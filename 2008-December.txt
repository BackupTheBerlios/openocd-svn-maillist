From ntfreak at mail.berlios.de  Sat Dec  6 11:48:49 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Sat, 6 Dec 2008 11:48:49 +0100
Subject: [Openocd-svn] r1218 - trunk/doc
Message-ID: <200812061048.mB6AmnmK026213@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-06 11:48:46 +0100 (Sat, 06 Dec 2008)
New Revision: 1218

Modified:
   trunk/doc/openocd.texi
Log:
- update texi to describe str9xpec driver flow

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-05 20:26:07 UTC (rev 1217)
+++ trunk/doc/openocd.texi	2008-12-06 10:48:46 UTC (rev 1218)
@@ -2080,7 +2080,7 @@
 @option{enable_turbo} <@var{num>.}
 
 Only use this driver for locking/unlocking the device or configuring the option bytes.
-Use the standard str9 driver for programming.
+Use the standard str9 driver for programming. @xref{STR9 specific commands}.
 
 @subsubsection stellaris (LM3Sxxx) options
 @cindex stellaris (LM3Sxxx) options
@@ -2140,6 +2140,7 @@
 
 @subsection STR9 specific commands
 @cindex STR9 specific commands
+ at anchor{STR9 specific commands}
 These are flash specific commands when using the str9xpec driver.
 @itemize @bullet
 @item @b{str9xpec enable_turbo} <@var{num}>
@@ -2164,6 +2165,43 @@
 @*write str9 option bytes. 
 @end itemize
 
+Note: Before using the str9xpec driver here is some background info to help
+you better understand how the drivers works. Openocd has two flash drivers for
+the str9.
+ at enumerate
+ at item
+Standard driver @option{str9x} programmed via the str9 core. Normally used for
+flash programming as it is faster than the @option{str9xpec} driver.
+ at item
+Direct programming @option{str9xpec} using the flash controller, this is
+ISC compilant (IEEE 1532) tap connected in series with the str9 core. The str9
+core does not need to be running to program using this flash driver. Typical use
+for this driver is locking/unlocking the target and programming the option bytes.
+ at end enumerate
+
+Before we run any cmds using the @option{str9xpec} driver we must first disable
+the str9 core. This example assumes the @option{str9xpec} driver has been
+configured for flash bank 0.
+ at example
+# assert srst, we do not want core running
+# while accessing str9xpec flash driver
+jtag_reset 0 1
+# turn off target polling
+poll off
+# disable str9 core
+str9xpec enable_turbo 0
+# read option bytes
+str9xpec options_read 0
+# re-enable str9 core
+str9xpec disable_turbo 0
+poll on
+reset halt
+ at end example
+The above example will read the str9 option bytes.
+When performing a unlock remember that you will not be able to halt the str9 - it
+has been locked. Halting the core is not required for the @option{str9xpec} driver
+as mentioned above, just issue the cmds above manually or from a telnet prompt.
+
 @subsection STR9 configuration
 @cindex STR9 configuration
 @itemize @bullet



From duane at mail.berlios.de  Sat Dec  6 14:13:04 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 6 Dec 2008 14:13:04 +0100
Subject: [Openocd-svn] r1219 - trunk
Message-ID: <200812061313.mB6DD47U025103@sheep.berlios.de>

Author: duane
Date: 2008-12-06 14:13:02 +0100 (Sat, 06 Dec 2008)
New Revision: 1219

Modified:
   trunk/README
Log:
Test of commit email from duane

Modified: trunk/README
===================================================================
--- trunk/README	2008-12-06 10:48:46 UTC (rev 1218)
+++ trunk/README	2008-12-06 13:13:02 UTC (rev 1219)
@@ -1 +1,2 @@
 openocd.texi is the authoritative source of OpenOCD documentation
+



From duane at mail.berlios.de  Mon Dec  8 12:23:07 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Mon, 8 Dec 2008 12:23:07 +0100
Subject: [Openocd-svn] r1220 - trunk/src/target/target
Message-ID: <200812081123.mB8BN7hZ005920@sheep.berlios.de>

Author: duane
Date: 2008-12-08 12:23:04 +0100 (Mon, 08 Dec 2008)
New Revision: 1220

Modified:
   trunk/src/target/target/at91r40008.cfg
   trunk/src/target/target/at91sam9260.cfg
   trunk/src/target/target/at91sam9260minimal.cfg
Log:
Typos in config files found by Sergey Lapin

Modified: trunk/src/target/target/at91r40008.cfg
===================================================================
--- trunk/src/target/target/at91r40008.cfg	2008-12-06 13:13:02 UTC (rev 1219)
+++ trunk/src/target/target/at91r40008.cfg	2008-12-08 11:23:04 UTC (rev 1220)
@@ -29,7 +29,7 @@
 #format L IRC IRCM IDCODE (Length, IR Capture, IR Capture Mask, IDCODE)
 jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGENAME -variant arm7tdmi
+target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm7tdmi
 
 
 $_TARGETNAME configure -event gdb-flash-erase-start {

Modified: trunk/src/target/target/at91sam9260.cfg
===================================================================
--- trunk/src/target/target/at91sam9260.cfg	2008-12-06 13:13:02 UTC (rev 1219)
+++ trunk/src/target/target/at91sam9260.cfg	2008-12-08 11:23:04 UTC (rev 1220)
@@ -9,7 +9,7 @@
 # Target configuration
 ######################
 
-$_TARGET_NAME configure -event reset-init {
+$_TARGETNAME configure -event reset-init {
 	# at reset chip runs at 32khz
 	jtag_khz 8
 	mww 0xfffffd08 0xa5000501         # RSTC_MR : enable user reset

Modified: trunk/src/target/target/at91sam9260minimal.cfg
===================================================================
--- trunk/src/target/target/at91sam9260minimal.cfg	2008-12-06 13:13:02 UTC (rev 1219)
+++ trunk/src/target/target/at91sam9260minimal.cfg	2008-12-08 11:23:04 UTC (rev 1220)
@@ -18,7 +18,7 @@
    set _CPUTAPID $CPUTAPID
 } else {
   # force an error till we get a good number
-   set _CPUTAPID 0xffffffff
+   set _CPUTAPID 0x0792603f
 }
 
 reset_config trst_and_srst
@@ -37,6 +37,6 @@
 target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm926ejs
 
 # Internal sram1 memory
-$_TARGET_NAME configure -work-area-virt 0 -work-area-phys 0x00300000 -work-area-size 0x1000 -work-area-backup 1
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00300000 -work-area-size 0x1000 -work-area-backup 1
 
 



From duane at mail.berlios.de  Wed Dec 10 02:15:29 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Wed, 10 Dec 2008 02:15:29 +0100
Subject: [Openocd-svn] r1221 - trunk/src/target/board
Message-ID: <200812100115.mBA1FTLQ030307@sheep.berlios.de>

Author: duane
Date: 2008-12-10 02:15:27 +0100 (Wed, 10 Dec 2008)
New Revision: 1221

Modified:
   trunk/src/target/board/hammer.cfg
Log:
Fix from Kees Jongenburger

Modified: trunk/src/target/board/hammer.cfg
===================================================================
--- trunk/src/target/board/hammer.cfg	2008-12-08 11:23:04 UTC (rev 1220)
+++ trunk/src/target/board/hammer.cfg	2008-12-10 01:15:27 UTC (rev 1221)
@@ -1,7 +1,7 @@
 # Target Configuration for the TinCanTools S3C2410 Based Hammer Module
 # http://www.tincantools.com
 
-source [target/samsung_s3c2410.cfg]
+source [find target/samsung_s3c2410.cfg]
 
 $_TARGETNAME configure -event reset-init {
 	# Reset Script for the TinCanTools S3C2410 Based Hammer Module



From duane at mail.berlios.de  Wed Dec 10 02:18:13 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Wed, 10 Dec 2008 02:18:13 +0100
Subject: [Openocd-svn] r1222 - trunk/src/target/target
Message-ID: <200812100118.mBA1IDcR031255@sheep.berlios.de>

Author: duane
Date: 2008-12-10 02:18:10 +0100 (Wed, 10 Dec 2008)
New Revision: 1222

Added:
   trunk/src/target/target/samsung_s3c2410.cfg
Removed:
   trunk/src/target/target/samsung_s2c2410.cfg
Log:
Fix from Kees Jongenburger (Part Duex)

Deleted: trunk/src/target/target/samsung_s2c2410.cfg
===================================================================
--- trunk/src/target/target/samsung_s2c2410.cfg	2008-12-10 01:15:27 UTC (rev 1221)
+++ trunk/src/target/target/samsung_s2c2410.cfg	2008-12-10 01:18:10 UTC (rev 1222)
@@ -1,35 +0,0 @@
-# Found on the 'TinCanTools' Hammer board.
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME s3c2410
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-  # This config file was defaulting to big endian..
-   set  _ENDIAN little
-}
-
-if { [info exists CPUTAPID] } {	
-   set  _CPUTAPID $CPUTAPID    
-} else {	 
-   set  _CPUTAPID 0xffffffff
-}
-
-#use combined on interfaces or targets that cannot set TRST/SRST separately
-reset_config trst_and_srst
-
-#jtag scan chain
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm920t -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm920t
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x30800000 -work-area-size 0x20000 -work-area-backup 0
-
-# speed up memory downloads
-arm7_9 fast_memory_access enable
-arm7_9 dcc_downloads enable

Copied: trunk/src/target/target/samsung_s3c2410.cfg (from rev 1220, trunk/src/target/target/samsung_s2c2410.cfg)


Property changes on: trunk/src/target/target/samsung_s3c2410.cfg
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native



From duane at mail.berlios.de  Wed Dec 10 12:44:55 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Wed, 10 Dec 2008 12:44:55 +0100
Subject: [Openocd-svn] r1223 - trunk/src/target/target
Message-ID: <200812101144.mBABit17000212@sheep.berlios.de>

Author: duane
Date: 2008-12-10 12:44:45 +0100 (Wed, 10 Dec 2008)
New Revision: 1223

Modified:
   trunk/src/target/target/imote2.cfg
   trunk/src/target/target/is5114.cfg
   trunk/src/target/target/samsung_s3c6410.cfg
Log:
More fixes thanks to Kees Jongenburger

Modified: trunk/src/target/target/imote2.cfg
===================================================================
--- trunk/src/target/target/imote2.cfg	2008-12-10 01:18:10 UTC (rev 1222)
+++ trunk/src/target/target/imote2.cfg	2008-12-10 11:44:45 UTC (rev 1223)
@@ -35,7 +35,7 @@
 jtag newtap $_CHIPNAME cpu -irlen 7 -ircapture 0x1 -irmask 0x7f -expected-id $_CPUTAPID
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME xscale -endian $_ENDIAN -chain-position $_TARGETNAME -varient pxa27x
+target create $_TARGETNAME xscale -endian $_ENDIAN -chain-position $_TARGETNAME -variant pxa27x
 $_TARGETNAME configure -work-area-virt 0x0x5c000000 -work-area-phys 0x0x5c000000 -work-area-size 0x10000 -work-area-backup 1
 # maps to PXA internal RAM. If you are using a PXA255
 # you must initialize SDRAM or leave this option off

Modified: trunk/src/target/target/is5114.cfg
===================================================================
--- trunk/src/target/target/is5114.cfg	2008-12-10 01:18:10 UTC (rev 1222)
+++ trunk/src/target/target/is5114.cfg	2008-12-10 11:44:45 UTC (rev 1223)
@@ -39,7 +39,7 @@
 
 #arm946e-s and 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm966e -endian $_ENDIAN  -chain-position $_TARGETNAME  -varient arm966e
+target create $_TARGETNAME arm966e -endian $_ENDIAN  -chain-position $_TARGETNAME  -variant arm966e
 
 $_TARGETNAME configure -event reset-start { jtag_rclk 16 }
 $_TARGETNAME configure -event reset-init {

Modified: trunk/src/target/target/samsung_s3c6410.cfg
===================================================================
--- trunk/src/target/target/samsung_s3c6410.cfg	2008-12-10 01:18:10 UTC (rev 1222)
+++ trunk/src/target/target/samsung_s3c6410.cfg	2008-12-10 11:44:45 UTC (rev 1223)
@@ -23,14 +23,14 @@
    set _BSTAPID $BSTAPID
 } else {
   # force an error till we get a good number
-   set _BSTAPID 0xffffffff
+   set _BSTAPID 0x2b900f0f
 }
 
 if { [info exists CPUTAPID ] } {
    set _CPUTAPID $CPUTAPID
 } else {
   # force an error till we get a good number
-   set _CPUTAPID 0xffffffff
+   set _CPUTAPID 0x07b76f0f
 }
 
 #jtag scan chain
@@ -40,7 +40,7 @@
 jtag newtap $_CHIPNAME cpu     -irlen 5 -ircapture 0x1 -irmask 0x1f -expected-id $_CPUTAPID
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm11 -endian $_ENDIAN  -chain-position $_TARGETNAME -varient arm1176
+target create $_TARGETNAME arm11 -endian $_ENDIAN  -chain-position $_TARGETNAME -variant arm1176
 
 jtag_nsrst_delay 500
 jtag_ntrst_delay 500



From ntfreak at mail.berlios.de  Wed Dec 10 18:47:18 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Wed, 10 Dec 2008 18:47:18 +0100
Subject: [Openocd-svn] r1224 - trunk/src/helper
Message-ID: <200812101747.mBAHlIfT019845@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-10 18:47:16 +0100 (Wed, 10 Dec 2008)
New Revision: 1224

Modified:
   trunk/src/helper/command.c
Log:
- fix illegal memory access in unregister_command function

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2008-12-10 11:44:45 UTC (rev 1223)
+++ trunk/src/helper/command.c	2008-12-10 17:47:16 UTC (rev 1224)
@@ -289,8 +289,10 @@
 		return ERROR_INVALID_ARGUMENTS;
 
 	/* find command */
-	for (c = context->commands; c; c = c->next)
-	{
+	c = context->commands;
+	
+	while(NULL != c)
+	{		
 		if (strcmp(name, c->name) == 0)
 		{
 			/* unlink command */
@@ -300,26 +302,32 @@
 			}
 			else
 			{
+				/* first element in command list */
 				context->commands = c->next;
 			}
-
+			
 			/* unregister children */
-			if (c->children)
+			while(NULL != c->children)
 			{
-				for (c2 = c->children; c2; c2 = c2->next)
-				{
-					free(c2->name);
-					free(c2);
-				}
+				c2 = c->children;
+				c->children = c->children->next;
+				free(c2->name);
+				c2->name = NULL;
+				free(c2);
+				c2 = NULL;
 			}
-
+			
 			/* delete command */
 			free(c->name);
+			c->name = NULL;
 			free(c);
+			c = NULL;
+			return ERROR_OK;
 		}
-
+		
 		/* remember the last command for unlinking */
 		p = c;
+		c = c->next;
 	}
 
 	return ERROR_OK;



From ntfreak at mail.berlios.de  Thu Dec 11 16:53:46 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Thu, 11 Dec 2008 16:53:46 +0100
Subject: [Openocd-svn] r1225 - in trunk: doc src/flash
Message-ID: <200812111553.mBBFrkZ8014554@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-11 16:53:45 +0100 (Thu, 11 Dec 2008)
New Revision: 1225

Modified:
   trunk/doc/openocd.texi
   trunk/src/flash/flash.c
Log:
- typo with flash bank help command
- typo with flash erase_sector in texi

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-10 17:47:16 UTC (rev 1224)
+++ trunk/doc/openocd.texi	2008-12-11 15:53:45 UTC (rev 1225)
@@ -1950,7 +1950,7 @@
 @cindex flash protect_check
 @*Check protection state of sectors in flash bank <num>. 
 @option{flash erase_sector} using the same syntax. 
- at subsection fash erase_sector
+ at subsection flash erase_sector
 @b{flash erase_sector} <@var{num}> <@var{first}> <@var{last}>
 @cindex flash erase_sector
 @anchor{flash erase_sector}

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2008-12-10 17:47:16 UTC (rev 1224)
+++ trunk/src/flash/flash.c	2008-12-11 15:53:45 UTC (rev 1225)
@@ -144,7 +144,7 @@
 {
 	flash_cmd = register_command(cmd_ctx, NULL, "flash", NULL, COMMAND_ANY, NULL);
 
-	register_command(cmd_ctx, flash_cmd, "bank", handle_flash_bank_command, COMMAND_CONFIG, "flash_bank <driver> <base> <size> <chip_width> <bus_width> <target> [driver_options ...]");
+	register_command(cmd_ctx, flash_cmd, "bank", handle_flash_bank_command, COMMAND_CONFIG, "flash bank <driver> <base> <size> <chip_width> <bus_width> <target> [driver_options ...]");
 	return ERROR_OK;
 }
 



From kc8apf at mail.berlios.de  Thu Dec 11 20:03:19 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Thu, 11 Dec 2008 20:03:19 +0100
Subject: [Openocd-svn] r1226 - trunk/src/jtag
Message-ID: <200812111903.mBBJ3JHf016815@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-11 20:03:17 +0100 (Thu, 11 Dec 2008)
New Revision: 1226

Modified:
   trunk/src/jtag/ft2232.c
Log:
AXM0432 layout for FDTI provided by Alan Carvalho de Assis (Freescale)

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2008-12-11 15:53:45 UTC (rev 1225)
+++ trunk/src/jtag/ft2232.c	2008-12-11 19:03:17 UTC (rev 1226)
@@ -102,6 +102,7 @@
 int turtle_init(void);
 int comstick_init(void);
 int stm32stick_init(void);
+int axm0432_jtag_init(void);
 
 /* reset procedures for supported layouts */
 void usbjtag_reset(int trst, int srst);
@@ -111,7 +112,9 @@
 void turtle_reset(int trst, int srst);
 void comstick_reset(int trst, int srst);
 void stm32stick_reset(int trst, int srst);
+void axm0432_jtag_reset(int trst, int srst);
 
+
 /* blink procedures for layouts that support a blinking led */
 void olimex_jtag_blink(void);
 void turtle_jtag_blink(void);
@@ -129,6 +132,7 @@
 	{"turtelizer2", turtle_init, turtle_reset, turtle_jtag_blink},
 	{"comstick", comstick_init, comstick_reset, NULL},
 	{"stm32stick", stm32stick_init, stm32stick_reset, NULL},
+	{"axm0432_jtag", axm0432_jtag_init, axm0432_jtag_reset, NULL},
 	{NULL, NULL, NULL},
 };
 
@@ -1045,6 +1049,38 @@
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output, high_direction);
 }
 
+
+void axm0432_jtag_reset(int trst, int srst)
+{
+	if (trst == 1)
+	{
+		cur_state = TAP_TLR;
+		high_output &= ~nTRST;
+	}
+	else if (trst == 0)
+	{
+		high_output |= nTRST;
+	}
+
+    if (srst == 1)
+    {
+            high_output &= ~nSRST;
+    }
+    else if (srst == 0)
+    {
+            high_output |= nSRST;
+    }
+
+    /* command "set data bits low byte" */
+    BUFFER_ADD = 0x82;
+    BUFFER_ADD = high_output;
+    BUFFER_ADD = high_direction;
+    LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output, high_direction);
+}
+
+
+
+
 void flyswatter_reset(int trst, int srst)
 {
 	if (trst == 1)
@@ -1722,6 +1758,82 @@
 	return ERROR_OK;
 }
 
+
+int axm0432_jtag_init(void)
+{
+	u8 buf[3];
+        u8 buf_read[1];
+	u32 bytes_written;
+        u32 bytes_read;
+	
+	low_output = 0x08;
+	low_direction = 0x2b;
+	
+	/* initialize low byte for jtag */
+	buf[0] = 0x80; /* command "set data bits low byte" */
+	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
+	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
+	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
+	
+	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
+	{
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		return ERROR_JTAG_INIT_FAILED;
+	}
+
+      
+	if (strcmp(layout->name, "axm0432_jtag") == 0)
+	{
+		nTRST = 0x08;
+		nTRSTnOE = 0x0;  /* No output enable for TRST*/
+		nSRST = 0x04;
+		nSRSTnOE = 0x0;  /* No output enable for SRST*/ 
+	}
+	else
+	{
+		LOG_ERROR("BUG: axm0432_jtag_init called for non axm0432 layout");
+		exit(-1);
+	}
+	
+	high_output = 0x0;
+	high_direction = 0x0c;
+
+        if (jtag_reset_config & RESET_TRST_OPEN_DRAIN)
+	{
+                LOG_ERROR("can't set nTRSTOE to push-pull on the Dicarlo jtag");
+        }
+	else
+	{
+		high_output |= nTRST;
+	}
+
+        if (jtag_reset_config & RESET_SRST_PUSH_PULL)
+	{
+		LOG_ERROR("can't set nSRST to push-pull on the Dicarlo jtag");
+	}
+	else
+	{
+		high_output |= nSRST;
+	}
+	
+	/* initialize high port */
+	buf[0] = 0x82; /* command "set data bits high byte" */
+	buf[1] = high_output; /* value */
+	buf[2] = high_direction;   /* all outputs (xRST and xRSTnOE) */
+	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
+	
+	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
+	{
+		LOG_ERROR("couldn't initialize FT2232 with 'Dicarlo' layout"); 
+		return ERROR_JTAG_INIT_FAILED;
+	}
+	
+	return ERROR_OK;
+}
+
+
+
+
 int jtagkey_init(void)
 {
 	u8 buf[3];



From ntfreak at mail.berlios.de  Fri Dec 12 00:22:16 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Fri, 12 Dec 2008 00:22:16 +0100
Subject: [Openocd-svn] r1227 - in trunk: doc src/jtag
Message-ID: <200812112322.mBBNMGx2010586@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-12 00:22:16 +0100 (Fri, 12 Dec 2008)
New Revision: 1227

Modified:
   trunk/doc/openocd.texi
   trunk/src/jtag/ft2232.c
Log:
- added Axiom AXM-0432 to texi
- updated missing jtag dongle url's in texi
- reformat and remove whitespace from last commit

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-11 19:03:17 UTC (rev 1226)
+++ trunk/doc/openocd.texi	2008-12-11 23:22:16 UTC (rev 1227)
@@ -286,7 +286,7 @@
 
 @itemize @bullet
 @item @b{usbjtag}
-@* Link Unknown [not easily verified]
+@* Link @url{www.ixo.de/info/usb_jtag}
 @item @b{jtagkey}
 @* See: @url{http://www.amontec.com/jtagkey.shtml}
 @item @b{oocdlink}
@@ -304,7 +304,9 @@
 @item @b{comstick}
 @* Link: @url{http://www.hitex.com/index.php?id=383}
 @item @b{stm32stick}
-@* Link Unknown [not easily verified]
+@* Link @url{http://www.hitex.com/stm32-stick}
+ at item @b{axm0432_jtag}
+@* Axiom AXM-0432 Link @url{http://www.axman.com}
 @end itemize
 
 @section USB JLINK based
@@ -370,7 +372,7 @@
 @* Unknown.
 
 @item @b{Lattice}
-@* From Lattice Semiconductor [link unknown]
+@* ispDownload from Lattice Semiconductor @url{http://www.latticesemi.com/lit/docs/devtools/dlcable.pdf}
 
 @item @b{flashlink}
 @* From ST Microsystems, link:

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2008-12-11 19:03:17 UTC (rev 1226)
+++ trunk/src/jtag/ft2232.c	2008-12-11 23:22:16 UTC (rev 1227)
@@ -114,7 +114,6 @@
 void stm32stick_reset(int trst, int srst);
 void axm0432_jtag_reset(int trst, int srst);
 
-
 /* blink procedures for layouts that support a blinking led */
 void olimex_jtag_blink(void);
 void turtle_jtag_blink(void);
@@ -1049,7 +1048,6 @@
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output, high_direction);
 }
 
-
 void axm0432_jtag_reset(int trst, int srst)
 {
 	if (trst == 1)
@@ -1062,25 +1060,22 @@
 		high_output |= nTRST;
 	}
 
-    if (srst == 1)
-    {
-            high_output &= ~nSRST;
-    }
-    else if (srst == 0)
-    {
-            high_output |= nSRST;
-    }
+	if (srst == 1)
+	{
+		high_output &= ~nSRST;
+	}
+	else if (srst == 0)
+	{
+		high_output |= nSRST;
+	}
 
-    /* command "set data bits low byte" */
-    BUFFER_ADD = 0x82;
-    BUFFER_ADD = high_output;
-    BUFFER_ADD = high_direction;
-    LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output, high_direction);
+	/* command "set data bits low byte" */
+	BUFFER_ADD = 0x82;
+	BUFFER_ADD = high_output;
+	BUFFER_ADD = high_direction;
+	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output, high_direction);
 }
 
-
-
-
 void flyswatter_reset(int trst, int srst)
 {
 	if (trst == 1)
@@ -1414,15 +1409,13 @@
 	char *openex_string = NULL;
 	u8 latency_timer;
 
-	LOG_DEBUG("'ft2232' interface using FTD2XX with '%s' layout (%4.4x:%4.4x)",
-	    ft2232_layout, vid, pid);
+	LOG_DEBUG("'ft2232' interface using FTD2XX with '%s' layout (%4.4x:%4.4x)",ft2232_layout, vid, pid);
 
 #if IS_WIN32 == 0
 	/* Add non-standard Vid/Pid to the linux driver */
 	if ((status = FT_SetVIDPID(vid, pid)) != FT_OK)
 	{
-		LOG_WARNING("couldn't add %4.4x:%4.4x",
-		    vid, pid);
+		LOG_WARNING("couldn't add %4.4x:%4.4x", vid, pid);
 	}
 #endif
 
@@ -1455,8 +1448,7 @@
 		DWORD num_devices;
 		
 		if (more) {
-			LOG_WARNING("unable to open ftdi device (trying more): %lu",
-			    status);
+			LOG_WARNING("unable to open ftdi device (trying more): %lu", status);
 			*try_more = 1;
 			return ERROR_JTAG_INIT_FAILED;
 		}
@@ -1758,13 +1750,10 @@
 	return ERROR_OK;
 }
 
-
 int axm0432_jtag_init(void)
 {
 	u8 buf[3];
-        u8 buf_read[1];
 	u32 bytes_written;
-        u32 bytes_read;
 	
 	low_output = 0x08;
 	low_direction = 0x2b;
@@ -1781,7 +1770,6 @@
 		return ERROR_JTAG_INIT_FAILED;
 	}
 
-      
 	if (strcmp(layout->name, "axm0432_jtag") == 0)
 	{
 		nTRST = 0x08;
@@ -1798,16 +1786,16 @@
 	high_output = 0x0;
 	high_direction = 0x0c;
 
-        if (jtag_reset_config & RESET_TRST_OPEN_DRAIN)
+	if (jtag_reset_config & RESET_TRST_OPEN_DRAIN)
 	{
-                LOG_ERROR("can't set nTRSTOE to push-pull on the Dicarlo jtag");
-        }
+		LOG_ERROR("can't set nTRSTOE to push-pull on the Dicarlo jtag");
+	}
 	else
 	{
 		high_output |= nTRST;
 	}
 
-        if (jtag_reset_config & RESET_SRST_PUSH_PULL)
+	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
 	{
 		LOG_ERROR("can't set nSRST to push-pull on the Dicarlo jtag");
 	}
@@ -1831,9 +1819,6 @@
 	return ERROR_OK;
 }
 
-
-
-
 int jtagkey_init(void)
 {
 	u8 buf[3];
@@ -2048,7 +2033,7 @@
 	}
 	
 	nSRST = 0x40;
-  	
+	
 	high_output = 0x00;
 	high_direction = 0x0C;
 	
@@ -2091,7 +2076,7 @@
 	nTRSTnOE = 0x00; /* no output enable for nTRST */
 	nSRST = 0x02;
 	nSRSTnOE = 0x00; /* no output enable for nSRST */
-  	
+	
 	high_output = 0x03;
 	high_direction = 0x03;
 	
@@ -2134,7 +2119,7 @@
 	nTRSTnOE = 0x00; /* no output enable for nTRST */
 	nSRST = 0x80;
 	nSRSTnOE = 0x00; /* no output enable for nSRST */
-  	
+	
 	high_output = 0x01;
 	high_direction = 0x03;
 	



From ntfreak at mail.berlios.de  Fri Dec 12 00:36:52 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Fri, 12 Dec 2008 00:36:52 +0100
Subject: [Openocd-svn] r1228 - trunk/doc
Message-ID: <200812112336.mBBNaqCu018755@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-12 00:36:51 +0100 (Fri, 12 Dec 2008)
New Revision: 1228

Modified:
   trunk/doc/openocd.texi
Log:
- incorrect url in last commit for usbjtag
- added missing ft2232 option for interface axm0432_jtag

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-11 23:22:16 UTC (rev 1227)
+++ trunk/doc/openocd.texi	2008-12-11 23:36:51 UTC (rev 1228)
@@ -286,7 +286,7 @@
 
 @itemize @bullet
 @item @b{usbjtag}
-@* Link @url{www.ixo.de/info/usb_jtag}
+@* Link @url{http://www.hs-augsburg.de/~hhoegl/proj/usbjtag/usbjtag.html}
 @item @b{jtagkey}
 @* See: @url{http://www.amontec.com/jtagkey.shtml}
 @item @b{oocdlink}
@@ -1179,6 +1179,8 @@
 egnite Software turtelizer2
 @item @b{oocdlink}
 OOCDLink
+ at item @b{axm0432_jtag}
+Axiom AXM-0432
 @end itemize
 
 @item @b{ft2232_vid_pid} <@var{vid}> <@var{pid}>



From kc8apf at mail.berlios.de  Fri Dec 12 01:21:10 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Fri, 12 Dec 2008 01:21:10 +0100
Subject: [Openocd-svn] r1229 - trunk/src/jtag
Message-ID: <200812120021.mBC0LAUh006078@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-12 01:21:07 +0100 (Fri, 12 Dec 2008)
New Revision: 1229

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
Log:
Allow -expected-id to be specified multiple times when creating a jtag tap

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-11 23:36:51 UTC (rev 1228)
+++ trunk/src/jtag/jtag.c	2008-12-12 00:21:07 UTC (rev 1229)
@@ -1574,20 +1574,36 @@
 		if (tap)
 		{
 			tap->idcode = idcode;
-			if( tap->expected_id ){
-				if( tap->idcode != tap->expected_id ){
-					LOG_ERROR("ERROR: Tap: %s - Expected id: 0x%08x, Got: 0x%08x",
+
+			if (tap->expected_ids_cnt > 0) {
+				/* Loop over the expected identification codes and test for a match */
+				u8 ii;
+				for (ii = 0; ii < tap->expected_ids_cnt; ii++) {
+					if( tap->idcode == tap->expected_ids[ii] ){
+						break;
+					}
+				}
+			
+				/* If none of the expected ids matched, log an error */
+				if (ii == tap->expected_ids_cnt) {
+					LOG_ERROR("JTAG tap: %s             got: 0x%08x (mfg: 0x%3.3x, part: 0x%4.4x, ver: 0x%1.1x)",
 							  tap->dotted_name,
-							  tap->expected_id,
-							  idcode );
-					LOG_ERROR("ERROR: expected: mfg: 0x%3.3x, part: 0x%4.4x, ver: 0x%1.1x",
-							  EXTRACT_MFG( tap->expected_id ),
-							  EXTRACT_PART( tap->expected_id ),
-							  EXTRACT_VER( tap->expected_id ) );
-					LOG_ERROR("ERROR:      got: mfg: 0x%3.3x, part: 0x%4.4x, ver: 0x%1.1x",
+							  idcode,
 							  EXTRACT_MFG( tap->idcode ),
 							  EXTRACT_PART( tap->idcode ),
 							  EXTRACT_VER( tap->idcode ) );
+					for (ii = 0; ii < tap->expected_ids_cnt; ii++) {
+						LOG_ERROR("JTAG tap: %s expected %hhu of %hhu: 0x%08x (mfg: 0x%3.3x, part: 0x%4.4x, ver: 0x%1.1x)",
+								  tap->dotted_name,
+								  ii + 1,
+								  tap->expected_ids_cnt,
+								  tap->expected_ids[ii],
+								  EXTRACT_MFG( tap->expected_ids[ii] ),
+								  EXTRACT_PART( tap->expected_ids[ii] ),
+								  EXTRACT_VER( tap->expected_ids[ii] ) );
+					}
+
+					return ERROR_JTAG_INIT_FAILED;
 				} else {
 					LOG_INFO("JTAG Tap/device matched");
 				}
@@ -1767,9 +1783,30 @@
 			pTap->enabled = 0;
 			break;
 		case NTAP_OPT_EXPECTED_ID:
+		{
+			u32 *new_expected_ids;
+
 			e = Jim_GetOpt_Wide( goi, &w );
-			pTap->expected_id = w;
+			if( e != JIM_OK) {
+				Jim_SetResult_sprintf(goi->interp, "option: %s bad parameter", n->name);
+				return e;
+			}
+
+			new_expected_ids = malloc(sizeof(u32) * (pTap->expected_ids_cnt + 1));
+			if (new_expected_ids == NULL) {
+				Jim_SetResult_sprintf( goi->interp, "no memory");
+				return JIM_ERR;
+			}
+
+			memcpy(new_expected_ids, pTap->expected_ids, sizeof(u32) * pTap->expected_ids_cnt);
+
+			new_expected_ids[pTap->expected_ids_cnt] = w;
+		
+			free(pTap->expected_ids);	
+			pTap->expected_ids = new_expected_ids;
+			pTap->expected_ids_cnt++;
 			break;
+		}
 		case NTAP_OPT_IRLEN:
 		case NTAP_OPT_IRMASK:
 		case NTAP_OPT_IRCAPTURE:
@@ -1809,6 +1846,7 @@
 							   pTap->dotted_name);
 		// fixme: Tell user what is missing :-(
 		// no memory leaks pelase
+		free(((void *)(pTap->expected_ids)));
 		free(((void *)(pTap->chip)));
 		free(((void *)(pTap->tapname)));
 		free(((void *)(pTap->dotted_name)));
@@ -2270,21 +2308,28 @@
 	command_print(cmd_ctx, "---|--------------------|---------|------------|------------|------|------|------|---------");
 
 	while( tap ){
-		u32 expected, expected_mask, cur_instr;
+		u32 expected, expected_mask, cur_instr, ii;
 		expected = buf_get_u32(tap->expected, 0, tap->ir_length);
 		expected_mask = buf_get_u32(tap->expected_mask, 0, tap->ir_length);
 		cur_instr = buf_get_u32(tap->cur_instr, 0, tap->ir_length);
+
 		command_print(cmd_ctx,
 					  "%2d | %-18s |    %c    | 0x%08x | 0x%08x | 0x%02x | 0x%02x | 0x%02x | 0x%02x",
 					  tap->abs_chain_position,
 					  tap->dotted_name,
 					  tap->enabled ? 'Y' : 'n',
 					  tap->idcode,
-					  tap->expected_id,
+					  (tap->expected_ids_cnt > 0 ? tap->expected_ids[0] : 0),
 					  tap->ir_length,
 					  expected,
 					  expected_mask,
 					  cur_instr);
+
+		for (ii = 1; ii < tap->expected_ids_cnt; ii++) {
+			command_print(cmd_ctx, "   |                    |         |            | 0x%08x |      |      |      |         ",
+						  tap->expected_ids[ii]);
+		}
+
 		tap = tap->next_tap;
 	}
 

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2008-12-11 23:36:51 UTC (rev 1228)
+++ trunk/src/jtag/jtag.h	2008-12-12 00:21:07 UTC (rev 1229)
@@ -179,7 +179,8 @@
 	u32 ir_capture_mask;
 	u8 *expected_mask;	/* Capture-IR expected mask */
 	u32 idcode;			/* device identification code */
-	u32 expected_id;
+	u32 *expected_ids;	/* Array of expected identification codes */
+	u8 expected_ids_cnt;/* Number of expected identification codes */
 	u8 *cur_instr;		/* current instruction */
 	int bypass;			/* bypass register selected */
 	jtag_tap_t *next_tap;



From oharboe at mail.berlios.de  Fri Dec 12 19:33:29 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 12 Dec 2008 19:33:29 +0100
Subject: [Openocd-svn] r1230 - zy1000
Message-ID: <200812121833.mBCIXT1J021340@sheep.berlios.de>

Author: oharboe
Date: 2008-12-12 19:33:19 +0100 (Fri, 12 Dec 2008)
New Revision: 1230

Added:
   zy1000/tags/
Log:
layout fix



From ntfreak at mail.berlios.de  Fri Dec 12 23:14:22 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Fri, 12 Dec 2008 23:14:22 +0100
Subject: [Openocd-svn] r1231 - trunk/src/target
Message-ID: <200812122214.mBCMEMu0027013@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-12 23:14:21 +0100 (Fri, 12 Dec 2008)
New Revision: 1231

Modified:
   trunk/src/target/cortex_m3.c
   trunk/src/target/cortex_m3.h
Log:
- check cortex_m3 FPB is enabled when setting hardware breakpoint
- Thanks Igor Skochinsky

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2008-12-12 18:33:19 UTC (rev 1230)
+++ trunk/src/target/cortex_m3.c	2008-12-12 22:14:21 UTC (rev 1231)
@@ -225,6 +225,7 @@
 
 	/* Enable FPB */
 	target_write_u32(target, FP_CTRL, 3);
+	cortex_m3->fpb_enabled = 1;
 
 	/* Restore FPB registers */
 	for (i = 0; i < cortex_m3->fp_num_code + cortex_m3->fp_num_lit; i++)
@@ -869,6 +870,11 @@
 		comparator_list[fp_num].fpcr_value = (breakpoint->address & 0x1FFFFFFC) | hilo | 1;
 		target_write_u32(target, comparator_list[fp_num].fpcr_address, comparator_list[fp_num].fpcr_value);
 		LOG_DEBUG("fpc_num %i fpcr_value 0x%x", fp_num, comparator_list[fp_num].fpcr_value);
+		if (!cortex_m3->fpb_enabled)
+		{
+			LOG_DEBUG("FPB wasn't enabled, do it now");
+			target_write_u32(target, FP_CTRL, 3);
+		}
 	}
 	else if (breakpoint->type == BKPT_SOFT)
 	{
@@ -1401,10 +1407,11 @@
 		/* Setup FPB */
 		target_read_u32(target, FP_CTRL, &fpcr);
 		cortex_m3->auto_bp_type = 1;
-		cortex_m3->fp_num_code = (fpcr >> 4) & 0xF;
+		cortex_m3->fp_num_code = (fpcr >> 8) & 0x70 | (fpcr >> 4) & 0xF; /* bits [14:12] and [7:4] */
 		cortex_m3->fp_num_lit = (fpcr >> 8) & 0xF;
 		cortex_m3->fp_code_available = cortex_m3->fp_num_code;
 		cortex_m3->fp_comparator_list = calloc(cortex_m3->fp_num_code + cortex_m3->fp_num_lit, sizeof(cortex_m3_fp_comparator_t));
+		cortex_m3->fpb_enabled = fpcr & 1;
 		for (i = 0; i < cortex_m3->fp_num_code + cortex_m3->fp_num_lit; i++)
 		{
 			cortex_m3->fp_comparator_list[i].type = (i < cortex_m3->fp_num_code) ? FPCR_CODE : FPCR_LITERAL;

Modified: trunk/src/target/cortex_m3.h
===================================================================
--- trunk/src/target/cortex_m3.h	2008-12-12 18:33:19 UTC (rev 1230)
+++ trunk/src/target/cortex_m3.h	2008-12-12 22:14:21 UTC (rev 1231)
@@ -145,14 +145,15 @@
 	u32 nvic_dfsr;  /* Debug Fault Status Register - shows reason for debug halt */
 	u32 nvic_icsr;  /* Interrupt Control State Register - shows active and pending IRQ */
 	
-	/* Flash Patch and Breakpoint */
+	/* Flash Patch and Breakpoint (FPB) */
 	int fp_num_lit;
 	int fp_num_code;
 	int fp_code_available;
+	int fpb_enabled;
 	int auto_bp_type;
 	cortex_m3_fp_comparator_t *fp_comparator_list;
 	
-	/* DWT */
+	/* Data Watchpoint and Trace (DWT) */
 	int dwt_num_comp;
 	int dwt_comp_available;
 	cortex_m3_dwt_comparator_t *dwt_comparator_list;



From kc8apf at mail.berlios.de  Sat Dec 13 07:26:13 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Sat, 13 Dec 2008 07:26:13 +0100
Subject: [Openocd-svn] r1232 - in trunk/src: flash jtag pld target xsvf
Message-ID: <200812130626.mBD6QDfp008761@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-13 07:25:50 +0100 (Sat, 13 Dec 2008)
New Revision: 1232

Modified:
   trunk/src/flash/str9xpec.c
   trunk/src/jtag/amt_jtagaccel.c
   trunk/src/jtag/bitbang.c
   trunk/src/jtag/bitq.c
   trunk/src/jtag/ft2232.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/jlink.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/usbprog.c
   trunk/src/jtag/zy1000.c
   trunk/src/pld/virtex2.c
   trunk/src/target/arm11.c
   trunk/src/target/arm11_dbgtap.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7_9_common.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/cortex_swjdp.c
   trunk/src/target/embeddedice.c
   trunk/src/target/etb.c
   trunk/src/target/etm.c
   trunk/src/target/feroceon.c
   trunk/src/target/mips_ejtag.c
   trunk/src/target/mips_m4k.c
   trunk/src/target/xscale.c
   trunk/src/xsvf/xsvf.c
Log:
Change tap_state naming to be consistent with SVF documentation.

Courtesy of Dick Hollenbeck <dick at softplc.com>


Modified: trunk/src/flash/str9xpec.c
===================================================================
--- trunk/src/flash/str9xpec.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/flash/str9xpec.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -145,7 +145,7 @@
 	scan_field_t field;
 	u8 status;
 
-	if (str9xpec_set_instr(tap, ISC_NOOP, TAP_PI) != ERROR_OK)
+	if (str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE) != ERROR_OK)
 		return ISC_STATUS_ERROR;
 
 	field.tap = tap;
@@ -158,7 +158,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
 
 	LOG_DEBUG("status: 0x%2.2x", status);
@@ -181,7 +181,7 @@
 		return ERROR_OK;
 
 	/* enter isc mode */
-	if (str9xpec_set_instr(tap, ISC_ENABLE, TAP_RTI) != ERROR_OK)
+	if (str9xpec_set_instr(tap, ISC_ENABLE, TAP_IDLE) != ERROR_OK)
 		return ERROR_TARGET_INVALID;
 
 	/* check ISC status */
@@ -207,7 +207,7 @@
 	if (!str9xpec_info->isc_enable)
 		return ERROR_OK;
 
-	if (str9xpec_set_instr(tap, ISC_DISABLE, TAP_RTI) != ERROR_OK)
+	if (str9xpec_set_instr(tap, ISC_DISABLE, TAP_IDLE) != ERROR_OK)
 		return ERROR_TARGET_INVALID;
 
 	/* delay to handle aborts */
@@ -238,7 +238,7 @@
 	LOG_DEBUG("ISC_CONFIGURATION");
 
 	/* execute ISC_CONFIGURATION command */
-	str9xpec_set_instr(tap, ISC_CONFIGURATION, TAP_PI);
+	str9xpec_set_instr(tap, ISC_CONFIGURATION, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 64;
@@ -250,7 +250,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
 
 	status = str9xpec_isc_status(tap);
@@ -349,10 +349,10 @@
 	armv4_5 = bank->target->arch_info;
 	arm7_9 = armv4_5->arch_info;
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	str9xpec_info->tap = jtag_TapByAbsPosition( jtag_info->tap->abs_chain_position - 1);
 	str9xpec_info->isc_enable = 0;
-	
+
 	str9xpec_build_block_list(bank);
 
 	/* clear option byte register */
@@ -390,7 +390,7 @@
 	}
 
 	/* execute ISC_BLANK_CHECK command */
-	str9xpec_set_instr(tap, ISC_BLANK_CHECK, TAP_PI);
+	str9xpec_set_instr(tap, ISC_BLANK_CHECK, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 64;
@@ -402,7 +402,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_add_sleep(40000);
 
 	/* read blank check result */
@@ -416,7 +416,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_PI);
+	jtag_add_dr_scan(1, &field, TAP_IRPAUSE);
 	jtag_execute_queue();
 
 	status = str9xpec_isc_status(tap);
@@ -506,7 +506,7 @@
 	LOG_DEBUG("ISC_ERASE");
 
 	/* execute ISC_ERASE command */
-	str9xpec_set_instr(tap, ISC_ERASE, TAP_PI);
+	str9xpec_set_instr(tap, ISC_ERASE, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 64;
@@ -518,7 +518,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
 
 	jtag_add_sleep(10);
@@ -569,9 +569,9 @@
 	str9xpec_set_address(bank, 0x80);
 
 	/* execute ISC_PROGRAM command */
-	str9xpec_set_instr(tap, ISC_PROGRAM_SECURITY, TAP_RTI);
+	str9xpec_set_instr(tap, ISC_PROGRAM_SECURITY, TAP_IDLE);
 
-	str9xpec_set_instr(tap, ISC_NOOP, TAP_PI);
+	str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE);
 
 	do {
 		field.tap = tap;
@@ -658,7 +658,7 @@
 	tap = str9xpec_info->tap;
 
 	/* set flash controller address */
-	str9xpec_set_instr(tap, ISC_ADDRESS_SHIFT, TAP_PI);
+	str9xpec_set_instr(tap, ISC_ADDRESS_SHIFT, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 8;
@@ -747,7 +747,7 @@
 
 		while (dwords_remaining > 0)
 		{
-			str9xpec_set_instr(tap, ISC_PROGRAM, TAP_PI);
+			str9xpec_set_instr(tap, ISC_PROGRAM, TAP_IRPAUSE);
 
 			field.tap = tap;
 			field.num_bits = 64;
@@ -759,12 +759,12 @@
 			field.in_handler = NULL;
 			field.in_handler_priv = NULL;
 
-			jtag_add_dr_scan(1, &field, TAP_RTI);
+			jtag_add_dr_scan(1, &field, TAP_IDLE);
 
 			/* small delay before polling */
 			jtag_add_sleep(50);
 
-			str9xpec_set_instr(tap, ISC_NOOP, TAP_PI);
+			str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE);
 
 			do {
 				field.tap = tap;
@@ -807,7 +807,7 @@
 			bytes_written++;
 		}
 
-		str9xpec_set_instr(tap, ISC_PROGRAM, TAP_PI);
+		str9xpec_set_instr(tap, ISC_PROGRAM, TAP_IRPAUSE);
 
 		field.tap = tap;
 		field.num_bits = 64;
@@ -819,12 +819,12 @@
 		field.in_handler = NULL;
 		field.in_handler_priv = NULL;
 
-		jtag_add_dr_scan(1, &field, TAP_RTI);
+		jtag_add_dr_scan(1, &field, TAP_IDLE);
 
 		/* small delay before polling */
 		jtag_add_sleep(50);
 
-		str9xpec_set_instr(tap, ISC_NOOP, TAP_PI);
+		str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE);
 
 		do {
 			field.tap = tap;
@@ -889,7 +889,7 @@
 
 	buffer = calloc(CEIL(32, 8), 1);
 
-	str9xpec_set_instr(tap, ISC_IDCODE, TAP_PI);
+	str9xpec_set_instr(tap, ISC_IDCODE, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 32;
@@ -901,7 +901,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
 
 	idcode = buf_get_u32(buffer, 0, 32);
@@ -1014,7 +1014,7 @@
 	str9xpec_set_address(bank, 0x50);
 
 	/* execute ISC_PROGRAM command */
-	str9xpec_set_instr(tap, ISC_PROGRAM, TAP_PI);
+	str9xpec_set_instr(tap, ISC_PROGRAM, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 64;
@@ -1026,12 +1026,12 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 
 	/* small delay before polling */
 	jtag_add_sleep(50);
 
-	str9xpec_set_instr(tap, ISC_NOOP, TAP_PI);
+	str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE);
 
 	do {
 		field.tap = tap;
@@ -1303,13 +1303,13 @@
 	}
 
 	/* enable turbo mode - TURBO-PROG-ENABLE */
-	str9xpec_set_instr(tap2, 0xD, TAP_RTI);
+	str9xpec_set_instr(tap2, 0xD, TAP_IDLE);
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 		return retval;
 
 	/* modify scan chain - str9 core has been removed */
 	tap1->enabled = 0;
-	
+
 	return ERROR_OK;
 }
 
@@ -1337,11 +1337,11 @@
 
 	if (tap == NULL)
 		return ERROR_FAIL;
-	
+
 	/* exit turbo mode via TLR */
-	str9xpec_set_instr(tap, ISC_NOOP, TAP_TLR);
+	str9xpec_set_instr(tap, ISC_NOOP, TAP_RESET);
 	jtag_execute_queue();
-	
+
 	/* restore previous scan chain */
 	if (tap->next_tap) {
 		tap->next_tap->enabled = 1;

Modified: trunk/src/jtag/amt_jtagaccel.c
===================================================================
--- trunk/src/jtag/amt_jtagaccel.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/amt_jtagaccel.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -109,13 +109,13 @@
 	{{0x1f, 0x00}, {0x0c, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x08, 0x00}, {0x00, 0x00}},	/* PI  */
 };
 
-jtag_interface_t amt_jtagaccel_interface = 
+jtag_interface_t amt_jtagaccel_interface =
 {
 	.name = "amt_jtagaccel",
-	
+
 	.execute_queue = amt_jtagaccel_execute_queue,
 
-	.speed = amt_jtagaccel_speed,	
+	.speed = amt_jtagaccel_speed,
 	.register_commands = amt_jtagaccel_register_commands,
 	.init = amt_jtagaccel_init,
 	.quit = amt_jtagaccel_quit,
@@ -127,7 +127,7 @@
 					 COMMAND_CONFIG, NULL);
 	register_command(cmd_ctx, NULL, "rtck", amt_jtagaccel_handle_rtck_command,
 					 COMMAND_CONFIG, NULL);
-	
+
 	return ERROR_OK;
 }
 
@@ -142,7 +142,7 @@
 		aw_control_rst |= 0x1;
 	else if (srst == 0)
 		aw_control_rst &= ~0x1;
-	
+
 	AMT_AW(aw_control_rst);
 }
 
@@ -151,7 +151,7 @@
 	aw_control_baudrate &= 0xf0;
 	aw_control_baudrate |= speed & 0x0f;
 	AMT_AW(aw_control_baudrate);
-	
+
 	return ERROR_OK;
 }
 
@@ -170,11 +170,11 @@
 {
 	int timeout = 4096;
 	u8 ar_status;
-	
+
 	AMT_AR(ar_status);
 	while (((ar_status) & 0x80) && (timeout-- > 0))
 		AMT_AR(ar_status);
-	
+
 	if (ar_status & 0x80)
 	{
 		LOG_ERROR("amt_jtagaccel timed out while waiting for end of scan, rtck was %s, last AR_STATUS: 0x%2.2x", (rtck_enabled) ? "enabled" : "disabled", ar_status);
@@ -186,15 +186,15 @@
 {
 	u8 aw_scan_tms_5;
 	u8 tms_scan[2];
-	 
+
 	tms_scan[0] = amt_jtagaccel_tap_move[tap_move_map[cur_state]][tap_move_map[end_state]][0];
 	tms_scan[1] = amt_jtagaccel_tap_move[tap_move_map[cur_state]][tap_move_map[end_state]][1];
-	
+
 	aw_scan_tms_5 = 0x40 | (tms_scan[0] & 0x1f);
 	AMT_AW(aw_scan_tms_5);
 	if (jtag_speed > 3 || rtck_enabled)
 		amt_wait_scan_busy();
-		
+
 	if (tms_scan[0] & 0x80)
 	{
 		aw_scan_tms_5 = 0x40 | (tms_scan[1] & 0x1f);
@@ -202,7 +202,7 @@
 		if (jtag_speed > 3 || rtck_enabled)
 			amt_wait_scan_busy();
 	}
-	
+
 	cur_state = end_state;
 }
 
@@ -213,27 +213,27 @@
 	u8 aw_scan_tms_1to4;
 
 	enum tap_state saved_end_state = end_state;
-	
+
 	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+	if (cur_state != TAP_IDLE)
 	{
-		amt_jtagaccel_end_state(TAP_RTI);
+		amt_jtagaccel_end_state(TAP_IDLE);
 		amt_jtagaccel_state_move();
 	}
-	
+
 	while (num_cycles - i >= 5)
 	{
 		aw_scan_tms_5 = 0x40;
 		AMT_AW(aw_scan_tms_5);
 		i += 5;
 	}
-	
+
 	if (num_cycles - i > 0)
 	{
 		aw_scan_tms_1to4 = 0x80 | ((num_cycles - i - 1) & 0x3) << 4;
 		AMT_AW(aw_scan_tms_1to4);
 	}
-	
+
 	amt_jtagaccel_end_state(saved_end_state);
 	if (cur_state != end_state)
 		amt_jtagaccel_state_move();
@@ -251,9 +251,9 @@
 	u8 tms_scan[2];
 
 	if (ir_scan)
-		amt_jtagaccel_end_state(TAP_SI);
+		amt_jtagaccel_end_state(TAP_IRSHIFT);
 	else
-		amt_jtagaccel_end_state(TAP_SD);
+		amt_jtagaccel_end_state(TAP_DRSHIFT);
 
 	amt_jtagaccel_state_move();
 	amt_jtagaccel_end_state(saved_end_state);
@@ -263,7 +263,7 @@
 	{
 		aw_tdi_option = 0x30 | (((scan_size - 1) % 8) - 1);
 		AMT_AW(aw_tdi_option);
-		
+
 		dw_tdi_scan = buf_get_u32(buffer, bit_count, (scan_size - 1) % 8) & 0xff;
 		AMT_DW(dw_tdi_scan);
 		if (jtag_speed > 3 || rtck_enabled)
@@ -275,11 +275,11 @@
 			dr_tdo = dr_tdo >> (8 - ((scan_size - 1) % 8));
 			buf_set_u32(buffer, bit_count, (scan_size - 1) % 8, dr_tdo);
 		}
-		
+
 		bit_count += (scan_size - 1) % 8;
 		bits_left -= (scan_size - 1) % 8;
 	}
-	
+
 	while (bits_left - 1 >= 8)
 	{
 		dw_tdi_scan = buf_get_u32(buffer, bit_count, 8) & 0xff;
@@ -292,11 +292,11 @@
 			AMT_DR(dr_tdo);
 			buf_set_u32(buffer, bit_count, 8, dr_tdo);
 		}
-				
+
 		bit_count += 8;
 		bits_left -= 8;
 	}
-		
+
 	tms_scan[0] = amt_jtagaccel_tap_move[tap_move_map[cur_state]][tap_move_map[end_state]][0];
 	tms_scan[1] = amt_jtagaccel_tap_move[tap_move_map[cur_state]][tap_move_map[end_state]][1];
 	aw_tms_scan = 0x40 | (tms_scan[0] & 0x1f) | (buf_get_u32(buffer, bit_count, 1) << 5);
@@ -310,7 +310,7 @@
 		dr_tdo = dr_tdo >> 7;
 		buf_set_u32(buffer, bit_count, 1, dr_tdo);
 	}
-	
+
 	if (tms_scan[0] & 0x80)
 	{
 		aw_tms_scan = 0x40 | (tms_scan[1] & 0x1f);
@@ -328,12 +328,12 @@
 	enum scan_type type;
 	u8 *buffer;
 	int retval;
-	
+
 	/* return ERROR_OK, unless a jtag_read_buffer returns a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
-		
+
 	while (cmd)
 	{
 		switch (cmd->type)
@@ -351,7 +351,7 @@
 #endif
 				if (cmd->cmd.reset->trst == 1)
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				amt_jtagaccel_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
@@ -397,7 +397,7 @@
 		}
 		cmd = cmd->next;
 	}
-	
+
 	return retval;
 }
 
@@ -409,16 +409,16 @@
 
     version.dwOSVersionInfoSize = sizeof version;
     if (!GetVersionEx( &version )) {
-        errno = EINVAL;
-        return -1;
+	errno = EINVAL;
+	return -1;
     }
     if (version.dwPlatformId != VER_PLATFORM_WIN32_NT)
-        return 0;
+	return 0;
 
     h = CreateFile( "\\\\.\\giveio", GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );
     if (h == INVALID_HANDLE_VALUE) {
-        errno = ENODEV;
-        return -1;
+	errno = ENODEV;
+	return -1;
     }
 
     CloseHandle( h );
@@ -437,7 +437,7 @@
 	u8 status_port;
 #endif
 	u8 ar_status;
-	
+
 #if PARPORT_USE_PPDEV == 1
 	if (device_handle > 0)
 	{
@@ -447,7 +447,7 @@
 
 	snprintf(buffer, 256, "/dev/parport%d", amt_jtagaccel_port);
 	device_handle = open(buffer, O_RDWR);
-	
+
 	if (device_handle < 0)
 	{
 		LOG_ERROR("cannot open device. check it exists and that user read and write rights are set");
@@ -468,7 +468,7 @@
 		LOG_ERROR(" cannot set compatible mode to device");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	control_port = 0x00;
 	i = ioctl(device_handle, PPWCONTROL, &control_port);
 
@@ -484,57 +484,57 @@
 
 #if PARPORT_USE_GIVEIO == 1
 	if (amt_jtagaccel_get_giveio_access() != 0) {
-#else /* PARPORT_USE_GIVEIO */	
+#else /* PARPORT_USE_GIVEIO */
 	if (ioperm(amt_jtagaccel_port, 5, 1) != 0) {
 #endif /* PARPORT_USE_GIVEIO */
 		LOG_ERROR("missing privileges for direct i/o");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	/* prepare epp port */
 	/* clear timeout */
 	status_port = inb(amt_jtagaccel_port + 1);
 	outb(status_port | 0x1, amt_jtagaccel_port + 1);
-	
+
 	/* reset epp port */
 	outb(0x00, amt_jtagaccel_port + 2);
 	outb(0x04, amt_jtagaccel_port + 2);
 #endif
-	
+
 	if (rtck_enabled)
-	{	
+	{
 		/* set RTCK enable bit */
 		aw_control_fsm |= 0x02;
 	}
-	
+
 	/* enable JTAG port */
 	aw_control_fsm |= 0x04;
 	AMT_AW(aw_control_fsm);
-	
+
 	amt_jtagaccel_speed(jtag_speed);
-	
+
 	if (jtag_reset_config & RESET_TRST_OPEN_DRAIN)
 		aw_control_rst &= ~0x8;
 	else
 		aw_control_rst |= 0x8;
-	
+
 	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
 		aw_control_rst &= ~0x2;
 	else
 		aw_control_rst |= 0x2;
-	
+
 	amt_jtagaccel_reset(0, 0);
-	
+
 	/* read status register */
 	AMT_AR(ar_status);
 	LOG_DEBUG("AR_STATUS: 0x%2.2x", ar_status);
-	
+
 	return ERROR_OK;
 }
 
 int amt_jtagaccel_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -568,6 +568,6 @@
 			rtck_enabled = 0;
 		}
 	}
-	
+
 	return ERROR_OK;
 }

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/bitbang.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -41,24 +41,24 @@
 
 
 /* DANGER!!!! clock absolutely *MUST* be 0 in idle or reset won't work!
- * 
+ *
  * Set this to 1 and str912 reset halt will fail.
- * 
+ *
  * If someone can submit a patch with an explanation it will be greatly
  * appreciated, but as far as I can tell (?H) DCLK is generated upon
- * clk=0 in TAP_RTI. Good luck deducing that from the ARM documentation!
- * The ARM documentation uses the term "DCLK is asserted while in the TAP_RTI 
+ * clk=0 in TAP_IDLE. Good luck deducing that from the ARM documentation!
+ * The ARM documentation uses the term "DCLK is asserted while in the TAP_IDLE
  * state". With hardware there is no such thing as *while* in a state. There
  * are only edges. So clk => 0 is in fact a very subtle state transition that
- * happens *while* in the TAP_RTI state. "#&?"#?&"#&"#&
- * 
+ * happens *while* in the TAP_IDLE state. "#&?"#?&"#&"#&
+ *
  * For "reset halt" the last thing that happens before srst is asserted
  * is that the breakpoint is set up. If DCLK is not wiggled one last
  * time before the reset, then the breakpoint is not set up and
  * "reset halt" will fail to halt.
- * 
+ *
  */
-#define CLOCK_IDLE() 0 
+#define CLOCK_IDLE() 0
 
 int bitbang_execute_queue(void);
 
@@ -76,10 +76,10 @@
 }
 
 void bitbang_state_move(void) {
-	
+
 	int i=0, tms=0;
 	u8 tms_scan = TAP_MOVE(cur_state, end_state);
-	
+
 	for (i = 0; i < 7; i++)
 	{
 		tms = (tms_scan >> i) & 1;
@@ -87,7 +87,7 @@
 		bitbang_interface->write(1, tms, 0);
 	}
 	bitbang_interface->write(CLOCK_IDLE(), tms, 0);
-	
+
 	cur_state = end_state;
 }
 
@@ -113,7 +113,7 @@
 			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[cmd->path[state_count]]);
 			exit(-1);
 		}
-		
+
 		bitbang_interface->write(0, tms, 0);
 		bitbang_interface->write(1, tms, 0);
 
@@ -121,7 +121,7 @@
 		state_count++;
 		num_states--;
 	}
-	
+
 	bitbang_interface->write(CLOCK_IDLE(), tms, 0);
 
 	end_state = cur_state;
@@ -130,16 +130,16 @@
 void bitbang_runtest(int num_cycles)
 {
 	int i;
-	
+
 	enum tap_state saved_end_state = end_state;
-	
+
 	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+	if (cur_state != TAP_IDLE)
 	{
-		bitbang_end_state(TAP_RTI);
+		bitbang_end_state(TAP_IDLE);
 		bitbang_state_move();
 	}
-	
+
 	/* execute num_cycles */
 	for (i = 0; i < num_cycles; i++)
 	{
@@ -147,7 +147,7 @@
 		bitbang_interface->write(1, 0, 0);
 	}
 	bitbang_interface->write(CLOCK_IDLE(), 0, 0);
-	
+
 	/* finish in end_state */
 	bitbang_end_state(saved_end_state);
 	if (cur_state != end_state)
@@ -158,13 +158,13 @@
 {
 	enum tap_state saved_end_state = end_state;
 	int bit_cnt;
-	
-	if (!((!ir_scan && (cur_state == TAP_SD)) || (ir_scan && (cur_state == TAP_SI))))
+
+	if (!((!ir_scan && (cur_state == TAP_DRSHIFT)) || (ir_scan && (cur_state == TAP_IRSHIFT))))
 	{
 		if (ir_scan)
-			bitbang_end_state(TAP_SI);
+			bitbang_end_state(TAP_IRSHIFT);
 		else
-			bitbang_end_state(TAP_SD);
+			bitbang_end_state(TAP_DRSHIFT);
 
 		bitbang_state_move();
 		bitbang_end_state(saved_end_state);
@@ -181,7 +181,7 @@
 		/* if we're just reading the scan, but don't care about the output
 		 * default to outputting 'low', this also makes valgrind traces more readable,
 		 * as it removes the dependency on an uninitialised value
-		 */ 
+		 */
 		tdi=0;
 		if ((type != SCAN_IN) && (buffer[bytec] & bcval))
 			tdi=1;
@@ -192,7 +192,7 @@
 			val=bitbang_interface->read();
 
 		bitbang_interface->write(1, tms, tdi);
-		
+
 		if (type != SCAN_OUT)
 		{
 			if (val)
@@ -201,21 +201,21 @@
 				buffer[bytec] &= ~bcval;
 		}
 	}
-	
-	/* TAP_SD & TAP_SI are illegal end states, so we always transition to the pause
+
+	/* TAP_DRSHIFT & TAP_IRSHIFT are illegal end states, so we always transition to the pause
 	 * state which is a legal stable state from which statemove will work.
-	 *  
-	 * Exit1 -> Pause 
+	 *
+	 * Exit1 -> Pause
 	 */
 	bitbang_interface->write(0, 0, 0);
 	bitbang_interface->write(1, 0, 0);
 	bitbang_interface->write(CLOCK_IDLE(), 0, 0);
-	
+
 	if (ir_scan)
-		cur_state = TAP_PI;
+		cur_state = TAP_IRPAUSE;
 	else
-		cur_state = TAP_PD;
-	
+		cur_state = TAP_DRPAUSE;
+
 	if (cur_state != end_state)
 		bitbang_state_move();
 }
@@ -227,18 +227,18 @@
 	enum scan_type type;
 	u8 *buffer;
 	int retval;
-	
+
 	if (!bitbang_interface)
 	{
 		LOG_ERROR("BUG: Bitbang interface called, but not yet initialized");
 		exit(-1);
 	}
-	
+
 	/* return ERROR_OK, unless a jtag_read_buffer returns a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
-		
+
 	if(bitbang_interface->blink)
 		bitbang_interface->blink(1);
 
@@ -259,7 +259,7 @@
 #endif
 				if ((cmd->cmd.reset->trst == 1) || (cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST)))
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				bitbang_interface->reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
@@ -313,7 +313,7 @@
 	}
 	if(bitbang_interface->blink)
 		bitbang_interface->blink(0);
-	
+
 	return retval;
 }
 

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/bitq.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -195,7 +195,7 @@
 	int i;
 
 	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI) bitq_state_move(TAP_RTI);
+	if (cur_state != TAP_IDLE) bitq_state_move(TAP_IDLE);
 
 	/* execute num_cycles */
 	for (i = 0; i < num_cycles; i++)
@@ -240,8 +240,8 @@
 
 	if (pause) {
 		bitq_io(0,0,0);
-		if (cur_state==TAP_SI) cur_state=TAP_PI;
-		else if (cur_state==TAP_SD) cur_state=TAP_PD;
+		if (cur_state==TAP_IRSHIFT) cur_state=TAP_IRPAUSE;
+		else if (cur_state==TAP_DRSHIFT) cur_state=TAP_DRPAUSE;
 	}
 }
 
@@ -250,8 +250,8 @@
 {
 	int i;
 
-	if (cmd->ir_scan) bitq_state_move(TAP_SI);
-	else bitq_state_move(TAP_SD);
+	if (cmd->ir_scan) bitq_state_move(TAP_IRSHIFT);
+	else bitq_state_move(TAP_DRSHIFT);
 
 	for (i=0; i < cmd->num_fields-1; i++)
 		bitq_scan_field(&cmd->fields[i], 0);
@@ -285,7 +285,7 @@
 #endif
 				if ((cmd->cmd.reset->trst == 1) || (cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST)))
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				bitq_interface->reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				if (bitq_interface->in_rdy()) bitq_in_proc();

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/ft2232.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -157,13 +157,13 @@
 #define BUFFER_ADD ft2232_buffer[ft2232_buffer_size++]
 #define BUFFER_READ ft2232_buffer[ft2232_read_pointer++]
 
-jtag_interface_t ft2232_interface = 
+jtag_interface_t ft2232_interface =
 {
 	.name = "ft2232",
 	.execute_queue = ft2232_execute_queue,
 	.speed = ft2232_speed,
 	.speed_div = ft2232_speed_div,
-	.khz = ft2232_khz, 
+	.khz = ft2232_khz,
 	.register_commands = ft2232_register_commands,
 	.init = ft2232_init,
 	.quit = ft2232_quit,
@@ -183,7 +183,7 @@
 	else
 	{
 		*bytes_written = dw_bytes_written;
-		return ERROR_OK;	
+		return ERROR_OK;
 	}
 #elif BUILD_FT2232_LIBFTDI == 1
 	int retval;
@@ -196,7 +196,7 @@
 	else
 	{
 		*bytes_written = retval;
-		return ERROR_OK;	
+		return ERROR_OK;
 	}
 #endif
 }
@@ -211,20 +211,20 @@
 
 	while ((*bytes_read < size) && timeout--)
 	{
-		if ((status = FT_Read(ftdih, buf + *bytes_read, size - 
-			*bytes_read, &dw_bytes_read)) != FT_OK)		
+		if ((status = FT_Read(ftdih, buf + *bytes_read, size -
+			*bytes_read, &dw_bytes_read)) != FT_OK)
 		{
-			*bytes_read = 0; 
+			*bytes_read = 0;
 			LOG_ERROR("FT_Read returned: %lu", status);
 			return ERROR_JTAG_DEVICE_ERROR;
 		}
-		*bytes_read += dw_bytes_read; 
+		*bytes_read += dw_bytes_read;
 	}
 #elif BUILD_FT2232_LIBFTDI == 1
 	int retval;
 	int timeout = 100;
 	*bytes_read = 0;
-	
+
 	while ((*bytes_read < size) && timeout--)
 	{
 		if ((retval = ftdi_read_data(&ftdic, buf + *bytes_read, size - *bytes_read)) < 0)
@@ -242,7 +242,7 @@
 		LOG_ERROR("couldn't read the requested number of bytes from FT2232 device (%i < %i)", *bytes_read, size);
 		return ERROR_JTAG_DEVICE_ERROR;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -255,7 +255,7 @@
 	buf[0] = 0x86; /* command "set divisor" */
 	buf[1] = speed & 0xff; /* valueL (0=6MHz, 1=3MHz, 2=2.0MHz, ...*/
 	buf[2] = (speed >> 8) & 0xff; /* valueH */
-	
+
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
 	if (((retval = ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
@@ -268,12 +268,12 @@
 
 int ft2232_speed_div(int speed, int *khz)
 {
-	/* Take a look in the FT2232 manual, 
+	/* Take a look in the FT2232 manual,
 	 * AN2232C-01 Command Processor for
 	 * MPSSE and MCU Host Bus. Chapter 3.8 */
-	
+
 	*khz = 6000 / (1+speed);
-	
+
 	return ERROR_OK;
 }
 
@@ -284,35 +284,35 @@
 		LOG_ERROR("RCLK not supported");
 		return ERROR_FAIL;
 	}
-	/* Take a look in the FT2232 manual, 
+	/* Take a look in the FT2232 manual,
 	 * AN2232C-01 Command Processor for
 	 * MPSSE and MCU Host Bus. Chapter 3.8
-	 * 
+	 *
 	 * We will calc here with a multiplier
 	 * of 10 for better rounding later. */
-	
+
 	/* Calc speed, (6000 / khz) - 1 */
 	/* Use 65000 for better rounding */
 	*jtag_speed = (60000 / khz) - 10;
-	
+
 	/* Add 0.9 for rounding */
 	*jtag_speed += 9;
-	
+
 	/* Calc real speed */
 	*jtag_speed = *jtag_speed / 10;
-	
+
 	/* Check if speed is greater than 0 */
 	if (*jtag_speed < 0)
 	{
 		*jtag_speed = 0;
 	}
-	
+
 	/* Check max value */
 	if (*jtag_speed > 0xFFFF)
 	{
 		*jtag_speed = 0xFFFF;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -371,7 +371,7 @@
 	int i;
 	char line[256];
 	char *line_p = line;
-	
+
 	for (i = 0; i < ft2232_buffer_size; i++)
 	{
 		line_p += snprintf(line_p, 256 - (line_p - line), "%2.2x ", ft2232_buffer[i]);
@@ -381,7 +381,7 @@
 			line_p = line;
 		}
 	}
-	
+
 	if (line_p != line)
 		LOG_DEBUG("%s", line);
 }
@@ -395,7 +395,7 @@
 	int retval;
 	u32 bytes_written;
 	u32 bytes_read;
-	
+
 #ifdef _DEBUG_USB_IO_
 	struct timeval start, inter, inter2, end;
 	struct timeval d_inter, d_inter2, d_end;
@@ -407,7 +407,7 @@
 #endif
 
 #ifdef _DEBUG_USB_IO_
-	gettimeofday(&start, NULL);	
+	gettimeofday(&start, NULL);
 #endif
 
 	if ((retval = ft2232_write(ft2232_buffer, ft2232_buffer_size, &bytes_written)) != ERROR_OK)
@@ -415,28 +415,28 @@
 		LOG_ERROR("couldn't write MPSSE commands to FT2232");
 		return retval;
 	}
-	
+
 #ifdef _DEBUG_USB_IO_
-	gettimeofday(&inter, NULL);	
+	gettimeofday(&inter, NULL);
 #endif
-	
+
 	if (ft2232_expect_read)
 	{
 		int timeout = 100;
 		ft2232_buffer_size = 0;
-		
+
 #ifdef _DEBUG_USB_IO_
-		gettimeofday(&inter2, NULL);	
+		gettimeofday(&inter2, NULL);
 #endif
-		
+
 		if ((retval = ft2232_read(ft2232_buffer, ft2232_expect_read, &bytes_read)) != ERROR_OK)
 		{
 			LOG_ERROR("couldn't read from FT2232");
 			return retval;
 		}
-		
+
 #ifdef _DEBUG_USB_IO_
-		gettimeofday(&end, NULL);	
+		gettimeofday(&end, NULL);
 
 		timeval_subtract(&d_inter, &inter, &start);
 		timeval_subtract(&d_inter2, &inter2, &start);
@@ -444,14 +444,14 @@
 
 		LOG_INFO("inter: %i.%i, inter2: %i.%i end: %i.%i", d_inter.tv_sec, d_inter.tv_usec, d_inter2.tv_sec, d_inter2.tv_usec, d_end.tv_sec, d_end.tv_usec);
 #endif
-	
-		
+
+
 		ft2232_buffer_size = bytes_read;
-		
+
 		if (ft2232_expect_read != ft2232_buffer_size)
 		{
 			LOG_ERROR("ft2232_expect_read (%i) != ft2232_buffer_size (%i) (%i retries)", ft2232_expect_read, ft2232_buffer_size, 100 - timeout);
-			ft2232_debug_dump_buffer();	
+			ft2232_debug_dump_buffer();
 
 			exit(-1);
 		}
@@ -464,12 +464,12 @@
 
 	ft2232_expect_read = 0;
 	ft2232_read_pointer = 0;
-	
+
 	/* return ERROR_OK, unless a jtag_read_buffer returns a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
-	
+
 	cmd = first;
 	while (cmd != last)
 	{
@@ -492,7 +492,7 @@
 		}
 		cmd = cmd->next;
 	}
-	
+
 	ft2232_buffer_size = 0;
 
 	return retval;
@@ -508,7 +508,7 @@
 	while (num_states)
 	{
 		int bit_count = 0;
-		
+
 		int num_states_batch = num_states > 7 ? 7 : num_states;
 
 		tms_byte = 0x0;
@@ -516,7 +516,7 @@
 		BUFFER_ADD = 0x4b;
 		/* number of states remaining */
 		BUFFER_ADD = num_states_batch - 1;
-		
+
 		while (num_states_batch--)
 		{
 			if (tap_transitions[cur_state].low == cmd->path[state_count])
@@ -533,10 +533,10 @@
 			state_count++;
 			num_states--;
 		}
-		
+
 		BUFFER_ADD = tms_byte;
 	}
-	
+
 	end_state = cur_state;
 }
 
@@ -547,7 +547,7 @@
 	int cur_byte = 0;
 	int last_bit;
 
-	if (!((!ir_scan && (cur_state == TAP_SD)) || (ir_scan && (cur_state == TAP_SI))))
+	if (!((!ir_scan && (cur_state == TAP_DRSHIFT)) || (ir_scan && (cur_state == TAP_IRSHIFT))))
 	{
 		/* command "Clock Data to TMS/CS Pin (no Read)" */
 		BUFFER_ADD = 0x4b;
@@ -556,17 +556,17 @@
 		/* TMS data bits */
 		if (ir_scan)
 		{
-			BUFFER_ADD = TAP_MOVE(cur_state, TAP_SI);
-			cur_state = TAP_SI;
+			BUFFER_ADD = TAP_MOVE(cur_state, TAP_IRSHIFT);
+			cur_state = TAP_IRSHIFT;
 		}
 		else
 		{
-			BUFFER_ADD = TAP_MOVE(cur_state, TAP_SD);
-			cur_state = TAP_SD;
+			BUFFER_ADD = TAP_MOVE(cur_state, TAP_DRSHIFT);
+			cur_state = TAP_DRSHIFT;
 		}
 		/* LOG_DEBUG("added TMS scan (no read)"); */
 	}
-	
+
 	/* add command for complete bytes */
 	while (num_bytes > 1)
 	{
@@ -608,7 +608,7 @@
 			bits_left -= 8 * (thisrun_bytes);
 		}
 	}
-	
+
 	/* the most signifcant bit is scanned during TAP movement */
 	if (type != SCAN_IN)
 		last_bit = (buffer[cur_byte] >> (bits_left - 1)) & 0x1;
@@ -641,8 +641,8 @@
 			BUFFER_ADD = buffer[cur_byte];
 	}
 
-	if ((ir_scan && (end_state == TAP_SI)) ||
-		(!ir_scan && (end_state == TAP_SD)))
+	if ((ir_scan && (end_state == TAP_IRSHIFT)) ||
+		(!ir_scan && (end_state == TAP_DRSHIFT)))
 	{
 		if (type == SCAN_IO)
 		{
@@ -698,24 +698,24 @@
 	u32 bytes_read;
 	int retval;
 	int thisrun_read = 0;
-	
+
 	if (cmd->ir_scan)
 	{
 		LOG_ERROR("BUG: large IR scans are not supported");
 		exit(-1);
 	}
 
-	if (cur_state != TAP_SD)
+	if (cur_state != TAP_DRSHIFT)
 	{
 		/* command "Clock Data to TMS/CS Pin (no Read)" */
 		BUFFER_ADD = 0x4b;
 		/* scan 7 bit */
 		BUFFER_ADD = 0x6;
 		/* TMS data bits */
-		BUFFER_ADD = TAP_MOVE(cur_state, TAP_SD);
-		cur_state = TAP_SD;
+		BUFFER_ADD = TAP_MOVE(cur_state, TAP_DRSHIFT);
+		cur_state = TAP_DRSHIFT;
 	}
-	
+
 	if ((retval = ft2232_write(ft2232_buffer, ft2232_buffer_size, &bytes_written)) != ERROR_OK)
 	{
 		LOG_ERROR("couldn't write MPSSE commands to FT2232");
@@ -723,12 +723,12 @@
 	}
 	LOG_DEBUG("ft2232_buffer_size: %i, bytes_written: %i", ft2232_buffer_size, bytes_written);
 	ft2232_buffer_size = 0;
-	
+
 	/* add command for complete bytes */
 	while (num_bytes > 1)
 	{
 		int thisrun_bytes;
-		
+
 		if (type == SCAN_IO)
 		{
 			/* Clock Data Bytes In and Out LSB First */
@@ -774,7 +774,7 @@
 		}
 		LOG_DEBUG("ft2232_buffer_size: %i, bytes_written: %i", ft2232_buffer_size, bytes_written);
 		ft2232_buffer_size = 0;
-		
+
 		if (type != SCAN_OUT)
 		{
 			if ((retval = ft2232_read(receive_pointer, thisrun_read, &bytes_read)) != ERROR_OK)
@@ -786,9 +786,9 @@
 			receive_pointer += bytes_read;
 		}
 	}
-	
+
 	thisrun_read = 0;
-	
+
 	/* the most signifcant bit is scanned during TAP movement */
 	if (type != SCAN_IN)
 		last_bit = (buffer[cur_byte] >> (bits_left - 1)) & 0x1;
@@ -819,12 +819,12 @@
 		BUFFER_ADD = bits_left - 2;
 		if (type != SCAN_IN)
 			BUFFER_ADD = buffer[cur_byte];
-			
+
 		if (type != SCAN_OUT)
 			thisrun_read += 2;
 	}
 
-	if (end_state == TAP_SD)
+	if (end_state == TAP_DRSHIFT)
 	{
 		if (type == SCAN_IO)
 		{
@@ -866,10 +866,10 @@
 		BUFFER_ADD = TAP_MOVE(cur_state, end_state) | (last_bit << 7);
 		cur_state = end_state;
 	}
-	
+
 	if (type != SCAN_OUT)
 		thisrun_read += 1;
-	
+
 	if ((retval = ft2232_write(ft2232_buffer, ft2232_buffer_size, &bytes_written)) != ERROR_OK)
 	{
 		LOG_ERROR("couldn't write MPSSE commands to FT2232");
@@ -877,7 +877,7 @@
 	}
 	LOG_DEBUG("ft2232_buffer_size: %i, bytes_written: %i", ft2232_buffer_size, bytes_written);
 	ft2232_buffer_size = 0;
-	
+
 	if (type != SCAN_OUT)
 	{
 		if ((retval = ft2232_read(receive_pointer, thisrun_read, &bytes_read)) != ERROR_OK)
@@ -888,7 +888,7 @@
 		LOG_DEBUG("thisrun_read: %i, bytes_read: %i", thisrun_read, bytes_read);
 		receive_pointer += bytes_read;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -896,10 +896,10 @@
 {
 	int predicted_size = 3;
 	int num_bytes = (scan_size - 1) / 8;
-	
-	if (cur_state != TAP_SD)
+
+	if (cur_state != TAP_DRSHIFT)
 		predicted_size += 3;
-	
+
 	if (type == SCAN_IN)	/* only from device to host */
 	{
 		/* complete bytes */
@@ -921,7 +921,7 @@
 int ft2232_predict_scan_in(int scan_size, enum scan_type type)
 {
 	int predicted_size = 0;
-	
+
 	if (type != SCAN_OUT)
 	{
 		/* complete bytes */
@@ -931,7 +931,7 @@
 		/* last bit (from TMS scan) */
 		predicted_size += 1;
 	}
-	
+
 	/* LOG_DEBUG("scan_size: %i, predicted_size: %i", scan_size, predicted_size); */
 
 	return predicted_size;
@@ -968,7 +968,7 @@
 		else
 			low_direction &= ~nSRSTnOE;	/* switch to input pin (high-Z) */
 	}
-	
+
 	/* command "set data bits low byte" */
 	BUFFER_ADD = 0x80;
 	BUFFER_ADD = low_output;
@@ -1007,7 +1007,7 @@
 		else
 			high_output |= nSRSTnOE;
 	}
-	
+
 	/* command "set data bits high byte" */
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
@@ -1052,7 +1052,7 @@
 {
 	if (trst == 1)
 	{
-		cur_state = TAP_TLR;
+		cur_state = TAP_RESET;
 		high_output &= ~nTRST;
 	}
 	else if (trst == 0)
@@ -1106,7 +1106,7 @@
 void turtle_reset(int trst, int srst)
 {
 	trst = trst;
-	
+
 	if (srst == 1)
 	{
 		low_output |= nSRST;
@@ -1115,7 +1115,7 @@
 	{
 		low_output &= ~nSRST;
 	}
-	
+
 	/* command "set data bits low byte" */
 	BUFFER_ADD = 0x80;
 	BUFFER_ADD = low_output;
@@ -1142,7 +1142,7 @@
 	{
 		high_output |= nSRST;
 	}
-	
+
 	/* command "set data bits high byte" */
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
@@ -1169,12 +1169,12 @@
 	{
 		low_output |= nSRST;
 	}
-	
+
 	/* command "set data bits low byte" */
 	BUFFER_ADD = 0x80;
 	BUFFER_ADD = low_output;
 	BUFFER_ADD = low_direction;
-	
+
 	/* command "set data bits high byte" */
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
@@ -1193,15 +1193,15 @@
 	int predicted_size = 0;
 	int require_send = 0;
 	int retval;
-	
+
 	/* return ERROR_OK, unless ft2232_send_and_recv reports a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
 
 	ft2232_buffer_size = 0;
 	ft2232_expect_read = 0;
-	
+
 	/* blink, if the current layout has that feature */
 	if (layout->blink)
 		layout->blink();
@@ -1227,24 +1227,24 @@
 
 				if ((cmd->cmd.reset->trst == 1) || (cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST)))
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				layout->reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				require_send = 1;
-				
-#ifdef _DEBUG_JTAG_IO_				
+
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("trst: %i, srst: %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 #endif
 				break;
 			case JTAG_RUNTEST:
 				/* only send the maximum buffer size that FT2232C can handle */
 				predicted_size = 0;
-				if (cur_state != TAP_RTI)
+				if (cur_state != TAP_IDLE)
 					predicted_size += 3;
 				predicted_size += 3 * CEIL(cmd->cmd.runtest->num_cycles, 7);
-				if ((cmd->cmd.runtest->end_state != -1) && (cmd->cmd.runtest->end_state != TAP_RTI))
+				if ((cmd->cmd.runtest->end_state != -1) && (cmd->cmd.runtest->end_state != TAP_IDLE))
 					predicted_size += 3;
-				if ((cmd->cmd.runtest->end_state == -1) && (end_state != TAP_RTI))
+				if ((cmd->cmd.runtest->end_state == -1) && (end_state != TAP_IDLE))
 					predicted_size += 3;
 				if (ft2232_buffer_size + predicted_size + 1 > FT2232_BUFFER_SIZE)
 				{
@@ -1253,15 +1253,15 @@
 					require_send = 0;
 					first_unsent = cmd;
 				}
-				if (cur_state != TAP_RTI)
+				if (cur_state != TAP_IDLE)
 				{
 					/* command "Clock Data to TMS/CS Pin (no Read)" */
 					BUFFER_ADD = 0x4b;
 					/* scan 7 bit */
 					BUFFER_ADD = 0x6;
 					/* TMS data bits */
-					BUFFER_ADD = TAP_MOVE(cur_state, TAP_RTI);
-					cur_state = TAP_RTI;
+					BUFFER_ADD = TAP_MOVE(cur_state, TAP_IDLE);
+					cur_state = TAP_IDLE;
 					require_send = 1;
 				}
 				i = cmd->cmd.runtest->num_cycles;
@@ -1273,7 +1273,7 @@
 					BUFFER_ADD = (i > 7) ? 6 : (i - 1);
 					/* TMS data bits */
 					BUFFER_ADD = 0x0;
-					cur_state = TAP_RTI;
+					cur_state = TAP_IDLE;
 					i -= (i > 7) ? 7 : i;
 					/* LOG_DEBUG("added TMS scan (no read)"); */
 				}
@@ -1291,7 +1291,7 @@
 					/* LOG_DEBUG("added TMS scan (no read)"); */
 				}
 				require_send = 1;
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("runtest: %i, end in %i", cmd->cmd.runtest->num_cycles, end_state);
 #endif
 				break;
@@ -1316,7 +1316,7 @@
 				/* LOG_DEBUG("added TMS scan (no read)"); */
 				cur_state = end_state;
 				require_send = 1;
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("statemove: %i", end_state);
 #endif
 				break;
@@ -1332,7 +1332,7 @@
 				}
 				ft2232_add_pathmove(cmd->cmd.pathmove);
 				require_send = 1;
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("pathmove: %i states, end in %i", cmd->cmd.pathmove->num_states, cmd->cmd.pathmove->path[cmd->cmd.pathmove->num_states - 1]);
 #endif
 				break;
@@ -1347,7 +1347,7 @@
 					if (first_unsent != cmd)
 						if (ft2232_send_and_recv(first_unsent, cmd) != ERROR_OK)
 							retval = ERROR_JTAG_QUEUE_FAILED;
-					
+
 					/* current command */
 					if (cmd->cmd.scan->end_state != -1)
 						ft2232_end_state(cmd->cmd.scan->end_state);
@@ -1374,7 +1374,7 @@
 				require_send = 1;
 				if (buffer)
 					free(buffer);
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("%s scan, %i bit, end in %i", (cmd->cmd.scan->ir_scan) ? "IR" : "DR", scan_size, end_state);
 #endif
 				break;
@@ -1383,7 +1383,7 @@
 					retval = ERROR_JTAG_QUEUE_FAILED;
 				first_unsent = cmd->next;
 				jtag_sleep(cmd->cmd.sleep->us);
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("sleep %i usec", cmd->cmd.sleep->us);
 #endif
 				break;
@@ -1424,7 +1424,7 @@
 		LOG_WARNING("can't open by device description and serial number, giving precedence to serial");
 		ft2232_device_desc = NULL;
 	}
-	
+
 	if (ft2232_device_desc)
 	{
 		openex_string = ft2232_device_desc;
@@ -1439,14 +1439,14 @@
 	{
 		LOG_ERROR("neither device description nor serial number specified");
 		LOG_ERROR("please add \"ft2232_device_desc <string>\" or \"ft2232_serial <string>\" to your .cfg file");
-		
-		return ERROR_JTAG_INIT_FAILED;	
+
+		return ERROR_JTAG_INIT_FAILED;
 	}
 
 	if ((status = FT_OpenEx(openex_string, openex_flags, &ftdih)) != FT_OK)
 	{
 		DWORD num_devices;
-		
+
 		if (more) {
 			LOG_WARNING("unable to open ftdi device (trying more): %lu", status);
 			*try_more = 1;
@@ -1471,7 +1471,7 @@
 				for (i = 0; i < num_devices; i++)
 					LOG_ERROR("%i: %s", i, desc_array[i]);
 			}
-			
+
 			for (i = 0; i < num_devices; i++)
 				free(desc_array[i]);
 			free(desc_array);
@@ -1488,7 +1488,7 @@
 		LOG_ERROR("unable to set latency timer: %lu", status);
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	if ((status = FT_GetLatencyTimer(ftdih, &latency_timer)) != FT_OK)
 	{
 		LOG_ERROR("unable to get latency timer: %lu", status);
@@ -1498,7 +1498,7 @@
 	{
 		LOG_DEBUG("current latency timer: %i", latency_timer);
 	}
-	
+
 	if ((status = FT_SetTimeouts(ftdih, 5000, 5000)) != FT_OK)
 	{
 		LOG_ERROR("unable to set timeouts: %lu", status);
@@ -1568,7 +1568,7 @@
 		LOG_ERROR("unable to set latency timer");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	if (ftdi_get_latency_timer(&ftdic, &latency_timer) < 0)
 	{
 		LOG_ERROR("unable to get latency timer");
@@ -1603,13 +1603,13 @@
 	u32 bytes_written;
 	ft2232_layout_t *cur_layout = ft2232_layouts;
 	int i;
-	
+
 	if ((ft2232_layout == NULL) || (ft2232_layout[0] == 0))
 	{
 		ft2232_layout = "usbjtag";
 		LOG_WARNING("No ft2232 layout specified, using default 'usbjtag'");
 	}
-	
+
 	while (cur_layout->name)
 	{
 		if (strcmp(cur_layout->name, ft2232_layout) == 0)
@@ -1625,7 +1625,7 @@
 		LOG_ERROR("No matching layout found for %s", ft2232_layout);
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	for (i = 0; 1; i++) {
 		/*
 		 * "more indicates that there are more IDs to try, so we should
@@ -1645,7 +1645,7 @@
 #elif BUILD_FT2232_LIBFTDI == 1
 		retval = ft2232_init_libftdi(ft2232_vid[i], ft2232_pid[i],
 			more, &try_more);
-#endif	
+#endif
 		if (retval >= 0)
 			break;
 		if (!more || !try_more)
@@ -1671,7 +1671,7 @@
 	return ft2232_purge_ftd2xx();
 #elif BUILD_FT2232_LIBFTDI == 1
 	return ft2232_purge_libftdi();
-#endif	
+#endif
 
 	return ERROR_OK;
 }
@@ -1680,10 +1680,10 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x0b;
-	
+
 	if (strcmp(ft2232_layout, "usbjtag") == 0)
 	{
 		nTRST = 0x10;
@@ -1710,9 +1710,9 @@
 	else
 	{
 		LOG_ERROR("BUG: usbjtag_init called for unknown layout '%s'", ft2232_layout);
-		return ERROR_JTAG_INIT_FAILED;	
+		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	if (jtag_reset_config & RESET_TRST_OPEN_DRAIN)
 	{
 		low_direction &= ~nTRSTnOE; /* nTRST input */
@@ -1723,7 +1723,7 @@
 		low_direction |= nTRSTnOE; /* nTRST output */
 		low_output |= nTRST; /* nTRST = 1 */
 	}
-	
+
 	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
 	{
 		low_direction |= nSRSTnOE; /* nSRST output */
@@ -1734,16 +1734,16 @@
 		low_direction &= ~nSRSTnOE; /* nSRST input */
 		low_output &= ~nSRST; /* nSRST = 0 */
 	}
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, xRST high) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'USBJTAG' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'USBJTAG' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
 
@@ -1754,19 +1754,19 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x2b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
 
@@ -1775,14 +1775,14 @@
 		nTRST = 0x08;
 		nTRSTnOE = 0x0;  /* No output enable for TRST*/
 		nSRST = 0x04;
-		nSRSTnOE = 0x0;  /* No output enable for SRST*/ 
+		nSRSTnOE = 0x0;  /* No output enable for SRST*/
 	}
 	else
 	{
 		LOG_ERROR("BUG: axm0432_jtag_init called for non axm0432 layout");
 		exit(-1);
 	}
-	
+
 	high_output = 0x0;
 	high_direction = 0x0c;
 
@@ -1803,19 +1803,19 @@
 	{
 		high_output |= nSRST;
 	}
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output; /* value */
 	buf[2] = high_direction;   /* all outputs (xRST and xRSTnOE) */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'Dicarlo' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'Dicarlo' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1823,22 +1823,22 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x1b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	if (strcmp(layout->name, "jtagkey") == 0)
 	{
 		nTRST = 0x01;
@@ -1859,7 +1859,7 @@
 		LOG_ERROR("BUG: jtagkey_init called for non jtagkey layout");
 		exit(-1);
 	}
-	
+
 	high_output = 0x0;
 	high_direction = 0x0f;
 
@@ -1873,7 +1873,7 @@
 		high_output &= ~nTRSTnOE;
 		high_output |= nTRST;
 	}
-	
+
 	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
 	{
 		high_output &= ~nSRSTnOE;
@@ -1884,19 +1884,19 @@
 		high_output |= nSRSTnOE;
 		high_output &= ~nSRST;
 	}
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output; /* value */
 	buf[2] = high_direction;   /* all outputs (xRST and xRSTnOE) */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1904,22 +1904,22 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x1b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	nTRST = 0x01;
 	nTRSTnOE = 0x4;
 	nSRST = 0x02;
@@ -1938,7 +1938,7 @@
 		high_output &= ~nTRSTnOE;
 		high_output |= nTRST;
 	}
-	
+
 	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
 	{
 		LOG_ERROR("can't set nSRST to push-pull on the Olimex ARM-USB-OCD");
@@ -1947,22 +1947,22 @@
 	{
 		high_output &= ~nSRST;
 	}
-	
+
 	/* turn red LED on */
 	high_output |= 0x08;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output; /* value */
 	buf[2] = high_direction;   /* all outputs (xRST and xRSTnOE) */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1970,22 +1970,22 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x18;
 	low_direction = 0xfb;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE[12]=out, n[ST]srst=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'flyswatter' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'flyswatter' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	nTRST = 0x10;
 	nTRSTnOE = 0x0; /* not output enable for nTRST */
 	nSRST = 0x20;
@@ -1996,19 +1996,19 @@
 
 	/* turn red LED1 on, LED2 off */
 	high_output |= 0x08;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output; /* value */
 	buf[2] = high_direction;   /* all outputs (xRST and xRSTnOE) */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'flyswatter' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'flyswatter' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2016,39 +2016,39 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x5b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'turtelizer2' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'turtelizer2' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	nSRST = 0x40;
-	
+
 	high_output = 0x00;
 	high_direction = 0x0C;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output;
 	buf[2] = high_direction;
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'turtelizer2' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'turtelizer2' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2056,42 +2056,42 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x0b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'comstick' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'comstick' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	nTRST = 0x01;
 	nTRSTnOE = 0x00; /* no output enable for nTRST */
 	nSRST = 0x02;
 	nSRSTnOE = 0x00; /* no output enable for nSRST */
-	
+
 	high_output = 0x03;
 	high_direction = 0x03;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output;
 	buf[2] = high_direction;
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'comstick' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'comstick' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2099,42 +2099,42 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x88;
 	low_direction = 0x8b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'stm32stick' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'stm32stick' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-		
+
 	nTRST = 0x01;
 	nTRSTnOE = 0x00; /* no output enable for nTRST */
 	nSRST = 0x80;
 	nSRSTnOE = 0x00; /* no output enable for nSRST */
-	
+
 	high_output = 0x01;
 	high_direction = 0x03;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output;
 	buf[2] = high_direction;
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'stm32stick' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'stm32stick' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2153,7 +2153,7 @@
 		/* set port pin low */
 		high_output |= 0x08;
 	}
-	
+
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
 	BUFFER_ADD = high_direction;
@@ -2161,7 +2161,7 @@
 
 void turtle_jtag_blink(void)
 {
-	/* 
+	/*
    * Turtelizer2 has two LEDs connected to ACBUS2 and ACBUS3
 	 */
 	if (high_output & 0x08)
@@ -2172,7 +2172,7 @@
 	{
 		high_output = 0x08;
 	}
-	
+
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
 	BUFFER_ADD = high_direction;
@@ -2186,9 +2186,9 @@
 	status = FT_Close(ftdih);
 #elif BUILD_FT2232_LIBFTDI == 1
 	ftdi_disable_bitbang(&ftdic);
-	
+
 	ftdi_usb_close(&ftdic);
-	
+
 	ftdi_deinit(&ftdic);
 #endif
 
@@ -2208,7 +2208,7 @@
 	{
 		LOG_ERROR("expected exactly one argument to ft2232_device_desc <description>");
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2222,7 +2222,7 @@
 	{
 		LOG_ERROR("expected exactly one argument to ft2232_serial <serial-number>");
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2276,6 +2276,6 @@
 	{
 		LOG_ERROR("expected exactly one argument to ft2232_latency <ms>");
 	}
-	
+
 	return ERROR_OK;
 }

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/gw16012.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -97,13 +97,13 @@
 
 int gw16012_handle_parport_port_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
-jtag_interface_t gw16012_interface = 
+jtag_interface_t gw16012_interface =
 {
 	.name = "gw16012",
-	
+
 	.execute_queue = gw16012_execute_queue,
 
-	.speed = gw16012_speed,	
+	.speed = gw16012_speed,
 	.register_commands = gw16012_register_commands,
 	.init = gw16012_init,
 	.quit = gw16012_quit,
@@ -113,7 +113,7 @@
 {
 	register_command(cmd_ctx, NULL, "parport_port", gw16012_handle_parport_port_command,
 					 COMMAND_CONFIG, NULL);
-	
+
 	return ERROR_OK;
 }
 
@@ -125,7 +125,7 @@
 #ifdef _DEBUG_GW16012_IO_
 	LOG_DEBUG("%2.2x", value);
 #endif
-	
+
 	#if PARPORT_USE_PPDEV == 1
 		ioctl(device_handle, PPWDATA, &value);
 	#else
@@ -134,7 +134,7 @@
 		#else
 			outb(value, gw16012_port);
 		#endif
-	#endif	
+	#endif
 }
 
 void gw16012_control(u8 value)
@@ -209,15 +209,15 @@
 {
 	int i=0, tms=0;
 	u8 tms_scan = TAP_MOVE(cur_state, end_state);
-	
+
 	gw16012_control(0x0); /* single-bit mode */
-	
+
 	for (i = 0; i < 7; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		gw16012_data(tms << 1); /* output next TMS bit */
 	}
-	
+
 	cur_state = end_state;
 }
 
@@ -243,12 +243,12 @@
 			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[cmd->path[state_count]]);
 			exit(-1);
 		}
-		
+
 		cur_state = cmd->path[state_count];
 		state_count++;
 		num_states--;
 	}
-	
+
 	end_state = cur_state;
 }
 
@@ -256,20 +256,20 @@
 {
 	enum tap_state saved_end_state = end_state;
 	int i;
-	
+
 	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+	if (cur_state != TAP_IDLE)
 	{
-		gw16012_end_state(TAP_RTI);
+		gw16012_end_state(TAP_IDLE);
 		gw16012_state_move();
 	}
-	
+
 	for (i = 0; i < num_cycles; i++)
 	{
 		gw16012_control(0x0); /* single-bit mode */
 		gw16012_data(0x0); /* TMS cycle with TMS low */
 	}
-	
+
 	gw16012_end_state(saved_end_state);
 	if (cur_state != end_state)
 		gw16012_state_move();
@@ -283,12 +283,12 @@
 	u8 scan_out, scan_in;
 
 	/* only if we're not already in the correct Shift state */
-	if (!((!ir_scan && (cur_state == TAP_SD)) || (ir_scan && (cur_state == TAP_SI))))
+	if (!((!ir_scan && (cur_state == TAP_DRSHIFT)) || (ir_scan && (cur_state == TAP_IRSHIFT))))
 	{
 		if (ir_scan)
-			gw16012_end_state(TAP_SI);
+			gw16012_end_state(TAP_IRSHIFT);
 		else
-			gw16012_end_state(TAP_SD);
+			gw16012_end_state(TAP_DRSHIFT);
 
 		gw16012_state_move();
 		gw16012_end_state(saved_end_state);
@@ -302,20 +302,20 @@
 		bit_count += 7;
 		bits_left -= 7;
 	}
-	
+
 	gw16012_control(0x0); /* single-bit mode */
 	while (bits_left-- > 0)
 	{
 		u8 tms = 0;
-		
+
 		scan_out = buf_get_u32(buffer, bit_count, 1);
-		
+
 		if (bits_left == 0) /* last bit */
 		{
-			if ((ir_scan && (end_state == TAP_SI))
-				|| (!ir_scan && (end_state == TAP_SD)))
+			if ((ir_scan && (end_state == TAP_IRSHIFT))
+				|| (!ir_scan && (end_state == TAP_DRSHIFT)))
 			{
-				tms = 0; 
+				tms = 0;
 			}
 			else
 			{
@@ -329,20 +329,20 @@
 		{
 			gw16012_input(&scan_in);
 			buf_set_u32(buffer, bit_count, 1, ((scan_in & 0x08) >> 3));
-		}		
+		}
 
 		bit_count++;
 	}
 
-	if (!((ir_scan && (end_state == TAP_SI)) ||
-		(!ir_scan && (end_state == TAP_SD))))
+	if (!((ir_scan && (end_state == TAP_IRSHIFT)) ||
+		(!ir_scan && (end_state == TAP_DRSHIFT))))
 	{
 		gw16012_data(0x0);
 		if (ir_scan)
-			cur_state = TAP_PI;
+			cur_state = TAP_IRPAUSE;
 		else
-			cur_state = TAP_PD;
-			
+			cur_state = TAP_DRPAUSE;
+
 		if (cur_state != end_state)
 			gw16012_state_move();
 	}
@@ -355,12 +355,12 @@
 	enum scan_type type;
 	u8 *buffer;
 	int retval;
-	
+
 	/* return ERROR_OK, unless a jtag_read_buffer returns a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
-		
+
 	while (cmd)
 	{
 		switch (cmd->type)
@@ -378,7 +378,7 @@
 #endif
 				if (cmd->cmd.reset->trst == 1)
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				gw16012_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
@@ -410,7 +410,7 @@
 				scan_size = jtag_build_buffer(cmd->cmd.scan, &buffer);
 				type = jtag_scan_type(cmd->cmd.scan);
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG("%s scan (%i) %i bit end in %i", (cmd->cmd.scan->ir_scan) ? "ir" : "dr", 
+				LOG_DEBUG("%s scan (%i) %i bit end in %i", (cmd->cmd.scan->ir_scan) ? "ir" : "dr",
 					type, scan_size, cmd->cmd.scan->end_state);
 #endif
 				gw16012_scan(cmd->cmd.scan->ir_scan, type, buffer, scan_size);
@@ -431,7 +431,7 @@
 		}
 		cmd = cmd->next;
 	}
-	
+
 	return retval;
 }
 
@@ -443,16 +443,16 @@
 
     version.dwOSVersionInfoSize = sizeof version;
     if (!GetVersionEx( &version )) {
-        errno = EINVAL;
-        return -1;
+	errno = EINVAL;
+	return -1;
     }
     if (version.dwPlatformId != VER_PLATFORM_WIN32_NT)
-        return 0;
+	return 0;
 
     h = CreateFile( "\\\\.\\giveio", GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );
     if (h == INVALID_HANDLE_VALUE) {
-        errno = ENODEV;
-        return -1;
+	errno = ENODEV;
+	return -1;
     }
 
     CloseHandle( h );
@@ -468,7 +468,7 @@
 	int i = 0;
 #endif
 	u8 status_port;
-	
+
 #if PARPORT_USE_PPDEV == 1
 	if (device_handle>0)
 	{
@@ -486,7 +486,7 @@
 
 	snprintf(buffer, 256, "/dev/parport%d", gw16012_port);
 	device_handle = open(buffer, O_WRONLY);
-#endif	
+#endif
 	if (device_handle<0)
 	{
 		LOG_ERROR("cannot open device. check it exists and that user read and write rights are set");
@@ -525,7 +525,7 @@
 		gw16012_port = 0x378;
 		LOG_WARNING("No gw16012 port specified, using default '0x378' (LPT1)");
 	}
-	
+
 	LOG_DEBUG("requesting privileges for parallel port 0x%lx...", (long unsigned)(gw16012_port) );
 #if PARPORT_USE_GIVEIO == 1
 	if (gw16012_get_giveio_access() != 0)
@@ -545,19 +545,19 @@
 	outb(0x0, gw16012_port + 2);
 #endif
 #endif /* PARPORT_USE_PPDEV */
-	
+
 	gw16012_input(&status_port);
 	gw16012_msb = (status_port & 0x80) ^ 0x80;
-	
+
 	gw16012_speed(jtag_speed);
 	gw16012_reset(0, 0);
-	
+
 	return ERROR_OK;
 }
 
 int gw16012_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/jlink.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -146,92 +146,92 @@
 	int scan_size;
 	enum scan_type type;
 	u8 *buffer;
-	
+
 	while (cmd != NULL)
 	{
 		switch (cmd->type)
 		{
 			case JTAG_END_STATE:
 				DEBUG_JTAG_IO("end_state: %i", cmd->cmd.end_state->end_state);
-			
+
 				if (cmd->cmd.end_state->end_state != -1)
 				{
 					jlink_end_state(cmd->cmd.end_state->end_state);
 				}
 				break;
-	
+
 			case JTAG_RUNTEST:
 				DEBUG_JTAG_IO( "runtest %i cycles, end in %i", cmd->cmd.runtest->num_cycles, \
 					cmd->cmd.runtest->end_state);
-				
+
 				if (cmd->cmd.runtest->end_state != -1)
 				{
 					jlink_end_state(cmd->cmd.runtest->end_state);
 				}
 				jlink_runtest(cmd->cmd.runtest->num_cycles);
 				break;
-	
+
 			case JTAG_STATEMOVE:
 				DEBUG_JTAG_IO("statemove end in %i", cmd->cmd.statemove->end_state);
-			
+
 				if (cmd->cmd.statemove->end_state != -1)
 				{
 					jlink_end_state(cmd->cmd.statemove->end_state);
 				}
 				jlink_state_move();
 				break;
-	
+
 			case JTAG_PATHMOVE:
 				DEBUG_JTAG_IO("pathmove: %i states, end in %i", \
 					cmd->cmd.pathmove->num_states, \
 					cmd->cmd.pathmove->path[cmd->cmd.pathmove->num_states - 1]);
-			
+
 				jlink_path_move(cmd->cmd.pathmove->num_states, cmd->cmd.pathmove->path);
 				break;
-	
+
 			case JTAG_SCAN:
 				DEBUG_JTAG_IO("scan end in %i", cmd->cmd.scan->end_state);
-			
+
 				if (cmd->cmd.scan->end_state != -1)
 				{
 					jlink_end_state(cmd->cmd.scan->end_state);
 				}
-			
+
 				scan_size = jtag_build_buffer(cmd->cmd.scan, &buffer);
 				DEBUG_JTAG_IO("scan input, length = %d", scan_size);
-				
+
 #ifdef _DEBUG_USB_COMMS_
 				jlink_debug_buffer(buffer, (scan_size + 7) / 8);
 #endif
 				type = jtag_scan_type(cmd->cmd.scan);
 				jlink_scan(cmd->cmd.scan->ir_scan, type, buffer, scan_size, cmd->cmd.scan);
 				break;
-	
+
 			case JTAG_RESET:
 				DEBUG_JTAG_IO("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);
-			
+
 				jlink_tap_execute();
-			
+
 				if (cmd->cmd.reset->trst == 1)
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				jlink_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
-	
+
 			case JTAG_SLEEP:
 				DEBUG_JTAG_IO("sleep %i", cmd->cmd.sleep->us);
 				jlink_tap_execute();
 				jtag_sleep(cmd->cmd.sleep->us);
 				break;
-	
+
 			default:
 				LOG_ERROR("BUG: unknown JTAG command type encountered");
 				exit(-1);
 		}
 		cmd = cmd->next;
 	}
-	
+
 	return jlink_tap_execute();
 }
 
@@ -239,19 +239,19 @@
 int jlink_speed(int speed)
 {
 	int result;
-	
+
 	if (speed <= JLINK_MAX_SPEED)
 	{
 		/* check for RTCK setting */
 		if (speed == 0)
 			speed = -1;
-		
+
 		usb_out_buffer[0] = EMU_CMD_SET_SPEED;
 		usb_out_buffer[1] = (speed >> 0) & 0xff;
 		usb_out_buffer[2] = (speed >> 8) & 0xff;
-		
+
 		result = jlink_usb_write(jlink_jtag_handle, 3);
-		
+
 		if (result == 3)
 		{
 			return ERROR_OK;
@@ -266,14 +266,14 @@
 	{
 		LOG_INFO("Requested speed %dkHz exceeds maximum of %dkHz, ignored", speed, JLINK_MAX_SPEED);
 	}
-	
+
 	return ERROR_OK;
 }
 
 int jlink_khz(int khz, int *jtag_speed)
 {
 	*jtag_speed = khz;
-	
+
 	return ERROR_OK;
 }
 
@@ -286,16 +286,16 @@
 
 int jlink_init(void)
 {
-	int check_cnt;  
-	
+	int check_cnt;
+
 	jlink_jtag_handle = jlink_usb_open();
-	
+
 	if (jlink_jtag_handle == 0)
 	{
 		LOG_ERROR("Cannot find jlink Interface! Please check connection and permissions.");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-		
+
 	check_cnt = 0;
 	while (check_cnt < 3)
 	{
@@ -305,7 +305,7 @@
 			jlink_get_status();
 			break;
 		}
-		
+
 		check_cnt++;
 	}
 
@@ -313,12 +313,12 @@
 	{
 		LOG_INFO("J-Link initial read failed, don't worry");
 	}
-	
+
 	LOG_INFO("J-Link JTAG Interface ready");
-	
+
 	jlink_reset(0, 0);
 	jlink_tap_init();
-	
+
 	return ERROR_OK;
 }
 
@@ -350,20 +350,20 @@
 	int i;
 	int tms = 0;
 	u8 tms_scan = TAP_MOVE(cur_state, end_state);
-	
+
 	for (i = 0; i < 7; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		jlink_tap_append_step(tms, 0);
 	}
-	
+
 	cur_state = end_state;
 }
 
 void jlink_path_move(int num_states, enum tap_state *path)
 {
 	int i;
-	
+
 	for (i = 0; i < num_states; i++)
 	{
 		if (path[i] == tap_transitions[cur_state].low)
@@ -379,32 +379,32 @@
 			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[path[i]]);
 			exit(-1);
 		}
-		
+
 		cur_state = path[i];
 	}
-	
+
 	end_state = cur_state;
 }
 
 void jlink_runtest(int num_cycles)
 {
 	int i;
-	
+
 	enum tap_state saved_end_state = end_state;
-	
+
 	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+	if (cur_state != TAP_IDLE)
 	{
-		jlink_end_state(TAP_RTI);
+		jlink_end_state(TAP_IDLE);
 		jlink_state_move();
 	}
-	
+
 	/* execute num_cycles */
 	for (i = 0; i < num_cycles; i++)
 	{
 		jlink_tap_append_step(0, 0);
 	}
-	
+
 	/* finish in end_state */
 	jlink_end_state(saved_end_state);
 	if (cur_state != end_state)
@@ -416,25 +416,25 @@
 void jlink_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
 {
 	enum tap_state saved_end_state;
-	
+
 	jlink_tap_ensure_space(1, scan_size + 8);
-	
+
 	saved_end_state = end_state;
-	
+
 	/* Move to appropriate scan state */
-	jlink_end_state(ir_scan ? TAP_SI : TAP_SD);
-	
+	jlink_end_state(ir_scan ? TAP_IRSHIFT : TAP_DRSHIFT);
+
 	jlink_state_move();
 	jlink_end_state(saved_end_state);
-	
+
 	/* Scan */
 	jlink_tap_append_scan(scan_size, buffer, command);
-	
+
 	/* We are in Exit1, go to Pause */
 	jlink_tap_append_step(0, 0);
-	
-	cur_state = ir_scan ? TAP_PI : TAP_PD;
-	
+
+	cur_state = ir_scan ? TAP_IRPAUSE : TAP_DRPAUSE;
+
 	if (cur_state != end_state)
 	{
 		jlink_state_move();
@@ -444,7 +444,7 @@
 void jlink_reset(int trst, int srst)
 {
 	LOG_DEBUG("trst: %i, srst: %i", trst, srst);
-	
+
 	/* Signals are active low */
 	if (srst == 0)
 	{
@@ -454,7 +454,7 @@
 	{
 		jlink_simple_command(EMU_CMD_HW_RESET0);
 	}
-	
+
 	if (trst == 0)
 	{
 		jlink_simple_command(EMU_CMD_HW_TRST1);
@@ -468,12 +468,12 @@
 void jlink_simple_command(u8 command)
 {
 	int result;
-	
+
 	DEBUG_JTAG_IO("0x%02x", command);
-	
+
 	usb_out_buffer[0] = command;
 	result = jlink_usb_write(jlink_jtag_handle, 1);
-	
+
 	if (result != 1)
 	{
 		LOG_ERROR("J-Link command 0x%02x failed (%d)", command, result);
@@ -483,10 +483,10 @@
 int jlink_get_status(void)
 {
 	int result;
-	
+
 	jlink_simple_command(EMU_CMD_GET_STATE);
 	result = jlink_usb_read(jlink_jtag_handle);
-	
+
 	if (result == 8)
 	{
 		int vref = usb_in_buffer[0] + (usb_in_buffer[1] << 8);
@@ -494,7 +494,7 @@
 			vref / 1000, vref % 1000, \
 			usb_in_buffer[2], usb_in_buffer[3], usb_in_buffer[4], \
 			usb_in_buffer[5], usb_in_buffer[6], usb_in_buffer[7]);
-		
+
 		if (vref < 1500)
 		{
 			LOG_ERROR("Vref too low. Check Target Power\n");
@@ -504,7 +504,7 @@
 	{
 		LOG_ERROR("J-Link command EMU_CMD_GET_STATE failed (%d)\n", result);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -512,16 +512,16 @@
 {
 	int result;
 	int len = 0;
-	
+
 	/* query hardware version */
 	jlink_simple_command(EMU_CMD_VERSION);
 	result = jlink_usb_read(jlink_jtag_handle);
-	
+
 	if (result == 2)
 	{
 		len = buf_get_u32(usb_in_buffer, 0, 16);
 		result = jlink_usb_read(jlink_jtag_handle);
-		
+
 		if (result == len)
 		{
 			usb_in_buffer[result] = 0;
@@ -529,7 +529,7 @@
 			return ERROR_OK;
 		}
 	}
-	
+
 	LOG_ERROR("J-Link command EMU_CMD_VERSION failed (%d)\n", result);
 	return ERROR_JTAG_DEVICE_ERROR;
 }
@@ -541,7 +541,7 @@
 		/* attempt to get status */
 		jlink_get_status();
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -581,7 +581,7 @@
 {
 	int available_scans = MAX_PENDING_SCAN_RESULTS - pending_scan_results_length;
 	int available_bits = JLINK_TAP_BUFFER_SIZE * 8 - tap_length;
-	
+
 	if (scans > available_scans || bits > available_bits)
 	{
 		jlink_tap_execute();
@@ -592,12 +592,12 @@
 {
 	last_tms = tms;
 	int index = tap_length / 8;
-	
+
 	if (index < JLINK_TAP_BUFFER_SIZE)
 	{
 		int bit_index = tap_length % 8;
 		u8 bit = 1 << bit_index;
-		
+
 		if (tms)
 		{
 			tms_buffer[index] |= bit;
@@ -606,7 +606,7 @@
 		{
 			tms_buffer[index] &= ~bit;
 		}
-		
+
 		if (tdi)
 		{
 			tdi_buffer[index] |= bit;
@@ -615,7 +615,7 @@
 		{
 			tdi_buffer[index] &= ~bit;
 		}
-		
+
 		tap_length++;
 	}
 	else
@@ -628,12 +628,12 @@
 {
 	pending_scan_result_t *pending_scan_result = &pending_scan_results_buffer[pending_scan_results_length];
 	int i;
-	
+
 	pending_scan_result->first = tap_length;
 	pending_scan_result->length = length;
 	pending_scan_result->command = command;
 	pending_scan_result->buffer = buffer;
-	
+
 	for (i = 0; i < length; i++)
 	{
 		jlink_tap_append_step((i < length-1 ? 0 : 1), (buffer[i/8] >> (i%8)) & 1);
@@ -650,7 +650,7 @@
 	int tdi_offset;
 	int i;
 	int result;
-	
+
 	if (tap_length > 0)
 	{
 		/* Pad last byte so that tap_length is divisible by 8 */
@@ -660,35 +660,35 @@
 			 * analogous to free-running JTAG interfaces. */
 			jlink_tap_append_step(last_tms, 0);
 		}
-	
+
 		byte_length = tap_length / 8;
-	
+
 		usb_out_buffer[0] = EMU_CMD_HW_JTAG3;
 		usb_out_buffer[1] = 0;
 		usb_out_buffer[2] = (tap_length >> 0) & 0xff;
 		usb_out_buffer[3] = (tap_length >> 8) & 0xff;
-	
+
 		tms_offset = 4;
 		for (i = 0; i < byte_length; i++)
 		{
 			usb_out_buffer[tms_offset + i] = tms_buffer[i];
 		}
-		
+
 		tdi_offset = tms_offset + byte_length;
 		for (i = 0; i < byte_length; i++)
 		{
 			usb_out_buffer[tdi_offset + i] = tdi_buffer[i];
 		}
-	
+
 		result = jlink_usb_message(jlink_jtag_handle, 4 + 2 * byte_length, byte_length);
-	
+
 		if (result == byte_length)
 		{
 			for (i = 0; i < byte_length; i++)
 			{
 				tdo_buffer[i] = usb_in_buffer[i];
 			}
-			
+
 			for (i = 0; i < pending_scan_results_length; i++)
 			{
 				pending_scan_result_t *pending_scan_result = &pending_scan_results_buffer[i];
@@ -696,22 +696,22 @@
 				int length = pending_scan_result->length;
 				int first = pending_scan_result->first;
 				scan_command_t *command = pending_scan_result->command;
-	
+
 				/* Copy to buffer */
 				buf_set_buf(tdo_buffer, first, buffer, 0, length);
-	
+
 				DEBUG_JTAG_IO("pending scan result, length = %d", length);
-				
+
 #ifdef _DEBUG_USB_COMMS_
 				jlink_debug_buffer(buffer, byte_length);
 #endif
-	
+
 				if (jtag_read_buffer(buffer, command) != ERROR_OK)
 				{
 					jlink_tap_init();
 					return ERROR_JTAG_QUEUE_FAILED;
 				}
-		
+
 				if (pending_scan_result->buffer != NULL)
 				{
 					free(pending_scan_result->buffer);
@@ -723,10 +723,10 @@
 			LOG_ERROR("jlink_tap_execute, wrong result %d, expected %d", result, byte_length);
 			return ERROR_JTAG_QUEUE_FAILED;
 		}
-		
+
 		jlink_tap_init();
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -738,19 +738,19 @@
 	struct usb_bus *busses;
 	struct usb_bus *bus;
 	struct usb_device *dev;
-	
+
 	jlink_jtag_t *result;
-	
+
 	result = (jlink_jtag_t*) malloc(sizeof(jlink_jtag_t));
-	
+
 	usb_init();
 	usb_find_busses();
 	usb_find_devices();
-	
+
 	busses = usb_get_busses();
-	
+
 	/* find jlink_jtag device in usb bus */
-	
+
 	for (bus = busses; bus; bus = bus->next)
 	{
 		for (dev = bus->devices; dev; dev = dev->next)
@@ -758,23 +758,23 @@
 			if ((dev->descriptor.idVendor == VID) && (dev->descriptor.idProduct == PID))
 			{
 				result->usb_handle = usb_open(dev);
-				
+
 				/* usb_set_configuration required under win32 */
 				usb_set_configuration(result->usb_handle, dev->config[0].bConfigurationValue);
 				usb_claim_interface(result->usb_handle, 0);
-				
+
 #if 0
-				/* 
+				/*
 				 * This makes problems under Mac OS X. And is not needed
 				 * under Windows. Hopefully this will not break a linux build
 				 */
 				usb_set_altinterface(result->usb_handle, 0);
-#endif				
+#endif
 				return result;
 			}
 		}
 	}
-	
+
 	free(result);
 	return NULL;
 }
@@ -790,7 +790,7 @@
 {
 	int result;
 	int result2;
-	
+
 	result = jlink_usb_write(jlink_jtag, out_length);
 	if (result == out_length)
 	{
@@ -811,7 +811,7 @@
 					else
 					{
 						LOG_ERROR("jlink_usb_read_emu_result (requested=0, result=%d)", usb_emu_result_buffer[0]);
-						return -1;				
+						return -1;
 					}
 				}
 				else
@@ -830,7 +830,7 @@
 				else
 				{
 					LOG_ERROR("jlink_usb_read_emu_result (requested=0, result=%d)", usb_in_buffer[result]);
-					return -1;				
+					return -1;
 				}
 			}
 		}
@@ -851,18 +851,18 @@
 int jlink_usb_write(jlink_jtag_t *jlink_jtag, int out_length)
 {
 	int result;
-	
+
 	if (out_length > JLINK_OUT_BUFFER_SIZE)
 	{
 		LOG_ERROR("jlink_jtag_write illegal out_length=%d (max=%d)", out_length, JLINK_OUT_BUFFER_SIZE);
 		return -1;
 	}
-	
+
 	result = usb_bulk_write(jlink_jtag->usb_handle, JLINK_WRITE_ENDPOINT, \
 		usb_out_buffer, out_length, JLINK_USB_TIMEOUT);
-	
+
 	DEBUG_JTAG_IO("jlink_usb_write, out_length = %d, result = %d", out_length, result);
-	
+
 #ifdef _DEBUG_USB_COMMS_
 	jlink_debug_buffer(usb_out_buffer, out_length);
 #endif
@@ -876,7 +876,7 @@
 		usb_in_buffer, JLINK_IN_BUFFER_SIZE, JLINK_USB_TIMEOUT);
 
 	DEBUG_JTAG_IO("jlink_usb_read, result = %d", result);
-	
+
 #ifdef _DEBUG_USB_COMMS_
 	jlink_debug_buffer(usb_in_buffer, result);
 #endif
@@ -890,7 +890,7 @@
 		usb_emu_result_buffer, JLINK_EMU_RESULT_BUFFER_SIZE, JLINK_USB_TIMEOUT);
 
 	DEBUG_JTAG_IO("jlink_usb_read_result, result = %d", result);
-	
+
 #ifdef _DEBUG_USB_COMMS_
 	jlink_debug_buffer(usb_emu_result_buffer, result);
 #endif
@@ -906,7 +906,7 @@
 	char s[4];
 	int i;
 	int j;
-	
+
 	for (i = 0; i < length; i += BYTES_PER_LINE)
 	{
 		snprintf(line, 5, "%04x", i);

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/jtag.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -87,22 +87,22 @@
 
 tap_transition_t tap_transitions[16] =
 {
-	{TAP_TLR, TAP_RTI},		/* TLR */
-	{TAP_SIS, TAP_CD},		/* SDS */
-	{TAP_E1D, TAP_SD},		/* CD  */
-	{TAP_E1D, TAP_SD},		/* SD  */
-	{TAP_UD,  TAP_PD}, 		/* E1D */
-	{TAP_E2D, TAP_PD},		/* PD  */
-	{TAP_UD,  TAP_SD},		/* E2D */
-	{TAP_SDS, TAP_RTI},		/* UD  */
-	{TAP_SDS, TAP_RTI},		/* RTI */
-	{TAP_TLR, TAP_CI},		/* SIS */
-	{TAP_E1I, TAP_SI},		/* CI  */
-	{TAP_E1I, TAP_SI},		/* SI  */
-	{TAP_UI,  TAP_PI}, 		/* E1I */
-	{TAP_E2I, TAP_PI},		/* PI  */
-	{TAP_UI,  TAP_SI},		/* E2I */
-	{TAP_SDS, TAP_RTI}		/* UI  */
+	{TAP_RESET, TAP_IDLE},		/* TLR */
+	{TAP_IRSELECT, TAP_DRCAPTURE},		/* SDS */
+	{TAP_DREXIT1, TAP_DRSHIFT},		/* CD  */
+	{TAP_DREXIT1, TAP_DRSHIFT},		/* SD  */
+	{TAP_DRUPDATE,  TAP_DRPAUSE}, 		/* E1D */
+	{TAP_DREXIT2, TAP_DRPAUSE},		/* PD  */
+	{TAP_DRUPDATE,  TAP_DRSHIFT},		/* E2D */
+	{TAP_DRSELECT, TAP_IDLE},		/* UD  */
+	{TAP_DRSELECT, TAP_IDLE},		/* RTI */
+	{TAP_RESET, TAP_IRCAPTURE},		/* SIS */
+	{TAP_IREXIT1, TAP_IRSHIFT},		/* CI  */
+	{TAP_IREXIT1, TAP_IRSHIFT},		/* SI  */
+	{TAP_IRUPDATE,  TAP_IRPAUSE}, 		/* E1I */
+	{TAP_IREXIT2, TAP_IRPAUSE},		/* PI  */
+	{TAP_IRUPDATE,  TAP_IRSHIFT},		/* E2I */
+	{TAP_DRSELECT, TAP_IDLE}		/* UI  */
 };
 
 char* jtag_event_strings[] =
@@ -115,8 +115,8 @@
  * inside the drivers, but we don't want to break
  * linking the drivers!!!!
  */
-enum tap_state end_state = TAP_TLR;
-enum tap_state cur_state = TAP_TLR;
+enum tap_state end_state = TAP_RESET;
+enum tap_state cur_state = TAP_RESET;
 int jtag_trst = 0;
 int jtag_srst = 0;
 
@@ -125,8 +125,8 @@
 static jtag_tap_t *jtag_all_taps = NULL;
 
 enum reset_types jtag_reset_config = RESET_NONE;
-enum tap_state cmd_queue_end_state = TAP_TLR;
-enum tap_state cmd_queue_cur_state = TAP_TLR;
+enum tap_state cmd_queue_end_state = TAP_RESET;
+enum tap_state cmd_queue_cur_state = TAP_RESET;
 
 int jtag_verify_capture_ir = 1;
 
@@ -477,7 +477,7 @@
 	 * alignment.
 	 *
 	 * What I do not/have is a reasonable portable means
-	 * to align by... 
+	 * to align by...
 	 *
 	 * The solution here, is based on these suggestions.
 	 * http://gcc.gnu.org/ml/gcc-help/2008-12/msg00041.html
@@ -493,9 +493,9 @@
 
 	// The alignment process.
 	size = (size + ALIGN_SIZE -1) & (~(ALIGN_SIZE-1));
-	// Done... 
-	
+	// Done...
 
+
 	if (*p_page)
 	{
 		while ((*p_page)->next)
@@ -543,7 +543,7 @@
 		return;
 	}
 
-	if (cmd_queue_end_state == TAP_TLR)
+	if (cmd_queue_end_state == TAP_RESET)
 		jtag_call_event_callbacks(JTAG_TRST_ASSERTED);
 }
 
@@ -959,7 +959,7 @@
 
 void jtag_add_tlr(void)
 {
-	jtag_prelude(TAP_TLR);
+	jtag_prelude(TAP_RESET);
 
 	int retval;
 	retval=interface_jtag_add_tlr();
@@ -969,7 +969,7 @@
 
 int MINIDRIVER(interface_jtag_add_tlr)()
 {
-	enum tap_state state = TAP_TLR;
+	enum tap_state state = TAP_RESET;
 	jtag_command_t **last_cmd = jtag_get_last_command_p();
 
 	/* allocate memory for a new list member */
@@ -1000,9 +1000,9 @@
 
 	for (i=0; i<num_states; i++)
 	{
-		if (path[i] == TAP_TLR)
+		if (path[i] == TAP_RESET)
 		{
-			LOG_ERROR("BUG: TAP_TLR is not a valid state for pathmove sequences");
+			LOG_ERROR("BUG: TAP_RESET is not a valid state for pathmove sequences");
 			exit(-1);
 		}
 		if ((tap_transitions[cur_state].low != path[i])&&
@@ -1154,7 +1154,7 @@
 	if (trst_with_tlr)
 	{
 		LOG_DEBUG("JTAG reset with TLR instead of TRST");
-		jtag_add_end_state(TAP_TLR);
+		jtag_add_end_state(TAP_RESET);
 		jtag_add_tlr();
 		jtag_call_event_callbacks(JTAG_TRST_ASSERTED);
 		return;
@@ -1166,7 +1166,7 @@
 		 * and inform possible listeners about this
 		 */
 		LOG_DEBUG("TRST line asserted");
-		cmd_queue_cur_state = TAP_TLR;
+		cmd_queue_cur_state = TAP_RESET;
 		jtag_call_event_callbacks(JTAG_TRST_ASSERTED);
 	}
 	else
@@ -1196,9 +1196,9 @@
 void jtag_add_end_state(enum tap_state state)
 {
 	cmd_queue_end_state = state;
-	if ((cmd_queue_end_state == TAP_SD)||(cmd_queue_end_state == TAP_SI))
+	if ((cmd_queue_end_state == TAP_DRSHIFT)||(cmd_queue_end_state == TAP_IRSHIFT))
 	{
-		LOG_ERROR("BUG: TAP_SD/SI can't be end state. Calling code should use a larger scan field");
+		LOG_ERROR("BUG: TAP_DRSHIFT/SI can't be end state. Calling code should use a larger scan field");
 	}
 }
 
@@ -1491,7 +1491,7 @@
 		buf_set_u32(idcode_buffer, i * 32, 32, 0x000000FF);
 	}
 
-	jtag_add_plain_dr_scan(1, &field, TAP_TLR);
+	jtag_add_plain_dr_scan(1, &field, TAP_RESET);
 	jtag_execute_queue();
 
 	for (i = 0; i < JTAG_MAX_CHAIN_SIZE * 4; i++)
@@ -1583,7 +1583,7 @@
 						break;
 					}
 				}
-			
+
 				/* If none of the expected ids matched, log an error */
 				if (ii == tap->expected_ids_cnt) {
 					LOG_ERROR("JTAG tap: %s             got: 0x%08x (mfg: 0x%3.3x, part: 0x%4.4x, ver: 0x%1.1x)",
@@ -1662,7 +1662,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_plain_ir_scan(1, &field, TAP_TLR);
+	jtag_add_plain_ir_scan(1, &field, TAP_RESET);
 	jtag_execute_queue();
 
 	tap = NULL;
@@ -1801,8 +1801,8 @@
 			memcpy(new_expected_ids, pTap->expected_ids, sizeof(u32) * pTap->expected_ids_cnt);
 
 			new_expected_ids[pTap->expected_ids_cnt] = w;
-		
-			free(pTap->expected_ids);	
+
+			free(pTap->expected_ids);
 			pTap->expected_ids = new_expected_ids;
 			pTap->expected_ids_cnt++;
 			break;

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/jtag.h	2008-12-13 06:25:50 UTC (rev 1232)
@@ -33,20 +33,15 @@
 #define _DEBUG_JTAG_IO_
 #endif
 
-/* Tap States
- * TLR - Test-Logic-Reset, RTI - Run-Test/Idle,
- * SDS - Select-DR-Scan, CD - Capture-DR, SD - Shift-DR, E1D - Exit1-DR,
- * PD - Pause-DR, E2D - Exit2-DR, UD - Update-DR,
- * SIS - Select-IR-Scan, CI - Capture-IR, SI - Shift-IR, E1I - Exit1-IR,
- * PI - Pause-IR, E2I - Exit2-IR, UI - Update-IR
+/* 16 Tap States, from page 21 of ASSET InterTech, Inc.'s svf.pdf
  */
 enum tap_state
 {
-	TAP_TLR = 0x0, TAP_RTI = 0x8,
-	TAP_SDS = 0x1, TAP_CD = 0x2, TAP_SD = 0x3, TAP_E1D = 0x4,
-	TAP_PD = 0x5, TAP_E2D = 0x6, TAP_UD = 0x7,
-	TAP_SIS = 0x9, TAP_CI = 0xa, TAP_SI = 0xb, TAP_E1I = 0xc,
-	TAP_PI = 0xd, TAP_E2I = 0xe, TAP_UI = 0xf
+	TAP_RESET = 0x0, TAP_IDLE = 0x8,
+	TAP_DRSELECT = 0x1, TAP_DRCAPTURE = 0x2, TAP_DRSHIFT = 0x3, TAP_DREXIT1 = 0x4,
+	TAP_DRPAUSE = 0x5, TAP_DREXIT2 = 0x6, TAP_DRUPDATE = 0x7,
+	TAP_IRSELECT = 0x9, TAP_IRCAPTURE = 0xa, TAP_IRSHIFT = 0xb, TAP_IREXIT1 = 0xc,
+	TAP_IRPAUSE = 0xd, TAP_IREXIT2 = 0xe, TAP_IRUPDATE = 0xf
 };
 
 typedef struct tap_transition_s
@@ -325,7 +320,7 @@
 
 /* JTAG interface, can be implemented with a software or hardware fifo
  *
- * TAP_SD and TAP_SI are illegal end states. TAP_SD/SI as end states
+ * TAP_DRSHIFT and TAP_IRSHIFT are illegal end states. TAP_DRSHIFT/SI as end states
  * can be emulated by using a larger scan.
  *
  * Code that is relatively insensitive to the path(as long
@@ -343,7 +338,7 @@
 extern int interface_jtag_add_plain_ir_scan(int num_fields, scan_field_t *fields, enum tap_state endstate);
 extern void jtag_add_plain_dr_scan(int num_fields, scan_field_t *fields, enum tap_state endstate);
 extern int interface_jtag_add_plain_dr_scan(int num_fields, scan_field_t *fields, enum tap_state endstate);
-/* run a TAP_TLR reset. End state is TAP_TLR, regardless
+/* run a TAP_RESET reset. End state is TAP_RESET, regardless
  * of start state.
  */
 extern void jtag_add_tlr(void);
@@ -364,7 +359,7 @@
  * all drivers can support this, but it is required for e.g.
  * XScale and Xilinx support
  *
- * Note! TAP_TLR must not be used in the path!
+ * Note! TAP_RESET must not be used in the path!
  *
  * Note that the first on the list must be reachable
  * via a single transition from the current state.
@@ -380,12 +375,12 @@
  */
 extern void jtag_add_pathmove(int num_states, enum tap_state *path);
 extern int interface_jtag_add_pathmove(int num_states, enum tap_state *path);
-/* go to TAP_RTI, if we're not already there and cycle
- * precisely num_cycles in the TAP_RTI after which move
- * to the end state, if it is != TAP_RTI
+/* go to TAP_IDLE, if we're not already there and cycle
+ * precisely num_cycles in the TAP_IDLE after which move
+ * to the end state, if it is != TAP_IDLE
  *
  * nb! num_cycles can be 0, in which case the fn will navigate
- * to endstate via TAP_RTI
+ * to endstate via TAP_IDLE
  */
 extern void jtag_add_runtest(int num_cycles, enum tap_state endstate);
 extern int interface_jtag_add_runtest(int num_cycles, enum tap_state endstate);
@@ -488,7 +483,7 @@
 #define MINIDRIVER(a) a
 /* jtag_add_dr_out() is a faster version of jtag_add_dr_scan()
  *
- * Current or end_state can not be TAP_TLR. end_state can be -1
+ * Current or end_state can not be TAP_RESET. end_state can be -1
  *
  * num_bits[i] is the number of bits to clock out from value[i] LSB first.
  *

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/usbprog.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -151,7 +151,7 @@
 #endif
 				if (cmd->cmd.reset->trst == 1)
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				usbprog_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
@@ -299,9 +299,9 @@
 	int i;
 
 	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+	if (cur_state != TAP_IDLE)
 	{
-		usbprog_end_state(TAP_RTI);
+		usbprog_end_state(TAP_IDLE);
 		usbprog_state_move();
 	}
 
@@ -336,9 +336,9 @@
 	enum tap_state saved_end_state = end_state;
 
 	if (ir_scan)
-		usbprog_end_state(TAP_SI);
+		usbprog_end_state(TAP_IRSHIFT);
 	else
-		usbprog_end_state(TAP_SD);
+		usbprog_end_state(TAP_DRSHIFT);
 
 	/* usbprog_jtag_tms_send(usbprog_jtag_handle); */
 
@@ -361,9 +361,9 @@
 	}
 
 	if (ir_scan)
-		cur_state = TAP_PI;
+		cur_state = TAP_IRPAUSE;
 	else
-		cur_state = TAP_PD;
+		cur_state = TAP_DRPAUSE;
 
 	if (cur_state != end_state)
 		usbprog_state_move();

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/jtag/zy1000.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -158,7 +158,7 @@
 	else
 	{
 		/* Danger!!! if clk!=0 when in
-		 * idle in TAP_RTI, reset halt on str912 will fail.
+		 * idle in TAP_IDLE, reset halt on str912 will fail.
 		 */
 		ZY1000_POKE(ZY1000_JTAG_BASE+0x10, 0x00000001);
 	}
@@ -177,7 +177,7 @@
 	{
 		waitIdle();
 		/* we're now in the TLR state until trst is deasserted */
-		ZY1000_POKE(ZY1000_JTAG_BASE+0x20, TAP_TLR);
+		ZY1000_POKE(ZY1000_JTAG_BASE+0x20, TAP_RESET);
 	} else
 	{
 		/* We'll get RCLK failure when we assert TRST, so clear any false positives here */
@@ -303,7 +303,7 @@
     if (fread(*data, 1, *len, pFile)!=*len)
     {
 		fclose(pFile);
-    	free(*data);
+	free(*data);
 		LOG_ERROR("Can't open %s\n", fileName);
 		return ERROR_JTAG_DEVICE_ERROR;
     }
@@ -429,7 +429,7 @@
 			enum tap_state pause_state;
 			int l;
 			k=num_bits-j;
-			pause_state=(shiftState==TAP_SD)?TAP_SD:TAP_SI;
+			pause_state=(shiftState==TAP_DRSHIFT)?TAP_DRSHIFT:TAP_IRSHIFT;
 			if (k>32)
 			{
 				k=32;
@@ -437,7 +437,7 @@
 			} else if (pause&&(i == num_fields-1))
 			{
 				/* this was the last to shift out this time */
-				pause_state=(shiftState==TAP_SD)?TAP_PD:TAP_PI;
+				pause_state=(shiftState==TAP_DRSHIFT)?TAP_DRPAUSE:TAP_IRPAUSE;
 			}
 
 			// we have (num_bits+7)/8 bytes of bits to toggle out.
@@ -520,7 +520,7 @@
 					fields[j].in_check_mask = tap->expected_mask;
 				}
 
-				scanFields(1, fields+j, TAP_SI, pause);
+				scanFields(1, fields+j, TAP_IRSHIFT, pause);
 				/* update device information */
 				buf_cpy(fields[j].out_value, tap->cur_instr, scan_size);
 
@@ -538,7 +538,7 @@
 			memset(&tmp, 0, sizeof(tmp));
 			tmp.out_value = ones;
 			tmp.num_bits = scan_size;
-			scanFields(1, &tmp, TAP_SI, pause);
+			scanFields(1, &tmp, TAP_IRSHIFT, pause);
 			/* update device information */
 			buf_cpy(tmp.out_value, tap->cur_instr, scan_size);
 			tap->bypass = 1;
@@ -555,7 +555,7 @@
 
 int interface_jtag_add_plain_ir_scan(int num_fields, scan_field_t *fields, enum tap_state state)
 {
-	scanFields(num_fields, fields, TAP_SI, 1);
+	scanFields(num_fields, fields, TAP_IRSHIFT, 1);
 	gotoEndState();
 
 	return ERROR_OK;
@@ -580,7 +580,7 @@
 			{
 				found = 1;
 
-				scanFields(1, fields+j, TAP_SD, pause);
+				scanFields(1, fields+j, TAP_DRSHIFT, pause);
 			}
 		}
 		if (!found)
@@ -596,7 +596,7 @@
 			tmp.in_handler = NULL;
 			tmp.in_handler_priv = NULL;
 
-			scanFields(1, &tmp, TAP_SD, pause);
+			scanFields(1, &tmp, TAP_DRSHIFT, pause);
 		}
 		else
 		{
@@ -608,7 +608,7 @@
 
 int interface_jtag_add_plain_dr_scan(int num_fields, scan_field_t *fields, enum tap_state state)
 {
-	scanFields(num_fields, fields, TAP_SD, 1);
+	scanFields(num_fields, fields, TAP_DRSHIFT, 1);
 	gotoEndState();
 	return ERROR_OK;
 }
@@ -616,7 +616,7 @@
 
 int interface_jtag_add_tlr()
 {
-	setCurrentState(TAP_TLR);
+	setCurrentState(TAP_RESET);
 	return ERROR_OK;
 }
 
@@ -635,7 +635,7 @@
 int interface_jtag_add_runtest(int num_cycles, enum tap_state state)
 {
 	/* num_cycles can be 0 */
-	setCurrentState(TAP_RTI);
+	setCurrentState(TAP_IDLE);
 
 	/* execute num_cycles, 32 at the time. */
 	int i;
@@ -647,14 +647,14 @@
 		{
 			num=num_cycles-i;
 		}
-		shiftValueInner(TAP_RTI, TAP_RTI, num, 0);
+		shiftValueInner(TAP_IDLE, TAP_IDLE, num, 0);
 	}
 
 #if !TEST_MANUAL()
 	/* finish in end_state */
 	setCurrentState(state);
 #else
-	enum tap_state t=TAP_RTI;
+	enum tap_state t=TAP_IDLE;
 	/* test manual drive code on any target */
 	int tms;
 	u8 tms_scan = TAP_MOVE(t, state);
@@ -734,8 +734,8 @@
 			int i;
 			for (i = 0; i < count; i++)
 			{
-				shiftValueInner(TAP_SD, TAP_SD, 32, fast_target_buffer_get_u32(buffer, 1));
-				shiftValueInner(TAP_SD, end_state, 6, reg_addr|(1<<5));
+				shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, 32, fast_target_buffer_get_u32(buffer, 1));
+				shiftValueInner(TAP_DRSHIFT, end_state, 6, reg_addr|(1<<5));
 				buffer+=4;
 			}
 		} else
@@ -743,8 +743,8 @@
 			int i;
 			for (i = 0; i < count; i++)
 			{
-				shiftValueInner(TAP_SD, TAP_SD, 32, fast_target_buffer_get_u32(buffer, 0));
-				shiftValueInner(TAP_SD, end_state, 6, reg_addr|(1<<5));
+				shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, 32, fast_target_buffer_get_u32(buffer, 0));
+				shiftValueInner(TAP_DRSHIFT, end_state, 6, reg_addr|(1<<5));
 				buffer+=4;
 			}
 		}

Modified: trunk/src/pld/virtex2.c
===================================================================
--- trunk/src/pld/virtex2.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/pld/virtex2.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -63,7 +63,7 @@
 		field.in_handler = NULL;
 		field.in_handler_priv = NULL;
 
-		jtag_add_ir_scan(1, &field, TAP_RTI);
+		jtag_add_ir_scan(1, &field, TAP_IDLE);
 
 		free(field.out_value);
 	}
@@ -95,7 +95,7 @@
 
 	virtex2_set_instr(virtex2_info->tap, 0x5); /* CFG_IN */
 
-	jtag_add_dr_scan(1, &scan_field, TAP_PD);
+	jtag_add_dr_scan(1, &scan_field, TAP_DRPAUSE);
 
 	free(values);
 
@@ -128,7 +128,7 @@
 	while (num_words--)
 	{
 		scan_field.in_handler_priv = words++;
-		jtag_add_dr_scan(1, &scan_field, TAP_PD);
+		jtag_add_dr_scan(1, &scan_field, TAP_DRPAUSE);
 	}
 
 	return ERROR_OK;
@@ -176,7 +176,7 @@
 	if ((retval = xilinx_read_bit_file(&bit_file, filename)) != ERROR_OK)
 		return retval;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	virtex2_set_instr(virtex2_info->tap, 0xb); /* JPROG_B */
 	jtag_execute_queue();
 	jtag_add_sleep(1000);
@@ -190,18 +190,18 @@
 	field.num_bits = bit_file.length * 8;
 	field.out_value = bit_file.data;
 
-	jtag_add_dr_scan(1, &field, TAP_PD);
+	jtag_add_dr_scan(1, &field, TAP_DRPAUSE);
 	jtag_execute_queue();
 
 	jtag_add_tlr();
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	virtex2_set_instr(virtex2_info->tap, 0xc); /* JSTART */
-	jtag_add_runtest(13, TAP_RTI);
+	jtag_add_runtest(13, TAP_IDLE);
 	virtex2_set_instr(virtex2_info->tap, 0x3f); /* BYPASS */
 	virtex2_set_instr(virtex2_info->tap, 0x3f); /* BYPASS */
 	virtex2_set_instr(virtex2_info->tap, 0xc); /* JSTART */
-	jtag_add_runtest(13, TAP_RTI);
+	jtag_add_runtest(13, TAP_IDLE);
 	virtex2_set_instr(virtex2_info->tap, 0x3f); /* BYPASS */
 	jtag_execute_queue();
 

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/arm11.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -393,7 +393,7 @@
 	arm11_setup_field(arm11,  1, NULL, NULL,	chain5_fields + 1);
 	arm11_setup_field(arm11,  1, NULL, NULL,	chain5_fields + 2);
 
-	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_PD);
+	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 	}
 	else
 	{
@@ -627,7 +627,7 @@
 	arm11_setup_field(arm11,  1, &Ready,	NULL, chain5_fields + 1);
 	arm11_setup_field(arm11,  1, &Valid,	NULL, chain5_fields + 2);
 
-	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_PD);
+	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 	}
 
 	arm11_record_register_history(arm11);
@@ -735,7 +735,7 @@
 	return ERROR_OK;
 	}
 
-	arm11_add_IR(arm11, ARM11_HALT, TAP_RTI);
+	arm11_add_IR(arm11, ARM11_HALT, TAP_IDLE);
 
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -841,7 +841,7 @@
 
 	arm11_leave_debug_state(arm11);
 
-	arm11_add_IR(arm11, ARM11_RESTART, TAP_RTI);
+	arm11_add_IR(arm11, ARM11_RESTART, TAP_IDLE);
 
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -956,7 +956,7 @@
 
 	arm11_leave_debug_state(arm11);
 
-	arm11_add_IR(arm11, ARM11_RESTART, TAP_RTI);
+	arm11_add_IR(arm11, ARM11_RESTART, TAP_IDLE);
 
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -1571,7 +1571,7 @@
 
 	arm11_setup_field(arm11, 32, NULL, &arm11->device_id, &idcode_field);
 
-	arm11_add_dr_scan_vc(1, &idcode_field, TAP_PD);
+	arm11_add_dr_scan_vc(1, &idcode_field, TAP_DRPAUSE);
 
 	/* check DIDR */
 
@@ -1584,7 +1584,7 @@
 	arm11_setup_field(arm11, 32, NULL,	&arm11->didr,		chain0_fields + 0);
 	arm11_setup_field(arm11,  8, NULL,	&arm11->implementor,	chain0_fields + 1);
 
-	arm11_add_dr_scan_vc(asizeof(chain0_fields), chain0_fields, TAP_RTI);
+	arm11_add_dr_scan_vc(asizeof(chain0_fields), chain0_fields, TAP_IDLE);
 
 	if ((retval=jtag_execute_queue())!=ERROR_OK)
 		return retval;
@@ -1832,7 +1832,7 @@
 {
 	jtag_tap_t *tap;
 	target_t * t;
-	
+
 	tap = jtag_TapByString( arg );
 	if( !tap ){
 		return NULL;

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/arm11_dbgtap.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -38,13 +38,13 @@
 
 enum tap_state arm11_move_pi_to_si_via_ci[] =
 {
-    TAP_E2I, TAP_UI, TAP_SDS, TAP_SIS, TAP_CI, TAP_SI
+    TAP_IREXIT2, TAP_IRUPDATE, TAP_DRSELECT, TAP_IRSELECT, TAP_IRCAPTURE, TAP_IRSHIFT
 };
 
 
 int arm11_add_ir_scan_vc(int num_fields, scan_field_t *fields, enum tap_state state)
 {
-    if (cmd_queue_cur_state == TAP_PI)
+    if (cmd_queue_cur_state == TAP_IRPAUSE)
 	jtag_add_pathmove(asizeof(arm11_move_pi_to_si_via_ci), arm11_move_pi_to_si_via_ci);
 
     jtag_add_ir_scan(num_fields, fields, state);
@@ -53,12 +53,12 @@
 
 enum tap_state arm11_move_pd_to_sd_via_cd[] =
 {
-    TAP_E2D, TAP_UD, TAP_SDS, TAP_CD, TAP_SD
+    TAP_DREXIT2, TAP_DRUPDATE, TAP_DRSELECT, TAP_DRCAPTURE, TAP_DRSHIFT
 };
 
 int arm11_add_dr_scan_vc(int num_fields, scan_field_t *fields, enum tap_state state)
 {
-    if (cmd_queue_cur_state == TAP_PD)
+    if (cmd_queue_cur_state == TAP_DRPAUSE)
 	jtag_add_pathmove(asizeof(arm11_move_pd_to_sd_via_cd), arm11_move_pd_to_sd_via_cd);
 
     jtag_add_dr_scan(num_fields, fields, state);
@@ -104,7 +104,7 @@
 	jtag_tap_t *tap;
 	tap = arm11->jtag_info.tap;
 	if(  tap == NULL ){
-    	/* FIX!!!! error is logged, but not propagated back up the call stack... */
+	/* FIX!!!! error is logged, but not propagated back up the call stack... */
 		LOG_ERROR( "tap is null here! This is bad!");
 		return;
     }
@@ -120,7 +120,7 @@
 
     arm11_setup_field(arm11, 5, &instr, NULL, &field);
 
-    arm11_add_ir_scan_vc(1, &field, state == -1 ? TAP_PI : state);
+    arm11_add_ir_scan_vc(1, &field, state == -1 ? TAP_IRPAUSE : state);
 }
 
 /** Verify shifted out data from Scan Chain Register (SCREG)
@@ -135,8 +135,8 @@
 
     if (v != 0x10)
     {
-        LOG_ERROR("'arm11 target' JTAG communication error SCREG SCAN OUT 0x%02x (expected 0x10)", v);
-        return ERROR_FAIL;
+	LOG_ERROR("'arm11 target' JTAG communication error SCREG SCAN OUT 0x%02x (expected 0x10)", v);
+	return ERROR_FAIL;
     }
 
     JTAG_DEBUG("SCREG SCAN OUT 0x%02x", v);
@@ -179,7 +179,7 @@
 
     field.in_handler = arm11_in_handler_SCAN_N;
 
-    arm11_add_dr_scan_vc(1, &field, state == -1 ? TAP_PD : state);
+    arm11_add_dr_scan_vc(1, &field, state == -1 ? TAP_DRPAUSE : state);
 }
 
 /** Write an instruction into the ITR register
@@ -194,7 +194,7 @@
  * \remarks By default this ends with Run-Test/Idle state
  * and causes the instruction to be executed. If
  * a subsequent write to DTR is needed before
- * executing the instruction then TAP_PD should be
+ * executing the instruction then TAP_DRPAUSE should be
  * passed to \p state.
  *
  * \remarks This adds to the JTAG command queue but does \em not execute it.
@@ -208,7 +208,7 @@
     arm11_setup_field(arm11, 32,    &inst,	NULL, itr + 0);
     arm11_setup_field(arm11, 1,	    NULL,	flag, itr + 1);
 
-    arm11_add_dr_scan_vc(asizeof(itr), itr, state == -1 ? TAP_RTI : state);
+    arm11_add_dr_scan_vc(asizeof(itr), itr, state == -1 ? TAP_IDLE : state);
 }
 
 /** Read the Debug Status and Control Register (DSCR)
@@ -231,12 +231,12 @@
 
     arm11_setup_field(arm11, 32, NULL, &dscr, &chain1_field);
 
-    arm11_add_dr_scan_vc(1, &chain1_field, TAP_PD);
+    arm11_add_dr_scan_vc(1, &chain1_field, TAP_DRPAUSE);
 
     jtag_execute_queue();
 
     if (arm11->last_dscr != dscr)
-        JTAG_DEBUG("DSCR  = %08x (OLD %08x)", dscr, arm11->last_dscr);
+	JTAG_DEBUG("DSCR  = %08x (OLD %08x)", dscr, arm11->last_dscr);
 
     arm11->last_dscr = dscr;
 
@@ -262,7 +262,7 @@
 
     arm11_setup_field(arm11, 32, &dscr, NULL, &chain1_field);
 
-    arm11_add_dr_scan_vc(1, &chain1_field, TAP_PD);
+    arm11_add_dr_scan_vc(1, &chain1_field, TAP_DRPAUSE);
 
     jtag_execute_queue();
 
@@ -369,13 +369,13 @@
 
     while (count--)
     {
-	arm11_add_debug_INST(arm11, *opcode++, NULL, TAP_RTI);
+	arm11_add_debug_INST(arm11, *opcode++, NULL, TAP_IDLE);
 
 	while (1)
 	{
 	    u8 flag;
 
-	    arm11_add_debug_INST(arm11, 0, &flag, count ? TAP_RTI : TAP_PD);
+	    arm11_add_debug_INST(arm11, 0, &flag, count ? TAP_IDLE : TAP_DRPAUSE);
 
 	    jtag_execute_queue();
 
@@ -416,7 +416,7 @@
 {
     arm11_add_IR(arm11, ARM11_ITRSEL, -1);
 
-    arm11_add_debug_INST(arm11, opcode, NULL, TAP_PD);
+    arm11_add_debug_INST(arm11, opcode, NULL, TAP_DRPAUSE);
 
     arm11_add_IR(arm11, ARM11_EXTEST, -1);
 
@@ -436,7 +436,7 @@
 	{
 	    Data	    = *data;
 
-	    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_RTI);
+	    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_IDLE);
 	    jtag_execute_queue();
 
 	    JTAG_DEBUG("DTR  Ready %d  nRetry %d", Ready, nRetry);
@@ -452,7 +452,7 @@
     {
 	Data	    = 0;
 
-	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_PD);
+	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 	jtag_execute_queue();
 
 	JTAG_DEBUG("DTR  Data %08x  Ready %d  nRetry %d", Data, Ready, nRetry);
@@ -462,18 +462,18 @@
 
 /** JTAG path for arm11_run_instr_data_to_core_noack
  *
- *  The repeated TAP_RTI's do not cause a repeated execution
+ *  The repeated TAP_IDLE's do not cause a repeated execution
  *  if passed without leaving the state.
  *
  *  Since this is more than 7 bits (adjustable via adding more
- *  TAP_RTI's) it produces an artificial delay in the lower
+ *  TAP_IDLE's) it produces an artificial delay in the lower
  *  layer (FT2232) that is long enough to finish execution on
  *  the core but still shorter than any manually inducible delays.
  *
  */
 enum tap_state arm11_MOVE_PD_RTI_PD_with_delay[] =
 {
-    TAP_E2D, TAP_UD, TAP_RTI, TAP_RTI, TAP_RTI, TAP_SDS, TAP_CD, TAP_SD
+    TAP_DREXIT2, TAP_DRUPDATE, TAP_IDLE, TAP_IDLE, TAP_IDLE, TAP_DRSELECT, TAP_DRCAPTURE, TAP_DRSHIFT
 };
 
 
@@ -497,7 +497,7 @@
 {
     arm11_add_IR(arm11, ARM11_ITRSEL, -1);
 
-    arm11_add_debug_INST(arm11, opcode, NULL, TAP_PD);
+    arm11_add_debug_INST(arm11, opcode, NULL, TAP_DRPAUSE);
 
     arm11_add_IR(arm11, ARM11_EXTEST, -1);
 
@@ -517,13 +517,13 @@
 
 	if (count)
 	{
-	    jtag_add_dr_scan(asizeof(chain5_fields), chain5_fields, TAP_PD);
+	    jtag_add_dr_scan(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 	    jtag_add_pathmove(asizeof(arm11_MOVE_PD_RTI_PD_with_delay),
 		arm11_MOVE_PD_RTI_PD_with_delay);
 	}
 	else
 	{
-	    jtag_add_dr_scan(asizeof(chain5_fields), chain5_fields, TAP_RTI);
+	    jtag_add_dr_scan(asizeof(chain5_fields), chain5_fields, TAP_IDLE);
 	}
     }
 
@@ -532,7 +532,7 @@
     chain5_fields[0].out_value	= 0;
     chain5_fields[1].in_value   = ReadyPos++;
 
-    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_PD);
+    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 
     jtag_execute_queue();
 
@@ -586,7 +586,7 @@
 {
     arm11_add_IR(arm11, ARM11_ITRSEL, -1);
 
-    arm11_add_debug_INST(arm11, opcode, NULL, TAP_RTI);
+    arm11_add_debug_INST(arm11, opcode, NULL, TAP_IDLE);
 
     arm11_add_IR(arm11, ARM11_INTEST, -1);
 
@@ -604,7 +604,7 @@
     {
 	do
 	{
-	    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, count ? TAP_RTI : TAP_PD);
+	    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, count ? TAP_IDLE : TAP_DRPAUSE);
 	    jtag_execute_queue();
 
 	    JTAG_DEBUG("DTR  Data %08x  Ready %d  nRetry %d", Data, Ready, nRetry);
@@ -699,11 +699,11 @@
 	    AddressOut	= 0;
 	}
 
-        do
+	do
 	{
 	    JTAG_DEBUG("SC7 <= Address %02x  Data %08x    nRW %d", AddressOut, DataOut, nRW);
 
-	    arm11_add_dr_scan_vc(asizeof(chain7_fields), chain7_fields, TAP_PD);
+	    arm11_add_dr_scan_vc(asizeof(chain7_fields), chain7_fields, TAP_DRPAUSE);
 	    jtag_execute_queue();
 
 	    JTAG_DEBUG("SC7 => Address %02x  Data %08x  Ready %d", AddressIn, DataIn, Ready);

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/arm720t.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -64,7 +64,7 @@
 	.assert_reset = arm7_9_assert_reset,
 	.deassert_reset = arm7_9_deassert_reset,
 	.soft_reset_halt = arm720t_soft_reset_halt,
-	
+
 	.get_gdb_reg_list = armv4_5_get_gdb_reg_list,
 
 	.read_memory = arm720t_read_memory,
@@ -72,7 +72,7 @@
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
 
 	.add_breakpoint = arm7_9_add_breakpoint,
@@ -96,10 +96,10 @@
 	scan_field_t fields[2];
 	u8 out_buf[4];
 	u8 instruction_buf = instruction;
-	
+
 	buf_set_u32(out_buf, 0, 32, flip_u32(out, 32));
-	
-	jtag_add_end_state(TAP_PD);
+
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -108,7 +108,7 @@
 	{
 		return retval;
 	}
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &instruction_buf;
@@ -135,7 +135,7 @@
 	}
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
-	
+
 	jtag_add_dr_scan(2, fields, -1);
 
 	if (clock)
@@ -171,7 +171,7 @@
 	arm720t_scan_cp15(target, 0x0, NULL, 0, 1);
 	/* "EXECUTE" stage (3), CDATA is read */
 	arm720t_scan_cp15(target, ARMV4_5_NOP, value, 1, 1);
-	
+
 	return ERROR_OK;
 }
 
@@ -197,9 +197,9 @@
 
 	arm720t_read_cp15(target, 0xee120f10, &ttb);
 	jtag_execute_queue();
-	
+
 	ttb &= 0xffffc000;
-	
+
 	return ttb;
 }
 
@@ -210,10 +210,10 @@
 	/* read cp15 control register */
 	arm720t_read_cp15(target, 0xee110f10, &cp15_control);
 	jtag_execute_queue();
-		
+
 	if (mmu)
 		cp15_control &= ~0x1U;
-	
+
 	if (d_u_cache || i_cache)
 		cp15_control &= ~0x4U;
 
@@ -227,13 +227,13 @@
 	/* read cp15 control register */
 	arm720t_read_cp15(target, 0xee110f10, &cp15_control);
 	jtag_execute_queue();
-		
+
 	if (mmu)
 		cp15_control |= 0x1U;
-	
+
 	if (d_u_cache || i_cache)
 		cp15_control |= 0x4U;
-	
+
 	arm720t_write_cp15(target, 0xee010f10, cp15_control);
 }
 
@@ -243,7 +243,7 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
-	
+
 	/* examine cp15 control reg */
 	arm720t_read_cp15(target, 0xee110f10, &arm720t->cp15_control_reg);
 	jtag_execute_queue();
@@ -265,7 +265,7 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
-	
+
 	/* restore i/d fault status and address register */
 	arm720t_write_cp15(target, 0xee050f10, arm720t->fsr_reg);
 	arm720t_write_cp15(target, 0xee060f10, arm720t->far_reg);
@@ -277,35 +277,35 @@
 	arm7_9_common_t *arm7_9;
 	arm7tdmi_common_t *arm7tdmi;
 	arm720t_common_t *arm720t;
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7_9 = armv4_5->arch_info;
 	if (arm7_9->common_magic != ARM7_9_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7tdmi = arm7_9->arch_info;
 	if (arm7tdmi->common_magic != ARM7TDMI_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm720t = arm7tdmi->arch_info;
 	if (arm720t->common_magic != ARM720T_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	*armv4_5_p = armv4_5;
 	*arm7_9_p = arm7_9;
 	*arm7tdmi_p = arm7tdmi;
 	*arm720t_p = arm720t;
-	
+
 	return ERROR_OK;
 }
 
@@ -315,18 +315,18 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
-	
-	char *state[] = 
+
+	char *state[] =
 	{
 		"disabled", "enabled"
 	};
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		LOG_ERROR("BUG: called for a non-ARMv4/5 target");
 		exit(-1);
 	}
-	
+
 	LOG_USER("target halted in %s state due to %s, current mode: %s\n"
 			"cpsr: 0x%8.8x pc: 0x%8.8x\n"
 			"MMU: %s, Cache: %s",
@@ -337,7 +337,7 @@
 			 buf_get_u32(armv4_5->core_cache->reg_list[15].value, 0, 32),
 			 state[arm720t->armv4_5_mmu.mmu_enabled],
 			 state[arm720t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled]);
-	
+
 	return ERROR_OK;
 }
 
@@ -348,23 +348,23 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
-	
+
 	/* disable cache, but leave MMU enabled */
 	if (arm720t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled)
 		arm720t_disable_mmu_caches(target, 0, 1, 0);
-	
+
 	retval = arm7_9_read_memory(target, address, size, count, buffer);
-	
+
 	if (arm720t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled)
 		arm720t_enable_mmu_caches(target, 0, 1, 0);
-	
+
 	return retval;
 }
 
 int arm720t_write_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
 {
 	int retval;
-	
+
 	if ((retval = arm7_9_write_memory(target, address, size, count, buffer)) != ERROR_OK)
 		return retval;
 
@@ -379,12 +379,12 @@
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
-	
+
 	if ((retval = target_halt(target)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	long long then=timeval_ms();
 	int timeout;
 	while (!(timeout=((timeval_ms()-then)>1000)))
@@ -413,22 +413,22 @@
 		LOG_ERROR("Failed to halt CPU after 1 sec");
 		return ERROR_TARGET_TIMEOUT;
 	}
-	
+
 	target->state = TARGET_HALTED;
-	
+
 	/* SVC, ARM state, IRQ and FIQ disabled */
 	buf_set_u32(armv4_5->core_cache->reg_list[ARMV4_5_CPSR].value, 0, 8, 0xd3);
 	armv4_5->core_cache->reg_list[ARMV4_5_CPSR].dirty = 1;
 	armv4_5->core_cache->reg_list[ARMV4_5_CPSR].valid = 1;
-	
+
 	/* start fetching from 0x0 */
 	buf_set_u32(armv4_5->core_cache->reg_list[15].value, 0, 32, 0x0);
 	armv4_5->core_cache->reg_list[15].dirty = 1;
 	armv4_5->core_cache->reg_list[15].valid = 1;
-	
+
 	armv4_5->core_mode = ARMV4_5_MODE_SVC;
 	armv4_5->core_state = ARMV4_5_STATE_ARM;
-	
+
 	arm720t_disable_mmu_caches(target, 1, 1, 1);
 	arm720t->armv4_5_mmu.mmu_enabled = 0;
 	arm720t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled = 0;
@@ -438,21 +438,21 @@
 	{
 		return retval;
 	}
-	
+
 	return ERROR_OK;
 }
 
 int arm720t_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
 	arm7tdmi_init_target(cmd_ctx, target);
-		
+
 	return ERROR_OK;
-	
+
 }
 
 int arm720t_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -460,15 +460,15 @@
 {
 	arm7tdmi_common_t *arm7tdmi = &arm720t->arm7tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm7tdmi->arm7_9_common;
-	
+
 	arm7tdmi_init_arch_info(target, arm7tdmi, tap, variant);
 
 	arm7tdmi->arch_info = arm720t;
 	arm720t->common_magic = ARM720T_COMMON_MAGIC;
-	
+
 	arm7_9->post_debug_entry = arm720t_post_debug_entry;
 	arm7_9->pre_restore_context = arm720t_pre_restore_context;
-	
+
 	arm720t->armv4_5_mmu.armv4_5_cache.ctype = -1;
 	arm720t->armv4_5_mmu.get_ttb = arm720t_get_ttb;
 	arm720t->armv4_5_mmu.read_memory = arm7_9_read_memory;
@@ -477,14 +477,14 @@
 	arm720t->armv4_5_mmu.enable_mmu_caches = arm720t_enable_mmu_caches;
 	arm720t->armv4_5_mmu.has_tiny_pages = 0;
 	arm720t->armv4_5_mmu.mmu_enabled = 0;
-	
+
 	return ERROR_OK;
 }
 
 int arm720t_target_create(struct target_s *target, Jim_Interp *interp)
 {
 	arm720t_common_t *arm720t = calloc(1,sizeof(arm720t_common_t));
-	
+
 	arm720t_init_arch_info(target, arm720t, target->tap, target->variant);
 
 	return ERROR_OK;
@@ -494,10 +494,10 @@
 {
 	int retval;
 	command_t *arm720t_cmd;
-	
-		
+
+
 	retval = arm7tdmi_register_commands(cmd_ctx);
-	
+
 	arm720t_cmd = register_command(cmd_ctx, NULL, "arm720t", NULL, COMMAND_ANY, "arm720t specific commands");
 
 	register_command(cmd_ctx, arm720t_cmd, "cp15", arm720t_handle_cp15_command, COMMAND_EXEC, "display/modify cp15 register <opcode> [value]");
@@ -510,7 +510,7 @@
 	register_command(cmd_ctx, arm720t_cmd, "mww_phys", arm720t_handle_mw_phys_command, COMMAND_EXEC, "write memory word <physical addr> <value>");
 	register_command(cmd_ctx, arm720t_cmd, "mwh_phys", arm720t_handle_mw_phys_command, COMMAND_EXEC, "write memory half-word <physical addr> <value>");
 	register_command(cmd_ctx, arm720t_cmd, "mwb_phys", arm720t_handle_mw_phys_command, COMMAND_EXEC, "write memory byte <physical addr> <value>");
-	
+
 	return ERROR_OK;
 }
 
@@ -529,9 +529,9 @@
 		command_print(cmd_ctx, "current target isn't an ARM720t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
@@ -556,7 +556,7 @@
 			{
 				return retval;
 			}
-			
+
 			command_print(cmd_ctx, "0x%8.8x: 0x%8.8x", opcode, value);
 		}
 		else if (argc == 2)
@@ -575,7 +575,7 @@
 }
 
 int arm720t_handle_virt2phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -588,20 +588,20 @@
 		command_print(cmd_ctx, "current target isn't an ARM720t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-		
+
 	return armv4_5_mmu_handle_virt2phys_command(cmd_ctx, cmd, args, argc, target, &arm720t->armv4_5_mmu);
 }
 
 int arm720t_handle_md_phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -614,20 +614,20 @@
 		command_print(cmd_ctx, "current target isn't an ARM720t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_mmu_handle_md_phys_command(cmd_ctx, cmd, args, argc, target, &arm720t->armv4_5_mmu);
 }
 
 int arm720t_handle_mw_phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -640,14 +640,14 @@
 		command_print(cmd_ctx, "current target isn't an ARM720t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_mmu_handle_mw_phys_command(cmd_ctx, cmd, args, argc, target, &arm720t->armv4_5_mmu);
 }

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/arm7_9_common.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -584,7 +584,7 @@
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
 
 	/* set RESTART instruction */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if (arm7_9->need_bypass_before_restart) {
 		arm7_9->need_bypass_before_restart = 0;
 		arm_jtag_set_instr(jtag_info, 0xf, NULL);
@@ -630,7 +630,7 @@
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
 
 	/* set RESTART instruction */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if (arm7_9->need_bypass_before_restart) {
 		arm7_9->need_bypass_before_restart = 0;
 		arm_jtag_set_instr(jtag_info, 0xf, NULL);
@@ -1492,14 +1492,14 @@
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
 
 	/* set RESTART instruction */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if (arm7_9->need_bypass_before_restart) {
 		arm7_9->need_bypass_before_restart = 0;
 		arm_jtag_set_instr(jtag_info, 0xf, NULL);
 	}
 	arm_jtag_set_instr(jtag_info, 0x4, NULL);
 
-	jtag_add_runtest(1, TAP_RTI);
+	jtag_add_runtest(1, TAP_IDLE);
 	return jtag_execute_queue();
 }
 

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/arm7tdmi.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -55,7 +55,7 @@
 /* target function declarations */
 int arm7tdmi_poll(struct target_s *target);
 int arm7tdmi_halt(target_t *target);
-		
+
 target_type_t arm7tdmi_target =
 {
 	.name = "arm7tdmi",
@@ -74,15 +74,15 @@
 	.soft_reset_halt = arm7_9_soft_reset_halt,
 
 	.get_gdb_reg_list = armv4_5_get_gdb_reg_list,
-	
+
 	.read_memory = arm7_9_read_memory,
 	.write_memory = arm7_9_write_memory,
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
-	
+
 	.add_breakpoint = arm7_9_add_breakpoint,
 	.remove_breakpoint = arm7_9_remove_breakpoint,
 	.add_watchpoint = arm7_9_add_watchpoint,
@@ -101,7 +101,7 @@
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	
+
 	/* only check the debug reason if we don't know it already */
 	if ((target->debug_reason != DBG_REASON_DBGRQ)
 			&& (target->debug_reason != DBG_REASON_SINGLESTEP))
@@ -109,9 +109,9 @@
 		scan_field_t fields[2];
 		u8 databus[4];
 		u8 breakpoint;
-		
-		jtag_add_end_state(TAP_PD);
 
+		jtag_add_end_state(TAP_DRPAUSE);
+
 		fields[0].tap = arm7_9->jtag_info.tap;
 		fields[0].num_bits = 1;
 		fields[0].out_value = NULL;
@@ -121,7 +121,7 @@
 		fields[0].in_check_mask = NULL;
 		fields[0].in_handler = NULL;
 		fields[0].in_handler_priv = NULL;
-		
+
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 32;
 		fields[1].out_value = NULL;
@@ -131,30 +131,30 @@
 		fields[1].in_check_mask = NULL;
 		fields[1].in_handler = NULL;
 		fields[1].in_handler_priv = NULL;
-		
+
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
 			return retval;
 		}
 		arm_jtag_set_instr(&arm7_9->jtag_info, arm7_9->jtag_info.intest_instr, NULL);
 
-		jtag_add_dr_scan(2, fields, TAP_PD);
+		jtag_add_dr_scan(2, fields, TAP_DRPAUSE);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		fields[0].in_value = NULL;
 		fields[0].out_value = &breakpoint;
 		fields[1].in_value = NULL;
 		fields[1].out_value = databus;
-		
-		jtag_add_dr_scan(2, fields, TAP_PD);
 
+		jtag_add_dr_scan(2, fields, TAP_DRPAUSE);
+
 		if (breakpoint & 1)
-			target->debug_reason = DBG_REASON_WATCHPOINT; 
+			target->debug_reason = DBG_REASON_WATCHPOINT;
 		else
-			target->debug_reason = DBG_REASON_BREAKPOINT; 
+			target->debug_reason = DBG_REASON_BREAKPOINT;
 	}
 
 	return ERROR_OK;
@@ -164,13 +164,13 @@
 static __inline int arm7tdmi_clock_out_inner(arm_jtag_t *jtag_info, u32 out, int breakpoint)
 {
 	u32 values[2]={breakpoint, flip_u32(out, 32)};
-			
+
 	jtag_add_dr_out(jtag_info->tap,
 			2,
 			arm7tdmi_num_bits,
 			values,
 			-1);
-			
+
 	jtag_add_runtest(0, -1);
 
 	return ERROR_OK;
@@ -179,10 +179,10 @@
 /* put an instruction in the ARM7TDMI pipeline or write the data bus, and optionally read data */
 static __inline int arm7tdmi_clock_out(arm_jtag_t *jtag_info, u32 out, u32 *deprecated, int breakpoint)
 {
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	arm_jtag_scann(jtag_info, 0x1);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-	
+
 	return arm7tdmi_clock_out_inner(jtag_info, out, breakpoint);
 }
 
@@ -192,13 +192,13 @@
 	int retval = ERROR_OK;
 	scan_field_t fields[2];
 
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-	
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
@@ -208,7 +208,7 @@
 	fields[0].in_check_mask = NULL;
 	fields[0].in_handler = NULL;
 	fields[0].in_handler_priv = NULL;
-		
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
@@ -222,14 +222,14 @@
 	jtag_add_dr_scan(2, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 {
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-			
+
 		if (in)
 		{
 			LOG_DEBUG("in: 0x%8.8x", *in);
@@ -247,19 +247,19 @@
 /* clock the target, and read the databus
  * the *in pointer points to a buffer where elements of 'size' bytes
  * are stored in big (be==1) or little (be==0) endianness
- */ 
+ */
 int arm7tdmi_clock_data_in_endianness(arm_jtag_t *jtag_info, void *in, int size, int be)
 {
 	int retval = ERROR_OK;
 	scan_field_t fields[2];
 
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-	
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
@@ -269,7 +269,7 @@
 	fields[0].in_check_mask = NULL;
 	fields[0].in_handler = NULL;
 	fields[0].in_handler_priv = NULL;
-		
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
@@ -294,14 +294,14 @@
 	jtag_add_dr_scan(2, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 {
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-			
+
 		if (in)
 		{
 			LOG_DEBUG("in: 0x%8.8x", *(u32*)in);
@@ -322,10 +322,10 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
-	/* save r0 before using it and put system in ARM state 
+
+	/* save r0 before using it and put system in ARM state
 	 * to allow common handling of ARM and THUMB debugging */
-	
+
 	/* fetch STR r0, [r0] */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_STR(0, 0), NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
@@ -333,7 +333,7 @@
 	/* nothing fetched, STR r0, [r0] in Execute (2) */
 	arm7tdmi_clock_data_in(jtag_info, r0);
 
-	/* MOV r0, r15 fetched, STR in Decode */	
+	/* MOV r0, r15 fetched, STR in Decode */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_MOV(0, 15), NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_STR(0, 0), NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
@@ -349,22 +349,22 @@
 	arm7tdmi_clock_out(jtag_info, 0x0, NULL, 0);
 	/* nothing fetched, data from previous cycle is written to register */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
-	
+
 	/* fetch BX */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_BX(0), NULL, 0);
 	/* NOP fetched, BX in Decode, MOV in Execute */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
 	/* NOP fetched, BX in Execute (1) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
-	
+
 	jtag_execute_queue();
-	
+
 	/* fix program counter:
 	 * MOV r0, r15 was the 4th instruction (+6)
 	 * reading PC in Thumb state gives address of instruction + 4
 	 */
 	*pc -= 0xa;
-	
+
 }
 
 void arm7tdmi_read_core_regs(target_t *target, u32 mask, u32* core_regs[16])
@@ -374,7 +374,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* STMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -405,7 +405,7 @@
 	u32 *buf_u32 = buffer;
 	u16 *buf_u16 = buffer;
 	u8 *buf_u8 = buffer;
-		
+
 	/* STMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -435,7 +435,7 @@
 			}
 		}
 	}
-	
+
 }
 
 void arm7tdmi_read_xpsr(target_t *target, u32 *xpsr, int spsr)
@@ -444,10 +444,10 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* MRS r0, cpsr */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_MRS(0, spsr & 1), NULL, 0);
-	
+
 	/* STR r0, [r15] */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STR(0, 15), NULL, 0);
 	/* fetch NOP, STR in DECODE stage */
@@ -465,7 +465,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr: %8.8x, spsr: %i", xpsr, spsr);
 
 	/* MSR1 fetched */
@@ -496,9 +496,9 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr_im: %2.2x, rot: %i, spsr: %i", xpsr_im, rot, spsr);
-	
+
 	/* MSR fetched */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_MSR_IM(xpsr_im, rot, 1, spsr), NULL, 0);
 	/* NOP fetched, MSR in DECODE */
@@ -507,7 +507,7 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	/* nothing fetched, MSR in EXECUTE (2) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
-	
+
 }
 
 void arm7tdmi_write_core_regs(target_t *target, u32 mask, u32 core_regs[16])
@@ -517,7 +517,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* LDMIA r0-15, [r0] at debug speed
 	* register values will start to appear on 4th DCLK
 	*/
@@ -535,7 +535,7 @@
 			arm7tdmi_clock_out_inner(jtag_info, core_regs[i], 0);
 	}
 	arm7tdmi_clock_out_inner(jtag_info, ARMV4_5_NOP, 0);
-	
+
 }
 
 void arm7tdmi_load_word_regs(target_t *target, u32 mask)
@@ -558,7 +558,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/* put system-speed load half-word into the pipeline */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
@@ -591,7 +591,7 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STMIA(0, mask, 0, 1), NULL, 0);
-	
+
 }
 
 void arm7tdmi_store_hword_reg(target_t *target, int num)
@@ -628,7 +628,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/* LDMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -655,7 +655,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out_inner(jtag_info, ARMV4_5_B(0xfffffa, 0), 0);
 
@@ -664,7 +664,7 @@
 void arm7tdmi_branch_resume_thumb(target_t *target)
 {
 	LOG_DEBUG("-");
-	
+
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
@@ -687,15 +687,15 @@
 
 	/* Branch and eXchange */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_BX(0), NULL, 0);
-	
+
 	embeddedice_read_reg(dbg_stat);
-	
+
 	/* fetch NOP, BX in DECODE stage */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
-	
+
 	/* target is now in Thumb state */
 	embeddedice_read_reg(dbg_stat);
-	
+
 	/* fetch NOP, BX in EXECUTE stage (1st cycle) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 
@@ -712,17 +712,17 @@
 	arm7tdmi_clock_out(jtag_info, buf_get_u32(armv4_5->core_cache->reg_list[0].value, 0, 32), NULL, 0);
 	/* nothing fetched, LDR in EXECUTE stage (3rd cycle) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
-	
+
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
 
 	embeddedice_read_reg(dbg_stat);
-	
+
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_B(0x7f8), NULL, 0);
 
 }
-		
+
 void arm7tdmi_build_reg_cache(target_t *target)
 {
 	reg_cache_t **cache_p = register_get_last_cache_p(&target->reg_cache);
@@ -745,10 +745,10 @@
 		reg_cache_t *t=embeddedice_build_reg_cache(target, arm7_9);
 		if (t==NULL)
 			return ERROR_FAIL;
-		
+
 		(*cache_p) = t;
 		arm7_9->eice_cache = (*cache_p);
-		
+
 		if (arm7_9->etm_ctx)
 		{
 			arm_jtag_t *jtag_info = &arm7_9->jtag_info;
@@ -771,16 +771,16 @@
 
 int arm7tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
-	
+
 	arm7tdmi_build_reg_cache(target);
-	
+
 	return ERROR_OK;
-	
+
 }
 
 int arm7tdmi_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -788,56 +788,56 @@
 {
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
-	
+
 	arm7_9 = &arm7tdmi->arm7_9_common;
 	armv4_5 = &arm7_9->armv4_5_common;
-	
+
 	/* prepare JTAG information for the new target */
 	arm7_9->jtag_info.tap = tap;
 	arm7_9->jtag_info.scann_size = 4;
-	
+
 	/* register arch-specific functions */
 	arm7_9->examine_debug_reason = arm7tdmi_examine_debug_reason;
 	arm7_9->change_to_arm = arm7tdmi_change_to_arm;
 	arm7_9->read_core_regs = arm7tdmi_read_core_regs;
 	arm7_9->read_core_regs_target_buffer = arm7tdmi_read_core_regs_target_buffer;
 	arm7_9->read_xpsr = arm7tdmi_read_xpsr;
-	
+
 	arm7_9->write_xpsr = arm7tdmi_write_xpsr;
 	arm7_9->write_xpsr_im8 = arm7tdmi_write_xpsr_im8;
 	arm7_9->write_core_regs = arm7tdmi_write_core_regs;
-	
+
 	arm7_9->load_word_regs = arm7tdmi_load_word_regs;
 	arm7_9->load_hword_reg = arm7tdmi_load_hword_reg;
 	arm7_9->load_byte_reg = arm7tdmi_load_byte_reg;
-	
+
 	arm7_9->store_word_regs = arm7tdmi_store_word_regs;
 	arm7_9->store_hword_reg = arm7tdmi_store_hword_reg;
 	arm7_9->store_byte_reg = arm7tdmi_store_byte_reg;
-	
+
 	arm7_9->write_pc = arm7tdmi_write_pc;
 	arm7_9->branch_resume = arm7tdmi_branch_resume;
 	arm7_9->branch_resume_thumb = arm7tdmi_branch_resume_thumb;
-	
+
 	arm7_9->enable_single_step = arm7_9_enable_eice_step;
 	arm7_9->disable_single_step = arm7_9_disable_eice_step;
-		
+
 	arm7_9->pre_debug_entry = NULL;
 	arm7_9->post_debug_entry = NULL;
-	
+
 	arm7_9->pre_restore_context = NULL;
 	arm7_9->post_restore_context = NULL;
-	
+
 	/* initialize arch-specific breakpoint handling */
 	arm7_9->arm_bkpt = 0xdeeedeee;
 	arm7_9->thumb_bkpt = 0xdeee;
-	
+
 	arm7_9->dbgreq_adjust_pc = 2;
 	arm7_9->arch_info = arm7tdmi;
 
 	arm7tdmi->arch_info = NULL;
 	arm7tdmi->common_magic = ARM7TDMI_COMMON_MAGIC;
-	
+
 	if (variant)
 	{
 		arm7tdmi->variant = strdup(variant);
@@ -846,7 +846,7 @@
 	{
 		arm7tdmi->variant = strdup("");
 	}
-	
+
 	arm7_9_init_arch_info(target, arm7_9);
 
 	return ERROR_OK;
@@ -857,11 +857,11 @@
 int arm7tdmi_target_create( struct target_s *target, Jim_Interp *interp )
 {
 	arm7tdmi_common_t *arm7tdmi;
-	
+
 	arm7tdmi = calloc(1,sizeof(arm7tdmi_common_t));
-	
+
 	arm7tdmi_init_arch_info(target, arm7tdmi, target->tap, target->variant);
-	
+
 	return ERROR_OK;
 }
 
@@ -869,9 +869,9 @@
 int arm7tdmi_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
-	
+
 	retval = arm7_9_register_commands(cmd_ctx);
-	
+
 	return retval;
 
 }

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/arm920t.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -73,7 +73,7 @@
 	.assert_reset = arm7_9_assert_reset,
 	.deassert_reset = arm7_9_deassert_reset,
 	.soft_reset_halt = arm920t_soft_reset_halt,
-	
+
 	.get_gdb_reg_list = armv4_5_get_gdb_reg_list,
 
 	.read_memory = arm920t_read_memory,
@@ -81,7 +81,7 @@
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
 
 	.add_breakpoint = arm7_9_add_breakpoint,
@@ -105,8 +105,8 @@
 	u8 access_type_buf = 1;
 	u8 reg_addr_buf = reg_addr & 0x3f;
 	u8 nr_w_buf = 0;
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0xf);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 
@@ -149,7 +149,7 @@
 	fields[3].in_check_mask = NULL;
 	fields[3].in_handler = NULL;
 	fields[3].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(4, fields, -1);
 
 	fields[1].in_handler_priv = value;
@@ -175,10 +175,10 @@
 	u8 reg_addr_buf = reg_addr & 0x3f;
 	u8 nr_w_buf = 1;
 	u8 value_buf[4];
-	
+
 	buf_set_u32(value_buf, 0, 32, value);
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0xf);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 
@@ -221,7 +221,7 @@
 	fields[3].in_check_mask = NULL;
 	fields[3].in_handler = NULL;
 	fields[3].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(4, fields, -1);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
@@ -242,11 +242,11 @@
 	u8 reg_addr_buf = 0x0;
 	u8 nr_w_buf = 0;
 	u8 cp15_opcode_buf[4];
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0xf);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-	
+
 	buf_set_u32(cp15_opcode_buf, 0, 32, cp15_opcode);
 
 	fields[0].tap = jtag_info->tap;
@@ -296,13 +296,13 @@
 	retval = arm7_9_execute_sys_speed(target);
 	if (retval != ERROR_OK)
 		return retval;
-	
+
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		LOG_ERROR("failed executing JTAG queue, exiting");
 		return retval;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -315,18 +315,18 @@
 
 	/* load address into R1 */
 	regs[1] = address;
-	arm9tdmi_write_core_regs(target, 0x2, regs); 
-	
-	/* read-modify-write CP15 test state register 
+	arm9tdmi_write_core_regs(target, 0x2, regs);
+
+	/* read-modify-write CP15 test state register
 	* to enable interpreted access mode */
-	arm920t_read_cp15_physical(target, 0x1e, &cp15c15);	
+	arm920t_read_cp15_physical(target, 0x1e, &cp15c15);
 	jtag_execute_queue();
 	cp15c15 |= 1;	/* set interpret mode */
 	arm920t_write_cp15_physical(target, 0x1e, cp15c15);
 
 	/* execute CP15 instruction and ARM load (reading from coprocessor) */
 	arm920t_execute_cp15(target, cp15_opcode, ARMV4_5_LDR(0, 1));
-	
+
 	/* disable interpreted access mode */
 	cp15c15 &= ~1U;	/* clear interpret mode */
 	arm920t_write_cp15_physical(target, 0x1e, cp15c15);
@@ -335,7 +335,7 @@
 	regs_p[0] = value;
 	arm9tdmi_read_core_regs(target, 0x1, regs_p);
 	jtag_execute_queue();
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	LOG_DEBUG("cp15_opcode: %8.8x, address: %8.8x, value: %8.8x", cp15_opcode, address, *value);
 #endif
@@ -360,7 +360,7 @@
 	regs[1] = address;
 	arm9tdmi_write_core_regs(target, 0x3, regs);
 
-	/* read-modify-write CP15 test state register 
+	/* read-modify-write CP15 test state register
 	* to enable interpreted access mode */
 	arm920t_read_cp15_physical(target, 0x1e, &cp15c15);
 	jtag_execute_queue();
@@ -380,10 +380,10 @@
 
 	if (armv4_5_mode_to_number(armv4_5->core_mode)==-1)
 		return ERROR_FAIL;
-	
+
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 0).dirty = 1;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 1).dirty = 1;
-	
+
 	return ERROR_OK;
 }
 
@@ -405,13 +405,13 @@
 	/* read cp15 control register */
 	arm920t_read_cp15_physical(target, 0x2, &cp15_control);
 	jtag_execute_queue();
-		
+
 	if (mmu)
 		cp15_control &= ~0x1U;
-	
+
 	if (d_u_cache)
 		cp15_control &= ~0x4U;
-	
+
 	if (i_cache)
 		cp15_control &= ~0x1000U;
 
@@ -425,16 +425,16 @@
 	/* read cp15 control register */
 	arm920t_read_cp15_physical(target, 0x2, &cp15_control);
 	jtag_execute_queue();
-		
+
 	if (mmu)
 		cp15_control |= 0x1U;
-	
+
 	if (d_u_cache)
 		cp15_control |= 0x4U;
-	
+
 	if (i_cache)
 		cp15_control |= 0x1000U;
-	
+
 	arm920t_write_cp15_physical(target, 0x2, cp15_control);
 }
 
@@ -445,7 +445,7 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
-	
+
 	/* examine cp15 control reg */
 	arm920t_read_cp15_physical(target, 0x2, &arm920t->cp15_control_reg);
 	jtag_execute_queue();
@@ -469,13 +469,13 @@
 	arm920t_read_cp15_interpreted(target, 0xee150f30, 0x0, &arm920t->i_fsr);
 	arm920t_read_cp15_interpreted(target, 0xee160f10, 0x0, &arm920t->d_far);
 	arm920t_read_cp15_interpreted(target, 0xee160f30, 0x0, &arm920t->i_far);
-	
+
 	LOG_DEBUG("D FSR: 0x%8.8x, D FAR: 0x%8.8x, I FSR: 0x%8.8x, I FAR: 0x%8.8x",
-		arm920t->d_fsr, arm920t->d_far, arm920t->i_fsr, arm920t->i_far);  
+		arm920t->d_fsr, arm920t->d_far, arm920t->i_fsr, arm920t->i_far);
 
 	if (arm920t->preserve_cache)
 	{
-		/* read-modify-write CP15 test state register 
+		/* read-modify-write CP15 test state register
 		 * to disable I/D-cache linefills */
 		arm920t_read_cp15_physical(target, 0x1e, &cp15c15);
 		jtag_execute_queue();
@@ -491,14 +491,14 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
-	
+
 	/* restore i/d fault status and address register */
 	arm920t_write_cp15_interpreted(target, 0xee050f10, arm920t->d_fsr, 0x0);
 	arm920t_write_cp15_interpreted(target, 0xee050f30, arm920t->i_fsr, 0x0);
 	arm920t_write_cp15_interpreted(target, 0xee060f10, arm920t->d_far, 0x0);
 	arm920t_write_cp15_interpreted(target, 0xee060f30, arm920t->i_far, 0x0);
-	
-	/* read-modify-write CP15 test state register 
+
+	/* read-modify-write CP15 test state register
 	* to reenable I/D-cache linefills */
 	if (arm920t->preserve_cache)
 	{
@@ -515,35 +515,35 @@
 	arm7_9_common_t *arm7_9;
 	arm9tdmi_common_t *arm9tdmi;
 	arm920t_common_t *arm920t;
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7_9 = armv4_5->arch_info;
 	if (arm7_9->common_magic != ARM7_9_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm9tdmi = arm7_9->arch_info;
 	if (arm9tdmi->common_magic != ARM9TDMI_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm920t = arm9tdmi->arch_info;
 	if (arm920t->common_magic != ARM920T_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	*armv4_5_p = armv4_5;
 	*arm7_9_p = arm7_9;
 	*arm9tdmi_p = arm9tdmi;
 	*arm920t_p = arm920t;
-	
+
 	return ERROR_OK;
 }
 
@@ -553,18 +553,18 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
-	
-	char *state[] = 
+
+	char *state[] =
 	{
 		"disabled", "enabled"
 	};
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		LOG_ERROR("BUG: called for a non-ARMv4/5 target");
 		exit(-1);
 	}
-	
+
 	LOG_USER(	"target halted in %s state due to %s, current mode: %s\n"
 			"cpsr: 0x%8.8x pc: 0x%8.8x\n"
 			"MMU: %s, D-Cache: %s, I-Cache: %s",
@@ -574,18 +574,18 @@
 			 buf_get_u32(armv4_5->core_cache->reg_list[ARMV4_5_CPSR].value, 0, 32),
 			 buf_get_u32(armv4_5->core_cache->reg_list[15].value, 0, 32),
 			 state[arm920t->armv4_5_mmu.mmu_enabled],
-			 state[arm920t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled], 
+			 state[arm920t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled],
 			 state[arm920t->armv4_5_mmu.armv4_5_cache.i_cache_enabled]);
-	
+
 	return ERROR_OK;
 }
 
 int arm920t_read_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
 {
 	int retval;
-	
+
 	retval = arm7_9_read_memory(target, address, size, count, buffer);
-	
+
 	return retval;
 }
 
@@ -596,7 +596,7 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
-	
+
 	if ((retval = arm7_9_write_memory(target, address, size, count, buffer)) != ERROR_OK)
 		return retval;
 
@@ -615,7 +615,7 @@
 			if (cb == 3)
 				armv4_5_mmu_write_physical(target, &arm920t->armv4_5_mmu, pa, size, count, buffer);
 		}
-		
+
 		if (arm920t->armv4_5_mmu.armv4_5_cache.i_cache_enabled)
 		{
 			LOG_DEBUG("I-Cache enabled, invalidating affected I-Cache line");
@@ -634,12 +634,12 @@
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
-	
+
 	if((retval = target_halt(target)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	long long then=timeval_ms();
 	int timeout;
 	while (!(timeout=((timeval_ms()-then)>1000)))
@@ -669,22 +669,22 @@
 		LOG_ERROR("Failed to halt CPU after 1 sec");
 		return ERROR_TARGET_TIMEOUT;
 	}
-	
+
 	target->state = TARGET_HALTED;
-	
+
 	/* SVC, ARM state, IRQ and FIQ disabled */
 	buf_set_u32(armv4_5->core_cache->reg_list[ARMV4_5_CPSR].value, 0, 8, 0xd3);
 	armv4_5->core_cache->reg_list[ARMV4_5_CPSR].dirty = 1;
 	armv4_5->core_cache->reg_list[ARMV4_5_CPSR].valid = 1;
-	
+
 	/* start fetching from 0x0 */
 	buf_set_u32(armv4_5->core_cache->reg_list[15].value, 0, 32, 0x0);
 	armv4_5->core_cache->reg_list[15].dirty = 1;
 	armv4_5->core_cache->reg_list[15].valid = 1;
-	
+
 	armv4_5->core_mode = ARMV4_5_MODE_SVC;
 	armv4_5->core_state = ARMV4_5_STATE_ARM;
-	
+
 	arm920t_disable_mmu_caches(target, 1, 1, 1);
 	arm920t->armv4_5_mmu.mmu_enabled = 0;
 	arm920t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled = 0;
@@ -694,21 +694,21 @@
 	{
 		return retval;
 	}
-	
+
 	return ERROR_OK;
 }
 
 int arm920t_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
 	arm9tdmi_init_target(cmd_ctx, target);
-		
+
 	return ERROR_OK;
-	
+
 }
 
 int arm920t_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -716,17 +716,17 @@
 {
 	arm9tdmi_common_t *arm9tdmi = &arm920t->arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm9tdmi->arm7_9_common;
-	
+
 	/* initialize arm9tdmi specific info (including arm7_9 and armv4_5)
 	 */
 	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
 
 	arm9tdmi->arch_info = arm920t;
 	arm920t->common_magic = ARM920T_COMMON_MAGIC;
-	
+
 	arm7_9->post_debug_entry = arm920t_post_debug_entry;
 	arm7_9->pre_restore_context = arm920t_pre_restore_context;
-	
+
 	arm920t->armv4_5_mmu.armv4_5_cache.ctype = -1;
 	arm920t->armv4_5_mmu.get_ttb = arm920t_get_ttb;
 	arm920t->armv4_5_mmu.read_memory = arm7_9_read_memory;
@@ -735,23 +735,23 @@
 	arm920t->armv4_5_mmu.enable_mmu_caches = arm920t_enable_mmu_caches;
 	arm920t->armv4_5_mmu.has_tiny_pages = 1;
 	arm920t->armv4_5_mmu.mmu_enabled = 0;
-	
+
 	/* disabling linefills leads to lockups, so keep them enabled for now
 	 * this doesn't affect correctness, but might affect timing issues, if
 	 * important data is evicted from the cache during the debug session
 	 * */
 	arm920t->preserve_cache = 0;
-	
+
 	/* override hw single-step capability from ARM9TDMI */
 	arm7_9->has_single_step = 1;
-	
+
 	return ERROR_OK;
 }
 
 int arm920t_target_create(struct target_s *target, Jim_Interp *interp)
 {
 	arm920t_common_t *arm920t = calloc(1,sizeof(arm920t_common_t));
-	
+
 	arm920t_init_arch_info(target, arm920t, target->tap, target->variant);
 
 	return ERROR_OK;
@@ -761,10 +761,10 @@
 {
 	int retval;
 	command_t *arm920t_cmd;
-	
-		
+
+
 	retval = arm9tdmi_register_commands(cmd_ctx);
-	
+
 	arm920t_cmd = register_command(cmd_ctx, NULL, "arm920t", NULL, COMMAND_ANY, "arm920t specific commands");
 
 	register_command(cmd_ctx, arm920t_cmd, "cp15", arm920t_handle_cp15_command, COMMAND_EXEC, "display/modify cp15 register <num> [value]");
@@ -804,30 +804,30 @@
 	FILE *output;
 	arm920t_cache_line_t d_cache[8][64], i_cache[8][64];
 	int segment, index;
-	
+
 	if (argc != 1)
 	{
 		command_print(cmd_ctx, "usage: arm920t read_cache <filename>");
 		return ERROR_OK;
 	}
-	
+
 	if ((output = fopen(args[0], "w")) == NULL)
 	{
 		LOG_DEBUG("error opening cache content file");
 		return ERROR_OK;
 	}
-	
+
 	for (i = 0; i < 16; i++)
 		regs_p[i] = &regs[i];
-		
+
 	if (arm920t_get_arch_pointers(target, &armv4_5, &arm7_9, &arm9tdmi, &arm920t) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	/* disable MMU and Caches */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), &cp15_ctrl);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -838,29 +838,29 @@
 	cp15_ctrl &= ~(ARMV4_5_MMU_ENABLED | ARMV4_5_D_U_CACHE_ENABLED | ARMV4_5_I_CACHE_ENABLED);
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl);
 
-	/* read CP15 test state register */ 
+	/* read CP15 test state register */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), &cp15c15);
 	jtag_execute_queue();
-	
+
 	/* read DCache content */
 	fprintf(output, "DCache:\n");
-	
-	/* go through segments 0 to nsets (8 on ARM920T, 4 on ARM922T) */ 
+
+	/* go through segments 0 to nsets (8 on ARM920T, 4 on ARM922T) */
 	for (segment = 0; segment < arm920t->armv4_5_mmu.armv4_5_cache.d_u_size.nsets; segment++)
 	{
 		fprintf(output, "\nsegment: %i\n----------", segment);
-		
+
 		/* Ra: r0 = SBZ(31:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment << 5);
 		arm9tdmi_write_core_regs(target, 0x1, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* D CAM Read, loads current victim into C15.C.D.Ind */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,6,2), ARMV4_5_LDR(1, 0));
-	
+
 		/* read current victim */
 		arm920t_read_cp15_physical(target, 0x3d, &C15_C_D_Ind);
 
@@ -877,16 +877,16 @@
 			/* set interpret mode */
 			cp15c15 |= 0x1;
 			arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 			/* Write DCache victim */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,9,1,0), ARMV4_5_LDR(1, 0));
-	
+
 			/* Read D RAM */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,10,2), ARMV4_5_LDMIA(0, 0x1fe, 0, 0));
-			
+
 			/* Read D CAM */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,6,2), ARMV4_5_LDR(9, 0));
-			
+
 			/* clear interpret mode */
 			cp15c15 &= ~0x1;
 			arm920t_write_cp15_physical(target, 0x1e, cp15c15);
@@ -899,19 +899,19 @@
 			}
 
 			d_cache[segment][index].cam = regs[9];
-			
+
 			/* mask LFSR[6] */
 			regs[9] &= 0xfffffffe;
 			fprintf(output, "\nsegment: %i, index: %i, CAM: 0x%8.8x, content (%s):\n", segment, index, regs[9], (regs[9] & 0x10) ? "valid" : "invalid");
-			
+
 			for (i = 1; i < 9; i++)
 			{
 				 d_cache[segment][index].data[i] = regs[i];
 				 fprintf(output, "%i: 0x%8.8x\n", i-1, regs[i]);
 			}
-	
+
 		}
-		
+
 		/* Ra: r0 = index(31:26):SBZ(25:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment << 5) | (C15_C_D_Ind << 26);
 		arm9tdmi_write_core_regs(target, 0x1, regs);
@@ -919,10 +919,10 @@
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 		/* Write DCache victim */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,9,1,0), ARMV4_5_LDR(1, 0));
-	
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
@@ -930,23 +930,23 @@
 
 	/* read ICache content */
 	fprintf(output, "ICache:\n");
-	
-	/* go through segments 0 to nsets (8 on ARM920T, 4 on ARM922T) */ 
+
+	/* go through segments 0 to nsets (8 on ARM920T, 4 on ARM922T) */
 	for (segment = 0; segment < arm920t->armv4_5_mmu.armv4_5_cache.d_u_size.nsets; segment++)
 	{
 		fprintf(output, "segment: %i\n----------", segment);
-		
+
 		/* Ra: r0 = SBZ(31:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment << 5);
 		arm9tdmi_write_core_regs(target, 0x1, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* I CAM Read, loads current victim into C15.C.I.Ind */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,5,2), ARMV4_5_LDR(1, 0));
-	
+
 		/* read current victim */
 		arm920t_read_cp15_physical(target, 0x3b, &C15_C_I_Ind);
 
@@ -963,16 +963,16 @@
 			/* set interpret mode */
 			cp15c15 |= 0x1;
 			arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 			/* Write ICache victim */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,9,1,1), ARMV4_5_LDR(1, 0));
-	
+
 			/* Read I RAM */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,9,2), ARMV4_5_LDMIA(0, 0x1fe, 0, 0));
-			
+
 			/* Read I CAM */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,5,2), ARMV4_5_LDR(9, 0));
-			
+
 			/* clear interpret mode */
 			cp15c15 &= ~0x1;
 			arm920t_write_cp15_physical(target, 0x1e, cp15c15);
@@ -985,20 +985,20 @@
 			}
 
 			i_cache[segment][index].cam = regs[9];
-			
+
 			/* mask LFSR[6] */
 			regs[9] &= 0xfffffffe;
 			fprintf(output, "\nsegment: %i, index: %i, CAM: 0x%8.8x, content (%s):\n", segment, index, regs[9], (regs[9] & 0x10) ? "valid" : "invalid");
-			
+
 			for (i = 1; i < 9; i++)
 			{
 				 i_cache[segment][index].data[i] = regs[i];
 				 fprintf(output, "%i: 0x%8.8x\n", i-1, regs[i]);
 			}
-	
+
 		}
-		
-	
+
+
 		/* Ra: r0 = index(31:26):SBZ(25:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment << 5) | (C15_C_D_Ind << 26);
 		arm9tdmi_write_core_regs(target, 0x1, regs);
@@ -1006,22 +1006,22 @@
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 		/* Write ICache victim */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,9,1,1), ARMV4_5_LDR(1, 0));
-	
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
 	}
-	
+
 	/* restore CP15 MMU and Cache settings */
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl_saved);
-	
+
 	command_print(cmd_ctx, "cache content successfully output to %s", args[0]);
-	
+
 	fclose(output);
-	
+
 	if (armv4_5_mode_to_number(armv4_5->core_mode)==-1)
 		return ERROR_FAIL;
 
@@ -1036,7 +1036,7 @@
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 7).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 7).valid;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 8).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 8).valid;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 9).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 9).valid;
-	
+
 	return ERROR_OK;
 }
 
@@ -1058,30 +1058,30 @@
 	u32 Dlockdown, Ilockdown;
 	arm920t_tlb_entry_t d_tlb[64], i_tlb[64];
 	int victim;
-	
+
 	if (argc != 1)
 	{
 		command_print(cmd_ctx, "usage: arm920t read_mmu <filename>");
 		return ERROR_OK;
 	}
-	
+
 	if ((output = fopen(args[0], "w")) == NULL)
 	{
 		LOG_DEBUG("error opening mmu content file");
 		return ERROR_OK;
 	}
-	
+
 	for (i = 0; i < 16; i++)
 		regs_p[i] = &regs[i];
-		
+
 	if (arm920t_get_arch_pointers(target, &armv4_5, &arm7_9, &arm9tdmi, &arm920t) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	/* disable MMU and Caches */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), &cp15_ctrl);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1092,27 +1092,27 @@
 	cp15_ctrl &= ~(ARMV4_5_MMU_ENABLED | ARMV4_5_D_U_CACHE_ENABLED | ARMV4_5_I_CACHE_ENABLED);
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl);
 
-	/* read CP15 test state register */ 
+	/* read CP15 test state register */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), &cp15c15);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return retval;
 	}
 
-	/* prepare reading D TLB content 
+	/* prepare reading D TLB content
 	 * */
-	
+
 	/* set interpret mode */
 	cp15c15 |= 0x1;
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 	/* Read D TLB lockdown */
 	arm920t_execute_cp15(target, ARMV4_5_MRC(15,0,0,10,0,0), ARMV4_5_LDR(1, 0));
-	
+
 	/* clear interpret mode */
 	cp15c15 &= ~0x1;
 	arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-	
+
 	/* read D TLB lockdown stored to r1 */
 	arm9tdmi_read_core_regs(target, 0x2, regs_p);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1120,63 +1120,63 @@
 		return retval;
 	}
 	Dlockdown = regs[1];
-	
+
 	for (victim = 0; victim < 64; victim += 8)
 	{
-		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0] 
+		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0]
 		 * base remains unchanged, victim goes through entries 0 to 63 */
 		regs[1] = (Dlockdown & 0xfc000000) | (victim << 20);
 		arm9tdmi_write_core_regs(target, 0x2, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* Write D TLB lockdown */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,0), ARMV4_5_STR(1, 0));
-	
+
 		/* Read D TLB CAM */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,6,4), ARMV4_5_LDMIA(0, 0x3fc, 0, 0));
-		
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-		
+
 		/* read D TLB CAM content stored to r2-r9 */
 		arm9tdmi_read_core_regs(target, 0x3fc, regs_p);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		for (i = 0; i < 8; i++)
-			d_tlb[victim + i].cam = regs[i + 2]; 
+			d_tlb[victim + i].cam = regs[i + 2];
 	}
 
 	for (victim = 0; victim < 64; victim++)
 	{
-		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0] 
+		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0]
 		 * base remains unchanged, victim goes through entries 0 to 63 */
 		regs[1] = (Dlockdown & 0xfc000000) | (victim << 20);
 		arm9tdmi_write_core_regs(target, 0x2, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* Write D TLB lockdown */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,0), ARMV4_5_STR(1, 0));
-	
+
 		/* Read D TLB RAM1 */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,10,4), ARMV4_5_LDR(2,0));
 
 		/* Read D TLB RAM2 */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,2,5), ARMV4_5_LDR(3,0));
-		
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-		
+
 		/* read D TLB RAM content stored to r2 and r3 */
 		arm9tdmi_read_core_regs(target, 0xc, regs_p);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1184,31 +1184,31 @@
 			return retval;
 		}
 
-		d_tlb[victim].ram1 = regs[2]; 
-		d_tlb[victim].ram2 = regs[3]; 
+		d_tlb[victim].ram1 = regs[2];
+		d_tlb[victim].ram2 = regs[3];
 	}
-		
+
 	/* restore D TLB lockdown */
 	regs[1] = Dlockdown;
 	arm9tdmi_write_core_regs(target, 0x2, regs);
-	
+
 	/* Write D TLB lockdown */
 	arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,0), ARMV4_5_STR(1, 0));
 
-	/* prepare reading I TLB content 
+	/* prepare reading I TLB content
 	 * */
-	
+
 	/* set interpret mode */
 	cp15c15 |= 0x1;
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 	/* Read I TLB lockdown */
 	arm920t_execute_cp15(target, ARMV4_5_MRC(15,0,0,10,0,1), ARMV4_5_LDR(1, 0));
-	
+
 	/* clear interpret mode */
 	cp15c15 &= ~0x1;
 	arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-	
+
 	/* read I TLB lockdown stored to r1 */
 	arm9tdmi_read_core_regs(target, 0x2, regs_p);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1216,63 +1216,63 @@
 		return retval;
 	}
 	Ilockdown = regs[1];
-	
+
 	for (victim = 0; victim < 64; victim += 8)
 	{
-		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0] 
+		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0]
 		 * base remains unchanged, victim goes through entries 0 to 63 */
 		regs[1] = (Ilockdown & 0xfc000000) | (victim << 20);
 		arm9tdmi_write_core_regs(target, 0x2, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* Write I TLB lockdown */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,1), ARMV4_5_STR(1, 0));
-	
+
 		/* Read I TLB CAM */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,5,4), ARMV4_5_LDMIA(0, 0x3fc, 0, 0));
-		
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-		
+
 		/* read I TLB CAM content stored to r2-r9 */
 		arm9tdmi_read_core_regs(target, 0x3fc, regs_p);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		for (i = 0; i < 8; i++)
-			i_tlb[i + victim].cam = regs[i + 2]; 
+			i_tlb[i + victim].cam = regs[i + 2];
 	}
 
 	for (victim = 0; victim < 64; victim++)
 	{
-		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0] 
+		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0]
 		 * base remains unchanged, victim goes through entries 0 to 63 */
 		regs[1] = (Dlockdown & 0xfc000000) | (victim << 20);
 		arm9tdmi_write_core_regs(target, 0x2, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* Write I TLB lockdown */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,1), ARMV4_5_STR(1, 0));
-	
+
 		/* Read I TLB RAM1 */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,9,4), ARMV4_5_LDR(2,0));
 
 		/* Read I TLB RAM2 */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,1,5), ARMV4_5_LDR(3,0));
-		
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-		
+
 		/* read I TLB RAM content stored to r2 and r3 */
 		arm9tdmi_read_core_regs(target, 0xc, regs_p);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1280,21 +1280,21 @@
 			return retval;
 		}
 
-		i_tlb[victim].ram1 = regs[2]; 
-		i_tlb[victim].ram2 = regs[3]; 
+		i_tlb[victim].ram1 = regs[2];
+		i_tlb[victim].ram2 = regs[3];
 	}
-		
+
 	/* restore I TLB lockdown */
 	regs[1] = Ilockdown;
 	arm9tdmi_write_core_regs(target, 0x2, regs);
-	
+
 	/* Write I TLB lockdown */
 	arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,1), ARMV4_5_STR(1, 0));
-	
+
 	/* restore CP15 MMU and Cache settings */
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl_saved);
 
-	/* output data to file */	
+	/* output data to file */
 	fprintf(output, "D TLB content:\n");
 	for (i = 0; i < 64; i++)
 	{
@@ -1306,11 +1306,11 @@
 	{
 		fprintf(output, "%i: 0x%8.8x 0x%8.8x 0x%8.8x %s\n", i, i_tlb[i].cam, i_tlb[i].ram1, i_tlb[i].ram2, (i_tlb[i].cam & 0x20) ? "(valid)" : "(invalid)");
 	}
-	
+
 	command_print(cmd_ctx, "mmu content successfully output to %s", args[0]);
-	
+
 	fclose(output);
-	
+
 	if (armv4_5_mode_to_number(armv4_5->core_mode)==-1)
 		return ERROR_FAIL;
 
@@ -1325,7 +1325,7 @@
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 7).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 7).valid;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 8).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 8).valid;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 9).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 9).valid;
-	
+
 	return ERROR_OK;
 }
 int arm920t_handle_cp15_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
@@ -1343,9 +1343,9 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
@@ -1369,7 +1369,7 @@
 			{
 				return retval;
 			}
-			
+
 			command_print(cmd_ctx, "%i: %8.8x", address, value);
 		}
 		else if (argc == 2)
@@ -1402,9 +1402,9 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
@@ -1424,7 +1424,7 @@
 				command_print(cmd_ctx, "couldn't execute %8.8x", opcode);
 				return ERROR_OK;
 			}
-			
+
 			command_print(cmd_ctx, "%8.8x: %8.8x", opcode, value);
 		}
 		else if (argc == 2)
@@ -1464,18 +1464,18 @@
 	arm7_9_common_t *arm7_9;
 	arm9tdmi_common_t *arm9tdmi;
 	arm920t_common_t *arm920t;
-	
+
 	if (arm920t_get_arch_pointers(target, &armv4_5, &arm7_9, &arm9tdmi, &arm920t) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_handle_cache_info_command(cmd_ctx, &arm920t->armv4_5_mmu.armv4_5_cache);
 }
 
 int arm920t_handle_virt2phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -1488,20 +1488,20 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-		
+
 	return armv4_5_mmu_handle_virt2phys_command(cmd_ctx, cmd, args, argc, target, &arm920t->armv4_5_mmu);
 }
 
 int arm920t_handle_md_phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -1514,20 +1514,20 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_mmu_handle_md_phys_command(cmd_ctx, cmd, args, argc, target, &arm920t->armv4_5_mmu);
 }
 
 int arm920t_handle_mw_phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -1540,14 +1540,14 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_mmu_handle_mw_phys_command(cmd_ctx, cmd, args, argc, target, &arm920t->armv4_5_mmu);
 }

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/arm926ejs.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -132,7 +132,7 @@
 
 	buf_set_u32(address_buf, 0, 14, address);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -222,7 +222,7 @@
 	buf_set_u32(address_buf, 0, 14, address);
 	buf_set_u32(value_buf, 0, 32, value);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -366,7 +366,7 @@
 		default:
 			LOG_ERROR("BUG: unknown debug reason: 0x%x", debug_reason);
 			target->debug_reason = DBG_REASON_DBGRQ;
-			/* if we fail here, we won't talk to the target and it will 
+			/* if we fail here, we won't talk to the target and it will
 			 * be reported to be in the halted state */
 			retval = ERROR_TARGET_FAILURE;
 			break;

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/arm966e.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -74,9 +74,9 @@
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
-	
+
 	.add_breakpoint = arm7_9_add_breakpoint,
 	.remove_breakpoint = arm7_9_remove_breakpoint,
 	.add_watchpoint = arm7_9_add_watchpoint,
@@ -92,13 +92,13 @@
 int arm966e_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
 	arm9tdmi_init_target(cmd_ctx, target);
-		
+
 	return ERROR_OK;
 }
 
 int arm966e_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -106,25 +106,25 @@
 {
 	arm9tdmi_common_t *arm9tdmi = &arm966e->arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm9tdmi->arm7_9_common;
-	
+
 	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
 
 	arm9tdmi->arch_info = arm966e;
 	arm966e->common_magic = ARM966E_COMMON_MAGIC;
-	
+
 	/* The ARM966E-S implements the ARMv5TE architecture which
 	 * has the BKPT instruction, so we don't have to use a watchpoint comparator
 	 */
 	arm7_9->arm_bkpt = ARMV5_BKPT(0x0);
 	arm7_9->thumb_bkpt = ARMV5_T_BKPT(0x0) & 0xffff;
-	
+
 	return ERROR_OK;
 }
 
 int arm966e_target_create( struct target_s *target, Jim_Interp *interp )
 {
 	arm966e_common_t *arm966e = calloc(1,sizeof(arm966e_common_t));
-	
+
 	arm966e_init_arch_info(target, arm966e, target->tap, target->variant);
 
 	return ERROR_OK;
@@ -136,35 +136,35 @@
 	arm7_9_common_t *arm7_9;
 	arm9tdmi_common_t *arm9tdmi;
 	arm966e_common_t *arm966e;
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7_9 = armv4_5->arch_info;
 	if (arm7_9->common_magic != ARM7_9_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm9tdmi = arm7_9->arch_info;
 	if (arm9tdmi->common_magic != ARM9TDMI_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm966e = arm9tdmi->arch_info;
 	if (arm966e->common_magic != ARM966E_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	*armv4_5_p = armv4_5;
 	*arm7_9_p = arm7_9;
 	*arm9tdmi_p = arm9tdmi;
 	*arm966e_p = arm966e;
-	
+
 	return ERROR_OK;
 }
 
@@ -177,8 +177,8 @@
 	scan_field_t fields[3];
 	u8 reg_addr_buf = reg_addr & 0x3f;
 	u8 nr_w_buf = 0;
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -214,7 +214,7 @@
 	fields[2].in_check_mask = NULL;
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(3, fields, -1);
 
 	fields[0].in_handler_priv = value;
@@ -243,10 +243,10 @@
 	u8 reg_addr_buf = reg_addr & 0x3f;
 	u8 nr_w_buf = 1;
 	u8 value_buf[4];
-	
+
 	buf_set_u32(value_buf, 0, 32, value);
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -282,7 +282,7 @@
 	fields[2].in_check_mask = NULL;
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(3, fields, -1);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
@@ -307,9 +307,9 @@
 		command_print(cmd_ctx, "current target isn't an ARM966e target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
@@ -333,7 +333,7 @@
 			{
 				return retval;
 			}
-			
+
 			command_print(cmd_ctx, "%i: %8.8x", address, value);
 		}
 		else if (argc == 2)
@@ -355,10 +355,10 @@
 {
 	int retval;
 	command_t *arm966e_cmd;
-	
+
 	retval = arm9tdmi_register_commands(cmd_ctx);
 	arm966e_cmd = register_command(cmd_ctx, NULL, "arm966e", NULL, COMMAND_ANY, "arm966e specific commands");
 	register_command(cmd_ctx, arm966e_cmd, "cp15", arm966e_handle_cp15_command, COMMAND_EXEC, "display/modify cp15 register <num> [value]");
-	
+
 	return retval;
 }

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/arm9tdmi.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -56,7 +56,7 @@
 
 int arm9tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target);
 int arm9tdmi_quit(void);
-		
+
 target_type_t arm9tdmi_target =
 {
 	.name = "arm9tdmi",
@@ -81,9 +81,9 @@
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
-	
+
 	.add_breakpoint = arm7_9_add_breakpoint,
 	.remove_breakpoint = arm7_9_remove_breakpoint,
 	.add_watchpoint = arm7_9_add_watchpoint,
@@ -115,7 +115,7 @@
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	
+
 	/* only check the debug reason if we don't know it already */
 	if ((target->debug_reason != DBG_REASON_DBGRQ)
 			&& (target->debug_reason != DBG_REASON_SINGLESTEP))
@@ -125,7 +125,7 @@
 		u8 instructionbus[4];
 		u8 debug_reason;
 
-		jtag_add_end_state(TAP_PD);
+		jtag_add_end_state(TAP_DRPAUSE);
 
 		fields[0].tap = arm7_9->jtag_info.tap;
 		fields[0].num_bits = 32;
@@ -136,7 +136,7 @@
 		fields[0].in_check_mask = NULL;
 		fields[0].in_handler = NULL;
 		fields[0].in_handler_priv = NULL;
-		
+
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 3;
 		fields[1].out_value = NULL;
@@ -146,7 +146,7 @@
 		fields[1].in_check_mask = NULL;
 		fields[1].in_handler = NULL;
 		fields[1].in_handler_priv = NULL;
-		
+
 		fields[2].tap = arm7_9->jtag_info.tap;
 		fields[2].num_bits = 32;
 		fields[2].out_value = NULL;
@@ -156,28 +156,28 @@
 		fields[2].in_check_mask = NULL;
 		fields[2].in_handler = NULL;
 		fields[2].in_handler_priv = NULL;
-		
+
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
 			return retval;
 		}
 		arm_jtag_set_instr(&arm7_9->jtag_info, arm7_9->jtag_info.intest_instr, NULL);
 
-		jtag_add_dr_scan(3, fields, TAP_PD);
+		jtag_add_dr_scan(3, fields, TAP_DRPAUSE);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		fields[0].in_value = NULL;
 		fields[0].out_value = databus;
 		fields[1].in_value = NULL;
 		fields[1].out_value = &debug_reason;
 		fields[2].in_value = NULL;
 		fields[2].out_value = instructionbus;
-		
-		jtag_add_dr_scan(3, fields, TAP_PD);
 
+		jtag_add_dr_scan(3, fields, TAP_DRPAUSE);
+
 		if (debug_reason & 0x4)
 			if (debug_reason & 0x2)
 				target->debug_reason = DBG_REASON_WPTANDBKPT;
@@ -198,23 +198,23 @@
 	u8 out_buf[4];
 	u8 instr_buf[4];
 	u8 sysspeed_buf = 0x0;
-	
+
 	/* prepare buffer */
 	buf_set_u32(out_buf, 0, 32, out);
-	
+
 	buf_set_u32(instr_buf, 0, 32, flip_u32(instr, 32));
-	
+
 	if (sysspeed)
 		buf_set_u32(&sysspeed_buf, 2, 1, 1);
-	
-	jtag_add_end_state(TAP_PD);
+
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
@@ -232,7 +232,7 @@
 	}
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
-	
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
@@ -242,7 +242,7 @@
 	fields[1].in_check_mask = NULL;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
-		
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
@@ -256,14 +256,14 @@
 	jtag_add_dr_scan(3, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		if (in)
 		{
 			LOG_DEBUG("instr: 0x%8.8x, out: 0x%8.8x, in: 0x%8.8x", instr, out, *in);
@@ -282,14 +282,14 @@
 	int retval = ERROR_OK;;
 	scan_field_t fields[3];
 
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
@@ -299,7 +299,7 @@
 	fields[0].in_handler_priv = in;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
-	
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
@@ -319,18 +319,18 @@
 	fields[2].in_check_mask = NULL;
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(3, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		if (in)
 		{
 			LOG_DEBUG("in: 0x%8.8x", *in);
@@ -353,15 +353,15 @@
 {
 	int retval = ERROR_OK;
 	scan_field_t fields[3];
-	
-	jtag_add_end_state(TAP_PD);
+
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
@@ -382,7 +382,7 @@
 	fields[0].in_handler_priv = in;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
-	
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
@@ -402,18 +402,18 @@
 	fields[2].in_check_mask = NULL;
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(3, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		if (in)
 		{
 			LOG_DEBUG("in: 0x%8.8x", *(u32*)in);
@@ -435,10 +435,10 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
-	/* save r0 before using it and put system in ARM state 
+
+	/* save r0 before using it and put system in ARM state
 	 * to allow common handling of ARM and THUMB debugging */
-	
+
 	/* fetch STR r0, [r0] */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_STR(0, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
@@ -446,7 +446,7 @@
 	/* STR r0, [r0] in Memory */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, r0, 0);
 
-	/* MOV r0, r15 fetched, STR in Decode */	
+	/* MOV r0, r15 fetched, STR in Decode */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_MOV(0, 15), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_STR(0, 0), 0, NULL, 0);
@@ -470,12 +470,12 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	/* NOP fetched, BX in Execute (1) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
-	
+
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return;
 	}
-	
+
 	/* fix program counter:
 	 * MOV r0, r15 was the 5th instruction (+8)
 	 * reading PC in Thumb state gives address of instruction + 4
@@ -490,7 +490,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* STMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -521,7 +521,7 @@
 	u32 *buf_u32 = buffer;
 	u16 *buf_u16 = buffer;
 	u8 *buf_u8 = buffer;
-	
+
 	/* STMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -558,7 +558,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* MRS r0, cpsr */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_MRS(0, spsr & 1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -583,7 +583,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr: %8.8x, spsr: %i", xpsr, spsr);
 
 	/* MSR1 fetched */
@@ -619,16 +619,16 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr_im: %2.2x, rot: %i, spsr: %i", xpsr_im, rot, spsr);
-	
+
 	/* MSR fetched */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_MSR_IM(xpsr_im, rot, 1, spsr), 0, NULL, 0);
 	/* NOP fetched, MSR in DECODE */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	/* NOP fetched, MSR in EXECUTE (1) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-	
+
 	/* rot == 4 writes flags, which takes only one cycle */
 	if (rot != 4)
 	{
@@ -646,7 +646,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* LDMIA r0-15, [r0] at debug speed
 	* register values will start to appear on 4th DCLK
 	*/
@@ -664,7 +664,7 @@
 			arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, core_regs[i], NULL, 0);
 	}
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-	
+
 }
 
 void arm9tdmi_load_word_regs(target_t *target, u32 mask)
@@ -686,7 +686,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/* put system-speed load half-word into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_LDRH_IP(num, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
@@ -750,7 +750,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/* LDMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -777,7 +777,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_B(0xfffffc, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
 
@@ -786,7 +786,7 @@
 void arm9tdmi_branch_resume_thumb(target_t *target)
 {
 	LOG_DEBUG("-");
-	
+
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
@@ -809,14 +809,14 @@
 
 	/* Branch and eXchange */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_BX(0), 0, NULL, 0);
-	
+
 	embeddedice_read_reg(dbg_stat);
-	
+
 	/* fetch NOP, BX in DECODE stage */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-	
+
 	embeddedice_read_reg(dbg_stat);
-	
+
 	/* fetch NOP, BX in EXECUTE stage (1st cycle) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 
@@ -833,12 +833,12 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, buf_get_u32(armv4_5->core_cache->reg_list[0].value, 0, 32), NULL, 0);
 	/* nothing fetched, LDR in EXECUTE stage (3rd cycle) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
-	
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 
 	embeddedice_read_reg(dbg_stat);
-	
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_B(0x7f7), 0, NULL, 1);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 
@@ -849,7 +849,7 @@
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	
+
 	if (arm7_9->has_single_step)
 	{
 		buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 3, 1, 1);
@@ -866,7 +866,7 @@
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	
+
 	if (arm7_9->has_single_step)
 	{
 		buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 3, 1, 0);
@@ -905,7 +905,7 @@
 			return ERROR_FAIL;
 		(*cache_p) = t;
 		arm7_9->eice_cache = (*cache_p);
-	
+
 		if (arm7_9->etm_ctx)
 		{
 			arm_jtag_t *jtag_info = &arm7_9->jtag_info;
@@ -928,16 +928,16 @@
 
 int arm9tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
-	
+
 	arm9tdmi_build_reg_cache(target);
-	
+
 	return ERROR_OK;
-	
+
 }
 
 int arm9tdmi_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -945,53 +945,53 @@
 {
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
-	
+
 	arm7_9 = &arm9tdmi->arm7_9_common;
 	armv4_5 = &arm7_9->armv4_5_common;
-	
+
 	/* prepare JTAG information for the new target */
 	arm7_9->jtag_info.tap = tap;
 	arm7_9->jtag_info.scann_size = 5;
-	
+
 	/* register arch-specific functions */
 	arm7_9->examine_debug_reason = arm9tdmi_examine_debug_reason;
 	arm7_9->change_to_arm = arm9tdmi_change_to_arm;
 	arm7_9->read_core_regs = arm9tdmi_read_core_regs;
 	arm7_9->read_core_regs_target_buffer = arm9tdmi_read_core_regs_target_buffer;
 	arm7_9->read_xpsr = arm9tdmi_read_xpsr;
-	
+
 	arm7_9->write_xpsr = arm9tdmi_write_xpsr;
 	arm7_9->write_xpsr_im8 = arm9tdmi_write_xpsr_im8;
 	arm7_9->write_core_regs = arm9tdmi_write_core_regs;
-	
+
 	arm7_9->load_word_regs = arm9tdmi_load_word_regs;
 	arm7_9->load_hword_reg = arm9tdmi_load_hword_reg;
 	arm7_9->load_byte_reg = arm9tdmi_load_byte_reg;
-	
+
 	arm7_9->store_word_regs = arm9tdmi_store_word_regs;
 	arm7_9->store_hword_reg = arm9tdmi_store_hword_reg;
 	arm7_9->store_byte_reg = arm9tdmi_store_byte_reg;
-	
+
 	arm7_9->write_pc = arm9tdmi_write_pc;
 	arm7_9->branch_resume = arm9tdmi_branch_resume;
 	arm7_9->branch_resume_thumb = arm9tdmi_branch_resume_thumb;
 
 	arm7_9->enable_single_step = arm9tdmi_enable_single_step;
 	arm7_9->disable_single_step = arm9tdmi_disable_single_step;
-	
+
 	arm7_9->pre_debug_entry = NULL;
 	arm7_9->post_debug_entry = NULL;
-	
+
 	arm7_9->pre_restore_context = NULL;
 	arm7_9->post_restore_context = NULL;
 
 	/* initialize arch-specific breakpoint handling */
 	arm7_9->arm_bkpt = 0xdeeedeee;
 	arm7_9->thumb_bkpt = 0xdeee;
-	
+
 	arm7_9->dbgreq_adjust_pc = 3;
 	arm7_9->arch_info = arm9tdmi;
-	
+
 	arm9tdmi->common_magic = ARM9TDMI_COMMON_MAGIC;
 	arm9tdmi->arch_info = NULL;
 
@@ -1003,7 +1003,7 @@
 	{
 		arm9tdmi->variant = strdup("");
 	}
-	
+
 	arm7_9_init_arch_info(target, arm7_9);
 
 	/* override use of DBGRQ, this is safe on ARM9TDMI */
@@ -1011,7 +1011,7 @@
 
 	/* all ARM9s have the vector catch register */
 	arm7_9->has_vector_catch = 1;
-	
+
 	return ERROR_OK;
 }
 
@@ -1020,28 +1020,28 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9;
 	arm9tdmi_common_t *arm9tdmi;
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7_9 = armv4_5->arch_info;
 	if (arm7_9->common_magic != ARM7_9_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm9tdmi = arm7_9->arch_info;
 	if (arm9tdmi->common_magic != ARM9TDMI_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	*armv4_5_p = armv4_5;
 	*arm7_9_p = arm7_9;
 	*arm9tdmi_p = arm9tdmi;
-	
+
 	return ERROR_OK;
 }
 
@@ -1052,24 +1052,24 @@
 	arm9tdmi_common_t *arm9tdmi = calloc(1,sizeof(arm9tdmi_common_t));
 
 	arm9tdmi_init_arch_info(target, arm9tdmi, target->tap, target->variant);
-	
+
 	return ERROR_OK;
 }
 
 int arm9tdmi_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
-	
+
 	command_t *arm9tdmi_cmd;
-	
-		
+
+
 	retval = arm7_9_register_commands(cmd_ctx);
-	
+
 	arm9tdmi_cmd = register_command(cmd_ctx, NULL, "arm9tdmi", NULL, COMMAND_ANY, "arm9tdmi specific commands");
 
 	register_command(cmd_ctx, arm9tdmi_cmd, "vector_catch", handle_arm9tdmi_catch_vectors_command, COMMAND_EXEC, "catch arm920t vectors ['all'|'none'|'<vec1 vec2 ...>']");
-	
-	
+
+
 	return retval;
 
 }
@@ -1083,22 +1083,22 @@
 	reg_t *vector_catch;
 	u32 vector_catch_value;
 	int i, j;
-	
+
 	if (arm9tdmi_get_arch_pointers(target, &armv4_5, &arm7_9, &arm9tdmi) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM9TDMI based target");
 		return ERROR_OK;
 	}
-	
+
 	vector_catch = &arm7_9->eice_cache->reg_list[EICE_VEC_CATCH];
-	
+
 	/* read the vector catch register if necessary */
 	if (!vector_catch->valid)
 		embeddedice_read_reg(vector_catch);
-	
+
 	/* get the current setting */
 	vector_catch_value = buf_get_u32(vector_catch->value, 0, 32);
-	
+
 	if (argc > 0)
 	{
 		vector_catch_value = 0x0;
@@ -1123,25 +1123,25 @@
 						break;
 					}
 				}
-				
+
 				/* complain if vector wasn't found */
 				if (!arm9tdmi_vectors[j].name)
 				{
 					command_print(cmd_ctx, "vector '%s' not found, leaving current setting unchanged", args[i]);
-					
+
 					/* reread current setting */
 					vector_catch_value = buf_get_u32(vector_catch->value, 0, 32);
-					
+
 					break;
 				}
 			}
 		}
-		
+
 		/* store new settings */
 		buf_set_u32(vector_catch->value, 0, 32, vector_catch_value);
 		embeddedice_store_reg(vector_catch);
 	}
-		
+
 	/* output current settings (skip RESERVED vector) */
 	for (i = 0; i < 8; i++)
 	{
@@ -1149,7 +1149,7 @@
 		{
 			command_print(cmd_ctx, "%s: %s", arm9tdmi_vectors[i].name,
 				(vector_catch_value & (1 << i)) ? "catch" : "don't catch");
-		}  
+		}
 	}
 
 	return ERROR_OK;

Modified: trunk/src/target/cortex_swjdp.c
===================================================================
--- trunk/src/target/cortex_swjdp.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/cortex_swjdp.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -44,7 +44,7 @@
 /*
  * Transaction Mode:
  * swjdp->trans_mode = TRANS_MODE_COMPOSITE;
- * Uses Overrun checking mode and does not do actual JTAG send/receive or transaction 
+ * Uses Overrun checking mode and does not do actual JTAG send/receive or transaction
  * result checking until swjdp_end_transaction()
  * This must be done before using or deallocating any return variables.
  * swjdp->trans_mode == TRANS_MODE_ATOMIC
@@ -63,8 +63,8 @@
 {
 	scan_field_t fields[2];
 	u8 out_addr_buf;
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_set_instr(jtag_info, instr, NULL);
 
 	fields[0].tap = jtag_info->tap;
@@ -99,8 +99,8 @@
 	scan_field_t fields[2];
 	u8 out_value_buf[4];
 	u8 out_addr_buf;
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_set_instr(jtag_info, instr, NULL);
 
 	fields[0].tap = jtag_info->tap;
@@ -138,7 +138,7 @@
 	return ERROR_OK;
 }
 
-/* scan_inout_check adds one extra inscan for DPAP_READ commands to read variables */ 
+/* scan_inout_check adds one extra inscan for DPAP_READ commands to read variables */
 int scan_inout_check(swjdp_common_t *swjdp, u8 instr, u8 reg_addr, u8 RnW, u8 *outvalue, u8 *invalue)
 {
 	swjdp_scan(swjdp->jtag_info, instr, reg_addr, RnW, outvalue, NULL, NULL);
@@ -146,7 +146,7 @@
 	{
 		swjdp_scan(swjdp->jtag_info, SWJDP_IR_DPACC, DP_RDBUFF, DPAP_READ, 0, invalue, &swjdp->ack);
 	}
-	
+
 	/* In TRANS_MODE_ATOMIC all SWJDP_IR_APACC transactions wait for ack=OK/FAULT and the check CTRL_STAT */
 	if ((instr == SWJDP_IR_APACC) && (swjdp->trans_mode == TRANS_MODE_ATOMIC))
 	{
@@ -163,7 +163,7 @@
 	{
 		swjdp_scan_u32(swjdp->jtag_info, SWJDP_IR_DPACC, DP_RDBUFF, DPAP_READ, 0, invalue, &swjdp->ack);
 	}
-	
+
 	/* In TRANS_MODE_ATOMIC all SWJDP_IR_APACC transactions wait for ack=OK/FAULT and then check CTRL_STAT */
 	if ((instr == SWJDP_IR_APACC) && (swjdp->trans_mode == TRANS_MODE_ATOMIC))
 	{
@@ -179,10 +179,10 @@
 	u32 ctrlstat;
 
 	keep_alive();
-	
+
 	/* Danger!!!! BROKEN!!!! */
 	scan_inout_check_u32(swjdp, SWJDP_IR_DPACC, DP_CTRL_STAT, DPAP_READ, 0, &ctrlstat);
-	/* Danger!!!! BROKEN!!!! Why will jtag_execute_queue() fail here???? 
+	/* Danger!!!! BROKEN!!!! Why will jtag_execute_queue() fail here????
 	R956 introduced the check on return value here and now Michael Schwingen reports
 	that this code no longer works....
 
@@ -196,9 +196,9 @@
 	scan_inout_check_u32(swjdp, SWJDP_IR_DPACC, DP_CTRL_STAT, DPAP_READ, 0, &ctrlstat);
 	if ((retval=jtag_execute_queue())!=ERROR_OK)
 		return retval;
-	
+
 	swjdp->ack = swjdp->ack & 0x7;
-	
+
 	long long then=timeval_ms();
 	while (swjdp->ack != 2)
 	{
@@ -234,13 +234,13 @@
 		else
 		{
 			u32 dcb_dhcsr,nvic_shcsr, nvic_bfar, nvic_cfsr;
-			
+
 			if (ctrlstat & SSTICKYORUN)
 				LOG_ERROR("SWJ-DP OVERRUN - check clock or reduce jtag speed");
-			
+
 			if (ctrlstat & SSTICKYERR)
 				LOG_ERROR("SWJ-DP STICKY ERROR");
-			
+
 			/* Clear Sticky Error Bits */
 			scan_inout_check_u32(swjdp, SWJDP_IR_DPACC, DP_CTRL_STAT, DPAP_WRITE, swjdp->dp_ctrl_stat | SSTICKYORUN | SSTICKYERR, NULL);
 			scan_inout_check_u32(swjdp, SWJDP_IR_DPACC, DP_CTRL_STAT, DPAP_READ, 0, &ctrlstat);
@@ -248,8 +248,8 @@
 				return retval;
 
 			LOG_DEBUG("swjdp: status 0x%x", ctrlstat);
-			
-			/* Can we find out the reason for the error ?? */			
+
+			/* Can we find out the reason for the error ?? */
 			ahbap_read_system_atomic_u32(swjdp, DCB_DHCSR, &dcb_dhcsr);
 			ahbap_read_system_atomic_u32(swjdp, NVIC_SHCSR, &nvic_shcsr);
 			ahbap_read_system_atomic_u32(swjdp, NVIC_CFSR, &nvic_cfsr);
@@ -312,7 +312,7 @@
 int ahbap_write_reg_u32(swjdp_common_t *swjdp, u32 reg_addr, u32 value)
 {
 	u8 out_value_buf[4];
-	
+
 	buf_set_u32(out_value_buf, 0, 32, value);
 	swjdp_bankselect_apacc(swjdp, reg_addr);
 	scan_inout_check(swjdp, SWJDP_IR_APACC, reg_addr, DPAP_WRITE, out_value_buf, NULL);
@@ -350,7 +350,7 @@
 		swjdp->ap_tar_value = tar;
 	}
 	if (csw & CSW_ADDRINC_MASK)
-	{ 	
+	{
 		/* Do not cache TAR value when autoincrementing */
 		swjdp->ap_tar_value = -1;
 	}
@@ -371,14 +371,14 @@
 
 	ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_OFF, address & 0xFFFFFFF0);
 	ahbap_read_reg_u32(swjdp, AHBAP_BD0 | (address & 0xC), value );
-	
+
 	return ERROR_OK;
 }
 
 int ahbap_read_system_atomic_u32(swjdp_common_t *swjdp, u32 address, u32 *value)
 {
 	ahbap_read_system_u32(swjdp, address, value);
-	
+
 	return swjdp_transaction_endcheck(swjdp);
 }
 
@@ -402,7 +402,7 @@
 int ahbap_write_system_atomic_u32(swjdp_common_t *swjdp, u32 address, u32 value)
 {
 	ahbap_write_system_u32(swjdp, address, value);
-	
+
 	return swjdp_transaction_endcheck(swjdp);
 }
 
@@ -419,12 +419,12 @@
 	int wcount, blocksize, writecount, errorcount = 0, retval = ERROR_OK;
 	u32 adr = address;
 	u8* pBuffer = buffer;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	count >>= 2;
 	wcount = count;
-	
+
 	/* if we have an unaligned access - reorder data */
 	if (adr & 0x3u)
 	{
@@ -432,7 +432,7 @@
 		{
 			int i;
 			outvalue = *((u32*)pBuffer);
-			
+
 			for (i = 0; i < 4; i++ )
 			{
 				*((u8*)pBuffer + (adr & 0x3)) = outvalue;
@@ -442,25 +442,25 @@
 			pBuffer += 4;
 		}
 	}
-	
+
 	while (wcount > 0)
 	{
 		/* Adjust to write blocks within 4K aligned boundaries */
 		blocksize = (0x1000 - (0xFFF & address)) >> 2;
 		if (wcount < blocksize)
 			blocksize = wcount;
-		
+
 		/* handle unaligned data at 4k boundary */
 		if (blocksize == 0)
 			blocksize = 1;
-			
+
 		ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_SINGLE, address);
-		
+
 		for (writecount = 0; writecount < blocksize; writecount++)
 		{
 			ahbap_write_reg(swjdp, AHBAP_DRW, buffer + 4 * writecount );
 		}
-		
+
 		if (swjdp_transaction_endcheck(swjdp) == ERROR_OK)
 		{
 			wcount = wcount - blocksize;
@@ -471,14 +471,14 @@
 		{
 			errorcount++;
 		}
-		
+
 		if (errorcount > 1)
 		{
 			LOG_WARNING("Block write error address 0x%x, wcount 0x%x", address, wcount);
 			return ERROR_JTAG_DEVICE_ERROR;
 		}
 	}
-	
+
 	return retval;
 }
 
@@ -487,32 +487,32 @@
 	u32 outvalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, writecount, i;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-		
+
 	wcount = count >> 1;
-	
+
 	while (wcount > 0)
 	{
 		int nbytes;
-		
+
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address)) >> 1;
-		
+
 		if (wcount < blocksize)
 			blocksize = wcount;
-		
+
 		/* handle unaligned data at 4k boundary */
 		if (blocksize == 0)
 			blocksize = 1;
-		
+
 		ahbap_setup_accessport(swjdp, CSW_16BIT | CSW_ADDRINC_PACKED, address);
 		writecount = blocksize;
-		
+
 		do
 		{
 			nbytes = MIN((writecount << 1), 4);
-			
+
 			if (nbytes < 4 )
 			{
 				if (ahbap_write_buf_u16(swjdp, buffer, nbytes, address) != ERROR_OK)
@@ -520,20 +520,20 @@
 					LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 					return ERROR_JTAG_DEVICE_ERROR;
 				}
-				
+
 				address += nbytes >> 1;
 			}
 			else
 			{
 				outvalue = *((u32*)buffer);
-				
+
 				for (i = 0; i < nbytes; i++ )
 				{
 					*((u8*)buffer + (address & 0x3)) = outvalue;
 					outvalue >>= 8;
 					address++;
 				}
-				
+
 				outvalue = *((u32*)buffer);
 				ahbap_write_reg_u32(swjdp, AHBAP_DRW, outvalue);
 				if (swjdp_transaction_endcheck(swjdp) != ERROR_OK)
@@ -542,14 +542,14 @@
 					return ERROR_JTAG_DEVICE_ERROR;
 				}
 			}
-			
+
 			buffer += nbytes >> 1;
 			writecount -= nbytes >> 1;
-			
+
 		} while (writecount);
 		wcount -= blocksize;
 	}
-	
+
 	return retval;
 }
 
@@ -557,12 +557,12 @@
 {
 	u32 outvalue;
 	int retval = ERROR_OK;
-	
+
 	if (count >= 4)
 		return ahbap_write_buf_packed_u16(swjdp, buffer, count, address);
-		
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	while (count > 0)
 	{
 		ahbap_setup_accessport(swjdp, CSW_16BIT | CSW_ADDRINC_SINGLE, address);
@@ -582,28 +582,28 @@
 	u32 outvalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, writecount, i;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	wcount = count;
-	
+
 	while (wcount > 0)
 	{
 		int nbytes;
-		
+
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address));
-		
+
 		if (wcount < blocksize)
 			blocksize = wcount;
-				
+
 		ahbap_setup_accessport(swjdp, CSW_8BIT | CSW_ADDRINC_PACKED, address);
 		writecount = blocksize;
-		
+
 		do
 		{
 			nbytes = MIN(writecount, 4);
-			
+
 			if (nbytes < 4 )
 			{
 				if (ahbap_write_buf_u8(swjdp, buffer, nbytes, address) != ERROR_OK)
@@ -611,20 +611,20 @@
 					LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 					return ERROR_JTAG_DEVICE_ERROR;
 				}
-				
+
 				address += nbytes;
 			}
 			else
 			{
 				outvalue = *((u32*)buffer);
-				
+
 				for (i = 0; i < nbytes; i++ )
 				{
 					*((u8*)buffer + (address & 0x3)) = outvalue;
 					outvalue >>= 8;
 					address++;
 				}
-				
+
 				outvalue = *((u32*)buffer);
 				ahbap_write_reg_u32(swjdp, AHBAP_DRW, outvalue);
 				if (swjdp_transaction_endcheck(swjdp) != ERROR_OK)
@@ -633,14 +633,14 @@
 					return ERROR_JTAG_DEVICE_ERROR;
 				}
 			}
-			
+
 			buffer += nbytes;
 			writecount -= nbytes;
-			
+
 		} while (writecount);
 		wcount -= blocksize;
 	}
-	
+
 	return retval;
 }
 
@@ -648,12 +648,12 @@
 {
 	u32 outvalue;
 	int retval = ERROR_OK;
-	
+
 	if (count >= 4)
 		return ahbap_write_buf_packed_u8(swjdp, buffer, count, address);
-		
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	while (count > 0)
 	{
 		ahbap_setup_accessport(swjdp, CSW_8BIT | CSW_ADDRINC_SINGLE, address);
@@ -664,7 +664,7 @@
 		address++;
 		buffer++;
 	}
-	
+
 	return retval;
 }
 
@@ -680,25 +680,25 @@
 	int wcount, blocksize, readcount, errorcount = 0, retval = ERROR_OK;
 	u32 adr = address;
 	u8* pBuffer = buffer;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	count >>= 2;
 	wcount = count;
-	
+
 	while (wcount > 0)
 	{
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address)) >> 2;
 		if (wcount < blocksize)
 			blocksize = wcount;
-		
+
 		/* handle unaligned data at 4k boundary */
 		if (blocksize == 0)
 			blocksize = 1;
-		
+
 		ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_SINGLE, address);
-		
+
 		/* Scan out first read */
 		swjdp_scan(swjdp->jtag_info, SWJDP_IR_APACC, AHBAP_DRW, DPAP_READ, 0, NULL, NULL);
 		for (readcount = 0; readcount < blocksize - 1; readcount++)
@@ -706,27 +706,27 @@
 			/* Scan out read instruction and scan in previous value */
 			swjdp_scan(swjdp->jtag_info, SWJDP_IR_APACC, AHBAP_DRW, DPAP_READ, 0, buffer + 4 * readcount, &swjdp->ack);
 		}
-		
+
 		/* Scan in last value */
 		swjdp_scan(swjdp->jtag_info, SWJDP_IR_DPACC, DP_RDBUFF, DPAP_READ, 0, buffer + 4 * readcount, &swjdp->ack);
 		if (swjdp_transaction_endcheck(swjdp) == ERROR_OK)
 		{
 			wcount = wcount - blocksize;
 			address += 4 * blocksize;
-			buffer += 4 * blocksize; 
+			buffer += 4 * blocksize;
 		}
 		else
 		{
 			errorcount++;
 		}
-		
+
 		if (errorcount > 1)
 		{
 			LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 			return ERROR_JTAG_DEVICE_ERROR;
 		}
 	}
-	
+
 	/* if we have an unaligned access - reorder data */
 	if (adr & 0x3u)
 	{
@@ -734,7 +734,7 @@
 		{
 			int i;
 			u32 data = *((u32*)pBuffer);
-			
+
 			for (i = 0; i < 4; i++ )
 			{
 				*((u8*)pBuffer) = (data >> 8 * (adr & 0x3));
@@ -743,7 +743,7 @@
 			}
 		}
 	}
-	
+
 	return retval;
 }
 
@@ -752,27 +752,27 @@
 	u32 invalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, readcount, i;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	wcount = count >> 1;
-	
+
 	while (wcount > 0)
 	{
 		int nbytes;
-		
+
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address)) >> 1;
 		if (wcount < blocksize)
 			blocksize = wcount;
-				
+
 		ahbap_setup_accessport(swjdp, CSW_16BIT | CSW_ADDRINC_PACKED, address);
-		
+
 		/* handle unaligned data at 4k boundary */
 		if (blocksize == 0)
 			blocksize = 1;
 		readcount = blocksize;
-		
+
 		do
 		{
 			ahbap_read_reg_u32(swjdp, AHBAP_DRW, &invalue );
@@ -781,21 +781,21 @@
 				LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 				return ERROR_JTAG_DEVICE_ERROR;
 			}
-			
+
 			nbytes = MIN((readcount << 1), 4);
-			
+
 			for (i = 0; i < nbytes; i++ )
 			{
 				*((u8*)buffer) = (invalue >> 8 * (address & 0x3));
 				buffer++;
 				address++;
 			}
-			
+
 			readcount -= (nbytes >> 1);
 		} while (readcount);
 		wcount -= blocksize;
 	}
-	
+
 	return retval;
 }
 
@@ -803,12 +803,12 @@
 {
 	u32 invalue, i;
 	int retval = ERROR_OK;
-	
+
 	if (count >= 4)
 		return ahbap_read_buf_packed_u16(swjdp, buffer, count, address);
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	while (count > 0)
 	{
 		ahbap_setup_accessport(swjdp, CSW_16BIT | CSW_ADDRINC_SINGLE, address);
@@ -840,24 +840,24 @@
 	u32 invalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, readcount, i;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	wcount = count;
-	
+
 	while (wcount > 0)
 	{
 		int nbytes;
-		
+
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address));
-		
+
 		if (wcount < blocksize)
 			blocksize = wcount;
-				
+
 		ahbap_setup_accessport(swjdp, CSW_8BIT | CSW_ADDRINC_PACKED, address);
 		readcount = blocksize;
-		
+
 		do
 		{
 			ahbap_read_reg_u32(swjdp, AHBAP_DRW, &invalue );
@@ -866,21 +866,21 @@
 				LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 				return ERROR_JTAG_DEVICE_ERROR;
 			}
-			
+
 			nbytes = MIN(readcount, 4);
-			
+
 			for (i = 0; i < nbytes; i++ )
 			{
 				*((u8*)buffer) = (invalue >> 8 * (address & 0x3));
 				buffer++;
 				address++;
 			}
-			
+
 			readcount -= nbytes;
 		} while (readcount);
 		wcount -= blocksize;
 	}
-	
+
 	return retval;
 }
 
@@ -888,12 +888,12 @@
 {
 	u32 invalue;
 	int retval = ERROR_OK;
-	
+
 	if (count >= 4)
 		return ahbap_read_buf_packed_u8(swjdp, buffer, count, address);
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	while (count > 0)
 	{
 		ahbap_setup_accessport(swjdp, CSW_8BIT | CSW_ADDRINC_SINGLE, address);
@@ -912,12 +912,12 @@
 {
 	int retval;
 	u32 dcrdr;
-	
+
 	/* because the DCB_DCRDR is used for the emulated dcc channel
 	 * we gave to save/restore the DCB_DCRDR when used */
-	
+
 	ahbap_read_system_atomic_u32(swjdp, DCB_DCRDR, &dcrdr);
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
 
 	/* ahbap_write_system_u32(swjdp, DCB_DCRSR, regnum); */
@@ -927,7 +927,7 @@
 	/* ahbap_read_system_u32(swjdp, DCB_DCRDR, value); */
 	ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_OFF, DCB_DCRDR & 0xFFFFFFF0);
 	ahbap_read_reg_u32(swjdp, AHBAP_BD0 | (DCB_DCRDR & 0xC), value );
-	
+
 	retval = swjdp_transaction_endcheck(swjdp);
 	ahbap_write_system_atomic_u32(swjdp, DCB_DCRDR, dcrdr);
 	return retval;
@@ -937,14 +937,14 @@
 {
 	int retval;
 	u32 dcrdr;
-	
+
 	/* because the DCB_DCRDR is used for the emulated dcc channel
 	 * we gave to save/restore the DCB_DCRDR when used */
-	 
+
 	ahbap_read_system_atomic_u32(swjdp, DCB_DCRDR, &dcrdr);
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	/* ahbap_write_system_u32(swjdp, DCB_DCRDR, core_regs[i]); */
 	ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_OFF, DCB_DCRDR & 0xFFFFFFF0);
 	ahbap_write_reg_u32(swjdp, AHBAP_BD0 | (DCB_DCRDR & 0xC), value );
@@ -952,7 +952,7 @@
 	/* ahbap_write_system_u32(swjdp, DCB_DCRSR, i | DCRSR_WnR	); */
 	ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_OFF, DCB_DCRSR & 0xFFFFFFF0);
 	ahbap_write_reg_u32(swjdp, AHBAP_BD0 | (DCB_DCRSR & 0xC), regnum | DCRSR_WnR );
-	
+
 	retval = swjdp_transaction_endcheck(swjdp);
 	ahbap_write_system_atomic_u32(swjdp, DCB_DCRDR, dcrdr);
 	return retval;
@@ -964,16 +964,16 @@
 	u32 ctrlstat;
 	int cnt = 0;
 	int retval;
-	
+
 	LOG_DEBUG(" ");
-	
+
 	swjdp->ap_csw_value = -1;
 	swjdp->ap_tar_value = -1;
 	swjdp->trans_mode = TRANS_MODE_ATOMIC;
 	swjdp_read_dpacc(swjdp, &dummy, DP_CTRL_STAT);
 	swjdp_write_dpacc(swjdp, SSTICKYERR, DP_CTRL_STAT);
 	swjdp_read_dpacc(swjdp, &dummy, DP_CTRL_STAT);
-	
+
 	swjdp->dp_ctrl_stat = CDBGPWRUPREQ | CSYSPWRUPREQ;
 
 	swjdp_write_dpacc(swjdp, swjdp->dp_ctrl_stat, DP_CTRL_STAT);
@@ -1005,11 +1005,11 @@
 	swjdp->dp_ctrl_stat = CDBGPWRUPREQ | CSYSPWRUPREQ | CORUNDETECT;
 	swjdp_write_dpacc(swjdp, swjdp->dp_ctrl_stat, DP_CTRL_STAT);
 	swjdp_read_dpacc(swjdp, &dummy, DP_CTRL_STAT);
-	
+
 	ahbap_read_reg_u32(swjdp, 0xFC, &idreg);
 	ahbap_read_reg_u32(swjdp, 0xF8, &romaddr);
-	
+
 	LOG_DEBUG("AHB-AP ID Register 0x%x, Debug ROM Address 0x%x", idreg, romaddr);
-	
+
 	return ERROR_OK;
 }

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/embeddedice.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -246,7 +246,7 @@
 	u8 field1_out[1];
 	u8 field2_out[1];
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(ice_reg->jtag_info, 0x2);
 
 	arm_jtag_set_instr(ice_reg->jtag_info, ice_reg->jtag_info->intest_instr, NULL);
@@ -309,7 +309,7 @@
 	u8 field1_out[1];
 	u8 field2_out[1];
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0x2);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 
@@ -400,7 +400,7 @@
 
 	LOG_DEBUG("%i: 0x%8.8x", ice_reg->addr, value);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(ice_reg->jtag_info, 0x2);
 
 	arm_jtag_set_instr(ice_reg->jtag_info, ice_reg->jtag_info->intest_instr, NULL);
@@ -426,7 +426,7 @@
 	u8 field1_out[1];
 	u8 field2_out[1];
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0x2);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 
@@ -495,7 +495,7 @@
 	else
 		return ERROR_INVALID_ARGUMENTS;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0x2);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/etb.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -184,7 +184,7 @@
 	scan_field_t fields[3];
 	int i;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	etb_scann(etb, 0x0);
 	etb_set_instr(etb, 0xc);
 
@@ -255,7 +255,7 @@
 
 	LOG_DEBUG("%i", etb_reg->addr);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	etb_scann(etb_reg->etb, 0x0);
 	etb_set_instr(etb_reg->etb, 0xc);
 
@@ -351,7 +351,7 @@
 
 	LOG_DEBUG("%i: 0x%8.8x", etb_reg->addr, value);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	etb_scann(etb_reg->etb, 0x0);
 	etb_set_instr(etb_reg->etb, 0xc);
 

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/etm.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -335,7 +335,7 @@
 
 	LOG_DEBUG("%i", etm_reg->addr);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(etm_reg->jtag_info, 0x6);
 	arm_jtag_set_instr(etm_reg->jtag_info, etm_reg->jtag_info->intest_instr, NULL);
 
@@ -426,7 +426,7 @@
 
 	LOG_DEBUG("%i: 0x%8.8x", etm_reg->addr, value);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(etm_reg->jtag_info, 0x6);
 	arm_jtag_set_instr(etm_reg->jtag_info, etm_reg->jtag_info->intest_instr, NULL);
 

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/feroceon.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -91,7 +91,7 @@
 	.assert_reset = feroceon_assert_reset,
 	.deassert_reset = arm7_9_deassert_reset,
 	.soft_reset_halt = arm926ejs_soft_reset_halt,
-	
+
 	.get_gdb_reg_list = armv4_5_get_gdb_reg_list,
 
 	.read_memory = arm7_9_read_memory,
@@ -99,7 +99,7 @@
 	.bulk_write_memory = feroceon_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
 
 	.add_breakpoint = arm7_9_add_breakpoint,
@@ -121,17 +121,17 @@
 	u8 out_buf[4];
 	u8 instr_buf[4];
 	u8 sysspeed_buf = 0x0;
-	
+
 	/* prepare buffer */
 	buf_set_u32(out_buf, 0, 32, 0);
-	
+
 	buf_set_u32(instr_buf, 0, 32, flip_u32(instr, 32));
-	
-	jtag_add_end_state(TAP_PD);
+
+	jtag_add_end_state(TAP_DRPAUSE);
 	arm_jtag_scann(jtag_info, 0x1);
-	
+
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
@@ -141,7 +141,7 @@
 	fields[0].in_handler_priv = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
-	
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
@@ -151,7 +151,7 @@
 	fields[1].in_check_mask = NULL;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
-		
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
@@ -165,7 +165,7 @@
 	jtag_add_dr_scan(3, fields, -1);
 
 	/* no jtag_add_runtest(0, -1) here */
-	
+
 	return ERROR_OK;
 }
 
@@ -174,9 +174,9 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/*
-	 * save r0 before using it and put system in ARM state 
+	 * save r0 before using it and put system in ARM state
 	 * to allow common handling of ARM and THUMB debugging
 	 */
 
@@ -221,7 +221,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_STMIA(0, mask & 0xffff, 0, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -276,7 +276,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_MRS(0, spsr & 1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -299,7 +299,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr: %8.8x, spsr: %i", xpsr, spsr);
 
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_MSR_IM(xpsr & 0xff, 0, 1, spsr), 0, NULL, 0);
@@ -358,7 +358,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_LDMIA(0, mask & 0xffff, 0, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -390,13 +390,13 @@
 void feroceon_branch_resume_thumb(target_t *target)
 {
 	LOG_DEBUG("-");
-	
+
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
 	u32 r0 = buf_get_u32(armv4_5->core_cache->reg_list[0].value, 0, 32);
 	u32 pc = buf_get_u32(armv4_5->core_cache->reg_list[15].value, 0, 32);
-	(void)(r0); // use R0... 
+	(void)(r0); // use R0...
 
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -411,7 +411,7 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_LDMIA(0, 0x1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
- 
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, pc, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
@@ -523,7 +523,7 @@
 	 * We can't use the dcc flow control bits, so let's transfer data
 	 * with 31 bits and flip the MSB each time a new data word is sent.
 	 */
-	static u32 dcc_code[] = 
+	static u32 dcc_code[] =
 	{
 		0xee115e10,	/* 3:	mrc	p14, 0, r5, c1, c0, 0	*/
 		0xe3a0301e,	/* 1:	mov	r3, #30			*/
@@ -586,7 +586,7 @@
 	armv4_5->core_cache->reg_list[0].dirty = 1;
 	armv4_5->core_state = ARMV4_5_STATE_ARM;
 
-	embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], 0); 
+	embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], 0);
 	arm7_9_resume(target, 0, arm7_9->dcc_working_area->address, 1, 1);
 
 	/* send data over */
@@ -597,12 +597,12 @@
 	{
 		u32 y = target_buffer_get_u32(target, buffer);
 		u32 z = (x >> 1) | (y >> shift) | (flip ^= 0x80000000);
-		embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], z); 
+		embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], z);
 		x = y << (32 - shift);
 		if (++shift >= 32 || i + 1 >= count)
 		{
 			z = (x >> 1) | (flip ^= 0x80000000);
-			embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], z); 
+			embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], z);
 			x = 0;
 			shift = 1;
 		}
@@ -644,7 +644,7 @@
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
 	arm926ejs_common_t *arm926ejs = calloc(1,sizeof(arm926ejs_common_t));
-  
+
 	arm926ejs_init_arch_info(target, arm926ejs, target->tap, target->variant);
 
 	armv4_5 = target->arch_info;
@@ -678,8 +678,8 @@
 	arm7_9->set_special_dbgrq = feroceon_set_dbgrq;
 
 	/* only one working comparator */
-	arm7_9->wp_available_max = 1; 
-	arm7_9->wp1_used_default = -1; 
+	arm7_9->wp_available_max = 1;
+	arm7_9->wp1_used_default = -1;
 
 	return ERROR_OK;
 }
@@ -694,27 +694,27 @@
 	retval = arm9tdmi_examine(target);
 	if (retval!=ERROR_OK)
 		return retval;
-			
+
 	armv4_5 = target->arch_info;
 	arm7_9 = armv4_5->arch_info;
-	
+
 	/* the COMMS_CTRL bits are all contiguous */
 	if (buf_get_u32(arm7_9->eice_cache->reg_list[EICE_COMMS_CTRL].value, 2, 4) != 6)
 		LOG_ERROR("unexpected Feroceon EICE version signature");
-	
-	arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].size = 6; 
-	arm7_9->eice_cache->reg_list[EICE_DBG_STAT].size = 5; 
+
+	arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].size = 6;
+	arm7_9->eice_cache->reg_list[EICE_DBG_STAT].size = 5;
 	arm7_9->has_monitor_mode = 1;
-	
+
 	/* vector catch reg is not initialized on reset */
 	embeddedice_set_reg(&arm7_9->eice_cache->reg_list[EICE_VEC_CATCH], 0);
-	
+
 	/* clear monitor mode, enable comparators */
 	embeddedice_read_reg(&arm7_9->eice_cache->reg_list[EICE_DBG_CTRL]);
-	jtag_execute_queue(); 
+	jtag_execute_queue();
 	buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 4, 1, 0);
-	buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 5, 1, 0); 
+	buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 5, 1, 0);
 	embeddedice_store_reg(&arm7_9->eice_cache->reg_list[EICE_DBG_CTRL]);
-	
+
 	return ERROR_OK;
 }

Modified: trunk/src/target/mips_ejtag.c
===================================================================
--- trunk/src/target/mips_ejtag.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/mips_ejtag.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -65,7 +65,7 @@
 {
 	scan_field_t field;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	mips_ejtag_set_instr(ejtag_info, EJTAG_INST_IDCODE, NULL);
 
@@ -92,7 +92,7 @@
 {
 	scan_field_t field;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	mips_ejtag_set_instr(ejtag_info, EJTAG_INST_IMPCODE, NULL);
 
@@ -202,7 +202,7 @@
 int mips_ejtag_enter_debug(mips_ejtag_t *ejtag_info)
 {
 	u32 ejtag_ctrl;
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	mips_ejtag_set_instr(ejtag_info, EJTAG_INST_CONTROL, NULL);
 
 	/* set debug break bit */

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/mips_m4k.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -67,7 +67,7 @@
 	.assert_reset = mips_m4k_assert_reset,
 	.deassert_reset = mips_m4k_deassert_reset,
 	.soft_reset_halt = mips_m4k_soft_reset_halt,
-	
+
 	.get_gdb_reg_list = mips32_get_gdb_reg_list,
 
 	.read_memory = mips_m4k_read_memory,
@@ -75,7 +75,7 @@
 	.bulk_write_memory = mips_m4k_bulk_write_memory,
 	.checksum_memory = NULL,
 	.blank_check_memory = NULL,
-	
+
 	.run_algorithm = mips32_run_algorithm,
 
 	.add_breakpoint = mips_m4k_add_breakpoint,
@@ -91,10 +91,10 @@
 };
 
 int mips_m4k_examine_debug_reason(target_t *target)
-{	
+{
 	int break_status;
 	int retval;
-	
+
 	if ((target->debug_reason != DBG_REASON_DBGRQ)
 		&& (target->debug_reason != DBG_REASON_SINGLESTEP))
 	{
@@ -108,7 +108,7 @@
 				return retval;
 			target->debug_reason = DBG_REASON_BREAKPOINT;
 		}
-		
+
 		/* get info about data breakpoint support */
 		if ((retval = target_read_u32(target, 0xFF302000, &break_status)) != ERROR_OK)
 			return retval;
@@ -120,7 +120,7 @@
 			target->debug_reason = DBG_REASON_WATCHPOINT;
 		}
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -129,29 +129,29 @@
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	u32 debug_reg;
-	
+
 	/* read debug register */
 	mips_ejtag_read_debug(ejtag_info, &debug_reg);
-	
+
 	/* make sure break uit configured */
 	mips32_configure_break_unit(target);
-	
+
 	/* attempt to find halt reason */
 	mips_m4k_examine_debug_reason(target);
-	
+
 	/* clear single step if active */
 	if (debug_reg & EJTAG_DEBUG_DSS)
 	{
 		/* stopped due to single step - clear step bit */
 		mips_ejtag_config_step(ejtag_info, 0);
 	}
-	
+
 	mips32_save_context(target);
-	
-	LOG_DEBUG("entered debug state at PC 0x%x, target->state: %s", 
-		*(u32*)(mips32->core_cache->reg_list[MIPS32_PC].value), 
+
+	LOG_DEBUG("entered debug state at PC 0x%x, target->state: %s",
+		*(u32*)(mips32->core_cache->reg_list[MIPS32_PC].value),
 		  Jim_Nvp_value2name_simple( nvp_target_state, target->state )->name);
-	
+
 	return ERROR_OK;
 }
 
@@ -161,48 +161,48 @@
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	u32 ejtag_ctrl = ejtag_info->ejtag_ctrl;
-	
+
 	/* read ejtag control reg */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	mips_ejtag_set_instr(ejtag_info, EJTAG_INST_CONTROL, NULL);
 	mips_ejtag_drscan_32(ejtag_info, &ejtag_ctrl);
-	
+
 	/* clear this bit before handling polling
 	 * as after reset registers will read zero */
 	if (ejtag_ctrl & EJTAG_CTRL_ROCC)
 	{
 		/* we have detected a reset, clear flag
 		 * otherwise ejtag will not work */
-		jtag_add_end_state(TAP_RTI);
+		jtag_add_end_state(TAP_IDLE);
 		ejtag_ctrl = ejtag_info->ejtag_ctrl & ~EJTAG_CTRL_ROCC;
-		
+
 		mips_ejtag_set_instr(ejtag_info, EJTAG_INST_CONTROL, NULL);
 		mips_ejtag_drscan_32(ejtag_info, &ejtag_ctrl);
 		LOG_DEBUG("Reset Detected");
 	}
-	
+
 	/* check for processor halted */
 	if (ejtag_ctrl & EJTAG_CTRL_BRKST)
 	{
 		if ((target->state == TARGET_RUNNING) || (target->state == TARGET_RESET))
 		{
-			jtag_add_end_state(TAP_RTI);
+			jtag_add_end_state(TAP_IDLE);
 			mips_ejtag_set_instr(ejtag_info, EJTAG_INST_NORMALBOOT, NULL);
-			
+
 			target->state = TARGET_HALTED;
-			
+
 			if ((retval = mips_m4k_debug_entry(target)) != ERROR_OK)
 				return retval;
-			
+
 			target_call_event_callbacks(target, TARGET_EVENT_HALTED);
 		}
 		else if (target->state == TARGET_DEBUG_RUNNING)
 		{
 			target->state = TARGET_HALTED;
-			
+
 			if ((retval = mips_m4k_debug_entry(target)) != ERROR_OK)
 				return retval;
-			
+
 			target_call_event_callbacks(target, TARGET_EVENT_DEBUG_HALTED);
 		}
 	}
@@ -210,9 +210,9 @@
 	{
 		target->state = TARGET_RUNNING;
 	}
-	
+
 //	LOG_DEBUG("ctrl=0x%08X", ejtag_ctrl);
-	
+
 	return ERROR_OK;
 }
 
@@ -220,22 +220,22 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
-	
-	LOG_DEBUG("target->state: %s", 
+
+	LOG_DEBUG("target->state: %s",
 		  Jim_Nvp_value2name_simple( nvp_target_state, target->state )->name);
-	
+
 	if (target->state == TARGET_HALTED)
 	{
 		LOG_DEBUG("target was already halted");
 		return ERROR_OK;
 	}
-	
+
 	if (target->state == TARGET_UNKNOWN)
 	{
 		LOG_WARNING("target was in unknown state when halt was requested");
 	}
-	
-	if (target->state == TARGET_RESET) 
+
+	if (target->state == TARGET_RESET)
 	{
 		if ((jtag_reset_config & RESET_SRST_PULLS_TRST) && jtag_srst)
 		{
@@ -248,16 +248,16 @@
 			 * debug entry was already prepared in mips32_prepare_reset_halt()
 			 */
 			target->debug_reason = DBG_REASON_DBGRQ;
-			
+
 			return ERROR_OK;
 		}
 	}
-	
+
 	/* break processor */
 	mips_ejtag_enter_debug(ejtag_info);
-	
+
 	target->debug_reason = DBG_REASON_DBGRQ;
-	
+
 	return ERROR_OK;
 }
 
@@ -266,28 +266,28 @@
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	mips_m4k_common_t *mips_m4k = mips32->arch_info;
-	
-	LOG_DEBUG("target->state: %s", 
+
+	LOG_DEBUG("target->state: %s",
 		Jim_Nvp_value2name_simple( nvp_target_state, target->state )->name);
-	
+
 	if (!(jtag_reset_config & RESET_HAS_SRST))
 	{
 		LOG_ERROR("Can't assert SRST");
 		return ERROR_FAIL;
 	}
-	
+
 	if (target->reset_halt)
 	{
 		/* use hardware to catch reset */
-		jtag_add_end_state(TAP_RTI);
+		jtag_add_end_state(TAP_IDLE);
 		mips_ejtag_set_instr(ejtag_info, EJTAG_INST_EJTAGBOOT, NULL);
 	}
 	else
 	{
-		jtag_add_end_state(TAP_RTI);
+		jtag_add_end_state(TAP_IDLE);
 		mips_ejtag_set_instr(ejtag_info, EJTAG_INST_NORMALBOOT, NULL);
 	}
-	
+
 	if (strcmp(mips_m4k->variant, "ejtag_srst") == 0)
 	{
 		u32 ejtag_ctrl = ejtag_info->ejtag_ctrl | EJTAG_CTRL_PRRST | EJTAG_CTRL_PERRST;
@@ -307,7 +307,7 @@
 			jtag_add_reset(0, 1);
 		}
 	}
-	
+
 	target->state = TARGET_RESET;
 	jtag_add_sleep(50000);
 
@@ -319,18 +319,18 @@
 		if ((retval = target_halt(target))!=ERROR_OK)
 			return retval;
 	}
-	
+
 	return ERROR_OK;
 }
 
 int mips_m4k_deassert_reset(target_t *target)
 {
-	LOG_DEBUG("target->state: %s", 
+	LOG_DEBUG("target->state: %s",
 		Jim_Nvp_value2name_simple( nvp_target_state, target->state )->name);
-	
+
 	/* deassert reset lines */
 	jtag_add_reset(0, 0);
-	
+
 	return ERROR_OK;
 }
 
@@ -344,15 +344,15 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
-	
+
 	/* configure single step mode */
 	mips_ejtag_config_step(ejtag_info, 1);
-	
+
 	/* exit debug mode */
 	mips_ejtag_exit_debug(ejtag_info, 1);
-	
+
 	mips_m4k_debug_entry(target);
-	
+
 	return ERROR_OK;
 }
 
@@ -362,20 +362,20 @@
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	breakpoint_t *breakpoint = NULL;
 	u32 resume_pc;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_WARNING("target not halted");
 		return ERROR_TARGET_NOT_HALTED;
 	}
-	
+
 	if (!debug_execution)
 	{
 		target_free_all_working_areas(target);
 		mips_m4k_enable_breakpoints(target);
 		mips_m4k_enable_watchpoints(target);
 	}
-	
+
 	/* current = 1: continue on current pc, otherwise continue at <address> */
 	if (!current)
 	{
@@ -383,11 +383,11 @@
 		mips32->core_cache->reg_list[MIPS32_PC].dirty = 1;
 		mips32->core_cache->reg_list[MIPS32_PC].valid = 1;
 	}
-	
+
 	resume_pc = buf_get_u32(mips32->core_cache->reg_list[MIPS32_PC].value, 0, 32);
-	
+
 	mips32_restore_context(target);
-	
+
 	/* the front-end may request us not to handle breakpoints */
 	if (handle_breakpoints)
 	{
@@ -400,14 +400,14 @@
 			mips_m4k_set_breakpoint(target, breakpoint);
 		}
 	}
-	
+
 	/* exit debug mode - enable interrupts if required */
 	mips_ejtag_exit_debug(ejtag_info, !debug_execution);
 	target->debug_reason = DBG_REASON_NOTHALTED;
-	
+
 	/* registers are now invalid */
 	mips32_invalidate_core_regs(target);
-	
+
 	if (!debug_execution)
 	{
 		target->state = TARGET_RUNNING;
@@ -420,7 +420,7 @@
 		target_call_event_callbacks(target, TARGET_EVENT_DEBUG_RESUMED);
 		LOG_DEBUG("target debug resumed at 0x%x", resume_pc);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -440,43 +440,43 @@
 	/* current = 1: continue on current pc, otherwise continue at <address> */
 	if (!current)
 		buf_set_u32(mips32->core_cache->reg_list[MIPS32_PC].value, 0, 32, address);
-	
+
 	/* the front-end may request us not to handle breakpoints */
 	if (handle_breakpoints)
 		if ((breakpoint = breakpoint_find(target, buf_get_u32(mips32->core_cache->reg_list[MIPS32_PC].value, 0, 32))))
 			mips_m4k_unset_breakpoint(target, breakpoint);
-	
+
 	/* restore context */
 	mips32_restore_context(target);
-	
+
 	/* configure single step mode */
 	mips_ejtag_config_step(ejtag_info, 1);
-	
+
 	target->debug_reason = DBG_REASON_SINGLESTEP;
-	
+
 	target_call_event_callbacks(target, TARGET_EVENT_RESUMED);
-	
+
 	/* exit debug mode */
 	mips_ejtag_exit_debug(ejtag_info, 1);
-	
+
 	/* registers are now invalid */
 	mips32_invalidate_core_regs(target);
-	
+
 	if (breakpoint)
 		mips_m4k_set_breakpoint(target, breakpoint);
 
 	LOG_DEBUG("target stepped ");
-	
+
 	mips_m4k_debug_entry(target);
 	target_call_event_callbacks(target, TARGET_EVENT_HALTED);
-	
+
 	return ERROR_OK;
 }
 
 void mips_m4k_enable_breakpoints(struct target_s *target)
 {
 	breakpoint_t *breakpoint = target->breakpoints;
-	
+
 	/* set any pending breakpoints */
 	while (breakpoint)
 	{
@@ -490,17 +490,17 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips32_comparator_t * comparator_list = mips32->inst_break_list;
-	
+
 	if (breakpoint->set)
 	{
 		LOG_WARNING("breakpoint already set");
 		return ERROR_OK;
 	}
-	
+
 	if (breakpoint->type == BKPT_HARD)
 	{
 		int bp_num = 0;
-		
+
 		while(comparator_list[bp_num].used && (bp_num < mips32->num_inst_bpoints))
 			bp_num++;
 		if (bp_num >= mips32->num_inst_bpoints)
@@ -521,7 +521,7 @@
 	{
 
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -536,7 +536,7 @@
 		LOG_WARNING("breakpoint not set");
 		return ERROR_OK;
 	}
-	
+
 	if (breakpoint->type == BKPT_HARD)
 	{
 		int bp_num = breakpoint->set - 1;
@@ -554,26 +554,26 @@
 
 	}
 	breakpoint->set = 0;
-	
+
 	return ERROR_OK;
 }
 
 int mips_m4k_add_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
 {
 	mips32_common_t *mips32 = target->arch_info;
-	
+
 	if (mips32->num_inst_bpoints_avail < 1)
 	{
 		LOG_INFO("no hardware breakpoint available");
 		return ERROR_TARGET_RESOURCE_NOT_AVAILABLE;
 	}
-	
+
 	/* default to hardware for now */
 	breakpoint->type = BKPT_HARD;
-	
+
 	mips32->num_inst_bpoints_avail--;
 	mips_m4k_set_breakpoint(target, breakpoint);
-	
+
 	return ERROR_OK;
 }
 
@@ -581,21 +581,21 @@
 {
 	/* get pointers to arch-specific information */
 	mips32_common_t *mips32 = target->arch_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_WARNING("target not halted");
 		return ERROR_TARGET_NOT_HALTED;
 	}
-	
+
 	if (breakpoint->set)
 	{
 		mips_m4k_unset_breakpoint(target, breakpoint);
 	}
-	
+
 	if (breakpoint->type == BKPT_HARD)
 		mips32->num_inst_bpoints_avail++;
-	
+
 	return ERROR_OK;
 }
 
@@ -626,7 +626,7 @@
 void mips_m4k_enable_watchpoints(struct target_s *target)
 {
 	watchpoint_t *watchpoint = target->watchpoints;
-	
+
 	/* set any pending watchpoints */
 	while (watchpoint)
 	{
@@ -640,7 +640,7 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
-	
+
 	LOG_DEBUG("address: 0x%8.8x, size: 0x%8.8x, count: 0x%8.8x", address, size, count);
 
 	if (target->state != TARGET_HALTED)
@@ -655,7 +655,7 @@
 
 	if (((size == 4) && (address & 0x3u)) || ((size == 2) && (address & 0x1u)))
 		return ERROR_TARGET_UNALIGNED_ACCESS;
-	
+
 	switch (size)
 	{
 		case 4:
@@ -679,7 +679,7 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
-	
+
 	LOG_DEBUG("address: 0x%8.8x, size: 0x%8.8x, count: 0x%8.8x", address, size, count);
 
 	if (target->state != TARGET_HALTED)
@@ -694,7 +694,7 @@
 
 	if (((size == 4) && (address & 0x3u)) || ((size == 2) && (address & 0x1u)))
 		return ERROR_TARGET_UNALIGNED_ACCESS;
-	
+
 	switch (size)
 	{
 		case 4:
@@ -711,14 +711,14 @@
 			exit(-1);
 			break;
 	}
-	
+
 	return ERROR_OK;
 }
 
 int mips_m4k_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
-	
+
 	retval = mips32_register_commands(cmd_ctx);
 	return retval;
 }
@@ -726,7 +726,7 @@
 int mips_m4k_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
 	mips32_build_reg_cache(target);
-	
+
 	return ERROR_OK;
 }
 
@@ -738,7 +738,7 @@
 int mips_m4k_init_arch_info(target_t *target, mips_m4k_common_t *mips_m4k, jtag_tap_t *tap, const char *variant)
 {
 	mips32_common_t *mips32 = &mips_m4k->mips32_common;
-	
+
 	if (variant)
 	{
 		mips_m4k->variant = strdup(variant);
@@ -747,22 +747,22 @@
 	{
 		mips_m4k->variant = strdup("");
 	}
-	
+
 	mips_m4k->common_magic = MIPSM4K_COMMON_MAGIC;
-	
+
 	/* initialize mips4k specific info */
 	mips32_init_arch_info(target, mips32, tap, variant);
 	mips32->arch_info = mips_m4k;
-	
+
 	return ERROR_OK;
 }
 
 int mips_m4k_target_create(struct target_s *target, Jim_Interp *interp)
 {
 	mips_m4k_common_t *mips_m4k = calloc(1,sizeof(mips_m4k_common_t));
-	
+
 	mips_m4k_init_arch_info(target, mips_m4k, target->tap, target->variant);
-	
+
 	return ERROR_OK;
 }
 
@@ -772,11 +772,11 @@
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	u32 idcode = 0;
-	
+
 	if (!target->type->examined)
 	{
 		mips_ejtag_get_idcode(ejtag_info, &idcode, NULL);
-		
+
 		if (((idcode >> 1) & 0x7FF) == 0x29)
 		{
 			/* we are using a pic32mx so select ejtag port
@@ -785,14 +785,14 @@
 			LOG_DEBUG("PIC32MX Detected - using EJTAG Interface");
 		}
 	}
-	
+
 	/* init rest of ejtag interface */
 	if ((retval = mips_ejtag_init(ejtag_info)) != ERROR_OK)
 		return retval;
-	
+
 	if ((retval = mips32_examine(target)) != ERROR_OK)
 		return retval;
-	
+
 	return ERROR_OK;
 }
 

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/target/xscale.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -252,7 +252,7 @@
 	u8 field2_check_value = 0x0;
 	u8 field2_check_mask = 0x1;
 
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dcsr);
 
 	buf_set_u32(&field0, 1, 1, xscale->hold_rst);
@@ -300,7 +300,7 @@
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
 	fields[1].in_value = NULL;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	jtag_add_dr_scan(3, fields, -1);
 
@@ -332,9 +332,9 @@
 
 	int i;
 
-	path[0] = TAP_SDS;
-	path[1] = TAP_CD;
-	path[2] = TAP_SD;
+	path[0] = TAP_DRSELECT;
+	path[1] = TAP_DRCAPTURE;
+	path[2] = TAP_DRSHIFT;
 
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
@@ -362,9 +362,9 @@
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgtx);
-	jtag_add_runtest(1, -1); /* ensures that we're in the TAP_RTI state as the above could be a no-op */
+	jtag_add_runtest(1, -1); /* ensures that we're in the TAP_IDLE state as the above could be a no-op */
 
 	/* repeat until all words have been collected */
 	int attempts=0;
@@ -379,7 +379,7 @@
 			fields[1].in_handler_priv = (u8*)&field1[i];
 
 			jtag_add_pathmove(3, path);
-			jtag_add_dr_scan(3, fields, TAP_RTI);
+			jtag_add_dr_scan(3, fields, TAP_IDLE);
 			words_scheduled++;
 		}
 
@@ -442,20 +442,20 @@
 	u8 field2_check_value = 0x0;
 	u8 field2_check_mask = 0x1;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgtx);
 
-	path[0] = TAP_SDS;
-	path[1] = TAP_CD;
-	path[2] = TAP_SD;
+	path[0] = TAP_DRSELECT;
+	path[1] = TAP_DRCAPTURE;
+	path[2] = TAP_DRSHIFT;
 
-	noconsume_path[0] = TAP_SDS;
-	noconsume_path[1] = TAP_CD;
-	noconsume_path[2] = TAP_E1D;
-	noconsume_path[3] = TAP_PD;
-	noconsume_path[4] = TAP_E2D;
-	noconsume_path[5] = TAP_SD;
+	noconsume_path[0] = TAP_DRSELECT;
+	noconsume_path[1] = TAP_DRCAPTURE;
+	noconsume_path[2] = TAP_DREXIT1;
+	noconsume_path[3] = TAP_DRPAUSE;
+	noconsume_path[4] = TAP_DREXIT2;
+	noconsume_path[5] = TAP_DRSHIFT;
 
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
@@ -499,7 +499,7 @@
 			jtag_add_pathmove(sizeof(noconsume_path)/sizeof(*noconsume_path), noconsume_path);
 		}
 
-		jtag_add_dr_scan(3, fields, TAP_RTI);
+		jtag_add_dr_scan(3, fields, TAP_IDLE);
 
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
@@ -551,7 +551,7 @@
 	u8 field2_check_value = 0x0;
 	u8 field2_check_mask = 0x1;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgrx);
 
@@ -588,7 +588,7 @@
 	LOG_DEBUG("polling RX");
 	for (;;)
 	{
-		jtag_add_dr_scan(3, fields, TAP_RTI);
+		jtag_add_dr_scan(3, fields, TAP_IDLE);
 
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
@@ -617,7 +617,7 @@
 
 	/* set rx_valid */
 	field2 = 0x1;
-	jtag_add_dr_scan(3, fields, TAP_RTI);
+	jtag_add_dr_scan(3, fields, TAP_IDLE);
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -640,7 +640,7 @@
 
 	int done_count = 0;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgrx);
 
@@ -683,7 +683,7 @@
 				3,
 				bits,
 				t,
-				TAP_RTI);
+				TAP_IDLE);
 		buffer += size;
 	}
 
@@ -726,7 +726,7 @@
 	if (ext_dbg_brk != -1)
 		xscale->external_debug_break = ext_dbg_brk;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dcsr);
 
 	buf_set_u32(&field0, 1, 1, xscale->hold_rst);
@@ -796,7 +796,7 @@
 
 	LOG_DEBUG("loading miniIC at 0x%8.8x", va);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.ldic); /* LDIC */
 
 	/* CMD is b010 for Main IC and b011 for Mini IC */
@@ -859,7 +859,7 @@
 
 	scan_field_t fields[2];
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.ldic); /* LDIC */
 
 	/* CMD for invalidate IC line b000, bits [6:4] b000 */
@@ -1597,7 +1597,7 @@
 	/* select DCSR instruction (set endstate to R-T-I to ensure we don't
 	 * end up in T-L-R, which would reset JTAG
 	 */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dcsr);
 
 	/* set Hold reset, Halt mode and Trap Reset */
@@ -1620,7 +1620,7 @@
 
     if (target->reset_halt)
     {
-    	int retval;
+	int retval;
 		if ((retval = target_halt(target))!=ERROR_OK)
 			return retval;
     }
@@ -1671,7 +1671,7 @@
 		/* wait 300ms; 150 and 100ms were not enough */
 		jtag_add_sleep(300*1000);
 
-		jtag_add_runtest(2030, TAP_RTI);
+		jtag_add_runtest(2030, TAP_IDLE);
 		jtag_execute_queue();
 
 		/* set Hold reset, Halt mode and Trap Reset */
@@ -1734,7 +1734,7 @@
 		xscale_load_ic(target, 1, 0x0, xscale->low_vectors);
 		xscale_load_ic(target, 1, 0xffff0000, xscale->high_vectors);
 
-		jtag_add_runtest(30, TAP_RTI);
+		jtag_add_runtest(30, TAP_IDLE);
 
 		jtag_add_sleep(100000);
 
@@ -3381,7 +3381,7 @@
 		command_print(cmd_ctx, "icache %s", (xscale->armv4_5_mmu.armv4_5_cache.i_cache_enabled) ? "enabled" : "disabled");
 
 	if (dcache)
-	 	command_print(cmd_ctx, "dcache %s", (xscale->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled) ? "enabled" : "disabled");
+		command_print(cmd_ctx, "dcache %s", (xscale->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled) ? "enabled" : "disabled");
 
 	return ERROR_OK;
 }

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2008-12-12 22:14:21 UTC (rev 1231)
+++ trunk/src/xsvf/xsvf.c	2008-12-13 06:25:50 UTC (rev 1232)
@@ -62,9 +62,9 @@
 
 enum tap_state xsvf_to_tap[] =
 {
-	TAP_TLR, TAP_RTI,
-	TAP_SDS, TAP_CD, TAP_SD, TAP_E1D, TAP_PD, TAP_E2D, TAP_UD,
-	TAP_SIS, TAP_CI, TAP_SI, TAP_E1I, TAP_PI, TAP_E2I, TAP_UI,
+	TAP_RESET, TAP_IDLE,
+	TAP_DRSELECT, TAP_DRCAPTURE, TAP_DRSHIFT, TAP_DREXIT1, TAP_DRPAUSE, TAP_DREXIT2, TAP_DRUPDATE,
+	TAP_IRSELECT, TAP_IRCAPTURE, TAP_IRSHIFT, TAP_IREXIT1, TAP_IRPAUSE, TAP_IREXIT2, TAP_IRUPDATE,
 };
 
 int tap_to_xsvf[] =
@@ -76,23 +76,23 @@
 /* xsvf has it's own definition of a statemove. This needs
  * to be handled according to the specs, which has nothing
  * to do with the JTAG spec or OpenOCD as such.
- * 
+ *
  * Implemented via jtag_add_pathmove().
  */
 void xsvf_add_statemove(enum tap_state state)
 {
 	enum tap_state moves[7]; /* max # of transitions */
-	int i; 
+	int i;
 	enum tap_state curstate = cmd_queue_cur_state;
 	u8 move = TAP_MOVE(cmd_queue_cur_state, state);
-	
-	if ((state != TAP_TLR) && (state == cmd_queue_cur_state))
+
+	if ((state != TAP_RESET) && (state == cmd_queue_cur_state))
 		return;
 
-	if(state==TAP_TLR) 
+	if(state==TAP_RESET)
 	{
-		jtag_add_tlr(); 
-		return; 
+		jtag_add_tlr();
+		return;
 	}
 	for (i=0; i<7; i++)
 	{
@@ -135,7 +135,7 @@
 {
 	char c;
 	unsigned char uc;
-	
+
 	while ((read(fd, &c, 1) > 0) && (c == 0x12))
 	{
 		if (*path_len > max_path)
@@ -149,9 +149,9 @@
 		}
 		path[(*path_len)++] = xsvf_to_tap[uc];
 	}
-	
+
 	lseek(fd, -1, SEEK_CUR);
-	
+
 	return ERROR_OK;
 }
 
@@ -166,9 +166,9 @@
 	int do_abort = 0;
 	int unsupported = 0;
 	int tdo_mismatch = 0;
-	
+
 	int runtest_requires_tck = 0;
-	
+
 	jtag_tap_t *tap = NULL;
 	/* use NULL to indicate a "plain" xsvf file which accounts for
 	   additional devices in the scan chain, otherwise the device
@@ -194,7 +194,7 @@
 		command_print(cmd_ctx, "file %s not found", args[0]);
 		return ERROR_OK;
 	}
-	
+
 	if ((argc > 2) && (strcmp(args[2], "virt2") == 0))
 	{
 		runtest_requires_tck = 1;
@@ -209,7 +209,7 @@
 				if (jtag_execute_queue() != ERROR_OK)
 				{
 					tdo_mismatch = 1;
-					break;	
+					break;
 				}
 				break;
 			case 0x01:	/* XTDOMASK */
@@ -239,9 +239,9 @@
 						field.in_handler = NULL;
 						field.in_handler_priv = NULL;
 						if (tap == NULL)
-							jtag_add_plain_ir_scan(1, &field, TAP_PI);
+							jtag_add_plain_ir_scan(1, &field, TAP_IRPAUSE);
 						else
-							jtag_add_ir_scan(1, &field, TAP_PI);
+							jtag_add_ir_scan(1, &field, TAP_IRPAUSE);
 						if (jtag_execute_queue() != ERROR_OK)
 						{
 							tdo_mismatch = 1;
@@ -254,7 +254,7 @@
 								jtag_add_runtest(xruntest, xsvf_to_tap[xendir]);
 							else
 							{
-								xsvf_add_statemove(TAP_RTI);
+								xsvf_add_statemove(TAP_IDLE);
 								jtag_add_sleep(xruntest);
 								xsvf_add_statemove(xsvf_to_tap[xendir]);
 							}
@@ -279,13 +279,13 @@
 					field.in_value = NULL;
 					jtag_set_check_value(&field, dr_in_buf, dr_in_mask, NULL);
 					if (tap == NULL)
-						jtag_add_plain_dr_scan(1, &field, TAP_PD);
+						jtag_add_plain_dr_scan(1, &field, TAP_DRPAUSE);
 					else
-						jtag_add_dr_scan(1, &field, TAP_PD);
+						jtag_add_dr_scan(1, &field, TAP_DRPAUSE);
 					if (jtag_execute_queue() != ERROR_OK)
 					{
 						tdo_mismatch = 1;
-						break;	
+						break;
 					}
 					if (xruntest)
 					{
@@ -293,7 +293,7 @@
 							jtag_add_runtest(xruntest, xsvf_to_tap[xenddr]);
 						else
 						{
-							xsvf_add_statemove(TAP_RTI);
+							xsvf_add_statemove(TAP_IDLE);
 							jtag_add_sleep(xruntest);
 							xsvf_add_statemove(xsvf_to_tap[xenddr]);
 						}
@@ -353,13 +353,13 @@
 						field.in_value = NULL;
 						jtag_set_check_value(&field, dr_in_buf, dr_in_mask, NULL);
 						if (tap == NULL)
-							jtag_add_plain_dr_scan(1, &field, TAP_PD);
+							jtag_add_plain_dr_scan(1, &field, TAP_DRPAUSE);
 						else
-							jtag_add_dr_scan(1, &field, TAP_PD);
+							jtag_add_dr_scan(1, &field, TAP_DRPAUSE);
 						if (jtag_execute_queue() != ERROR_OK)
 						{
 							tdo_mismatch = 1;
-							break;	
+							break;
 						}
 						if (xruntest)
 						{
@@ -367,7 +367,7 @@
 								jtag_add_runtest(xruntest, xsvf_to_tap[xenddr]);
 							else
 							{
-								xsvf_add_statemove(TAP_RTI);
+								xsvf_add_statemove(TAP_IDLE);
 								jtag_add_sleep(xruntest);
 								xsvf_add_statemove(xsvf_to_tap[xenddr]);
 							}
@@ -418,14 +418,14 @@
 					{
 						int i,lasti;
 						/* here the trick is that jtag_add_pathmove() must end in a stable
-						state, so we must only invoke jtag_add_tlr() when we absolutely 
+						state, so we must only invoke jtag_add_tlr() when we absolutely
 						have to
 						*/
-						for(i=0,lasti=0;i<path_len;i++) 
+						for(i=0,lasti=0;i<path_len;i++)
 						{
-							if(path[i]==TAP_TLR) 
+							if(path[i]==TAP_RESET)
 							{
-								if(i>lasti)  
+								if(i>lasti)
 								{
 									jtag_add_pathmove(i-lasti,path+lasti);
 								}
@@ -433,7 +433,7 @@
 								jtag_add_tlr();
 							}
 						}
-						if(i>=lasti) 
+						if(i>=lasti)
 						{
 							jtag_add_pathmove(i-lasti, path+lasti);
 						}
@@ -536,7 +536,7 @@
 		if (do_abort || unsupported || tdo_mismatch)
 			break;
 	}
-	
+
 	if (tdo_mismatch)
 	{
 		command_print(cmd_ctx, "TDO mismatch, aborting");
@@ -554,18 +554,18 @@
 		command_print(cmd_ctx, "premature end detected, aborting");
 		return ERROR_OK;
 	}
-	
+
 	if (dr_out_buf)
 		free(dr_out_buf);
-	
+
 	if (dr_in_buf)
 		free(dr_in_buf);
-	
+
 	if (dr_in_mask)
 		free(dr_in_mask);
 
 	close(xsvf_fd);
-	
+
 	command_print(cmd_ctx, "XSVF file programmed successfully");
 
 	return ERROR_OK;



From kc8apf at mail.berlios.de  Sat Dec 13 07:28:28 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Sat, 13 Dec 2008 07:28:28 +0100
Subject: [Openocd-svn] r1233 - /
Message-ID: <200812130628.mBD6SSvQ015456@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-13 07:28:23 +0100 (Sat, 13 Dec 2008)
New Revision: 1233

Added:
   branches/
   tags/
Removed:
   openocd/
Log:
Back to openocd being the top-level project

Copied: branches (from rev 1231, openocd/branches)

Copied: tags (from rev 1231, openocd/tags)



From kc8apf at mail.berlios.de  Sat Dec 13 07:29:51 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Sat, 13 Dec 2008 07:29:51 +0100
Subject: [Openocd-svn] r1234 - branches
Message-ID: <200812130629.mBD6TpDA025152@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-13 07:29:47 +0100 (Sat, 13 Dec 2008)
New Revision: 1234

Removed:
   branches/cortex-m3/
   branches/mips/
   branches/xscale-ixp-be/
   branches/xscale/
Log:
Remove obsolete branches



From kc8apf at mail.berlios.de  Sat Dec 13 07:59:35 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Sat, 13 Dec 2008 07:59:35 +0100
Subject: [Openocd-svn] r1235 - in trunk/src: flash jtag target
Message-ID: <200812130659.mBD6xZVr028889@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-13 07:59:24 +0100 (Sat, 13 Dec 2008)
New Revision: 1235

Modified:
   trunk/src/flash/str9xpec.c
   trunk/src/jtag/amt_jtagaccel.c
   trunk/src/jtag/bitbang.c
   trunk/src/jtag/bitq.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/jlink.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/usbprog.c
   trunk/src/jtag/zy1000.c
   trunk/src/target/arm11_dbgtap.c
Log:
Clean up references to old tap_state names

Modified: trunk/src/flash/str9xpec.c
===================================================================
--- trunk/src/flash/str9xpec.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/flash/str9xpec.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -1338,7 +1338,7 @@
 	if (tap == NULL)
 		return ERROR_FAIL;
 
-	/* exit turbo mode via TLR */
+	/* exit turbo mode via RESET */
 	str9xpec_set_instr(tap, ISC_NOOP, TAP_RESET);
 	jtag_execute_queue();
 

Modified: trunk/src/jtag/amt_jtagaccel.c
===================================================================
--- trunk/src/jtag/amt_jtagaccel.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/jtag/amt_jtagaccel.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -100,13 +100,13 @@
  */
 u8 amt_jtagaccel_tap_move[6][6][2] =
 {
-	/*	   TLR           RTI              SD            PD            SI            PI             */
-	{{0x1f, 0x00}, {0x0f, 0x00}, {0x8a, 0x04}, {0x0a, 0x00}, {0x06, 0x00}, {0x96, 0x00}},	/* TLR */
-	{{0x1f, 0x00}, {0x00, 0x00}, {0x85, 0x08}, {0x05, 0x00}, {0x8b, 0x08}, {0x0b, 0x00}},	/* RTI */
-	{{0x1f, 0x00}, {0x0d, 0x00}, {0x00, 0x00}, {0x01, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* SD  */
-	{{0x1f, 0x00}, {0x0c, 0x00}, {0x08, 0x00}, {0x00, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* PD  */
-	{{0x1f, 0x00}, {0x0d, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x00, 0x00}, {0x01, 0x00}},	/* SI  */
-	{{0x1f, 0x00}, {0x0c, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x08, 0x00}, {0x00, 0x00}},	/* PI  */
+	/*	   RESET         IDLE        DRSHIFT       DRPAUSE       IRSHIFT       IRPAUSE             */
+	{{0x1f, 0x00}, {0x0f, 0x00}, {0x8a, 0x04}, {0x0a, 0x00}, {0x06, 0x00}, {0x96, 0x00}},	/* RESET */
+	{{0x1f, 0x00}, {0x00, 0x00}, {0x85, 0x08}, {0x05, 0x00}, {0x8b, 0x08}, {0x0b, 0x00}},	/* IDLE */
+	{{0x1f, 0x00}, {0x0d, 0x00}, {0x00, 0x00}, {0x01, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* DRSHIFT  */
+	{{0x1f, 0x00}, {0x0c, 0x00}, {0x08, 0x00}, {0x00, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* DRPAUSE  */
+	{{0x1f, 0x00}, {0x0d, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x00, 0x00}, {0x01, 0x00}},	/* IRSHIFT  */
+	{{0x1f, 0x00}, {0x0c, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x08, 0x00}, {0x00, 0x00}},	/* IRPAUSE  */
 };
 
 jtag_interface_t amt_jtagaccel_interface =
@@ -214,7 +214,7 @@
 
 	enum tap_state saved_end_state = end_state;
 
-	/* only do a state_move when we're not already in RTI */
+	/* only do a state_move when we're not already in IDLE */
 	if (cur_state != TAP_IDLE)
 	{
 		amt_jtagaccel_end_state(TAP_IDLE);

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/jtag/bitbang.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -133,7 +133,7 @@
 
 	enum tap_state saved_end_state = end_state;
 
-	/* only do a state_move when we're not already in RTI */
+	/* only do a state_move when we're not already in IDLE */
 	if (cur_state != TAP_IDLE)
 	{
 		bitbang_end_state(TAP_IDLE);

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/jtag/bitq.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -194,7 +194,7 @@
 {
 	int i;
 
-	/* only do a state_move when we're not already in RTI */
+	/* only do a state_move when we're not already in IDLE */
 	if (cur_state != TAP_IDLE) bitq_state_move(TAP_IDLE);
 
 	/* execute num_cycles */

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/jtag/gw16012.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -257,7 +257,7 @@
 	enum tap_state saved_end_state = end_state;
 	int i;
 
-	/* only do a state_move when we're not already in RTI */
+	/* only do a state_move when we're not already in IDLE */
 	if (cur_state != TAP_IDLE)
 	{
 		gw16012_end_state(TAP_IDLE);

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/jtag/jlink.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -392,7 +392,7 @@
 
 	enum tap_state saved_end_state = end_state;
 
-	/* only do a state_move when we're not already in RTI */
+	/* only do a state_move when we're not already in IDLE */
 	if (cur_state != TAP_IDLE)
 	{
 		jlink_end_state(TAP_IDLE);

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/jtag/jtag.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -67,17 +67,17 @@
  * 4: Shift-IR
  * 5: Pause-IR
  *
- * SD->SD and SI->SI have to be caught in interface specific code
+ * DRSHIFT->DRSHIFT and IRSHIFT->IRSHIFT have to be caught in interface specific code
  */
 u8 tap_move[6][6] =
 {
-/*	  TLR   RTI   SD    PD    SI    PI             */
-	{0x7f, 0x00, 0x17, 0x0a, 0x1b, 0x16},	/* TLR */
-	{0x7f, 0x00, 0x25, 0x05, 0x2b, 0x0b},	/* RTI */
-	{0x7f, 0x31, 0x00, 0x01, 0x0f, 0x2f},	/* SD  */
-	{0x7f, 0x30, 0x20, 0x17, 0x1e, 0x2f},	/* PD  */
-	{0x7f, 0x31, 0x07, 0x17, 0x00, 0x01},	/* SI  */
-	{0x7f, 0x30, 0x1c, 0x17, 0x20, 0x2f}	/* PI  */
+/*	  RESET  IDLE  DRSHIFT  DRPAUSE  IRSHIFT  IRPAUSE             */
+	{  0x7f, 0x00,    0x17,    0x0a,    0x1b,    0x16},	/* RESET */
+	{  0x7f, 0x00,    0x25,    0x05,    0x2b,    0x0b},	/* IDLE */
+	{  0x7f, 0x31,    0x00,    0x01,    0x0f,    0x2f},	/* DRSHIFT  */
+	{  0x7f, 0x30,    0x20,    0x17,    0x1e,    0x2f},	/* DRPAUSE  */
+	{  0x7f, 0x31,    0x07,    0x17,    0x00,    0x01},	/* IRSHIFT  */
+	{  0x7f, 0x30,    0x1c,    0x17,    0x20,    0x2f}	/* IRPAUSE  */
 };
 
 int tap_move_map[16] = {
@@ -87,27 +87,27 @@
 
 tap_transition_t tap_transitions[16] =
 {
-	{TAP_RESET, TAP_IDLE},		/* TLR */
-	{TAP_IRSELECT, TAP_DRCAPTURE},		/* SDS */
-	{TAP_DREXIT1, TAP_DRSHIFT},		/* CD  */
-	{TAP_DREXIT1, TAP_DRSHIFT},		/* SD  */
-	{TAP_DRUPDATE,  TAP_DRPAUSE}, 		/* E1D */
-	{TAP_DREXIT2, TAP_DRPAUSE},		/* PD  */
-	{TAP_DRUPDATE,  TAP_DRSHIFT},		/* E2D */
-	{TAP_DRSELECT, TAP_IDLE},		/* UD  */
-	{TAP_DRSELECT, TAP_IDLE},		/* RTI */
-	{TAP_RESET, TAP_IRCAPTURE},		/* SIS */
-	{TAP_IREXIT1, TAP_IRSHIFT},		/* CI  */
-	{TAP_IREXIT1, TAP_IRSHIFT},		/* SI  */
-	{TAP_IRUPDATE,  TAP_IRPAUSE}, 		/* E1I */
-	{TAP_IREXIT2, TAP_IRPAUSE},		/* PI  */
-	{TAP_IRUPDATE,  TAP_IRSHIFT},		/* E2I */
-	{TAP_DRSELECT, TAP_IDLE}		/* UI  */
+	{TAP_RESET, TAP_IDLE},		/* RESET */
+	{TAP_IRSELECT, TAP_DRCAPTURE},		/* DRSELECT */
+	{TAP_DREXIT1, TAP_DRSHIFT},		/* DRCAPTURE  */
+	{TAP_DREXIT1, TAP_DRSHIFT},		/* DRSHIFT  */
+	{TAP_DRUPDATE,  TAP_DRPAUSE}, 		/* DREXIT1 */
+	{TAP_DREXIT2, TAP_DRPAUSE},		/* DRPAUSE  */
+	{TAP_DRUPDATE,  TAP_DRSHIFT},		/* DREXIT2 */
+	{TAP_DRSELECT, TAP_IDLE},		/* DRUPDATE  */
+	{TAP_DRSELECT, TAP_IDLE},		/* IDLE */
+	{TAP_RESET, TAP_IRCAPTURE},		/* IRSELECT */
+	{TAP_IREXIT1, TAP_IRSHIFT},		/* IRCAPTURE  */
+	{TAP_IREXIT1, TAP_IRSHIFT},		/* IRSHIFT  */
+	{TAP_IRUPDATE,  TAP_IRPAUSE}, 		/* IREXIT1 */
+	{TAP_IREXIT2, TAP_IRPAUSE},		/* IRPAUSE  */
+	{TAP_IRUPDATE,  TAP_IRSHIFT},		/* IREXIT2 */
+	{TAP_DRSELECT, TAP_IDLE}		/* IRUPDATE  */
 };
 
 char* jtag_event_strings[] =
 {
-	"JTAG controller reset (TLR or TRST)"
+	"JTAG controller reset (RESET or TRST)"
 };
 
 /* kludge!!!! these are just global variables that the
@@ -1153,7 +1153,7 @@
 
 	if (trst_with_tlr)
 	{
-		LOG_DEBUG("JTAG reset with TLR instead of TRST");
+		LOG_DEBUG("JTAG reset with RESET instead of TRST");
 		jtag_add_end_state(TAP_RESET);
 		jtag_add_tlr();
 		jtag_call_event_callbacks(JTAG_TRST_ASSERTED);
@@ -1198,7 +1198,7 @@
 	cmd_queue_end_state = state;
 	if ((cmd_queue_end_state == TAP_DRSHIFT)||(cmd_queue_end_state == TAP_IRSHIFT))
 	{
-		LOG_ERROR("BUG: TAP_DRSHIFT/SI can't be end state. Calling code should use a larger scan field");
+		LOG_ERROR("BUG: TAP_DRSHIFT/IRSHIFT can't be end state. Calling code should use a larger scan field");
 	}
 }
 
@@ -2096,11 +2096,11 @@
 	if ((retval=jtag_interface_init(cmd_ctx)) != ERROR_OK)
 		return retval;
 
-	LOG_DEBUG("Trying to bring the JTAG controller to life by asserting TRST / TLR");
+	LOG_DEBUG("Trying to bring the JTAG controller to life by asserting TRST / RESET");
 
 	/* Reset can happen after a power cycle.
 	 *
-	 * Ideally we would only assert TRST or run TLR before the target reset.
+	 * Ideally we would only assert TRST or run RESET before the target reset.
 	 *
 	 * However w/srst_pulls_trst, trst is asserted together with the target
 	 * reset whether we want it or not.
@@ -2113,7 +2113,7 @@
 	 * NB! order matters!!!! srst *can* disconnect JTAG circuitry
 	 *
 	 */
-	jtag_add_reset(1, 0); /* TLR or TRST */
+	jtag_add_reset(1, 0); /* RESET or TRST */
 	if (jtag_reset_config & RESET_HAS_SRST)
 	{
 		jtag_add_reset(1, 1);

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/jtag/jtag.h	2008-12-13 06:59:24 UTC (rev 1235)
@@ -310,7 +310,7 @@
  * upon subsequent invocations
  */
 extern int jtag_interface_init(struct command_context_s *cmd_ctx);
-/* initialize JTAG chain using only a TLR reset. If init fails,
+/* initialize JTAG chain using only a RESET reset. If init fails,
  * try reset + init.
  */
 extern int jtag_init(struct command_context_s *cmd_ctx);
@@ -320,7 +320,7 @@
 
 /* JTAG interface, can be implemented with a software or hardware fifo
  *
- * TAP_DRSHIFT and TAP_IRSHIFT are illegal end states. TAP_DRSHIFT/SI as end states
+ * TAP_DRSHIFT and TAP_IRSHIFT are illegal end states. TAP_DRSHIFT/IRSHIFT as end states
  * can be emulated by using a larger scan.
  *
  * Code that is relatively insensitive to the path(as long

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/jtag/usbprog.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -298,7 +298,7 @@
 {
 	int i;
 
-	/* only do a state_move when we're not already in RTI */
+	/* only do a state_move when we're not already in IDLE */
 	if (cur_state != TAP_IDLE)
 	{
 		usbprog_end_state(TAP_IDLE);

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/jtag/zy1000.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -176,7 +176,7 @@
 	if (trst||(srst&&(jtag_reset_config & RESET_SRST_PULLS_TRST)))
 	{
 		waitIdle();
-		/* we're now in the TLR state until trst is deasserted */
+		/* we're now in the RESET state until trst is deasserted */
 		ZY1000_POKE(ZY1000_JTAG_BASE+0x20, TAP_RESET);
 	} else
 	{

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2008-12-13 06:29:47 UTC (rev 1234)
+++ trunk/src/target/arm11_dbgtap.c	2008-12-13 06:59:24 UTC (rev 1235)
@@ -340,10 +340,10 @@
  * Put arm11_run_instr_data_prepare() and arm11_run_instr_data_finish()
  * around a block of arm11_run_instr_... calls.
  *
- * Any RTI can lead to an instruction execution when
+ * Any IDLE can lead to an instruction execution when
  * scan chains 4 or 5 are selected and the IR holds
  * INTEST or EXTEST. So we must disable that before
- * any following activities lead to an RTI.
+ * any following activities lead to an IDLE.
  *
  * \param arm11 Target state variable.
  *
@@ -471,7 +471,7 @@
  *  the core but still shorter than any manually inducible delays.
  *
  */
-enum tap_state arm11_MOVE_PD_RTI_PD_with_delay[] =
+enum tap_state arm11_MOVE_DRPAUSE_IDLE_DRPAUSE_with_delay[] =
 {
     TAP_DREXIT2, TAP_DRUPDATE, TAP_IDLE, TAP_IDLE, TAP_IDLE, TAP_DRSELECT, TAP_DRCAPTURE, TAP_DRSHIFT
 };
@@ -518,8 +518,8 @@
 	if (count)
 	{
 	    jtag_add_dr_scan(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
-	    jtag_add_pathmove(asizeof(arm11_MOVE_PD_RTI_PD_with_delay),
-		arm11_MOVE_PD_RTI_PD_with_delay);
+	    jtag_add_pathmove(asizeof(arm11_MOVE_DRPAUSE_IDLE_DRPAUSE_with_delay),
+		arm11_MOVE_DRPAUSE_IDLE_DRPAUSE_with_delay);
 	}
 	else
 	{



From kc8apf at mail.berlios.de  Sat Dec 13 08:04:06 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Sat, 13 Dec 2008 08:04:06 +0100
Subject: [Openocd-svn] r1236 - in branches/openocd_1_0_branch: . doc
	src/flash src/helper src/jtag src/pld src/target
	src/target/board src/target/target src/xsvf
Message-ID: <200812130704.mBD746xY029222@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-13 08:02:56 +0100 (Sat, 13 Dec 2008)
New Revision: 1236

Added:
   branches/openocd_1_0_branch/src/target/target/samsung_s3c2410.cfg
Removed:
   branches/openocd_1_0_branch/src/target/target/samsung_s2c2410.cfg
Modified:
   branches/openocd_1_0_branch/README
   branches/openocd_1_0_branch/doc/openocd.texi
   branches/openocd_1_0_branch/src/flash/flash.c
   branches/openocd_1_0_branch/src/flash/str9xpec.c
   branches/openocd_1_0_branch/src/helper/command.c
   branches/openocd_1_0_branch/src/jtag/amt_jtagaccel.c
   branches/openocd_1_0_branch/src/jtag/bitbang.c
   branches/openocd_1_0_branch/src/jtag/bitq.c
   branches/openocd_1_0_branch/src/jtag/ft2232.c
   branches/openocd_1_0_branch/src/jtag/gw16012.c
   branches/openocd_1_0_branch/src/jtag/jlink.c
   branches/openocd_1_0_branch/src/jtag/jtag.c
   branches/openocd_1_0_branch/src/jtag/jtag.h
   branches/openocd_1_0_branch/src/jtag/usbprog.c
   branches/openocd_1_0_branch/src/jtag/zy1000.c
   branches/openocd_1_0_branch/src/pld/virtex2.c
   branches/openocd_1_0_branch/src/target/arm11.c
   branches/openocd_1_0_branch/src/target/arm11_dbgtap.c
   branches/openocd_1_0_branch/src/target/arm720t.c
   branches/openocd_1_0_branch/src/target/arm7_9_common.c
   branches/openocd_1_0_branch/src/target/arm7tdmi.c
   branches/openocd_1_0_branch/src/target/arm920t.c
   branches/openocd_1_0_branch/src/target/arm926ejs.c
   branches/openocd_1_0_branch/src/target/arm966e.c
   branches/openocd_1_0_branch/src/target/arm9tdmi.c
   branches/openocd_1_0_branch/src/target/board/hammer.cfg
   branches/openocd_1_0_branch/src/target/cortex_m3.c
   branches/openocd_1_0_branch/src/target/cortex_m3.h
   branches/openocd_1_0_branch/src/target/cortex_swjdp.c
   branches/openocd_1_0_branch/src/target/embeddedice.c
   branches/openocd_1_0_branch/src/target/etb.c
   branches/openocd_1_0_branch/src/target/etm.c
   branches/openocd_1_0_branch/src/target/feroceon.c
   branches/openocd_1_0_branch/src/target/mips_ejtag.c
   branches/openocd_1_0_branch/src/target/mips_m4k.c
   branches/openocd_1_0_branch/src/target/target/at91r40008.cfg
   branches/openocd_1_0_branch/src/target/target/at91sam9260.cfg
   branches/openocd_1_0_branch/src/target/target/at91sam9260minimal.cfg
   branches/openocd_1_0_branch/src/target/target/imote2.cfg
   branches/openocd_1_0_branch/src/target/target/is5114.cfg
   branches/openocd_1_0_branch/src/target/target/samsung_s3c6410.cfg
   branches/openocd_1_0_branch/src/target/xscale.c
   branches/openocd_1_0_branch/src/xsvf/xsvf.c
Log:
Merge r1217-r1235

Modified: branches/openocd_1_0_branch/README
===================================================================
--- branches/openocd_1_0_branch/README	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/README	2008-12-13 07:02:56 UTC (rev 1236)
@@ -1 +1,2 @@
 openocd.texi is the authoritative source of OpenOCD documentation
+

Modified: branches/openocd_1_0_branch/doc/openocd.texi
===================================================================
--- branches/openocd_1_0_branch/doc/openocd.texi	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/doc/openocd.texi	2008-12-13 07:02:56 UTC (rev 1236)
@@ -286,7 +286,7 @@
 
 @itemize @bullet
 @item @b{usbjtag}
-@* Link Unknown [not easily verified]
+@* Link @url{http://www.hs-augsburg.de/~hhoegl/proj/usbjtag/usbjtag.html}
 @item @b{jtagkey}
 @* See: @url{http://www.amontec.com/jtagkey.shtml}
 @item @b{oocdlink}
@@ -304,7 +304,9 @@
 @item @b{comstick}
 @* Link: @url{http://www.hitex.com/index.php?id=383}
 @item @b{stm32stick}
-@* Link Unknown [not easily verified]
+@* Link @url{http://www.hitex.com/stm32-stick}
+ at item @b{axm0432_jtag}
+@* Axiom AXM-0432 Link @url{http://www.axman.com}
 @end itemize
 
 @section USB JLINK based
@@ -370,7 +372,7 @@
 @* Unknown.
 
 @item @b{Lattice}
-@* From Lattice Semiconductor [link unknown]
+@* ispDownload from Lattice Semiconductor @url{http://www.latticesemi.com/lit/docs/devtools/dlcable.pdf}
 
 @item @b{flashlink}
 @* From ST Microsystems, link:
@@ -1177,6 +1179,8 @@
 egnite Software turtelizer2
 @item @b{oocdlink}
 OOCDLink
+ at item @b{axm0432_jtag}
+Axiom AXM-0432
 @end itemize
 
 @item @b{ft2232_vid_pid} <@var{vid}> <@var{pid}>
@@ -1950,7 +1954,7 @@
 @cindex flash protect_check
 @*Check protection state of sectors in flash bank <num>. 
 @option{flash erase_sector} using the same syntax. 
- at subsection fash erase_sector
+ at subsection flash erase_sector
 @b{flash erase_sector} <@var{num}> <@var{first}> <@var{last}>
 @cindex flash erase_sector
 @anchor{flash erase_sector}
@@ -2080,7 +2084,7 @@
 @option{enable_turbo} <@var{num>.}
 
 Only use this driver for locking/unlocking the device or configuring the option bytes.
-Use the standard str9 driver for programming.
+Use the standard str9 driver for programming. @xref{STR9 specific commands}.
 
 @subsubsection stellaris (LM3Sxxx) options
 @cindex stellaris (LM3Sxxx) options
@@ -2140,6 +2144,7 @@
 
 @subsection STR9 specific commands
 @cindex STR9 specific commands
+ at anchor{STR9 specific commands}
 These are flash specific commands when using the str9xpec driver.
 @itemize @bullet
 @item @b{str9xpec enable_turbo} <@var{num}>
@@ -2164,6 +2169,43 @@
 @*write str9 option bytes. 
 @end itemize
 
+Note: Before using the str9xpec driver here is some background info to help
+you better understand how the drivers works. Openocd has two flash drivers for
+the str9.
+ at enumerate
+ at item
+Standard driver @option{str9x} programmed via the str9 core. Normally used for
+flash programming as it is faster than the @option{str9xpec} driver.
+ at item
+Direct programming @option{str9xpec} using the flash controller, this is
+ISC compilant (IEEE 1532) tap connected in series with the str9 core. The str9
+core does not need to be running to program using this flash driver. Typical use
+for this driver is locking/unlocking the target and programming the option bytes.
+ at end enumerate
+
+Before we run any cmds using the @option{str9xpec} driver we must first disable
+the str9 core. This example assumes the @option{str9xpec} driver has been
+configured for flash bank 0.
+ at example
+# assert srst, we do not want core running
+# while accessing str9xpec flash driver
+jtag_reset 0 1
+# turn off target polling
+poll off
+# disable str9 core
+str9xpec enable_turbo 0
+# read option bytes
+str9xpec options_read 0
+# re-enable str9 core
+str9xpec disable_turbo 0
+poll on
+reset halt
+ at end example
+The above example will read the str9 option bytes.
+When performing a unlock remember that you will not be able to halt the str9 - it
+has been locked. Halting the core is not required for the @option{str9xpec} driver
+as mentioned above, just issue the cmds above manually or from a telnet prompt.
+
 @subsection STR9 configuration
 @cindex STR9 configuration
 @itemize @bullet

Modified: branches/openocd_1_0_branch/src/flash/flash.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/flash.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/flash/flash.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -144,7 +144,7 @@
 {
 	flash_cmd = register_command(cmd_ctx, NULL, "flash", NULL, COMMAND_ANY, NULL);
 
-	register_command(cmd_ctx, flash_cmd, "bank", handle_flash_bank_command, COMMAND_CONFIG, "flash_bank <driver> <base> <size> <chip_width> <bus_width> <target> [driver_options ...]");
+	register_command(cmd_ctx, flash_cmd, "bank", handle_flash_bank_command, COMMAND_CONFIG, "flash bank <driver> <base> <size> <chip_width> <bus_width> <target> [driver_options ...]");
 	return ERROR_OK;
 }
 

Modified: branches/openocd_1_0_branch/src/flash/str9xpec.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/str9xpec.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/flash/str9xpec.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -145,7 +145,7 @@
 	scan_field_t field;
 	u8 status;
 
-	if (str9xpec_set_instr(tap, ISC_NOOP, TAP_PI) != ERROR_OK)
+	if (str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE) != ERROR_OK)
 		return ISC_STATUS_ERROR;
 
 	field.tap = tap;
@@ -158,7 +158,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
 
 	LOG_DEBUG("status: 0x%2.2x", status);
@@ -181,7 +181,7 @@
 		return ERROR_OK;
 
 	/* enter isc mode */
-	if (str9xpec_set_instr(tap, ISC_ENABLE, TAP_RTI) != ERROR_OK)
+	if (str9xpec_set_instr(tap, ISC_ENABLE, TAP_IDLE) != ERROR_OK)
 		return ERROR_TARGET_INVALID;
 
 	/* check ISC status */
@@ -207,7 +207,7 @@
 	if (!str9xpec_info->isc_enable)
 		return ERROR_OK;
 
-	if (str9xpec_set_instr(tap, ISC_DISABLE, TAP_RTI) != ERROR_OK)
+	if (str9xpec_set_instr(tap, ISC_DISABLE, TAP_IDLE) != ERROR_OK)
 		return ERROR_TARGET_INVALID;
 
 	/* delay to handle aborts */
@@ -238,7 +238,7 @@
 	LOG_DEBUG("ISC_CONFIGURATION");
 
 	/* execute ISC_CONFIGURATION command */
-	str9xpec_set_instr(tap, ISC_CONFIGURATION, TAP_PI);
+	str9xpec_set_instr(tap, ISC_CONFIGURATION, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 64;
@@ -250,7 +250,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
 
 	status = str9xpec_isc_status(tap);
@@ -349,10 +349,10 @@
 	armv4_5 = bank->target->arch_info;
 	arm7_9 = armv4_5->arch_info;
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	str9xpec_info->tap = jtag_TapByAbsPosition( jtag_info->tap->abs_chain_position - 1);
 	str9xpec_info->isc_enable = 0;
-	
+
 	str9xpec_build_block_list(bank);
 
 	/* clear option byte register */
@@ -390,7 +390,7 @@
 	}
 
 	/* execute ISC_BLANK_CHECK command */
-	str9xpec_set_instr(tap, ISC_BLANK_CHECK, TAP_PI);
+	str9xpec_set_instr(tap, ISC_BLANK_CHECK, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 64;
@@ -402,7 +402,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_add_sleep(40000);
 
 	/* read blank check result */
@@ -416,7 +416,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_PI);
+	jtag_add_dr_scan(1, &field, TAP_IRPAUSE);
 	jtag_execute_queue();
 
 	status = str9xpec_isc_status(tap);
@@ -506,7 +506,7 @@
 	LOG_DEBUG("ISC_ERASE");
 
 	/* execute ISC_ERASE command */
-	str9xpec_set_instr(tap, ISC_ERASE, TAP_PI);
+	str9xpec_set_instr(tap, ISC_ERASE, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 64;
@@ -518,7 +518,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
 
 	jtag_add_sleep(10);
@@ -569,9 +569,9 @@
 	str9xpec_set_address(bank, 0x80);
 
 	/* execute ISC_PROGRAM command */
-	str9xpec_set_instr(tap, ISC_PROGRAM_SECURITY, TAP_RTI);
+	str9xpec_set_instr(tap, ISC_PROGRAM_SECURITY, TAP_IDLE);
 
-	str9xpec_set_instr(tap, ISC_NOOP, TAP_PI);
+	str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE);
 
 	do {
 		field.tap = tap;
@@ -658,7 +658,7 @@
 	tap = str9xpec_info->tap;
 
 	/* set flash controller address */
-	str9xpec_set_instr(tap, ISC_ADDRESS_SHIFT, TAP_PI);
+	str9xpec_set_instr(tap, ISC_ADDRESS_SHIFT, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 8;
@@ -747,7 +747,7 @@
 
 		while (dwords_remaining > 0)
 		{
-			str9xpec_set_instr(tap, ISC_PROGRAM, TAP_PI);
+			str9xpec_set_instr(tap, ISC_PROGRAM, TAP_IRPAUSE);
 
 			field.tap = tap;
 			field.num_bits = 64;
@@ -759,12 +759,12 @@
 			field.in_handler = NULL;
 			field.in_handler_priv = NULL;
 
-			jtag_add_dr_scan(1, &field, TAP_RTI);
+			jtag_add_dr_scan(1, &field, TAP_IDLE);
 
 			/* small delay before polling */
 			jtag_add_sleep(50);
 
-			str9xpec_set_instr(tap, ISC_NOOP, TAP_PI);
+			str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE);
 
 			do {
 				field.tap = tap;
@@ -807,7 +807,7 @@
 			bytes_written++;
 		}
 
-		str9xpec_set_instr(tap, ISC_PROGRAM, TAP_PI);
+		str9xpec_set_instr(tap, ISC_PROGRAM, TAP_IRPAUSE);
 
 		field.tap = tap;
 		field.num_bits = 64;
@@ -819,12 +819,12 @@
 		field.in_handler = NULL;
 		field.in_handler_priv = NULL;
 
-		jtag_add_dr_scan(1, &field, TAP_RTI);
+		jtag_add_dr_scan(1, &field, TAP_IDLE);
 
 		/* small delay before polling */
 		jtag_add_sleep(50);
 
-		str9xpec_set_instr(tap, ISC_NOOP, TAP_PI);
+		str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE);
 
 		do {
 			field.tap = tap;
@@ -889,7 +889,7 @@
 
 	buffer = calloc(CEIL(32, 8), 1);
 
-	str9xpec_set_instr(tap, ISC_IDCODE, TAP_PI);
+	str9xpec_set_instr(tap, ISC_IDCODE, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 32;
@@ -901,7 +901,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
 
 	idcode = buf_get_u32(buffer, 0, 32);
@@ -1014,7 +1014,7 @@
 	str9xpec_set_address(bank, 0x50);
 
 	/* execute ISC_PROGRAM command */
-	str9xpec_set_instr(tap, ISC_PROGRAM, TAP_PI);
+	str9xpec_set_instr(tap, ISC_PROGRAM, TAP_IRPAUSE);
 
 	field.tap = tap;
 	field.num_bits = 64;
@@ -1026,12 +1026,12 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_dr_scan(1, &field, TAP_RTI);
+	jtag_add_dr_scan(1, &field, TAP_IDLE);
 
 	/* small delay before polling */
 	jtag_add_sleep(50);
 
-	str9xpec_set_instr(tap, ISC_NOOP, TAP_PI);
+	str9xpec_set_instr(tap, ISC_NOOP, TAP_IRPAUSE);
 
 	do {
 		field.tap = tap;
@@ -1303,13 +1303,13 @@
 	}
 
 	/* enable turbo mode - TURBO-PROG-ENABLE */
-	str9xpec_set_instr(tap2, 0xD, TAP_RTI);
+	str9xpec_set_instr(tap2, 0xD, TAP_IDLE);
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 		return retval;
 
 	/* modify scan chain - str9 core has been removed */
 	tap1->enabled = 0;
-	
+
 	return ERROR_OK;
 }
 
@@ -1337,11 +1337,11 @@
 
 	if (tap == NULL)
 		return ERROR_FAIL;
-	
-	/* exit turbo mode via TLR */
-	str9xpec_set_instr(tap, ISC_NOOP, TAP_TLR);
+
+	/* exit turbo mode via RESET */
+	str9xpec_set_instr(tap, ISC_NOOP, TAP_RESET);
 	jtag_execute_queue();
-	
+
 	/* restore previous scan chain */
 	if (tap->next_tap) {
 		tap->next_tap->enabled = 1;

Modified: branches/openocd_1_0_branch/src/helper/command.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/command.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/helper/command.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -289,8 +289,10 @@
 		return ERROR_INVALID_ARGUMENTS;
 
 	/* find command */
-	for (c = context->commands; c; c = c->next)
-	{
+	c = context->commands;
+	
+	while(NULL != c)
+	{		
 		if (strcmp(name, c->name) == 0)
 		{
 			/* unlink command */
@@ -300,26 +302,32 @@
 			}
 			else
 			{
+				/* first element in command list */
 				context->commands = c->next;
 			}
-
+			
 			/* unregister children */
-			if (c->children)
+			while(NULL != c->children)
 			{
-				for (c2 = c->children; c2; c2 = c2->next)
-				{
-					free(c2->name);
-					free(c2);
-				}
+				c2 = c->children;
+				c->children = c->children->next;
+				free(c2->name);
+				c2->name = NULL;
+				free(c2);
+				c2 = NULL;
 			}
-
+			
 			/* delete command */
 			free(c->name);
+			c->name = NULL;
 			free(c);
+			c = NULL;
+			return ERROR_OK;
 		}
-
+		
 		/* remember the last command for unlinking */
 		p = c;
+		c = c->next;
 	}
 
 	return ERROR_OK;

Modified: branches/openocd_1_0_branch/src/jtag/amt_jtagaccel.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/amt_jtagaccel.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/amt_jtagaccel.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -100,22 +100,22 @@
  */
 u8 amt_jtagaccel_tap_move[6][6][2] =
 {
-	/*	   TLR           RTI              SD            PD            SI            PI             */
-	{{0x1f, 0x00}, {0x0f, 0x00}, {0x8a, 0x04}, {0x0a, 0x00}, {0x06, 0x00}, {0x96, 0x00}},	/* TLR */
-	{{0x1f, 0x00}, {0x00, 0x00}, {0x85, 0x08}, {0x05, 0x00}, {0x8b, 0x08}, {0x0b, 0x00}},	/* RTI */
-	{{0x1f, 0x00}, {0x0d, 0x00}, {0x00, 0x00}, {0x01, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* SD  */
-	{{0x1f, 0x00}, {0x0c, 0x00}, {0x08, 0x00}, {0x00, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* PD  */
-	{{0x1f, 0x00}, {0x0d, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x00, 0x00}, {0x01, 0x00}},	/* SI  */
-	{{0x1f, 0x00}, {0x0c, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x08, 0x00}, {0x00, 0x00}},	/* PI  */
+	/*	   RESET         IDLE        DRSHIFT       DRPAUSE       IRSHIFT       IRPAUSE             */
+	{{0x1f, 0x00}, {0x0f, 0x00}, {0x8a, 0x04}, {0x0a, 0x00}, {0x06, 0x00}, {0x96, 0x00}},	/* RESET */
+	{{0x1f, 0x00}, {0x00, 0x00}, {0x85, 0x08}, {0x05, 0x00}, {0x8b, 0x08}, {0x0b, 0x00}},	/* IDLE */
+	{{0x1f, 0x00}, {0x0d, 0x00}, {0x00, 0x00}, {0x01, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* DRSHIFT  */
+	{{0x1f, 0x00}, {0x0c, 0x00}, {0x08, 0x00}, {0x00, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* DRPAUSE  */
+	{{0x1f, 0x00}, {0x0d, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x00, 0x00}, {0x01, 0x00}},	/* IRSHIFT  */
+	{{0x1f, 0x00}, {0x0c, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x08, 0x00}, {0x00, 0x00}},	/* IRPAUSE  */
 };
 
-jtag_interface_t amt_jtagaccel_interface = 
+jtag_interface_t amt_jtagaccel_interface =
 {
 	.name = "amt_jtagaccel",
-	
+
 	.execute_queue = amt_jtagaccel_execute_queue,
 
-	.speed = amt_jtagaccel_speed,	
+	.speed = amt_jtagaccel_speed,
 	.register_commands = amt_jtagaccel_register_commands,
 	.init = amt_jtagaccel_init,
 	.quit = amt_jtagaccel_quit,
@@ -127,7 +127,7 @@
 					 COMMAND_CONFIG, NULL);
 	register_command(cmd_ctx, NULL, "rtck", amt_jtagaccel_handle_rtck_command,
 					 COMMAND_CONFIG, NULL);
-	
+
 	return ERROR_OK;
 }
 
@@ -142,7 +142,7 @@
 		aw_control_rst |= 0x1;
 	else if (srst == 0)
 		aw_control_rst &= ~0x1;
-	
+
 	AMT_AW(aw_control_rst);
 }
 
@@ -151,7 +151,7 @@
 	aw_control_baudrate &= 0xf0;
 	aw_control_baudrate |= speed & 0x0f;
 	AMT_AW(aw_control_baudrate);
-	
+
 	return ERROR_OK;
 }
 
@@ -170,11 +170,11 @@
 {
 	int timeout = 4096;
 	u8 ar_status;
-	
+
 	AMT_AR(ar_status);
 	while (((ar_status) & 0x80) && (timeout-- > 0))
 		AMT_AR(ar_status);
-	
+
 	if (ar_status & 0x80)
 	{
 		LOG_ERROR("amt_jtagaccel timed out while waiting for end of scan, rtck was %s, last AR_STATUS: 0x%2.2x", (rtck_enabled) ? "enabled" : "disabled", ar_status);
@@ -186,15 +186,15 @@
 {
 	u8 aw_scan_tms_5;
 	u8 tms_scan[2];
-	 
+
 	tms_scan[0] = amt_jtagaccel_tap_move[tap_move_map[cur_state]][tap_move_map[end_state]][0];
 	tms_scan[1] = amt_jtagaccel_tap_move[tap_move_map[cur_state]][tap_move_map[end_state]][1];
-	
+
 	aw_scan_tms_5 = 0x40 | (tms_scan[0] & 0x1f);
 	AMT_AW(aw_scan_tms_5);
 	if (jtag_speed > 3 || rtck_enabled)
 		amt_wait_scan_busy();
-		
+
 	if (tms_scan[0] & 0x80)
 	{
 		aw_scan_tms_5 = 0x40 | (tms_scan[1] & 0x1f);
@@ -202,7 +202,7 @@
 		if (jtag_speed > 3 || rtck_enabled)
 			amt_wait_scan_busy();
 	}
-	
+
 	cur_state = end_state;
 }
 
@@ -213,27 +213,27 @@
 	u8 aw_scan_tms_1to4;
 
 	enum tap_state saved_end_state = end_state;
-	
-	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+
+	/* only do a state_move when we're not already in IDLE */
+	if (cur_state != TAP_IDLE)
 	{
-		amt_jtagaccel_end_state(TAP_RTI);
+		amt_jtagaccel_end_state(TAP_IDLE);
 		amt_jtagaccel_state_move();
 	}
-	
+
 	while (num_cycles - i >= 5)
 	{
 		aw_scan_tms_5 = 0x40;
 		AMT_AW(aw_scan_tms_5);
 		i += 5;
 	}
-	
+
 	if (num_cycles - i > 0)
 	{
 		aw_scan_tms_1to4 = 0x80 | ((num_cycles - i - 1) & 0x3) << 4;
 		AMT_AW(aw_scan_tms_1to4);
 	}
-	
+
 	amt_jtagaccel_end_state(saved_end_state);
 	if (cur_state != end_state)
 		amt_jtagaccel_state_move();
@@ -251,9 +251,9 @@
 	u8 tms_scan[2];
 
 	if (ir_scan)
-		amt_jtagaccel_end_state(TAP_SI);
+		amt_jtagaccel_end_state(TAP_IRSHIFT);
 	else
-		amt_jtagaccel_end_state(TAP_SD);
+		amt_jtagaccel_end_state(TAP_DRSHIFT);
 
 	amt_jtagaccel_state_move();
 	amt_jtagaccel_end_state(saved_end_state);
@@ -263,7 +263,7 @@
 	{
 		aw_tdi_option = 0x30 | (((scan_size - 1) % 8) - 1);
 		AMT_AW(aw_tdi_option);
-		
+
 		dw_tdi_scan = buf_get_u32(buffer, bit_count, (scan_size - 1) % 8) & 0xff;
 		AMT_DW(dw_tdi_scan);
 		if (jtag_speed > 3 || rtck_enabled)
@@ -275,11 +275,11 @@
 			dr_tdo = dr_tdo >> (8 - ((scan_size - 1) % 8));
 			buf_set_u32(buffer, bit_count, (scan_size - 1) % 8, dr_tdo);
 		}
-		
+
 		bit_count += (scan_size - 1) % 8;
 		bits_left -= (scan_size - 1) % 8;
 	}
-	
+
 	while (bits_left - 1 >= 8)
 	{
 		dw_tdi_scan = buf_get_u32(buffer, bit_count, 8) & 0xff;
@@ -292,11 +292,11 @@
 			AMT_DR(dr_tdo);
 			buf_set_u32(buffer, bit_count, 8, dr_tdo);
 		}
-				
+
 		bit_count += 8;
 		bits_left -= 8;
 	}
-		
+
 	tms_scan[0] = amt_jtagaccel_tap_move[tap_move_map[cur_state]][tap_move_map[end_state]][0];
 	tms_scan[1] = amt_jtagaccel_tap_move[tap_move_map[cur_state]][tap_move_map[end_state]][1];
 	aw_tms_scan = 0x40 | (tms_scan[0] & 0x1f) | (buf_get_u32(buffer, bit_count, 1) << 5);
@@ -310,7 +310,7 @@
 		dr_tdo = dr_tdo >> 7;
 		buf_set_u32(buffer, bit_count, 1, dr_tdo);
 	}
-	
+
 	if (tms_scan[0] & 0x80)
 	{
 		aw_tms_scan = 0x40 | (tms_scan[1] & 0x1f);
@@ -328,12 +328,12 @@
 	enum scan_type type;
 	u8 *buffer;
 	int retval;
-	
+
 	/* return ERROR_OK, unless a jtag_read_buffer returns a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
-		
+
 	while (cmd)
 	{
 		switch (cmd->type)
@@ -351,7 +351,7 @@
 #endif
 				if (cmd->cmd.reset->trst == 1)
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				amt_jtagaccel_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
@@ -397,7 +397,7 @@
 		}
 		cmd = cmd->next;
 	}
-	
+
 	return retval;
 }
 
@@ -409,16 +409,16 @@
 
     version.dwOSVersionInfoSize = sizeof version;
     if (!GetVersionEx( &version )) {
-        errno = EINVAL;
-        return -1;
+	errno = EINVAL;
+	return -1;
     }
     if (version.dwPlatformId != VER_PLATFORM_WIN32_NT)
-        return 0;
+	return 0;
 
     h = CreateFile( "\\\\.\\giveio", GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );
     if (h == INVALID_HANDLE_VALUE) {
-        errno = ENODEV;
-        return -1;
+	errno = ENODEV;
+	return -1;
     }
 
     CloseHandle( h );
@@ -437,7 +437,7 @@
 	u8 status_port;
 #endif
 	u8 ar_status;
-	
+
 #if PARPORT_USE_PPDEV == 1
 	if (device_handle > 0)
 	{
@@ -447,7 +447,7 @@
 
 	snprintf(buffer, 256, "/dev/parport%d", amt_jtagaccel_port);
 	device_handle = open(buffer, O_RDWR);
-	
+
 	if (device_handle < 0)
 	{
 		LOG_ERROR("cannot open device. check it exists and that user read and write rights are set");
@@ -468,7 +468,7 @@
 		LOG_ERROR(" cannot set compatible mode to device");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	control_port = 0x00;
 	i = ioctl(device_handle, PPWCONTROL, &control_port);
 
@@ -484,57 +484,57 @@
 
 #if PARPORT_USE_GIVEIO == 1
 	if (amt_jtagaccel_get_giveio_access() != 0) {
-#else /* PARPORT_USE_GIVEIO */	
+#else /* PARPORT_USE_GIVEIO */
 	if (ioperm(amt_jtagaccel_port, 5, 1) != 0) {
 #endif /* PARPORT_USE_GIVEIO */
 		LOG_ERROR("missing privileges for direct i/o");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	/* prepare epp port */
 	/* clear timeout */
 	status_port = inb(amt_jtagaccel_port + 1);
 	outb(status_port | 0x1, amt_jtagaccel_port + 1);
-	
+
 	/* reset epp port */
 	outb(0x00, amt_jtagaccel_port + 2);
 	outb(0x04, amt_jtagaccel_port + 2);
 #endif
-	
+
 	if (rtck_enabled)
-	{	
+	{
 		/* set RTCK enable bit */
 		aw_control_fsm |= 0x02;
 	}
-	
+
 	/* enable JTAG port */
 	aw_control_fsm |= 0x04;
 	AMT_AW(aw_control_fsm);
-	
+
 	amt_jtagaccel_speed(jtag_speed);
-	
+
 	if (jtag_reset_config & RESET_TRST_OPEN_DRAIN)
 		aw_control_rst &= ~0x8;
 	else
 		aw_control_rst |= 0x8;
-	
+
 	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
 		aw_control_rst &= ~0x2;
 	else
 		aw_control_rst |= 0x2;
-	
+
 	amt_jtagaccel_reset(0, 0);
-	
+
 	/* read status register */
 	AMT_AR(ar_status);
 	LOG_DEBUG("AR_STATUS: 0x%2.2x", ar_status);
-	
+
 	return ERROR_OK;
 }
 
 int amt_jtagaccel_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -568,6 +568,6 @@
 			rtck_enabled = 0;
 		}
 	}
-	
+
 	return ERROR_OK;
 }

Modified: branches/openocd_1_0_branch/src/jtag/bitbang.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/bitbang.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/bitbang.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -41,24 +41,24 @@
 
 
 /* DANGER!!!! clock absolutely *MUST* be 0 in idle or reset won't work!
- * 
+ *
  * Set this to 1 and str912 reset halt will fail.
- * 
+ *
  * If someone can submit a patch with an explanation it will be greatly
  * appreciated, but as far as I can tell (?H) DCLK is generated upon
- * clk=0 in TAP_RTI. Good luck deducing that from the ARM documentation!
- * The ARM documentation uses the term "DCLK is asserted while in the TAP_RTI 
+ * clk=0 in TAP_IDLE. Good luck deducing that from the ARM documentation!
+ * The ARM documentation uses the term "DCLK is asserted while in the TAP_IDLE
  * state". With hardware there is no such thing as *while* in a state. There
  * are only edges. So clk => 0 is in fact a very subtle state transition that
- * happens *while* in the TAP_RTI state. "#&?"#?&"#&"#&
- * 
+ * happens *while* in the TAP_IDLE state. "#&?"#?&"#&"#&
+ *
  * For "reset halt" the last thing that happens before srst is asserted
  * is that the breakpoint is set up. If DCLK is not wiggled one last
  * time before the reset, then the breakpoint is not set up and
  * "reset halt" will fail to halt.
- * 
+ *
  */
-#define CLOCK_IDLE() 0 
+#define CLOCK_IDLE() 0
 
 int bitbang_execute_queue(void);
 
@@ -76,10 +76,10 @@
 }
 
 void bitbang_state_move(void) {
-	
+
 	int i=0, tms=0;
 	u8 tms_scan = TAP_MOVE(cur_state, end_state);
-	
+
 	for (i = 0; i < 7; i++)
 	{
 		tms = (tms_scan >> i) & 1;
@@ -87,7 +87,7 @@
 		bitbang_interface->write(1, tms, 0);
 	}
 	bitbang_interface->write(CLOCK_IDLE(), tms, 0);
-	
+
 	cur_state = end_state;
 }
 
@@ -113,7 +113,7 @@
 			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[cmd->path[state_count]]);
 			exit(-1);
 		}
-		
+
 		bitbang_interface->write(0, tms, 0);
 		bitbang_interface->write(1, tms, 0);
 
@@ -121,7 +121,7 @@
 		state_count++;
 		num_states--;
 	}
-	
+
 	bitbang_interface->write(CLOCK_IDLE(), tms, 0);
 
 	end_state = cur_state;
@@ -130,16 +130,16 @@
 void bitbang_runtest(int num_cycles)
 {
 	int i;
-	
+
 	enum tap_state saved_end_state = end_state;
-	
-	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+
+	/* only do a state_move when we're not already in IDLE */
+	if (cur_state != TAP_IDLE)
 	{
-		bitbang_end_state(TAP_RTI);
+		bitbang_end_state(TAP_IDLE);
 		bitbang_state_move();
 	}
-	
+
 	/* execute num_cycles */
 	for (i = 0; i < num_cycles; i++)
 	{
@@ -147,7 +147,7 @@
 		bitbang_interface->write(1, 0, 0);
 	}
 	bitbang_interface->write(CLOCK_IDLE(), 0, 0);
-	
+
 	/* finish in end_state */
 	bitbang_end_state(saved_end_state);
 	if (cur_state != end_state)
@@ -158,13 +158,13 @@
 {
 	enum tap_state saved_end_state = end_state;
 	int bit_cnt;
-	
-	if (!((!ir_scan && (cur_state == TAP_SD)) || (ir_scan && (cur_state == TAP_SI))))
+
+	if (!((!ir_scan && (cur_state == TAP_DRSHIFT)) || (ir_scan && (cur_state == TAP_IRSHIFT))))
 	{
 		if (ir_scan)
-			bitbang_end_state(TAP_SI);
+			bitbang_end_state(TAP_IRSHIFT);
 		else
-			bitbang_end_state(TAP_SD);
+			bitbang_end_state(TAP_DRSHIFT);
 
 		bitbang_state_move();
 		bitbang_end_state(saved_end_state);
@@ -181,7 +181,7 @@
 		/* if we're just reading the scan, but don't care about the output
 		 * default to outputting 'low', this also makes valgrind traces more readable,
 		 * as it removes the dependency on an uninitialised value
-		 */ 
+		 */
 		tdi=0;
 		if ((type != SCAN_IN) && (buffer[bytec] & bcval))
 			tdi=1;
@@ -192,7 +192,7 @@
 			val=bitbang_interface->read();
 
 		bitbang_interface->write(1, tms, tdi);
-		
+
 		if (type != SCAN_OUT)
 		{
 			if (val)
@@ -201,21 +201,21 @@
 				buffer[bytec] &= ~bcval;
 		}
 	}
-	
-	/* TAP_SD & TAP_SI are illegal end states, so we always transition to the pause
+
+	/* TAP_DRSHIFT & TAP_IRSHIFT are illegal end states, so we always transition to the pause
 	 * state which is a legal stable state from which statemove will work.
-	 *  
-	 * Exit1 -> Pause 
+	 *
+	 * Exit1 -> Pause
 	 */
 	bitbang_interface->write(0, 0, 0);
 	bitbang_interface->write(1, 0, 0);
 	bitbang_interface->write(CLOCK_IDLE(), 0, 0);
-	
+
 	if (ir_scan)
-		cur_state = TAP_PI;
+		cur_state = TAP_IRPAUSE;
 	else
-		cur_state = TAP_PD;
-	
+		cur_state = TAP_DRPAUSE;
+
 	if (cur_state != end_state)
 		bitbang_state_move();
 }
@@ -227,18 +227,18 @@
 	enum scan_type type;
 	u8 *buffer;
 	int retval;
-	
+
 	if (!bitbang_interface)
 	{
 		LOG_ERROR("BUG: Bitbang interface called, but not yet initialized");
 		exit(-1);
 	}
-	
+
 	/* return ERROR_OK, unless a jtag_read_buffer returns a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
-		
+
 	if(bitbang_interface->blink)
 		bitbang_interface->blink(1);
 
@@ -259,7 +259,7 @@
 #endif
 				if ((cmd->cmd.reset->trst == 1) || (cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST)))
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				bitbang_interface->reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
@@ -313,7 +313,7 @@
 	}
 	if(bitbang_interface->blink)
 		bitbang_interface->blink(0);
-	
+
 	return retval;
 }
 

Modified: branches/openocd_1_0_branch/src/jtag/bitq.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/bitq.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/bitq.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -194,8 +194,8 @@
 {
 	int i;
 
-	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI) bitq_state_move(TAP_RTI);
+	/* only do a state_move when we're not already in IDLE */
+	if (cur_state != TAP_IDLE) bitq_state_move(TAP_IDLE);
 
 	/* execute num_cycles */
 	for (i = 0; i < num_cycles; i++)
@@ -240,8 +240,8 @@
 
 	if (pause) {
 		bitq_io(0,0,0);
-		if (cur_state==TAP_SI) cur_state=TAP_PI;
-		else if (cur_state==TAP_SD) cur_state=TAP_PD;
+		if (cur_state==TAP_IRSHIFT) cur_state=TAP_IRPAUSE;
+		else if (cur_state==TAP_DRSHIFT) cur_state=TAP_DRPAUSE;
 	}
 }
 
@@ -250,8 +250,8 @@
 {
 	int i;
 
-	if (cmd->ir_scan) bitq_state_move(TAP_SI);
-	else bitq_state_move(TAP_SD);
+	if (cmd->ir_scan) bitq_state_move(TAP_IRSHIFT);
+	else bitq_state_move(TAP_DRSHIFT);
 
 	for (i=0; i < cmd->num_fields-1; i++)
 		bitq_scan_field(&cmd->fields[i], 0);
@@ -285,7 +285,7 @@
 #endif
 				if ((cmd->cmd.reset->trst == 1) || (cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST)))
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				bitq_interface->reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				if (bitq_interface->in_rdy()) bitq_in_proc();

Modified: branches/openocd_1_0_branch/src/jtag/ft2232.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/ft2232.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/ft2232.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -102,6 +102,7 @@
 int turtle_init(void);
 int comstick_init(void);
 int stm32stick_init(void);
+int axm0432_jtag_init(void);
 
 /* reset procedures for supported layouts */
 void usbjtag_reset(int trst, int srst);
@@ -111,6 +112,7 @@
 void turtle_reset(int trst, int srst);
 void comstick_reset(int trst, int srst);
 void stm32stick_reset(int trst, int srst);
+void axm0432_jtag_reset(int trst, int srst);
 
 /* blink procedures for layouts that support a blinking led */
 void olimex_jtag_blink(void);
@@ -129,6 +131,7 @@
 	{"turtelizer2", turtle_init, turtle_reset, turtle_jtag_blink},
 	{"comstick", comstick_init, comstick_reset, NULL},
 	{"stm32stick", stm32stick_init, stm32stick_reset, NULL},
+	{"axm0432_jtag", axm0432_jtag_init, axm0432_jtag_reset, NULL},
 	{NULL, NULL, NULL},
 };
 
@@ -154,13 +157,13 @@
 #define BUFFER_ADD ft2232_buffer[ft2232_buffer_size++]
 #define BUFFER_READ ft2232_buffer[ft2232_read_pointer++]
 
-jtag_interface_t ft2232_interface = 
+jtag_interface_t ft2232_interface =
 {
 	.name = "ft2232",
 	.execute_queue = ft2232_execute_queue,
 	.speed = ft2232_speed,
 	.speed_div = ft2232_speed_div,
-	.khz = ft2232_khz, 
+	.khz = ft2232_khz,
 	.register_commands = ft2232_register_commands,
 	.init = ft2232_init,
 	.quit = ft2232_quit,
@@ -180,7 +183,7 @@
 	else
 	{
 		*bytes_written = dw_bytes_written;
-		return ERROR_OK;	
+		return ERROR_OK;
 	}
 #elif BUILD_FT2232_LIBFTDI == 1
 	int retval;
@@ -193,7 +196,7 @@
 	else
 	{
 		*bytes_written = retval;
-		return ERROR_OK;	
+		return ERROR_OK;
 	}
 #endif
 }
@@ -208,20 +211,20 @@
 
 	while ((*bytes_read < size) && timeout--)
 	{
-		if ((status = FT_Read(ftdih, buf + *bytes_read, size - 
-			*bytes_read, &dw_bytes_read)) != FT_OK)		
+		if ((status = FT_Read(ftdih, buf + *bytes_read, size -
+			*bytes_read, &dw_bytes_read)) != FT_OK)
 		{
-			*bytes_read = 0; 
+			*bytes_read = 0;
 			LOG_ERROR("FT_Read returned: %lu", status);
 			return ERROR_JTAG_DEVICE_ERROR;
 		}
-		*bytes_read += dw_bytes_read; 
+		*bytes_read += dw_bytes_read;
 	}
 #elif BUILD_FT2232_LIBFTDI == 1
 	int retval;
 	int timeout = 100;
 	*bytes_read = 0;
-	
+
 	while ((*bytes_read < size) && timeout--)
 	{
 		if ((retval = ftdi_read_data(&ftdic, buf + *bytes_read, size - *bytes_read)) < 0)
@@ -239,7 +242,7 @@
 		LOG_ERROR("couldn't read the requested number of bytes from FT2232 device (%i < %i)", *bytes_read, size);
 		return ERROR_JTAG_DEVICE_ERROR;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -252,7 +255,7 @@
 	buf[0] = 0x86; /* command "set divisor" */
 	buf[1] = speed & 0xff; /* valueL (0=6MHz, 1=3MHz, 2=2.0MHz, ...*/
 	buf[2] = (speed >> 8) & 0xff; /* valueH */
-	
+
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
 	if (((retval = ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
@@ -265,12 +268,12 @@
 
 int ft2232_speed_div(int speed, int *khz)
 {
-	/* Take a look in the FT2232 manual, 
+	/* Take a look in the FT2232 manual,
 	 * AN2232C-01 Command Processor for
 	 * MPSSE and MCU Host Bus. Chapter 3.8 */
-	
+
 	*khz = 6000 / (1+speed);
-	
+
 	return ERROR_OK;
 }
 
@@ -281,35 +284,35 @@
 		LOG_ERROR("RCLK not supported");
 		return ERROR_FAIL;
 	}
-	/* Take a look in the FT2232 manual, 
+	/* Take a look in the FT2232 manual,
 	 * AN2232C-01 Command Processor for
 	 * MPSSE and MCU Host Bus. Chapter 3.8
-	 * 
+	 *
 	 * We will calc here with a multiplier
 	 * of 10 for better rounding later. */
-	
+
 	/* Calc speed, (6000 / khz) - 1 */
 	/* Use 65000 for better rounding */
 	*jtag_speed = (60000 / khz) - 10;
-	
+
 	/* Add 0.9 for rounding */
 	*jtag_speed += 9;
-	
+
 	/* Calc real speed */
 	*jtag_speed = *jtag_speed / 10;
-	
+
 	/* Check if speed is greater than 0 */
 	if (*jtag_speed < 0)
 	{
 		*jtag_speed = 0;
 	}
-	
+
 	/* Check max value */
 	if (*jtag_speed > 0xFFFF)
 	{
 		*jtag_speed = 0xFFFF;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -368,7 +371,7 @@
 	int i;
 	char line[256];
 	char *line_p = line;
-	
+
 	for (i = 0; i < ft2232_buffer_size; i++)
 	{
 		line_p += snprintf(line_p, 256 - (line_p - line), "%2.2x ", ft2232_buffer[i]);
@@ -378,7 +381,7 @@
 			line_p = line;
 		}
 	}
-	
+
 	if (line_p != line)
 		LOG_DEBUG("%s", line);
 }
@@ -392,7 +395,7 @@
 	int retval;
 	u32 bytes_written;
 	u32 bytes_read;
-	
+
 #ifdef _DEBUG_USB_IO_
 	struct timeval start, inter, inter2, end;
 	struct timeval d_inter, d_inter2, d_end;
@@ -404,7 +407,7 @@
 #endif
 
 #ifdef _DEBUG_USB_IO_
-	gettimeofday(&start, NULL);	
+	gettimeofday(&start, NULL);
 #endif
 
 	if ((retval = ft2232_write(ft2232_buffer, ft2232_buffer_size, &bytes_written)) != ERROR_OK)
@@ -412,28 +415,28 @@
 		LOG_ERROR("couldn't write MPSSE commands to FT2232");
 		return retval;
 	}
-	
+
 #ifdef _DEBUG_USB_IO_
-	gettimeofday(&inter, NULL);	
+	gettimeofday(&inter, NULL);
 #endif
-	
+
 	if (ft2232_expect_read)
 	{
 		int timeout = 100;
 		ft2232_buffer_size = 0;
-		
+
 #ifdef _DEBUG_USB_IO_
-		gettimeofday(&inter2, NULL);	
+		gettimeofday(&inter2, NULL);
 #endif
-		
+
 		if ((retval = ft2232_read(ft2232_buffer, ft2232_expect_read, &bytes_read)) != ERROR_OK)
 		{
 			LOG_ERROR("couldn't read from FT2232");
 			return retval;
 		}
-		
+
 #ifdef _DEBUG_USB_IO_
-		gettimeofday(&end, NULL);	
+		gettimeofday(&end, NULL);
 
 		timeval_subtract(&d_inter, &inter, &start);
 		timeval_subtract(&d_inter2, &inter2, &start);
@@ -441,14 +444,14 @@
 
 		LOG_INFO("inter: %i.%i, inter2: %i.%i end: %i.%i", d_inter.tv_sec, d_inter.tv_usec, d_inter2.tv_sec, d_inter2.tv_usec, d_end.tv_sec, d_end.tv_usec);
 #endif
-	
-		
+
+
 		ft2232_buffer_size = bytes_read;
-		
+
 		if (ft2232_expect_read != ft2232_buffer_size)
 		{
 			LOG_ERROR("ft2232_expect_read (%i) != ft2232_buffer_size (%i) (%i retries)", ft2232_expect_read, ft2232_buffer_size, 100 - timeout);
-			ft2232_debug_dump_buffer();	
+			ft2232_debug_dump_buffer();
 
 			exit(-1);
 		}
@@ -461,12 +464,12 @@
 
 	ft2232_expect_read = 0;
 	ft2232_read_pointer = 0;
-	
+
 	/* return ERROR_OK, unless a jtag_read_buffer returns a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
-	
+
 	cmd = first;
 	while (cmd != last)
 	{
@@ -489,7 +492,7 @@
 		}
 		cmd = cmd->next;
 	}
-	
+
 	ft2232_buffer_size = 0;
 
 	return retval;
@@ -505,7 +508,7 @@
 	while (num_states)
 	{
 		int bit_count = 0;
-		
+
 		int num_states_batch = num_states > 7 ? 7 : num_states;
 
 		tms_byte = 0x0;
@@ -513,7 +516,7 @@
 		BUFFER_ADD = 0x4b;
 		/* number of states remaining */
 		BUFFER_ADD = num_states_batch - 1;
-		
+
 		while (num_states_batch--)
 		{
 			if (tap_transitions[cur_state].low == cmd->path[state_count])
@@ -530,10 +533,10 @@
 			state_count++;
 			num_states--;
 		}
-		
+
 		BUFFER_ADD = tms_byte;
 	}
-	
+
 	end_state = cur_state;
 }
 
@@ -544,7 +547,7 @@
 	int cur_byte = 0;
 	int last_bit;
 
-	if (!((!ir_scan && (cur_state == TAP_SD)) || (ir_scan && (cur_state == TAP_SI))))
+	if (!((!ir_scan && (cur_state == TAP_DRSHIFT)) || (ir_scan && (cur_state == TAP_IRSHIFT))))
 	{
 		/* command "Clock Data to TMS/CS Pin (no Read)" */
 		BUFFER_ADD = 0x4b;
@@ -553,17 +556,17 @@
 		/* TMS data bits */
 		if (ir_scan)
 		{
-			BUFFER_ADD = TAP_MOVE(cur_state, TAP_SI);
-			cur_state = TAP_SI;
+			BUFFER_ADD = TAP_MOVE(cur_state, TAP_IRSHIFT);
+			cur_state = TAP_IRSHIFT;
 		}
 		else
 		{
-			BUFFER_ADD = TAP_MOVE(cur_state, TAP_SD);
-			cur_state = TAP_SD;
+			BUFFER_ADD = TAP_MOVE(cur_state, TAP_DRSHIFT);
+			cur_state = TAP_DRSHIFT;
 		}
 		/* LOG_DEBUG("added TMS scan (no read)"); */
 	}
-	
+
 	/* add command for complete bytes */
 	while (num_bytes > 1)
 	{
@@ -605,7 +608,7 @@
 			bits_left -= 8 * (thisrun_bytes);
 		}
 	}
-	
+
 	/* the most signifcant bit is scanned during TAP movement */
 	if (type != SCAN_IN)
 		last_bit = (buffer[cur_byte] >> (bits_left - 1)) & 0x1;
@@ -638,8 +641,8 @@
 			BUFFER_ADD = buffer[cur_byte];
 	}
 
-	if ((ir_scan && (end_state == TAP_SI)) ||
-		(!ir_scan && (end_state == TAP_SD)))
+	if ((ir_scan && (end_state == TAP_IRSHIFT)) ||
+		(!ir_scan && (end_state == TAP_DRSHIFT)))
 	{
 		if (type == SCAN_IO)
 		{
@@ -695,24 +698,24 @@
 	u32 bytes_read;
 	int retval;
 	int thisrun_read = 0;
-	
+
 	if (cmd->ir_scan)
 	{
 		LOG_ERROR("BUG: large IR scans are not supported");
 		exit(-1);
 	}
 
-	if (cur_state != TAP_SD)
+	if (cur_state != TAP_DRSHIFT)
 	{
 		/* command "Clock Data to TMS/CS Pin (no Read)" */
 		BUFFER_ADD = 0x4b;
 		/* scan 7 bit */
 		BUFFER_ADD = 0x6;
 		/* TMS data bits */
-		BUFFER_ADD = TAP_MOVE(cur_state, TAP_SD);
-		cur_state = TAP_SD;
+		BUFFER_ADD = TAP_MOVE(cur_state, TAP_DRSHIFT);
+		cur_state = TAP_DRSHIFT;
 	}
-	
+
 	if ((retval = ft2232_write(ft2232_buffer, ft2232_buffer_size, &bytes_written)) != ERROR_OK)
 	{
 		LOG_ERROR("couldn't write MPSSE commands to FT2232");
@@ -720,12 +723,12 @@
 	}
 	LOG_DEBUG("ft2232_buffer_size: %i, bytes_written: %i", ft2232_buffer_size, bytes_written);
 	ft2232_buffer_size = 0;
-	
+
 	/* add command for complete bytes */
 	while (num_bytes > 1)
 	{
 		int thisrun_bytes;
-		
+
 		if (type == SCAN_IO)
 		{
 			/* Clock Data Bytes In and Out LSB First */
@@ -771,7 +774,7 @@
 		}
 		LOG_DEBUG("ft2232_buffer_size: %i, bytes_written: %i", ft2232_buffer_size, bytes_written);
 		ft2232_buffer_size = 0;
-		
+
 		if (type != SCAN_OUT)
 		{
 			if ((retval = ft2232_read(receive_pointer, thisrun_read, &bytes_read)) != ERROR_OK)
@@ -783,9 +786,9 @@
 			receive_pointer += bytes_read;
 		}
 	}
-	
+
 	thisrun_read = 0;
-	
+
 	/* the most signifcant bit is scanned during TAP movement */
 	if (type != SCAN_IN)
 		last_bit = (buffer[cur_byte] >> (bits_left - 1)) & 0x1;
@@ -816,12 +819,12 @@
 		BUFFER_ADD = bits_left - 2;
 		if (type != SCAN_IN)
 			BUFFER_ADD = buffer[cur_byte];
-			
+
 		if (type != SCAN_OUT)
 			thisrun_read += 2;
 	}
 
-	if (end_state == TAP_SD)
+	if (end_state == TAP_DRSHIFT)
 	{
 		if (type == SCAN_IO)
 		{
@@ -863,10 +866,10 @@
 		BUFFER_ADD = TAP_MOVE(cur_state, end_state) | (last_bit << 7);
 		cur_state = end_state;
 	}
-	
+
 	if (type != SCAN_OUT)
 		thisrun_read += 1;
-	
+
 	if ((retval = ft2232_write(ft2232_buffer, ft2232_buffer_size, &bytes_written)) != ERROR_OK)
 	{
 		LOG_ERROR("couldn't write MPSSE commands to FT2232");
@@ -874,7 +877,7 @@
 	}
 	LOG_DEBUG("ft2232_buffer_size: %i, bytes_written: %i", ft2232_buffer_size, bytes_written);
 	ft2232_buffer_size = 0;
-	
+
 	if (type != SCAN_OUT)
 	{
 		if ((retval = ft2232_read(receive_pointer, thisrun_read, &bytes_read)) != ERROR_OK)
@@ -885,7 +888,7 @@
 		LOG_DEBUG("thisrun_read: %i, bytes_read: %i", thisrun_read, bytes_read);
 		receive_pointer += bytes_read;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -893,10 +896,10 @@
 {
 	int predicted_size = 3;
 	int num_bytes = (scan_size - 1) / 8;
-	
-	if (cur_state != TAP_SD)
+
+	if (cur_state != TAP_DRSHIFT)
 		predicted_size += 3;
-	
+
 	if (type == SCAN_IN)	/* only from device to host */
 	{
 		/* complete bytes */
@@ -918,7 +921,7 @@
 int ft2232_predict_scan_in(int scan_size, enum scan_type type)
 {
 	int predicted_size = 0;
-	
+
 	if (type != SCAN_OUT)
 	{
 		/* complete bytes */
@@ -928,7 +931,7 @@
 		/* last bit (from TMS scan) */
 		predicted_size += 1;
 	}
-	
+
 	/* LOG_DEBUG("scan_size: %i, predicted_size: %i", scan_size, predicted_size); */
 
 	return predicted_size;
@@ -965,7 +968,7 @@
 		else
 			low_direction &= ~nSRSTnOE;	/* switch to input pin (high-Z) */
 	}
-	
+
 	/* command "set data bits low byte" */
 	BUFFER_ADD = 0x80;
 	BUFFER_ADD = low_output;
@@ -1004,7 +1007,7 @@
 		else
 			high_output |= nSRSTnOE;
 	}
-	
+
 	/* command "set data bits high byte" */
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
@@ -1045,6 +1048,34 @@
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output, high_direction);
 }
 
+void axm0432_jtag_reset(int trst, int srst)
+{
+	if (trst == 1)
+	{
+		cur_state = TAP_RESET;
+		high_output &= ~nTRST;
+	}
+	else if (trst == 0)
+	{
+		high_output |= nTRST;
+	}
+
+	if (srst == 1)
+	{
+		high_output &= ~nSRST;
+	}
+	else if (srst == 0)
+	{
+		high_output |= nSRST;
+	}
+
+	/* command "set data bits low byte" */
+	BUFFER_ADD = 0x82;
+	BUFFER_ADD = high_output;
+	BUFFER_ADD = high_direction;
+	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output, high_direction);
+}
+
 void flyswatter_reset(int trst, int srst)
 {
 	if (trst == 1)
@@ -1075,7 +1106,7 @@
 void turtle_reset(int trst, int srst)
 {
 	trst = trst;
-	
+
 	if (srst == 1)
 	{
 		low_output |= nSRST;
@@ -1084,7 +1115,7 @@
 	{
 		low_output &= ~nSRST;
 	}
-	
+
 	/* command "set data bits low byte" */
 	BUFFER_ADD = 0x80;
 	BUFFER_ADD = low_output;
@@ -1111,7 +1142,7 @@
 	{
 		high_output |= nSRST;
 	}
-	
+
 	/* command "set data bits high byte" */
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
@@ -1138,12 +1169,12 @@
 	{
 		low_output |= nSRST;
 	}
-	
+
 	/* command "set data bits low byte" */
 	BUFFER_ADD = 0x80;
 	BUFFER_ADD = low_output;
 	BUFFER_ADD = low_direction;
-	
+
 	/* command "set data bits high byte" */
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
@@ -1162,15 +1193,15 @@
 	int predicted_size = 0;
 	int require_send = 0;
 	int retval;
-	
+
 	/* return ERROR_OK, unless ft2232_send_and_recv reports a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
 
 	ft2232_buffer_size = 0;
 	ft2232_expect_read = 0;
-	
+
 	/* blink, if the current layout has that feature */
 	if (layout->blink)
 		layout->blink();
@@ -1196,24 +1227,24 @@
 
 				if ((cmd->cmd.reset->trst == 1) || (cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST)))
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				layout->reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				require_send = 1;
-				
-#ifdef _DEBUG_JTAG_IO_				
+
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("trst: %i, srst: %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 #endif
 				break;
 			case JTAG_RUNTEST:
 				/* only send the maximum buffer size that FT2232C can handle */
 				predicted_size = 0;
-				if (cur_state != TAP_RTI)
+				if (cur_state != TAP_IDLE)
 					predicted_size += 3;
 				predicted_size += 3 * CEIL(cmd->cmd.runtest->num_cycles, 7);
-				if ((cmd->cmd.runtest->end_state != -1) && (cmd->cmd.runtest->end_state != TAP_RTI))
+				if ((cmd->cmd.runtest->end_state != -1) && (cmd->cmd.runtest->end_state != TAP_IDLE))
 					predicted_size += 3;
-				if ((cmd->cmd.runtest->end_state == -1) && (end_state != TAP_RTI))
+				if ((cmd->cmd.runtest->end_state == -1) && (end_state != TAP_IDLE))
 					predicted_size += 3;
 				if (ft2232_buffer_size + predicted_size + 1 > FT2232_BUFFER_SIZE)
 				{
@@ -1222,15 +1253,15 @@
 					require_send = 0;
 					first_unsent = cmd;
 				}
-				if (cur_state != TAP_RTI)
+				if (cur_state != TAP_IDLE)
 				{
 					/* command "Clock Data to TMS/CS Pin (no Read)" */
 					BUFFER_ADD = 0x4b;
 					/* scan 7 bit */
 					BUFFER_ADD = 0x6;
 					/* TMS data bits */
-					BUFFER_ADD = TAP_MOVE(cur_state, TAP_RTI);
-					cur_state = TAP_RTI;
+					BUFFER_ADD = TAP_MOVE(cur_state, TAP_IDLE);
+					cur_state = TAP_IDLE;
 					require_send = 1;
 				}
 				i = cmd->cmd.runtest->num_cycles;
@@ -1242,7 +1273,7 @@
 					BUFFER_ADD = (i > 7) ? 6 : (i - 1);
 					/* TMS data bits */
 					BUFFER_ADD = 0x0;
-					cur_state = TAP_RTI;
+					cur_state = TAP_IDLE;
 					i -= (i > 7) ? 7 : i;
 					/* LOG_DEBUG("added TMS scan (no read)"); */
 				}
@@ -1260,7 +1291,7 @@
 					/* LOG_DEBUG("added TMS scan (no read)"); */
 				}
 				require_send = 1;
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("runtest: %i, end in %i", cmd->cmd.runtest->num_cycles, end_state);
 #endif
 				break;
@@ -1285,7 +1316,7 @@
 				/* LOG_DEBUG("added TMS scan (no read)"); */
 				cur_state = end_state;
 				require_send = 1;
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("statemove: %i", end_state);
 #endif
 				break;
@@ -1301,7 +1332,7 @@
 				}
 				ft2232_add_pathmove(cmd->cmd.pathmove);
 				require_send = 1;
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("pathmove: %i states, end in %i", cmd->cmd.pathmove->num_states, cmd->cmd.pathmove->path[cmd->cmd.pathmove->num_states - 1]);
 #endif
 				break;
@@ -1316,7 +1347,7 @@
 					if (first_unsent != cmd)
 						if (ft2232_send_and_recv(first_unsent, cmd) != ERROR_OK)
 							retval = ERROR_JTAG_QUEUE_FAILED;
-					
+
 					/* current command */
 					if (cmd->cmd.scan->end_state != -1)
 						ft2232_end_state(cmd->cmd.scan->end_state);
@@ -1343,7 +1374,7 @@
 				require_send = 1;
 				if (buffer)
 					free(buffer);
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("%s scan, %i bit, end in %i", (cmd->cmd.scan->ir_scan) ? "IR" : "DR", scan_size, end_state);
 #endif
 				break;
@@ -1352,7 +1383,7 @@
 					retval = ERROR_JTAG_QUEUE_FAILED;
 				first_unsent = cmd->next;
 				jtag_sleep(cmd->cmd.sleep->us);
-#ifdef _DEBUG_JTAG_IO_				
+#ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("sleep %i usec", cmd->cmd.sleep->us);
 #endif
 				break;
@@ -1378,15 +1409,13 @@
 	char *openex_string = NULL;
 	u8 latency_timer;
 
-	LOG_DEBUG("'ft2232' interface using FTD2XX with '%s' layout (%4.4x:%4.4x)",
-	    ft2232_layout, vid, pid);
+	LOG_DEBUG("'ft2232' interface using FTD2XX with '%s' layout (%4.4x:%4.4x)",ft2232_layout, vid, pid);
 
 #if IS_WIN32 == 0
 	/* Add non-standard Vid/Pid to the linux driver */
 	if ((status = FT_SetVIDPID(vid, pid)) != FT_OK)
 	{
-		LOG_WARNING("couldn't add %4.4x:%4.4x",
-		    vid, pid);
+		LOG_WARNING("couldn't add %4.4x:%4.4x", vid, pid);
 	}
 #endif
 
@@ -1395,7 +1424,7 @@
 		LOG_WARNING("can't open by device description and serial number, giving precedence to serial");
 		ft2232_device_desc = NULL;
 	}
-	
+
 	if (ft2232_device_desc)
 	{
 		openex_string = ft2232_device_desc;
@@ -1410,17 +1439,16 @@
 	{
 		LOG_ERROR("neither device description nor serial number specified");
 		LOG_ERROR("please add \"ft2232_device_desc <string>\" or \"ft2232_serial <string>\" to your .cfg file");
-		
-		return ERROR_JTAG_INIT_FAILED;	
+
+		return ERROR_JTAG_INIT_FAILED;
 	}
 
 	if ((status = FT_OpenEx(openex_string, openex_flags, &ftdih)) != FT_OK)
 	{
 		DWORD num_devices;
-		
+
 		if (more) {
-			LOG_WARNING("unable to open ftdi device (trying more): %lu",
-			    status);
+			LOG_WARNING("unable to open ftdi device (trying more): %lu", status);
 			*try_more = 1;
 			return ERROR_JTAG_INIT_FAILED;
 		}
@@ -1443,7 +1471,7 @@
 				for (i = 0; i < num_devices; i++)
 					LOG_ERROR("%i: %s", i, desc_array[i]);
 			}
-			
+
 			for (i = 0; i < num_devices; i++)
 				free(desc_array[i]);
 			free(desc_array);
@@ -1460,7 +1488,7 @@
 		LOG_ERROR("unable to set latency timer: %lu", status);
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	if ((status = FT_GetLatencyTimer(ftdih, &latency_timer)) != FT_OK)
 	{
 		LOG_ERROR("unable to get latency timer: %lu", status);
@@ -1470,7 +1498,7 @@
 	{
 		LOG_DEBUG("current latency timer: %i", latency_timer);
 	}
-	
+
 	if ((status = FT_SetTimeouts(ftdih, 5000, 5000)) != FT_OK)
 	{
 		LOG_ERROR("unable to set timeouts: %lu", status);
@@ -1540,7 +1568,7 @@
 		LOG_ERROR("unable to set latency timer");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	if (ftdi_get_latency_timer(&ftdic, &latency_timer) < 0)
 	{
 		LOG_ERROR("unable to get latency timer");
@@ -1575,13 +1603,13 @@
 	u32 bytes_written;
 	ft2232_layout_t *cur_layout = ft2232_layouts;
 	int i;
-	
+
 	if ((ft2232_layout == NULL) || (ft2232_layout[0] == 0))
 	{
 		ft2232_layout = "usbjtag";
 		LOG_WARNING("No ft2232 layout specified, using default 'usbjtag'");
 	}
-	
+
 	while (cur_layout->name)
 	{
 		if (strcmp(cur_layout->name, ft2232_layout) == 0)
@@ -1597,7 +1625,7 @@
 		LOG_ERROR("No matching layout found for %s", ft2232_layout);
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	for (i = 0; 1; i++) {
 		/*
 		 * "more indicates that there are more IDs to try, so we should
@@ -1617,7 +1645,7 @@
 #elif BUILD_FT2232_LIBFTDI == 1
 		retval = ft2232_init_libftdi(ft2232_vid[i], ft2232_pid[i],
 			more, &try_more);
-#endif	
+#endif
 		if (retval >= 0)
 			break;
 		if (!more || !try_more)
@@ -1643,7 +1671,7 @@
 	return ft2232_purge_ftd2xx();
 #elif BUILD_FT2232_LIBFTDI == 1
 	return ft2232_purge_libftdi();
-#endif	
+#endif
 
 	return ERROR_OK;
 }
@@ -1652,10 +1680,10 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x0b;
-	
+
 	if (strcmp(ft2232_layout, "usbjtag") == 0)
 	{
 		nTRST = 0x10;
@@ -1682,9 +1710,9 @@
 	else
 	{
 		LOG_ERROR("BUG: usbjtag_init called for unknown layout '%s'", ft2232_layout);
-		return ERROR_JTAG_INIT_FAILED;	
+		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	if (jtag_reset_config & RESET_TRST_OPEN_DRAIN)
 	{
 		low_direction &= ~nTRSTnOE; /* nTRST input */
@@ -1695,7 +1723,7 @@
 		low_direction |= nTRSTnOE; /* nTRST output */
 		low_output |= nTRST; /* nTRST = 1 */
 	}
-	
+
 	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
 	{
 		low_direction |= nSRSTnOE; /* nSRST output */
@@ -1706,42 +1734,111 @@
 		low_direction &= ~nSRSTnOE; /* nSRST input */
 		low_output &= ~nSRST; /* nSRST = 0 */
 	}
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, xRST high) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'USBJTAG' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'USBJTAG' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
 
 	return ERROR_OK;
 }
 
+int axm0432_jtag_init(void)
+{
+	u8 buf[3];
+	u32 bytes_written;
+
+	low_output = 0x08;
+	low_direction = 0x2b;
+
+	/* initialize low byte for jtag */
+	buf[0] = 0x80; /* command "set data bits low byte" */
+	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
+	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
+	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
+
+	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
+	{
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
+		return ERROR_JTAG_INIT_FAILED;
+	}
+
+	if (strcmp(layout->name, "axm0432_jtag") == 0)
+	{
+		nTRST = 0x08;
+		nTRSTnOE = 0x0;  /* No output enable for TRST*/
+		nSRST = 0x04;
+		nSRSTnOE = 0x0;  /* No output enable for SRST*/
+	}
+	else
+	{
+		LOG_ERROR("BUG: axm0432_jtag_init called for non axm0432 layout");
+		exit(-1);
+	}
+
+	high_output = 0x0;
+	high_direction = 0x0c;
+
+	if (jtag_reset_config & RESET_TRST_OPEN_DRAIN)
+	{
+		LOG_ERROR("can't set nTRSTOE to push-pull on the Dicarlo jtag");
+	}
+	else
+	{
+		high_output |= nTRST;
+	}
+
+	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
+	{
+		LOG_ERROR("can't set nSRST to push-pull on the Dicarlo jtag");
+	}
+	else
+	{
+		high_output |= nSRST;
+	}
+
+	/* initialize high port */
+	buf[0] = 0x82; /* command "set data bits high byte" */
+	buf[1] = high_output; /* value */
+	buf[2] = high_direction;   /* all outputs (xRST and xRSTnOE) */
+	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
+
+	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
+	{
+		LOG_ERROR("couldn't initialize FT2232 with 'Dicarlo' layout");
+		return ERROR_JTAG_INIT_FAILED;
+	}
+
+	return ERROR_OK;
+}
+
 int jtagkey_init(void)
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x1b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	if (strcmp(layout->name, "jtagkey") == 0)
 	{
 		nTRST = 0x01;
@@ -1762,7 +1859,7 @@
 		LOG_ERROR("BUG: jtagkey_init called for non jtagkey layout");
 		exit(-1);
 	}
-	
+
 	high_output = 0x0;
 	high_direction = 0x0f;
 
@@ -1776,7 +1873,7 @@
 		high_output &= ~nTRSTnOE;
 		high_output |= nTRST;
 	}
-	
+
 	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
 	{
 		high_output &= ~nSRSTnOE;
@@ -1787,19 +1884,19 @@
 		high_output |= nSRSTnOE;
 		high_output &= ~nSRST;
 	}
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output; /* value */
 	buf[2] = high_direction;   /* all outputs (xRST and xRSTnOE) */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1807,22 +1904,22 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x1b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	nTRST = 0x01;
 	nTRSTnOE = 0x4;
 	nSRST = 0x02;
@@ -1841,7 +1938,7 @@
 		high_output &= ~nTRSTnOE;
 		high_output |= nTRST;
 	}
-	
+
 	if (jtag_reset_config & RESET_SRST_PUSH_PULL)
 	{
 		LOG_ERROR("can't set nSRST to push-pull on the Olimex ARM-USB-OCD");
@@ -1850,22 +1947,22 @@
 	{
 		high_output &= ~nSRST;
 	}
-	
+
 	/* turn red LED on */
 	high_output |= 0x08;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output; /* value */
 	buf[2] = high_direction;   /* all outputs (xRST and xRSTnOE) */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'JTAGkey' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1873,22 +1970,22 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x18;
 	low_direction = 0xfb;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE[12]=out, n[ST]srst=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'flyswatter' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'flyswatter' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	nTRST = 0x10;
 	nTRSTnOE = 0x0; /* not output enable for nTRST */
 	nSRST = 0x20;
@@ -1899,19 +1996,19 @@
 
 	/* turn red LED1 on, LED2 off */
 	high_output |= 0x08;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output; /* value */
 	buf[2] = high_direction;   /* all outputs (xRST and xRSTnOE) */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'flyswatter' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'flyswatter' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1919,39 +2016,39 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x5b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'turtelizer2' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'turtelizer2' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	nSRST = 0x40;
-  	
+
 	high_output = 0x00;
 	high_direction = 0x0C;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output;
 	buf[2] = high_direction;
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'turtelizer2' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'turtelizer2' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1959,42 +2056,42 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x08;
 	low_direction = 0x0b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'comstick' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'comstick' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	nTRST = 0x01;
 	nTRSTnOE = 0x00; /* no output enable for nTRST */
 	nSRST = 0x02;
 	nSRSTnOE = 0x00; /* no output enable for nSRST */
-  	
+
 	high_output = 0x03;
 	high_direction = 0x03;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output;
 	buf[2] = high_direction;
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'comstick' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'comstick' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2002,42 +2099,42 @@
 {
 	u8 buf[3];
 	u32 bytes_written;
-	
+
 	low_output = 0x88;
 	low_direction = 0x8b;
-	
+
 	/* initialize low byte for jtag */
 	buf[0] = 0x80; /* command "set data bits low byte" */
 	buf[1] = low_output; /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
 	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'stm32stick' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'stm32stick' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-		
+
 	nTRST = 0x01;
 	nTRSTnOE = 0x00; /* no output enable for nTRST */
 	nSRST = 0x80;
 	nSRSTnOE = 0x00; /* no output enable for nSRST */
-  	
+
 	high_output = 0x01;
 	high_direction = 0x03;
-	
+
 	/* initialize high port */
 	buf[0] = 0x82; /* command "set data bits high byte" */
 	buf[1] = high_output;
 	buf[2] = high_direction;
 	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
-	
+
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'stm32stick' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'stm32stick' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2056,7 +2153,7 @@
 		/* set port pin low */
 		high_output |= 0x08;
 	}
-	
+
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
 	BUFFER_ADD = high_direction;
@@ -2064,7 +2161,7 @@
 
 void turtle_jtag_blink(void)
 {
-	/* 
+	/*
    * Turtelizer2 has two LEDs connected to ACBUS2 and ACBUS3
 	 */
 	if (high_output & 0x08)
@@ -2075,7 +2172,7 @@
 	{
 		high_output = 0x08;
 	}
-	
+
 	BUFFER_ADD = 0x82;
 	BUFFER_ADD = high_output;
 	BUFFER_ADD = high_direction;
@@ -2089,9 +2186,9 @@
 	status = FT_Close(ftdih);
 #elif BUILD_FT2232_LIBFTDI == 1
 	ftdi_disable_bitbang(&ftdic);
-	
+
 	ftdi_usb_close(&ftdic);
-	
+
 	ftdi_deinit(&ftdic);
 #endif
 
@@ -2111,7 +2208,7 @@
 	{
 		LOG_ERROR("expected exactly one argument to ft2232_device_desc <description>");
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2125,7 +2222,7 @@
 	{
 		LOG_ERROR("expected exactly one argument to ft2232_serial <serial-number>");
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2179,6 +2276,6 @@
 	{
 		LOG_ERROR("expected exactly one argument to ft2232_latency <ms>");
 	}
-	
+
 	return ERROR_OK;
 }

Modified: branches/openocd_1_0_branch/src/jtag/gw16012.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/gw16012.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/gw16012.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -97,13 +97,13 @@
 
 int gw16012_handle_parport_port_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
-jtag_interface_t gw16012_interface = 
+jtag_interface_t gw16012_interface =
 {
 	.name = "gw16012",
-	
+
 	.execute_queue = gw16012_execute_queue,
 
-	.speed = gw16012_speed,	
+	.speed = gw16012_speed,
 	.register_commands = gw16012_register_commands,
 	.init = gw16012_init,
 	.quit = gw16012_quit,
@@ -113,7 +113,7 @@
 {
 	register_command(cmd_ctx, NULL, "parport_port", gw16012_handle_parport_port_command,
 					 COMMAND_CONFIG, NULL);
-	
+
 	return ERROR_OK;
 }
 
@@ -125,7 +125,7 @@
 #ifdef _DEBUG_GW16012_IO_
 	LOG_DEBUG("%2.2x", value);
 #endif
-	
+
 	#if PARPORT_USE_PPDEV == 1
 		ioctl(device_handle, PPWDATA, &value);
 	#else
@@ -134,7 +134,7 @@
 		#else
 			outb(value, gw16012_port);
 		#endif
-	#endif	
+	#endif
 }
 
 void gw16012_control(u8 value)
@@ -209,15 +209,15 @@
 {
 	int i=0, tms=0;
 	u8 tms_scan = TAP_MOVE(cur_state, end_state);
-	
+
 	gw16012_control(0x0); /* single-bit mode */
-	
+
 	for (i = 0; i < 7; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		gw16012_data(tms << 1); /* output next TMS bit */
 	}
-	
+
 	cur_state = end_state;
 }
 
@@ -243,12 +243,12 @@
 			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[cmd->path[state_count]]);
 			exit(-1);
 		}
-		
+
 		cur_state = cmd->path[state_count];
 		state_count++;
 		num_states--;
 	}
-	
+
 	end_state = cur_state;
 }
 
@@ -256,20 +256,20 @@
 {
 	enum tap_state saved_end_state = end_state;
 	int i;
-	
-	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+
+	/* only do a state_move when we're not already in IDLE */
+	if (cur_state != TAP_IDLE)
 	{
-		gw16012_end_state(TAP_RTI);
+		gw16012_end_state(TAP_IDLE);
 		gw16012_state_move();
 	}
-	
+
 	for (i = 0; i < num_cycles; i++)
 	{
 		gw16012_control(0x0); /* single-bit mode */
 		gw16012_data(0x0); /* TMS cycle with TMS low */
 	}
-	
+
 	gw16012_end_state(saved_end_state);
 	if (cur_state != end_state)
 		gw16012_state_move();
@@ -283,12 +283,12 @@
 	u8 scan_out, scan_in;
 
 	/* only if we're not already in the correct Shift state */
-	if (!((!ir_scan && (cur_state == TAP_SD)) || (ir_scan && (cur_state == TAP_SI))))
+	if (!((!ir_scan && (cur_state == TAP_DRSHIFT)) || (ir_scan && (cur_state == TAP_IRSHIFT))))
 	{
 		if (ir_scan)
-			gw16012_end_state(TAP_SI);
+			gw16012_end_state(TAP_IRSHIFT);
 		else
-			gw16012_end_state(TAP_SD);
+			gw16012_end_state(TAP_DRSHIFT);
 
 		gw16012_state_move();
 		gw16012_end_state(saved_end_state);
@@ -302,20 +302,20 @@
 		bit_count += 7;
 		bits_left -= 7;
 	}
-	
+
 	gw16012_control(0x0); /* single-bit mode */
 	while (bits_left-- > 0)
 	{
 		u8 tms = 0;
-		
+
 		scan_out = buf_get_u32(buffer, bit_count, 1);
-		
+
 		if (bits_left == 0) /* last bit */
 		{
-			if ((ir_scan && (end_state == TAP_SI))
-				|| (!ir_scan && (end_state == TAP_SD)))
+			if ((ir_scan && (end_state == TAP_IRSHIFT))
+				|| (!ir_scan && (end_state == TAP_DRSHIFT)))
 			{
-				tms = 0; 
+				tms = 0;
 			}
 			else
 			{
@@ -329,20 +329,20 @@
 		{
 			gw16012_input(&scan_in);
 			buf_set_u32(buffer, bit_count, 1, ((scan_in & 0x08) >> 3));
-		}		
+		}
 
 		bit_count++;
 	}
 
-	if (!((ir_scan && (end_state == TAP_SI)) ||
-		(!ir_scan && (end_state == TAP_SD))))
+	if (!((ir_scan && (end_state == TAP_IRSHIFT)) ||
+		(!ir_scan && (end_state == TAP_DRSHIFT))))
 	{
 		gw16012_data(0x0);
 		if (ir_scan)
-			cur_state = TAP_PI;
+			cur_state = TAP_IRPAUSE;
 		else
-			cur_state = TAP_PD;
-			
+			cur_state = TAP_DRPAUSE;
+
 		if (cur_state != end_state)
 			gw16012_state_move();
 	}
@@ -355,12 +355,12 @@
 	enum scan_type type;
 	u8 *buffer;
 	int retval;
-	
+
 	/* return ERROR_OK, unless a jtag_read_buffer returns a failed check
 	 * that wasn't handled by a caller-provided error handler
-	 */ 
+	 */
 	retval = ERROR_OK;
-		
+
 	while (cmd)
 	{
 		switch (cmd->type)
@@ -378,7 +378,7 @@
 #endif
 				if (cmd->cmd.reset->trst == 1)
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				gw16012_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
@@ -410,7 +410,7 @@
 				scan_size = jtag_build_buffer(cmd->cmd.scan, &buffer);
 				type = jtag_scan_type(cmd->cmd.scan);
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG("%s scan (%i) %i bit end in %i", (cmd->cmd.scan->ir_scan) ? "ir" : "dr", 
+				LOG_DEBUG("%s scan (%i) %i bit end in %i", (cmd->cmd.scan->ir_scan) ? "ir" : "dr",
 					type, scan_size, cmd->cmd.scan->end_state);
 #endif
 				gw16012_scan(cmd->cmd.scan->ir_scan, type, buffer, scan_size);
@@ -431,7 +431,7 @@
 		}
 		cmd = cmd->next;
 	}
-	
+
 	return retval;
 }
 
@@ -443,16 +443,16 @@
 
     version.dwOSVersionInfoSize = sizeof version;
     if (!GetVersionEx( &version )) {
-        errno = EINVAL;
-        return -1;
+	errno = EINVAL;
+	return -1;
     }
     if (version.dwPlatformId != VER_PLATFORM_WIN32_NT)
-        return 0;
+	return 0;
 
     h = CreateFile( "\\\\.\\giveio", GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );
     if (h == INVALID_HANDLE_VALUE) {
-        errno = ENODEV;
-        return -1;
+	errno = ENODEV;
+	return -1;
     }
 
     CloseHandle( h );
@@ -468,7 +468,7 @@
 	int i = 0;
 #endif
 	u8 status_port;
-	
+
 #if PARPORT_USE_PPDEV == 1
 	if (device_handle>0)
 	{
@@ -486,7 +486,7 @@
 
 	snprintf(buffer, 256, "/dev/parport%d", gw16012_port);
 	device_handle = open(buffer, O_WRONLY);
-#endif	
+#endif
 	if (device_handle<0)
 	{
 		LOG_ERROR("cannot open device. check it exists and that user read and write rights are set");
@@ -525,7 +525,7 @@
 		gw16012_port = 0x378;
 		LOG_WARNING("No gw16012 port specified, using default '0x378' (LPT1)");
 	}
-	
+
 	LOG_DEBUG("requesting privileges for parallel port 0x%lx...", (long unsigned)(gw16012_port) );
 #if PARPORT_USE_GIVEIO == 1
 	if (gw16012_get_giveio_access() != 0)
@@ -545,19 +545,19 @@
 	outb(0x0, gw16012_port + 2);
 #endif
 #endif /* PARPORT_USE_PPDEV */
-	
+
 	gw16012_input(&status_port);
 	gw16012_msb = (status_port & 0x80) ^ 0x80;
-	
+
 	gw16012_speed(jtag_speed);
 	gw16012_reset(0, 0);
-	
+
 	return ERROR_OK;
 }
 
 int gw16012_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 

Modified: branches/openocd_1_0_branch/src/jtag/jlink.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/jlink.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/jlink.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -146,92 +146,92 @@
 	int scan_size;
 	enum scan_type type;
 	u8 *buffer;
-	
+
 	while (cmd != NULL)
 	{
 		switch (cmd->type)
 		{
 			case JTAG_END_STATE:
 				DEBUG_JTAG_IO("end_state: %i", cmd->cmd.end_state->end_state);
-			
+
 				if (cmd->cmd.end_state->end_state != -1)
 				{
 					jlink_end_state(cmd->cmd.end_state->end_state);
 				}
 				break;
-	
+
 			case JTAG_RUNTEST:
 				DEBUG_JTAG_IO( "runtest %i cycles, end in %i", cmd->cmd.runtest->num_cycles, \
 					cmd->cmd.runtest->end_state);
-				
+
 				if (cmd->cmd.runtest->end_state != -1)
 				{
 					jlink_end_state(cmd->cmd.runtest->end_state);
 				}
 				jlink_runtest(cmd->cmd.runtest->num_cycles);
 				break;
-	
+
 			case JTAG_STATEMOVE:
 				DEBUG_JTAG_IO("statemove end in %i", cmd->cmd.statemove->end_state);
-			
+
 				if (cmd->cmd.statemove->end_state != -1)
 				{
 					jlink_end_state(cmd->cmd.statemove->end_state);
 				}
 				jlink_state_move();
 				break;
-	
+
 			case JTAG_PATHMOVE:
 				DEBUG_JTAG_IO("pathmove: %i states, end in %i", \
 					cmd->cmd.pathmove->num_states, \
 					cmd->cmd.pathmove->path[cmd->cmd.pathmove->num_states - 1]);
-			
+
 				jlink_path_move(cmd->cmd.pathmove->num_states, cmd->cmd.pathmove->path);
 				break;
-	
+
 			case JTAG_SCAN:
 				DEBUG_JTAG_IO("scan end in %i", cmd->cmd.scan->end_state);
-			
+
 				if (cmd->cmd.scan->end_state != -1)
 				{
 					jlink_end_state(cmd->cmd.scan->end_state);
 				}
-			
+
 				scan_size = jtag_build_buffer(cmd->cmd.scan, &buffer);
 				DEBUG_JTAG_IO("scan input, length = %d", scan_size);
-				
+
 #ifdef _DEBUG_USB_COMMS_
 				jlink_debug_buffer(buffer, (scan_size + 7) / 8);
 #endif
 				type = jtag_scan_type(cmd->cmd.scan);
 				jlink_scan(cmd->cmd.scan->ir_scan, type, buffer, scan_size, cmd->cmd.scan);
 				break;
-	
+
 			case JTAG_RESET:
 				DEBUG_JTAG_IO("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);
-			
+
 				jlink_tap_execute();
-			
+
 				if (cmd->cmd.reset->trst == 1)
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				jlink_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
-	
+
 			case JTAG_SLEEP:
 				DEBUG_JTAG_IO("sleep %i", cmd->cmd.sleep->us);
 				jlink_tap_execute();
 				jtag_sleep(cmd->cmd.sleep->us);
 				break;
-	
+
 			default:
 				LOG_ERROR("BUG: unknown JTAG command type encountered");
 				exit(-1);
 		}
 		cmd = cmd->next;
 	}
-	
+
 	return jlink_tap_execute();
 }
 
@@ -239,19 +239,19 @@
 int jlink_speed(int speed)
 {
 	int result;
-	
+
 	if (speed <= JLINK_MAX_SPEED)
 	{
 		/* check for RTCK setting */
 		if (speed == 0)
 			speed = -1;
-		
+
 		usb_out_buffer[0] = EMU_CMD_SET_SPEED;
 		usb_out_buffer[1] = (speed >> 0) & 0xff;
 		usb_out_buffer[2] = (speed >> 8) & 0xff;
-		
+
 		result = jlink_usb_write(jlink_jtag_handle, 3);
-		
+
 		if (result == 3)
 		{
 			return ERROR_OK;
@@ -266,14 +266,14 @@
 	{
 		LOG_INFO("Requested speed %dkHz exceeds maximum of %dkHz, ignored", speed, JLINK_MAX_SPEED);
 	}
-	
+
 	return ERROR_OK;
 }
 
 int jlink_khz(int khz, int *jtag_speed)
 {
 	*jtag_speed = khz;
-	
+
 	return ERROR_OK;
 }
 
@@ -286,16 +286,16 @@
 
 int jlink_init(void)
 {
-	int check_cnt;  
-	
+	int check_cnt;
+
 	jlink_jtag_handle = jlink_usb_open();
-	
+
 	if (jlink_jtag_handle == 0)
 	{
 		LOG_ERROR("Cannot find jlink Interface! Please check connection and permissions.");
 		return ERROR_JTAG_INIT_FAILED;
 	}
-		
+
 	check_cnt = 0;
 	while (check_cnt < 3)
 	{
@@ -305,7 +305,7 @@
 			jlink_get_status();
 			break;
 		}
-		
+
 		check_cnt++;
 	}
 
@@ -313,12 +313,12 @@
 	{
 		LOG_INFO("J-Link initial read failed, don't worry");
 	}
-	
+
 	LOG_INFO("J-Link JTAG Interface ready");
-	
+
 	jlink_reset(0, 0);
 	jlink_tap_init();
-	
+
 	return ERROR_OK;
 }
 
@@ -350,20 +350,20 @@
 	int i;
 	int tms = 0;
 	u8 tms_scan = TAP_MOVE(cur_state, end_state);
-	
+
 	for (i = 0; i < 7; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		jlink_tap_append_step(tms, 0);
 	}
-	
+
 	cur_state = end_state;
 }
 
 void jlink_path_move(int num_states, enum tap_state *path)
 {
 	int i;
-	
+
 	for (i = 0; i < num_states; i++)
 	{
 		if (path[i] == tap_transitions[cur_state].low)
@@ -379,32 +379,32 @@
 			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[path[i]]);
 			exit(-1);
 		}
-		
+
 		cur_state = path[i];
 	}
-	
+
 	end_state = cur_state;
 }
 
 void jlink_runtest(int num_cycles)
 {
 	int i;
-	
+
 	enum tap_state saved_end_state = end_state;
-	
-	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+
+	/* only do a state_move when we're not already in IDLE */
+	if (cur_state != TAP_IDLE)
 	{
-		jlink_end_state(TAP_RTI);
+		jlink_end_state(TAP_IDLE);
 		jlink_state_move();
 	}
-	
+
 	/* execute num_cycles */
 	for (i = 0; i < num_cycles; i++)
 	{
 		jlink_tap_append_step(0, 0);
 	}
-	
+
 	/* finish in end_state */
 	jlink_end_state(saved_end_state);
 	if (cur_state != end_state)
@@ -416,25 +416,25 @@
 void jlink_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
 {
 	enum tap_state saved_end_state;
-	
+
 	jlink_tap_ensure_space(1, scan_size + 8);
-	
+
 	saved_end_state = end_state;
-	
+
 	/* Move to appropriate scan state */
-	jlink_end_state(ir_scan ? TAP_SI : TAP_SD);
-	
+	jlink_end_state(ir_scan ? TAP_IRSHIFT : TAP_DRSHIFT);
+
 	jlink_state_move();
 	jlink_end_state(saved_end_state);
-	
+
 	/* Scan */
 	jlink_tap_append_scan(scan_size, buffer, command);
-	
+
 	/* We are in Exit1, go to Pause */
 	jlink_tap_append_step(0, 0);
-	
-	cur_state = ir_scan ? TAP_PI : TAP_PD;
-	
+
+	cur_state = ir_scan ? TAP_IRPAUSE : TAP_DRPAUSE;
+
 	if (cur_state != end_state)
 	{
 		jlink_state_move();
@@ -444,7 +444,7 @@
 void jlink_reset(int trst, int srst)
 {
 	LOG_DEBUG("trst: %i, srst: %i", trst, srst);
-	
+
 	/* Signals are active low */
 	if (srst == 0)
 	{
@@ -454,7 +454,7 @@
 	{
 		jlink_simple_command(EMU_CMD_HW_RESET0);
 	}
-	
+
 	if (trst == 0)
 	{
 		jlink_simple_command(EMU_CMD_HW_TRST1);
@@ -468,12 +468,12 @@
 void jlink_simple_command(u8 command)
 {
 	int result;
-	
+
 	DEBUG_JTAG_IO("0x%02x", command);
-	
+
 	usb_out_buffer[0] = command;
 	result = jlink_usb_write(jlink_jtag_handle, 1);
-	
+
 	if (result != 1)
 	{
 		LOG_ERROR("J-Link command 0x%02x failed (%d)", command, result);
@@ -483,10 +483,10 @@
 int jlink_get_status(void)
 {
 	int result;
-	
+
 	jlink_simple_command(EMU_CMD_GET_STATE);
 	result = jlink_usb_read(jlink_jtag_handle);
-	
+
 	if (result == 8)
 	{
 		int vref = usb_in_buffer[0] + (usb_in_buffer[1] << 8);
@@ -494,7 +494,7 @@
 			vref / 1000, vref % 1000, \
 			usb_in_buffer[2], usb_in_buffer[3], usb_in_buffer[4], \
 			usb_in_buffer[5], usb_in_buffer[6], usb_in_buffer[7]);
-		
+
 		if (vref < 1500)
 		{
 			LOG_ERROR("Vref too low. Check Target Power\n");
@@ -504,7 +504,7 @@
 	{
 		LOG_ERROR("J-Link command EMU_CMD_GET_STATE failed (%d)\n", result);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -512,16 +512,16 @@
 {
 	int result;
 	int len = 0;
-	
+
 	/* query hardware version */
 	jlink_simple_command(EMU_CMD_VERSION);
 	result = jlink_usb_read(jlink_jtag_handle);
-	
+
 	if (result == 2)
 	{
 		len = buf_get_u32(usb_in_buffer, 0, 16);
 		result = jlink_usb_read(jlink_jtag_handle);
-		
+
 		if (result == len)
 		{
 			usb_in_buffer[result] = 0;
@@ -529,7 +529,7 @@
 			return ERROR_OK;
 		}
 	}
-	
+
 	LOG_ERROR("J-Link command EMU_CMD_VERSION failed (%d)\n", result);
 	return ERROR_JTAG_DEVICE_ERROR;
 }
@@ -541,7 +541,7 @@
 		/* attempt to get status */
 		jlink_get_status();
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -581,7 +581,7 @@
 {
 	int available_scans = MAX_PENDING_SCAN_RESULTS - pending_scan_results_length;
 	int available_bits = JLINK_TAP_BUFFER_SIZE * 8 - tap_length;
-	
+
 	if (scans > available_scans || bits > available_bits)
 	{
 		jlink_tap_execute();
@@ -592,12 +592,12 @@
 {
 	last_tms = tms;
 	int index = tap_length / 8;
-	
+
 	if (index < JLINK_TAP_BUFFER_SIZE)
 	{
 		int bit_index = tap_length % 8;
 		u8 bit = 1 << bit_index;
-		
+
 		if (tms)
 		{
 			tms_buffer[index] |= bit;
@@ -606,7 +606,7 @@
 		{
 			tms_buffer[index] &= ~bit;
 		}
-		
+
 		if (tdi)
 		{
 			tdi_buffer[index] |= bit;
@@ -615,7 +615,7 @@
 		{
 			tdi_buffer[index] &= ~bit;
 		}
-		
+
 		tap_length++;
 	}
 	else
@@ -628,12 +628,12 @@
 {
 	pending_scan_result_t *pending_scan_result = &pending_scan_results_buffer[pending_scan_results_length];
 	int i;
-	
+
 	pending_scan_result->first = tap_length;
 	pending_scan_result->length = length;
 	pending_scan_result->command = command;
 	pending_scan_result->buffer = buffer;
-	
+
 	for (i = 0; i < length; i++)
 	{
 		jlink_tap_append_step((i < length-1 ? 0 : 1), (buffer[i/8] >> (i%8)) & 1);
@@ -650,7 +650,7 @@
 	int tdi_offset;
 	int i;
 	int result;
-	
+
 	if (tap_length > 0)
 	{
 		/* Pad last byte so that tap_length is divisible by 8 */
@@ -660,35 +660,35 @@
 			 * analogous to free-running JTAG interfaces. */
 			jlink_tap_append_step(last_tms, 0);
 		}
-	
+
 		byte_length = tap_length / 8;
-	
+
 		usb_out_buffer[0] = EMU_CMD_HW_JTAG3;
 		usb_out_buffer[1] = 0;
 		usb_out_buffer[2] = (tap_length >> 0) & 0xff;
 		usb_out_buffer[3] = (tap_length >> 8) & 0xff;
-	
+
 		tms_offset = 4;
 		for (i = 0; i < byte_length; i++)
 		{
 			usb_out_buffer[tms_offset + i] = tms_buffer[i];
 		}
-		
+
 		tdi_offset = tms_offset + byte_length;
 		for (i = 0; i < byte_length; i++)
 		{
 			usb_out_buffer[tdi_offset + i] = tdi_buffer[i];
 		}
-	
+
 		result = jlink_usb_message(jlink_jtag_handle, 4 + 2 * byte_length, byte_length);
-	
+
 		if (result == byte_length)
 		{
 			for (i = 0; i < byte_length; i++)
 			{
 				tdo_buffer[i] = usb_in_buffer[i];
 			}
-			
+
 			for (i = 0; i < pending_scan_results_length; i++)
 			{
 				pending_scan_result_t *pending_scan_result = &pending_scan_results_buffer[i];
@@ -696,22 +696,22 @@
 				int length = pending_scan_result->length;
 				int first = pending_scan_result->first;
 				scan_command_t *command = pending_scan_result->command;
-	
+
 				/* Copy to buffer */
 				buf_set_buf(tdo_buffer, first, buffer, 0, length);
-	
+
 				DEBUG_JTAG_IO("pending scan result, length = %d", length);
-				
+
 #ifdef _DEBUG_USB_COMMS_
 				jlink_debug_buffer(buffer, byte_length);
 #endif
-	
+
 				if (jtag_read_buffer(buffer, command) != ERROR_OK)
 				{
 					jlink_tap_init();
 					return ERROR_JTAG_QUEUE_FAILED;
 				}
-		
+
 				if (pending_scan_result->buffer != NULL)
 				{
 					free(pending_scan_result->buffer);
@@ -723,10 +723,10 @@
 			LOG_ERROR("jlink_tap_execute, wrong result %d, expected %d", result, byte_length);
 			return ERROR_JTAG_QUEUE_FAILED;
 		}
-		
+
 		jlink_tap_init();
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -738,19 +738,19 @@
 	struct usb_bus *busses;
 	struct usb_bus *bus;
 	struct usb_device *dev;
-	
+
 	jlink_jtag_t *result;
-	
+
 	result = (jlink_jtag_t*) malloc(sizeof(jlink_jtag_t));
-	
+
 	usb_init();
 	usb_find_busses();
 	usb_find_devices();
-	
+
 	busses = usb_get_busses();
-	
+
 	/* find jlink_jtag device in usb bus */
-	
+
 	for (bus = busses; bus; bus = bus->next)
 	{
 		for (dev = bus->devices; dev; dev = dev->next)
@@ -758,23 +758,23 @@
 			if ((dev->descriptor.idVendor == VID) && (dev->descriptor.idProduct == PID))
 			{
 				result->usb_handle = usb_open(dev);
-				
+
 				/* usb_set_configuration required under win32 */
 				usb_set_configuration(result->usb_handle, dev->config[0].bConfigurationValue);
 				usb_claim_interface(result->usb_handle, 0);
-				
+
 #if 0
-				/* 
+				/*
 				 * This makes problems under Mac OS X. And is not needed
 				 * under Windows. Hopefully this will not break a linux build
 				 */
 				usb_set_altinterface(result->usb_handle, 0);
-#endif				
+#endif
 				return result;
 			}
 		}
 	}
-	
+
 	free(result);
 	return NULL;
 }
@@ -790,7 +790,7 @@
 {
 	int result;
 	int result2;
-	
+
 	result = jlink_usb_write(jlink_jtag, out_length);
 	if (result == out_length)
 	{
@@ -811,7 +811,7 @@
 					else
 					{
 						LOG_ERROR("jlink_usb_read_emu_result (requested=0, result=%d)", usb_emu_result_buffer[0]);
-						return -1;				
+						return -1;
 					}
 				}
 				else
@@ -830,7 +830,7 @@
 				else
 				{
 					LOG_ERROR("jlink_usb_read_emu_result (requested=0, result=%d)", usb_in_buffer[result]);
-					return -1;				
+					return -1;
 				}
 			}
 		}
@@ -851,18 +851,18 @@
 int jlink_usb_write(jlink_jtag_t *jlink_jtag, int out_length)
 {
 	int result;
-	
+
 	if (out_length > JLINK_OUT_BUFFER_SIZE)
 	{
 		LOG_ERROR("jlink_jtag_write illegal out_length=%d (max=%d)", out_length, JLINK_OUT_BUFFER_SIZE);
 		return -1;
 	}
-	
+
 	result = usb_bulk_write(jlink_jtag->usb_handle, JLINK_WRITE_ENDPOINT, \
 		usb_out_buffer, out_length, JLINK_USB_TIMEOUT);
-	
+
 	DEBUG_JTAG_IO("jlink_usb_write, out_length = %d, result = %d", out_length, result);
-	
+
 #ifdef _DEBUG_USB_COMMS_
 	jlink_debug_buffer(usb_out_buffer, out_length);
 #endif
@@ -876,7 +876,7 @@
 		usb_in_buffer, JLINK_IN_BUFFER_SIZE, JLINK_USB_TIMEOUT);
 
 	DEBUG_JTAG_IO("jlink_usb_read, result = %d", result);
-	
+
 #ifdef _DEBUG_USB_COMMS_
 	jlink_debug_buffer(usb_in_buffer, result);
 #endif
@@ -890,7 +890,7 @@
 		usb_emu_result_buffer, JLINK_EMU_RESULT_BUFFER_SIZE, JLINK_USB_TIMEOUT);
 
 	DEBUG_JTAG_IO("jlink_usb_read_result, result = %d", result);
-	
+
 #ifdef _DEBUG_USB_COMMS_
 	jlink_debug_buffer(usb_emu_result_buffer, result);
 #endif
@@ -906,7 +906,7 @@
 	char s[4];
 	int i;
 	int j;
-	
+
 	for (i = 0; i < length; i += BYTES_PER_LINE)
 	{
 		snprintf(line, 5, "%04x", i);

Modified: branches/openocd_1_0_branch/src/jtag/jtag.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/jtag.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/jtag.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -67,17 +67,17 @@
  * 4: Shift-IR
  * 5: Pause-IR
  *
- * SD->SD and SI->SI have to be caught in interface specific code
+ * DRSHIFT->DRSHIFT and IRSHIFT->IRSHIFT have to be caught in interface specific code
  */
 u8 tap_move[6][6] =
 {
-/*	  TLR   RTI   SD    PD    SI    PI             */
-	{0x7f, 0x00, 0x17, 0x0a, 0x1b, 0x16},	/* TLR */
-	{0x7f, 0x00, 0x25, 0x05, 0x2b, 0x0b},	/* RTI */
-	{0x7f, 0x31, 0x00, 0x01, 0x0f, 0x2f},	/* SD  */
-	{0x7f, 0x30, 0x20, 0x17, 0x1e, 0x2f},	/* PD  */
-	{0x7f, 0x31, 0x07, 0x17, 0x00, 0x01},	/* SI  */
-	{0x7f, 0x30, 0x1c, 0x17, 0x20, 0x2f}	/* PI  */
+/*	  RESET  IDLE  DRSHIFT  DRPAUSE  IRSHIFT  IRPAUSE             */
+	{  0x7f, 0x00,    0x17,    0x0a,    0x1b,    0x16},	/* RESET */
+	{  0x7f, 0x00,    0x25,    0x05,    0x2b,    0x0b},	/* IDLE */
+	{  0x7f, 0x31,    0x00,    0x01,    0x0f,    0x2f},	/* DRSHIFT  */
+	{  0x7f, 0x30,    0x20,    0x17,    0x1e,    0x2f},	/* DRPAUSE  */
+	{  0x7f, 0x31,    0x07,    0x17,    0x00,    0x01},	/* IRSHIFT  */
+	{  0x7f, 0x30,    0x1c,    0x17,    0x20,    0x2f}	/* IRPAUSE  */
 };
 
 int tap_move_map[16] = {
@@ -87,27 +87,27 @@
 
 tap_transition_t tap_transitions[16] =
 {
-	{TAP_TLR, TAP_RTI},		/* TLR */
-	{TAP_SIS, TAP_CD},		/* SDS */
-	{TAP_E1D, TAP_SD},		/* CD  */
-	{TAP_E1D, TAP_SD},		/* SD  */
-	{TAP_UD,  TAP_PD}, 		/* E1D */
-	{TAP_E2D, TAP_PD},		/* PD  */
-	{TAP_UD,  TAP_SD},		/* E2D */
-	{TAP_SDS, TAP_RTI},		/* UD  */
-	{TAP_SDS, TAP_RTI},		/* RTI */
-	{TAP_TLR, TAP_CI},		/* SIS */
-	{TAP_E1I, TAP_SI},		/* CI  */
-	{TAP_E1I, TAP_SI},		/* SI  */
-	{TAP_UI,  TAP_PI}, 		/* E1I */
-	{TAP_E2I, TAP_PI},		/* PI  */
-	{TAP_UI,  TAP_SI},		/* E2I */
-	{TAP_SDS, TAP_RTI}		/* UI  */
+	{TAP_RESET, TAP_IDLE},		/* RESET */
+	{TAP_IRSELECT, TAP_DRCAPTURE},		/* DRSELECT */
+	{TAP_DREXIT1, TAP_DRSHIFT},		/* DRCAPTURE  */
+	{TAP_DREXIT1, TAP_DRSHIFT},		/* DRSHIFT  */
+	{TAP_DRUPDATE,  TAP_DRPAUSE}, 		/* DREXIT1 */
+	{TAP_DREXIT2, TAP_DRPAUSE},		/* DRPAUSE  */
+	{TAP_DRUPDATE,  TAP_DRSHIFT},		/* DREXIT2 */
+	{TAP_DRSELECT, TAP_IDLE},		/* DRUPDATE  */
+	{TAP_DRSELECT, TAP_IDLE},		/* IDLE */
+	{TAP_RESET, TAP_IRCAPTURE},		/* IRSELECT */
+	{TAP_IREXIT1, TAP_IRSHIFT},		/* IRCAPTURE  */
+	{TAP_IREXIT1, TAP_IRSHIFT},		/* IRSHIFT  */
+	{TAP_IRUPDATE,  TAP_IRPAUSE}, 		/* IREXIT1 */
+	{TAP_IREXIT2, TAP_IRPAUSE},		/* IRPAUSE  */
+	{TAP_IRUPDATE,  TAP_IRSHIFT},		/* IREXIT2 */
+	{TAP_DRSELECT, TAP_IDLE}		/* IRUPDATE  */
 };
 
 char* jtag_event_strings[] =
 {
-	"JTAG controller reset (TLR or TRST)"
+	"JTAG controller reset (RESET or TRST)"
 };
 
 /* kludge!!!! these are just global variables that the
@@ -115,8 +115,8 @@
  * inside the drivers, but we don't want to break
  * linking the drivers!!!!
  */
-enum tap_state end_state = TAP_TLR;
-enum tap_state cur_state = TAP_TLR;
+enum tap_state end_state = TAP_RESET;
+enum tap_state cur_state = TAP_RESET;
 int jtag_trst = 0;
 int jtag_srst = 0;
 
@@ -125,8 +125,8 @@
 static jtag_tap_t *jtag_all_taps = NULL;
 
 enum reset_types jtag_reset_config = RESET_NONE;
-enum tap_state cmd_queue_end_state = TAP_TLR;
-enum tap_state cmd_queue_cur_state = TAP_TLR;
+enum tap_state cmd_queue_end_state = TAP_RESET;
+enum tap_state cmd_queue_cur_state = TAP_RESET;
 
 int jtag_verify_capture_ir = 1;
 
@@ -477,7 +477,7 @@
 	 * alignment.
 	 *
 	 * What I do not/have is a reasonable portable means
-	 * to align by... 
+	 * to align by...
 	 *
 	 * The solution here, is based on these suggestions.
 	 * http://gcc.gnu.org/ml/gcc-help/2008-12/msg00041.html
@@ -493,9 +493,9 @@
 
 	// The alignment process.
 	size = (size + ALIGN_SIZE -1) & (~(ALIGN_SIZE-1));
-	// Done... 
-	
+	// Done...
 
+
 	if (*p_page)
 	{
 		while ((*p_page)->next)
@@ -543,7 +543,7 @@
 		return;
 	}
 
-	if (cmd_queue_end_state == TAP_TLR)
+	if (cmd_queue_end_state == TAP_RESET)
 		jtag_call_event_callbacks(JTAG_TRST_ASSERTED);
 }
 
@@ -959,7 +959,7 @@
 
 void jtag_add_tlr(void)
 {
-	jtag_prelude(TAP_TLR);
+	jtag_prelude(TAP_RESET);
 
 	int retval;
 	retval=interface_jtag_add_tlr();
@@ -969,7 +969,7 @@
 
 int MINIDRIVER(interface_jtag_add_tlr)()
 {
-	enum tap_state state = TAP_TLR;
+	enum tap_state state = TAP_RESET;
 	jtag_command_t **last_cmd = jtag_get_last_command_p();
 
 	/* allocate memory for a new list member */
@@ -1000,9 +1000,9 @@
 
 	for (i=0; i<num_states; i++)
 	{
-		if (path[i] == TAP_TLR)
+		if (path[i] == TAP_RESET)
 		{
-			LOG_ERROR("BUG: TAP_TLR is not a valid state for pathmove sequences");
+			LOG_ERROR("BUG: TAP_RESET is not a valid state for pathmove sequences");
 			exit(-1);
 		}
 		if ((tap_transitions[cur_state].low != path[i])&&
@@ -1153,8 +1153,8 @@
 
 	if (trst_with_tlr)
 	{
-		LOG_DEBUG("JTAG reset with TLR instead of TRST");
-		jtag_add_end_state(TAP_TLR);
+		LOG_DEBUG("JTAG reset with RESET instead of TRST");
+		jtag_add_end_state(TAP_RESET);
 		jtag_add_tlr();
 		jtag_call_event_callbacks(JTAG_TRST_ASSERTED);
 		return;
@@ -1166,7 +1166,7 @@
 		 * and inform possible listeners about this
 		 */
 		LOG_DEBUG("TRST line asserted");
-		cmd_queue_cur_state = TAP_TLR;
+		cmd_queue_cur_state = TAP_RESET;
 		jtag_call_event_callbacks(JTAG_TRST_ASSERTED);
 	}
 	else
@@ -1196,9 +1196,9 @@
 void jtag_add_end_state(enum tap_state state)
 {
 	cmd_queue_end_state = state;
-	if ((cmd_queue_end_state == TAP_SD)||(cmd_queue_end_state == TAP_SI))
+	if ((cmd_queue_end_state == TAP_DRSHIFT)||(cmd_queue_end_state == TAP_IRSHIFT))
 	{
-		LOG_ERROR("BUG: TAP_SD/SI can't be end state. Calling code should use a larger scan field");
+		LOG_ERROR("BUG: TAP_DRSHIFT/IRSHIFT can't be end state. Calling code should use a larger scan field");
 	}
 }
 
@@ -1491,7 +1491,7 @@
 		buf_set_u32(idcode_buffer, i * 32, 32, 0x000000FF);
 	}
 
-	jtag_add_plain_dr_scan(1, &field, TAP_TLR);
+	jtag_add_plain_dr_scan(1, &field, TAP_RESET);
 	jtag_execute_queue();
 
 	for (i = 0; i < JTAG_MAX_CHAIN_SIZE * 4; i++)
@@ -1574,20 +1574,36 @@
 		if (tap)
 		{
 			tap->idcode = idcode;
-			if( tap->expected_id ){
-				if( tap->idcode != tap->expected_id ){
-					LOG_ERROR("ERROR: Tap: %s - Expected id: 0x%08x, Got: 0x%08x",
+
+			if (tap->expected_ids_cnt > 0) {
+				/* Loop over the expected identification codes and test for a match */
+				u8 ii;
+				for (ii = 0; ii < tap->expected_ids_cnt; ii++) {
+					if( tap->idcode == tap->expected_ids[ii] ){
+						break;
+					}
+				}
+
+				/* If none of the expected ids matched, log an error */
+				if (ii == tap->expected_ids_cnt) {
+					LOG_ERROR("JTAG tap: %s             got: 0x%08x (mfg: 0x%3.3x, part: 0x%4.4x, ver: 0x%1.1x)",
 							  tap->dotted_name,
-							  tap->expected_id,
-							  idcode );
-					LOG_ERROR("ERROR: expected: mfg: 0x%3.3x, part: 0x%4.4x, ver: 0x%1.1x",
-							  EXTRACT_MFG( tap->expected_id ),
-							  EXTRACT_PART( tap->expected_id ),
-							  EXTRACT_VER( tap->expected_id ) );
-					LOG_ERROR("ERROR:      got: mfg: 0x%3.3x, part: 0x%4.4x, ver: 0x%1.1x",
+							  idcode,
 							  EXTRACT_MFG( tap->idcode ),
 							  EXTRACT_PART( tap->idcode ),
 							  EXTRACT_VER( tap->idcode ) );
+					for (ii = 0; ii < tap->expected_ids_cnt; ii++) {
+						LOG_ERROR("JTAG tap: %s expected %hhu of %hhu: 0x%08x (mfg: 0x%3.3x, part: 0x%4.4x, ver: 0x%1.1x)",
+								  tap->dotted_name,
+								  ii + 1,
+								  tap->expected_ids_cnt,
+								  tap->expected_ids[ii],
+								  EXTRACT_MFG( tap->expected_ids[ii] ),
+								  EXTRACT_PART( tap->expected_ids[ii] ),
+								  EXTRACT_VER( tap->expected_ids[ii] ) );
+					}
+
+					return ERROR_JTAG_INIT_FAILED;
 				} else {
 					LOG_INFO("JTAG Tap/device matched");
 				}
@@ -1646,7 +1662,7 @@
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
 
-	jtag_add_plain_ir_scan(1, &field, TAP_TLR);
+	jtag_add_plain_ir_scan(1, &field, TAP_RESET);
 	jtag_execute_queue();
 
 	tap = NULL;
@@ -1767,9 +1783,30 @@
 			pTap->enabled = 0;
 			break;
 		case NTAP_OPT_EXPECTED_ID:
+		{
+			u32 *new_expected_ids;
+
 			e = Jim_GetOpt_Wide( goi, &w );
-			pTap->expected_id = w;
+			if( e != JIM_OK) {
+				Jim_SetResult_sprintf(goi->interp, "option: %s bad parameter", n->name);
+				return e;
+			}
+
+			new_expected_ids = malloc(sizeof(u32) * (pTap->expected_ids_cnt + 1));
+			if (new_expected_ids == NULL) {
+				Jim_SetResult_sprintf( goi->interp, "no memory");
+				return JIM_ERR;
+			}
+
+			memcpy(new_expected_ids, pTap->expected_ids, sizeof(u32) * pTap->expected_ids_cnt);
+
+			new_expected_ids[pTap->expected_ids_cnt] = w;
+
+			free(pTap->expected_ids);
+			pTap->expected_ids = new_expected_ids;
+			pTap->expected_ids_cnt++;
 			break;
+		}
 		case NTAP_OPT_IRLEN:
 		case NTAP_OPT_IRMASK:
 		case NTAP_OPT_IRCAPTURE:
@@ -1809,6 +1846,7 @@
 							   pTap->dotted_name);
 		// fixme: Tell user what is missing :-(
 		// no memory leaks pelase
+		free(((void *)(pTap->expected_ids)));
 		free(((void *)(pTap->chip)));
 		free(((void *)(pTap->tapname)));
 		free(((void *)(pTap->dotted_name)));
@@ -2058,11 +2096,11 @@
 	if ((retval=jtag_interface_init(cmd_ctx)) != ERROR_OK)
 		return retval;
 
-	LOG_DEBUG("Trying to bring the JTAG controller to life by asserting TRST / TLR");
+	LOG_DEBUG("Trying to bring the JTAG controller to life by asserting TRST / RESET");
 
 	/* Reset can happen after a power cycle.
 	 *
-	 * Ideally we would only assert TRST or run TLR before the target reset.
+	 * Ideally we would only assert TRST or run RESET before the target reset.
 	 *
 	 * However w/srst_pulls_trst, trst is asserted together with the target
 	 * reset whether we want it or not.
@@ -2075,7 +2113,7 @@
 	 * NB! order matters!!!! srst *can* disconnect JTAG circuitry
 	 *
 	 */
-	jtag_add_reset(1, 0); /* TLR or TRST */
+	jtag_add_reset(1, 0); /* RESET or TRST */
 	if (jtag_reset_config & RESET_HAS_SRST)
 	{
 		jtag_add_reset(1, 1);
@@ -2270,21 +2308,28 @@
 	command_print(cmd_ctx, "---|--------------------|---------|------------|------------|------|------|------|---------");
 
 	while( tap ){
-		u32 expected, expected_mask, cur_instr;
+		u32 expected, expected_mask, cur_instr, ii;
 		expected = buf_get_u32(tap->expected, 0, tap->ir_length);
 		expected_mask = buf_get_u32(tap->expected_mask, 0, tap->ir_length);
 		cur_instr = buf_get_u32(tap->cur_instr, 0, tap->ir_length);
+
 		command_print(cmd_ctx,
 					  "%2d | %-18s |    %c    | 0x%08x | 0x%08x | 0x%02x | 0x%02x | 0x%02x | 0x%02x",
 					  tap->abs_chain_position,
 					  tap->dotted_name,
 					  tap->enabled ? 'Y' : 'n',
 					  tap->idcode,
-					  tap->expected_id,
+					  (tap->expected_ids_cnt > 0 ? tap->expected_ids[0] : 0),
 					  tap->ir_length,
 					  expected,
 					  expected_mask,
 					  cur_instr);
+
+		for (ii = 1; ii < tap->expected_ids_cnt; ii++) {
+			command_print(cmd_ctx, "   |                    |         |            | 0x%08x |      |      |      |         ",
+						  tap->expected_ids[ii]);
+		}
+
 		tap = tap->next_tap;
 	}
 

Modified: branches/openocd_1_0_branch/src/jtag/jtag.h
===================================================================
--- branches/openocd_1_0_branch/src/jtag/jtag.h	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/jtag.h	2008-12-13 07:02:56 UTC (rev 1236)
@@ -33,20 +33,15 @@
 #define _DEBUG_JTAG_IO_
 #endif
 
-/* Tap States
- * TLR - Test-Logic-Reset, RTI - Run-Test/Idle,
- * SDS - Select-DR-Scan, CD - Capture-DR, SD - Shift-DR, E1D - Exit1-DR,
- * PD - Pause-DR, E2D - Exit2-DR, UD - Update-DR,
- * SIS - Select-IR-Scan, CI - Capture-IR, SI - Shift-IR, E1I - Exit1-IR,
- * PI - Pause-IR, E2I - Exit2-IR, UI - Update-IR
+/* 16 Tap States, from page 21 of ASSET InterTech, Inc.'s svf.pdf
  */
 enum tap_state
 {
-	TAP_TLR = 0x0, TAP_RTI = 0x8,
-	TAP_SDS = 0x1, TAP_CD = 0x2, TAP_SD = 0x3, TAP_E1D = 0x4,
-	TAP_PD = 0x5, TAP_E2D = 0x6, TAP_UD = 0x7,
-	TAP_SIS = 0x9, TAP_CI = 0xa, TAP_SI = 0xb, TAP_E1I = 0xc,
-	TAP_PI = 0xd, TAP_E2I = 0xe, TAP_UI = 0xf
+	TAP_RESET = 0x0, TAP_IDLE = 0x8,
+	TAP_DRSELECT = 0x1, TAP_DRCAPTURE = 0x2, TAP_DRSHIFT = 0x3, TAP_DREXIT1 = 0x4,
+	TAP_DRPAUSE = 0x5, TAP_DREXIT2 = 0x6, TAP_DRUPDATE = 0x7,
+	TAP_IRSELECT = 0x9, TAP_IRCAPTURE = 0xa, TAP_IRSHIFT = 0xb, TAP_IREXIT1 = 0xc,
+	TAP_IRPAUSE = 0xd, TAP_IREXIT2 = 0xe, TAP_IRUPDATE = 0xf
 };
 
 typedef struct tap_transition_s
@@ -179,7 +174,8 @@
 	u32 ir_capture_mask;
 	u8 *expected_mask;	/* Capture-IR expected mask */
 	u32 idcode;			/* device identification code */
-	u32 expected_id;
+	u32 *expected_ids;	/* Array of expected identification codes */
+	u8 expected_ids_cnt;/* Number of expected identification codes */
 	u8 *cur_instr;		/* current instruction */
 	int bypass;			/* bypass register selected */
 	jtag_tap_t *next_tap;
@@ -314,7 +310,7 @@
  * upon subsequent invocations
  */
 extern int jtag_interface_init(struct command_context_s *cmd_ctx);
-/* initialize JTAG chain using only a TLR reset. If init fails,
+/* initialize JTAG chain using only a RESET reset. If init fails,
  * try reset + init.
  */
 extern int jtag_init(struct command_context_s *cmd_ctx);
@@ -324,7 +320,7 @@
 
 /* JTAG interface, can be implemented with a software or hardware fifo
  *
- * TAP_SD and TAP_SI are illegal end states. TAP_SD/SI as end states
+ * TAP_DRSHIFT and TAP_IRSHIFT are illegal end states. TAP_DRSHIFT/IRSHIFT as end states
  * can be emulated by using a larger scan.
  *
  * Code that is relatively insensitive to the path(as long
@@ -342,7 +338,7 @@
 extern int interface_jtag_add_plain_ir_scan(int num_fields, scan_field_t *fields, enum tap_state endstate);
 extern void jtag_add_plain_dr_scan(int num_fields, scan_field_t *fields, enum tap_state endstate);
 extern int interface_jtag_add_plain_dr_scan(int num_fields, scan_field_t *fields, enum tap_state endstate);
-/* run a TAP_TLR reset. End state is TAP_TLR, regardless
+/* run a TAP_RESET reset. End state is TAP_RESET, regardless
  * of start state.
  */
 extern void jtag_add_tlr(void);
@@ -363,7 +359,7 @@
  * all drivers can support this, but it is required for e.g.
  * XScale and Xilinx support
  *
- * Note! TAP_TLR must not be used in the path!
+ * Note! TAP_RESET must not be used in the path!
  *
  * Note that the first on the list must be reachable
  * via a single transition from the current state.
@@ -379,12 +375,12 @@
  */
 extern void jtag_add_pathmove(int num_states, enum tap_state *path);
 extern int interface_jtag_add_pathmove(int num_states, enum tap_state *path);
-/* go to TAP_RTI, if we're not already there and cycle
- * precisely num_cycles in the TAP_RTI after which move
- * to the end state, if it is != TAP_RTI
+/* go to TAP_IDLE, if we're not already there and cycle
+ * precisely num_cycles in the TAP_IDLE after which move
+ * to the end state, if it is != TAP_IDLE
  *
  * nb! num_cycles can be 0, in which case the fn will navigate
- * to endstate via TAP_RTI
+ * to endstate via TAP_IDLE
  */
 extern void jtag_add_runtest(int num_cycles, enum tap_state endstate);
 extern int interface_jtag_add_runtest(int num_cycles, enum tap_state endstate);
@@ -487,7 +483,7 @@
 #define MINIDRIVER(a) a
 /* jtag_add_dr_out() is a faster version of jtag_add_dr_scan()
  *
- * Current or end_state can not be TAP_TLR. end_state can be -1
+ * Current or end_state can not be TAP_RESET. end_state can be -1
  *
  * num_bits[i] is the number of bits to clock out from value[i] LSB first.
  *

Modified: branches/openocd_1_0_branch/src/jtag/usbprog.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/usbprog.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/usbprog.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -151,7 +151,7 @@
 #endif
 				if (cmd->cmd.reset->trst == 1)
 				{
-					cur_state = TAP_TLR;
+					cur_state = TAP_RESET;
 				}
 				usbprog_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 				break;
@@ -298,10 +298,10 @@
 {
 	int i;
 
-	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_RTI)
+	/* only do a state_move when we're not already in IDLE */
+	if (cur_state != TAP_IDLE)
 	{
-		usbprog_end_state(TAP_RTI);
+		usbprog_end_state(TAP_IDLE);
 		usbprog_state_move();
 	}
 
@@ -336,9 +336,9 @@
 	enum tap_state saved_end_state = end_state;
 
 	if (ir_scan)
-		usbprog_end_state(TAP_SI);
+		usbprog_end_state(TAP_IRSHIFT);
 	else
-		usbprog_end_state(TAP_SD);
+		usbprog_end_state(TAP_DRSHIFT);
 
 	/* usbprog_jtag_tms_send(usbprog_jtag_handle); */
 
@@ -361,9 +361,9 @@
 	}
 
 	if (ir_scan)
-		cur_state = TAP_PI;
+		cur_state = TAP_IRPAUSE;
 	else
-		cur_state = TAP_PD;
+		cur_state = TAP_DRPAUSE;
 
 	if (cur_state != end_state)
 		usbprog_state_move();

Modified: branches/openocd_1_0_branch/src/jtag/zy1000.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/zy1000.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/jtag/zy1000.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -158,7 +158,7 @@
 	else
 	{
 		/* Danger!!! if clk!=0 when in
-		 * idle in TAP_RTI, reset halt on str912 will fail.
+		 * idle in TAP_IDLE, reset halt on str912 will fail.
 		 */
 		ZY1000_POKE(0x08000010, 0x00000001);
 	}
@@ -176,8 +176,8 @@
 	if (trst||(srst&&(jtag_reset_config & RESET_SRST_PULLS_TRST)))
 	{
 		waitIdle();
-		/* we're now in the TLR state until trst is deasserted */
-		ZY1000_POKE(0x08000020, TAP_TLR);
+		/* we're now in the RESET state until trst is deasserted */
+		ZY1000_POKE(ZY1000_JTAG_BASE+0x20, TAP_RESET);
 	} else
 	{
 		/* We'll get RCLK failure when we assert TRST, so clear any false positives here */
@@ -303,7 +303,7 @@
     if (fread(*data, 1, *len, pFile)!=*len)
     {
 		fclose(pFile);
-    	free(*data);
+	free(*data);
 		LOG_ERROR("Can't open %s\n", fileName);
 		return ERROR_JTAG_DEVICE_ERROR;
     }
@@ -429,7 +429,7 @@
 			enum tap_state pause_state;
 			int l;
 			k=num_bits-j;
-			pause_state=(shiftState==TAP_SD)?TAP_SD:TAP_SI;
+			pause_state=(shiftState==TAP_DRSHIFT)?TAP_DRSHIFT:TAP_IRSHIFT;
 			if (k>32)
 			{
 				k=32;
@@ -437,7 +437,7 @@
 			} else if (pause&&(i == num_fields-1))
 			{
 				/* this was the last to shift out this time */
-				pause_state=(shiftState==TAP_SD)?TAP_PD:TAP_PI;
+				pause_state=(shiftState==TAP_DRSHIFT)?TAP_DRPAUSE:TAP_IRPAUSE;
 			}
 
 			// we have (num_bits+7)/8 bytes of bits to toggle out.
@@ -520,7 +520,7 @@
 					fields[j].in_check_mask = tap->expected_mask;
 				}
 
-				scanFields(1, fields+j, TAP_SI, pause);
+				scanFields(1, fields+j, TAP_IRSHIFT, pause);
 				/* update device information */
 				buf_cpy(fields[j].out_value, tap->cur_instr, scan_size);
 
@@ -538,7 +538,7 @@
 			memset(&tmp, 0, sizeof(tmp));
 			tmp.out_value = ones;
 			tmp.num_bits = scan_size;
-			scanFields(1, &tmp, TAP_SI, pause);
+			scanFields(1, &tmp, TAP_IRSHIFT, pause);
 			/* update device information */
 			buf_cpy(tmp.out_value, tap->cur_instr, scan_size);
 			tap->bypass = 1;
@@ -555,7 +555,7 @@
 
 int interface_jtag_add_plain_ir_scan(int num_fields, scan_field_t *fields, enum tap_state state)
 {
-	scanFields(num_fields, fields, TAP_SI, 1);
+	scanFields(num_fields, fields, TAP_IRSHIFT, 1);
 	gotoEndState();
 
 	return ERROR_OK;
@@ -580,7 +580,7 @@
 			{
 				found = 1;
 
-				scanFields(1, fields+j, TAP_SD, pause);
+				scanFields(1, fields+j, TAP_DRSHIFT, pause);
 			}
 		}
 		if (!found)
@@ -596,7 +596,7 @@
 			tmp.in_handler = NULL;
 			tmp.in_handler_priv = NULL;
 
-			scanFields(1, &tmp, TAP_SD, pause);
+			scanFields(1, &tmp, TAP_DRSHIFT, pause);
 		}
 		else
 		{
@@ -608,7 +608,7 @@
 
 int interface_jtag_add_plain_dr_scan(int num_fields, scan_field_t *fields, enum tap_state state)
 {
-	scanFields(num_fields, fields, TAP_SD, 1);
+	scanFields(num_fields, fields, TAP_DRSHIFT, 1);
 	gotoEndState();
 	return ERROR_OK;
 }
@@ -616,7 +616,7 @@
 
 int interface_jtag_add_tlr()
 {
-	setCurrentState(TAP_TLR);
+	setCurrentState(TAP_RESET);
 	return ERROR_OK;
 }
 
@@ -635,7 +635,7 @@
 int interface_jtag_add_runtest(int num_cycles, enum tap_state state)
 {
 	/* num_cycles can be 0 */
-	setCurrentState(TAP_RTI);
+	setCurrentState(TAP_IDLE);
 
 	/* execute num_cycles, 32 at the time. */
 	int i;
@@ -647,14 +647,14 @@
 		{
 			num=num_cycles-i;
 		}
-		shiftValueInner(TAP_RTI, TAP_RTI, num, 0);
+		shiftValueInner(TAP_IDLE, TAP_IDLE, num, 0);
 	}
 
 #if !TEST_MANUAL()
 	/* finish in end_state */
 	setCurrentState(state);
 #else
-	enum tap_state t=TAP_RTI;
+	enum tap_state t=TAP_IDLE;
 	/* test manual drive code on any target */
 	int tms;
 	u8 tms_scan = TAP_MOVE(t, state);
@@ -734,8 +734,8 @@
 			int i;
 			for (i = 0; i < count; i++)
 			{
-				shiftValueInner(TAP_SD, TAP_SD, 32, fast_target_buffer_get_u32(buffer, 1));
-				shiftValueInner(TAP_SD, end_state, 6, reg_addr|(1<<5));
+				shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, 32, fast_target_buffer_get_u32(buffer, 1));
+				shiftValueInner(TAP_DRSHIFT, end_state, 6, reg_addr|(1<<5));
 				buffer+=4;
 			}
 		} else
@@ -743,8 +743,8 @@
 			int i;
 			for (i = 0; i < count; i++)
 			{
-				shiftValueInner(TAP_SD, TAP_SD, 32, fast_target_buffer_get_u32(buffer, 0));
-				shiftValueInner(TAP_SD, end_state, 6, reg_addr|(1<<5));
+				shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, 32, fast_target_buffer_get_u32(buffer, 0));
+				shiftValueInner(TAP_DRSHIFT, end_state, 6, reg_addr|(1<<5));
 				buffer+=4;
 			}
 		}

Modified: branches/openocd_1_0_branch/src/pld/virtex2.c
===================================================================
--- branches/openocd_1_0_branch/src/pld/virtex2.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/pld/virtex2.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -63,7 +63,7 @@
 		field.in_handler = NULL;
 		field.in_handler_priv = NULL;
 
-		jtag_add_ir_scan(1, &field, TAP_RTI);
+		jtag_add_ir_scan(1, &field, TAP_IDLE);
 
 		free(field.out_value);
 	}
@@ -95,7 +95,7 @@
 
 	virtex2_set_instr(virtex2_info->tap, 0x5); /* CFG_IN */
 
-	jtag_add_dr_scan(1, &scan_field, TAP_PD);
+	jtag_add_dr_scan(1, &scan_field, TAP_DRPAUSE);
 
 	free(values);
 
@@ -128,7 +128,7 @@
 	while (num_words--)
 	{
 		scan_field.in_handler_priv = words++;
-		jtag_add_dr_scan(1, &scan_field, TAP_PD);
+		jtag_add_dr_scan(1, &scan_field, TAP_DRPAUSE);
 	}
 
 	return ERROR_OK;
@@ -176,7 +176,7 @@
 	if ((retval = xilinx_read_bit_file(&bit_file, filename)) != ERROR_OK)
 		return retval;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	virtex2_set_instr(virtex2_info->tap, 0xb); /* JPROG_B */
 	jtag_execute_queue();
 	jtag_add_sleep(1000);
@@ -190,18 +190,18 @@
 	field.num_bits = bit_file.length * 8;
 	field.out_value = bit_file.data;
 
-	jtag_add_dr_scan(1, &field, TAP_PD);
+	jtag_add_dr_scan(1, &field, TAP_DRPAUSE);
 	jtag_execute_queue();
 
 	jtag_add_tlr();
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	virtex2_set_instr(virtex2_info->tap, 0xc); /* JSTART */
-	jtag_add_runtest(13, TAP_RTI);
+	jtag_add_runtest(13, TAP_IDLE);
 	virtex2_set_instr(virtex2_info->tap, 0x3f); /* BYPASS */
 	virtex2_set_instr(virtex2_info->tap, 0x3f); /* BYPASS */
 	virtex2_set_instr(virtex2_info->tap, 0xc); /* JSTART */
-	jtag_add_runtest(13, TAP_RTI);
+	jtag_add_runtest(13, TAP_IDLE);
 	virtex2_set_instr(virtex2_info->tap, 0x3f); /* BYPASS */
 	jtag_execute_queue();
 

Modified: branches/openocd_1_0_branch/src/target/arm11.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm11.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/arm11.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -393,7 +393,7 @@
 	arm11_setup_field(arm11,  1, NULL, NULL,	chain5_fields + 1);
 	arm11_setup_field(arm11,  1, NULL, NULL,	chain5_fields + 2);
 
-	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_PD);
+	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 	}
 	else
 	{
@@ -627,7 +627,7 @@
 	arm11_setup_field(arm11,  1, &Ready,	NULL, chain5_fields + 1);
 	arm11_setup_field(arm11,  1, &Valid,	NULL, chain5_fields + 2);
 
-	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_PD);
+	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 	}
 
 	arm11_record_register_history(arm11);
@@ -735,7 +735,7 @@
 	return ERROR_OK;
 	}
 
-	arm11_add_IR(arm11, ARM11_HALT, TAP_RTI);
+	arm11_add_IR(arm11, ARM11_HALT, TAP_IDLE);
 
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -841,7 +841,7 @@
 
 	arm11_leave_debug_state(arm11);
 
-	arm11_add_IR(arm11, ARM11_RESTART, TAP_RTI);
+	arm11_add_IR(arm11, ARM11_RESTART, TAP_IDLE);
 
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -956,7 +956,7 @@
 
 	arm11_leave_debug_state(arm11);
 
-	arm11_add_IR(arm11, ARM11_RESTART, TAP_RTI);
+	arm11_add_IR(arm11, ARM11_RESTART, TAP_IDLE);
 
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -1571,7 +1571,7 @@
 
 	arm11_setup_field(arm11, 32, NULL, &arm11->device_id, &idcode_field);
 
-	arm11_add_dr_scan_vc(1, &idcode_field, TAP_PD);
+	arm11_add_dr_scan_vc(1, &idcode_field, TAP_DRPAUSE);
 
 	/* check DIDR */
 
@@ -1584,7 +1584,7 @@
 	arm11_setup_field(arm11, 32, NULL,	&arm11->didr,		chain0_fields + 0);
 	arm11_setup_field(arm11,  8, NULL,	&arm11->implementor,	chain0_fields + 1);
 
-	arm11_add_dr_scan_vc(asizeof(chain0_fields), chain0_fields, TAP_RTI);
+	arm11_add_dr_scan_vc(asizeof(chain0_fields), chain0_fields, TAP_IDLE);
 
 	if ((retval=jtag_execute_queue())!=ERROR_OK)
 		return retval;
@@ -1832,7 +1832,7 @@
 {
 	jtag_tap_t *tap;
 	target_t * t;
-	
+
 	tap = jtag_TapByString( arg );
 	if( !tap ){
 		return NULL;

Modified: branches/openocd_1_0_branch/src/target/arm11_dbgtap.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm11_dbgtap.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/arm11_dbgtap.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -38,13 +38,13 @@
 
 enum tap_state arm11_move_pi_to_si_via_ci[] =
 {
-    TAP_E2I, TAP_UI, TAP_SDS, TAP_SIS, TAP_CI, TAP_SI
+    TAP_IREXIT2, TAP_IRUPDATE, TAP_DRSELECT, TAP_IRSELECT, TAP_IRCAPTURE, TAP_IRSHIFT
 };
 
 
 int arm11_add_ir_scan_vc(int num_fields, scan_field_t *fields, enum tap_state state)
 {
-    if (cmd_queue_cur_state == TAP_PI)
+    if (cmd_queue_cur_state == TAP_IRPAUSE)
 	jtag_add_pathmove(asizeof(arm11_move_pi_to_si_via_ci), arm11_move_pi_to_si_via_ci);
 
     jtag_add_ir_scan(num_fields, fields, state);
@@ -53,12 +53,12 @@
 
 enum tap_state arm11_move_pd_to_sd_via_cd[] =
 {
-    TAP_E2D, TAP_UD, TAP_SDS, TAP_CD, TAP_SD
+    TAP_DREXIT2, TAP_DRUPDATE, TAP_DRSELECT, TAP_DRCAPTURE, TAP_DRSHIFT
 };
 
 int arm11_add_dr_scan_vc(int num_fields, scan_field_t *fields, enum tap_state state)
 {
-    if (cmd_queue_cur_state == TAP_PD)
+    if (cmd_queue_cur_state == TAP_DRPAUSE)
 	jtag_add_pathmove(asizeof(arm11_move_pd_to_sd_via_cd), arm11_move_pd_to_sd_via_cd);
 
     jtag_add_dr_scan(num_fields, fields, state);
@@ -104,7 +104,7 @@
 	jtag_tap_t *tap;
 	tap = arm11->jtag_info.tap;
 	if(  tap == NULL ){
-    	/* FIX!!!! error is logged, but not propagated back up the call stack... */
+	/* FIX!!!! error is logged, but not propagated back up the call stack... */
 		LOG_ERROR( "tap is null here! This is bad!");
 		return;
     }
@@ -120,7 +120,7 @@
 
     arm11_setup_field(arm11, 5, &instr, NULL, &field);
 
-    arm11_add_ir_scan_vc(1, &field, state == -1 ? TAP_PI : state);
+    arm11_add_ir_scan_vc(1, &field, state == -1 ? TAP_IRPAUSE : state);
 }
 
 /** Verify shifted out data from Scan Chain Register (SCREG)
@@ -135,8 +135,8 @@
 
     if (v != 0x10)
     {
-        LOG_ERROR("'arm11 target' JTAG communication error SCREG SCAN OUT 0x%02x (expected 0x10)", v);
-        return ERROR_FAIL;
+	LOG_ERROR("'arm11 target' JTAG communication error SCREG SCAN OUT 0x%02x (expected 0x10)", v);
+	return ERROR_FAIL;
     }
 
     JTAG_DEBUG("SCREG SCAN OUT 0x%02x", v);
@@ -179,7 +179,7 @@
 
     field.in_handler = arm11_in_handler_SCAN_N;
 
-    arm11_add_dr_scan_vc(1, &field, state == -1 ? TAP_PD : state);
+    arm11_add_dr_scan_vc(1, &field, state == -1 ? TAP_DRPAUSE : state);
 }
 
 /** Write an instruction into the ITR register
@@ -194,7 +194,7 @@
  * \remarks By default this ends with Run-Test/Idle state
  * and causes the instruction to be executed. If
  * a subsequent write to DTR is needed before
- * executing the instruction then TAP_PD should be
+ * executing the instruction then TAP_DRPAUSE should be
  * passed to \p state.
  *
  * \remarks This adds to the JTAG command queue but does \em not execute it.
@@ -208,7 +208,7 @@
     arm11_setup_field(arm11, 32,    &inst,	NULL, itr + 0);
     arm11_setup_field(arm11, 1,	    NULL,	flag, itr + 1);
 
-    arm11_add_dr_scan_vc(asizeof(itr), itr, state == -1 ? TAP_RTI : state);
+    arm11_add_dr_scan_vc(asizeof(itr), itr, state == -1 ? TAP_IDLE : state);
 }
 
 /** Read the Debug Status and Control Register (DSCR)
@@ -231,12 +231,12 @@
 
     arm11_setup_field(arm11, 32, NULL, &dscr, &chain1_field);
 
-    arm11_add_dr_scan_vc(1, &chain1_field, TAP_PD);
+    arm11_add_dr_scan_vc(1, &chain1_field, TAP_DRPAUSE);
 
     jtag_execute_queue();
 
     if (arm11->last_dscr != dscr)
-        JTAG_DEBUG("DSCR  = %08x (OLD %08x)", dscr, arm11->last_dscr);
+	JTAG_DEBUG("DSCR  = %08x (OLD %08x)", dscr, arm11->last_dscr);
 
     arm11->last_dscr = dscr;
 
@@ -262,7 +262,7 @@
 
     arm11_setup_field(arm11, 32, &dscr, NULL, &chain1_field);
 
-    arm11_add_dr_scan_vc(1, &chain1_field, TAP_PD);
+    arm11_add_dr_scan_vc(1, &chain1_field, TAP_DRPAUSE);
 
     jtag_execute_queue();
 
@@ -340,10 +340,10 @@
  * Put arm11_run_instr_data_prepare() and arm11_run_instr_data_finish()
  * around a block of arm11_run_instr_... calls.
  *
- * Any RTI can lead to an instruction execution when
+ * Any IDLE can lead to an instruction execution when
  * scan chains 4 or 5 are selected and the IR holds
  * INTEST or EXTEST. So we must disable that before
- * any following activities lead to an RTI.
+ * any following activities lead to an IDLE.
  *
  * \param arm11 Target state variable.
  *
@@ -369,13 +369,13 @@
 
     while (count--)
     {
-	arm11_add_debug_INST(arm11, *opcode++, NULL, TAP_RTI);
+	arm11_add_debug_INST(arm11, *opcode++, NULL, TAP_IDLE);
 
 	while (1)
 	{
 	    u8 flag;
 
-	    arm11_add_debug_INST(arm11, 0, &flag, count ? TAP_RTI : TAP_PD);
+	    arm11_add_debug_INST(arm11, 0, &flag, count ? TAP_IDLE : TAP_DRPAUSE);
 
 	    jtag_execute_queue();
 
@@ -416,7 +416,7 @@
 {
     arm11_add_IR(arm11, ARM11_ITRSEL, -1);
 
-    arm11_add_debug_INST(arm11, opcode, NULL, TAP_PD);
+    arm11_add_debug_INST(arm11, opcode, NULL, TAP_DRPAUSE);
 
     arm11_add_IR(arm11, ARM11_EXTEST, -1);
 
@@ -436,7 +436,7 @@
 	{
 	    Data	    = *data;
 
-	    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_RTI);
+	    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_IDLE);
 	    jtag_execute_queue();
 
 	    JTAG_DEBUG("DTR  Ready %d  nRetry %d", Ready, nRetry);
@@ -452,7 +452,7 @@
     {
 	Data	    = 0;
 
-	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_PD);
+	arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 	jtag_execute_queue();
 
 	JTAG_DEBUG("DTR  Data %08x  Ready %d  nRetry %d", Data, Ready, nRetry);
@@ -462,18 +462,18 @@
 
 /** JTAG path for arm11_run_instr_data_to_core_noack
  *
- *  The repeated TAP_RTI's do not cause a repeated execution
+ *  The repeated TAP_IDLE's do not cause a repeated execution
  *  if passed without leaving the state.
  *
  *  Since this is more than 7 bits (adjustable via adding more
- *  TAP_RTI's) it produces an artificial delay in the lower
+ *  TAP_IDLE's) it produces an artificial delay in the lower
  *  layer (FT2232) that is long enough to finish execution on
  *  the core but still shorter than any manually inducible delays.
  *
  */
-enum tap_state arm11_MOVE_PD_RTI_PD_with_delay[] =
+enum tap_state arm11_MOVE_DRPAUSE_IDLE_DRPAUSE_with_delay[] =
 {
-    TAP_E2D, TAP_UD, TAP_RTI, TAP_RTI, TAP_RTI, TAP_SDS, TAP_CD, TAP_SD
+    TAP_DREXIT2, TAP_DRUPDATE, TAP_IDLE, TAP_IDLE, TAP_IDLE, TAP_DRSELECT, TAP_DRCAPTURE, TAP_DRSHIFT
 };
 
 
@@ -497,7 +497,7 @@
 {
     arm11_add_IR(arm11, ARM11_ITRSEL, -1);
 
-    arm11_add_debug_INST(arm11, opcode, NULL, TAP_PD);
+    arm11_add_debug_INST(arm11, opcode, NULL, TAP_DRPAUSE);
 
     arm11_add_IR(arm11, ARM11_EXTEST, -1);
 
@@ -517,13 +517,13 @@
 
 	if (count)
 	{
-	    jtag_add_dr_scan(asizeof(chain5_fields), chain5_fields, TAP_PD);
-	    jtag_add_pathmove(asizeof(arm11_MOVE_PD_RTI_PD_with_delay),
-		arm11_MOVE_PD_RTI_PD_with_delay);
+	    jtag_add_dr_scan(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
+	    jtag_add_pathmove(asizeof(arm11_MOVE_DRPAUSE_IDLE_DRPAUSE_with_delay),
+		arm11_MOVE_DRPAUSE_IDLE_DRPAUSE_with_delay);
 	}
 	else
 	{
-	    jtag_add_dr_scan(asizeof(chain5_fields), chain5_fields, TAP_RTI);
+	    jtag_add_dr_scan(asizeof(chain5_fields), chain5_fields, TAP_IDLE);
 	}
     }
 
@@ -532,7 +532,7 @@
     chain5_fields[0].out_value	= 0;
     chain5_fields[1].in_value   = ReadyPos++;
 
-    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_PD);
+    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 
     jtag_execute_queue();
 
@@ -586,7 +586,7 @@
 {
     arm11_add_IR(arm11, ARM11_ITRSEL, -1);
 
-    arm11_add_debug_INST(arm11, opcode, NULL, TAP_RTI);
+    arm11_add_debug_INST(arm11, opcode, NULL, TAP_IDLE);
 
     arm11_add_IR(arm11, ARM11_INTEST, -1);
 
@@ -604,7 +604,7 @@
     {
 	do
 	{
-	    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, count ? TAP_RTI : TAP_PD);
+	    arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, count ? TAP_IDLE : TAP_DRPAUSE);
 	    jtag_execute_queue();
 
 	    JTAG_DEBUG("DTR  Data %08x  Ready %d  nRetry %d", Data, Ready, nRetry);
@@ -699,11 +699,11 @@
 	    AddressOut	= 0;
 	}
 
-        do
+	do
 	{
 	    JTAG_DEBUG("SC7 <= Address %02x  Data %08x    nRW %d", AddressOut, DataOut, nRW);
 
-	    arm11_add_dr_scan_vc(asizeof(chain7_fields), chain7_fields, TAP_PD);
+	    arm11_add_dr_scan_vc(asizeof(chain7_fields), chain7_fields, TAP_DRPAUSE);
 	    jtag_execute_queue();
 
 	    JTAG_DEBUG("SC7 => Address %02x  Data %08x  Ready %d", AddressIn, DataIn, Ready);

Modified: branches/openocd_1_0_branch/src/target/arm720t.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm720t.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/arm720t.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -64,7 +64,7 @@
 	.assert_reset = arm7_9_assert_reset,
 	.deassert_reset = arm7_9_deassert_reset,
 	.soft_reset_halt = arm720t_soft_reset_halt,
-	
+
 	.get_gdb_reg_list = armv4_5_get_gdb_reg_list,
 
 	.read_memory = arm720t_read_memory,
@@ -72,7 +72,7 @@
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
 
 	.add_breakpoint = arm7_9_add_breakpoint,
@@ -96,10 +96,10 @@
 	scan_field_t fields[2];
 	u8 out_buf[4];
 	u8 instruction_buf = instruction;
-	
+
 	buf_set_u32(out_buf, 0, 32, flip_u32(out, 32));
-	
-	jtag_add_end_state(TAP_PD);
+
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -108,7 +108,7 @@
 	{
 		return retval;
 	}
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &instruction_buf;
@@ -135,7 +135,7 @@
 	}
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
-	
+
 	jtag_add_dr_scan(2, fields, -1);
 
 	if (clock)
@@ -171,7 +171,7 @@
 	arm720t_scan_cp15(target, 0x0, NULL, 0, 1);
 	/* "EXECUTE" stage (3), CDATA is read */
 	arm720t_scan_cp15(target, ARMV4_5_NOP, value, 1, 1);
-	
+
 	return ERROR_OK;
 }
 
@@ -197,9 +197,9 @@
 
 	arm720t_read_cp15(target, 0xee120f10, &ttb);
 	jtag_execute_queue();
-	
+
 	ttb &= 0xffffc000;
-	
+
 	return ttb;
 }
 
@@ -210,10 +210,10 @@
 	/* read cp15 control register */
 	arm720t_read_cp15(target, 0xee110f10, &cp15_control);
 	jtag_execute_queue();
-		
+
 	if (mmu)
 		cp15_control &= ~0x1U;
-	
+
 	if (d_u_cache || i_cache)
 		cp15_control &= ~0x4U;
 
@@ -227,13 +227,13 @@
 	/* read cp15 control register */
 	arm720t_read_cp15(target, 0xee110f10, &cp15_control);
 	jtag_execute_queue();
-		
+
 	if (mmu)
 		cp15_control |= 0x1U;
-	
+
 	if (d_u_cache || i_cache)
 		cp15_control |= 0x4U;
-	
+
 	arm720t_write_cp15(target, 0xee010f10, cp15_control);
 }
 
@@ -243,7 +243,7 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
-	
+
 	/* examine cp15 control reg */
 	arm720t_read_cp15(target, 0xee110f10, &arm720t->cp15_control_reg);
 	jtag_execute_queue();
@@ -265,7 +265,7 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
-	
+
 	/* restore i/d fault status and address register */
 	arm720t_write_cp15(target, 0xee050f10, arm720t->fsr_reg);
 	arm720t_write_cp15(target, 0xee060f10, arm720t->far_reg);
@@ -277,35 +277,35 @@
 	arm7_9_common_t *arm7_9;
 	arm7tdmi_common_t *arm7tdmi;
 	arm720t_common_t *arm720t;
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7_9 = armv4_5->arch_info;
 	if (arm7_9->common_magic != ARM7_9_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7tdmi = arm7_9->arch_info;
 	if (arm7tdmi->common_magic != ARM7TDMI_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm720t = arm7tdmi->arch_info;
 	if (arm720t->common_magic != ARM720T_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	*armv4_5_p = armv4_5;
 	*arm7_9_p = arm7_9;
 	*arm7tdmi_p = arm7tdmi;
 	*arm720t_p = arm720t;
-	
+
 	return ERROR_OK;
 }
 
@@ -315,18 +315,18 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
-	
-	char *state[] = 
+
+	char *state[] =
 	{
 		"disabled", "enabled"
 	};
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		LOG_ERROR("BUG: called for a non-ARMv4/5 target");
 		exit(-1);
 	}
-	
+
 	LOG_USER("target halted in %s state due to %s, current mode: %s\n"
 			"cpsr: 0x%8.8x pc: 0x%8.8x\n"
 			"MMU: %s, Cache: %s",
@@ -337,7 +337,7 @@
 			 buf_get_u32(armv4_5->core_cache->reg_list[15].value, 0, 32),
 			 state[arm720t->armv4_5_mmu.mmu_enabled],
 			 state[arm720t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled]);
-	
+
 	return ERROR_OK;
 }
 
@@ -348,23 +348,23 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
-	
+
 	/* disable cache, but leave MMU enabled */
 	if (arm720t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled)
 		arm720t_disable_mmu_caches(target, 0, 1, 0);
-	
+
 	retval = arm7_9_read_memory(target, address, size, count, buffer);
-	
+
 	if (arm720t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled)
 		arm720t_enable_mmu_caches(target, 0, 1, 0);
-	
+
 	return retval;
 }
 
 int arm720t_write_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
 {
 	int retval;
-	
+
 	if ((retval = arm7_9_write_memory(target, address, size, count, buffer)) != ERROR_OK)
 		return retval;
 
@@ -379,12 +379,12 @@
 	arm7tdmi_common_t *arm7tdmi = arm7_9->arch_info;
 	arm720t_common_t *arm720t = arm7tdmi->arch_info;
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
-	
+
 	if ((retval = target_halt(target)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	long long then=timeval_ms();
 	int timeout;
 	while (!(timeout=((timeval_ms()-then)>1000)))
@@ -413,22 +413,22 @@
 		LOG_ERROR("Failed to halt CPU after 1 sec");
 		return ERROR_TARGET_TIMEOUT;
 	}
-	
+
 	target->state = TARGET_HALTED;
-	
+
 	/* SVC, ARM state, IRQ and FIQ disabled */
 	buf_set_u32(armv4_5->core_cache->reg_list[ARMV4_5_CPSR].value, 0, 8, 0xd3);
 	armv4_5->core_cache->reg_list[ARMV4_5_CPSR].dirty = 1;
 	armv4_5->core_cache->reg_list[ARMV4_5_CPSR].valid = 1;
-	
+
 	/* start fetching from 0x0 */
 	buf_set_u32(armv4_5->core_cache->reg_list[15].value, 0, 32, 0x0);
 	armv4_5->core_cache->reg_list[15].dirty = 1;
 	armv4_5->core_cache->reg_list[15].valid = 1;
-	
+
 	armv4_5->core_mode = ARMV4_5_MODE_SVC;
 	armv4_5->core_state = ARMV4_5_STATE_ARM;
-	
+
 	arm720t_disable_mmu_caches(target, 1, 1, 1);
 	arm720t->armv4_5_mmu.mmu_enabled = 0;
 	arm720t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled = 0;
@@ -438,21 +438,21 @@
 	{
 		return retval;
 	}
-	
+
 	return ERROR_OK;
 }
 
 int arm720t_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
 	arm7tdmi_init_target(cmd_ctx, target);
-		
+
 	return ERROR_OK;
-	
+
 }
 
 int arm720t_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -460,15 +460,15 @@
 {
 	arm7tdmi_common_t *arm7tdmi = &arm720t->arm7tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm7tdmi->arm7_9_common;
-	
+
 	arm7tdmi_init_arch_info(target, arm7tdmi, tap, variant);
 
 	arm7tdmi->arch_info = arm720t;
 	arm720t->common_magic = ARM720T_COMMON_MAGIC;
-	
+
 	arm7_9->post_debug_entry = arm720t_post_debug_entry;
 	arm7_9->pre_restore_context = arm720t_pre_restore_context;
-	
+
 	arm720t->armv4_5_mmu.armv4_5_cache.ctype = -1;
 	arm720t->armv4_5_mmu.get_ttb = arm720t_get_ttb;
 	arm720t->armv4_5_mmu.read_memory = arm7_9_read_memory;
@@ -477,14 +477,14 @@
 	arm720t->armv4_5_mmu.enable_mmu_caches = arm720t_enable_mmu_caches;
 	arm720t->armv4_5_mmu.has_tiny_pages = 0;
 	arm720t->armv4_5_mmu.mmu_enabled = 0;
-	
+
 	return ERROR_OK;
 }
 
 int arm720t_target_create(struct target_s *target, Jim_Interp *interp)
 {
 	arm720t_common_t *arm720t = calloc(1,sizeof(arm720t_common_t));
-	
+
 	arm720t_init_arch_info(target, arm720t, target->tap, target->variant);
 
 	return ERROR_OK;
@@ -494,10 +494,10 @@
 {
 	int retval;
 	command_t *arm720t_cmd;
-	
-		
+
+
 	retval = arm7tdmi_register_commands(cmd_ctx);
-	
+
 	arm720t_cmd = register_command(cmd_ctx, NULL, "arm720t", NULL, COMMAND_ANY, "arm720t specific commands");
 
 	register_command(cmd_ctx, arm720t_cmd, "cp15", arm720t_handle_cp15_command, COMMAND_EXEC, "display/modify cp15 register <opcode> [value]");
@@ -510,7 +510,7 @@
 	register_command(cmd_ctx, arm720t_cmd, "mww_phys", arm720t_handle_mw_phys_command, COMMAND_EXEC, "write memory word <physical addr> <value>");
 	register_command(cmd_ctx, arm720t_cmd, "mwh_phys", arm720t_handle_mw_phys_command, COMMAND_EXEC, "write memory half-word <physical addr> <value>");
 	register_command(cmd_ctx, arm720t_cmd, "mwb_phys", arm720t_handle_mw_phys_command, COMMAND_EXEC, "write memory byte <physical addr> <value>");
-	
+
 	return ERROR_OK;
 }
 
@@ -529,9 +529,9 @@
 		command_print(cmd_ctx, "current target isn't an ARM720t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
@@ -556,7 +556,7 @@
 			{
 				return retval;
 			}
-			
+
 			command_print(cmd_ctx, "0x%8.8x: 0x%8.8x", opcode, value);
 		}
 		else if (argc == 2)
@@ -575,7 +575,7 @@
 }
 
 int arm720t_handle_virt2phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -588,20 +588,20 @@
 		command_print(cmd_ctx, "current target isn't an ARM720t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-		
+
 	return armv4_5_mmu_handle_virt2phys_command(cmd_ctx, cmd, args, argc, target, &arm720t->armv4_5_mmu);
 }
 
 int arm720t_handle_md_phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -614,20 +614,20 @@
 		command_print(cmd_ctx, "current target isn't an ARM720t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_mmu_handle_md_phys_command(cmd_ctx, cmd, args, argc, target, &arm720t->armv4_5_mmu);
 }
 
 int arm720t_handle_mw_phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -640,14 +640,14 @@
 		command_print(cmd_ctx, "current target isn't an ARM720t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_mmu_handle_mw_phys_command(cmd_ctx, cmd, args, argc, target, &arm720t->armv4_5_mmu);
 }

Modified: branches/openocd_1_0_branch/src/target/arm7_9_common.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm7_9_common.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/arm7_9_common.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -584,7 +584,7 @@
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
 
 	/* set RESTART instruction */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if (arm7_9->need_bypass_before_restart) {
 		arm7_9->need_bypass_before_restart = 0;
 		arm_jtag_set_instr(jtag_info, 0xf, NULL);
@@ -630,7 +630,7 @@
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
 
 	/* set RESTART instruction */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if (arm7_9->need_bypass_before_restart) {
 		arm7_9->need_bypass_before_restart = 0;
 		arm_jtag_set_instr(jtag_info, 0xf, NULL);
@@ -1492,14 +1492,14 @@
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
 
 	/* set RESTART instruction */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if (arm7_9->need_bypass_before_restart) {
 		arm7_9->need_bypass_before_restart = 0;
 		arm_jtag_set_instr(jtag_info, 0xf, NULL);
 	}
 	arm_jtag_set_instr(jtag_info, 0x4, NULL);
 
-	jtag_add_runtest(1, TAP_RTI);
+	jtag_add_runtest(1, TAP_IDLE);
 	return jtag_execute_queue();
 }
 

Modified: branches/openocd_1_0_branch/src/target/arm7tdmi.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm7tdmi.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/arm7tdmi.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -55,7 +55,7 @@
 /* target function declarations */
 int arm7tdmi_poll(struct target_s *target);
 int arm7tdmi_halt(target_t *target);
-		
+
 target_type_t arm7tdmi_target =
 {
 	.name = "arm7tdmi",
@@ -74,15 +74,15 @@
 	.soft_reset_halt = arm7_9_soft_reset_halt,
 
 	.get_gdb_reg_list = armv4_5_get_gdb_reg_list,
-	
+
 	.read_memory = arm7_9_read_memory,
 	.write_memory = arm7_9_write_memory,
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
-	
+
 	.add_breakpoint = arm7_9_add_breakpoint,
 	.remove_breakpoint = arm7_9_remove_breakpoint,
 	.add_watchpoint = arm7_9_add_watchpoint,
@@ -101,7 +101,7 @@
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	
+
 	/* only check the debug reason if we don't know it already */
 	if ((target->debug_reason != DBG_REASON_DBGRQ)
 			&& (target->debug_reason != DBG_REASON_SINGLESTEP))
@@ -109,9 +109,9 @@
 		scan_field_t fields[2];
 		u8 databus[4];
 		u8 breakpoint;
-		
-		jtag_add_end_state(TAP_PD);
 
+		jtag_add_end_state(TAP_DRPAUSE);
+
 		fields[0].tap = arm7_9->jtag_info.tap;
 		fields[0].num_bits = 1;
 		fields[0].out_value = NULL;
@@ -121,7 +121,7 @@
 		fields[0].in_check_mask = NULL;
 		fields[0].in_handler = NULL;
 		fields[0].in_handler_priv = NULL;
-		
+
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 32;
 		fields[1].out_value = NULL;
@@ -131,30 +131,30 @@
 		fields[1].in_check_mask = NULL;
 		fields[1].in_handler = NULL;
 		fields[1].in_handler_priv = NULL;
-		
+
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
 			return retval;
 		}
 		arm_jtag_set_instr(&arm7_9->jtag_info, arm7_9->jtag_info.intest_instr, NULL);
 
-		jtag_add_dr_scan(2, fields, TAP_PD);
+		jtag_add_dr_scan(2, fields, TAP_DRPAUSE);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		fields[0].in_value = NULL;
 		fields[0].out_value = &breakpoint;
 		fields[1].in_value = NULL;
 		fields[1].out_value = databus;
-		
-		jtag_add_dr_scan(2, fields, TAP_PD);
 
+		jtag_add_dr_scan(2, fields, TAP_DRPAUSE);
+
 		if (breakpoint & 1)
-			target->debug_reason = DBG_REASON_WATCHPOINT; 
+			target->debug_reason = DBG_REASON_WATCHPOINT;
 		else
-			target->debug_reason = DBG_REASON_BREAKPOINT; 
+			target->debug_reason = DBG_REASON_BREAKPOINT;
 	}
 
 	return ERROR_OK;
@@ -164,13 +164,13 @@
 static __inline int arm7tdmi_clock_out_inner(arm_jtag_t *jtag_info, u32 out, int breakpoint)
 {
 	u32 values[2]={breakpoint, flip_u32(out, 32)};
-			
+
 	jtag_add_dr_out(jtag_info->tap,
 			2,
 			arm7tdmi_num_bits,
 			values,
 			-1);
-			
+
 	jtag_add_runtest(0, -1);
 
 	return ERROR_OK;
@@ -179,10 +179,10 @@
 /* put an instruction in the ARM7TDMI pipeline or write the data bus, and optionally read data */
 static __inline int arm7tdmi_clock_out(arm_jtag_t *jtag_info, u32 out, u32 *deprecated, int breakpoint)
 {
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	arm_jtag_scann(jtag_info, 0x1);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-	
+
 	return arm7tdmi_clock_out_inner(jtag_info, out, breakpoint);
 }
 
@@ -192,13 +192,13 @@
 	int retval = ERROR_OK;
 	scan_field_t fields[2];
 
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-	
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
@@ -208,7 +208,7 @@
 	fields[0].in_check_mask = NULL;
 	fields[0].in_handler = NULL;
 	fields[0].in_handler_priv = NULL;
-		
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
@@ -222,14 +222,14 @@
 	jtag_add_dr_scan(2, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 {
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-			
+
 		if (in)
 		{
 			LOG_DEBUG("in: 0x%8.8x", *in);
@@ -247,19 +247,19 @@
 /* clock the target, and read the databus
  * the *in pointer points to a buffer where elements of 'size' bytes
  * are stored in big (be==1) or little (be==0) endianness
- */ 
+ */
 int arm7tdmi_clock_data_in_endianness(arm_jtag_t *jtag_info, void *in, int size, int be)
 {
 	int retval = ERROR_OK;
 	scan_field_t fields[2];
 
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-	
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
@@ -269,7 +269,7 @@
 	fields[0].in_check_mask = NULL;
 	fields[0].in_handler = NULL;
 	fields[0].in_handler_priv = NULL;
-		
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
@@ -294,14 +294,14 @@
 	jtag_add_dr_scan(2, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 {
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-			
+
 		if (in)
 		{
 			LOG_DEBUG("in: 0x%8.8x", *(u32*)in);
@@ -322,10 +322,10 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
-	/* save r0 before using it and put system in ARM state 
+
+	/* save r0 before using it and put system in ARM state
 	 * to allow common handling of ARM and THUMB debugging */
-	
+
 	/* fetch STR r0, [r0] */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_STR(0, 0), NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
@@ -333,7 +333,7 @@
 	/* nothing fetched, STR r0, [r0] in Execute (2) */
 	arm7tdmi_clock_data_in(jtag_info, r0);
 
-	/* MOV r0, r15 fetched, STR in Decode */	
+	/* MOV r0, r15 fetched, STR in Decode */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_MOV(0, 15), NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_STR(0, 0), NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
@@ -349,22 +349,22 @@
 	arm7tdmi_clock_out(jtag_info, 0x0, NULL, 0);
 	/* nothing fetched, data from previous cycle is written to register */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
-	
+
 	/* fetch BX */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_BX(0), NULL, 0);
 	/* NOP fetched, BX in Decode, MOV in Execute */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
 	/* NOP fetched, BX in Execute (1) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
-	
+
 	jtag_execute_queue();
-	
+
 	/* fix program counter:
 	 * MOV r0, r15 was the 4th instruction (+6)
 	 * reading PC in Thumb state gives address of instruction + 4
 	 */
 	*pc -= 0xa;
-	
+
 }
 
 void arm7tdmi_read_core_regs(target_t *target, u32 mask, u32* core_regs[16])
@@ -374,7 +374,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* STMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -405,7 +405,7 @@
 	u32 *buf_u32 = buffer;
 	u16 *buf_u16 = buffer;
 	u8 *buf_u8 = buffer;
-		
+
 	/* STMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -435,7 +435,7 @@
 			}
 		}
 	}
-	
+
 }
 
 void arm7tdmi_read_xpsr(target_t *target, u32 *xpsr, int spsr)
@@ -444,10 +444,10 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* MRS r0, cpsr */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_MRS(0, spsr & 1), NULL, 0);
-	
+
 	/* STR r0, [r15] */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STR(0, 15), NULL, 0);
 	/* fetch NOP, STR in DECODE stage */
@@ -465,7 +465,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr: %8.8x, spsr: %i", xpsr, spsr);
 
 	/* MSR1 fetched */
@@ -496,9 +496,9 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr_im: %2.2x, rot: %i, spsr: %i", xpsr_im, rot, spsr);
-	
+
 	/* MSR fetched */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_MSR_IM(xpsr_im, rot, 1, spsr), NULL, 0);
 	/* NOP fetched, MSR in DECODE */
@@ -507,7 +507,7 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	/* nothing fetched, MSR in EXECUTE (2) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
-	
+
 }
 
 void arm7tdmi_write_core_regs(target_t *target, u32 mask, u32 core_regs[16])
@@ -517,7 +517,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* LDMIA r0-15, [r0] at debug speed
 	* register values will start to appear on 4th DCLK
 	*/
@@ -535,7 +535,7 @@
 			arm7tdmi_clock_out_inner(jtag_info, core_regs[i], 0);
 	}
 	arm7tdmi_clock_out_inner(jtag_info, ARMV4_5_NOP, 0);
-	
+
 }
 
 void arm7tdmi_load_word_regs(target_t *target, u32 mask)
@@ -558,7 +558,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/* put system-speed load half-word into the pipeline */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
@@ -591,7 +591,7 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STMIA(0, mask, 0, 1), NULL, 0);
-	
+
 }
 
 void arm7tdmi_store_hword_reg(target_t *target, int num)
@@ -628,7 +628,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/* LDMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -655,7 +655,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out_inner(jtag_info, ARMV4_5_B(0xfffffa, 0), 0);
 
@@ -664,7 +664,7 @@
 void arm7tdmi_branch_resume_thumb(target_t *target)
 {
 	LOG_DEBUG("-");
-	
+
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
@@ -687,15 +687,15 @@
 
 	/* Branch and eXchange */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_BX(0), NULL, 0);
-	
+
 	embeddedice_read_reg(dbg_stat);
-	
+
 	/* fetch NOP, BX in DECODE stage */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
-	
+
 	/* target is now in Thumb state */
 	embeddedice_read_reg(dbg_stat);
-	
+
 	/* fetch NOP, BX in EXECUTE stage (1st cycle) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 
@@ -712,17 +712,17 @@
 	arm7tdmi_clock_out(jtag_info, buf_get_u32(armv4_5->core_cache->reg_list[0].value, 0, 32), NULL, 0);
 	/* nothing fetched, LDR in EXECUTE stage (3rd cycle) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
-	
+
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 0);
 
 	embeddedice_read_reg(dbg_stat);
-	
+
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_B(0x7f8), NULL, 0);
 
 }
-		
+
 void arm7tdmi_build_reg_cache(target_t *target)
 {
 	reg_cache_t **cache_p = register_get_last_cache_p(&target->reg_cache);
@@ -745,10 +745,10 @@
 		reg_cache_t *t=embeddedice_build_reg_cache(target, arm7_9);
 		if (t==NULL)
 			return ERROR_FAIL;
-		
+
 		(*cache_p) = t;
 		arm7_9->eice_cache = (*cache_p);
-		
+
 		if (arm7_9->etm_ctx)
 		{
 			arm_jtag_t *jtag_info = &arm7_9->jtag_info;
@@ -771,16 +771,16 @@
 
 int arm7tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
-	
+
 	arm7tdmi_build_reg_cache(target);
-	
+
 	return ERROR_OK;
-	
+
 }
 
 int arm7tdmi_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -788,56 +788,56 @@
 {
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
-	
+
 	arm7_9 = &arm7tdmi->arm7_9_common;
 	armv4_5 = &arm7_9->armv4_5_common;
-	
+
 	/* prepare JTAG information for the new target */
 	arm7_9->jtag_info.tap = tap;
 	arm7_9->jtag_info.scann_size = 4;
-	
+
 	/* register arch-specific functions */
 	arm7_9->examine_debug_reason = arm7tdmi_examine_debug_reason;
 	arm7_9->change_to_arm = arm7tdmi_change_to_arm;
 	arm7_9->read_core_regs = arm7tdmi_read_core_regs;
 	arm7_9->read_core_regs_target_buffer = arm7tdmi_read_core_regs_target_buffer;
 	arm7_9->read_xpsr = arm7tdmi_read_xpsr;
-	
+
 	arm7_9->write_xpsr = arm7tdmi_write_xpsr;
 	arm7_9->write_xpsr_im8 = arm7tdmi_write_xpsr_im8;
 	arm7_9->write_core_regs = arm7tdmi_write_core_regs;
-	
+
 	arm7_9->load_word_regs = arm7tdmi_load_word_regs;
 	arm7_9->load_hword_reg = arm7tdmi_load_hword_reg;
 	arm7_9->load_byte_reg = arm7tdmi_load_byte_reg;
-	
+
 	arm7_9->store_word_regs = arm7tdmi_store_word_regs;
 	arm7_9->store_hword_reg = arm7tdmi_store_hword_reg;
 	arm7_9->store_byte_reg = arm7tdmi_store_byte_reg;
-	
+
 	arm7_9->write_pc = arm7tdmi_write_pc;
 	arm7_9->branch_resume = arm7tdmi_branch_resume;
 	arm7_9->branch_resume_thumb = arm7tdmi_branch_resume_thumb;
-	
+
 	arm7_9->enable_single_step = arm7_9_enable_eice_step;
 	arm7_9->disable_single_step = arm7_9_disable_eice_step;
-		
+
 	arm7_9->pre_debug_entry = NULL;
 	arm7_9->post_debug_entry = NULL;
-	
+
 	arm7_9->pre_restore_context = NULL;
 	arm7_9->post_restore_context = NULL;
-	
+
 	/* initialize arch-specific breakpoint handling */
 	arm7_9->arm_bkpt = 0xdeeedeee;
 	arm7_9->thumb_bkpt = 0xdeee;
-	
+
 	arm7_9->dbgreq_adjust_pc = 2;
 	arm7_9->arch_info = arm7tdmi;
 
 	arm7tdmi->arch_info = NULL;
 	arm7tdmi->common_magic = ARM7TDMI_COMMON_MAGIC;
-	
+
 	if (variant)
 	{
 		arm7tdmi->variant = strdup(variant);
@@ -846,7 +846,7 @@
 	{
 		arm7tdmi->variant = strdup("");
 	}
-	
+
 	arm7_9_init_arch_info(target, arm7_9);
 
 	return ERROR_OK;
@@ -857,11 +857,11 @@
 int arm7tdmi_target_create( struct target_s *target, Jim_Interp *interp )
 {
 	arm7tdmi_common_t *arm7tdmi;
-	
+
 	arm7tdmi = calloc(1,sizeof(arm7tdmi_common_t));
-	
+
 	arm7tdmi_init_arch_info(target, arm7tdmi, target->tap, target->variant);
-	
+
 	return ERROR_OK;
 }
 
@@ -869,9 +869,9 @@
 int arm7tdmi_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
-	
+
 	retval = arm7_9_register_commands(cmd_ctx);
-	
+
 	return retval;
 
 }

Modified: branches/openocd_1_0_branch/src/target/arm920t.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm920t.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/arm920t.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -73,7 +73,7 @@
 	.assert_reset = arm7_9_assert_reset,
 	.deassert_reset = arm7_9_deassert_reset,
 	.soft_reset_halt = arm920t_soft_reset_halt,
-	
+
 	.get_gdb_reg_list = armv4_5_get_gdb_reg_list,
 
 	.read_memory = arm920t_read_memory,
@@ -81,7 +81,7 @@
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
 
 	.add_breakpoint = arm7_9_add_breakpoint,
@@ -105,8 +105,8 @@
 	u8 access_type_buf = 1;
 	u8 reg_addr_buf = reg_addr & 0x3f;
 	u8 nr_w_buf = 0;
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0xf);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 
@@ -149,7 +149,7 @@
 	fields[3].in_check_mask = NULL;
 	fields[3].in_handler = NULL;
 	fields[3].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(4, fields, -1);
 
 	fields[1].in_handler_priv = value;
@@ -175,10 +175,10 @@
 	u8 reg_addr_buf = reg_addr & 0x3f;
 	u8 nr_w_buf = 1;
 	u8 value_buf[4];
-	
+
 	buf_set_u32(value_buf, 0, 32, value);
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0xf);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 
@@ -221,7 +221,7 @@
 	fields[3].in_check_mask = NULL;
 	fields[3].in_handler = NULL;
 	fields[3].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(4, fields, -1);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
@@ -242,11 +242,11 @@
 	u8 reg_addr_buf = 0x0;
 	u8 nr_w_buf = 0;
 	u8 cp15_opcode_buf[4];
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0xf);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-	
+
 	buf_set_u32(cp15_opcode_buf, 0, 32, cp15_opcode);
 
 	fields[0].tap = jtag_info->tap;
@@ -296,13 +296,13 @@
 	retval = arm7_9_execute_sys_speed(target);
 	if (retval != ERROR_OK)
 		return retval;
-	
+
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		LOG_ERROR("failed executing JTAG queue, exiting");
 		return retval;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -315,18 +315,18 @@
 
 	/* load address into R1 */
 	regs[1] = address;
-	arm9tdmi_write_core_regs(target, 0x2, regs); 
-	
-	/* read-modify-write CP15 test state register 
+	arm9tdmi_write_core_regs(target, 0x2, regs);
+
+	/* read-modify-write CP15 test state register
 	* to enable interpreted access mode */
-	arm920t_read_cp15_physical(target, 0x1e, &cp15c15);	
+	arm920t_read_cp15_physical(target, 0x1e, &cp15c15);
 	jtag_execute_queue();
 	cp15c15 |= 1;	/* set interpret mode */
 	arm920t_write_cp15_physical(target, 0x1e, cp15c15);
 
 	/* execute CP15 instruction and ARM load (reading from coprocessor) */
 	arm920t_execute_cp15(target, cp15_opcode, ARMV4_5_LDR(0, 1));
-	
+
 	/* disable interpreted access mode */
 	cp15c15 &= ~1U;	/* clear interpret mode */
 	arm920t_write_cp15_physical(target, 0x1e, cp15c15);
@@ -335,7 +335,7 @@
 	regs_p[0] = value;
 	arm9tdmi_read_core_regs(target, 0x1, regs_p);
 	jtag_execute_queue();
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	LOG_DEBUG("cp15_opcode: %8.8x, address: %8.8x, value: %8.8x", cp15_opcode, address, *value);
 #endif
@@ -360,7 +360,7 @@
 	regs[1] = address;
 	arm9tdmi_write_core_regs(target, 0x3, regs);
 
-	/* read-modify-write CP15 test state register 
+	/* read-modify-write CP15 test state register
 	* to enable interpreted access mode */
 	arm920t_read_cp15_physical(target, 0x1e, &cp15c15);
 	jtag_execute_queue();
@@ -380,10 +380,10 @@
 
 	if (armv4_5_mode_to_number(armv4_5->core_mode)==-1)
 		return ERROR_FAIL;
-	
+
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 0).dirty = 1;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 1).dirty = 1;
-	
+
 	return ERROR_OK;
 }
 
@@ -405,13 +405,13 @@
 	/* read cp15 control register */
 	arm920t_read_cp15_physical(target, 0x2, &cp15_control);
 	jtag_execute_queue();
-		
+
 	if (mmu)
 		cp15_control &= ~0x1U;
-	
+
 	if (d_u_cache)
 		cp15_control &= ~0x4U;
-	
+
 	if (i_cache)
 		cp15_control &= ~0x1000U;
 
@@ -425,16 +425,16 @@
 	/* read cp15 control register */
 	arm920t_read_cp15_physical(target, 0x2, &cp15_control);
 	jtag_execute_queue();
-		
+
 	if (mmu)
 		cp15_control |= 0x1U;
-	
+
 	if (d_u_cache)
 		cp15_control |= 0x4U;
-	
+
 	if (i_cache)
 		cp15_control |= 0x1000U;
-	
+
 	arm920t_write_cp15_physical(target, 0x2, cp15_control);
 }
 
@@ -445,7 +445,7 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
-	
+
 	/* examine cp15 control reg */
 	arm920t_read_cp15_physical(target, 0x2, &arm920t->cp15_control_reg);
 	jtag_execute_queue();
@@ -469,13 +469,13 @@
 	arm920t_read_cp15_interpreted(target, 0xee150f30, 0x0, &arm920t->i_fsr);
 	arm920t_read_cp15_interpreted(target, 0xee160f10, 0x0, &arm920t->d_far);
 	arm920t_read_cp15_interpreted(target, 0xee160f30, 0x0, &arm920t->i_far);
-	
+
 	LOG_DEBUG("D FSR: 0x%8.8x, D FAR: 0x%8.8x, I FSR: 0x%8.8x, I FAR: 0x%8.8x",
-		arm920t->d_fsr, arm920t->d_far, arm920t->i_fsr, arm920t->i_far);  
+		arm920t->d_fsr, arm920t->d_far, arm920t->i_fsr, arm920t->i_far);
 
 	if (arm920t->preserve_cache)
 	{
-		/* read-modify-write CP15 test state register 
+		/* read-modify-write CP15 test state register
 		 * to disable I/D-cache linefills */
 		arm920t_read_cp15_physical(target, 0x1e, &cp15c15);
 		jtag_execute_queue();
@@ -491,14 +491,14 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
-	
+
 	/* restore i/d fault status and address register */
 	arm920t_write_cp15_interpreted(target, 0xee050f10, arm920t->d_fsr, 0x0);
 	arm920t_write_cp15_interpreted(target, 0xee050f30, arm920t->i_fsr, 0x0);
 	arm920t_write_cp15_interpreted(target, 0xee060f10, arm920t->d_far, 0x0);
 	arm920t_write_cp15_interpreted(target, 0xee060f30, arm920t->i_far, 0x0);
-	
-	/* read-modify-write CP15 test state register 
+
+	/* read-modify-write CP15 test state register
 	* to reenable I/D-cache linefills */
 	if (arm920t->preserve_cache)
 	{
@@ -515,35 +515,35 @@
 	arm7_9_common_t *arm7_9;
 	arm9tdmi_common_t *arm9tdmi;
 	arm920t_common_t *arm920t;
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7_9 = armv4_5->arch_info;
 	if (arm7_9->common_magic != ARM7_9_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm9tdmi = arm7_9->arch_info;
 	if (arm9tdmi->common_magic != ARM9TDMI_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm920t = arm9tdmi->arch_info;
 	if (arm920t->common_magic != ARM920T_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	*armv4_5_p = armv4_5;
 	*arm7_9_p = arm7_9;
 	*arm9tdmi_p = arm9tdmi;
 	*arm920t_p = arm920t;
-	
+
 	return ERROR_OK;
 }
 
@@ -553,18 +553,18 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
-	
-	char *state[] = 
+
+	char *state[] =
 	{
 		"disabled", "enabled"
 	};
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		LOG_ERROR("BUG: called for a non-ARMv4/5 target");
 		exit(-1);
 	}
-	
+
 	LOG_USER(	"target halted in %s state due to %s, current mode: %s\n"
 			"cpsr: 0x%8.8x pc: 0x%8.8x\n"
 			"MMU: %s, D-Cache: %s, I-Cache: %s",
@@ -574,18 +574,18 @@
 			 buf_get_u32(armv4_5->core_cache->reg_list[ARMV4_5_CPSR].value, 0, 32),
 			 buf_get_u32(armv4_5->core_cache->reg_list[15].value, 0, 32),
 			 state[arm920t->armv4_5_mmu.mmu_enabled],
-			 state[arm920t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled], 
+			 state[arm920t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled],
 			 state[arm920t->armv4_5_mmu.armv4_5_cache.i_cache_enabled]);
-	
+
 	return ERROR_OK;
 }
 
 int arm920t_read_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
 {
 	int retval;
-	
+
 	retval = arm7_9_read_memory(target, address, size, count, buffer);
-	
+
 	return retval;
 }
 
@@ -596,7 +596,7 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
-	
+
 	if ((retval = arm7_9_write_memory(target, address, size, count, buffer)) != ERROR_OK)
 		return retval;
 
@@ -615,7 +615,7 @@
 			if (cb == 3)
 				armv4_5_mmu_write_physical(target, &arm920t->armv4_5_mmu, pa, size, count, buffer);
 		}
-		
+
 		if (arm920t->armv4_5_mmu.armv4_5_cache.i_cache_enabled)
 		{
 			LOG_DEBUG("I-Cache enabled, invalidating affected I-Cache line");
@@ -634,12 +634,12 @@
 	arm9tdmi_common_t *arm9tdmi = arm7_9->arch_info;
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
-	
+
 	if((retval = target_halt(target)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	long long then=timeval_ms();
 	int timeout;
 	while (!(timeout=((timeval_ms()-then)>1000)))
@@ -669,22 +669,22 @@
 		LOG_ERROR("Failed to halt CPU after 1 sec");
 		return ERROR_TARGET_TIMEOUT;
 	}
-	
+
 	target->state = TARGET_HALTED;
-	
+
 	/* SVC, ARM state, IRQ and FIQ disabled */
 	buf_set_u32(armv4_5->core_cache->reg_list[ARMV4_5_CPSR].value, 0, 8, 0xd3);
 	armv4_5->core_cache->reg_list[ARMV4_5_CPSR].dirty = 1;
 	armv4_5->core_cache->reg_list[ARMV4_5_CPSR].valid = 1;
-	
+
 	/* start fetching from 0x0 */
 	buf_set_u32(armv4_5->core_cache->reg_list[15].value, 0, 32, 0x0);
 	armv4_5->core_cache->reg_list[15].dirty = 1;
 	armv4_5->core_cache->reg_list[15].valid = 1;
-	
+
 	armv4_5->core_mode = ARMV4_5_MODE_SVC;
 	armv4_5->core_state = ARMV4_5_STATE_ARM;
-	
+
 	arm920t_disable_mmu_caches(target, 1, 1, 1);
 	arm920t->armv4_5_mmu.mmu_enabled = 0;
 	arm920t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled = 0;
@@ -694,21 +694,21 @@
 	{
 		return retval;
 	}
-	
+
 	return ERROR_OK;
 }
 
 int arm920t_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
 	arm9tdmi_init_target(cmd_ctx, target);
-		
+
 	return ERROR_OK;
-	
+
 }
 
 int arm920t_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -716,17 +716,17 @@
 {
 	arm9tdmi_common_t *arm9tdmi = &arm920t->arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm9tdmi->arm7_9_common;
-	
+
 	/* initialize arm9tdmi specific info (including arm7_9 and armv4_5)
 	 */
 	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
 
 	arm9tdmi->arch_info = arm920t;
 	arm920t->common_magic = ARM920T_COMMON_MAGIC;
-	
+
 	arm7_9->post_debug_entry = arm920t_post_debug_entry;
 	arm7_9->pre_restore_context = arm920t_pre_restore_context;
-	
+
 	arm920t->armv4_5_mmu.armv4_5_cache.ctype = -1;
 	arm920t->armv4_5_mmu.get_ttb = arm920t_get_ttb;
 	arm920t->armv4_5_mmu.read_memory = arm7_9_read_memory;
@@ -735,23 +735,23 @@
 	arm920t->armv4_5_mmu.enable_mmu_caches = arm920t_enable_mmu_caches;
 	arm920t->armv4_5_mmu.has_tiny_pages = 1;
 	arm920t->armv4_5_mmu.mmu_enabled = 0;
-	
+
 	/* disabling linefills leads to lockups, so keep them enabled for now
 	 * this doesn't affect correctness, but might affect timing issues, if
 	 * important data is evicted from the cache during the debug session
 	 * */
 	arm920t->preserve_cache = 0;
-	
+
 	/* override hw single-step capability from ARM9TDMI */
 	arm7_9->has_single_step = 1;
-	
+
 	return ERROR_OK;
 }
 
 int arm920t_target_create(struct target_s *target, Jim_Interp *interp)
 {
 	arm920t_common_t *arm920t = calloc(1,sizeof(arm920t_common_t));
-	
+
 	arm920t_init_arch_info(target, arm920t, target->tap, target->variant);
 
 	return ERROR_OK;
@@ -761,10 +761,10 @@
 {
 	int retval;
 	command_t *arm920t_cmd;
-	
-		
+
+
 	retval = arm9tdmi_register_commands(cmd_ctx);
-	
+
 	arm920t_cmd = register_command(cmd_ctx, NULL, "arm920t", NULL, COMMAND_ANY, "arm920t specific commands");
 
 	register_command(cmd_ctx, arm920t_cmd, "cp15", arm920t_handle_cp15_command, COMMAND_EXEC, "display/modify cp15 register <num> [value]");
@@ -804,30 +804,30 @@
 	FILE *output;
 	arm920t_cache_line_t d_cache[8][64], i_cache[8][64];
 	int segment, index;
-	
+
 	if (argc != 1)
 	{
 		command_print(cmd_ctx, "usage: arm920t read_cache <filename>");
 		return ERROR_OK;
 	}
-	
+
 	if ((output = fopen(args[0], "w")) == NULL)
 	{
 		LOG_DEBUG("error opening cache content file");
 		return ERROR_OK;
 	}
-	
+
 	for (i = 0; i < 16; i++)
 		regs_p[i] = &regs[i];
-		
+
 	if (arm920t_get_arch_pointers(target, &armv4_5, &arm7_9, &arm9tdmi, &arm920t) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	/* disable MMU and Caches */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), &cp15_ctrl);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -838,29 +838,29 @@
 	cp15_ctrl &= ~(ARMV4_5_MMU_ENABLED | ARMV4_5_D_U_CACHE_ENABLED | ARMV4_5_I_CACHE_ENABLED);
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl);
 
-	/* read CP15 test state register */ 
+	/* read CP15 test state register */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), &cp15c15);
 	jtag_execute_queue();
-	
+
 	/* read DCache content */
 	fprintf(output, "DCache:\n");
-	
-	/* go through segments 0 to nsets (8 on ARM920T, 4 on ARM922T) */ 
+
+	/* go through segments 0 to nsets (8 on ARM920T, 4 on ARM922T) */
 	for (segment = 0; segment < arm920t->armv4_5_mmu.armv4_5_cache.d_u_size.nsets; segment++)
 	{
 		fprintf(output, "\nsegment: %i\n----------", segment);
-		
+
 		/* Ra: r0 = SBZ(31:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment << 5);
 		arm9tdmi_write_core_regs(target, 0x1, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* D CAM Read, loads current victim into C15.C.D.Ind */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,6,2), ARMV4_5_LDR(1, 0));
-	
+
 		/* read current victim */
 		arm920t_read_cp15_physical(target, 0x3d, &C15_C_D_Ind);
 
@@ -877,16 +877,16 @@
 			/* set interpret mode */
 			cp15c15 |= 0x1;
 			arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 			/* Write DCache victim */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,9,1,0), ARMV4_5_LDR(1, 0));
-	
+
 			/* Read D RAM */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,10,2), ARMV4_5_LDMIA(0, 0x1fe, 0, 0));
-			
+
 			/* Read D CAM */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,6,2), ARMV4_5_LDR(9, 0));
-			
+
 			/* clear interpret mode */
 			cp15c15 &= ~0x1;
 			arm920t_write_cp15_physical(target, 0x1e, cp15c15);
@@ -899,19 +899,19 @@
 			}
 
 			d_cache[segment][index].cam = regs[9];
-			
+
 			/* mask LFSR[6] */
 			regs[9] &= 0xfffffffe;
 			fprintf(output, "\nsegment: %i, index: %i, CAM: 0x%8.8x, content (%s):\n", segment, index, regs[9], (regs[9] & 0x10) ? "valid" : "invalid");
-			
+
 			for (i = 1; i < 9; i++)
 			{
 				 d_cache[segment][index].data[i] = regs[i];
 				 fprintf(output, "%i: 0x%8.8x\n", i-1, regs[i]);
 			}
-	
+
 		}
-		
+
 		/* Ra: r0 = index(31:26):SBZ(25:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment << 5) | (C15_C_D_Ind << 26);
 		arm9tdmi_write_core_regs(target, 0x1, regs);
@@ -919,10 +919,10 @@
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 		/* Write DCache victim */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,9,1,0), ARMV4_5_LDR(1, 0));
-	
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
@@ -930,23 +930,23 @@
 
 	/* read ICache content */
 	fprintf(output, "ICache:\n");
-	
-	/* go through segments 0 to nsets (8 on ARM920T, 4 on ARM922T) */ 
+
+	/* go through segments 0 to nsets (8 on ARM920T, 4 on ARM922T) */
 	for (segment = 0; segment < arm920t->armv4_5_mmu.armv4_5_cache.d_u_size.nsets; segment++)
 	{
 		fprintf(output, "segment: %i\n----------", segment);
-		
+
 		/* Ra: r0 = SBZ(31:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment << 5);
 		arm9tdmi_write_core_regs(target, 0x1, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* I CAM Read, loads current victim into C15.C.I.Ind */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,5,2), ARMV4_5_LDR(1, 0));
-	
+
 		/* read current victim */
 		arm920t_read_cp15_physical(target, 0x3b, &C15_C_I_Ind);
 
@@ -963,16 +963,16 @@
 			/* set interpret mode */
 			cp15c15 |= 0x1;
 			arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 			/* Write ICache victim */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,9,1,1), ARMV4_5_LDR(1, 0));
-	
+
 			/* Read I RAM */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,9,2), ARMV4_5_LDMIA(0, 0x1fe, 0, 0));
-			
+
 			/* Read I CAM */
 			arm920t_execute_cp15(target, ARMV4_5_MCR(15,2,0,15,5,2), ARMV4_5_LDR(9, 0));
-			
+
 			/* clear interpret mode */
 			cp15c15 &= ~0x1;
 			arm920t_write_cp15_physical(target, 0x1e, cp15c15);
@@ -985,20 +985,20 @@
 			}
 
 			i_cache[segment][index].cam = regs[9];
-			
+
 			/* mask LFSR[6] */
 			regs[9] &= 0xfffffffe;
 			fprintf(output, "\nsegment: %i, index: %i, CAM: 0x%8.8x, content (%s):\n", segment, index, regs[9], (regs[9] & 0x10) ? "valid" : "invalid");
-			
+
 			for (i = 1; i < 9; i++)
 			{
 				 i_cache[segment][index].data[i] = regs[i];
 				 fprintf(output, "%i: 0x%8.8x\n", i-1, regs[i]);
 			}
-	
+
 		}
-		
-	
+
+
 		/* Ra: r0 = index(31:26):SBZ(25:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment << 5) | (C15_C_D_Ind << 26);
 		arm9tdmi_write_core_regs(target, 0x1, regs);
@@ -1006,22 +1006,22 @@
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 		/* Write ICache victim */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,9,1,1), ARMV4_5_LDR(1, 0));
-	
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
 	}
-	
+
 	/* restore CP15 MMU and Cache settings */
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl_saved);
-	
+
 	command_print(cmd_ctx, "cache content successfully output to %s", args[0]);
-	
+
 	fclose(output);
-	
+
 	if (armv4_5_mode_to_number(armv4_5->core_mode)==-1)
 		return ERROR_FAIL;
 
@@ -1036,7 +1036,7 @@
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 7).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 7).valid;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 8).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 8).valid;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 9).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 9).valid;
-	
+
 	return ERROR_OK;
 }
 
@@ -1058,30 +1058,30 @@
 	u32 Dlockdown, Ilockdown;
 	arm920t_tlb_entry_t d_tlb[64], i_tlb[64];
 	int victim;
-	
+
 	if (argc != 1)
 	{
 		command_print(cmd_ctx, "usage: arm920t read_mmu <filename>");
 		return ERROR_OK;
 	}
-	
+
 	if ((output = fopen(args[0], "w")) == NULL)
 	{
 		LOG_DEBUG("error opening mmu content file");
 		return ERROR_OK;
 	}
-	
+
 	for (i = 0; i < 16; i++)
 		regs_p[i] = &regs[i];
-		
+
 	if (arm920t_get_arch_pointers(target, &armv4_5, &arm7_9, &arm9tdmi, &arm920t) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	/* disable MMU and Caches */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), &cp15_ctrl);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1092,27 +1092,27 @@
 	cp15_ctrl &= ~(ARMV4_5_MMU_ENABLED | ARMV4_5_D_U_CACHE_ENABLED | ARMV4_5_I_CACHE_ENABLED);
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl);
 
-	/* read CP15 test state register */ 
+	/* read CP15 test state register */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), &cp15c15);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return retval;
 	}
 
-	/* prepare reading D TLB content 
+	/* prepare reading D TLB content
 	 * */
-	
+
 	/* set interpret mode */
 	cp15c15 |= 0x1;
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 	/* Read D TLB lockdown */
 	arm920t_execute_cp15(target, ARMV4_5_MRC(15,0,0,10,0,0), ARMV4_5_LDR(1, 0));
-	
+
 	/* clear interpret mode */
 	cp15c15 &= ~0x1;
 	arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-	
+
 	/* read D TLB lockdown stored to r1 */
 	arm9tdmi_read_core_regs(target, 0x2, regs_p);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1120,63 +1120,63 @@
 		return retval;
 	}
 	Dlockdown = regs[1];
-	
+
 	for (victim = 0; victim < 64; victim += 8)
 	{
-		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0] 
+		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0]
 		 * base remains unchanged, victim goes through entries 0 to 63 */
 		regs[1] = (Dlockdown & 0xfc000000) | (victim << 20);
 		arm9tdmi_write_core_regs(target, 0x2, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* Write D TLB lockdown */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,0), ARMV4_5_STR(1, 0));
-	
+
 		/* Read D TLB CAM */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,6,4), ARMV4_5_LDMIA(0, 0x3fc, 0, 0));
-		
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-		
+
 		/* read D TLB CAM content stored to r2-r9 */
 		arm9tdmi_read_core_regs(target, 0x3fc, regs_p);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		for (i = 0; i < 8; i++)
-			d_tlb[victim + i].cam = regs[i + 2]; 
+			d_tlb[victim + i].cam = regs[i + 2];
 	}
 
 	for (victim = 0; victim < 64; victim++)
 	{
-		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0] 
+		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0]
 		 * base remains unchanged, victim goes through entries 0 to 63 */
 		regs[1] = (Dlockdown & 0xfc000000) | (victim << 20);
 		arm9tdmi_write_core_regs(target, 0x2, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* Write D TLB lockdown */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,0), ARMV4_5_STR(1, 0));
-	
+
 		/* Read D TLB RAM1 */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,10,4), ARMV4_5_LDR(2,0));
 
 		/* Read D TLB RAM2 */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,2,5), ARMV4_5_LDR(3,0));
-		
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-		
+
 		/* read D TLB RAM content stored to r2 and r3 */
 		arm9tdmi_read_core_regs(target, 0xc, regs_p);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1184,31 +1184,31 @@
 			return retval;
 		}
 
-		d_tlb[victim].ram1 = regs[2]; 
-		d_tlb[victim].ram2 = regs[3]; 
+		d_tlb[victim].ram1 = regs[2];
+		d_tlb[victim].ram2 = regs[3];
 	}
-		
+
 	/* restore D TLB lockdown */
 	regs[1] = Dlockdown;
 	arm9tdmi_write_core_regs(target, 0x2, regs);
-	
+
 	/* Write D TLB lockdown */
 	arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,0), ARMV4_5_STR(1, 0));
 
-	/* prepare reading I TLB content 
+	/* prepare reading I TLB content
 	 * */
-	
+
 	/* set interpret mode */
 	cp15c15 |= 0x1;
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-	
+
 	/* Read I TLB lockdown */
 	arm920t_execute_cp15(target, ARMV4_5_MRC(15,0,0,10,0,1), ARMV4_5_LDR(1, 0));
-	
+
 	/* clear interpret mode */
 	cp15c15 &= ~0x1;
 	arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-	
+
 	/* read I TLB lockdown stored to r1 */
 	arm9tdmi_read_core_regs(target, 0x2, regs_p);
 	if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1216,63 +1216,63 @@
 		return retval;
 	}
 	Ilockdown = regs[1];
-	
+
 	for (victim = 0; victim < 64; victim += 8)
 	{
-		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0] 
+		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0]
 		 * base remains unchanged, victim goes through entries 0 to 63 */
 		regs[1] = (Ilockdown & 0xfc000000) | (victim << 20);
 		arm9tdmi_write_core_regs(target, 0x2, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* Write I TLB lockdown */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,1), ARMV4_5_STR(1, 0));
-	
+
 		/* Read I TLB CAM */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,5,4), ARMV4_5_LDMIA(0, 0x3fc, 0, 0));
-		
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-		
+
 		/* read I TLB CAM content stored to r2-r9 */
 		arm9tdmi_read_core_regs(target, 0x3fc, regs_p);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		for (i = 0; i < 8; i++)
-			i_tlb[i + victim].cam = regs[i + 2]; 
+			i_tlb[i + victim].cam = regs[i + 2];
 	}
 
 	for (victim = 0; victim < 64; victim++)
 	{
-		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0] 
+		/* new lockdown value: base[31:26]:victim[25:20]:SBZ[19:1]:p[0]
 		 * base remains unchanged, victim goes through entries 0 to 63 */
 		regs[1] = (Dlockdown & 0xfc000000) | (victim << 20);
 		arm9tdmi_write_core_regs(target, 0x2, regs);
-		
+
 		/* set interpret mode */
 		cp15c15 |= 0x1;
 		arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), cp15c15);
-		
+
 		/* Write I TLB lockdown */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,1), ARMV4_5_STR(1, 0));
-	
+
 		/* Read I TLB RAM1 */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,9,4), ARMV4_5_LDR(2,0));
 
 		/* Read I TLB RAM2 */
 		arm920t_execute_cp15(target, ARMV4_5_MCR(15,4,0,15,1,5), ARMV4_5_LDR(3,0));
-		
+
 		/* clear interpret mode */
 		cp15c15 &= ~0x1;
 		arm920t_write_cp15_physical(target, 0x1e, cp15c15);
-		
+
 		/* read I TLB RAM content stored to r2 and r3 */
 		arm9tdmi_read_core_regs(target, 0xc, regs_p);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1280,21 +1280,21 @@
 			return retval;
 		}
 
-		i_tlb[victim].ram1 = regs[2]; 
-		i_tlb[victim].ram2 = regs[3]; 
+		i_tlb[victim].ram1 = regs[2];
+		i_tlb[victim].ram2 = regs[3];
 	}
-		
+
 	/* restore I TLB lockdown */
 	regs[1] = Ilockdown;
 	arm9tdmi_write_core_regs(target, 0x2, regs);
-	
+
 	/* Write I TLB lockdown */
 	arm920t_execute_cp15(target, ARMV4_5_MCR(15,0,0,10,0,1), ARMV4_5_STR(1, 0));
-	
+
 	/* restore CP15 MMU and Cache settings */
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl_saved);
 
-	/* output data to file */	
+	/* output data to file */
 	fprintf(output, "D TLB content:\n");
 	for (i = 0; i < 64; i++)
 	{
@@ -1306,11 +1306,11 @@
 	{
 		fprintf(output, "%i: 0x%8.8x 0x%8.8x 0x%8.8x %s\n", i, i_tlb[i].cam, i_tlb[i].ram1, i_tlb[i].ram2, (i_tlb[i].cam & 0x20) ? "(valid)" : "(invalid)");
 	}
-	
+
 	command_print(cmd_ctx, "mmu content successfully output to %s", args[0]);
-	
+
 	fclose(output);
-	
+
 	if (armv4_5_mode_to_number(armv4_5->core_mode)==-1)
 		return ERROR_FAIL;
 
@@ -1325,7 +1325,7 @@
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 7).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 7).valid;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 8).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 8).valid;
 	ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 9).dirty = ARMV4_5_CORE_REG_MODE(armv4_5->core_cache, armv4_5->core_mode, 9).valid;
-	
+
 	return ERROR_OK;
 }
 int arm920t_handle_cp15_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
@@ -1343,9 +1343,9 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
@@ -1369,7 +1369,7 @@
 			{
 				return retval;
 			}
-			
+
 			command_print(cmd_ctx, "%i: %8.8x", address, value);
 		}
 		else if (argc == 2)
@@ -1402,9 +1402,9 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
@@ -1424,7 +1424,7 @@
 				command_print(cmd_ctx, "couldn't execute %8.8x", opcode);
 				return ERROR_OK;
 			}
-			
+
 			command_print(cmd_ctx, "%8.8x: %8.8x", opcode, value);
 		}
 		else if (argc == 2)
@@ -1464,18 +1464,18 @@
 	arm7_9_common_t *arm7_9;
 	arm9tdmi_common_t *arm9tdmi;
 	arm920t_common_t *arm920t;
-	
+
 	if (arm920t_get_arch_pointers(target, &armv4_5, &arm7_9, &arm9tdmi, &arm920t) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_handle_cache_info_command(cmd_ctx, &arm920t->armv4_5_mmu.armv4_5_cache);
 }
 
 int arm920t_handle_virt2phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -1488,20 +1488,20 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-		
+
 	return armv4_5_mmu_handle_virt2phys_command(cmd_ctx, cmd, args, argc, target, &arm920t->armv4_5_mmu);
 }
 
 int arm920t_handle_md_phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -1514,20 +1514,20 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_mmu_handle_md_phys_command(cmd_ctx, cmd, args, argc, target, &arm920t->armv4_5_mmu);
 }
 
 int arm920t_handle_mw_phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
-{	
+{
 	target_t *target = get_current_target(cmd_ctx);
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -1540,14 +1540,14 @@
 		command_print(cmd_ctx, "current target isn't an ARM920t target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
 		return ERROR_OK;
 	}
-	
+
 	return armv4_5_mmu_handle_mw_phys_command(cmd_ctx, cmd, args, argc, target, &arm920t->armv4_5_mmu);
 }

Modified: branches/openocd_1_0_branch/src/target/arm926ejs.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm926ejs.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/arm926ejs.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -132,7 +132,7 @@
 
 	buf_set_u32(address_buf, 0, 14, address);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -222,7 +222,7 @@
 	buf_set_u32(address_buf, 0, 14, address);
 	buf_set_u32(value_buf, 0, 32, value);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -366,7 +366,7 @@
 		default:
 			LOG_ERROR("BUG: unknown debug reason: 0x%x", debug_reason);
 			target->debug_reason = DBG_REASON_DBGRQ;
-			/* if we fail here, we won't talk to the target and it will 
+			/* if we fail here, we won't talk to the target and it will
 			 * be reported to be in the halted state */
 			retval = ERROR_TARGET_FAILURE;
 			break;

Modified: branches/openocd_1_0_branch/src/target/arm966e.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm966e.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/arm966e.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -74,9 +74,9 @@
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
-	
+
 	.add_breakpoint = arm7_9_add_breakpoint,
 	.remove_breakpoint = arm7_9_remove_breakpoint,
 	.add_watchpoint = arm7_9_add_watchpoint,
@@ -92,13 +92,13 @@
 int arm966e_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
 	arm9tdmi_init_target(cmd_ctx, target);
-		
+
 	return ERROR_OK;
 }
 
 int arm966e_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -106,25 +106,25 @@
 {
 	arm9tdmi_common_t *arm9tdmi = &arm966e->arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm9tdmi->arm7_9_common;
-	
+
 	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
 
 	arm9tdmi->arch_info = arm966e;
 	arm966e->common_magic = ARM966E_COMMON_MAGIC;
-	
+
 	/* The ARM966E-S implements the ARMv5TE architecture which
 	 * has the BKPT instruction, so we don't have to use a watchpoint comparator
 	 */
 	arm7_9->arm_bkpt = ARMV5_BKPT(0x0);
 	arm7_9->thumb_bkpt = ARMV5_T_BKPT(0x0) & 0xffff;
-	
+
 	return ERROR_OK;
 }
 
 int arm966e_target_create( struct target_s *target, Jim_Interp *interp )
 {
 	arm966e_common_t *arm966e = calloc(1,sizeof(arm966e_common_t));
-	
+
 	arm966e_init_arch_info(target, arm966e, target->tap, target->variant);
 
 	return ERROR_OK;
@@ -136,35 +136,35 @@
 	arm7_9_common_t *arm7_9;
 	arm9tdmi_common_t *arm9tdmi;
 	arm966e_common_t *arm966e;
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7_9 = armv4_5->arch_info;
 	if (arm7_9->common_magic != ARM7_9_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm9tdmi = arm7_9->arch_info;
 	if (arm9tdmi->common_magic != ARM9TDMI_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm966e = arm9tdmi->arch_info;
 	if (arm966e->common_magic != ARM966E_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	*armv4_5_p = armv4_5;
 	*arm7_9_p = arm7_9;
 	*arm9tdmi_p = arm9tdmi;
 	*arm966e_p = arm966e;
-	
+
 	return ERROR_OK;
 }
 
@@ -177,8 +177,8 @@
 	scan_field_t fields[3];
 	u8 reg_addr_buf = reg_addr & 0x3f;
 	u8 nr_w_buf = 0;
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -214,7 +214,7 @@
 	fields[2].in_check_mask = NULL;
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(3, fields, -1);
 
 	fields[0].in_handler_priv = value;
@@ -243,10 +243,10 @@
 	u8 reg_addr_buf = reg_addr & 0x3f;
 	u8 nr_w_buf = 1;
 	u8 value_buf[4];
-	
+
 	buf_set_u32(value_buf, 0, 32, value);
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
@@ -282,7 +282,7 @@
 	fields[2].in_check_mask = NULL;
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(3, fields, -1);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
@@ -307,9 +307,9 @@
 		command_print(cmd_ctx, "current target isn't an ARM966e target");
 		return ERROR_OK;
 	}
-	
+
 	jtag_info = &arm7_9->jtag_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"%s\" command", cmd);
@@ -333,7 +333,7 @@
 			{
 				return retval;
 			}
-			
+
 			command_print(cmd_ctx, "%i: %8.8x", address, value);
 		}
 		else if (argc == 2)
@@ -355,10 +355,10 @@
 {
 	int retval;
 	command_t *arm966e_cmd;
-	
+
 	retval = arm9tdmi_register_commands(cmd_ctx);
 	arm966e_cmd = register_command(cmd_ctx, NULL, "arm966e", NULL, COMMAND_ANY, "arm966e specific commands");
 	register_command(cmd_ctx, arm966e_cmd, "cp15", arm966e_handle_cp15_command, COMMAND_EXEC, "display/modify cp15 register <num> [value]");
-	
+
 	return retval;
 }

Modified: branches/openocd_1_0_branch/src/target/arm9tdmi.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm9tdmi.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/arm9tdmi.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -56,7 +56,7 @@
 
 int arm9tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target);
 int arm9tdmi_quit(void);
-		
+
 target_type_t arm9tdmi_target =
 {
 	.name = "arm9tdmi",
@@ -81,9 +81,9 @@
 	.bulk_write_memory = arm7_9_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
-	
+
 	.add_breakpoint = arm7_9_add_breakpoint,
 	.remove_breakpoint = arm7_9_remove_breakpoint,
 	.add_watchpoint = arm7_9_add_watchpoint,
@@ -115,7 +115,7 @@
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	
+
 	/* only check the debug reason if we don't know it already */
 	if ((target->debug_reason != DBG_REASON_DBGRQ)
 			&& (target->debug_reason != DBG_REASON_SINGLESTEP))
@@ -125,7 +125,7 @@
 		u8 instructionbus[4];
 		u8 debug_reason;
 
-		jtag_add_end_state(TAP_PD);
+		jtag_add_end_state(TAP_DRPAUSE);
 
 		fields[0].tap = arm7_9->jtag_info.tap;
 		fields[0].num_bits = 32;
@@ -136,7 +136,7 @@
 		fields[0].in_check_mask = NULL;
 		fields[0].in_handler = NULL;
 		fields[0].in_handler_priv = NULL;
-		
+
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 3;
 		fields[1].out_value = NULL;
@@ -146,7 +146,7 @@
 		fields[1].in_check_mask = NULL;
 		fields[1].in_handler = NULL;
 		fields[1].in_handler_priv = NULL;
-		
+
 		fields[2].tap = arm7_9->jtag_info.tap;
 		fields[2].num_bits = 32;
 		fields[2].out_value = NULL;
@@ -156,28 +156,28 @@
 		fields[2].in_check_mask = NULL;
 		fields[2].in_handler = NULL;
 		fields[2].in_handler_priv = NULL;
-		
+
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
 			return retval;
 		}
 		arm_jtag_set_instr(&arm7_9->jtag_info, arm7_9->jtag_info.intest_instr, NULL);
 
-		jtag_add_dr_scan(3, fields, TAP_PD);
+		jtag_add_dr_scan(3, fields, TAP_DRPAUSE);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		fields[0].in_value = NULL;
 		fields[0].out_value = databus;
 		fields[1].in_value = NULL;
 		fields[1].out_value = &debug_reason;
 		fields[2].in_value = NULL;
 		fields[2].out_value = instructionbus;
-		
-		jtag_add_dr_scan(3, fields, TAP_PD);
 
+		jtag_add_dr_scan(3, fields, TAP_DRPAUSE);
+
 		if (debug_reason & 0x4)
 			if (debug_reason & 0x2)
 				target->debug_reason = DBG_REASON_WPTANDBKPT;
@@ -198,23 +198,23 @@
 	u8 out_buf[4];
 	u8 instr_buf[4];
 	u8 sysspeed_buf = 0x0;
-	
+
 	/* prepare buffer */
 	buf_set_u32(out_buf, 0, 32, out);
-	
+
 	buf_set_u32(instr_buf, 0, 32, flip_u32(instr, 32));
-	
+
 	if (sysspeed)
 		buf_set_u32(&sysspeed_buf, 2, 1, 1);
-	
-	jtag_add_end_state(TAP_PD);
+
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
@@ -232,7 +232,7 @@
 	}
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
-	
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
@@ -242,7 +242,7 @@
 	fields[1].in_check_mask = NULL;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
-		
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
@@ -256,14 +256,14 @@
 	jtag_add_dr_scan(3, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		if (in)
 		{
 			LOG_DEBUG("instr: 0x%8.8x, out: 0x%8.8x, in: 0x%8.8x", instr, out, *in);
@@ -282,14 +282,14 @@
 	int retval = ERROR_OK;;
 	scan_field_t fields[3];
 
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
@@ -299,7 +299,7 @@
 	fields[0].in_handler_priv = in;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
-	
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
@@ -319,18 +319,18 @@
 	fields[2].in_check_mask = NULL;
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(3, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		if (in)
 		{
 			LOG_DEBUG("in: 0x%8.8x", *in);
@@ -353,15 +353,15 @@
 {
 	int retval = ERROR_OK;
 	scan_field_t fields[3];
-	
-	jtag_add_end_state(TAP_PD);
+
+	jtag_add_end_state(TAP_DRPAUSE);
 	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
-	
+
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
@@ -382,7 +382,7 @@
 	fields[0].in_handler_priv = in;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
-	
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
@@ -402,18 +402,18 @@
 	fields[2].in_check_mask = NULL;
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
-	
+
 	jtag_add_dr_scan(3, fields, -1);
 
 	jtag_add_runtest(0, -1);
-	
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
-		
+
 		if (in)
 		{
 			LOG_DEBUG("in: 0x%8.8x", *(u32*)in);
@@ -435,10 +435,10 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
-	/* save r0 before using it and put system in ARM state 
+
+	/* save r0 before using it and put system in ARM state
 	 * to allow common handling of ARM and THUMB debugging */
-	
+
 	/* fetch STR r0, [r0] */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_STR(0, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
@@ -446,7 +446,7 @@
 	/* STR r0, [r0] in Memory */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, r0, 0);
 
-	/* MOV r0, r15 fetched, STR in Decode */	
+	/* MOV r0, r15 fetched, STR in Decode */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_MOV(0, 15), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_STR(0, 0), 0, NULL, 0);
@@ -470,12 +470,12 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	/* NOP fetched, BX in Execute (1) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
-	
+
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return;
 	}
-	
+
 	/* fix program counter:
 	 * MOV r0, r15 was the 5th instruction (+8)
 	 * reading PC in Thumb state gives address of instruction + 4
@@ -490,7 +490,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* STMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -521,7 +521,7 @@
 	u32 *buf_u32 = buffer;
 	u16 *buf_u16 = buffer;
 	u8 *buf_u8 = buffer;
-	
+
 	/* STMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -558,7 +558,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* MRS r0, cpsr */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_MRS(0, spsr & 1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -583,7 +583,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr: %8.8x, spsr: %i", xpsr, spsr);
 
 	/* MSR1 fetched */
@@ -619,16 +619,16 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr_im: %2.2x, rot: %i, spsr: %i", xpsr_im, rot, spsr);
-	
+
 	/* MSR fetched */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_MSR_IM(xpsr_im, rot, 1, spsr), 0, NULL, 0);
 	/* NOP fetched, MSR in DECODE */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	/* NOP fetched, MSR in EXECUTE (1) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-	
+
 	/* rot == 4 writes flags, which takes only one cycle */
 	if (rot != 4)
 	{
@@ -646,7 +646,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	/* LDMIA r0-15, [r0] at debug speed
 	* register values will start to appear on 4th DCLK
 	*/
@@ -664,7 +664,7 @@
 			arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, core_regs[i], NULL, 0);
 	}
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-	
+
 }
 
 void arm9tdmi_load_word_regs(target_t *target, u32 mask)
@@ -686,7 +686,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/* put system-speed load half-word into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_LDRH_IP(num, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
@@ -750,7 +750,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/* LDMIA r0-15, [r0] at debug speed
 	 * register values will start to appear on 4th DCLK
 	 */
@@ -777,7 +777,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_B(0xfffffc, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
 
@@ -786,7 +786,7 @@
 void arm9tdmi_branch_resume_thumb(target_t *target)
 {
 	LOG_DEBUG("-");
-	
+
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
@@ -809,14 +809,14 @@
 
 	/* Branch and eXchange */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_BX(0), 0, NULL, 0);
-	
+
 	embeddedice_read_reg(dbg_stat);
-	
+
 	/* fetch NOP, BX in DECODE stage */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-	
+
 	embeddedice_read_reg(dbg_stat);
-	
+
 	/* fetch NOP, BX in EXECUTE stage (1st cycle) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 
@@ -833,12 +833,12 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, buf_get_u32(armv4_5->core_cache->reg_list[0].value, 0, 32), NULL, 0);
 	/* nothing fetched, LDR in EXECUTE stage (3rd cycle) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
-	
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 
 	embeddedice_read_reg(dbg_stat);
-	
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_B(0x7f7), 0, NULL, 1);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 
@@ -849,7 +849,7 @@
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	
+
 	if (arm7_9->has_single_step)
 	{
 		buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 3, 1, 1);
@@ -866,7 +866,7 @@
 	/* get pointers to arch-specific information */
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	
+
 	if (arm7_9->has_single_step)
 	{
 		buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 3, 1, 0);
@@ -905,7 +905,7 @@
 			return ERROR_FAIL;
 		(*cache_p) = t;
 		arm7_9->eice_cache = (*cache_p);
-	
+
 		if (arm7_9->etm_ctx)
 		{
 			arm_jtag_t *jtag_info = &arm7_9->jtag_info;
@@ -928,16 +928,16 @@
 
 int arm9tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
-	
+
 	arm9tdmi_build_reg_cache(target);
-	
+
 	return ERROR_OK;
-	
+
 }
 
 int arm9tdmi_quit(void)
 {
-	
+
 	return ERROR_OK;
 }
 
@@ -945,53 +945,53 @@
 {
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
-	
+
 	arm7_9 = &arm9tdmi->arm7_9_common;
 	armv4_5 = &arm7_9->armv4_5_common;
-	
+
 	/* prepare JTAG information for the new target */
 	arm7_9->jtag_info.tap = tap;
 	arm7_9->jtag_info.scann_size = 5;
-	
+
 	/* register arch-specific functions */
 	arm7_9->examine_debug_reason = arm9tdmi_examine_debug_reason;
 	arm7_9->change_to_arm = arm9tdmi_change_to_arm;
 	arm7_9->read_core_regs = arm9tdmi_read_core_regs;
 	arm7_9->read_core_regs_target_buffer = arm9tdmi_read_core_regs_target_buffer;
 	arm7_9->read_xpsr = arm9tdmi_read_xpsr;
-	
+
 	arm7_9->write_xpsr = arm9tdmi_write_xpsr;
 	arm7_9->write_xpsr_im8 = arm9tdmi_write_xpsr_im8;
 	arm7_9->write_core_regs = arm9tdmi_write_core_regs;
-	
+
 	arm7_9->load_word_regs = arm9tdmi_load_word_regs;
 	arm7_9->load_hword_reg = arm9tdmi_load_hword_reg;
 	arm7_9->load_byte_reg = arm9tdmi_load_byte_reg;
-	
+
 	arm7_9->store_word_regs = arm9tdmi_store_word_regs;
 	arm7_9->store_hword_reg = arm9tdmi_store_hword_reg;
 	arm7_9->store_byte_reg = arm9tdmi_store_byte_reg;
-	
+
 	arm7_9->write_pc = arm9tdmi_write_pc;
 	arm7_9->branch_resume = arm9tdmi_branch_resume;
 	arm7_9->branch_resume_thumb = arm9tdmi_branch_resume_thumb;
 
 	arm7_9->enable_single_step = arm9tdmi_enable_single_step;
 	arm7_9->disable_single_step = arm9tdmi_disable_single_step;
-	
+
 	arm7_9->pre_debug_entry = NULL;
 	arm7_9->post_debug_entry = NULL;
-	
+
 	arm7_9->pre_restore_context = NULL;
 	arm7_9->post_restore_context = NULL;
 
 	/* initialize arch-specific breakpoint handling */
 	arm7_9->arm_bkpt = 0xdeeedeee;
 	arm7_9->thumb_bkpt = 0xdeee;
-	
+
 	arm7_9->dbgreq_adjust_pc = 3;
 	arm7_9->arch_info = arm9tdmi;
-	
+
 	arm9tdmi->common_magic = ARM9TDMI_COMMON_MAGIC;
 	arm9tdmi->arch_info = NULL;
 
@@ -1003,7 +1003,7 @@
 	{
 		arm9tdmi->variant = strdup("");
 	}
-	
+
 	arm7_9_init_arch_info(target, arm7_9);
 
 	/* override use of DBGRQ, this is safe on ARM9TDMI */
@@ -1011,7 +1011,7 @@
 
 	/* all ARM9s have the vector catch register */
 	arm7_9->has_vector_catch = 1;
-	
+
 	return ERROR_OK;
 }
 
@@ -1020,28 +1020,28 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9;
 	arm9tdmi_common_t *arm9tdmi;
-	
+
 	if (armv4_5->common_magic != ARMV4_5_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm7_9 = armv4_5->arch_info;
 	if (arm7_9->common_magic != ARM7_9_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	arm9tdmi = arm7_9->arch_info;
 	if (arm9tdmi->common_magic != ARM9TDMI_COMMON_MAGIC)
 	{
 		return -1;
 	}
-	
+
 	*armv4_5_p = armv4_5;
 	*arm7_9_p = arm7_9;
 	*arm9tdmi_p = arm9tdmi;
-	
+
 	return ERROR_OK;
 }
 
@@ -1052,24 +1052,24 @@
 	arm9tdmi_common_t *arm9tdmi = calloc(1,sizeof(arm9tdmi_common_t));
 
 	arm9tdmi_init_arch_info(target, arm9tdmi, target->tap, target->variant);
-	
+
 	return ERROR_OK;
 }
 
 int arm9tdmi_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
-	
+
 	command_t *arm9tdmi_cmd;
-	
-		
+
+
 	retval = arm7_9_register_commands(cmd_ctx);
-	
+
 	arm9tdmi_cmd = register_command(cmd_ctx, NULL, "arm9tdmi", NULL, COMMAND_ANY, "arm9tdmi specific commands");
 
 	register_command(cmd_ctx, arm9tdmi_cmd, "vector_catch", handle_arm9tdmi_catch_vectors_command, COMMAND_EXEC, "catch arm920t vectors ['all'|'none'|'<vec1 vec2 ...>']");
-	
-	
+
+
 	return retval;
 
 }
@@ -1083,22 +1083,22 @@
 	reg_t *vector_catch;
 	u32 vector_catch_value;
 	int i, j;
-	
+
 	if (arm9tdmi_get_arch_pointers(target, &armv4_5, &arm7_9, &arm9tdmi) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM9TDMI based target");
 		return ERROR_OK;
 	}
-	
+
 	vector_catch = &arm7_9->eice_cache->reg_list[EICE_VEC_CATCH];
-	
+
 	/* read the vector catch register if necessary */
 	if (!vector_catch->valid)
 		embeddedice_read_reg(vector_catch);
-	
+
 	/* get the current setting */
 	vector_catch_value = buf_get_u32(vector_catch->value, 0, 32);
-	
+
 	if (argc > 0)
 	{
 		vector_catch_value = 0x0;
@@ -1123,25 +1123,25 @@
 						break;
 					}
 				}
-				
+
 				/* complain if vector wasn't found */
 				if (!arm9tdmi_vectors[j].name)
 				{
 					command_print(cmd_ctx, "vector '%s' not found, leaving current setting unchanged", args[i]);
-					
+
 					/* reread current setting */
 					vector_catch_value = buf_get_u32(vector_catch->value, 0, 32);
-					
+
 					break;
 				}
 			}
 		}
-		
+
 		/* store new settings */
 		buf_set_u32(vector_catch->value, 0, 32, vector_catch_value);
 		embeddedice_store_reg(vector_catch);
 	}
-		
+
 	/* output current settings (skip RESERVED vector) */
 	for (i = 0; i < 8; i++)
 	{
@@ -1149,7 +1149,7 @@
 		{
 			command_print(cmd_ctx, "%s: %s", arm9tdmi_vectors[i].name,
 				(vector_catch_value & (1 << i)) ? "catch" : "don't catch");
-		}  
+		}
 	}
 
 	return ERROR_OK;

Modified: branches/openocd_1_0_branch/src/target/board/hammer.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/board/hammer.cfg	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/board/hammer.cfg	2008-12-13 07:02:56 UTC (rev 1236)
@@ -1,7 +1,7 @@
 # Target Configuration for the TinCanTools S3C2410 Based Hammer Module
 # http://www.tincantools.com
 
-source [target/samsung_s3c2410.cfg]
+source [find target/samsung_s3c2410.cfg]
 
 $_TARGETNAME configure -event reset-init {
 	# Reset Script for the TinCanTools S3C2410 Based Hammer Module

Modified: branches/openocd_1_0_branch/src/target/cortex_m3.c
===================================================================
--- branches/openocd_1_0_branch/src/target/cortex_m3.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/cortex_m3.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -225,6 +225,7 @@
 
 	/* Enable FPB */
 	target_write_u32(target, FP_CTRL, 3);
+	cortex_m3->fpb_enabled = 1;
 
 	/* Restore FPB registers */
 	for (i = 0; i < cortex_m3->fp_num_code + cortex_m3->fp_num_lit; i++)
@@ -869,6 +870,11 @@
 		comparator_list[fp_num].fpcr_value = (breakpoint->address & 0x1FFFFFFC) | hilo | 1;
 		target_write_u32(target, comparator_list[fp_num].fpcr_address, comparator_list[fp_num].fpcr_value);
 		LOG_DEBUG("fpc_num %i fpcr_value 0x%x", fp_num, comparator_list[fp_num].fpcr_value);
+		if (!cortex_m3->fpb_enabled)
+		{
+			LOG_DEBUG("FPB wasn't enabled, do it now");
+			target_write_u32(target, FP_CTRL, 3);
+		}
 	}
 	else if (breakpoint->type == BKPT_SOFT)
 	{
@@ -1401,10 +1407,11 @@
 		/* Setup FPB */
 		target_read_u32(target, FP_CTRL, &fpcr);
 		cortex_m3->auto_bp_type = 1;
-		cortex_m3->fp_num_code = (fpcr >> 4) & 0xF;
+		cortex_m3->fp_num_code = (fpcr >> 8) & 0x70 | (fpcr >> 4) & 0xF; /* bits [14:12] and [7:4] */
 		cortex_m3->fp_num_lit = (fpcr >> 8) & 0xF;
 		cortex_m3->fp_code_available = cortex_m3->fp_num_code;
 		cortex_m3->fp_comparator_list = calloc(cortex_m3->fp_num_code + cortex_m3->fp_num_lit, sizeof(cortex_m3_fp_comparator_t));
+		cortex_m3->fpb_enabled = fpcr & 1;
 		for (i = 0; i < cortex_m3->fp_num_code + cortex_m3->fp_num_lit; i++)
 		{
 			cortex_m3->fp_comparator_list[i].type = (i < cortex_m3->fp_num_code) ? FPCR_CODE : FPCR_LITERAL;

Modified: branches/openocd_1_0_branch/src/target/cortex_m3.h
===================================================================
--- branches/openocd_1_0_branch/src/target/cortex_m3.h	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/cortex_m3.h	2008-12-13 07:02:56 UTC (rev 1236)
@@ -145,14 +145,15 @@
 	u32 nvic_dfsr;  /* Debug Fault Status Register - shows reason for debug halt */
 	u32 nvic_icsr;  /* Interrupt Control State Register - shows active and pending IRQ */
 	
-	/* Flash Patch and Breakpoint */
+	/* Flash Patch and Breakpoint (FPB) */
 	int fp_num_lit;
 	int fp_num_code;
 	int fp_code_available;
+	int fpb_enabled;
 	int auto_bp_type;
 	cortex_m3_fp_comparator_t *fp_comparator_list;
 	
-	/* DWT */
+	/* Data Watchpoint and Trace (DWT) */
 	int dwt_num_comp;
 	int dwt_comp_available;
 	cortex_m3_dwt_comparator_t *dwt_comparator_list;

Modified: branches/openocd_1_0_branch/src/target/cortex_swjdp.c
===================================================================
--- branches/openocd_1_0_branch/src/target/cortex_swjdp.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/cortex_swjdp.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -44,7 +44,7 @@
 /*
  * Transaction Mode:
  * swjdp->trans_mode = TRANS_MODE_COMPOSITE;
- * Uses Overrun checking mode and does not do actual JTAG send/receive or transaction 
+ * Uses Overrun checking mode and does not do actual JTAG send/receive or transaction
  * result checking until swjdp_end_transaction()
  * This must be done before using or deallocating any return variables.
  * swjdp->trans_mode == TRANS_MODE_ATOMIC
@@ -63,8 +63,8 @@
 {
 	scan_field_t fields[2];
 	u8 out_addr_buf;
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_set_instr(jtag_info, instr, NULL);
 
 	fields[0].tap = jtag_info->tap;
@@ -99,8 +99,8 @@
 	scan_field_t fields[2];
 	u8 out_value_buf[4];
 	u8 out_addr_buf;
-	
-	jtag_add_end_state(TAP_RTI);
+
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_set_instr(jtag_info, instr, NULL);
 
 	fields[0].tap = jtag_info->tap;
@@ -138,7 +138,7 @@
 	return ERROR_OK;
 }
 
-/* scan_inout_check adds one extra inscan for DPAP_READ commands to read variables */ 
+/* scan_inout_check adds one extra inscan for DPAP_READ commands to read variables */
 int scan_inout_check(swjdp_common_t *swjdp, u8 instr, u8 reg_addr, u8 RnW, u8 *outvalue, u8 *invalue)
 {
 	swjdp_scan(swjdp->jtag_info, instr, reg_addr, RnW, outvalue, NULL, NULL);
@@ -146,7 +146,7 @@
 	{
 		swjdp_scan(swjdp->jtag_info, SWJDP_IR_DPACC, DP_RDBUFF, DPAP_READ, 0, invalue, &swjdp->ack);
 	}
-	
+
 	/* In TRANS_MODE_ATOMIC all SWJDP_IR_APACC transactions wait for ack=OK/FAULT and the check CTRL_STAT */
 	if ((instr == SWJDP_IR_APACC) && (swjdp->trans_mode == TRANS_MODE_ATOMIC))
 	{
@@ -163,7 +163,7 @@
 	{
 		swjdp_scan_u32(swjdp->jtag_info, SWJDP_IR_DPACC, DP_RDBUFF, DPAP_READ, 0, invalue, &swjdp->ack);
 	}
-	
+
 	/* In TRANS_MODE_ATOMIC all SWJDP_IR_APACC transactions wait for ack=OK/FAULT and then check CTRL_STAT */
 	if ((instr == SWJDP_IR_APACC) && (swjdp->trans_mode == TRANS_MODE_ATOMIC))
 	{
@@ -179,10 +179,10 @@
 	u32 ctrlstat;
 
 	keep_alive();
-	
+
 	/* Danger!!!! BROKEN!!!! */
 	scan_inout_check_u32(swjdp, SWJDP_IR_DPACC, DP_CTRL_STAT, DPAP_READ, 0, &ctrlstat);
-	/* Danger!!!! BROKEN!!!! Why will jtag_execute_queue() fail here???? 
+	/* Danger!!!! BROKEN!!!! Why will jtag_execute_queue() fail here????
 	R956 introduced the check on return value here and now Michael Schwingen reports
 	that this code no longer works....
 
@@ -196,9 +196,9 @@
 	scan_inout_check_u32(swjdp, SWJDP_IR_DPACC, DP_CTRL_STAT, DPAP_READ, 0, &ctrlstat);
 	if ((retval=jtag_execute_queue())!=ERROR_OK)
 		return retval;
-	
+
 	swjdp->ack = swjdp->ack & 0x7;
-	
+
 	long long then=timeval_ms();
 	while (swjdp->ack != 2)
 	{
@@ -234,13 +234,13 @@
 		else
 		{
 			u32 dcb_dhcsr,nvic_shcsr, nvic_bfar, nvic_cfsr;
-			
+
 			if (ctrlstat & SSTICKYORUN)
 				LOG_ERROR("SWJ-DP OVERRUN - check clock or reduce jtag speed");
-			
+
 			if (ctrlstat & SSTICKYERR)
 				LOG_ERROR("SWJ-DP STICKY ERROR");
-			
+
 			/* Clear Sticky Error Bits */
 			scan_inout_check_u32(swjdp, SWJDP_IR_DPACC, DP_CTRL_STAT, DPAP_WRITE, swjdp->dp_ctrl_stat | SSTICKYORUN | SSTICKYERR, NULL);
 			scan_inout_check_u32(swjdp, SWJDP_IR_DPACC, DP_CTRL_STAT, DPAP_READ, 0, &ctrlstat);
@@ -248,8 +248,8 @@
 				return retval;
 
 			LOG_DEBUG("swjdp: status 0x%x", ctrlstat);
-			
-			/* Can we find out the reason for the error ?? */			
+
+			/* Can we find out the reason for the error ?? */
 			ahbap_read_system_atomic_u32(swjdp, DCB_DHCSR, &dcb_dhcsr);
 			ahbap_read_system_atomic_u32(swjdp, NVIC_SHCSR, &nvic_shcsr);
 			ahbap_read_system_atomic_u32(swjdp, NVIC_CFSR, &nvic_cfsr);
@@ -312,7 +312,7 @@
 int ahbap_write_reg_u32(swjdp_common_t *swjdp, u32 reg_addr, u32 value)
 {
 	u8 out_value_buf[4];
-	
+
 	buf_set_u32(out_value_buf, 0, 32, value);
 	swjdp_bankselect_apacc(swjdp, reg_addr);
 	scan_inout_check(swjdp, SWJDP_IR_APACC, reg_addr, DPAP_WRITE, out_value_buf, NULL);
@@ -350,7 +350,7 @@
 		swjdp->ap_tar_value = tar;
 	}
 	if (csw & CSW_ADDRINC_MASK)
-	{ 	
+	{
 		/* Do not cache TAR value when autoincrementing */
 		swjdp->ap_tar_value = -1;
 	}
@@ -371,14 +371,14 @@
 
 	ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_OFF, address & 0xFFFFFFF0);
 	ahbap_read_reg_u32(swjdp, AHBAP_BD0 | (address & 0xC), value );
-	
+
 	return ERROR_OK;
 }
 
 int ahbap_read_system_atomic_u32(swjdp_common_t *swjdp, u32 address, u32 *value)
 {
 	ahbap_read_system_u32(swjdp, address, value);
-	
+
 	return swjdp_transaction_endcheck(swjdp);
 }
 
@@ -402,7 +402,7 @@
 int ahbap_write_system_atomic_u32(swjdp_common_t *swjdp, u32 address, u32 value)
 {
 	ahbap_write_system_u32(swjdp, address, value);
-	
+
 	return swjdp_transaction_endcheck(swjdp);
 }
 
@@ -419,12 +419,12 @@
 	int wcount, blocksize, writecount, errorcount = 0, retval = ERROR_OK;
 	u32 adr = address;
 	u8* pBuffer = buffer;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	count >>= 2;
 	wcount = count;
-	
+
 	/* if we have an unaligned access - reorder data */
 	if (adr & 0x3u)
 	{
@@ -432,7 +432,7 @@
 		{
 			int i;
 			outvalue = *((u32*)pBuffer);
-			
+
 			for (i = 0; i < 4; i++ )
 			{
 				*((u8*)pBuffer + (adr & 0x3)) = outvalue;
@@ -442,25 +442,25 @@
 			pBuffer += 4;
 		}
 	}
-	
+
 	while (wcount > 0)
 	{
 		/* Adjust to write blocks within 4K aligned boundaries */
 		blocksize = (0x1000 - (0xFFF & address)) >> 2;
 		if (wcount < blocksize)
 			blocksize = wcount;
-		
+
 		/* handle unaligned data at 4k boundary */
 		if (blocksize == 0)
 			blocksize = 1;
-			
+
 		ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_SINGLE, address);
-		
+
 		for (writecount = 0; writecount < blocksize; writecount++)
 		{
 			ahbap_write_reg(swjdp, AHBAP_DRW, buffer + 4 * writecount );
 		}
-		
+
 		if (swjdp_transaction_endcheck(swjdp) == ERROR_OK)
 		{
 			wcount = wcount - blocksize;
@@ -471,14 +471,14 @@
 		{
 			errorcount++;
 		}
-		
+
 		if (errorcount > 1)
 		{
 			LOG_WARNING("Block write error address 0x%x, wcount 0x%x", address, wcount);
 			return ERROR_JTAG_DEVICE_ERROR;
 		}
 	}
-	
+
 	return retval;
 }
 
@@ -487,32 +487,32 @@
 	u32 outvalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, writecount, i;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-		
+
 	wcount = count >> 1;
-	
+
 	while (wcount > 0)
 	{
 		int nbytes;
-		
+
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address)) >> 1;
-		
+
 		if (wcount < blocksize)
 			blocksize = wcount;
-		
+
 		/* handle unaligned data at 4k boundary */
 		if (blocksize == 0)
 			blocksize = 1;
-		
+
 		ahbap_setup_accessport(swjdp, CSW_16BIT | CSW_ADDRINC_PACKED, address);
 		writecount = blocksize;
-		
+
 		do
 		{
 			nbytes = MIN((writecount << 1), 4);
-			
+
 			if (nbytes < 4 )
 			{
 				if (ahbap_write_buf_u16(swjdp, buffer, nbytes, address) != ERROR_OK)
@@ -520,20 +520,20 @@
 					LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 					return ERROR_JTAG_DEVICE_ERROR;
 				}
-				
+
 				address += nbytes >> 1;
 			}
 			else
 			{
 				outvalue = *((u32*)buffer);
-				
+
 				for (i = 0; i < nbytes; i++ )
 				{
 					*((u8*)buffer + (address & 0x3)) = outvalue;
 					outvalue >>= 8;
 					address++;
 				}
-				
+
 				outvalue = *((u32*)buffer);
 				ahbap_write_reg_u32(swjdp, AHBAP_DRW, outvalue);
 				if (swjdp_transaction_endcheck(swjdp) != ERROR_OK)
@@ -542,14 +542,14 @@
 					return ERROR_JTAG_DEVICE_ERROR;
 				}
 			}
-			
+
 			buffer += nbytes >> 1;
 			writecount -= nbytes >> 1;
-			
+
 		} while (writecount);
 		wcount -= blocksize;
 	}
-	
+
 	return retval;
 }
 
@@ -557,12 +557,12 @@
 {
 	u32 outvalue;
 	int retval = ERROR_OK;
-	
+
 	if (count >= 4)
 		return ahbap_write_buf_packed_u16(swjdp, buffer, count, address);
-		
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	while (count > 0)
 	{
 		ahbap_setup_accessport(swjdp, CSW_16BIT | CSW_ADDRINC_SINGLE, address);
@@ -582,28 +582,28 @@
 	u32 outvalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, writecount, i;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	wcount = count;
-	
+
 	while (wcount > 0)
 	{
 		int nbytes;
-		
+
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address));
-		
+
 		if (wcount < blocksize)
 			blocksize = wcount;
-				
+
 		ahbap_setup_accessport(swjdp, CSW_8BIT | CSW_ADDRINC_PACKED, address);
 		writecount = blocksize;
-		
+
 		do
 		{
 			nbytes = MIN(writecount, 4);
-			
+
 			if (nbytes < 4 )
 			{
 				if (ahbap_write_buf_u8(swjdp, buffer, nbytes, address) != ERROR_OK)
@@ -611,20 +611,20 @@
 					LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 					return ERROR_JTAG_DEVICE_ERROR;
 				}
-				
+
 				address += nbytes;
 			}
 			else
 			{
 				outvalue = *((u32*)buffer);
-				
+
 				for (i = 0; i < nbytes; i++ )
 				{
 					*((u8*)buffer + (address & 0x3)) = outvalue;
 					outvalue >>= 8;
 					address++;
 				}
-				
+
 				outvalue = *((u32*)buffer);
 				ahbap_write_reg_u32(swjdp, AHBAP_DRW, outvalue);
 				if (swjdp_transaction_endcheck(swjdp) != ERROR_OK)
@@ -633,14 +633,14 @@
 					return ERROR_JTAG_DEVICE_ERROR;
 				}
 			}
-			
+
 			buffer += nbytes;
 			writecount -= nbytes;
-			
+
 		} while (writecount);
 		wcount -= blocksize;
 	}
-	
+
 	return retval;
 }
 
@@ -648,12 +648,12 @@
 {
 	u32 outvalue;
 	int retval = ERROR_OK;
-	
+
 	if (count >= 4)
 		return ahbap_write_buf_packed_u8(swjdp, buffer, count, address);
-		
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	while (count > 0)
 	{
 		ahbap_setup_accessport(swjdp, CSW_8BIT | CSW_ADDRINC_SINGLE, address);
@@ -664,7 +664,7 @@
 		address++;
 		buffer++;
 	}
-	
+
 	return retval;
 }
 
@@ -680,25 +680,25 @@
 	int wcount, blocksize, readcount, errorcount = 0, retval = ERROR_OK;
 	u32 adr = address;
 	u8* pBuffer = buffer;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	count >>= 2;
 	wcount = count;
-	
+
 	while (wcount > 0)
 	{
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address)) >> 2;
 		if (wcount < blocksize)
 			blocksize = wcount;
-		
+
 		/* handle unaligned data at 4k boundary */
 		if (blocksize == 0)
 			blocksize = 1;
-		
+
 		ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_SINGLE, address);
-		
+
 		/* Scan out first read */
 		swjdp_scan(swjdp->jtag_info, SWJDP_IR_APACC, AHBAP_DRW, DPAP_READ, 0, NULL, NULL);
 		for (readcount = 0; readcount < blocksize - 1; readcount++)
@@ -706,27 +706,27 @@
 			/* Scan out read instruction and scan in previous value */
 			swjdp_scan(swjdp->jtag_info, SWJDP_IR_APACC, AHBAP_DRW, DPAP_READ, 0, buffer + 4 * readcount, &swjdp->ack);
 		}
-		
+
 		/* Scan in last value */
 		swjdp_scan(swjdp->jtag_info, SWJDP_IR_DPACC, DP_RDBUFF, DPAP_READ, 0, buffer + 4 * readcount, &swjdp->ack);
 		if (swjdp_transaction_endcheck(swjdp) == ERROR_OK)
 		{
 			wcount = wcount - blocksize;
 			address += 4 * blocksize;
-			buffer += 4 * blocksize; 
+			buffer += 4 * blocksize;
 		}
 		else
 		{
 			errorcount++;
 		}
-		
+
 		if (errorcount > 1)
 		{
 			LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 			return ERROR_JTAG_DEVICE_ERROR;
 		}
 	}
-	
+
 	/* if we have an unaligned access - reorder data */
 	if (adr & 0x3u)
 	{
@@ -734,7 +734,7 @@
 		{
 			int i;
 			u32 data = *((u32*)pBuffer);
-			
+
 			for (i = 0; i < 4; i++ )
 			{
 				*((u8*)pBuffer) = (data >> 8 * (adr & 0x3));
@@ -743,7 +743,7 @@
 			}
 		}
 	}
-	
+
 	return retval;
 }
 
@@ -752,27 +752,27 @@
 	u32 invalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, readcount, i;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	wcount = count >> 1;
-	
+
 	while (wcount > 0)
 	{
 		int nbytes;
-		
+
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address)) >> 1;
 		if (wcount < blocksize)
 			blocksize = wcount;
-				
+
 		ahbap_setup_accessport(swjdp, CSW_16BIT | CSW_ADDRINC_PACKED, address);
-		
+
 		/* handle unaligned data at 4k boundary */
 		if (blocksize == 0)
 			blocksize = 1;
 		readcount = blocksize;
-		
+
 		do
 		{
 			ahbap_read_reg_u32(swjdp, AHBAP_DRW, &invalue );
@@ -781,21 +781,21 @@
 				LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 				return ERROR_JTAG_DEVICE_ERROR;
 			}
-			
+
 			nbytes = MIN((readcount << 1), 4);
-			
+
 			for (i = 0; i < nbytes; i++ )
 			{
 				*((u8*)buffer) = (invalue >> 8 * (address & 0x3));
 				buffer++;
 				address++;
 			}
-			
+
 			readcount -= (nbytes >> 1);
 		} while (readcount);
 		wcount -= blocksize;
 	}
-	
+
 	return retval;
 }
 
@@ -803,12 +803,12 @@
 {
 	u32 invalue, i;
 	int retval = ERROR_OK;
-	
+
 	if (count >= 4)
 		return ahbap_read_buf_packed_u16(swjdp, buffer, count, address);
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	while (count > 0)
 	{
 		ahbap_setup_accessport(swjdp, CSW_16BIT | CSW_ADDRINC_SINGLE, address);
@@ -840,24 +840,24 @@
 	u32 invalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, readcount, i;
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	wcount = count;
-	
+
 	while (wcount > 0)
 	{
 		int nbytes;
-		
+
 		/* Adjust to read within 4K block boundaries */
 		blocksize = (0x1000 - (0xFFF & address));
-		
+
 		if (wcount < blocksize)
 			blocksize = wcount;
-				
+
 		ahbap_setup_accessport(swjdp, CSW_8BIT | CSW_ADDRINC_PACKED, address);
 		readcount = blocksize;
-		
+
 		do
 		{
 			ahbap_read_reg_u32(swjdp, AHBAP_DRW, &invalue );
@@ -866,21 +866,21 @@
 				LOG_WARNING("Block read error address 0x%x, count 0x%x", address, count);
 				return ERROR_JTAG_DEVICE_ERROR;
 			}
-			
+
 			nbytes = MIN(readcount, 4);
-			
+
 			for (i = 0; i < nbytes; i++ )
 			{
 				*((u8*)buffer) = (invalue >> 8 * (address & 0x3));
 				buffer++;
 				address++;
 			}
-			
+
 			readcount -= nbytes;
 		} while (readcount);
 		wcount -= blocksize;
 	}
-	
+
 	return retval;
 }
 
@@ -888,12 +888,12 @@
 {
 	u32 invalue;
 	int retval = ERROR_OK;
-	
+
 	if (count >= 4)
 		return ahbap_read_buf_packed_u8(swjdp, buffer, count, address);
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	while (count > 0)
 	{
 		ahbap_setup_accessport(swjdp, CSW_8BIT | CSW_ADDRINC_SINGLE, address);
@@ -912,12 +912,12 @@
 {
 	int retval;
 	u32 dcrdr;
-	
+
 	/* because the DCB_DCRDR is used for the emulated dcc channel
 	 * we gave to save/restore the DCB_DCRDR when used */
-	
+
 	ahbap_read_system_atomic_u32(swjdp, DCB_DCRDR, &dcrdr);
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
 
 	/* ahbap_write_system_u32(swjdp, DCB_DCRSR, regnum); */
@@ -927,7 +927,7 @@
 	/* ahbap_read_system_u32(swjdp, DCB_DCRDR, value); */
 	ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_OFF, DCB_DCRDR & 0xFFFFFFF0);
 	ahbap_read_reg_u32(swjdp, AHBAP_BD0 | (DCB_DCRDR & 0xC), value );
-	
+
 	retval = swjdp_transaction_endcheck(swjdp);
 	ahbap_write_system_atomic_u32(swjdp, DCB_DCRDR, dcrdr);
 	return retval;
@@ -937,14 +937,14 @@
 {
 	int retval;
 	u32 dcrdr;
-	
+
 	/* because the DCB_DCRDR is used for the emulated dcc channel
 	 * we gave to save/restore the DCB_DCRDR when used */
-	 
+
 	ahbap_read_system_atomic_u32(swjdp, DCB_DCRDR, &dcrdr);
-	
+
 	swjdp->trans_mode = TRANS_MODE_COMPOSITE;
-	
+
 	/* ahbap_write_system_u32(swjdp, DCB_DCRDR, core_regs[i]); */
 	ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_OFF, DCB_DCRDR & 0xFFFFFFF0);
 	ahbap_write_reg_u32(swjdp, AHBAP_BD0 | (DCB_DCRDR & 0xC), value );
@@ -952,7 +952,7 @@
 	/* ahbap_write_system_u32(swjdp, DCB_DCRSR, i | DCRSR_WnR	); */
 	ahbap_setup_accessport(swjdp, CSW_32BIT | CSW_ADDRINC_OFF, DCB_DCRSR & 0xFFFFFFF0);
 	ahbap_write_reg_u32(swjdp, AHBAP_BD0 | (DCB_DCRSR & 0xC), regnum | DCRSR_WnR );
-	
+
 	retval = swjdp_transaction_endcheck(swjdp);
 	ahbap_write_system_atomic_u32(swjdp, DCB_DCRDR, dcrdr);
 	return retval;
@@ -964,16 +964,16 @@
 	u32 ctrlstat;
 	int cnt = 0;
 	int retval;
-	
+
 	LOG_DEBUG(" ");
-	
+
 	swjdp->ap_csw_value = -1;
 	swjdp->ap_tar_value = -1;
 	swjdp->trans_mode = TRANS_MODE_ATOMIC;
 	swjdp_read_dpacc(swjdp, &dummy, DP_CTRL_STAT);
 	swjdp_write_dpacc(swjdp, SSTICKYERR, DP_CTRL_STAT);
 	swjdp_read_dpacc(swjdp, &dummy, DP_CTRL_STAT);
-	
+
 	swjdp->dp_ctrl_stat = CDBGPWRUPREQ | CSYSPWRUPREQ;
 
 	swjdp_write_dpacc(swjdp, swjdp->dp_ctrl_stat, DP_CTRL_STAT);
@@ -1005,11 +1005,11 @@
 	swjdp->dp_ctrl_stat = CDBGPWRUPREQ | CSYSPWRUPREQ | CORUNDETECT;
 	swjdp_write_dpacc(swjdp, swjdp->dp_ctrl_stat, DP_CTRL_STAT);
 	swjdp_read_dpacc(swjdp, &dummy, DP_CTRL_STAT);
-	
+
 	ahbap_read_reg_u32(swjdp, 0xFC, &idreg);
 	ahbap_read_reg_u32(swjdp, 0xF8, &romaddr);
-	
+
 	LOG_DEBUG("AHB-AP ID Register 0x%x, Debug ROM Address 0x%x", idreg, romaddr);
-	
+
 	return ERROR_OK;
 }

Modified: branches/openocd_1_0_branch/src/target/embeddedice.c
===================================================================
--- branches/openocd_1_0_branch/src/target/embeddedice.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/embeddedice.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -246,7 +246,7 @@
 	u8 field1_out[1];
 	u8 field2_out[1];
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(ice_reg->jtag_info, 0x2);
 
 	arm_jtag_set_instr(ice_reg->jtag_info, ice_reg->jtag_info->intest_instr, NULL);
@@ -309,7 +309,7 @@
 	u8 field1_out[1];
 	u8 field2_out[1];
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0x2);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 
@@ -400,7 +400,7 @@
 
 	LOG_DEBUG("%i: 0x%8.8x", ice_reg->addr, value);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(ice_reg->jtag_info, 0x2);
 
 	arm_jtag_set_instr(ice_reg->jtag_info, ice_reg->jtag_info->intest_instr, NULL);
@@ -426,7 +426,7 @@
 	u8 field1_out[1];
 	u8 field2_out[1];
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0x2);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 
@@ -495,7 +495,7 @@
 	else
 		return ERROR_INVALID_ARGUMENTS;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(jtag_info, 0x2);
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
 

Modified: branches/openocd_1_0_branch/src/target/etb.c
===================================================================
--- branches/openocd_1_0_branch/src/target/etb.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/etb.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -184,7 +184,7 @@
 	scan_field_t fields[3];
 	int i;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	etb_scann(etb, 0x0);
 	etb_set_instr(etb, 0xc);
 
@@ -255,7 +255,7 @@
 
 	LOG_DEBUG("%i", etb_reg->addr);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	etb_scann(etb_reg->etb, 0x0);
 	etb_set_instr(etb_reg->etb, 0xc);
 
@@ -351,7 +351,7 @@
 
 	LOG_DEBUG("%i: 0x%8.8x", etb_reg->addr, value);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	etb_scann(etb_reg->etb, 0x0);
 	etb_set_instr(etb_reg->etb, 0xc);
 

Modified: branches/openocd_1_0_branch/src/target/etm.c
===================================================================
--- branches/openocd_1_0_branch/src/target/etm.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/etm.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -335,7 +335,7 @@
 
 	LOG_DEBUG("%i", etm_reg->addr);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(etm_reg->jtag_info, 0x6);
 	arm_jtag_set_instr(etm_reg->jtag_info, etm_reg->jtag_info->intest_instr, NULL);
 
@@ -426,7 +426,7 @@
 
 	LOG_DEBUG("%i: 0x%8.8x", etm_reg->addr, value);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	arm_jtag_scann(etm_reg->jtag_info, 0x6);
 	arm_jtag_set_instr(etm_reg->jtag_info, etm_reg->jtag_info->intest_instr, NULL);
 

Modified: branches/openocd_1_0_branch/src/target/feroceon.c
===================================================================
--- branches/openocd_1_0_branch/src/target/feroceon.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/feroceon.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -91,7 +91,7 @@
 	.assert_reset = feroceon_assert_reset,
 	.deassert_reset = arm7_9_deassert_reset,
 	.soft_reset_halt = arm926ejs_soft_reset_halt,
-	
+
 	.get_gdb_reg_list = armv4_5_get_gdb_reg_list,
 
 	.read_memory = arm7_9_read_memory,
@@ -99,7 +99,7 @@
 	.bulk_write_memory = feroceon_bulk_write_memory,
 	.checksum_memory = arm7_9_checksum_memory,
 	.blank_check_memory = arm7_9_blank_check_memory,
-	
+
 	.run_algorithm = armv4_5_run_algorithm,
 
 	.add_breakpoint = arm7_9_add_breakpoint,
@@ -121,17 +121,17 @@
 	u8 out_buf[4];
 	u8 instr_buf[4];
 	u8 sysspeed_buf = 0x0;
-	
+
 	/* prepare buffer */
 	buf_set_u32(out_buf, 0, 32, 0);
-	
+
 	buf_set_u32(instr_buf, 0, 32, flip_u32(instr, 32));
-	
-	jtag_add_end_state(TAP_PD);
+
+	jtag_add_end_state(TAP_DRPAUSE);
 	arm_jtag_scann(jtag_info, 0x1);
-	
+
 	arm_jtag_set_instr(jtag_info, jtag_info->intest_instr, NULL);
-		
+
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
@@ -141,7 +141,7 @@
 	fields[0].in_handler_priv = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
-	
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
@@ -151,7 +151,7 @@
 	fields[1].in_check_mask = NULL;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
-		
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
@@ -165,7 +165,7 @@
 	jtag_add_dr_scan(3, fields, -1);
 
 	/* no jtag_add_runtest(0, -1) here */
-	
+
 	return ERROR_OK;
 }
 
@@ -174,9 +174,9 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-	
+
 	/*
-	 * save r0 before using it and put system in ARM state 
+	 * save r0 before using it and put system in ARM state
 	 * to allow common handling of ARM and THUMB debugging
 	 */
 
@@ -221,7 +221,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_STMIA(0, mask & 0xffff, 0, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -276,7 +276,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_MRS(0, spsr & 1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -299,7 +299,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	LOG_DEBUG("xpsr: %8.8x, spsr: %i", xpsr, spsr);
 
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_MSR_IM(xpsr & 0xff, 0, 1, spsr), 0, NULL, 0);
@@ -358,7 +358,7 @@
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
-		
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_LDMIA(0, mask & 0xffff, 0, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -390,13 +390,13 @@
 void feroceon_branch_resume_thumb(target_t *target)
 {
 	LOG_DEBUG("-");
-	
+
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
 	u32 r0 = buf_get_u32(armv4_5->core_cache->reg_list[0].value, 0, 32);
 	u32 pc = buf_get_u32(armv4_5->core_cache->reg_list[15].value, 0, 32);
-	(void)(r0); // use R0... 
+	(void)(r0); // use R0...
 
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
@@ -411,7 +411,7 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_LDMIA(0, 0x1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
- 
+
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, pc, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
@@ -523,7 +523,7 @@
 	 * We can't use the dcc flow control bits, so let's transfer data
 	 * with 31 bits and flip the MSB each time a new data word is sent.
 	 */
-	static u32 dcc_code[] = 
+	static u32 dcc_code[] =
 	{
 		0xee115e10,	/* 3:	mrc	p14, 0, r5, c1, c0, 0	*/
 		0xe3a0301e,	/* 1:	mov	r3, #30			*/
@@ -586,7 +586,7 @@
 	armv4_5->core_cache->reg_list[0].dirty = 1;
 	armv4_5->core_state = ARMV4_5_STATE_ARM;
 
-	embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], 0); 
+	embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], 0);
 	arm7_9_resume(target, 0, arm7_9->dcc_working_area->address, 1, 1);
 
 	/* send data over */
@@ -597,12 +597,12 @@
 	{
 		u32 y = target_buffer_get_u32(target, buffer);
 		u32 z = (x >> 1) | (y >> shift) | (flip ^= 0x80000000);
-		embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], z); 
+		embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], z);
 		x = y << (32 - shift);
 		if (++shift >= 32 || i + 1 >= count)
 		{
 			z = (x >> 1) | (flip ^= 0x80000000);
-			embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], z); 
+			embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], z);
 			x = 0;
 			shift = 1;
 		}
@@ -644,7 +644,7 @@
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
 	arm926ejs_common_t *arm926ejs = calloc(1,sizeof(arm926ejs_common_t));
-  
+
 	arm926ejs_init_arch_info(target, arm926ejs, target->tap, target->variant);
 
 	armv4_5 = target->arch_info;
@@ -678,8 +678,8 @@
 	arm7_9->set_special_dbgrq = feroceon_set_dbgrq;
 
 	/* only one working comparator */
-	arm7_9->wp_available_max = 1; 
-	arm7_9->wp1_used_default = -1; 
+	arm7_9->wp_available_max = 1;
+	arm7_9->wp1_used_default = -1;
 
 	return ERROR_OK;
 }
@@ -694,27 +694,27 @@
 	retval = arm9tdmi_examine(target);
 	if (retval!=ERROR_OK)
 		return retval;
-			
+
 	armv4_5 = target->arch_info;
 	arm7_9 = armv4_5->arch_info;
-	
+
 	/* the COMMS_CTRL bits are all contiguous */
 	if (buf_get_u32(arm7_9->eice_cache->reg_list[EICE_COMMS_CTRL].value, 2, 4) != 6)
 		LOG_ERROR("unexpected Feroceon EICE version signature");
-	
-	arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].size = 6; 
-	arm7_9->eice_cache->reg_list[EICE_DBG_STAT].size = 5; 
+
+	arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].size = 6;
+	arm7_9->eice_cache->reg_list[EICE_DBG_STAT].size = 5;
 	arm7_9->has_monitor_mode = 1;
-	
+
 	/* vector catch reg is not initialized on reset */
 	embeddedice_set_reg(&arm7_9->eice_cache->reg_list[EICE_VEC_CATCH], 0);
-	
+
 	/* clear monitor mode, enable comparators */
 	embeddedice_read_reg(&arm7_9->eice_cache->reg_list[EICE_DBG_CTRL]);
-	jtag_execute_queue(); 
+	jtag_execute_queue();
 	buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 4, 1, 0);
-	buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 5, 1, 0); 
+	buf_set_u32(arm7_9->eice_cache->reg_list[EICE_DBG_CTRL].value, 5, 1, 0);
 	embeddedice_store_reg(&arm7_9->eice_cache->reg_list[EICE_DBG_CTRL]);
-	
+
 	return ERROR_OK;
 }

Modified: branches/openocd_1_0_branch/src/target/mips_ejtag.c
===================================================================
--- branches/openocd_1_0_branch/src/target/mips_ejtag.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/mips_ejtag.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -65,7 +65,7 @@
 {
 	scan_field_t field;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	mips_ejtag_set_instr(ejtag_info, EJTAG_INST_IDCODE, NULL);
 
@@ -92,7 +92,7 @@
 {
 	scan_field_t field;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	mips_ejtag_set_instr(ejtag_info, EJTAG_INST_IMPCODE, NULL);
 
@@ -202,7 +202,7 @@
 int mips_ejtag_enter_debug(mips_ejtag_t *ejtag_info)
 {
 	u32 ejtag_ctrl;
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	mips_ejtag_set_instr(ejtag_info, EJTAG_INST_CONTROL, NULL);
 
 	/* set debug break bit */

Modified: branches/openocd_1_0_branch/src/target/mips_m4k.c
===================================================================
--- branches/openocd_1_0_branch/src/target/mips_m4k.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/mips_m4k.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -67,7 +67,7 @@
 	.assert_reset = mips_m4k_assert_reset,
 	.deassert_reset = mips_m4k_deassert_reset,
 	.soft_reset_halt = mips_m4k_soft_reset_halt,
-	
+
 	.get_gdb_reg_list = mips32_get_gdb_reg_list,
 
 	.read_memory = mips_m4k_read_memory,
@@ -75,7 +75,7 @@
 	.bulk_write_memory = mips_m4k_bulk_write_memory,
 	.checksum_memory = NULL,
 	.blank_check_memory = NULL,
-	
+
 	.run_algorithm = mips32_run_algorithm,
 
 	.add_breakpoint = mips_m4k_add_breakpoint,
@@ -91,10 +91,10 @@
 };
 
 int mips_m4k_examine_debug_reason(target_t *target)
-{	
+{
 	int break_status;
 	int retval;
-	
+
 	if ((target->debug_reason != DBG_REASON_DBGRQ)
 		&& (target->debug_reason != DBG_REASON_SINGLESTEP))
 	{
@@ -108,7 +108,7 @@
 				return retval;
 			target->debug_reason = DBG_REASON_BREAKPOINT;
 		}
-		
+
 		/* get info about data breakpoint support */
 		if ((retval = target_read_u32(target, 0xFF302000, &break_status)) != ERROR_OK)
 			return retval;
@@ -120,7 +120,7 @@
 			target->debug_reason = DBG_REASON_WATCHPOINT;
 		}
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -129,29 +129,29 @@
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	u32 debug_reg;
-	
+
 	/* read debug register */
 	mips_ejtag_read_debug(ejtag_info, &debug_reg);
-	
+
 	/* make sure break uit configured */
 	mips32_configure_break_unit(target);
-	
+
 	/* attempt to find halt reason */
 	mips_m4k_examine_debug_reason(target);
-	
+
 	/* clear single step if active */
 	if (debug_reg & EJTAG_DEBUG_DSS)
 	{
 		/* stopped due to single step - clear step bit */
 		mips_ejtag_config_step(ejtag_info, 0);
 	}
-	
+
 	mips32_save_context(target);
-	
-	LOG_DEBUG("entered debug state at PC 0x%x, target->state: %s", 
-		*(u32*)(mips32->core_cache->reg_list[MIPS32_PC].value), 
+
+	LOG_DEBUG("entered debug state at PC 0x%x, target->state: %s",
+		*(u32*)(mips32->core_cache->reg_list[MIPS32_PC].value),
 		  Jim_Nvp_value2name_simple( nvp_target_state, target->state )->name);
-	
+
 	return ERROR_OK;
 }
 
@@ -161,48 +161,48 @@
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	u32 ejtag_ctrl = ejtag_info->ejtag_ctrl;
-	
+
 	/* read ejtag control reg */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	mips_ejtag_set_instr(ejtag_info, EJTAG_INST_CONTROL, NULL);
 	mips_ejtag_drscan_32(ejtag_info, &ejtag_ctrl);
-	
+
 	/* clear this bit before handling polling
 	 * as after reset registers will read zero */
 	if (ejtag_ctrl & EJTAG_CTRL_ROCC)
 	{
 		/* we have detected a reset, clear flag
 		 * otherwise ejtag will not work */
-		jtag_add_end_state(TAP_RTI);
+		jtag_add_end_state(TAP_IDLE);
 		ejtag_ctrl = ejtag_info->ejtag_ctrl & ~EJTAG_CTRL_ROCC;
-		
+
 		mips_ejtag_set_instr(ejtag_info, EJTAG_INST_CONTROL, NULL);
 		mips_ejtag_drscan_32(ejtag_info, &ejtag_ctrl);
 		LOG_DEBUG("Reset Detected");
 	}
-	
+
 	/* check for processor halted */
 	if (ejtag_ctrl & EJTAG_CTRL_BRKST)
 	{
 		if ((target->state == TARGET_RUNNING) || (target->state == TARGET_RESET))
 		{
-			jtag_add_end_state(TAP_RTI);
+			jtag_add_end_state(TAP_IDLE);
 			mips_ejtag_set_instr(ejtag_info, EJTAG_INST_NORMALBOOT, NULL);
-			
+
 			target->state = TARGET_HALTED;
-			
+
 			if ((retval = mips_m4k_debug_entry(target)) != ERROR_OK)
 				return retval;
-			
+
 			target_call_event_callbacks(target, TARGET_EVENT_HALTED);
 		}
 		else if (target->state == TARGET_DEBUG_RUNNING)
 		{
 			target->state = TARGET_HALTED;
-			
+
 			if ((retval = mips_m4k_debug_entry(target)) != ERROR_OK)
 				return retval;
-			
+
 			target_call_event_callbacks(target, TARGET_EVENT_DEBUG_HALTED);
 		}
 	}
@@ -210,9 +210,9 @@
 	{
 		target->state = TARGET_RUNNING;
 	}
-	
+
 //	LOG_DEBUG("ctrl=0x%08X", ejtag_ctrl);
-	
+
 	return ERROR_OK;
 }
 
@@ -220,22 +220,22 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
-	
-	LOG_DEBUG("target->state: %s", 
+
+	LOG_DEBUG("target->state: %s",
 		  Jim_Nvp_value2name_simple( nvp_target_state, target->state )->name);
-	
+
 	if (target->state == TARGET_HALTED)
 	{
 		LOG_DEBUG("target was already halted");
 		return ERROR_OK;
 	}
-	
+
 	if (target->state == TARGET_UNKNOWN)
 	{
 		LOG_WARNING("target was in unknown state when halt was requested");
 	}
-	
-	if (target->state == TARGET_RESET) 
+
+	if (target->state == TARGET_RESET)
 	{
 		if ((jtag_reset_config & RESET_SRST_PULLS_TRST) && jtag_srst)
 		{
@@ -248,16 +248,16 @@
 			 * debug entry was already prepared in mips32_prepare_reset_halt()
 			 */
 			target->debug_reason = DBG_REASON_DBGRQ;
-			
+
 			return ERROR_OK;
 		}
 	}
-	
+
 	/* break processor */
 	mips_ejtag_enter_debug(ejtag_info);
-	
+
 	target->debug_reason = DBG_REASON_DBGRQ;
-	
+
 	return ERROR_OK;
 }
 
@@ -266,28 +266,28 @@
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	mips_m4k_common_t *mips_m4k = mips32->arch_info;
-	
-	LOG_DEBUG("target->state: %s", 
+
+	LOG_DEBUG("target->state: %s",
 		Jim_Nvp_value2name_simple( nvp_target_state, target->state )->name);
-	
+
 	if (!(jtag_reset_config & RESET_HAS_SRST))
 	{
 		LOG_ERROR("Can't assert SRST");
 		return ERROR_FAIL;
 	}
-	
+
 	if (target->reset_halt)
 	{
 		/* use hardware to catch reset */
-		jtag_add_end_state(TAP_RTI);
+		jtag_add_end_state(TAP_IDLE);
 		mips_ejtag_set_instr(ejtag_info, EJTAG_INST_EJTAGBOOT, NULL);
 	}
 	else
 	{
-		jtag_add_end_state(TAP_RTI);
+		jtag_add_end_state(TAP_IDLE);
 		mips_ejtag_set_instr(ejtag_info, EJTAG_INST_NORMALBOOT, NULL);
 	}
-	
+
 	if (strcmp(mips_m4k->variant, "ejtag_srst") == 0)
 	{
 		u32 ejtag_ctrl = ejtag_info->ejtag_ctrl | EJTAG_CTRL_PRRST | EJTAG_CTRL_PERRST;
@@ -307,7 +307,7 @@
 			jtag_add_reset(0, 1);
 		}
 	}
-	
+
 	target->state = TARGET_RESET;
 	jtag_add_sleep(50000);
 
@@ -319,18 +319,18 @@
 		if ((retval = target_halt(target))!=ERROR_OK)
 			return retval;
 	}
-	
+
 	return ERROR_OK;
 }
 
 int mips_m4k_deassert_reset(target_t *target)
 {
-	LOG_DEBUG("target->state: %s", 
+	LOG_DEBUG("target->state: %s",
 		Jim_Nvp_value2name_simple( nvp_target_state, target->state )->name);
-	
+
 	/* deassert reset lines */
 	jtag_add_reset(0, 0);
-	
+
 	return ERROR_OK;
 }
 
@@ -344,15 +344,15 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
-	
+
 	/* configure single step mode */
 	mips_ejtag_config_step(ejtag_info, 1);
-	
+
 	/* exit debug mode */
 	mips_ejtag_exit_debug(ejtag_info, 1);
-	
+
 	mips_m4k_debug_entry(target);
-	
+
 	return ERROR_OK;
 }
 
@@ -362,20 +362,20 @@
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	breakpoint_t *breakpoint = NULL;
 	u32 resume_pc;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_WARNING("target not halted");
 		return ERROR_TARGET_NOT_HALTED;
 	}
-	
+
 	if (!debug_execution)
 	{
 		target_free_all_working_areas(target);
 		mips_m4k_enable_breakpoints(target);
 		mips_m4k_enable_watchpoints(target);
 	}
-	
+
 	/* current = 1: continue on current pc, otherwise continue at <address> */
 	if (!current)
 	{
@@ -383,11 +383,11 @@
 		mips32->core_cache->reg_list[MIPS32_PC].dirty = 1;
 		mips32->core_cache->reg_list[MIPS32_PC].valid = 1;
 	}
-	
+
 	resume_pc = buf_get_u32(mips32->core_cache->reg_list[MIPS32_PC].value, 0, 32);
-	
+
 	mips32_restore_context(target);
-	
+
 	/* the front-end may request us not to handle breakpoints */
 	if (handle_breakpoints)
 	{
@@ -400,14 +400,14 @@
 			mips_m4k_set_breakpoint(target, breakpoint);
 		}
 	}
-	
+
 	/* exit debug mode - enable interrupts if required */
 	mips_ejtag_exit_debug(ejtag_info, !debug_execution);
 	target->debug_reason = DBG_REASON_NOTHALTED;
-	
+
 	/* registers are now invalid */
 	mips32_invalidate_core_regs(target);
-	
+
 	if (!debug_execution)
 	{
 		target->state = TARGET_RUNNING;
@@ -420,7 +420,7 @@
 		target_call_event_callbacks(target, TARGET_EVENT_DEBUG_RESUMED);
 		LOG_DEBUG("target debug resumed at 0x%x", resume_pc);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -440,43 +440,43 @@
 	/* current = 1: continue on current pc, otherwise continue at <address> */
 	if (!current)
 		buf_set_u32(mips32->core_cache->reg_list[MIPS32_PC].value, 0, 32, address);
-	
+
 	/* the front-end may request us not to handle breakpoints */
 	if (handle_breakpoints)
 		if ((breakpoint = breakpoint_find(target, buf_get_u32(mips32->core_cache->reg_list[MIPS32_PC].value, 0, 32))))
 			mips_m4k_unset_breakpoint(target, breakpoint);
-	
+
 	/* restore context */
 	mips32_restore_context(target);
-	
+
 	/* configure single step mode */
 	mips_ejtag_config_step(ejtag_info, 1);
-	
+
 	target->debug_reason = DBG_REASON_SINGLESTEP;
-	
+
 	target_call_event_callbacks(target, TARGET_EVENT_RESUMED);
-	
+
 	/* exit debug mode */
 	mips_ejtag_exit_debug(ejtag_info, 1);
-	
+
 	/* registers are now invalid */
 	mips32_invalidate_core_regs(target);
-	
+
 	if (breakpoint)
 		mips_m4k_set_breakpoint(target, breakpoint);
 
 	LOG_DEBUG("target stepped ");
-	
+
 	mips_m4k_debug_entry(target);
 	target_call_event_callbacks(target, TARGET_EVENT_HALTED);
-	
+
 	return ERROR_OK;
 }
 
 void mips_m4k_enable_breakpoints(struct target_s *target)
 {
 	breakpoint_t *breakpoint = target->breakpoints;
-	
+
 	/* set any pending breakpoints */
 	while (breakpoint)
 	{
@@ -490,17 +490,17 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips32_comparator_t * comparator_list = mips32->inst_break_list;
-	
+
 	if (breakpoint->set)
 	{
 		LOG_WARNING("breakpoint already set");
 		return ERROR_OK;
 	}
-	
+
 	if (breakpoint->type == BKPT_HARD)
 	{
 		int bp_num = 0;
-		
+
 		while(comparator_list[bp_num].used && (bp_num < mips32->num_inst_bpoints))
 			bp_num++;
 		if (bp_num >= mips32->num_inst_bpoints)
@@ -521,7 +521,7 @@
 	{
 
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -536,7 +536,7 @@
 		LOG_WARNING("breakpoint not set");
 		return ERROR_OK;
 	}
-	
+
 	if (breakpoint->type == BKPT_HARD)
 	{
 		int bp_num = breakpoint->set - 1;
@@ -554,26 +554,26 @@
 
 	}
 	breakpoint->set = 0;
-	
+
 	return ERROR_OK;
 }
 
 int mips_m4k_add_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
 {
 	mips32_common_t *mips32 = target->arch_info;
-	
+
 	if (mips32->num_inst_bpoints_avail < 1)
 	{
 		LOG_INFO("no hardware breakpoint available");
 		return ERROR_TARGET_RESOURCE_NOT_AVAILABLE;
 	}
-	
+
 	/* default to hardware for now */
 	breakpoint->type = BKPT_HARD;
-	
+
 	mips32->num_inst_bpoints_avail--;
 	mips_m4k_set_breakpoint(target, breakpoint);
-	
+
 	return ERROR_OK;
 }
 
@@ -581,21 +581,21 @@
 {
 	/* get pointers to arch-specific information */
 	mips32_common_t *mips32 = target->arch_info;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_WARNING("target not halted");
 		return ERROR_TARGET_NOT_HALTED;
 	}
-	
+
 	if (breakpoint->set)
 	{
 		mips_m4k_unset_breakpoint(target, breakpoint);
 	}
-	
+
 	if (breakpoint->type == BKPT_HARD)
 		mips32->num_inst_bpoints_avail++;
-	
+
 	return ERROR_OK;
 }
 
@@ -626,7 +626,7 @@
 void mips_m4k_enable_watchpoints(struct target_s *target)
 {
 	watchpoint_t *watchpoint = target->watchpoints;
-	
+
 	/* set any pending watchpoints */
 	while (watchpoint)
 	{
@@ -640,7 +640,7 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
-	
+
 	LOG_DEBUG("address: 0x%8.8x, size: 0x%8.8x, count: 0x%8.8x", address, size, count);
 
 	if (target->state != TARGET_HALTED)
@@ -655,7 +655,7 @@
 
 	if (((size == 4) && (address & 0x3u)) || ((size == 2) && (address & 0x1u)))
 		return ERROR_TARGET_UNALIGNED_ACCESS;
-	
+
 	switch (size)
 	{
 		case 4:
@@ -679,7 +679,7 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
-	
+
 	LOG_DEBUG("address: 0x%8.8x, size: 0x%8.8x, count: 0x%8.8x", address, size, count);
 
 	if (target->state != TARGET_HALTED)
@@ -694,7 +694,7 @@
 
 	if (((size == 4) && (address & 0x3u)) || ((size == 2) && (address & 0x1u)))
 		return ERROR_TARGET_UNALIGNED_ACCESS;
-	
+
 	switch (size)
 	{
 		case 4:
@@ -711,14 +711,14 @@
 			exit(-1);
 			break;
 	}
-	
+
 	return ERROR_OK;
 }
 
 int mips_m4k_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
-	
+
 	retval = mips32_register_commands(cmd_ctx);
 	return retval;
 }
@@ -726,7 +726,7 @@
 int mips_m4k_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
 	mips32_build_reg_cache(target);
-	
+
 	return ERROR_OK;
 }
 
@@ -738,7 +738,7 @@
 int mips_m4k_init_arch_info(target_t *target, mips_m4k_common_t *mips_m4k, jtag_tap_t *tap, const char *variant)
 {
 	mips32_common_t *mips32 = &mips_m4k->mips32_common;
-	
+
 	if (variant)
 	{
 		mips_m4k->variant = strdup(variant);
@@ -747,22 +747,22 @@
 	{
 		mips_m4k->variant = strdup("");
 	}
-	
+
 	mips_m4k->common_magic = MIPSM4K_COMMON_MAGIC;
-	
+
 	/* initialize mips4k specific info */
 	mips32_init_arch_info(target, mips32, tap, variant);
 	mips32->arch_info = mips_m4k;
-	
+
 	return ERROR_OK;
 }
 
 int mips_m4k_target_create(struct target_s *target, Jim_Interp *interp)
 {
 	mips_m4k_common_t *mips_m4k = calloc(1,sizeof(mips_m4k_common_t));
-	
+
 	mips_m4k_init_arch_info(target, mips_m4k, target->tap, target->variant);
-	
+
 	return ERROR_OK;
 }
 
@@ -772,11 +772,11 @@
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	u32 idcode = 0;
-	
+
 	if (!target->type->examined)
 	{
 		mips_ejtag_get_idcode(ejtag_info, &idcode, NULL);
-		
+
 		if (((idcode >> 1) & 0x7FF) == 0x29)
 		{
 			/* we are using a pic32mx so select ejtag port
@@ -785,14 +785,14 @@
 			LOG_DEBUG("PIC32MX Detected - using EJTAG Interface");
 		}
 	}
-	
+
 	/* init rest of ejtag interface */
 	if ((retval = mips_ejtag_init(ejtag_info)) != ERROR_OK)
 		return retval;
-	
+
 	if ((retval = mips32_examine(target)) != ERROR_OK)
 		return retval;
-	
+
 	return ERROR_OK;
 }
 

Modified: branches/openocd_1_0_branch/src/target/target/at91r40008.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/at91r40008.cfg	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/target/at91r40008.cfg	2008-12-13 07:02:56 UTC (rev 1236)
@@ -29,7 +29,7 @@
 #format L IRC IRCM IDCODE (Length, IR Capture, IR Capture Mask, IDCODE)
 jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGENAME -variant arm7tdmi
+target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm7tdmi
 
 
 $_TARGETNAME configure -event gdb-flash-erase-start {

Modified: branches/openocd_1_0_branch/src/target/target/at91sam9260.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/at91sam9260.cfg	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/target/at91sam9260.cfg	2008-12-13 07:02:56 UTC (rev 1236)
@@ -9,7 +9,7 @@
 # Target configuration
 ######################
 
-$_TARGET_NAME configure -event reset-init {
+$_TARGETNAME configure -event reset-init {
 	# at reset chip runs at 32khz
 	jtag_khz 8
 	mww 0xfffffd08 0xa5000501         # RSTC_MR : enable user reset

Modified: branches/openocd_1_0_branch/src/target/target/at91sam9260minimal.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/at91sam9260minimal.cfg	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/target/at91sam9260minimal.cfg	2008-12-13 07:02:56 UTC (rev 1236)
@@ -18,7 +18,7 @@
    set _CPUTAPID $CPUTAPID
 } else {
   # force an error till we get a good number
-   set _CPUTAPID 0xffffffff
+   set _CPUTAPID 0x0792603f
 }
 
 reset_config trst_and_srst
@@ -37,6 +37,6 @@
 target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm926ejs
 
 # Internal sram1 memory
-$_TARGET_NAME configure -work-area-virt 0 -work-area-phys 0x00300000 -work-area-size 0x1000 -work-area-backup 1
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00300000 -work-area-size 0x1000 -work-area-backup 1
 
 

Modified: branches/openocd_1_0_branch/src/target/target/imote2.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/imote2.cfg	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/target/imote2.cfg	2008-12-13 07:02:56 UTC (rev 1236)
@@ -35,7 +35,7 @@
 jtag newtap $_CHIPNAME cpu -irlen 7 -ircapture 0x1 -irmask 0x7f -expected-id $_CPUTAPID
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME xscale -endian $_ENDIAN -chain-position $_TARGETNAME -varient pxa27x
+target create $_TARGETNAME xscale -endian $_ENDIAN -chain-position $_TARGETNAME -variant pxa27x
 $_TARGETNAME configure -work-area-virt 0x0x5c000000 -work-area-phys 0x0x5c000000 -work-area-size 0x10000 -work-area-backup 1
 # maps to PXA internal RAM. If you are using a PXA255
 # you must initialize SDRAM or leave this option off

Modified: branches/openocd_1_0_branch/src/target/target/is5114.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/is5114.cfg	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/target/is5114.cfg	2008-12-13 07:02:56 UTC (rev 1236)
@@ -39,7 +39,7 @@
 
 #arm946e-s and 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm966e -endian $_ENDIAN  -chain-position $_TARGETNAME  -varient arm966e
+target create $_TARGETNAME arm966e -endian $_ENDIAN  -chain-position $_TARGETNAME  -variant arm966e
 
 $_TARGETNAME configure -event reset-start { jtag_rclk 16 }
 $_TARGETNAME configure -event reset-init {

Deleted: branches/openocd_1_0_branch/src/target/target/samsung_s2c2410.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/samsung_s2c2410.cfg	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/target/samsung_s2c2410.cfg	2008-12-13 07:02:56 UTC (rev 1236)
@@ -1,35 +0,0 @@
-# Found on the 'TinCanTools' Hammer board.
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME s3c2410
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-  # This config file was defaulting to big endian..
-   set  _ENDIAN little
-}
-
-if { [info exists CPUTAPID] } {	
-   set  _CPUTAPID $CPUTAPID    
-} else {	 
-   set  _CPUTAPID 0xffffffff
-}
-
-#use combined on interfaces or targets that cannot set TRST/SRST separately
-reset_config trst_and_srst
-
-#jtag scan chain
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm920t -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm920t
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x30800000 -work-area-size 0x20000 -work-area-backup 0
-
-# speed up memory downloads
-arm7_9 fast_memory_access enable
-arm7_9 dcc_downloads enable

Copied: branches/openocd_1_0_branch/src/target/target/samsung_s3c2410.cfg (from rev 1234, trunk/src/target/target/samsung_s3c2410.cfg)

Modified: branches/openocd_1_0_branch/src/target/target/samsung_s3c6410.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/samsung_s3c6410.cfg	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/target/samsung_s3c6410.cfg	2008-12-13 07:02:56 UTC (rev 1236)
@@ -23,14 +23,14 @@
    set _BSTAPID $BSTAPID
 } else {
   # force an error till we get a good number
-   set _BSTAPID 0xffffffff
+   set _BSTAPID 0x2b900f0f
 }
 
 if { [info exists CPUTAPID ] } {
    set _CPUTAPID $CPUTAPID
 } else {
   # force an error till we get a good number
-   set _CPUTAPID 0xffffffff
+   set _CPUTAPID 0x07b76f0f
 }
 
 #jtag scan chain
@@ -40,7 +40,7 @@
 jtag newtap $_CHIPNAME cpu     -irlen 5 -ircapture 0x1 -irmask 0x1f -expected-id $_CPUTAPID
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm11 -endian $_ENDIAN  -chain-position $_TARGETNAME -varient arm1176
+target create $_TARGETNAME arm11 -endian $_ENDIAN  -chain-position $_TARGETNAME -variant arm1176
 
 jtag_nsrst_delay 500
 jtag_ntrst_delay 500

Modified: branches/openocd_1_0_branch/src/target/xscale.c
===================================================================
--- branches/openocd_1_0_branch/src/target/xscale.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/target/xscale.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -252,7 +252,7 @@
 	u8 field2_check_value = 0x0;
 	u8 field2_check_mask = 0x1;
 
-	jtag_add_end_state(TAP_PD);
+	jtag_add_end_state(TAP_DRPAUSE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dcsr);
 
 	buf_set_u32(&field0, 1, 1, xscale->hold_rst);
@@ -300,7 +300,7 @@
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
 	fields[1].in_value = NULL;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	jtag_add_dr_scan(3, fields, -1);
 
@@ -332,9 +332,9 @@
 
 	int i;
 
-	path[0] = TAP_SDS;
-	path[1] = TAP_CD;
-	path[2] = TAP_SD;
+	path[0] = TAP_DRSELECT;
+	path[1] = TAP_DRCAPTURE;
+	path[2] = TAP_DRSHIFT;
 
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
@@ -362,9 +362,9 @@
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgtx);
-	jtag_add_runtest(1, -1); /* ensures that we're in the TAP_RTI state as the above could be a no-op */
+	jtag_add_runtest(1, -1); /* ensures that we're in the TAP_IDLE state as the above could be a no-op */
 
 	/* repeat until all words have been collected */
 	int attempts=0;
@@ -379,7 +379,7 @@
 			fields[1].in_handler_priv = (u8*)&field1[i];
 
 			jtag_add_pathmove(3, path);
-			jtag_add_dr_scan(3, fields, TAP_RTI);
+			jtag_add_dr_scan(3, fields, TAP_IDLE);
 			words_scheduled++;
 		}
 
@@ -442,20 +442,20 @@
 	u8 field2_check_value = 0x0;
 	u8 field2_check_mask = 0x1;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgtx);
 
-	path[0] = TAP_SDS;
-	path[1] = TAP_CD;
-	path[2] = TAP_SD;
+	path[0] = TAP_DRSELECT;
+	path[1] = TAP_DRCAPTURE;
+	path[2] = TAP_DRSHIFT;
 
-	noconsume_path[0] = TAP_SDS;
-	noconsume_path[1] = TAP_CD;
-	noconsume_path[2] = TAP_E1D;
-	noconsume_path[3] = TAP_PD;
-	noconsume_path[4] = TAP_E2D;
-	noconsume_path[5] = TAP_SD;
+	noconsume_path[0] = TAP_DRSELECT;
+	noconsume_path[1] = TAP_DRCAPTURE;
+	noconsume_path[2] = TAP_DREXIT1;
+	noconsume_path[3] = TAP_DRPAUSE;
+	noconsume_path[4] = TAP_DREXIT2;
+	noconsume_path[5] = TAP_DRSHIFT;
 
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
@@ -499,7 +499,7 @@
 			jtag_add_pathmove(sizeof(noconsume_path)/sizeof(*noconsume_path), noconsume_path);
 		}
 
-		jtag_add_dr_scan(3, fields, TAP_RTI);
+		jtag_add_dr_scan(3, fields, TAP_IDLE);
 
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
@@ -551,7 +551,7 @@
 	u8 field2_check_value = 0x0;
 	u8 field2_check_mask = 0x1;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgrx);
 
@@ -588,7 +588,7 @@
 	LOG_DEBUG("polling RX");
 	for (;;)
 	{
-		jtag_add_dr_scan(3, fields, TAP_RTI);
+		jtag_add_dr_scan(3, fields, TAP_IDLE);
 
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
@@ -617,7 +617,7 @@
 
 	/* set rx_valid */
 	field2 = 0x1;
-	jtag_add_dr_scan(3, fields, TAP_RTI);
+	jtag_add_dr_scan(3, fields, TAP_IDLE);
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -640,7 +640,7 @@
 
 	int done_count = 0;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgrx);
 
@@ -683,7 +683,7 @@
 				3,
 				bits,
 				t,
-				TAP_RTI);
+				TAP_IDLE);
 		buffer += size;
 	}
 
@@ -726,7 +726,7 @@
 	if (ext_dbg_brk != -1)
 		xscale->external_debug_break = ext_dbg_brk;
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dcsr);
 
 	buf_set_u32(&field0, 1, 1, xscale->hold_rst);
@@ -796,7 +796,7 @@
 
 	LOG_DEBUG("loading miniIC at 0x%8.8x", va);
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.ldic); /* LDIC */
 
 	/* CMD is b010 for Main IC and b011 for Mini IC */
@@ -859,7 +859,7 @@
 
 	scan_field_t fields[2];
 
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.ldic); /* LDIC */
 
 	/* CMD for invalidate IC line b000, bits [6:4] b000 */
@@ -1597,7 +1597,7 @@
 	/* select DCSR instruction (set endstate to R-T-I to ensure we don't
 	 * end up in T-L-R, which would reset JTAG
 	 */
-	jtag_add_end_state(TAP_RTI);
+	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dcsr);
 
 	/* set Hold reset, Halt mode and Trap Reset */
@@ -1620,7 +1620,7 @@
 
     if (target->reset_halt)
     {
-    	int retval;
+	int retval;
 		if ((retval = target_halt(target))!=ERROR_OK)
 			return retval;
     }
@@ -1671,7 +1671,7 @@
 		/* wait 300ms; 150 and 100ms were not enough */
 		jtag_add_sleep(300*1000);
 
-		jtag_add_runtest(2030, TAP_RTI);
+		jtag_add_runtest(2030, TAP_IDLE);
 		jtag_execute_queue();
 
 		/* set Hold reset, Halt mode and Trap Reset */
@@ -1734,7 +1734,7 @@
 		xscale_load_ic(target, 1, 0x0, xscale->low_vectors);
 		xscale_load_ic(target, 1, 0xffff0000, xscale->high_vectors);
 
-		jtag_add_runtest(30, TAP_RTI);
+		jtag_add_runtest(30, TAP_IDLE);
 
 		jtag_add_sleep(100000);
 
@@ -3381,7 +3381,7 @@
 		command_print(cmd_ctx, "icache %s", (xscale->armv4_5_mmu.armv4_5_cache.i_cache_enabled) ? "enabled" : "disabled");
 
 	if (dcache)
-	 	command_print(cmd_ctx, "dcache %s", (xscale->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled) ? "enabled" : "disabled");
+		command_print(cmd_ctx, "dcache %s", (xscale->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled) ? "enabled" : "disabled");
 
 	return ERROR_OK;
 }

Modified: branches/openocd_1_0_branch/src/xsvf/xsvf.c
===================================================================
--- branches/openocd_1_0_branch/src/xsvf/xsvf.c	2008-12-13 06:59:24 UTC (rev 1235)
+++ branches/openocd_1_0_branch/src/xsvf/xsvf.c	2008-12-13 07:02:56 UTC (rev 1236)
@@ -62,9 +62,9 @@
 
 enum tap_state xsvf_to_tap[] =
 {
-	TAP_TLR, TAP_RTI,
-	TAP_SDS, TAP_CD, TAP_SD, TAP_E1D, TAP_PD, TAP_E2D, TAP_UD,
-	TAP_SIS, TAP_CI, TAP_SI, TAP_E1I, TAP_PI, TAP_E2I, TAP_UI,
+	TAP_RESET, TAP_IDLE,
+	TAP_DRSELECT, TAP_DRCAPTURE, TAP_DRSHIFT, TAP_DREXIT1, TAP_DRPAUSE, TAP_DREXIT2, TAP_DRUPDATE,
+	TAP_IRSELECT, TAP_IRCAPTURE, TAP_IRSHIFT, TAP_IREXIT1, TAP_IRPAUSE, TAP_IREXIT2, TAP_IRUPDATE,
 };
 
 int tap_to_xsvf[] =
@@ -76,23 +76,23 @@
 /* xsvf has it's own definition of a statemove. This needs
  * to be handled according to the specs, which has nothing
  * to do with the JTAG spec or OpenOCD as such.
- * 
+ *
  * Implemented via jtag_add_pathmove().
  */
 void xsvf_add_statemove(enum tap_state state)
 {
 	enum tap_state moves[7]; /* max # of transitions */
-	int i; 
+	int i;
 	enum tap_state curstate = cmd_queue_cur_state;
 	u8 move = TAP_MOVE(cmd_queue_cur_state, state);
-	
-	if ((state != TAP_TLR) && (state == cmd_queue_cur_state))
+
+	if ((state != TAP_RESET) && (state == cmd_queue_cur_state))
 		return;
 
-	if(state==TAP_TLR) 
+	if(state==TAP_RESET)
 	{
-		jtag_add_tlr(); 
-		return; 
+		jtag_add_tlr();
+		return;
 	}
 	for (i=0; i<7; i++)
 	{
@@ -135,7 +135,7 @@
 {
 	char c;
 	unsigned char uc;
-	
+
 	while ((read(fd, &c, 1) > 0) && (c == 0x12))
 	{
 		if (*path_len > max_path)
@@ -149,9 +149,9 @@
 		}
 		path[(*path_len)++] = xsvf_to_tap[uc];
 	}
-	
+
 	lseek(fd, -1, SEEK_CUR);
-	
+
 	return ERROR_OK;
 }
 
@@ -166,9 +166,9 @@
 	int do_abort = 0;
 	int unsupported = 0;
 	int tdo_mismatch = 0;
-	
+
 	int runtest_requires_tck = 0;
-	
+
 	jtag_tap_t *tap = NULL;
 	/* use NULL to indicate a "plain" xsvf file which accounts for
 	   additional devices in the scan chain, otherwise the device
@@ -194,7 +194,7 @@
 		command_print(cmd_ctx, "file %s not found", args[0]);
 		return ERROR_OK;
 	}
-	
+
 	if ((argc > 2) && (strcmp(args[2], "virt2") == 0))
 	{
 		runtest_requires_tck = 1;
@@ -209,7 +209,7 @@
 				if (jtag_execute_queue() != ERROR_OK)
 				{
 					tdo_mismatch = 1;
-					break;	
+					break;
 				}
 				break;
 			case 0x01:	/* XTDOMASK */
@@ -239,9 +239,9 @@
 						field.in_handler = NULL;
 						field.in_handler_priv = NULL;
 						if (tap == NULL)
-							jtag_add_plain_ir_scan(1, &field, TAP_PI);
+							jtag_add_plain_ir_scan(1, &field, TAP_IRPAUSE);
 						else
-							jtag_add_ir_scan(1, &field, TAP_PI);
+							jtag_add_ir_scan(1, &field, TAP_IRPAUSE);
 						if (jtag_execute_queue() != ERROR_OK)
 						{
 							tdo_mismatch = 1;
@@ -254,7 +254,7 @@
 								jtag_add_runtest(xruntest, xsvf_to_tap[xendir]);
 							else
 							{
-								xsvf_add_statemove(TAP_RTI);
+								xsvf_add_statemove(TAP_IDLE);
 								jtag_add_sleep(xruntest);
 								xsvf_add_statemove(xsvf_to_tap[xendir]);
 							}
@@ -279,13 +279,13 @@
 					field.in_value = NULL;
 					jtag_set_check_value(&field, dr_in_buf, dr_in_mask, NULL);
 					if (tap == NULL)
-						jtag_add_plain_dr_scan(1, &field, TAP_PD);
+						jtag_add_plain_dr_scan(1, &field, TAP_DRPAUSE);
 					else
-						jtag_add_dr_scan(1, &field, TAP_PD);
+						jtag_add_dr_scan(1, &field, TAP_DRPAUSE);
 					if (jtag_execute_queue() != ERROR_OK)
 					{
 						tdo_mismatch = 1;
-						break;	
+						break;
 					}
 					if (xruntest)
 					{
@@ -293,7 +293,7 @@
 							jtag_add_runtest(xruntest, xsvf_to_tap[xenddr]);
 						else
 						{
-							xsvf_add_statemove(TAP_RTI);
+							xsvf_add_statemove(TAP_IDLE);
 							jtag_add_sleep(xruntest);
 							xsvf_add_statemove(xsvf_to_tap[xenddr]);
 						}
@@ -353,13 +353,13 @@
 						field.in_value = NULL;
 						jtag_set_check_value(&field, dr_in_buf, dr_in_mask, NULL);
 						if (tap == NULL)
-							jtag_add_plain_dr_scan(1, &field, TAP_PD);
+							jtag_add_plain_dr_scan(1, &field, TAP_DRPAUSE);
 						else
-							jtag_add_dr_scan(1, &field, TAP_PD);
+							jtag_add_dr_scan(1, &field, TAP_DRPAUSE);
 						if (jtag_execute_queue() != ERROR_OK)
 						{
 							tdo_mismatch = 1;
-							break;	
+							break;
 						}
 						if (xruntest)
 						{
@@ -367,7 +367,7 @@
 								jtag_add_runtest(xruntest, xsvf_to_tap[xenddr]);
 							else
 							{
-								xsvf_add_statemove(TAP_RTI);
+								xsvf_add_statemove(TAP_IDLE);
 								jtag_add_sleep(xruntest);
 								xsvf_add_statemove(xsvf_to_tap[xenddr]);
 							}
@@ -418,14 +418,14 @@
 					{
 						int i,lasti;
 						/* here the trick is that jtag_add_pathmove() must end in a stable
-						state, so we must only invoke jtag_add_tlr() when we absolutely 
+						state, so we must only invoke jtag_add_tlr() when we absolutely
 						have to
 						*/
-						for(i=0,lasti=0;i<path_len;i++) 
+						for(i=0,lasti=0;i<path_len;i++)
 						{
-							if(path[i]==TAP_TLR) 
+							if(path[i]==TAP_RESET)
 							{
-								if(i>lasti)  
+								if(i>lasti)
 								{
 									jtag_add_pathmove(i-lasti,path+lasti);
 								}
@@ -433,7 +433,7 @@
 								jtag_add_tlr();
 							}
 						}
-						if(i>=lasti) 
+						if(i>=lasti)
 						{
 							jtag_add_pathmove(i-lasti, path+lasti);
 						}
@@ -536,7 +536,7 @@
 		if (do_abort || unsupported || tdo_mismatch)
 			break;
 	}
-	
+
 	if (tdo_mismatch)
 	{
 		command_print(cmd_ctx, "TDO mismatch, aborting");
@@ -554,18 +554,18 @@
 		command_print(cmd_ctx, "premature end detected, aborting");
 		return ERROR_OK;
 	}
-	
+
 	if (dr_out_buf)
 		free(dr_out_buf);
-	
+
 	if (dr_in_buf)
 		free(dr_in_buf);
-	
+
 	if (dr_in_mask)
 		free(dr_in_mask);
 
 	close(xsvf_fd);
-	
+
 	command_print(cmd_ctx, "XSVF file programmed successfully");
 
 	return ERROR_OK;



From kc8apf at mail.berlios.de  Sat Dec 13 08:05:42 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Sat, 13 Dec 2008 08:05:42 +0100
Subject: [Openocd-svn] r1237 - trunk/src/jtag
Message-ID: <200812130705.mBD75gPg029308@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-13 08:05:38 +0100 (Sat, 13 Dec 2008)
New Revision: 1237

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
Log:
Add JTAG tap events for enable/disable

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-13 07:02:56 UTC (rev 1236)
+++ trunk/src/jtag/jtag.c	2008-12-13 07:05:38 UTC (rev 1237)
@@ -110,6 +110,13 @@
 	"JTAG controller reset (RESET or TRST)"
 };
 
+const Jim_Nvp nvp_jtag_tap_event[] = {
+	{ .value = JTAG_TAP_EVENT_ENABLE,       .name = "tap-enable" },
+	{ .value = JTAG_TAP_EVENT_DISABLE,      .name = "tap-disable" },
+
+	{ .name = NULL, .value = -1 }
+};
+
 /* kludge!!!! these are just global variables that the
  * interface use internally. They really belong
  * inside the drivers, but we don't want to break
@@ -1699,8 +1706,106 @@
 	return ERROR_OK;
 }
 
+enum jtag_tap_cfg_param {
+	JCFG_EVENT
+};
 
+static Jim_Nvp nvp_config_opts[] = {
+	{ .name = "-event",      .value = JCFG_EVENT },
+
+	{ .name = NULL,          .value = -1 }
+};
+
 static int
+jtag_tap_configure_cmd( Jim_GetOptInfo *goi,
+		jtag_tap_t * tap)
+{
+	Jim_Nvp *n;
+	Jim_Obj *o;
+	int e;
+
+	/* parse config or cget options */
+	while (goi->argc > 0) {
+		Jim_SetEmptyResult (goi->interp);
+
+		e = Jim_GetOpt_Nvp(goi, nvp_config_opts, &n);
+		if (e != JIM_OK) {
+			Jim_GetOpt_NvpUnknown(goi, nvp_config_opts, 0);
+			return e;
+		}
+
+		switch (n->value) {
+			case JCFG_EVENT:
+				if (goi->argc == 0) {
+					Jim_WrongNumArgs( goi->interp, goi->argc, goi->argv, "-event ?event-name? ..." );
+					return JIM_ERR;
+				}
+
+				e = Jim_GetOpt_Nvp( goi, nvp_jtag_tap_event, &n );
+				if (e != JIM_OK) {
+					Jim_GetOpt_NvpUnknown(goi, nvp_jtag_tap_event, 1);
+					return e;
+				}
+
+				if (goi->isconfigure) {
+					if (goi->argc != 1) {
+						Jim_WrongNumArgs(goi->interp, goi->argc, goi->argv, "-event ?event-name? ?EVENT-BODY?");
+						return JIM_ERR;
+					}
+				} else {
+					if (goi->argc != 0) {
+						Jim_WrongNumArgs(goi->interp, goi->argc, goi->argv, "-event ?event-name?");
+						return JIM_ERR;
+					}
+				}
+
+				{
+					jtag_tap_event_action_t *jteap;
+
+					jteap = tap->event_action;
+					/* replace existing? */
+					while (jteap) {
+						if (jteap->event == n->value) {
+							break;
+						}
+						jteap = jteap->next;
+					}
+
+					if (goi->isconfigure) {
+						if (jteap == NULL) {
+							/* create new */
+							jteap = calloc(1, sizeof (*jteap));
+						}
+						jteap->event = n->value;
+						Jim_GetOpt_Obj( goi, &o);
+						if (jteap->body) {
+							Jim_DecrRefCount(interp, jteap->body);
+						}
+						jteap->body = Jim_DuplicateObj(goi->interp, o);
+						Jim_IncrRefCount(jteap->body);
+
+						/* add to head of event list */
+						jteap->next = tap->event_action;
+						tap->event_action = jteap;
+						Jim_SetEmptyResult(goi->interp);
+					} else {
+						/* get */
+						if (jteap == NULL) {
+							Jim_SetEmptyResult(goi->interp);
+						} else {
+							Jim_SetResult(goi->interp, Jim_DuplicateObj(goi->interp, jteap->body));
+						}
+					}
+				}
+				/* loop for more */
+				break;
+		}
+	} /* while (goi->argc) */
+
+	return JIM_OK;
+}
+
+static int
 jim_newtap_cmd( Jim_GetOptInfo *goi )
 {
 	jtag_tap_t *pTap;
@@ -1901,6 +2006,7 @@
 	Jim_GetOptInfo goi;
 	int e;
 	Jim_Nvp *n;
+	Jim_Obj *o;
 	struct command_context_s *context;
 
 	enum {
@@ -1909,7 +2015,9 @@
 		JTAG_CMD_NEWTAP,
 		JTAG_CMD_TAPENABLE,
 		JTAG_CMD_TAPDISABLE,
-		JTAG_CMD_TAPISENABLED
+		JTAG_CMD_TAPISENABLED,
+		JTAG_CMD_CONFIGURE,
+		JTAG_CMD_CGET
 	};
 
 	const Jim_Nvp jtag_cmds[] = {
@@ -1919,6 +2027,8 @@
 		{ .name = "tapisenabled"     , .value = JTAG_CMD_TAPISENABLED },
 		{ .name = "tapenable"     , .value = JTAG_CMD_TAPENABLE },
 		{ .name = "tapdisable"    , .value = JTAG_CMD_TAPDISABLE },
+		{ .name = "configure"     , .value = JTAG_CMD_CONFIGURE },
+		{ .name = "cget"          , .value = JTAG_CMD_CGET },
 
 		{ .name = NULL, .value = -1 },
 	};
@@ -1977,10 +2087,12 @@
 				// below
 				break;
 			case JTAG_CMD_TAPENABLE:
+				jtag_tap_handle_event( t, JTAG_TAP_EVENT_ENABLE);
 				e = 1;
 				t->enabled = e;
 				break;
 			case JTAG_CMD_TAPDISABLE:
+				jtag_tap_handle_event( t, JTAG_TAP_EVENT_DISABLE);
 				e = 0;
 				t->enabled = e;
 				break;
@@ -1988,6 +2100,46 @@
 			Jim_SetResult( goi.interp, Jim_NewIntObj( goi.interp, e ) );
 			return JIM_OK;
 		}
+		break;
+
+	case JTAG_CMD_CGET:
+		if( goi.argc < 2 ){
+			Jim_WrongNumArgs( goi.interp, 0, NULL, "?tap-name? -option ...");
+			return JIM_ERR;
+		}
+
+		{
+			jtag_tap_t *t;
+
+			Jim_GetOpt_Obj(&goi, &o);
+			t = jtag_TapByJimObj( goi.interp, o );
+			if( t == NULL ){
+				return JIM_ERR;
+			}
+
+			goi.isconfigure = 0;
+			return jtag_tap_configure_cmd( &goi, t);
+		}
+		break;
+
+	case JTAG_CMD_CONFIGURE:
+		if( goi.argc < 3 ){
+			Jim_WrongNumArgs( goi.interp, 0, NULL, "?tap-name? -option ?VALUE? ...");
+			return JIM_ERR;
+		}
+
+		{
+			jtag_tap_t *t;
+
+			Jim_GetOpt_Obj(&goi, &o);
+			t = jtag_TapByJimObj( goi.interp, o );
+			if( t == NULL ){
+				return JIM_ERR;
+			}
+
+			goi.isconfigure = 1;
+			return jtag_tap_configure_cmd( &goi, t);
+		}
 	}
 
 
@@ -2763,3 +2915,34 @@
 	return jtag->srst_asserted(srst_asserted);
 }
 
+void jtag_tap_handle_event( jtag_tap_t * tap, enum jtag_tap_event e)
+{
+	jtag_tap_event_action_t * jteap;
+	int done;
+
+	jteap = tap->event_action;
+
+	done = 0;
+	while (jteap) {
+		if (jteap->event == e) {
+			done = 1;
+			LOG_DEBUG( "JTAG tap: %s event: %d (%s) action: %s\n",
+					tap->dotted_name,
+					e,
+					Jim_Nvp_value2name_simple(nvp_jtag_tap_event, e)->name,
+					Jim_GetString(jteap->body, NULL) );
+			if (Jim_EvalObj(interp, jteap->body) != JIM_OK) {
+				Jim_PrintErrorMessage(interp);
+			}
+		}
+
+		jteap = jteap->next;
+	}
+
+	if (!done) {
+		LOG_DEBUG( "event %d %s - no action",
+				e,
+				Jim_Nvp_value2name_simple( nvp_jtag_tap_event, e)->name);
+	}
+}
+

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2008-12-13 07:02:56 UTC (rev 1236)
+++ trunk/src/jtag/jtag.h	2008-12-13 07:05:38 UTC (rev 1237)
@@ -158,6 +158,9 @@
 
 extern jtag_command_t *jtag_command_queue;
 
+// forward declaration
+typedef struct jtag_tap_event_action_s jtag_tap_event_action_t;
+
 // this is really: typedef jtag_tap_t
 // But - the typedef is done in "types.h"
 // due to "forward decloration reasons"
@@ -178,6 +181,9 @@
 	u8 expected_ids_cnt;/* Number of expected identification codes */
 	u8 *cur_instr;		/* current instruction */
 	int bypass;			/* bypass register selected */
+
+	jtag_tap_event_action_t *event_action;
+
 	jtag_tap_t *next_tap;
 };
 extern jtag_tap_t *jtag_AllTaps(void);
@@ -271,8 +277,22 @@
 	JTAG_TRST_ASSERTED
 };
 
-extern char* jtag_event_strings[];
+extern char * jtag_event_strings[];
 
+enum jtag_tap_event
+{
+	JTAG_TAP_EVENT_ENABLE,
+	JTAG_TAP_EVENT_DISABLE
+};
+
+extern const Jim_Nvp nvp_jtag_tap_event[];
+
+struct jtag_tap_event_action_s {
+	enum jtag_tap_event event;
+	Jim_Obj *body;
+	jtag_tap_event_action_t *next;
+};
+
 extern int jtag_trst;
 extern int jtag_srst;
 
@@ -462,6 +482,8 @@
 
 extern int jtag_verify_capture_ir;
 
+void jtag_tap_handle_event( jtag_tap_t * tap, enum jtag_tap_event e);
+
 /* error codes
  * JTAG subsystem uses codes between -100 and -199 */
 



From ntfreak at mail.berlios.de  Sat Dec 13 13:44:42 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Sat, 13 Dec 2008 13:44:42 +0100
Subject: [Openocd-svn] r1238 - in trunk/src: . flash helper jtag server
	target
Message-ID: <200812131244.mBDCigPv010116@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-13 13:44:39 +0100 (Sat, 13 Dec 2008)
New Revision: 1238

Modified:
   trunk/src/flash/cfi.h
   trunk/src/flash/ecos.c
   trunk/src/flash/flash.c
   trunk/src/flash/lpc2000.c
   trunk/src/flash/lpc288x.c
   trunk/src/flash/lpc3180_nand_controller.c
   trunk/src/flash/mflash.c
   trunk/src/flash/mflash.h
   trunk/src/flash/nand.c
   trunk/src/flash/s3c24xx_regs_nand.h
   trunk/src/flash/stellaris.h
   trunk/src/flash/stm32x.h
   trunk/src/flash/str7x.c
   trunk/src/flash/str7x.h
   trunk/src/flash/str9x.h
   trunk/src/flash/tms470.c
   trunk/src/helper/bin2char.c
   trunk/src/helper/binarybuffer.c
   trunk/src/helper/command.c
   trunk/src/helper/configuration.c
   trunk/src/helper/fileio.h
   trunk/src/helper/log.c
   trunk/src/helper/log.h
   trunk/src/helper/options.c
   trunk/src/helper/replacements.c
   trunk/src/helper/replacements.h
   trunk/src/helper/tclapi.c
   trunk/src/helper/types.h
   trunk/src/jtag/bitbang.c
   trunk/src/jtag/bitq.c
   trunk/src/jtag/dummy.c
   trunk/src/jtag/ep93xx.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/presto.c
   trunk/src/jtag/usbprog.c
   trunk/src/openocd.c
   trunk/src/server/gdb_server.c
   trunk/src/server/server.c
   trunk/src/server/telnet_server.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7_9_common.c
   trunk/src/target/arm7_9_common.h
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm7tdmi.h
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm926ejs.h
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/arm9tdmi.h
   trunk/src/target/armv4_5.c
   trunk/src/target/armv4_5.h
   trunk/src/target/breakpoints.c
   trunk/src/target/breakpoints.h
   trunk/src/target/cortex_m3.c
   trunk/src/target/cortex_m3.h
   trunk/src/target/cortex_swjdp.h
   trunk/src/target/embeddedice.h
   trunk/src/target/etb.h
   trunk/src/target/feroceon.c
   trunk/src/target/image.c
   trunk/src/target/image.h
   trunk/src/target/mips32.c
   trunk/src/target/mips32.h
   trunk/src/target/mips32_dmaacc.c
   trunk/src/target/mips32_dmaacc.h
   trunk/src/target/mips32_pracc.h
   trunk/src/target/mips_m4k.c
   trunk/src/target/mips_m4k.h
   trunk/src/target/oocd_trace.c
   trunk/src/target/oocd_trace.h
   trunk/src/target/register.c
   trunk/src/target/register.h
   trunk/src/target/target.c
   trunk/src/target/target.h
   trunk/src/target/xscale.c
Log:
- remove target specific variant and use target->variant member
- fix build warning in cortex_m3
- code cleanup - remove trailing lf and convert c++ comments

Modified: trunk/src/flash/cfi.h
===================================================================
--- trunk/src/flash/cfi.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/cfi.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -148,10 +148,10 @@
 } cfi_fixup_t;
 
 #define CFI_MFR_AMD		0x0001
-#define CFI_MFR_FUJITSU		0x0004
+#define CFI_MFR_FUJITSU	0x0004
 #define CFI_MFR_ATMEL	0x001F
 #define CFI_MFR_ST		0x0020	/* STMicroelectronics */
-#define CFI_MFR_AMIC		0x0037
+#define CFI_MFR_AMIC	0x0037
 #define CFI_MFR_SST		0x00BF
 #define CFI_MFR_MX		0x00C2
 

Modified: trunk/src/flash/ecos.c
===================================================================
--- trunk/src/flash/ecos.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/ecos.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -25,7 +25,6 @@
 
 #include "replacements.h"
 
-
 #include "flash.h"
 
 #include "target.h"
@@ -37,8 +36,6 @@
 #include "../target/embeddedice.h"
 #include "types.h"
 
-
-
 int ecosflash_register_commands(struct command_context_s *cmd_ctx);
 int ecosflash_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
 int ecosflash_erase(struct flash_bank_s *bank, int first, int last);
@@ -99,42 +96,41 @@
 #define FLASH_ERR_DRV_WRONG_PART  0x0d  /* Driver does not support device */
 #define FLASH_ERR_LOW_VOLTAGE     0x0e  /* Not enough juice to complete job */
 
-
 char *
 flash_errmsg(int err)
 {
-    switch (err) {
-    case FLASH_ERR_OK:
-        return "No error - operation complete";
-    case FLASH_ERR_ERASE_SUSPEND:
-        return "Device is in erase suspend state";
-    case FLASH_ERR_PROGRAM_SUSPEND:
-        return "Device is in program suspend state";
-    case FLASH_ERR_INVALID:
-        return "Invalid FLASH address";
-    case FLASH_ERR_ERASE:
-        return "Error trying to erase";
-    case FLASH_ERR_LOCK:
-        return "Error trying to lock/unlock";
-    case FLASH_ERR_PROGRAM:
-        return "Error trying to program";
-    case FLASH_ERR_PROTOCOL:
-        return "Generic error";
-    case FLASH_ERR_PROTECT:
-        return "Device/region is write-protected";
-    case FLASH_ERR_NOT_INIT:
-        return "FLASH sub-system not initialized";
-    case FLASH_ERR_DRV_VERIFY:
-        return "Data verify failed after operation";
-    case FLASH_ERR_DRV_TIMEOUT:
-        return "Driver timed out waiting for device";
-    case FLASH_ERR_DRV_WRONG_PART:
-        return "Driver does not support device";
-    case FLASH_ERR_LOW_VOLTAGE:
-        return "Device reports low voltage";
-    default:
-        return "Unknown error";
-    }
+	switch (err) {
+	case FLASH_ERR_OK:
+		return "No error - operation complete";
+	case FLASH_ERR_ERASE_SUSPEND:
+		return "Device is in erase suspend state";
+	case FLASH_ERR_PROGRAM_SUSPEND:
+		return "Device is in program suspend state";
+	case FLASH_ERR_INVALID:
+		return "Invalid FLASH address";
+	case FLASH_ERR_ERASE:
+		return "Error trying to erase";
+	case FLASH_ERR_LOCK:
+		return "Error trying to lock/unlock";
+	case FLASH_ERR_PROGRAM:
+		return "Error trying to program";
+	case FLASH_ERR_PROTOCOL:
+		return "Generic error";
+	case FLASH_ERR_PROTECT:
+		return "Device/region is write-protected";
+	case FLASH_ERR_NOT_INIT:
+		return "FLASH sub-system not initialized";
+	case FLASH_ERR_DRV_VERIFY:
+		return "Data verify failed after operation";
+	case FLASH_ERR_DRV_TIMEOUT:
+		return "Driver timed out waiting for device";
+	case FLASH_ERR_DRV_WRONG_PART:
+		return "Driver does not support device";
+	case FLASH_ERR_LOW_VOLTAGE:
+		return "Device reports low voltage";
+	default:
+		return "Unknown error";
+	}
 }
 #endif
 
@@ -185,7 +181,6 @@
 	return ERROR_OK;
 }
 
-
 int loadDriver(ecosflash_flash_bank_t *info)
 {
 	u32 buf_cnt;
@@ -228,7 +223,6 @@
 	return ERROR_OK;
 }
 
-
 static int const OFFSET_ERASE=0x0;
 static int const OFFSET_ERASE_SIZE=0x8;
 static int const OFFSET_FLASH=0xc;
@@ -236,7 +230,6 @@
 static int const OFFSET_GET_WORKAREA=0x18;
 static int const OFFSET_GET_WORKAREA_SIZE=0x4;
 
-
 int runCode(ecosflash_flash_bank_t *info,
 		u32 codeStart, u32 codeStop, u32 r0, u32 r1, u32 r2,
 		u32 *result,
@@ -334,8 +327,8 @@
 
 
 	int i;
-    for (i=0; i<len; i+=chunk)
-    {
+	for (i=0; i<len; i+=chunk)
+	{
 		int t=len-i;
 		if (t>chunk)
 		{
@@ -343,38 +336,36 @@
 		}
 
 		int retval;
-    	retval=target_write_buffer(target, buffer, t, ((u8 *)data)+i);
-    	if (retval != ERROR_OK)
-    		return retval;
+		retval=target_write_buffer(target, buffer, t, ((u8 *)data)+i);
+		if (retval != ERROR_OK)
+			return retval;
 
-    	u32 flashErr;
-    	retval=runCode(info,
-    			info->start_address+OFFSET_FLASH,
-    			info->start_address+OFFSET_FLASH+OFFSET_FLASH_SIZE,
-    			buffer,
-    			address+i,
-    			t,
-    			&flashErr,
-    			timeout);
-    	if (retval != ERROR_OK)
-    		return retval;
+		u32 flashErr;
+		retval=runCode(info,
+				info->start_address+OFFSET_FLASH,
+				info->start_address+OFFSET_FLASH+OFFSET_FLASH_SIZE,
+				buffer,
+				address+i,
+				t,
+				&flashErr,
+				timeout);
+		if (retval != ERROR_OK)
+			return retval;
 
 		if (flashErr != 0x0)
 		{
 			LOG_ERROR("Flash prog failed with %d (%s)\n", flashErr, flash_errmsg(flashErr));
 			return ERROR_FAIL;
 		}
-    }
+	}
 	return ERROR_OK;
 }
 
-
 int ecosflash_probe(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
-
 int ecosflash_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, "ecosflash", NULL, COMMAND_ANY, NULL);
@@ -382,7 +373,7 @@
 	return ERROR_OK;
 }
 
-/*
+#if 0
 static void command(flash_bank_t *bank, u8 cmd, u8 *cmd_buf)
 {
 	ecosflash_flash_bank_t *info = bank->driver_priv;
@@ -403,7 +394,7 @@
 		}
 	}
 }
-*/
+#endif
 
 u32 ecosflash_address(struct flash_bank_s *bank, u32 address)
 {
@@ -421,7 +412,6 @@
 	return retval + bank->base;
 }
 
-
 int ecosflash_erase(struct flash_bank_s *bank, int first, int last)
 {
 	struct flash_bank_s *c=bank;
@@ -434,7 +424,6 @@
 	return ERROR_OK;
 }
 
-
 int ecosflash_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	ecosflash_flash_bank_t *info = bank->driver_priv;
@@ -442,7 +431,6 @@
 	return eCosBoard_flash(info, buffer, c->base+offset, count);
 }
 
-
 int ecosflash_protect_check(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
@@ -455,7 +443,6 @@
 	return ERROR_OK;
 }
 
-
 u32 ecosflash_get_flash_status(flash_bank_t *bank)
 {
 	return ERROR_OK;
@@ -475,7 +462,3 @@
 {
 	return ERROR_OK;
 }
-
-
-
-

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/flash.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -466,7 +466,6 @@
 						j, p->sectors[j].offset, p->sectors[j].size, p->sectors[j].size>>10,
 						erase_state);
 		}
-
 	}
 
 	return ERROR_OK;
@@ -658,7 +657,6 @@
 		command_print(cmd_ctx, "auto erase enabled");
 	}
 
-
 	if (argc < 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -743,7 +741,6 @@
 	if(count == 0)
 		return ERROR_OK;
 
-
 	switch(cmd[4])
 	{
 	case 'w':
@@ -804,7 +801,6 @@
 		return retval;
 	}
 
-
 	if(err == ERROR_OK)
 	{
 		float speed;

Modified: trunk/src/flash/lpc2000.c
===================================================================
--- trunk/src/flash/lpc2000.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/lpc2000.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -577,7 +577,7 @@
 			break;
 		
 		if (bytes_remaining >= thisrun_bytes)
-		{                      
+		{
 			if ((retval = target_write_buffer(bank->target, download_area->address, thisrun_bytes, buffer + bytes_written)) != ERROR_OK)
 			{
 				retval = ERROR_FLASH_OPERATION_FAILED;

Modified: trunk/src/flash/lpc288x.c
===================================================================
--- trunk/src/flash/lpc288x.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/lpc288x.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -126,7 +126,6 @@
 	.info = lpc288x_info
 };
 
-
 int lpc288x_register_commands(struct command_context_s *cmd_ctx)
 {
 	return ERROR_OK;
@@ -204,7 +203,7 @@
 
 int lpc288x_protect_check(struct flash_bank_s *bank)
 {
-    return ERROR_OK;
+	return ERROR_OK;
 }
 
 /* flash_bank LPC288x 0 0 0 0 <target#> <cclk> */

Modified: trunk/src/flash/lpc3180_nand_controller.c
===================================================================
--- trunk/src/flash/lpc3180_nand_controller.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/lpc3180_nand_controller.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -69,7 +69,7 @@
 int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device)
 {
 	lpc3180_nand_controller_t *lpc3180_info;
-		
+	
 	if (argc < 3)
 	{
 		LOG_WARNING("incomplete 'lpc3180' nand flash configuration");
@@ -126,7 +126,7 @@
 	
 	if (bypass && !direct)	/* bypass mode */
 		return fclkin / (2 * p);
-		
+	
 	if (bypass & direct)	/* direct bypass mode */
 		return fclkin;
 	
@@ -273,7 +273,7 @@
 		trhz = ((30 / cycle) + 1);
 		trbwb = ((100 / cycle) + 1);
 		tcea = ((45 / cycle) + 1);
-				
+		
 		/* MLC_LOCK = 0xa25e (unlock protected registers) */
 		target_write_u32(target, 0x200b8044, 0xa25e);
 	

Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/mflash.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -80,7 +80,7 @@
 	target_t *target = mflash_bank->target;
 	int ret;
 
-	// remove alternate function.
+	/* remove alternate function. */
 	mask = 0x3u << (gpio.num & 0xF)*2;
 
 	addr = PXA270_GAFR0_L + (gpio.num >> 4) * 4;
@@ -95,7 +95,7 @@
 	if ((ret = target_write_u32(target, addr, value)) != ERROR_OK)
 		return ret;
 
-	// set direction to output
+	/* set direction to output */
 	mask = 0x1u << (gpio.num & 0x1F);
 
 	addr = PXA270_GPDR0 + (gpio.num >> 5) * 4;
@@ -261,75 +261,75 @@
 
 	duration_start_measure(&duration);
 
-    while (time) {
+	while (time) {
 
-    	target_read_u8(target, mg_task_reg + MG_REG_STATUS, &status);
+		target_read_u8(target, mg_task_reg + MG_REG_STATUS, &status);
 
-    	if (status & mg_io_rbit_status_busy)
-	    {
-    		if (wait == mg_io_wait_bsy)
-	               return ERROR_OK;
-	    } else {
-	        switch(wait)
-	        {
-	            case mg_io_wait_not_bsy:
-	                return ERROR_OK;
-	            case mg_io_wait_rdy_noerr:
-	                if (status & mg_io_rbit_status_ready)
-	                    return ERROR_OK;
-	                break;
-	            case mg_io_wait_drq_noerr:
-	                if (status & mg_io_rbit_status_data_req)
-	                    return ERROR_OK;
-	                break;
-	            default:
-	                break;
-	        }
+		if (status & mg_io_rbit_status_busy)
+		{
+			if (wait == mg_io_wait_bsy)
+				return ERROR_OK;
+		} else {
+			switch(wait)
+			{
+				case mg_io_wait_not_bsy:
+					return ERROR_OK;
+				case mg_io_wait_rdy_noerr:
+					if (status & mg_io_rbit_status_ready)
+						return ERROR_OK;
+					break;
+				case mg_io_wait_drq_noerr:
+					if (status & mg_io_rbit_status_data_req)
+						return ERROR_OK;
+					break;
+				default:
+					break;
+			}
 
-	        // Now we check the error condition!
-	        if (status & mg_io_rbit_status_error)
-	        {
-	            target_read_u8(target, mg_task_reg + MG_REG_ERROR, &error);
+			/* Now we check the error condition! */
+			if (status & mg_io_rbit_status_error)
+			{
+				target_read_u8(target, mg_task_reg + MG_REG_ERROR, &error);
 
-                if (error & mg_io_rbit_err_bad_sect_num) {
-                	LOG_ERROR("sector not found");
-                    return ERROR_FAIL;
-                }
-                else if (error & (mg_io_rbit_err_bad_block | mg_io_rbit_err_uncorrectable)) {
-                	LOG_ERROR("bad block");
-                    return ERROR_FAIL;
-                } else {
-                	LOG_ERROR("disk operation fail");
-	                return ERROR_FAIL;
-	            }
-	        }
+				if (error & mg_io_rbit_err_bad_sect_num) {
+					LOG_ERROR("sector not found");
+					return ERROR_FAIL;
+				}
+				else if (error & (mg_io_rbit_err_bad_block | mg_io_rbit_err_uncorrectable)) {
+					LOG_ERROR("bad block");
+					return ERROR_FAIL;
+				} else {
+					LOG_ERROR("disk operation fail");
+					return ERROR_FAIL;
+				}
+			}
 
-	        switch (wait)
-	        {
-	            case mg_io_wait_rdy:
-	                if (status & mg_io_rbit_status_ready)
-	                    return ERROR_OK;
+			switch (wait)
+			{
+				case mg_io_wait_rdy:
+					if (status & mg_io_rbit_status_ready)
+						return ERROR_OK;
 
-	            case mg_io_wait_drq:
-	                if (status & mg_io_rbit_status_data_req)
-	                    return ERROR_OK;
+				case mg_io_wait_drq:
+					if (status & mg_io_rbit_status_data_req)
+						return ERROR_OK;
 
-	            default:
-	            	break;
-	        }
-	    }
+				default:
+					break;
+			}
+		}
 
-    	duration_stop_measure(&duration, NULL);
+		duration_stop_measure(&duration, NULL);
 
-  		t=duration.duration.tv_usec/1000;
-   		t+=duration.duration.tv_sec*1000;
+		t=duration.duration.tv_usec/1000;
+		t+=duration.duration.tv_sec*1000;
 
 		if (t > time)
-            break;
-    }
+			break;
+	}
 
-    LOG_ERROR("timeout occured");
-    return ERROR_FAIL;
+	LOG_ERROR("timeout occured");
+	return ERROR_FAIL;
 }
 
 static int mg_dsk_srst(u8 on)
@@ -634,7 +634,6 @@
 			LOG_DEBUG("copies %u byte", end_addr - cur_addr);
 
 		}
-
 	}
 
 	free(sect_buff);
@@ -671,7 +670,6 @@
 		}
 
 		mg_mflash_write_sects(sect_buff, sect_num, 1);
-
 	}
 
 	if (cur_addr < end_addr) {
@@ -697,9 +695,7 @@
 			memcpy(sect_buff, buff_ptr, end_addr - cur_addr);
 			LOG_DEBUG("copies %u byte", end_addr - cur_addr);
 			mg_mflash_write_sects(sect_buff, sect_num, 1);
-
 		}
-
 	}
 
 	free(sect_buff);
@@ -711,7 +707,7 @@
 {
 	u32 address, buf_cnt;
 	u8 *buffer;
-	// TODO : multi-bank support, large file support
+	/* TODO : multi-bank support, large file support */
 	fileio_t fileio;
 	duration_t duration;
 	char *duration_text;
@@ -727,7 +723,6 @@
 		mg_mflash_probe();
 	}
 
-
 	if (fileio_open(&fileio, args[1], FILEIO_READ, FILEIO_BINARY) != ERROR_OK) {
 		return ERROR_FAIL;
 	}
@@ -764,7 +759,7 @@
 {
 	u32 address, size_written, size;
 	u8 *buffer;
-	// TODO : multi-bank support
+	/* TODO : multi-bank support */
 	fileio_t fileio;
 	duration_t duration;
 	char *duration_text;

Modified: trunk/src/flash/mflash.h
===================================================================
--- trunk/src/flash/mflash.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/mflash.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -39,79 +39,79 @@
 
 typedef struct _mg_io_type_drv_info {
 
-    mg_io_uint16 general_configuration;            // 00
-    mg_io_uint16 number_of_cylinders;               // 01
-    mg_io_uint16 reserved1;                       // 02
-    mg_io_uint16 number_of_heads;                   // 03
-    mg_io_uint16 unformatted_bytes_per_track;        // 04
-    mg_io_uint16 unformatted_bytes_per_sector;       // 05
-    mg_io_uint16 sectors_per_track;                 // 06
-    mg_io_uint8  vendor_unique1[6];                // 07/08/09
+	mg_io_uint16 general_configuration;				/* 00 */
+	mg_io_uint16 number_of_cylinders;				/* 01 */
+	mg_io_uint16 reserved1;							/* 02 */
+	mg_io_uint16 number_of_heads;					/* 03 */
+	mg_io_uint16 unformatted_bytes_per_track;		/* 04 */
+	mg_io_uint16 unformatted_bytes_per_sector;		/* 05 */
+	mg_io_uint16 sectors_per_track;					/* 06 */
+	mg_io_uint8  vendor_unique1[6];					/* 07/08/09 */
 
-    mg_io_uint8  serial_number[20];                // 10~19
+	mg_io_uint8  serial_number[20];					/* 10~19 */
 
-    mg_io_uint16 buffer_type;                      // 20
-    mg_io_uint16 buffer_sector_size;                // 21
-    mg_io_uint16 number_of_ecc_bytes;                // 22
+	mg_io_uint16 buffer_type;						/* 20 */
+	mg_io_uint16 buffer_sector_size;				/* 21 */
+	mg_io_uint16 number_of_ecc_bytes;				/* 22 */
 
-    mg_io_uint8  firmware_revision[8];             // 23~26
-    mg_io_uint8  model_number[40];                 // 27
+	mg_io_uint8  firmware_revision[8];				/* 23~26 */
+	mg_io_uint8  model_number[40];					/* 27 */
 
-    mg_io_uint8  maximum_block_transfer;            // 47 low byte
-    mg_io_uint8  vendor_unique2;                   // 47 high byte
-    mg_io_uint16 dword_io;                    // 48
+	mg_io_uint8  maximum_block_transfer;			/* 47 low byte */
+	mg_io_uint8  vendor_unique2;					/* 47 high byte */
+	mg_io_uint16 dword_io;							/* 48 */
 
-    mg_io_uint16 capabilities;                    // 49
-    mg_io_uint16 reserved2;                       // 50
+	mg_io_uint16 capabilities;						/* 49 */
+	mg_io_uint16 reserved2;							/* 50 */
 
-    mg_io_uint8  vendor_unique3;                   // 51 low byte
-    mg_io_uint8  pio_cycle_timing_mode;              // 51 high byte
-    mg_io_uint8  vendor_unique4;                   // 52 low byte
-    mg_io_uint8  dma_cycle_timing_mode;              // 52 high byte
-    mg_io_uint16 translation_fields_valid;          // 53 (low bit)
-    mg_io_uint16 number_of_current_cylinders;        // 54
-    mg_io_uint16 number_of_current_heads;            // 55
-    mg_io_uint16 current_sectors_per_track;          // 56
-    mg_io_uint16 current_sector_capacity_lo;      // 57 & 58
-    mg_io_uint16 current_sector_capacity_hi;     // 57 & 58
-    mg_io_uint8  multi_sector_count;                // 59 low
-    mg_io_uint8  multi_sector_setting_valid;         // 59 high (low bit)
+	mg_io_uint8  vendor_unique3;					/* 51 low byte */
+	mg_io_uint8  pio_cycle_timing_mode;				/* 51 high byte */
+	mg_io_uint8  vendor_unique4;					/* 52 low byte */
+	mg_io_uint8  dma_cycle_timing_mode;				/* 52 high byte */
+	mg_io_uint16 translation_fields_valid;			/* 53 (low bit) */
+	mg_io_uint16 number_of_current_cylinders;		/* 54 */
+	mg_io_uint16 number_of_current_heads;			/* 55 */
+	mg_io_uint16 current_sectors_per_track;			/* 56 */
+	mg_io_uint16 current_sector_capacity_lo;		/* 57 & 58 */
+	mg_io_uint16 current_sector_capacity_hi;		/* 57 & 58 */
+	mg_io_uint8  multi_sector_count;				/* 59 low */
+	mg_io_uint8  multi_sector_setting_valid;		/* 59 high (low bit) */
 
-    mg_io_uint16 total_user_addressable_sectors_lo;     // 60 & 61
-    mg_io_uint16 total_user_addressable_sectors_hi;     // 60 & 61
+	mg_io_uint16 total_user_addressable_sectors_lo;	/* 60 & 61 */
+	mg_io_uint16 total_user_addressable_sectors_hi;	/* 60 & 61 */
 
-    mg_io_uint8  single_dma_modes_supported;         // 62 low byte
-    mg_io_uint8  single_dma_transfer_active;         // 62 high byte
-    mg_io_uint8  multi_dma_modes_supported;          // 63 low byte
-    mg_io_uint8  multi_dma_transfer_active;          // 63 high byte
-    mg_io_uint16 adv_pio_mode;
-    mg_io_uint16 min_dma_cyc;
-    mg_io_uint16 recommend_dma_cyc;
-    mg_io_uint16 min_pio_cyc_no_iordy;
-    mg_io_uint16 min_pio_cyc_with_iordy;
-    mg_io_uint8  reserved3[22];
-    mg_io_uint16 major_ver_num;
-    mg_io_uint16 minor_ver_num;
-    mg_io_uint16 feature_cmd_set_suprt0;
-    mg_io_uint16 feature_cmd_set_suprt1;
-    mg_io_uint16 feature_cmd_set_suprt2;
-    mg_io_uint16 feature_cmd_set_en0;
-    mg_io_uint16 feature_cmd_set_en1;
-    mg_io_uint16 feature_cmd_set_en2;
-    mg_io_uint16 reserved4;
-    mg_io_uint16 req_time_for_security_er_done;
-    mg_io_uint16 req_time_for_enhan_security_er_done;
-    mg_io_uint16 adv_pwr_mgm_lvl_val;
-    mg_io_uint16 reserved5;
-    mg_io_uint16 re_of_hw_rst;
-    mg_io_uint8  reserved6[68];
-    mg_io_uint16 security_stas;
-    mg_io_uint8  vendor_uniq_bytes[62];
-    mg_io_uint16 cfa_pwr_mode;
-    mg_io_uint8  reserved7[186];
+	mg_io_uint8  single_dma_modes_supported;		/* 62 low byte */
+	mg_io_uint8  single_dma_transfer_active;		/* 62 high byte */
+	mg_io_uint8  multi_dma_modes_supported;			/* 63 low byte */
+	mg_io_uint8  multi_dma_transfer_active;			/* 63 high byte */
+	mg_io_uint16 adv_pio_mode;
+	mg_io_uint16 min_dma_cyc;
+	mg_io_uint16 recommend_dma_cyc;
+	mg_io_uint16 min_pio_cyc_no_iordy;
+	mg_io_uint16 min_pio_cyc_with_iordy;
+	mg_io_uint8  reserved3[22];
+	mg_io_uint16 major_ver_num;
+	mg_io_uint16 minor_ver_num;
+	mg_io_uint16 feature_cmd_set_suprt0;
+	mg_io_uint16 feature_cmd_set_suprt1;
+	mg_io_uint16 feature_cmd_set_suprt2;
+	mg_io_uint16 feature_cmd_set_en0;
+	mg_io_uint16 feature_cmd_set_en1;
+	mg_io_uint16 feature_cmd_set_en2;
+	mg_io_uint16 reserved4;
+	mg_io_uint16 req_time_for_security_er_done;
+	mg_io_uint16 req_time_for_enhan_security_er_done;
+	mg_io_uint16 adv_pwr_mgm_lvl_val;
+	mg_io_uint16 reserved5;
+	mg_io_uint16 re_of_hw_rst;
+	mg_io_uint8  reserved6[68];
+	mg_io_uint16 security_stas;
+	mg_io_uint8  vendor_uniq_bytes[62];
+	mg_io_uint16 cfa_pwr_mode;
+	mg_io_uint8  reserved7[186];
 
-    mg_io_uint16 scts_per_secure_data_unit;
-    mg_io_uint16 integrity_word;
+	mg_io_uint16 scts_per_secure_data_unit;
+	mg_io_uint16 integrity_word;
 
 } mg_io_type_drv_info;
 
@@ -140,105 +140,105 @@
 extern int mflash_register_commands(struct command_context_s *cmd_ctx);
 extern int mflash_init_drivers(struct command_context_s *cmd_ctx);
 
-#define MG_MFLASH_SECTOR_SIZE       (0x200)        //512Bytes = 2^9
-#define MG_MFLASH_SECTOR_SIZE_MASK  (0x200-1)
-#define MG_MFLASH_SECTOR_SIZE_SHIFT (9)
+#define MG_MFLASH_SECTOR_SIZE		(0x200)		/* 512Bytes = 2^9 */
+#define MG_MFLASH_SECTOR_SIZE_MASK	(0x200-1)
+#define MG_MFLASH_SECTOR_SIZE_SHIFT	(9)
 
-#define MG_BUFFER_OFFSET    0x8000
+#define MG_BUFFER_OFFSET	0x8000
 #define MG_REG_OFFSET		0xC000
-#define MG_REG_FEATURE		0x2 // write case
-#define MG_REG_ERROR		0x2 // read case
+#define MG_REG_FEATURE		0x2		/* write case */
+#define MG_REG_ERROR		0x2		/* read case */
 #define MG_REG_SECT_CNT		0x4
 #define MG_REG_SECT_NUM		0x6
 #define MG_REG_CYL_LOW		0x8
 #define MG_REG_CYL_HIGH		0xA
 #define MG_REG_DRV_HEAD		0xC
-#define MG_REG_COMMAND		0xE // write case
-#define MG_REG_STATUS		0xE // read  case
+#define MG_REG_COMMAND		0xE		/* write case */
+#define MG_REG_STATUS		0xE		/* read  case */
 #define MG_REG_DRV_CTRL		0x10
 #define MG_REG_BURST_CTRL	0x12
 
-#define MG_OEM_DISK_WAIT_TIME_LONG   15000 // msec
-#define MG_OEM_DISK_WAIT_TIME_NORMAL  3000 // msec
-#define MG_OEM_DISK_WAIT_TIME_SHORT   1000 // msec
+#define MG_OEM_DISK_WAIT_TIME_LONG		15000	/* msec */
+#define MG_OEM_DISK_WAIT_TIME_NORMAL	3000	/* msec */
+#define MG_OEM_DISK_WAIT_TIME_SHORT		1000	/* msec */
 
 typedef enum _mg_io_type_wait{
 
-    mg_io_wait_bsy       = 1,
-    mg_io_wait_not_bsy   = 2,
-    mg_io_wait_rdy       = 3,
-    mg_io_wait_drq       = 4,  // wait for data request
-    mg_io_wait_drq_noerr = 5,  // wait for DRQ but ignore the error status bit
-    mg_io_wait_rdy_noerr = 6   // wait for ready, but ignore error status bit
+	mg_io_wait_bsy       = 1,
+	mg_io_wait_not_bsy   = 2,
+	mg_io_wait_rdy       = 3,
+	mg_io_wait_drq       = 4,	/* wait for data request */
+	mg_io_wait_drq_noerr = 5,	/* wait for DRQ but ignore the error status bit */
+	mg_io_wait_rdy_noerr = 6	/* wait for ready, but ignore error status bit */
 
 } mg_io_type_wait;
 
-//= "Status Register" bit masks.
+/*= "Status Register" bit masks. */
 typedef enum _mg_io_type_rbit_status{
 
-    mg_io_rbit_status_error            = 0x01, // error bit in status register
-    mg_io_rbit_status_corrected_error  = 0x04, // corrected error in status register
-    mg_io_rbit_status_data_req         = 0x08, // data request bit in status register
-    mg_io_rbit_status_seek_done        = 0x10, // DSC - Drive Seek Complete
-    mg_io_rbit_status_write_fault      = 0x20, // DWF - Drive Write Fault
-    mg_io_rbit_status_ready            = 0x40,
-    mg_io_rbit_status_busy             = 0x80
+	mg_io_rbit_status_error            = 0x01, /* error bit in status register */
+	mg_io_rbit_status_corrected_error  = 0x04, /* corrected error in status register */
+	mg_io_rbit_status_data_req         = 0x08, /* data request bit in status register */
+	mg_io_rbit_status_seek_done        = 0x10, /* DSC - Drive Seek Complete */
+	mg_io_rbit_status_write_fault      = 0x20, /* DWF - Drive Write Fault */
+	mg_io_rbit_status_ready            = 0x40,
+	mg_io_rbit_status_busy             = 0x80
 
 } mg_io_type_rbit_status;
 
-//= "Error Register" bit masks.
+/*= "Error Register" bit masks. */
 typedef enum _mg_io_type_rbit_error{
 
-    mg_io_rbit_err_general          = 0x01,
-    mg_io_rbit_err_aborted          = 0x04,
-    mg_io_rbit_err_bad_sect_num     = 0x10,
-    mg_io_rbit_err_uncorrectable    = 0x40,
-    mg_io_rbit_err_bad_block        = 0x80
+	mg_io_rbit_err_general          = 0x01,
+	mg_io_rbit_err_aborted          = 0x04,
+	mg_io_rbit_err_bad_sect_num     = 0x10,
+	mg_io_rbit_err_uncorrectable    = 0x40,
+	mg_io_rbit_err_bad_block        = 0x80
 
 } mg_io_type_rbit_error;
 
-//= "Device Control Register" bit.
+/* = "Device Control Register" bit. */
 typedef enum _mg_io_type_rbit_devc{
 
-    mg_io_rbit_devc_intr      = 0x02,//  interrupt enable bit (1:disable, 0:enable)
-    mg_io_rbit_devc_srst      = 0x04  // softwrae reset bit (1:assert, 0:de-assert)
+	mg_io_rbit_devc_intr      = 0x02,	/* interrupt enable bit (1:disable, 0:enable) */
+	mg_io_rbit_devc_srst      = 0x04	/* softwrae reset bit (1:assert, 0:de-assert) */
 
 } mg_io_type_rbit_devc;
 
-// "Drive Select/Head Register" values.
+/* "Drive Select/Head Register" values. */
 typedef enum _mg_io_type_rval_dev{
 
-    mg_io_rval_dev_must_be_on      =   0x80, // These 1 bits are always on
-    mg_io_rval_dev_drv_master      =  (0x00 | mg_io_rval_dev_must_be_on),// Master
-    mg_io_rval_dev_drv_slave0      =  (0x10 | mg_io_rval_dev_must_be_on),// Slave0
-    mg_io_rval_dev_drv_slave1      =  (0x20 | mg_io_rval_dev_must_be_on),// Slave1
-    mg_io_rval_dev_drv_slave2      =  (0x30 | mg_io_rval_dev_must_be_on),// Slave2
-    mg_io_rval_dev_lba_mode        =  (0x40 | mg_io_rval_dev_must_be_on)
+	mg_io_rval_dev_must_be_on      =   0x80, /* These 1 bits are always on */
+	mg_io_rval_dev_drv_master      =  (0x00 | mg_io_rval_dev_must_be_on), /* Master */
+	mg_io_rval_dev_drv_slave0      =  (0x10 | mg_io_rval_dev_must_be_on), /* Slave0 */
+	mg_io_rval_dev_drv_slave1      =  (0x20 | mg_io_rval_dev_must_be_on), /* Slave1 */
+	mg_io_rval_dev_drv_slave2      =  (0x30 | mg_io_rval_dev_must_be_on), /* Slave2 */
+	mg_io_rval_dev_lba_mode        =  (0x40 | mg_io_rval_dev_must_be_on)
 
 } mg_io_type_rval_dev;
 
 typedef enum _mg_io_type_cmd
 {
-    mg_io_cmd_read             =0x20,
-    mg_io_cmd_write            =0x30,
+	mg_io_cmd_read             =0x20,
+	mg_io_cmd_write            =0x30,
 
-    mg_io_cmd_setmul           =0xC6,
-    mg_io_cmd_readmul          =0xC4,
-    mg_io_cmd_writemul         =0xC5,
+	mg_io_cmd_setmul           =0xC6,
+	mg_io_cmd_readmul          =0xC4,
+	mg_io_cmd_writemul         =0xC5,
 
-    mg_io_cmd_idle             =0x97,//0xE3
-    mg_io_cmd_idle_immediate   =0x95,//0xE1
+	mg_io_cmd_idle             =0x97, /* 0xE3 */
+	mg_io_cmd_idle_immediate   =0x95, /* 0xE1 */
 
-    mg_io_cmd_setsleep         =0x99,//0xE6
-    mg_io_cmd_stdby            =0x96,//0xE2
-    mg_io_cmd_stdby_immediate  =0x94,//0xE0
+	mg_io_cmd_setsleep         =0x99, /* 0xE6 */
+	mg_io_cmd_stdby            =0x96, /* 0xE2 */
+	mg_io_cmd_stdby_immediate  =0x94, /* 0xE0 */
 
-    mg_io_cmd_identify         =0xEC,
-    mg_io_cmd_set_feature      =0xEF,
+	mg_io_cmd_identify         =0xEC,
+	mg_io_cmd_set_feature      =0xEF,
 
-    mg_io_cmd_confirm_write    =0x3C,
-    mg_io_cmd_confirm_read     =0x40,
-    mg_io_cmd_wakeup           =0xC3
+	mg_io_cmd_confirm_write    =0x3C,
+	mg_io_cmd_confirm_read     =0x40,
+	mg_io_cmd_wakeup           =0xC3
 
 } mg_io_type_cmd;
 

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/nand.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -1524,4 +1524,3 @@
 	
 	return ERROR_OK;
 }
-

Modified: trunk/src/flash/s3c24xx_regs_nand.h
===================================================================
--- trunk/src/flash/s3c24xx_regs_nand.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/s3c24xx_regs_nand.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -85,11 +85,11 @@
 #define S3C2440_NFCONT_SPARE_ECCLOCK	(1<<6)
 #define S3C2440_NFCONT_MAIN_ECCLOCK	(1<<5)
 #define S3C2440_NFCONT_INITECC		(1<<4)
-#define S3C2440_NFCONT_nFCE		(1<<1)
+#define S3C2440_NFCONT_nFCE			(1<<1)
 #define S3C2440_NFCONT_ENABLE		(1<<0)
 
 #define S3C2440_NFSTAT_READY		(1<<0)
-#define S3C2440_NFSTAT_nCE		(1<<1)
+#define S3C2440_NFSTAT_nCE			(1<<1)
 #define S3C2440_NFSTAT_RnB_CHANGE	(1<<2)
 #define S3C2440_NFSTAT_ILLEGAL_ACCESS	(1<<3)
 
@@ -114,13 +114,13 @@
 #define S3C2412_NFSTAT_RnB_CHANGE	(1<<4)
 #define S3C2412_NFSTAT_nFCE1		(1<<3)
 #define S3C2412_NFSTAT_nFCE0		(1<<2)
-#define S3C2412_NFSTAT_Res1		(1<<1)
+#define S3C2412_NFSTAT_Res1			(1<<1)
 #define S3C2412_NFSTAT_READY		(1<<0)
 
 #define S3C2412_NFECCERR_SERRDATA(x)	(((x) >> 21) & 0xf)
-#define S3C2412_NFECCERR_SERRBIT(x)	(((x) >> 18) & 0x7)
+#define S3C2412_NFECCERR_SERRBIT(x)		(((x) >> 18) & 0x7)
 #define S3C2412_NFECCERR_MERRDATA(x)	(((x) >> 7) & 0x3ff)
-#define S3C2412_NFECCERR_MERRBIT(x)	(((x) >> 4) & 0x7)
+#define S3C2412_NFECCERR_MERRBIT(x)		(((x) >> 4) & 0x7)
 #define S3C2412_NFECCERR_SPARE_ERR(x)	(((x) >> 2) & 0x3)
 #define S3C2412_NFECCERR_MAIN_ERR(x)	(((x) >> 2) & 0x3)
 #define S3C2412_NFECCERR_NONE		(0)

Modified: trunk/src/flash/stellaris.h
===================================================================
--- trunk/src/flash/stellaris.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/stellaris.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -83,7 +83,6 @@
 #define AMASK	1
 #define PMASK	2
 
-
 /* Flash Controller Command bits */
 #define FMC_WRKEY	(0xA442<<16)
 #define FMC_COMT	(1<<3)

Modified: trunk/src/flash/stm32x.h
===================================================================
--- trunk/src/flash/stm32x.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/stm32x.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -100,4 +100,3 @@
 } stm32x_mem_layout_t;
 
 #endif /* STM32X_H */
-

Modified: trunk/src/flash/str7x.c
===================================================================
--- trunk/src/flash/str7x.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/str7x.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -717,4 +717,3 @@
 	
 	return ERROR_OK;
 }
-

Modified: trunk/src/flash/str7x.h
===================================================================
--- trunk/src/flash/str7x.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/str7x.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -109,4 +109,3 @@
 } str7x_mem_layout_t;
 
 #endif /* STR7X_H */
-

Modified: trunk/src/flash/str9x.h
===================================================================
--- trunk/src/flash/str9x.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/str9x.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -50,7 +50,7 @@
 	STR9X_BUSY = 11
 };
 
-/*  Flash registers */
+/* Flash registers */
 
 #define FLASH_BBSR		0x54000000		/* Boot Bank Size Register                */
 #define FLASH_NBBSR		0x54000004		/* Non-Boot Bank Size Register            */
@@ -61,4 +61,3 @@
 #define FLASH_BCE5ADDR	0x54000020		/* BC Fifth Entry Target Address Register */
 
 #endif /* STR9X_H */
-

Modified: trunk/src/flash/tms470.c
===================================================================
--- trunk/src/flash/tms470.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/flash/tms470.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -73,7 +73,7 @@
 };
 
 #define TMS470R1A256_NUM_SECTORS \
-  (sizeof(TMS470R1A256_SECTORS)/sizeof(TMS470R1A256_SECTORS[0]))
+	(sizeof(TMS470R1A256_SECTORS)/sizeof(TMS470R1A256_SECTORS[0]))
 
 const flash_sector_t TMS470R1A288_BANK0_SECTORS[] = {
 	{0x00000000, 0x00002000, -1, -1},
@@ -83,7 +83,7 @@
 };
 
 #define TMS470R1A288_BANK0_NUM_SECTORS \
-  (sizeof(TMS470R1A288_BANK0_SECTORS)/sizeof(TMS470R1A288_BANK0_SECTORS[0]))
+	(sizeof(TMS470R1A288_BANK0_SECTORS)/sizeof(TMS470R1A288_BANK0_SECTORS[0]))
 
 const flash_sector_t TMS470R1A288_BANK1_SECTORS[] = {
 	{0x00040000, 0x00010000, -1, -1},
@@ -93,43 +93,43 @@
 };
 
 #define TMS470R1A288_BANK1_NUM_SECTORS \
-  (sizeof(TMS470R1A288_BANK1_SECTORS)/sizeof(TMS470R1A288_BANK1_SECTORS[0]))
+	(sizeof(TMS470R1A288_BANK1_SECTORS)/sizeof(TMS470R1A288_BANK1_SECTORS[0]))
 
 const flash_sector_t TMS470R1A384_BANK0_SECTORS[] = {
-    {0x00000000, 0x00002000, -1, -1},
-    {0x00002000, 0x00002000, -1, -1},
-    {0x00004000, 0x00004000, -1, -1},
-    {0x00008000, 0x00004000, -1, -1},
-    {0x0000C000, 0x00004000, -1, -1},
-    {0x00010000, 0x00004000, -1, -1},
-    {0x00014000, 0x00004000, -1, -1},
-    {0x00018000, 0x00002000, -1, -1},
-    {0x0001C000, 0x00002000, -1, -1},
-    {0x0001E000, 0x00002000, -1, -1},
+	{0x00000000, 0x00002000, -1, -1},
+	{0x00002000, 0x00002000, -1, -1},
+	{0x00004000, 0x00004000, -1, -1},
+	{0x00008000, 0x00004000, -1, -1},
+	{0x0000C000, 0x00004000, -1, -1},
+	{0x00010000, 0x00004000, -1, -1},
+	{0x00014000, 0x00004000, -1, -1},
+	{0x00018000, 0x00002000, -1, -1},
+	{0x0001C000, 0x00002000, -1, -1},
+	{0x0001E000, 0x00002000, -1, -1},
 };
 
 #define TMS470R1A384_BANK0_NUM_SECTORS \
-  (sizeof(TMS470R1A384_BANK0_SECTORS)/sizeof(TMS470R1A384_BANK0_SECTORS[0]))
+	(sizeof(TMS470R1A384_BANK0_SECTORS)/sizeof(TMS470R1A384_BANK0_SECTORS[0]))
 
 const flash_sector_t TMS470R1A384_BANK1_SECTORS[] = {
-    {0x00020000, 0x00008000, -1, -1},
-    {0x00028000, 0x00008000, -1, -1},
-    {0x00030000, 0x00008000, -1, -1},
-    {0x00038000, 0x00008000, -1, -1},
+	{0x00020000, 0x00008000, -1, -1},
+	{0x00028000, 0x00008000, -1, -1},
+	{0x00030000, 0x00008000, -1, -1},
+	{0x00038000, 0x00008000, -1, -1},
 };
 
 #define TMS470R1A384_BANK1_NUM_SECTORS \
-  (sizeof(TMS470R1A384_BANK1_SECTORS)/sizeof(TMS470R1A384_BANK1_SECTORS[0]))
+	(sizeof(TMS470R1A384_BANK1_SECTORS)/sizeof(TMS470R1A384_BANK1_SECTORS[0]))
 
 const flash_sector_t TMS470R1A384_BANK2_SECTORS[] = {
-    {0x00040000, 0x00008000, -1, -1},
-    {0x00048000, 0x00008000, -1, -1},
-    {0x00050000, 0x00008000, -1, -1},
-    {0x00058000, 0x00008000, -1, -1},
+	{0x00040000, 0x00008000, -1, -1},
+	{0x00048000, 0x00008000, -1, -1},
+	{0x00050000, 0x00008000, -1, -1},
+	{0x00058000, 0x00008000, -1, -1},
 };
 
 #define TMS470R1A384_BANK2_NUM_SECTORS \
-  (sizeof(TMS470R1A384_BANK2_SECTORS)/sizeof(TMS470R1A384_BANK2_SECTORS[0]))
+	(sizeof(TMS470R1A384_BANK2_SECTORS)/sizeof(TMS470R1A384_BANK2_SECTORS[0]))
 
 /* ---------------------------------------------------------------------- */
 
@@ -229,56 +229,56 @@
 		}
 		break;
 
-    case 0x2d:
-        part_name = "TMS470R1A384";
+	case 0x2d:
+		part_name = "TMS470R1A384";
 
-        if ((bank->base >= 0x00000000) && (bank->base < 0x00020000))
-        {
-            tms470_info->ordinal = 0;
-            bank->base = 0x00000000;
-            bank->size = 128 * 1024;
-            bank->num_sectors = TMS470R1A384_BANK0_NUM_SECTORS;
-            bank->sectors = malloc(sizeof(TMS470R1A384_BANK0_SECTORS));
-            if (!bank->sectors)
-            {
-                return ERROR_FLASH_OPERATION_FAILED;
-            }
-            (void)memcpy(bank->sectors, TMS470R1A384_BANK0_SECTORS, sizeof(TMS470R1A384_BANK0_SECTORS));
-        }
-        else if ((bank->base >= 0x00020000) && (bank->base < 0x00040000))
-        {
-            tms470_info->ordinal = 1;
-            bank->base = 0x00020000;
-            bank->size = 128 * 1024;
-            bank->num_sectors = TMS470R1A384_BANK1_NUM_SECTORS;
-            bank->sectors = malloc(sizeof(TMS470R1A384_BANK1_SECTORS));
-            if (!bank->sectors)
-            {
-                return ERROR_FLASH_OPERATION_FAILED;
-            }
-            (void)memcpy(bank->sectors, TMS470R1A384_BANK1_SECTORS, sizeof(TMS470R1A384_BANK1_SECTORS));
-        }
-        else if ((bank->base >= 0x00040000) && (bank->base < 0x00060000))
-        {
-            tms470_info->ordinal = 2;
-            bank->base = 0x00040000;
-            bank->size = 128 * 1024;
-            bank->num_sectors = TMS470R1A384_BANK2_NUM_SECTORS;
-            bank->sectors = malloc(sizeof(TMS470R1A384_BANK2_SECTORS));
-            if (!bank->sectors)
-            {
-                return ERROR_FLASH_OPERATION_FAILED;
-            }
-            (void)memcpy(bank->sectors, TMS470R1A384_BANK2_SECTORS, sizeof(TMS470R1A384_BANK2_SECTORS));
-        }
-        else
-        {
-            LOG_ERROR("No %s flash bank contains base address 0x%08x.", part_name, bank->base);
-            return ERROR_FLASH_OPERATION_FAILED;
-        }
-        break;
+		if ((bank->base >= 0x00000000) && (bank->base < 0x00020000))
+		{
+			tms470_info->ordinal = 0;
+			bank->base = 0x00000000;
+			bank->size = 128 * 1024;
+			bank->num_sectors = TMS470R1A384_BANK0_NUM_SECTORS;
+			bank->sectors = malloc(sizeof(TMS470R1A384_BANK0_SECTORS));
+			if (!bank->sectors)
+			{
+				return ERROR_FLASH_OPERATION_FAILED;
+			}
+			(void)memcpy(bank->sectors, TMS470R1A384_BANK0_SECTORS, sizeof(TMS470R1A384_BANK0_SECTORS));
+		}
+		else if ((bank->base >= 0x00020000) && (bank->base < 0x00040000))
+		{
+			tms470_info->ordinal = 1;
+			bank->base = 0x00020000;
+			bank->size = 128 * 1024;
+			bank->num_sectors = TMS470R1A384_BANK1_NUM_SECTORS;
+			bank->sectors = malloc(sizeof(TMS470R1A384_BANK1_SECTORS));
+			if (!bank->sectors)
+			{
+				return ERROR_FLASH_OPERATION_FAILED;
+			}
+			(void)memcpy(bank->sectors, TMS470R1A384_BANK1_SECTORS, sizeof(TMS470R1A384_BANK1_SECTORS));
+		}
+		else if ((bank->base >= 0x00040000) && (bank->base < 0x00060000))
+		{
+			tms470_info->ordinal = 2;
+			bank->base = 0x00040000;
+			bank->size = 128 * 1024;
+			bank->num_sectors = TMS470R1A384_BANK2_NUM_SECTORS;
+			bank->sectors = malloc(sizeof(TMS470R1A384_BANK2_SECTORS));
+			if (!bank->sectors)
+			{
+				return ERROR_FLASH_OPERATION_FAILED;
+			}
+			(void)memcpy(bank->sectors, TMS470R1A384_BANK2_SECTORS, sizeof(TMS470R1A384_BANK2_SECTORS));
+		}
+		else
+		{
+			LOG_ERROR("No %s flash bank contains base address 0x%08x.", part_name, bank->base);
+			return ERROR_FLASH_OPERATION_FAILED;
+		}
+		break;
 
-    default:
+	default:
 		LOG_WARNING("Could not identify part 0x%02x as a member of the TMS470 family.", part_number);
 		return ERROR_FLASH_OPERATION_FAILED;
 	}

Modified: trunk/src/helper/bin2char.c
===================================================================
--- trunk/src/helper/bin2char.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/bin2char.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -30,7 +30,7 @@
 	if (argc == 1) {
 		fprintf(stderr, "bin2char <varname>\n");
 		fprintf(stderr, "read from standard input and write a char"
-		    " array out to standard output\n");
+			" array out to standard output\n");
 		exit(1);
 	}
 

Modified: trunk/src/helper/binarybuffer.c
===================================================================
--- trunk/src/helper/binarybuffer.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/binarybuffer.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -210,7 +210,7 @@
 	else if (radix == 10)
 	{
 		factor = 2.40824;   /* log(256) / log(10) = 2.40824 */
-    }
+	}
 	else if (radix == 8)
 	{
 		factor = 2.66667;	/* log(256) / log(8) = 2.66667 */
@@ -222,20 +222,20 @@
 	str = calloc(str_len + 1, 1);
 	
 	for (i = b256_len - 1; i >= 0; i--)
-    {
-        tmp = buf[i];
-    	if ((i == (buf_len / 8)) && (buf_len % 8))
-    		tmp &= (0xff >> (8 - (buf_len % 8)));
+	{
+		tmp = buf[i];
+		if ((i == (buf_len / 8)) && (buf_len % 8))
+			tmp &= (0xff >> (8 - (buf_len % 8)));
 
-        for (j = str_len; j > 0; j--)
-        {
-            tmp += (u32)str[j-1] * 256;
-            str[j-1] = (u8)(tmp % radix);
-            tmp /= radix;
-        }
-    }
-    
-    for (j = 0; j < str_len; j++)
+		for (j = str_len; j > 0; j--)
+		{
+			tmp += (u32)str[j-1] * 256;
+			str[j-1] = (u8)(tmp % radix);
+			tmp /= radix;
+		}
+	}
+
+	for (j = 0; j < str_len; j++)
 		str[j] = DIGITS[(int)str[j]];
 	
 	return str;
@@ -295,23 +295,23 @@
 	for (i = 0; charbuf[i]; i++)
 	{ 
 		tmp = charbuf[i];
-        if ((tmp >= '0') && (tmp <= '9'))
-        	tmp = (tmp - '0');
-        else if ((tmp >= 'a') && (tmp <= 'f'))
-        	tmp = (tmp - 'a' + 10);
-        else if ((tmp >= 'A') && (tmp <= 'F'))
-        	tmp = (tmp - 'A' + 10);
-        else continue;	/* skip characters other than [0-9,a-f,A-F] */
+		if ((tmp >= '0') && (tmp <= '9'))
+			tmp = (tmp - '0');
+		else if ((tmp >= 'a') && (tmp <= 'f'))
+			tmp = (tmp - 'a' + 10);
+		else if ((tmp >= 'A') && (tmp <= 'F'))
+			tmp = (tmp - 'A' + 10);
+		else continue;	/* skip characters other than [0-9,a-f,A-F] */
 		
 		if (tmp >= radix)
 			continue;	/* skip digits invalid for the current radix */ 
 		
 		for (j = 0; j < b256_len; j++)
-        {
-            tmp += (u32)b256_buf[j] * radix;
-            b256_buf[j] = (u8)(tmp & 0xFF);
-            tmp >>= 8;
-        }
+		{
+			tmp += (u32)b256_buf[j] * radix;
+			b256_buf[j] = (u8)(tmp & 0xFF);
+			tmp >>= 8;
+		}
 		
 	}
 	

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/command.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -229,9 +229,9 @@
 	free((void *)override_name);
 
 	/* accumulate help text in Tcl helptext list.  */
-    Jim_Obj *helptext=Jim_GetGlobalVariableStr(interp, "ocd_helptext", JIM_ERRMSG);
-    if (Jim_IsShared(helptext))
-        helptext = Jim_DuplicateObj(interp, helptext);
+	Jim_Obj *helptext=Jim_GetGlobalVariableStr(interp, "ocd_helptext", JIM_ERRMSG);
+	if (Jim_IsShared(helptext))
+		helptext = Jim_DuplicateObj(interp, helptext);
 	Jim_Obj *cmd_entry=Jim_NewListObj(interp, NULL, 0);
 
 	Jim_Obj *cmd_list=Jim_NewListObj(interp, NULL, 0);
@@ -356,8 +356,8 @@
 		 * The latter bit isn't precisely neat, but will do for now.
 		 */
 		LOG_USER_N("%s", string);
-		// We already printed it above
-		//command_output_text(context, string);
+		/* We already printed it above */
+		/* command_output_text(context, string); */
 		free(string);
 	}
 
@@ -381,8 +381,8 @@
 		 * The latter bit isn't precisely neat, but will do for now.
 		 */
 		LOG_USER_N("%s", string);
-		// We already printed it above
-		//command_output_text(context, string);
+		/* We already printed it above */
+		/* command_output_text(context, string); */
 		free(string);
 	}
 
@@ -644,7 +644,6 @@
 	return NULL;
 }
 
-
 static int jim_capture(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 {
 	if (argc != 2)
@@ -801,7 +800,7 @@
 	Jim_CreateCommand(interp, name, cmd, NULL, NULL);
 
 	/* FIX!!! it would be prettier to invoke add_help_text...
-	   accumulate help text in Tcl helptext list.  */
+	 * accumulate help text in Tcl helptext list.  */
 	Jim_Obj *helptext=Jim_GetGlobalVariableStr(interp, "ocd_helptext", JIM_ERRMSG);
 	if (Jim_IsShared(helptext))
 		helptext = Jim_DuplicateObj(interp, helptext);
@@ -816,7 +815,6 @@
 	Jim_ListAppendElement(interp, helptext, cmd_entry);
 }
 
-
 /* return global variable long value or 0 upon failure */
 long jim_global_long(const char *variable)
 {

Modified: trunk/src/helper/configuration.c
===================================================================
--- trunk/src/helper/configuration.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/configuration.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -91,7 +91,6 @@
 	return NULL;
 }
 
-
 FILE *open_file_from_path (char *file, char *mode)
 {
 	if (mode[0]!='r')

Modified: trunk/src/helper/fileio.h
===================================================================
--- trunk/src/helper/fileio.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/fileio.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -44,7 +44,6 @@
 	FILEIO_BINARY,
 };
 
-
 enum fileio_access
 {
 	FILEIO_READ,		/* open for reading, position at beginning */
@@ -71,7 +70,7 @@
 extern int fileio_open(fileio_t *fileio, char *url, enum fileio_access access, enum fileio_type type);
 extern int fileio_read_u32(fileio_t *fileio, u32 *data);
 extern int fileio_write_u32(fileio_t *fileio, u32 data);
-	
+
 #define ERROR_FILEIO_LOCATION_UNKNOWN	(-1200)
 #define ERROR_FILEIO_NOT_FOUND			(-1201)
 #define ERROR_FILEIO_OPERATION_FAILED		(-1202)

Modified: trunk/src/helper/log.c
===================================================================
--- trunk/src/helper/log.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/log.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -413,7 +413,6 @@
 	}
 }
 
-
 void busy_sleep(int ms)
 {
 	long long then;

Modified: trunk/src/helper/log.h
===================================================================
--- trunk/src/helper/log.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/log.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -124,6 +124,6 @@
 /* see "Error:" log entry for meaningful message to the user. The caller should 
  * make no assumptions about what went wrong and try to handle the problem.
  */
-#define ERROR_FAIL       			(-4)
+#define ERROR_FAIL					(-4)
 
 #endif /* LOG_H */

Modified: trunk/src/helper/options.c
===================================================================
--- trunk/src/helper/options.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/options.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -163,6 +163,5 @@
 		exit(-1);
 	}	
 
-
 	return ERROR_OK;
 }

Modified: trunk/src/helper/replacements.c
===================================================================
--- trunk/src/helper/replacements.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/replacements.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -82,19 +82,19 @@
 
 int gettimeofday(struct timeval *tv, struct timezone *tz)
 {
-	FILETIME        ft;
-	LARGE_INTEGER   li;
-	__int64         t;
-	static int      tzflag;
+	FILETIME ft;
+	LARGE_INTEGER li;
+	__int64 t;
+	static int tzflag;
 
 	if (tv)
 	{
 		GetSystemTimeAsFileTime(&ft);
 		li.LowPart  = ft.dwLowDateTime;
 		li.HighPart = ft.dwHighDateTime;
-		t  = li.QuadPart;                   /* In 100-nanosecond intervals */
-		t -= EPOCHFILETIME;                 /* Offset to the Epoch time */
-		t /= 10;                            /* In microseconds */
+		t  = li.QuadPart;					/* In 100-nanosecond intervals */
+		t -= EPOCHFILETIME;					/* Offset to the Epoch time */
+		t /= 10;							/* In microseconds */
 		tv->tv_sec  = (long)(t / 1000000);
 		tv->tv_usec = (long)(t % 1000000);
 	}

Modified: trunk/src/helper/replacements.h
===================================================================
--- trunk/src/helper/replacements.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/replacements.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -87,7 +87,7 @@
 
 #ifdef _WIN32
 struct timezone {
-    int tz_minuteswest;
+	int tz_minuteswest;
 	int tz_dsttime;
 };
 #endif
@@ -181,27 +181,27 @@
 static __inline int write_socket( int handle, const void *buffer, unsigned int count )
 {
 #ifdef _WIN32
-    return send(handle, buffer, count, 0);
+	return send(handle, buffer, count, 0);
 #else
-    return write(handle, buffer, count);
+	return write(handle, buffer, count);
 #endif
 }
 
 static __inline int read_socket( int handle, void *buffer, unsigned int count )
 {
 #ifdef _WIN32
-    return recv(handle, buffer, count, 0);
+	return recv(handle, buffer, count, 0);
 #else
-    return read(handle, buffer, count);
+	return read(handle, buffer, count);
 #endif
 }
 
 static __inline int close_socket(int sock)
 {
 #ifdef _WIN32
-    return closesocket(sock);
+	return closesocket(sock);
 #else
-    return close(sock);
+	return close(sock);
 #endif
 }
 
@@ -229,9 +229,9 @@
 	u32	e_shoff;		/* Section header table file offset */
 	u32	e_flags;		/* Processor-specific flags */
 	u16	e_ehsize;		/* ELF header size in bytes */
-	u16	e_phentsize;		/* Program header table entry size */
+	u16	e_phentsize;	/* Program header table entry size */
 	u16	e_phnum;		/* Program header table entry count */
-	u16	e_shentsize;		/* Section header table entry size */
+	u16	e_shentsize;	/* Section header table entry size */
 	u16	e_shnum;		/* Section header table entry count */
 	u16	e_shstrndx;		/* Section header string table index */
 } Elf32_Ehdr;

Modified: trunk/src/helper/tclapi.c
===================================================================
--- trunk/src/helper/tclapi.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/tclapi.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -525,7 +525,6 @@
 	return JIM_OK;
 }
 
-
 int tclapi_register_commands()
 {
 	register_jim("ocd_mem2array", jim_mem2array, "read memory and return as a TCL array for script processing");

Modified: trunk/src/helper/types.h
===================================================================
--- trunk/src/helper/types.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/helper/types.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -43,10 +43,8 @@
 typedef unsigned long long u64;
 #endif
 
-
 typedef struct jtag_tap_s jtag_tap_t;
 
-
 /* DANGER!!!! here be dragons! Note that the pointer in 
  * memory might be unaligned. On some CPU's, i.e. ARM7,
  * the 2 lsb are ignored for 32 bit access, on others
@@ -59,26 +57,25 @@
 #define be_to_h_u16(x) ((u16)((x)[1] | (x)[0] << 8))
 
 #define h_u32_to_le(buf, val) do {\
-(buf)[3] = ((val) & 0xff000000) >> 24;\
-(buf)[2] = ((val) & 0x00ff0000) >> 16;\
-(buf)[1] = ((val) & 0x0000ff00) >> 8;\
-(buf)[0] = ((val) & 0x000000ff);\
+	(buf)[3] = ((val) & 0xff000000) >> 24;\
+	(buf)[2] = ((val) & 0x00ff0000) >> 16;\
+	(buf)[1] = ((val) & 0x0000ff00) >> 8;\
+	(buf)[0] = ((val) & 0x000000ff);\
 } while (0)
 #define h_u32_to_be(buf, val) do {\
-(buf)[0] = ((val) & 0xff000000) >> 24;\
-(buf)[1] = ((val) & 0x00ff0000) >> 16;\
-(buf)[2] = ((val) & 0x0000ff00) >> 8;\
-(buf)[3] = ((val) & 0x000000ff);\
+	(buf)[0] = ((val) & 0xff000000) >> 24;\
+	(buf)[1] = ((val) & 0x00ff0000) >> 16;\
+	(buf)[2] = ((val) & 0x0000ff00) >> 8;\
+	(buf)[3] = ((val) & 0x000000ff);\
 } while (0)
 
 #define h_u16_to_le(buf, val) do {\
-(buf)[1] = ((val) & 0xff00) >> 8;\
-(buf)[0] = ((val) & 0x00ff) >> 0;\
+	(buf)[1] = ((val) & 0xff00) >> 8;\
+	(buf)[0] = ((val) & 0x00ff) >> 0;\
 } while (0)
 #define h_u16_to_be(buf, val) do {\
-(buf)[0] = ((val) & 0xff00) >> 8;\
-(buf)[1] = ((val) & 0x00ff) >> 0;\
+	(buf)[0] = ((val) & 0xff00) >> 8;\
+	(buf)[1] = ((val) & 0x00ff) >> 0;\
 } while (0)
 
-
 #endif /* TYPES_H */

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/jtag/bitbang.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -39,7 +39,6 @@
 
 bitbang_interface_t *bitbang_interface;
 
-
 /* DANGER!!!! clock absolutely *MUST* be 0 in idle or reset won't work!
  *
  * Set this to 1 and str912 reset halt will fail.
@@ -316,4 +315,3 @@
 
 	return retval;
 }
-

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/jtag/bitq.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -34,7 +34,6 @@
 #include <stdlib.h>
 #include <unistd.h>
 
-
 bitq_interface_t *bitq_interface; /* low level bit queue interface */
 
 bitq_state_t bitq_in_state; /* state of input queue */
@@ -42,7 +41,6 @@
 u8 *bitq_in_buffer; /* buffer dynamically reallocated as needed */
 unsigned long bitq_in_bufsize=32; /* min. buffer size */
 
-
 /*
  * input queue processing does not use jtag_read_buffer() to avoid unnecessary overhead
  * also the buffer for incomming data is reallocated only if necessary
@@ -129,8 +127,6 @@
 	}
 }
 
-
-
 void bitq_io(int tms, int tdi, int tdo_req)
 {
 	bitq_interface->out(tms, tdi, tdo_req);
@@ -138,7 +134,6 @@
 	if (bitq_interface->in_rdy()) bitq_in_proc();
 }
 
-
 void bitq_end_state(enum tap_state state)
 {
 	if (state==-1) return;
@@ -149,7 +144,6 @@
 	end_state = state;
 }
 
-
 void bitq_state_move(enum tap_state new_state)
 {
 	int i=0;
@@ -170,7 +164,6 @@
 	cur_state = new_state;
 }
 
-
 void bitq_path_move(pathmove_command_t *cmd)
 {
 	int i;
@@ -189,7 +182,6 @@
 	end_state = cur_state;
 }
 
-
 void bitq_runtest(int num_cycles)
 {
 	int i;
@@ -205,7 +197,6 @@
 	if (cur_state != end_state) bitq_state_move(end_state);
 }
 
-
 void bitq_scan_field(scan_field_t *field, int pause)
 {
 	int bit_cnt;
@@ -245,7 +236,6 @@
 	}
 }
 
-
 void bitq_scan(scan_command_t *cmd)
 {
 	int i;
@@ -258,7 +248,6 @@
 	bitq_scan_field(&cmd->fields[i], 1);
 }
 
-
 int bitq_execute_queue(void)
 {
 	jtag_command_t *cmd = jtag_command_queue; /* currently processed command */
@@ -356,7 +345,6 @@
 	return bitq_in_state.status;
 }
 
-
 void bitq_cleanup(void)
 {
 	if (bitq_in_buffer!=NULL)

Modified: trunk/src/jtag/dummy.c
===================================================================
--- trunk/src/jtag/dummy.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/jtag/dummy.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -26,7 +26,6 @@
 #include "jtag.h"
 #include "bitbang.h"
 
-
 int dummy_speed(int speed);
 int dummy_register_commands(struct command_context_s *cmd_ctx);
 int dummy_init(void);
@@ -65,7 +64,6 @@
 	return 1;
 }
 
-
 void dummy_write(int tck, int tms, int tdi)
 {
 }
@@ -73,7 +71,6 @@
 void dummy_reset(int trst, int srst)
 {
 }
-	
 
 int dummy_speed(int speed)
 {
@@ -85,7 +82,6 @@
 	return ERROR_OK;
 }
 
-
 int dummy_init(void)
 {
 	bitbang_interface = &dummy_bitbang;	
@@ -98,8 +94,6 @@
 	return ERROR_OK;
 }
 
-
 void dummy_led(int on)
 {
 }
-

Modified: trunk/src/jtag/ep93xx.c
===================================================================
--- trunk/src/jtag/ep93xx.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/jtag/ep93xx.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -64,7 +64,7 @@
 jtag_interface_t ep93xx_interface = 
 {
 	.name = "ep93xx",
-	
+
 	.execute_queue = bitbang_execute_queue,
 
 	.speed = ep93xx_speed,	
@@ -126,7 +126,7 @@
 
 int ep93xx_speed(int speed)
 {
-	
+
 	return ERROR_OK;
 }
 

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/jtag/gw16012.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -438,26 +438,26 @@
 #if PARPORT_USE_GIVEIO == 1
 int gw16012_get_giveio_access()
 {
-    HANDLE h;
-    OSVERSIONINFO version;
+	HANDLE h;
+	OSVERSIONINFO version;
 
-    version.dwOSVersionInfoSize = sizeof version;
-    if (!GetVersionEx( &version )) {
-	errno = EINVAL;
-	return -1;
-    }
-    if (version.dwPlatformId != VER_PLATFORM_WIN32_NT)
-	return 0;
+	version.dwOSVersionInfoSize = sizeof version;
+	if (!GetVersionEx( &version )) {
+		errno = EINVAL;
+		return -1;
+	}
+	if (version.dwPlatformId != VER_PLATFORM_WIN32_NT)
+		return 0;
 
-    h = CreateFile( "\\\\.\\giveio", GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );
-    if (h == INVALID_HANDLE_VALUE) {
-	errno = ENODEV;
-	return -1;
-    }
+	h = CreateFile( "\\\\.\\giveio", GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );
+	if (h == INVALID_HANDLE_VALUE) {
+		errno = ENODEV;
+		return -1;
+	}
 
-    CloseHandle( h );
+	CloseHandle( h );
 
-    return 0;
+	return 0;
 }
 #endif
 

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/jtag/jtag.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -250,8 +250,6 @@
 jtag_interface_t *jtag_interface = NULL;
 int jtag_speed = 0;
 
-
-
 /* forward declarations */
 void jtag_add_pathmove(int num_states, enum tap_state *path);
 void jtag_add_runtest(int num_cycles, enum tap_state endstate);
@@ -279,14 +277,12 @@
 
 int handle_verify_ircapture_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
-
 jtag_tap_t *jtag_AllTaps(void)
 {
-  return jtag_all_taps;
+	return jtag_all_taps;
 };
 
-int
-jtag_NumTotalTaps(void)
+int jtag_NumTotalTaps(void)
 {
 	jtag_tap_t *t;
 	int n;
@@ -300,8 +296,7 @@
 	return n;
 }
 
-int
-jtag_NumEnabledTaps(void)
+int jtag_NumEnabledTaps(void)
 {
 	jtag_tap_t *t;
 	int n;
@@ -345,8 +340,7 @@
 	return t;
 }
 
-jtag_tap_t *
-jtag_TapByJimObj( Jim_Interp *interp, Jim_Obj *o )
+jtag_tap_t * jtag_TapByJimObj( Jim_Interp *interp, Jim_Obj *o )
 {
 	jtag_tap_t *t;
 	const char *cp;
@@ -365,8 +359,7 @@
 }
 
 /* returns a pointer to the n-th device in the scan chain */
-jtag_tap_t *
-jtag_TapByAbsPosition( int n )
+jtag_tap_t * jtag_TapByAbsPosition( int n )
 {
 	int orig_n;
 	jtag_tap_t *t;
@@ -377,11 +370,10 @@
 	while( t && (n > 0)) {
 		n--;
 		t = t->next_tap;
-    }
+	}
 	return t;
 }
 
-
 int jtag_register_event_callback(int (*callback)(enum jtag_event event, void *priv), void *priv)
 {
 	jtag_event_callback_t **callbacks_p = &jtag_event_callbacks;
@@ -463,7 +455,6 @@
 	return last_comand_pointer;
 }
 
-
 void* cmd_queue_alloc(size_t size)
 {
 	cmd_queue_page_t **p_page = &cmd_queue_pages;
@@ -491,18 +482,17 @@
 	 *
 	 */
 	union worse_case_align {
-	  int i;
-	  long l;
-	  float f;
-	  void *v;
+		int i;
+		long l;
+		float f;
+		void *v;
 	};
 #define ALIGN_SIZE  (sizeof(union worse_case_align))
 
-	// The alignment process.
+	/* The alignment process. */
 	size = (size + ALIGN_SIZE -1) & (~(ALIGN_SIZE-1));
-	// Done...
+	/* Done... */
 
-
 	if (*p_page)
 	{
 		while ((*p_page)->next)
@@ -652,7 +642,6 @@
 			(*last_cmd)->cmd.scan->fields[nth_tap].out_value = buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 			(*last_cmd)->cmd.scan->fields[nth_tap].out_mask = NULL;
 			tap->bypass = 1;
-
 		}
 
 		/* update device information */
@@ -1023,7 +1012,6 @@
 
 	jtag_prelude1();
 
-
 	retval=interface_jtag_add_pathmove(num_states, path);
 	cmd_queue_cur_state = path[num_states - 1];
 	if (retval!=ERROR_OK)
@@ -1805,8 +1793,7 @@
 	return JIM_OK;
 }
 
-static int
-jim_newtap_cmd( Jim_GetOptInfo *goi )
+static int jim_newtap_cmd( Jim_GetOptInfo *goi )
 {
 	jtag_tap_t *pTap;
 	jtag_tap_t **ppTap;
@@ -1824,24 +1811,23 @@
 #define NTAP_OPT_IRCAPTURE 2
 		{ .name = "-ircapture"		,	.value = NTAP_OPT_IRCAPTURE },
 #define NTAP_OPT_ENABLED   3
-		{ .name = "-enable"			,   .value = NTAP_OPT_ENABLED },
+		{ .name = "-enable"			,	.value = NTAP_OPT_ENABLED },
 #define NTAP_OPT_DISABLED  4
-		{ .name = "-disable"		,   .value = NTAP_OPT_DISABLED },
+		{ .name = "-disable"		,	.value = NTAP_OPT_DISABLED },
 #define NTAP_OPT_EXPECTED_ID 5
-		{ .name = "-expected-id"	,   .value = NTAP_OPT_EXPECTED_ID },
-		{ .name = NULL				,   .value = -1 },
+		{ .name = "-expected-id"	,	.value = NTAP_OPT_EXPECTED_ID },
+		{ .name = NULL				,	.value = -1 },
 	};
 
-
 	pTap = malloc( sizeof(jtag_tap_t) );
 	memset( pTap, 0, sizeof(*pTap) );
 	if( !pTap ){
 		Jim_SetResult_sprintf( goi->interp, "no memory");
 		return JIM_ERR;
 	}
-	//
-	// we expect CHIP + TAP + OPTIONS
-	//
+	/*
+	 * we expect CHIP + TAP + OPTIONS
+	 * */
 	if( goi->argc < 3 ){
 		Jim_SetResult_sprintf(goi->interp, "Missing CHIP TAP OPTIONS ....");
 		return JIM_ERR;
@@ -1852,7 +1838,7 @@
 	Jim_GetOpt_String( goi, &cp, NULL );
 	pTap->tapname = strdup(cp);
 
-	// name + dot + name + null
+	/* name + dot + name + null */
 	x = strlen(pTap->chip) + 1 + strlen(pTap->tapname) + 1;
 	cp = malloc( x );
 	sprintf( cp, "%s.%s", pTap->chip, pTap->tapname );
@@ -1861,16 +1847,15 @@
 	LOG_DEBUG("Creating New Tap, Chip: %s, Tap: %s, Dotted: %s, %d params",
 			  pTap->chip, pTap->tapname, pTap->dotted_name, goi->argc);
 
-
-	// default is enabled
+	/* default is enabled */
 	pTap->enabled = 1;
 
-	// deal with options
+	/* deal with options */
 #define NTREQ_IRLEN      1
 #define NTREQ_IRCAPTURE  2
 #define NTREQ_IRMASK     4
 
-	// clear them as we find them
+	/* clear them as we find them */
 	reqbits = (NTREQ_IRLEN | NTREQ_IRCAPTURE | NTREQ_IRMASK);
 
 	while( goi->argc ){
@@ -1921,7 +1906,7 @@
 				return e;
 			}
 			if( (w < 0) || (w > 0xffff) ){
-				// wacky value
+				/* wacky value */
 				Jim_SetResult_sprintf( goi->interp, "option: %s - wacky value: %d (0x%x)",
 									   n->name, (int)(w), (int)(w));
 				return JIM_ERR;
@@ -1940,17 +1925,17 @@
 				reqbits &= (~(NTREQ_IRCAPTURE));
 				break;
 			}
-		} // switch(n->value)
-	} // while( goi->argc )
+		} /* switch(n->value) */
+	} /* while( goi->argc ) */
 
-	// Did we get all the options?
+	/* Did we get all the options? */
 	if( reqbits ){
 		// no
 		Jim_SetResult_sprintf( goi->interp,
 							   "newtap: %s missing required parameters",
 							   pTap->dotted_name);
-		// fixme: Tell user what is missing :-(
-		// no memory leaks pelase
+		/* TODO: Tell user what is missing :-( */
+		/* no memory leaks pelase */
 		free(((void *)(pTap->expected_ids)));
 		free(((void *)(pTap->chip)));
 		free(((void *)(pTap->tapname)));
@@ -1976,7 +1961,6 @@
 
 	pTap->bypass = 1;
 
-
 	jtag_register_event_callback(jtag_reset_callback, pTap );
 
 	ppTap = &(jtag_all_taps);
@@ -1989,19 +1973,16 @@
 		pTap->abs_chain_position = n_taps++;
 	}
 	LOG_DEBUG( "Created Tap: %s @ abs position %d, irlen %d, capture: 0x%x mask: 0x%x",
-			   (*ppTap)->dotted_name,
-			   (*ppTap)->abs_chain_position,
-			   (*ppTap)->ir_length,
-			   (*ppTap)->ir_capture_value,
-			   (*ppTap)->ir_capture_mask );
+				(*ppTap)->dotted_name,
+				(*ppTap)->abs_chain_position,
+				(*ppTap)->ir_length,
+				(*ppTap)->ir_capture_value,
+				(*ppTap)->ir_capture_mask );
 
-
 	return ERROR_OK;
 }
 
-
-static int
-jim_jtag_command( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
+static int jim_jtag_command( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
 {
 	Jim_GetOptInfo goi;
 	int e;
@@ -2034,7 +2015,7 @@
 	};
 
 	context = Jim_GetAssocData(interp, "context");
-	// go past the command
+	/* go past the command */
 	Jim_GetOpt_Setup( &goi, interp, argc-1, argv+1 );
 
 	e = Jim_GetOpt_Nvp( &goi, jtag_cmds, &n );
@@ -2045,9 +2026,9 @@
 		Jim_SetEmptyResult( goi.interp );
 	switch( n->value ){
 	case JTAG_CMD_INTERFACE:
-		// return the name of the interface
-		// TCL code might need to know the exact type...
-		// FUTURE: we allow this as a means to "set" the interface.
+		/* return the name of the interface */
+		/* TCL code might need to know the exact type... */
+		/* FUTURE: we allow this as a means to "set" the interface. */
 		if( goi.argc != 0 ){
 			Jim_WrongNumArgs( goi.interp, 1, goi.argv-1, "(no params)");
 			return JIM_ERR;
@@ -2142,7 +2123,6 @@
 		}
 	}
 
-
 	return JIM_ERR;
 }
 
@@ -2203,8 +2183,6 @@
 	if (jtag_interface->init() != ERROR_OK)
 		return ERROR_JTAG_INIT_FAILED;
 
-
-
 	jtag = jtag_interface;
 	return ERROR_OK;
 }
@@ -2216,7 +2194,6 @@
 
 	LOG_DEBUG("Init JTAG chain");
 
-
 	tap = jtag_NextEnabledTap(NULL);
 	if( tap == NULL ){
 		LOG_ERROR("There are no enabled taps?");
@@ -2390,14 +2367,14 @@
 	int e;
 	char buf[1024];
 	Jim_Obj *newargs[ 10 ];
-	//
-	// CONVERT SYNTAX
-	//
-	//   argv[-1] = command
-	//   argv[ 0] = ir length
-	//   argv[ 1] = ir capture
-	//   argv[ 2] = ir mask
-	//   argv[ 3] = not actually used by anything but in the docs
+	/*
+	 * CONVERT SYNTAX
+	 * argv[-1] = command
+	 * argv[ 0] = ir length
+	 * argv[ 1] = ir capture
+	 * argv[ 2] = ir mask
+	 * argv[ 3] = not actually used by anything but in the docs
+	 */
 
 	if( argc < 4 ){
 		command_print( cmd_ctx, "OLD DEPRECATED SYNTAX: Please use the NEW syntax");
@@ -2413,8 +2390,6 @@
 	command_print( cmd_ctx, "jtag newtap stm32 boundry  ....., and the tap: \"stm32.boundery\"");
 	command_print( cmd_ctx, "And then refer to the taps by the dotted name.");
 
-
-
 	newargs[0] = Jim_NewStringObj( interp, "jtag", -1   );
 	newargs[1] = Jim_NewStringObj( interp, "newtap", -1 );
 	sprintf( buf, "chip%d", jtag_NumTotalTaps() );
@@ -2441,8 +2416,6 @@
 			 Jim_GetString( newargs[8], NULL ),
 			 Jim_GetString( newargs[9], NULL ) );
 
-
-
 	e = jim_jtag_command( interp, 10, newargs );
 	if( e != JIM_OK ){
 		command_print( cmd_ctx, "%s", Jim_GetString( Jim_GetResult(interp), NULL ) );
@@ -2450,7 +2423,6 @@
 	return e;
 }
 
-
 int handle_scan_chain_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	jtag_tap_t *tap;
@@ -2835,7 +2807,6 @@
 		Jim_GetLong(interp, args[i], &bits);
 		str = Jim_GetString(args[i+1], &len);
 
-
 		fields[field_count].tap = tap;
 		fields[field_count].num_bits = bits;
 		fields[field_count].out_value = malloc(CEIL(bits, 8));
@@ -2904,7 +2875,6 @@
 	return ERROR_OK;
 }
 
-
 int jtag_power_dropout(int *dropout)
 {
 	return jtag->power_dropout(dropout);
@@ -2945,4 +2915,3 @@
 				Jim_Nvp_value2name_simple( nvp_jtag_tap_event, e)->name);
 	}
 }
-

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/jtag/jtag.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -78,11 +78,10 @@
 	/* in_check_value/mask, in_handler_error_handler, in_handler_priv can be used by the in handler, otherwise they contain garbage  */
 	u8 *in_check_value;	/* used to validate scan results */
 	u8 *in_check_mask;	/* check specified bits against check_value */
-	in_handler_t in_handler;	    /* process received buffer using this handler */
+	in_handler_t in_handler;/* process received buffer using this handler */
 	void *in_handler_priv;	/* additional information for the in_handler */
 } scan_field_t;
 
-
 enum scan_type
 {
 	/* IN: from device to host, OUT: from host to device */
@@ -158,12 +157,12 @@
 
 extern jtag_command_t *jtag_command_queue;
 
-// forward declaration
+/* forward declaration */
 typedef struct jtag_tap_event_action_s jtag_tap_event_action_t;
 
-// this is really: typedef jtag_tap_t
-// But - the typedef is done in "types.h"
-// due to "forward decloration reasons"
+/* this is really: typedef jtag_tap_t */
+/* But - the typedef is done in "types.h" */
+/* due to "forward decloration reasons" */
 struct jtag_tap_s
 {
 	const char *chip;
@@ -188,22 +187,21 @@
 };
 extern jtag_tap_t *jtag_AllTaps(void);
 extern jtag_tap_t *jtag_TapByPosition(int n);
-extern jtag_tap_t *jtag_TapByPosition( int n );
-extern jtag_tap_t *jtag_TapByString( const char *dotted_name );
-extern jtag_tap_t *jtag_TapByJimObj( Jim_Interp *interp, Jim_Obj *obj );
-extern jtag_tap_t *jtag_TapByAbsPosition( int abs_position );
-extern int         jtag_NumEnabledTaps(void);
-extern int         jtag_NumTotalTaps(void);
+extern jtag_tap_t *jtag_TapByPosition(int n);
+extern jtag_tap_t *jtag_TapByString(const char *dotted_name);
+extern jtag_tap_t *jtag_TapByJimObj(Jim_Interp *interp, Jim_Obj *obj);
+extern jtag_tap_t *jtag_TapByAbsPosition(int abs_position);
+extern int jtag_NumEnabledTaps(void);
+extern int jtag_NumTotalTaps(void);
 
-
 static __inline__ jtag_tap_t *
 jtag_NextEnabledTap( jtag_tap_t *p )
 {
 	if( p == NULL ){
-		// start at the head of list
+		/* start at the head of list */
 		p = jtag_AllTaps();
 	} else {
-		// start *after* this one
+		/* start *after* this one */
 		p = p->next_tap;
 	}
 	while( p ){
@@ -216,9 +214,6 @@
 	return p;
 }
 
-
-
-
 enum reset_line_mode
 {
 	LINE_OPEN_DRAIN = 0x0,
@@ -440,8 +435,6 @@
 extern void jtag_add_sleep(u32 us);
 extern int interface_jtag_add_sleep(u32 us);
 
-
-
 /*
  * For software FIFO implementations, the queued commands can be executed
  * during this call or earlier. A sw queue might decide to push out
@@ -468,7 +461,6 @@
 extern int jtag_power_dropout(int *dropout);
 extern int jtag_srst_asserted(int *srst_asserted);
 
-
 /* JTAG support functions */
 extern void jtag_set_check_value(scan_field_t *field, u8 *value,  u8 *mask, error_handler_t *in_error_handler);
 extern enum scan_type jtag_scan_type(scan_command_t *cmd);
@@ -494,8 +486,6 @@
 #define ERROR_JTAG_QUEUE_FAILED			(-104)
 #define ERROR_JTAG_DEVICE_ERROR			(-107)
 
-
-
 /* this allows JTAG devices to implement the entire jtag_xxx() layer in hw/sw */
 #ifdef HAVE_JTAG_MINIDRIVER_H
 /* Here a #define MINIDRIVER() and an inline version of hw fifo interface_jtag_add_dr_out can be defined */
@@ -527,9 +517,6 @@
 		enum tap_state end_state);
 #endif
 
-
-
-
 static __inline__ void jtag_add_dr_out(jtag_tap_t *tap,
 		int num_fields,
 		const int *num_bits,
@@ -542,5 +529,4 @@
 	interface_jtag_add_dr_out(tap, num_fields, num_bits, value, cmd_queue_end_state);
 }
 
-
 #endif /* JTAG_H */

Modified: trunk/src/jtag/presto.c
===================================================================
--- trunk/src/jtag/presto.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/jtag/presto.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -49,7 +49,6 @@
 #error "BUG: either FTD2XX and LIBFTDI has to be used"
 #endif
 
-
 int presto_jtag_speed(int speed);
 int presto_jtag_khz(int khz, int *jtag_speed);
 int presto_jtag_speed_div(int speed, int *khz);
@@ -69,7 +68,6 @@
 	.quit = presto_jtag_quit,
 };
 
-
 int presto_bitq_out(int tms, int tdi, int tdo_req);
 int presto_bitq_flush(void);
 int presto_bitq_sleep(unsigned long us);
@@ -87,10 +85,8 @@
 	.in = presto_bitq_in,
 };
 
-
 /* -------------------------------------------------------------------------- */
 
-
 #define FT_DEVICE_NAME_LEN 64
 #define FT_DEVICE_SERNUM_LEN 64
 
@@ -486,7 +482,6 @@
 	return result;
 }
 
-
 int presto_flush(void)
 {
 	if (presto->buff_out_pos == 0)
@@ -530,7 +525,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_sendbyte(int data)
 {
 	if (data == EOF) return presto_flush();
@@ -555,7 +549,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_getbyte(void)
 {
 	if (presto->buff_in_pos < presto->buff_in_len)
@@ -573,10 +566,8 @@
 	return -1;
 }
 
-
 /* -------------------------------------------------------------------------- */
 
-
 int presto_tdi_flush(void)
 {
 	if (presto->jtag_tdi_count == 0)
@@ -596,7 +587,6 @@
 	return 0;
 }
 
-
 int presto_tck_idle(void)
 {
 	if (presto->jtag_tck == 1)
@@ -608,10 +598,8 @@
 	return 0;
 }
 
-
 /* -------------------------------------------------------------------------- */
 
-
 int presto_bitq_out(int tms, int tdi, int tdo_req)
 {
 	int i;
@@ -658,7 +646,6 @@
 	return 0;
 }
 
-
 int presto_bitq_flush(void)
 {
 	presto_tdi_flush();
@@ -669,7 +656,6 @@
 	return presto_flush();
 }
 
-
 int presto_bitq_in_rdy(void)
 {
 	if (presto->buff_in_pos>=presto->buff_in_len)
@@ -677,7 +663,6 @@
 	return presto->buff_in_len-presto->buff_in_pos;
 }
 
-
 int presto_bitq_in(void)
 {
 	if (presto->buff_in_pos>=presto->buff_in_len)
@@ -686,7 +671,6 @@
 	return 0;
 }
 
-
 int presto_bitq_sleep(unsigned long us)
 {
 	long waits;
@@ -708,7 +692,6 @@
 	return 0;
 }
 
-
 int presto_bitq_reset(int trst, int srst)
 {
 	presto_tdi_flush();
@@ -724,10 +707,8 @@
 	return 0;
 }
 
-
 /* -------------------------------------------------------------------------- */
 
-
 int presto_jtag_khz(int khz, int *jtag_speed)
 {
 	if (khz < 0)
@@ -742,7 +723,6 @@
 	return 0;
 }
 
-
 int presto_jtag_speed_div(int speed, int *khz)
 {
 	if ((speed < 0) || (speed > 1000))
@@ -757,7 +737,6 @@
 	return 0;
 }
 
-
 int presto_jtag_speed(int speed)
 {
 	int khz;
@@ -777,7 +756,6 @@
 	return 0;
 }
 
-
 char *presto_serial;
 
 int presto_handle_serial_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
@@ -796,7 +774,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_jtag_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, "presto_serial", presto_handle_serial_command,
@@ -804,7 +781,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_jtag_init(void)
 {
 	if (presto_open(presto_serial) != ERROR_OK)
@@ -825,7 +801,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_jtag_quit(void)
 {
 	bitq_cleanup();

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/jtag/usbprog.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -47,10 +47,10 @@
 #define PID 0x0c63
 
 /* Pins at usbprog */
-#define TDO_BIT         0
-#define TDI_BIT         3
-#define TCK_BIT         2
-#define TMS_BIT         1
+#define TDO_BIT			0
+#define TDI_BIT			3
+#define TCK_BIT			2
+#define TMS_BIT			1
 
 int usbprog_execute_queue(void);
 int usbprog_speed(int speed);
@@ -74,17 +74,17 @@
 	.quit = usbprog_quit
 };
 
-#define UNKOWN_COMMAND  0x00
-#define PORT_DIRECTION  0x01
-#define PORT_SET        0x02
-#define PORT_GET        0x03
-#define PORT_SETBIT     0x04
-#define PORT_GETBIT     0x05
-#define WRITE_TDI     	0x06
-#define READ_TDO     	0x07
-#define WRITE_AND_READ 	0x08
-#define WRITE_TMS     	0x09
-#define WRITE_TMS_CHAIN 0x0A
+#define UNKOWN_COMMAND	0x00
+#define PORT_DIRECTION	0x01
+#define PORT_SET		0x02
+#define PORT_GET		0x03
+#define PORT_SETBIT		0x04
+#define PORT_GETBIT		0x05
+#define WRITE_TDI		0x06
+#define READ_TDO		0x07
+#define WRITE_AND_READ	0x08
+#define WRITE_TMS		0x09
+#define WRITE_TMS_CHAIN	0x0A
 
 struct usbprog_jtag
 {

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/openocd.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -71,7 +71,7 @@
 	/* DANGER!!! make sure that the line below does not appear in a patch, do not remove */
 	/* DANGER!!! make sure that the line below does not appear in a patch, do not remove */
 	/* DANGER!!! make sure that the line below does not appear in a patch, do not remove */
-	LOG_OUTPUT( "$URL$\n");
+	LOG_OUTPUT("$URL$\n");
 	/* DANGER!!! make sure that the line above does not appear in a patch, do not remove */
 	/* DANGER!!! make sure that the line above does not appear in a patch, do not remove */
 	/* DANGER!!! make sure that the line above does not appear in a patch, do not remove */
@@ -79,14 +79,6 @@
 	/* DANGER!!! make sure that the line above does not appear in a patch, do not remove */
 }
 
-
-
-
-
-
-
-
-
 /* Give TELNET a way to find out what version this is */
 int handle_version_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
@@ -240,7 +232,7 @@
 
 	cmd_ctx = setup_command_handler();
 
-	LOG_OUTPUT( "\n\nBUGS? Read http://svn.berlios.de/svnroot/repos/openocd/trunk/BUGS\n\n\n");
+	LOG_OUTPUT("\n\nBUGS? Read http://svn.berlios.de/svnroot/repos/openocd/trunk/BUGS\n\n\n");
 
 	print_version();
 

Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/server/gdb_server.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -307,7 +307,7 @@
 		if ((retval = gdb_get_char(connection, &reply)) != ERROR_OK)
 			return retval;
 		if( reply == '$' ){
-			// fix a problem with some IAR tools
+			/* fix a problem with some IAR tools */
 			gdb_putback_char( connection, reply );
 			LOG_DEBUG("Unexpected start of new packet");
 			break;
@@ -719,7 +719,6 @@
 	return ERROR_OK;
 }
 
-
 int gdb_new_connection(connection_t *connection)
 {
 	gdb_connection_t *gdb_connection = malloc(sizeof(gdb_connection_t));
@@ -847,7 +846,6 @@
 	return ERROR_OK;
 }
 
-
 static int gdb_reg_pos(target_t *target, int pos, int len)
 {
 	if (target->endianness == TARGET_LITTLE_ENDIAN)
@@ -2354,7 +2352,6 @@
 	return ERROR_OK;
 }
 
-
 int gdb_register_commands(command_context_t *command_context)
 {
 	register_command(command_context, NULL, "gdb_port", handle_gdb_port_command,

Modified: trunk/src/server/server.c
===================================================================
--- trunk/src/server/server.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/server/server.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -429,12 +429,12 @@
 #ifdef _WIN32
 BOOL WINAPI ControlHandler(DWORD dwCtrlType)
 {
-    shutdown_openocd = 1;
-    return TRUE;
+	shutdown_openocd = 1;
+	return TRUE;
 }
 
 void sig_handler(int sig) {
-    shutdown_openocd = 1;
+	shutdown_openocd = 1;
 }
 #endif
 
@@ -491,5 +491,3 @@
 
 	return ERROR_COMMAND_CLOSE_CONNECTION;
 }
-
-

Modified: trunk/src/server/telnet_server.c
===================================================================
--- trunk/src/server/telnet_server.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/server/telnet_server.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -188,8 +188,6 @@
 
 	log_add_callback(telnet_log_callback, connection);
 
-
-
 	return ERROR_OK;
 }
 

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm720t.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -447,21 +447,19 @@
 	arm7tdmi_init_target(cmd_ctx, target);
 
 	return ERROR_OK;
-
 }
 
 int arm720t_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm720t_init_arch_info(target_t *target, arm720t_common_t *arm720t, jtag_tap_t *tap, const char *variant)
+int arm720t_init_arch_info(target_t *target, arm720t_common_t *arm720t, jtag_tap_t *tap)
 {
 	arm7tdmi_common_t *arm7tdmi = &arm720t->arm7tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm7tdmi->arm7_9_common;
 
-	arm7tdmi_init_arch_info(target, arm7tdmi, tap, variant);
+	arm7tdmi_init_arch_info(target, arm7tdmi, tap);
 
 	arm7tdmi->arch_info = arm720t;
 	arm720t->common_magic = ARM720T_COMMON_MAGIC;
@@ -485,7 +483,7 @@
 {
 	arm720t_common_t *arm720t = calloc(1,sizeof(arm720t_common_t));
 
-	arm720t_init_arch_info(target, arm720t, target->tap, target->variant);
+	arm720t_init_arch_info(target, arm720t, target->tap);
 
 	return ERROR_OK;
 }

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm7_9_common.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -66,7 +66,6 @@
 int handle_arm7_9_dcc_downloads_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 int handle_arm7_9_etm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
-
 static int arm7_9_clear_watchpoints(arm7_9_common_t *arm7_9)
 {
 	embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_W0_CONTROL_VALUE], 0x0);
@@ -143,7 +142,6 @@
 	return arm7_9_clear_watchpoints(arm7_9);
 }
 
-
 int arm7_9_get_arch_pointers(target_t *target, armv4_5_common_t **armv4_5_p, arm7_9_common_t **arm7_9_p)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -269,7 +267,6 @@
 	}
 
 	return retval;
-
 }
 
 int arm7_9_unset_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
@@ -388,7 +385,6 @@
 		}
 	}
 
-
 	arm7_9->breakpoint_count++;
 
 	return arm7_9_set_breakpoint(target, breakpoint);
@@ -571,9 +567,6 @@
 	return ERROR_OK;
 }
 
-
-
-
 int arm7_9_execute_sys_speed(struct target_s *target)
 {
 	int retval;
@@ -642,9 +635,9 @@
 		/* check for DBGACK and SYSCOMP set (others don't care) */
 
 		/* NB! These are constants that must be available until after next jtag_execute() and
-		   we evaluate the values upon first execution in lieu of setting up these constants
-		   during early setup.
-		*/
+		 * we evaluate the values upon first execution in lieu of setting up these constants
+		 * during early setup.
+		 * */
 		buf_set_u32(check_value, 0, 32, 0x9);
 		buf_set_u32(check_mask, 0, 32, 0x9);
 		set=1;
@@ -689,7 +682,6 @@
 	arm_jtag_t *jtag_info = &arm7_9->jtag_info;
 	reg_t *dcc_control = &arm7_9->eice_cache->reg_list[EICE_COMMS_CTRL];
 
-
 	if (!target->dbg_msg_enabled)
 		return ERROR_OK;
 
@@ -857,29 +849,26 @@
 		jtag_add_reset(0, 1);
 	}
 
-
 	target->state = TARGET_RESET;
 	jtag_add_sleep(50000);
 
 	armv4_5_invalidate_core_regs(target);
 
-    if ((target->reset_halt)&&((jtag_reset_config & RESET_SRST_PULLS_TRST)==0))
+	if ((target->reset_halt)&&((jtag_reset_config & RESET_SRST_PULLS_TRST)==0))
 	{
 		/* debug entry was already prepared in arm7_9_assert_reset() */
 		target->debug_reason = DBG_REASON_DBGRQ;
 	}
 
 	return ERROR_OK;
-
 }
 
 int arm7_9_deassert_reset(target_t *target)
 {
 	int retval=ERROR_OK;
 	LOG_DEBUG("target->state: %s",
-		  Jim_Nvp_value2name_simple( nvp_target_state,target->state)->name);
+		Jim_Nvp_value2name_simple( nvp_target_state,target->state)->name);
 
-
 	/* deassert reset lines */
 	jtag_add_reset(0, 0);
 
@@ -1527,7 +1516,6 @@
 	}
 }
 
-
 int arm7_9_resume(struct target_s *target, int current, u32 address, int handle_breakpoints, int debug_execution)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -1833,7 +1821,6 @@
 		}
 
 	return err;
-
 }
 
 int arm7_9_read_core_reg(struct target_s *target, int num, enum armv4_5_mode mode)
@@ -1900,7 +1887,6 @@
 	}
 
 	return ERROR_OK;
-
 }
 
 int arm7_9_write_core_reg(struct target_s *target, int num, enum armv4_5_mode mode, u32 value)
@@ -2326,7 +2312,6 @@
 static int dcc_count;
 static u8 *dcc_buffer;
 
-
 static int arm7_9_dcc_completion(struct target_s *target, u32 exit_point, int timeout_ms, void *arch_info)
 {
 	int retval = ERROR_OK;
@@ -2342,8 +2327,7 @@
 	if (count>2)
 	{
 		/* Handle first & last using standard embeddedice_write_reg and the middle ones w/the
-		   core function repeated.
-		 */
+		 * core function repeated. */
 		embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_COMMS_DATA], fast_target_buffer_get_u32(buffer, little));
 		buffer+=4;
 
@@ -2373,7 +2357,6 @@
 	return target_wait_state(target, TARGET_HALTED, 500);
 }
 
-
 static const u32 dcc_code[] =
 {
 	/* MRC      TST         BNE         MRC         STR         B */
@@ -2382,7 +2365,6 @@
 
 int armv4_5_run_algorithm_inner(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_params, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info, int (*run_it)(struct target_s *target, u32 exit_point, int timeout_ms, void *arch_info));
 
-
 int arm7_9_bulk_write_memory(target_t *target, u32 address, u32 count, u8 *buffer)
 {
 	int retval;
@@ -2429,8 +2411,6 @@
 
 	buf_set_u32(reg_params[0].value, 0, 32, address);
 
-	//armv4_5_run_algorithm_inner(struct target_s *target, int num_mem_params, mem_param_t *mem_params,
-	// int num_reg_params, reg_param_t *reg_params, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info, int (*run_it)(struct target_s *target, u32 exit_point, int timeout_ms, void *arch_info))
 	dcc_count=count;
 	dcc_buffer=buffer;
 	retval = armv4_5_run_algorithm_inner(target, 0, NULL, 1, reg_params,
@@ -2741,10 +2721,8 @@
 	value = strtoul(args[2], NULL, 0);
 
 	return arm7_9_write_core_reg(target, num, mode, value);
-
 }
 
-
 int handle_arm7_9_dbgrq_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);

Modified: trunk/src/target/arm7_9_common.h
===================================================================
--- trunk/src/target/arm7_9_common.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm7_9_common.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -154,5 +154,4 @@
 int arm7_9_init_arch_info(target_t *target, arm7_9_common_t *arm7_9);
 int arm7_9_get_arch_pointers(target_t *target, armv4_5_common_t **armv4_5_p, arm7_9_common_t **arm7_9_p);
 
-
 #endif /* ARM7_9_COMMON_H */

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm7tdmi.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -364,7 +364,6 @@
 	 * reading PC in Thumb state gives address of instruction + 4
 	 */
 	*pc -= 0xa;
-
 }
 
 void arm7tdmi_read_core_regs(target_t *target, u32 mask, u32* core_regs[16])
@@ -391,7 +390,6 @@
 			/* nothing fetched, STM still in EXECUTE (1+i cycle) */
 			arm7tdmi_clock_data_in(jtag_info, core_regs[i]);
 	}
-
 }
 
 void arm7tdmi_read_core_regs_target_buffer(target_t *target, u32 mask, void* buffer, int size)
@@ -435,7 +433,6 @@
 			}
 		}
 	}
-
 }
 
 void arm7tdmi_read_xpsr(target_t *target, u32 *xpsr, int spsr)
@@ -456,7 +453,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	/* nothing fetched, STR still in EXECUTE (2nd cycle) */
 	arm7tdmi_clock_data_in(jtag_info, xpsr);
-
 }
 
 void arm7tdmi_write_xpsr(target_t *target, u32 xpsr, int spsr)
@@ -507,7 +503,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	/* nothing fetched, MSR in EXECUTE (2) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
-
 }
 
 void arm7tdmi_write_core_regs(target_t *target, u32 mask, u32 core_regs[16])
@@ -535,7 +530,6 @@
 			arm7tdmi_clock_out_inner(jtag_info, core_regs[i], 0);
 	}
 	arm7tdmi_clock_out_inner(jtag_info, ARMV4_5_NOP, 0);
-
 }
 
 void arm7tdmi_load_word_regs(target_t *target, u32 mask)
@@ -549,7 +543,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_LDMIA(0, mask & 0xffff, 0, 1), NULL, 0);
-
 }
 
 void arm7tdmi_load_hword_reg(target_t *target, int num)
@@ -563,7 +556,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_LDRH_IP(num, 0), NULL, 0);
-
 }
 
 void arm7tdmi_load_byte_reg(target_t *target, int num)
@@ -577,7 +569,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_LDRB_IP(num, 0), NULL, 0);
-
 }
 
 void arm7tdmi_store_word_regs(target_t *target, u32 mask)
@@ -591,7 +582,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STMIA(0, mask, 0, 1), NULL, 0);
-
 }
 
 void arm7tdmi_store_hword_reg(target_t *target, int num)
@@ -605,7 +595,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STRH_IP(num, 0), NULL, 0);
-
 }
 
 void arm7tdmi_store_byte_reg(target_t *target, int num)
@@ -619,7 +608,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STRB_IP(num, 0), NULL, 0);
-
 }
 
 void arm7tdmi_write_pc(target_t *target, u32 pc)
@@ -658,7 +646,6 @@
 
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out_inner(jtag_info, ARMV4_5_B(0xfffffa, 0), 0);
-
 }
 
 void arm7tdmi_branch_resume_thumb(target_t *target)
@@ -720,7 +707,6 @@
 
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_B(0x7f8), NULL, 0);
-
 }
 
 void arm7tdmi_build_reg_cache(target_t *target)
@@ -771,20 +757,17 @@
 
 int arm7tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
-
 	arm7tdmi_build_reg_cache(target);
 
 	return ERROR_OK;
-
 }
 
 int arm7tdmi_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm7tdmi_init_arch_info(target_t *target, arm7tdmi_common_t *arm7tdmi, jtag_tap_t *tap, const char *variant)
+int arm7tdmi_init_arch_info(target_t *target, arm7tdmi_common_t *arm7tdmi, jtag_tap_t *tap)
 {
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -838,34 +821,21 @@
 	arm7tdmi->arch_info = NULL;
 	arm7tdmi->common_magic = ARM7TDMI_COMMON_MAGIC;
 
-	if (variant)
-	{
-		arm7tdmi->variant = strdup(variant);
-	}
-	else
-	{
-		arm7tdmi->variant = strdup("");
-	}
-
 	arm7_9_init_arch_info(target, arm7_9);
 
 	return ERROR_OK;
 }
 
-
-
 int arm7tdmi_target_create( struct target_s *target, Jim_Interp *interp )
 {
 	arm7tdmi_common_t *arm7tdmi;
 
 	arm7tdmi = calloc(1,sizeof(arm7tdmi_common_t));
+	arm7tdmi_init_arch_info(target, arm7tdmi, target->tap);
 
-	arm7tdmi_init_arch_info(target, arm7tdmi, target->tap, target->variant);
-
 	return ERROR_OK;
 }
 
-
 int arm7tdmi_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
@@ -873,5 +843,4 @@
 	retval = arm7_9_register_commands(cmd_ctx);
 
 	return retval;
-
 }

Modified: trunk/src/target/arm7tdmi.h
===================================================================
--- trunk/src/target/arm7tdmi.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm7tdmi.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -35,15 +35,13 @@
 typedef struct arm7tdmi_common_s
 {
 	int common_magic;
-	char *variant;
 	void *arch_info;
 	arm7_9_common_t arm7_9_common;
 } arm7tdmi_common_t;
 
 int arm7tdmi_register_commands(struct command_context_s *cmd_ctx);
-int arm7tdmi_init_arch_info(target_t *target, arm7tdmi_common_t *arm7tdmi, jtag_tap_t *tap, const char *variant);
+int arm7tdmi_init_arch_info(target_t *target, arm7tdmi_common_t *arm7tdmi, jtag_tap_t *tap);
 int arm7tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target);
 int arm7tdmi_examine(struct target_s *target);
 
-
 #endif /* ARM7TDMI_H */

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm920t.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -703,23 +703,21 @@
 	arm9tdmi_init_target(cmd_ctx, target);
 
 	return ERROR_OK;
-
 }
 
 int arm920t_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm920t_init_arch_info(target_t *target, arm920t_common_t *arm920t, jtag_tap_t *tap, const char *variant)
+int arm920t_init_arch_info(target_t *target, arm920t_common_t *arm920t, jtag_tap_t *tap)
 {
 	arm9tdmi_common_t *arm9tdmi = &arm920t->arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm9tdmi->arm7_9_common;
 
 	/* initialize arm9tdmi specific info (including arm7_9 and armv4_5)
 	 */
-	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
+	arm9tdmi_init_arch_info(target, arm9tdmi, tap);
 
 	arm9tdmi->arch_info = arm920t;
 	arm920t->common_magic = ARM920T_COMMON_MAGIC;
@@ -752,7 +750,7 @@
 {
 	arm920t_common_t *arm920t = calloc(1,sizeof(arm920t_common_t));
 
-	arm920t_init_arch_info(target, arm920t, target->tap, target->variant);
+	arm920t_init_arch_info(target, arm920t, target->tap);
 
 	return ERROR_OK;
 }
@@ -995,10 +993,8 @@
 				 i_cache[segment][index].data[i] = regs[i];
 				 fprintf(output, "%i: 0x%8.8x\n", i-1, regs[i]);
 			}
-
 		}
 
-
 		/* Ra: r0 = index(31:26):SBZ(25:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment << 5) | (C15_C_D_Ind << 26);
 		arm9tdmi_write_core_regs(target, 0x1, regs);

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm926ejs.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -98,7 +98,6 @@
 	.mmu = arm926ejs_mmu
 };
 
-
 int arm926ejs_catch_broken_irscan(u8 *captured, void *priv, scan_field_t *field)
 {
 	/* The ARM926EJ-S' instruction register is 4 bits wide */
@@ -498,7 +497,6 @@
 	LOG_DEBUG("D FSR: 0x%8.8x, D FAR: 0x%8.8x, I FSR: 0x%8.8x",
 		arm926ejs->d_fsr, arm926ejs->d_far, arm926ejs->i_fsr);
 
-
 	u32 cache_dbg_ctrl;
 
 	/* read-modify-write CP15 cache debug control register
@@ -666,7 +664,6 @@
 	arm926ejs->armv4_5_mmu.armv4_5_cache.i_cache_enabled = 0;
 
 	return target_call_event_callbacks(target, TARGET_EVENT_HALTED);
-
 }
 
 int arm926ejs_write_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
@@ -705,23 +702,21 @@
 	arm9tdmi_init_target(cmd_ctx, target);
 
 	return ERROR_OK;
-
 }
 
 int arm926ejs_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm926ejs_init_arch_info(target_t *target, arm926ejs_common_t *arm926ejs, jtag_tap_t *tap, const char *variant)
+int arm926ejs_init_arch_info(target_t *target, arm926ejs_common_t *arm926ejs, jtag_tap_t *tap)
 {
 	arm9tdmi_common_t *arm9tdmi = &arm926ejs->arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm9tdmi->arm7_9_common;
 
 	/* initialize arm9tdmi specific info (including arm7_9 and armv4_5)
 	 */
-	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
+	arm9tdmi_init_arch_info(target, arm9tdmi, tap);
 
 	arm9tdmi->arch_info = arm926ejs;
 	arm926ejs->common_magic = ARM926EJS_COMMON_MAGIC;
@@ -755,7 +750,7 @@
 {
 	arm926ejs_common_t *arm926ejs = calloc(1,sizeof(arm926ejs_common_t));
 
-	arm926ejs_init_arch_info(target, arm926ejs, target->tap, target->variant);
+	arm926ejs_init_arch_info(target, arm926ejs, target->tap);
 
 	return ERROR_OK;
 }
@@ -945,6 +940,7 @@
 
 	return armv4_5_mmu_handle_mw_phys_command(cmd_ctx, cmd, args, argc, target, &arm926ejs->armv4_5_mmu);
 }
+
 static int arm926ejs_virt2phys(struct target_s *target, u32 virtual, u32 *physical)
 {
 	int retval;

Modified: trunk/src/target/arm926ejs.h
===================================================================
--- trunk/src/target/arm926ejs.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm926ejs.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -43,7 +43,7 @@
 	u32 d_far;
 } arm926ejs_common_t;
 
-extern int arm926ejs_init_arch_info(target_t *target, arm926ejs_common_t *arm926ejs, jtag_tap_t *tap, const char *variant);
+extern int arm926ejs_init_arch_info(target_t *target, arm926ejs_common_t *arm926ejs, jtag_tap_t *tap);
 extern int arm926ejs_register_commands(struct command_context_s *cmd_ctx); 
 extern int arm926ejs_arch_state(struct target_s *target); 
 extern int arm926ejs_write_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer); 

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm966e.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -98,16 +98,15 @@
 
 int arm966e_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm966e_init_arch_info(target_t *target, arm966e_common_t *arm966e, jtag_tap_t *tap, const char *variant)
+int arm966e_init_arch_info(target_t *target, arm966e_common_t *arm966e, jtag_tap_t *tap)
 {
 	arm9tdmi_common_t *arm9tdmi = &arm966e->arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &arm9tdmi->arm7_9_common;
 
-	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
+	arm9tdmi_init_arch_info(target, arm9tdmi, tap);
 
 	arm9tdmi->arch_info = arm966e;
 	arm966e->common_magic = ARM966E_COMMON_MAGIC;
@@ -125,7 +124,7 @@
 {
 	arm966e_common_t *arm966e = calloc(1,sizeof(arm966e_common_t));
 
-	arm966e_init_arch_info(target, arm966e, target->tap, target->variant);
+	arm966e_init_arch_info(target, arm966e, target->tap);
 
 	return ERROR_OK;
 }

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm9tdmi.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -507,7 +507,6 @@
 			/* nothing fetched, STM in MEMORY (i'th cycle) */
 			arm9tdmi_clock_data_in(jtag_info, core_regs[i]);
 	}
-
 }
 
 void arm9tdmi_read_core_regs_target_buffer(target_t *target, u32 mask, void* buffer, int size)
@@ -549,7 +548,6 @@
 					break;
 			}
 	}
-
 }
 
 void arm9tdmi_read_xpsr(target_t *target, u32 *xpsr, int spsr)
@@ -574,7 +572,6 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	/* nothing fetched, STR in MEMORY */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, xpsr, 0);
-
 }
 
 void arm9tdmi_write_xpsr(target_t *target, u32 xpsr, int spsr)
@@ -664,7 +661,6 @@
 			arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, core_regs[i], NULL, 0);
 	}
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-
 }
 
 void arm9tdmi_load_word_regs(target_t *target, u32 mask)
@@ -677,7 +673,6 @@
 	/* put system-speed load-multiple into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_LDMIA(0, mask & 0xffff, 0, 1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_load_hword_reg(target_t *target, int num)
@@ -702,7 +697,6 @@
 	/* put system-speed load byte into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_LDRB_IP(num, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_store_word_regs(target_t *target, u32 mask)
@@ -715,7 +709,6 @@
 	/* put system-speed store-multiple into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_STMIA(0, mask, 0, 1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_store_hword_reg(target_t *target, int num)
@@ -728,7 +721,6 @@
 	/* put system-speed store half-word into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_STRH_IP(num, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_store_byte_reg(target_t *target, int num)
@@ -741,7 +733,6 @@
 	/* put system-speed store byte into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_STRB_IP(num, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_write_pc(target_t *target, u32 pc)
@@ -768,7 +759,6 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	/* fetch NOP, LDM in EXECUTE stage (5th cycle) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-
 }
 
 void arm9tdmi_branch_resume(target_t *target)
@@ -780,7 +770,6 @@
 
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_B(0xfffffc, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_branch_resume_thumb(target_t *target)
@@ -841,7 +830,6 @@
 
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_B(0x7f7), 0, NULL, 1);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
-
 }
 
 void arm9tdmi_enable_single_step(target_t *target, u32 next_pc)
@@ -888,7 +876,6 @@
 	armv4_5->core_cache = (*cache_p);
 }
 
-
 int arm9tdmi_examine(struct target_s *target)
 {
 	/* get pointers to arch-specific information */
@@ -932,16 +919,14 @@
 	arm9tdmi_build_reg_cache(target);
 
 	return ERROR_OK;
-
 }
 
 int arm9tdmi_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm9tdmi_init_arch_info(target_t *target, arm9tdmi_common_t *arm9tdmi, jtag_tap_t *tap, const char *variant)
+int arm9tdmi_init_arch_info(target_t *target, arm9tdmi_common_t *arm9tdmi, jtag_tap_t *tap)
 {
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -995,15 +980,6 @@
 	arm9tdmi->common_magic = ARM9TDMI_COMMON_MAGIC;
 	arm9tdmi->arch_info = NULL;
 
-	if (variant)
-	{
-		arm9tdmi->variant = strdup(variant);
-	}
-	else
-	{
-		arm9tdmi->variant = strdup("");
-	}
-
 	arm7_9_init_arch_info(target, arm7_9);
 
 	/* override use of DBGRQ, this is safe on ARM9TDMI */
@@ -1045,13 +1021,11 @@
 	return ERROR_OK;
 }
 
-
-
 int arm9tdmi_target_create(struct target_s *target, Jim_Interp *interp)
 {
 	arm9tdmi_common_t *arm9tdmi = calloc(1,sizeof(arm9tdmi_common_t));
 
-	arm9tdmi_init_arch_info(target, arm9tdmi, target->tap, target->variant);
+	arm9tdmi_init_arch_info(target, arm9tdmi, target->tap);
 
 	return ERROR_OK;
 }
@@ -1059,19 +1033,13 @@
 int arm9tdmi_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
-
 	command_t *arm9tdmi_cmd;
-
-
+	
 	retval = arm7_9_register_commands(cmd_ctx);
-
 	arm9tdmi_cmd = register_command(cmd_ctx, NULL, "arm9tdmi", NULL, COMMAND_ANY, "arm9tdmi specific commands");
-
 	register_command(cmd_ctx, arm9tdmi_cmd, "vector_catch", handle_arm9tdmi_catch_vectors_command, COMMAND_EXEC, "catch arm920t vectors ['all'|'none'|'<vec1 vec2 ...>']");
-
-
+	
 	return retval;
-
 }
 
 int handle_arm9tdmi_catch_vectors_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)

Modified: trunk/src/target/arm9tdmi.h
===================================================================
--- trunk/src/target/arm9tdmi.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/arm9tdmi.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -35,7 +35,6 @@
 typedef struct arm9tdmi_common_s
 {
 	int common_magic;
-	char *variant;
 	void *arch_info;
 	arm7_9_common_t arm7_9_common;
 } arm9tdmi_common_t;
@@ -60,7 +59,7 @@
 
 extern int arm9tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target);
 int arm9tdmi_examine(struct target_s *target);
-extern int arm9tdmi_init_arch_info(target_t *target, arm9tdmi_common_t *arm9tdmi, jtag_tap_t *tap, const char *variant);
+extern int arm9tdmi_init_arch_info(target_t *target, arm9tdmi_common_t *arm9tdmi, jtag_tap_t *tap);
 extern int arm9tdmi_register_commands(struct command_context_s *cmd_ctx);
 
 extern int arm9tdmi_clock_out(arm_jtag_t *jtag_info, u32 instr, u32 out, u32 *in, int sysspeed);

Modified: trunk/src/target/armv4_5.c
===================================================================
--- trunk/src/target/armv4_5.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/armv4_5.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -178,7 +178,6 @@
 	"GDB dummy floating-point status register", armv4_5_gdb_dummy_fps_value, 0, 1, 32, NULL, 0, NULL, 0
 };
 
-
 int armv4_5_get_core_reg(reg_t *reg)
 {
 	int retval;
@@ -663,7 +662,6 @@
 	return retval;
 }
 
-
 int armv4_5_run_algorithm(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_params, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info)
 {
 	return armv4_5_run_algorithm_inner(target, num_mem_params, mem_params, num_reg_params, reg_params, entry_point, exit_point, timeout_ms, arch_info, armv4_5_run_algorithm_completion);

Modified: trunk/src/target/armv4_5.h
===================================================================
--- trunk/src/target/armv4_5.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/armv4_5.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -137,7 +137,6 @@
 	}
 };
 
-
 extern int armv4_5_arch_state(struct target_s *target);
 extern int armv4_5_get_gdb_reg_list(target_t *target, reg_t **reg_list[], int *reg_list_size);
 extern int armv4_5_invalidate_core_regs(target_t *target);

Modified: trunk/src/target/breakpoints.c
===================================================================
--- trunk/src/target/breakpoints.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/breakpoints.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -238,8 +238,6 @@
 	free(watchpoint);
 }
 
-
-
 void watchpoint_remove(target_t *target, u32 address)
 {
 	watchpoint_t *watchpoint = target->watchpoints;
@@ -263,7 +261,6 @@
 	}
 }
 
-
 void watchpoint_clear_target(target_t *target)
 {
 	watchpoint_t *watchpoint;

Modified: trunk/src/target/breakpoints.h
===================================================================
--- trunk/src/target/breakpoints.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/breakpoints.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -69,4 +69,3 @@
 extern void watchpoint_clear_target(struct target_s *target);
 
 #endif /* BREAKPOINTS_H */
-

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/cortex_m3.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -740,7 +740,7 @@
 	 * when srst is asserted the luminary device seesm to also clear the debug registers
 	 * which does not match the armv7 debug TRM */
 		
-	if (strcmp(cortex_m3->variant, "lm3s") == 0)
+	if (strcmp(target->variant, "lm3s") == 0)
 	{
 		/* get revision of lm3s target, only early silicon has this issue
 		 * Fury Rev B, DustDevil Rev B, Tempest all ok */
@@ -1407,7 +1407,7 @@
 		/* Setup FPB */
 		target_read_u32(target, FP_CTRL, &fpcr);
 		cortex_m3->auto_bp_type = 1;
-		cortex_m3->fp_num_code = (fpcr >> 8) & 0x70 | (fpcr >> 4) & 0xF; /* bits [14:12] and [7:4] */
+		cortex_m3->fp_num_code = ((fpcr >> 8) & 0x70) | ((fpcr >> 4) & 0xF); /* bits [14:12] and [7:4] */
 		cortex_m3->fp_num_lit = (fpcr >> 8) & 0xF;
 		cortex_m3->fp_code_available = cortex_m3->fp_num_code;
 		cortex_m3->fp_comparator_list = calloc(cortex_m3->fp_num_code + cortex_m3->fp_num_lit, sizeof(cortex_m3_fp_comparator_t));
@@ -1517,7 +1517,7 @@
 	return ERROR_OK;
 }
 
-int cortex_m3_init_arch_info(target_t *target, cortex_m3_common_t *cortex_m3, jtag_tap_t *tap, const char *variant)
+int cortex_m3_init_arch_info(target_t *target, cortex_m3_common_t *cortex_m3, jtag_tap_t *tap)
 {
 	armv7m_common_t *armv7m;
 	armv7m = &cortex_m3->armv7m;
@@ -1545,15 +1545,6 @@
 	armv7m->pre_restore_context = NULL;
 	armv7m->post_restore_context = NULL;
 	
-	if (variant)
-	{
-		cortex_m3->variant = strdup(variant);
-	}
-	else
-	{
-		cortex_m3->variant = strdup("");
-	}
-	
 	armv7m_init_arch_info(target, armv7m);	
 	armv7m->arch_info = cortex_m3;
 	armv7m->load_core_reg_u32 = cortex_m3_load_core_reg_u32;
@@ -1568,7 +1559,7 @@
 {
 	cortex_m3_common_t *cortex_m3 = calloc(1,sizeof(cortex_m3_common_t));
 	
-	cortex_m3_init_arch_info(target, cortex_m3, target->tap, target->variant);
+	cortex_m3_init_arch_info(target, cortex_m3, target->tap);
 	
 	return ERROR_OK;
 }

Modified: trunk/src/target/cortex_m3.h
===================================================================
--- trunk/src/target/cortex_m3.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/cortex_m3.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -138,7 +138,6 @@
 {
 	int common_magic;
 	arm_jtag_t jtag_info;
-	char *variant;
 	
 	/* Context information */
 	u32 dcb_dhcsr;
@@ -190,6 +189,6 @@
 int cortex_m3_remove_watchpoint(struct target_s *target, watchpoint_t *watchpoint);
 
 extern int cortex_m3_register_commands(struct command_context_s *cmd_ctx);
-extern int cortex_m3_init_arch_info(target_t *target, cortex_m3_common_t *cortex_m3, jtag_tap_t *tap, const char *variant);
+extern int cortex_m3_init_arch_info(target_t *target, cortex_m3_common_t *cortex_m3, jtag_tap_t *tap);
 
 #endif /* CORTEX_M3_H */

Modified: trunk/src/target/cortex_swjdp.h
===================================================================
--- trunk/src/target/cortex_swjdp.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/cortex_swjdp.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -33,9 +33,9 @@
 #define DPAP_WRITE		0
 #define DPAP_READ		1
 #define DP_ZERO			0
-#define DP_CTRL_STAT    0x4
-#define DP_SELECT       0x8
-#define DP_RDBUFF       0xC
+#define DP_CTRL_STAT	0x4
+#define DP_SELECT		0x8
+#define DP_RDBUFF		0xC
 
 #define CORUNDETECT		(1<<0)
 #define SSTICKYORUN		(1<<1)

Modified: trunk/src/target/embeddedice.h
===================================================================
--- trunk/src/target/embeddedice.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/embeddedice.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -129,5 +129,4 @@
 
 void embeddedice_write_dcc(jtag_tap_t *tap, int reg_addr, u8 *buffer, int little, int count);
 
-
 #endif /* EMBEDDED_ICE_H */

Modified: trunk/src/target/etb.h
===================================================================
--- trunk/src/target/etb.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/etb.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -31,15 +31,15 @@
 /* ETB registers */
 enum
 {
-    ETB_ID = 0x00,
-    ETB_RAM_DEPTH = 0x01,
-    ETB_RAM_WIDTH = 0x02,
-    ETB_STATUS = 0x03,
-    ETB_RAM_DATA = 0x04,
-    ETB_RAM_READ_POINTER = 0x05,
-    ETB_RAM_WRITE_POINTER = 0x06,
-    ETB_TRIGGER_COUNTER = 0x07,
-    ETB_CTRL = 0x08,
+	ETB_ID = 0x00,
+	ETB_RAM_DEPTH = 0x01,
+	ETB_RAM_WIDTH = 0x02,
+	ETB_STATUS = 0x03,
+	ETB_RAM_DATA = 0x04,
+	ETB_RAM_READ_POINTER = 0x05,
+	ETB_RAM_WRITE_POINTER = 0x06,
+	ETB_TRIGGER_COUNTER = 0x07,
+	ETB_CTRL = 0x08,
 };
 
 typedef struct etb_s

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/feroceon.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -645,7 +645,7 @@
 	arm7_9_common_t *arm7_9;
 	arm926ejs_common_t *arm926ejs = calloc(1,sizeof(arm926ejs_common_t));
 
-	arm926ejs_init_arch_info(target, arm926ejs, target->tap, target->variant);
+	arm926ejs_init_arch_info(target, arm926ejs, target->tap);
 
 	armv4_5 = target->arch_info;
 	arm7_9 = armv4_5->arch_info;
@@ -684,7 +684,6 @@
 	return ERROR_OK;
 }
 
-
 int feroceon_examine(struct target_s *target)
 {
 	armv4_5_common_t *armv4_5;

Modified: trunk/src/target/image.c
===================================================================
--- trunk/src/target/image.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/image.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -83,15 +83,15 @@
 		LOG_DEBUG("ELF image detected.");
 		image->type = IMAGE_ELF;
 	}
-	else if  ((buffer[0]==':') /* record start byte */
-	        &&(isxdigit(buffer[1]))
-	        &&(isxdigit(buffer[2]))
-	        &&(isxdigit(buffer[3]))
-	        &&(isxdigit(buffer[4]))
-	        &&(isxdigit(buffer[5]))
-	        &&(isxdigit(buffer[6]))
-	        &&(buffer[7]=='0') /* record type : 00 -> 05 */
-	        &&(buffer[8]>='0')&&(buffer[8]<'6'))
+	else if ((buffer[0]==':') /* record start byte */
+		&&(isxdigit(buffer[1]))
+		&&(isxdigit(buffer[2]))
+		&&(isxdigit(buffer[3]))
+		&&(isxdigit(buffer[4]))
+		&&(isxdigit(buffer[5]))
+		&&(isxdigit(buffer[6]))
+		&&(buffer[7]=='0') /* record type : 00 -> 05 */
+		&&(buffer[8]>='0')&&(buffer[8]<'6'))
 	{
 		LOG_DEBUG("IHEX image detected.");
 		image->type = IMAGE_IHEX;
@@ -381,7 +381,6 @@
 		return ERROR_IMAGE_FORMAT_ERROR;
 	}
 
-
 	elf->endianness = elf->header->e_ident[EI_DATA];
 	if ((elf->endianness!=ELFDATA2LSB)
 		 &&(elf->endianness!=ELFDATA2MSB))
@@ -1042,5 +1041,3 @@
 	*checksum = crc;
 	return ERROR_OK;
 }
-
-

Modified: trunk/src/target/image.h
===================================================================
--- trunk/src/target/image.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/image.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -44,12 +44,12 @@
 
 typedef enum image_type
 {
-    IMAGE_BINARY,	/* plain binary */
-    IMAGE_IHEX,		/* intel hex-record format */
-    IMAGE_MEMORY,	/* target-memory pseudo-image */
-    IMAGE_ELF,		/* ELF binary */
-    IMAGE_SRECORD,	/* motorola s19 */
-    IMAGE_BUILDER,	/* when building a new image */
+	IMAGE_BINARY,	/* plain binary */
+	IMAGE_IHEX,		/* intel hex-record format */
+	IMAGE_MEMORY,	/* target-memory pseudo-image */
+	IMAGE_ELF,		/* ELF binary */
+	IMAGE_SRECORD,	/* motorola s19 */
+	IMAGE_BUILDER,	/* when building a new image */
 } image_type_t;
 
 typedef struct image_section_s

Modified: trunk/src/target/mips32.c
===================================================================
--- trunk/src/target/mips32.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/mips32.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -320,7 +320,7 @@
 	return cache;
 }
 
-int mips32_init_arch_info(target_t *target, mips32_common_t *mips32, jtag_tap_t *tap, const char *variant)
+int mips32_init_arch_info(target_t *target, mips32_common_t *mips32, jtag_tap_t *tap)
 {
 	target->arch_info = mips32;
 	mips32->common_magic = MIPS32_COMMON_MAGIC;

Modified: trunk/src/target/mips32.h
===================================================================
--- trunk/src/target/mips32.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/mips32.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -119,7 +119,7 @@
 #define MIPS32_DRET					0x4200001F
 
 extern int mips32_arch_state(struct target_s *target);
-extern int mips32_init_arch_info(target_t *target, mips32_common_t *mips32, jtag_tap_t *tap, const char *variant);
+extern int mips32_init_arch_info(target_t *target, mips32_common_t *mips32, jtag_tap_t *tap);
 extern int mips32_restore_context(target_t *target);
 extern int mips32_save_context(target_t *target);
 extern reg_cache_t *mips32_build_reg_cache(target_t *target);

Modified: trunk/src/target/mips32_dmaacc.c
===================================================================
--- trunk/src/target/mips32_dmaacc.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/mips32_dmaacc.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -182,7 +182,7 @@
 		return ERROR_JTAG_DEVICE_ERROR;
 	}
 
-	// Handle the bigendian/littleendian
+	/* Handle the bigendian/littleendian */
 	switch (addr & 0x3) {
 		case 0:
 			*data = v & 0xff;

Modified: trunk/src/target/mips32_dmaacc.h
===================================================================
--- trunk/src/target/mips32_dmaacc.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/mips32_dmaacc.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -27,10 +27,10 @@
 
 #include "mips_ejtag.h"
 
-#define EJTAG_CTRL_DMA_BYTE        0x00000000
-#define EJTAG_CTRL_DMA_HALFWORD    0x00000080
-#define EJTAG_CTRL_DMA_WORD        0x00000100
-#define EJTAG_CTRL_DMA_TRIPLEBYTE  0x00000180
+#define EJTAG_CTRL_DMA_BYTE			0x00000000
+#define EJTAG_CTRL_DMA_HALFWORD		0x00000080
+#define EJTAG_CTRL_DMA_WORD			0x00000100
+#define EJTAG_CTRL_DMA_TRIPLEBYTE	0x00000180
 
 #define RETRY_ATTEMPTS	0
 
@@ -45,9 +45,4 @@
 extern int mips32_dmaacc_write_mem16(mips_ejtag_t *ejtag_info, u32 addr, int count, u16 *buf);
 extern int mips32_dmaacc_write_mem32(mips_ejtag_t *ejtag_info, u32 addr, int count, u32 *buf);
 
-#if 0
-extern int mips32_dmaacc_read_regs(mips_ejtag_t *ejtag_info, u32 *regs);
-extern int mips32_dmaacc_write_regs(mips_ejtag_t *ejtag_info, u32 *regs);
 #endif
-
-#endif

Modified: trunk/src/target/mips32_pracc.h
===================================================================
--- trunk/src/target/mips32_pracc.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/mips32_pracc.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -34,7 +34,7 @@
 #define UPPER16(u32) (u32 >> 16)
 #define LOWER16(u32) (u32 & 0xFFFF)
 #define NEG16(v) (((~(v)) + 1) & 0xFFFF)
-//#define NEG18(v) ( ((~(v)) + 1) & 0x3FFFF )
+/*#define NEG18(v) ( ((~(v)) + 1) & 0x3FFFF )*/
 
 extern int mips32_pracc_read_mem(mips_ejtag_t *ejtag_info, u32 addr, int size, int count, void *buf);
 extern int mips32_pracc_write_mem(mips_ejtag_t *ejtag_info, u32 addr, int size, int count, void *buf);

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/mips_m4k.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -265,7 +265,6 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
-	mips_m4k_common_t *mips_m4k = mips32->arch_info;
 
 	LOG_DEBUG("target->state: %s",
 		Jim_Nvp_value2name_simple( nvp_target_state, target->state )->name);
@@ -288,7 +287,7 @@
 		mips_ejtag_set_instr(ejtag_info, EJTAG_INST_NORMALBOOT, NULL);
 	}
 
-	if (strcmp(mips_m4k->variant, "ejtag_srst") == 0)
+	if (strcmp(target->variant, "ejtag_srst") == 0)
 	{
 		u32 ejtag_ctrl = ejtag_info->ejtag_ctrl | EJTAG_CTRL_PRRST | EJTAG_CTRL_PERRST;
 		LOG_DEBUG("Using EJTAG reset (PRRST) to reset processor...");
@@ -735,23 +734,14 @@
 	return ERROR_OK;
 }
 
-int mips_m4k_init_arch_info(target_t *target, mips_m4k_common_t *mips_m4k, jtag_tap_t *tap, const char *variant)
+int mips_m4k_init_arch_info(target_t *target, mips_m4k_common_t *mips_m4k, jtag_tap_t *tap)
 {
 	mips32_common_t *mips32 = &mips_m4k->mips32_common;
 
-	if (variant)
-	{
-		mips_m4k->variant = strdup(variant);
-	}
-	else
-	{
-		mips_m4k->variant = strdup("");
-	}
-
 	mips_m4k->common_magic = MIPSM4K_COMMON_MAGIC;
 
 	/* initialize mips4k specific info */
-	mips32_init_arch_info(target, mips32, tap, variant);
+	mips32_init_arch_info(target, mips32, tap);
 	mips32->arch_info = mips_m4k;
 
 	return ERROR_OK;
@@ -761,7 +751,7 @@
 {
 	mips_m4k_common_t *mips_m4k = calloc(1,sizeof(mips_m4k_common_t));
 
-	mips_m4k_init_arch_info(target, mips_m4k, target->tap, target->variant);
+	mips_m4k_init_arch_info(target, mips_m4k, target->tap);
 
 	return ERROR_OK;
 }

Modified: trunk/src/target/mips_m4k.h
===================================================================
--- trunk/src/target/mips_m4k.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/mips_m4k.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -32,8 +32,6 @@
 {
 	int common_magic;
 	mips32_common_t mips32_common;
-	
-	char *variant;
 } mips_m4k_common_t;
 
 extern int mips_m4k_bulk_write_memory(target_t *target, u32 address, u32 count, u8 *buffer);

Modified: trunk/src/target/oocd_trace.c
===================================================================
--- trunk/src/target/oocd_trace.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/oocd_trace.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -61,19 +61,19 @@
 
 int oocd_trace_write_reg(oocd_trace_t *oocd_trace, int reg, u32 value)
 {
-    size_t bytes_written;
-    u8 data[5];
+	size_t bytes_written;
+	u8 data[5];
 
-    data[0] = 0x18 | (reg & 0x7);
-    data[1] = value & 0xff;
-    data[2] = (value & 0xff00) >> 8;
-    data[3] = (value & 0xff0000) >> 16;
-    data[4] = (value & 0xff000000) >> 24;
+	data[0] = 0x18 | (reg & 0x7);
+	data[1] = value & 0xff;
+	data[2] = (value & 0xff00) >> 8;
+	data[3] = (value & 0xff0000) >> 16;
+	data[4] = (value & 0xff000000) >> 24;
 
-    bytes_written = write(oocd_trace->tty_fd, data, 5);
-    LOG_DEBUG("reg #%i: 0x%8.8x\n", reg, value);
+	bytes_written = write(oocd_trace->tty_fd, data, 5);
+	LOG_DEBUG("reg #%i: 0x%8.8x\n", reg, value);
 
-    return ERROR_OK;
+	return ERROR_OK;
 }
 
 int oocd_trace_read_memory(oocd_trace_t *oocd_trace, u8 *data, u32 address, u32 size)
@@ -143,7 +143,7 @@
 	 * read up any leftover characters to ensure communication is in sync */
 	while ((bytes_read = read(oocd_trace->tty_fd, trash, sizeof(trash))) > 0)
 	{
-	    LOG_DEBUG("%i bytes read\n", bytes_read);
+		LOG_DEBUG("%i bytes read\n", bytes_read);
 	};
 	
 	return ERROR_OK;
@@ -190,8 +190,8 @@
 	u8 *trace_data;
 	int i;
 
-    oocd_trace_read_reg(oocd_trace, OOCD_TRACE_STATUS, &status);
-    oocd_trace_read_reg(oocd_trace, OOCD_TRACE_ADDRESS, &address);
+	oocd_trace_read_reg(oocd_trace, OOCD_TRACE_STATUS, &status);
+	oocd_trace_read_reg(oocd_trace, OOCD_TRACE_ADDRESS, &address);
 
 	/* check if we overflowed, and adjust first frame of the trace accordingly
 	 * if we didn't overflow, read only up to the frame that would be written next,

Modified: trunk/src/target/oocd_trace.h
===================================================================
--- trunk/src/target/oocd_trace.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/oocd_trace.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -30,12 +30,12 @@
 /* registers */
 enum
 {
-    OOCD_TRACE_ID = 0x7,
-    OOCD_TRACE_ADDRESS = 0x0,
-    OOCD_TRACE_TRIGGER_COUNTER = 0x01,
-    OOCD_TRACE_CONTROL = 0x2,
-    OOCD_TRACE_STATUS = 0x3,
-    OOCD_TRACE_SDRAM_COUNTER = 0x4,
+	OOCD_TRACE_ID = 0x7,
+	OOCD_TRACE_ADDRESS = 0x0,
+	OOCD_TRACE_TRIGGER_COUNTER = 0x01,
+	OOCD_TRACE_CONTROL = 0x2,
+	OOCD_TRACE_STATUS = 0x3,
+	OOCD_TRACE_SDRAM_COUNTER = 0x4,
 };
 
 /* commands */

Modified: trunk/src/target/register.c
===================================================================
--- trunk/src/target/register.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/register.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -107,8 +107,6 @@
 	return NULL;
 }
 
-
-
 static int register_get_dummy_core_reg(reg_t *reg)
 {
 	return ERROR_OK;

Modified: trunk/src/target/register.h
===================================================================
--- trunk/src/target/register.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/register.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -70,4 +70,3 @@
 extern void register_init_dummy(reg_t *reg);
 
 #endif /* REGISTER_H */
-

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/target.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -61,7 +61,6 @@
 
 int cli_target_callback_event_handler(struct target_s *target, enum target_event event, void *priv);
 
-
 int handle_targets_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 int handle_reg_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
@@ -90,8 +89,6 @@
 static int target_array2mem(Jim_Interp *interp, target_t *target, int argc, Jim_Obj *const *argv);
 static int target_mem2array(Jim_Interp *interp, target_t *target, int argc, Jim_Obj *const *argv);
 
-
-
 /* targets */
 extern target_type_t arm7tdmi_target;
 extern target_type_t arm720t_target;
@@ -166,18 +163,15 @@
 	{ .value = TARGET_EVENT_OLD_gdb_program_config , .name = "old-gdb_program_config" },
 	{ .value = TARGET_EVENT_OLD_pre_resume         , .name = "old-pre_resume" },
 
-
 	{ .value = TARGET_EVENT_EARLY_HALTED, .name = "early-halted" },
 	{ .value = TARGET_EVENT_HALTED, .name = "halted" },
 	{ .value = TARGET_EVENT_RESUMED, .name = "resumed" },
 	{ .value = TARGET_EVENT_RESUME_START, .name = "resume-start" },
 	{ .value = TARGET_EVENT_RESUME_END, .name = "resume-end" },
 
-
 	{ .name = "gdb-start", .value = TARGET_EVENT_GDB_START },
 	{ .name = "gdb-end", .value = TARGET_EVENT_GDB_END },
 
-
 	/* historical name */
 
 	{ .value = TARGET_EVENT_RESET_START, .name = "reset-start" },
@@ -193,21 +187,15 @@
 	{ .value = TARGET_EVENT_RESET_INIT , .name = "reset-init" },
 	{ .value = TARGET_EVENT_RESET_END, .name = "reset-end" },
 
-
-
-
-
 	{ .value = TARGET_EVENT_EXAMINE_START, .name = "examine-start" },
 	{ .value = TARGET_EVENT_EXAMINE_END, .name = "examine-end" },
 
-
 	{ .value = TARGET_EVENT_DEBUG_HALTED, .name = "debug-halted" },
 	{ .value = TARGET_EVENT_DEBUG_RESUMED, .name = "debug-resumed" },
 
 	{ .value = TARGET_EVENT_GDB_ATTACH, .name = "gdb-attach" },
 	{ .value = TARGET_EVENT_GDB_DETACH, .name = "gdb-detach" },
 
-
 	{ .value = TARGET_EVENT_GDB_FLASH_WRITE_START, .name = "gdb-flash-write-start" },
 	{ .value = TARGET_EVENT_GDB_FLASH_WRITE_END  , .name = "gdb-flash-write-end"   },
 
@@ -230,7 +218,6 @@
 	{ .name = NULL, .value = -1 },
 };
 
-
 const Jim_Nvp nvp_target_debug_reason [] = {
 	{ .name = "debug-request"            , .value = DBG_REASON_DBGRQ },
 	{ .name = "breakpoint"               , .value = DBG_REASON_BREAKPOINT },
@@ -247,7 +234,7 @@
 	{ .name = "big",    .value = TARGET_BIG_ENDIAN },
 	{ .name = "little", .value = TARGET_LITTLE_ENDIAN },
 	{ .name = "be",     .value = TARGET_BIG_ENDIAN },
-        { .name = "le",     .value = TARGET_LITTLE_ENDIAN },
+	{ .name = "le",     .value = TARGET_LITTLE_ENDIAN },
 	{ .name = NULL,     .value = -1 },
 };
 
@@ -378,7 +365,6 @@
 	return target;
 }
 
-
 int target_poll(struct target_s *target)
 {
 	/* We can't poll until after examine */
@@ -422,7 +408,6 @@
 	return retval;
 }
 
-
 int target_process_reset(struct command_context_s *cmd_ctx, enum target_reset_mode reset_mode)
 {
 	char buf[100];
@@ -448,7 +433,6 @@
 	return retval;
 }
 
-
 static int default_virt2phys(struct target_s *target, u32 virtual, u32 *physical)
 {
 	*physical = virtual;
@@ -467,7 +451,6 @@
 	return ERROR_OK;
 }
 
-
 /* Targets that correctly implement init+examine, i.e.
  * no communication with target during init:
  *
@@ -563,7 +546,6 @@
 		target->type->run_algorithm_imp = target->type->run_algorithm;
 		target->type->run_algorithm = target_run_algorithm_imp;
 
-
 		if (target->type->mmu == NULL)
 		{
 			target->type->mmu = default_mmu;
@@ -709,7 +691,6 @@
 		target_call_event_callbacks(target, TARGET_EVENT_EARLY_HALTED);
 	}
 
-
 	LOG_DEBUG("target event %i (%s)",
 			  event,
 			  Jim_Nvp_value2name_simple( nvp_target_event, event )->name );
@@ -1051,7 +1032,6 @@
 	return ERROR_OK;
 }
 
-
 /* Single aligned words are guaranteed to use 16 or 32 bit access
  * mode respectively, otherwise data is handled as quickly as
  * possible
@@ -1347,7 +1327,6 @@
 	if((retval = trace_register_commands(cmd_ctx)) != ERROR_OK)
 		return retval;
 
-
 	return retval;
 }
 
@@ -1387,7 +1366,7 @@
 	}
 DumpTargets:
 
-  target = all_targets;
+	target = all_targets;
 	command_print(cmd_ctx, "    CmdName    Type       Endian     AbsChainPos Name          State     ");
 	command_print(cmd_ctx, "--  ---------- ---------- ---------- ----------- ------------- ----------");
 	while (target)
@@ -1407,8 +1386,7 @@
 	return ERROR_OK;
 }
 
-// every 300ms we check for reset & powerdropout and issue a "reset halt" if
-// so.
+/* every 300ms we check for reset & powerdropout and issue a "reset halt" if so. */
 
 static int powerDropout;
 static int srstAsserted;
@@ -1476,7 +1454,6 @@
 	return ERROR_OK;
 }
 
-
 /* process target state changes */
 int handle_target(void *priv)
 {
@@ -1546,7 +1523,6 @@
 		target = target->next;
 	}
 
-
 	return retval;
 }
 
@@ -1661,7 +1637,6 @@
 	return ERROR_OK;
 }
 
-
 int handle_poll_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	int retval = ERROR_OK;
@@ -1694,7 +1669,6 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-
 	return retval;
 }
 
@@ -1739,14 +1713,14 @@
 		{
 			once=0;
 			LOG_DEBUG("waiting for target %s...",
-			      Jim_Nvp_value2name_simple(nvp_target_state,state)->name);
+				Jim_Nvp_value2name_simple(nvp_target_state,state)->name);
 		}
 
 		gettimeofday(&now, NULL);
 		if ((now.tv_sec > timeout.tv_sec) || ((now.tv_sec == timeout.tv_sec) && (now.tv_usec >= timeout.tv_usec)))
 		{
 			LOG_ERROR("timed out while waiting for target %s",
-			      Jim_Nvp_value2name_simple(nvp_target_state,state)->name);
+				Jim_Nvp_value2name_simple(nvp_target_state,state)->name);
 			return ERROR_FAIL;
 		}
 	}
@@ -1858,7 +1832,6 @@
 
 	address = strtoul(args[0], NULL, 0);
 
-
 	switch (cmd[2])
 	{
 		case 'w':
@@ -2025,7 +1998,6 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-
 	duration_start_measure(&duration);
 
 	if (image_open(&image, args[0], (argc >= 3) ? args[2] : NULL) != ERROR_OK)
@@ -2053,7 +2025,6 @@
 		u32 offset=0;
 		u32 length=buf_cnt;
 
-
 		/* DANGER!!! beware of unsigned comparision here!!! */
 
 		if ((image.sections[i].base_address+buf_cnt>=min_address)&&
@@ -2470,6 +2441,7 @@
 	}
 	return retval;
 }
+
 static void writeLong(FILE *f, int l)
 {
 	int i;
@@ -2480,14 +2452,13 @@
 	}
 
 }
+
 static void writeString(FILE *f, char *s)
 {
 	fwrite(s, 1, strlen(s), f);
 }
 
-
-
-// Dump a gmon.out histogram file.
+/* Dump a gmon.out histogram file. */
 static void writeGmon(u32 *samples, int sampleNum, char *filename)
 {
 	int i;
@@ -2495,14 +2466,14 @@
 	if (f==NULL)
 		return;
 	fwrite("gmon", 1, 4, f);
-	writeLong(f, 0x00000001); // Version
-	writeLong(f, 0); // padding
-	writeLong(f, 0); // padding
-	writeLong(f, 0); // padding
+	writeLong(f, 0x00000001); /* Version */
+	writeLong(f, 0); /* padding */
+	writeLong(f, 0); /* padding */
+	writeLong(f, 0); /* padding */
 
-	fwrite("", 1, 1, f);  // GMON_TAG_TIME_HIST
+	fwrite("", 1, 1, f);  /* GMON_TAG_TIME_HIST */
 
-	// figure out bucket size
+	/* figure out bucket size */
 	u32 min=samples[0];
 	u32 max=samples[0];
 	for (i=0; i<sampleNum; i++)
@@ -2519,7 +2490,7 @@
 
 	int addressSpace=(max-min+1);
 
-	static int const maxBuckets=256*1024; // maximum buckets.
+	static int const maxBuckets=256*1024; /* maximum buckets. */
 	int length=addressSpace;
 	if (length > maxBuckets)
 	{
@@ -2538,23 +2509,23 @@
 		long long a=address-min;
 		long long b=length-1;
 		long long c=addressSpace-1;
-		int index=(a*b)/c; // danger!!!! int32 overflows
+		int index=(a*b)/c; /* danger!!!! int32 overflows */
 		buckets[index]++;
 	}
 
-	//			   append binary memory gmon.out &profile_hist_hdr ((char*)&profile_hist_hdr + sizeof(struct gmon_hist_hdr))
-	writeLong(f, min); 					// low_pc
-	writeLong(f, max);		// high_pc
-	writeLong(f, length);		// # of samples
-	writeLong(f, 64000000); 			// 64MHz
+	/* append binary memory gmon.out &profile_hist_hdr ((char*)&profile_hist_hdr + sizeof(struct gmon_hist_hdr)) */
+	writeLong(f, min); 			/* low_pc */
+	writeLong(f, max);			/* high_pc */
+	writeLong(f, length);		/* # of samples */
+	writeLong(f, 64000000); 	/* 64MHz */
 	writeString(f, "seconds");
 	for (i=0; i<(15-strlen("seconds")); i++)
 	{
-		fwrite("", 1, 1, f);  // padding
+		fwrite("", 1, 1, f);	/* padding */
 	}
 	writeString(f, "s");
 
-//			   append binary memory gmon.out profile_hist_data (profile_hist_data + profile_hist_hdr.hist_size)
+	/*append binary memory gmon.out profile_hist_data (profile_hist_data + profile_hist_hdr.hist_size) */
 
 	char *data=malloc(2*length);
 	if (data!=NULL)
@@ -2608,7 +2579,7 @@
 
 	int numSamples=0;
 	int retval=ERROR_OK;
-	// hopefully it is safe to cache! We want to stop/restart as quickly as possible.
+	/* hopefully it is safe to cache! We want to stop/restart as quickly as possible. */
 	reg_t *reg = register_get_by_name(target->reg_cache, "pc", 1);
 
 	for (;;)
@@ -2620,10 +2591,10 @@
 			samples[numSamples++]=t;
 			retval = target_resume(target, 1, 0, 0, 0); /* current pc, addr = 0, do not handle breakpoints, not debugging */
 			target_poll(target);
-			alive_sleep(10); // sleep 10ms, i.e. <100 samples/second.
+			alive_sleep(10); /* sleep 10ms, i.e. <100 samples/second. */
 		} else if (target->state == TARGET_RUNNING)
 		{
-			// We want to quickly sample the PC.
+			/* We want to quickly sample the PC. */
 			if((retval = target_halt(target)) != ERROR_OK)
 			{
 				free(samples);
@@ -2898,7 +2869,6 @@
 	return target_array2mem( interp,target, argc, argv );
 }
 
-
 static int target_array2mem(Jim_Interp *interp, target_t *target, int argc, Jim_Obj *const *argv)
 {
 	long l;
@@ -2983,7 +2953,6 @@
 		return JIM_ERR;
 	}
 
-
 	/* Transfer loop */
 
 	/* index counter */
@@ -3031,15 +3000,13 @@
 	return JIM_OK;
 }
 
-void
-target_all_handle_event( enum target_event e )
+void target_all_handle_event( enum target_event e )
 {
 	target_t *target;
 
-
 	LOG_DEBUG( "**all*targets: event: %d, %s",
-		   e,
-		   Jim_Nvp_value2name_simple( nvp_target_event, e )->name );
+			e,
+			Jim_Nvp_value2name_simple( nvp_target_event, e )->name );
 
 	target = all_targets;
 	while (target){
@@ -3048,8 +3015,7 @@
 	}
 }
 
-void
-target_handle_event( target_t *target, enum target_event e )
+void target_handle_event( target_t *target, enum target_event e )
 {
 	target_event_action_t *teap;
 	int done;
@@ -3093,7 +3059,6 @@
 	TCFG_CHAIN_POSITION,
 };
 
-
 static Jim_Nvp nvp_config_opts[] = {
 	{ .name = "-type",             .value = TCFG_TYPE },
 	{ .name = "-event",            .value = TCFG_EVENT },
@@ -3108,10 +3073,7 @@
 	{ .name = NULL, .value = -1 }
 };
 
-
-static int
-target_configure( Jim_GetOptInfo *goi,
-				  target_t *target )
+static int target_configure( Jim_GetOptInfo *goi, target_t *target )
 {
 	Jim_Nvp *n;
 	Jim_Obj *o;
@@ -3119,11 +3081,10 @@
 	char *cp;
 	int e;
 
-
 	/* parse config or cget options ... */
 	while( goi->argc > 0 ){
 		Jim_SetEmptyResult( goi->interp );
-		//Jim_GetOpt_Debug( goi );
+		/* Jim_GetOpt_Debug( goi ); */
 
 		if( target->type->target_jim_configure ){
 			/* target defines a configure function */
@@ -3184,7 +3145,6 @@
 				}
 			}
 
-
 			{
 				target_event_action_t *teap;
 
@@ -3377,12 +3337,8 @@
 	return JIM_OK;
 }
 
-
 /** this is the 'tcl' handler for the target specific command */
-static int
-tcl_target_func( Jim_Interp *interp,
-				 int argc,
-				 Jim_Obj *const *argv )
+static int tcl_target_func( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
 {
 	Jim_GetOptInfo goi;
 	jim_wide a,b,c;
@@ -3393,7 +3349,6 @@
 	struct command_context_s *cmd_ctx;
 	int e;
 
-
 	enum {
 		TS_CMD_CONFIGURE,
 		TS_CMD_CGET,
@@ -3436,7 +3391,6 @@
 		{ .name = NULL, .value = -1 },
 	};
 
-
 	/* go past the "command" */
 	Jim_GetOpt_Setup( &goi, interp, argc-1, argv+1 );
 
@@ -3449,7 +3403,7 @@
 		Jim_GetOpt_NvpUnknown( &goi, target_options, 0 );
 		return e;
 	}
-	// Assume blank result
+	/* Assume blank result */
 	Jim_SetEmptyResult( goi.interp );
 
 	switch( n->value ){
@@ -3680,17 +3634,17 @@
 			Jim_GetOpt_NvpUnknown( &goi, nvp_assert, 1 );
 			return e;
 		}
-		// the halt or not param
+		/* the halt or not param */
 		e = Jim_GetOpt_Wide( &goi, &a);
 		if( e != JIM_OK ){
 			return e;
 		}
-		// determine if we should halt or not.
+		/* determine if we should halt or not. */
 		target->reset_halt = !!a;
-		// When this happens - all workareas are invalid.
+		/* When this happens - all workareas are invalid. */
 		target_free_all_working_areas_restore(target, 0);
 
-		// do the assert
+		/* do the assert */
 		if( n->value == NVP_ASSERT ){
 			target->type->assert_reset( target );
 		} else {
@@ -3705,7 +3659,7 @@
 		target->type->halt( target );
 		return JIM_OK;
 	case TS_CMD_WAITSTATE:
-		// params:  <name>  statename timeoutmsecs
+		/* params:  <name>  statename timeoutmsecs */
 		if( goi.argc != 2 ){
 			Jim_SetResult_sprintf( goi.interp, "%s STATENAME TIMEOUTMSECS", n->name );
 			return JIM_ERR;
@@ -3725,7 +3679,7 @@
 								   "target: %s wait %s fails (%d) %s",
 								   target->cmd_name,
 								   n->name,
-					       e, target_strerror_safe(e) );
+								   e, target_strerror_safe(e) );
 			return JIM_ERR;
 		} else {
 			return JIM_OK;
@@ -3776,11 +3730,8 @@
 	return JIM_ERR;
 }
 
-
-static int
-target_create( Jim_GetOptInfo *goi )
+static int target_create( Jim_GetOptInfo *goi )
 {
-
 	Jim_Obj *new_cmd;
 	Jim_Cmd *cmd;
 	const char *cp;
@@ -3834,7 +3785,6 @@
 		return JIM_ERR;
 	}
 
-
 	/* Create it */
 	target = calloc(1,sizeof(target_t));
 	/* set target number */
@@ -3892,6 +3842,10 @@
 		target->endianness = TARGET_LITTLE_ENDIAN;
 	}
 
+	/* incase variant is not set */
+	if (!target->variant)
+		target->variant = strdup("");
+	
 	/* create the target specific commands */
 	if( target->type->register_commands ){
 		(*(target->type->register_commands))( cmd_ctx );
@@ -3924,8 +3878,7 @@
 	return e;
 }
 
-static int
-jim_target( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
+static int jim_target( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
 {
 	int x,r,e;
 	jim_wide w;
@@ -3944,7 +3897,7 @@
 	const char *target_cmds[] = {
 		"create", "types", "names", "current", "number",
 		"count",
-		NULL // terminate
+		NULL /* terminate */
 	};
 
 	LOG_DEBUG("Target command params:");
@@ -3959,7 +3912,7 @@
 		return JIM_ERR;
 	}
 
-	//Jim_GetOpt_Debug( &goi );
+	/* Jim_GetOpt_Debug( &goi ); */
 	r = Jim_GetOpt_Enum( &goi, target_cmds, &x   );
 	if( r != JIM_OK ){
 		return r;

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/target.h	2008-12-13 12:44:39 UTC (rev 1238)
@@ -40,15 +40,15 @@
 struct reg_s;
 struct command_context_s;
 /*
-TARGET_UNKNOWN = 0: we don't know anything about the target yet
-TARGET_RUNNING = 1: the target is executing user code
-TARGET_HALTED  = 2: the target is not executing code, and ready to talk to the
-debugger. on an xscale it means that the debug handler is executing
-TARGET_RESET   = 3: the target is being held in reset (only a temporary state,
-not sure how this is used with all the recent changes)
-TARGET_DEBUG_RUNNING = 4: the target is running, but it is executing code on
-behalf of the debugger (e.g. algorithm for flashing)
-*/
+ * TARGET_UNKNOWN = 0: we don't know anything about the target yet
+ * TARGET_RUNNING = 1: the target is executing user code
+ * TARGET_HALTED  = 2: the target is not executing code, and ready to talk to the
+ * debugger. on an xscale it means that the debug handler is executing
+ * TARGET_RESET   = 3: the target is being held in reset (only a temporary state,
+ * not sure how this is used with all the recent changes)
+ * TARGET_DEBUG_RUNNING = 4: the target is running, but it is executing code on
+ * behalf of the debugger (e.g. algorithm for flashing) */
+
 enum target_state
 {
 	TARGET_UNKNOWN = 0,
@@ -228,7 +228,7 @@
 	 *
 	 * It is illegal to talk to the target at this stage as this fn is invoked
 	 * before the JTAG chain has been examined/verified
-     */
+	 * */
 	int (*init_target)(struct command_context_s *cmd_ctx, struct target_s *target);
 	int (*quit)(void);
 
@@ -237,21 +237,21 @@
 
 } target_type_t;
 
-// forward decloration
+/* forward decloration */
 typedef struct target_event_action_s target_event_action_t;
 
 typedef struct target_s
 {
 	target_type_t *type;				/* target type definition (name, access functions) */
-	const char *cmd_name;               /* tcl Name of target */
-	int target_number;                  /* generaly, target index but may not be in order */
-	jtag_tap_t *tap;                 /* where on the jtag chain is this */
-	const char *variant;                /* what varient of this chip is it? */
+	const char *cmd_name;				/* tcl Name of target */
+	int target_number;					/* generaly, target index but may not be in order */
+	jtag_tap_t *tap;					/* where on the jtag chain is this */
+	const char *variant;				/* what varient of this chip is it? */
 	target_event_action_t *event_action;
 
 	int reset_halt;						/* attempt resetting the CPU into the halted mode? */
 	u32 working_area;					/* working area (initialized RAM). Evaluated
-										   upon first allocation from virtual/physical address. */
+										 * upon first allocation from virtual/physical address. */
 	u32 working_area_virt;				/* virtual address */
 	u32 working_area_phys;				/* physical address */
 	u32 working_area_size;				/* size in bytes */
@@ -269,27 +269,27 @@
 	void *arch_info;					/* architecture specific information */
 	struct target_s *next;				/* next target in list */
 
-	int display; 						/* display async info in telnet session. Do not display
-										   lots of halted/resumed info when stepping in debugger. */
+	int display;						/* display async info in telnet session. Do not display
+										 * lots of halted/resumed info when stepping in debugger. */
 } target_t;
 
 enum target_event
 {
-	// OLD historical names
-	//  - Prior to the great TCL change
-	//  - June/July/Aug 2008
-	//  - Duane Ellis
+	/* LD historical names
+	 * - Prior to the great TCL change
+	 * - June/July/Aug 2008
+	 * - Duane Ellis */
 	TARGET_EVENT_OLD_gdb_program_config,
 	TARGET_EVENT_OLD_pre_reset,
 	TARGET_EVENT_OLD_post_reset,
 	TARGET_EVENT_OLD_pre_resume,
 
 	/* allow GDB to do stuff before others handle the halted event,
- 	this is in lieu of defining ordering of invocation of events,
- 	which would be more complicated */
- 	TARGET_EVENT_EARLY_HALTED,
- 	TARGET_EVENT_HALTED,		/* target entered debug state from normal execution or reset */
- 	TARGET_EVENT_RESUMED,		/* target resumed to normal execution */
+	 * this is in lieu of defining ordering of invocation of events,
+	 * which would be more complicated */
+	TARGET_EVENT_EARLY_HALTED,
+	TARGET_EVENT_HALTED,		/* target entered debug state from normal execution or reset */
+	TARGET_EVENT_RESUMED,		/* target resumed to normal execution */
 	TARGET_EVENT_RESUME_START,
 	TARGET_EVENT_RESUME_END,
 
@@ -308,14 +308,12 @@
 	TARGET_EVENT_RESET_INIT,
 	TARGET_EVENT_RESET_END,
 
+	TARGET_EVENT_DEBUG_HALTED,	/* target entered debug state, but was executing on behalf of the debugger */
+	TARGET_EVENT_DEBUG_RESUMED, /* target resumed to execute on behalf of the debugger */
 
- 	TARGET_EVENT_DEBUG_HALTED,	/* target entered debug state, but was executing on behalf of the debugger */
- 	TARGET_EVENT_DEBUG_RESUMED, /* target resumed to execute on behalf of the debugger */
-
 	TARGET_EVENT_EXAMINE_START,
 	TARGET_EVENT_EXAMINE_END,
 
-
 	TARGET_EVENT_GDB_ATTACH,
 	TARGET_EVENT_GDB_DETACH,
 
@@ -330,7 +328,7 @@
 struct target_event_action_s {
 	enum target_event event;
 	Jim_Obj *body;
-	int      has_percent;
+	int has_percent;
 	target_event_action_t *next;
  };
 
@@ -428,7 +426,6 @@
 void target_handle_event( target_t *t, enum target_event e);
 void target_all_handle_event( enum target_event e );
 
-
 #define ERROR_TARGET_INVALID	(-300)
 #define ERROR_TARGET_INIT_FAILED (-301)
 #define ERROR_TARGET_TIMEOUT	(-302)

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2008-12-13 07:05:38 UTC (rev 1237)
+++ trunk/src/target/xscale.c	2008-12-13 12:44:39 UTC (rev 1238)
@@ -353,8 +353,6 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-
-
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
@@ -474,8 +472,6 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-
-
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
@@ -572,8 +568,6 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-
-
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
@@ -749,8 +743,6 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-
-
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
@@ -1718,7 +1710,7 @@
 
 			for (; buf_cnt < 32; buf_cnt += 4)
 			{
-					cache_line[buf_cnt / 4] = 0xe1a08008;
+				cache_line[buf_cnt / 4] = 0xe1a08008;
 			}
 
 			/* only load addresses other than the reset vectors */
@@ -1766,19 +1758,16 @@
 		jtag_add_reset(0, 0);
 	}
 
-
 	return ERROR_OK;
 }
 
 int xscale_soft_reset_halt(struct target_s *target)
 {
-
 	return ERROR_OK;
 }
 
 int xscale_read_core_reg(struct target_s *target, int num, enum armv4_5_mode mode)
 {
-
 	return ERROR_OK;
 }
 
@@ -2243,7 +2232,6 @@
 	}
 
 	return ERROR_OK;
-
 }
 
 int xscale_add_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
@@ -3041,7 +3029,6 @@
 
 int xscale_quit(void)
 {
-
 	return ERROR_OK;
 }
 
@@ -3267,7 +3254,6 @@
 	int domain;
 	u32 ap;
 
-
 	if ((retval = xscale_get_arch_pointers(target, &armv4_5, &xscale)) != ERROR_OK)
 	{
 		return retval;
@@ -3295,7 +3281,6 @@
 	return ERROR_OK;
 }
 
-
 int xscale_handle_mmu_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);



From duane at mail.berlios.de  Sat Dec 13 14:11:18 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 13 Dec 2008 14:11:18 +0100
Subject: [Openocd-svn] r1239 - trunk/src/target/target
Message-ID: <200812131311.mBDDBIW2012408@sheep.berlios.de>

Author: duane
Date: 2008-12-13 14:11:15 +0100 (Sat, 13 Dec 2008)
New Revision: 1239

Added:
   trunk/src/target/target/samsung_s3c2440.cfg
Removed:
   trunk/src/target/target/s3c2440.cfg
Log:
Updates and fixes from Kees Jongenburger

Deleted: trunk/src/target/target/s3c2440.cfg
===================================================================
--- trunk/src/target/target/s3c2440.cfg	2008-12-13 12:44:39 UTC (rev 1238)
+++ trunk/src/target/target/s3c2440.cfg	2008-12-13 13:11:15 UTC (rev 1239)
@@ -1,37 +0,0 @@
-# Target configuration for the Samsung 2440 system on chip
-# Tested on a S3C2440 Evaluation board
-# Processor       : ARM920Tid(wb) rev 0 (v4l)
-# Info:   JTAG device found: 0x0032409d (Manufacturer: 0x04e, Part: 0x0324, Version: 0x0)
-# [Duane Ellis 27/nov/2008: Above 0x0032409d appears to be copy/paste from other places]
-# [and I do not believe it to be accurate, hence the 0xffffffff below]
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME s3c2440
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-  # this defaults to a bigendian
-   set  _ENDIAN little
-}
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-  # force an error till we get a good number
-   set _CPUTAPID 0xFFFFFFFF
-}
-
-#jtag scan chain
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm920t -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm920t
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x200000 -work-area-size 0x4000 -work-area-backup 1
-
-#reset configuration
-reset_config trst_and_srst
-

Copied: trunk/src/target/target/samsung_s3c2440.cfg (from rev 1238, trunk/src/target/target/s3c2440.cfg)
===================================================================
--- trunk/src/target/target/s3c2440.cfg	2008-12-13 12:44:39 UTC (rev 1238)
+++ trunk/src/target/target/samsung_s3c2440.cfg	2008-12-13 13:11:15 UTC (rev 1239)
@@ -0,0 +1,35 @@
+# Target configuration for the Samsung 2440 system on chip
+# Tested on a S3C2440 Evaluation board by keesj
+# Processor       : ARM920Tid(wb) rev 0 (v4l)
+# Info:   JTAG tap: s3c2440.cpu tap/device found: 0x0032409d (Manufacturer: 0x04e, Part: 0x0324, Version: 0x0)
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME s3c2440
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+  # this defaults to a bigendian
+   set  _ENDIAN little
+}
+
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+  # force an error till we get a good number
+   set _CPUTAPID 0x0032409d
+}
+
+#jtag scan chain
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME arm920t -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm920t
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x200000 -work-area-size 0x4000 -work-area-backup 1
+
+#reset configuration
+reset_config trst_and_srst
+


Property changes on: trunk/src/target/target/samsung_s3c2440.cfg
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native



From kc8apf at mail.berlios.de  Sun Dec 14 21:33:09 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Sun, 14 Dec 2008 21:33:09 +0100
Subject: [Openocd-svn] r1240 - trunk/src/jtag
Message-ID: <200812142033.mBEKX9Zf020746@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-14 21:33:01 +0100 (Sun, 14 Dec 2008)
New Revision: 1240

Modified:
   trunk/src/jtag/bitbang.c
   trunk/src/jtag/bitq.c
   trunk/src/jtag/ft2232.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/jlink.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/usbprog.c
   trunk/src/jtag/zy1000.c
Log:
- Update tap_state_strings to correspond to SVF state names
- Use new jtag_state_name() instead of global tap_state_strings[]


Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2008-12-13 13:11:15 UTC (rev 1239)
+++ trunk/src/jtag/bitbang.c	2008-12-14 20:33:01 UTC (rev 1240)
@@ -109,7 +109,7 @@
 		}
 		else
 		{
-			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[cmd->path[state_count]]);
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(cmd->path[state_count]));
 			exit(-1);
 		}
 

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2008-12-13 13:11:15 UTC (rev 1239)
+++ trunk/src/jtag/bitq.c	2008-12-14 20:33:01 UTC (rev 1240)
@@ -172,7 +172,7 @@
 		if (tap_transitions[cur_state].low == cmd->path[i]) bitq_io(0, 0, 0);
 		else if (tap_transitions[cur_state].high == cmd->path[i]) bitq_io(1, 0, 0);
 		else {
-			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[cmd->path[i]]);
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(cmd->path[i)]);
 			exit(-1);
 		}
 

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2008-12-13 13:11:15 UTC (rev 1239)
+++ trunk/src/jtag/ft2232.c	2008-12-14 20:33:01 UTC (rev 1240)
@@ -525,7 +525,7 @@
 				buf_set_u32(&tms_byte, bit_count++, 1, 0x1);
 			else
 			{
-				LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[cmd->path[state_count]]);
+				LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(cmd->path[state_count]));
 				exit(-1);
 			}
 

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2008-12-13 13:11:15 UTC (rev 1239)
+++ trunk/src/jtag/gw16012.c	2008-12-14 20:33:01 UTC (rev 1240)
@@ -240,7 +240,7 @@
 		}
 		else
 		{
-			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[cmd->path[state_count]]);
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(cmd->path[state_count]));
 			exit(-1);
 		}
 

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2008-12-13 13:11:15 UTC (rev 1239)
+++ trunk/src/jtag/jlink.c	2008-12-14 20:33:01 UTC (rev 1240)
@@ -376,7 +376,7 @@
 		}
 		else
 		{
-			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[path[i]]);
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(path[i]));
 			exit(-1);
 		}
 

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-13 13:11:15 UTC (rev 1239)
+++ trunk/src/jtag/jtag.c	2008-12-14 20:33:01 UTC (rev 1240)
@@ -41,14 +41,6 @@
 int jtag_error=ERROR_OK;
 
 
-char* tap_state_strings[16] =
-{
-	"tlr",
-	"sds", "cd", "sd", "e1d", "pd", "e2d", "ud",
-	"rti",
-	"sis", "ci", "si", "e1i", "pi", "e2i", "ui"
-};
-
 typedef struct cmd_queue_page_s
 {
 	void *address;
@@ -1004,7 +996,7 @@
 		if ((tap_transitions[cur_state].low != path[i])&&
 				(tap_transitions[cur_state].high != path[i]))
 		{
-			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[path[i]]);
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(path[i]));
 			exit(-1);
 		}
 		cur_state = path[i];
@@ -2656,14 +2648,14 @@
 	{
 		for (state = 0; state < 16; state++)
 		{
-			if (strcmp(args[0], tap_state_strings[state]) == 0)
+			if (strcmp(args[0], jtag_state_name(state)) == 0)
 			{
 				jtag_add_end_state(state);
 				jtag_execute_queue();
 			}
 		}
 	}
-	command_print(cmd_ctx, "current endstate: %s", tap_state_strings[cmd_queue_end_state]);
+	command_print(cmd_ctx, "current endstate: %s", jtag_state_name(cmd_queue_end_state));
 
 	return ERROR_OK;
 }
@@ -2915,3 +2907,34 @@
 				Jim_Nvp_value2name_simple( nvp_jtag_tap_event, e)->name);
 	}
 }
+
+
+/* map state number to SVF state string */
+const char* jtag_state_name(enum tap_state state)
+{
+	const char* ret;
+
+	switch( state )
+	{
+	case TAP_RESET:		ret = "RESET";			break;
+	case TAP_IDLE:		ret = "IDLE";			break;
+	case TAP_DRSELECT:	ret = "DRSELECT";		break;
+	case TAP_DRCAPTURE: ret = "DRCAPTURE";		break;
+	case TAP_DRSHIFT:	ret = "DRSHIFT";			break;
+	case TAP_DREXIT1:	ret = "DREXIT1";			break;
+	case TAP_DRPAUSE:	ret = "DRPAUSE";			break;
+	case TAP_DREXIT2:	ret = "DREXIT2";			break;
+	case TAP_DRUPDATE:	ret = "DRUPDATE";		break;
+	case TAP_IRSELECT:	ret = "IRSELECT";		break;
+	case TAP_IRCAPTURE: ret = "IRCAPTURE";		break;
+	case TAP_IRSHIFT:	ret = "IRSHIFT";			break;
+	case TAP_IREXIT1:	ret = "IREXIT1";			break;
+	case TAP_IRPAUSE:	ret = "IRPAUSE";			break;
+	case TAP_IREXIT2:	ret = "IREXIT2";			break;
+	case TAP_IRUPDATE:	ret = "IRUPDATE";		break;
+	default:				ret = "???";
+	}
+
+	return ret;
+}
+

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2008-12-13 13:11:15 UTC (rev 1239)
+++ trunk/src/jtag/jtag.h	2008-12-14 20:33:01 UTC (rev 1240)
@@ -50,7 +50,6 @@
 	enum tap_state low;
 } tap_transition_t;
 
-extern char* tap_state_strings[16];
 extern int tap_move_map[16];	/* map 16 TAP states to 6 stable states */
 extern u8 tap_move[6][6];		/* value scanned to TMS to move from one of six stable states to another */
 extern tap_transition_t tap_transitions[16];	/* describe the TAP state diagram */
@@ -529,4 +528,11 @@
 	interface_jtag_add_dr_out(tap, num_fields, num_bits, value, cmd_queue_end_state);
 }
 
+/**
+ * Function jtag_state_name
+ * Returns a string suitable for display representing the JTAG tap_state 
+ */
+const char* jtag_state_name(enum tap_state state);
+
+
 #endif /* JTAG_H */

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2008-12-13 13:11:15 UTC (rev 1239)
+++ trunk/src/jtag/usbprog.c	2008-12-14 20:33:01 UTC (rev 1240)
@@ -282,7 +282,7 @@
 		}
 		else
 		{
-			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[cmd->path[state_count]]);
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(cmd->path[state_count]));
 			exit(-1);
 		}
 

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2008-12-13 13:11:15 UTC (rev 1239)
+++ trunk/src/jtag/zy1000.c	2008-12-14 20:33:01 UTC (rev 1240)
@@ -266,51 +266,51 @@
 int loadFile(const char *fileName, void **data, int *len)
 {
 	FILE * pFile;
-	pFile = fopen (fileName,"rb");
+	pFile = fopen(fileName,"rb");
 	if (pFile==NULL)
 	{
 		LOG_ERROR("Can't open %s\n", fileName);
 		return ERROR_JTAG_DEVICE_ERROR;
 	}
-    if (fseek (pFile, 0, SEEK_END)!=0)
-    {
+	if (fseek(pFile, 0, SEEK_END)!=0)
+	{
 		LOG_ERROR("Can't open %s\n", fileName);
 		fclose(pFile);
 		return ERROR_JTAG_DEVICE_ERROR;
-    }
-    *len=ftell (pFile);
-    if (*len==-1)
-    {
+	}
+	*len=ftell(pFile);
+	if (*len==-1)
+	{
 		LOG_ERROR("Can't open %s\n", fileName);
 		fclose(pFile);
 		return ERROR_JTAG_DEVICE_ERROR;
-    }
+	}
 
-    if (fseek (pFile, 0, SEEK_SET)!=0)
-    {
+	if (fseek(pFile, 0, SEEK_SET)!=0)
+	{
 		LOG_ERROR("Can't open %s\n", fileName);
 		fclose(pFile);
 		return ERROR_JTAG_DEVICE_ERROR;
-    }
-    *data=malloc(*len+1);
-    if (*data==NULL)
-    {
+	}
+	*data=malloc(*len+1);
+	if (*data==NULL)
+	{
 		LOG_ERROR("Can't open %s\n", fileName);
 		fclose(pFile);
 		return ERROR_JTAG_DEVICE_ERROR;
-    }
+	}
 
-    if (fread(*data, 1, *len, pFile)!=*len)
-    {
+	if (fread(*data, 1, *len, pFile)!=*len)
+	{
 		fclose(pFile);
 	free(*data);
 		LOG_ERROR("Can't open %s\n", fileName);
 		return ERROR_JTAG_DEVICE_ERROR;
-    }
-    fclose (pFile);
-    *(((char *)(*data))+*len)=0; /* sentinel */
+	}
+	fclose(pFile);
+	*(((char *)(*data))+*len)=0; /* sentinel */
 
-    return ERROR_OK;
+	return ERROR_OK;
 
 
 
@@ -365,7 +365,7 @@
 #if 0
 static void shiftValueInnerFlip(const enum tap_state state, const enum tap_state endState, int repeat, cyg_uint32 value)
 {
-	VERBOSE(LOG_INFO("shiftValueInner %s %s %d %08x (flipped)", tap_state_strings[state], tap_state_strings[endState], repeat, value));
+	VERBOSE(LOG_INFO("shiftValueInner %s %s %d %08x (flipped)", jtag_state_name(state), jtag_state_name(endState), repeat, value));
 	cyg_uint32 a,b;
 	a=state;
 	b=endState;
@@ -476,7 +476,7 @@
 			int r=fields[i].in_handler(inBuffer, fields[i].in_handler_priv, fields+i);
 			if (r!=ERROR_OK)
 			{
-			    /* this will cause jtag_execute_queue() to return an error */
+				/* this will cause jtag_execute_queue() to return an error */
 				jtag_error=r;
 			}
 		}
@@ -703,7 +703,7 @@
 		}
 		else
 		{
-			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", tap_state_strings[cur_state], tap_state_strings[path[state_count]]);
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(path[state_count)]);
 			exit(-1);
 		}
 



From oharboe at mail.berlios.de  Mon Dec 15 10:05:19 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 15 Dec 2008 10:05:19 +0100
Subject: [Openocd-svn] r1241 - in trunk/src: . target
Message-ID: <200812150905.mBF95J2I025224@sheep.berlios.de>

Author: oharboe
Date: 2008-12-15 10:05:16 +0100 (Mon, 15 Dec 2008)
New Revision: 1241

Modified:
   trunk/src/ecosboard.c
   trunk/src/target/target.c
Log:
fast_load profiling tool moved to target.c

Modified: trunk/src/ecosboard.c
===================================================================
--- trunk/src/ecosboard.c	2008-12-14 20:33:01 UTC (rev 1240)
+++ trunk/src/ecosboard.c	2008-12-15 09:05:16 UTC (rev 1241)
@@ -121,197 +121,7 @@
 
 char hwaddr[512];
 
-struct FastLoad
-{
-	u32 address;
-	u8 *data;
-	int length;
 
-};
-
-static int fastload_num;
-static struct FastLoad *fastload;
-
-static void free_fastload()
-{
-	if (fastload!=NULL)
-	{
-		int i;
-		for (i=0; i<fastload_num; i++)
-		{
-			if (fastload[i].data)
-				free(fastload[i].data);
-		}
-		free(fastload);
-		fastload=NULL;
-	}
-}
-
-
-int handle_fast_load_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	u8 *buffer;
-	u32 buf_cnt;
-	u32 image_size;
-	u32 min_address=0;
-	u32 max_address=0xffffffff;
-	int i;
-	int retval;
-
-	image_t image;
-
-	duration_t duration;
-	char *duration_text;
-
-	if ((argc < 1)||(argc > 5))
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-
-	/* a base address isn't always necessary, default to 0x0 (i.e. don't relocate) */
-	if (argc >= 2)
-	{
-		image.base_address_set = 1;
-		image.base_address = strtoul(args[1], NULL, 0);
-	}
-	else
-	{
-		image.base_address_set = 0;
-	}
-
-
-	image.start_address_set = 0;
-
-	if (argc>=4)
-	{
-		min_address=strtoul(args[3], NULL, 0);
-	}
-	if (argc>=5)
-	{
-		max_address=strtoul(args[4], NULL, 0)+min_address;
-	}
-
-	if (min_address>max_address)
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-
-	duration_start_measure(&duration);
-
-	if (image_open(&image, args[0], (argc >= 3) ? args[2] : NULL) != ERROR_OK)
-	{
-		return ERROR_OK;
-	}
-
-	image_size = 0x0;
-	retval = ERROR_OK;
-	fastload_num=image.num_sections;
-	fastload=(struct FastLoad *)malloc(sizeof(struct FastLoad)*image.num_sections);
-	if (fastload==NULL)
-	{
-		image_close(&image);
-		return ERROR_FAIL;
-	}
-	memset(fastload, 0, sizeof(struct FastLoad)*image.num_sections);
-	for (i = 0; i < image.num_sections; i++)
-	{
-		buffer = malloc(image.sections[i].size);
-		if (buffer == NULL)
-		{
-			command_print(cmd_ctx, "error allocating buffer for section (%d bytes)", image.sections[i].size);
-			break;
-		}
-
-		if ((retval = image_read_section(&image, i, 0x0, image.sections[i].size, buffer, &buf_cnt)) != ERROR_OK)
-		{
-			free(buffer);
-			break;
-		}
-
-		u32 offset=0;
-		u32 length=buf_cnt;
-
-
-		/* DANGER!!! beware of unsigned comparision here!!! */
-
-		if ((image.sections[i].base_address+buf_cnt>=min_address)&&
-				(image.sections[i].base_address<max_address))
-		{
-			if (image.sections[i].base_address<min_address)
-			{
-				/* clip addresses below */
-				offset+=min_address-image.sections[i].base_address;
-				length-=offset;
-			}
-
-			if (image.sections[i].base_address+buf_cnt>max_address)
-			{
-				length-=(image.sections[i].base_address+buf_cnt)-max_address;
-			}
-
-			fastload[i].address=image.sections[i].base_address+offset;
-			fastload[i].data=malloc(length);
-			if (fastload[i].data==NULL)
-			{
-				free(buffer);
-				break;
-			}
-			memcpy(fastload[i].data, buffer+offset, length);
-			fastload[i].length=length;
-
-			image_size += length;
-			command_print(cmd_ctx, "%u byte written at address 0x%8.8x", length, image.sections[i].base_address+offset);
-		}
-
-		free(buffer);
-	}
-
-	duration_stop_measure(&duration, &duration_text);
-	if (retval==ERROR_OK)
-	{
-		command_print(cmd_ctx, "Loaded %u bytes in %s", image_size, duration_text);
-		command_print(cmd_ctx, "NB!!! image has not been loaded to target, issue a subsequent 'fast_load' to do so.");
-	}
-	free(duration_text);
-
-	image_close(&image);
-
-	if (retval!=ERROR_OK)
-	{
-		free_fastload();
-	}
-
-	return retval;
-}
-
-int handle_fast_load_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc>0)
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (fastload==NULL)
-	{
-		LOG_ERROR("No image in memory");
-		return ERROR_FAIL;
-	}
-	int i;
-	int ms=timeval_ms();
-	int size=0;
-	for (i=0; i<fastload_num;i++)
-	{
-		int retval;
-		target_t *target = get_current_target(cmd_ctx);
-		if ((retval = target_write_buffer(target, fastload[i].address, fastload[i].length, fastload[i].data)) != ERROR_OK)
-		{
-			return retval;
-		}
-		size+=fastload[i].length;
-	}
-	int after=timeval_ms();
-	command_print(cmd_ctx, "Loaded image %f kBytes/s", (float)(size/1024.0)/((float)(after-ms)/1000.0));
-	return ERROR_OK;
-}
-
-
 /* Give TELNET a way to find out what version this is */
 int handle_zy1000_version_command(struct command_context_s *cmd_ctx, char *cmd,
 		char **args, int argc)
@@ -1969,12 +1779,6 @@
 	register_command(cmd_ctx, NULL, "rm", handle_rm_command, COMMAND_ANY,
 			"remove file");
 
-	register_command(cmd_ctx, NULL, "fast_load_image", handle_fast_load_image_command, COMMAND_ANY,
-			"same args as load_image, image stored in memory");
-
-	register_command(cmd_ctx, NULL, "fast_load", handle_fast_load_command, COMMAND_ANY,
-			"loads active fast load image to current target");
-
 	register_command(cmd_ctx, NULL, "cat", handle_cat_command, COMMAND_ANY,
 			"display file content");
 

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2008-12-14 20:33:01 UTC (rev 1240)
+++ trunk/src/target/target.c	2008-12-15 09:05:16 UTC (rev 1241)
@@ -82,6 +82,9 @@
 int handle_rwp_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 int handle_virt2phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc);
 int handle_profile_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+int handle_fast_load_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+int handle_fast_load_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+
 static int jim_array2mem(Jim_Interp *interp, int argc, Jim_Obj *const *argv);
 static int jim_mem2array(Jim_Interp *interp, int argc, Jim_Obj *const *argv);
 static int jim_target( Jim_Interp *interp, int argc, Jim_Obj *const *argv);
@@ -929,6 +932,14 @@
 	register_command(cmd_ctx, NULL, "virt2phys", handle_virt2phys_command, COMMAND_ANY, "translate a virtual address into a physical address");
 	register_command(cmd_ctx, NULL, "profile", handle_profile_command, COMMAND_EXEC, "profiling samples the CPU PC");
 
+	register_command(cmd_ctx, NULL, "fast_load_image", handle_fast_load_image_command, COMMAND_ANY,
+			"same args as load_image, image stored in memory - mainly for profiling purposes");
+
+	register_command(cmd_ctx, NULL, "fast_load", handle_fast_load_command, COMMAND_ANY,
+			"loads active fast load image to current target - mainly for profiling purposes");
+
+
+
 	register_jim(cmd_ctx, "target", jim_target, "configure target" );
 
 
@@ -3845,7 +3856,7 @@
 	/* incase variant is not set */
 	if (!target->variant)
 		target->variant = strdup("");
-	
+
 	/* create the target specific commands */
 	if( target->type->register_commands ){
 		(*(target->type->register_commands))( cmd_ctx );
@@ -3993,3 +4004,196 @@
 
 	return JIM_ERR;
 }
+
+
+struct FastLoad
+{
+	u32 address;
+	u8 *data;
+	int length;
+
+};
+
+static int fastload_num;
+static struct FastLoad *fastload;
+
+static void free_fastload()
+{
+	if (fastload!=NULL)
+	{
+		int i;
+		for (i=0; i<fastload_num; i++)
+		{
+			if (fastload[i].data)
+				free(fastload[i].data);
+		}
+		free(fastload);
+		fastload=NULL;
+	}
+}
+
+
+
+
+int handle_fast_load_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	u8 *buffer;
+	u32 buf_cnt;
+	u32 image_size;
+	u32 min_address=0;
+	u32 max_address=0xffffffff;
+	int i;
+	int retval;
+
+	image_t image;
+
+	duration_t duration;
+	char *duration_text;
+
+	if ((argc < 1)||(argc > 5))
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+
+	/* a base address isn't always necessary, default to 0x0 (i.e. don't relocate) */
+	if (argc >= 2)
+	{
+		image.base_address_set = 1;
+		image.base_address = strtoul(args[1], NULL, 0);
+	}
+	else
+	{
+		image.base_address_set = 0;
+	}
+
+
+	image.start_address_set = 0;
+
+	if (argc>=4)
+	{
+		min_address=strtoul(args[3], NULL, 0);
+	}
+	if (argc>=5)
+	{
+		max_address=strtoul(args[4], NULL, 0)+min_address;
+	}
+
+	if (min_address>max_address)
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+
+	duration_start_measure(&duration);
+
+	if (image_open(&image, args[0], (argc >= 3) ? args[2] : NULL) != ERROR_OK)
+	{
+		return ERROR_OK;
+	}
+
+	image_size = 0x0;
+	retval = ERROR_OK;
+	fastload_num=image.num_sections;
+	fastload=(struct FastLoad *)malloc(sizeof(struct FastLoad)*image.num_sections);
+	if (fastload==NULL)
+	{
+		image_close(&image);
+		return ERROR_FAIL;
+	}
+	memset(fastload, 0, sizeof(struct FastLoad)*image.num_sections);
+	for (i = 0; i < image.num_sections; i++)
+	{
+		buffer = malloc(image.sections[i].size);
+		if (buffer == NULL)
+		{
+			command_print(cmd_ctx, "error allocating buffer for section (%d bytes)", image.sections[i].size);
+			break;
+		}
+
+		if ((retval = image_read_section(&image, i, 0x0, image.sections[i].size, buffer, &buf_cnt)) != ERROR_OK)
+		{
+			free(buffer);
+			break;
+		}
+
+		u32 offset=0;
+		u32 length=buf_cnt;
+
+
+		/* DANGER!!! beware of unsigned comparision here!!! */
+
+		if ((image.sections[i].base_address+buf_cnt>=min_address)&&
+				(image.sections[i].base_address<max_address))
+		{
+			if (image.sections[i].base_address<min_address)
+			{
+				/* clip addresses below */
+				offset+=min_address-image.sections[i].base_address;
+				length-=offset;
+			}
+
+			if (image.sections[i].base_address+buf_cnt>max_address)
+			{
+				length-=(image.sections[i].base_address+buf_cnt)-max_address;
+			}
+
+			fastload[i].address=image.sections[i].base_address+offset;
+			fastload[i].data=malloc(length);
+			if (fastload[i].data==NULL)
+			{
+				free(buffer);
+				break;
+			}
+			memcpy(fastload[i].data, buffer+offset, length);
+			fastload[i].length=length;
+
+			image_size += length;
+			command_print(cmd_ctx, "%u byte written at address 0x%8.8x", length, image.sections[i].base_address+offset);
+		}
+
+		free(buffer);
+	}
+
+	duration_stop_measure(&duration, &duration_text);
+	if (retval==ERROR_OK)
+	{
+		command_print(cmd_ctx, "Loaded %u bytes in %s", image_size, duration_text);
+		command_print(cmd_ctx, "NB!!! image has not been loaded to target, issue a subsequent 'fast_load' to do so.");
+	}
+	free(duration_text);
+
+	image_close(&image);
+
+	if (retval!=ERROR_OK)
+	{
+		free_fastload();
+	}
+
+	return retval;
+}
+
+int handle_fast_load_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc>0)
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	if (fastload==NULL)
+	{
+		LOG_ERROR("No image in memory");
+		return ERROR_FAIL;
+	}
+	int i;
+	int ms=timeval_ms();
+	int size=0;
+	for (i=0; i<fastload_num;i++)
+	{
+		int retval;
+		target_t *target = get_current_target(cmd_ctx);
+		if ((retval = target_write_buffer(target, fastload[i].address, fastload[i].length, fastload[i].data)) != ERROR_OK)
+		{
+			return retval;
+		}
+		size+=fastload[i].length;
+	}
+	int after=timeval_ms();
+	command_print(cmd_ctx, "Loaded image %f kBytes/s", (float)(size/1024.0)/((float)(after-ms)/1000.0));
+	return ERROR_OK;
+}



From ntfreak at mail.berlios.de  Mon Dec 15 10:43:27 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Mon, 15 Dec 2008 10:43:27 +0100
Subject: [Openocd-svn] r1242 - in trunk: doc src/helper src/server src/target
Message-ID: <200812150943.mBF9hRPx028652@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-15 10:43:26 +0100 (Mon, 15 Dec 2008)
New Revision: 1242

Modified:
   trunk/doc/openocd.texi
   trunk/src/helper/Makefile.am
   trunk/src/helper/log.c
   trunk/src/helper/options.c
   trunk/src/server/gdb_server.c
   trunk/src/server/server.c
   trunk/src/server/server.h
   trunk/src/server/tcl_server.c
   trunk/src/server/telnet_server.c
   trunk/src/target/target.c
Log:
- add ability for openocd to communicate to gdb using pipes (stdin/stdout).
- this is enabled by new command line option option --pipe.

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/doc/openocd.texi	2008-12-15 09:43:26 UTC (rev 1242)
@@ -15,7 +15,7 @@
 
 @itemize @bullet
 @item Copyright @copyright{} 2008 The OpenOCD Project
- at item Copyright @copyright{} 2007-2008 Spen @email{spen@@spen-soft.co.uk}
+ at item Copyright @copyright{} 2007-2008 Spencer Oliver @email{spen@@spen-soft.co.uk}
 @item Copyright @copyright{} 2008 Oyvind Harboe @email{oyvind.harboe@@zylin.com}
 @item Copyright @copyright{} 2008 Duane Ellis @email{openocd@@duaneellis.com}
 @end itemize
@@ -411,9 +411,10 @@
 --debug      | -d       set debug level <0-3>
 --log_output | -l       redirect log output to file <name>
 --command    | -c       run <command>
+--pipe       | -p       use pipes when talking to gdb
 @end verbatim
 
-By default openocd reads the file configuration file ``openocd.cfg''
+By default OpenOCD reads the file configuration file ``openocd.cfg''
 in the current directory.  To specify a different (or multiple)
 configuration file, you can use the ``-f'' option. For example:
 
@@ -445,6 +446,9 @@
 the @option{-s <search>} switch. The current directory and the OpenOCD
 target library is in the search path by default.
 
+For details on the @option{-p} option. @xref{Connecting to GDB}.
+Option @option{-p} is not currently supported under native win32.
+
 Note! OpenOCD will launch the GDB & telnet server even if it can not
 establish a connection with the target. In general, it is possible for
 the JTAG controller to be unresponsive until the target is set up
@@ -455,7 +459,7 @@
 @cindex configuration
 
 @section Outline
-There are 4 basic ways of ``configurating'' openocd to run, they are:
+There are 4 basic ways of ``configurating'' OpenOCD to run, they are:
 
 @enumerate
 @item A small openocd.cfg file which ``sources'' other configuration files
@@ -671,7 +675,7 @@
 every chip. If the @t{-expected-id} is nonzero, OpenOCD attempts
 to verify the tap id number verses configuration file and may issue an
 error or warning like this. The hope is this will help pin point
-problem openocd configurations.
+problem OpenOCD configurations.
 
 @example
 Info:   JTAG tap: sam7x256.cpu tap/device found: 0x3f0f0f0f (Manufacturer: 0x787, Part: 0xf0f0, Version: 0x3)
@@ -904,7 +908,7 @@
 JIM-Tcl commands, and (older) the orginal command interpretor.
 
 @item @b{Commands}
-@* At the openocd telnet command line (or via the GDB mon command) one
+@* At the OpenOCD telnet command line (or via the GDB mon command) one
 can type a Tcl for() loop, set variables, etc.
 
 @item @b{Historical Note}
@@ -1145,7 +1149,7 @@
 @b{TODO:} Confirm the following: On windows the name needs to end with
 a ``space A''? Or not? It has to do with the FTD2xx driver. When must
 this be added and when must it not be added? Why can't the code in the
-interface or in openocd automatically add this if needed? -- Duane.
+interface or in OpenOCD automatically add this if needed? -- Duane.
 
 @item @b{ft2232_serial} <@var{serial-number}>
 @cindex ft2232_serial
@@ -1527,7 +1531,7 @@
 circuit and skipped.
 
 
-From OpenOCDs view point, a JTAG TAP is in one of 3 states:
+From OpenOCD's view point, a JTAG TAP is in one of 3 states:
 
 @itemize @bullet
 @item @b{Enabled - Not In ByPass} and has a variable bit length
@@ -1640,7 +1644,7 @@
     puts [format "The button is %s" $x]
 @end example
     
-In OpenOCDs terms, the ``target'' is an object just like a Tcl/Tk
+In OpenOCD's terms, the ``target'' is an object just like a Tcl/Tk
 button. Commands avaialble as a ``target object'' are:
 
 @comment START targetobj commands.
@@ -1841,7 +1845,7 @@
 @item @b{-work-area-size [ADDRESS]} specify/set the work area
 @item @b{-work-area-backup [0|1]} does the work area get backed up
 @item @b{-endian  [big|little]} 
- at item @b{-variant [NAME]} some chips have varients openocd needs to know about
+ at item @b{-variant [NAME]} some chips have varients OpenOCD needs to know about
 @item @b{-chain-position DOTTED.NAME} the tap name this target refers to.
 @end itemize
 Example:
@@ -1870,7 +1874,7 @@
 @* None (this is also used as the ARM946)
 @item @b{cortex_m3}
 @* use variant <@var{-variant lm3s}> when debugging luminary lm3s targets. This will cause
-openocd to use a software reset rather than asserting SRST to avoid a issue with clearing
+OpenOCD to use a software reset rather than asserting SRST to avoid a issue with clearing
 the debug registers. This is fixed in Fury Rev B, DustDevil Rev B, Tempest, these revisions will
 be detected and the normal reset behaviour used.
 @item @b{xscale}
@@ -1880,9 +1884,9 @@
 @item @b{mips_m4k}
 @* Use variant @option{ejtag_srst} when debugging targets that do not
 provide a functional SRST line on the EJTAG connector.  This causes
-openocd to instead use an EJTAG software reset command to reset the
+OpenOCD to instead use an EJTAG software reset command to reset the
 processor.  You still need to enable @option{srst} on the reset
-configuration command to enable openocd hardware reset functionality.
+configuration command to enable OpenOCD hardware reset functionality.
 @comment END varients
 @end itemize
 @section working_area - Command Removed
@@ -2004,7 +2008,7 @@
 @end itemize
 
 @section flash bank command
-The @b{flash bank} command is used to configure one or more flash chips (or banks in openocd terms)
+The @b{flash bank} command is used to configure one or more flash chips (or banks in OpenOCD terms)
 
 @example
 @b{flash bank} <@var{driver}> <@var{base}> <@var{size}> <@var{chip_width}>
@@ -2170,7 +2174,7 @@
 @end itemize
 
 Note: Before using the str9xpec driver here is some background info to help
-you better understand how the drivers works. Openocd has two flash drivers for
+you better understand how the drivers works. OpenOCD has two flash drivers for
 the str9.
 @enumerate
 @item
@@ -2793,41 +2797,52 @@
 OpenOCD complies with the remote gdbserver protocol, and as such can be used
 to debug remote targets.
 
- at section Connecting to gdb
- at cindex Connecting to gdb
+ at section Connecting to GDB
+ at cindex Connecting to GDB
+ at anchor{Connecting to GDB}
 Use GDB 6.7 or newer with OpenOCD if you run into trouble. For
 instance 6.3 has a known bug where it produces bogus memory access
 errors, which has since been fixed: look up 1836 in
 @url{http://sourceware.org/cgi-bin/gnatsweb.pl?database=gdb}
 
-
-A connection is typically started as follows:
+@*OpenOCD can communicate with GDB in two ways:
+ at enumerate
+ at item
+A socket (tcp) connection is typically started as follows:
 @example
 target remote localhost:3333
 @end example
-This would cause gdb to connect to the gdbserver on the local pc using port 3333.
+This would cause GDB to connect to the gdbserver on the local pc using port 3333.
+ at item
+A pipe connection is typically started as follows:
+ at example
+target remote openocd --pipe
+ at end example
+This would cause GDB to run OpenOCD and communicate using pipes (stdin/stdout).
+Using this method has the advantage of GDB starting/stopping OpenOCD for debug session.
+ at end enumerate
 
-To see a list of available OpenOCD commands type @option{monitor help} on the
-gdb commandline.
+@*To see a list of available OpenOCD commands type @option{monitor help} on the
+GDB commandline.
 
 OpenOCD supports the gdb @option{qSupported} packet, this enables information
-to be sent by the gdb server (openocd) to gdb. Typical information includes
+to be sent by the gdb server (OpenOCD) to GDB. Typical information includes
 packet size and device memory map.
 
-Previous versions of OpenOCD required the following gdb options to increase
-the packet size and speed up gdb communication.
+Previous versions of OpenOCD required the following GDB options to increase
+the packet size and speed up GDB communication.
 @example
 set remote memory-write-packet-size 1024
 set remote memory-write-packet-size fixed
 set remote memory-read-packet-size 1024
 set remote memory-read-packet-size fixed
 @end example
-This is now handled in the @option{qSupported} PacketSize.
+This is now handled in the @option{qSupported} PacketSize and should not be required.
 
- at section Programming using gdb
- at cindex Programming using gdb
+ at section Programming using GDB
+ at cindex Programming using GDB
 
-By default the target memory map is sent to gdb, this can be disabled by
+By default the target memory map is sent to GDB, this can be disabled by
 the following OpenOCD config option:
 @example
 gdb_memory_map disable
@@ -2836,34 +2851,34 @@
 in OpenOCD. For faster performance you should also configure a valid 
 working area.
 
-Informing gdb of the memory map of the target will enable gdb to protect any
+Informing GDB of the memory map of the target will enable GDB to protect any
 flash area of the target and use hardware breakpoints by default. This means
 that the OpenOCD option @option{gdb_breakpoint_override} is not required when
 using a memory map. @xref{gdb_breakpoint_override}.
 
-To view the configured memory map in gdb, use the gdb command @option{info mem}
-All other unasigned addresses within gdb are treated as RAM.
+To view the configured memory map in GDB, use the gdb command @option{info mem}
+All other unasigned addresses within GDB are treated as RAM.
 
 GDB 6.8 and higher set any memory area not in the memory map as inaccessible,
-this can be changed to the old behaviour by using the following gdb command.
+this can be changed to the old behaviour by using the following GDB command.
 @example
 set mem inaccessible-by-default off
 @end example
 
-If @option{gdb_flash_program enable} is also used, gdb will be able to
+If @option{gdb_flash_program enable} is also used, GDB will be able to
 program any flash memory using the vFlash interface.
 
-gdb will look at the target memory map when a load command is given, if any
+GDB will look at the target memory map when a load command is given, if any
 areas to be programmed lie within the target flash area the vFlash packets
 will be used.
 
-If the target needs configuring before gdb programming, an event
+If the target needs configuring before GDB programming, an event
 script can be executed.
 @example
 $_TARGETNAME configure -event EVENTNAME BODY
 @end example
 
-To verify any flash programming the gdb command @option{compare-sections}
+To verify any flash programming the GDB command @option{compare-sections}
 can be used.
 
 @node TCL scripting API
@@ -3598,7 +3613,7 @@
 OpenOCD comes with a target configuration script library. These scripts can be
 used as-is or serve as a starting point.
 
-The target library is published together with the openocd executable and 
+The target library is published together with the OpenOCD executable and 
 the path to the target library is in the OpenOCD script search path.
 Similarly there are example scripts for configuring the JTAG interface. 
 

Modified: trunk/src/helper/Makefile.am
===================================================================
--- trunk/src/helper/Makefile.am	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/src/helper/Makefile.am	2008-12-15 09:43:26 UTC (rev 1242)
@@ -1,4 +1,4 @@
-INCLUDES = -I$(top_srcdir)/src $(all_includes) -I$(top_srcdir)/src/target
+INCLUDES = -I$(top_srcdir)/src $(all_includes) -I$(top_srcdir)/src/target -I$(top_srcdir)/src/server
 METASOURCES = AUTO
 AM_CPPFLAGS = -DPKGDATADIR=\"$(pkgdatadir)\" -DPKGLIBDIR=\"$(pkglibdir)\" @CPPFLAGS@
 noinst_LIBRARIES = libhelper.a

Modified: trunk/src/helper/log.c
===================================================================
--- trunk/src/helper/log.c	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/src/helper/log.c	2008-12-15 09:43:26 UTC (rev 1242)
@@ -31,6 +31,7 @@
 #include "configuration.h"
 #include "time_support.h"
 #include "command.h"
+#include "server.h"
 
 #include <stdio.h>
 #include <stdlib.h>
@@ -108,9 +109,11 @@
 #endif
 					string);
 		}
-		else
+		else if(server_use_pipes == 0)
 		{
-			if (strcmp(string, "\n")!=0)
+			/* if we are using gdb through pipes then we do not want any output
+			 * to the pipe otherwise we get repeated strings */
+			if (strcmp(string, "\n") != 0)
 			{
 				/* print human readable output - but skip empty lines */
 				fprintf(log_output, "%s%s",
@@ -203,6 +206,18 @@
 	if (debug_level > 3)
 		debug_level = 3;
 
+	if (debug_level >= LOG_LVL_DEBUG && server_use_pipes == 1)
+	{
+		/* if we are enabling debug info then we need to write to a log file
+		 * otherwise the pipe will get full and cause issues with gdb */
+		FILE* file = fopen("openocd.log", "w");
+		if (file)
+		{
+			log_output = file;
+			LOG_WARNING("enabling log output as we are using pipes");
+		}
+	}
+	
 	return ERROR_OK;
 }
 

Modified: trunk/src/helper/options.c
===================================================================
--- trunk/src/helper/options.c	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/src/helper/options.c	2008-12-15 09:43:26 UTC (rev 1242)
@@ -24,10 +24,13 @@
 #include "config.h"
 #endif
 
+#include "replacements.h"
+
 #include "types.h"
 #include "command.h"
 #include "configuration.h"
 #include "log.h"
+#include "server.h"
 
 #include <stdio.h>
 #include <stdlib.h>
@@ -43,8 +46,9 @@
 	{"debug",	optional_argument,	0,		'd'},
 	{"file", 	required_argument,	0,		'f'},
 	{"search",	required_argument,	0,		's'},
-	{"log_output",	required_argument,	0,		'l'},
+	{"log_output",	required_argument,	0,	'l'},
 	{"command",	required_argument,	0,		'c'},
+	{"pipe",	no_argument,		0,		'p'},
 	{0, 0, 0, 0}
 };
 
@@ -95,7 +99,7 @@
 		/* getopt_long stores the option index here. */
 		int option_index = 0;
 		
-		c = getopt_long(argc, argv, "hvd::l:f:s:c:", long_options, &option_index);
+		c = getopt_long(argc, argv, "hvd::l:f:s:c:p", long_options, &option_index);
 		
 		/* Detect the end of the options. */
 		if (c == -1)
@@ -140,7 +144,20 @@
 					add_config_command(optarg);
 				}	
 				break;
-				
+			case 'p':	/* --pipe | -p */
+#if BUILD_ECOSBOARD == 1
+				/* pipes unsupported on hosted platforms */
+				LOG_WARNING("pipes not supported on this platform");
+#else
+#ifdef IS_MINGW
+				/* pipes currently unsupported on win32 */
+				LOG_WARNING("pipes currently unsupported on win32");
+				exit(1);
+#else
+				server_use_pipes = 1;
+#endif
+#endif
+				break;
 		}
 	}
 
@@ -154,6 +171,7 @@
 		LOG_OUTPUT("--debug      | -d\tset debug level <0-3>\n");
 		LOG_OUTPUT("--log_output | -l\tredirect log output to file <name>\n");
 		LOG_OUTPUT("--command    | -c\trun <command>\n");
+		LOG_OUTPUT("--pipe       | -p\tuse pipes for gdb communication\n");
 		exit(-1);
 	}	
 
@@ -161,7 +179,7 @@
 	{
 		/* Nothing to do, version gets printed automatically. */
 		exit(-1);
-	}	
-
+	}
+	
 	return ERROR_OK;
 }

Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/src/server/gdb_server.c	2008-12-15 09:43:26 UTC (rev 1242)
@@ -169,10 +169,18 @@
 
 	for (;;)
 	{
-		retval=check_pending(connection, 1, NULL);
-		if (retval!=ERROR_OK)
-			return retval;
-		gdb_con->buf_cnt = read_socket(connection->fd, gdb_con->buffer, GDB_BUFFER_SIZE);
+		if (connection->service->type == CONNECTION_PIPE)
+		{
+			gdb_con->buf_cnt = read(connection->fd, gdb_con->buffer, GDB_BUFFER_SIZE);
+		}
+		else
+		{
+			retval = check_pending(connection, 1, NULL);
+			if (retval != ERROR_OK)
+				return retval;
+			gdb_con->buf_cnt = read_socket(connection->fd, gdb_con->buffer, GDB_BUFFER_SIZE);
+		}
+		
 		if (gdb_con->buf_cnt > 0)
 		{
 			break;
@@ -268,11 +276,22 @@
 	gdb_connection_t *gdb_con = connection->priv;
 	if (gdb_con->closed)
 		return ERROR_SERVER_REMOTE_CLOSED;
-
-	if (write_socket(connection->fd, data, len) == len)
+	
+	if (connection->service->type == CONNECTION_PIPE)
 	{
-		return ERROR_OK;
+		/* write to stdout */
+		if (write(STDOUT_FILENO, data, len) == len)
+		{
+			return ERROR_OK;
+		}
 	}
+	else
+	{
+		if (write_socket(connection->fd, data, len) == len)
+		{
+			return ERROR_OK;
+		}
+	}
 	gdb_con->closed = 1;
 	return ERROR_SERVER_REMOTE_CLOSED;
 }
@@ -2158,7 +2177,7 @@
 	if (retval == ERROR_SERVER_REMOTE_CLOSED)
 		return retval;
 
-	/* logging does not propagate the error, yet can set th gdb_con->closed flag */
+	/* logging does not propagate the error, yet can set the gdb_con->closed flag */
 	if (gdb_con->closed)
 		return ERROR_SERVER_REMOTE_CLOSED;
 
@@ -2177,34 +2196,37 @@
 		return ERROR_OK;
 	}
 
-	if (gdb_port == 0)
+	if (gdb_port == 0 && server_use_pipes == 0)
 	{
 		LOG_WARNING("no gdb port specified, using default port 3333");
 		gdb_port = 3333;
 	}
 
-	while (target)
+	if (server_use_pipes)
 	{
-		char service_name[8];
-
-		snprintf(service_name, 8, "gdb-%2.2i", target->target_number);
-
+		/* only a single gdb connection when using a pipe */
+		
 		gdb_service = malloc(sizeof(gdb_service_t));
 		gdb_service->target = target;
 
-		add_service("gdb", CONNECTION_GDB,
-			    gdb_port + target->target_number,
-			    1, gdb_new_connection, gdb_input,
-			    gdb_connection_closed,
-			    gdb_service);
+		add_service("gdb", CONNECTION_PIPE, 0, 1, gdb_new_connection, gdb_input, gdb_connection_closed, gdb_service);
 
-		LOG_DEBUG("gdb service for target %s at port %i",
-			  target->type->name,
-			  gdb_port + target->target_number);
+		LOG_DEBUG("gdb service for target %s using pipes", target->type->name);
+	}
+	else
+	{
+		while (target)
+		{
+			gdb_service = malloc(sizeof(gdb_service_t));
+			gdb_service->target = target;
 
-		target = target->next;
+			add_service("gdb", CONNECTION_TCP, gdb_port + target->target_number, 1, gdb_new_connection, gdb_input, gdb_connection_closed, gdb_service);
+			
+			LOG_DEBUG("gdb service for target %s at port %i", target->type->name, gdb_port + target->target_number);
+			target = target->next;
+		}
 	}
-
+	
 	return ERROR_OK;
 }
 

Modified: trunk/src/server/server.c
===================================================================
--- trunk/src/server/server.c	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/src/server/server.c	2008-12-15 09:43:26 UTC (rev 1242)
@@ -53,6 +53,9 @@
 static int shutdown_openocd = 0;
 int handle_shutdown_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
+/* set when using pipes rather than tcp */
+int server_use_pipes = 0;
+
 int add_connection(service_t *service, command_context_t *cmd_ctx)
 {
 	unsigned int address_size;
@@ -69,28 +72,44 @@
 	c->priv = NULL;
 	c->next = NULL;
 
-	address_size = sizeof(c->sin);
-	
-	c->fd = accept(service->fd, (struct sockaddr *)&service->sin, &address_size);
-	
-	/* This increases performance dramatically for e.g. GDB load which
-	 * does not have a sliding window protocol. */
-	retval=setsockopt(c->fd,	/* socket affected */
-			IPPROTO_TCP,		/* set option at TCP level */
-			TCP_NODELAY,		/* name of option */
-			(char *)&flag,		/* the cast is historical cruft */
-			sizeof(int));		/* length of option value */
+	if (service->type == CONNECTION_TCP)
+	{
+		address_size = sizeof(c->sin);
 		
-	LOG_INFO("accepting '%s' connection from %i", service->name, c->sin.sin_port);
-	if ((retval = service->new_connection(c)) == ERROR_OK)
-	{
+		c->fd = accept(service->fd, (struct sockaddr *)&service->sin, &address_size);
+		
+		/* This increases performance dramatically for e.g. GDB load which
+		 * does not have a sliding window protocol. */
+		retval=setsockopt(c->fd,	/* socket affected */
+				IPPROTO_TCP,		/* set option at TCP level */
+				TCP_NODELAY,		/* name of option */
+				(char *)&flag,		/* the cast is historical cruft */
+				sizeof(int));		/* length of option value */
+			
+		LOG_INFO("accepting '%s' connection from %i", service->name, c->sin.sin_port);
+		if ((retval = service->new_connection(c)) != ERROR_OK)
+		{
+			close_socket(c->fd);
+			LOG_ERROR("attempted '%s' connection rejected", service->name);
+			free(c);
+			return retval;
+		}
 	}
-	else
+	else if (service->type == CONNECTION_PIPE)
 	{
-		close_socket(c->fd);
-		LOG_ERROR("attempted '%s' connection rejected", service->name);
-		free(c);
-		return retval;
+#ifndef _WIN32
+		c->fd = service->fd;
+		
+		/* do not check for new connections again on stdin */
+		service->fd = -1;
+#endif
+		LOG_INFO("accepting '%s' connection from pipe", service->name);
+		if ((retval = service->new_connection(c)) != ERROR_OK)
+		{
+			LOG_ERROR("attempted '%s' connection rejected", service->name);
+			free(c);
+			return retval;
+		}
 	}
 	
 	/* add to the end of linked list */
@@ -113,7 +132,8 @@
 		if (c->fd == connection->fd)
 		{	
 			service->connection_closed(c);
-			close_socket(c->fd);
+			if (service->type == CONNECTION_TCP)
+				close_socket(c->fd);
 			command_done(c->cmd_ctx);
 			
 			/* delete connection */
@@ -150,45 +170,68 @@
 	c->priv = priv;
 	c->next = NULL;
 	
-	if ((c->fd = socket(AF_INET, SOCK_STREAM, 0)) == -1)
+	if (type == CONNECTION_TCP)
 	{
-		LOG_ERROR("error creating socket: %s", strerror(errno));
-		exit(-1);
-	}
-	
-	setsockopt(c->fd, SOL_SOCKET, SO_REUSEADDR, (void*)&so_reuseaddr_option, sizeof(int));
-	
-	socket_nonblock(c->fd);
-	
-	memset(&c->sin, 0, sizeof(c->sin));
-	c->sin.sin_family = AF_INET;
-	c->sin.sin_addr.s_addr = INADDR_ANY;
-	c->sin.sin_port = htons(port);
-	
-	if (bind(c->fd, (struct sockaddr *)&c->sin, sizeof(c->sin)) == -1)
-	{
-		LOG_ERROR("couldn't bind to socket: %s", strerror(errno));
-		exit(-1);
-	}
-	
+		if ((c->fd = socket(AF_INET, SOCK_STREAM, 0)) == -1)
+		{
+			LOG_ERROR("error creating socket: %s", strerror(errno));
+			exit(-1);
+		}
+		
+		setsockopt(c->fd, SOL_SOCKET, SO_REUSEADDR, (void*)&so_reuseaddr_option, sizeof(int));
+		
+		socket_nonblock(c->fd);
+		
+		memset(&c->sin, 0, sizeof(c->sin));
+		c->sin.sin_family = AF_INET;
+		c->sin.sin_addr.s_addr = INADDR_ANY;
+		c->sin.sin_port = htons(port);
+		
+		if (bind(c->fd, (struct sockaddr *)&c->sin, sizeof(c->sin)) == -1)
+		{
+			LOG_ERROR("couldn't bind to socket: %s", strerror(errno));
+			exit(-1);
+		}
+		
 #ifndef _WIN32
-	int segsize=65536;
-	setsockopt(c->fd, IPPROTO_TCP, TCP_MAXSEG,  &segsize, sizeof(int));
+		int segsize=65536;
+		setsockopt(c->fd, IPPROTO_TCP, TCP_MAXSEG,  &segsize, sizeof(int));
 #endif
-	int window_size = 128 * 1024;	
-
-	/* These setsockopt()s must happen before the listen() */
+		int window_size = 128 * 1024;	
 	
-	setsockopt(c->fd, SOL_SOCKET, SO_SNDBUF,
-		(char *)&window_size, sizeof(window_size));
-	setsockopt(c->fd, SOL_SOCKET, SO_RCVBUF,
-		(char *)&window_size, sizeof(window_size));
-	
-	if (listen(c->fd, 1) == -1)
+		/* These setsockopt()s must happen before the listen() */
+		
+		setsockopt(c->fd, SOL_SOCKET, SO_SNDBUF,
+			(char *)&window_size, sizeof(window_size));
+		setsockopt(c->fd, SOL_SOCKET, SO_RCVBUF,
+			(char *)&window_size, sizeof(window_size));
+		
+		if (listen(c->fd, 1) == -1)
+		{
+			LOG_ERROR("couldn't listen on socket: %s", strerror(errno));
+			exit(-1);
+		}
+	}
+	else if (type == CONNECTION_PIPE)
 	{
-		LOG_ERROR("couldn't listen on socket: %s", strerror(errno));
-		exit(-1);
+		/* use stdin */
+		c->fd = STDIN_FILENO;
+		
+#ifdef _WIN32
+		/* for win32 set stdin/stdout to binary mode */
+		if (_setmode(_fileno(stdout), _O_BINARY) < 0)
+			LOG_WARNING("cannot change stdout mode to binary");
+		if (_setmode(_fileno(stdin), _O_BINARY) < 0)
+			LOG_WARNING("cannot change stdin mode to binary");
+#else
+		socket_nonblock(c->fd);
+#endif
 	}
+	else
+	{
+		LOG_ERROR("unknown connection type: %d", type);
+		exit(1);
+	}
 	
 	/* add to the end of linked list */
 	for (p = &services; *p; p = &(*p)->next);
@@ -310,14 +353,18 @@
 		
 #ifndef _WIN32
 #if BUILD_ECOSBOARD == 0
-		/* add STDIN to read_fds */
-		FD_SET(fileno(stdin), &read_fds);
+		if (server_use_pipes == 0)
+		{
+			/* add STDIN to read_fds */
+			FD_SET(fileno(stdin), &read_fds);
+		}
 #endif
 #endif
 
 		openocd_sleep_prelude();
 		kept_alive();
-		// Only while we're sleeping we'll let others run
+		
+		/* Only while we're sleeping we'll let others run */
 		retval = select(fd_max + 1, &read_fds, NULL, NULL, &tv);
 		openocd_sleep_postlude();
 
@@ -371,11 +418,14 @@
 				}
 				else
 				{
-					struct sockaddr_in sin;
-					unsigned int address_size = sizeof(sin);
-					int tmp_fd;
-					tmp_fd = accept(service->fd, (struct sockaddr *)&service->sin, &address_size);
-					close_socket(tmp_fd);
+					if (service->type != CONNECTION_PIPE)
+					{
+						struct sockaddr_in sin;
+						unsigned int address_size = sizeof(sin);
+						int tmp_fd;
+						tmp_fd = accept(service->fd, (struct sockaddr *)&service->sin, &address_size);
+						close_socket(tmp_fd);
+					}
 					LOG_INFO("rejected '%s' connection, no more connections allowed", service->name);
 				}
 			}
@@ -389,11 +439,16 @@
 				{
 					if ((FD_ISSET(c->fd, &read_fds)) || c->input_pending)
 					{
-						if (service->input(c) != ERROR_OK)
+						if ((retval = service->input(c)) != ERROR_OK)
 						{
 							connection_t *next = c->next;
+							if (service->type == CONNECTION_PIPE)
+							{
+								/* if connection uses a pipe then shutdown openocd on error */
+								shutdown_openocd = 1;
+							}
 							remove_connection(service, c);
-							LOG_INFO("dropped '%s' connection", service->name);
+							LOG_INFO("dropped '%s' connection - error %d", service->name, retval);
 							c = next;
 							continue;
 						}
@@ -405,11 +460,15 @@
 		
 #ifndef _WIN32
 #if BUILD_ECOSBOARD == 0
-		if (FD_ISSET(fileno(stdin), &read_fds))
+		/* check for data on stdin if not using pipes */
+		if (server_use_pipes == 0)
 		{
-			if (getc(stdin) == 'x')
+			if (FD_ISSET(fileno(stdin), &read_fds))
 			{
-				shutdown_openocd = 1;
+				if (getc(stdin) == 'x')
+				{
+					shutdown_openocd = 1;
+				}
 			}
 		}
 #endif
@@ -459,7 +518,6 @@
 	signal(SIGBREAK, sig_handler);
 	signal(SIGABRT, sig_handler);
 #endif
-
 	
 	return ERROR_OK;
 }

Modified: trunk/src/server/server.h
===================================================================
--- trunk/src/server/server.h	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/src/server/server.h	2008-12-15 09:43:26 UTC (rev 1242)
@@ -34,9 +34,8 @@
 
 enum connection_type
 {
-	CONNECTION_GDB,
-	CONNECTION_TELNET,
-	CONNECTION_TCL,
+	CONNECTION_TCP,
+	CONNECTION_PIPE
 };
 
 typedef struct connection_s
@@ -76,6 +75,8 @@
 extern int server_loop(command_context_t *command_context);
 extern int server_register_commands(command_context_t *context);
 
+extern int server_use_pipes;
+
 #define ERROR_SERVER_REMOTE_CLOSED	(-400)
 #define ERROR_CONNECTION_REJECTED	(-401)
 

Modified: trunk/src/server/tcl_server.c
===================================================================
--- trunk/src/server/tcl_server.c	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/src/server/tcl_server.c	2008-12-15 09:43:26 UTC (rev 1242)
@@ -179,7 +179,7 @@
 		tcl_port = 6666;
 	}
 
-	retval = add_service("tcl", CONNECTION_TCL, tcl_port, 1, tcl_new_connection, tcl_input, tcl_closed, NULL);
+	retval = add_service("tcl", CONNECTION_TCP, tcl_port, 1, tcl_new_connection, tcl_input, tcl_closed, NULL);
 	return retval;
 }
 

Modified: trunk/src/server/telnet_server.c
===================================================================
--- trunk/src/server/telnet_server.c	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/src/server/telnet_server.c	2008-12-15 09:43:26 UTC (rev 1242)
@@ -615,7 +615,7 @@
 
 	telnet_service->banner = banner;
 
-	add_service("telnet", CONNECTION_TELNET, telnet_port, 1, telnet_new_connection, telnet_input, telnet_connection_closed, telnet_service);
+	add_service("telnet", CONNECTION_TCP, telnet_port, 1, telnet_new_connection, telnet_input, telnet_connection_closed, telnet_service);
 
 	return ERROR_OK;
 }

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2008-12-15 09:05:16 UTC (rev 1241)
+++ trunk/src/target/target.c	2008-12-15 09:43:26 UTC (rev 1242)
@@ -232,7 +232,6 @@
 	{ .name = NULL, .value = -1 },
 };
 
-
 const Jim_Nvp nvp_target_endian[] = {
 	{ .name = "big",    .value = TARGET_BIG_ENDIAN },
 	{ .name = "little", .value = TARGET_LITTLE_ENDIAN },
@@ -249,8 +248,7 @@
 	{ .name = NULL     , .value = -1 },
 };
 
-static int
-max_target_number( void )
+static int max_target_number(void)
 {
 	target_t *t;
 	int x;
@@ -267,8 +265,7 @@
 }
 
 /* determine the number of the new target */
-static int
-new_target_number( void )
+static int new_target_number(void)
 {
 	target_t *t;
 	int x;



From oharboe at mail.berlios.de  Mon Dec 15 12:32:40 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 15 Dec 2008 12:32:40 +0100
Subject: [Openocd-svn] r1243 - trunk trunk/src trunk/src/helper
	trunk/src/jtag zy1000/trunk/build zy1000/trunk/build/include
	zy1000/trunk/build/tcl
Message-ID: <200812151132.mBFBWeCX007293@sheep.berlios.de>

Author: oharboe
Date: 2008-12-15 12:32:22 +0100 (Mon, 15 Dec 2008)
New Revision: 1243

Added:
   trunk/src/helper/ioutil.c
Modified:
   trunk/configure.in
   trunk/src/Makefile.am
   trunk/src/ecosboard.c
   trunk/src/helper/Makefile.am
   trunk/src/jtag/zy1000.c
   trunk/src/openocd.c
   zy1000/trunk/build/buildocd.sh
   zy1000/trunk/build/include/jtag_minidriver.h
   zy1000/trunk/build/include/rom.h
   zy1000/trunk/build/tcl/openocd.cfg
Log:
sync up to tap_xxx rename + add with-ioutil for standalone openocd implemetnations

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2008-12-15 09:43:26 UTC (rev 1242)
+++ trunk/configure.in	2008-12-15 11:32:22 UTC (rev 1243)
@@ -67,6 +67,10 @@
   AS_HELP_STRING([--enable-ecosboard], [Enable building support for eCosBoard based JTAG debugger]), 
   [build_ecosboard=$enableval], [build_ecosboard=no])
 
+AC_ARG_ENABLE(ioutil,
+  AS_HELP_STRING([--enable-ioutil], [Enable ioutil functions - useful for standalone OpenOCD implementations]), 
+  [build_ioutil=$enableval], [build_ioutil=no])
+
 case "${host_cpu}" in 
   arm*)
     AC_ARG_ENABLE(ep93xx,
@@ -179,6 +183,12 @@
   AC_DEFINE(BUILD_ECOSBOARD, 0, [0 if you don't want eCosBoard.])
 fi
 
+if test $build_ioutil = yes; then
+  AC_DEFINE(BUILD_IOUTIL, 1, [1 if you want ioutils.])
+else
+  AC_DEFINE(BUILD_IOUTIL, 0, [0 if you don't want ioutils.])
+fi
+
 if test $build_at91rm9200 = yes; then
   build_bitbang=yes
   AC_DEFINE(BUILD_AT91RM9200, 1, [1 if you want at91rm9200.])
@@ -274,6 +284,7 @@
 AM_CONDITIONAL(GIVEIO, test $parport_use_giveio = yes)
 AM_CONDITIONAL(EP93XX, test $build_ep93xx = yes)
 AM_CONDITIONAL(ECOSBOARD, test $build_ecosboard = yes)
+AM_CONDITIONAL(IOUTIL, test $build_ioutil = yes)
 AM_CONDITIONAL(AT91RM9200, test $build_at91rm9200 = yes)
 AM_CONDITIONAL(BITBANG, test $build_bitbang = yes)
 AM_CONDITIONAL(FT2232_LIBFTDI, test $build_ft2232_libftdi = yes)

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-15 09:43:26 UTC (rev 1242)
+++ trunk/src/Makefile.am	2008-12-15 11:32:22 UTC (rev 1243)
@@ -6,6 +6,7 @@
 MAINFILE = main.c
 endif
 
+
 openocd_SOURCES = $(MAINFILE) openocd.c
 
 # set the include path found by configure

Modified: trunk/src/ecosboard.c
===================================================================
--- trunk/src/ecosboard.c	2008-12-15 09:43:26 UTC (rev 1242)
+++ trunk/src/ecosboard.c	2008-12-15 11:32:22 UTC (rev 1243)
@@ -81,7 +81,6 @@
 #include <ifaddrs.h>
 #include <string.h>
 
-
 #include <unistd.h>
 #include <stdio.h>
 #define MAX_IFS 64
@@ -98,14 +97,6 @@
 
 #endif
 
-#define ZYLIN_VERSION "1.48"
-#define ZYLIN_DATE __DATE__
-#define ZYLIN_TIME __TIME__
-/* hmmm....  we can't pick up the right # during build if we've checked this out
- * in Eclipse... arrggghh...*/
-#define ZYLIN_OPENOCD "$Revision$"
-#define ZYLIN_OPENOCD_VERSION "Zylin JTAG ZY1000 " ZYLIN_VERSION " " ZYLIN_DATE " " ZYLIN_TIME
-#define ZYLIN_CONFIG_DIR "/config/settings"
 
 void diag_write(char *buf, int len)
 {
@@ -122,39 +113,6 @@
 char hwaddr[512];
 
 
-/* Give TELNET a way to find out what version this is */
-int handle_zy1000_version_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc > 1)
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-	if (argc == 0)
-	{
-		command_print(cmd_ctx, ZYLIN_OPENOCD_VERSION);
-	} else if (strcmp("openocd", args[0])==0)
-	{
-		int revision;
-		revision=atol(ZYLIN_OPENOCD+strlen("XRevision: "));
-		command_print(cmd_ctx, "%d", revision);
-	} else if (strcmp("zy1000", args[0])==0)
-	{
-		command_print(cmd_ctx, "%s", ZYLIN_VERSION);
-	} else if (strcmp("date", args[0])==0)
-	{
-		command_print(cmd_ctx, "%s", ZYLIN_DATE);
-	} else
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-
-	return ERROR_OK;
-}
-
-
-
-
 extern flash_driver_t *flash_drivers[];
 extern target_type_t *target_types[];
 
@@ -184,48 +142,17 @@
 
 	// no more interrupts than 1/10ms.
 	//profile_on((void *)0, (void *)0x40000, 16, 10000); // SRAM
-//	profile_on(0, &_etext, 16, 10000); // SRAM & DRAM
+	//	profile_on(0, &_etext, 16, 10000); // SRAM & DRAM
 	profile_on(start_of_code, end_of_code, 16, 10000); // Nios DRAM
 }
 #endif
 
-// launch GDB server if a config file exists
-bool zylinjtag_parse_config_file(struct command_context_s *cmd_ctx, const char *config_file_name)
-{
-	bool foundFile = false;
-	FILE *config_file = NULL;
-	command_print(cmd_ctx, "executing config file %s", config_file_name);
-	config_file = fopen(config_file_name, "r");
-	if (config_file)
-	{
-		fclose(config_file);
-		int retval;
-		retval = command_run_linef(cmd_ctx, "script %s", config_file_name);
-		if (retval == ERROR_OK)
-		{
-			foundFile = true;
-		}
-		else
-		{
-			command_print(cmd_ctx, "Failed executing %s %d", config_file_name, retval);
-		}
-	}
-	else
-	{
-		command_print(cmd_ctx, "No %s found", config_file_name);
-	}
-
-	return foundFile;
-}
-
 extern int eth0_up;
 static FILE *log;
 
 static char reboot_stack[2048];
 
-
-static void
-zylinjtag_reboot(cyg_addrword_t data)
+static void zylinjtag_reboot(cyg_addrword_t data)
 {
 	serialLog = true;
 	diag_printf("Rebooting in 100 ticks..\n");
@@ -240,324 +167,28 @@
 
 void reboot(void)
 {
-    cyg_thread_create(1,
-                      zylinjtag_reboot,
-                      (cyg_addrword_t)0,
-                      "reboot Thread",
-                      (void *)reboot_stack,
-                      sizeof(reboot_stack),
-                      &zylinjtag_thread_handle,
-                      &zylinjtag_thread_object);
+	cyg_thread_create(1, zylinjtag_reboot, (cyg_addrword_t) 0, "reboot Thread",
+			(void *) reboot_stack, sizeof(reboot_stack),
+			&zylinjtag_thread_handle, &zylinjtag_thread_object);
 	cyg_thread_resume(zylinjtag_thread_handle);
 }
 
-int configuration_output_handler(struct command_context_s *context, const char* line)
+int configuration_output_handler(struct command_context_s *context,
+		const char* line)
 {
 	diag_printf("%s", line);
 
 	return ERROR_OK;
 }
 
-int zy1000_configuration_output_handler_log(struct command_context_s *context, const char* line)
+int zy1000_configuration_output_handler_log(struct command_context_s *context,
+		const char* line)
 {
 	LOG_USER_N("%s", line);
 
 	return ERROR_OK;
 }
 
-int handle_rm_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc != 1)
-	{
-		command_print(cmd_ctx, "rm <filename>");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	if (unlink(args[0]) != 0)
-	{
-		command_print(cmd_ctx, "failed: %d", errno);
-	}
-
-	return ERROR_OK;
-}
-
-int loadFile(const char *fileName, void **data, int *len);
-
-int handle_cat_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc != 1)
-	{
-		command_print(cmd_ctx, "cat <filename>");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
-	void *data;
-	int len;
-
-	int retval = loadFile(args[0], &data, &len);
-	if (retval == ERROR_OK)
-	{
-		command_print(cmd_ctx, "%s", data);
-		free(data);
-	}
-	else
-	{
-		command_print(cmd_ctx, "%s not found %d", args[0], retval);
-	}
-
-	return ERROR_OK;
-}
-int handle_trunc_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc != 1)
-	{
-		command_print(cmd_ctx, "trunc <filename>");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	FILE *config_file = NULL;
-	config_file = fopen(args[0], "w");
-	if (config_file != NULL)
-		fclose(config_file);
-
-	return ERROR_OK;
-}
-
-
-int handle_meminfo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	static int prev = 0;
-	struct mallinfo info;
-
-	if (argc != 0)
-	{
-		command_print(cmd_ctx, "meminfo");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	info = mallinfo();
-
-	if (prev > 0)
-	{
-		command_print(cmd_ctx, "Diff:            %d", prev - info.fordblks);
-	}
-	prev = info.fordblks;
-
-	command_print(cmd_ctx, "Available ram:   %d", info.fordblks );
-
-	return ERROR_OK;
-}
-
-static bool savePower;
-
-static void setPower(bool power)
-{
-	savePower = power;
-	if (power)
-	{
-		HAL_WRITE_UINT32(ZY1000_JTAG_BASE+0x14, 0x8);
-	} else
-	{
-		HAL_WRITE_UINT32(ZY1000_JTAG_BASE+0x10, 0x8);
-	}
-}
-
-int handle_power_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc > 1)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	if (argc == 1)
-	{
-		if (strcmp(args[0], "on") == 0)
-		{
-			setPower(1);
-		}
-		else if (strcmp(args[0], "off") == 0)
-		{
-			setPower(0);
-		} else
-		{
-			command_print(cmd_ctx, "arg is \"on\" or \"off\"");
-			return ERROR_INVALID_ARGUMENTS;
-		}
-	}
-
-	command_print(cmd_ctx, "Target power %s", savePower ? "on" : "off");
-
-	return ERROR_OK;
-}
-
-int handle_append_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc < 1)
-	{
-		command_print(cmd_ctx,
-				"append <filename> [<string1>, [<string2>, ...]]");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	FILE *config_file = NULL;
-	config_file = fopen(args[0], "a");
-	if (config_file != NULL)
-	{
-		int i;
-		fseek(config_file, 0, SEEK_END);
-
-		for (i = 1; i < argc; i++)
-		{
-			fwrite(args[i], strlen(args[i]), 1, config_file);
-			if (i != argc - 1)
-			{
-				fwrite(" ", 1, 1, config_file);
-			}
-		}
-		fwrite("\n", 1, 1, config_file);
-		fclose(config_file);
-	}
-
-	return ERROR_OK;
-}
-
-extern int telnet_socket;
-
-int readMore(int fd, void *data, int length)
-{
-	/* used in select() */
-	fd_set read_fds;
-
-	/* monitor sockets for acitvity */
-	int fd_max = 1;
-	FD_ZERO(&read_fds);
-	/* listen for new connections */
-	FD_SET(fd, &read_fds);
-
-	// Maximum 5 seconds.
-	struct timeval tv;
-	tv.tv_sec = 5;
-	tv.tv_usec = 0;
-
-	int retval = select(fd_max + 1, &read_fds, NULL, NULL, &tv);
-	if (retval == 0)
-	{
-		diag_printf("Timed out waiting for binary payload\n");
-		return -1;
-	}
-	if (retval != 1)
-		return -1;
-
-	return read_socket(fd, data, length);
-}
-
-int readAll(int fd, void *data, int length)
-{
-	int pos = 0;
-	for (;;)
-	{
-		int actual = readMore(fd, ((char *) data) + pos, length - pos);
-		//		diag_printf("Read %d bytes(pos=%d, length=%d)\n", actual, pos, length);
-		if (actual <= 0)
-			return -1;
-		pos += actual;
-		if (pos == length)
-			break;
-	}
-	return length;
-}
-
-int handle_peek_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	cyg_uint32 value;
-	if (argc != 1)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-	HAL_READ_UINT32(strtoul(args[0], NULL, 0), value);
-	command_print(cmd_ctx, "0x%x : 0x%x", strtoul(args[0], NULL, 0), value);
-	return ERROR_OK;
-}
-
-int handle_poke_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc != 2)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-	HAL_WRITE_UINT32(strtoul(args[0], NULL, 0), strtoul(args[1], NULL, 0));
-	return ERROR_OK;
-}
-
-int handle_cp_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc != 2)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
-	void *data;
-	int len;
-
-	int retval = loadFile(args[0], &data, &len);
-	if (retval != ERROR_OK)
-		return retval;
-
-	FILE *f = fopen(args[1], "wb");
-	if (f == NULL)
-		retval = ERROR_INVALID_ARGUMENTS;
-
-	int pos = 0;
-	for (;;)
-	{
-		int chunk = len - pos;
-		static const int maxChunk = 512 * 1024; // ~1/sec
-		if (chunk > maxChunk)
-		{
-			chunk = maxChunk;
-		}
-
-		if ((retval==ERROR_OK)&&(fwrite(((char *)data)+pos, 1, chunk, f)!=chunk))
-			retval = ERROR_INVALID_ARGUMENTS;
-
-		if (retval != ERROR_OK)
-		{
-			break;
-		}
-
-		command_print(cmd_ctx, "%d", len - pos);
-
-		pos += chunk;
-
-		if (pos == len)
-			break;
-	}
-
-	if (retval == ERROR_OK)
-	{
-		command_print(cmd_ctx, "Copied %s to %s", args[0], args[1]);
-	} else
-	{
-		command_print(cmd_ctx, "Failed: %d", retval);
-	}
-
-	if (data != NULL)
-		free(data);
-	if (f != NULL)
-		fclose(f);
-
-	if (retval != ERROR_OK)
-		unlink(args[1]);
-
-	return retval;
-}
-
 #ifdef CYGPKG_PROFILE_GPROF
 extern void start_profile();
 
@@ -618,116 +249,10 @@
 #endif
 }
 
-#define SHOW_RESULT(a, b) diag_printf(#a " failed %d\n", (int)b)
+void copyfile(char *name2, char *name1);
 
-#define IOSIZE 512
-static void copyfile(char *name2, char *name1)
-{
+void copydir(char *name, char *destdir);
 
-	int err;
-	char buf[IOSIZE];
-	int fd1, fd2;
-	ssize_t done, wrote;
-
-	fd1 = open(name1, O_WRONLY | O_CREAT);
-	if (fd1 < 0)
-		SHOW_RESULT( open, fd1 );
-
-	fd2 = open(name2, O_RDONLY);
-	if (fd2 < 0)
-		SHOW_RESULT( open, fd2 );
-
-	for (;;)
-	{
-		done = read(fd2, buf, IOSIZE );
-		if (done < 0)
-		{
-			SHOW_RESULT( read, done );
-			break;
-		}
-
-        if( done == 0 ) break;
-
-		wrote = write(fd1, buf, done);
-        if( wrote != done ) SHOW_RESULT( write, wrote );
-
-        if( wrote != done ) break;
-	}
-
-	err = close(fd1);
-    if( err < 0 ) SHOW_RESULT( close, err );
-
-	err = close(fd2);
-    if( err < 0 ) SHOW_RESULT( close, err );
-
-}
-static void copydir(char *name, char *destdir)
-{
-	int err;
-	DIR *dirp;
-
-	dirp = opendir(destdir);
-	if (dirp==NULL)
-	{
-		mkdir(destdir, 0777);
-	} else
-	{
-		err = closedir(dirp);
-	}
-
-	dirp = opendir(name);
-    if( dirp == NULL ) SHOW_RESULT( opendir, -1 );
-
-	for (;;)
-	{
-		struct dirent *entry = readdir(dirp);
-
-		if (entry == NULL)
-			break;
-
-		if (strcmp(entry->d_name, ".") == 0)
-			continue;
-		if (strcmp(entry->d_name, "..") == 0)
-			continue;
-
-		bool isDir = false;
-		struct stat buf;
-		char fullPath[PATH_MAX];
-		strncpy(fullPath, name, PATH_MAX);
-		strcat(fullPath, "/");
-		strncat(fullPath, entry->d_name, PATH_MAX - strlen(fullPath));
-
-		if (stat(fullPath, &buf) == -1)
-		{
-			diag_printf("unable to read status from %s", fullPath);
-			break;
-		}
-		isDir = S_ISDIR(buf.st_mode) != 0;
-
-		if (isDir)
-			continue;
-
-		//        diag_printf("<INFO>: entry %14s",entry->d_name);
-		char fullname[PATH_MAX];
-		char fullname2[PATH_MAX];
-
-		strcpy(fullname, name);
-		strcat(fullname, "/");
-		strcat(fullname, entry->d_name);
-
-		strcpy(fullname2, destdir);
-		strcat(fullname2, "/");
-		strcat(fullname2, entry->d_name);
-		//        diag_printf("from %s to %s\n", fullname, fullname2);
-		copyfile(fullname, fullname2);
-
-		//       diag_printf("\n");
-	}
-
-	err = closedir(dirp);
-    if( err < 0 ) SHOW_RESULT( stat, err );
-}
-
 #if 0
 MTAB_ENTRY( romfs_mte1,
 		"/rom",
@@ -746,7 +271,6 @@
 	cyg_mutex_lock(&httpstate.jim_lock);
 }
 
-
 void format(void)
 {
 	diag_printf("Formatting JFFS2...\n");
@@ -761,12 +285,10 @@
 		reboot();
 	}
 
-
 	cyg_uint32 len;
 	cyg_io_flash_getconfig_devsize_t ds;
-	len = sizeof (ds);
-	err = cyg_io_get_config(handle,
-				CYG_IO_GET_CONFIG_FLASH_DEVSIZE, &ds, &len);
+	len = sizeof(ds);
+	err = cyg_io_get_config(handle, CYG_IO_GET_CONFIG_FLASH_DEVSIZE, &ds, &len);
 	if (err != ENOERR)
 	{
 		diag_printf("Flash error cyg_io_get_config %d\n", err);
@@ -775,15 +297,14 @@
 
 	cyg_io_flash_getconfig_erase_t e;
 	void *err_addr;
-	len = sizeof (e);
+	len = sizeof(e);
 
 	e.offset = 0;
 	e.len = ds.dev_size;
 	e.err_address = &err_addr;
 
 	diag_printf("Formatting 0x%08x bytes\n", ds.dev_size);
-	err = cyg_io_get_config(handle, CYG_IO_GET_CONFIG_FLASH_ERASE,
-				&e, &len);
+	err = cyg_io_get_config(handle, CYG_IO_GET_CONFIG_FLASH_ERASE, &e, &len);
 	if (err != ENOERR)
 	{
 		diag_printf("Flash erase error %d offset 0x%p\n", err, err_addr);
@@ -795,11 +316,7 @@
 	reboot();
 }
 
-
-
-static int
-zylinjtag_Jim_Command_format_jffs2(Jim_Interp *interp,
-                                   int argc,
+static int zylinjtag_Jim_Command_format_jffs2(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
 	if (argc != 1)
@@ -808,31 +325,10 @@
 	}
 
 	format();
-	for(;;);
+	for (;;)
+		;
 }
 
-
-static int
-zylinjtag_Jim_Command_rm(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	int del;
-	if (argc != 2)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "rm ?dirorfile?");
-		return JIM_ERR;
-	}
-
-	del = 0;
-	if (unlink(Jim_GetString(argv[1], NULL)) == 0)
-		del = 1;
-	if (rmdir(Jim_GetString(argv[1], NULL)) == 0)
-		del = 1;
-
-	return del ? JIM_OK : JIM_ERR;
-}
-
 static int zylinjtag_Jim_Command_threads(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
@@ -887,198 +383,28 @@
 		Jim_ListAppendElement(interp, threadObj, Jim_NewStringObj(interp,
 				state_string, strlen(state_string)));
 
-		Jim_ListAppendElement	(interp, threadObj, Jim_NewIntObj(interp, id));
-		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp, info.set_pri));
-		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp, info.cur_pri));
+		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp, id));
+		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp,
+				info.set_pri));
+		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp,
+				info.cur_pri));
 
 		Jim_ListAppendElement(interp, threads, threadObj);
 	}
-	Jim_SetResult( interp, threads);
+	Jim_SetResult(interp, threads);
 
 	return JIM_OK;
 }
 
-
-static int
-zylinjtag_Jim_Command_ls(Jim_Interp *interp,
-                                   int argc,
+static int zylinjtag_Jim_Command_log(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
-	if (argc != 2)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "ls ?dir?");
-		return JIM_ERR;
-	}
-
-	char *name = (char*) Jim_GetString(argv[1], NULL);
-
-	DIR *dirp = NULL;
-	dirp = opendir(name);
-	if (dirp == NULL)
-	{
-		return JIM_ERR;
-	}
-	Jim_Obj *objPtr = Jim_NewListObj(interp, NULL, 0);
-
-	for (;;)
-	{
-		struct dirent *entry = NULL;
-		entry = readdir(dirp);
-		if (entry == NULL)
-			break;
-
-		if ((strcmp(".", entry->d_name)==0)||(strcmp("..", entry->d_name)==0))
-			continue;
-
-        Jim_ListAppendElement(interp, objPtr, Jim_NewStringObj(interp, entry->d_name, strlen(entry->d_name)));
-	}
-	closedir(dirp);
-
-	Jim_SetResult(interp, objPtr);
-
-	return JIM_OK;
-}
-
-
-static int
-zylinjtag_Jim_Command_getmem(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 3)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "ls ?dir?");
-		return JIM_ERR;
-	}
-
-	long address;
-	long length;
-	if (Jim_GetLong(interp, argv[1], &address) != JIM_OK)
-		return JIM_ERR;
-	if (Jim_GetLong(interp, argv[2], &length) != JIM_OK)
-		return JIM_ERR;
-
-	if (length < 0 && length > (4096 * 1024))
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "getmem ?dir?");
-		return JIM_ERR;
-	}
-
-	void *mem = malloc(length);
-	if (mem == NULL)
-		return JIM_ERR;
-
-	target_t *target = get_current_target(cmd_ctx);
-
-	int retval;
-	int size = 1;
-	int count = length;
-	if ((address % 4 == 0) && (count % 4 == 0))
-	{
-		size = 4;
-		count /= 4;
-	}
-
-	if ((retval  = target->type->read_memory(target, address, size, count, mem)) != ERROR_OK)
-	{
-		free(mem);
-		return JIM_ERR;
-	}
-
-	Jim_Obj *objPtr = Jim_NewStringObj(interp, mem, length);
-	Jim_SetResult(interp, objPtr);
-
-	free(mem);
-
-	return JIM_OK;
-}
-
-static int
-zylinjtag_Jim_Command_peek(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 2)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "peek ?address?");
-		return JIM_ERR;
-	}
-
-	long address;
-	if (Jim_GetLong(interp, argv[1], &address) != JIM_OK)
-		return JIM_ERR;
-
-	int value = *((volatile int *) address);
-
-	Jim_SetResult(interp, Jim_NewIntObj(interp, value));
-
-	return JIM_OK;
-}
-
-static int
-zylinjtag_Jim_Command_poke(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 3)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "poke ?address? ?value?");
-		return JIM_ERR;
-	}
-
-	long address;
-	if (Jim_GetLong(interp, argv[1], &address) != JIM_OK)
-		return JIM_ERR;
-	long value;
-	if (Jim_GetLong(interp, argv[2], &value) != JIM_OK)
-		return JIM_ERR;
-
-	*((volatile int *) address) = value;
-
-	return JIM_OK;
-}
-
-
-
-static int
-zylinjtag_Jim_Command_flash(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	int retval;
-	u32 base = 0;
-	flash_bank_t *t = get_flash_bank_by_num_noprobe(0);
-	if (t != NULL)
-	{
-		base = t->base;
-		retval = JIM_OK;
-    } else
-	{
-		retval = JIM_ERR;
-	}
-
-	if (retval == JIM_OK)
-	{
-		Jim_SetResult(interp, Jim_NewIntObj(interp, base));
-	}
-
-	return retval;
-}
-
-
-
-
-
-static int
-zylinjtag_Jim_Command_log(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
 	Jim_Obj *tclOutput = Jim_NewStringObj(interp, "", 0);
 
 	if (logCount >= logSize)
 	{
-    	Jim_AppendString(httpstate.jim_interp, tclOutput, logBuffer+logCount%logSize, logSize-logCount%logSize);
+		Jim_AppendString(httpstate.jim_interp, tclOutput, logBuffer + logCount
+				% logSize, logSize - logCount % logSize);
 	}
 	Jim_AppendString(httpstate.jim_interp, tclOutput, logBuffer, writePtr);
 
@@ -1086,18 +412,14 @@
 	return JIM_OK;
 }
 
-static int
-zylinjtag_Jim_Command_reboot(Jim_Interp *interp,
-                                   int argc,
+static int zylinjtag_Jim_Command_reboot(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
 	reboot();
 	return JIM_OK;
 }
 
-static int
-zylinjtag_Jim_Command_mac(Jim_Interp *interp,
-                                   int argc,
+static int zylinjtag_Jim_Command_mac(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
 
@@ -1110,9 +432,7 @@
 	return JIM_OK;
 }
 
-static int
-zylinjtag_Jim_Command_ip(Jim_Interp *interp,
-                                   int argc,
+static int zylinjtag_Jim_Command_ip(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
 	Jim_Obj *tclOutput = Jim_NewStringObj(interp, "", 0);
@@ -1156,7 +476,6 @@
 
 extern Jim_Interp *interp;
 
-
 static void zylinjtag_startNetwork()
 {
 	// Bring TCP/IP up immediately before we're ready to accept commands.
@@ -1181,18 +500,18 @@
 
 	interp = httpstate.jim_interp;
 
-    Jim_CreateCommand(httpstate.jim_interp, "log", zylinjtag_Jim_Command_log, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "reboot", zylinjtag_Jim_Command_reboot, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "peek", zylinjtag_Jim_Command_peek, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "zy1000_flash", zylinjtag_Jim_Command_flash, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "poke", zylinjtag_Jim_Command_poke, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "ls", zylinjtag_Jim_Command_ls, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "threads", zylinjtag_Jim_Command_threads, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "getmem", zylinjtag_Jim_Command_getmem, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "mac", zylinjtag_Jim_Command_mac, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "ip", zylinjtag_Jim_Command_ip, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "rm", zylinjtag_Jim_Command_rm, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, "format_jffs2", zylinjtag_Jim_Command_format_jffs2, NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, "log", zylinjtag_Jim_Command_log,
+			NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, "reboot",
+			zylinjtag_Jim_Command_reboot, NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, "threads",
+			zylinjtag_Jim_Command_threads, NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, "mac", zylinjtag_Jim_Command_mac,
+			NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, "ip", zylinjtag_Jim_Command_ip,
+			NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, "format_jffs2",
+			zylinjtag_Jim_Command_format_jffs2, NULL, NULL);
 
 	cyg_httpd_start();
 
@@ -1225,18 +544,14 @@
 			(int) ((unsigned char *) &ifr.ifr_hwaddr.sa_data)[4],
 			(int) ((unsigned char *) &ifr.ifr_hwaddr.sa_data)[5]);
 
+	discover_message
+			= alloc_printf("ZY1000 Zylin JTAG debugger MAC %s", hwaddr);
 
-	discover_message=alloc_printf("ZY1000 Zylin JTAG debugger MAC %s", hwaddr);
-
 	discover_launch();
 }
 
-
-
-
-
-static void
-print_exception_handler(cyg_addrword_t data, cyg_code_t exception, cyg_addrword_t info)
+static void print_exception_handler(cyg_addrword_t data, cyg_code_t exception,
+		cyg_addrword_t info)
 {
 	writeLog = false;
 	serialLog = true;
@@ -1245,17 +560,17 @@
 	{
 #ifdef CYGNUM_HAL_VECTOR_UNDEF_INSTRUCTION
 	case CYGNUM_HAL_VECTOR_UNDEF_INSTRUCTION:
-		infoStr = "undefined instruction";
-		break;
+	infoStr = "undefined instruction";
+	break;
 	case CYGNUM_HAL_VECTOR_SOFTWARE_INTERRUPT:
-		infoStr = "software interrupt";
-		break;
+	infoStr = "software interrupt";
+	break;
 	case CYGNUM_HAL_VECTOR_ABORT_PREFETCH:
-		infoStr = "abort prefetch";
-		break;
+	infoStr = "abort prefetch";
+	break;
 	case CYGNUM_HAL_VECTOR_ABORT_DATA:
-		infoStr = "abort data";
-		break;
+	infoStr = "abort data";
+	break;
 #endif
 	default:
 		break;
@@ -1282,11 +597,8 @@
 	cyg_exception_handler_t *old_handler;
 	cyg_addrword_t old_data;
 
-	cyg_exception_set_handler(exception,
-	print_exception_handler,
-	0,
-	&old_handler,
-	&old_data);
+	cyg_exception_set_handler(exception, print_exception_handler, 0,
+			&old_handler, &old_data);
 }
 
 static cyg_thread zylinjtag_uart_thread_object;
@@ -1296,7 +608,6 @@
 static char forwardBuffer[1024]; // NB! must be smaller than a TCP/IP packet!!!!!
 static char backwardBuffer[1024];
 
-
 void setNoDelay(int session, int flag)
 {
 #if 1
@@ -1324,8 +635,7 @@
 } tcpipSent[512 * 1024];
 int cur;
 
-static void
-zylinjtag_uart(cyg_addrword_t data)
+static void zylinjtag_uart(cyg_addrword_t data)
 {
 	int so_reuseaddr_option = 1;
 
@@ -1336,7 +646,8 @@
 		exit(-1);
 	}
 
-	setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, (void*)&so_reuseaddr_option, sizeof(int));
+	setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, (void*) &so_reuseaddr_option,
+			sizeof(int));
 
 	struct sockaddr_in sin;
 	unsigned int address_size;
@@ -1417,7 +728,8 @@
 			if (actual2 <= 0)
 			{
 				memset(backwardBuffer, 's', sizeof(backwardBuffer));
-				actual2=read(serHandle, backwardBuffer, sizeof(backwardBuffer));
+				actual2 = read(serHandle, backwardBuffer,
+						sizeof(backwardBuffer));
 				if (actual2 < 0)
 				{
 					if (errno != EAGAIN)
@@ -1441,7 +753,8 @@
 				y = written;
 			}
 
-			if (FD_ISSET(session, &read_fds)&&(sizeof(forwardBuffer)>actual))
+			if (FD_ISSET(session, &read_fds)
+					&& (sizeof(forwardBuffer) > actual))
 			{
 				// NB! Here it is important that we empty the TCP/IP read buffer
 				// to make transmission tick right
@@ -1449,7 +762,8 @@
 				pos = 0;
 				int t;
 				// this will block if there is no data at all
-				t=read_socket(session, forwardBuffer+actual, sizeof(forwardBuffer)-actual);
+				t = read_socket(session, forwardBuffer + actual,
+						sizeof(forwardBuffer) - actual);
 				if (t <= 0)
 				{
 					goto closeSession;
@@ -1475,7 +789,8 @@
 					}
 					// The serial buffer is full
 					written = 0;
-				} else
+				}
+				else
 				{
 					actual -= written;
 					pos += written;
@@ -1492,14 +807,14 @@
 			}
 
 		}
-	    closeSession:
-	    close(session);
+		closeSession: close(session);
 		close(serHandle);
 
 		int i;
 		for (i = 0; i < 1024; i++)
 		{
-	    	diag_printf("%d %d %d %d\n", tcpipSent[i].req, tcpipSent[i].actual, tcpipSent[i].req2, tcpipSent[i].actual2);
+			diag_printf("%d %d %d %d\n", tcpipSent[i].req, tcpipSent[i].actual,
+					tcpipSent[i].req2, tcpipSent[i].actual2);
 
 		}
 	}
@@ -1509,28 +824,23 @@
 
 void startUart(void)
 {
-    cyg_thread_create(1,
-                      zylinjtag_uart,
-                      (cyg_addrword_t)0,
-                      "uart thread",
-                      (void *)uart_stack,
-                      sizeof(uart_stack),
-                      &zylinjtag_uart_thread_handle,
-                      &zylinjtag_uart_thread_object);
+	cyg_thread_create(1, zylinjtag_uart, (cyg_addrword_t) 0, "uart thread",
+			(void *) uart_stack, sizeof(uart_stack),
+			&zylinjtag_uart_thread_handle, &zylinjtag_uart_thread_object);
 	cyg_thread_set_priority(zylinjtag_uart_thread_handle, 1); // low priority as it sits in a busy loop
 	cyg_thread_resume(zylinjtag_uart_thread_handle);
 }
 
-
-
-int handle_uart_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+int handle_uart_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
 {
 	static int current_baud = 38400;
 	if (argc == 0)
 	{
 		command_print(cmd_ctx, "%d", current_baud);
 		return ERROR_OK;
-	} else if (argc != 1)
+	}
+	else if (argc != 1)
 	{
 		return ERROR_INVALID_ARGUMENTS;
 	}
@@ -1577,9 +887,10 @@
 		return ERROR_FAIL;
 	}
 
-
-	err = cyg_io_get_config(serial_handle, CYG_IO_GET_CONFIG_SERIAL_OUTPUT_DRAIN, &buf, &len);
-	err = cyg_io_get_config(serial_handle, CYG_IO_GET_CONFIG_SERIAL_INFO, &buf, &len);
+	err = cyg_io_get_config(serial_handle,
+			CYG_IO_GET_CONFIG_SERIAL_OUTPUT_DRAIN, &buf, &len);
+	err = cyg_io_get_config(serial_handle, CYG_IO_GET_CONFIG_SERIAL_INFO, &buf,
+			&len);
 	if (err != ENOERR)
 	{
 		command_print(cmd_ctx, "Failed to get serial port settings %d", err);
@@ -1587,7 +898,8 @@
 	}
 	buf.baud = baud;
 
-	err = cyg_io_set_config(serial_handle, CYG_IO_SET_CONFIG_SERIAL_INFO, &buf, &len);
+	err = cyg_io_set_config(serial_handle, CYG_IO_SET_CONFIG_SERIAL_INFO, &buf,
+			&len);
 	if (err != ENOERR)
 	{
 		command_print(cmd_ctx, "Failed to set serial port settings %d", err);
@@ -1599,49 +911,27 @@
 
 bool logAllToSerial = false;
 
-/* boolean parameter stored on config */
-bool boolParam(char *var)
-{
-	bool result = false;
-	char *name = alloc_printf(ZYLIN_CONFIG_DIR "/%s", var);
-	if (name == NULL)
-		return result;
 
-	void *data;
-	int len;
-	if (loadFile(name, &data, &len) == ERROR_OK)
-	{
-		if (len > 1)
-			len = 1;
-		result = strncmp((char *) data, "1", len) == 0;
-		free(data);
-	}
-	free(name);
-	return result;
-}
+int boolParam(char *var);
 
+
 command_context_t *setup_command_handler();
 
+extern const char *zylin_config_dir;
+
 int add_default_dirs(void)
 {
-	add_script_search_dir(ZYLIN_CONFIG_DIR);
+	add_script_search_dir(zylin_config_dir);
 	add_script_search_dir("/rom/lib/openocd");
 	add_script_search_dir("/rom");
 	return ERROR_OK;
 }
 
-static cyg_uint8 *ramblockdevice;
-static const int ramblockdevice_size=4096*1024;
 int main(int argc, char *argv[])
 {
 	/* ramblockdevice will be the same address every time. The deflate app uses a buffer 16mBytes out, so we
 	 * need to allocate towards the end of the heap.  */
 
-	ramblockdevice=(cyg_uint8 *)malloc(ramblockdevice_size);
-	memset(ramblockdevice, 0xff, ramblockdevice_size);
-
-
-
 #ifdef CYGNUM_HAL_VECTOR_UNDEF_INSTRUCTION
 	setHandler(CYGNUM_HAL_VECTOR_UNDEF_INSTRUCTION);
 	setHandler(CYGNUM_HAL_VECTOR_ABORT_PREFETCH);
@@ -1650,10 +940,12 @@
 
 	int err;
 
-	setPower(true); // on by default
-
 	atexit(keep_webserver);
 
+	diag_init_putc(_zylinjtag_diag_write_char);
+	// We want this in the log.
+	diag_printf("Zylin ZY1000.\n");
+
 	err = mount("", "/ram", "ramfs");
 	if (err < 0)
 	{
@@ -1688,12 +980,7 @@
 		exit(-1);
 	}
 
-	diag_init_putc(_zylinjtag_diag_write_char);
 
-	// We want this in the log.
-	diag_printf("Zylin ZY1000. Copyright Zylin AS 2007-2008.\n");
-	diag_printf("%s\n", ZYLIN_OPENOCD_VERSION);
-
 	copydir("/rom", "/ram/cgi");
 
 	err = mount("/dev/flash1", "/config", "jffs2");
@@ -1701,12 +988,13 @@
 	{
 		diag_printf("unable to mount jffs2, falling back to ram disk..\n");
 		err = mount("", "/config", "ramfs");
-		if (err<0)
+		if (err < 0)
 		{
 			diag_printf("unable to mount /config as ramdisk.\n");
 			reboot();
 		}
-	} else
+	}
+	else
 	{
 		/* are we using a ram disk instead of a flash disk? This is used
 		 * for ZY1000 live demo...
@@ -1716,7 +1004,7 @@
 		if (boolParam("ramdisk"))
 		{
 			diag_printf("Unmounting /config from flash and using ram instead\n");
-			err=umount("/config");
+			err = umount("/config");
 			if (err < 0)
 			{
 				diag_printf("unable to unmount jffs\n");
@@ -1737,23 +1025,22 @@
 				reboot();
 			}
 
-	//		copydir("/config2", "/config");
+			//		copydir("/config2", "/config");
 			copyfile("/config2/ip", "/config/ip");
 			copydir("/config2/settings", "/config/settings");
 
 			umount("/config2");
-		} else
-		{
-			/* we're not going to use a ram block disk */
-			free(ramblockdevice);
 		}
 	}
 
+	mkdir(zylin_config_dir, 0777);
+	char *dirname=alloc_printf("%s/target", zylin_config_dir);
+	mkdir(dirname, 0777);
+	free(dirname);
+	dirname=alloc_printf("%s/event", zylin_config_dir);
+	mkdir(dirname, 0777);
+	free(dirname);
 
-	mkdir(ZYLIN_CONFIG_DIR, 0777);
-	mkdir(ZYLIN_CONFIG_DIR "/target", 0777);
-	mkdir(ZYLIN_CONFIG_DIR "/event", 0777);
-
 	logAllToSerial = boolParam("logserial");
 
 	// We need the network & web server in case there is something wrong with
@@ -1767,43 +1054,18 @@
 	add_default_dirs();
 
 	/* initialize commandline interface */
-	command_context_t *cmd_ctx;
+	command_context_t * cmd_ctx;
 	cmd_ctx = setup_command_handler();
 	command_set_output_handler(cmd_ctx, configuration_output_handler, NULL);
 	command_context_mode(cmd_ctx, COMMAND_CONFIG);
 
-
-	register_command(cmd_ctx, NULL, "zy1000_version", handle_zy1000_version_command,
-			COMMAND_EXEC, "show zy1000 version numbers");
-
-	register_command(cmd_ctx, NULL, "rm", handle_rm_command, COMMAND_ANY,
-			"remove file");
-
-	register_command(cmd_ctx, NULL, "cat", handle_cat_command, COMMAND_ANY,
-			"display file content");
-
-	register_command(cmd_ctx, NULL, "trunc", handle_trunc_command, COMMAND_ANY,
-			"truncate a file to 0 size");
-
-	register_command(cmd_ctx, NULL, "append_file", handle_append_command,
-			COMMAND_ANY, "append a variable number of strings to a file");
-
-	register_command(cmd_ctx, NULL, "power", handle_power_command, COMMAND_ANY,
-			"power <on/off> - turn power switch to target on/off. No arguments - print status.");
-
-	register_command(cmd_ctx, NULL, "meminfo", handle_meminfo_command,
-			COMMAND_ANY, "display available ram memory");
-
-	register_command(cmd_ctx, NULL, "cp", handle_cp_command,
-					 COMMAND_ANY, "copy a file <from> <to>");
-
 #ifdef CYGPKG_PROFILE_GPROF
 	register_command(cmd_ctx, NULL, "ecosboard_profile", eCosBoard_handle_eCosBoard_profile_command,
 			COMMAND_ANY, NULL);
 #endif
-	register_command(cmd_ctx, NULL, "uart", handle_uart_command,
-					 COMMAND_ANY, "uart <baud>  - forward uart on port 5555");
 
+	register_command(cmd_ctx, NULL, "uart", handle_uart_command, COMMAND_ANY,
+			"uart <baud>  - forward uart on port 5555");
 
 	int errVal;
 	errVal = log_init(cmd_ctx);
@@ -1821,11 +1083,12 @@
 
 	if (logAllToSerial)
 	{
-		diag_printf(ZYLIN_CONFIG_DIR "/logserial=1 => sending log output to serial port using \"debug_level 3\" as default.\n");
+		diag_printf(
+				 "%s/logserial=1 => sending log output to serial port using \"debug_level 3\" as default.\n", zylin_config_dir);
 		command_run_line(cmd_ctx, "debug_level 3");
 	}
 
-	zylinjtag_parse_config_file(cmd_ctx, "/rom/openocd.cfg");
+	command_run_linef(cmd_ctx, "script /rom/openocd.cfg");
 
 	// FIX!!!  Yuk!
 	// diag_printf() is really invoked from many more places than we trust it
@@ -1834,7 +1097,8 @@
 	// Disabling it here is safe and gives us enough logged debug output for now. Crossing
 	// fingers that it doesn't cause any crashes.
 	diag_printf("Init complete, GDB & telnet servers launched.\n");
-	command_set_output_handler(cmd_ctx, zy1000_configuration_output_handler_log, NULL);
+	command_set_output_handler(cmd_ctx,
+			zy1000_configuration_output_handler_log, NULL);
 	if (!logAllToSerial)
 	{
 		serialLog = false;
@@ -1852,13 +1116,11 @@
 	umount("/config");
 
 	exit(0);
-	for (;;);
+	for (;;)
+		;
 }
 
-
-
-cyg_int32
-cyg_httpd_exec_cgi_tcl(char *file_name);
+cyg_int32 cyg_httpd_exec_cgi_tcl(char *file_name);
 cyg_int32 homeForm(CYG_HTTPD_STATE *p)
 {
 	cyg_httpd_exec_cgi_tcl("/ram/cgi/index.tcl");
@@ -1960,18 +1222,12 @@
 // This set of file operations are used for normal open files.
 
 static cyg_fileops tftpfs_fileops =
-{
-	tftpfs_fo_read,
-	tftpfs_fo_write,
-	tftpfs_fo_lseek,
-	(cyg_fileop_ioctl *)cyg_fileio_erofs,
-    cyg_fileio_seltrue,
-    tftpfs_fo_fsync,
-    tftpfs_fo_close,
+{ tftpfs_fo_read, tftpfs_fo_write, tftpfs_fo_lseek,
+		(cyg_fileop_ioctl *) cyg_fileio_erofs, cyg_fileio_seltrue,
+		tftpfs_fo_fsync, tftpfs_fo_close,
 		(cyg_fileop_fstat *) cyg_fileio_erofs,
 		(cyg_fileop_getinfo *) cyg_fileio_erofs,
-	(cyg_fileop_setinfo *)cyg_fileio_erofs,
-};
+		(cyg_fileop_setinfo *) cyg_fileio_erofs, };
 
 // -------------------------------------------------------------------------
 // tftpfs_mount()
@@ -2068,7 +1324,8 @@
 	if (!tftp->readFile)
 	{
 		int err;
-	    tftp->actual = tftp_client_get( tftp->file, tftp->server, 0, tftp->mem, tftpMaxSize,   TFTP_OCTET, &err);
+		tftp->actual = tftp_client_get(tftp->file, tftp->server, 0, tftp->mem,
+				tftpMaxSize, TFTP_OCTET, &err);
 
 		if (tftp->actual < 0)
 		{
@@ -2083,8 +1340,7 @@
 // tftpfs_fo_write()
 // Read data from file.
 
-static int
-tftpfs_fo_read(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
+static int tftpfs_fo_read(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
 {
 	struct Tftp *tftp = (struct Tftp *) fp->f_data;
 
@@ -2116,9 +1372,7 @@
 	return ENOERR;
 }
 
-
-static int
-tftpfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
+static int tftpfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
 {
 	struct Tftp *tftp = (struct Tftp *) fp->f_data;
 
@@ -2149,8 +1403,7 @@
 	return ENOERR;
 }
 
-static int
-tftpfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode)
+static int tftpfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode)
 {
 	int error = ENOERR;
 	return error;
@@ -2167,7 +1420,8 @@
 
 	if (tftp->write)
 	{
-	    tftp_client_put( tftp->file, tftp->server, 0, tftp->mem, fp->f_offset,   TFTP_OCTET, &error);
+		tftp_client_put(tftp->file, tftp->server, 0, tftp->mem, fp->f_offset,
+				TFTP_OCTET, &error);
 	}
 
 	freeTftp(tftp);
@@ -2227,13 +1481,13 @@
 }
 
 // Chunked version.
-cyg_int32
-show_log_entry(CYG_HTTPD_STATE *phttpstate)
+cyg_int32 show_log_entry(CYG_HTTPD_STATE *phttpstate)
 {
 	cyg_httpd_start_chunked("text");
 	if (logCount >= logSize)
 	{
-        cyg_httpd_write_chunked(logBuffer+logCount%logSize, logSize-logCount%logSize);
+		cyg_httpd_write_chunked(logBuffer + logCount % logSize, logSize
+				- logCount % logSize);
 	}
 	cyg_httpd_write_chunked(logBuffer, writePtr);
 	cyg_httpd_end_chunked();
@@ -2247,8 +1501,7 @@
 static int logfs_umount(cyg_mtab_entry *mte);
 static int logfs_open(cyg_mtab_entry *mte, cyg_dir dir, const char *name,
 		int mode, cyg_file *fte);
-static int
-logfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio);
+static int logfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio);
 
 // File operations
 static int logfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode);
@@ -2285,18 +1538,12 @@
 // This set of file operations are used for normal open files.
 
 static cyg_fileops logfs_fileops =
-{
-	(cyg_fileop_read *)cyg_fileio_erofs,
-    (cyg_fileop_write *)logfs_fo_write,
+{ (cyg_fileop_read *) cyg_fileio_erofs, (cyg_fileop_write *) logfs_fo_write,
 		(cyg_fileop_lseek *) cyg_fileio_erofs,
-	(cyg_fileop_ioctl *)cyg_fileio_erofs,
-    cyg_fileio_seltrue,
-    logfs_fo_fsync,
-    logfs_fo_close,
-	(cyg_fileop_fstat *)cyg_fileio_erofs,
+		(cyg_fileop_ioctl *) cyg_fileio_erofs, cyg_fileio_seltrue,
+		logfs_fo_fsync, logfs_fo_close, (cyg_fileop_fstat *) cyg_fileio_erofs,
 		(cyg_fileop_getinfo *) cyg_fileio_erofs,
-	(cyg_fileop_setinfo *)cyg_fileio_erofs,
-};
+		(cyg_fileop_setinfo *) cyg_fileio_erofs, };
 
 // -------------------------------------------------------------------------
 // logfs_mount()
@@ -2329,8 +1576,7 @@
 // logfs_fo_write()
 // Write data to file.
 
-static int
-logfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
+static int logfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
 {
 	int i;
 	for (i = 0; i < uio->uio_iovcnt; i++)
@@ -2345,8 +1591,7 @@
 
 	return ENOERR;
 }
-static int
-logfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode)
+static int logfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode)
 {
 	return ENOERR;
 }

Modified: trunk/src/helper/Makefile.am
===================================================================
--- trunk/src/helper/Makefile.am	2008-12-15 09:43:26 UTC (rev 1242)
+++ trunk/src/helper/Makefile.am	2008-12-15 11:32:22 UTC (rev 1243)
@@ -9,9 +9,16 @@
 CONFIGFILES = options.c jim.c jim-eventloop.c 
 endif
 
+
+
 libhelper_a_SOURCES = binarybuffer.c $(CONFIGFILES) configuration.c log.c command.c time_support.c \
 	replacements.c fileio.c startup_tcl.c
 
+if IOUTIL
+libhelper_a_SOURCES += ioutil.c
+endif
+
+
 noinst_HEADERS = binarybuffer.h configuration.h types.h log.h command.h \
 	time_support.h replacements.h fileio.h jim.h jim-eventloop.h \
 	startup.tcl bin2char.c

Added: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2008-12-15 09:43:26 UTC (rev 1242)
+++ trunk/src/helper/ioutil.c	2008-12-15 11:32:22 UTC (rev 1243)
@@ -0,0 +1,590 @@
+/***************************************************************************
+ *   Copyright (C) 2007-2008 by ?yvind Harboe                              *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+/* this file contains various functionality useful to standalone systems */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "log.h"
+#include "types.h"
+#include "configuration.h"
+#include "target.h"
+
+#include "command.h"
+
+#include <time_support.h>
+#include <sys/time.h>
+#include <sys/types.h>
+#include <strings.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <unistd.h>
+#if !BUILD_ECOSBOARD
+#include <malloc.h>
+#endif
+#include <errno.h>
+
+
+#include <fcntl.h>
+#include <sys/stat.h>
+#include <dirent.h>
+#include <netinet/tcp.h>
+#include <sys/ioctl.h>
+#include <sys/socket.h>
+#include <netinet/in.h>
+#include <net/if.h>
+#include <arpa/inet.h>
+#include <sys/types.h>
+#include <sys/socket.h>
+#include <netdb.h>
+#include <netinet/in.h>
+#include <unistd.h>
+#include <arpa/inet.h>
+#include <stdio.h>
+#include <string.h>
+
+
+#include <unistd.h>
+#include <stdio.h>
+
+int handle_rm_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
+{
+	if (argc != 1)
+	{
+		command_print(cmd_ctx, "rm <filename>");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	if (unlink(args[0]) != 0)
+	{
+		command_print(cmd_ctx, "failed: %d", errno);
+	}
+
+	return ERROR_OK;
+}
+
+
+/* loads a file and returns a pointer to it in memory. The file contains
+ * a 0 byte(sentinel) after len bytes - the length of the file. */
+int loadFile(const char *fileName, void **data, int *len)
+{
+	FILE * pFile;
+	pFile = fopen(fileName,"rb");
+	if (pFile==NULL)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		return ERROR_FAIL;
+	}
+	if (fseek(pFile, 0, SEEK_END)!=0)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		fclose(pFile);
+		return ERROR_FAIL;
+	}
+	*len=ftell(pFile);
+	if (*len==-1)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		fclose(pFile);
+		return ERROR_FAIL;
+	}
+
+	if (fseek(pFile, 0, SEEK_SET)!=0)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		fclose(pFile);
+		return ERROR_FAIL;
+	}
+	*data=malloc(*len+1);
+	if (*data==NULL)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		fclose(pFile);
+		return ERROR_FAIL;
+	}
+
+	if (fread(*data, 1, *len, pFile)!=*len)
+	{
+		fclose(pFile);
+		free(*data);
+		LOG_ERROR("Can't open %s\n", fileName);
+		return ERROR_FAIL;
+	}
+	fclose(pFile);
+	*(((char *)(*data))+*len)=0; /* sentinel */
+
+	return ERROR_OK;
+
+
+
+}
+
+
+
+int handle_cat_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
+{
+	if (argc != 1)
+	{
+		command_print(cmd_ctx, "cat <filename>");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
+	void *data;
+	int len;
+
+	int retval = loadFile(args[0], &data, &len);
+	if (retval == ERROR_OK)
+	{
+		command_print(cmd_ctx, "%s", data);
+		free(data);
+	}
+	else
+	{
+		command_print(cmd_ctx, "%s not found %d", args[0], retval);
+	}
+
+	return ERROR_OK;
+}
+int handle_trunc_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
+{
+	if (argc != 1)
+	{
+		command_print(cmd_ctx, "trunc <filename>");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	FILE *config_file = NULL;
+	config_file = fopen(args[0], "w");
+	if (config_file != NULL)
+		fclose(config_file);
+
+	return ERROR_OK;
+}
+
+
+int handle_meminfo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	static int prev = 0;
+	struct mallinfo info;
+
+	if (argc != 0)
+	{
+		command_print(cmd_ctx, "meminfo");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	info = mallinfo();
+
+	if (prev > 0)
+	{
+		command_print(cmd_ctx, "Diff:            %d", prev - info.fordblks);
+	}
+	prev = info.fordblks;
+
+	command_print(cmd_ctx, "Available ram:   %d", info.fordblks );
+
+	return ERROR_OK;
+}
+
+
+int handle_append_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
+{
+	if (argc < 1)
+	{
+		command_print(cmd_ctx,
+				"append <filename> [<string1>, [<string2>, ...]]");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	FILE *config_file = NULL;
+	config_file = fopen(args[0], "a");
+	if (config_file != NULL)
+	{
+		int i;
+		fseek(config_file, 0, SEEK_END);
+
+		for (i = 1; i < argc; i++)
+		{
+			fwrite(args[i], strlen(args[i]), 1, config_file);
+			if (i != argc - 1)
+			{
+				fwrite(" ", 1, 1, config_file);
+			}
+		}
+		fwrite("\n", 1, 1, config_file);
+		fclose(config_file);
+	}
+
+	return ERROR_OK;
+}
+
+
+
+int handle_cp_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 2)
+	{
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
+	void *data;
+	int len;
+
+	int retval = loadFile(args[0], &data, &len);
+	if (retval != ERROR_OK)
+		return retval;
+
+	FILE *f = fopen(args[1], "wb");
+	if (f == NULL)
+		retval = ERROR_INVALID_ARGUMENTS;
+
+	int pos = 0;
+	for (;;)
+	{
+		int chunk = len - pos;
+		static const int maxChunk = 512 * 1024; // ~1/sec
+		if (chunk > maxChunk)
+		{
+			chunk = maxChunk;
+		}
+
+		if ((retval==ERROR_OK)&&(fwrite(((char *)data)+pos, 1, chunk, f)!=chunk))
+			retval = ERROR_INVALID_ARGUMENTS;
+
+		if (retval != ERROR_OK)
+		{
+			break;
+		}
+
+		command_print(cmd_ctx, "%d", len - pos);
+
+		pos += chunk;
+
+		if (pos == len)
+			break;
+	}
+
+	if (retval == ERROR_OK)
+	{
+		command_print(cmd_ctx, "Copied %s to %s", args[0], args[1]);
+	} else
+	{
+		command_print(cmd_ctx, "Failed: %d", retval);
+	}
+
+	if (data != NULL)
+		free(data);
+	if (f != NULL)
+		fclose(f);
+
+	if (retval != ERROR_OK)
+		unlink(args[1]);
+
+	return retval;
+}
+
+
+
+
+#define SHOW_RESULT(a, b) LOG_ERROR(#a " failed %d\n", (int)b)
+
+#define IOSIZE 512
+void copyfile(char *name2, char *name1)
+{
+
+	int err;
+	char buf[IOSIZE];
+	int fd1, fd2;
+	ssize_t done, wrote;
+
+	fd1 = open(name1, O_WRONLY | O_CREAT);
+	if (fd1 < 0)
+		SHOW_RESULT( open, fd1 );
+
+	fd2 = open(name2, O_RDONLY);
+	if (fd2 < 0)
+		SHOW_RESULT( open, fd2 );
+
+	for (;;)
+	{
+		done = read(fd2, buf, IOSIZE );
+		if (done < 0)
+		{
+			SHOW_RESULT( read, done );
+			break;
+		}
+
+        if( done == 0 ) break;
+
+		wrote = write(fd1, buf, done);
+        if( wrote != done ) SHOW_RESULT( write, wrote );
+
+        if( wrote != done ) break;
+	}
+
+	err = close(fd1);
+    if( err < 0 ) SHOW_RESULT( close, err );
+
+	err = close(fd2);
+    if( err < 0 ) SHOW_RESULT( close, err );
+
+}
+
+/* utility fn to copy a directory */
+void copydir(char *name, char *destdir)
+{
+	int err;
+	DIR *dirp;
+
+	dirp = opendir(destdir);
+	if (dirp==NULL)
+	{
+		mkdir(destdir, 0777);
+	} else
+	{
+		err = closedir(dirp);
+	}
+
+	dirp = opendir(name);
+    if( dirp == NULL ) SHOW_RESULT( opendir, -1 );
+
+	for (;;)
+	{
+		struct dirent *entry = readdir(dirp);
+
+		if (entry == NULL)
+			break;
+
+		if (strcmp(entry->d_name, ".") == 0)
+			continue;
+		if (strcmp(entry->d_name, "..") == 0)
+			continue;
+
+		int isDir = 0;
+		struct stat buf;
+		char fullPath[PATH_MAX];
+		strncpy(fullPath, name, PATH_MAX);
+		strcat(fullPath, "/");
+		strncat(fullPath, entry->d_name, PATH_MAX - strlen(fullPath));
+
+		if (stat(fullPath, &buf) == -1)
+		{
+			LOG_ERROR("unable to read status from %s", fullPath);
+			break;
+		}
+		isDir = S_ISDIR(buf.st_mode) != 0;
+
+		if (isDir)
+			continue;
+
+		//        diag_printf("<INFO>: entry %14s",entry->d_name);
+		char fullname[PATH_MAX];
+		char fullname2[PATH_MAX];
+
+		strcpy(fullname, name);
+		strcat(fullname, "/");
+		strcat(fullname, entry->d_name);
+
+		strcpy(fullname2, destdir);
+		strcat(fullname2, "/");
+		strcat(fullname2, entry->d_name);
+		//        diag_printf("from %s to %s\n", fullname, fullname2);
+		copyfile(fullname, fullname2);
+
+		//       diag_printf("\n");
+	}
+
+	err = closedir(dirp);
+    if( err < 0 ) SHOW_RESULT( stat, err );
+}
+
+
+
+
+static int
+zylinjtag_Jim_Command_rm(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
+{
+	int del;
+	if (argc != 2)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "rm ?dirorfile?");
+		return JIM_ERR;
+	}
+
+	del = 0;
+	if (unlink(Jim_GetString(argv[1], NULL)) == 0)
+		del = 1;
+	if (rmdir(Jim_GetString(argv[1], NULL)) == 0)
+		del = 1;
+
+	return del ? JIM_OK : JIM_ERR;
+}
+
+
+static int
+zylinjtag_Jim_Command_ls(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
+{
+	if (argc != 2)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "ls ?dir?");
+		return JIM_ERR;
+	}
+
+	char *name = (char*) Jim_GetString(argv[1], NULL);
+
+	DIR *dirp = NULL;
+	dirp = opendir(name);
+	if (dirp == NULL)
+	{
+		return JIM_ERR;
+	}
+	Jim_Obj *objPtr = Jim_NewListObj(interp, NULL, 0);
+
+	for (;;)
+	{
+		struct dirent *entry = NULL;
+		entry = readdir(dirp);
+		if (entry == NULL)
+			break;
+
+		if ((strcmp(".", entry->d_name)==0)||(strcmp("..", entry->d_name)==0))
+			continue;
+
+        Jim_ListAppendElement(interp, objPtr, Jim_NewStringObj(interp, entry->d_name, strlen(entry->d_name)));
+	}
+	closedir(dirp);
+
+	Jim_SetResult(interp, objPtr);
+
+	return JIM_OK;
+}
+
+int handle_peek_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 1)
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+	volatile int *address=(volatile int *)strtoul(args[0], NULL, 0);
+	int value=*address;
+	command_print(cmd_ctx, "0x%x : 0x%x", address, value);
+	return ERROR_OK;
+}
+
+int handle_poke_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 2)
+	{
+		return ERROR_INVALID_ARGUMENTS;
+	}
+	volatile int *address=(volatile int *)strtoul(args[0], NULL, 0);
+	int value=strtoul(args[1], NULL, 0);
+	*address=value;
+	return ERROR_OK;
+}
+
+static int
+zylinjtag_Jim_Command_peek(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
+{
+	if (argc != 2)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "peek ?address?");
+		return JIM_ERR;
+	}
+
+	long address;
+	if (Jim_GetLong(interp, argv[1], &address) != JIM_OK)
+		return JIM_ERR;
+
+	int value = *((volatile int *) address);
+
+	Jim_SetResult(interp, Jim_NewIntObj(interp, value));
+
+	return JIM_OK;
+}
+
+static int
+zylinjtag_Jim_Command_poke(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
+{
+	if (argc != 3)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "poke ?address? ?value?");
+		return JIM_ERR;
+	}
+
+	long address;
+	if (Jim_GetLong(interp, argv[1], &address) != JIM_OK)
+		return JIM_ERR;
+	long value;
+	if (Jim_GetLong(interp, argv[2], &value) != JIM_OK)
+		return JIM_ERR;
+
+	*((volatile int *) address) = value;
+
+	return JIM_OK;
+}
+
+int ioutil_init(struct command_context_s *cmd_ctx)
+{
+	register_command(cmd_ctx, NULL, "rm", handle_rm_command, COMMAND_ANY,
+			"remove file");
+
+	register_command(cmd_ctx, NULL, "cat", handle_cat_command, COMMAND_ANY,
+			"display file content");
+
+	register_command(cmd_ctx, NULL, "trunc", handle_trunc_command, COMMAND_ANY,
+			"truncate a file to 0 size");
+
+	register_command(cmd_ctx, NULL, "cp", handle_cp_command,
+					 COMMAND_ANY, "copy a file <from> <to>");
+
+	register_command(cmd_ctx, NULL, "append_file", handle_append_command,
+			COMMAND_ANY, "append a variable number of strings to a file");
+
+	register_command(cmd_ctx, NULL, "meminfo", handle_meminfo_command,
+			COMMAND_ANY, "display available ram memory");
+
+    Jim_CreateCommand(interp, "rm", zylinjtag_Jim_Command_rm, NULL, NULL);
+
+    Jim_CreateCommand(interp, "peek", zylinjtag_Jim_Command_peek, NULL, NULL);
+    Jim_CreateCommand(interp, "poke", zylinjtag_Jim_Command_poke, NULL, NULL);
+    Jim_CreateCommand(interp, "ls", zylinjtag_Jim_Command_ls, NULL, NULL);
+
+
+    return ERROR_OK;
+}
+
+

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2008-12-15 09:43:26 UTC (rev 1242)
+++ trunk/src/jtag/zy1000.c	2008-12-15 11:32:22 UTC (rev 1243)
@@ -32,6 +32,12 @@
 
 #include <stdlib.h>
 
+#define ZYLIN_VERSION "1.48"
+#define ZYLIN_DATE __DATE__
+#define ZYLIN_TIME __TIME__
+#define ZYLIN_OPENOCD "$Revision: 1241 $"
+#define ZYLIN_OPENOCD_VERSION "Zylin JTAG ZY1000 " ZYLIN_VERSION " " ZYLIN_DATE " " ZYLIN_TIME
+const char *zylin_config_dir="/config/settings";
 
 extern int jtag_error;
 
@@ -223,7 +229,7 @@
 	{
 		if(speed > 8190 || speed < 2)
 		{
-			LOG_ERROR("valid ZY1000 jtag_speed=[8190,2]. Divisor is 64MHz / even values between 8190-2, i.e. min 7814Hz, max 32MHz");
+			LOG_USER("valid ZY1000 jtag_speed=[8190,2]. Divisor is 64MHz / even values between 8190-2, i.e. min 7814Hz, max 32MHz");
 			return ERROR_INVALID_ARGUMENTS;
 		}
 
@@ -234,91 +240,124 @@
 	return ERROR_OK;
 }
 
-int zy1000_register_commands(struct command_context_s *cmd_ctx)
+static bool savePower;
+
+
+static void setPower(bool power)
 {
-	return ERROR_OK;
+	savePower = power;
+	if (power)
+	{
+		HAL_WRITE_UINT32(ZY1000_JTAG_BASE+0x14, 0x8);
+	} else
+	{
+		HAL_WRITE_UINT32(ZY1000_JTAG_BASE+0x10, 0x8);
+	}
 }
 
-
-int zy1000_init(void)
+int handle_power_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
-	ZY1000_POKE(ZY1000_JTAG_BASE+0x10, 0x30); // Turn on LED1 & LED2
+	if (argc > 1)
+	{
+		return ERROR_INVALID_ARGUMENTS;
+	}
 
-	 /* deassert resets. Important to avoid infinite loop waiting for SRST to deassert */
-	zy1000_reset(0, 0);
-	zy1000_speed(jtag_speed);
+	if (argc == 1)
+	{
+		if (strcmp(args[0], "on") == 0)
+		{
+			setPower(1);
+		}
+		else if (strcmp(args[0], "off") == 0)
+		{
+			setPower(0);
+		} else
+		{
+			command_print(cmd_ctx, "arg is \"on\" or \"off\"");
+			return ERROR_INVALID_ARGUMENTS;
+		}
+	}
 
-	bitbang_interface = &zy1000_bitbang;
+	command_print(cmd_ctx, "Target power %s", savePower ? "on" : "off");
 
 	return ERROR_OK;
 }
 
-int zy1000_quit(void)
-{
 
-	return ERROR_OK;
-}
-
-
-
-/* loads a file and returns a pointer to it in memory. The file contains
- * a 0 byte(sentinel) after len bytes - the length of the file. */
-int loadFile(const char *fileName, void **data, int *len)
+/* Give TELNET a way to find out what version this is */
+int handle_zy1000_version_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
 {
-	FILE * pFile;
-	pFile = fopen(fileName,"rb");
-	if (pFile==NULL)
+	if (argc > 1)
 	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		return ERROR_JTAG_DEVICE_ERROR;
+		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	if (fseek(pFile, 0, SEEK_END)!=0)
+	if (argc == 0)
 	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		fclose(pFile);
-		return ERROR_JTAG_DEVICE_ERROR;
+		command_print(cmd_ctx, ZYLIN_OPENOCD_VERSION);
 	}
-	*len=ftell(pFile);
-	if (*len==-1)
+	else if (strcmp("openocd", args[0]) == 0)
 	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		fclose(pFile);
-		return ERROR_JTAG_DEVICE_ERROR;
+		int revision;
+		revision = atol(ZYLIN_OPENOCD+strlen("XRevision: "));
+		command_print(cmd_ctx, "%d", revision);
 	}
-
-	if (fseek(pFile, 0, SEEK_SET)!=0)
+	else if (strcmp("zy1000", args[0]) == 0)
 	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		fclose(pFile);
-		return ERROR_JTAG_DEVICE_ERROR;
+		command_print(cmd_ctx, "%s", ZYLIN_VERSION);
 	}
-	*data=malloc(*len+1);
-	if (*data==NULL)
+	else if (strcmp("date", args[0]) == 0)
 	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		fclose(pFile);
-		return ERROR_JTAG_DEVICE_ERROR;
+		command_print(cmd_ctx, "%s", ZYLIN_DATE);
 	}
-
-	if (fread(*data, 1, *len, pFile)!=*len)
+	else
 	{
-		fclose(pFile);
-	free(*data);
-		LOG_ERROR("Can't open %s\n", fileName);
-		return ERROR_JTAG_DEVICE_ERROR;
+		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	fclose(pFile);
-	*(((char *)(*data))+*len)=0; /* sentinel */
 
 	return ERROR_OK;
+}
 
 
+int zy1000_register_commands(struct command_context_s *cmd_ctx)
+{
+	register_command(cmd_ctx, NULL, "power", handle_power_command, COMMAND_ANY,
+			"power <on/off> - turn power switch to target on/off. No arguments - print status.");
+	register_command(cmd_ctx, NULL, "zy1000_version", handle_zy1000_version_command,
+			COMMAND_EXEC, "show zy1000 version numbers");
 
+
+	return ERROR_OK;
 }
 
 
+int zy1000_init(void)
+{
+	LOG_ERROR("%s\n", ZYLIN_OPENOCD_VERSION);
 
+	ZY1000_POKE(ZY1000_JTAG_BASE+0x10, 0x30); // Turn on LED1 & LED2
 
+	setPower(true); // on by default
+
+
+	 /* deassert resets. Important to avoid infinite loop waiting for SRST to deassert */
+	zy1000_reset(0, 0);
+	zy1000_speed(jtag_speed);
+
+	bitbang_interface = &zy1000_bitbang;
+
+	return ERROR_OK;
+}
+
+int zy1000_quit(void)
+{
+
+	return ERROR_OK;
+}
+
+
+
+
 int interface_jtag_execute_queue(void)
 {
 	cyg_uint32 empty;
@@ -703,7 +742,7 @@
 		}
 		else
 		{
-			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(path[state_count)]);
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(path[state_count]));
 			exit(-1);
 		}
 
@@ -760,3 +799,25 @@
 	}
 }
 
+int loadFile(const char *fileName, void **data, int *len);
+
+/* boolean parameter stored on config */
+int boolParam(char *var)
+{
+	bool result = false;
+	char *name = alloc_printf("%s/%s", zylin_config_dir, var);
+	if (name == NULL)
+		return result;
+
+	void *data;
+	int len;
+	if (loadFile(name, &data, &len) == ERROR_OK)
+	{
+		if (len > 1)
+			len = 1;
+		result = strncmp((char *) data, "1", len) == 0;
+		free(data);
+	}
+	free(name);
+	return result;
+}

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2008-12-15 09:43:26 UTC (rev 1242)
+++ trunk/src/openocd.c	2008-12-15 11:32:22 UTC (rev 1243)
@@ -118,6 +118,8 @@
 	return ERROR_OK;
 }
 
+int ioutil_init(struct command_context_s *cmd_ctx);
+
 /* OpenOCD can't really handle failure of this command. Patches welcome! :-) */
 int handle_init_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
@@ -130,6 +132,13 @@
 
 	atexit(exit_handler);
 
+#if BUILD_IOUTIL
+	if (ioutil_init(cmd_ctx) != ERROR_OK)
+	{
+		return ERROR_FAIL;
+	}
+#endif
+
 	if (target_init(cmd_ctx) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG("target init complete");

Modified: zy1000/trunk/build/buildocd.sh
===================================================================
--- zy1000/trunk/build/buildocd.sh	2008-12-15 09:43:26 UTC (rev 1242)
+++ zy1000/trunk/build/buildocd.sh	2008-12-15 11:32:22 UTC (rev 1243)
@@ -19,7 +19,7 @@
 rm -rf /tmp/ecosboard/build
 mkdir /tmp/ecosboard/build
 cd /tmp/ecosboard/build
-$OPENOCD/../../openocd/configure --host=arm-elf --includedir=/tmp/ecosboard/ecos/install/include/ --enable-ecosboard --prefix=/tmp/ecosboard/ocdinstall
+$OPENOCD/../../openocd/configure --enable-ioutil --host=arm-elf --includedir=/tmp/ecosboard/ecos/install/include/ --enable-ecosboard --prefix=/tmp/ecosboard/ocdinstall
 echo >makephi.sh sh $OPENOCD/makephi.sh
 echo >>makephi.sh sh $OPENOCD/makefw.sh
 make

Modified: zy1000/trunk/build/include/jtag_minidriver.h
===================================================================
--- zy1000/trunk/build/include/jtag_minidriver.h	2008-12-15 09:43:26 UTC (rev 1242)
+++ zy1000/trunk/build/include/jtag_minidriver.h	2008-12-15 11:32:22 UTC (rev 1243)
@@ -64,7 +64,7 @@
 	cyg_uint32 a;
 	a=state;
 	int repeat=0;
-	if (state==TAP_TLR)
+	if (state==TAP_RESET)
 	{
 		// The FPGA nor we know the current state of the CPU TAP
 		// controller. This will move it to TAP for sure.
@@ -92,7 +92,7 @@
 	ZY1000_POKE(ZY1000_JTAG_BASE+0xc, value);
 #if 1
 #if TEST_MANUAL()
-	if ((state==TAP_SD)&&(endState!=TAP_SD))
+	if ((state==TAP_DRSHIFT)&&(endState!=TAP_DRSHIFT))
 	{
 		int i;
 		setCurrentState(state);
@@ -111,8 +111,8 @@
 		waitIdle();
 		ZY1000_POKE(ZY1000_JTAG_BASE+0x28, 0);
 		waitIdle();
-		//ZY1000_POKE(ZY1000_JTAG_BASE+0x20, TAP_SD); // set this state and things break => expected
-		ZY1000_POKE(ZY1000_JTAG_BASE+0x20, TAP_PD); // set this and things will work => expected. Not setting this is not sufficient to make things break.
+		//ZY1000_POKE(ZY1000_JTAG_BASE+0x20, TAP_DRSHIFT); // set this state and things break => expected
+		ZY1000_POKE(ZY1000_JTAG_BASE+0x20, TAP_DRPAUSE); // set this and things will work => expected. Not setting this is not sufficient to make things break.
 		setCurrentState(endState);
 	} else
 	{
@@ -124,7 +124,7 @@
 #endif
 #else
 	/* maximum debug version */
-	if ((repeat>0)&&((state==TAP_SD)||(state==TAP_SI)))
+	if ((repeat>0)&&((state==TAP_DRSHIFT)||(state==TAP_SI)))
 	{
 		int i;
 		/* sample shift register for every bit. */
@@ -154,7 +154,7 @@
 		const u32 *value,
 		enum tap_state end_state)
 {
-	enum tap_state pause_state = TAP_SD;
+	enum tap_state pause_state = TAP_DRSHIFT;
 
 	jtag_tap_t *tap, *nextTap;
 	for(tap = jtag_NextEnabledTap(NULL); tap!= NULL; tap=nextTap)
@@ -162,20 +162,20 @@
 		nextTap=jtag_NextEnabledTap(tap);
 		if (nextTap==NULL)
 		{
-			pause_state = TAP_PD;
+			pause_state = TAP_DRPAUSE;
 		}
 		if (tap == target_tap)
 		{
 			int j;
 			for (j=0; j<(num_fields-1); j++)
 			{
-				shiftValueInner(TAP_SD, TAP_SD, num_bits[j], value[j]);
+				shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, num_bits[j], value[j]);
 			}
-			shiftValueInner(TAP_SD, pause_state, num_bits[j], value[j]);
+			shiftValueInner(TAP_DRSHIFT, pause_state, num_bits[j], value[j]);
 		} else
 		{
 			/* program the scan field to 1 bit length, and ignore it's value */
-			shiftValueInner(TAP_SD, pause_state, 1, 0);
+			shiftValueInner(TAP_DRSHIFT, pause_state, 1, 0);
 		}
 	}
 	setCurrentState(end_state);
@@ -192,15 +192,15 @@
 	if ((singletap)&&(num_fields==3))
 	{
 		/* used by embeddedice_write_reg_inner() */
-		shiftValueInner(TAP_SD, TAP_SD, num_bits[0], value[0]);
-		shiftValueInner(TAP_SD, TAP_SD, num_bits[1], value[1]);
-		shiftValueInner(TAP_SD, TAP_PD, num_bits[2], value[2]);
+		shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, num_bits[0], value[0]);
+		shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, num_bits[1], value[1]);
+		shiftValueInner(TAP_DRSHIFT, TAP_DRPAUSE, num_bits[2], value[2]);
 		setCurrentState(end_state);
 	} else if ((singletap)&&(num_fields==2))
 	{
 		/* used by arm7 code */
-		shiftValueInner(TAP_SD, TAP_SD, num_bits[0], value[0]);
-		shiftValueInner(TAP_SD, TAP_PD, num_bits[1], value[1]);
+		shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, num_bits[0], value[0]);
+		shiftValueInner(TAP_DRSHIFT, TAP_DRPAUSE, num_bits[1], value[1]);
 		setCurrentState(end_state);
 	} else
 	{

Modified: zy1000/trunk/build/include/rom.h
===================================================================
--- zy1000/trunk/build/include/rom.h	2008-12-15 09:43:26 UTC (rev 1242)
+++ zy1000/trunk/build/include/rom.h	2008-12-15 11:32:22 UTC (rev 1243)
@@ -1,682 +1,690 @@
 /* This is a generated file. Do not edit. */
 
 static CYGBLD_ATTRIB_ALIGN(4) const unsigned char filedata[] = {
-    0x2e, 0x6d, 0x6f, 0x52, 0xa8, 0x00, 0x00, 0x00,
-    0x00, 0xd5, 0x07, 0x00, 0x04, 0x03, 0x02, 0x01,
+    0x2e, 0x6d, 0x6f, 0x52, 0xaa, 0x00, 0x00, 0x00,
+    0x00, 0xde, 0x07, 0x00, 0x04, 0x03, 0x02, 0x01,
     0x52, 0x4f, 0x4d, 0x46, 0x53, 0x20, 0x76, 0x31,
     0x2e, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x01, 0x00, 0x6f, 0x01, 0x09, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x40, 0x05, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x20, 0x15, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x60, 0x15, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe0, 0x8f, 0x00, 0x00,
-    0x91, 0xe7, 0x37, 0x49, 0x00, 0x2e, 0x00, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x2e, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x31, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x01, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x60, 0x1a, 0x00, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0xa0, 0x1a, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x90, 0x37, 0x00, 0x00,
-    0xa4, 0xe7, 0x37, 0x49, 0xe0, 0xbd, 0x00, 0x00,
+    0x2b, 0x3e, 0x46, 0x49, 0x60, 0xbe, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x8a, 0x2b, 0x00, 0x00,
-    0xa4, 0xe7, 0x37, 0x49, 0x80, 0xf5, 0x00, 0x00,
+    0x2b, 0x3e, 0x46, 0x49, 0x00, 0xf6, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x34, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0xc0, 0x1b, 0x00, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x00, 0x1c, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xae, 0x37, 0x00, 0x00,
-    0xa4, 0xe7, 0x37, 0x49, 0x20, 0x21, 0x01, 0x00,
+    0x2c, 0x3e, 0x46, 0x49, 0xa0, 0x21, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x9d, 0x2f, 0x00, 0x00,
-    0xa4, 0xe7, 0x37, 0x49, 0xe0, 0x58, 0x01, 0x00,
+    0x2c, 0x3e, 0x46, 0x49, 0x60, 0x59, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf3, 0x2d, 0x00, 0x00,
-    0xa4, 0xe7, 0x37, 0x49, 0x80, 0x88, 0x01, 0x00,
+    0x2c, 0x3e, 0x46, 0x49, 0x00, 0x89, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x9e, 0x00, 0x00, 0x00,
-    0xa5, 0xe7, 0x37, 0x49, 0x80, 0xb6, 0x01, 0x00,
+    0x2c, 0x3e, 0x46, 0x49, 0x00, 0xb7, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x78, 0x38, 0x00, 0x00,
-    0xa5, 0xe7, 0x37, 0x49, 0x20, 0xb7, 0x01, 0x00,
+    0x2d, 0x3e, 0x46, 0x49, 0xa0, 0xb7, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x06, 0x2e, 0x00, 0x00,
-    0xa5, 0xe7, 0x37, 0x49, 0xa0, 0xef, 0x01, 0x00,
+    0x2d, 0x3e, 0x46, 0x49, 0x20, 0xf0, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x8b, 0x65, 0x00, 0x00,
-    0x91, 0xe7, 0x37, 0x49, 0xc0, 0x1d, 0x02, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x40, 0x1e, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x32, 0x3e,
     0x08, 0x00, 0x6f, 0x01, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x92, 0x02, 0x00, 0x00,
-    0x91, 0xe7, 0x37, 0x49, 0x60, 0xd2, 0x07, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x60, 0xdb, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf3, 0x2e, 0x00, 0x00,
-    0xa6, 0xe7, 0x37, 0x49, 0x60, 0x83, 0x02, 0x00,
+    0x2e, 0x3e, 0x46, 0x49, 0xe0, 0x83, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa9, 0x39, 0x00, 0x00,
-    0xa6, 0xe7, 0x37, 0x49, 0x60, 0xb2, 0x02, 0x00,
+    0x2f, 0x3e, 0x46, 0x49, 0xe0, 0xb2, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x35, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x00, 0x03, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x20, 0x1c, 0x00, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x60, 0x1c, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x59, 0x26, 0x00, 0x00,
-    0xa6, 0xe7, 0x37, 0x49, 0x20, 0xec, 0x02, 0x00,
+    0x2f, 0x3e, 0x46, 0x49, 0xa0, 0xec, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x22, 0x03, 0x00, 0x00,
-    0x91, 0xe7, 0x37, 0x49, 0x80, 0x12, 0x03, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x00, 0x13, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x6a, 0x08, 0x00, 0x00,
-    0x91, 0xe7, 0x37, 0x49, 0xc0, 0x15, 0x03, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x40, 0x16, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x39, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc0, 0x02, 0x00, 0x00,
-    0xa3, 0xe7, 0x37, 0x49, 0x20, 0x1f, 0x00, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x60, 0x1f, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0xe1, 0x08, 0x00, 0x00,
-    0x9c, 0xe7, 0x37, 0x49, 0x40, 0x1e, 0x03, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x30, 0x09, 0x00, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0x1e, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xdf, 0x2a, 0x00, 0x00,
-    0xab, 0xe7, 0x37, 0x49, 0x40, 0x27, 0x03, 0x00,
+    0x35, 0x3e, 0x46, 0x49, 0x00, 0x28, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x19, 0x30, 0x00, 0x00,
-    0xab, 0xe7, 0x37, 0x49, 0x20, 0x52, 0x03, 0x00,
+    0x35, 0x3e, 0x46, 0x49, 0xe0, 0x52, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xcb, 0x32, 0x00, 0x00,
-    0xac, 0xe7, 0x37, 0x49, 0x40, 0x82, 0x03, 0x00,
+    0x35, 0x3e, 0x46, 0x49, 0x00, 0x83, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x0d, 0x29, 0x00, 0x00,
-    0xac, 0xe7, 0x37, 0x49, 0x20, 0xb5, 0x03, 0x00,
+    0x36, 0x3e, 0x46, 0x49, 0xe0, 0xb5, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xd7, 0x2d, 0x00, 0x00,
-    0xad, 0xe7, 0x37, 0x49, 0x40, 0xde, 0x03, 0x00,
+    0x36, 0x3e, 0x46, 0x49, 0x00, 0xdf, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x26, 0x01, 0x00, 0x00,
-    0xad, 0xe7, 0x37, 0x49, 0x20, 0x0c, 0x04, 0x00,
+    0x36, 0x3e, 0x46, 0x49, 0xe0, 0x0c, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x3f, 0x0b, 0x00, 0x00,
-    0x9f, 0xe7, 0x37, 0x49, 0x60, 0x0d, 0x04, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x20, 0x0e, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x91, 0x30, 0x00, 0x00,
-    0xad, 0xe7, 0x37, 0x49, 0xa0, 0x18, 0x04, 0x00,
+    0x37, 0x3e, 0x46, 0x49, 0x60, 0x19, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x41, 0x07, 0x00, 0x00,
-    0xae, 0xe7, 0x37, 0x49, 0x40, 0x49, 0x04, 0x00,
+    0x37, 0x3e, 0x46, 0x49, 0x00, 0x4a, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x30, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0xa0, 0x06, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xe0, 0x21, 0x00, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0xe0, 0x06, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x20, 0x22, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x22, 0x48, 0x00, 0x00,
-    0xae, 0xe7, 0x37, 0x49, 0xa0, 0x50, 0x04, 0x00,
+    0x37, 0x3e, 0x46, 0x49, 0x60, 0x51, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x32, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x04, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x00, 0x01, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x80, 0x28, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x00, 0x29, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xca, 0x2e, 0x00, 0x00,
-    0xae, 0xe7, 0x37, 0x49, 0xe0, 0x98, 0x04, 0x00,
+    0x37, 0x3e, 0x46, 0x49, 0xa0, 0x99, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xab, 0x30, 0x00, 0x00,
-    0xae, 0xe7, 0x37, 0x49, 0xc0, 0xc7, 0x04, 0x00,
+    0x38, 0x3e, 0x46, 0x49, 0x80, 0xc8, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x70, 0x01, 0x00, 0x00,
-    0xae, 0xe7, 0x37, 0x49, 0x80, 0xf8, 0x04, 0x00,
+    0x38, 0x3e, 0x46, 0x49, 0x40, 0xf9, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x36, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x80, 0x29, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x00, 0x2a, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xb3, 0x35, 0x00, 0x00,
-    0xaf, 0xe7, 0x37, 0x49, 0x00, 0xfa, 0x04, 0x00,
+    0x38, 0x3e, 0x46, 0x49, 0xc0, 0xfa, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x13, 0x06, 0x00, 0x00,
-    0xa2, 0xe7, 0x37, 0x49, 0xc0, 0x2f, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x30, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x65, 0x03, 0x00, 0x00,
-    0x91, 0xe7, 0x37, 0x49, 0xe0, 0x35, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0xa0, 0x36, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xce, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x60, 0x39, 0x05, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0x20, 0x3a, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x51, 0x08, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x40, 0x3a, 0x05, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0x00, 0x3b, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x62, 0x09, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0xa0, 0x42, 0x05, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0x60, 0x43, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x0f, 0x04, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x20, 0x4c, 0x05, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x14, 0x04, 0x00, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0xe0, 0x4c, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x40, 0x50, 0x05, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0x00, 0x51, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x23, 0x01, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0xa0, 0x50, 0x05, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0x60, 0x51, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x64, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0xe0, 0x51, 0x05, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0xa0, 0x52, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x69, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x60, 0x52, 0x05, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0x20, 0x53, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa9, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0xe0, 0x52, 0x05, 0x00,
+    0x77, 0x3e, 0x46, 0x49, 0xa0, 0x53, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe0, 0x8f, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0xa0, 0x53, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x60, 0x54, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x85, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x80, 0xe3, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0xe4, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x3d, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x20, 0xe4, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xe4, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xfc, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x60, 0xe4, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x20, 0xe5, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xfe, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x60, 0xe5, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x20, 0xe6, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xb4, 0x01, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x60, 0xe6, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x20, 0xe7, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x3a, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x20, 0xe8, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xe8, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x11, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x60, 0xe8, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x20, 0xe9, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xee, 0x00, 0x00, 0x00,
-    0xe5, 0xe7, 0x37, 0x49, 0x80, 0xe8, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0xe9, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x26, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0xe9, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0xea, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x7b, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xc0, 0xe9, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x80, 0xea, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x7b, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x40, 0xea, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x00, 0xeb, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa5, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xc0, 0xea, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x80, 0xeb, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x72, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0xeb, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0xec, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x86, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x00, 0xec, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xc0, 0xec, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x75, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xa0, 0xec, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x60, 0xed, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x99, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x20, 0xed, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xed, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xad, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xc0, 0xed, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x80, 0xee, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x72, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0xee, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0xef, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x79, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x00, 0xef, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xc0, 0xef, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x6f, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0xef, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0xf0, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x50, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x00, 0xf0, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xc0, 0xf0, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x8d, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x60, 0xf0, 0x05, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x20, 0xf1, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x35, 0x01, 0x00, 0x00,
-    0x9a, 0xe7, 0x37, 0x49, 0x00, 0xf1, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0xf1, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x33, 0x01, 0x00, 0x00,
-    0x9a, 0xe7, 0x37, 0x49, 0x40, 0xf2, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x00, 0xf3, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x6c, 0x01, 0x00, 0x00,
-    0x9a, 0xe7, 0x37, 0x49, 0x80, 0xf3, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x40, 0xf4, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x36, 0x01, 0x00, 0x00,
-    0x9a, 0xe7, 0x37, 0x49, 0x00, 0xf5, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0xf5, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x5d, 0x01, 0x00, 0x00,
-    0x9a, 0xe7, 0x37, 0x49, 0x40, 0xf6, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x00, 0xf7, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x4a, 0x01, 0x00, 0x00,
-    0x9a, 0xe7, 0x37, 0x49, 0xa0, 0xf7, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x60, 0xf8, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc6, 0x01, 0x00, 0x00,
-    0x9a, 0xe7, 0x37, 0x49, 0x00, 0xf9, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0xf9, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc0, 0x03, 0x00, 0x00,
-    0x9a, 0xe7, 0x37, 0x49, 0xe0, 0xfa, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0xa0, 0xfb, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x0a, 0x0c, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0xa0, 0xfe, 0x05, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x60, 0xff, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x5f, 0x01, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0xc0, 0x0a, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x0b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x19, 0x01, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0x20, 0x0c, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0xe0, 0x0c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x09, 0x01, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0x40, 0x0d, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x00, 0x0e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x01, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0x60, 0x0e, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x20, 0x0f, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x31, 0x01, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0xc0, 0x0f, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x10, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa9, 0x00, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0x00, 0x11, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0x11, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf1, 0x08, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0xc0, 0x11, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x12, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x86, 0x01, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0xc0, 0x1a, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x1b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x65, 0x01, 0x00, 0x00,
-    0x9b, 0xe7, 0x37, 0x49, 0x60, 0x1c, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0x20, 0x1d, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x84, 0x0f, 0x00, 0x00,
-    0x9c, 0xe7, 0x37, 0x49, 0xe0, 0x1d, 0x06, 0x00,
+    0x2a, 0x3e, 0x46, 0x49, 0xa0, 0x1e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x01, 0x06, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0x2d, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0x2e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x27, 0x07, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xa0, 0x33, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x60, 0x34, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x46, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0x3a, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x47, 0x05, 0x00, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xa0, 0x3b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x37, 0x06, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x40, 0x40, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x00, 0x41, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x53, 0x0c, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0x46, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x52, 0x0c, 0x00, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0x47, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0xfb, 0x03, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0x52, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0xfa, 0x03, 0x00, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xa0, 0x53, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x83, 0x0b, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0x56, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xa0, 0x57, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x9f, 0x03, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0x62, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0x63, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf4, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x20, 0x66, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xe0, 0x66, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf2, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x20, 0x6c, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xe0, 0x6c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x77, 0x04, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x20, 0x72, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xe0, 0x72, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xfe, 0x06, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xa0, 0x76, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x60, 0x77, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x17, 0x03, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xa0, 0x7d, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x60, 0x7e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe2, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xc0, 0x80, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x80, 0x81, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x19, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xc0, 0x86, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x80, 0x87, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc2, 0x04, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0x8b, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xa0, 0x8c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xbd, 0x04, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xc0, 0x90, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x80, 0x91, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf6, 0x03, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0x95, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0x96, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa2, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0x99, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0x9a, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x34, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x40, 0x9f, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x00, 0xa0, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x31, 0x00, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0x9f, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0xa0, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x4c, 0x04, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xc0, 0x9f, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x80, 0xa0, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x25, 0x03, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x20, 0xa4, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xa4, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x14, 0x01, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x60, 0xa7, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x20, 0xa8, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x3c, 0x06, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0xa8, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0xa9, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x05, 0x04, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xc0, 0xae, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x80, 0xaf, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x88, 0x09, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0xb2, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xa0, 0xb3, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x15, 0x02, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0xbc, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x40, 0xbd, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x9b, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xa0, 0xbe, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x60, 0xbf, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc3, 0x04, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x40, 0xc4, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x00, 0xc5, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x03, 0x04, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x20, 0xc9, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xc9, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x98, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x40, 0xcd, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0x00, 0xce, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe3, 0x03, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0xd2, 0x06, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xa0, 0xd3, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x4e, 0x02, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0xd6, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0xe3, 0x03, 0x00, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xa0, 0xd7, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x97, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x40, 0xd9, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x3f, 0x04, 0x00, 0x00,
+    0x78, 0x3e, 0x46, 0x49, 0xa0, 0xdb, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x67, 0x02, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0xde, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x4e, 0x02, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0xe0, 0xdf, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x33, 0x01, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x60, 0xe1, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x97, 0x05, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x40, 0xe2, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x84, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xa0, 0xe2, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x67, 0x02, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0xe0, 0xe7, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x2d, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x40, 0xe8, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x33, 0x01, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x60, 0xea, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x48, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0xed, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x84, 0x05, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xeb, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0xfc, 0x04, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0xf2, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x2d, 0x05, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x40, 0xf1, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x5d, 0x05, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0xf7, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x48, 0x05, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x80, 0xf6, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x9e, 0x06, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x40, 0xfd, 0x06, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0xfc, 0x04, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0xe0, 0xfb, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x84, 0x07, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0xe0, 0x03, 0x07, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x5d, 0x05, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0xe0, 0x00, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0xf0, 0x04, 0x00, 0x00,
-    0xe6, 0xe7, 0x37, 0x49, 0x80, 0x0b, 0x07, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x9e, 0x06, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x40, 0x06, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0xcc, 0x01, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x80, 0x10, 0x07, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x84, 0x07, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0xe0, 0x0c, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x5a, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x60, 0x12, 0x07, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0xf0, 0x04, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x80, 0x14, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x21, 0x0f, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xc0, 0x12, 0x07, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0xcc, 0x01, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x80, 0x19, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0xfa, 0x09, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x00, 0x22, 0x07, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x5a, 0x00, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x60, 0x1b, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0xf5, 0x0b, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x00, 0x2c, 0x07, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0x21, 0x0f, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0xc0, 0x1b, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0xfa, 0x09, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x00, 0x2b, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x32, 0x3e,
+    0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0xf5, 0x0b, 0x00, 0x00,
+    0x79, 0x3e, 0x46, 0x49, 0x00, 0x35, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x33, 0x3e,
+    0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x7f, 0x06, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x00, 0x38, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x32, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x00, 0x41, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x34, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x04, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x80, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xe0, 0x29, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x33, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x60, 0x2a, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x35, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x03, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x60, 0x2a, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x34, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xe0, 0x2a, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x88, 0x0e, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x80, 0x3e, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x35, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x80, 0x47, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe0, 0x06, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x20, 0x4d, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x36, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x20, 0x56, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x5e, 0x02, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x00, 0x54, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x37, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x00, 0x5d, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x39, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x03, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xc0, 0x2a, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x38, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x40, 0x2b, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x30, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x03, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x20, 0x2b, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x39, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xa0, 0x2b, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x31, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x00, 0x01, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x80, 0x2b, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x30, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x00, 0x2c, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x18, 0x0c, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x60, 0x56, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x31, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x60, 0x5f, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x21, 0x0f, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x80, 0x62, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x32, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x80, 0x6b, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa9, 0x10, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xc0, 0x71, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x33, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xc0, 0x7a, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x66, 0x01, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x80, 0x82, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x34, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x80, 0x8b, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xaf, 0x05, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x00, 0x84, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x35, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x00, 0x8d, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xcf, 0x0e, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xc0, 0x89, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x36, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xc0, 0x92, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x38, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa0, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x80, 0x2c, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x37, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x00, 0x2d, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xec, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xa0, 0x98, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x38, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xa1, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf1, 0x1d, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xa0, 0x99, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x39, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xa2, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf6, 0x11, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xa0, 0xb7, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x30, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xc0, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x32, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe0, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x20, 0x2d, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x31, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xa0, 0x2d, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x79, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xa0, 0xc9, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x32, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xd2, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x77, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x20, 0xca, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x33, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x20, 0xd3, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x78, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xa0, 0xca, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x34, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xd3, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x78, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x20, 0xcb, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x35, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x20, 0xd4, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x79, 0x00, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0xa0, 0xcb, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x36, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xd4, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x38, 0x06, 0x00, 0x00,
-    0xe7, 0xe7, 0x37, 0x49, 0x20, 0xcc, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x37, 0x3e,
+    0x79, 0x3e, 0x46, 0x49, 0x20, 0xd5, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x39, 0x3e,
     0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1227,53 +1235,61 @@
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x7d, 0x00, 0x00, 0x00, 0x80, 0x04, 0x00, 0x00,
     0x73, 0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x5f,
-    0x73, 0x33, 0x63, 0x34, 0x35, 0x31, 0x30, 0x2e,
+    0x73, 0x33, 0x63, 0x32, 0x34, 0x31, 0x30, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x7e, 0x00, 0x00, 0x00, 0xa0, 0x04, 0x00, 0x00,
     0x73, 0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x5f,
+    0x73, 0x33, 0x63, 0x32, 0x34, 0x34, 0x30, 0x2e,
+    0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x7f, 0x00, 0x00, 0x00, 0xc0, 0x04, 0x00, 0x00,
+    0x73, 0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x5f,
+    0x73, 0x33, 0x63, 0x34, 0x35, 0x31, 0x30, 0x2e,
+    0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x80, 0x00, 0x00, 0x00, 0xe0, 0x04, 0x00, 0x00,
+    0x73, 0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x5f,
     0x73, 0x33, 0x63, 0x36, 0x34, 0x31, 0x30, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x7f, 0x00, 0x00, 0x00, 0xc0, 0x04, 0x00, 0x00,
+    0x81, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00,
     0x73, 0x68, 0x61, 0x72, 0x70, 0x5f, 0x6c, 0x68,
     0x37, 0x39, 0x35, 0x33, 0x32, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x80, 0x00, 0x00, 0x00, 0xe0, 0x04, 0x00, 0x00,
+    0x82, 0x00, 0x00, 0x00, 0x20, 0x05, 0x00, 0x00,
     0x73, 0x6d, 0x64, 0x6b, 0x36, 0x34, 0x31, 0x30,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x81, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00,
+    0x83, 0x00, 0x00, 0x00, 0x40, 0x05, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x82, 0x00, 0x00, 0x00, 0x20, 0x05, 0x00, 0x00,
+    0x84, 0x00, 0x00, 0x00, 0x60, 0x05, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x73, 0x74, 0x69,
     0x63, 0x6b, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x83, 0x00, 0x00, 0x00, 0x40, 0x05, 0x00, 0x00,
+    0x85, 0x00, 0x00, 0x00, 0x80, 0x05, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x37, 0x31, 0x30, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x84, 0x00, 0x00, 0x00, 0x60, 0x05, 0x00, 0x00,
+    0x86, 0x00, 0x00, 0x00, 0xa0, 0x05, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x37, 0x33, 0x30, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x85, 0x00, 0x00, 0x00, 0x80, 0x05, 0x00, 0x00,
+    0x87, 0x00, 0x00, 0x00, 0xc0, 0x05, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x37, 0x35, 0x30, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x86, 0x00, 0x00, 0x00, 0xa0, 0x05, 0x00, 0x00,
+    0x88, 0x00, 0x00, 0x00, 0xe0, 0x05, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x39, 0x31, 0x30, 0x2d, 0x65,
     0x76, 0x61, 0x6c, 0x2e, 0x63, 0x66, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x87, 0x00, 0x00, 0x00, 0xc0, 0x05, 0x00, 0x00,
+    0x89, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x39, 0x31, 0x32, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x88, 0x00, 0x00, 0x00, 0xe0, 0x05, 0x00, 0x00,
+    0x8a, 0x00, 0x00, 0x00, 0x20, 0x06, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x39, 0x63, 0x6f, 0x6d, 0x73,
     0x74, 0x69, 0x63, 0x6b, 0x2e, 0x63, 0x66, 0x67,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x89, 0x00, 0x00, 0x00, 0x20, 0x06, 0x00, 0x00,
+    0x8b, 0x00, 0x00, 0x00, 0x60, 0x06, 0x00, 0x00,
     0x74, 0x65, 0x73, 0x74, 0x5f, 0x72, 0x65, 0x73,
     0x65, 0x74, 0x5f, 0x73, 0x79, 0x6e, 0x74, 0x61,
     0x78, 0x5f, 0x65, 0x72, 0x72, 0x6f, 0x72, 0x2e,
@@ -1281,19 +1297,19 @@
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8a, 0x00, 0x00, 0x00, 0x40, 0x06, 0x00, 0x00,
+    0x8c, 0x00, 0x00, 0x00, 0x80, 0x06, 0x00, 0x00,
     0x74, 0x65, 0x73, 0x74, 0x5f, 0x73, 0x79, 0x6e,
     0x74, 0x61, 0x78, 0x5f, 0x65, 0x72, 0x72, 0x6f,
     0x72, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
-    0x8b, 0x00, 0x00, 0x00, 0x60, 0x06, 0x00, 0x00,
+    0x8d, 0x00, 0x00, 0x00, 0xa0, 0x06, 0x00, 0x00,
     0x77, 0x69, 0x2d, 0x39, 0x63, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8c, 0x00, 0x00, 0x00, 0x80, 0x06, 0x00, 0x00,
+    0x8e, 0x00, 0x00, 0x00, 0xc0, 0x06, 0x00, 0x00,
     0x78, 0x62, 0x61, 0x5f, 0x72, 0x65, 0x76, 0x41,
     0x33, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8d, 0x00, 0x00, 0x00, 0xa0, 0x06, 0x00, 0x00,
+    0x8f, 0x00, 0x00, 0x00, 0xe0, 0x06, 0x00, 0x00,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1305,27 +1321,27 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8e, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0x90, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x62, 0x69, 0x74, 0x73, 0x62, 0x79, 0x74, 0x65,
     0x73, 0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8f, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0x91, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x63, 0x68, 0x69, 0x70, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x90, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0x92, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x63, 0x70, 0x75, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x91, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
+    0x93, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
     0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x92, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0x94, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
     0x6d, 0x6d, 0x72, 0x5f, 0x68, 0x65, 0x6c, 0x70,
     0x65, 0x72, 0x73, 0x2e, 0x74, 0x63, 0x6c, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x93, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
+    0x95, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
     0x72, 0x65, 0x61, 0x64, 0x61, 0x62, 0x6c, 0x65,
     0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1337,11 +1353,11 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa7, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xa9, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x64, 0x65, 0x62, 0x75, 0x67, 0x5f, 0x68, 0x61,
     0x6e, 0x64, 0x6c, 0x65, 0x72, 0x2e, 0x62, 0x69,
     0x6e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8f, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0x91, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1349,15 +1365,15 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x94, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0x96, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x6d, 0x65, 0x6c, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x95, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0x97, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x90, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0x92, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1365,111 +1381,111 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa1, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xa3, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x94, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0x96, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8f, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0x91, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x96, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0x98, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x95, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0x97, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8f, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0x91, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9d, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0x9f, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x96, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0x98, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x94, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0x96, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x97, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0x99, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x69, 0x63, 0x2e, 0x74, 0x63, 0x6c, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x98, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0x9a, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x73, 0x61, 0x6d, 0x37,
     0x78, 0x31, 0x32, 0x38, 0x2e, 0x74, 0x63, 0x6c,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x99, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0x9b, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x73, 0x61, 0x6d, 0x37,
     0x78, 0x32, 0x35, 0x36, 0x2e, 0x74, 0x63, 0x6c,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9a, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
+    0x9c, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
     0x70, 0x6d, 0x63, 0x2e, 0x74, 0x63, 0x6c, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9b, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0x9d, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
     0x72, 0x74, 0x74, 0x2e, 0x74, 0x63, 0x6c, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9c, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
+    0x9e, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
     0x75, 0x73, 0x61, 0x72, 0x74, 0x73, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9d, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0x9f, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x95, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0x97, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9e, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xa0, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x2e, 0x74, 0x63,
     0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9f, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0xa1, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x5f, 0x72, 0x63,
     0x63, 0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa0, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0xa2, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x5f, 0x72, 0x65,
     0x67, 0x73, 0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa1, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0xa3, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x90, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0x92, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa2, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xa4, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x37, 0x74, 0x64, 0x6d, 0x69,
     0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa3, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0xa5, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x39, 0x32, 0x30, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa4, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0xa6, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x39, 0x34, 0x36, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa5, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
+    0xa7, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x39, 0x36, 0x36, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa6, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0xa8, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
     0x63, 0x6f, 0x72, 0x74, 0x65, 0x78, 0x5f, 0x6d,
     0x33, 0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -25829,10 +25845,18 @@
     0x50, 0x20, 0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72,
     0x20, 0x6f, 0x66, 0x20, 0x5a, 0x59, 0x31, 0x30,
     0x30, 0x30, 0x20, 0x75, 0x6e, 0x69, 0x74, 0x22,
-    0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x0a, 0x0a, 0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20,
+    0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x66,
+    0x6c, 0x61, 0x73, 0x68, 0x20, 0x7b, 0x7d, 0x20,
+    0x7b, 0x0a, 0x09, 0x73, 0x65, 0x74, 0x20, 0x74,
+    0x20, 0x5b, 0x6c, 0x69, 0x6e, 0x64, 0x65, 0x78,
+    0x20, 0x30, 0x20, 0x5b, 0x6f, 0x63, 0x64, 0x5f,
+    0x66, 0x6c, 0x61, 0x73, 0x68, 0x5f, 0x62, 0x61,
+    0x6e, 0x6b, 0x73, 0x5d, 0x5d, 0x0a, 0x09, 0x72,
+    0x65, 0x74, 0x75, 0x72, 0x6e, 0x20, 0x24, 0x74,
+    0x28, 0x62, 0x61, 0x73, 0x65, 0x29, 0x0a, 0x7d,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -43411,124 +43435,124 @@
     0x63, 0x61, 0x6e, 0x74, 0x6f, 0x6f, 0x6c, 0x73,
     0x2e, 0x63, 0x6f, 0x6d, 0x0d, 0x0a, 0x0d, 0x0a,
     0x73, 0x6f, 0x75, 0x72, 0x63, 0x65, 0x20, 0x5b,
-    0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x2f, 0x73,
-    0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x5f, 0x73,
-    0x33, 0x63, 0x32, 0x34, 0x31, 0x30, 0x2e, 0x63,
-    0x66, 0x67, 0x5d, 0x0d, 0x0a, 0x0d, 0x0a, 0x24,
-    0x5f, 0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e,
-    0x41, 0x4d, 0x45, 0x20, 0x63, 0x6f, 0x6e, 0x66,
-    0x69, 0x67, 0x75, 0x72, 0x65, 0x20, 0x2d, 0x65,
-    0x76, 0x65, 0x6e, 0x74, 0x20, 0x72, 0x65, 0x73,
-    0x65, 0x74, 0x2d, 0x69, 0x6e, 0x69, 0x74, 0x20,
-    0x7b, 0x0d, 0x0a, 0x09, 0x23, 0x20, 0x52, 0x65,
-    0x73, 0x65, 0x74, 0x20, 0x53, 0x63, 0x72, 0x69,
-    0x70, 0x74, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x74,
-    0x68, 0x65, 0x20, 0x54, 0x69, 0x6e, 0x43, 0x61,
-    0x6e, 0x54, 0x6f, 0x6f, 0x6c, 0x73, 0x20, 0x53,
-    0x33, 0x43, 0x32, 0x34, 0x31, 0x30, 0x20, 0x42,
-    0x61, 0x73, 0x65, 0x64, 0x20, 0x48, 0x61, 0x6d,
-    0x6d, 0x65, 0x72, 0x20, 0x4d, 0x6f, 0x64, 0x75,
-    0x6c, 0x65, 0x0d, 0x0a, 0x09, 0x23, 0x20, 0x68,
-    0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x77, 0x77,
-    0x77, 0x2e, 0x74, 0x69, 0x6e, 0x63, 0x61, 0x6e,
-    0x74, 0x6f, 0x6f, 0x6c, 0x73, 0x2e, 0x63, 0x6f,
-    0x6d, 0x0d, 0x0a, 0x09, 0x23, 0x0d, 0x0a, 0x09,
-    0x23, 0x20, 0x53, 0x65, 0x74, 0x75, 0x70, 0x20,
-    0x70, 0x72, 0x69, 0x6d, 0x61, 0x72, 0x79, 0x20,
-    0x63, 0x6c, 0x6f, 0x63, 0x6b, 0x73, 0x20, 0x61,
-    0x6e, 0x64, 0x20, 0x69, 0x6e, 0x69, 0x74, 0x69,
-    0x61, 0x6c, 0x69, 0x7a, 0x65, 0x20, 0x74, 0x68,
-    0x65, 0x20, 0x53, 0x44, 0x52, 0x41, 0x4d, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x35, 0x33, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x34, 0x61, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x38, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x34, 0x61, 0x30, 0x30, 0x30, 0x30, 0x30, 0x63,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x37, 0x66, 0x66, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x34, 0x63, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x34, 0x63, 0x30, 0x30, 0x30, 0x30, 0x31, 0x34,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x33, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x34, 0x63, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x34, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x30, 0x61, 0x31, 0x30, 0x33, 0x31, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x20, 0x30, 0x78, 0x31, 0x31, 0x31, 0x31, 0x31,
-    0x31, 0x32, 0x32, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x34, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x37, 0x30, 0x30, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x30, 0x38,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x37, 0x30, 0x30, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x63, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x37, 0x30, 0x30, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x31, 0x30,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x37, 0x30, 0x30, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30, 0x30,
-    0x30, 0x30, 0x31, 0x34, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x37, 0x30, 0x30, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x31, 0x38,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x37, 0x30, 0x30, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30, 0x30,
-    0x30, 0x30, 0x31, 0x63, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x30, 0x31, 0x38, 0x30, 0x30, 0x35, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x32, 0x30,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x31, 0x38,
-    0x30, 0x30, 0x35, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30, 0x30,
-    0x30, 0x30, 0x32, 0x34, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x39, 0x63, 0x30, 0x34, 0x35, 0x39, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x32, 0x38,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x30, 0x62, 0x32, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30, 0x30,
-    0x30, 0x30, 0x32, 0x63, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x30, 0x33, 0x30, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x33, 0x30,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x30, 0x33, 0x30, 0x0d, 0x0a, 0x09, 0x66, 0x6c,
-    0x61, 0x73, 0x68, 0x20, 0x70, 0x72, 0x6f, 0x62,
-    0x65, 0x20, 0x30, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x66, 0x6c, 0x61,
-    0x73, 0x68, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69,
-    0x67, 0x75, 0x72, 0x61, 0x74, 0x69, 0x6f, 0x6e,
-    0x0d, 0x0a, 0x23, 0x66, 0x6c, 0x61, 0x73, 0x68,
-    0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x3c, 0x64,
-    0x72, 0x69, 0x76, 0x65, 0x72, 0x3e, 0x20, 0x3c,
-    0x62, 0x61, 0x73, 0x65, 0x3e, 0x20, 0x3c, 0x73,
-    0x69, 0x7a, 0x65, 0x3e, 0x20, 0x3c, 0x63, 0x68,
-    0x69, 0x70, 0x5f, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3e, 0x20, 0x3c, 0x62, 0x75, 0x73, 0x5f, 0x77,
-    0x69, 0x64, 0x74, 0x68, 0x3e, 0x20, 0x5b, 0x64,
-    0x72, 0x69, 0x76, 0x65, 0x72, 0x5f, 0x6f, 0x70,
-    0x74, 0x69, 0x6f, 0x6e, 0x73, 0x20, 0x2e, 0x2e,
-    0x2e, 0x5d, 0x0d, 0x0a, 0x66, 0x6c, 0x61, 0x73,
-    0x68, 0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x63,
-    0x66, 0x69, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30,
+    0x66, 0x69, 0x6e, 0x64, 0x20, 0x74, 0x61, 0x72,
+    0x67, 0x65, 0x74, 0x2f, 0x73, 0x61, 0x6d, 0x73,
+    0x75, 0x6e, 0x67, 0x5f, 0x73, 0x33, 0x63, 0x32,
+    0x34, 0x31, 0x30, 0x2e, 0x63, 0x66, 0x67, 0x5d,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x24, 0x5f, 0x54, 0x41,
+    0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45,
+    0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75,
+    0x72, 0x65, 0x20, 0x2d, 0x65, 0x76, 0x65, 0x6e,
+    0x74, 0x20, 0x72, 0x65, 0x73, 0x65, 0x74, 0x2d,
+    0x69, 0x6e, 0x69, 0x74, 0x20, 0x7b, 0x0d, 0x0a,
+    0x09, 0x23, 0x20, 0x52, 0x65, 0x73, 0x65, 0x74,
+    0x20, 0x53, 0x63, 0x72, 0x69, 0x70, 0x74, 0x20,
+    0x66, 0x6f, 0x72, 0x20, 0x74, 0x68, 0x65, 0x20,
+    0x54, 0x69, 0x6e, 0x43, 0x61, 0x6e, 0x54, 0x6f,
+    0x6f, 0x6c, 0x73, 0x20, 0x53, 0x33, 0x43, 0x32,
+    0x34, 0x31, 0x30, 0x20, 0x42, 0x61, 0x73, 0x65,
+    0x64, 0x20, 0x48, 0x61, 0x6d, 0x6d, 0x65, 0x72,
+    0x20, 0x4d, 0x6f, 0x64, 0x75, 0x6c, 0x65, 0x0d,
+    0x0a, 0x09, 0x23, 0x20, 0x68, 0x74, 0x74, 0x70,
+    0x3a, 0x2f, 0x2f, 0x77, 0x77, 0x77, 0x2e, 0x74,
+    0x69, 0x6e, 0x63, 0x61, 0x6e, 0x74, 0x6f, 0x6f,
+    0x6c, 0x73, 0x2e, 0x63, 0x6f, 0x6d, 0x0d, 0x0a,
+    0x09, 0x23, 0x0d, 0x0a, 0x09, 0x23, 0x20, 0x53,
+    0x65, 0x74, 0x75, 0x70, 0x20, 0x70, 0x72, 0x69,
+    0x6d, 0x61, 0x72, 0x79, 0x20, 0x63, 0x6c, 0x6f,
+    0x63, 0x6b, 0x73, 0x20, 0x61, 0x6e, 0x64, 0x20,
+    0x69, 0x6e, 0x69, 0x74, 0x69, 0x61, 0x6c, 0x69,
+    0x7a, 0x65, 0x20, 0x74, 0x68, 0x65, 0x20, 0x53,
+    0x44, 0x52, 0x41, 0x4d, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x35, 0x33, 0x30,
     0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x78,
-    0x31, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x20,
-    0x32, 0x20, 0x32, 0x20, 0x30, 0x0d, 0x0a, 0x00,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x34, 0x61, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x38, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66,
+    0x66, 0x66, 0x66, 0x66, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x34, 0x61, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x63, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x37, 0x66, 0x66,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x34, 0x63, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x20, 0x30, 0x78, 0x30, 0x30, 0x66, 0x66,
+    0x66, 0x66, 0x66, 0x66, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x34, 0x63, 0x30,
+    0x30, 0x30, 0x30, 0x31, 0x34, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x33,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x34, 0x63, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x34, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x61,
+    0x31, 0x30, 0x33, 0x31, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x78,
+    0x31, 0x31, 0x31, 0x31, 0x31, 0x31, 0x32, 0x32,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x34, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x37, 0x30, 0x30, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x38, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x37, 0x30, 0x30,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x63, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x37, 0x30, 0x30, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30,
+    0x30, 0x30, 0x30, 0x31, 0x30, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x37, 0x30, 0x30,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x31,
+    0x34, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x37, 0x30, 0x30, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30,
+    0x30, 0x30, 0x30, 0x31, 0x38, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x37, 0x30, 0x30,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x31,
+    0x63, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x31,
+    0x38, 0x30, 0x30, 0x35, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30,
+    0x30, 0x30, 0x30, 0x32, 0x30, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x30, 0x31, 0x38, 0x30, 0x30, 0x35,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x32,
+    0x34, 0x20, 0x30, 0x78, 0x30, 0x30, 0x39, 0x63,
+    0x30, 0x34, 0x35, 0x39, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30,
+    0x30, 0x30, 0x30, 0x32, 0x38, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x62, 0x32,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x34, 0x38, 0x30, 0x30, 0x30, 0x30, 0x32,
+    0x63, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x33, 0x30, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x34, 0x38, 0x30,
+    0x30, 0x30, 0x30, 0x33, 0x30, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x33, 0x30,
+    0x0d, 0x0a, 0x09, 0x66, 0x6c, 0x61, 0x73, 0x68,
+    0x20, 0x70, 0x72, 0x6f, 0x62, 0x65, 0x20, 0x30,
+    0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x23, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x20,
+    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75, 0x72,
+    0x61, 0x74, 0x69, 0x6f, 0x6e, 0x0d, 0x0a, 0x23,
+    0x66, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x62, 0x61,
+    0x6e, 0x6b, 0x20, 0x3c, 0x64, 0x72, 0x69, 0x76,
+    0x65, 0x72, 0x3e, 0x20, 0x3c, 0x62, 0x61, 0x73,
+    0x65, 0x3e, 0x20, 0x3c, 0x73, 0x69, 0x7a, 0x65,
+    0x3e, 0x20, 0x3c, 0x63, 0x68, 0x69, 0x70, 0x5f,
+    0x77, 0x69, 0x64, 0x74, 0x68, 0x3e, 0x20, 0x3c,
+    0x62, 0x75, 0x73, 0x5f, 0x77, 0x69, 0x64, 0x74,
+    0x68, 0x3e, 0x20, 0x5b, 0x64, 0x72, 0x69, 0x76,
+    0x65, 0x72, 0x5f, 0x6f, 0x70, 0x74, 0x69, 0x6f,
+    0x6e, 0x73, 0x20, 0x2e, 0x2e, 0x2e, 0x5d, 0x0d,
+    0x0a, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x62,
+    0x61, 0x6e, 0x6b, 0x20, 0x63, 0x66, 0x69, 0x20,
+    0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x20, 0x30, 0x78, 0x31, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x20, 0x32, 0x20, 0x32,
+    0x20, 0x30, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x54, 0x68, 0x65, 0x20, 0x49, 0x41,
     0x52, 0x20, 0x73, 0x74, 0x72, 0x39, 0x31, 0x32,
     0x2d, 0x73, 0x6b, 0x20, 0x65, 0x76, 0x61, 0x6c,
@@ -51141,71 +51165,71 @@
     0x44, 0x49, 0x41, 0x4e, 0x20, 0x2d, 0x63, 0x68,
     0x61, 0x69, 0x6e, 0x2d, 0x70, 0x6f, 0x73, 0x69,
     0x74, 0x69, 0x6f, 0x6e, 0x20, 0x24, 0x5f, 0x54,
-    0x41, 0x52, 0x47, 0x45, 0x4e, 0x41, 0x4d, 0x45,
-    0x20, 0x2d, 0x76, 0x61, 0x72, 0x69, 0x61, 0x6e,
-    0x74, 0x20, 0x61, 0x72, 0x6d, 0x37, 0x74, 0x64,
-    0x6d, 0x69, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x24, 0x5f, 0x54, 0x41, 0x52, 0x47, 0x45, 0x54,
-    0x4e, 0x41, 0x4d, 0x45, 0x20, 0x63, 0x6f, 0x6e,
-    0x66, 0x69, 0x67, 0x75, 0x72, 0x65, 0x20, 0x2d,
-    0x65, 0x76, 0x65, 0x6e, 0x74, 0x20, 0x67, 0x64,
-    0x62, 0x2d, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x2d,
-    0x65, 0x72, 0x61, 0x73, 0x65, 0x2d, 0x73, 0x74,
-    0x61, 0x72, 0x74, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
-    0x77, 0x61, 0x69, 0x74, 0x5f, 0x68, 0x61, 0x6c,
-    0x74, 0x0d, 0x0a, 0x09, 0x73, 0x6c, 0x65, 0x65,
-    0x70, 0x20, 0x31, 0x30, 0x0d, 0x0a, 0x09, 0x70,
-    0x6f, 0x6c, 0x6c, 0x0d, 0x0a, 0x09, 0x23, 0x20,
-    0x45, 0x74, 0x68, 0x65, 0x72, 0x6e, 0x75, 0x74,
-    0x20, 0x33, 0x20, 0x72, 0x65, 0x6d, 0x61, 0x70,
-    0x70, 0x69, 0x6e, 0x67, 0x20, 0x69, 0x73, 0x20,
-    0x72, 0x65, 0x71, 0x75, 0x69, 0x72, 0x65, 0x64,
-    0x20, 0x74, 0x6f, 0x20, 0x61, 0x63, 0x63, 0x65,
-    0x73, 0x73, 0x20, 0x65, 0x78, 0x74, 0x65, 0x72,
-    0x6e, 0x61, 0x6c, 0x20, 0x66, 0x6c, 0x61, 0x73,
-    0x68, 0x20, 0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79,
-    0x2e, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20,
-    0x30, 0x78, 0x66, 0x66, 0x65, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x20, 0x30, 0x78, 0x31, 0x30, 0x30,
-    0x30, 0x32, 0x31, 0x33, 0x64, 0x0d, 0x0a, 0x09,
-    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
-    0x65, 0x30, 0x30, 0x30, 0x30, 0x34, 0x20, 0x30,
-    0x78, 0x32, 0x30, 0x30, 0x30, 0x33, 0x65, 0x33,
-    0x64, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20,
-    0x30, 0x78, 0x66, 0x66, 0x65, 0x30, 0x30, 0x30,
-    0x32, 0x30, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x31, 0x0d, 0x0a, 0x7d,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x24, 0x5f, 0x54, 0x41,
-    0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45,
+    0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d,
+    0x45, 0x20, 0x2d, 0x76, 0x61, 0x72, 0x69, 0x61,
+    0x6e, 0x74, 0x20, 0x61, 0x72, 0x6d, 0x37, 0x74,
+    0x64, 0x6d, 0x69, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x24, 0x5f, 0x54, 0x41, 0x52, 0x47, 0x45,
+    0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20, 0x63, 0x6f,
+    0x6e, 0x66, 0x69, 0x67, 0x75, 0x72, 0x65, 0x20,
+    0x2d, 0x65, 0x76, 0x65, 0x6e, 0x74, 0x20, 0x67,
+    0x64, 0x62, 0x2d, 0x66, 0x6c, 0x61, 0x73, 0x68,
+    0x2d, 0x65, 0x72, 0x61, 0x73, 0x65, 0x2d, 0x73,
+    0x74, 0x61, 0x72, 0x74, 0x20, 0x7b, 0x0d, 0x0a,
+    0x09, 0x77, 0x61, 0x69, 0x74, 0x5f, 0x68, 0x61,
+    0x6c, 0x74, 0x0d, 0x0a, 0x09, 0x73, 0x6c, 0x65,
+    0x65, 0x70, 0x20, 0x31, 0x30, 0x0d, 0x0a, 0x09,
+    0x70, 0x6f, 0x6c, 0x6c, 0x0d, 0x0a, 0x09, 0x23,
+    0x20, 0x45, 0x74, 0x68, 0x65, 0x72, 0x6e, 0x75,
+    0x74, 0x20, 0x33, 0x20, 0x72, 0x65, 0x6d, 0x61,
+    0x70, 0x70, 0x69, 0x6e, 0x67, 0x20, 0x69, 0x73,
+    0x20, 0x72, 0x65, 0x71, 0x75, 0x69, 0x72, 0x65,
+    0x64, 0x20, 0x74, 0x6f, 0x20, 0x61, 0x63, 0x63,
+    0x65, 0x73, 0x73, 0x20, 0x65, 0x78, 0x74, 0x65,
+    0x72, 0x6e, 0x61, 0x6c, 0x20, 0x66, 0x6c, 0x61,
+    0x73, 0x68, 0x20, 0x6d, 0x65, 0x6d, 0x6f, 0x72,
+    0x79, 0x2e, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x66, 0x66, 0x65, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x20, 0x30, 0x78, 0x31, 0x30,
+    0x30, 0x30, 0x32, 0x31, 0x33, 0x64, 0x0d, 0x0a,
+    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
+    0x66, 0x65, 0x30, 0x30, 0x30, 0x30, 0x34, 0x20,
+    0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x33, 0x65,
+    0x33, 0x64, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x66, 0x66, 0x65, 0x30, 0x30,
+    0x30, 0x32, 0x30, 0x20, 0x30, 0x78, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x31, 0x0d, 0x0a,
+    0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x24, 0x5f, 0x54,
+    0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d,
+    0x45, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
+    0x75, 0x72, 0x65, 0x20, 0x2d, 0x77, 0x6f, 0x72,
+    0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x76,
+    0x69, 0x72, 0x74, 0x20, 0x30, 0x20, 0x2d, 0x77,
+    0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61,
+    0x2d, 0x70, 0x68, 0x79, 0x73, 0x20, 0x30, 0x78,
+    0x33, 0x43, 0x30, 0x30, 0x30, 0x20, 0x2d, 0x77,
+    0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61,
+    0x2d, 0x73, 0x69, 0x7a, 0x65, 0x20, 0x30, 0x78,
+    0x34, 0x30, 0x30, 0x30, 0x20, 0x2d, 0x77, 0x6f,
+    0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d,
+    0x62, 0x61, 0x63, 0x6b, 0x75, 0x70, 0x20, 0x30,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x66, 0x6c, 0x61, 0x73,
+    0x68, 0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x63,
+    0x66, 0x69, 0x20, 0x30, 0x78, 0x31, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x78,
+    0x34, 0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x32,
+    0x20, 0x32, 0x20, 0x30, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x23, 0x20, 0x46, 0x6f, 0x72, 0x20, 0x6d, 0x6f,
+    0x72, 0x65, 0x20, 0x69, 0x6e, 0x66, 0x6f, 0x72,
+    0x6d, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x61,
+    0x62, 0x6f, 0x75, 0x74, 0x20, 0x74, 0x68, 0x65,
     0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75,
-    0x72, 0x65, 0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b,
-    0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x76, 0x69,
-    0x72, 0x74, 0x20, 0x30, 0x20, 0x2d, 0x77, 0x6f,
-    0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d,
-    0x70, 0x68, 0x79, 0x73, 0x20, 0x30, 0x78, 0x33,
-    0x43, 0x30, 0x30, 0x30, 0x20, 0x2d, 0x77, 0x6f,
-    0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d,
-    0x73, 0x69, 0x7a, 0x65, 0x20, 0x30, 0x78, 0x34,
-    0x30, 0x30, 0x30, 0x20, 0x2d, 0x77, 0x6f, 0x72,
-    0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x62,
-    0x61, 0x63, 0x6b, 0x75, 0x70, 0x20, 0x30, 0x0d,
-    0x0a, 0x0d, 0x0a, 0x66, 0x6c, 0x61, 0x73, 0x68,
-    0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x63, 0x66,
-    0x69, 0x20, 0x30, 0x78, 0x31, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x78, 0x34,
-    0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x32, 0x20,
-    0x32, 0x20, 0x30, 0x0d, 0x0a, 0x0d, 0x0a, 0x23,
-    0x20, 0x46, 0x6f, 0x72, 0x20, 0x6d, 0x6f, 0x72,
-    0x65, 0x20, 0x69, 0x6e, 0x66, 0x6f, 0x72, 0x6d,
-    0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x61, 0x62,
-    0x6f, 0x75, 0x74, 0x20, 0x74, 0x68, 0x65, 0x20,
-    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75, 0x72,
-    0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x66, 0x69,
-    0x6c, 0x65, 0x73, 0x2c, 0x20, 0x74, 0x61, 0x6b,
-    0x65, 0x20, 0x61, 0x20, 0x6c, 0x6f, 0x6f, 0x6b,
-    0x20, 0x61, 0x74, 0x3a, 0x0d, 0x0a, 0x23, 0x20,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x2e,
-    0x74, 0x65, 0x78, 0x69, 0x0d, 0x0a, 0x00, 0x00,
+    0x72, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x66,
+    0x69, 0x6c, 0x65, 0x73, 0x2c, 0x20, 0x74, 0x61,
+    0x6b, 0x65, 0x20, 0x61, 0x20, 0x6c, 0x6f, 0x6f,
+    0x6b, 0x20, 0x61, 0x74, 0x3a, 0x0d, 0x0a, 0x23,
+    0x20, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
+    0x2e, 0x74, 0x65, 0x78, 0x69, 0x0d, 0x0a, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -51445,365 +51469,365 @@
     0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
     0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x0d, 0x0a,
     0x0d, 0x0a, 0x24, 0x5f, 0x54, 0x41, 0x52, 0x47,
-    0x45, 0x54, 0x5f, 0x4e, 0x41, 0x4d, 0x45, 0x20,
-    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75, 0x72,
-    0x65, 0x20, 0x2d, 0x65, 0x76, 0x65, 0x6e, 0x74,
-    0x20, 0x72, 0x65, 0x73, 0x65, 0x74, 0x2d, 0x69,
-    0x6e, 0x69, 0x74, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
-    0x23, 0x20, 0x61, 0x74, 0x20, 0x72, 0x65, 0x73,
-    0x65, 0x74, 0x20, 0x63, 0x68, 0x69, 0x70, 0x20,
-    0x72, 0x75, 0x6e, 0x73, 0x20, 0x61, 0x74, 0x20,
-    0x33, 0x32, 0x6b, 0x68, 0x7a, 0x0d, 0x0a, 0x09,
-    0x6a, 0x74, 0x61, 0x67, 0x5f, 0x6b, 0x68, 0x7a,
-    0x20, 0x38, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
-    0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x66,
-    0x64, 0x30, 0x38, 0x20, 0x30, 0x78, 0x61, 0x35,
-    0x30, 0x30, 0x30, 0x35, 0x30, 0x31, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23,
-    0x20, 0x52, 0x53, 0x54, 0x43, 0x5f, 0x4d, 0x52,
-    0x20, 0x3a, 0x20, 0x65, 0x6e, 0x61, 0x62, 0x6c,
-    0x65, 0x20, 0x75, 0x73, 0x65, 0x72, 0x20, 0x72,
-    0x65, 0x73, 0x65, 0x74, 0x0d, 0x0a, 0x09, 0x6d,
-    0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66,
-    0x66, 0x66, 0x64, 0x34, 0x34, 0x20, 0x30, 0x78,
-    0x30, 0x30, 0x30, 0x30, 0x38, 0x30, 0x30, 0x30,
+    0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20, 0x63,
+    0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75, 0x72, 0x65,
+    0x20, 0x2d, 0x65, 0x76, 0x65, 0x6e, 0x74, 0x20,
+    0x72, 0x65, 0x73, 0x65, 0x74, 0x2d, 0x69, 0x6e,
+    0x69, 0x74, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x23,
+    0x20, 0x61, 0x74, 0x20, 0x72, 0x65, 0x73, 0x65,
+    0x74, 0x20, 0x63, 0x68, 0x69, 0x70, 0x20, 0x72,
+    0x75, 0x6e, 0x73, 0x20, 0x61, 0x74, 0x20, 0x33,
+    0x32, 0x6b, 0x68, 0x7a, 0x0d, 0x0a, 0x09, 0x6a,
+    0x74, 0x61, 0x67, 0x5f, 0x6b, 0x68, 0x7a, 0x20,
+    0x38, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20,
+    0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x66, 0x64,
+    0x30, 0x38, 0x20, 0x30, 0x78, 0x61, 0x35, 0x30,
+    0x30, 0x30, 0x35, 0x30, 0x31, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20,
+    0x52, 0x53, 0x54, 0x43, 0x5f, 0x4d, 0x52, 0x20,
+    0x3a, 0x20, 0x65, 0x6e, 0x61, 0x62, 0x6c, 0x65,
+    0x20, 0x75, 0x73, 0x65, 0x72, 0x20, 0x72, 0x65,
+    0x73, 0x65, 0x74, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
+    0x77, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66,
+    0x66, 0x64, 0x34, 0x34, 0x20, 0x30, 0x78, 0x30,
+    0x30, 0x30, 0x30, 0x38, 0x30, 0x30, 0x30, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x23, 0x20, 0x57, 0x44, 0x54, 0x5f, 0x4d,
-    0x52, 0x20, 0x3a, 0x20, 0x64, 0x69, 0x73, 0x61,
-    0x62, 0x6c, 0x65, 0x20, 0x77, 0x61, 0x74, 0x63,
-    0x68, 0x64, 0x6f, 0x67, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x66, 0x63, 0x32, 0x30, 0x20,
-    0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x34, 0x30,
-    0x30, 0x31, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x23, 0x20, 0x43, 0x4b, 0x47,
-    0x52, 0x5f, 0x4d, 0x4f, 0x52, 0x20, 0x3a, 0x20,
-    0x65, 0x6e, 0x61, 0x62, 0x6c, 0x65, 0x20, 0x74,
-    0x68, 0x65, 0x20, 0x6d, 0x61, 0x69, 0x6e, 0x20,
-    0x6f, 0x73, 0x63, 0x69, 0x6c, 0x6c, 0x61, 0x74,
-    0x6f, 0x72, 0x0d, 0x0a, 0x09, 0x73, 0x6c, 0x65,
-    0x65, 0x70, 0x20, 0x32, 0x30, 0x20, 0x20, 0x20,
+    0x23, 0x20, 0x57, 0x44, 0x54, 0x5f, 0x4d, 0x52,
+    0x20, 0x3a, 0x20, 0x64, 0x69, 0x73, 0x61, 0x62,
+    0x6c, 0x65, 0x20, 0x77, 0x61, 0x74, 0x63, 0x68,
+    0x64, 0x6f, 0x67, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x66, 0x63, 0x32, 0x30, 0x20, 0x30,
+    0x78, 0x30, 0x30, 0x30, 0x30, 0x34, 0x30, 0x30,
+    0x31, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x23, 0x20, 0x43, 0x4b, 0x47, 0x52,
+    0x5f, 0x4d, 0x4f, 0x52, 0x20, 0x3a, 0x20, 0x65,
+    0x6e, 0x61, 0x62, 0x6c, 0x65, 0x20, 0x74, 0x68,
+    0x65, 0x20, 0x6d, 0x61, 0x69, 0x6e, 0x20, 0x6f,
+    0x73, 0x63, 0x69, 0x6c, 0x6c, 0x61, 0x74, 0x6f,
+    0x72, 0x0d, 0x0a, 0x09, 0x73, 0x6c, 0x65, 0x65,
+    0x70, 0x20, 0x32, 0x30, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20,
+    0x77, 0x61, 0x69, 0x74, 0x20, 0x32, 0x30, 0x20,
+    0x6d, 0x73, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x66,
+    0x63, 0x33, 0x30, 0x20, 0x30, 0x78, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x31, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23,
-    0x20, 0x77, 0x61, 0x69, 0x74, 0x20, 0x32, 0x30,
-    0x20, 0x6d, 0x73, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66,
-    0x66, 0x63, 0x33, 0x30, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x31, 0x20,
+    0x20, 0x50, 0x4d, 0x43, 0x5f, 0x4d, 0x43, 0x4b,
+    0x52, 0x20, 0x3a, 0x20, 0x73, 0x77, 0x69, 0x74,
+    0x63, 0x68, 0x20, 0x74, 0x6f, 0x20, 0x6d, 0x61,
+    0x69, 0x6e, 0x20, 0x6f, 0x73, 0x63, 0x69, 0x6c,
+    0x6c, 0x61, 0x74, 0x6f, 0x72, 0x0d, 0x0a, 0x09,
+    0x73, 0x6c, 0x65, 0x65, 0x70, 0x20, 0x31, 0x30,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x23, 0x20, 0x50, 0x4d, 0x43, 0x5f, 0x4d, 0x43,
-    0x4b, 0x52, 0x20, 0x3a, 0x20, 0x73, 0x77, 0x69,
-    0x74, 0x63, 0x68, 0x20, 0x74, 0x6f, 0x20, 0x6d,
-    0x61, 0x69, 0x6e, 0x20, 0x6f, 0x73, 0x63, 0x69,
-    0x6c, 0x6c, 0x61, 0x74, 0x6f, 0x72, 0x0d, 0x0a,
-    0x09, 0x73, 0x6c, 0x65, 0x65, 0x70, 0x20, 0x31,
-    0x30, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x23, 0x20, 0x77, 0x61, 0x69,
-    0x74, 0x20, 0x31, 0x30, 0x20, 0x6d, 0x73, 0x0d,
-    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
-    0x66, 0x66, 0x66, 0x66, 0x66, 0x63, 0x32, 0x38,
-    0x20, 0x30, 0x78, 0x32, 0x30, 0x36, 0x30, 0x62,
-    0x66, 0x30, 0x39, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x43, 0x4b,
-    0x47, 0x52, 0x5f, 0x50, 0x4c, 0x4c, 0x41, 0x52,
-    0x3a, 0x20, 0x53, 0x65, 0x74, 0x20, 0x50, 0x4c,
-    0x4c, 0x41, 0x20, 0x52, 0x65, 0x67, 0x69, 0x73,
-    0x74, 0x65, 0x72, 0x20, 0x66, 0x6f, 0x72, 0x20,
-    0x31, 0x39, 0x38, 0x2c, 0x36, 0x35, 0x36, 0x4d,
-    0x48, 0x7a, 0x0d, 0x0a, 0x09, 0x73, 0x6c, 0x65,
-    0x65, 0x70, 0x20, 0x32, 0x30, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x23, 0x20, 0x77, 0x61, 0x69, 0x74,
+    0x20, 0x31, 0x30, 0x20, 0x6d, 0x73, 0x0d, 0x0a,
+    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
+    0x66, 0x66, 0x66, 0x66, 0x63, 0x32, 0x38, 0x20,
+    0x30, 0x78, 0x32, 0x30, 0x36, 0x30, 0x62, 0x66,
+    0x30, 0x39, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x23, 0x20, 0x43, 0x4b, 0x47,
+    0x52, 0x5f, 0x50, 0x4c, 0x4c, 0x41, 0x52, 0x3a,
+    0x20, 0x53, 0x65, 0x74, 0x20, 0x50, 0x4c, 0x4c,
+    0x41, 0x20, 0x52, 0x65, 0x67, 0x69, 0x73, 0x74,
+    0x65, 0x72, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x31,
+    0x39, 0x38, 0x2c, 0x36, 0x35, 0x36, 0x4d, 0x48,
+    0x7a, 0x0d, 0x0a, 0x09, 0x73, 0x6c, 0x65, 0x65,
+    0x70, 0x20, 0x32, 0x30, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20,
+    0x77, 0x61, 0x69, 0x74, 0x20, 0x32, 0x30, 0x20,
+    0x6d, 0x73, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x66,
+    0x63, 0x33, 0x30, 0x20, 0x30, 0x78, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x31, 0x30, 0x31, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23,
-    0x20, 0x77, 0x61, 0x69, 0x74, 0x20, 0x32, 0x30,
-    0x20, 0x6d, 0x73, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66,
-    0x66, 0x63, 0x33, 0x30, 0x20, 0x30, 0x78, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x31, 0x30, 0x31, 0x20,
+    0x20, 0x50, 0x4d, 0x43, 0x5f, 0x4d, 0x43, 0x4b,
+    0x52, 0x20, 0x3a, 0x20, 0x53, 0x65, 0x6c, 0x65,
+    0x63, 0x74, 0x20, 0x70, 0x72, 0x65, 0x73, 0x63,
+    0x61, 0x6c, 0x65, 0x72, 0x0d, 0x0a, 0x09, 0x73,
+    0x6c, 0x65, 0x65, 0x70, 0x20, 0x31, 0x30, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x23, 0x20, 0x50, 0x4d, 0x43, 0x5f, 0x4d, 0x43,
-    0x4b, 0x52, 0x20, 0x3a, 0x20, 0x53, 0x65, 0x6c,
-    0x65, 0x63, 0x74, 0x20, 0x70, 0x72, 0x65, 0x73,
-    0x63, 0x61, 0x6c, 0x65, 0x72, 0x0d, 0x0a, 0x09,
-    0x73, 0x6c, 0x65, 0x65, 0x70, 0x20, 0x31, 0x30,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x23, 0x20, 0x77, 0x61, 0x69, 0x74, 0x20,
+    0x31, 0x30, 0x20, 0x6d, 0x73, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x66, 0x63, 0x33, 0x30, 0x20, 0x30,
+    0x78, 0x30, 0x30, 0x30, 0x30, 0x30, 0x31, 0x30,
+    0x32, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x23, 0x20, 0x50, 0x4d, 0x43, 0x5f,
+    0x4d, 0x43, 0x4b, 0x52, 0x20, 0x3a, 0x20, 0x43,
+    0x6c, 0x6f, 0x63, 0x6b, 0x20, 0x66, 0x72, 0x6f,
+    0x6d, 0x20, 0x50, 0x4c, 0x4c, 0x41, 0x20, 0x69,
+    0x73, 0x20, 0x73, 0x65, 0x6c, 0x65, 0x63, 0x74,
+    0x65, 0x64, 0x0d, 0x0a, 0x09, 0x73, 0x6c, 0x65,
+    0x65, 0x70, 0x20, 0x31, 0x30, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x23, 0x20, 0x77, 0x61, 0x69, 0x74,
-    0x20, 0x31, 0x30, 0x20, 0x6d, 0x73, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x66, 0x63, 0x33, 0x30, 0x20,
-    0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30, 0x31,
-    0x30, 0x32, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x23, 0x20, 0x50, 0x4d, 0x43,
-    0x5f, 0x4d, 0x43, 0x4b, 0x52, 0x20, 0x3a, 0x20,
-    0x43, 0x6c, 0x6f, 0x63, 0x6b, 0x20, 0x66, 0x72,
-    0x6f, 0x6d, 0x20, 0x50, 0x4c, 0x4c, 0x41, 0x20,
-    0x69, 0x73, 0x20, 0x73, 0x65, 0x6c, 0x65, 0x63,
-    0x74, 0x65, 0x64, 0x0d, 0x0a, 0x09, 0x73, 0x6c,
-    0x65, 0x65, 0x70, 0x20, 0x31, 0x30, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23,
+    0x20, 0x77, 0x61, 0x69, 0x74, 0x20, 0x31, 0x30,
+    0x20, 0x6d, 0x73, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
+    0x23, 0x20, 0x4e, 0x6f, 0x77, 0x20, 0x72, 0x75,
+    0x6e, 0x20, 0x61, 0x74, 0x20, 0x61, 0x6e, 0x79,
+    0x74, 0x68, 0x69, 0x6e, 0x67, 0x20, 0x66, 0x61,
+    0x73, 0x74, 0x2e, 0x2e, 0x2e, 0x20, 0x69, 0x65,
+    0x3a, 0x20, 0x31, 0x30, 0x6d, 0x68, 0x7a, 0x21,
+    0x0d, 0x0a, 0x09, 0x6a, 0x74, 0x61, 0x67, 0x5f,
+    0x6b, 0x68, 0x7a, 0x20, 0x31, 0x30, 0x30, 0x30,
+    0x30, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x23, 0x20, 0x77, 0x61, 0x69, 0x74, 0x20, 0x31,
-    0x30, 0x20, 0x6d, 0x73, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x23, 0x20, 0x4e, 0x6f, 0x77, 0x20, 0x72,
-    0x75, 0x6e, 0x20, 0x61, 0x74, 0x20, 0x61, 0x6e,
-    0x79, 0x74, 0x68, 0x69, 0x6e, 0x67, 0x20, 0x66,
-    0x61, 0x73, 0x74, 0x2e, 0x2e, 0x2e, 0x20, 0x69,
-    0x65, 0x3a, 0x20, 0x31, 0x30, 0x6d, 0x68, 0x7a,
-    0x21, 0x0d, 0x0a, 0x09, 0x6a, 0x74, 0x61, 0x67,
-    0x5f, 0x6b, 0x68, 0x7a, 0x20, 0x31, 0x30, 0x30,
-    0x30, 0x30, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20,
-    0x49, 0x6e, 0x63, 0x72, 0x65, 0x61, 0x73, 0x65,
-    0x20, 0x4a, 0x54, 0x41, 0x47, 0x20, 0x53, 0x70,
-    0x65, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x36,
-    0x20, 0x4d, 0x48, 0x7a, 0x0d, 0x0a, 0x09, 0x61,
-    0x72, 0x6d, 0x37, 0x5f, 0x39, 0x20, 0x64, 0x63,
-    0x63, 0x5f, 0x64, 0x6f, 0x77, 0x6e, 0x6c, 0x6f,
-    0x61, 0x64, 0x73, 0x20, 0x65, 0x6e, 0x61, 0x62,
-    0x6c, 0x65, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x23, 0x20, 0x45, 0x6e, 0x61, 0x62, 0x6c,
-    0x65, 0x20, 0x66, 0x61, 0x73, 0x74, 0x65, 0x72,
-    0x20, 0x44, 0x43, 0x43, 0x20, 0x64, 0x6f, 0x77,
-    0x6e, 0x6c, 0x6f, 0x61, 0x64, 0x73, 0x0d, 0x0a,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x49,
+    0x6e, 0x63, 0x72, 0x65, 0x61, 0x73, 0x65, 0x20,
+    0x4a, 0x54, 0x41, 0x47, 0x20, 0x53, 0x70, 0x65,
+    0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x36, 0x20,
+    0x4d, 0x48, 0x7a, 0x0d, 0x0a, 0x09, 0x61, 0x72,
+    0x6d, 0x37, 0x5f, 0x39, 0x20, 0x64, 0x63, 0x63,
+    0x5f, 0x64, 0x6f, 0x77, 0x6e, 0x6c, 0x6f, 0x61,
+    0x64, 0x73, 0x20, 0x65, 0x6e, 0x61, 0x62, 0x6c,
+    0x65, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x23, 0x20, 0x45, 0x6e, 0x61, 0x62, 0x6c, 0x65,
+    0x20, 0x66, 0x61, 0x73, 0x74, 0x65, 0x72, 0x20,
+    0x44, 0x43, 0x43, 0x20, 0x64, 0x6f, 0x77, 0x6e,
+    0x6c, 0x6f, 0x61, 0x64, 0x73, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
+    0x66, 0x66, 0x66, 0x66, 0x65, 0x63, 0x30, 0x30,
+    0x20, 0x30, 0x78, 0x30, 0x31, 0x30, 0x32, 0x30,
+    0x31, 0x30, 0x32, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x53, 0x4d,
+    0x43, 0x5f, 0x53, 0x45, 0x54, 0x55, 0x50, 0x30,
+    0x20, 0x3a, 0x20, 0x53, 0x65, 0x74, 0x75, 0x70,
+    0x20, 0x53, 0x4d, 0x43, 0x20, 0x66, 0x6f, 0x72,
+    0x20, 0x49, 0x6e, 0x74, 0x65, 0x6c, 0x20, 0x4e,
+    0x4f, 0x52, 0x20, 0x46, 0x6c, 0x61, 0x73, 0x68,
+    0x20, 0x4a, 0x53, 0x32, 0x38, 0x46, 0x31, 0x32,
+    0x38, 0x50, 0x33, 0x30, 0x54, 0x38, 0x35, 0x20,
+    0x31, 0x32, 0x38, 0x4d, 0x42, 0x69, 0x74, 0x0d,
+    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
+    0x66, 0x66, 0x66, 0x66, 0x65, 0x63, 0x30, 0x34,
+    0x20, 0x30, 0x78, 0x30, 0x39, 0x30, 0x37, 0x30,
+    0x38, 0x30, 0x36, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x53, 0x4d,
+    0x43, 0x5f, 0x50, 0x55, 0x4c, 0x53, 0x45, 0x30,
     0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
     0x78, 0x66, 0x66, 0x66, 0x66, 0x65, 0x63, 0x30,
-    0x30, 0x20, 0x30, 0x78, 0x30, 0x31, 0x30, 0x32,
-    0x30, 0x31, 0x30, 0x32, 0x20, 0x20, 0x20, 0x20,
+    0x38, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x64,
+    0x30, 0x30, 0x30, 0x62, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x53,
-    0x4d, 0x43, 0x5f, 0x53, 0x45, 0x54, 0x55, 0x50,
-    0x30, 0x20, 0x3a, 0x20, 0x53, 0x65, 0x74, 0x75,
-    0x70, 0x20, 0x53, 0x4d, 0x43, 0x20, 0x66, 0x6f,
-    0x72, 0x20, 0x49, 0x6e, 0x74, 0x65, 0x6c, 0x20,
-    0x4e, 0x4f, 0x52, 0x20, 0x46, 0x6c, 0x61, 0x73,
-    0x68, 0x20, 0x4a, 0x53, 0x32, 0x38, 0x46, 0x31,
-    0x32, 0x38, 0x50, 0x33, 0x30, 0x54, 0x38, 0x35,
-    0x20, 0x31, 0x32, 0x38, 0x4d, 0x42, 0x69, 0x74,
-    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
-    0x78, 0x66, 0x66, 0x66, 0x66, 0x65, 0x63, 0x30,
-    0x34, 0x20, 0x30, 0x78, 0x30, 0x39, 0x30, 0x37,
-    0x30, 0x38, 0x30, 0x36, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x53,
-    0x4d, 0x43, 0x5f, 0x50, 0x55, 0x4c, 0x53, 0x45,
+    0x4d, 0x43, 0x5f, 0x43, 0x59, 0x43, 0x4c, 0x45,
     0x30, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20,
     0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x65, 0x63,
-    0x30, 0x38, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30,
-    0x64, 0x30, 0x30, 0x30, 0x62, 0x20, 0x20, 0x20,
+    0x30, 0x63, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30,
+    0x30, 0x31, 0x30, 0x30, 0x33, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20,
-    0x53, 0x4d, 0x43, 0x5f, 0x43, 0x59, 0x43, 0x4c,
-    0x45, 0x30, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
-    0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x65,
-    0x63, 0x30, 0x63, 0x20, 0x30, 0x78, 0x30, 0x30,
-    0x30, 0x30, 0x31, 0x30, 0x30, 0x33, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23,
-    0x20, 0x53, 0x4d, 0x43, 0x5f, 0x4d, 0x4f, 0x44,
-    0x45, 0x30, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x66,
-    0x6c, 0x61, 0x73, 0x68, 0x20, 0x70, 0x72, 0x6f,
-    0x62, 0x65, 0x20, 0x30, 0x20, 0x20, 0x20, 0x20,
+    0x53, 0x4d, 0x43, 0x5f, 0x4d, 0x4f, 0x44, 0x45,
+    0x30, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x66, 0x6c,
+    0x61, 0x73, 0x68, 0x20, 0x70, 0x72, 0x6f, 0x62,
+    0x65, 0x20, 0x30, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x23, 0x20, 0x49, 0x64, 0x65, 0x6e, 0x74,
-    0x69, 0x66, 0x79, 0x20, 0x66, 0x6c, 0x61, 0x73,
-    0x68, 0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x30,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
-    0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x66,
-    0x38, 0x37, 0x30, 0x20, 0x30, 0x78, 0x66, 0x66,
-    0x66, 0x66, 0x30, 0x30, 0x30, 0x30, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23,
-    0x20, 0x50, 0x49, 0x4f, 0x5f, 0x41, 0x53, 0x52,
-    0x20, 0x3a, 0x20, 0x53, 0x65, 0x6c, 0x65, 0x63,
-    0x74, 0x20, 0x70, 0x65, 0x72, 0x69, 0x70, 0x68,
-    0x65, 0x72, 0x61, 0x6c, 0x20, 0x66, 0x75, 0x6e,
-    0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x66, 0x6f,
-    0x72, 0x20, 0x44, 0x31, 0x35, 0x2e, 0x2e, 0x44,
-    0x33, 0x31, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
-    0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x66,
-    0x38, 0x30, 0x34, 0x20, 0x30, 0x78, 0x66, 0x66,
-    0x66, 0x66, 0x30, 0x30, 0x30, 0x30, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23,
-    0x20, 0x50, 0x49, 0x4f, 0x5f, 0x50, 0x44, 0x52,
-    0x20, 0x3a, 0x20, 0x44, 0x69, 0x73, 0x61, 0x62,
-    0x6c, 0x65, 0x20, 0x50, 0x49, 0x4f, 0x20, 0x66,
-    0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20,
-    0x66, 0x6f, 0x72, 0x20, 0x44, 0x31, 0x35, 0x2e,
-    0x2e, 0x44, 0x33, 0x31, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x65, 0x66, 0x31, 0x63, 0x20,
-    0x30, 0x78, 0x32, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x23, 0x20, 0x49, 0x64, 0x65, 0x6e, 0x74, 0x69,
+    0x66, 0x79, 0x20, 0x66, 0x6c, 0x61, 0x73, 0x68,
+    0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x30, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20,
+    0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x66, 0x38,
+    0x37, 0x30, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66,
+    0x66, 0x30, 0x30, 0x30, 0x30, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20,
+    0x50, 0x49, 0x4f, 0x5f, 0x41, 0x53, 0x52, 0x20,
+    0x3a, 0x20, 0x53, 0x65, 0x6c, 0x65, 0x63, 0x74,
+    0x20, 0x70, 0x65, 0x72, 0x69, 0x70, 0x68, 0x65,
+    0x72, 0x61, 0x6c, 0x20, 0x66, 0x75, 0x6e, 0x63,
+    0x74, 0x69, 0x6f, 0x6e, 0x20, 0x66, 0x6f, 0x72,
+    0x20, 0x44, 0x31, 0x35, 0x2e, 0x2e, 0x44, 0x33,
+    0x31, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20,
+    0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x66, 0x38,
+    0x30, 0x34, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66,
+    0x66, 0x30, 0x30, 0x30, 0x30, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20,
+    0x50, 0x49, 0x4f, 0x5f, 0x50, 0x44, 0x52, 0x20,
+    0x3a, 0x20, 0x44, 0x69, 0x73, 0x61, 0x62, 0x6c,
+    0x65, 0x20, 0x50, 0x49, 0x4f, 0x20, 0x66, 0x75,
+    0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x66,
+    0x6f, 0x72, 0x20, 0x44, 0x31, 0x35, 0x2e, 0x2e,
+    0x44, 0x33, 0x31, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x65, 0x66, 0x31, 0x63, 0x20, 0x30,
+    0x78, 0x32, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x23, 0x20, 0x45, 0x42, 0x49,
-    0x5f, 0x43, 0x53, 0x41, 0x20, 0x3a, 0x20, 0x41,
-    0x73, 0x73, 0x69, 0x67, 0x6e, 0x20, 0x45, 0x42,
-    0x49, 0x20, 0x43, 0x68, 0x69, 0x70, 0x20, 0x53,
-    0x65, 0x6c, 0x65, 0x63, 0x74, 0x20, 0x31, 0x20,
-    0x74, 0x6f, 0x20, 0x53, 0x44, 0x52, 0x41, 0x4d,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x23, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66,
-    0x65, 0x61, 0x30, 0x38, 0x20, 0x30, 0x78, 0x38,
-    0x35, 0x32, 0x32, 0x37, 0x32, 0x35, 0x39, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x23, 0x20, 0x53, 0x44, 0x52, 0x41, 0x4d, 0x43,
-    0x5f, 0x43, 0x52, 0x20, 0x3a, 0x20, 0x43, 0x6f,
-    0x6e, 0x66, 0x69, 0x67, 0x75, 0x72, 0x65, 0x20,
-    0x53, 0x44, 0x52, 0x41, 0x4d, 0x20, 0x28, 0x32,
-    0x20, 0x78, 0x20, 0x53, 0x61, 0x6d, 0x73, 0x75,
-    0x6e, 0x67, 0x20, 0x4b, 0x34, 0x53, 0x35, 0x36,
-    0x31, 0x36, 0x33, 0x32, 0x48, 0x2d, 0x55, 0x43,
-    0x37, 0x35, 0x20, 0x3a, 0x20, 0x34, 0x4d, 0x20,
-    0x78, 0x20, 0x31, 0x36, 0x42, 0x69, 0x74, 0x20,
-    0x78, 0x20, 0x34, 0x20, 0x42, 0x61, 0x6e, 0x6b,
-    0x73, 0x29, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x20, 0x23, 0x20, 0x45, 0x42, 0x49, 0x5f,
+    0x43, 0x53, 0x41, 0x20, 0x3a, 0x20, 0x41, 0x73,
+    0x73, 0x69, 0x67, 0x6e, 0x20, 0x45, 0x42, 0x49,
+    0x20, 0x43, 0x68, 0x69, 0x70, 0x20, 0x53, 0x65,
+    0x6c, 0x65, 0x63, 0x74, 0x20, 0x31, 0x20, 0x74,
+    0x6f, 0x20, 0x53, 0x44, 0x52, 0x41, 0x4d, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x09, 0x23, 0x6d, 0x77, 0x77,
     0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x65,
     0x61, 0x30, 0x38, 0x20, 0x30, 0x78, 0x38, 0x35,
-    0x32, 0x32, 0x37, 0x32, 0x35, 0x34, 0x20, 0x20,
+    0x32, 0x32, 0x37, 0x32, 0x35, 0x39, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23,
     0x20, 0x53, 0x44, 0x52, 0x41, 0x4d, 0x43, 0x5f,
     0x43, 0x52, 0x20, 0x3a, 0x20, 0x43, 0x6f, 0x6e,
     0x66, 0x69, 0x67, 0x75, 0x72, 0x65, 0x20, 0x53,
     0x44, 0x52, 0x41, 0x4d, 0x20, 0x28, 0x32, 0x20,
     0x78, 0x20, 0x53, 0x61, 0x6d, 0x73, 0x75, 0x6e,
-    0x67, 0x20, 0x4b, 0x34, 0x53, 0x36, 0x34, 0x31,
+    0x67, 0x20, 0x4b, 0x34, 0x53, 0x35, 0x36, 0x31,
     0x36, 0x33, 0x32, 0x48, 0x2d, 0x55, 0x43, 0x37,
-    0x35, 0x20, 0x3a, 0x20, 0x31, 0x4d, 0x20, 0x78,
+    0x35, 0x20, 0x3a, 0x20, 0x34, 0x4d, 0x20, 0x78,
     0x20, 0x31, 0x36, 0x42, 0x69, 0x74, 0x20, 0x78,
     0x20, 0x34, 0x20, 0x42, 0x61, 0x6e, 0x6b, 0x73,
-    0x29, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
+    0x29, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20,
+    0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x65, 0x61,
+    0x30, 0x38, 0x20, 0x30, 0x78, 0x38, 0x35, 0x32,
+    0x32, 0x37, 0x32, 0x35, 0x34, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20,
+    0x53, 0x44, 0x52, 0x41, 0x4d, 0x43, 0x5f, 0x43,
+    0x52, 0x20, 0x3a, 0x20, 0x43, 0x6f, 0x6e, 0x66,
+    0x69, 0x67, 0x75, 0x72, 0x65, 0x20, 0x53, 0x44,
+    0x52, 0x41, 0x4d, 0x20, 0x28, 0x32, 0x20, 0x78,
+    0x20, 0x53, 0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67,
+    0x20, 0x4b, 0x34, 0x53, 0x36, 0x34, 0x31, 0x36,
+    0x33, 0x32, 0x48, 0x2d, 0x55, 0x43, 0x37, 0x35,
+    0x20, 0x3a, 0x20, 0x31, 0x4d, 0x20, 0x78, 0x20,
+    0x31, 0x36, 0x42, 0x69, 0x74, 0x20, 0x78, 0x20,
+    0x34, 0x20, 0x42, 0x61, 0x6e, 0x6b, 0x73, 0x29,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x65,
+    0x61, 0x30, 0x30, 0x20, 0x30, 0x78, 0x31, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23,
+    0x20, 0x53, 0x44, 0x52, 0x41, 0x4d, 0x43, 0x5f,
+    0x4d, 0x52, 0x20, 0x3a, 0x20, 0x69, 0x73, 0x73,
+    0x75, 0x65, 0x20, 0x61, 0x20, 0x4e, 0x4f, 0x50,
+    0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x61, 0x6e, 0x64,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x32, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
     0x77, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66,
-    0x65, 0x61, 0x30, 0x30, 0x20, 0x30, 0x78, 0x31,
+    0x65, 0x61, 0x30, 0x30, 0x20, 0x30, 0x78, 0x32,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x23, 0x20, 0x53, 0x44, 0x52, 0x41, 0x4d, 0x43,
     0x5f, 0x4d, 0x52, 0x20, 0x3a, 0x20, 0x69, 0x73,
-    0x73, 0x75, 0x65, 0x20, 0x61, 0x20, 0x4e, 0x4f,
-    0x50, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x61, 0x6e,
-    0x64, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20,
-    0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09, 0x6d,
-    0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66,
-    0x66, 0x65, 0x61, 0x30, 0x30, 0x20, 0x30, 0x78,
-    0x32, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x73, 0x75, 0x65, 0x20, 0x61, 0x6e, 0x20, 0x27,
+    0x41, 0x6c, 0x6c, 0x20, 0x42, 0x61, 0x6e, 0x6b,
+    0x73, 0x20, 0x50, 0x72, 0x65, 0x63, 0x68, 0x61,
+    0x72, 0x67, 0x65, 0x27, 0x20, 0x63, 0x6f, 0x6d,
+    0x6d, 0x61, 0x6e, 0x64, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d,
+    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
+    0x66, 0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30,
+    0x20, 0x30, 0x78, 0x34, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x23, 0x20, 0x53, 0x44, 0x52, 0x41, 0x4d,
-    0x43, 0x5f, 0x4d, 0x52, 0x20, 0x3a, 0x20, 0x69,
-    0x73, 0x73, 0x75, 0x65, 0x20, 0x61, 0x6e, 0x20,
-    0x27, 0x41, 0x6c, 0x6c, 0x20, 0x42, 0x61, 0x6e,
-    0x6b, 0x73, 0x20, 0x50, 0x72, 0x65, 0x63, 0x68,
-    0x61, 0x72, 0x67, 0x65, 0x27, 0x20, 0x63, 0x6f,
-    0x6d, 0x6d, 0x61, 0x6e, 0x64, 0x0d, 0x0a, 0x09,
-    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x32, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30,
-    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
-    0x78, 0x66, 0x66, 0x66, 0x66, 0x65, 0x61, 0x30,
-    0x30, 0x20, 0x30, 0x78, 0x34, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x53, 0x44,
+    0x52, 0x41, 0x4d, 0x43, 0x5f, 0x4d, 0x52, 0x20,
+    0x3a, 0x20, 0x69, 0x73, 0x73, 0x75, 0x65, 0x20,
+    0x38, 0x20, 0x78, 0x20, 0x27, 0x41, 0x75, 0x74,
+    0x6f, 0x2d, 0x52, 0x65, 0x66, 0x72, 0x65, 0x73,
+    0x68, 0x27, 0x20, 0x43, 0x6f, 0x6d, 0x6d, 0x61,
+    0x6e, 0x64, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20, 0x30,
+    0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20, 0x30,
+    0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20, 0x30,
+    0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20, 0x30,
+    0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20, 0x30,
+    0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20, 0x30,
+    0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20, 0x30,
+    0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77,
+    0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66, 0x66,
+    0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20, 0x30,
+    0x78, 0x33, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x53,
-    0x44, 0x52, 0x41, 0x4d, 0x43, 0x5f, 0x4d, 0x52,
-    0x20, 0x3a, 0x20, 0x69, 0x73, 0x73, 0x75, 0x65,
-    0x20, 0x38, 0x20, 0x78, 0x20, 0x27, 0x41, 0x75,
-    0x74, 0x6f, 0x2d, 0x52, 0x65, 0x66, 0x72, 0x65,
-    0x73, 0x68, 0x27, 0x20, 0x43, 0x6f, 0x6d, 0x6d,
-    0x61, 0x6e, 0x64, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20,
-    0x30, 0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20,
-    0x30, 0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20,
-    0x30, 0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20,
-    0x30, 0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20,
-    0x30, 0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20,
-    0x30, 0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20,
-    0x30, 0x78, 0x34, 0x0d, 0x0a, 0x09, 0x6d, 0x77,
-    0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x66,
-    0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30, 0x20,
-    0x30, 0x78, 0x33, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x23, 0x20, 0x53, 0x44, 0x52, 0x41,
+    0x4d, 0x43, 0x5f, 0x4d, 0x52, 0x20, 0x3a, 0x20,
+    0x69, 0x73, 0x73, 0x75, 0x65, 0x20, 0x61, 0x20,
+    0x27, 0x4c, 0x6f, 0x61, 0x64, 0x20, 0x4d, 0x6f,
+    0x64, 0x65, 0x20, 0x52, 0x65, 0x67, 0x69, 0x73,
+    0x74, 0x65, 0x72, 0x27, 0x20, 0x63, 0x6f, 0x6d,
+    0x6d, 0x61, 0x6e, 0x64, 0x0d, 0x0a, 0x09, 0x6d,
+    0x77, 0x77, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x0d,
+    0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78,
+    0x66, 0x66, 0x66, 0x66, 0x65, 0x61, 0x30, 0x30,
+    0x20, 0x30, 0x78, 0x30, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x23, 0x20, 0x53, 0x44, 0x52,
-    0x41, 0x4d, 0x43, 0x5f, 0x4d, 0x52, 0x20, 0x3a,
-    0x20, 0x69, 0x73, 0x73, 0x75, 0x65, 0x20, 0x61,
-    0x20, 0x27, 0x4c, 0x6f, 0x61, 0x64, 0x20, 0x4d,
-    0x6f, 0x64, 0x65, 0x20, 0x52, 0x65, 0x67, 0x69,
-    0x73, 0x74, 0x65, 0x72, 0x27, 0x20, 0x63, 0x6f,
-    0x6d, 0x6d, 0x61, 0x6e, 0x64, 0x0d, 0x0a, 0x09,
+    0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x53, 0x44,
+    0x52, 0x41, 0x4d, 0x43, 0x5f, 0x4d, 0x52, 0x20,
+    0x3a, 0x20, 0x6e, 0x6f, 0x72, 0x6d, 0x61, 0x6c,
+    0x20, 0x6d, 0x6f, 0x64, 0x65, 0x0d, 0x0a, 0x09,
     0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x32, 0x30,
     0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30,
     0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
     0x78, 0x66, 0x66, 0x66, 0x66, 0x65, 0x61, 0x30,
-    0x30, 0x20, 0x30, 0x78, 0x30, 0x20, 0x20, 0x20,
+    0x34, 0x20, 0x30, 0x78, 0x35, 0x64, 0x32, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
     0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20, 0x53,
-    0x44, 0x52, 0x41, 0x4d, 0x43, 0x5f, 0x4d, 0x52,
-    0x20, 0x3a, 0x20, 0x6e, 0x6f, 0x72, 0x6d, 0x61,
-    0x6c, 0x20, 0x6d, 0x6f, 0x64, 0x65, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x32,
-    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x20,
-    0x30, 0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20,
-    0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x65, 0x61,
-    0x30, 0x34, 0x20, 0x30, 0x78, 0x35, 0x64, 0x32,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x23, 0x20,
-    0x53, 0x44, 0x52, 0x41, 0x4d, 0x43, 0x5f, 0x54,
-    0x52, 0x20, 0x3a, 0x20, 0x53, 0x65, 0x74, 0x20,
-    0x72, 0x65, 0x66, 0x72, 0x65, 0x73, 0x68, 0x20,
-    0x74, 0x69, 0x6d, 0x65, 0x72, 0x20, 0x63, 0x6f,
-    0x75, 0x6e, 0x74, 0x20, 0x74, 0x6f, 0x20, 0x31,
-    0x35, 0x75, 0x73, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x23, 0x23, 0x23,
+    0x44, 0x52, 0x41, 0x4d, 0x43, 0x5f, 0x54, 0x52,
+    0x20, 0x3a, 0x20, 0x53, 0x65, 0x74, 0x20, 0x72,
+    0x65, 0x66, 0x72, 0x65, 0x73, 0x68, 0x20, 0x74,
+    0x69, 0x6d, 0x65, 0x72, 0x20, 0x63, 0x6f, 0x75,
+    0x6e, 0x74, 0x20, 0x74, 0x6f, 0x20, 0x31, 0x35,
+    0x75, 0x73, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x23, 0x23, 0x23, 0x23, 0x23,
     0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
     0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x0d, 0x0a, 0x23, 0x20, 0x46, 0x6c, 0x61,
-    0x73, 0x68, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69,
-    0x67, 0x75, 0x72, 0x61, 0x74, 0x69, 0x6f, 0x6e,
-    0x0d, 0x0a, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
+    0x0d, 0x0a, 0x23, 0x20, 0x46, 0x6c, 0x61, 0x73,
+    0x68, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
+    0x75, 0x72, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x0d,
+    0x0a, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
     0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x0d,
-    0x0a, 0x0d, 0x0a, 0x23, 0x66, 0x6c, 0x61, 0x73,
+    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x23, 0x66, 0x6c, 0x61, 0x73, 0x68,
+    0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x63, 0x66,
+    0x69, 0x20, 0x3c, 0x62, 0x61, 0x73, 0x65, 0x3e,
+    0x20, 0x3c, 0x73, 0x69, 0x7a, 0x65, 0x3e, 0x20,
+    0x3c, 0x63, 0x68, 0x69, 0x70, 0x20, 0x77, 0x69,
+    0x64, 0x74, 0x68, 0x3e, 0x20, 0x3c, 0x62, 0x75,
+    0x73, 0x20, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3e,
+    0x20, 0x3c, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74,
+    0x23, 0x3e, 0x0d, 0x0a, 0x66, 0x6c, 0x61, 0x73,
     0x68, 0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x63,
-    0x66, 0x69, 0x20, 0x3c, 0x62, 0x61, 0x73, 0x65,
-    0x3e, 0x20, 0x3c, 0x73, 0x69, 0x7a, 0x65, 0x3e,
-    0x20, 0x3c, 0x63, 0x68, 0x69, 0x70, 0x20, 0x77,
-    0x69, 0x64, 0x74, 0x68, 0x3e, 0x20, 0x3c, 0x62,
-    0x75, 0x73, 0x20, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3e, 0x20, 0x3c, 0x74, 0x61, 0x72, 0x67, 0x65,
-    0x74, 0x23, 0x3e, 0x0d, 0x0a, 0x66, 0x6c, 0x61,
-    0x73, 0x68, 0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20,
-    0x63, 0x66, 0x69, 0x20, 0x30, 0x78, 0x31, 0x30,
-    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30,
-    0x78, 0x30, 0x31, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x30, 0x20, 0x32, 0x20, 0x32, 0x20, 0x30, 0x0d,
-    0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x66, 0x69, 0x20, 0x30, 0x78, 0x31, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x78,
+    0x30, 0x31, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x20, 0x32, 0x20, 0x32, 0x20, 0x30, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
     0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
@@ -51863,8 +51887,8 @@
     0x20, 0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72, 0x0d,
     0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20,
     0x5f, 0x43, 0x50, 0x55, 0x54, 0x41, 0x50, 0x49,
-    0x44, 0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66,
-    0x66, 0x66, 0x66, 0x66, 0x0d, 0x0a, 0x7d, 0x0d,
+    0x44, 0x20, 0x30, 0x78, 0x30, 0x37, 0x39, 0x32,
+    0x36, 0x30, 0x33, 0x66, 0x0d, 0x0a, 0x7d, 0x0d,
     0x0a, 0x0d, 0x0a, 0x72, 0x65, 0x73, 0x65, 0x74,
     0x5f, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x20,
     0x74, 0x72, 0x73, 0x74, 0x5f, 0x61, 0x6e, 0x64,
@@ -51918,21 +51942,21 @@
     0x6e, 0x74, 0x65, 0x72, 0x6e, 0x61, 0x6c, 0x20,
     0x73, 0x72, 0x61, 0x6d, 0x31, 0x20, 0x6d, 0x65,
     0x6d, 0x6f, 0x72, 0x79, 0x0d, 0x0a, 0x24, 0x5f,
-    0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x5f, 0x4e,
-    0x41, 0x4d, 0x45, 0x20, 0x63, 0x6f, 0x6e, 0x66,
-    0x69, 0x67, 0x75, 0x72, 0x65, 0x20, 0x2d, 0x77,
-    0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61,
-    0x2d, 0x76, 0x69, 0x72, 0x74, 0x20, 0x30, 0x20,
-    0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72,
-    0x65, 0x61, 0x2d, 0x70, 0x68, 0x79, 0x73, 0x20,
-    0x30, 0x78, 0x30, 0x30, 0x33, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b,
-    0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x73, 0x69,
-    0x7a, 0x65, 0x20, 0x30, 0x78, 0x31, 0x30, 0x30,
+    0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41,
+    0x4d, 0x45, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69,
+    0x67, 0x75, 0x72, 0x65, 0x20, 0x2d, 0x77, 0x6f,
+    0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d,
+    0x76, 0x69, 0x72, 0x74, 0x20, 0x30, 0x20, 0x2d,
+    0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65,
+    0x61, 0x2d, 0x70, 0x68, 0x79, 0x73, 0x20, 0x30,
+    0x78, 0x30, 0x30, 0x33, 0x30, 0x30, 0x30, 0x30,
     0x30, 0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d,
-    0x61, 0x72, 0x65, 0x61, 0x2d, 0x62, 0x61, 0x63,
-    0x6b, 0x75, 0x70, 0x20, 0x31, 0x0d, 0x0a, 0x0d,
-    0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x61, 0x72, 0x65, 0x61, 0x2d, 0x73, 0x69, 0x7a,
+    0x65, 0x20, 0x30, 0x78, 0x31, 0x30, 0x30, 0x30,
+    0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61,
+    0x72, 0x65, 0x61, 0x2d, 0x62, 0x61, 0x63, 0x6b,
+    0x75, 0x70, 0x20, 0x31, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x75, 0x73, 0x65, 0x20, 0x63, 0x6f, 0x6d,
     0x62, 0x69, 0x6e, 0x65, 0x64, 0x20, 0x6f, 0x6e,
     0x20, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x66, 0x61,
@@ -52756,7 +52780,7 @@
     0x69, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x24, 0x5f,
     0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41,
     0x4d, 0x45, 0x20, 0x2d, 0x76, 0x61, 0x72, 0x69,
-    0x65, 0x6e, 0x74, 0x20, 0x70, 0x78, 0x61, 0x32,
+    0x61, 0x6e, 0x74, 0x20, 0x70, 0x78, 0x61, 0x32,
     0x37, 0x78, 0x0d, 0x0a, 0x24, 0x5f, 0x54, 0x41,
     0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45,
     0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75,
@@ -53420,7 +53444,7 @@
     0x6e, 0x2d, 0x70, 0x6f, 0x73, 0x69, 0x74, 0x69,
     0x6f, 0x6e, 0x20, 0x24, 0x5f, 0x54, 0x41, 0x52,
     0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20,
-    0x20, 0x2d, 0x76, 0x61, 0x72, 0x69, 0x65, 0x6e,
+    0x20, 0x2d, 0x76, 0x61, 0x72, 0x69, 0x61, 0x6e,
     0x74, 0x20, 0x61, 0x72, 0x6d, 0x39, 0x36, 0x36,
     0x65, 0x0d, 0x0a, 0x0d, 0x0a, 0x24, 0x5f, 0x54,
     0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d,
@@ -56029,6 +56053,270 @@
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x23, 0x20, 0x46, 0x6f, 0x75, 0x6e, 0x64, 0x20,
+    0x6f, 0x6e, 0x20, 0x74, 0x68, 0x65, 0x20, 0x27,
+    0x54, 0x69, 0x6e, 0x43, 0x61, 0x6e, 0x54, 0x6f,
+    0x6f, 0x6c, 0x73, 0x27, 0x20, 0x48, 0x61, 0x6d,
+    0x6d, 0x65, 0x72, 0x20, 0x62, 0x6f, 0x61, 0x72,
+    0x64, 0x2e, 0x0d, 0x0a, 0x0d, 0x0a, 0x69, 0x66,
+    0x20, 0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f,
+    0x20, 0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20,
+    0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45,
+    0x5d, 0x20, 0x7d, 0x20, 0x7b, 0x09, 0x0d, 0x0a,
+    0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x20,
+    0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d,
+    0x45, 0x20, 0x24, 0x43, 0x48, 0x49, 0x50, 0x4e,
+    0x41, 0x4d, 0x45, 0x20, 0x20, 0x20, 0x20, 0x0d,
+    0x0a, 0x7d, 0x20, 0x65, 0x6c, 0x73, 0x65, 0x20,
+    0x7b, 0x09, 0x20, 0x0d, 0x0a, 0x20, 0x20, 0x20,
+    0x73, 0x65, 0x74, 0x20, 0x20, 0x5f, 0x43, 0x48,
+    0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45, 0x20, 0x73,
+    0x33, 0x63, 0x32, 0x34, 0x31, 0x30, 0x0d, 0x0a,
+    0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x69, 0x66, 0x20,
+    0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f, 0x20,
+    0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20, 0x45,
+    0x4e, 0x44, 0x49, 0x41, 0x4e, 0x5d, 0x20, 0x7d,
+    0x20, 0x7b, 0x09, 0x0d, 0x0a, 0x20, 0x20, 0x20,
+    0x73, 0x65, 0x74, 0x20, 0x20, 0x5f, 0x45, 0x4e,
+    0x44, 0x49, 0x41, 0x4e, 0x20, 0x24, 0x45, 0x4e,
+    0x44, 0x49, 0x41, 0x4e, 0x20, 0x20, 0x20, 0x20,
+    0x0d, 0x0a, 0x7d, 0x20, 0x65, 0x6c, 0x73, 0x65,
+    0x20, 0x7b, 0x09, 0x20, 0x0d, 0x0a, 0x20, 0x20,
+    0x23, 0x20, 0x54, 0x68, 0x69, 0x73, 0x20, 0x63,
+    0x6f, 0x6e, 0x66, 0x69, 0x67, 0x20, 0x66, 0x69,
+    0x6c, 0x65, 0x20, 0x77, 0x61, 0x73, 0x20, 0x64,
+    0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x69, 0x6e,
+    0x67, 0x20, 0x74, 0x6f, 0x20, 0x62, 0x69, 0x67,
+    0x20, 0x65, 0x6e, 0x64, 0x69, 0x61, 0x6e, 0x2e,
+    0x2e, 0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65,
+    0x74, 0x20, 0x20, 0x5f, 0x45, 0x4e, 0x44, 0x49,
+    0x41, 0x4e, 0x20, 0x6c, 0x69, 0x74, 0x74, 0x6c,
+    0x65, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x69, 0x66, 0x20, 0x7b, 0x20, 0x5b, 0x69, 0x6e,
+    0x66, 0x6f, 0x20, 0x65, 0x78, 0x69, 0x73, 0x74,
+    0x73, 0x20, 0x43, 0x50, 0x55, 0x54, 0x41, 0x50,
+    0x49, 0x44, 0x5d, 0x20, 0x7d, 0x20, 0x7b, 0x09,
+    0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74,
+    0x20, 0x20, 0x5f, 0x43, 0x50, 0x55, 0x54, 0x41,
+    0x50, 0x49, 0x44, 0x20, 0x24, 0x43, 0x50, 0x55,
+    0x54, 0x41, 0x50, 0x49, 0x44, 0x20, 0x20, 0x20,
+    0x20, 0x0d, 0x0a, 0x7d, 0x20, 0x65, 0x6c, 0x73,
+    0x65, 0x20, 0x7b, 0x09, 0x20, 0x0d, 0x0a, 0x20,
+    0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x20, 0x5f,
+    0x43, 0x50, 0x55, 0x54, 0x41, 0x50, 0x49, 0x44,
+    0x20, 0x30, 0x78, 0x66, 0x66, 0x66, 0x66, 0x66,
+    0x66, 0x66, 0x66, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x23, 0x75, 0x73, 0x65, 0x20, 0x63,
+    0x6f, 0x6d, 0x62, 0x69, 0x6e, 0x65, 0x64, 0x20,
+    0x6f, 0x6e, 0x20, 0x69, 0x6e, 0x74, 0x65, 0x72,
+    0x66, 0x61, 0x63, 0x65, 0x73, 0x20, 0x6f, 0x72,
+    0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x73,
+    0x20, 0x74, 0x68, 0x61, 0x74, 0x20, 0x63, 0x61,
+    0x6e, 0x6e, 0x6f, 0x74, 0x20, 0x73, 0x65, 0x74,
+    0x20, 0x54, 0x52, 0x53, 0x54, 0x2f, 0x53, 0x52,
+    0x53, 0x54, 0x20, 0x73, 0x65, 0x70, 0x61, 0x72,
+    0x61, 0x74, 0x65, 0x6c, 0x79, 0x0d, 0x0a, 0x72,
+    0x65, 0x73, 0x65, 0x74, 0x5f, 0x63, 0x6f, 0x6e,
+    0x66, 0x69, 0x67, 0x20, 0x74, 0x72, 0x73, 0x74,
+    0x5f, 0x61, 0x6e, 0x64, 0x5f, 0x73, 0x72, 0x73,
+    0x74, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x6a, 0x74,
+    0x61, 0x67, 0x20, 0x73, 0x63, 0x61, 0x6e, 0x20,
+    0x63, 0x68, 0x61, 0x69, 0x6e, 0x0d, 0x0a, 0x6a,
+    0x74, 0x61, 0x67, 0x20, 0x6e, 0x65, 0x77, 0x74,
+    0x61, 0x70, 0x20, 0x24, 0x5f, 0x43, 0x48, 0x49,
+    0x50, 0x4e, 0x41, 0x4d, 0x45, 0x20, 0x63, 0x70,
+    0x75, 0x20, 0x2d, 0x69, 0x72, 0x6c, 0x65, 0x6e,
+    0x20, 0x34, 0x20, 0x2d, 0x69, 0x72, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x30, 0x78,
+    0x31, 0x20, 0x2d, 0x69, 0x72, 0x6d, 0x61, 0x73,
+    0x6b, 0x20, 0x30, 0x78, 0x66, 0x20, 0x2d, 0x65,
+    0x78, 0x70, 0x65, 0x63, 0x74, 0x65, 0x64, 0x2d,
+    0x69, 0x64, 0x20, 0x24, 0x5f, 0x43, 0x50, 0x55,
+    0x54, 0x41, 0x50, 0x49, 0x44, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x73, 0x65, 0x74, 0x20, 0x5f, 0x54, 0x41,
+    0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45,
+    0x20, 0x5b, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74,
+    0x20, 0x22, 0x25, 0x73, 0x2e, 0x63, 0x70, 0x75,
+    0x22, 0x20, 0x24, 0x5f, 0x43, 0x48, 0x49, 0x50,
+    0x4e, 0x41, 0x4d, 0x45, 0x5d, 0x0d, 0x0a, 0x74,
+    0x61, 0x72, 0x67, 0x65, 0x74, 0x20, 0x63, 0x72,
+    0x65, 0x61, 0x74, 0x65, 0x20, 0x24, 0x5f, 0x54,
+    0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d,
+    0x45, 0x20, 0x61, 0x72, 0x6d, 0x39, 0x32, 0x30,
+    0x74, 0x20, 0x2d, 0x65, 0x6e, 0x64, 0x69, 0x61,
+    0x6e, 0x20, 0x24, 0x5f, 0x45, 0x4e, 0x44, 0x49,
+    0x41, 0x4e, 0x20, 0x2d, 0x63, 0x68, 0x61, 0x69,
+    0x6e, 0x2d, 0x70, 0x6f, 0x73, 0x69, 0x74, 0x69,
+    0x6f, 0x6e, 0x20, 0x24, 0x5f, 0x54, 0x41, 0x52,
+    0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20,
+    0x2d, 0x76, 0x61, 0x72, 0x69, 0x61, 0x6e, 0x74,
+    0x20, 0x61, 0x72, 0x6d, 0x39, 0x32, 0x30, 0x74,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x24, 0x5f, 0x54, 0x41,
+    0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45,
+    0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75,
+    0x72, 0x65, 0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b,
+    0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x76, 0x69,
+    0x72, 0x74, 0x20, 0x30, 0x20, 0x2d, 0x77, 0x6f,
+    0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d,
+    0x70, 0x68, 0x79, 0x73, 0x20, 0x30, 0x78, 0x33,
+    0x30, 0x38, 0x30, 0x30, 0x30, 0x30, 0x30, 0x20,
+    0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72,
+    0x65, 0x61, 0x2d, 0x73, 0x69, 0x7a, 0x65, 0x20,
+    0x30, 0x78, 0x32, 0x30, 0x30, 0x30, 0x30, 0x20,
+    0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72,
+    0x65, 0x61, 0x2d, 0x62, 0x61, 0x63, 0x6b, 0x75,
+    0x70, 0x20, 0x30, 0x0d, 0x0a, 0x0d, 0x0a, 0x23,
+    0x20, 0x73, 0x70, 0x65, 0x65, 0x64, 0x20, 0x75,
+    0x70, 0x20, 0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79,
+    0x20, 0x64, 0x6f, 0x77, 0x6e, 0x6c, 0x6f, 0x61,
+    0x64, 0x73, 0x0d, 0x0a, 0x61, 0x72, 0x6d, 0x37,
+    0x5f, 0x39, 0x20, 0x66, 0x61, 0x73, 0x74, 0x5f,
+    0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x5f, 0x61,
+    0x63, 0x63, 0x65, 0x73, 0x73, 0x20, 0x65, 0x6e,
+    0x61, 0x62, 0x6c, 0x65, 0x0d, 0x0a, 0x61, 0x72,
+    0x6d, 0x37, 0x5f, 0x39, 0x20, 0x64, 0x63, 0x63,
+    0x5f, 0x64, 0x6f, 0x77, 0x6e, 0x6c, 0x6f, 0x61,
+    0x64, 0x73, 0x20, 0x65, 0x6e, 0x61, 0x62, 0x6c,
+    0x65, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x23, 0x20, 0x54, 0x61, 0x72, 0x67, 0x65, 0x74,
+    0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75,
+    0x72, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x66,
+    0x6f, 0x72, 0x20, 0x74, 0x68, 0x65, 0x20, 0x53,
+    0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x20, 0x32,
+    0x34, 0x34, 0x30, 0x20, 0x73, 0x79, 0x73, 0x74,
+    0x65, 0x6d, 0x20, 0x6f, 0x6e, 0x20, 0x63, 0x68,
+    0x69, 0x70, 0x0d, 0x0a, 0x23, 0x20, 0x54, 0x65,
+    0x73, 0x74, 0x65, 0x64, 0x20, 0x6f, 0x6e, 0x20,
+    0x61, 0x20, 0x53, 0x33, 0x43, 0x32, 0x34, 0x34,
+    0x30, 0x20, 0x45, 0x76, 0x61, 0x6c, 0x75, 0x61,
+    0x74, 0x69, 0x6f, 0x6e, 0x20, 0x62, 0x6f, 0x61,
+    0x72, 0x64, 0x20, 0x62, 0x79, 0x20, 0x6b, 0x65,
+    0x65, 0x73, 0x6a, 0x0d, 0x0a, 0x23, 0x20, 0x50,
+    0x72, 0x6f, 0x63, 0x65, 0x73, 0x73, 0x6f, 0x72,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x3a,
+    0x20, 0x41, 0x52, 0x4d, 0x39, 0x32, 0x30, 0x54,
+    0x69, 0x64, 0x28, 0x77, 0x62, 0x29, 0x20, 0x72,
+    0x65, 0x76, 0x20, 0x30, 0x20, 0x28, 0x76, 0x34,
+    0x6c, 0x29, 0x0d, 0x0a, 0x23, 0x20, 0x49, 0x6e,
+    0x66, 0x6f, 0x3a, 0x20, 0x20, 0x20, 0x4a, 0x54,
+    0x41, 0x47, 0x20, 0x74, 0x61, 0x70, 0x3a, 0x20,
+    0x73, 0x33, 0x63, 0x32, 0x34, 0x34, 0x30, 0x2e,
+    0x63, 0x70, 0x75, 0x20, 0x74, 0x61, 0x70, 0x2f,
+    0x64, 0x65, 0x76, 0x69, 0x63, 0x65, 0x20, 0x66,
+    0x6f, 0x75, 0x6e, 0x64, 0x3a, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x33, 0x32, 0x34, 0x30, 0x39, 0x64,
+    0x20, 0x28, 0x4d, 0x61, 0x6e, 0x75, 0x66, 0x61,
+    0x63, 0x74, 0x75, 0x72, 0x65, 0x72, 0x3a, 0x20,
+    0x30, 0x78, 0x30, 0x34, 0x65, 0x2c, 0x20, 0x50,
+    0x61, 0x72, 0x74, 0x3a, 0x20, 0x30, 0x78, 0x30,
+    0x33, 0x32, 0x34, 0x2c, 0x20, 0x56, 0x65, 0x72,
+    0x73, 0x69, 0x6f, 0x6e, 0x3a, 0x20, 0x30, 0x78,
+    0x30, 0x29, 0x0d, 0x0a, 0x0d, 0x0a, 0x69, 0x66,
+    0x20, 0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f,
+    0x20, 0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20,
+    0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45,
+    0x5d, 0x20, 0x7d, 0x20, 0x7b, 0x09, 0x0d, 0x0a,
+    0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x20,
+    0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d,
+    0x45, 0x20, 0x24, 0x43, 0x48, 0x49, 0x50, 0x4e,
+    0x41, 0x4d, 0x45, 0x20, 0x20, 0x20, 0x20, 0x0d,
+    0x0a, 0x7d, 0x20, 0x65, 0x6c, 0x73, 0x65, 0x20,
+    0x7b, 0x09, 0x20, 0x0d, 0x0a, 0x20, 0x20, 0x20,
+    0x73, 0x65, 0x74, 0x20, 0x20, 0x5f, 0x43, 0x48,
+    0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45, 0x20, 0x73,
+    0x33, 0x63, 0x32, 0x34, 0x34, 0x30, 0x0d, 0x0a,
+    0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x69, 0x66, 0x20,
+    0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f, 0x20,
+    0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20, 0x45,
+    0x4e, 0x44, 0x49, 0x41, 0x4e, 0x5d, 0x20, 0x7d,
+    0x20, 0x7b, 0x09, 0x0d, 0x0a, 0x20, 0x20, 0x20,
+    0x73, 0x65, 0x74, 0x20, 0x20, 0x5f, 0x45, 0x4e,
+    0x44, 0x49, 0x41, 0x4e, 0x20, 0x24, 0x45, 0x4e,
+    0x44, 0x49, 0x41, 0x4e, 0x20, 0x20, 0x20, 0x20,
+    0x0d, 0x0a, 0x7d, 0x20, 0x65, 0x6c, 0x73, 0x65,
+    0x20, 0x7b, 0x09, 0x20, 0x0d, 0x0a, 0x20, 0x20,
+    0x23, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x64,
+    0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x73, 0x20,
+    0x74, 0x6f, 0x20, 0x61, 0x20, 0x62, 0x69, 0x67,
+    0x65, 0x6e, 0x64, 0x69, 0x61, 0x6e, 0x0d, 0x0a,
+    0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x20,
+    0x5f, 0x45, 0x4e, 0x44, 0x49, 0x41, 0x4e, 0x20,
+    0x6c, 0x69, 0x74, 0x74, 0x6c, 0x65, 0x0d, 0x0a,
+    0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x69, 0x66, 0x20,
+    0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f, 0x20,
+    0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20, 0x43,
+    0x50, 0x55, 0x54, 0x41, 0x50, 0x49, 0x44, 0x20,
+    0x5d, 0x20, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x20,
+    0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x5f, 0x43,
+    0x50, 0x55, 0x54, 0x41, 0x50, 0x49, 0x44, 0x20,
+    0x24, 0x43, 0x50, 0x55, 0x54, 0x41, 0x50, 0x49,
+    0x44, 0x0d, 0x0a, 0x7d, 0x20, 0x65, 0x6c, 0x73,
+    0x65, 0x20, 0x7b, 0x0d, 0x0a, 0x20, 0x20, 0x23,
+    0x20, 0x66, 0x6f, 0x72, 0x63, 0x65, 0x20, 0x61,
+    0x6e, 0x20, 0x65, 0x72, 0x72, 0x6f, 0x72, 0x20,
+    0x74, 0x69, 0x6c, 0x6c, 0x20, 0x77, 0x65, 0x20,
+    0x67, 0x65, 0x74, 0x20, 0x61, 0x20, 0x67, 0x6f,
+    0x6f, 0x64, 0x20, 0x6e, 0x75, 0x6d, 0x62, 0x65,
+    0x72, 0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65,
+    0x74, 0x20, 0x5f, 0x43, 0x50, 0x55, 0x54, 0x41,
+    0x50, 0x49, 0x44, 0x20, 0x30, 0x78, 0x30, 0x30,
+    0x33, 0x32, 0x34, 0x30, 0x39, 0x64, 0x0d, 0x0a,
+    0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x6a, 0x74,
+    0x61, 0x67, 0x20, 0x73, 0x63, 0x61, 0x6e, 0x20,
+    0x63, 0x68, 0x61, 0x69, 0x6e, 0x0d, 0x0a, 0x6a,
+    0x74, 0x61, 0x67, 0x20, 0x6e, 0x65, 0x77, 0x74,
+    0x61, 0x70, 0x20, 0x24, 0x5f, 0x43, 0x48, 0x49,
+    0x50, 0x4e, 0x41, 0x4d, 0x45, 0x20, 0x63, 0x70,
+    0x75, 0x20, 0x2d, 0x69, 0x72, 0x6c, 0x65, 0x6e,
+    0x20, 0x34, 0x20, 0x2d, 0x69, 0x72, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x30, 0x78,
+    0x31, 0x20, 0x2d, 0x69, 0x72, 0x6d, 0x61, 0x73,
+    0x6b, 0x20, 0x30, 0x78, 0x30, 0x66, 0x20, 0x2d,
+    0x65, 0x78, 0x70, 0x65, 0x63, 0x74, 0x65, 0x64,
+    0x2d, 0x69, 0x64, 0x20, 0x24, 0x5f, 0x43, 0x50,
+    0x55, 0x54, 0x41, 0x50, 0x49, 0x44, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x73, 0x65, 0x74, 0x20, 0x5f, 0x54,
+    0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d,
+    0x45, 0x20, 0x5b, 0x66, 0x6f, 0x72, 0x6d, 0x61,
+    0x74, 0x20, 0x22, 0x25, 0x73, 0x2e, 0x63, 0x70,
+    0x75, 0x22, 0x20, 0x24, 0x5f, 0x43, 0x48, 0x49,
+    0x50, 0x4e, 0x41, 0x4d, 0x45, 0x5d, 0x0d, 0x0a,
+    0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20, 0x63,
+    0x72, 0x65, 0x61, 0x74, 0x65, 0x20, 0x24, 0x5f,
+    0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41,
+    0x4d, 0x45, 0x20, 0x61, 0x72, 0x6d, 0x39, 0x32,
+    0x30, 0x74, 0x20, 0x2d, 0x65, 0x6e, 0x64, 0x69,
+    0x61, 0x6e, 0x20, 0x24, 0x5f, 0x45, 0x4e, 0x44,
+    0x49, 0x41, 0x4e, 0x20, 0x2d, 0x63, 0x68, 0x61,
+    0x69, 0x6e, 0x2d, 0x70, 0x6f, 0x73, 0x69, 0x74,
+    0x69, 0x6f, 0x6e, 0x20, 0x24, 0x5f, 0x54, 0x41,
+    0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45,
+    0x20, 0x2d, 0x76, 0x61, 0x72, 0x69, 0x61, 0x6e,
+    0x74, 0x20, 0x61, 0x72, 0x6d, 0x39, 0x32, 0x30,
+    0x74, 0x0d, 0x0a, 0x24, 0x5f, 0x54, 0x41, 0x52,
+    0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20,
+    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75, 0x72,
+    0x65, 0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d,
+    0x61, 0x72, 0x65, 0x61, 0x2d, 0x76, 0x69, 0x72,
+    0x74, 0x20, 0x30, 0x20, 0x2d, 0x77, 0x6f, 0x72,
+    0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x70,
+    0x68, 0x79, 0x73, 0x20, 0x30, 0x78, 0x32, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x20, 0x2d, 0x77, 0x6f,
+    0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d,
+    0x73, 0x69, 0x7a, 0x65, 0x20, 0x30, 0x78, 0x34,
+    0x30, 0x30, 0x30, 0x20, 0x2d, 0x77, 0x6f, 0x72,
+    0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x62,
+    0x61, 0x63, 0x6b, 0x75, 0x70, 0x20, 0x31, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x23, 0x72, 0x65, 0x73, 0x65,
+    0x74, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
+    0x75, 0x72, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x0d,
+    0x0a, 0x72, 0x65, 0x73, 0x65, 0x74, 0x5f, 0x63,
+    0x6f, 0x6e, 0x66, 0x69, 0x67, 0x20, 0x74, 0x72,
+    0x73, 0x74, 0x5f, 0x61, 0x6e, 0x64, 0x5f, 0x73,
+    0x72, 0x73, 0x74, 0x0d, 0x0a, 0x0d, 0x0a, 0x00,
     0x0d, 0x0a, 0x69, 0x66, 0x20, 0x7b, 0x20, 0x5b,
     0x69, 0x6e, 0x66, 0x6f, 0x20, 0x65, 0x78, 0x69,
     0x73, 0x74, 0x73, 0x20, 0x43, 0x48, 0x49, 0x50,
@@ -56200,8 +56488,8 @@
     0x6f, 0x6f, 0x64, 0x20, 0x6e, 0x75, 0x6d, 0x62,
     0x65, 0x72, 0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73,
     0x65, 0x74, 0x20, 0x5f, 0x42, 0x53, 0x54, 0x41,
-    0x50, 0x49, 0x44, 0x20, 0x30, 0x78, 0x66, 0x66,
-    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x0d, 0x0a,
+    0x50, 0x49, 0x44, 0x20, 0x30, 0x78, 0x32, 0x62,
+    0x39, 0x30, 0x30, 0x66, 0x30, 0x66, 0x0d, 0x0a,
     0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x69, 0x66, 0x20,
     0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f, 0x20,
     0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20, 0x43,
@@ -56219,8 +56507,8 @@
     0x6f, 0x64, 0x20, 0x6e, 0x75, 0x6d, 0x62, 0x65,
     0x72, 0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65,
     0x74, 0x20, 0x5f, 0x43, 0x50, 0x55, 0x54, 0x41,
-    0x50, 0x49, 0x44, 0x20, 0x30, 0x78, 0x66, 0x66,
-    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x0d, 0x0a,
+    0x50, 0x49, 0x44, 0x20, 0x30, 0x78, 0x30, 0x37,
+    0x62, 0x37, 0x36, 0x66, 0x30, 0x66, 0x0d, 0x0a,
     0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x6a, 0x74,
     0x61, 0x67, 0x20, 0x73, 0x63, 0x61, 0x6e, 0x20,
     0x63, 0x68, 0x61, 0x69, 0x6e, 0x0d, 0x0a, 0x0d,
@@ -56270,7 +56558,7 @@
     0x69, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x24, 0x5f,
     0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41,
     0x4d, 0x45, 0x20, 0x2d, 0x76, 0x61, 0x72, 0x69,
-    0x65, 0x6e, 0x74, 0x20, 0x61, 0x72, 0x6d, 0x31,
+    0x61, 0x6e, 0x74, 0x20, 0x61, 0x72, 0x6d, 0x31,
     0x31, 0x37, 0x36, 0x0d, 0x0a, 0x0d, 0x0a, 0x6a,
     0x74, 0x61, 0x67, 0x5f, 0x6e, 0x73, 0x72, 0x73,
     0x74, 0x5f, 0x64, 0x65, 0x6c, 0x61, 0x79, 0x20,

Modified: zy1000/trunk/build/tcl/openocd.cfg
===================================================================
--- zy1000/trunk/build/tcl/openocd.cfg	2008-12-15 09:43:26 UTC (rev 1242)
+++ zy1000/trunk/build/tcl/openocd.cfg	2008-12-15 11:32:22 UTC (rev 1243)
@@ -119,3 +119,9 @@
 add_help_text reboot "reboots ZY1000 unit"
 add_help_text mac "prints MAC number of ZY1000 unit"
 add_help_text ip "print current IP number of ZY1000 unit"
+
+
+proc zy1000_flash {} {
+	set t [lindex 0 [ocd_flash_banks]]
+	return $t(base)
+}
\ No newline at end of file



From oharboe at mail.berlios.de  Mon Dec 15 13:57:30 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 15 Dec 2008 13:57:30 +0100
Subject: [Openocd-svn] r1244 - trunk/doc
Message-ID: <200812151257.mBFCvUOP030686@sheep.berlios.de>

Author: oharboe
Date: 2008-12-15 13:57:29 +0100 (Mon, 15 Dec 2008)
New Revision: 1244

Modified:
   trunk/doc/openocd.texi
Log:
fixed compilation problem

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-15 11:32:22 UTC (rev 1243)
+++ trunk/doc/openocd.texi	2008-12-15 12:57:29 UTC (rev 1244)
@@ -96,8 +96,7 @@
 
 @b{Dongles:} OpenOCD currently many types of hardware dongles: USB
 Based, Parallel Port Based, and other standalone boxes that run
-OpenOCD internally. See the section titled: @xref{JTAG Hardware
-Dongles}.
+OpenOCD internally. See the section titled: @xref{JTAG Hardware Dongles}.
 
 @b{GDB Debug:} It allows ARM7 (ARM7TDMI and ARM720t), ARM9 (ARM920t,
 ARM922t, ARM926ej--s, ARM966e--s), XScale (PXA25x, IXP42x) and



From ntfreak at mail.berlios.de  Mon Dec 15 17:10:18 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Mon, 15 Dec 2008 17:10:18 +0100
Subject: [Openocd-svn] r1245 - trunk/src/helper
Message-ID: <200812151610.mBFGAIEA016075@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-15 17:10:18 +0100 (Mon, 15 Dec 2008)
New Revision: 1245

Modified:
   trunk/src/helper/ioutil.c
Log:
- add missing svn props from r1243 commit

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2008-12-15 12:57:29 UTC (rev 1244)
+++ trunk/src/helper/ioutil.c	2008-12-15 16:10:18 UTC (rev 1245)
@@ -1,590 +1,590 @@
-/***************************************************************************
- *   Copyright (C) 2007-2008 by ?yvind Harboe                              *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-/* this file contains various functionality useful to standalone systems */
-
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
-#include "log.h"
-#include "types.h"
-#include "configuration.h"
-#include "target.h"
-
-#include "command.h"
-
-#include <time_support.h>
-#include <sys/time.h>
-#include <sys/types.h>
-#include <strings.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
-#if !BUILD_ECOSBOARD
-#include <malloc.h>
-#endif
-#include <errno.h>
-
-
-#include <fcntl.h>
-#include <sys/stat.h>
-#include <dirent.h>
-#include <netinet/tcp.h>
-#include <sys/ioctl.h>
-#include <sys/socket.h>
-#include <netinet/in.h>
-#include <net/if.h>
-#include <arpa/inet.h>
-#include <sys/types.h>
-#include <sys/socket.h>
-#include <netdb.h>
-#include <netinet/in.h>
-#include <unistd.h>
-#include <arpa/inet.h>
-#include <stdio.h>
-#include <string.h>
-
-
-#include <unistd.h>
-#include <stdio.h>
-
-int handle_rm_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc != 1)
-	{
-		command_print(cmd_ctx, "rm <filename>");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	if (unlink(args[0]) != 0)
-	{
-		command_print(cmd_ctx, "failed: %d", errno);
-	}
-
-	return ERROR_OK;
-}
-
-
-/* loads a file and returns a pointer to it in memory. The file contains
- * a 0 byte(sentinel) after len bytes - the length of the file. */
-int loadFile(const char *fileName, void **data, int *len)
-{
-	FILE * pFile;
-	pFile = fopen(fileName,"rb");
-	if (pFile==NULL)
-	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		return ERROR_FAIL;
-	}
-	if (fseek(pFile, 0, SEEK_END)!=0)
-	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		fclose(pFile);
-		return ERROR_FAIL;
-	}
-	*len=ftell(pFile);
-	if (*len==-1)
-	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		fclose(pFile);
-		return ERROR_FAIL;
-	}
-
-	if (fseek(pFile, 0, SEEK_SET)!=0)
-	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		fclose(pFile);
-		return ERROR_FAIL;
-	}
-	*data=malloc(*len+1);
-	if (*data==NULL)
-	{
-		LOG_ERROR("Can't open %s\n", fileName);
-		fclose(pFile);
-		return ERROR_FAIL;
-	}
-
-	if (fread(*data, 1, *len, pFile)!=*len)
-	{
-		fclose(pFile);
-		free(*data);
-		LOG_ERROR("Can't open %s\n", fileName);
-		return ERROR_FAIL;
-	}
-	fclose(pFile);
-	*(((char *)(*data))+*len)=0; /* sentinel */
-
-	return ERROR_OK;
-
-
-
-}
-
-
-
-int handle_cat_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc != 1)
-	{
-		command_print(cmd_ctx, "cat <filename>");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
-	void *data;
-	int len;
-
-	int retval = loadFile(args[0], &data, &len);
-	if (retval == ERROR_OK)
-	{
-		command_print(cmd_ctx, "%s", data);
-		free(data);
-	}
-	else
-	{
-		command_print(cmd_ctx, "%s not found %d", args[0], retval);
-	}
-
-	return ERROR_OK;
-}
-int handle_trunc_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc != 1)
-	{
-		command_print(cmd_ctx, "trunc <filename>");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	FILE *config_file = NULL;
-	config_file = fopen(args[0], "w");
-	if (config_file != NULL)
-		fclose(config_file);
-
-	return ERROR_OK;
-}
-
-
-int handle_meminfo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	static int prev = 0;
-	struct mallinfo info;
-
-	if (argc != 0)
-	{
-		command_print(cmd_ctx, "meminfo");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	info = mallinfo();
-
-	if (prev > 0)
-	{
-		command_print(cmd_ctx, "Diff:            %d", prev - info.fordblks);
-	}
-	prev = info.fordblks;
-
-	command_print(cmd_ctx, "Available ram:   %d", info.fordblks );
-
-	return ERROR_OK;
-}
-
-
-int handle_append_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc < 1)
-	{
-		command_print(cmd_ctx,
-				"append <filename> [<string1>, [<string2>, ...]]");
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	FILE *config_file = NULL;
-	config_file = fopen(args[0], "a");
-	if (config_file != NULL)
-	{
-		int i;
-		fseek(config_file, 0, SEEK_END);
-
-		for (i = 1; i < argc; i++)
-		{
-			fwrite(args[i], strlen(args[i]), 1, config_file);
-			if (i != argc - 1)
-			{
-				fwrite(" ", 1, 1, config_file);
-			}
-		}
-		fwrite("\n", 1, 1, config_file);
-		fclose(config_file);
-	}
-
-	return ERROR_OK;
-}
-
-
-
-int handle_cp_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc != 2)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
-	void *data;
-	int len;
-
-	int retval = loadFile(args[0], &data, &len);
-	if (retval != ERROR_OK)
-		return retval;
-
-	FILE *f = fopen(args[1], "wb");
-	if (f == NULL)
-		retval = ERROR_INVALID_ARGUMENTS;
-
-	int pos = 0;
-	for (;;)
-	{
-		int chunk = len - pos;
-		static const int maxChunk = 512 * 1024; // ~1/sec
-		if (chunk > maxChunk)
-		{
-			chunk = maxChunk;
-		}
-
-		if ((retval==ERROR_OK)&&(fwrite(((char *)data)+pos, 1, chunk, f)!=chunk))
-			retval = ERROR_INVALID_ARGUMENTS;
-
-		if (retval != ERROR_OK)
-		{
-			break;
-		}
-
-		command_print(cmd_ctx, "%d", len - pos);
-
-		pos += chunk;
-
-		if (pos == len)
-			break;
-	}
-
-	if (retval == ERROR_OK)
-	{
-		command_print(cmd_ctx, "Copied %s to %s", args[0], args[1]);
-	} else
-	{
-		command_print(cmd_ctx, "Failed: %d", retval);
-	}
-
-	if (data != NULL)
-		free(data);
-	if (f != NULL)
-		fclose(f);
-
-	if (retval != ERROR_OK)
-		unlink(args[1]);
-
-	return retval;
-}
-
-
-
-
-#define SHOW_RESULT(a, b) LOG_ERROR(#a " failed %d\n", (int)b)
-
-#define IOSIZE 512
-void copyfile(char *name2, char *name1)
-{
-
-	int err;
-	char buf[IOSIZE];
-	int fd1, fd2;
-	ssize_t done, wrote;
-
-	fd1 = open(name1, O_WRONLY | O_CREAT);
-	if (fd1 < 0)
-		SHOW_RESULT( open, fd1 );
-
-	fd2 = open(name2, O_RDONLY);
-	if (fd2 < 0)
-		SHOW_RESULT( open, fd2 );
-
-	for (;;)
-	{
-		done = read(fd2, buf, IOSIZE );
-		if (done < 0)
-		{
-			SHOW_RESULT( read, done );
-			break;
-		}
-
-        if( done == 0 ) break;
-
-		wrote = write(fd1, buf, done);
-        if( wrote != done ) SHOW_RESULT( write, wrote );
-
-        if( wrote != done ) break;
-	}
-
-	err = close(fd1);
-    if( err < 0 ) SHOW_RESULT( close, err );
-
-	err = close(fd2);
-    if( err < 0 ) SHOW_RESULT( close, err );
-
-}
-
-/* utility fn to copy a directory */
-void copydir(char *name, char *destdir)
-{
-	int err;
-	DIR *dirp;
-
-	dirp = opendir(destdir);
-	if (dirp==NULL)
-	{
-		mkdir(destdir, 0777);
-	} else
-	{
-		err = closedir(dirp);
-	}
-
-	dirp = opendir(name);
-    if( dirp == NULL ) SHOW_RESULT( opendir, -1 );
-
-	for (;;)
-	{
-		struct dirent *entry = readdir(dirp);
-
-		if (entry == NULL)
-			break;
-
-		if (strcmp(entry->d_name, ".") == 0)
-			continue;
-		if (strcmp(entry->d_name, "..") == 0)
-			continue;
-
-		int isDir = 0;
-		struct stat buf;
-		char fullPath[PATH_MAX];
-		strncpy(fullPath, name, PATH_MAX);
-		strcat(fullPath, "/");
-		strncat(fullPath, entry->d_name, PATH_MAX - strlen(fullPath));
-
-		if (stat(fullPath, &buf) == -1)
-		{
-			LOG_ERROR("unable to read status from %s", fullPath);
-			break;
-		}
-		isDir = S_ISDIR(buf.st_mode) != 0;
-
-		if (isDir)
-			continue;
-
-		//        diag_printf("<INFO>: entry %14s",entry->d_name);
-		char fullname[PATH_MAX];
-		char fullname2[PATH_MAX];
-
-		strcpy(fullname, name);
-		strcat(fullname, "/");
-		strcat(fullname, entry->d_name);
-
-		strcpy(fullname2, destdir);
-		strcat(fullname2, "/");
-		strcat(fullname2, entry->d_name);
-		//        diag_printf("from %s to %s\n", fullname, fullname2);
-		copyfile(fullname, fullname2);
-
-		//       diag_printf("\n");
-	}
-
-	err = closedir(dirp);
-    if( err < 0 ) SHOW_RESULT( stat, err );
-}
-
-
-
-
-static int
-zylinjtag_Jim_Command_rm(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	int del;
-	if (argc != 2)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "rm ?dirorfile?");
-		return JIM_ERR;
-	}
-
-	del = 0;
-	if (unlink(Jim_GetString(argv[1], NULL)) == 0)
-		del = 1;
-	if (rmdir(Jim_GetString(argv[1], NULL)) == 0)
-		del = 1;
-
-	return del ? JIM_OK : JIM_ERR;
-}
-
-
-static int
-zylinjtag_Jim_Command_ls(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 2)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "ls ?dir?");
-		return JIM_ERR;
-	}
-
-	char *name = (char*) Jim_GetString(argv[1], NULL);
-
-	DIR *dirp = NULL;
-	dirp = opendir(name);
-	if (dirp == NULL)
-	{
-		return JIM_ERR;
-	}
-	Jim_Obj *objPtr = Jim_NewListObj(interp, NULL, 0);
-
-	for (;;)
-	{
-		struct dirent *entry = NULL;
-		entry = readdir(dirp);
-		if (entry == NULL)
-			break;
-
-		if ((strcmp(".", entry->d_name)==0)||(strcmp("..", entry->d_name)==0))
-			continue;
-
-        Jim_ListAppendElement(interp, objPtr, Jim_NewStringObj(interp, entry->d_name, strlen(entry->d_name)));
-	}
-	closedir(dirp);
-
-	Jim_SetResult(interp, objPtr);
-
-	return JIM_OK;
-}
-
-int handle_peek_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc != 1)
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-	volatile int *address=(volatile int *)strtoul(args[0], NULL, 0);
-	int value=*address;
-	command_print(cmd_ctx, "0x%x : 0x%x", address, value);
-	return ERROR_OK;
-}
-
-int handle_poke_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc != 2)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-	volatile int *address=(volatile int *)strtoul(args[0], NULL, 0);
-	int value=strtoul(args[1], NULL, 0);
-	*address=value;
-	return ERROR_OK;
-}
-
-static int
-zylinjtag_Jim_Command_peek(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 2)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "peek ?address?");
-		return JIM_ERR;
-	}
-
-	long address;
-	if (Jim_GetLong(interp, argv[1], &address) != JIM_OK)
-		return JIM_ERR;
-
-	int value = *((volatile int *) address);
-
-	Jim_SetResult(interp, Jim_NewIntObj(interp, value));
-
-	return JIM_OK;
-}
-
-static int
-zylinjtag_Jim_Command_poke(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 3)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "poke ?address? ?value?");
-		return JIM_ERR;
-	}
-
-	long address;
-	if (Jim_GetLong(interp, argv[1], &address) != JIM_OK)
-		return JIM_ERR;
-	long value;
-	if (Jim_GetLong(interp, argv[2], &value) != JIM_OK)
-		return JIM_ERR;
-
-	*((volatile int *) address) = value;
-
-	return JIM_OK;
-}
-
-int ioutil_init(struct command_context_s *cmd_ctx)
-{
-	register_command(cmd_ctx, NULL, "rm", handle_rm_command, COMMAND_ANY,
-			"remove file");
-
-	register_command(cmd_ctx, NULL, "cat", handle_cat_command, COMMAND_ANY,
-			"display file content");
-
-	register_command(cmd_ctx, NULL, "trunc", handle_trunc_command, COMMAND_ANY,
-			"truncate a file to 0 size");
-
-	register_command(cmd_ctx, NULL, "cp", handle_cp_command,
-					 COMMAND_ANY, "copy a file <from> <to>");
-
-	register_command(cmd_ctx, NULL, "append_file", handle_append_command,
-			COMMAND_ANY, "append a variable number of strings to a file");
-
-	register_command(cmd_ctx, NULL, "meminfo", handle_meminfo_command,
-			COMMAND_ANY, "display available ram memory");
-
-    Jim_CreateCommand(interp, "rm", zylinjtag_Jim_Command_rm, NULL, NULL);
-
-    Jim_CreateCommand(interp, "peek", zylinjtag_Jim_Command_peek, NULL, NULL);
-    Jim_CreateCommand(interp, "poke", zylinjtag_Jim_Command_poke, NULL, NULL);
-    Jim_CreateCommand(interp, "ls", zylinjtag_Jim_Command_ls, NULL, NULL);
-
-
-    return ERROR_OK;
-}
-
-
+/***************************************************************************
+ *   Copyright (C) 2007-2008 by ?yvind Harboe                              *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+/* this file contains various functionality useful to standalone systems */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "log.h"
+#include "types.h"
+#include "configuration.h"
+#include "target.h"
+
+#include "command.h"
+
+#include <time_support.h>
+#include <sys/time.h>
+#include <sys/types.h>
+#include <strings.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <unistd.h>
+#if !BUILD_ECOSBOARD
+#include <malloc.h>
+#endif
+#include <errno.h>
+
+
+#include <fcntl.h>
+#include <sys/stat.h>
+#include <dirent.h>
+#include <netinet/tcp.h>
+#include <sys/ioctl.h>
+#include <sys/socket.h>
+#include <netinet/in.h>
+#include <net/if.h>
+#include <arpa/inet.h>
+#include <sys/types.h>
+#include <sys/socket.h>
+#include <netdb.h>
+#include <netinet/in.h>
+#include <unistd.h>
+#include <arpa/inet.h>
+#include <stdio.h>
+#include <string.h>
+
+
+#include <unistd.h>
+#include <stdio.h>
+
+int handle_rm_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
+{
+	if (argc != 1)
+	{
+		command_print(cmd_ctx, "rm <filename>");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	if (unlink(args[0]) != 0)
+	{
+		command_print(cmd_ctx, "failed: %d", errno);
+	}
+
+	return ERROR_OK;
+}
+
+
+/* loads a file and returns a pointer to it in memory. The file contains
+ * a 0 byte(sentinel) after len bytes - the length of the file. */
+int loadFile(const char *fileName, void **data, int *len)
+{
+	FILE * pFile;
+	pFile = fopen(fileName,"rb");
+	if (pFile==NULL)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		return ERROR_FAIL;
+	}
+	if (fseek(pFile, 0, SEEK_END)!=0)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		fclose(pFile);
+		return ERROR_FAIL;
+	}
+	*len=ftell(pFile);
+	if (*len==-1)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		fclose(pFile);
+		return ERROR_FAIL;
+	}
+
+	if (fseek(pFile, 0, SEEK_SET)!=0)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		fclose(pFile);
+		return ERROR_FAIL;
+	}
+	*data=malloc(*len+1);
+	if (*data==NULL)
+	{
+		LOG_ERROR("Can't open %s\n", fileName);
+		fclose(pFile);
+		return ERROR_FAIL;
+	}
+
+	if (fread(*data, 1, *len, pFile)!=*len)
+	{
+		fclose(pFile);
+		free(*data);
+		LOG_ERROR("Can't open %s\n", fileName);
+		return ERROR_FAIL;
+	}
+	fclose(pFile);
+	*(((char *)(*data))+*len)=0; /* sentinel */
+
+	return ERROR_OK;
+
+
+
+}
+
+
+
+int handle_cat_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
+{
+	if (argc != 1)
+	{
+		command_print(cmd_ctx, "cat <filename>");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
+	void *data;
+	int len;
+
+	int retval = loadFile(args[0], &data, &len);
+	if (retval == ERROR_OK)
+	{
+		command_print(cmd_ctx, "%s", data);
+		free(data);
+	}
+	else
+	{
+		command_print(cmd_ctx, "%s not found %d", args[0], retval);
+	}
+
+	return ERROR_OK;
+}
+int handle_trunc_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
+{
+	if (argc != 1)
+	{
+		command_print(cmd_ctx, "trunc <filename>");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	FILE *config_file = NULL;
+	config_file = fopen(args[0], "w");
+	if (config_file != NULL)
+		fclose(config_file);
+
+	return ERROR_OK;
+}
+
+
+int handle_meminfo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	static int prev = 0;
+	struct mallinfo info;
+
+	if (argc != 0)
+	{
+		command_print(cmd_ctx, "meminfo");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	info = mallinfo();
+
+	if (prev > 0)
+	{
+		command_print(cmd_ctx, "Diff:            %d", prev - info.fordblks);
+	}
+	prev = info.fordblks;
+
+	command_print(cmd_ctx, "Available ram:   %d", info.fordblks );
+
+	return ERROR_OK;
+}
+
+
+int handle_append_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
+{
+	if (argc < 1)
+	{
+		command_print(cmd_ctx,
+				"append <filename> [<string1>, [<string2>, ...]]");
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	FILE *config_file = NULL;
+	config_file = fopen(args[0], "a");
+	if (config_file != NULL)
+	{
+		int i;
+		fseek(config_file, 0, SEEK_END);
+
+		for (i = 1; i < argc; i++)
+		{
+			fwrite(args[i], strlen(args[i]), 1, config_file);
+			if (i != argc - 1)
+			{
+				fwrite(" ", 1, 1, config_file);
+			}
+		}
+		fwrite("\n", 1, 1, config_file);
+		fclose(config_file);
+	}
+
+	return ERROR_OK;
+}
+
+
+
+int handle_cp_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 2)
+	{
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
+	void *data;
+	int len;
+
+	int retval = loadFile(args[0], &data, &len);
+	if (retval != ERROR_OK)
+		return retval;
+
+	FILE *f = fopen(args[1], "wb");
+	if (f == NULL)
+		retval = ERROR_INVALID_ARGUMENTS;
+
+	int pos = 0;
+	for (;;)
+	{
+		int chunk = len - pos;
+		static const int maxChunk = 512 * 1024; // ~1/sec
+		if (chunk > maxChunk)
+		{
+			chunk = maxChunk;
+		}
+
+		if ((retval==ERROR_OK)&&(fwrite(((char *)data)+pos, 1, chunk, f)!=chunk))
+			retval = ERROR_INVALID_ARGUMENTS;
+
+		if (retval != ERROR_OK)
+		{
+			break;
+		}
+
+		command_print(cmd_ctx, "%d", len - pos);
+
+		pos += chunk;
+
+		if (pos == len)
+			break;
+	}
+
+	if (retval == ERROR_OK)
+	{
+		command_print(cmd_ctx, "Copied %s to %s", args[0], args[1]);
+	} else
+	{
+		command_print(cmd_ctx, "Failed: %d", retval);
+	}
+
+	if (data != NULL)
+		free(data);
+	if (f != NULL)
+		fclose(f);
+
+	if (retval != ERROR_OK)
+		unlink(args[1]);
+
+	return retval;
+}
+
+
+
+
+#define SHOW_RESULT(a, b) LOG_ERROR(#a " failed %d\n", (int)b)
+
+#define IOSIZE 512
+void copyfile(char *name2, char *name1)
+{
+
+	int err;
+	char buf[IOSIZE];
+	int fd1, fd2;
+	ssize_t done, wrote;
+
+	fd1 = open(name1, O_WRONLY | O_CREAT);
+	if (fd1 < 0)
+		SHOW_RESULT( open, fd1 );
+
+	fd2 = open(name2, O_RDONLY);
+	if (fd2 < 0)
+		SHOW_RESULT( open, fd2 );
+
+	for (;;)
+	{
+		done = read(fd2, buf, IOSIZE );
+		if (done < 0)
+		{
+			SHOW_RESULT( read, done );
+			break;
+		}
+
+        if( done == 0 ) break;
+
+		wrote = write(fd1, buf, done);
+        if( wrote != done ) SHOW_RESULT( write, wrote );
+
+        if( wrote != done ) break;
+	}
+
+	err = close(fd1);
+    if( err < 0 ) SHOW_RESULT( close, err );
+
+	err = close(fd2);
+    if( err < 0 ) SHOW_RESULT( close, err );
+
+}
+
+/* utility fn to copy a directory */
+void copydir(char *name, char *destdir)
+{
+	int err;
+	DIR *dirp;
+
+	dirp = opendir(destdir);
+	if (dirp==NULL)
+	{
+		mkdir(destdir, 0777);
+	} else
+	{
+		err = closedir(dirp);
+	}
+
+	dirp = opendir(name);
+    if( dirp == NULL ) SHOW_RESULT( opendir, -1 );
+
+	for (;;)
+	{
+		struct dirent *entry = readdir(dirp);
+
+		if (entry == NULL)
+			break;
+
+		if (strcmp(entry->d_name, ".") == 0)
+			continue;
+		if (strcmp(entry->d_name, "..") == 0)
+			continue;
+
+		int isDir = 0;
+		struct stat buf;
+		char fullPath[PATH_MAX];
+		strncpy(fullPath, name, PATH_MAX);
+		strcat(fullPath, "/");
+		strncat(fullPath, entry->d_name, PATH_MAX - strlen(fullPath));
+
+		if (stat(fullPath, &buf) == -1)
+		{
+			LOG_ERROR("unable to read status from %s", fullPath);
+			break;
+		}
+		isDir = S_ISDIR(buf.st_mode) != 0;
+
+		if (isDir)
+			continue;
+
+		//        diag_printf("<INFO>: entry %14s",entry->d_name);
+		char fullname[PATH_MAX];
+		char fullname2[PATH_MAX];
+
+		strcpy(fullname, name);
+		strcat(fullname, "/");
+		strcat(fullname, entry->d_name);
+
+		strcpy(fullname2, destdir);
+		strcat(fullname2, "/");
+		strcat(fullname2, entry->d_name);
+		//        diag_printf("from %s to %s\n", fullname, fullname2);
+		copyfile(fullname, fullname2);
+
+		//       diag_printf("\n");
+	}
+
+	err = closedir(dirp);
+    if( err < 0 ) SHOW_RESULT( stat, err );
+}
+
+
+
+
+static int
+zylinjtag_Jim_Command_rm(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
+{
+	int del;
+	if (argc != 2)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "rm ?dirorfile?");
+		return JIM_ERR;
+	}
+
+	del = 0;
+	if (unlink(Jim_GetString(argv[1], NULL)) == 0)
+		del = 1;
+	if (rmdir(Jim_GetString(argv[1], NULL)) == 0)
+		del = 1;
+
+	return del ? JIM_OK : JIM_ERR;
+}
+
+
+static int
+zylinjtag_Jim_Command_ls(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
+{
+	if (argc != 2)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "ls ?dir?");
+		return JIM_ERR;
+	}
+
+	char *name = (char*) Jim_GetString(argv[1], NULL);
+
+	DIR *dirp = NULL;
+	dirp = opendir(name);
+	if (dirp == NULL)
+	{
+		return JIM_ERR;
+	}
+	Jim_Obj *objPtr = Jim_NewListObj(interp, NULL, 0);
+
+	for (;;)
+	{
+		struct dirent *entry = NULL;
+		entry = readdir(dirp);
+		if (entry == NULL)
+			break;
+
+		if ((strcmp(".", entry->d_name)==0)||(strcmp("..", entry->d_name)==0))
+			continue;
+
+        Jim_ListAppendElement(interp, objPtr, Jim_NewStringObj(interp, entry->d_name, strlen(entry->d_name)));
+	}
+	closedir(dirp);
+
+	Jim_SetResult(interp, objPtr);
+
+	return JIM_OK;
+}
+
+int handle_peek_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 1)
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+	volatile int *address=(volatile int *)strtoul(args[0], NULL, 0);
+	int value=*address;
+	command_print(cmd_ctx, "0x%x : 0x%x", address, value);
+	return ERROR_OK;
+}
+
+int handle_poke_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 2)
+	{
+		return ERROR_INVALID_ARGUMENTS;
+	}
+	volatile int *address=(volatile int *)strtoul(args[0], NULL, 0);
+	int value=strtoul(args[1], NULL, 0);
+	*address=value;
+	return ERROR_OK;
+}
+
+static int
+zylinjtag_Jim_Command_peek(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
+{
+	if (argc != 2)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "peek ?address?");
+		return JIM_ERR;
+	}
+
+	long address;
+	if (Jim_GetLong(interp, argv[1], &address) != JIM_OK)
+		return JIM_ERR;
+
+	int value = *((volatile int *) address);
+
+	Jim_SetResult(interp, Jim_NewIntObj(interp, value));
+
+	return JIM_OK;
+}
+
+static int
+zylinjtag_Jim_Command_poke(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
+{
+	if (argc != 3)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "poke ?address? ?value?");
+		return JIM_ERR;
+	}
+
+	long address;
+	if (Jim_GetLong(interp, argv[1], &address) != JIM_OK)
+		return JIM_ERR;
+	long value;
+	if (Jim_GetLong(interp, argv[2], &value) != JIM_OK)
+		return JIM_ERR;
+
+	*((volatile int *) address) = value;
+
+	return JIM_OK;
+}
+
+int ioutil_init(struct command_context_s *cmd_ctx)
+{
+	register_command(cmd_ctx, NULL, "rm", handle_rm_command, COMMAND_ANY,
+			"remove file");
+
+	register_command(cmd_ctx, NULL, "cat", handle_cat_command, COMMAND_ANY,
+			"display file content");
+
+	register_command(cmd_ctx, NULL, "trunc", handle_trunc_command, COMMAND_ANY,
+			"truncate a file to 0 size");
+
+	register_command(cmd_ctx, NULL, "cp", handle_cp_command,
+					 COMMAND_ANY, "copy a file <from> <to>");
+
+	register_command(cmd_ctx, NULL, "append_file", handle_append_command,
+			COMMAND_ANY, "append a variable number of strings to a file");
+
+	register_command(cmd_ctx, NULL, "meminfo", handle_meminfo_command,
+			COMMAND_ANY, "display available ram memory");
+
+    Jim_CreateCommand(interp, "rm", zylinjtag_Jim_Command_rm, NULL, NULL);
+
+    Jim_CreateCommand(interp, "peek", zylinjtag_Jim_Command_peek, NULL, NULL);
+    Jim_CreateCommand(interp, "poke", zylinjtag_Jim_Command_poke, NULL, NULL);
+    Jim_CreateCommand(interp, "ls", zylinjtag_Jim_Command_ls, NULL, NULL);
+
+
+    return ERROR_OK;
+}
+
+


Property changes on: trunk/src/helper/ioutil.c
___________________________________________________________________
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Tue Dec 16 11:22:25 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 16 Dec 2008 11:22:25 +0100
Subject: [Openocd-svn] r1246 - trunk/src/helper
Message-ID: <200812161022.mBGAMPQi020992@sheep.berlios.de>

Author: oharboe
Date: 2008-12-16 11:22:24 +0100 (Tue, 16 Dec 2008)
New Revision: 1246

Modified:
   trunk/src/helper/command.c
Log:
fix broken -c/f options where it would silently terminate for scripts that did not set the return value.

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2008-12-15 16:10:18 UTC (rev 1245)
+++ trunk/src/helper/command.c	2008-12-16 10:22:24 UTC (rev 1246)
@@ -290,9 +290,9 @@
 
 	/* find command */
 	c = context->commands;
-	
+
 	while(NULL != c)
-	{		
+	{
 		if (strcmp(name, c->name) == 0)
 		{
 			/* unlink command */
@@ -305,7 +305,7 @@
 				/* first element in command list */
 				context->commands = c->next;
 			}
-			
+
 			/* unregister children */
 			while(NULL != c->children)
 			{
@@ -316,7 +316,7 @@
 				free(c2);
 				c2 = NULL;
 			}
-			
+
 			/* delete command */
 			free(c->name);
 			c->name = NULL;
@@ -324,7 +324,7 @@
 			c = NULL;
 			return ERROR_OK;
 		}
-		
+
 		/* remember the last command for unlinking */
 		p = c;
 		c = c->next;
@@ -479,21 +479,20 @@
 		int reslen;
 
 		result = Jim_GetString(Jim_GetResult(interp), &reslen);
-		if (reslen) {
-			int i;
-			char buff[256+1];
-			for (i = 0; i < reslen; i += 256)
-			{
-				int chunk;
-				chunk = reslen - i;
-				if (chunk > 256)
-					chunk = 256;
-				strncpy(buff, result+i, chunk);
-				buff[chunk] = 0;
-				LOG_USER_N("%s", buff);
-			}
-			LOG_USER_N("%s", "\n");
+		int i;
+		char buff[256+1];
+		for (i = 0; i < reslen; i += 256)
+		{
+			int chunk;
+			chunk = reslen - i;
+			if (chunk > 256)
+				chunk = 256;
+			strncpy(buff, result+i, chunk);
+			buff[chunk] = 0;
+			LOG_USER_N("%s", buff);
 		}
+		LOG_USER_N("%s", "\n");
+		retval=ERROR_OK;
 	}
 	return retval;
 }



From oharboe at mail.berlios.de  Tue Dec 16 11:55:09 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 16 Dec 2008 11:55:09 +0100
Subject: [Openocd-svn] r1247 - trunk/src/server
Message-ID: <200812161055.mBGAt9Ml023521@sheep.berlios.de>

Author: oharboe
Date: 2008-12-16 11:55:08 +0100 (Tue, 16 Dec 2008)
New Revision: 1247

Modified:
   trunk/src/server/gdb_server.c
Log:
allow setting/reading gdb_port at any time

Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2008-12-16 10:22:24 UTC (rev 1246)
+++ trunk/src/server/gdb_server.c	2008-12-16 10:55:08 UTC (rev 1247)
@@ -180,7 +180,7 @@
 				return retval;
 			gdb_con->buf_cnt = read_socket(connection->fd, gdb_con->buffer, GDB_BUFFER_SIZE);
 		}
-		
+
 		if (gdb_con->buf_cnt > 0)
 		{
 			break;
@@ -276,7 +276,7 @@
 	gdb_connection_t *gdb_con = connection->priv;
 	if (gdb_con->closed)
 		return ERROR_SERVER_REMOTE_CLOSED;
-	
+
 	if (connection->service->type == CONNECTION_PIPE)
 	{
 		/* write to stdout */
@@ -2205,7 +2205,7 @@
 	if (server_use_pipes)
 	{
 		/* only a single gdb connection when using a pipe */
-		
+
 		gdb_service = malloc(sizeof(gdb_service_t));
 		gdb_service->target = target;
 
@@ -2221,12 +2221,12 @@
 			gdb_service->target = target;
 
 			add_service("gdb", CONNECTION_TCP, gdb_port + target->target_number, 1, gdb_new_connection, gdb_input, gdb_connection_closed, gdb_service);
-			
+
 			LOG_DEBUG("gdb service for target %s at port %i", target->type->name, gdb_port + target->target_number);
 			target = target->next;
 		}
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -2377,7 +2377,7 @@
 int gdb_register_commands(command_context_t *command_context)
 {
 	register_command(command_context, NULL, "gdb_port", handle_gdb_port_command,
-			COMMAND_CONFIG, "daemon configuration command gdb_port");
+			COMMAND_ANY, "daemon configuration command gdb_port");
 	register_command(command_context, NULL, "gdb_detach", handle_gdb_detach_command,
 			COMMAND_CONFIG, "");
 	register_command(command_context, NULL, "gdb_memory_map", handle_gdb_memory_map_command,



From oharboe at mail.berlios.de  Tue Dec 16 12:49:23 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 16 Dec 2008 12:49:23 +0100
Subject: [Openocd-svn] r1248 - trunk/src/jtag
Message-ID: <200812161149.mBGBnNCc016915@sheep.berlios.de>

Author: oharboe
Date: 2008-12-16 12:49:14 +0100 (Tue, 16 Dec 2008)
New Revision: 1248

Modified:
   trunk/src/jtag/dummy.c
Log:
jtag_khz simulation

Modified: trunk/src/jtag/dummy.c
===================================================================
--- trunk/src/jtag/dummy.c	2008-12-16 10:55:08 UTC (rev 1247)
+++ trunk/src/jtag/dummy.c	2008-12-16 11:49:14 UTC (rev 1248)
@@ -30,18 +30,24 @@
 int dummy_register_commands(struct command_context_s *cmd_ctx);
 int dummy_init(void);
 int dummy_quit(void);
+static int dummy_khz(int khz, int *jtag_speed);
+static int dummy_speed_div(int speed, int *khz);
 
-/* The dummy driver is used to easily check the code path 
+
+/* The dummy driver is used to easily check the code path
  * where the target is unresponsive.
  */
-jtag_interface_t dummy_interface = 
+jtag_interface_t dummy_interface =
 {
 	.name = "dummy",
-	
+
 	.execute_queue = bitbang_execute_queue,
 
-	.speed = dummy_speed,	
+	.speed = dummy_speed,
 	.register_commands = dummy_register_commands,
+	.khz = dummy_khz,
+	.speed_div = dummy_speed_div,
+
 	.init = dummy_init,
 	.quit = dummy_quit,
 };
@@ -72,6 +78,33 @@
 {
 }
 
+static int dummy_khz(int khz, int *jtag_speed)
+{
+	if (khz==0)
+	{
+		*jtag_speed=0;
+	}
+	else
+	{
+		*jtag_speed=64000/khz;
+	}
+	return ERROR_OK;
+}
+
+static int dummy_speed_div(int speed, int *khz)
+{
+	if (speed==0)
+	{
+		*khz = 0;
+	}
+	else
+	{
+		*khz=64000/speed;
+	}
+
+	return ERROR_OK;
+}
+
 int dummy_speed(int speed)
 {
 	return ERROR_OK;
@@ -84,7 +117,7 @@
 
 int dummy_init(void)
 {
-	bitbang_interface = &dummy_bitbang;	
+	bitbang_interface = &dummy_bitbang;
 
 	return ERROR_OK;
 }



From oharboe at mail.berlios.de  Tue Dec 16 20:29:52 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 16 Dec 2008 20:29:52 +0100
Subject: [Openocd-svn] r1249 - trunk/doc
Message-ID: <200812161929.mBGJTqEB011505@sheep.berlios.de>

Author: oharboe
Date: 2008-12-16 20:29:50 +0100 (Tue, 16 Dec 2008)
New Revision: 1249

Modified:
   trunk/doc/openocd.texi
Log:
Dirk Behme <dirk.behme at googlemail.com> Fix some typos in documentation

 

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-16 11:49:14 UTC (rev 1248)
+++ trunk/doc/openocd.texi	2008-12-16 19:29:50 UTC (rev 1249)
@@ -544,7 +544,7 @@
 
 @enumerate
 @item The RESET configuration of your debug environment as a hole
- at item Is there a ``work area'' that that OpenOCD can use?
+ at item Is there a ``work area'' that OpenOCD can use?
 @* For ARM - work areas mean up to 10x faster downloads.
 @item For MMU/MPU based ARM chips (ie: ARM9 and later) will that work area still be available?
 @item For complex targets (multiple chips) the JTAG SPEED becomes an issue.
@@ -920,7 +920,7 @@
 
 @node Daemon Configuration
 @chapter Daemon Configuration
-The commands here are commonly found inthe openocd.cfg file and are
+The commands here are commonly found in the openocd.cfg file and are
 used to specify what TCP/IP ports are used, and how GDB should be
 supported.
 @section init
@@ -1492,9 +1492,9 @@
 by the ``jtag newtap'' command. The documentation remains here so that
 one can easily convert the old syntax to the new syntax. About the old
 syntax: The old syntax is positional, ie: The 4th parameter is the
-``irmask'' The new syntax requires named prefixes, and supports
-additional options, for example ``-irmask 4'' Please refer to the
- at b{jtag newtap} command for deails.
+``irmask''. The new syntax requires named prefixes, and supports
+additional options, for example ``-irmask 4''. Please refer to the
+ at b{jtag newtap} command for details.
 @example
 OLD: jtag_device 8 0x01 0x0e3 0xfe
 NEW: jtag newtap CHIPNAME TAPNAME -irlen 8 -ircapture 0xe3 -irmask 0xfe
@@ -1543,7 +1543,7 @@
 
 @b{jtag tapisenabled DOTTED.NAME}
 
-This command return 1 if the named tap is currently enabled, 0 if not.
+This command returns 1 if the named tap is currently enabled, 0 if not.
 This command exists so that scripts that manipulate a JRC (like the
 Omap3530 has) can determine if OpenOCD thinks a tap is presently
 enabled, or disabled.
@@ -1558,7 +1558,7 @@
 @section targets [NAME]
 @b{Note:} This command name is PLURAL - not singular.  
 
-With NO parameter, this pural @b{targets} command lists all known
+With NO parameter, this plural @b{targets} command lists all known
 targets in a human friendly form.
 
 With a parameter, this pural @b{targets} command sets the current
@@ -1690,13 +1690,13 @@
 @end itemize
 
 @section Target Events
-At various times, certian things happen, or you want to happen.
+At various times, certain things can happen, or you want them to happen.
 
 Examples:
 @itemize @bullet
 @item What should happen when GDB connects? Should your target reset?
 @item When GDB tries to flash the target, do you need to enable the flash via a special command?
- at item During reset, do you need to write to certian memory locations to reconfigure the SDRAM?
+ at item During reset, do you need to write to certain memory location to reconfigure the SDRAM?
 @end itemize
 
 All of the above items are handled by target events.
@@ -1708,7 +1708,7 @@
 target event name, and BODY is a tcl procedure or string of commands
 to execute. 
 
-The programers model is the: ``-command'' option used in Tcl/Tk
+The programmers model is the ``-command'' option used in Tcl/Tk
 buttons and events. Below are two identical examples, the first
 creates and invokes small procedure. The second inlines the procedure.
 
@@ -1822,13 +1822,13 @@
 @comment end TYPES
 @end itemize
 @item @b{PARAMS}
-@*PARAMs are various target configure parameters, the following are manditory
-at configuration.
- at comment START manditory
+@*PARAMs are various target configure parameters, the following are mandatory
+at configuration:
+ at comment START mandatory
 @itemize @bullet
 @item @b{-endian big|little}
 @item @b{-chain-position DOTTED.NAME}
- at comment end MANDITORY
+ at comment end MANDATORY
 @end itemize
 @comment END params
 @end itemize
@@ -3269,7 +3269,7 @@
 @section TCL Rule #1
 There is a famous joke, it goes like this:
 @enumerate
- at item Rule #1: The wife is aways correct
+ at item Rule #1: The wife is always correct
 @item Rule #2: If you think otherwise, See Rule #1
 @end enumerate
 
@@ -3280,7 +3280,7 @@
 @item Rule #2: If you think otherwise, See Rule #1
 @end enumerate
 
-As in the famous joke, the consiquences of Rule #1 are profound. Once
+As in the famous joke, the consequences of Rule #1 are profound. Once
 you understand Rule #1, you will understand TCL.
 
 @section TCL Rule #1b
@@ -3350,9 +3350,9 @@
 28/nov/2008, Jim/OpenOCD does not have a date command.
 @end itemize
 
- at section Consiquences of Rule 1/2/3/4
+ at section Consequences of Rule 1/2/3/4
 
-The consiquences of Rule 1 is profound.
+The consequences of Rule 1 is profound.
 
 @subsection Tokenizing & Execution.
 



From oharboe at mail.berlios.de  Tue Dec 16 22:10:08 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 16 Dec 2008 22:10:08 +0100
Subject: [Openocd-svn] r1250 - trunk/src/helper
Message-ID: <200812162110.mBGLA8Rg025058@sheep.berlios.de>

Author: oharboe
Date: 2008-12-16 22:10:06 +0100 (Tue, 16 Dec 2008)
New Revision: 1250

Modified:
   trunk/src/helper/jim.c
   trunk/src/helper/jim.h
Log:
sync up to latest jim tcl

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2008-12-16 19:29:50 UTC (rev 1249)
+++ trunk/src/helper/jim.c	2008-12-16 21:10:06 UTC (rev 1250)
@@ -7,6 +7,7 @@
  * Copyright 2008 Andrew Lunn <andrew at lunn.ch>
  * Copyright 2008 Duane Ellis <openocd at duaneellis.com>
  * Copyright 2008 Uwe Klein <uklein at klein-messgeraete.de>
+ * Copyright 2008 Steve Bennett <steveb at workware.net.au>
  * 
  * The FreeBSD license
  * 
@@ -85,6 +86,10 @@
 #endif /* WIN32 */
 #endif /* JIM_DYNLIB */
 
+#ifndef WIN32
+#include <unistd.h>
+#endif
+
 #ifdef __ECOS
 #include <cyg/jimtcl/jim.h>
 #else
@@ -1325,19 +1330,21 @@
     if (brace) {
         while (!stop) {
             if (*pc->p == '}' || pc->len == 0) {
+                pc->tend = pc->p-1;
                 stop = 1;
                 if (pc->len == 0)
-                    continue;
+                    break;
             }
             else if (*pc->p == '\n')
                 pc->linenr++;
             pc->p++; pc->len--;
         }
-        if (pc->len == 0)
-            pc->tend = pc->p-1;
-        else
-            pc->tend = pc->p-2;
     } else {
+        /* Include leading colons */
+        while (*pc->p == ':') {
+            pc->p++;
+            pc->len--;
+        }
         while (!stop) {
             if (!((*pc->p >= 'a' && *pc->p <= 'z') ||
                 (*pc->p >= 'A' && *pc->p <= 'Z') ||
@@ -2197,9 +2204,14 @@
 
 static Jim_Obj *JimStringToLower(Jim_Interp *interp, Jim_Obj *strObjPtr)
 {
-    char *buf = Jim_Alloc(strObjPtr->length+1);
+    char *buf;
     int i;
+    if (strObjPtr->typePtr != &stringObjType) {
+        SetStringFromAny(interp, strObjPtr);
+    }
 
+    buf = Jim_Alloc(strObjPtr->length+1);
+
     memcpy(buf, strObjPtr->bytes, strObjPtr->length+1);
     for (i = 0; i < strObjPtr->length; i++)
         buf[i] = tolower(buf[i]);
@@ -2208,9 +2220,14 @@
 
 static Jim_Obj *JimStringToUpper(Jim_Interp *interp, Jim_Obj *strObjPtr)
 {
-    char *buf = Jim_Alloc(strObjPtr->length+1);
+    char *buf;
     int i;
+    if (strObjPtr->typePtr != &stringObjType) {
+        SetStringFromAny(interp, strObjPtr);
+    }
 
+    buf = Jim_Alloc(strObjPtr->length+1);
+
     memcpy(buf, strObjPtr->bytes, strObjPtr->length+1);
     for (i = 0; i < strObjPtr->length; i++)
         buf[i] = toupper(buf[i]);
@@ -2289,32 +2306,32 @@
 			/* non-terminals */
 		case '0': /* zero pad */
 			zpad = 1;
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			goto next_fmt;
 			break;
 		case '+':
 			forceplus = 1;
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			goto next_fmt;
 			break;
 		case ' ': /* sign space */
 			spad = 1;
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			goto next_fmt;
 			break;
 		case '-':
 			ljust = 1;
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			goto next_fmt;
 			break;
 		case '#':
 			altfm = 1;
-			*fmt++; fmtLen--;
+			fmt++; fmtLen--;
  			goto next_fmt;
-
+			
 		case '.':
 			inprec = 1;
-			*fmt++; fmtLen--;
+			fmt++; fmtLen--;
  			goto next_fmt;
 			break;
 		case '1':
@@ -2340,7 +2357,7 @@
 			goto next_fmt;
 		case '*':
 			/* suck up the next item as an integer */
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			objc--;
 			if( objc <= 0 ){
 				goto not_enough_args;
@@ -2358,12 +2375,12 @@
 					prec = 0;
 				}
 			} else {
-				width = wideValue;
-				if( width < 0 ){
-					ljust = 1;
-					width = -width;
-				}
+			width = wideValue;
+			if( width < 0 ){
+				ljust = 1;
+				width = -width;
 			}
+			}
 			objv++;
 			goto next_fmt;
 			break;
@@ -2455,6 +2472,7 @@
 			break;
         case 'b':
         case 'd':
+        case 'o':
 		case 'i':
 		case 'u':
 		case 'x':
@@ -3009,7 +3027,7 @@
         initialLineNumber = objPtr->internalRep.sourceValue.lineNumber;
         propagateSourceInfo = 1;
     } else {
-        script->fileName = Jim_StrDup("?");
+        script->fileName = Jim_StrDup("");
         initialLineNumber = 1;
     }
 
@@ -3161,9 +3179,6 @@
     he = Jim_FindHashEntry(&interp->commands, cmdName);
     if (he == NULL) { /* New command to create */
         cmdPtr = Jim_Alloc(sizeof(*cmdPtr));
-        cmdPtr->cmdProc = cmdProc;
-        cmdPtr->privData = privData;
-        cmdPtr->delProc = delProc;
         Jim_AddHashEntry(&interp->commands, cmdName, cmdPtr);
     } else {
         Jim_InterpIncrProcEpoch(interp);
@@ -3181,9 +3196,13 @@
             /* If it was a C coded command, call the delProc if any */
             cmdPtr->delProc(interp, cmdPtr->privData);
         }
-        cmdPtr->cmdProc = cmdProc;
-        cmdPtr->privData = privData;
     }
+
+    /* Store the new details for this proc */
+    cmdPtr->delProc = delProc;
+    cmdPtr->cmdProc = cmdProc;
+    cmdPtr->privData = privData;
+
     /* There is no need to increment the 'proc epoch' because
      * creation of a new procedure can never affect existing
      * cached commands. We don't do negative caching. */
@@ -3463,15 +3482,23 @@
     /* Make sure it's not syntax glue to get/set dict. */
     if (Jim_NameIsDictSugar(varName, len))
             return JIM_DICT_SUGAR;
-    /* Lookup this name into the variables hash table */
-    he = Jim_FindHashEntry(&interp->framePtr->vars, varName);
-    if (he == NULL) {
-        /* Try with static vars. */
-        if (interp->framePtr->staticVars == NULL)
+    if (varName[0] == ':' && varName[1] == ':') {
+        he = Jim_FindHashEntry(&interp->topFramePtr->vars, varName + 2);
+        if (he == NULL) {
             return JIM_ERR;
-        if (!(he = Jim_FindHashEntry(interp->framePtr->staticVars, varName)))
-            return JIM_ERR;
+        }
     }
+    else {
+        /* Lookup this name into the variables hash table */
+        he = Jim_FindHashEntry(&interp->framePtr->vars, varName);
+        if (he == NULL) {
+            /* Try with static vars. */
+            if (interp->framePtr->staticVars == NULL)
+                return JIM_ERR;
+            if (!(he = Jim_FindHashEntry(interp->framePtr->staticVars, varName)))
+                return JIM_ERR;
+        }
+    }
     /* Free the old internal repr and set the new one. */
     Jim_FreeIntRep(interp, objPtr);
     objPtr->typePtr = &variableObjType;
@@ -3509,7 +3536,13 @@
         Jim_IncrRefCount(valObjPtr);
         var->linkFramePtr = NULL;
         /* Insert the new variable */
-        Jim_AddHashEntry(&interp->framePtr->vars, name, var);
+        if (name[0] == ':' && name[1] == ':') {
+            /* Into to the top evel frame */
+            Jim_AddHashEntry(&interp->topFramePtr->vars, name + 2, var);
+        }
+        else {
+            Jim_AddHashEntry(&interp->framePtr->vars, name, var);
+        }
         /* Make the object int rep a variable */
         Jim_FreeIntRep(interp, nameObjPtr);
         nameObjPtr->typePtr = &variableObjType;
@@ -4410,6 +4443,7 @@
     i->result = i->emptyObj;
     i->stackTrace = Jim_NewListObj(i, NULL, 0);
     i->unknown = Jim_NewStringObj(i, "unknown", -1);
+    i->unknown_called = 0;
     Jim_IncrRefCount(i->emptyObj);
     Jim_IncrRefCount(i->result);
     Jim_IncrRefCount(i->stackTrace);
@@ -4624,6 +4658,11 @@
 static void JimAppendStackTrace(Jim_Interp *interp, const char *procname,
         const char *filename, int linenr)
 {
+    /* No need to add this dummy entry to the stack trace */
+    if (strcmp(procname, "unknown") == 0) {
+        return;
+    }
+
     if (Jim_IsShared(interp->stackTrace)) {
         interp->stackTrace =
             Jim_DuplicateObj(interp, interp->stackTrace);
@@ -6592,7 +6631,7 @@
             case JIM_EXPROP_STRING:
                 break;
             default:
-                op = JimExprOperatorInfoByOpcode(expr->opcode[i]);
+                op = JimExprOperatorInfoByOpcode(expr->opcode[leftindex]);
                 if (op == NULL) {
                     Jim_Panic(interp,"Default reached in ExprMakeLazy()");
                 }
@@ -6982,6 +7021,16 @@
             /* --- Double --- */
             if (Jim_GetDouble(interp, A, &dA) != JIM_OK ||
                 Jim_GetDouble(interp, B, &dB) != JIM_OK) {
+
+                /* Hmmm! For compatibility, maybe convert != and == into ne and eq */
+                if (expr->opcode[i] == JIM_EXPROP_NUMNE) {
+                    opcode = JIM_EXPROP_STRNE;
+                    goto retry_as_string;
+                }
+                else if (expr->opcode[i] == JIM_EXPROP_NUMEQ) {
+                    opcode = JIM_EXPROP_STREQ;
+                    goto retry_as_string;
+                }
                 Jim_DecrRefCount(interp, A);
                 Jim_DecrRefCount(interp, B);
                 error = 1;
@@ -7043,9 +7092,10 @@
         } else if (opcode == JIM_EXPROP_STREQ || opcode == JIM_EXPROP_STRNE) {
             B = stack[--stacklen];
             A = stack[--stacklen];
+retry_as_string:
             sA = Jim_GetString(A, &Alen);
             sB = Jim_GetString(B, &Blen);
-            switch(expr->opcode[i]) {
+            switch(opcode) {
             case JIM_EXPROP_STREQ:
                 if (Alen == Blen && memcmp(sA, sB, Alen) ==0)
                     wC = 1;
@@ -7877,21 +7927,21 @@
             if (Jim_ListIndex(interp, libPathObjPtr, i,
                     &prefixObjPtr, JIM_NONE) != JIM_OK)
                 continue;
-            prefix = Jim_GetString(prefixObjPtr, NULL);
-            prefixlen = strlen(prefix);
+            prefix = Jim_GetString(prefixObjPtr, &prefixlen);
             if (prefixlen+strlen(pathName)+1 >= JIM_PATH_LEN)
                 continue;
-            if (prefixlen && prefix[prefixlen-1] == '/')
+            if (*pathName == '/') {
+                strcpy(buf, pathName);
+            }    
+            else if (prefixlen && prefix[prefixlen-1] == '/')
                 sprintf(buf, "%s%s", prefix, pathName);
             else
                 sprintf(buf, "%s/%s", prefix, pathName);
-            printf("opening '%s'\n", buf);
             fp = fopen(buf, "r");
             if (fp == NULL)
                 continue;
             fclose(fp);
             handle = dlopen(buf, RTLD_LAZY);
-            printf("got handle %p\n", handle);
         }
         if (handle == NULL) {
             Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
@@ -8235,6 +8285,9 @@
     Jim_HashEntry *he;
     int requiredVer;
 
+    /* Start with an empty error string */
+    Jim_SetResultString(interp, "", 0);
+
     if (JimPackageVersionToInt(interp, ver, &requiredVer, JIM_ERRMSG) != JIM_OK)
         return NULL;
     he = Jim_FindHashEntry(&interp->packages, name);
@@ -8249,8 +8302,9 @@
         }
         /* No way... return an error. */
         if (flags & JIM_ERRMSG) {
-            Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-            Jim_AppendStrings(interp, Jim_GetResult(interp),
+            int len;
+            Jim_GetString(Jim_GetResult(interp), &len);
+            Jim_AppendStrings(interp, Jim_GetResult(interp), len ? "\n" : "",
                     "Can't find package '", name, "'", NULL);
         }
         return NULL;
@@ -8263,7 +8317,6 @@
         }
         /* Check if version matches. */
         if (JimPackageMatchVersion(requiredVer, actualVer, flags) == 0) {
-            Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
             Jim_AppendStrings(interp, Jim_GetResult(interp),
                     "Package '", name, "' already loaded, but with version ",
                     he->val, NULL);
@@ -8288,6 +8341,13 @@
     Jim_Obj **v, *sv[JIM_EVAL_SARGV_LEN];
     int retCode;
 
+    /* If JimUnknown() is recursively called (e.g. error in the unknown proc,
+     * done here
+     */
+    if (interp->unknown_called) {
+        return JIM_ERR;
+    }
+
     /* If the [unknown] command does not exists returns
      * just now */
     if (Jim_GetCommand(interp, interp->unknown, JIM_NONE) == NULL)
@@ -8308,7 +8368,10 @@
     memcpy(v+1, argv, sizeof(Jim_Obj*)*argc);
     v[0] = interp->unknown;
     /* Call it */
+    interp->unknown_called++;
     retCode = Jim_EvalObjVector(interp, argc+1, v);
+    interp->unknown_called--;
+
     /* Clean up */
     if (v != sv)
         Jim_Free(v);
@@ -8342,12 +8405,16 @@
         if (cmdPtr->cmdProc) {
             interp->cmdPrivData = cmdPtr->privData;
             retcode = cmdPtr->cmdProc(interp, objc, objv);
+            if (retcode == JIM_ERR_ADDSTACK) {
+                //JimAppendStackTrace(interp, "", script->fileName, token[i-argc*2].linenr);
+                retcode = JIM_ERR;
+            }
         } else {
             retcode = JimCallProcedure(interp, cmdPtr, objc, objv);
-    if (retcode == JIM_ERR) {
-        JimAppendStackTrace(interp,
-            Jim_GetString(objv[0], NULL), "?", 1);
-    }
+            if (retcode == JIM_ERR) {
+                JimAppendStackTrace(interp,
+                    Jim_GetString(objv[0], NULL), "", 1);
+            }
         }
     }
     /* Decr refcount of arguments and return the retcode */
@@ -8628,6 +8695,10 @@
             if (cmd->cmdProc) {
                 interp->cmdPrivData = cmd->privData;
                 retcode = cmd->cmdProc(interp, argc, argv);
+                if (retcode == JIM_ERR_ADDSTACK) {
+                    JimAppendStackTrace(interp, "", script->fileName, token[i-argc*2].linenr);
+                    retcode = JIM_ERR;
+                }
             } else {
                 retcode = JimCallProcedure(interp, cmd, argc, argv);
                 if (retcode == JIM_ERR) {
@@ -8641,7 +8712,7 @@
             retcode = JimUnknown(interp, argc, argv);
             if (retcode == JIM_ERR) {
                 JimAppendStackTrace(interp,
-                    Jim_GetString(argv[0], NULL), script->fileName,
+                    "", script->fileName,
                     token[i-argc*2].linenr);
             }
         }
@@ -8697,6 +8768,7 @@
 {
     int i, retcode;
     Jim_CallFrame *callFramePtr;
+    int num_args;
 
     /* Check arity */
     if (argc < cmd->arityMin || (cmd->arityMax != -1 &&
@@ -8727,19 +8799,47 @@
     Jim_IncrRefCount(cmd->bodyObjPtr);
     interp->framePtr = callFramePtr;
     interp->numLevels ++;
+
     /* Set arguments */
-    for (i = 0; i < cmd->arityMin-1; i++) {
-        Jim_Obj *objPtr;
+    Jim_ListLength(interp, cmd->argListObjPtr, &num_args);
 
-        Jim_ListIndex(interp, cmd->argListObjPtr, i, &objPtr, JIM_NONE);
-        Jim_SetVariable(interp, objPtr, argv[i+1]);
+    /* If last argument is 'args', don't set it here */
+    if (cmd->arityMax == -1) {
+        num_args--;
     }
+
+    for (i = 0; i < num_args; i++) {
+        Jim_Obj *argObjPtr;
+        Jim_Obj *nameObjPtr;
+        Jim_Obj *valueObjPtr;
+
+        Jim_ListIndex(interp, cmd->argListObjPtr, i, &argObjPtr, JIM_NONE);
+        if (i + 1 >= cmd->arityMin) {
+            /* The name is the first element of the list */
+            Jim_ListIndex(interp, argObjPtr, 0, &nameObjPtr, JIM_NONE);
+        }
+        else {
+            /* The element arg is the name */
+            nameObjPtr = argObjPtr;
+        }
+
+        if (i + 1 >= argc) {
+            /* No more values, so use default */
+            /* The value is the second element of the list */
+            Jim_ListIndex(interp, argObjPtr, 1, &valueObjPtr, JIM_NONE);
+        }
+        else {
+            valueObjPtr = argv[i+1];
+        }
+        Jim_SetVariable(interp, nameObjPtr, valueObjPtr);
+    }
+    /* Set optional arguments */
     if (cmd->arityMax == -1) {
         Jim_Obj *listObjPtr, *objPtr;
 
-        listObjPtr = Jim_NewListObj(interp, argv+cmd->arityMin,
-                argc-cmd->arityMin);
-        Jim_ListIndex(interp, cmd->argListObjPtr, i, &objPtr, JIM_NONE);
+        i++;
+        listObjPtr = Jim_NewListObj(interp, argv+i, argc-i);
+        Jim_ListIndex(interp, cmd->argListObjPtr, num_args, &objPtr, JIM_NONE);
         Jim_SetVariable(interp, objPtr, listObjPtr);
     }
     /* Eval the body */
@@ -10895,17 +10995,31 @@
     }
     Jim_ListLength(interp, argv[2], &argListLen);
     arityMin = arityMax = argListLen+1;
+
     if (argListLen) {
         const char *str;
         int len;
-        Jim_Obj *lastArgPtr;
+        Jim_Obj *argPtr;
         
-        Jim_ListIndex(interp, argv[2], argListLen-1, &lastArgPtr, JIM_NONE);
-        str = Jim_GetString(lastArgPtr, &len);
+        /* Check for 'args' and adjust arityMin and arityMax if necessary */
+        Jim_ListIndex(interp, argv[2], argListLen-1, &argPtr, JIM_NONE);
+        str = Jim_GetString(argPtr, &len);
         if (len == 4 && memcmp(str, "args", 4) == 0) {
             arityMin--;
             arityMax = -1;
         }
+
+        /* Check for default arguments and reduce arityMin if necessary */
+        while (arityMin > 1) {
+            int len;
+            Jim_ListIndex(interp, argv[2], arityMin - 2, &argPtr, JIM_NONE);
+            Jim_ListLength(interp, argPtr, &len);
+            if (len != 2) {
+                /* No default argument */
+                break;
+            }
+            arityMin--;
+        }
     }
     if (argc == 4) {
         return Jim_CreateProcedure(interp, Jim_GetString(argv[1], NULL),
@@ -11537,10 +11651,10 @@
     int cmd, result = JIM_OK;
     static const char *commands[] = {
         "body", "commands", "exists", "globals", "level", "locals",
-        "vars", "version", "complete", "args", NULL
+        "vars", "version", "complete", "args", "hostname", NULL
     };
     enum {INFO_BODY, INFO_COMMANDS, INFO_EXISTS, INFO_GLOBALS, INFO_LEVEL,
-          INFO_LOCALS, INFO_VARS, INFO_VERSION, INFO_COMPLETE, INFO_ARGS};
+          INFO_LOCALS, INFO_VARS, INFO_VERSION, INFO_COMPLETE, INFO_ARGS, INFO_HOSTNAME};
     
     if (argc < 2) {
         Jim_WrongNumArgs(interp, 1, argv, "command ?args ...?");
@@ -11636,6 +11750,10 @@
         s = Jim_GetString(argv[2], &len);
         Jim_SetResult(interp,
                 Jim_NewIntObj(interp, Jim_ScriptIsComplete(s, len, NULL)));
+    } else if (cmd == INFO_HOSTNAME) {
+        /* Redirect to os.hostname if it exists */
+        Jim_Obj *command = Jim_NewStringObj(interp, "os.gethostname", -1);
+        result = Jim_EvalObjVector(interp, 1, &command);
     }
     return result;
 }
@@ -11854,6 +11972,24 @@
     const char *key;
     char *val;
 
+    if (argc == 1) {
+        extern char **environ;
+
+        int i;
+        Jim_Obj *listObjPtr = Jim_NewListObj(interp, NULL, 0);
+
+        for (i = 0; environ[i]; i++) {
+            const char *equals = strchr(environ[i], '=');
+            if (equals) {
+                Jim_ListAppendElement(interp, listObjPtr, Jim_NewStringObj(interp, environ[i], equals - environ[i]));
+                Jim_ListAppendElement(interp, listObjPtr, Jim_NewStringObj(interp, equals + 1, -1));
+            }
+        }
+
+        Jim_SetResult(interp, listObjPtr);
+        return JIM_OK;
+    }
+
     if (argc != 2) {
         Jim_WrongNumArgs(interp, 1, argv, "varName");
         return JIM_ERR;
@@ -11882,6 +12018,9 @@
         return JIM_ERR;
     }
     retval = Jim_EvalFile(interp, Jim_GetString(argv[1], NULL));
+    if (retval == JIM_ERR) {
+        return JIM_ERR_ADDSTACK;
+    }
     if (retval == JIM_RETURN)
         return JIM_OK;
     return retval;
@@ -12031,7 +12170,7 @@
                 argc == 4 ? Jim_GetString(argv[3], NULL) : "",
                 JIM_ERRMSG);
         if (ver == NULL)
-            return JIM_ERR;
+            return JIM_ERR_ADDSTACK;
         Jim_SetResultString(interp, ver, -1);
     } else if (option == OPT_PROVIDE) {
         if (argc != 4) {
@@ -12044,108 +12183,6 @@
     return JIM_OK;
 }
 
-
-static void
-jim_get_s_us( jim_wide *s, jim_wide *us )
-{
-#if defined(WIN32)
-	/* 
-	 * Sorry - I do not have, or use Win32.
-	 * This concept is from 
-	 * 
-	 * Method is from: 
-	 *    http://www.openasthra.com/c-tidbits/gettimeofday-function-for-windows/
-	 *
-	 * I have no method to test/verify.
-	 *  - Duane 6-sep-2008.
-	 * (once verified, please somebody remove this comment)
-	 */
-#if defined(_MSC_VER) || defined(_MSC_EXTENSIONS)
-  #define DELTA_EPOCH_IN_MICROSECS  11644473600000000Ui64
-#else
-  #define DELTA_EPOCH_IN_MICROSECS  11644473600000000ULL
-#endif
-
-	FILETIME ft;
-	unsigned __int64 tmpres;
-	tmpres = 0;
-	GetSystemTimeAsFileTime( &ft );
-
-	tmpres |= ft.dwHighDateTime;
-	tmpres <<= 32;
-	tmpres |= ft.dwLowDateTime;
-	/* convert to unix representation */
-	tmpres /= 10;
-	tmpres -= DELTA_EPOCH_IN_MICROSECS;
-	
-	*s  = (tmpres / 1000000ULL);
-	*us = (tmpres % 1000000ULL);
-	
-#undef DELTA_EPOCH_IN_MICROSECS
-
-#else
-	/* LINUX/CYGWIN */
-	struct timeval tv;
-	struct timezone tz;
-	gettimeofday( &tv, &tz );
-	*s  = tv.tv_sec;
-	*us = tv.tv_usec;
-#endif
-}
-
-
-/* [clock] */
-static int Jim_ClockCoreCommand( Jim_Interp *interp, int argc,
-								   Jim_Obj *const *argv)
-{
-	/*
-	 *  See: TCL man page for 'clock'
-	 *  we do not impliment all features.
-	 */
-	jim_wide r,s,us;
-	int option;
-	const char *options[] = {
-		"clicks",
-		"microseconds",
-		"milliseconds",
-		"seconds",
-		NULL 
-	};
-	enum { OPT_CLICKS, OPT_USEC, OPT_MSEC, OPT_SEC };
-
-	if( argc < 2 ){
-		Jim_WrongNumArgs( interp, 1, argv, "option ?arguments ...?");
-		return JIM_ERR;
-	}
-
-	if( Jim_GetEnum(interp, argv[1], options, &option, "option",
-					JIM_ERRMSG) != JIM_OK ){
-		return JIM_ERR;
-	}
-
-	// platform independent get time.
-	jim_get_s_us( &s, &us );
-
-	r = 0;
-	switch(option){
-	case OPT_CLICKS:
-	case OPT_USEC:
-		/* clicks & usecs are the same */
-		r = (s * 1000000) + us;
-		break;
-	case OPT_MSEC:
-		r = (s * 1000) + (us / 1000);
-		break;
-	case OPT_SEC:
-		r = s;
-		break;
-	}
-		
-	Jim_SetResult( interp, Jim_NewWideObj( interp, r ) );
-	return JIM_OK;
-}
-	 
-
 static struct {
     const char *name;
     Jim_CmdProc cmdProc;
@@ -12210,7 +12247,6 @@
     {"rand", Jim_RandCoreCommand},
     {"package", Jim_PackageCoreCommand},
     {"tailcall", Jim_TailcallCoreCommand},
-	{"clock", Jim_ClockCoreCommand},
     {NULL, NULL},
 };
 
@@ -12250,9 +12286,11 @@
 {
     int len, i;
 
-    Jim_fprintf(interp, interp->cookie_stderr, "Runtime error, file \"%s\", line %d:" JIM_NL,
-				interp->errorFileName, interp->errorLine);
-    Jim_fprintf(interp,interp->cookie_stderr, "    %s" JIM_NL,
+    if (*interp->errorFileName) {
+        Jim_fprintf(interp, interp->cookie_stderr, "Runtime error, file \"%s\", line %d:" JIM_NL "    ",
+                                    interp->errorFileName, interp->errorLine);
+    }
+    Jim_fprintf(interp,interp->cookie_stderr, "%s" JIM_NL,
             Jim_GetString(interp->result, NULL));
     Jim_ListLength(interp, interp->stackTrace, &len);
     for (i = len-3; i >= 0; i-= 3) {
@@ -12267,9 +12305,18 @@
         Jim_ListIndex(interp, interp->stackTrace, i+2, &objPtr,
                 JIM_NONE);
         line = Jim_GetString(objPtr, NULL);
-		Jim_fprintf( interp, interp->cookie_stderr,
-                "In procedure '%s' called at file \"%s\", line %s" JIM_NL,
-                proc, file, line);
+        if (*proc) {
+            Jim_fprintf( interp, interp->cookie_stderr,
+                    "in procedure '%s' ", proc);
+        }
+        if (*file) {
+            Jim_fprintf( interp, interp->cookie_stderr,
+                    "called at file \"%s\", line %s",
+                    file, line);
+        }
+        if (*file || *proc) {
+            Jim_fprintf( interp, interp->cookie_stderr, JIM_NL);
+        }
     }
 }
 
@@ -12393,7 +12440,6 @@
 	}
 	return (*(interp->cb_fgets))( s, size, cookie );
 }
-
 Jim_Nvp *
 Jim_Nvp_name2value_simple( const Jim_Nvp *p, const char *name )
 {
@@ -12555,7 +12601,7 @@
 	Jim_Obj *o;
 	
 	o = NULL; // failure 
-	if( goi->argc > 0 ){
+	if( goi->argc ){
 		// success 
 		o = goi->argv[0];
 		goi->argc -= 1;
@@ -12704,7 +12750,7 @@
 {
 	va_list ap;
 	char *buf;
-	
+
 	va_start(ap,fmt);
 	buf = jim_vasprintf( fmt, ap );
 	va_end(ap);
@@ -12773,3 +12819,12 @@
 
 	return Jim_GetString( debug_string_obj, NULL );
 }
+
+	
+
+/*
+ * Local Variables: ***
+ * c-basic-offset: 4 ***
+ * tab-width: 4 ***
+ * End: ***
+ */

Modified: trunk/src/helper/jim.h
===================================================================
--- trunk/src/helper/jim.h	2008-12-16 19:29:50 UTC (rev 1249)
+++ trunk/src/helper/jim.h	2008-12-16 21:10:06 UTC (rev 1250)
@@ -164,6 +164,7 @@
 #define JIM_CONTINUE 4
 #define JIM_EVAL 5
 #define JIM_EXIT 6
+#define JIM_ERR_ADDSTACK 7
 #define JIM_MAX_NESTING_DEPTH 10000 /* default max nesting depth */
 
 /* Some function get an integer argument with flags to change
@@ -530,6 +531,7 @@
     struct Jim_HashTable sharedStrings; /* Shared Strings hash table */
     Jim_Obj *stackTrace; /* Stack trace object. */
     Jim_Obj *unknown; /* Unknown command cache */
+    int unknown_called; /* The unknown command has been invoked */
     int errorFlag; /* Set if an error occurred during execution. */
     int evalRetcodeLevel; /* Level where the last return with code JIM_EVAL
                              happened. */
@@ -560,6 +562,7 @@
  * cached can no longer considered valid. */
 #define Jim_InterpIncrProcEpoch(i) (i)->procEpoch++
 #define Jim_SetResultString(i,s,l) Jim_SetResult(i, Jim_NewStringObj(i,s,l))
+#define Jim_SetResultInt(i,intval) Jim_SetResult(i, Jim_NewIntObj(i,intval))
 #define Jim_SetEmptyResult(i) Jim_SetResult(i, (i)->emptyObj)
 #define Jim_GetResult(i) ((i)->result)
 #define Jim_CmdPrivData(i) ((i)->cmdPrivData)
@@ -1296,7 +1299,7 @@
   JIM_GET_API(Nvp_name2value);
   JIM_GET_API(Nvp_name2value_nocase);
   JIM_GET_API(Nvp_name2value_simple);
-
+  
   JIM_GET_API(Nvp_value2name);
   JIM_GET_API(Nvp_value2name_simple);
 
@@ -1337,3 +1340,10 @@
 #endif
 
 #endif /* __JIM__H */
+
+/*
+ * Local Variables: ***
+ * c-basic-offset: 4 ***
+ * tab-width: 4 ***
+ * End: ***
+ */



From oharboe at mail.berlios.de  Tue Dec 16 23:20:15 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 16 Dec 2008 23:20:15 +0100
Subject: [Openocd-svn] r1251 - trunk trunk/src trunk/src/server
	zy1000/trunk/build
Message-ID: <200812162220.mBGMKF6H032644@sheep.berlios.de>

Author: oharboe
Date: 2008-12-16 23:20:10 +0100 (Tue, 16 Dec 2008)
New Revision: 1251

Added:
   trunk/src/server/httpd.c
   zy1000/trunk/build/testhttpd.tcl
Modified:
   trunk/configure.in
   trunk/src/Makefile.am
   trunk/src/main.c
   trunk/src/openocd.c
   trunk/src/server/Makefile.am
Log:
work in progress to hook up libmicrohttpd + tcl integration

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2008-12-16 21:10:06 UTC (rev 1250)
+++ trunk/configure.in	2008-12-16 22:20:10 UTC (rev 1251)
@@ -71,6 +71,10 @@
   AS_HELP_STRING([--enable-ioutil], [Enable ioutil functions - useful for standalone OpenOCD implementations]), 
   [build_ioutil=$enableval], [build_ioutil=no])
 
+AC_ARG_ENABLE(httpd,
+  AS_HELP_STRING([--enable-httpd], [Enable builtin httpd server - useful for standalone OpenOCD implementations]), 
+  [build_httpd=$enableval], [build_httpd=no])
+
 case "${host_cpu}" in 
   arm*)
     AC_ARG_ENABLE(ep93xx,
@@ -189,6 +193,12 @@
   AC_DEFINE(BUILD_IOUTIL, 0, [0 if you don't want ioutils.])
 fi
 
+if test $build_httpd = yes; then
+  AC_DEFINE(BUILD_HTTPD, 1, [1 if you want httpd.])
+else
+  AC_DEFINE(BUILD_HTTPD, 0, [0 if you don't want httpd.])
+fi
+
 if test $build_at91rm9200 = yes; then
   build_bitbang=yes
   AC_DEFINE(BUILD_AT91RM9200, 1, [1 if you want at91rm9200.])
@@ -285,6 +295,7 @@
 AM_CONDITIONAL(EP93XX, test $build_ep93xx = yes)
 AM_CONDITIONAL(ECOSBOARD, test $build_ecosboard = yes)
 AM_CONDITIONAL(IOUTIL, test $build_ioutil = yes)
+AM_CONDITIONAL(HTTPD, test $build_httpd = yes)
 AM_CONDITIONAL(AT91RM9200, test $build_at91rm9200 = yes)
 AM_CONDITIONAL(BITBANG, test $build_bitbang = yes)
 AM_CONDITIONAL(FT2232_LIBFTDI, test $build_ft2232_libftdi = yes)

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-16 21:10:06 UTC (rev 1250)
+++ trunk/src/Makefile.am	2008-12-16 22:20:10 UTC (rev 1251)
@@ -79,6 +79,13 @@
 	$(top_builddir)/src/pld/libpld.a \
 	$(FTDI2232LIB) $(FTD2XXLIB) $(MINGWLDADD) $(LIBUSB)
 
+
+if HTTPD
+openocd_LDADD += -lmicrohttpd
+endif
+
+
+
 nobase_dist_pkglib_DATA = \
 	tcl/bitsbytes.tcl			\
 	tcl/chip/atmel/at91/aic.tcl		\

Modified: trunk/src/main.c
===================================================================
--- trunk/src/main.c	2008-12-16 21:10:06 UTC (rev 1250)
+++ trunk/src/main.c	2008-12-16 22:20:10 UTC (rev 1251)
@@ -18,6 +18,12 @@
  *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
  ***************************************************************************/
 
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#if !BUILD_HTTPD
 /* implementations of OpenOCD that uses multithreading needs to know when
  * OpenOCD is sleeping. No-op in vanilla OpenOCD
  */
@@ -28,13 +34,14 @@
 void openocd_sleep_postlude(void)
 {
 }
+#endif
 
 /* This is the main entry for developer PC hosted OpenOCD.
  *
  * OpenOCD can also be used as a library that is linked with
  * another application(not mainstream yet, but possible), e.g.
  * w/as an embedded application.
- * 
+ *
  * Those applications will have their own main() implementation
  * and use bits and pieces from openocd.c. */
 

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2008-12-16 21:10:06 UTC (rev 1250)
+++ trunk/src/openocd.c	2008-12-16 22:20:10 UTC (rev 1251)
@@ -229,6 +229,9 @@
 	return cmd_ctx;
 }
 
+int httpd_start(void);
+void httpd_stop(void);
+
 /* normally this is the main() function entry, but if OpenOCD is linked
  * into application, then this fn will not be invoked, but rather that
  * application will have it's own implementation of main(). */
@@ -255,6 +258,11 @@
 	if ( (ret != ERROR_OK) && (ret != ERROR_COMMAND_CLOSE_CONNECTION) )
 		return EXIT_FAILURE;
 
+#if BUILD_HTTPD
+	if (httpd_start()!=ERROR_OK)
+		return EXIT_FAILURE;
+#endif
+
 	if (ret != ERROR_COMMAND_CLOSE_CONNECTION)
 	{
 		command_context_mode(cmd_ctx, COMMAND_EXEC);
@@ -268,10 +276,15 @@
 	/* shut server down */
 	server_quit();
 
+#if BUILD_HTTPD
+	httpd_stop();
+#endif
+
 	unregister_all_commands(cmd_ctx);
 
 	/* free commandline interface */
 	command_done(cmd_ctx);
 
+
 	return EXIT_SUCCESS;
 }

Modified: trunk/src/server/Makefile.am
===================================================================
--- trunk/src/server/Makefile.am	2008-12-16 21:10:06 UTC (rev 1250)
+++ trunk/src/server/Makefile.am	2008-12-16 22:20:10 UTC (rev 1251)
@@ -4,6 +4,11 @@
 noinst_HEADERS = server.h telnet_server.h gdb_server.h
 libserver_a_SOURCES = server.c telnet_server.c gdb_server.c
 
+if HTTPD
+libserver_a_SOURCES += httpd.c
+endif
+
+
 # tcl server addons
 noinst_HEADERS += tcl_server.h
 libserver_a_SOURCES += tcl_server.c

Added: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2008-12-16 21:10:06 UTC (rev 1250)
+++ trunk/src/server/httpd.c	2008-12-16 22:20:10 UTC (rev 1251)
@@ -0,0 +1,455 @@
+/***************************************************************************
+ *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   oyvind.harboe at zylin.com                                               *
+ *                                                                         *
+ *   Copyright (C) 2008 Free Software Foundation
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+/* some bits were copied from ahttpd which is under eCos license and
+ * copyright to FSF
+ */
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "replacements.h"
+
+#include "server.h"
+
+#include "log.h"
+#include "telnet_server.h"
+#include "target.h"
+
+#include <command.h>
+#include <string.h>
+#include <stdlib.h>
+#include <errno.h>
+#include <unistd.h>
+#include <sys/types.h>
+#include <fcntl.h>
+#include <signal.h>
+
+#include <sys/types.h>
+#include <sys/select.h>
+#include <sys/socket.h>
+#include <microhttpd.h>
+#include <stdlib.h>
+#include <string.h>
+#include <stdio.h>
+
+#define PAGE_NOT_FOUND "<html><head><title>File not found</title></head><body>File not found</body></html>"
+
+static const char *appendf(const *prev, const char *format, ...)
+{
+	va_list ap;
+	va_start(ap, format);
+	char *string = alloc_vprintf(format, ap);
+	va_end(ap);
+	char *string2 = NULL;
+
+	if (string != NULL)
+	{
+		string2 = alloc_printf("%s%s", (prev == NULL) ? "" : prev, string);
+	}
+
+	if (prev != NULL)
+	{
+		free(prev);
+	}
+
+	if (string == NULL)
+		free(string);
+
+	return string2;
+}
+
+static const char *httpd_exec_cgi_tcl_error(Jim_Interp *interp)
+{
+	int len, i;
+
+	const char *t = NULL;
+	t = appendf(t, "<html><body>\n");
+
+	t = appendf(t, "Runtime error, file \"%s\", line %d:<br>",
+			interp->errorFileName, interp->errorLine);
+	t = appendf(t, "    %s<br>", Jim_GetString(interp->result, NULL));
+	Jim_ListLength(interp, interp->stackTrace, &len);
+	for (i = 0; i < len; i += 3)
+	{
+		Jim_Obj *objPtr;
+		const char *proc, *file, *line;
+
+		Jim_ListIndex(interp, interp->stackTrace, i, &objPtr, JIM_NONE);
+		proc = Jim_GetString(objPtr, NULL);
+		Jim_ListIndex(interp, interp->stackTrace, i + 1, &objPtr, JIM_NONE);
+		file = Jim_GetString(objPtr, NULL);
+		Jim_ListIndex(interp, interp->stackTrace, i + 2, &objPtr, JIM_NONE);
+		line = Jim_GetString(objPtr, NULL);
+		t = appendf(t, "In procedure '%s' called at file \"%s\", line %s<br>",
+				proc, file, line);
+	}
+	t = appendf(t, "</html></body>\n");
+
+	return t;
+}
+
+static int httpd_Jim_Command_writeform(Jim_Interp *interp, int argc,
+		Jim_Obj * const *argv)
+{
+	if (argc != 3)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "method ?args ...?");
+		return JIM_ERR;
+	}
+	char *name = (char*) Jim_GetString(argv[1], NULL);
+	char *file = (char*) Jim_GetString(argv[2], NULL);
+
+	// Find length
+	char *data;
+	int actual;
+
+	int retcode;
+
+	const char *script = alloc_printf("set dummy_val $httppostdata(%s); set dummy_val",
+			name);
+	retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
+	free((void *) script);
+	if (retcode != JIM_OK)
+		return retcode;
+
+	data = Jim_GetString(Jim_GetResult(interp), &actual);
+
+	FILE *f;
+	f = fopen(file, "wb");
+	if (f != NULL)
+	{
+		int ok;
+		ok = fwrite(data, 1, actual, f) == actual;
+		fclose(f);
+
+		if (!ok)
+		{
+			Jim_SetResultString(interp, "Could not write to file", -1);
+			return JIM_ERR;
+		}
+	}
+	else
+	{
+		Jim_SetResultString(interp, "Could not create file", -1);
+		return JIM_ERR;
+	}
+	return JIM_OK;
+}
+
+
+int
+httpd_Jim_Command_formfetch(Jim_Interp *interp,
+                                   int argc,
+                                   Jim_Obj *const *argv)
+{
+    if (argc!=2)
+    {
+        Jim_WrongNumArgs(interp, 1, argv, "method ?args ...?");
+        return JIM_ERR;
+    }
+    char *name = (char*)Jim_GetString(argv[1], NULL);
+
+
+    const char *script = alloc_printf("set dummy_val $httppostdata(%s); set dummy_val",
+    			name);
+    	int retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
+    	free((void *) script);
+    	if (retcode != JIM_OK)
+    		return retcode;
+
+    Jim_SetResult(interp, Jim_GetResult(interp));
+    return JIM_OK;
+}
+
+struct httpd_request
+{
+	int post;
+	struct MHD_PostProcessor *postprocessor;
+
+	//Jim_Obj *dict;
+
+	int complete; /* did we receive the entire post ? */
+
+};
+
+static void request_completed(void *cls, struct MHD_Connection *connection,
+		void **con_cls, enum MHD_RequestTerminationCode toe)
+{
+	struct httpd_request *r = (struct httpd_request*) *con_cls;
+
+	if (NULL == r)
+		return;
+
+	if (r->postprocessor)
+	{
+		MHD_destroy_post_processor(r->postprocessor);
+	}
+
+	free(r);
+	*con_cls = NULL;
+}
+
+/* append to said key in dictonary */
+static void append_key(struct httpd_request *r, const char *key,
+		const char *data, size_t off, size_t size)
+{
+	Jim_Obj *keyObj = Jim_NewStringObj(interp, key, -1);
+	Jim_Obj *value = NULL;
+
+	Jim_Obj *dict = Jim_GetVariableStr(interp, "httppostdata", 0);
+
+	if (dict!=NULL)
+	{
+		if (Jim_DictKey(interp, dict, keyObj, &value, 0) != JIM_OK)
+		{
+			 value = NULL;
+		}
+	}
+	if (value == NULL)
+		value = Jim_NewStringObj(interp, "", -1);
+
+	/* create a new object we append to and insert into this location */
+	Jim_Obj *newObj = Jim_NewStringObj(interp, "", -1);
+	Jim_AppendObj(interp, newObj, value);
+	Jim_AppendString(interp, newObj, data, size);
+	/* uhh... use name here of dictionary */
+	Jim_SetDictKeysVector(interp, Jim_NewStringObj(interp, "httppostdata", -1), &keyObj, 1, newObj);
+}
+
+/* append data to each key */
+static int iterate_post(void *con_cls, enum MHD_ValueKind kind,
+		const char *key, const char *filename, const char *content_type,
+		const char *transfer_encoding, const char *data, size_t off,
+		size_t size)
+{
+	struct httpd_request *r = (struct httpd_request*) con_cls;
+
+	append_key(r, key, data, off, size);
+
+	return MHD_YES;
+}
+
+static int record_arg(void *cls, enum MHD_ValueKind kind, const char *key,
+		const char *value)
+{
+	struct httpd_request *r = (struct httpd_request*) cls;
+	append_key(r, key, value, 0, strlen(value));
+	return MHD_YES;
+}
+
+static int ahc_echo(void * cls, struct MHD_Connection * connection,
+		const char * url, const char * method, const char * version,
+		const char * upload_data, unsigned int * upload_data_size, void ** ptr)
+{
+	struct MHD_Response * response;
+	int ret;
+
+	int post = 0;
+
+	if (0 == strcmp(method, "POST"))
+	{
+		post = 1;
+	}
+	else if (0 == strcmp(method, "GET"))
+	{
+	}
+	else
+	{
+		return MHD_NO; /* unexpected method */
+	}
+
+	struct httpd_request *r;
+	if (*ptr == NULL)
+	{
+		/* The first time only the headers are valid,
+		 do not respond in the first round... */
+
+		*ptr = malloc(sizeof(struct httpd_request));
+		if (*ptr == NULL)
+			return MHD_NO;
+		memset(*ptr, 0, sizeof(struct httpd_request));
+
+		r = (struct httpd_request *) *ptr;
+
+		r->post = post;
+
+//		r->dict = Jim_NewDictObj(interp, NULL, 0);
+
+		/* fill in url query strings in dictonary */
+		MHD_get_connection_values(connection, MHD_GET_ARGUMENT_KIND,
+				record_arg, r);
+
+		if (r->post)
+		{
+			r->postprocessor = MHD_create_post_processor(connection, 2048
+					* 1024, iterate_post, r);
+		}
+
+		return MHD_YES;
+	}
+
+	r = (struct httpd_request *) *ptr;
+
+	if (r->post)
+	{
+		/* consume post data */
+		if (*upload_data_size)
+		{
+			MHD_post_process(r->postprocessor, upload_data, *upload_data_size);
+			*upload_data_size = 0;
+			return MHD_YES;
+		}
+		else
+		{
+		}
+	} else
+	{
+	}
+
+	/* hand over to request who will be using it. */
+	//Jim_SetGlobalVariableStr(interp, "httppostdata", Jim_GetVariableStr(interp, "httppostdata", 0));
+	//	r->dict = NULL;
+
+
+	/* FIX!!!! we need more advanced handling of url's to avoid them
+	 * being subverted to evil purposes
+	 */
+
+	url++; /* skip '/' */
+
+	const char *suffix;
+	suffix = strrchr(url, '.');
+	if ((suffix != NULL) && (strcmp(suffix, ".tcl") == 0))
+	{
+		printf("Run tcl %s\n", url);
+
+		int retcode;
+
+		const char *script = alloc_printf(
+				"global httpdata; source {%s}; set httpdata", url);
+		retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
+		free((void *) script);
+
+		if (retcode == JIM_ERR)
+		{
+			printf("Tcl failed\n");
+			const char *t = httpd_exec_cgi_tcl_error(interp);
+			if (t == NULL)
+				return MHD_NO;
+
+			response = MHD_create_response_from_data(strlen(t), (void *) t,
+					MHD_YES, MHD_NO);
+			ret = MHD_queue_response(connection,
+					MHD_HTTP_INTERNAL_SERVER_ERROR, response);
+			MHD_destroy_response(response);
+			return ret;
+		}
+		else
+		{
+			printf("Tcl OK\n");
+			/* FIX!!! how to handle mime types??? */
+			const char *result;
+			int reslen;
+			result = Jim_GetString(Jim_GetResult(interp), &reslen);
+
+			response = MHD_create_response_from_data(reslen, (void *) result,
+					MHD_NO, MHD_YES);
+			ret = MHD_queue_response(connection,
+					MHD_HTTP_INTERNAL_SERVER_ERROR, response);
+			MHD_destroy_response(response);
+			return ret;
+		}
+	}
+	else
+	{
+		void *data;
+		int len;
+
+		int retval = loadFile(url, &data, &len);
+		if (retval != ERROR_OK)
+		{
+			printf("Did not find %s\n", url);
+
+			response = MHD_create_response_from_data(strlen(PAGE_NOT_FOUND),
+					(void *) PAGE_NOT_FOUND, MHD_NO, MHD_NO);
+			ret = MHD_queue_response(connection, MHD_HTTP_NOT_FOUND, response);
+			MHD_destroy_response(response);
+			return ret;
+		}
+
+		printf("Serving %s length=%d\n", url, len);
+		/* serve file directly */
+		response = MHD_create_response_from_data(len, data, MHD_YES, MHD_NO);
+		MHD_add_response_header(response, "Content-Type", "image/png");
+
+		ret = MHD_queue_response(connection, MHD_HTTP_OK, response);
+		MHD_destroy_response(response);
+
+		//free(data);
+		return ret;
+	}
+}
+
+static struct MHD_Daemon * d;
+
+int httpd_start(void)
+{
+
+	int port = 8888;
+	LOG_USER("Launching httpd server on port %d", port);
+	d = MHD_start_daemon(MHD_USE_SELECT_INTERNALLY, port, NULL, NULL,
+			&ahc_echo, NULL, /* could be data for handler, but we only have a single handler, use global variables instead */
+			MHD_OPTION_NOTIFY_COMPLETED, request_completed, NULL, /* Closure... what's that??? */
+			MHD_OPTION_END);
+	if (d == NULL)
+		return ERROR_FAIL;
+
+	Jim_CreateCommand(interp,
+						  "formfetch",
+						  httpd_Jim_Command_formfetch,
+						  NULL,
+						  NULL);
+
+    Jim_CreateCommand(interp,
+                      "writeform",
+                      httpd_Jim_Command_writeform,
+                      NULL,
+                      NULL);
+
+
+	return ERROR_OK;
+}
+
+void httpd_stop(void)
+{
+	MHD_stop_daemon(d);
+}
+
+void openocd_sleep_prelude(void)
+{
+}
+
+void openocd_sleep_postlude(void)
+{
+}
+

Added: zy1000/trunk/build/testhttpd.tcl
===================================================================
--- zy1000/trunk/build/testhttpd.tcl	2008-12-16 21:10:06 UTC (rev 1250)
+++ zy1000/trunk/build/testhttpd.tcl	2008-12-16 22:20:10 UTC (rev 1251)
@@ -0,0 +1,41 @@
+# some dummy proc's to get things going for test purposes
+
+proc zy1000_version {args} {
+return abc
+}
+
+script ../zy1000/linux_zy1000/build/tcl/openocd.cfg 
+
+interface dummy
+
+
+proc ip {} {
+return 10.0.0.55
+}
+
+proc start_chunked {a} {
+	global httpdata
+	global httpmime
+	set httpmime $a
+	set httpdata ""
+}
+
+proc write_chunked {a} {
+	global httpdata
+	append httpdata $a
+}
+
+proc end_chunked {} {
+}
+
+
+
+#proc formfetch {a} {
+#	global httppostdata
+	#catch { 
+#	echo "$a=$httppostdata($a)"
+	#return $httppostdata($a) 
+	#}
+#	
+	#return ""  
+#}
\ No newline at end of file



From oharboe at mail.berlios.de  Wed Dec 17 10:57:04 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 17 Dec 2008 10:57:04 +0100
Subject: [Openocd-svn] r1252 - in zy1000/trunk/build: menu tcl
Message-ID: <200812170957.mBH9v4QY017556@sheep.berlios.de>

Author: oharboe
Date: 2008-12-17 10:56:59 +0100 (Wed, 17 Dec 2008)
New Revision: 1252

Modified:
   zy1000/trunk/build/menu/zy1000menu.xml
   zy1000/trunk/build/menu/zy1000menu.xsl
   zy1000/trunk/build/tcl/openocd.cfg
Log:
retire unused code

Modified: zy1000/trunk/build/menu/zy1000menu.xml
===================================================================
--- zy1000/trunk/build/menu/zy1000menu.xml	2008-12-16 22:20:10 UTC (rev 1251)
+++ zy1000/trunk/build/menu/zy1000menu.xml	2008-12-17 09:56:59 UTC (rev 1252)
@@ -62,9 +62,9 @@
 							append buffer [ocd_jtag_khz]
 						</tcl>
 						<br>
-						<tcl>append buffer [openocd {zy1000_version zy1000}]</tcl><br>
-						<tcl>append buffer [openocd {zy1000_version openocd}]</tcl><br>
-						<tcl>append buffer [openocd {zy1000_version date}]</tcl><br>
+						<tcl>append buffer [capture {zy1000_version zy1000}]</tcl><br>
+						<tcl>append buffer [capture {zy1000_version openocd}]</tcl><br>
+						<tcl>append buffer [capture {zy1000_version date}]</tcl><br>
 						<tcl>append buffer [ip]</tcl><br>
 						<tcl>append buffer [ocd_gdb_port]</tcl>
 					</td>
@@ -100,25 +100,25 @@
 							set form_action [formfetch form_action]
 							
 							if {[string compare $form_action "Halt"]==0} {
-								append console [encode [openocd "halt"]]
+								append console [encode [capture "halt"]]
 							}
 							if {[string compare $form_action "Resume"]==0} {
-								append console [encode [openocd "resume"]]
+								append console [encode [capture "resume"]]
 							}
 							  
 							if {[string compare $form_action "Reset and run"]==0} {
-								append console [encode [openocd "reset run"]]
+								append console [encode [capture "reset run"]]
 							}
 							
 							if {[string compare $form_action "Power on"]==0} {
-								append console [encode [openocd "power on"]]
+								append console [encode [capture "power on"]]
 							}
 							if {[string compare $form_action "Power off"]==0} {
-								append console [encode [openocd "power off"]]
+								append console [encode [capture "power off"]]
 							}
 						</tcl>
 					
-						<tcl>append console [encode [openocd poll]]</tcl>
+						<tcl>append console [encode [capture poll]]</tcl>
 					</td>
 				</tr>
 			</table>
@@ -184,8 +184,8 @@
 			
 			append buffer {<form enctype="multipart/form-data" action="preconfig.tcl" method="post">}
 			if {[string compare $form_action "Select and reload"]==0} {
-				openocd "trunc /config/settings/openocd.cfg"
-				openocd "append_file /config/settings/openocd.cfg script target/$form_target"
+				capture "trunc /config/settings/openocd.cfg"
+				capture "append_file /config/settings/openocd.cfg script target/$form_target"
 				reboot 
 			}
 			
@@ -271,7 +271,7 @@
 				}
 				
 				if {[string compare $form_action "Delete"]==0} {
-					openocd "rm /config/settings/$form_selected"
+					capture "rm /config/settings/$form_selected"
 				}
 				
 				if {[string compare $form_action "Save"]==0} {
@@ -463,9 +463,9 @@
 					
 						set form_action [formfetch form_action]
 						if {[string compare $form_action "Reset CPU and probe flash"]==0} {
-							append console [encode [openocd "reset init"]]
-							append buffer [encode [openocd "flash probe 0"]]
-							append buffer [encode [openocd "flash info 0"]]
+							append console [encode [capture "reset init"]]
+							append buffer [encode [capture "flash probe 0"]]
+							append buffer [encode [capture "flash info 0"]]
 						}
 					} else {
 						append buffer "No flash bank configured."
@@ -540,7 +540,7 @@
 			set action_verify [expr {[string compare $form_action "Verify"]==0 || [string compare $form_action "Flash and verify"]==0}]
 			
 			if {$action_reset} {
-				append console [encode [openocd "reset init"]]
+				append console [encode [capture "reset init"]]
 			}
 			</tcl>
 			</code><tcl>
@@ -594,7 +594,7 @@
 			}
 			append buffer "<br>"
 			if {$action_flash} {
-				append console [encode [openocd "halt"]]
+				append console [encode [capture "halt"]]
 				append buffer "<b>"
 				if {[catch {capture {eval "flash write_image erase $upload_filename $form_offset $form_type"}} result]} {
 					append buffer "Flash write failed<br>"
@@ -606,7 +606,7 @@
 				append buffer "</b>"
 			}
 			if {$action_verify} {
-				append console [encode [openocd "halt"]]
+				append console [encode [capture "halt"]]
 				append buffer "<b>"
 				if {[catch {capture {eval "verify_image $upload_filename $form_offset $form_type"}} result]} {
 					append buffer "Verify failed<br>"
@@ -674,10 +674,10 @@
 							append console [encode [capture {catch production_test}]]
 						}
 						if {[string compare $form_action "Power on"]==0} {
-							append console [encode [openocd "power on"]]
+							append console [encode [capture "power on"]]
 						}
 						if {[string compare $form_action "Power off"]==0} {
-							append console [encode [openocd "power off"]]
+							append console [encode [capture "power off"]]
 						}
 					</tcl>
 				</code>
@@ -751,8 +751,8 @@
 			if {[string compare $form_address ""]!=0} {
 				if {[string compare $form_action "Erase"]==0} {
 						append buffer "<code style=\"white-space: nowrap;\">"
-						append console [encode [openocd "reset init"]]
-						append console [encode [openocd "flash erase_address $form_address $form_length"]]
+						append console [encode [capture "reset init"]]
+						append console [encode [capture "flash erase_address $form_address $form_length"]]
 						append buffer </code>
 				}  
 			}
@@ -808,25 +808,25 @@
 set form_action [formfetch form_action]
 
 if {[string compare $form_action "Run from address"]==0} {
-	append console [encode [openocd "halt"]]
-	append console [encode [openocd "wait_halt"]]
-	append console [encode [openocd "resume $form_address"]]
+	append console [encode [capture "halt"]]
+	append console [encode [capture "wait_halt"]]
+	append console [encode [capture "resume $form_address"]]
 }  
 
 if {[string compare $form_action "Halt"]==0} {
-	append console [encode [openocd "halt"]]
-	append console [encode [openocd "wait_halt"]]
+	append console [encode [capture "halt"]]
+	append console [encode [capture "wait_halt"]]
 }
   
 if {[string compare $form_action "Reset and run"]==0} {
-	append console [encode [openocd "reset run"]]
+	append console [encode [capture "reset run"]]
 }
   
 if {[string compare $form_action "Reset and init"]==0} {
-	append console [encode [openocd "reset init"]]
+	append console [encode [capture "reset init"]]
 }  
 
-append console [encode [openocd poll]]
+append console [encode [capture poll]]
 
 </tcl>
 
@@ -941,10 +941,10 @@
 					set form_address "0x[tohex [expr $form_address+$form_length]]"
 				}  
 				if {[string compare $form_action "Modify"]==0} {
-					append console [openocd "$modify_cmd $form_address $form_value"]
+					append console [capture "$modify_cmd $form_address $form_value"]
 				}  
 				if {[string compare $form_action "Fill"]==0} {
-					append console [openocd "$modify_cmd $form_address $form_value $form_length"]
+					append console [capture "$modify_cmd $form_address $form_value $form_length"]
 				}  
 			}
 			
@@ -992,8 +992,8 @@
 			<code style="white-space: nowrap; font-size:11px;font:courier new;">
 				<tcl>
 				if {[string compare $form_address ""]!=0} {
-					append console [encode [openocd halt]]
-					append buffer [encode [openocd "$form_type $form_address [expr $form_length]"]]
+					append console [encode [capture halt]]
+					append buffer [encode [capture "$form_type $form_address [expr $form_length]"]]
 				} 
 				</tcl>
 			</code>
@@ -1051,8 +1051,8 @@
 			</form>
 			<tcl>
 				if {[string compare $form_action "Download"]==0} {
-					append console [encode [openocd "reset init"]]
-					append console [encode [openocd "dump_image /ram/dump.bin $form_address $form_length"]]
+					append console [encode [capture "reset init"]]
+					append console [encode [capture "dump_image /ram/dump.bin $form_address $form_length"]]
 					</tcl>
 					<form action="../dump.bin" target="_blank"> 
 						<input type="submit" name="form_action" value="Save downloaded memory">
@@ -1344,7 +1344,7 @@
 	} err
 }
 if {[string compare $form_action "Delete"]==0} {
-	openocd "rm $form_filename"
+	capture "rm $form_filename"
 }
 
 set form_edittext_subst [to_textarea $form_edittext]
@@ -1560,9 +1560,9 @@
 			set form_config [load_config "target/[load_target]"]
 			set support_id [string range [rand] 0 7]
 			set form_log ""
-			append form_log "Version: [openocd "zy1000_version zy1000"]"
-			append form_log "OpenOCD version: [openocd "zy1000_version openocd"]"
-			append form_log "Version date: [openocd "zy1000_version date"]"
+			append form_log "Version: [capture "zy1000_version zy1000"]"
+			append form_log "OpenOCD version: [capture "zy1000_version openocd"]"
+			append form_log "Version date: [capture "zy1000_version date"]"
 			append form_log [log]
 			</tcl>
 

Modified: zy1000/trunk/build/menu/zy1000menu.xsl
===================================================================
--- zy1000/trunk/build/menu/zy1000menu.xsl	2008-12-16 22:20:10 UTC (rev 1251)
+++ zy1000/trunk/build/menu/zy1000menu.xsl	2008-12-17 09:56:59 UTC (rev 1252)
@@ -36,7 +36,7 @@
 					</div>
 					<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 						<div class="textlight" style="position:relative;left:15px;top:4px;">
-							<tcl>append buffer [openocd zy1000_version]</tcl>
+							<tcl>append buffer [capture zy1000_version]</tcl>
 						</div>
 					</div>
 				</div>

Modified: zy1000/trunk/build/tcl/openocd.cfg
===================================================================
--- zy1000/trunk/build/tcl/openocd.cfg	2008-12-16 22:20:10 UTC (rev 1251)
+++ zy1000/trunk/build/tcl/openocd.cfg	2008-12-17 09:56:59 UTC (rev 1252)
@@ -2,12 +2,7 @@
 
 
 
-proc openocd {cmd} {
-	catch "ocd_$cmd" t
-	return $t
-}
 
-
 proc tohex {a} {
    set r ""
    while 1 {



From oharboe at mail.berlios.de  Wed Dec 17 12:33:48 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 17 Dec 2008 12:33:48 +0100
Subject: [Openocd-svn] r1253 - in zy1000/trunk/build: include tcl
Message-ID: <200812171133.mBHBXm0L030268@sheep.berlios.de>

Author: oharboe
Date: 2008-12-17 12:33:33 +0100 (Wed, 17 Dec 2008)
New Revision: 1253

Modified:
   zy1000/trunk/build/include/rom.h
   zy1000/trunk/build/tcl/browsemem.tcl
   zy1000/trunk/build/tcl/downloadmem.tcl
   zy1000/trunk/build/tcl/editconfigs.tcl
   zy1000/trunk/build/tcl/editfile.tcl
   zy1000/trunk/build/tcl/erase.tcl
   zy1000/trunk/build/tcl/flash.tcl
   zy1000/trunk/build/tcl/flashinfo.tcl
   zy1000/trunk/build/tcl/guiupload.tcl
   zy1000/trunk/build/tcl/index.tcl
   zy1000/trunk/build/tcl/log.tcl
   zy1000/trunk/build/tcl/openocd.tcl
   zy1000/trunk/build/tcl/preconfig.tcl
   zy1000/trunk/build/tcl/production.tcl
   zy1000/trunk/build/tcl/reload.tcl
   zy1000/trunk/build/tcl/run.tcl
   zy1000/trunk/build/tcl/support.tcl
   zy1000/trunk/build/tcl/targets.tcl
   zy1000/trunk/build/tcl/terminal.tcl
   zy1000/trunk/build/tcl/upgrade.tcl
   zy1000/trunk/build/tcl/zy1000.tcl
Log:
wip

Modified: zy1000/trunk/build/include/rom.h
===================================================================
--- zy1000/trunk/build/include/rom.h	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/include/rom.h	2008-12-17 11:33:33 UTC (rev 1253)
@@ -2,688 +2,688 @@
 
 static CYGBLD_ATTRIB_ALIGN(4) const unsigned char filedata[] = {
     0x2e, 0x6d, 0x6f, 0x52, 0xaa, 0x00, 0x00, 0x00,
-    0x00, 0xde, 0x07, 0x00, 0x04, 0x03, 0x02, 0x01,
+    0xc0, 0xdd, 0x07, 0x00, 0x04, 0x03, 0x02, 0x01,
     0x52, 0x4f, 0x4d, 0x46, 0x53, 0x20, 0x76, 0x31,
     0x2e, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x01, 0x00, 0x6f, 0x01, 0x09, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x40, 0x05, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x60, 0x15, 0x00, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x60, 0x15, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe0, 0x8f, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x2e, 0x00, 0x00,
+    0xe2, 0xcb, 0x48, 0x49, 0x80, 0x2e, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x31, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x01, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0xa0, 0x1a, 0x00, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xa0, 0x1a, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x90, 0x37, 0x00, 0x00,
-    0x2b, 0x3e, 0x46, 0x49, 0x60, 0xbe, 0x00, 0x00,
+    0xec, 0xcb, 0x48, 0x49, 0x60, 0xbe, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x8a, 0x2b, 0x00, 0x00,
-    0x2b, 0x3e, 0x46, 0x49, 0x00, 0xf6, 0x00, 0x00,
+    0xec, 0xcb, 0x48, 0x49, 0x00, 0xf6, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x34, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x00, 0x1c, 0x00, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x00, 0x1c, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xae, 0x37, 0x00, 0x00,
-    0x2c, 0x3e, 0x46, 0x49, 0xa0, 0x21, 0x01, 0x00,
+    0xec, 0xcb, 0x48, 0x49, 0xa0, 0x21, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x9d, 0x2f, 0x00, 0x00,
-    0x2c, 0x3e, 0x46, 0x49, 0x60, 0x59, 0x01, 0x00,
+    0xed, 0xcb, 0x48, 0x49, 0x60, 0x59, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf3, 0x2d, 0x00, 0x00,
-    0x2c, 0x3e, 0x46, 0x49, 0x00, 0x89, 0x01, 0x00,
+    0xed, 0xcb, 0x48, 0x49, 0x00, 0x89, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x9e, 0x00, 0x00, 0x00,
-    0x2c, 0x3e, 0x46, 0x49, 0x00, 0xb7, 0x01, 0x00,
+    0xed, 0xcb, 0x48, 0x49, 0x00, 0xb7, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x78, 0x38, 0x00, 0x00,
-    0x2d, 0x3e, 0x46, 0x49, 0xa0, 0xb7, 0x01, 0x00,
+    0xed, 0xcb, 0x48, 0x49, 0xa0, 0xb7, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x06, 0x2e, 0x00, 0x00,
-    0x2d, 0x3e, 0x46, 0x49, 0x20, 0xf0, 0x01, 0x00,
+    0xee, 0xcb, 0x48, 0x49, 0x20, 0xf0, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x8b, 0x65, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x40, 0x1e, 0x02, 0x00,
+    0xe2, 0xcb, 0x48, 0x49, 0x40, 0x1e, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x32, 0x3e,
     0x08, 0x00, 0x6f, 0x01, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x92, 0x02, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x60, 0xdb, 0x07, 0x00,
+    0xe2, 0xcb, 0x48, 0x49, 0x20, 0xdb, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf3, 0x2e, 0x00, 0x00,
-    0x2e, 0x3e, 0x46, 0x49, 0xe0, 0x83, 0x02, 0x00,
+    0xee, 0xcb, 0x48, 0x49, 0xe0, 0x83, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa9, 0x39, 0x00, 0x00,
-    0x2f, 0x3e, 0x46, 0x49, 0xe0, 0xb2, 0x02, 0x00,
+    0xee, 0xcb, 0x48, 0x49, 0xe0, 0xb2, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x35, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x00, 0x03, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x60, 0x1c, 0x00, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x60, 0x1c, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x59, 0x26, 0x00, 0x00,
-    0x2f, 0x3e, 0x46, 0x49, 0xa0, 0xec, 0x02, 0x00,
+    0xef, 0xcb, 0x48, 0x49, 0xa0, 0xec, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x22, 0x03, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x00, 0x13, 0x03, 0x00,
+    0xe2, 0xcb, 0x48, 0x49, 0x00, 0x13, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x6a, 0x08, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x40, 0x16, 0x03, 0x00,
+    0xe2, 0xcb, 0x48, 0x49, 0x40, 0x16, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x39, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc0, 0x02, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x60, 0x1f, 0x00, 0x00,
+    0xeb, 0xcb, 0x48, 0x49, 0x60, 0x1f, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xed, 0x03, 0x01, 0x02, 0x30, 0x09, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0x1e, 0x03, 0x00,
+    0xed, 0x03, 0x01, 0x02, 0xf9, 0x08, 0x00, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0xc0, 0x1e, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xdf, 0x2a, 0x00, 0x00,
-    0x35, 0x3e, 0x46, 0x49, 0x00, 0x28, 0x03, 0x00,
+    0xf3, 0xcb, 0x48, 0x49, 0xc0, 0x27, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x19, 0x30, 0x00, 0x00,
-    0x35, 0x3e, 0x46, 0x49, 0xe0, 0x52, 0x03, 0x00,
+    0xf4, 0xcb, 0x48, 0x49, 0xa0, 0x52, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xcb, 0x32, 0x00, 0x00,
-    0x35, 0x3e, 0x46, 0x49, 0x00, 0x83, 0x03, 0x00,
+    0xf4, 0xcb, 0x48, 0x49, 0xc0, 0x82, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x0d, 0x29, 0x00, 0x00,
-    0x36, 0x3e, 0x46, 0x49, 0xe0, 0xb5, 0x03, 0x00,
+    0xf4, 0xcb, 0x48, 0x49, 0xa0, 0xb5, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xd7, 0x2d, 0x00, 0x00,
-    0x36, 0x3e, 0x46, 0x49, 0x00, 0xdf, 0x03, 0x00,
+    0xf4, 0xcb, 0x48, 0x49, 0xc0, 0xde, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x26, 0x01, 0x00, 0x00,
-    0x36, 0x3e, 0x46, 0x49, 0xe0, 0x0c, 0x04, 0x00,
+    0xf5, 0xcb, 0x48, 0x49, 0xa0, 0x0c, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x3f, 0x0b, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x20, 0x0e, 0x04, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0xe0, 0x0d, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x91, 0x30, 0x00, 0x00,
-    0x37, 0x3e, 0x46, 0x49, 0x60, 0x19, 0x04, 0x00,
+    0xf5, 0xcb, 0x48, 0x49, 0x20, 0x19, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x41, 0x07, 0x00, 0x00,
-    0x37, 0x3e, 0x46, 0x49, 0x00, 0x4a, 0x04, 0x00,
+    0xf5, 0xcb, 0x48, 0x49, 0xc0, 0x49, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x30, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe0, 0x06, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x20, 0x22, 0x00, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x20, 0x22, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x22, 0x48, 0x00, 0x00,
-    0x37, 0x3e, 0x46, 0x49, 0x60, 0x51, 0x04, 0x00,
+    0xf5, 0xcb, 0x48, 0x49, 0x20, 0x51, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x32, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x04, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x00, 0x01, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x00, 0x29, 0x00, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x00, 0x29, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xca, 0x2e, 0x00, 0x00,
-    0x37, 0x3e, 0x46, 0x49, 0xa0, 0x99, 0x04, 0x00,
+    0xf6, 0xcb, 0x48, 0x49, 0x60, 0x99, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xab, 0x30, 0x00, 0x00,
-    0x38, 0x3e, 0x46, 0x49, 0x80, 0xc8, 0x04, 0x00,
+    0xf6, 0xcb, 0x48, 0x49, 0x40, 0xc8, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x70, 0x01, 0x00, 0x00,
-    0x38, 0x3e, 0x46, 0x49, 0x40, 0xf9, 0x04, 0x00,
+    0xf7, 0xcb, 0x48, 0x49, 0x00, 0xf9, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x36, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x00, 0x2a, 0x00, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x00, 0x2a, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xb3, 0x35, 0x00, 0x00,
-    0x38, 0x3e, 0x46, 0x49, 0xc0, 0xfa, 0x04, 0x00,
+    0xf7, 0xcb, 0x48, 0x49, 0x80, 0xfa, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x13, 0x06, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x30, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x40, 0x30, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x65, 0x03, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0xa0, 0x36, 0x05, 0x00,
+    0xe2, 0xcb, 0x48, 0x49, 0x60, 0x36, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xce, 0x00, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0x20, 0x3a, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xe0, 0x39, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x51, 0x08, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0x00, 0x3b, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xc0, 0x3a, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x62, 0x09, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0x60, 0x43, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x20, 0x43, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x14, 0x04, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0xe0, 0x4c, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xa0, 0x4c, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0x00, 0x51, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xc0, 0x50, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x23, 0x01, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0x60, 0x51, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x20, 0x51, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x64, 0x00, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0xa0, 0x52, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x60, 0x52, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x69, 0x00, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0x20, 0x53, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xe0, 0x52, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa9, 0x00, 0x00, 0x00,
-    0x77, 0x3e, 0x46, 0x49, 0xa0, 0x53, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x60, 0x53, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe0, 0x8f, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x60, 0x54, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x20, 0x54, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x85, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0xe4, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x00, 0xe4, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x3d, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xe4, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xa0, 0xe4, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xfc, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x20, 0xe5, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xe0, 0xe4, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xfe, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x20, 0xe6, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xe0, 0xe5, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xb4, 0x01, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x20, 0xe7, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xe0, 0xe6, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x3a, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xe8, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xa0, 0xe8, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x11, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x20, 0xe9, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xe0, 0xe8, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xee, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0xe9, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x00, 0xe9, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x26, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0xea, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x00, 0xea, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x7b, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x80, 0xea, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x40, 0xea, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x7b, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x00, 0xeb, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xc0, 0xea, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa5, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x80, 0xeb, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x40, 0xeb, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x72, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0xec, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x00, 0xec, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x86, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xc0, 0xec, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x80, 0xec, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x75, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x60, 0xed, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x20, 0xed, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x99, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xed, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xa0, 0xed, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xad, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x80, 0xee, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x40, 0xee, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x72, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0xef, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x00, 0xef, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x79, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xc0, 0xef, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x80, 0xef, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x6f, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0xf0, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x00, 0xf0, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x50, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xc0, 0xf0, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x80, 0xf0, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x8d, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x20, 0xf1, 0x05, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xe0, 0xf0, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x35, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0xf1, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x80, 0xf1, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x33, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x00, 0xf3, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0xc0, 0xf2, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x6c, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x40, 0xf4, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x00, 0xf4, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x36, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0xf5, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x80, 0xf5, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x5d, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x00, 0xf7, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0xc0, 0xf6, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x4a, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x60, 0xf8, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x20, 0xf8, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc6, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0xf9, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x80, 0xf9, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc0, 0x03, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0xa0, 0xfb, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x60, 0xfb, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x0a, 0x0c, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x60, 0xff, 0x05, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x20, 0xff, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x5f, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x0b, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x40, 0x0b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x19, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0xe0, 0x0c, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0xa0, 0x0c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x09, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x00, 0x0e, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0xc0, 0x0d, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x20, 0x0f, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0xe0, 0x0e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x31, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x10, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x40, 0x10, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa9, 0x00, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0xc0, 0x11, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x80, 0x11, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf1, 0x08, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x12, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x40, 0x12, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x86, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x80, 0x1b, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x40, 0x1b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x65, 0x01, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0x20, 0x1d, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0xe0, 0x1c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x84, 0x0f, 0x00, 0x00,
-    0x2a, 0x3e, 0x46, 0x49, 0xa0, 0x1e, 0x06, 0x00,
+    0xe8, 0xcb, 0x48, 0x49, 0x60, 0x1e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x01, 0x06, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0x2e, 0x06, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x00, 0x2e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x27, 0x07, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x60, 0x34, 0x06, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x20, 0x34, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x47, 0x05, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xa0, 0x3b, 0x06, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0x60, 0x3b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x37, 0x06, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x00, 0x41, 0x06, 0x00,
+    0x19, 0xcc, 0x48, 0x49, 0xc0, 0x40, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x52, 0x0c, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0x47, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0x47, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xfa, 0x03, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xa0, 0x53, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x60, 0x53, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x83, 0x0b, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xa0, 0x57, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x60, 0x57, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x9f, 0x03, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0x63, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0x63, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf4, 0x05, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xe0, 0x66, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0x66, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf2, 0x05, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xe0, 0x6c, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0x6c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x77, 0x04, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xe0, 0x72, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0x72, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xfe, 0x06, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x60, 0x77, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x20, 0x77, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x17, 0x03, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x60, 0x7e, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x20, 0x7e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe2, 0x05, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x80, 0x81, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x40, 0x81, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x19, 0x05, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x80, 0x87, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x40, 0x87, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc2, 0x04, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xa0, 0x8c, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x60, 0x8c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xbd, 0x04, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x80, 0x91, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x40, 0x91, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf6, 0x03, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0x96, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0x96, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa2, 0x05, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0x9a, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0x9a, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x34, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x00, 0xa0, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xc0, 0x9f, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x31, 0x00, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0xa0, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0xa0, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x4c, 0x04, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x80, 0xa0, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x40, 0xa0, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x25, 0x03, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xa4, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0xa4, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x14, 0x01, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x20, 0xa8, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xe0, 0xa7, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x3c, 0x06, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0xa9, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0xa9, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x05, 0x04, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x80, 0xaf, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x40, 0xaf, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x88, 0x09, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xa0, 0xb3, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x60, 0xb3, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x15, 0x02, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x40, 0xbd, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0xbd, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x9b, 0x05, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x60, 0xbf, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x20, 0xbf, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xc3, 0x04, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x00, 0xc5, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xc0, 0xc4, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x03, 0x04, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xe0, 0xc9, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0xc9, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x98, 0x05, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0x00, 0xce, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xc0, 0xcd, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe3, 0x03, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xa0, 0xd3, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x60, 0xd3, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe3, 0x03, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xa0, 0xd7, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x60, 0xd7, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x3f, 0x04, 0x00, 0x00,
-    0x78, 0x3e, 0x46, 0x49, 0xa0, 0xdb, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x60, 0xdb, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x4e, 0x02, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xe0, 0xdf, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0xdf, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x97, 0x05, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x40, 0xe2, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0xe2, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x67, 0x02, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xe0, 0xe7, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0xe7, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x33, 0x01, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x60, 0xea, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x20, 0xea, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x84, 0x05, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xeb, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x60, 0xeb, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x2d, 0x05, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x40, 0xf1, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0xf1, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x48, 0x05, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x80, 0xf6, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x40, 0xf6, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xfc, 0x04, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xe0, 0xfb, 0x06, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0xfb, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x5d, 0x05, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xe0, 0x00, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0x00, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x9e, 0x06, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x40, 0x06, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x00, 0x06, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x84, 0x07, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xe0, 0x0c, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xa0, 0x0c, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf0, 0x04, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x80, 0x14, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x40, 0x14, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xcc, 0x01, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x80, 0x19, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x40, 0x19, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x5a, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x60, 0x1b, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x20, 0x1b, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x21, 0x0f, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xc0, 0x1b, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x80, 0x1b, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xfa, 0x09, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x00, 0x2b, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xc0, 0x2a, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf5, 0x0b, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x00, 0x35, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xc0, 0x34, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x7f, 0x06, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x00, 0x41, 0x07, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0xc0, 0x40, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x34, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x04, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x80, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x60, 0x2a, 0x00, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x60, 0x2a, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x35, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x03, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xe0, 0x2a, 0x00, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0xe0, 0x2a, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x88, 0x0e, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x80, 0x47, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x40, 0x47, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe0, 0x06, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x20, 0x56, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0xe0, 0x55, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x5e, 0x02, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x00, 0x5d, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0xc0, 0x5c, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x39, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x03, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x40, 0x2b, 0x00, 0x00,
+    0x1b, 0xcc, 0x48, 0x49, 0x40, 0x2b, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x30, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x03, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xa0, 0x2b, 0x00, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0xa0, 0x2b, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x31, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x00, 0x01, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x00, 0x2c, 0x00, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x00, 0x2c, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x18, 0x0c, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x60, 0x5f, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x20, 0x5f, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x21, 0x0f, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x80, 0x6b, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x40, 0x6b, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa9, 0x10, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xc0, 0x7a, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x80, 0x7a, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x66, 0x01, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x80, 0x8b, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x40, 0x8b, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xaf, 0x05, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x00, 0x8d, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0xc0, 0x8c, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xcf, 0x0e, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xc0, 0x92, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x80, 0x92, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x38, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xa0, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x00, 0x2d, 0x00, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x00, 0x2d, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xec, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xa1, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x60, 0xa1, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf1, 0x1d, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xa2, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x60, 0xa2, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xf6, 0x11, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xc0, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x60, 0xc0, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x32, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0xe0, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xa0, 0x2d, 0x00, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0xa0, 0x2d, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x79, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xd2, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x60, 0xd2, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x77, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x20, 0xd3, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0xe0, 0xd2, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x78, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xd3, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x60, 0xd3, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x78, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x20, 0xd4, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0xe0, 0xd3, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x79, 0x00, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0xa0, 0xd4, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0x60, 0xd4, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xed, 0x03, 0x01, 0x02, 0x38, 0x06, 0x00, 0x00,
-    0x79, 0x3e, 0x46, 0x49, 0x20, 0xd5, 0x07, 0x00,
+    0x1c, 0xcc, 0x48, 0x49, 0xe0, 0xd4, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x39, 0x3e,
     0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -6211,8 +6211,8 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -6877,8 +6877,8 @@
     0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
     0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73, 0x6f,
-    0x6c, 0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e,
-    0x6f, 0x63, 0x64, 0x20, 0x22, 0x24, 0x6d, 0x6f,
+    0x6c, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
+    0x75, 0x72, 0x65, 0x20, 0x22, 0x24, 0x6d, 0x6f,
     0x64, 0x69, 0x66, 0x79, 0x5f, 0x63, 0x6d, 0x64,
     0x20, 0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61,
     0x64, 0x64, 0x72, 0x65, 0x73, 0x73, 0x20, 0x24,
@@ -6894,7 +6894,7 @@
     0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63,
     0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x22, 0x24, 0x6d, 0x6f, 0x64, 0x69, 0x66, 0x79,
     0x5f, 0x63, 0x6d, 0x64, 0x20, 0x24, 0x66, 0x6f,
     0x72, 0x6d, 0x5f, 0x61, 0x64, 0x64, 0x72, 0x65,
@@ -7183,13 +7183,13 @@
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63,
     0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b,
     0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x68, 0x61, 0x6c, 0x74, 0x5d, 0x5d, 0x0d, 0x0a,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
     0x65, 0x72, 0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f,
-    0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e,
-    0x6f, 0x63, 0x64, 0x20, 0x22, 0x24, 0x66, 0x6f,
+    0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
+    0x75, 0x72, 0x65, 0x20, 0x22, 0x24, 0x66, 0x6f,
     0x72, 0x6d, 0x5f, 0x74, 0x79, 0x70, 0x65, 0x20,
     0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x64,
     0x64, 0x72, 0x65, 0x73, 0x73, 0x20, 0x5b, 0x65,
@@ -7993,8 +7993,8 @@
     0x74, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x22, 0x3e,
     0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e,
-    0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79, 0x31, 0x30,
+    0x65, 0x72, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
+    0x75, 0x72, 0x65, 0x20, 0x7a, 0x79, 0x31, 0x30,
     0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73, 0x69,
     0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
@@ -8581,15 +8581,15 @@
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f,
     0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65,
-    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22,
+    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63,
+    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22,
     0x72, 0x65, 0x73, 0x65, 0x74, 0x20, 0x69, 0x6e,
     0x69, 0x74, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
     0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73, 0x6f,
     0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f,
-    0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e,
-    0x6f, 0x63, 0x64, 0x20, 0x22, 0x64, 0x75, 0x6d,
+    0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
+    0x75, 0x72, 0x65, 0x20, 0x22, 0x64, 0x75, 0x6d,
     0x70, 0x5f, 0x69, 0x6d, 0x61, 0x67, 0x65, 0x20,
     0x2f, 0x72, 0x61, 0x6d, 0x2f, 0x64, 0x75, 0x6d,
     0x70, 0x2e, 0x62, 0x69, 0x6e, 0x20, 0x24, 0x66,
@@ -9378,8 +9378,8 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -9969,8 +9969,8 @@
     0x74, 0x69, 0x6f, 0x6e, 0x20, 0x22, 0x44, 0x65,
     0x6c, 0x65, 0x74, 0x65, 0x22, 0x5d, 0x3d, 0x3d,
     0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x6f, 0x70, 0x65, 0x6e, 0x6f,
-    0x63, 0x64, 0x20, 0x22, 0x72, 0x6d, 0x20, 0x2f,
+    0x09, 0x09, 0x09, 0x63, 0x61, 0x70, 0x74, 0x75,
+    0x72, 0x65, 0x20, 0x22, 0x72, 0x6d, 0x20, 0x2f,
     0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x2f, 0x73,
     0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x73, 0x2f,
     0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x73, 0x65,
@@ -11180,7 +11180,7 @@
     0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
     0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
@@ -11784,8 +11784,8 @@
     0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63,
     0x74, 0x69, 0x6f, 0x6e, 0x20, 0x22, 0x44, 0x65,
     0x6c, 0x65, 0x74, 0x65, 0x22, 0x5d, 0x3d, 0x3d,
-    0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22,
+    0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x63,
+    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22,
     0x72, 0x6d, 0x20, 0x24, 0x66, 0x6f, 0x72, 0x6d,
     0x5f, 0x66, 0x69, 0x6c, 0x65, 0x6e, 0x61, 0x6d,
     0x65, 0x22, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d,
@@ -12693,8 +12693,8 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -13297,14 +13297,14 @@
     0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
     0x20, 0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65,
     0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65,
-    0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63,
-    0x64, 0x20, 0x22, 0x72, 0x65, 0x73, 0x65, 0x74,
+    0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
+    0x65, 0x20, 0x22, 0x72, 0x65, 0x73, 0x65, 0x74,
     0x20, 0x69, 0x6e, 0x69, 0x74, 0x22, 0x5d, 0x5d,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63,
     0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b,
     0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x22, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x65,
     0x72, 0x61, 0x73, 0x65, 0x5f, 0x61, 0x64, 0x64,
     0x72, 0x65, 0x73, 0x73, 0x20, 0x24, 0x66, 0x6f,
@@ -14183,7 +14183,7 @@
     0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
     0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
@@ -14827,7 +14827,7 @@
     0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20,
     0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20,
-    0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
+    0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65,
     0x20, 0x22, 0x72, 0x65, 0x73, 0x65, 0x74, 0x20,
     0x69, 0x6e, 0x69, 0x74, 0x22, 0x5d, 0x5d, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09,
@@ -15083,8 +15083,8 @@
     0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
     0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73, 0x6f,
     0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f,
-    0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e,
-    0x6f, 0x63, 0x64, 0x20, 0x22, 0x68, 0x61, 0x6c,
+    0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
+    0x75, 0x72, 0x65, 0x20, 0x22, 0x68, 0x61, 0x6c,
     0x74, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
     0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
@@ -15136,8 +15136,8 @@
     0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f,
     0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65,
-    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22,
+    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63,
+    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22,
     0x68, 0x61, 0x6c, 0x74, 0x22, 0x5d, 0x5d, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
@@ -15990,8 +15990,8 @@
     0x69, 0x67, 0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a,
     0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63,
-    0x64, 0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
+    0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
+    0x65, 0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
     0x5f, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e,
     0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
@@ -16570,21 +16570,21 @@
     0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20,
     0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20,
-    0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
+    0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65,
     0x20, 0x22, 0x72, 0x65, 0x73, 0x65, 0x74, 0x20,
     0x69, 0x6e, 0x69, 0x74, 0x22, 0x5d, 0x5d, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
     0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x65,
-    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22,
+    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63,
+    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22,
     0x66, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x70, 0x72,
     0x6f, 0x62, 0x65, 0x20, 0x30, 0x22, 0x5d, 0x5d,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
     0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x22, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x69,
     0x6e, 0x66, 0x6f, 0x20, 0x30, 0x22, 0x5d, 0x5d,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
@@ -20729,8 +20729,8 @@
     0x74, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x22, 0x3e,
     0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e,
-    0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79, 0x31, 0x30,
+    0x65, 0x72, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
+    0x75, 0x72, 0x65, 0x20, 0x7a, 0x79, 0x31, 0x30,
     0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73, 0x69,
     0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
@@ -22216,8 +22216,8 @@
     0x69, 0x67, 0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a,
     0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63,
-    0x64, 0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
+    0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
+    0x65, 0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
     0x5f, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e,
     0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
@@ -22853,8 +22853,8 @@
     0x09, 0x3c, 0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
-    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7b,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63,
+    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7b,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
     0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x7a,
     0x79, 0x31, 0x30, 0x30, 0x30, 0x7d, 0x5d, 0x0d,
@@ -22863,8 +22863,8 @@
     0x3c, 0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7b, 0x7a,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7b, 0x7a,
     0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65,
     0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x6f, 0x70,
     0x65, 0x6e, 0x6f, 0x63, 0x64, 0x7d, 0x5d, 0x0d,
@@ -22873,8 +22873,8 @@
     0x3c, 0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7b, 0x7a,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7b, 0x7a,
     0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65,
     0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x64, 0x61,
     0x74, 0x65, 0x7d, 0x5d, 0x0d, 0x0a, 0x61, 0x70,
@@ -23006,8 +23006,8 @@
     0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
     0x20, 0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65,
     0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65,
-    0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63,
-    0x64, 0x20, 0x22, 0x68, 0x61, 0x6c, 0x74, 0x22,
+    0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
+    0x65, 0x20, 0x22, 0x68, 0x61, 0x6c, 0x74, 0x22,
     0x5d, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x69, 0x66, 0x20,
@@ -23020,8 +23020,8 @@
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f,
     0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65,
-    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22,
+    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63,
+    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22,
     0x72, 0x65, 0x73, 0x75, 0x6d, 0x65, 0x22, 0x5d,
     0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
@@ -23038,7 +23038,7 @@
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63,
     0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b,
     0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x22, 0x72, 0x65, 0x73, 0x65, 0x74, 0x20, 0x72,
     0x75, 0x6e, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d,
@@ -23054,8 +23054,8 @@
     0x09, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73,
     0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63,
-    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65,
-    0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22, 0x70, 0x6f,
+    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70,
+    0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x70, 0x6f,
     0x77, 0x65, 0x72, 0x20, 0x6f, 0x6e, 0x22, 0x5d,
     0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
@@ -23070,7 +23070,7 @@
     0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20,
     0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20,
-    0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
+    0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65,
     0x20, 0x22, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x20,
     0x6f, 0x66, 0x66, 0x22, 0x5d, 0x5d, 0x0d, 0x0a,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d,
@@ -23082,8 +23082,8 @@
     0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c,
     0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64,
-    0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f,
-    0x63, 0x64, 0x20, 0x70, 0x6f, 0x6c, 0x6c, 0x5d,
+    0x65, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75,
+    0x72, 0x65, 0x20, 0x70, 0x6f, 0x6c, 0x6c, 0x5d,
     0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
     0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
@@ -24080,7 +24080,7 @@
     0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
     0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
@@ -25568,295 +25568,287 @@
     0x69, 0x67, 0x2f, 0x73, 0x65, 0x74, 0x74, 0x69,
     0x6e, 0x67, 0x73, 0x2f, 0x6f, 0x70, 0x65, 0x6e,
     0x6f, 0x63, 0x64, 0x2e, 0x63, 0x66, 0x67, 0x20,
-    0x0a, 0x0a, 0x0a, 0x0a, 0x70, 0x72, 0x6f, 0x63,
-    0x20, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
-    0x20, 0x7b, 0x63, 0x6d, 0x64, 0x7d, 0x20, 0x7b,
-    0x0a, 0x09, 0x63, 0x61, 0x74, 0x63, 0x68, 0x20,
-    0x22, 0x6f, 0x63, 0x64, 0x5f, 0x24, 0x63, 0x6d,
-    0x64, 0x22, 0x20, 0x74, 0x0a, 0x09, 0x72, 0x65,
-    0x74, 0x75, 0x72, 0x6e, 0x20, 0x24, 0x74, 0x0a,
-    0x7d, 0x0a, 0x0a, 0x0a, 0x70, 0x72, 0x6f, 0x63,
-    0x20, 0x74, 0x6f, 0x68, 0x65, 0x78, 0x20, 0x7b,
-    0x61, 0x7d, 0x20, 0x7b, 0x0a, 0x20, 0x20, 0x20,
-    0x73, 0x65, 0x74, 0x20, 0x72, 0x20, 0x22, 0x22,
-    0x0a, 0x20, 0x20, 0x20, 0x77, 0x68, 0x69, 0x6c,
-    0x65, 0x20, 0x31, 0x20, 0x7b, 0x0a, 0x0a, 0x20,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74,
-    0x20, 0x72, 0x65, 0x6d, 0x20, 0x5b, 0x65, 0x78,
-    0x70, 0x72, 0x20, 0x24, 0x61, 0x25, 0x31, 0x36,
-    0x5d, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x73, 0x65, 0x74, 0x20, 0x61, 0x20, 0x5b, 0x65,
-    0x78, 0x70, 0x72, 0x20, 0x24, 0x61, 0x2f, 0x31,
+    0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x70, 0x72, 0x6f,
+    0x63, 0x20, 0x74, 0x6f, 0x68, 0x65, 0x78, 0x20,
+    0x7b, 0x61, 0x7d, 0x20, 0x7b, 0x0a, 0x20, 0x20,
+    0x20, 0x73, 0x65, 0x74, 0x20, 0x72, 0x20, 0x22,
+    0x22, 0x0a, 0x20, 0x20, 0x20, 0x77, 0x68, 0x69,
+    0x6c, 0x65, 0x20, 0x31, 0x20, 0x7b, 0x0a, 0x0a,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x73, 0x65,
+    0x74, 0x20, 0x72, 0x65, 0x6d, 0x20, 0x5b, 0x65,
+    0x78, 0x70, 0x72, 0x20, 0x24, 0x61, 0x25, 0x31,
     0x36, 0x5d, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x20,
-    0x20, 0x73, 0x65, 0x74, 0x20, 0x72, 0x20, 0x5b,
-    0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x69,
-    0x6e, 0x64, 0x65, 0x78, 0x20, 0x22, 0x30, 0x31,
-    0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39,
-    0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x22, 0x20,
-    0x24, 0x72, 0x65, 0x6d, 0x5d, 0x24, 0x72, 0x0a,
-    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x69, 0x66,
-    0x20, 0x28, 0x24, 0x61, 0x3d, 0x3d, 0x30, 0x29,
-    0x20, 0x74, 0x68, 0x65, 0x6e, 0x20, 0x62, 0x72,
-    0x65, 0x61, 0x6b, 0x0a, 0x20, 0x20, 0x20, 0x7d,
-    0x20, 0x20, 0x0a, 0x20, 0x20, 0x20, 0x72, 0x65,
-    0x74, 0x75, 0x72, 0x6e, 0x20, 0x24, 0x72, 0x20,
-    0x0a, 0x7d, 0x0a, 0x0a, 0x23, 0x20, 0x65, 0x6e,
-    0x63, 0x6f, 0x64, 0x65, 0x20, 0x74, 0x65, 0x78,
-    0x74, 0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20, 0x65,
-    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x7b, 0x61,
-    0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x72, 0x65, 0x74,
-    0x75, 0x72, 0x6e, 0x20, 0x5b, 0x73, 0x74, 0x72,
-    0x69, 0x6e, 0x67, 0x20, 0x6d, 0x61, 0x70, 0x20,
-    0x7b, 0x5c, 0x6e, 0x20, 0x3c, 0x62, 0x72, 0x2f,
-    0x3e, 0x20, 0x7b, 0x20, 0x7d, 0x20, 0x7b, 0x26,
-    0x6e, 0x62, 0x73, 0x70, 0x3b, 0x7d, 0x20, 0x5c,
-    0x74, 0x20, 0x7b, 0x26, 0x6e, 0x62, 0x73, 0x70,
-    0x3b, 0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b, 0x26,
-    0x6e, 0x62, 0x73, 0x70, 0x3b, 0x26, 0x6e, 0x62,
-    0x73, 0x70, 0x3b, 0x26, 0x6e, 0x62, 0x73, 0x70,
-    0x3b, 0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b, 0x26,
-    0x6e, 0x62, 0x73, 0x70, 0x3b, 0x26, 0x6e, 0x62,
-    0x73, 0x70, 0x3b, 0x7d, 0x20, 0x3e, 0x20, 0x26,
-    0x67, 0x74, 0x3b, 0x20, 0x3c, 0x20, 0x26, 0x6c,
-    0x74, 0x3b, 0x20, 0x2f, 0x20, 0x26, 0x23, 0x34,
-    0x37, 0x3b, 0x7d, 0x20, 0x24, 0x61, 0x5d, 0x0a,
-    0x7d, 0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20, 0x6c,
-    0x6f, 0x61, 0x64, 0x5f, 0x66, 0x69, 0x6c, 0x65,
-    0x20, 0x7b, 0x61, 0x7d, 0x20, 0x7b, 0x0a, 0x09,
-    0x73, 0x65, 0x74, 0x20, 0x72, 0x65, 0x73, 0x75,
-    0x6c, 0x74, 0x20, 0x22, 0x22, 0x0a, 0x09, 0x63,
-    0x61, 0x74, 0x63, 0x68, 0x20, 0x7b, 0x20, 0x0a,
-    0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x66, 0x70,
-    0x20, 0x5b, 0x61, 0x69, 0x6f, 0x2e, 0x6f, 0x70,
-    0x65, 0x6e, 0x20, 0x24, 0x61, 0x20, 0x72, 0x5d,
-    0x0a, 0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x72,
-    0x65, 0x73, 0x75, 0x6c, 0x74, 0x20, 0x5b, 0x24,
-    0x66, 0x70, 0x20, 0x72, 0x65, 0x61, 0x64, 0x5d,
-    0x0a, 0x09, 0x09, 0x24, 0x66, 0x70, 0x20, 0x63,
-    0x6c, 0x6f, 0x73, 0x65, 0x3b, 0x0a, 0x09, 0x7d,
-    0x20, 0x65, 0x72, 0x72, 0x0a, 0x09, 0x72, 0x65,
-    0x74, 0x75, 0x72, 0x6e, 0x20, 0x24, 0x72, 0x65,
-    0x73, 0x75, 0x6c, 0x74, 0x0a, 0x7d, 0x0a, 0x0a,
-    0x70, 0x72, 0x6f, 0x63, 0x20, 0x6c, 0x6f, 0x61,
-    0x64, 0x5f, 0x76, 0x61, 0x72, 0x20, 0x7b, 0x61,
-    0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x72, 0x65, 0x74,
-    0x75, 0x72, 0x6e, 0x20, 0x5b, 0x6c, 0x6f, 0x61,
-    0x64, 0x5f, 0x66, 0x69, 0x6c, 0x65, 0x20, 0x2f,
-    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x2f, 0x73,
-    0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x73, 0x2f,
-    0x24, 0x61, 0x5d, 0x0a, 0x7d, 0x0a, 0x70, 0x72,
-    0x6f, 0x63, 0x20, 0x73, 0x61, 0x76, 0x65, 0x5f,
-    0x76, 0x61, 0x72, 0x20, 0x7b, 0x61, 0x20, 0x62,
-    0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x63, 0x61, 0x74,
-    0x63, 0x68, 0x20, 0x7b, 0x20, 0x0a, 0x09, 0x73,
-    0x65, 0x74, 0x20, 0x66, 0x70, 0x20, 0x5b, 0x61,
-    0x69, 0x6f, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x20,
+    0x20, 0x73, 0x65, 0x74, 0x20, 0x61, 0x20, 0x5b,
+    0x65, 0x78, 0x70, 0x72, 0x20, 0x24, 0x61, 0x2f,
+    0x31, 0x36, 0x5d, 0x0a, 0x20, 0x20, 0x20, 0x20,
+    0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x72, 0x20,
+    0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20,
+    0x69, 0x6e, 0x64, 0x65, 0x78, 0x20, 0x22, 0x30,
+    0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38,
+    0x39, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x22,
+    0x20, 0x24, 0x72, 0x65, 0x6d, 0x5d, 0x24, 0x72,
+    0x0a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x69,
+    0x66, 0x20, 0x28, 0x24, 0x61, 0x3d, 0x3d, 0x30,
+    0x29, 0x20, 0x74, 0x68, 0x65, 0x6e, 0x20, 0x62,
+    0x72, 0x65, 0x61, 0x6b, 0x0a, 0x20, 0x20, 0x20,
+    0x7d, 0x20, 0x20, 0x0a, 0x20, 0x20, 0x20, 0x72,
+    0x65, 0x74, 0x75, 0x72, 0x6e, 0x20, 0x24, 0x72,
+    0x20, 0x0a, 0x7d, 0x0a, 0x0a, 0x23, 0x20, 0x65,
+    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x74, 0x65,
+    0x78, 0x74, 0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20,
+    0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x7b,
+    0x61, 0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x72, 0x65,
+    0x74, 0x75, 0x72, 0x6e, 0x20, 0x5b, 0x73, 0x74,
+    0x72, 0x69, 0x6e, 0x67, 0x20, 0x6d, 0x61, 0x70,
+    0x20, 0x7b, 0x5c, 0x6e, 0x20, 0x3c, 0x62, 0x72,
+    0x2f, 0x3e, 0x20, 0x7b, 0x20, 0x7d, 0x20, 0x7b,
+    0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b, 0x7d, 0x20,
+    0x5c, 0x74, 0x20, 0x7b, 0x26, 0x6e, 0x62, 0x73,
+    0x70, 0x3b, 0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b,
+    0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b, 0x26, 0x6e,
+    0x62, 0x73, 0x70, 0x3b, 0x26, 0x6e, 0x62, 0x73,
+    0x70, 0x3b, 0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b,
+    0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b, 0x26, 0x6e,
+    0x62, 0x73, 0x70, 0x3b, 0x7d, 0x20, 0x3e, 0x20,
+    0x26, 0x67, 0x74, 0x3b, 0x20, 0x3c, 0x20, 0x26,
+    0x6c, 0x74, 0x3b, 0x20, 0x2f, 0x20, 0x26, 0x23,
+    0x34, 0x37, 0x3b, 0x7d, 0x20, 0x24, 0x61, 0x5d,
+    0x0a, 0x7d, 0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20,
+    0x6c, 0x6f, 0x61, 0x64, 0x5f, 0x66, 0x69, 0x6c,
+    0x65, 0x20, 0x7b, 0x61, 0x7d, 0x20, 0x7b, 0x0a,
+    0x09, 0x73, 0x65, 0x74, 0x20, 0x72, 0x65, 0x73,
+    0x75, 0x6c, 0x74, 0x20, 0x22, 0x22, 0x0a, 0x09,
+    0x63, 0x61, 0x74, 0x63, 0x68, 0x20, 0x7b, 0x20,
+    0x0a, 0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x66,
+    0x70, 0x20, 0x5b, 0x61, 0x69, 0x6f, 0x2e, 0x6f,
+    0x70, 0x65, 0x6e, 0x20, 0x24, 0x61, 0x20, 0x72,
+    0x5d, 0x0a, 0x09, 0x09, 0x73, 0x65, 0x74, 0x20,
+    0x72, 0x65, 0x73, 0x75, 0x6c, 0x74, 0x20, 0x5b,
+    0x24, 0x66, 0x70, 0x20, 0x72, 0x65, 0x61, 0x64,
+    0x5d, 0x0a, 0x09, 0x09, 0x24, 0x66, 0x70, 0x20,
+    0x63, 0x6c, 0x6f, 0x73, 0x65, 0x3b, 0x0a, 0x09,
+    0x7d, 0x20, 0x65, 0x72, 0x72, 0x0a, 0x09, 0x72,
+    0x65, 0x74, 0x75, 0x72, 0x6e, 0x20, 0x24, 0x72,
+    0x65, 0x73, 0x75, 0x6c, 0x74, 0x0a, 0x7d, 0x0a,
+    0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20, 0x6c, 0x6f,
+    0x61, 0x64, 0x5f, 0x76, 0x61, 0x72, 0x20, 0x7b,
+    0x61, 0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x72, 0x65,
+    0x74, 0x75, 0x72, 0x6e, 0x20, 0x5b, 0x6c, 0x6f,
+    0x61, 0x64, 0x5f, 0x66, 0x69, 0x6c, 0x65, 0x20,
     0x2f, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x2f,
     0x73, 0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x73,
-    0x2f, 0x24, 0x61, 0x20, 0x77, 0x5d, 0x0a, 0x09,
-    0x24, 0x66, 0x70, 0x20, 0x70, 0x75, 0x74, 0x73,
-    0x20, 0x2d, 0x6e, 0x6f, 0x6e, 0x65, 0x77, 0x6c,
-    0x69, 0x6e, 0x65, 0x20, 0x24, 0x62, 0x0a, 0x09,
-    0x24, 0x66, 0x70, 0x20, 0x63, 0x6c, 0x6f, 0x73,
-    0x65, 0x3b, 0x0a, 0x09, 0x7d, 0x20, 0x65, 0x72,
-    0x72, 0x0a, 0x7d, 0x0a, 0x0a, 0x23, 0x20, 0x52,
-    0x65, 0x61, 0x64, 0x20, 0x66, 0x72, 0x6f, 0x6d,
+    0x2f, 0x24, 0x61, 0x5d, 0x0a, 0x7d, 0x0a, 0x70,
+    0x72, 0x6f, 0x63, 0x20, 0x73, 0x61, 0x76, 0x65,
+    0x5f, 0x76, 0x61, 0x72, 0x20, 0x7b, 0x61, 0x20,
+    0x62, 0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x63, 0x61,
+    0x74, 0x63, 0x68, 0x20, 0x7b, 0x20, 0x0a, 0x09,
+    0x73, 0x65, 0x74, 0x20, 0x66, 0x70, 0x20, 0x5b,
+    0x61, 0x69, 0x6f, 0x2e, 0x6f, 0x70, 0x65, 0x6e,
     0x20, 0x2f, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
     0x2f, 0x73, 0x65, 0x74, 0x74, 0x69, 0x6e, 0x67,
-    0x73, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x74, 0x68,
-    0x65, 0x6e, 0x20, 0x2f, 0x72, 0x6f, 0x6d, 0x0a,
-    0x70, 0x72, 0x6f, 0x63, 0x20, 0x6c, 0x6f, 0x61,
-    0x64, 0x5f, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
-    0x20, 0x7b, 0x61, 0x7d, 0x20, 0x7b, 0x0a, 0x09,
-    0x73, 0x65, 0x74, 0x20, 0x72, 0x65, 0x73, 0x75,
-    0x6c, 0x74, 0x20, 0x5b, 0x6c, 0x6f, 0x61, 0x64,
-    0x5f, 0x66, 0x69, 0x6c, 0x65, 0x20, 0x22, 0x2f,
-    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x2f, 0x73,
-    0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x73, 0x2f,
-    0x24, 0x61, 0x22, 0x5d, 0x0a, 0x09, 0x69, 0x66,
-    0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e,
-    0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68,
-    0x20, 0x24, 0x72, 0x65, 0x73, 0x75, 0x6c, 0x74,
-    0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0a,
-    0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x72, 0x65,
-    0x73, 0x75, 0x6c, 0x74, 0x20, 0x5b, 0x6c, 0x6f,
-    0x61, 0x64, 0x5f, 0x66, 0x69, 0x6c, 0x65, 0x20,
-    0x22, 0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x24, 0x61,
-    0x22, 0x5d, 0x0a, 0x09, 0x7d, 0x0a, 0x09, 0x72,
-    0x65, 0x74, 0x75, 0x72, 0x6e, 0x20, 0x24, 0x72,
-    0x65, 0x73, 0x75, 0x6c, 0x74, 0x0a, 0x7d, 0x0a,
+    0x73, 0x2f, 0x24, 0x61, 0x20, 0x77, 0x5d, 0x0a,
+    0x09, 0x24, 0x66, 0x70, 0x20, 0x70, 0x75, 0x74,
+    0x73, 0x20, 0x2d, 0x6e, 0x6f, 0x6e, 0x65, 0x77,
+    0x6c, 0x69, 0x6e, 0x65, 0x20, 0x24, 0x62, 0x0a,
+    0x09, 0x24, 0x66, 0x70, 0x20, 0x63, 0x6c, 0x6f,
+    0x73, 0x65, 0x3b, 0x0a, 0x09, 0x7d, 0x20, 0x65,
+    0x72, 0x72, 0x0a, 0x7d, 0x0a, 0x0a, 0x23, 0x20,
+    0x52, 0x65, 0x61, 0x64, 0x20, 0x66, 0x72, 0x6f,
+    0x6d, 0x20, 0x2f, 0x63, 0x6f, 0x6e, 0x66, 0x69,
+    0x67, 0x2f, 0x73, 0x65, 0x74, 0x74, 0x69, 0x6e,
+    0x67, 0x73, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x74,
+    0x68, 0x65, 0x6e, 0x20, 0x2f, 0x72, 0x6f, 0x6d,
     0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20, 0x6c, 0x6f,
-    0x61, 0x64, 0x5f, 0x74, 0x61, 0x72, 0x67, 0x65,
-    0x74, 0x20, 0x7b, 0x7d, 0x20, 0x7b, 0x0a, 0x09,
-    0x73, 0x65, 0x74, 0x20, 0x63, 0x6f, 0x6e, 0x66,
-    0x69, 0x67, 0x46, 0x69, 0x6c, 0x65, 0x20, 0x22,
-    0x22, 0x0a, 0x09, 0x63, 0x61, 0x74, 0x63, 0x68,
-    0x20, 0x7b, 0x20, 0x0a, 0x09, 0x09, 0x73, 0x65,
-    0x74, 0x20, 0x66, 0x70, 0x20, 0x5b, 0x61, 0x69,
-    0x6f, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x20, 0x2f,
-    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x2f, 0x73,
-    0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x73, 0x2f,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x2e,
-    0x63, 0x66, 0x67, 0x20, 0x72, 0x5d, 0x0a, 0x09,
+    0x61, 0x64, 0x5f, 0x63, 0x6f, 0x6e, 0x66, 0x69,
+    0x67, 0x20, 0x7b, 0x61, 0x7d, 0x20, 0x7b, 0x0a,
+    0x09, 0x73, 0x65, 0x74, 0x20, 0x72, 0x65, 0x73,
+    0x75, 0x6c, 0x74, 0x20, 0x5b, 0x6c, 0x6f, 0x61,
+    0x64, 0x5f, 0x66, 0x69, 0x6c, 0x65, 0x20, 0x22,
+    0x2f, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x2f,
+    0x73, 0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x73,
+    0x2f, 0x24, 0x61, 0x22, 0x5d, 0x0a, 0x09, 0x69,
+    0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69,
+    0x6e, 0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74,
+    0x68, 0x20, 0x24, 0x72, 0x65, 0x73, 0x75, 0x6c,
+    0x74, 0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b,
+    0x0a, 0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x72,
+    0x65, 0x73, 0x75, 0x6c, 0x74, 0x20, 0x5b, 0x6c,
+    0x6f, 0x61, 0x64, 0x5f, 0x66, 0x69, 0x6c, 0x65,
+    0x20, 0x22, 0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x24,
+    0x61, 0x22, 0x5d, 0x0a, 0x09, 0x7d, 0x0a, 0x09,
+    0x72, 0x65, 0x74, 0x75, 0x72, 0x6e, 0x20, 0x24,
+    0x72, 0x65, 0x73, 0x75, 0x6c, 0x74, 0x0a, 0x7d,
+    0x0a, 0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20, 0x6c,
+    0x6f, 0x61, 0x64, 0x5f, 0x74, 0x61, 0x72, 0x67,
+    0x65, 0x74, 0x20, 0x7b, 0x7d, 0x20, 0x7b, 0x0a,
     0x09, 0x73, 0x65, 0x74, 0x20, 0x63, 0x6f, 0x6e,
     0x66, 0x69, 0x67, 0x46, 0x69, 0x6c, 0x65, 0x20,
-    0x5b, 0x24, 0x66, 0x70, 0x20, 0x72, 0x65, 0x61,
-    0x64, 0x5d, 0x0a, 0x09, 0x09, 0x24, 0x66, 0x70,
-    0x20, 0x63, 0x6c, 0x6f, 0x73, 0x65, 0x3b, 0x0a,
-    0x09, 0x7d, 0x20, 0x65, 0x72, 0x72, 0x0a, 0x09,
-    0x0a, 0x09, 0x23, 0x20, 0x66, 0x69, 0x73, 0x68,
-    0x20, 0x6f, 0x75, 0x74, 0x20, 0x74, 0x61, 0x72,
-    0x67, 0x65, 0x74, 0x20, 0x6e, 0x61, 0x6d, 0x65,
-    0x0a, 0x09, 0x73, 0x65, 0x74, 0x20, 0x66, 0x6f,
-    0x72, 0x6d, 0x5f, 0x74, 0x61, 0x72, 0x67, 0x65,
-    0x74, 0x20, 0x22, 0x22, 0x0a, 0x09, 0x73, 0x65,
-    0x74, 0x20, 0x66, 0x6f, 0x75, 0x6e, 0x64, 0x20,
-    0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20,
-    0x66, 0x69, 0x72, 0x73, 0x74, 0x20, 0x22, 0x73,
-    0x63, 0x72, 0x69, 0x70, 0x74, 0x20, 0x74, 0x61,
-    0x72, 0x67, 0x65, 0x74, 0x2f, 0x22, 0x20, 0x24,
-    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x46, 0x69,
-    0x6c, 0x65, 0x5d, 0x0a, 0x09, 0x69, 0x66, 0x20,
-    0x7b, 0x24, 0x66, 0x6f, 0x75, 0x6e, 0x64, 0x3d,
-    0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x09,
-    0x73, 0x65, 0x74, 0x20, 0x66, 0x6f, 0x72, 0x6d,
-    0x5f, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20,
-    0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20,
-    0x72, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x24, 0x63,
-    0x6f, 0x6e, 0x66, 0x69, 0x67, 0x46, 0x69, 0x6c,
-    0x65, 0x20, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e,
-    0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68,
-    0x20, 0x22, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74,
-    0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x2f,
-    0x22, 0x5d, 0x20, 0x5b, 0x65, 0x78, 0x70, 0x72,
+    0x22, 0x22, 0x0a, 0x09, 0x63, 0x61, 0x74, 0x63,
+    0x68, 0x20, 0x7b, 0x20, 0x0a, 0x09, 0x09, 0x73,
+    0x65, 0x74, 0x20, 0x66, 0x70, 0x20, 0x5b, 0x61,
+    0x69, 0x6f, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x20,
+    0x2f, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x2f,
+    0x73, 0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x73,
+    0x2f, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
+    0x2e, 0x63, 0x66, 0x67, 0x20, 0x72, 0x5d, 0x0a,
+    0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x63, 0x6f,
+    0x6e, 0x66, 0x69, 0x67, 0x46, 0x69, 0x6c, 0x65,
+    0x20, 0x5b, 0x24, 0x66, 0x70, 0x20, 0x72, 0x65,
+    0x61, 0x64, 0x5d, 0x0a, 0x09, 0x09, 0x24, 0x66,
+    0x70, 0x20, 0x63, 0x6c, 0x6f, 0x73, 0x65, 0x3b,
+    0x0a, 0x09, 0x7d, 0x20, 0x65, 0x72, 0x72, 0x0a,
+    0x09, 0x0a, 0x09, 0x23, 0x20, 0x66, 0x69, 0x73,
+    0x68, 0x20, 0x6f, 0x75, 0x74, 0x20, 0x74, 0x61,
+    0x72, 0x67, 0x65, 0x74, 0x20, 0x6e, 0x61, 0x6d,
+    0x65, 0x0a, 0x09, 0x73, 0x65, 0x74, 0x20, 0x66,
+    0x6f, 0x72, 0x6d, 0x5f, 0x74, 0x61, 0x72, 0x67,
+    0x65, 0x74, 0x20, 0x22, 0x22, 0x0a, 0x09, 0x73,
+    0x65, 0x74, 0x20, 0x66, 0x6f, 0x75, 0x6e, 0x64,
     0x20, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67,
-    0x20, 0x66, 0x69, 0x72, 0x73, 0x74, 0x20, 0x5c,
-    0x6e, 0x20, 0x24, 0x63, 0x6f, 0x6e, 0x66, 0x69,
-    0x67, 0x46, 0x69, 0x6c, 0x65, 0x5d, 0x2d, 0x31,
-    0x5d, 0x5d, 0x0a, 0x09, 0x7d, 0x0a, 0x09, 0x0a,
+    0x20, 0x66, 0x69, 0x72, 0x73, 0x74, 0x20, 0x22,
+    0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x20, 0x74,
+    0x61, 0x72, 0x67, 0x65, 0x74, 0x2f, 0x22, 0x20,
+    0x24, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x46,
+    0x69, 0x6c, 0x65, 0x5d, 0x0a, 0x09, 0x69, 0x66,
+    0x20, 0x7b, 0x24, 0x66, 0x6f, 0x75, 0x6e, 0x64,
+    0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0a, 0x09,
+    0x09, 0x73, 0x65, 0x74, 0x20, 0x66, 0x6f, 0x72,
+    0x6d, 0x5f, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74,
+    0x20, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67,
+    0x20, 0x72, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x24,
+    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x46, 0x69,
+    0x6c, 0x65, 0x20, 0x5b, 0x73, 0x74, 0x72, 0x69,
+    0x6e, 0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74,
+    0x68, 0x20, 0x22, 0x73, 0x63, 0x72, 0x69, 0x70,
+    0x74, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74,
+    0x2f, 0x22, 0x5d, 0x20, 0x5b, 0x65, 0x78, 0x70,
+    0x72, 0x20, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e,
+    0x67, 0x20, 0x66, 0x69, 0x72, 0x73, 0x74, 0x20,
+    0x5c, 0x6e, 0x20, 0x24, 0x63, 0x6f, 0x6e, 0x66,
+    0x69, 0x67, 0x46, 0x69, 0x6c, 0x65, 0x5d, 0x2d,
+    0x31, 0x5d, 0x5d, 0x0a, 0x09, 0x7d, 0x0a, 0x09,
+    0x0a, 0x09, 0x72, 0x65, 0x74, 0x75, 0x72, 0x6e,
+    0x20, 0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x74,
+    0x61, 0x72, 0x67, 0x65, 0x74, 0x0a, 0x09, 0x09,
+    0x0a, 0x7d, 0x09, 0x09, 0x09, 0x09, 0x0a, 0x0a,
+    0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20, 0x74, 0x6f,
+    0x5f, 0x74, 0x65, 0x78, 0x74, 0x61, 0x72, 0x65,
+    0x61, 0x20, 0x7b, 0x61, 0x7d, 0x20, 0x7b, 0x0a,
     0x09, 0x72, 0x65, 0x74, 0x75, 0x72, 0x6e, 0x20,
-    0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x74, 0x61,
-    0x72, 0x67, 0x65, 0x74, 0x0a, 0x09, 0x09, 0x0a,
-    0x7d, 0x09, 0x09, 0x09, 0x09, 0x0a, 0x0a, 0x0a,
-    0x70, 0x72, 0x6f, 0x63, 0x20, 0x74, 0x6f, 0x5f,
-    0x74, 0x65, 0x78, 0x74, 0x61, 0x72, 0x65, 0x61,
-    0x20, 0x7b, 0x61, 0x7d, 0x20, 0x7b, 0x0a, 0x09,
-    0x72, 0x65, 0x74, 0x75, 0x72, 0x6e, 0x20, 0x5b,
-    0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x6d,
-    0x61, 0x70, 0x20, 0x7b, 0x26, 0x20, 0x26, 0x23,
-    0x33, 0x38, 0x3b, 0x20, 0x3e, 0x20, 0x26, 0x67,
-    0x74, 0x3b, 0x20, 0x3c, 0x20, 0x26, 0x6c, 0x74,
-    0x3b, 0x20, 0x2f, 0x20, 0x26, 0x23, 0x34, 0x37,
-    0x3b, 0x7d, 0x20, 0x24, 0x61, 0x5d, 0x0a, 0x7d,
-    0x09, 0x0a, 0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20,
-    0x66, 0x72, 0x6f, 0x6d, 0x5f, 0x74, 0x65, 0x78,
-    0x74, 0x61, 0x72, 0x65, 0x61, 0x20, 0x7b, 0x61,
-    0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x72, 0x65, 0x74,
-    0x75, 0x72, 0x6e, 0x20, 0x5b, 0x73, 0x74, 0x72,
-    0x69, 0x6e, 0x67, 0x20, 0x6d, 0x61, 0x70, 0x20,
-    0x7b, 0x26, 0x67, 0x74, 0x3b, 0x20, 0x3e, 0x20,
-    0x26, 0x6c, 0x74, 0x3b, 0x20, 0x3c, 0x20, 0x26,
-    0x23, 0x33, 0x38, 0x3b, 0x20, 0x26, 0x20, 0x26,
-    0x23, 0x34, 0x37, 0x3b, 0x20, 0x2f, 0x7d, 0x20,
-    0x24, 0x61, 0x5d, 0x0a, 0x7d, 0x0a, 0x09, 0x0a,
-    0x70, 0x72, 0x6f, 0x63, 0x20, 0x6c, 0x75, 0x6e,
-    0x69, 0x6f, 0x6e, 0x20, 0x7b, 0x61, 0x20, 0x62,
-    0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x66, 0x6f, 0x72,
-    0x65, 0x61, 0x63, 0x68, 0x20, 0x65, 0x20, 0x24,
-    0x61, 0x20, 0x7b, 0x0a, 0x09, 0x09, 0x73, 0x65,
-    0x74, 0x20, 0x78, 0x28, 0x24, 0x65, 0x29, 0x20,
-    0x7b, 0x7d, 0x0a, 0x09, 0x7d, 0x0a, 0x20, 0x09,
-    0x66, 0x6f, 0x72, 0x65, 0x61, 0x63, 0x68, 0x20,
-    0x65, 0x20, 0x24, 0x62, 0x20, 0x7b, 0x0a, 0x09,
-    0x09, 0x69, 0x66, 0x20, 0x7b, 0x21, 0x5b, 0x69,
-    0x6e, 0x66, 0x6f, 0x20, 0x65, 0x78, 0x69, 0x73,
-    0x74, 0x73, 0x20, 0x78, 0x28, 0x24, 0x65, 0x29,
-    0x5d, 0x7d, 0x20, 0x7b, 0x0a, 0x20, 0x20, 0x20,
-    0x20, 0x09, 0x09, 0x6c, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x61, 0x20, 0x24, 0x65, 0x0a,
-    0x09, 0x09, 0x7d, 0x0a, 0x09, 0x7d, 0x0a, 0x20,
-    0x09, 0x72, 0x65, 0x74, 0x75, 0x72, 0x6e, 0x20,
-    0x24, 0x61, 0x0a, 0x7d, 0x0a, 0x20, 0x0a, 0x0a,
-    0x20, 0x0a, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x66,
-    0x61, 0x63, 0x65, 0x20, 0x5a, 0x59, 0x31, 0x30,
-    0x30, 0x30, 0x0a, 0x74, 0x65, 0x6c, 0x6e, 0x65,
-    0x74, 0x5f, 0x70, 0x6f, 0x72, 0x74, 0x20, 0x32,
-    0x33, 0x0a, 0x67, 0x64, 0x62, 0x5f, 0x70, 0x6f,
-    0x72, 0x74, 0x20, 0x33, 0x33, 0x33, 0x33, 0x0a,
-    0x23, 0x20, 0x31, 0x4d, 0x48, 0x7a, 0x20, 0x64,
-    0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x20, 0x73,
-    0x70, 0x65, 0x65, 0x64, 0x0a, 0x6a, 0x74, 0x61,
-    0x67, 0x5f, 0x6b, 0x68, 0x7a, 0x20, 0x31, 0x30,
-    0x30, 0x30, 0x0a, 0x0a, 0x23, 0x20, 0x52, 0x75,
-    0x6e, 0x20, 0x64, 0x65, 0x66, 0x61, 0x75, 0x6c,
-    0x74, 0x20, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74,
-    0x0a, 0x0a, 0x67, 0x6c, 0x6f, 0x62, 0x61, 0x6c,
-    0x20, 0x73, 0x74, 0x61, 0x72, 0x74, 0x75, 0x70,
-    0x5f, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x0a,
-    0x73, 0x65, 0x74, 0x20, 0x73, 0x74, 0x61, 0x72,
-    0x74, 0x75, 0x70, 0x5f, 0x73, 0x74, 0x61, 0x74,
-    0x75, 0x73, 0x20, 0x30, 0x0a, 0x0a, 0x23, 0x20,
-    0x48, 0x65, 0x72, 0x65, 0x20, 0x77, 0x65, 0x20,
-    0x64, 0x6f, 0x20, 0x2a, 0x6e, 0x6f, 0x74, 0x2a,
-    0x20, 0x63, 0x61, 0x74, 0x63, 0x68, 0x20, 0x74,
-    0x68, 0x65, 0x20, 0x65, 0x72, 0x72, 0x6f, 0x72,
-    0x20, 0x73, 0x69, 0x6e, 0x63, 0x65, 0x20, 0x77,
-    0x65, 0x20, 0x77, 0x61, 0x6e, 0x74, 0x20, 0x74,
-    0x68, 0x65, 0x20, 0x66, 0x69, 0x6c, 0x65, 0x20,
-    0x26, 0x20, 0x6c, 0x69, 0x6e, 0x65, 0x20, 0x6e,
-    0x75, 0x6d, 0x62, 0x65, 0x72, 0x20, 0x74, 0x6f,
-    0x20, 0x61, 0x70, 0x70, 0x65, 0x61, 0x72, 0x0a,
-    0x23, 0x20, 0x69, 0x6e, 0x20, 0x74, 0x68, 0x65,
-    0x20, 0x6c, 0x6f, 0x67, 0x0a, 0x73, 0x63, 0x72,
-    0x69, 0x70, 0x74, 0x20, 0x2f, 0x63, 0x6f, 0x6e,
-    0x66, 0x69, 0x67, 0x2f, 0x73, 0x65, 0x74, 0x74,
-    0x69, 0x6e, 0x67, 0x73, 0x2f, 0x6f, 0x70, 0x65,
-    0x6e, 0x6f, 0x63, 0x64, 0x2e, 0x63, 0x66, 0x67,
-    0x0a, 0x69, 0x6e, 0x69, 0x74, 0x20, 0x72, 0x65,
-    0x73, 0x75, 0x6c, 0x74, 0x0a, 0x23, 0x20, 0x53,
-    0x74, 0x61, 0x72, 0x74, 0x75, 0x70, 0x20, 0x77,
-    0x61, 0x73, 0x20, 0x4f, 0x4b, 0x0a, 0x73, 0x65,
-    0x74, 0x20, 0x73, 0x74, 0x61, 0x72, 0x74, 0x75,
+    0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20,
+    0x6d, 0x61, 0x70, 0x20, 0x7b, 0x26, 0x20, 0x26,
+    0x23, 0x33, 0x38, 0x3b, 0x20, 0x3e, 0x20, 0x26,
+    0x67, 0x74, 0x3b, 0x20, 0x3c, 0x20, 0x26, 0x6c,
+    0x74, 0x3b, 0x20, 0x2f, 0x20, 0x26, 0x23, 0x34,
+    0x37, 0x3b, 0x7d, 0x20, 0x24, 0x61, 0x5d, 0x0a,
+    0x7d, 0x09, 0x0a, 0x0a, 0x70, 0x72, 0x6f, 0x63,
+    0x20, 0x66, 0x72, 0x6f, 0x6d, 0x5f, 0x74, 0x65,
+    0x78, 0x74, 0x61, 0x72, 0x65, 0x61, 0x20, 0x7b,
+    0x61, 0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x72, 0x65,
+    0x74, 0x75, 0x72, 0x6e, 0x20, 0x5b, 0x73, 0x74,
+    0x72, 0x69, 0x6e, 0x67, 0x20, 0x6d, 0x61, 0x70,
+    0x20, 0x7b, 0x26, 0x67, 0x74, 0x3b, 0x20, 0x3e,
+    0x20, 0x26, 0x6c, 0x74, 0x3b, 0x20, 0x3c, 0x20,
+    0x26, 0x23, 0x33, 0x38, 0x3b, 0x20, 0x26, 0x20,
+    0x26, 0x23, 0x34, 0x37, 0x3b, 0x20, 0x2f, 0x7d,
+    0x20, 0x24, 0x61, 0x5d, 0x0a, 0x7d, 0x0a, 0x09,
+    0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20, 0x6c, 0x75,
+    0x6e, 0x69, 0x6f, 0x6e, 0x20, 0x7b, 0x61, 0x20,
+    0x62, 0x7d, 0x20, 0x7b, 0x0a, 0x09, 0x66, 0x6f,
+    0x72, 0x65, 0x61, 0x63, 0x68, 0x20, 0x65, 0x20,
+    0x24, 0x61, 0x20, 0x7b, 0x0a, 0x09, 0x09, 0x73,
+    0x65, 0x74, 0x20, 0x78, 0x28, 0x24, 0x65, 0x29,
+    0x20, 0x7b, 0x7d, 0x0a, 0x09, 0x7d, 0x0a, 0x20,
+    0x09, 0x66, 0x6f, 0x72, 0x65, 0x61, 0x63, 0x68,
+    0x20, 0x65, 0x20, 0x24, 0x62, 0x20, 0x7b, 0x0a,
+    0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x21, 0x5b,
+    0x69, 0x6e, 0x66, 0x6f, 0x20, 0x65, 0x78, 0x69,
+    0x73, 0x74, 0x73, 0x20, 0x78, 0x28, 0x24, 0x65,
+    0x29, 0x5d, 0x7d, 0x20, 0x7b, 0x0a, 0x20, 0x20,
+    0x20, 0x20, 0x09, 0x09, 0x6c, 0x61, 0x70, 0x70,
+    0x65, 0x6e, 0x64, 0x20, 0x61, 0x20, 0x24, 0x65,
+    0x0a, 0x09, 0x09, 0x7d, 0x0a, 0x09, 0x7d, 0x0a,
+    0x20, 0x09, 0x72, 0x65, 0x74, 0x75, 0x72, 0x6e,
+    0x20, 0x24, 0x61, 0x0a, 0x7d, 0x0a, 0x20, 0x0a,
+    0x0a, 0x20, 0x0a, 0x69, 0x6e, 0x74, 0x65, 0x72,
+    0x66, 0x61, 0x63, 0x65, 0x20, 0x5a, 0x59, 0x31,
+    0x30, 0x30, 0x30, 0x0a, 0x74, 0x65, 0x6c, 0x6e,
+    0x65, 0x74, 0x5f, 0x70, 0x6f, 0x72, 0x74, 0x20,
+    0x32, 0x33, 0x0a, 0x67, 0x64, 0x62, 0x5f, 0x70,
+    0x6f, 0x72, 0x74, 0x20, 0x33, 0x33, 0x33, 0x33,
+    0x0a, 0x23, 0x20, 0x31, 0x4d, 0x48, 0x7a, 0x20,
+    0x64, 0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x20,
+    0x73, 0x70, 0x65, 0x65, 0x64, 0x0a, 0x6a, 0x74,
+    0x61, 0x67, 0x5f, 0x6b, 0x68, 0x7a, 0x20, 0x31,
+    0x30, 0x30, 0x30, 0x0a, 0x0a, 0x23, 0x20, 0x52,
+    0x75, 0x6e, 0x20, 0x64, 0x65, 0x66, 0x61, 0x75,
+    0x6c, 0x74, 0x20, 0x73, 0x63, 0x72, 0x69, 0x70,
+    0x74, 0x0a, 0x0a, 0x67, 0x6c, 0x6f, 0x62, 0x61,
+    0x6c, 0x20, 0x73, 0x74, 0x61, 0x72, 0x74, 0x75,
     0x70, 0x5f, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73,
-    0x20, 0x31, 0x0a, 0x0a, 0x0a, 0x61, 0x64, 0x64,
-    0x5f, 0x68, 0x65, 0x6c, 0x70, 0x5f, 0x74, 0x65,
-    0x78, 0x74, 0x20, 0x6c, 0x73, 0x20, 0x22, 0x3c,
-    0x64, 0x69, 0x72, 0x65, 0x63, 0x74, 0x6f, 0x72,
-    0x79, 0x3e, 0x20, 0x2d, 0x20, 0x6c, 0x69, 0x73,
-    0x74, 0x73, 0x20, 0x66, 0x69, 0x6c, 0x65, 0x73,
-    0x20, 0x69, 0x6e, 0x20, 0x64, 0x69, 0x72, 0x65,
-    0x63, 0x74, 0x6f, 0x72, 0x79, 0x22, 0x0a, 0x61,
-    0x64, 0x64, 0x5f, 0x68, 0x65, 0x6c, 0x70, 0x5f,
-    0x74, 0x65, 0x78, 0x74, 0x20, 0x72, 0x65, 0x62,
-    0x6f, 0x6f, 0x74, 0x20, 0x22, 0x72, 0x65, 0x62,
-    0x6f, 0x6f, 0x74, 0x73, 0x20, 0x5a, 0x59, 0x31,
+    0x0a, 0x73, 0x65, 0x74, 0x20, 0x73, 0x74, 0x61,
+    0x72, 0x74, 0x75, 0x70, 0x5f, 0x73, 0x74, 0x61,
+    0x74, 0x75, 0x73, 0x20, 0x30, 0x0a, 0x0a, 0x23,
+    0x20, 0x48, 0x65, 0x72, 0x65, 0x20, 0x77, 0x65,
+    0x20, 0x64, 0x6f, 0x20, 0x2a, 0x6e, 0x6f, 0x74,
+    0x2a, 0x20, 0x63, 0x61, 0x74, 0x63, 0x68, 0x20,
+    0x74, 0x68, 0x65, 0x20, 0x65, 0x72, 0x72, 0x6f,
+    0x72, 0x20, 0x73, 0x69, 0x6e, 0x63, 0x65, 0x20,
+    0x77, 0x65, 0x20, 0x77, 0x61, 0x6e, 0x74, 0x20,
+    0x74, 0x68, 0x65, 0x20, 0x66, 0x69, 0x6c, 0x65,
+    0x20, 0x26, 0x20, 0x6c, 0x69, 0x6e, 0x65, 0x20,
+    0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72, 0x20, 0x74,
+    0x6f, 0x20, 0x61, 0x70, 0x70, 0x65, 0x61, 0x72,
+    0x0a, 0x23, 0x20, 0x69, 0x6e, 0x20, 0x74, 0x68,
+    0x65, 0x20, 0x6c, 0x6f, 0x67, 0x0a, 0x73, 0x63,
+    0x72, 0x69, 0x70, 0x74, 0x20, 0x2f, 0x63, 0x6f,
+    0x6e, 0x66, 0x69, 0x67, 0x2f, 0x73, 0x65, 0x74,
+    0x74, 0x69, 0x6e, 0x67, 0x73, 0x2f, 0x6f, 0x70,
+    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x2e, 0x63, 0x66,
+    0x67, 0x0a, 0x69, 0x6e, 0x69, 0x74, 0x20, 0x72,
+    0x65, 0x73, 0x75, 0x6c, 0x74, 0x0a, 0x23, 0x20,
+    0x53, 0x74, 0x61, 0x72, 0x74, 0x75, 0x70, 0x20,
+    0x77, 0x61, 0x73, 0x20, 0x4f, 0x4b, 0x0a, 0x73,
+    0x65, 0x74, 0x20, 0x73, 0x74, 0x61, 0x72, 0x74,
+    0x75, 0x70, 0x5f, 0x73, 0x74, 0x61, 0x74, 0x75,
+    0x73, 0x20, 0x31, 0x0a, 0x0a, 0x0a, 0x61, 0x64,
+    0x64, 0x5f, 0x68, 0x65, 0x6c, 0x70, 0x5f, 0x74,
+    0x65, 0x78, 0x74, 0x20, 0x6c, 0x73, 0x20, 0x22,
+    0x3c, 0x64, 0x69, 0x72, 0x65, 0x63, 0x74, 0x6f,
+    0x72, 0x79, 0x3e, 0x20, 0x2d, 0x20, 0x6c, 0x69,
+    0x73, 0x74, 0x73, 0x20, 0x66, 0x69, 0x6c, 0x65,
+    0x73, 0x20, 0x69, 0x6e, 0x20, 0x64, 0x69, 0x72,
+    0x65, 0x63, 0x74, 0x6f, 0x72, 0x79, 0x22, 0x0a,
+    0x61, 0x64, 0x64, 0x5f, 0x68, 0x65, 0x6c, 0x70,
+    0x5f, 0x74, 0x65, 0x78, 0x74, 0x20, 0x72, 0x65,
+    0x62, 0x6f, 0x6f, 0x74, 0x20, 0x22, 0x72, 0x65,
+    0x62, 0x6f, 0x6f, 0x74, 0x73, 0x20, 0x5a, 0x59,
+    0x31, 0x30, 0x30, 0x30, 0x20, 0x75, 0x6e, 0x69,
+    0x74, 0x22, 0x0a, 0x61, 0x64, 0x64, 0x5f, 0x68,
+    0x65, 0x6c, 0x70, 0x5f, 0x74, 0x65, 0x78, 0x74,
+    0x20, 0x6d, 0x61, 0x63, 0x20, 0x22, 0x70, 0x72,
+    0x69, 0x6e, 0x74, 0x73, 0x20, 0x4d, 0x41, 0x43,
+    0x20, 0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72, 0x20,
+    0x6f, 0x66, 0x20, 0x5a, 0x59, 0x31, 0x30, 0x30,
+    0x30, 0x20, 0x75, 0x6e, 0x69, 0x74, 0x22, 0x0a,
+    0x61, 0x64, 0x64, 0x5f, 0x68, 0x65, 0x6c, 0x70,
+    0x5f, 0x74, 0x65, 0x78, 0x74, 0x20, 0x69, 0x70,
+    0x20, 0x22, 0x70, 0x72, 0x69, 0x6e, 0x74, 0x20,
+    0x63, 0x75, 0x72, 0x72, 0x65, 0x6e, 0x74, 0x20,
+    0x49, 0x50, 0x20, 0x6e, 0x75, 0x6d, 0x62, 0x65,
+    0x72, 0x20, 0x6f, 0x66, 0x20, 0x5a, 0x59, 0x31,
     0x30, 0x30, 0x30, 0x20, 0x75, 0x6e, 0x69, 0x74,
-    0x22, 0x0a, 0x61, 0x64, 0x64, 0x5f, 0x68, 0x65,
-    0x6c, 0x70, 0x5f, 0x74, 0x65, 0x78, 0x74, 0x20,
-    0x6d, 0x61, 0x63, 0x20, 0x22, 0x70, 0x72, 0x69,
-    0x6e, 0x74, 0x73, 0x20, 0x4d, 0x41, 0x43, 0x20,
-    0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72, 0x20, 0x6f,
-    0x66, 0x20, 0x5a, 0x59, 0x31, 0x30, 0x30, 0x30,
-    0x20, 0x75, 0x6e, 0x69, 0x74, 0x22, 0x0a, 0x61,
-    0x64, 0x64, 0x5f, 0x68, 0x65, 0x6c, 0x70, 0x5f,
-    0x74, 0x65, 0x78, 0x74, 0x20, 0x69, 0x70, 0x20,
-    0x22, 0x70, 0x72, 0x69, 0x6e, 0x74, 0x20, 0x63,
-    0x75, 0x72, 0x72, 0x65, 0x6e, 0x74, 0x20, 0x49,
-    0x50, 0x20, 0x6e, 0x75, 0x6d, 0x62, 0x65, 0x72,
-    0x20, 0x6f, 0x66, 0x20, 0x5a, 0x59, 0x31, 0x30,
-    0x30, 0x30, 0x20, 0x75, 0x6e, 0x69, 0x74, 0x22,
-    0x0a, 0x0a, 0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20,
-    0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x66,
-    0x6c, 0x61, 0x73, 0x68, 0x20, 0x7b, 0x7d, 0x20,
-    0x7b, 0x0a, 0x09, 0x73, 0x65, 0x74, 0x20, 0x74,
-    0x20, 0x5b, 0x6c, 0x69, 0x6e, 0x64, 0x65, 0x78,
-    0x20, 0x30, 0x20, 0x5b, 0x6f, 0x63, 0x64, 0x5f,
-    0x66, 0x6c, 0x61, 0x73, 0x68, 0x5f, 0x62, 0x61,
-    0x6e, 0x6b, 0x73, 0x5d, 0x5d, 0x0a, 0x09, 0x72,
-    0x65, 0x74, 0x75, 0x72, 0x6e, 0x20, 0x24, 0x74,
-    0x28, 0x62, 0x61, 0x73, 0x65, 0x29, 0x0a, 0x7d,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x22, 0x0a, 0x0a, 0x0a, 0x70, 0x72, 0x6f, 0x63,
+    0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f,
+    0x66, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x7b, 0x7d,
+    0x20, 0x7b, 0x0a, 0x09, 0x73, 0x65, 0x74, 0x20,
+    0x74, 0x20, 0x5b, 0x6c, 0x69, 0x6e, 0x64, 0x65,
+    0x78, 0x20, 0x30, 0x20, 0x5b, 0x6f, 0x63, 0x64,
+    0x5f, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x5f, 0x62,
+    0x61, 0x6e, 0x6b, 0x73, 0x5d, 0x5d, 0x0a, 0x09,
+    0x72, 0x65, 0x74, 0x75, 0x72, 0x6e, 0x20, 0x24,
+    0x74, 0x28, 0x62, 0x61, 0x73, 0x65, 0x29, 0x0a,
+    0x7d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -25978,8 +25970,8 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -27337,8 +27329,8 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -27910,14 +27902,14 @@
     0x20, 0x61, 0x6e, 0x64, 0x20, 0x72, 0x65, 0x6c,
     0x6f, 0x61, 0x64, 0x22, 0x5d, 0x3d, 0x3d, 0x30,
     0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
+    0x09, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65,
     0x20, 0x22, 0x74, 0x72, 0x75, 0x6e, 0x63, 0x20,
     0x2f, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x2f,
     0x73, 0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x73,
     0x2f, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
     0x2e, 0x63, 0x66, 0x67, 0x22, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x6f, 0x70, 0x65, 0x6e, 0x6f,
-    0x63, 0x64, 0x20, 0x22, 0x61, 0x70, 0x70, 0x65,
+    0x09, 0x09, 0x09, 0x63, 0x61, 0x70, 0x74, 0x75,
+    0x72, 0x65, 0x20, 0x22, 0x61, 0x70, 0x70, 0x65,
     0x6e, 0x64, 0x5f, 0x66, 0x69, 0x6c, 0x65, 0x20,
     0x2f, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x2f,
     0x73, 0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x73,
@@ -28884,8 +28876,8 @@
     0x74, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x22, 0x3e,
     0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e,
-    0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79, 0x31, 0x30,
+    0x65, 0x72, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
+    0x75, 0x72, 0x65, 0x20, 0x7a, 0x79, 0x31, 0x30,
     0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73, 0x69,
     0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
@@ -29548,8 +29540,8 @@
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70,
     0x70, 0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e,
     0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e,
-    0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22, 0x70,
+    0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x70,
     0x6f, 0x77, 0x65, 0x72, 0x20, 0x6f, 0x6e, 0x22,
     0x5d, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
@@ -29563,8 +29555,8 @@
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f,
     0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65,
-    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22,
+    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63,
+    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22,
     0x70, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x6f, 0x66,
     0x66, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09,
@@ -30509,7 +30501,7 @@
     0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
     0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
@@ -31830,8 +31822,8 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -32378,19 +32370,19 @@
     0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73,
     0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63,
-    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65,
-    0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22, 0x68, 0x61,
+    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70,
+    0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x68, 0x61,
     0x6c, 0x74, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63,
     0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b,
     0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x22, 0x77, 0x61, 0x69, 0x74, 0x5f, 0x68, 0x61,
     0x6c, 0x74, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63,
     0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b,
     0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b,
-    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x22, 0x72, 0x65, 0x73, 0x75, 0x6d, 0x65, 0x20,
     0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x64,
     0x64, 0x72, 0x65, 0x73, 0x73, 0x22, 0x5d, 0x5d,
@@ -32404,13 +32396,13 @@
     0x0a, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
     0x20, 0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65,
     0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65,
-    0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63,
-    0x64, 0x20, 0x22, 0x68, 0x61, 0x6c, 0x74, 0x22,
+    0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
+    0x65, 0x20, 0x22, 0x68, 0x61, 0x6c, 0x74, 0x22,
     0x5d, 0x5d, 0x0d, 0x0a, 0x09, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73,
     0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63,
-    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65,
-    0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22, 0x77, 0x61,
+    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70,
+    0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x77, 0x61,
     0x69, 0x74, 0x5f, 0x68, 0x61, 0x6c, 0x74, 0x22,
     0x5d, 0x5d, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x20,
     0x20, 0x0d, 0x0a, 0x69, 0x66, 0x20, 0x7b, 0x5b,
@@ -32423,8 +32415,8 @@
     0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73,
     0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63,
-    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65,
-    0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22, 0x72, 0x65,
+    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70,
+    0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x72, 0x65,
     0x73, 0x65, 0x74, 0x20, 0x72, 0x75, 0x6e, 0x22,
     0x5d, 0x5d, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x20,
     0x20, 0x0d, 0x0a, 0x69, 0x66, 0x20, 0x7b, 0x5b,
@@ -32437,15 +32429,15 @@
     0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x61, 0x70,
     0x70, 0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e,
     0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e,
-    0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22, 0x72,
+    0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x72,
     0x65, 0x73, 0x65, 0x74, 0x20, 0x69, 0x6e, 0x69,
     0x74, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x7d, 0x20,
     0x20, 0x0d, 0x0a, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73,
     0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63,
-    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x6f, 0x70, 0x65,
-    0x6e, 0x6f, 0x63, 0x64, 0x20, 0x70, 0x6f, 0x6c,
+    0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70,
+    0x74, 0x75, 0x72, 0x65, 0x20, 0x70, 0x6f, 0x6c,
     0x6c, 0x5d, 0x5d, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
@@ -33711,8 +33703,8 @@
     0x74, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x22, 0x3e,
     0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e,
-    0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79, 0x31, 0x30,
+    0x65, 0x72, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
+    0x75, 0x72, 0x65, 0x20, 0x7a, 0x79, 0x31, 0x30,
     0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73, 0x69,
     0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
@@ -34274,8 +34266,8 @@
     0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
     0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x6c, 0x6f,
     0x67, 0x20, 0x22, 0x56, 0x65, 0x72, 0x73, 0x69,
-    0x6f, 0x6e, 0x3a, 0x20, 0x5b, 0x6f, 0x70, 0x65,
-    0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22, 0x7a, 0x79,
+    0x6f, 0x6e, 0x3a, 0x20, 0x5b, 0x63, 0x61, 0x70,
+    0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x20, 0x7a, 0x79, 0x31,
     0x30, 0x30, 0x30, 0x22, 0x5d, 0x22, 0x0d, 0x0a,
@@ -34283,8 +34275,8 @@
     0x64, 0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x6c,
     0x6f, 0x67, 0x20, 0x22, 0x4f, 0x70, 0x65, 0x6e,
     0x4f, 0x43, 0x44, 0x20, 0x76, 0x65, 0x72, 0x73,
-    0x69, 0x6f, 0x6e, 0x3a, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22, 0x7a,
+    0x69, 0x6f, 0x6e, 0x3a, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x7a,
     0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65,
     0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x6f, 0x70,
     0x65, 0x6e, 0x6f, 0x63, 0x64, 0x22, 0x5d, 0x22,
@@ -34292,8 +34284,8 @@
     0x65, 0x6e, 0x64, 0x20, 0x66, 0x6f, 0x72, 0x6d,
     0x5f, 0x6c, 0x6f, 0x67, 0x20, 0x22, 0x56, 0x65,
     0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x64, 0x61,
-    0x74, 0x65, 0x3a, 0x20, 0x5b, 0x6f, 0x70, 0x65,
-    0x6e, 0x6f, 0x63, 0x64, 0x20, 0x22, 0x7a, 0x79,
+    0x74, 0x65, 0x3a, 0x20, 0x5b, 0x63, 0x61, 0x70,
+    0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x20, 0x64, 0x61, 0x74,
     0x65, 0x22, 0x5d, 0x22, 0x0d, 0x0a, 0x09, 0x09,
@@ -35483,8 +35475,8 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -36632,8 +36624,8 @@
     0x74, 0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68,
     0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
-    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63,
+    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a,
     0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65,
     0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
@@ -37816,8 +37808,8 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -39310,8 +39302,8 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
+    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -40922,8 +40914,8 @@
     0x69, 0x67, 0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a,
     0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x5b, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63,
-    0x64, 0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
+    0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
+    0x65, 0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
     0x5f, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e,
     0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,

Modified: zy1000/trunk/build/tcl/browsemem.tcl
===================================================================
--- zy1000/trunk/build/tcl/browsemem.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/browsemem.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -54,7 +54,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -208,10 +208,10 @@
 					set form_address "0x[tohex [expr $form_address+$form_length]]"
 				}  
 				if {[string compare $form_action "Modify"]==0} {
-					append console [openocd "$modify_cmd $form_address $form_value"]
+					append console [capture "$modify_cmd $form_address $form_value"]
 				}  
 				if {[string compare $form_action "Fill"]==0} {
-					append console [openocd "$modify_cmd $form_address $form_value $form_length"]
+					append console [capture "$modify_cmd $form_address $form_value $form_length"]
 				}  
 			}
 			
@@ -259,8 +259,8 @@
 			<code style="white-space: nowrap; font-size:11px;font:courier new;">
 				<tcl>
 				if {[string compare $form_address ""]!=0} {
-					append console [encode [openocd halt]]
-					append buffer [encode [openocd "$form_type $form_address [expr $form_length]"]]
+					append console [encode [capture halt]]
+					append buffer [encode [capture "$form_type $form_address [expr $form_length]"]]
 				} 
 				</tcl>
 			</code>

Modified: zy1000/trunk/build/tcl/downloadmem.tcl
===================================================================
--- zy1000/trunk/build/tcl/downloadmem.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/downloadmem.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -59,7 +59,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -180,8 +180,8 @@
 			</form>
 			<tcl>
 				if {[string compare $form_action "Download"]==0} {
-					append console [encode [openocd "reset init"]]
-					append console [encode [openocd "dump_image /ram/dump.bin $form_address $form_length"]]
+					append console [encode [capture "reset init"]]
+					append console [encode [capture "dump_image /ram/dump.bin $form_address $form_length"]]
 					</tcl>
 					<form action="../dump.bin" target="_blank"> 
 						<input type="submit" name="form_action" value="Save downloaded memory">

Modified: zy1000/trunk/build/tcl/editconfigs.tcl
===================================================================
--- zy1000/trunk/build/tcl/editconfigs.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/editconfigs.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -27,7 +27,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -150,7 +150,7 @@
 				}
 				
 				if {[string compare $form_action "Delete"]==0} {
-					openocd "rm /config/settings/$form_selected"
+					capture "rm /config/settings/$form_selected"
 				}
 				
 				if {[string compare $form_action "Save"]==0} {

Modified: zy1000/trunk/build/tcl/editfile.tcl
===================================================================
--- zy1000/trunk/build/tcl/editfile.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/editfile.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -75,7 +75,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -213,7 +213,7 @@
 	} err
 }
 if {[string compare $form_action "Delete"]==0} {
-	openocd "rm $form_filename"
+	capture "rm $form_filename"
 }
 
 set form_edittext_subst [to_textarea $form_edittext]

Modified: zy1000/trunk/build/tcl/erase.tcl
===================================================================
--- zy1000/trunk/build/tcl/erase.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/erase.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -48,7 +48,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -181,8 +181,8 @@
 			if {[string compare $form_address ""]!=0} {
 				if {[string compare $form_action "Erase"]==0} {
 						append buffer "<code style=\"white-space: nowrap;\">"
-						append console [encode [openocd "reset init"]]
-						append console [encode [openocd "flash erase_address $form_address $form_length"]]
+						append console [encode [capture "reset init"]]
+						append console [encode [capture "flash erase_address $form_address $form_length"]]
 						append buffer </code>
 				}  
 			}

Modified: zy1000/trunk/build/tcl/flash.tcl
===================================================================
--- zy1000/trunk/build/tcl/flash.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/flash.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -39,7 +39,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -178,7 +178,7 @@
 			set action_verify [expr {[string compare $form_action "Verify"]==0 || [string compare $form_action "Flash and verify"]==0}]
 			
 			if {$action_reset} {
-				append console [encode [openocd "reset init"]]
+				append console [encode [capture "reset init"]]
 			}
 			</tcl>
 			</code><tcl>
@@ -232,7 +232,7 @@
 			}
 			append buffer "<br>"
 			if {$action_flash} {
-				append console [encode [openocd "halt"]]
+				append console [encode [capture "halt"]]
 				append buffer "<b>"
 				if {[catch {capture {eval "flash write_image erase $upload_filename $form_offset $form_type"}} result]} {
 					append buffer "Flash write failed<br>"
@@ -244,7 +244,7 @@
 				append buffer "</b>"
 			}
 			if {$action_verify} {
-				append console [encode [openocd "halt"]]
+				append console [encode [capture "halt"]]
 				append buffer "<b>"
 				if {[catch {capture {eval "verify_image $upload_filename $form_offset $form_type"}} result]} {
 					append buffer "Verify failed<br>"

Modified: zy1000/trunk/build/tcl/flashinfo.tcl
===================================================================
--- zy1000/trunk/build/tcl/flashinfo.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/flashinfo.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -37,7 +37,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -159,9 +159,9 @@
 					
 						set form_action [formfetch form_action]
 						if {[string compare $form_action "Reset CPU and probe flash"]==0} {
-							append console [encode [openocd "reset init"]]
-							append buffer [encode [openocd "flash probe 0"]]
-							append buffer [encode [openocd "flash info 0"]]
+							append console [encode [capture "reset init"]]
+							append buffer [encode [capture "flash probe 0"]]
+							append buffer [encode [capture "flash info 0"]]
 						}
 					} else {
 						append buffer "No flash bank configured."

Modified: zy1000/trunk/build/tcl/guiupload.tcl
===================================================================
--- zy1000/trunk/build/tcl/guiupload.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/guiupload.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -69,7 +69,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/index.tcl
===================================================================
--- zy1000/trunk/build/tcl/index.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/index.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -21,7 +21,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -164,9 +164,9 @@
 							append buffer [ocd_jtag_khz]
 						</tcl>
 						<br>
-						<tcl>append buffer [openocd {zy1000_version zy1000}]</tcl><br>
-						<tcl>append buffer [openocd {zy1000_version openocd}]</tcl><br>
-						<tcl>append buffer [openocd {zy1000_version date}]</tcl><br>
+						<tcl>append buffer [capture {zy1000_version zy1000}]</tcl><br>
+						<tcl>append buffer [capture {zy1000_version openocd}]</tcl><br>
+						<tcl>append buffer [capture {zy1000_version date}]</tcl><br>
 						<tcl>append buffer [ip]</tcl><br>
 						<tcl>append buffer [ocd_gdb_port]</tcl>
 					</td>
@@ -202,25 +202,25 @@
 							set form_action [formfetch form_action]
 							
 							if {[string compare $form_action "Halt"]==0} {
-								append console [encode [openocd "halt"]]
+								append console [encode [capture "halt"]]
 							}
 							if {[string compare $form_action "Resume"]==0} {
-								append console [encode [openocd "resume"]]
+								append console [encode [capture "resume"]]
 							}
 							  
 							if {[string compare $form_action "Reset and run"]==0} {
-								append console [encode [openocd "reset run"]]
+								append console [encode [capture "reset run"]]
 							}
 							
 							if {[string compare $form_action "Power on"]==0} {
-								append console [encode [openocd "power on"]]
+								append console [encode [capture "power on"]]
 							}
 							if {[string compare $form_action "Power off"]==0} {
-								append console [encode [openocd "power off"]]
+								append console [encode [capture "power off"]]
 							}
 						</tcl>
 					
-						<tcl>append console [encode [openocd poll]]</tcl>
+						<tcl>append console [encode [capture poll]]</tcl>
 					</td>
 				</tr>
 			</table>

Modified: zy1000/trunk/build/tcl/log.tcl
===================================================================
--- zy1000/trunk/build/tcl/log.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/log.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -66,7 +66,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/openocd.tcl
===================================================================
--- zy1000/trunk/build/tcl/openocd.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/openocd.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -63,7 +63,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/preconfig.tcl
===================================================================
--- zy1000/trunk/build/tcl/preconfig.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/preconfig.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -24,7 +24,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -143,8 +143,8 @@
 			
 			append buffer {<form enctype="multipart/form-data" action="preconfig.tcl" method="post">}
 			if {[string compare $form_action "Select and reload"]==0} {
-				openocd "trunc /config/settings/openocd.cfg"
-				openocd "append_file /config/settings/openocd.cfg script target/$form_target"
+				capture "trunc /config/settings/openocd.cfg"
+				capture "append_file /config/settings/openocd.cfg script target/$form_target"
 				reboot 
 			}
 			

Modified: zy1000/trunk/build/tcl/production.tcl
===================================================================
--- zy1000/trunk/build/tcl/production.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/production.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -44,7 +44,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -180,10 +180,10 @@
 							append console [encode [capture {catch production_test}]]
 						}
 						if {[string compare $form_action "Power on"]==0} {
-							append console [encode [openocd "power on"]]
+							append console [encode [capture "power on"]]
 						}
 						if {[string compare $form_action "Power off"]==0} {
-							append console [encode [openocd "power off"]]
+							append console [encode [capture "power off"]]
 						}
 					</tcl>
 				</code>

Modified: zy1000/trunk/build/tcl/reload.tcl
===================================================================
--- zy1000/trunk/build/tcl/reload.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/reload.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -34,7 +34,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/run.tcl
===================================================================
--- zy1000/trunk/build/tcl/run.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/run.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -51,7 +51,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -171,25 +171,25 @@
 set form_action [formfetch form_action]
 
 if {[string compare $form_action "Run from address"]==0} {
-	append console [encode [openocd "halt"]]
-	append console [encode [openocd "wait_halt"]]
-	append console [encode [openocd "resume $form_address"]]
+	append console [encode [capture "halt"]]
+	append console [encode [capture "wait_halt"]]
+	append console [encode [capture "resume $form_address"]]
 }  
 
 if {[string compare $form_action "Halt"]==0} {
-	append console [encode [openocd "halt"]]
-	append console [encode [openocd "wait_halt"]]
+	append console [encode [capture "halt"]]
+	append console [encode [capture "wait_halt"]]
 }
   
 if {[string compare $form_action "Reset and run"]==0} {
-	append console [encode [openocd "reset run"]]
+	append console [encode [capture "reset run"]]
 }
   
 if {[string compare $form_action "Reset and init"]==0} {
-	append console [encode [openocd "reset init"]]
+	append console [encode [capture "reset init"]]
 }  
 
-append console [encode [openocd poll]]
+append console [encode [capture poll]]
 
 </tcl>
 

Modified: zy1000/trunk/build/tcl/support.tcl
===================================================================
--- zy1000/trunk/build/tcl/support.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/support.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -85,7 +85,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -202,9 +202,9 @@
 			set form_config [load_config "target/[load_target]"]
 			set support_id [string range [rand] 0 7]
 			set form_log ""
-			append form_log "Version: [openocd "zy1000_version zy1000"]"
-			append form_log "OpenOCD version: [openocd "zy1000_version openocd"]"
-			append form_log "Version date: [openocd "zy1000_version date"]"
+			append form_log "Version: [capture "zy1000_version zy1000"]"
+			append form_log "OpenOCD version: [capture "zy1000_version openocd"]"
+			append form_log "Version date: [capture "zy1000_version date"]"
 			append form_log [log]
 			</tcl>
 

Modified: zy1000/trunk/build/tcl/targets.tcl
===================================================================
--- zy1000/trunk/build/tcl/targets.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/targets.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -30,7 +30,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -325,7 +325,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/terminal.tcl
===================================================================
--- zy1000/trunk/build/tcl/terminal.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/terminal.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -89,7 +89,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/upgrade.tcl
===================================================================
--- zy1000/trunk/build/tcl/upgrade.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/upgrade.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -72,7 +72,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/zy1000.tcl
===================================================================
--- zy1000/trunk/build/tcl/zy1000.tcl	2008-12-17 09:56:59 UTC (rev 1252)
+++ zy1000/trunk/build/tcl/zy1000.tcl	2008-12-17 11:33:33 UTC (rev 1253)
@@ -82,7 +82,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [openocd zy1000_version]</tcl>
+<tcl>append buffer [capture zy1000_version]</tcl>
 </div>
 </div>
 </div>



From oharboe at mail.berlios.de  Wed Dec 17 13:50:08 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 17 Dec 2008 13:50:08 +0100
Subject: [Openocd-svn] r1254 - trunk/src/server
Message-ID: <200812171250.mBHCo838017989@sheep.berlios.de>

Author: oharboe
Date: 2008-12-17 13:50:07 +0100 (Wed, 17 Dec 2008)
New Revision: 1254

Modified:
   trunk/src/server/httpd.c
Log:
fixed gaffe in post handling

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2008-12-17 11:33:33 UTC (rev 1253)
+++ trunk/src/server/httpd.c	2008-12-17 12:50:07 UTC (rev 1254)
@@ -175,9 +175,13 @@
     	int retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
     	free((void *) script);
     	if (retcode != JIM_OK)
-    		return retcode;
+    	{
+    	    Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+    	} else
+    	{
+    	    Jim_SetResult(interp, Jim_GetResult(interp));
+    	}
 
-    Jim_SetResult(interp, Jim_GetResult(interp));
     return JIM_OK;
 }
 
@@ -292,9 +296,8 @@
 		r = (struct httpd_request *) *ptr;
 
 		r->post = post;
+		Jim_SetVariableStr(interp, "httppostdata", Jim_NewDictObj(interp, NULL, 0));
 
-//		r->dict = Jim_NewDictObj(interp, NULL, 0);
-
 		/* fill in url query strings in dictonary */
 		MHD_get_connection_values(connection, MHD_GET_ARGUMENT_KIND,
 				record_arg, r);
@@ -327,7 +330,6 @@
 	}
 
 	/* hand over to request who will be using it. */
-	//Jim_SetGlobalVariableStr(interp, "httppostdata", Jim_GetVariableStr(interp, "httppostdata", 0));
 	//	r->dict = NULL;
 
 



From oharboe at mail.berlios.de  Wed Dec 17 14:39:47 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 17 Dec 2008 14:39:47 +0100
Subject: [Openocd-svn] r1255 - in trunk/src: . helper server
Message-ID: <200812171339.mBHDdlWj022691@sheep.berlios.de>

Author: oharboe
Date: 2008-12-17 14:39:40 +0100 (Wed, 17 Dec 2008)
New Revision: 1255

Modified:
   trunk/src/ecosboard.c
   trunk/src/helper/ioutil.c
   trunk/src/server/telnet_server.c
Log:
houskeeping

Modified: trunk/src/ecosboard.c
===================================================================
--- trunk/src/ecosboard.c	2008-12-17 12:50:07 UTC (rev 1254)
+++ trunk/src/ecosboard.c	2008-12-17 13:39:40 UTC (rev 1255)
@@ -419,61 +419,7 @@
 	return JIM_OK;
 }
 
-static int zylinjtag_Jim_Command_mac(Jim_Interp *interp, int argc,
-		Jim_Obj * const *argv)
-{
 
-	Jim_Obj *tclOutput = Jim_NewStringObj(interp, "", 0);
-
-	Jim_AppendString(httpstate.jim_interp, tclOutput, hwaddr, strlen(hwaddr));
-
-	Jim_SetResult(interp, tclOutput);
-
-	return JIM_OK;
-}
-
-static int zylinjtag_Jim_Command_ip(Jim_Interp *interp, int argc,
-		Jim_Obj * const *argv)
-{
-	Jim_Obj *tclOutput = Jim_NewStringObj(interp, "", 0);
-
-	struct ifaddrs *ifa = NULL, *ifp = NULL;
-
-	if (getifaddrs(&ifp) < 0)
-	{
-		return JIM_ERR;
-	}
-
-	for (ifa = ifp; ifa; ifa = ifa->ifa_next)
-	{
-		char ip[200];
-		socklen_t salen;
-
-		if (ifa->ifa_addr->sa_family == AF_INET)
-			salen = sizeof(struct sockaddr_in);
-		else if (ifa->ifa_addr->sa_family == AF_INET6)
-			salen = sizeof(struct sockaddr_in6);
-		else
-			continue;
-
-		if (getnameinfo(ifa->ifa_addr, salen, ip, sizeof(ip), NULL, 0,
-				NI_NUMERICHOST) < 0)
-		{
-			continue;
-		}
-
-		Jim_AppendString(httpstate.jim_interp, tclOutput, ip, strlen(ip));
-		break;
-
-	}
-
-	freeifaddrs(ifp);
-
-	Jim_SetResult(interp, tclOutput);
-
-	return JIM_OK;
-}
-
 extern Jim_Interp *interp;
 
 static void zylinjtag_startNetwork()
@@ -506,10 +452,6 @@
 			zylinjtag_Jim_Command_reboot, NULL, NULL);
 	Jim_CreateCommand(httpstate.jim_interp, "threads",
 			zylinjtag_Jim_Command_threads, NULL, NULL);
-	Jim_CreateCommand(httpstate.jim_interp, "mac", zylinjtag_Jim_Command_mac,
-			NULL, NULL);
-	Jim_CreateCommand(httpstate.jim_interp, "ip", zylinjtag_Jim_Command_ip,
-			NULL, NULL);
 	Jim_CreateCommand(httpstate.jim_interp, "format_jffs2",
 			zylinjtag_Jim_Command_format_jffs2, NULL, NULL);
 

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2008-12-17 12:50:07 UTC (rev 1254)
+++ trunk/src/helper/ioutil.c	2008-12-17 13:39:40 UTC (rev 1255)
@@ -63,6 +63,8 @@
 #include <string.h>
 
 
+#include <ifaddrs.h>
+
 #include <unistd.h>
 #include <stdio.h>
 
@@ -557,6 +559,120 @@
 	return JIM_OK;
 }
 
+
+/* not so pretty code to fish out ip number*/
+static int zylinjtag_Jim_Command_ip(Jim_Interp *interp, int argc,
+		Jim_Obj * const *argv)
+{
+	Jim_Obj *tclOutput = Jim_NewStringObj(interp, "", 0);
+
+	struct ifaddrs *ifa = NULL, *ifp = NULL;
+
+	if (getifaddrs(&ifp) < 0)
+	{
+		return JIM_ERR;
+	}
+
+	for (ifa = ifp; ifa; ifa = ifa->ifa_next)
+	{
+		char ip[200];
+		socklen_t salen;
+
+		if (ifa->ifa_addr->sa_family == AF_INET)
+			salen = sizeof(struct sockaddr_in);
+		else if (ifa->ifa_addr->sa_family == AF_INET6)
+			salen = sizeof(struct sockaddr_in6);
+		else
+			continue;
+
+		if (getnameinfo(ifa->ifa_addr, salen, ip, sizeof(ip), NULL, 0,
+				NI_NUMERICHOST) < 0)
+		{
+			continue;
+		}
+
+		Jim_AppendString(interp, tclOutput, ip, strlen(ip));
+		break;
+
+	}
+
+	freeifaddrs(ifp);
+
+	Jim_SetResult(interp, tclOutput);
+
+	return JIM_OK;
+}
+
+
+/* not so pretty code to fish out eth0 mac address */
+static int zylinjtag_Jim_Command_mac(Jim_Interp *interp, int argc,
+		Jim_Obj * const *argv)
+{
+
+
+	struct ifreq *ifr, *ifend;
+	struct ifreq ifreq;
+	struct ifconf ifc;
+	struct ifreq ifs[5];
+	int SockFD;
+
+	SockFD = socket(AF_INET, SOCK_DGRAM, 0);
+	if (SockFD < 0)
+	{
+		return JIM_ERR;
+	}
+
+	ifc.ifc_len = sizeof(ifs);
+	ifc.ifc_req = ifs;
+	if (ioctl(SockFD, SIOCGIFCONF, &ifc) < 0)
+	{
+		close(SockFD);
+		return JIM_ERR;
+	}
+
+	ifend = ifs + (ifc.ifc_len / sizeof(struct ifreq));
+	for (ifr = ifc.ifc_req; ifr < ifend; ifr++)
+	{
+		//if (ifr->ifr_addr.sa_family == AF_INET)
+		{
+			if (strcmp("eth0", ifr->ifr_name)!=0)
+				continue;
+			strncpy(ifreq.ifr_name, ifr->ifr_name, sizeof(ifreq.ifr_name));
+			if (ioctl(SockFD, SIOCGIFHWADDR, &ifreq) < 0)
+			{
+				close(SockFD);
+				return JIM_ERR;
+			}
+
+			close(SockFD);
+
+
+			Jim_Obj *tclOutput = Jim_NewStringObj(interp, "", 0);
+
+			char buffer[256];
+			sprintf(buffer, "%02x-%02x-%02x-%02x-%02x-%02x",
+					ifreq.ifr_hwaddr.sa_data[0]&0xff,
+					ifreq.ifr_hwaddr.sa_data[1]&0xff,
+					ifreq.ifr_hwaddr.sa_data[2]&0xff,
+					ifreq.ifr_hwaddr.sa_data[3]&0xff,
+					ifreq.ifr_hwaddr.sa_data[4]&0xff,
+					ifreq.ifr_hwaddr.sa_data[5]&0xff);
+
+			Jim_AppendString(interp, tclOutput, buffer, strlen(buffer));
+
+			Jim_SetResult(interp, tclOutput);
+
+			return JIM_OK;
+		}
+	}
+	close(SockFD);
+
+	return JIM_ERR;
+
+}
+
+
+
 int ioutil_init(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, "rm", handle_rm_command, COMMAND_ANY,
@@ -583,7 +699,12 @@
     Jim_CreateCommand(interp, "poke", zylinjtag_Jim_Command_poke, NULL, NULL);
     Jim_CreateCommand(interp, "ls", zylinjtag_Jim_Command_ls, NULL, NULL);
 
+	Jim_CreateCommand(interp, "mac", zylinjtag_Jim_Command_mac,
+			NULL, NULL);
 
+	Jim_CreateCommand(interp, "ip", zylinjtag_Jim_Command_ip,
+			NULL, NULL);
+
     return ERROR_OK;
 }
 

Modified: trunk/src/server/telnet_server.c
===================================================================
--- trunk/src/server/telnet_server.c	2008-12-17 12:50:07 UTC (rev 1254)
+++ trunk/src/server/telnet_server.c	2008-12-17 13:39:40 UTC (rev 1255)
@@ -626,7 +626,7 @@
 					 COMMAND_EXEC, "exit telnet session");
 
 	register_command(command_context, NULL, "telnet_port", handle_telnet_port_command,
-					 COMMAND_CONFIG, "port on which to listen for incoming telnet connections");
+					 COMMAND_ANY, "port on which to listen for incoming telnet connections");
 
 	return ERROR_OK;
 }



From oharboe at mail.berlios.de  Wed Dec 17 15:07:05 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 17 Dec 2008 15:07:05 +0100
Subject: [Openocd-svn] r1256 - trunk/src/jtag zy1000/trunk/build/menu
	zy1000/trunk/build/tcl
Message-ID: <200812171407.mBHE75Nu026356@sheep.berlios.de>

Author: oharboe
Date: 2008-12-17 15:07:03 +0100 (Wed, 17 Dec 2008)
New Revision: 1256

Modified:
   trunk/src/jtag/zy1000.c
   zy1000/trunk/build/menu/zy1000menu.xml
   zy1000/trunk/build/tcl/index.tcl
Log:
more houskeeping

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2008-12-17 13:39:40 UTC (rev 1255)
+++ trunk/src/jtag/zy1000.c	2008-12-17 14:07:03 UTC (rev 1256)
@@ -319,6 +319,25 @@
 }
 
 
+static int
+zylinjtag_Jim_Command_powerstatus(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
+{
+	if (argc != 1)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "powerstatus");
+		return JIM_ERR;
+	}
+
+	cyg_uint32 status;
+	ZY1000_PEEK(ZY1000_JTAG_BASE+0x10, status);
+
+	Jim_SetResult(interp, Jim_NewIntObj(interp, (status&0x80)!=0));
+
+	return JIM_OK;
+}
+
 int zy1000_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, "power", handle_power_command, COMMAND_ANY,
@@ -326,11 +345,14 @@
 	register_command(cmd_ctx, NULL, "zy1000_version", handle_zy1000_version_command,
 			COMMAND_EXEC, "show zy1000 version numbers");
 
+	Jim_CreateCommand(interp, "powerstatus", zylinjtag_Jim_Command_powerstatus, NULL, NULL);
 
 	return ERROR_OK;
 }
 
 
+
+
 int zy1000_init(void)
 {
 	LOG_ERROR("%s\n", ZYLIN_OPENOCD_VERSION);

Modified: zy1000/trunk/build/menu/zy1000menu.xml
===================================================================
--- zy1000/trunk/build/menu/zy1000menu.xml	2008-12-17 13:39:40 UTC (rev 1255)
+++ zy1000/trunk/build/menu/zy1000menu.xml	2008-12-17 14:07:03 UTC (rev 1256)
@@ -85,7 +85,7 @@
 				<tr>
 					<td class="fontbigger" style="height:20px;padding-right:10px;">Target power: 
 						<tcl>
-						if {[expr [peek 0x08000010] & 0x80]!=0} {
+						if {[powerstatus]!=0} {
 							append buffer "no"
 						} else {
 							append buffer "yes"

Modified: zy1000/trunk/build/tcl/index.tcl
===================================================================
--- zy1000/trunk/build/tcl/index.tcl	2008-12-17 13:39:40 UTC (rev 1255)
+++ zy1000/trunk/build/tcl/index.tcl	2008-12-17 14:07:03 UTC (rev 1256)
@@ -187,7 +187,7 @@
 				<tr>
 					<td class="fontbigger" style="height:20px;padding-right:10px;">Target power: 
 						<tcl>
-						if {[expr [peek 0x08000010] & 0x80]!=0} {
+						if {[powerstatus]!=0} {
 							append buffer "no"
 						} else {
 							append buffer "yes"



From oharboe at mail.berlios.de  Wed Dec 17 15:55:15 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 17 Dec 2008 15:55:15 +0100
Subject: [Openocd-svn] r1257 - trunk/src trunk/src/jtag
	zy1000/trunk/build/tcl
Message-ID: <200812171455.mBHEtFMb030351@sheep.berlios.de>

Author: oharboe
Date: 2008-12-17 15:55:12 +0100 (Wed, 17 Dec 2008)
New Revision: 1257

Modified:
   trunk/src/jtag/zy1000.c
   trunk/src/openocd.c
   zy1000/trunk/build/tcl/openocd.cfg
Log:
check syntax for init/version

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2008-12-17 14:07:03 UTC (rev 1256)
+++ trunk/src/jtag/zy1000.c	2008-12-17 14:55:12 UTC (rev 1257)
@@ -355,7 +355,7 @@
 
 int zy1000_init(void)
 {
-	LOG_ERROR("%s\n", ZYLIN_OPENOCD_VERSION);
+	LOG_USER("%s", ZYLIN_OPENOCD_VERSION);
 
 	ZY1000_POKE(ZY1000_JTAG_BASE+0x10, 0x30); // Turn on LED1 & LED2
 

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2008-12-17 14:07:03 UTC (rev 1256)
+++ trunk/src/openocd.c	2008-12-17 14:55:12 UTC (rev 1257)
@@ -82,6 +82,9 @@
 /* Give TELNET a way to find out what version this is */
 int handle_version_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
+	if (argc!=0)
+		return ERROR_COMMAND_SYNTAX_ERROR;
+
 	command_print(cmd_ctx, OPENOCD_VERSION);
 
 	return ERROR_OK;
@@ -123,6 +126,10 @@
 /* OpenOCD can't really handle failure of this command. Patches welcome! :-) */
 int handle_init_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
+
+	if (argc!=0)
+		return ERROR_COMMAND_SYNTAX_ERROR;
+
 	int retval;
 	static int initialized=0;
 	if (initialized)

Modified: zy1000/trunk/build/tcl/openocd.cfg
===================================================================
--- zy1000/trunk/build/tcl/openocd.cfg	2008-12-17 14:07:03 UTC (rev 1256)
+++ zy1000/trunk/build/tcl/openocd.cfg	2008-12-17 14:55:12 UTC (rev 1257)
@@ -90,6 +90,16 @@
 }
  
 
+add_help_text ls "<directory> - lists files in directory"
+add_help_text reboot "reboots ZY1000 unit"
+add_help_text mac "prints MAC number of ZY1000 unit"
+add_help_text ip "print current IP number of ZY1000 unit"
+
+
+proc zy1000_flash {} {
+	set t [lindex 0 [ocd_flash_banks]]
+	return $t(base)
+}
  
 interface ZY1000
 telnet_port 23
@@ -105,18 +115,7 @@
 # Here we do *not* catch the error since we want the file & line number to appear
 # in the log
 script /config/settings/openocd.cfg
-init result
+init
 # Startup was OK
 set startup_status 1
 
-
-add_help_text ls "<directory> - lists files in directory"
-add_help_text reboot "reboots ZY1000 unit"
-add_help_text mac "prints MAC number of ZY1000 unit"
-add_help_text ip "print current IP number of ZY1000 unit"
-
-
-proc zy1000_flash {} {
-	set t [lindex 0 [ocd_flash_banks]]
-	return $t(base)
-}
\ No newline at end of file



From kc8apf at mail.berlios.de  Fri Dec 19 05:25:40 2008
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Fri, 19 Dec 2008 05:25:40 +0100
Subject: [Openocd-svn] r1258 - in trunk: . doc src src/jtag src/jtag/rlink
	tools tools/rlink_make_speed_table tools/st7_dtc_as
Message-ID: <200812190425.mBJ4PepK005937@sheep.berlios.de>

Author: kc8apf
Date: 2008-12-19 05:25:22 +0100 (Fri, 19 Dec 2008)
New Revision: 1258

Added:
   trunk/src/jtag/rlink/
   trunk/src/jtag/rlink/Makefile
   trunk/src/jtag/rlink/call.m4
   trunk/src/jtag/rlink/dtc_cmd.h
   trunk/src/jtag/rlink/ep1_cmd.h
   trunk/src/jtag/rlink/init.m4
   trunk/src/jtag/rlink/rlink.c
   trunk/src/jtag/rlink/rlink.h
   trunk/src/jtag/rlink/rlink_speed_table.c
   trunk/src/jtag/rlink/st7.h
   trunk/tools/
   trunk/tools/rlink_make_speed_table/
   trunk/tools/rlink_make_speed_table/rlink_make_speed_table
   trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl
   trunk/tools/st7_dtc_as/
   trunk/tools/st7_dtc_as/st7_dtc_as
   trunk/tools/st7_dtc_as/st7_dtc_as.pl
Modified:
   trunk/configure.in
   trunk/doc/openocd.texi
   trunk/src/Makefile.am
   trunk/src/jtag/Makefile.am
   trunk/src/jtag/jtag.c
Log:
- rlink interface support from Lou Deluxe <lou.openocd012 at fixit.nospammail.net>


Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/configure.in	2008-12-19 04:25:22 UTC (rev 1258)
@@ -116,6 +116,10 @@
   AS_HELP_STRING([--enable-jlink], [Enable building support for the Segger J-Link JTAG Programmer]),
   [build_jlink=$enableval], [build_jlink=no])
 
+AC_ARG_ENABLE(rlink,
+  AS_HELP_STRING([--enable-rlink], [Enable building support for the Raisonance RLink JTAG Programmer]),
+  [build_rlink=$enableval], [build_rlink=no])
+
 AC_ARG_WITH(ftd2xx,
         [AS_HELP_STRING(--with-ftd2xx,
            [Where libftd2xx can be found <default=search>])],
@@ -286,6 +290,12 @@
   AC_DEFINE(BUILD_JLINK, 0, [0 if you don't want the J-Link JTAG driver.])
 fi
 
+if test $build_rlink = yes; then
+  AC_DEFINE(BUILD_RLINK, 1, [1 if you want the RLink JTAG driver.])
+else
+  AC_DEFINE(BUILD_RLINK, 0, [0 if you don't want the RLink JTAG driver.])
+fi
+
 AM_CONFIG_HEADER(config.h)
 AM_INIT_AUTOMAKE(openocd, 1.0)
 
@@ -307,6 +317,7 @@
 AM_CONDITIONAL(USBPROG, test $build_usbprog = yes)
 AM_CONDITIONAL(OOCD_TRACE, test $build_oocd_trace = yes)
 AM_CONDITIONAL(JLINK, test $build_jlink = yes)
+AM_CONDITIONAL(RLINK, test $build_rlink = yes)
 AM_CONDITIONAL(IS_CYGWIN, test $is_cygwin = yes)
 AM_CONDITIONAL(IS_MINGW, test $is_mingw = yes)
 AM_CONDITIONAL(IS_WIN32, test $is_win32 = yes)

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/doc/openocd.texi	2008-12-19 04:25:22 UTC (rev 1258)
@@ -218,6 +218,8 @@
 @option{--enable-presto_ftd2xx}
 @item
 @option{--enable-jlink}
+ at item
+ at option{--enable-rlink}
 @end itemize
 
 If you want to access the parallel port using the PPDEV interface you have to specify
@@ -322,6 +324,18 @@
 @* Link: @url{http://www.iar.com/website1/1.0.1.0/369/1/index.php}
 @end itemize
 
+ at section USB RLINK based
+Raisonance has an adapter called @b{RLink}.  It exists in a stripped-down form on the STM32 Primer, permanently attached to the JTAG lines.  It also exists on the STM32 Primer2, but that is wired for SWD and not JTAG, thus not supported.
+
+ at itemize @bullet
+ at item @b{Raisonance RLink}
+@* Link: @url{http://www.raisonance.com/products/RLink.php}
+ at item @b{STM32 Primer}
+@* Link: @url{http://www.stm32circle.com/resources/stm32primer.php}
+ at item @b{STM32 Primer2}
+@* Link: @url{http://www.stm32circle.com/resources/stm32primer2.php}
+ at end itemize
+
 @section USB Other
 @itemize @bullet
 @item @b{USBprog}
@@ -1017,6 +1031,11 @@
 # jlink interface
 interface jlink
 @end verbatim
+ at b{A Raisonance RLink}
+ at verbatim
+# rlink interface
+interface rlink
+ at end verbatim
 @b{Parallel Port}
 @verbatim
 interface parport
@@ -1066,6 +1085,9 @@
 
 @item @b{jlink}
 @* Segger jlink usb adapter
+
+ at item @b{rlink}
+@* Raisonance RLink usb adapter
 @comment - End parameters
 @end itemize
 @comment - End Interface
@@ -1247,6 +1269,7 @@
 @item ft2232: 6MHz / (@var{number}+1)
 @item amt jtagaccel: 8 / 2**@var{number}
 @item jlink: maximum speed in kHz (0-12000), 0 will use RTCK
+ at item rlink: 24MHz / @var{number}, but only for certain values of @var{number}
 @comment end speed list.
 @end itemize
 

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/Makefile.am	2008-12-19 04:25:22 UTC (rev 1258)
@@ -47,9 +47,13 @@
 if JLINK
 LIBUSB = -lusb
 else
+if RLINK
+LIBUSB = -lusb
+else
 LIBUSB =
 endif
 endif
+endif
 
 if IS_WIN32
 if FTD2XXDIR

Modified: trunk/src/jtag/Makefile.am
===================================================================
--- trunk/src/jtag/Makefile.am	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/Makefile.am	2008-12-19 04:25:22 UTC (rev 1258)
@@ -99,7 +99,13 @@
 JLINKFILES =
 endif
 
+if RLINK
+RLINKFILES = rlink/rlink.c rlink/rlink_speed_table.c
+else
+RLINKFILES =
+endif
+
 libjtag_a_SOURCES = jtag.c $(BITBANGFILES) $(PARPORTFILES) $(DUMMYFILES) $(FT2232FILES) $(AMTJTAGACCELFILES) $(EP93XXFILES) \
-	$(AT91RM9200FILES) $(GW16012FILES) $(BITQFILES) $(PRESTOFILES) $(USBPROGFILES) $(ECOSBOARDFILES) $(JLINKFILES)
+	$(AT91RM9200FILES) $(GW16012FILES) $(BITQFILES) $(PRESTOFILES) $(USBPROGFILES) $(ECOSBOARDFILES) $(JLINKFILES) $(RLINKFILES)
 
 noinst_HEADERS = bitbang.h jtag.h

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/jtag.c	2008-12-19 04:25:22 UTC (rev 1258)
@@ -196,6 +196,10 @@
 	extern jtag_interface_t jlink_interface;
 #endif
 
+#if BUILD_RLINK == 1
+	extern jtag_interface_t rlink_interface;
+#endif
+
 jtag_interface_t *jtag_interfaces[] = {
 #if BUILD_ECOSBOARD == 1
 	&zy1000_interface,
@@ -233,6 +237,9 @@
 #if BUILD_JLINK == 1
 	&jlink_interface,
 #endif
+#if BUILD_RLINK == 1
+	&rlink_interface,
+#endif
 	NULL,
 };
 

Added: trunk/src/jtag/rlink/Makefile
===================================================================
--- trunk/src/jtag/rlink/Makefile	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/rlink/Makefile	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,73 @@
+#***************************************************************************
+#*   Copyright (C) 2008 Lou Deluxe                                         *
+#*   lou.openocd012 at fixit.nospammail.net                                   *
+#*                                                                         *
+#*   This program is free software; you can redistribute it and/or modify  *
+#*   it under the terms of the GNU General Public License as published by  *
+#*   the Free Software Foundation; either version 2 of the License, or     *
+#*   (at your option) any later version.                                   *
+#*                                                                         *
+#*   This program is distributed in the hope that it will be useful,       *
+#*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+#*   GNU General Public License for more details.                          *
+#*                                                                         *
+#*   You should have received a copy of the GNU General Public License     *
+#*   along with this program; if not, write to the                         *
+#*   Free Software Foundation, Inc.,                                       *
+#*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+#***************************************************************************
+
+TOP = ../../..
+INTERFACE_NAME = rlink
+
+PERL = perl
+M4 = m4
+
+TARGETDIR = ${TOP}/src/target
+TOOLSDIR = ${TOP}/tools
+
+MAKE_SPEED_TABLE = ${TOOLSDIR}/rlink_make_speed_table/rlink_make_speed_table
+ST7_DTC_AS = ${TOOLSDIR}/st7_dtc_as/st7_dtc_as
+
+OPENOCD = ${TOP}/src/openocd
+OPENOCD_CONFIG = -s ${TARGETDIR}
+OPENOCD_CONFIG += -f interface/rlink.cfg
+OPENOCD_CONFIG += -f board/stm32f10x_128k_eval.cfg
+
+PATCHFILE = /tmp/openocd_${INTERFACE_NAME}.diff.gz
+
+# relative to ${TOP}
+SVNADDFILES =
+SVNADDFILES += src/target/interface/rlink.cfg
+SVNADDFILES += src/jtag/${INTERFACE_NAME}.c
+SVNADDFILES += src/jtag/${INTERFACE_NAME}
+
+PRESCALERS = 64 11 8 2
+
+DTCFILES =
+DTCFILES += $(addsuffix _init.dtc, ${PRESCALERS})
+DTCFILES += $(addsuffix _call.dtc, ${PRESCALERS})
+
+default: rlink_speed_table.c clean
+
+%_init.fsm: init.m4
+	${M4} -P -DSHIFTER_PRESCALER=`echo "$@" | sed -e's/_.*//'` $< > $@
+
+%_call.fsm: call.m4
+	${M4} -P -DSHIFTER_PRESCALER=`echo "$@" | sed -e's/_.*//'` $< > $@
+
+%.dtc: %.fsm
+	${ST7_DTC_AS} -b -o $@ -i $< > /dev/null
+
+rlink_speed_table.c: ${DTCFILES}
+	${MAKE_SPEED_TABLE} ${PRESCALERS} > $@ || rm $@
+
+clean:
+	-rm *.dtc *.fsm
+
+distclean: clean
+
+test: default
+	(cd ${TOP} && (rm src/jtag/${INTERFACE_NAME}.o; ${MAKE}))
+	${OPENOCD} -d0 ${OPENOCD_CONFIG} -c init -c 'poll off'


Property changes on: trunk/src/jtag/rlink/Makefile
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/jtag/rlink/call.m4
===================================================================
--- trunk/src/jtag/rlink/call.m4	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/rlink/call.m4	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,485 @@
+m4_divert(`-1')
+/***************************************************************************
+ *   Copyright (C) 2008 Lou Deluxe                                         *
+ *   lou.openocd012 at fixit.nospammail.net                                   *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+m4_dnl Setup and hold times depend on SHIFTER_PRESCALER
+m4_define(`SETUP_DELAY_CYCLES', m4_eval(`('SHIFTER_PRESCALER` + 1) / 2'))
+m4_define(`HOLD_DELAY_CYCLES', m4_eval(`'SHIFTER_PRESCALER` / 2'))
+
+m4_dnl Some macros to make nybble handling a little easier
+m4_define(`m4_high_nybble', `m4_eval(`(($1) >> 4) & 0xf')')
+m4_define(`m4_low_nybble', `m4_eval(`($1) & 0xf')')
+
+m4_dnl A macro to generate a number of NOPs depending on the argument
+m4_define(`m4_0_to_5_nops', `m4_ifelse(m4_eval(`($1) >= 1'), 1, `	NOP
+'m4_ifelse(m4_eval(`($1) >= 2'), 1, `	NOP
+'m4_ifelse(m4_eval(`($1) >= 3'), 1, `	NOP
+'m4_ifelse(m4_eval(`($1) >= 4'), 1, `	NOP
+'m4_ifelse(m4_eval(`($1) >= 5'), 1, `	NOP
+')))))')
+
+
+m4_dnl Some macros to facilitate bit-banging delays.
+m4_dnl There are 3 of them.  One for self-contained delays, and two for those which must be split between setup and loop to keep from disturbing A at delay time.
+m4_dnl The argument passed to any of them is the number of cycles which the delay should consume.
+
+m4_dnl This one is self-contained.
+
+m4_define(`m4_delay',
+`; delay (m4_eval($1) cycles)'
+`m4_ifelse(m4_eval(`('$1`) < 6'), 1,
+	m4_0_to_5_nops($1)
+,
+	m4_ifelse(m4_eval(`(('$1`) - 3) % 2'), 1, `	NOP')
+	A.H = m4_high_nybble(`(('$1`) - 3) / 2')
+	A.L = m4_low_nybble(`(('$1`) - 3) / 2')
+	Y = A
+	DECY
+	JP -1
+)')
+
+
+m4_dnl These are the setup and loop parts of the split delay.
+m4_dnl The argument passed to both must match for the result to make sense.
+m4_dnl The setup does not figure into the delay.  It takes 3 cycles when a loop is used and none if nops are used.
+
+m4_define(`m4_delay_setup',
+`; delay setup (m4_eval($1) cycles)'
+`m4_ifelse(m4_eval(`('$1`) < 6'), 0, `	'
+	A.H = m4_high_nybble(`('$1`) / 2')
+	A.L = m4_low_nybble(`('$1`) / 2')
+	Y = A
+)')
+	
+m4_define(`m4_delay_loop',
+`; delay loop (m4_eval($1) cycles)'
+`m4_ifelse(m4_eval(`('$1`) < 6'), 1,
+	m4_0_to_5_nops($1)
+,
+	m4_ifelse(m4_eval(`('$1`) % 2'), 1, `	NOP')
+	DECY
+	JP -1
+)')
+
+m4_dnl These are utility macros for use with delays.  Specifically, there is code below which needs some predictability in code size for relative jumps to reach.  The m4_delay macro generates an extra NOP when an even delay is needed, and the m4_delay_loop macro generates an extra NOP when an odd delay is needed.  Using this for the argument to the respective macro rounds up the argument so that the extra NOP will not be generated.  There is also logic built in to cancel the rounding when the result is small enough that a loop would not be generated.
+	
+m4_define(`m4_delay_loop_round_up', `m4_ifelse(m4_eval($1` < 6'), 1, $1, m4_eval(`(('$1`) + 1) / 2 * 2'))')
+m4_define(`m4_delay_round_up', `m4_ifelse(m4_eval($1` < 6'), 1, $1, m4_eval(`(('$1`) / 2 * 2) + 1'))')
+
+
+m4_divert(`0')m4_dnl
+
+;------------------------------------------------------------------------------
+:opcode_error
+; This is at address 0x00 in case of empty LUT entries
+	STATUS STOP ERROR
+
+;------------------------------------------------------------------------------
+; Command interpreter at address 0x01 because it is branched to a lot and having it be 0x01 means we can use X for it, which is already used for other purposes which want it to be 1.
+; Assumes X is 1
+; Assumes ADR_BUFFER0 points to the next command byte
+; Stores the current command byte in CMP01
+
+:command_interpreter
+	A = DATA_BUFFER0
+	ADR_BUFFER0 += X
+	CMP01 = A	; store the current command for later
+
+	EXCHANGE	; put MSN into LSN
+	A.H = 0xc	; lookup table at 0x1550 + 0xc0 = 0x1610
+
+	; branch to address in lookup table
+	Y = A 
+	A = <Y>
+	BRANCH
+
+;------------------------------------------------------------------------------
+; LUT for high nybble
+
+;LUT; c0 opcode_error
+;LUT; c1 opcode_shift_tdi_andor_tms_bytes
+;LUT; c2 opcode_shift_tdi_andor_tms_bytes
+;LUT; c3 opcode_shift_tdi_andor_tms_bytes
+;LUT; c4 opcode_shift_tdo_bytes
+;LUT; c5 opcode_error
+;LUT; c6 opcode_shift_tdio_bytes
+;LUT; c7 opcode_error
+;LUT; c8 opcode_shift_tms_tdi_bit_pair
+;LUT; c9 opcode_shift_tms_bits
+;LUT; ca opcode_error
+;LUT; cb opcode_error
+;LUT; cc opcode_error
+;LUT; cd opcode_error
+;LUT; ce opcode_shift_tdio_bits
+;LUT; cf opcode_stop
+
+
+;------------------------------------------------------------------------------
+; USB/buffer handling
+;
+
+;ENTRY; download entry_download
+
+opcode_stop:
+opcode_next_buffer:
+	; pointer to completion flag
+	A.H = 0xf
+	A.L = 0xf
+	Y = A
+
+	A = OR_MPEG	; buffer indicator from previous iteration
+	<Y> = A		; either indicator will have bit 0 set
+	BSET 1		; was buffer 1 previously current?
+;	A.H = 0		; already zero from OR_MPEG
+	JP opcode_next_buffer_0
+
+opcode_next_buffer_1:
+	A.L = 0x1	; ack buffer 0
+	BUFFER_MNGT = A
+;	A.H = 0x0	; already zero from BUFFER_MNGT
+	A.L = 0x3	; Input buffer 1 = 0x1850 (0x0300)
+	JP +4
+
+opcode_next_buffer_0:
+	A.L = 0x2	; ack buffer 1
+	BUFFER_MNGT = A
+entry_download:
+	A = X		; Input buffer 0 = 0x1650 (0x0100)
+
+	ADR_BUFFER01 = A
+	OR_MPEG = A	; store for next iteration
+
+	A.L = 0x0
+	BUFFER_MNGT = A	; finish acking previous buffer
+	Y = A
+	ADR_BUFFER00 = A
+	ADR_BUFFER11 = A
+
+	A.H = 0x4	; Output buffer = 0x1590 (0x0040)
+	ADR_BUFFER10 = A
+
+	EXCHANGE	; 0x04
+	X = A		; for the spin loop below
+
+	; pointer to status in shared memory
+	DECY		; setting to 0 above and decrementing here saves a byte
+
+	; wait until a command buffer is available
+	A = BUFFER_MNGT	; spin while neither of bits 2 or 3 are set
+	CP A<X		; this is slightly faster and smaller than trying to AND and compare the result, and it lets us just use the nybble-swapped 0x40 from the output buffer setup.
+	JP -2
+	<Y> = A		; update status once done spinning
+
+	; restore X, since we used it
+;	A.H = 0	; high nybble of BUFFER_MNGT will always be 0 the way we use it
+	A.L = 1
+	X = A
+
+	; go to command interpreter
+	BRANCH
+
+
+;;------------------------------------------------------------------------------
+;:opcode_stop
+;;
+;
+;	; Ack buffer 0 in download mode
+;	A.L = 0x1
+;	BUFFER_MNGT = A
+;	
+;	STATUS STOP
+
+
+;------------------------------------------------------------------------------
+:opcode_shift_tdi_andor_tms_bytes
+;
+
+	A = CMP01	; bits 3..0 contain the number of bytes to shift - 1
+	A.H = 0
+	Y = A		; loop counter 
+
+	A = CMP01
+	EXCHANGE
+	CMP01 = A	; we're interested in bits in the high nybble
+
+opcode_shift_tdi_andor_tms_bytes__loop:
+
+; set tdi to supplied byte or zero
+	A = CMP01
+	BSET 1
+	JP +4
+	A.H = 0
+	A.L = 0
+	JP +3
+	A = DATA_BUFFER0
+	ADR_BUFFER0 += X
+	SHIFT_MPEG = A
+
+; set tms to supplied byte or zero
+	A = CMP01
+	BCLR 0
+	JP +5
+	A = DATA_BUFFER0
+	ADR_BUFFER0 += X
+	SHIFT_CARD = A
+	SHIFT CARD OUT=>PIN0
+
+; run both shifters as nearly simultaneously as possible
+	SHIFT MPEG OUT=>PIN1
+
+	A = CTRL_FCI
+	EXCHANGE
+	BCLR 3
+	JP -3
+
+	DECY
+	JP opcode_shift_tdi_andor_tms_bytes__loop
+
+	A = X
+	BRANCH
+
+
+;------------------------------------------------------------------------------
+:opcode_shift_tdo_bytes
+;
+
+	A = CMP01	; bits 3..0 contain the number of bytes to shift - 1
+	A.H = 0
+	Y = A		; loop counter 
+
+opcode_shift_tdo_bytes__loop:
+	SHIFT MPEG PIN0=>IN
+
+	A = CTRL_FCI
+	EXCHANGE
+	BCLR 3
+	JP -3
+
+	; put shifted byte into output buffer
+	A = SHIFT_MPEG
+	DATA_BUFFER1 = A
+	ADR_BUFFER1 += X
+
+	DECY
+	JP opcode_shift_tdo_bytes__loop
+
+	A = X
+	BRANCH
+
+
+;------------------------------------------------------------------------------
+:opcode_shift_tdio_bytes
+;
+
+	A = CMP01	; bits 3..0 contain the number of bytes to shift - 1
+	A.H = 0
+	CMP10 = A	; byte loop counter
+
+	A.H = opcode_shift_tdio_bytes__sub_return
+	A.L = opcode_shift_tdio_bytes__sub_return
+	CMP00 = A	; return address
+
+opcode_shift_tdio_bytes__loop:
+	A.H = 0
+	A.L = 7
+	CMP11 = A		; always use 8 bits
+
+	JP sub_shift_tdio_bits
+opcode_shift_tdio_bytes__sub_return:
+	
+	A = CMP10	; byte loop counter
+	CP A=>X
+	CLC
+	A -= X
+	CMP10 = A
+	JP opcode_shift_tdio_bytes__loop
+
+	A = X
+;DR_MPEG = A ; return TCK low, as str912 reset halt seems to require it
+	BRANCH
+
+
+;------------------------------------------------------------------------------
+:opcode_shift_tdio_bits
+;
+
+	A = CMP01	; bits 2..0 contain the number of bits to shift - 1
+	A.H = 0
+	BCLR 3		; set TMS=1 if bit 3 was set
+	CMP11 = A	; bit loop counter 
+
+	A.H = opcode_shift_tdio_bits__sub_return
+	A.L = opcode_shift_tdio_bits__sub_return
+	CMP00 = A	; return address
+
+	JP sub_shift_tdio_bits
+	A.L = 0x1	; TMS=1
+	DR_CARD = A
+	JP sub_shift_tdio_bits
+opcode_shift_tdio_bits__sub_return:
+	
+	A = X
+;DR_MPEG = A ; return TCK low, as str912 reset halt seems to require it
+	BRANCH
+
+
+;------------------------------------------------------------------------------
+:sub_shift_tdio_bits
+;
+
+	A = DATA_BUFFER0	; get byte from input buffer
+	ADR_BUFFER0 += X
+	MASK = A		; put it in MASK where bit routine will use it
+
+:sub_shift_tdio_bits__loop
+m4_delay_setup(m4_delay_loop_round_up(SETUP_DELAY_CYCLES - 1))
+
+	A = MASK	; shift TDO into and TDI out of MASK via carry
+	A += MASK
+	MASK = A
+
+	; shifting out TDI
+	A.L = 0x2	; TCK=0, TDI=1
+	CP CARRY
+	JP +2
+	A.L = 0x0	; TCK=0, TDI=0
+	DR_MPEG = A
+
+m4_delay_loop(m4_delay_loop_round_up(SETUP_DELAY_CYCLES - 1))
+
+	BSET 2		; TCK high
+	DR_MPEG = A 
+
+	A = DR_MPEG	; set carry bit to TDO 
+	CLC
+	BCLR 0
+	JP +2
+	SEC
+
+m4_delay(HOLD_DELAY_CYCLES - 10)
+
+	A = CMP11	; bit loop counter
+	Y = A		; use Y to avoid corrupting carry bit with subtract
+	DECY
+	A = Y
+	CMP11 = A
+	JP :sub_shift_tdio_bits__loop
+
+	; shift last TDO bit into result
+	A = MASK
+	A += MASK
+	DATA_BUFFER1 = A
+	ADR_BUFFER1 += X
+
+	A = CMP00	; return to caller
+	BRANCH
+
+
+;------------------------------------------------------------------------------
+:opcode_shift_tms_tdi_bit_pair
+;
+
+; set TMS line manually
+	A = CMP01	; bits 3..0 contain TDI and TMS bits and whether to return TDO
+	BSET 0		; TMS bit
+	A.L = 0x1	; TMS=1
+	JP +2
+	A.L = 0x0	; TMS=0
+	DR_CARD = A
+
+; stuff command buffer with bitmap of single TDI bit
+	A = CMP01
+	BSET 1		; TDI bit
+	A.H = 0x8	; TDI=1
+	JP +2
+	A.H = 0x0	; TDI=0
+	ADR_BUFFER0 -= X
+	DATA_BUFFER0 = A
+
+	A.H = 0
+	A.L = 0
+	CMP11 = A	; bit loop counter (only doing one bit)
+
+	A.H = opcode_shift_tms_tdi_bit_pair__sub_return
+	A.L = opcode_shift_tms_tdi_bit_pair__sub_return
+	CMP00 = A	; return address
+
+; jump this way due to relative jump range issues
+	A.H = sub_shift_tdio_bits
+	A.L = sub_shift_tdio_bits
+	BRANCH
+opcode_shift_tms_tdi_bit_pair__sub_return:
+
+	A = CMP01
+	BSET 3		; bit says whether to return TDO
+	JP +2
+	ADR_BUFFER1 -= X	; subroutine returns it, so undo that
+	
+	A = X
+	DR_MPEG = A ; return TCK low, as str912 reset halt seems to require it
+	BRANCH
+
+
+;------------------------------------------------------------------------------
+:opcode_shift_tms_bits
+;
+
+	A = CMP01	; bits 3..0 contain the number of bits to shift - 1 (only 1-8 bits is valid... no checking, just improper operation)
+	A.H = 0
+	CMP11 = A	; bit loop counter 
+
+	A = DATA_BUFFER0	; get byte from input buffer
+	ADR_BUFFER0 += X
+	MASK = A		; The byte we'll be shifting
+
+:opcode_shift_tms_bits__loop
+m4_delay_setup(SETUP_DELAY_CYCLES - 1)
+
+	A = MASK	; shift TMS out of MASK via carry
+	A += MASK
+	MASK = A
+
+	; shifting out TMS
+	A.L = 0x1	; TCK=0, TDI=0, TMS=1
+	CP CARRY
+	JP +2
+	A.L = 0x0	; TCK=0, TDI=0, TMS=0
+	DR_CARD = A
+	DR_MPEG = A
+
+m4_delay_loop(SETUP_DELAY_CYCLES - 1)
+
+	BSET 2		; TCK high
+	DR_MPEG = A 
+
+m4_delay(HOLD_DELAY_CYCLES - 10)
+
+	A = CMP11	; bit loop counter
+	CP A=>X
+	CLC
+	A -= X
+	CMP11 = A
+	JP :opcode_shift_tms_bits__loop
+
+	A = X
+	DR_MPEG = A ; return TCK low, as str912 reset halt seems to require it
+	BRANCH
+
+

Added: trunk/src/jtag/rlink/dtc_cmd.h
===================================================================
--- trunk/src/jtag/rlink/dtc_cmd.h	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/rlink/dtc_cmd.h	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,66 @@
+/***************************************************************************
+ *   Copyright (C) 2008 Lou Deluxe                                         *
+ *   lou.openocd012 at fixit.nospammail.net                                   *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+/* A command position with the high nybble of 0x0 is reserved for an error condition.  If executed, it stops the DTC and raises the ERROR flag */
+
+#define DTC_CMD_SHIFT_TMS_BYTES(bytes)	((0x1 << 4) | ((bytes) - 1))
+/* Shift 1-16 bytes out TMS. TDI is 0. */
+/* Bytes to shift follow. */
+
+#define DTC_CMD_SHIFT_TDI_BYTES(bytes)	((0x2 << 4) | ((bytes) - 1))
+/* Shift 1-16 bytes out TDI. TMS is 0. */
+/* Bytes to shift follow. */
+
+#define DTC_CMD_SHIFT_TDI_AND_TMS_BYTES(bytes)	((0x3 << 4) | ((bytes) - 1))
+/* Shift 1-16 byte pairs out TDI and TMS. */
+/* Byte pairs to shift follow in TDI, TMS order. */
+
+#define DTC_CMD_SHIFT_TDO_BYTES(bytes)	((0x4 << 4) | ((bytes) - 1))
+/* Shift 1-16 bytes in TDO. TMS is unaffected. */
+/* Reply buffer contains bytes shifted in. */
+
+#define DTC_CMD_SHIFT_TDIO_BYTES(bytes)	((0x6 << 4) | ((bytes) - 1))
+/* Shift 1-16 bytes out TDI and in TDO. TMS is unaffected. */
+
+#define DTC_CMD_SHIFT_TMS_TDI_BIT_PAIR(tms, tdi, tdo)	((0x8 << 4) | (	\
+		(tms) ? (1 << 0) : 0	\
+	) | (	\
+		(tdi) ? (1 << 1) : 0	\
+	) | (	\
+		(tdo) ? (1 << 3) : 0	\
+	))
+/* Single bit shift. */
+/* tms and tdi are the levels shifted out on TMS and TDI, respectively. */
+/* tdo indicates whether a byte will be returned in the reply buffer with its least significant bit set to reflect TDO */
+/* Care should be taken when tdo is zero, as the underlying code actually does put that byte in the reply buffer.  Setting tdo to zero just moves the pointer back.  The result is that if this command is executed when the reply buffer is already full, a byte will be written erroneously to memory not belonging to the reply buffer.  This could be worked around at the expense of DTC code space and speed. */
+
+#define DTC_CMD_SHIFT_TMS_BITS(bits)	((0x9 << 4) | ((bits) - 1))
+/* Shift 1-8 bits out TMS. */
+/* Bits to be shifted out are left justified in the following byte. */
+
+#define DTC_CMD_SHIFT_TDIO_BITS(bits)	((0xe << 4) | ((bits) - 1))
+/* Shift 1-8 bits out TDI and in TDO, TMS is unaffected. */
+/* Bits to be shifted out are left justified in the following byte. */
+/* Bits shifted in are right justified in the byte placed in the reply buffer. */
+
+
+#define DTC_CMD_STOP			(0xf << 4)
+/* Stop processing the command buffer and wait for the next one. */
+/* A shared status byte is updated with bit 0 set when this has happened, and it is cleared when a new command buffer becomes ready.  The host can poll that byte to see when it is safe to read a reply. */


Property changes on: trunk/src/jtag/rlink/dtc_cmd.h
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/jtag/rlink/ep1_cmd.h
===================================================================
--- trunk/src/jtag/rlink/ep1_cmd.h	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/rlink/ep1_cmd.h	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,57 @@
+/***************************************************************************
+ *   Copyright (C) 2008 Lou Deluxe                                         *
+ *   lou.openocd012 at fixit.nospammail.net                                   *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+/*
+ * Command opcodes that can be sent over endpoint 1.
+ * This codifies information provided by Rob Brown <rob at cobbleware.com>.
+ * The buffer can contain several of these, but only one which returns data.
+ * Some of these opcodes have arguments, which follow immediately.
+ * If shorter than the packet size, trailing positions should be zero-filled.
+ */
+
+/* LED update enables:
+ *  When enabled, each LED is updated automatically.
+ *  When not enabled, each LED can be controlled manually with EP1_CMD_SET_PORTD_LEDS.
+ */
+#define EP1_CMD_LEDUE_BOTH				(0x05)
+/* EP1_CMD_LEDUE_NONE has the side effect of turning the LEDs on */
+#define EP1_CMD_LEDUE_NONE				(0x06)
+#define EP1_CMD_LEDUE_ERROR				(0x17)
+#define EP1_CMD_LEDUE_BUSY				(0x18)
+
+#define EP1_CMD_DTC_STOP				(0x0b)
+#define EP1_CMD_DTC_LOAD				(0x0c)
+#define EP1_CMD_DTC_CALL				(0x0d)
+#define EP1_CMD_SET_UPLOAD				(0x0f)
+#define EP1_CMD_SET_DOWNLOAD			(0x10)
+#define EP1_CMD_DTC_WAIT				(0x12)
+#define EP1_CMD_DTC_GET_STATUS			(0x15)
+/* a quick way to just read back one byte */
+#define EP1_CMD_DTC_GET_CACHED_STATUS	(0x16)
+
+/* Writes upper 2 bits port D with argument */
+#define EP1_CMD_SET_PORTD_UPPER			(0x19)
+/* Writes lower 2 bits (BUSY and ERROR) of port D with argument */
+#define EP1_CMD_SET_PORTD_LEDS			(0x1a)
+
+#define EP1_CMD_MEMORY_READ				(0x28)
+#define EP1_CMD_MEMORY_WRITE			(0x29)
+#define EP1_CMD_GET_FWREV				(0xfe)
+#define EP1_CMD_GET_SERIAL				(0xff)


Property changes on: trunk/src/jtag/rlink/ep1_cmd.h
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/jtag/rlink/init.m4
===================================================================
--- trunk/src/jtag/rlink/init.m4	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/rlink/init.m4	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,74 @@
+m4_divert(`-1')
+/***************************************************************************
+ *   Copyright (C) 2008 Lou Deluxe                                         *
+ *   lou.openocd012 at fixit.nospammail.net                                   *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+m4_undefine(`CTRL_MPEG_L')
+m4_undefine(`CTRL_CARD_L')
+
+m4_ifelse(SHIFTER_PRESCALER, 1, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x0')')
+')
+m4_ifelse(SHIFTER_PRESCALER, 2, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x2')')
+	m4_define(`CTRL_CARD_L', `m4_eval(`0x8 | 0x1')')
+')
+m4_ifelse(SHIFTER_PRESCALER, 8, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x3')')
+')
+m4_ifelse(SHIFTER_PRESCALER, 11, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x4')')
+')
+m4_ifelse(SHIFTER_PRESCALER, 64, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x7')')
+')
+
+m4_ifdef(`CTRL_MPEG_L',,`
+	m4_errprint(`SHIFTER_PRESCALER was not defined with a supported value
+')	m4_m4exit(`1')
+')
+
+m4_divert(`0')m4_dnl
+
+init:
+	A.H = 0
+
+	A.L = 0
+
+	DR_MPEG = A	; TDI and TCK start out low
+	DR_CARD = A	; TMS starts out low
+
+	A.L = 0x6
+
+	CTRL_FCI = A	; MPEG and CARD driven by FCI
+	DDR_MPEG = A	; TDI and TCK are outputs
+
+	A.L = 0x1
+
+	X = A		; X == 1
+	DDR_CARD = A	; TMS is output
+
+	A.L = CTRL_MPEG_L
+	CTRL_MPEG = A
+m4_ifdef(`CTRL_CARD_L',
+`	A.L = 'CTRL_CARD_L`
+')m4_dnl
+	CTRL_CARD = A
+
+	STATUS STOP

Added: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/rlink/rlink.c	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,1808 @@
+/***************************************************************************
+ *   Copyright (C) 2005 by Dominic Rath                                    *
+ *   Dominic.Rath at gmx.de                                                   *
+ *                                                                         *
+ *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   oyvind.harboe at zylin.com                                               *
+ *                                                                         *
+ *   Copyright (C) 2008 Rob Brown, Lou Deluxe                              *
+ *   rob at cobbleware.com, lou.openocd012 at fixit.nospammail.net               *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+/* system includes */
+#include <errno.h>
+#include <string.h>
+#include <usb.h>
+
+/* project specific includes */
+#include "log.h"
+#include "types.h"
+#include "jtag.h"
+#include "configuration.h"
+#include "rlink.h"
+#include "st7.h"
+#include "ep1_cmd.h"
+#include "dtc_cmd.h"
+
+
+/* This feature is made useless by running the DTC all the time.  When automatic, the LED is on whenever the DTC is running.  Otherwise, USB messages are sent to turn it on and off. */
+#undef AUTOMATIC_BUSY_LED
+
+/* This feature may require derating the speed due to reduced hold time. */
+#undef USE_HARDWARE_SHIFTER_FOR_TMS
+
+
+#define INTERFACE_NAME		"RLink"
+
+#define USB_IDVENDOR		(0x138e)
+#define USB_IDPRODUCT		(0x9000)
+
+#define USB_EP1OUT_ADDR		(0x01)
+#define USB_EP1OUT_SIZE		(16)
+#define USB_EP1IN_ADDR		(USB_EP1OUT_ADDR | 0x80)
+#define USB_EP1IN_SIZE		(USB_EP1OUT_SIZE)
+
+#define USB_EP2OUT_ADDR		(0x02)
+#define USB_EP2OUT_SIZE		(64)
+#define USB_EP2IN_ADDR		(USB_EP2OUT_ADDR | 0x80)
+#define USB_EP2IN_SIZE		(USB_EP2OUT_SIZE)
+#define USB_EP2BANK_SIZE	(512)
+
+#define USB_TIMEOUT_MS		(3 * 1000)
+
+#define DTC_STATUS_POLL_BYTE	(ST7_USB_BUF_EP0OUT + 0xff)
+
+
+/* Symbolic names for some pins */
+#define ST7_PA_NJTAG_TRST		ST7_PA1
+#define ST7_PA_NRLINK_RST		ST7_PA3
+#define ST7_PA_NLINE_DRIVER_ENABLE	ST7_PA5
+
+/* mask for negative-logic pins */
+#define ST7_PA_NUNASSERTED	(0	\
+	| ST7_PA_NJTAG_TRST	\
+	| ST7_PA_NRLINK_RST	\
+	| ST7_PA_NLINE_DRIVER_ENABLE	\
+)
+
+#define ST7_PD_NBUSY_LED		ST7_PD0
+#define ST7_PD_NERROR_LED		ST7_PD1
+#define ST7_PD_NRUN_LED			ST7_PD7
+
+#define ST7_PE_ADAPTER_SENSE_IN		ST7_PE3
+#define ST7_PE_ADAPTER_SENSE_OUT	ST7_PE4
+
+static usb_dev_handle *pHDev;
+
+
+/*
+ * ep1 commands are up to USB_EP1OUT_SIZE bytes in length.
+ * This function takes care of zeroing the unused bytes before sending the packet.
+ * Any reply packet is not handled by this function.
+ */
+static
+int
+ep1_generic_commandl(
+	usb_dev_handle	*pHDev,
+	size_t		length,
+	...
+) {
+	uint8_t		usb_buffer[USB_EP1OUT_SIZE];
+	uint8_t		*usb_buffer_p;
+	va_list		ap;
+	int		usb_ret;
+
+	if(length > sizeof(usb_buffer)) {
+		length = sizeof(usb_buffer);
+	}
+
+	usb_buffer_p = usb_buffer;
+
+	va_start(ap, length);
+	while(length > 0) {
+		*usb_buffer_p++ = va_arg(ap, int);
+		length--;
+	}
+	
+	memset(
+		usb_buffer_p,
+		0,
+		sizeof(usb_buffer) - (usb_buffer_p - usb_buffer)
+	);
+
+	usb_ret = usb_bulk_write(
+		pHDev,
+		USB_EP1OUT_ADDR,
+		usb_buffer, sizeof(usb_buffer),
+		USB_TIMEOUT_MS
+	);
+
+	return(usb_ret);
+}
+
+
+
+#if 0
+static
+ssize_t
+ep1_memory_read(
+	usb_dev_handle	*pHDev,
+	uint16_t	addr,
+	size_t		length,
+	uint8_t		*buffer
+) {
+	uint8_t		usb_buffer[USB_EP1OUT_SIZE];
+	int		usb_ret;
+	size_t		remain;
+	ssize_t		count;
+
+	usb_buffer[0] = EP1_CMD_MEMORY_READ;
+	memset(
+		usb_buffer + 4,
+		0,
+		sizeof(usb_buffer) - 4
+	);
+
+	remain = length;
+	count = 0;
+
+	while(remain) {
+		if(remain > sizeof(usb_buffer)) {
+			length = sizeof(usb_buffer);
+		} else {
+			length = remain;
+		}
+
+		usb_buffer[1] = addr >> 8;
+		usb_buffer[2] = addr;
+		usb_buffer[3] = length;
+
+      		usb_ret = usb_bulk_write(
+			pHDev, USB_EP1OUT_ADDR,
+			usb_buffer, sizeof(usb_buffer),
+			USB_TIMEOUT_MS
+		);
+
+		if(usb_ret < sizeof(usb_buffer)) {
+			break;
+		}
+		
+		usb_ret = usb_bulk_read(
+			pHDev, USB_EP1IN_ADDR,
+			buffer, length,
+			USB_TIMEOUT_MS
+		);
+
+		if(usb_ret < length) {
+			break;
+		}
+		
+		addr += length;
+		buffer += length;
+		count += length;
+		remain -= length;
+	}
+
+	return(count);
+}
+#endif
+
+
+
+static
+ssize_t
+ep1_memory_write(
+	usb_dev_handle	*pHDev,
+	uint16_t	addr,
+	size_t		length,
+	uint8_t	const	*buffer
+) {
+	uint8_t		usb_buffer[USB_EP1OUT_SIZE];
+	int		usb_ret;
+	size_t		remain;
+	ssize_t		count;
+
+	usb_buffer[0] = EP1_CMD_MEMORY_WRITE;
+
+	remain = length;
+	count = 0;
+
+	while(remain) {
+		if(remain > (sizeof(usb_buffer) - 4)) {
+			length = (sizeof(usb_buffer) - 4);
+		} else {
+			length = remain;
+		}
+
+		usb_buffer[1] = addr >> 8;
+		usb_buffer[2] = addr;
+		usb_buffer[3] = length;
+		memcpy(
+			usb_buffer + 4,
+			buffer,
+			length
+		);
+		memset(
+			usb_buffer + 4 + length,
+			0,
+			sizeof(usb_buffer) - 4 - length
+		);
+
+      		usb_ret = usb_bulk_write(
+			pHDev, USB_EP1OUT_ADDR,
+			usb_buffer, sizeof(usb_buffer),
+			USB_TIMEOUT_MS
+		);
+
+		if(usb_ret < sizeof(usb_buffer)) {
+			break;
+		}
+		
+		addr += length;
+		buffer += length;
+		count += length;
+		remain -= length;
+	}
+
+	return(count);
+}
+
+
+#if 0
+static
+ssize_t
+ep1_memory_writel(
+	usb_dev_handle	*pHDev,
+	uint16_t	addr,
+	size_t		length,
+	...
+) {
+	uint8_t		buffer[USB_EP1OUT_SIZE - 4];
+	uint8_t		*buffer_p;
+	va_list		ap;
+	size_t		remain;
+
+	if(length > sizeof(buffer)) {
+		length = sizeof(buffer);
+	}
+
+	remain = length;
+	buffer_p = buffer;
+
+	va_start(ap, length);
+	while(remain > 0) {
+		*buffer_p++ = va_arg(ap, int);
+		remain--;
+	}
+
+	return(ep1_memory_write(pHDev, addr, length, buffer));
+}
+#endif
+
+
+#define DTCLOAD_COMMENT		(0)
+#define DTCLOAD_ENTRY		(1)
+#define DTCLOAD_LOAD		(2)
+#define DTCLOAD_RUN			(3)
+#define DTCLOAD_LUT_START	(4)
+#define DTCLOAD_LUT			(5)
+
+#define DTC_LOAD_BUFFER		ST7_USB_BUF_EP2UIDO
+
+/* This gets set by the DTC loader */
+static uint8_t dtc_entry_download;
+
+
+/* The buffer is specially formatted to represent a valid image to load into the DTC. */
+static
+int
+dtc_load_from_buffer(
+	usb_dev_handle	*pHDev,
+	const u8		*buffer,
+	size_t			length
+) {
+	struct header_s {
+		u8	type;
+		u8	length;
+	};
+
+	int				usb_err;
+	struct header_s	*header;
+	u8				lut_start = 0xc0;
+
+	dtc_entry_download = 0;
+
+	/* Stop the DTC before loading anything. */
+	usb_err = ep1_generic_commandl(
+		pHDev, 1,
+		EP1_CMD_DTC_STOP
+	);
+	if(usb_err < 0) return(usb_err);
+
+	while(length) {
+		if(length < sizeof(*header)) {
+			LOG_ERROR("Malformed DTC image\n");
+			exit(1);
+		}
+		
+		header = (struct header_s *)buffer;
+		buffer += sizeof(*header);
+		length -= sizeof(*header);
+
+		if(length < header->length + 1) {
+			LOG_ERROR("Malformed DTC image\n");
+			exit(1);
+		}
+		
+		switch(header->type) {
+			case DTCLOAD_COMMENT:
+				break;
+
+			case DTCLOAD_ENTRY:
+				/* store entry addresses somewhere */
+				if(!strncmp("download", buffer + 1, 8)) {
+					dtc_entry_download = buffer[0];
+				}
+				break;
+
+			case DTCLOAD_LOAD:
+   				/* Send the DTC program to ST7 RAM. */
+				usb_err = ep1_memory_write(
+					pHDev,
+					DTC_LOAD_BUFFER,
+					header->length + 1, buffer
+				);
+				if(usb_err < 0) return(usb_err);
+
+				/* Load it into the DTC. */
+				usb_err = ep1_generic_commandl(
+					pHDev, 3,
+					EP1_CMD_DTC_LOAD,
+						(DTC_LOAD_BUFFER >> 8),
+						DTC_LOAD_BUFFER
+				);
+				if(usb_err < 0) return(usb_err);
+
+				break;
+
+			case DTCLOAD_RUN:
+				usb_err = ep1_generic_commandl(
+					pHDev, 3,
+					EP1_CMD_DTC_CALL,
+						buffer[0],
+					EP1_CMD_DTC_WAIT
+				);
+				if(usb_err < 0) return(usb_err);
+
+				break;
+
+			case DTCLOAD_LUT_START:
+				lut_start = buffer[0];
+				break;
+		
+			case DTCLOAD_LUT:
+   				usb_err = ep1_memory_write(
+					pHDev,
+					ST7_USB_BUF_EP0OUT + lut_start,
+					header->length + 1, buffer
+				);
+				if(usb_err < 0) return(usb_err);
+				break;
+
+			default:
+				LOG_ERROR("Invalid DTC image record type: 0x%02x\n", header->type);
+				exit(1);
+				break;
+		}
+		
+		buffer += (header->length + 1);
+		length -= (header->length + 1);
+	}
+
+	return(0);
+}
+
+
+/*
+ * Start the DTC running in download mode (waiting for 512 byte command packets on ep2).
+ */
+static
+int
+dtc_start_download(
+) {
+	int	usb_err;
+	u8	ep2txr;
+
+	/* set up for download mode and make sure EP2 is set up to transmit */
+	usb_err = ep1_generic_commandl(
+		pHDev, 7,
+		 
+		EP1_CMD_DTC_STOP,
+		EP1_CMD_SET_UPLOAD,
+		EP1_CMD_SET_DOWNLOAD,
+		EP1_CMD_MEMORY_READ,	/* read EP2TXR for its data toggle */
+			ST7_EP2TXR >> 8,
+			ST7_EP2TXR,
+			1
+	);
+	if(usb_err < 0) return(usb_err);
+
+	/* read back ep2txr */
+	usb_err = usb_bulk_read(
+		pHDev, USB_EP1IN_ADDR,
+		&ep2txr, 1,
+		USB_TIMEOUT_MS
+	);
+	if(usb_err < 0) return(usb_err);
+
+	usb_err = ep1_generic_commandl(
+		pHDev, 13,
+		 
+		EP1_CMD_MEMORY_WRITE,	/* preinitialize poll byte */
+			DTC_STATUS_POLL_BYTE >> 8,
+			DTC_STATUS_POLL_BYTE,
+			1,
+			0x00,
+		EP1_CMD_MEMORY_WRITE,	/* set EP2IN to return data */
+			ST7_EP2TXR >> 8,
+			ST7_EP2TXR,
+			1,
+			(ep2txr & ST7_EP2TXR_DTOG_TX) | ST7_EP2TXR_STAT_VALID,
+		EP1_CMD_DTC_CALL,	/* start running the DTC */
+			dtc_entry_download,
+		EP1_CMD_DTC_GET_CACHED_STATUS
+	);
+	if(usb_err < 0) return(usb_err);
+
+	/* wait for completion */
+	usb_err = usb_bulk_read(
+		pHDev, USB_EP1IN_ADDR,
+		&ep2txr, 1,
+		USB_TIMEOUT_MS
+	);
+
+	return(usb_err);
+}
+
+
+static
+int
+dtc_run_download(
+	usb_dev_handle	*pHDev,
+	u8	*command_buffer,
+	int	command_buffer_size,
+	u8	*reply_buffer,
+	int	reply_buffer_size
+) {
+	u8	ep2_buffer[USB_EP2IN_SIZE];
+	int	usb_err;
+	int	i;
+
+	LOG_DEBUG(": %d/%d\n", command_buffer_size, reply_buffer_size);
+
+	usb_err = usb_bulk_write(
+		pHDev,
+		USB_EP2OUT_ADDR,
+		command_buffer, USB_EP2BANK_SIZE,
+		USB_TIMEOUT_MS
+	);
+	if(usb_err < 0) return(usb_err);
+
+
+	/* Wait for DTC to finish running command buffer */
+	for(i = 5;;) {
+		usb_err = ep1_generic_commandl(
+			pHDev, 4,
+
+			EP1_CMD_MEMORY_READ,
+				DTC_STATUS_POLL_BYTE >> 8,
+				DTC_STATUS_POLL_BYTE,
+				1
+		);
+		if(usb_err < 0) return(usb_err);
+
+		usb_err = usb_bulk_read(
+			pHDev,
+			USB_EP1IN_ADDR,
+			ep2_buffer, 1,
+			USB_TIMEOUT_MS
+		);
+		if(usb_err < 0) return(usb_err);
+
+		if(ep2_buffer[0] & 0x01) break;
+
+		if(!--i) {
+			LOG_ERROR("%s, %d: too many retries waiting for DTC status\n",
+				__FILE__, __LINE__
+			);
+			return(-ETIMEDOUT);
+		}
+	}
+
+
+	if(!reply_buffer) reply_buffer_size = 0;
+	if(reply_buffer_size) {
+		usb_err = usb_bulk_read(
+			pHDev,
+			USB_EP2IN_ADDR,
+			ep2_buffer, sizeof(ep2_buffer),
+			USB_TIMEOUT_MS
+		);
+
+		if(usb_err < (int)sizeof(ep2_buffer)) {
+			LOG_ERROR("%s, %d: Read of endpoint 2 returned %d\n",
+				__FILE__, __LINE__, usb_err
+			);
+			return(usb_err);
+		}
+
+		memcpy(reply_buffer, ep2_buffer, reply_buffer_size);
+
+	}
+
+	return(usb_err);
+}
+
+
+/*
+ * The dtc reply queue is a singly linked list that describes what to do with the reply packet that comes from the DTC.  Only SCAN_IN and SCAN_IO generate these entries.
+ */
+
+typedef
+struct dtc_reply_queue_entry_s {
+	struct dtc_reply_queue_entry_s	*next;
+	jtag_command_t	*cmd;	/* the command that resulted in this entry */
+
+	struct {
+		u8		*buffer;	/* the scan buffer */
+		int		size;		/* size of the scan buffer in bits */
+		int		offset;		/* how many bits were already done before this? */
+		int		length;		/* how many bits are processed in this operation? */
+		enum scan_type	type;		/* SCAN_IN/SCAN_OUT/SCAN_IO */
+	} scan;
+} dtc_reply_queue_entry_t;
+
+
+/*
+ * The dtc_queue consists of a buffer of pending commands and a reply queue.
+ * rlink_scan and tap_state_run add to the command buffer and maybe to the reply queue.
+ */
+
+static
+struct {
+	dtc_reply_queue_entry_t	*rq_head;
+	dtc_reply_queue_entry_t	*rq_tail;
+	int			cmd_index;
+	int			reply_index;
+	u8			cmd_buffer[USB_EP2BANK_SIZE];
+} dtc_queue;
+
+
+/*
+ * The tap state queue is for accumulating TAP state changes wiithout needlessly flushing the dtc_queue.  When it fills or is run, it adds the accumulated bytes to the dtc_queue.
+ */
+
+static
+struct {
+	int	length;
+	u32	buffer;
+} tap_state_queue;
+
+
+
+static
+int
+dtc_queue_init(
+) {
+	dtc_queue.rq_head = NULL;
+	dtc_queue.rq_tail = NULL;
+	dtc_queue.cmd_index = 0;
+	dtc_queue.reply_index = 0;
+	return(0);
+}
+
+
+static
+inline
+dtc_reply_queue_entry_t *
+dtc_queue_enqueue_reply(
+	enum scan_type	type,
+	u8				*buffer,
+	int				size,
+	int				offset,
+	int				length,
+	jtag_command_t	*cmd
+) {
+	dtc_reply_queue_entry_t	*rq_entry;
+
+	rq_entry = malloc(sizeof(dtc_reply_queue_entry_t));
+	if(rq_entry != NULL) {
+		rq_entry->scan.type = type;
+		rq_entry->scan.buffer = buffer;
+		rq_entry->scan.size = size;
+		rq_entry->scan.offset = offset;
+		rq_entry->scan.length = length;
+		rq_entry->cmd = cmd;
+		rq_entry->next = NULL;
+
+		if(dtc_queue.rq_head == NULL)
+			dtc_queue.rq_head = rq_entry;
+		else
+			dtc_queue.rq_tail->next = rq_entry;
+
+		dtc_queue.rq_tail = rq_entry;
+	}
+
+	return(rq_entry);
+}
+
+
+/*
+ * Running the queue means that any pending command buffer is run and any reply data dealt with.  The command buffer is then cleared for subsequent processing.
+ * The queue is automatically run by append when it is necessary to get space for the append.
+*/
+
+static
+int
+dtc_queue_run(
+) {
+	dtc_reply_queue_entry_t	*rq_p, *rq_next;
+	int			retval;
+	int			usb_err;
+	int			bit_cnt;
+	int			x;
+	u8			*dtc_p, *tdo_p;
+	u8			dtc_mask, tdo_mask;
+	u8			reply_buffer[USB_EP2IN_SIZE];
+
+	retval = ERROR_OK;
+
+	if(dtc_queue.cmd_index < 1) return(retval);
+
+	dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = DTC_CMD_STOP;
+
+	/* run the cmd */
+	if(dtc_queue.rq_head == NULL) {
+		usb_err = dtc_run_download(pHDev,
+			dtc_queue.cmd_buffer, dtc_queue.cmd_index,
+			NULL, 0
+		);	
+		if(usb_err < 0) {
+			LOG_ERROR("dtc_run_download: %s\n", usb_strerror());
+			exit(1);
+		}
+	} else {
+		usb_err = dtc_run_download(pHDev,
+			dtc_queue.cmd_buffer, dtc_queue.cmd_index,
+			reply_buffer, dtc_queue.reply_index
+		);	
+		if(usb_err < 0) {
+			LOG_ERROR("dtc_run_download: %s\n", usb_strerror());
+			exit(1);
+		} else {
+			/* process the reply, which empties the reply queue and frees its entries */
+			dtc_p = reply_buffer;
+
+			/* The rigamarole with the masks and doing it bit-by-bit is due to the fact that the scan buffer is LSb-first and the DTC code is MSb-first for hardware reasons.   It was that or craft a function to do the reversal, and that wouldn't work with bit-stuffing (supplying extra bits to use mostly byte operations), or any other scheme which would throw the byte alignment off. */
+
+			for(
+				rq_p = dtc_queue.rq_head;
+				rq_p != NULL;
+				rq_p = rq_next
+			) {
+				tdo_p = rq_p->scan.buffer + (rq_p->scan.offset / 8);
+				tdo_mask = 1 << (rq_p->scan.offset % 8);
+
+
+				bit_cnt = rq_p->scan.length;
+				if(bit_cnt >= 8) {
+					/* bytes */
+
+					dtc_mask = 1 << (8 - 1);
+
+					for(
+						;
+						bit_cnt;
+						bit_cnt--
+					) {
+						if(*dtc_p & dtc_mask) {
+							*tdo_p |= tdo_mask;
+						} else {
+							*tdo_p &=~ tdo_mask;
+						}
+						
+						dtc_mask >>= 1;
+						if(dtc_mask == 0) {
+							dtc_p++;
+							dtc_mask = 1 << (8 - 1);
+						}
+
+						tdo_mask <<= 1;
+						if(tdo_mask == 0) {
+							tdo_p++;
+							tdo_mask = 1;
+						}
+					}
+				} else {
+					/*  extra bits or last bit */
+
+					x = *dtc_p++;
+					if((
+						rq_p->scan.type == SCAN_IN
+					) && (
+						rq_p->scan.offset != rq_p->scan.size - 1
+					)) {
+						/* extra bits were sent as a full byte with padding on the end */
+						dtc_mask = 1 << (8 - 1);
+					} else {
+						dtc_mask = 1 << (bit_cnt - 1);
+					}
+
+					for(
+						;
+						bit_cnt;
+						bit_cnt--
+					) {
+						if(x & dtc_mask) {
+							*tdo_p |= tdo_mask;
+						} else {
+							*tdo_p &=~ tdo_mask;
+						}
+
+						dtc_mask >>= 1;
+
+						tdo_mask <<= 1;
+						if(tdo_mask == 0) {
+							tdo_p++;
+							tdo_mask = 1;
+						}
+								
+					}
+				}
+
+				if((rq_p->scan.offset + rq_p->scan.length) >= rq_p->scan.size) {
+					/* feed scan buffer back into openocd and free it */
+					if(jtag_read_buffer(rq_p->scan.buffer, rq_p->cmd->cmd.scan) != ERROR_OK) {
+						 retval = ERROR_JTAG_QUEUE_FAILED;
+					}
+					free(rq_p->scan.buffer);
+				}
+
+				rq_next = rq_p->next;
+				free(rq_p);
+			}
+			dtc_queue.rq_head = NULL;
+			dtc_queue.rq_tail = NULL;
+		}
+
+	}
+
+
+	/* reset state for new appends */
+	dtc_queue.cmd_index = 0;
+	dtc_queue.reply_index = 0;
+
+	return(retval);
+}
+
+
+
+static
+int
+tap_state_queue_init(
+) {
+	tap_state_queue.length = 0;
+	tap_state_queue.buffer = 0;
+	return(0);
+}
+
+
+static
+int
+tap_state_queue_run(
+) {
+	int	i;
+	int	bits;
+	u8	byte;
+	int	retval;
+
+	retval = 0;
+	if(!tap_state_queue.length) return(retval);
+	bits = 1;
+	byte = 0;
+	for(i = tap_state_queue.length; i--;) {
+		
+		byte <<= 1;
+		if(tap_state_queue.buffer & 1) {
+			byte |= 1;
+		}
+		if((bits >= 8) || !i) {
+			byte <<= (8 - bits);
+
+			/* make sure there's room for stop, byte op, and one byte */
+			if(dtc_queue.cmd_index >= (sizeof(dtc_queue.cmd_buffer) - (1 + 1 + 1))) {
+				dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
+					DTC_CMD_STOP;
+				dtc_queue_run();
+			}
+
+#ifdef USE_HARDWARE_SHIFTER_FOR_TMS
+			if(bits == 8) {
+				dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
+					DTC_CMD_SHIFT_TMS_BYTES(1);
+			} else {
+#endif
+				dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
+					DTC_CMD_SHIFT_TMS_BITS(bits);
+#ifdef USE_HARDWARE_SHIFTER_FOR_TMS
+			}
+#endif
+
+			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
+				byte;
+
+			byte = 0;
+			bits = 1;
+		} else {
+			bits++;
+		}
+
+		tap_state_queue.buffer >>= 1;
+	}
+	retval = tap_state_queue_init();
+	return(retval);
+}
+
+
+static
+int
+tap_state_queue_append(
+	u8	tms
+) {
+	int	retval;
+
+	if(tap_state_queue.length >= sizeof(tap_state_queue.buffer) * 8) {
+		retval = tap_state_queue_run();
+		if(retval != 0) return(retval);
+	}
+
+	if(tms) {
+		tap_state_queue.buffer |= (1 << tap_state_queue.length);
+	}
+	tap_state_queue.length++;
+
+	return(0);
+}
+
+
+static
+void rlink_end_state(enum tap_state state)
+{
+	if (tap_move_map[state] != -1)
+		end_state = state;
+	else
+	{
+		LOG_ERROR("BUG: %i is not a valid end state", state);
+		exit(-1);
+	}
+}
+
+
+static
+void rlink_state_move(void) {
+
+	int i=0, tms=0;
+	u8 tms_scan = TAP_MOVE(cur_state, end_state);
+
+	for (i = 0; i < 7; i++)
+	{
+		tms = (tms_scan >> i) & 1;
+		tap_state_queue_append(tms);
+	}
+
+	cur_state = end_state;
+}
+
+static
+void rlink_path_move(pathmove_command_t *cmd)
+{
+	int num_states = cmd->num_states;
+	int state_count;
+	int tms = 0;
+
+	state_count = 0;
+	while (num_states)
+	{
+		if (tap_transitions[cur_state].low == cmd->path[state_count])
+		{
+			tms = 0;
+		}
+		else if (tap_transitions[cur_state].high == cmd->path[state_count])
+		{
+			tms = 1;
+		}
+		else
+		{
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(cmd->path[state_count]));
+			exit(-1);
+		}
+
+		tap_state_queue_append(tms);
+
+		cur_state = cmd->path[state_count];
+		state_count++;
+		num_states--;
+	}
+
+	end_state = cur_state;
+}
+
+
+static
+void rlink_runtest(int num_cycles)
+{
+	int i;
+
+	enum tap_state saved_end_state = end_state;
+
+	/* only do a state_move when we're not already in RTI */
+	if (cur_state != TAP_IDLE)
+	{
+		rlink_end_state(TAP_IDLE);
+		rlink_state_move();
+	}
+
+	/* execute num_cycles */
+	for (i = 0; i < num_cycles; i++)
+	{
+		tap_state_queue_append(0);
+	}
+
+	/* finish in end_state */
+	rlink_end_state(saved_end_state);
+	if (cur_state != end_state)
+		rlink_state_move();
+}
+
+
+/* (1) assert or (0) deassert reset lines */
+static
+void rlink_reset(int trst, int srst)
+{
+	u8			bitmap;
+	int			usb_err;
+
+	bitmap = ((~(ST7_PA_NLINE_DRIVER_ENABLE)) & ST7_PA_NUNASSERTED);
+
+	if(trst) {
+		bitmap &= ~ST7_PA_NJTAG_TRST;
+	}
+	if(srst) {
+		bitmap &= ~ST7_PA_NRLINK_RST;
+	}
+
+	usb_err = ep1_generic_commandl(
+		pHDev, 5,
+		 
+		EP1_CMD_MEMORY_WRITE,
+			ST7_PADR >> 8,
+			ST7_PADR,
+			1,
+			bitmap
+	);
+	if(usb_err < 0) {
+		LOG_ERROR("%s: %s\n", __func__, usb_strerror());
+		exit(1);
+	}
+}
+
+
+static
+int
+rlink_scan(
+	jtag_command_t	*cmd,
+	enum scan_type	type,
+	u8			*buffer,
+	int			scan_size
+) {
+	int			ir_scan;
+	enum tap_state	saved_end_state;
+	int			byte_bits;
+	int			extra_bits;
+	int			chunk_bits;
+	int			chunk_bytes;
+	int			x;
+
+	int			tdi_bit_offset;
+	u8			tdi_mask, *tdi_p;
+	u8			dtc_mask;
+	dtc_reply_queue_entry_t	*rq_entry;
+
+	if(scan_size < 1) {
+		LOG_ERROR("scan_size cannot be less than 1 bit\n");
+		exit(1);
+	}
+
+	ir_scan = cmd->cmd.scan->ir_scan;
+
+	/* Move to the proper state before starting to shift TDI/TDO. */
+	if (!(
+		(!ir_scan && (cur_state == TAP_DRSHIFT))
+		||
+		(ir_scan && (cur_state == TAP_IRSHIFT))
+	)) {
+		saved_end_state = end_state;
+		rlink_end_state(ir_scan ? TAP_IRSHIFT : TAP_DRSHIFT);
+		rlink_state_move();
+		rlink_end_state(saved_end_state);
+	}
+
+	tap_state_queue_run();
+
+
+#if 0
+	printf("scan_size = %d, type=0x%x\n", scan_size, type);
+	{
+		int   i;
+
+		/* clear unused bits in scan buffer for ease of debugging */
+		/* (it makes diffing output easier) */
+		buffer[scan_size / 8] &= ((1 << ((scan_size - 1) % 8) + 1) - 1);
+
+		printf("before scan:");
+		for(i = 0; i < (scan_size + 7) / 8; i++) {
+			printf(" %02x", buffer[i]);
+		}
+		printf("\n");
+	}
+#endif
+
+	/* The number of bits that can be shifted as complete bytes */
+	byte_bits = (int)(scan_size - 1) / 8 * 8;
+	/* The number of bits left over, not counting the last bit */
+	extra_bits = (scan_size - 1) - byte_bits;
+
+	tdi_bit_offset = 0;
+	tdi_p = buffer;
+	tdi_mask = 1;
+
+	if(extra_bits && (type == SCAN_OUT)) {
+		/* Schedule any extra bits into the DTC command buffer, padding as needed */
+		/* For SCAN_OUT, this comes before the full bytes so the (leading) padding bits will fall off the end */
+		/* make sure there's room for stop, byte op, and one byte */
+		if(
+			(dtc_queue.cmd_index >= sizeof(dtc_queue.cmd_buffer) - (1 + 1 + 1))
+		) {
+			dtc_queue_run();
+		}
+
+		x = 0;
+		dtc_mask = 1 << (extra_bits - 1);
+	
+		while(extra_bits--) {
+			if(*tdi_p & tdi_mask) {
+				x |= dtc_mask;
+			}
+
+			dtc_mask >>= 1;
+
+			tdi_mask <<= 1;
+			if(tdi_mask == 0) {
+				tdi_p++;
+				tdi_mask = 1;
+			}
+		}
+
+		dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
+			DTC_CMD_SHIFT_TDI_BYTES(1);
+
+		dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = x;
+	}
+
+	/* Loop scheduling full bytes into the DTC command buffer */
+	while(byte_bits) {
+		if(type == SCAN_IN) {
+			/* make sure there's room for stop and byte op */
+			x = (dtc_queue.cmd_index >= sizeof(dtc_queue.cmd_buffer) - (1 + 1));
+		} else {
+			/* make sure there's room for stop, byte op, and at least one byte */
+			x = (dtc_queue.cmd_index >= sizeof(dtc_queue.cmd_buffer) - (1 + 1 + 1));
+		}
+
+		if(type != SCAN_OUT) {
+			/* make sure there's room for at least one reply byte */
+			x |= (dtc_queue.reply_index >= USB_EP2IN_SIZE - (1));
+		}
+
+		if(x) {
+			dtc_queue_run();
+		}
+
+		chunk_bits = byte_bits;
+		/* we can only use up to 16 bytes at a time */
+		if(chunk_bits > (16 * 8)) chunk_bits = (16 * 8);
+
+		if(type != SCAN_IN) {
+			/* how much is there room for, considering stop and byte op? */
+			x = (sizeof(dtc_queue.cmd_buffer) - (dtc_queue.cmd_index + 1 + 1)) * 8;
+			if(chunk_bits > x) chunk_bits = x;
+		}
+
+		if(type != SCAN_OUT) {
+			/* how much is there room for in the reply buffer? */
+			x = (USB_EP2IN_SIZE - dtc_queue.reply_index) * 8;
+			if(chunk_bits > x) chunk_bits = x;
+		}
+
+		/* so the loop will end */
+		byte_bits -= chunk_bits;
+
+		if(type != SCAN_OUT) {
+			if(dtc_queue_enqueue_reply(
+				type, buffer, scan_size, tdi_bit_offset,
+				chunk_bits,
+				cmd
+			) == NULL) {
+				LOG_ERROR("enqueuing DTC reply entry: %s\n", strerror(errno));
+				exit(1);
+			}
+			
+			tdi_bit_offset += chunk_bits;
+		}
+
+		/* chunk_bits is a multiple of 8, so there are no rounding issues. */
+		chunk_bytes = chunk_bits / 8;
+
+		switch(type) {
+			case SCAN_IN:
+				x = DTC_CMD_SHIFT_TDO_BYTES(chunk_bytes);
+				break;
+			case SCAN_OUT:
+				x = DTC_CMD_SHIFT_TDI_BYTES(chunk_bytes);
+				break;
+			default:
+				x = DTC_CMD_SHIFT_TDIO_BYTES(chunk_bytes);
+				break;
+		}
+		dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = x;
+
+		if(type != SCAN_IN) {
+			x = 0;
+			dtc_mask = 1 << (8 - 1);
+		
+			while(chunk_bits--) {
+				if(*tdi_p & tdi_mask) {
+					x |= dtc_mask;
+				}
+	
+				dtc_mask >>= 1;
+				if(dtc_mask == 0) {
+					dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = x;
+					dtc_queue.reply_index++;
+					x = 0;
+					dtc_mask = 1 << (8 - 1);
+				}
+	
+				tdi_mask <<= 1;
+				if(tdi_mask == 0) {
+					tdi_p++;
+					tdi_mask = 1;
+				}
+			}
+		}
+	}
+
+	if(extra_bits && (type != SCAN_OUT)) {
+		/* Schedule any extra bits into the DTC command buffer */
+		/* make sure there's room for stop, byte op, and one byte */
+		if(
+			(dtc_queue.cmd_index >= sizeof(dtc_queue.cmd_buffer) - (1 + 1 + 1))
+			||
+			(dtc_queue.reply_index >= USB_EP2IN_SIZE - (1))
+		) {
+			dtc_queue_run();
+		}
+
+		if(dtc_queue_enqueue_reply(
+			type, buffer, scan_size, tdi_bit_offset,
+			extra_bits,
+			cmd
+		) == NULL) {
+			LOG_ERROR("enqueuing DTC reply entry: %s\n", strerror(errno));
+			exit(1);
+		}
+			
+		tdi_bit_offset += extra_bits;
+
+		if(type == SCAN_IN) {
+			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
+				DTC_CMD_SHIFT_TDO_BYTES(1);
+
+		} else {
+			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
+				DTC_CMD_SHIFT_TDIO_BITS(extra_bits);
+
+			x = 0;
+			dtc_mask = 1 << (8 - 1);
+		
+			while(extra_bits--) {
+				if(*tdi_p & tdi_mask) {
+					x |= dtc_mask;
+				}
+	
+				dtc_mask >>= 1;
+	
+				tdi_mask <<= 1;
+				if(tdi_mask == 0) {
+					tdi_p++;
+					tdi_mask = 1;
+				}
+			}
+
+			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = x;
+		}
+
+		dtc_queue.reply_index++;
+	}
+
+	/* Schedule the last bit into the DTC command buffer */
+	{
+		/* make sure there's room for stop, and bit pair command */
+		if(
+			(dtc_queue.cmd_index >= sizeof(dtc_queue.cmd_buffer) - (1 + 1))
+			||
+			(dtc_queue.reply_index >= USB_EP2IN_SIZE - (1))
+		) {
+			dtc_queue_run();
+		}
+
+		if(type == SCAN_OUT) {
+			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
+				DTC_CMD_SHIFT_TMS_TDI_BIT_PAIR(1, (*tdi_p & tdi_mask), 0);
+
+		} else {
+			if(dtc_queue_enqueue_reply(
+				type, buffer, scan_size, tdi_bit_offset,
+				1,
+				cmd
+			) == NULL) {
+				LOG_ERROR("enqueuing DTC reply entry: %s\n", strerror(errno));
+				exit(1);
+			}
+			
+			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = 
+				DTC_CMD_SHIFT_TMS_TDI_BIT_PAIR(1, (*tdi_p & tdi_mask), 1);
+
+			dtc_queue.reply_index++;
+		}
+	}
+
+	/* Move to pause state */
+	tap_state_queue_append(0);
+	cur_state = ir_scan ? TAP_IRPAUSE : TAP_DRPAUSE;
+	if (cur_state != end_state) rlink_state_move();
+
+	return(0);
+}
+
+
+static
+int rlink_execute_queue(void)
+{
+	jtag_command_t *cmd = jtag_command_queue; /* currently processed command */
+	int scan_size;
+	enum scan_type type;
+	u8 *buffer;
+	int retval, tmp_retval;
+
+	/* return ERROR_OK, unless something goes wrong */
+	retval = ERROR_OK;
+
+#ifndef AUTOMATIC_BUSY_LED
+	/* turn LED on */
+	ep1_generic_commandl(pHDev, 2,
+		EP1_CMD_SET_PORTD_LEDS,
+		~(ST7_PD_NBUSY_LED)
+	);
+#endif
+
+	while (cmd)
+	{
+		switch (cmd->type)
+		{
+			case JTAG_END_STATE:
+			case JTAG_RUNTEST:
+			case JTAG_STATEMOVE:
+			case JTAG_PATHMOVE:
+			case JTAG_SCAN:
+				break;
+
+			default:
+				/* some events, such as resets, need a queue flush to ensure consistency */
+				tap_state_queue_run();
+				dtc_queue_run();
+				break;
+		}
+
+		switch (cmd->type)
+		{
+			case JTAG_END_STATE:
+#ifdef _DEBUG_JTAG_IO_
+				LOG_DEBUG("end_state: %i", cmd->cmd.end_state->end_state);
+#endif
+				if (cmd->cmd.end_state->end_state != -1)
+					rlink_end_state(cmd->cmd.end_state->end_state);
+				break;
+			case JTAG_RESET:
+#ifdef _DEBUG_JTAG_IO_
+				LOG_DEBUG("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);
+#endif
+				if ((cmd->cmd.reset->trst == 1) || (cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST)))
+				{
+					cur_state = TAP_RESET;
+				}
+				rlink_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
+				break;
+			case JTAG_RUNTEST:
+#ifdef _DEBUG_JTAG_IO_
+				LOG_DEBUG("runtest %i cycles, end in %i", cmd->cmd.runtest->num_cycles, cmd->cmd.runtest->end_state);
+#endif
+				if (cmd->cmd.runtest->end_state != -1)
+					rlink_end_state(cmd->cmd.runtest->end_state);
+				rlink_runtest(cmd->cmd.runtest->num_cycles);
+				break;
+			case JTAG_STATEMOVE:
+#ifdef _DEBUG_JTAG_IO_
+				LOG_DEBUG("statemove end in %i", cmd->cmd.statemove->end_state);
+#endif
+				if (cmd->cmd.statemove->end_state != -1)
+					rlink_end_state(cmd->cmd.statemove->end_state);
+				rlink_state_move();
+				break;
+			case JTAG_PATHMOVE:
+#ifdef _DEBUG_JTAG_IO_
+				LOG_DEBUG("pathmove: %i states, end in %i", cmd->cmd.pathmove->num_states, cmd->cmd.pathmove->path[cmd->cmd.pathmove->num_states - 1]);
+#endif
+				rlink_path_move(cmd->cmd.pathmove);
+				break;
+			case JTAG_SCAN:
+#ifdef _DEBUG_JTAG_IO_
+				LOG_DEBUG("%s scan end in %i",  (cmd->cmd.scan->ir_scan) ? "IR" : "DR", cmd->cmd.scan->end_state);
+#endif
+				if (cmd->cmd.scan->end_state != -1)
+					rlink_end_state(cmd->cmd.scan->end_state);
+				scan_size = jtag_build_buffer(cmd->cmd.scan, &buffer);
+				type = jtag_scan_type(cmd->cmd.scan);
+				if(rlink_scan(cmd, type, buffer, scan_size) != ERROR_OK) {
+					retval = ERROR_FAIL;
+				}
+				break;
+			case JTAG_SLEEP:
+#ifdef _DEBUG_JTAG_IO_
+				LOG_DEBUG("sleep %i", cmd->cmd.sleep->us);
+#endif
+				jtag_sleep(cmd->cmd.sleep->us);
+				break;
+			default:
+				LOG_ERROR("BUG: unknown JTAG command type encountered");
+				exit(-1);
+		}
+		cmd = cmd->next;
+	}
+
+	/* Flush the DTC queue to make sure any pending reads have been done before exiting this function */
+	tap_state_queue_run();
+	tmp_retval = dtc_queue_run();
+	if(tmp_retval != ERROR_OK) {
+		retval = tmp_retval;
+	}
+
+#ifndef AUTOMATIC_BUSY_LED
+	/* turn LED onff */
+	ep1_generic_commandl(pHDev, 2,
+		EP1_CMD_SET_PORTD_LEDS,
+		~0
+	);
+#endif
+
+	return retval;
+}
+
+
+/* Using an unindexed table because it is infrequently accessed and it is short.  The table must be in order of ascending speed (and descending prescaler), as it is scanned in reverse. */
+
+static
+int rlink_speed(int speed)
+{
+	int		i;
+
+	if(speed == 0) {
+		/* fastest speed */
+		speed = rlink_speed_table[rlink_speed_table_size - 1].prescaler;
+	}
+
+	for(i = rlink_speed_table_size; i--; ) {
+		if(rlink_speed_table[i].prescaler == speed) {
+			if(dtc_load_from_buffer(pHDev, rlink_speed_table[i].dtc, rlink_speed_table[i].dtc_size) != 0) {
+				LOG_ERROR("An error occurred while trying to load DTC code for speed \"%d\".\n", speed);
+				exit(1);
+			}
+	
+			if(dtc_start_download() < 0) {
+				LOG_ERROR("%s, %d: starting DTC: %s",
+					__FILE__, __LINE__,
+					usb_strerror()
+				);
+				exit(1);
+			}
+
+			return ERROR_OK;
+		}
+	}
+
+	LOG_ERROR("%d is not a supported speed", speed);
+	return(ERROR_FAIL);
+}
+
+
+static
+int rlink_speed_div(
+	int speed,
+	int *khz
+) {
+	int	i;
+
+	for(i = rlink_speed_table_size; i--; ) {
+		if(rlink_speed_table[i].prescaler == speed) {
+			*khz = rlink_speed_table[i].khz;
+			return(ERROR_OK);
+		}
+	}
+
+	LOG_ERROR("%d is not a supported speed", speed);
+	return(ERROR_FAIL);
+}
+
+
+static
+int rlink_khz(
+	int khz,
+	int *speed
+) {
+	int	i;
+
+	if(khz == 0) {
+		LOG_ERROR("RCLK not supported");
+		return ERROR_FAIL;
+	}
+
+	for(i = rlink_speed_table_size; i--; ) {
+		if(rlink_speed_table[i].khz <= khz) {
+			*speed = rlink_speed_table[i].prescaler;
+			return(ERROR_OK);
+		}
+	}
+
+	LOG_WARNING("The lowest supported JTAG speed is %d KHz", rlink_speed_table[0].khz);
+	*speed = rlink_speed_table[0].prescaler;
+	return(ERROR_OK);
+}
+
+
+#if 0
+static
+int
+handle_dtc_directory_command(
+	struct command_context_s *cmd_ctx,
+	char *cmd,
+	char **args,
+	int argc
+) {
+	if(argc != 1) {
+		LOG_ERROR("expected exactly one argument to rlink_dtc_directory <directory-path>");
+		return(ERROR_INVALID_ARGUMENTS);
+	}
+
+	printf("handle_dtc_directory_command called with \"%s\"\n", args[0]);
+
+	return(ERROR_OK);
+}
+#endif
+
+
+static
+int rlink_register_commands(struct command_context_s *cmd_ctx)
+{
+
+#ifdef _DEBUG_JTAG_IO_
+	LOG_DEBUG("rlink_register_commands called with cmd_ctx=%p\n", cmd_ctx);
+#endif
+
+#if 0
+	register_command(
+		cmd_ctx, NULL,
+		"rlink_dtc_directory",
+		handle_dtc_directory_command,
+		COMMAND_CONFIG,
+		"The directory in which to search for DTC load images"
+	);
+#endif
+
+	return ERROR_OK;
+}
+
+
+static
+int rlink_init(void)
+{
+	struct usb_bus *busses;
+	struct usb_bus *bus;
+	int c, i, a, j, retries,len;
+	int found=0;
+	int success=0;
+	u8 reply_buffer[USB_EP1IN_SIZE];
+
+	usb_init();
+	usb_find_busses();
+	usb_find_devices();
+
+	busses = usb_get_busses();
+
+	for(bus = busses; bus; bus = bus->next)
+	{
+		struct usb_device *dev;
+
+		for(dev = bus->devices; dev; dev = dev->next)
+		{
+			if( (dev->descriptor.idVendor == USB_IDVENDOR) && (dev->descriptor.idProduct == USB_IDPRODUCT) )
+			{
+				found = 1;
+				LOG_DEBUG("Found device on bus.\n");
+
+				do
+				{
+					if( dev->descriptor.bNumConfigurations > 1 )
+					{
+						LOG_ERROR("Whoops! NumConfigurations is not 1, don't know what to do...\n");
+						break;
+					}
+					if( dev->config->bNumInterfaces > 1 )
+					{
+						LOG_ERROR("Whoops! NumInterfaces is not 1, don't know what to do...\n");
+						break;
+					}
+
+					pHDev=usb_open(dev);
+					if( !pHDev )
+						LOG_ERROR ("Failed to open device.\n");
+					else
+					{
+						LOG_DEBUG("Opened device, pHDev = %p\n",pHDev);
+
+						retries = 3;
+						do
+						{
+							i = usb_claim_interface(pHDev,0);
+							if(i)
+							{
+								LOG_ERROR("usb_claim_interface: %s", usb_strerror());
+#ifdef LIBUSB_HAS_DETACH_KERNEL_DRIVER_NP
+								j = usb_detach_kernel_driver_np(pHDev, 0);
+								if(j)
+									LOG_ERROR("detach kernel driver: %s", usb_strerror());
+#endif
+							}
+							else
+							{
+								LOG_DEBUG("interface claimed!\n");
+								break;
+							}
+						} while(--retries);
+
+						if(!i)
+						{
+							if( usb_set_altinterface(pHDev,0) )
+							{
+								LOG_ERROR("Failed to set interface.\n");
+								break;
+							}
+							else
+								success=1;
+						}
+					}
+				} while(0);
+			}
+		}
+	}
+
+	if( !found )
+	{
+		LOG_ERROR("No device found on bus.\n");
+		exit(1);
+	}
+
+	if( !success )
+	{
+		LOG_ERROR("Initialisation failed.");
+		exit(1);
+	}
+
+
+	/* The device starts out in an unknown state on open.  As such, result reads time out, and it's not even known whether the command was accepted.  So, for this first command, we issue it repeatedly until its response doesn't time out.  Also, if sending a command is going to time out, we'll find that out here. */
+	/* It must be possible to open the device in such a way that this special magic isn't needed, but, so far, it escapes us. */
+	for(i = 0; i < 5; i++) {
+		j = ep1_generic_commandl(
+			pHDev, 1,
+			EP1_CMD_GET_FWREV
+		);
+		if(j < USB_EP1OUT_SIZE) {
+			LOG_ERROR("USB write error: %s", usb_strerror());
+			return(ERROR_FAIL);
+		}
+		j = usb_bulk_read(
+			pHDev, USB_EP1IN_ADDR,
+			reply_buffer, sizeof(reply_buffer),
+			200
+		);
+		if(j != -ETIMEDOUT) break;
+	}
+
+	if(j < (int)sizeof(reply_buffer)) {
+		LOG_ERROR("USB read error: %s", usb_strerror());
+		return(ERROR_FAIL);
+	}
+	LOG_DEBUG(INTERFACE_NAME" firmware version: %d.%d.%d\n", reply_buffer[0], reply_buffer[1], reply_buffer[2]);
+
+	if((reply_buffer[0] != 0) || (reply_buffer[1] != 0) || (reply_buffer[2] != 3)) {
+		LOG_WARNING("The rlink device is not of the version that the developers have played with.  It may or may not work.\n");
+	}
+
+	/* Probe port E for adapter presence */
+	ep1_generic_commandl(
+		pHDev, 16,
+		EP1_CMD_MEMORY_WRITE,	/* Drive sense pin with 0 */
+			ST7_PEDR >> 8,
+			ST7_PEDR,
+			3,
+			0x00,
+			ST7_PE_ADAPTER_SENSE_OUT,
+			ST7_PE_ADAPTER_SENSE_OUT,
+		EP1_CMD_MEMORY_READ,	/* Read back */
+			ST7_PEDR >> 8,
+			ST7_PEDR,
+			1,
+		EP1_CMD_MEMORY_WRITE,	/* Drive sense pin with 1 */
+			ST7_PEDR >> 8,
+			ST7_PEDR,
+			1,
+			ST7_PE_ADAPTER_SENSE_OUT
+	);
+
+	usb_bulk_read(
+		pHDev, USB_EP1IN_ADDR,
+		reply_buffer, 1,
+		USB_TIMEOUT_MS
+	);
+
+	if((reply_buffer[0] & ST7_PE_ADAPTER_SENSE_IN) != 0) {
+		LOG_WARNING("target detection problem\n");
+	}
+
+	ep1_generic_commandl(
+		pHDev, 11,
+		EP1_CMD_MEMORY_READ,	/* Read back */
+			ST7_PEDR >> 8,
+			ST7_PEDR,
+			1,
+		EP1_CMD_MEMORY_WRITE,	/* float port E */
+			ST7_PEDR >> 8,
+			ST7_PEDR,
+			3,
+			0x00,
+			0x00,
+			0x00
+	);
+
+	usb_bulk_read(
+		pHDev, USB_EP1IN_ADDR,
+		reply_buffer, 1,
+		USB_TIMEOUT_MS
+	);
+
+
+	if((reply_buffer[0] & ST7_PE_ADAPTER_SENSE_IN) == 0) {
+		LOG_WARNING("target not plugged in\n");
+	}
+
+	/* float port A, make sure DTC is stopped, set upper 2 bits of port D, and set up port A */
+	ep1_generic_commandl(
+		pHDev, 15,
+		EP1_CMD_MEMORY_WRITE,
+			ST7_PADDR >> 8,
+			ST7_PADDR,
+			2,
+			0x00,
+			0x00,
+		EP1_CMD_DTC_STOP,
+		EP1_CMD_SET_PORTD_UPPER,
+			~(ST7_PD_NRUN_LED),
+		EP1_CMD_MEMORY_WRITE,
+			ST7_PADR >> 8,
+			ST7_PADR,
+			2,
+			((~(ST7_PA_NLINE_DRIVER_ENABLE)) & ST7_PA_NUNASSERTED),
+			(ST7_PA_NLINE_DRIVER_ENABLE | ST7_PA_NRLINK_RST | ST7_PA_NJTAG_TRST)
+	);
+
+	/* set LED updating mode and make sure they're unlit */
+	ep1_generic_commandl(
+		pHDev, 3,
+#ifdef AUTOMATIC_BUSY_LED
+		EP1_CMD_LEDUE_BUSY,
+#else
+		EP1_CMD_LEDUE_NONE,
+#endif
+		EP1_CMD_SET_PORTD_LEDS,
+			~0
+	);
+
+	tap_state_queue_init();
+	dtc_queue_init();
+	rlink_speed(jtag_speed);
+	rlink_reset(0, 0);
+
+	return ERROR_OK;
+}
+
+
+static
+int rlink_quit(void)
+{
+	/* stop DTC and make sure LEDs are off */
+	ep1_generic_commandl(
+		pHDev, 6,
+		EP1_CMD_DTC_STOP,
+		EP1_CMD_LEDUE_NONE,
+		EP1_CMD_SET_PORTD_LEDS,
+			~0,
+		EP1_CMD_SET_PORTD_UPPER,
+			~0
+	);
+
+	usb_release_interface(pHDev,0);
+	usb_close(pHDev);
+
+
+	return ERROR_OK;
+}
+
+
+jtag_interface_t rlink_interface =
+{
+	.name = "rlink",
+	.init = rlink_init,
+	.quit = rlink_quit,
+	.register_commands = rlink_register_commands,
+	.speed = rlink_speed,
+	.speed_div = rlink_speed_div,
+	.khz = rlink_khz,
+	.execute_queue = rlink_execute_queue,
+};


Property changes on: trunk/src/jtag/rlink/rlink.c
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/jtag/rlink/rlink.h
===================================================================
--- trunk/src/jtag/rlink/rlink.h	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/rlink/rlink.h	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,33 @@
+/***************************************************************************
+ *   Copyright (C) 2008 Lou Deluxe                                         *
+ *   lou.openocd012 at fixit.nospammail.net                                   *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+#include "types.h"
+#include <sys/types.h>
+
+typedef
+struct rlink_speed_table_s {
+	u8 const	*dtc;
+	u16			dtc_size;
+	u16			khz;
+	u8			prescaler;
+} rlink_speed_table_t;
+
+extern const rlink_speed_table_t	rlink_speed_table[];
+extern const size_t					rlink_speed_table_size;


Property changes on: trunk/src/jtag/rlink/rlink.h
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/jtag/rlink/rlink_speed_table.c
===================================================================
--- trunk/src/jtag/rlink/rlink_speed_table.c	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/rlink/rlink_speed_table.c	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,98 @@
+/* This file was created automatically by ../../../tools/rlink_make_speed_table/rlink_make_speed_table.pl. */
+
+#include "rlink.h"
+#include "st7.h"
+
+static const u8 dtc_64[] = {
+	0, 2, 68, 84, 67, 2, 13, 160, 176, 151, 147, 182, 141, 152, 177, 129, 148,
+	191, 143, 142, 5, 3, 0, 0, 0, 2, 68, 84, 67, 4, 0, 192, 5, 15, 0, 42, 42,
+	42, 73, 0, 88, 0, 160, 189, 0, 0, 0, 0, 106, 9, 1, 8, 22, 100, 111, 119,
+	110, 108, 111, 97, 100, 2, 226, 7, 219, 39, 137, 51, 172, 130, 192, 96,
+	175, 191, 130, 217, 128, 57, 69, 177, 159, 179, 68, 178, 159, 193, 133,
+	153, 176, 159, 130, 132, 135, 164, 134, 51, 129, 60, 223, 9, 98, 128, 177,
+	129, 96, 201, 160, 130, 201, 51, 137, 201, 57, 68, 160, 176, 67, 219, 39,
+	154, 201, 40, 69, 219, 39, 150, 17, 27, 205, 51, 43, 99, 60, 118, 193,
+	96, 201, 160, 130, 24, 205, 51, 43, 99, 218, 156, 47, 60, 105, 193, 96,
+	201, 160, 138, 166, 178, 136, 160, 183, 139, 86, 202, 8, 2, 36, 138, 105,
+	193, 96, 201, 160, 43, 139, 167, 181, 136, 70, 177, 147, 67, 193, 96, 219,
+	39, 131, 161, 176, 130, 195, 53, 131, 178, 10, 66, 176, 151, 60, 97, 58,
+	151, 215, 2, 40, 66, 1, 0, 160, 185, 130, 60, 97, 203, 130, 60, 194, 139,
+	127, 195, 53, 156, 47, 200, 96, 201, 56, 177, 66, 176, 147, 201, 57, 168,
+	66, 160, 38, 155, 160, 176, 139, 171, 182, 136, 167, 183, 96, 201, 59,
+	66, 46, 193, 151, 96, 201, 160, 139, 219, 39, 131, 160, 191, 130, 195,
+	53, 131, 177, 10, 66, 176, 147, 151, 0, 60, 97, 58, 151, 0, 160, 185, 130,
+	60, 97, 203, 8, 2, 36, 139, 124, 193, 151, 96
+};
+
+static const u8 dtc_11[] = {
+	0, 2, 68, 84, 67, 2, 13, 160, 176, 151, 147, 182, 141, 152, 177, 129, 148,
+	188, 143, 142, 5, 3, 0, 0, 0, 2, 68, 84, 67, 4, 0, 192, 5, 15, 0, 42, 42,
+	42, 73, 0, 88, 0, 154, 183, 0, 0, 0, 0, 106, 9, 1, 8, 22, 100, 111, 119,
+	110, 108, 111, 97, 100, 2, 213, 7, 219, 39, 137, 51, 172, 130, 192, 96,
+	175, 191, 130, 217, 128, 57, 69, 177, 159, 179, 68, 178, 159, 193, 133,
+	153, 176, 159, 130, 132, 135, 164, 134, 51, 129, 60, 223, 9, 98, 128, 177,
+	129, 96, 201, 160, 130, 201, 51, 137, 201, 57, 68, 160, 176, 67, 219, 39,
+	154, 201, 40, 69, 219, 39, 150, 17, 27, 205, 51, 43, 99, 60, 118, 193,
+	96, 201, 160, 130, 24, 205, 51, 43, 99, 218, 156, 47, 60, 105, 193, 96,
+	201, 160, 138, 166, 178, 136, 160, 183, 139, 86, 202, 8, 2, 36, 138, 105,
+	193, 96, 201, 160, 43, 139, 167, 181, 136, 70, 177, 147, 67, 193, 96, 219,
+	39, 131, 195, 53, 131, 178, 10, 66, 176, 151, 0, 0, 0, 0, 0, 58, 151, 215,
+	2, 40, 66, 1, 203, 130, 60, 194, 139, 121, 195, 53, 156, 47, 200, 96, 201,
+	56, 177, 66, 176, 147, 201, 57, 168, 66, 160, 38, 155, 160, 176, 139, 171,
+	176, 136, 167, 183, 96, 201, 59, 66, 46, 193, 151, 96, 201, 160, 139, 219,
+	39, 131, 195, 53, 131, 177, 10, 66, 176, 147, 151, 0, 0, 0, 0, 0, 58, 151,
+	203, 8, 2, 36, 139, 117, 193, 151, 96
+};
+
+static const u8 dtc_8[] = {
+	0, 2, 68, 84, 67, 2, 13, 160, 176, 151, 147, 182, 141, 152, 177, 129, 148,
+	187, 143, 142, 5, 3, 0, 0, 0, 2, 68, 84, 67, 4, 0, 192, 5, 15, 0, 42, 42,
+	42, 73, 0, 88, 0, 152, 181, 0, 0, 0, 0, 106, 9, 1, 8, 22, 100, 111, 119,
+	110, 108, 111, 97, 100, 2, 209, 7, 219, 39, 137, 51, 172, 130, 192, 96,
+	175, 191, 130, 217, 128, 57, 69, 177, 159, 179, 68, 178, 159, 193, 133,
+	153, 176, 159, 130, 132, 135, 164, 134, 51, 129, 60, 223, 9, 98, 128, 177,
+	129, 96, 201, 160, 130, 201, 51, 137, 201, 57, 68, 160, 176, 67, 219, 39,
+	154, 201, 40, 69, 219, 39, 150, 17, 27, 205, 51, 43, 99, 60, 118, 193,
+	96, 201, 160, 130, 24, 205, 51, 43, 99, 218, 156, 47, 60, 105, 193, 96,
+	201, 160, 138, 166, 178, 136, 160, 183, 139, 86, 202, 8, 2, 36, 138, 105,
+	193, 96, 201, 160, 43, 139, 167, 181, 136, 70, 177, 147, 67, 193, 96, 219,
+	39, 131, 195, 53, 131, 178, 10, 66, 176, 151, 0, 0, 0, 58, 151, 215, 2,
+	40, 66, 1, 203, 130, 60, 194, 139, 119, 195, 53, 156, 47, 200, 96, 201,
+	56, 177, 66, 176, 147, 201, 57, 168, 66, 160, 38, 155, 160, 176, 139, 170,
+	190, 136, 167, 183, 96, 201, 59, 66, 46, 193, 151, 96, 201, 160, 139, 219,
+	39, 131, 195, 53, 131, 177, 10, 66, 176, 147, 151, 0, 0, 0, 58, 151, 203,
+	8, 2, 36, 139, 115, 193, 151, 96
+};
+
+static const u8 dtc_2[] = {
+	0, 2, 68, 84, 67, 2, 14, 160, 176, 151, 147, 182, 141, 152, 177, 129, 148,
+	186, 143, 185, 142, 5, 3, 0, 0, 0, 2, 68, 84, 67, 4, 0, 192, 5, 15, 0,
+	42, 42, 42, 73, 0, 88, 0, 149, 178, 0, 0, 0, 0, 106, 9, 1, 8, 22, 100,
+	111, 119, 110, 108, 111, 97, 100, 2, 203, 7, 219, 39, 137, 51, 172, 130,
+	192, 96, 175, 191, 130, 217, 128, 57, 69, 177, 159, 179, 68, 178, 159,
+	193, 133, 153, 176, 159, 130, 132, 135, 164, 134, 51, 129, 60, 223, 9,
+	98, 128, 177, 129, 96, 201, 160, 130, 201, 51, 137, 201, 57, 68, 160, 176,
+	67, 219, 39, 154, 201, 40, 69, 219, 39, 150, 17, 27, 205, 51, 43, 99, 60,
+	118, 193, 96, 201, 160, 130, 24, 205, 51, 43, 99, 218, 156, 47, 60, 105,
+	193, 96, 201, 160, 138, 166, 178, 136, 160, 183, 139, 86, 202, 8, 2, 36,
+	138, 105, 193, 96, 201, 160, 43, 139, 167, 181, 136, 70, 177, 147, 67,
+	193, 96, 219, 39, 131, 195, 53, 131, 178, 10, 66, 176, 151, 58, 151, 215,
+	2, 40, 66, 1, 203, 130, 60, 194, 139, 116, 195, 53, 156, 47, 200, 96, 201,
+	56, 177, 66, 176, 147, 201, 57, 168, 66, 160, 38, 155, 160, 176, 139, 170,
+	187, 136, 167, 183, 96, 201, 59, 66, 46, 193, 151, 96, 201, 160, 139, 219,
+	39, 131, 195, 53, 131, 177, 10, 66, 176, 147, 151, 58, 151, 203, 8, 2,
+	36, 139, 112, 193, 151, 96
+};
+
+const rlink_speed_table_t rlink_speed_table[] = {{
+	dtc_64, sizeof(dtc_64), (ST7_FOSC * 2) / (1000 * 64), 64
+}, {
+	dtc_11, sizeof(dtc_11), (ST7_FOSC * 2) / (1000 * 11), 11
+}, {
+	dtc_8, sizeof(dtc_8), (ST7_FOSC * 2) / (1000 * 8), 8
+}, {
+	dtc_2, sizeof(dtc_2), (ST7_FOSC * 2) / (1000 * 2), 2
+}};
+
+const size_t rlink_speed_table_size = sizeof(rlink_speed_table) / sizeof(*rlink_speed_table);
+


Property changes on: trunk/src/jtag/rlink/rlink_speed_table.c
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/jtag/rlink/st7.h
===================================================================
--- trunk/src/jtag/rlink/st7.h	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/src/jtag/rlink/st7.h	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,114 @@
+/***************************************************************************
+ *   Copyright (C) 2008 Lou Deluxe                                         *
+ *   lou.openocd012 at fixit.nospammail.net                                   *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+#define ST7_FOSC		(12 * 1000000)
+
+/* This is not a complete enumeration of ST7 registers, but it is sufficient for this interface driver. */
+
+#define ST7_PADR		(0x0000)
+#define ST7_PADDR		(ST7_PADR + 1)
+#define ST7_PAOR		(ST7_PADR + 2)
+#define ST7_PBDR		(0x0003)
+#define ST7_PBDDR		(ST7_PBDR + 1)
+#define ST7_PCDR		(0x0006)
+#define ST7_PCDDR		(ST7_PCDR + 1)
+#define ST7_PCOR		(ST7_PCDR + 2)
+#define ST7_PDDR		(0x0009)
+#define ST7_PDDDR		(ST7_PDDR + 1)
+#define ST7_PDOR		(ST7_PDDR + 2)
+#define ST7_PEDR		(0x000c)
+#define ST7_PEDDR		(ST7_PEDR + 1)
+#define ST7_PEOR		(ST7_PEDR + 2)
+#define ST7_PFDR		(0x000f)
+#define ST7_PFDDR		(ST7_PFDR + 1)
+
+#define ST7_ADCDR		(0x0012)
+#define ST7_ADCCSR		(ST7_ADCDR + 1)
+
+#define ST7_EP2TXR		(0x003e)
+#define ST7_EP2TXR_STAT_TX0	(1 << 0)
+#define ST7_EP2TXR_STAT_TX1	(1 << 1)
+#define ST7_EP2TXR_STAT_DISABLED	(0)
+#define ST7_EP2TXR_STAT_STALL	(ST7_EP2TXR_STAT_TX0)
+#define ST7_EP2TXR_STAT_VALID	(ST7_EP2TXR_STAT_TX1 | ST7_EP2TXR_STAT_TX0)
+#define ST7_EP2TXR_STAT_NAK	(ST7_EP2TXR_STAT_TX1)
+#define ST7_EP2TXR_DTOG_TX	(1 << 2)
+#define ST7_EP2TXR_CTR_TX	(1 << 3)
+
+#define ST7_USB_BUF_EP0OUT	(0x1550)
+#define ST7_USB_BUF_EP0IN	(0x1560)
+#define ST7_USB_BUF_EP1OUT	(0x1570)
+#define ST7_USB_BUF_EP1IN	(0x1580)
+#define ST7_USB_BUF_EP2UODI	(0x1590)
+#define ST7_USB_BUF_EP2UIDO	(0x1650)
+
+#define ST7_PA0			(1 << 0)
+#define ST7_PA1			(1 << 1)
+#define ST7_PA2			(1 << 2)
+#define ST7_PA3			(1 << 3)
+#define ST7_PA4			(1 << 4)
+#define ST7_PA5			(1 << 5)
+#define ST7_PA6			(1 << 6)
+#define ST7_PA7			(1 << 7)
+
+#define ST7_PB0			(1 << 0)
+#define ST7_PB1			(1 << 1)
+#define ST7_PB2			(1 << 2)
+#define ST7_PB3			(1 << 3)
+#define ST7_PB4			(1 << 4)
+#define ST7_PB5			(1 << 5)
+#define ST7_PB6			(1 << 6)
+#define ST7_PB7			(1 << 7)
+
+#define ST7_PC0			(1 << 0)
+#define ST7_PC1			(1 << 1)
+#define ST7_PC2			(1 << 2)
+#define ST7_PC3			(1 << 3)
+#define ST7_PC4			(1 << 4)
+#define ST7_PC5			(1 << 5)
+#define ST7_PC6			(1 << 6)
+#define ST7_PC7			(1 << 7)
+
+#define ST7_PD0			(1 << 0)
+#define ST7_PD1			(1 << 1)
+#define ST7_PD2			(1 << 2)
+#define ST7_PD3			(1 << 3)
+#define ST7_PD4			(1 << 4)
+#define ST7_PD5			(1 << 5)
+#define ST7_PD6			(1 << 6)
+#define ST7_PD7			(1 << 7)
+
+#define ST7_PE0			(1 << 0)
+#define ST7_PE1			(1 << 1)
+#define ST7_PE2			(1 << 2)
+#define ST7_PE3			(1 << 3)
+#define ST7_PE4			(1 << 4)
+#define ST7_PE5			(1 << 5)
+#define ST7_PE6			(1 << 6)
+#define ST7_PE7			(1 << 7)
+
+#define ST7_PF0			(1 << 0)
+#define ST7_PF1			(1 << 1)
+#define ST7_PF2			(1 << 2)
+#define ST7_PF3			(1 << 3)
+#define ST7_PF4			(1 << 4)
+#define ST7_PF5			(1 << 5)
+#define ST7_PF6			(1 << 6)
+#define ST7_PF7			(1 << 7)


Property changes on: trunk/src/jtag/rlink/st7.h
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/tools/rlink_make_speed_table/rlink_make_speed_table
===================================================================
--- trunk/tools/rlink_make_speed_table/rlink_make_speed_table	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/tools/rlink_make_speed_table/rlink_make_speed_table	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,2 @@
+#!/bin/sh
+exec perl "$0.pl" $*


Property changes on: trunk/tools/rlink_make_speed_table/rlink_make_speed_table
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl
===================================================================
--- trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,68 @@
+#!/bin/perl
+#***************************************************************************
+#*   Copyright (C) 2008 Lou Deluxe                                         *
+#*   lou.openocd012 at fixit.nospammail.net                                   *
+#*                                                                         *
+#*   This program is free software; you can redistribute it and/or modify  *
+#*   it under the terms of the GNU General Public License as published by  *
+#*   the Free Software Foundation; either version 2 of the License, or     *
+#*   (at your option) any later version.                                   *
+#*                                                                         *
+#*   This program is distributed in the hope that it will be useful,       *
+#*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+#*   GNU General Public License for more details.                          *
+#*                                                                         *
+#*   You should have received a copy of the GNU General Public License     *
+#*   along with this program; if not, write to the                         *
+#*   Free Software Foundation, Inc.,                                       *
+#*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+#***************************************************************************
+
+# A simple utility to read a list of files (names composed by numeric prescaler arguments) and compose a C source file defining data structures which hold the binary data read from those files.
+
+ at speed_table = ();
+
+printf("/* This file was created automatically by %s. */\n\n", $0);
+for $i ('rlink', 'st7') {
+	printf("#include \"$i.h\"\n");
+}
+printf("\n");
+
+for $prescaler (sort {$b <=> $a} @ARGV) {
+	my(@ary) = (
+		byte_array_from_file(${prescaler} . "_init.dtc"),
+		byte_array_from_file(${prescaler} . "_call.dtc")
+	);
+
+	for $i (@ary) {
+		$i = sprintf("%d", $i);
+	}
+	$bytes = join(', ', @ary);
+	$bytes =~ s/(^|\s)(.{70}?\S*)/\2\n/go;	# break up long lines
+	$bytes =~ s/\n +/\n/go;
+	$bytes =~ s/(^|\n)/\1\t/go;		# format nicely
+	printf("static const u8 dtc_%d[] = {\n%s\n};\n\n", $prescaler, $bytes);
+	push(@speed_table, sprintf("\tdtc_%d, sizeof(dtc_%d), (ST7_FOSC * 2) / (1000 * %d), %d\n", $prescaler, $prescaler, $prescaler, $prescaler));
+}
+
+printf("const rlink_speed_table_t rlink_speed_table[] = {{\n%s}};\n\n", join("}, {\n", @speed_table));
+printf("const size_t rlink_speed_table_size = sizeof(rlink_speed_table) / sizeof(*rlink_speed_table);\n\n");
+
+
+sub byte_array_from_file {
+	my($filename) = @_;
+
+	my(@array, $text, $i) = ();
+
+	open(IN, '<', $filename) || die "$filename: $!";
+	undef($/);
+	$text = <IN>;
+	close(IN);
+
+	for($i = 0; $i < length($text); $i++) {
+		push(@array, ord(substr($text, $i, 1)));
+	}
+
+	@array;
+}

Added: trunk/tools/st7_dtc_as/st7_dtc_as
===================================================================
--- trunk/tools/st7_dtc_as/st7_dtc_as	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/tools/st7_dtc_as/st7_dtc_as	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,2 @@
+#!/bin/sh
+exec perl "$0.pl" $*


Property changes on: trunk/tools/st7_dtc_as/st7_dtc_as
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/tools/st7_dtc_as/st7_dtc_as.pl
===================================================================
--- trunk/tools/st7_dtc_as/st7_dtc_as.pl	2008-12-17 14:55:12 UTC (rev 1257)
+++ trunk/tools/st7_dtc_as/st7_dtc_as.pl	2008-12-19 04:25:22 UTC (rev 1258)
@@ -0,0 +1,709 @@
+#!/bin/perl
+#***************************************************************************
+#*   Copyright (C) 2008 Lou Deluxe                                         *
+#*   lou.openocd012 at fixit.nospammail.net                                   *
+#*                                                                         *
+#*   This program is free software; you can redistribute it and/or modify  *
+#*   it under the terms of the GNU General Public License as published by  *
+#*   the Free Software Foundation; either version 2 of the License, or     *
+#*   (at your option) any later version.                                   *
+#*                                                                         *
+#*   This program is distributed in the hope that it will be useful,       *
+#*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+#*   GNU General Public License for more details.                          *
+#*                                                                         *
+#*   You should have received a copy of the GNU General Public License     *
+#*   along with this program; if not, write to the                         *
+#*   Free Software Foundation, Inc.,                                       *
+#*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+#***************************************************************************
+
+# A rudimentary assembler for DTC code.
+# It is not robust, by any means, but it gets the job done.
+
+{package DTC_as;
+
+my($i);	# for later loop to generate reverse lookup
+
+sub new {
+	my($self) = bless{};
+
+	$self->{'pagewidth'} = 60;
+	$self;
+}
+
+
+
+%status_bit_arg = (
+	'STOP' => 0x01,
+	'ERROR' => 0x02,
+);
+
+%cp_arg = (
+	'A=>X' => 0x00,
+	'A<X' => 0x01,
+	'CARRY' => 0x02,
+	'ALWAYS' => 0x03,
+	'ADR_BUFFER0=>CMP0' => 0x04,
+	'ADR_BUFFER0<CMP0' => 0x05,
+	'ADR_BUFFER1=>CMP1' => 0x06,
+	'ADR_BUFFER1<CMP1' => 0x07,
+);
+
+%shift_unit_arg = (
+	'CARD' => 0x00,
+	'MPEG' => 0x08,
+);
+
+%shift_pin_arg = (
+	'PIN0=>IN' => 0x00,
+	'PIN1=>IN' => 0x04,
+	'OUT=>PIN0' => 0x01,
+	'OUT=>PIN1' => 0x03,
+);
+
+ at ld_arg = (
+	'<Y>',
+	'X',
+	'Y',
+	'MASK',
+	'ADR_BUFFER00',
+	'ADR_BUFFER01',
+	'ADR_BUFFER10',
+	'ADR_BUFFER11',
+	'CMP00',
+	'CMP01',
+	'CMP10',
+	'CMP11',
+	'DATA_FLASH',
+	'CTRL_FCI',
+	'CTRL_CARD',
+	'CTRL_MPEG',
+	'DR_PARALLEL',
+	'DDR_PARALLEL',
+	'OR_PARALLEL',
+	'DR_CARD',
+	'DDR_CARD',
+	'OR_CARD',
+	'SHIFT_CARD',
+	'DR_MPEG',
+	'DDR_MPEG',
+	'OR_MPEG',
+	'SHIFT_MPEG',
+	'DATA_BUFFER0',
+	'DATA_BUFFER1',
+	'ECC_CRC',
+	'TMP_ECC',
+	'BUFFER_MNGT'
+);
+
+for($i = 0; $i < @ld_arg; $i++) {
+	$ld_arg{$ld_arg[$i]} = $i;
+}
+
+
+# ADDER8 / SUB8
+sub alu8 {
+	my($self) = shift;
+	my($operand, $i) = shift;
+
+	if(defined($ld_arg{$operand})) {
+		$i = $ld_arg{$operand};
+
+		if($i > 0x00 && $i < 0x04) {
+			return(($i - 0x01) << 3);
+		}
+	}
+
+	return undef;
+}
+
+# ADDER16 / SUB16
+sub alu16 {
+	my($self) = shift;
+	my($operand, $i) = shift;
+
+	$operand .= '0';
+
+	if(defined($ld_arg{$operand})) {
+		$i = $ld_arg{$operand};
+
+		if($i > 0x03 && $i < 0x0c) {
+			return(($i - 0x04) << 2);
+		}
+	}
+
+	return undef;
+}
+
+
+# BSET / BCLR
+sub bsetorclr {
+	my($self) = shift;
+	my($ret);
+	
+	if(@_ < 1) {
+		return undef;
+	}
+	$ret = $_[0];
+
+	if(($ret < 0) || ($ret > 3)) {
+		return undef;
+	}
+
+	return $ret;
+}
+
+
+# Opcode lookup table
+%op = (
+	'NOP' => [
+		0x0,
+	],
+	'SEC' => [
+		0x1,
+	],
+	'CLC' => [
+		0x2,
+	],
+	'RET' => [
+		0x3,
+	],
+	'STATUS' => [
+		0x4,
+		sub {
+			my($self) = shift;
+			my($ret, $i);
+
+			for $i (@_) {
+				if(!defined($status_bit_arg{"\U$i"})) {
+					return undef;
+				}
+
+				$ret |= $status_bit_arg{"\U$i"};
+			}
+			if($ret < 1) {
+				return undef;
+			}
+
+			return $ret;
+		}
+	],
+	'CP' => [
+		0x8,
+		sub {
+			my($self) = shift;
+			if((@_ != 1) || (!defined($cp_arg{"\U$_[0]"}))) {
+				return undef;
+			}
+			return($cp_arg{"\U$_[0]"});
+		}
+	],
+	'SHIFT' => [
+		0x10,
+		sub {
+			my($self) = shift;
+			my($ret, $i);
+			
+			if((@_ < 2) || (!defined($shift_unit_arg{"\U$_[0]"}))) {
+				return undef;
+			}
+			$ret = $shift_unit_arg{"\U$_[0]"};
+			shift;
+
+			for $i (@_) {
+				if(!defined($shift_pin_arg{"\U$i"})) {
+					return undef;
+				}
+
+				$ret |= $shift_pin_arg{"\U$i"};
+			}
+
+			return $ret;
+		}
+	],
+	'SUB8' => [
+		0x24,
+		\&alu8
+	],
+	'ADDER8' => [
+		0x25,
+		\&alu8
+	],
+	'SUB16' => [
+		0x26,
+		\&alu16
+	],
+	'ADDER16' => [
+		0x27,
+		\&alu16
+	],
+	'BCLR' => [
+		0x28,
+		\&bsetorclr
+	],
+	'BSET' => [
+		0x38,
+		\&bsetorclr
+	],
+	'REVERSE' => [
+		0x30,
+	],
+	'XOR' => [
+		0x31,
+	],
+	'AND' => [
+		0x32,
+	],
+	'EXCHANGE' => [
+		0x33,
+	],
+	'DECY' => [
+		0x3c,
+	],
+	'INCY' => [
+		0x3d,
+	],
+	'JP' => [
+		0x40,
+		sub {
+			my($self) = shift;
+			my($i);
+
+			if(@_ != 1) {
+				return undef;
+			}
+			$i = $_[0];
+			if(!defined($self->{'label'}{$i})) {
+				$i =~ s/^://o;
+				if(!defined($self->{'label'}{$i})) {
+					# not a defined label
+					undef $i;
+				}
+			}
+
+			if(defined($i)) {
+				$i = $self->{'label'}{$i} - $self->{'pc'};
+			} else {
+				$i = $_[0];
+			}
+
+			if($i =~ m/^([+-]?\d+)$/) {
+				$i = 0 + $1;
+				if(($i > 31) || ($i < -31)) {
+					warn "relative jump ($i) out of range";
+					return undef;
+				}
+				if($i < 0) {
+					return(0x20 - $1);
+				} else {
+					return(0x00 + $1);
+				}
+			}
+
+			return undef;
+		}
+	],
+	'BRANCH' => [
+		0x60,
+	],
+	'LD' => [
+		0x80,
+		sub {
+			my($self) = shift;
+			my($i);
+
+#			print STDERR join(", ", LD, @_), "\n";
+
+			if(@_ == 1) {
+				$_[1] = 'A';
+			}
+			if(@_ != 2) {
+				return undef;
+			}
+
+				
+			if($_[0] =~ m/^([ML])S[BN]$/o) {
+				# MSB/LSB aka MSN/LSN
+				if($1 eq 'L') {
+					$_[0] = 'A.L';
+				} else {
+					$_[0] = 'A.H';
+				}
+			}
+			if($_[0] =~ m/^A\.([LH])$/o) {
+				# A.L/A.H
+				my($islsb) = ($1 eq 'L') ? 1 : 0;
+				$i = $_[1];
+				if($i =~ s/^0x([0-9a-fA-F])$/hex($1)/e) {
+#					print "$i looks hex\n";
+				} elsif($i =~ m/^\d+$/) {
+#					print "$i looks decimal\n";
+				} elsif(defined($self->{'label'}{$i})) {
+#					print "label match for $i ($self->{'label'}{$i})\n";
+					$i = $self->{'label'}{$i};
+#					print "\$i=$i\n";
+#					print "\$islsb=$islsb\n";
+					if($islsb) {
+						$i = ($i & 0xf);
+					} else {
+						$i = ($i >> 4) & 0xf;
+					}
+#					print "\$i=$i\n";
+				} else {
+					print "no label match for $i\n";
+					return undef;
+				}
+				if(($i < 0) || ($i > 0xf)) {
+					return undef;
+				}
+				if($islsb) {
+					$i |= 0x10;
+				};
+				return(0x20 | $i);
+			} elsif($_[0] eq 'A') {
+				if(!defined($ld_arg{$_[1]})) {
+					return undef;
+				}
+				return(0x40 | $ld_arg{$_[1]});
+			} elsif($_[1] eq 'A') {
+				if(!defined($ld_arg{$_[0]})) {
+					return undef;
+				}
+				return(0x00 | $ld_arg{$_[0]});
+			}
+
+			return undef;
+		}
+	],
+);
+
+$op{'JR'} = $op{'JP'};
+
+
+sub pass {
+	my($self, $ifh, $ofh, $passnum) = @_;
+
+	# passnum=0 for plain parsing pass to populate label values
+	# passnum=1 for actual pass to assemble
+
+	my($line, $oline, $opcd);
+
+	if($passnum == 0) {
+		delete($self->{'label'});
+		delete($self->{'binary'});
+		delete($self->{'ENTRY'});
+		delete($self->{'LUT'});
+	}
+
+	seek($ifh, 0, 0); # rewind
+	$self->{'pc'} = 0;
+	$self->{'line_number'} = 0;
+	while(defined($line = <$ifh>)) {
+		$self->{'line_number'}++;
+		$line =~ s/\s+$//so;
+		$oline = $line;
+		$line =~ s/;.*//o;
+		$line =~ s/^\s+//o;
+		@_ = split(/[\s,]+/, $line);
+
+		undef($opcd);
+
+		if(@_ > 0) {
+
+			if(
+				($_[0] =~ s/^://o)
+				||
+				($_[0] =~ s/:$//o)
+			) {
+				if($passnum == 0) {
+					if(defined($self->{'label'}{$_[0]})) {
+						die "label redefinition for \"$_[0]\" in line $self->{'line_number'}";
+					}
+					$self->{'label'}{$_[0]} = $self->{'pc'};
+				}
+				shift(@_);
+			}
+
+			if(@_ > 0) {
+				if($passnum == 1) {
+					if((@_ == 3) && ($_[1] eq '=')) {
+						# convert this = that to LD 
+						$_[1] = $_[0];
+						$_[0] = 'LD';
+					}
+					elsif((@_ == 3) && ($_[1] eq '+=')) {
+						# convert this += that to ADDER8 or ADDER16
+						if($_[0] eq 'A') {
+							@_ = ('ADDER8', $_[2]);
+						}
+						elsif($_[2] eq 'X') {
+							@_ = ('ADDER16', $_[0]);
+						}
+					}
+					elsif((@_ == 3) && ($_[1] eq '-=')) {
+						# convert this -= that to ADDER8 or ADDER16
+						if($_[0] eq 'A') {
+							@_ = ('SUB8', $_[2]);
+						}
+						elsif($_[2] eq 'X') {
+							@_ = ('SUB16', $_[0]);
+						}
+					}
+					elsif((@_ == 1) && ($_[0] =~ m/^(B((SET)|(CLR)))([1-4])$/oi)) {
+						# convert BSETn or BCLRn to BSET n-1 or BCLR n-1
+						$_[0] = $1;
+						$_[1] = $5 - 1;
+					}
+
+					$op = "\U$_[0]";
+					if(!defined($op{$op})) {
+						die "unknown instruction: $op in line $self->{'line_number'}";
+					}
+					shift(@_);
+
+					$op = $op{$op};
+					$sub = $op->[1];
+					if(defined($sub)) {
+						$opcd = &$sub($self, @_);
+					} else {
+						$opcd = 0;
+					}
+
+					if(!defined($opcd)) {
+						die "bad argument(s) in line $self->{'line_number'}";
+					}
+
+					$opcd |= $op->[0];
+				}
+
+				$self->{'pc'}++;
+			}
+
+		} else {
+			if($passnum == 0) {
+				if($oline =~ m/^;LUT; (.*)/o) {
+					my($entry, $label) = split(/\s+/, $1);
+					$entry =~ s/^0x//o;
+					$self->{'LUT'}[hex($entry)] = $label;
+				}
+				if($oline =~ m/^;ENTRY; (.*)/o) {
+					my($id, $label) = split(/\s+/, $1);
+					$self->{'ENTRY'}{$id} = $label;
+				}
+			}
+		}
+
+		if($passnum == 1) {
+			if(defined($opcd)) {
+				$self->{'binary'} .= chr($opcd);
+
+				printf $ofh ("/* 0x%02x */ 0x%02x%s /* %-*s */\n",
+					$self->{'pc'} - 1,
+					$opcd,
+					(
+						(
+							($self->{'last pc'} < 0xff)
+							|| 
+							($self->{'last pc'} != $self->{'pc'} - 1)
+						) ?
+							','
+						:
+							''
+					),
+					$self->{'pagewidth'} - 23,
+					$oline
+				);
+			} else {
+				if($oline ne '') {
+					print $ofh "                 /* $oline */\n";
+				} else {
+					print $ofh "\n";
+				}
+			}
+		}
+	}
+
+	if($passnum == 0) {
+		$self->{'last pc'} = $self->{'pc'} - 1;
+	}
+
+	if($passnum == 1) {
+		while($self->{'pc'} < 0xff) {
+			printf $ofh ("/* 0x%02x */ 0,\n",
+				$self->{'pc'}
+			);
+			$self->{'pc'}++;
+		}
+		if($self->{'pc'} < 0x100) {
+			printf $ofh ("/* 0x%02x */ 0\n",
+				$self->{'pc'}
+			);
+			$self->{'pc'}++;
+		}
+	}
+}
+
+} # package DTC_as
+
+
+use Getopt::Std;
+
+%opt = (
+	't' => 'unsigned char',
+);
+
+# -t type of arrays (defaults to unsigned char)
+# -l lookup table array name (no table generated if not provided)
+# -d DTC code array name (naked elements if not provided)
+# -i input filename (trailing argument if not provided)
+# -o output filename (stdout if not provided)
+getopts('l:d:i:o:t:b', \%opt);
+
+if(defined($opt{'i'})) {
+	$infile = $opt{'i'};
+} else {
+	$infile = shift;
+}
+
+if(!open(IN, '<', $infile)) {
+	die "$infile: $!";
+}
+
+
+if($opt{'b'}) {
+	if(!defined($opt{'o'})) {
+		die "binary format requires -o";
+	}
+	if(!open(OUT, '>&', *STDOUT)) {
+		die "dup stdout: $!";
+	}
+	open(STDOUT, '>&', *STDERR);
+} else {
+	if(defined($opt{'o'})) {
+		if(!open(OUT, '>', $opt{'o'})) {
+			die "$opt{'o'}: $!";
+		}
+	} else {
+		if(!open(OUT, '>&', *STDOUT)) {
+			die "dup stdout: $!";
+		}
+		open(STDOUT, '>&', *STDERR);
+	}
+}
+	
+
+$as = new DTC_as;
+
+$as->pass(*IN, *OUT, 0);
+
+if(defined($opt{'d'})) {
+	print OUT "$opt{'t'} $opt{'d'}", "[0x100] = {\n";
+}
+$as->pass(*IN, *OUT, 1);
+if(defined($opt{'d'})) {
+	print OUT "};\n\n";
+}
+
+close(IN);
+
+if(defined($opt{'l'})) {
+	print OUT "$opt{'t'} $opt{'l'}", "[0x40] = {\n";
+#	$end = @{$as->{'LUT'}};
+#	if($end > 0x100) {
+#		$end = 0x100;
+#	}
+	for($i = 0xc0; $i < 0x100; $i++) {
+		$label = $as->{'LUT'}[$i];
+		if(defined($label)) {
+			if(defined($as->{'label'}{$label})) {
+				printf OUT ("/* 0x%02x */ 0x%02x%s /* %s */\n",
+					$i,
+					$as->{'label'}{$label},
+					(($i < 0xff) ? ',' : ''),
+					$label
+				);
+			} else {
+				die "label $label has not been defined";
+			}
+		} else {
+			printf OUT ("/* 0x%02x */ 0%s\n",
+				$i,
+				(($i < 0xff) ? ',' : ''),
+			);
+		}
+	}
+	print OUT "};\n\n";
+}
+
+
+close(OUT);
+
+sub DTCLOAD_COMMENT { 0; }
+sub DTCLOAD_ENTRY { 1; }
+sub DTCLOAD_LOAD { 2; }
+sub DTCLOAD_RUN { 3; }
+sub DTCLOAD_LUT_START { 4; }
+sub DTCLOAD_LUT { 5; }
+
+
+if($opt{'b'}) {
+	open(OUT, ">", $opt{'o'}) || die "$opt{'o'}: $!";
+	syswrite(OUT, pack('CC', DTCLOAD_LUT_COMMENT, 3 - 1) . 'DTC');
+	
+	$ref = $as->{'LUT'};
+	if(@$ref > 0) {
+		for($start = 0; $start < @$ref && !defined($ref->[$start]); $start++) {}
+		for($end = 0xff; $end >= $start && !defined($ref->[$end]); $end--) {}
+		undef($lut);
+		for($i = $start; $i <= $end; $i++) {
+			if(!defined($ref->[$i])) {
+				$lut .= "\0";
+				next;
+			}
+			$label = $ref->[$i];
+			if(defined($as->{'label'}{$label})) {
+				$label = $as->{'label'}{$label};
+#				printf("adding LUT entry 0x%02x\n", $label);
+				$lut .= chr($label);
+			} else {
+				die "label $label has not been defined";
+			}
+		}
+		if(length($lut) > 0) {
+			syswrite(OUT, pack('CCC', DTCLOAD_LUT_START, 1 - 1, $start));
+			syswrite(OUT, pack('CC', DTCLOAD_LUT, length($lut) - 1) . $lut);
+		}
+	}
+
+	while(($key, $label) = each(%{$as->{'ENTRY'}})) {
+#		print "$key = $label\n";
+		if(defined($as->{'label'}{$label})) {
+			$label = $as->{'label'}{$label};
+#			print "key=$key\n";
+#			print "label=$label\n";
+			syswrite(OUT, pack('CCC', DTCLOAD_ENTRY, length($key), $label) . $key);
+		} else {
+			die "label $label has not been defined";
+		}
+	}
+
+	if(length($as->{'binary'})) {
+#		printf("DTC code size: 0x%x\n", length($as->{'binary'}));
+		syswrite(OUT, pack('CC',
+			DTCLOAD_LOAD ,
+			length($as->{'binary'}) - 1
+		) . $as->{'binary'});
+
+		if(%{$as->{'ENTRY'}} < 1) {
+			syswrite(OUT, pack('CCC', DTCLOAD_RUN, 1 - 1, 0x00));
+		}
+	}
+
+	close(OUT);
+}
+
+
+0;
+



From oharboe at mail.berlios.de  Fri Dec 19 07:49:36 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 19 Dec 2008 07:49:36 +0100
Subject: [Openocd-svn] r1259 - trunk/src/helper
Message-ID: <200812190649.mBJ6na9M006644@sheep.berlios.de>

Author: oharboe
Date: 2008-12-19 07:49:34 +0100 (Fri, 19 Dec 2008)
New Revision: 1259

Modified:
   trunk/src/helper/types.h
Log:
Dick Hollenbeck <dick at softplc.com> convert macros to inline fn's.

Modified: trunk/src/helper/types.h
===================================================================
--- trunk/src/helper/types.h	2008-12-19 04:25:22 UTC (rev 1258)
+++ trunk/src/helper/types.h	2008-12-19 06:49:34 UTC (rev 1259)
@@ -45,37 +45,68 @@
 
 typedef struct jtag_tap_s jtag_tap_t;
 
-/* DANGER!!!! here be dragons! Note that the pointer in 
- * memory might be unaligned. On some CPU's, i.e. ARM7,
- * the 2 lsb are ignored for 32 bit access, on others
- * it will cause an exception and on e.g. x86, it works
- * the same as if aligned.
+
+/* DANGER!!!! here be dragons! 
+ * 
+ * Leave these fn's as byte accesses because it is safe
+ * across architectures. Clever usage of 32 bit access
+ * will create problems on some hosts.
+ * 
+ * Note that the pointer in memory might be unaligned. 
+ * 
+ * On some CPU's, i.e. ARM7, the 2 lsb are ignored for 32 
+ * bit access, on others it will cause an exception and 
+ * on e.g. x86, it works the same as if aligned.
+ * 
  */
-#define le_to_h_u32(x) ((u32)((x)[0] | (x)[1] << 8 | (x)[2] << 16 | (x)[3] << 24))
-#define le_to_h_u16(x) ((u16)((x)[0] | (x)[1] << 8))
-#define be_to_h_u32(x) ((u32)((x)[3] | (x)[2] << 8 | (x)[1] << 16 | (x)[0] << 24))
-#define be_to_h_u16(x) ((u16)((x)[1] | (x)[0] << 8))
 
-#define h_u32_to_le(buf, val) do {\
-	(buf)[3] = ((val) & 0xff000000) >> 24;\
-	(buf)[2] = ((val) & 0x00ff0000) >> 16;\
-	(buf)[1] = ((val) & 0x0000ff00) >> 8;\
-	(buf)[0] = ((val) & 0x000000ff);\
-} while (0)
-#define h_u32_to_be(buf, val) do {\
-	(buf)[0] = ((val) & 0xff000000) >> 24;\
-	(buf)[1] = ((val) & 0x00ff0000) >> 16;\
-	(buf)[2] = ((val) & 0x0000ff00) >> 8;\
-	(buf)[3] = ((val) & 0x000000ff);\
-} while (0)
 
-#define h_u16_to_le(buf, val) do {\
-	(buf)[1] = ((val) & 0xff00) >> 8;\
-	(buf)[0] = ((val) & 0x00ff) >> 0;\
-} while (0)
-#define h_u16_to_be(buf, val) do {\
-	(buf)[0] = ((val) & 0xff00) >> 8;\
-	(buf)[1] = ((val) & 0x00ff) >> 0;\
-} while (0)
+static inline u32 le_to_h_u32(const u8* buf)
+{
+	return (u32)(buf[0] | buf[1] << 8 | buf[2] << 16 | buf[3] << 24);
+}
 
+static inline u16 le_to_h_u16(const u8* buf)
+{
+	return (u16)(buf[0] | buf[1] << 8);
+}
+
+static inline u32 be_to_h_u32(const u8* buf)
+{
+	return (u32)(buf[3] | buf[2] << 8 | buf[1] << 16 | buf[0] << 24);
+}
+
+static inline u16 be_to_h_u16(const u8* buf)
+{
+	return (u16)(buf[1] | buf[0] << 8);
+}
+
+static inline void h_u32_to_le(u8* buf, int val)
+{
+	buf[3] = (u8) (val >> 24);
+	buf[2] = (u8) (val >> 16);
+	buf[1] = (u8) (val >> 8);
+	buf[0] = (u8) (val >> 0);
+}
+
+static inline void h_u32_to_be(u8* buf, int val)
+{
+	buf[0] = (u8) (val >> 24);
+	buf[1] = (u8) (val >> 16);
+	buf[2] = (u8) (val >> 8);
+	buf[3] = (u8) (val >> 0);
+}
+
+static inline void h_u16_to_le(u8* buf, int val)
+{
+	buf[1] = (u8) (val >> 8);
+	buf[0] = (u8) (val >> 0);
+}
+
+static inline void h_u16_to_be(u8* buf, int val)
+{
+	buf[0] = (u8) (val >> 8);
+	buf[1] = (u8) (val >> 0);
+}
+
 #endif /* TYPES_H */



From ntfreak at mail.berlios.de  Fri Dec 19 14:58:16 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Fri, 19 Dec 2008 14:58:16 +0100
Subject: [Openocd-svn] r1260 - in trunk: src/helper src/jtag/rlink
	src/server src/target/interface tools/rlink_make_speed_table
	tools/st7_dtc_as
Message-ID: <200812191358.mBJDwGDT023173@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-19 14:58:15 +0100 (Fri, 19 Dec 2008)
New Revision: 1260

Added:
   trunk/src/target/interface/rlink.cfg
Modified:
   trunk/src/helper/replacements.h
   trunk/src/jtag/rlink/call.m4
   trunk/src/jtag/rlink/init.m4
   trunk/src/jtag/rlink/rlink.c
   trunk/src/server/httpd.c
   trunk/tools/rlink_make_speed_table/rlink_make_speed_table
   trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl
   trunk/tools/st7_dtc_as/st7_dtc_as
   trunk/tools/st7_dtc_as/st7_dtc_as.pl
Log:
- fix rlink build under native win32 (mingw)
- remove rlink build warnings
- add usb_set_configuration to rlink_init, win32 requires this
- add win32 ETIMEDOUT define

Modified: trunk/src/helper/replacements.h
===================================================================
--- trunk/src/helper/replacements.h	2008-12-19 06:49:34 UTC (rev 1259)
+++ trunk/src/helper/replacements.h	2008-12-19 13:58:15 UTC (rev 1260)
@@ -84,7 +84,6 @@
 /* gettimeofday() */
 #ifndef HAVE_GETTIMEOFDAY
 
-
 #ifdef _WIN32
 struct timezone {
 	int tz_minuteswest;
@@ -161,6 +160,12 @@
 #include <windows.h>
 #include <time.h>
 
+/* win32 systems do not support ETIMEDOUT */
+
+#ifndef ETIMEDOUT
+#define ETIMEDOUT WSAETIMEDOUT
+#endif
+
 #if IS_MINGW == 1
 static __inline unsigned char inb(unsigned short int port)
 {


Property changes on: trunk/src/jtag/rlink/call.m4
___________________________________________________________________
Name: svn:eol-style
   + LF

Modified: trunk/src/jtag/rlink/init.m4
===================================================================
--- trunk/src/jtag/rlink/init.m4	2008-12-19 06:49:34 UTC (rev 1259)
+++ trunk/src/jtag/rlink/init.m4	2008-12-19 13:58:15 UTC (rev 1260)
@@ -1,74 +1,74 @@
-m4_divert(`-1')
-/***************************************************************************
- *   Copyright (C) 2008 Lou Deluxe                                         *
- *   lou.openocd012 at fixit.nospammail.net                                   *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-m4_undefine(`CTRL_MPEG_L')
-m4_undefine(`CTRL_CARD_L')
-
-m4_ifelse(SHIFTER_PRESCALER, 1, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x0')')
-')
-m4_ifelse(SHIFTER_PRESCALER, 2, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x2')')
-	m4_define(`CTRL_CARD_L', `m4_eval(`0x8 | 0x1')')
-')
-m4_ifelse(SHIFTER_PRESCALER, 8, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x3')')
-')
-m4_ifelse(SHIFTER_PRESCALER, 11, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x4')')
-')
-m4_ifelse(SHIFTER_PRESCALER, 64, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x7')')
-')
-
-m4_ifdef(`CTRL_MPEG_L',,`
-	m4_errprint(`SHIFTER_PRESCALER was not defined with a supported value
-')	m4_m4exit(`1')
-')
-
-m4_divert(`0')m4_dnl
-
-init:
-	A.H = 0
-
-	A.L = 0
-
-	DR_MPEG = A	; TDI and TCK start out low
-	DR_CARD = A	; TMS starts out low
-
-	A.L = 0x6
-
-	CTRL_FCI = A	; MPEG and CARD driven by FCI
-	DDR_MPEG = A	; TDI and TCK are outputs
-
-	A.L = 0x1
-
-	X = A		; X == 1
-	DDR_CARD = A	; TMS is output
-
-	A.L = CTRL_MPEG_L
-	CTRL_MPEG = A
-m4_ifdef(`CTRL_CARD_L',
-`	A.L = 'CTRL_CARD_L`
-')m4_dnl
-	CTRL_CARD = A
-
-	STATUS STOP
+m4_divert(`-1')
+/***************************************************************************
+ *   Copyright (C) 2008 Lou Deluxe                                         *
+ *   lou.openocd012 at fixit.nospammail.net                                   *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+m4_undefine(`CTRL_MPEG_L')
+m4_undefine(`CTRL_CARD_L')
+
+m4_ifelse(SHIFTER_PRESCALER, 1, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x0')')
+')
+m4_ifelse(SHIFTER_PRESCALER, 2, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x2')')
+	m4_define(`CTRL_CARD_L', `m4_eval(`0x8 | 0x1')')
+')
+m4_ifelse(SHIFTER_PRESCALER, 8, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x3')')
+')
+m4_ifelse(SHIFTER_PRESCALER, 11, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x4')')
+')
+m4_ifelse(SHIFTER_PRESCALER, 64, `
+	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x7')')
+')
+
+m4_ifdef(`CTRL_MPEG_L',,`
+	m4_errprint(`SHIFTER_PRESCALER was not defined with a supported value
+')	m4_m4exit(`1')
+')
+
+m4_divert(`0')m4_dnl
+
+init:
+	A.H = 0
+
+	A.L = 0
+
+	DR_MPEG = A	; TDI and TCK start out low
+	DR_CARD = A	; TMS starts out low
+
+	A.L = 0x6
+
+	CTRL_FCI = A	; MPEG and CARD driven by FCI
+	DDR_MPEG = A	; TDI and TCK are outputs
+
+	A.L = 0x1
+
+	X = A		; X == 1
+	DDR_CARD = A	; TMS is output
+
+	A.L = CTRL_MPEG_L
+	CTRL_MPEG = A
+m4_ifdef(`CTRL_CARD_L',
+`	A.L = 'CTRL_CARD_L`
+')m4_dnl
+	CTRL_CARD = A
+
+	STATUS STOP


Property changes on: trunk/src/jtag/rlink/init.m4
___________________________________________________________________
Name: svn:eol-style
   + LF

Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2008-12-19 06:49:34 UTC (rev 1259)
+++ trunk/src/jtag/rlink/rlink.c	2008-12-19 13:58:15 UTC (rev 1260)
@@ -31,6 +31,7 @@
 #include <errno.h>
 #include <string.h>
 #include <usb.h>
+#include <stdint.h>
 
 /* project specific includes */
 #include "log.h"
@@ -1034,7 +1035,6 @@
 	int			tdi_bit_offset;
 	u8			tdi_mask, *tdi_p;
 	u8			dtc_mask;
-	dtc_reply_queue_entry_t	*rq_entry;
 
 	if(scan_size < 1) {
 		LOG_ERROR("scan_size cannot be less than 1 bit\n");
@@ -1555,7 +1555,7 @@
 {
 	struct usb_bus *busses;
 	struct usb_bus *bus;
-	int c, i, a, j, retries,len;
+	int i, j, retries;
 	int found=0;
 	int success=0;
 	u8 reply_buffer[USB_EP1IN_SIZE];
@@ -1597,6 +1597,9 @@
 					{
 						LOG_DEBUG("Opened device, pHDev = %p\n",pHDev);
 
+						/* usb_set_configuration required under win32 */
+						usb_set_configuration(pHDev, dev->config[0].bConfigurationValue);
+						
 						retries = 3;
 						do
 						{

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2008-12-19 06:49:34 UTC (rev 1259)
+++ trunk/src/server/httpd.c	2008-12-19 13:58:15 UTC (rev 1260)
@@ -1,457 +1,457 @@
-/***************************************************************************
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
- *   oyvind.harboe at zylin.com                                               *
- *                                                                         *
- *   Copyright (C) 2008 Free Software Foundation
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-/* some bits were copied from ahttpd which is under eCos license and
- * copyright to FSF
- */
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
-#include "replacements.h"
-
-#include "server.h"
-
-#include "log.h"
-#include "telnet_server.h"
-#include "target.h"
-
-#include <command.h>
-#include <string.h>
-#include <stdlib.h>
-#include <errno.h>
-#include <unistd.h>
-#include <sys/types.h>
-#include <fcntl.h>
-#include <signal.h>
-
-#include <sys/types.h>
-#include <sys/select.h>
-#include <sys/socket.h>
-#include <microhttpd.h>
-#include <stdlib.h>
-#include <string.h>
-#include <stdio.h>
-
-#define PAGE_NOT_FOUND "<html><head><title>File not found</title></head><body>File not found</body></html>"
-
-static const char *appendf(const *prev, const char *format, ...)
-{
-	va_list ap;
-	va_start(ap, format);
-	char *string = alloc_vprintf(format, ap);
-	va_end(ap);
-	char *string2 = NULL;
-
-	if (string != NULL)
-	{
-		string2 = alloc_printf("%s%s", (prev == NULL) ? "" : prev, string);
-	}
-
-	if (prev != NULL)
-	{
-		free(prev);
-	}
-
-	if (string == NULL)
-		free(string);
-
-	return string2;
-}
-
-static const char *httpd_exec_cgi_tcl_error(Jim_Interp *interp)
-{
-	int len, i;
-
-	const char *t = NULL;
-	t = appendf(t, "<html><body>\n");
-
-	t = appendf(t, "Runtime error, file \"%s\", line %d:<br>",
-			interp->errorFileName, interp->errorLine);
-	t = appendf(t, "    %s<br>", Jim_GetString(interp->result, NULL));
-	Jim_ListLength(interp, interp->stackTrace, &len);
-	for (i = 0; i < len; i += 3)
-	{
-		Jim_Obj *objPtr;
-		const char *proc, *file, *line;
-
-		Jim_ListIndex(interp, interp->stackTrace, i, &objPtr, JIM_NONE);
-		proc = Jim_GetString(objPtr, NULL);
-		Jim_ListIndex(interp, interp->stackTrace, i + 1, &objPtr, JIM_NONE);
-		file = Jim_GetString(objPtr, NULL);
-		Jim_ListIndex(interp, interp->stackTrace, i + 2, &objPtr, JIM_NONE);
-		line = Jim_GetString(objPtr, NULL);
-		t = appendf(t, "In procedure '%s' called at file \"%s\", line %s<br>",
-				proc, file, line);
-	}
-	t = appendf(t, "</html></body>\n");
-
-	return t;
-}
-
-static int httpd_Jim_Command_writeform(Jim_Interp *interp, int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 3)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, "method ?args ...?");
-		return JIM_ERR;
-	}
-	char *name = (char*) Jim_GetString(argv[1], NULL);
-	char *file = (char*) Jim_GetString(argv[2], NULL);
-
-	// Find length
-	char *data;
-	int actual;
-
-	int retcode;
-
-	const char *script = alloc_printf("set dummy_val $httppostdata(%s); set dummy_val",
-			name);
-	retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
-	free((void *) script);
-	if (retcode != JIM_OK)
-		return retcode;
-
-	data = Jim_GetString(Jim_GetResult(interp), &actual);
-
-	FILE *f;
-	f = fopen(file, "wb");
-	if (f != NULL)
-	{
-		int ok;
-		ok = fwrite(data, 1, actual, f) == actual;
-		fclose(f);
-
-		if (!ok)
-		{
-			Jim_SetResultString(interp, "Could not write to file", -1);
-			return JIM_ERR;
-		}
-	}
-	else
-	{
-		Jim_SetResultString(interp, "Could not create file", -1);
-		return JIM_ERR;
-	}
-	return JIM_OK;
-}
-
-
-int
-httpd_Jim_Command_formfetch(Jim_Interp *interp,
-                                   int argc,
-                                   Jim_Obj *const *argv)
-{
-    if (argc!=2)
-    {
-        Jim_WrongNumArgs(interp, 1, argv, "method ?args ...?");
-        return JIM_ERR;
-    }
-    char *name = (char*)Jim_GetString(argv[1], NULL);
-
-
-    const char *script = alloc_printf("set dummy_val $httppostdata(%s); set dummy_val",
-    			name);
-    	int retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
-    	free((void *) script);
-    	if (retcode != JIM_OK)
-    	{
-    	    Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-    	} else
-    	{
-    	    Jim_SetResult(interp, Jim_GetResult(interp));
-    	}
-
-    return JIM_OK;
-}
-
-struct httpd_request
-{
-	int post;
-	struct MHD_PostProcessor *postprocessor;
-
-	//Jim_Obj *dict;
-
-	int complete; /* did we receive the entire post ? */
-
-};
-
-static void request_completed(void *cls, struct MHD_Connection *connection,
-		void **con_cls, enum MHD_RequestTerminationCode toe)
-{
-	struct httpd_request *r = (struct httpd_request*) *con_cls;
-
-	if (NULL == r)
-		return;
-
-	if (r->postprocessor)
-	{
-		MHD_destroy_post_processor(r->postprocessor);
-	}
-
-	free(r);
-	*con_cls = NULL;
-}
-
-/* append to said key in dictonary */
-static void append_key(struct httpd_request *r, const char *key,
-		const char *data, size_t off, size_t size)
-{
-	Jim_Obj *keyObj = Jim_NewStringObj(interp, key, -1);
-	Jim_Obj *value = NULL;
-
-	Jim_Obj *dict = Jim_GetVariableStr(interp, "httppostdata", 0);
-
-	if (dict!=NULL)
-	{
-		if (Jim_DictKey(interp, dict, keyObj, &value, 0) != JIM_OK)
-		{
-			 value = NULL;
-		}
-	}
-	if (value == NULL)
-		value = Jim_NewStringObj(interp, "", -1);
-
-	/* create a new object we append to and insert into this location */
-	Jim_Obj *newObj = Jim_NewStringObj(interp, "", -1);
-	Jim_AppendObj(interp, newObj, value);
-	Jim_AppendString(interp, newObj, data, size);
-	/* uhh... use name here of dictionary */
-	Jim_SetDictKeysVector(interp, Jim_NewStringObj(interp, "httppostdata", -1), &keyObj, 1, newObj);
-}
-
-/* append data to each key */
-static int iterate_post(void *con_cls, enum MHD_ValueKind kind,
-		const char *key, const char *filename, const char *content_type,
-		const char *transfer_encoding, const char *data, size_t off,
-		size_t size)
-{
-	struct httpd_request *r = (struct httpd_request*) con_cls;
-
-	append_key(r, key, data, off, size);
-
-	return MHD_YES;
-}
-
-static int record_arg(void *cls, enum MHD_ValueKind kind, const char *key,
-		const char *value)
-{
-	struct httpd_request *r = (struct httpd_request*) cls;
-	append_key(r, key, value, 0, strlen(value));
-	return MHD_YES;
-}
-
-static int ahc_echo(void * cls, struct MHD_Connection * connection,
-		const char * url, const char * method, const char * version,
-		const char * upload_data, unsigned int * upload_data_size, void ** ptr)
-{
-	struct MHD_Response * response;
-	int ret;
-
-	int post = 0;
-
-	if (0 == strcmp(method, "POST"))
-	{
-		post = 1;
-	}
-	else if (0 == strcmp(method, "GET"))
-	{
-	}
-	else
-	{
-		return MHD_NO; /* unexpected method */
-	}
-
-	struct httpd_request *r;
-	if (*ptr == NULL)
-	{
-		/* The first time only the headers are valid,
-		 do not respond in the first round... */
-
-		*ptr = malloc(sizeof(struct httpd_request));
-		if (*ptr == NULL)
-			return MHD_NO;
-		memset(*ptr, 0, sizeof(struct httpd_request));
-
-		r = (struct httpd_request *) *ptr;
-
-		r->post = post;
-		Jim_SetVariableStr(interp, "httppostdata", Jim_NewDictObj(interp, NULL, 0));
-
-		/* fill in url query strings in dictonary */
-		MHD_get_connection_values(connection, MHD_GET_ARGUMENT_KIND,
-				record_arg, r);
-
-		if (r->post)
-		{
-			r->postprocessor = MHD_create_post_processor(connection, 2048
-					* 1024, iterate_post, r);
-		}
-
-		return MHD_YES;
-	}
-
-	r = (struct httpd_request *) *ptr;
-
-	if (r->post)
-	{
-		/* consume post data */
-		if (*upload_data_size)
-		{
-			MHD_post_process(r->postprocessor, upload_data, *upload_data_size);
-			*upload_data_size = 0;
-			return MHD_YES;
-		}
-		else
-		{
-		}
-	} else
-	{
-	}
-
-	/* hand over to request who will be using it. */
-	//	r->dict = NULL;
-
-
-	/* FIX!!!! we need more advanced handling of url's to avoid them
-	 * being subverted to evil purposes
-	 */
-
-	url++; /* skip '/' */
-
-	const char *suffix;
-	suffix = strrchr(url, '.');
-	if ((suffix != NULL) && (strcmp(suffix, ".tcl") == 0))
-	{
-		printf("Run tcl %s\n", url);
-
-		int retcode;
-
-		const char *script = alloc_printf(
-				"global httpdata; source {%s}; set httpdata", url);
-		retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
-		free((void *) script);
-
-		if (retcode == JIM_ERR)
-		{
-			printf("Tcl failed\n");
-			const char *t = httpd_exec_cgi_tcl_error(interp);
-			if (t == NULL)
-				return MHD_NO;
-
-			response = MHD_create_response_from_data(strlen(t), (void *) t,
-					MHD_YES, MHD_NO);
-			ret = MHD_queue_response(connection,
-					MHD_HTTP_INTERNAL_SERVER_ERROR, response);
-			MHD_destroy_response(response);
-			return ret;
-		}
-		else
-		{
-			printf("Tcl OK\n");
-			/* FIX!!! how to handle mime types??? */
-			const char *result;
-			int reslen;
-			result = Jim_GetString(Jim_GetResult(interp), &reslen);
-
-			response = MHD_create_response_from_data(reslen, (void *) result,
-					MHD_NO, MHD_YES);
-			ret = MHD_queue_response(connection,
-					MHD_HTTP_INTERNAL_SERVER_ERROR, response);
-			MHD_destroy_response(response);
-			return ret;
-		}
-	}
-	else
-	{
-		void *data;
-		int len;
-
-		int retval = loadFile(url, &data, &len);
-		if (retval != ERROR_OK)
-		{
-			printf("Did not find %s\n", url);
-
-			response = MHD_create_response_from_data(strlen(PAGE_NOT_FOUND),
-					(void *) PAGE_NOT_FOUND, MHD_NO, MHD_NO);
-			ret = MHD_queue_response(connection, MHD_HTTP_NOT_FOUND, response);
-			MHD_destroy_response(response);
-			return ret;
-		}
-
-		printf("Serving %s length=%d\n", url, len);
-		/* serve file directly */
-		response = MHD_create_response_from_data(len, data, MHD_YES, MHD_NO);
-		MHD_add_response_header(response, "Content-Type", "image/png");
-
-		ret = MHD_queue_response(connection, MHD_HTTP_OK, response);
-		MHD_destroy_response(response);
-
-		//free(data);
-		return ret;
-	}
-}
-
-static struct MHD_Daemon * d;
-
-int httpd_start(void)
-{
-
-	int port = 8888;
-	LOG_USER("Launching httpd server on port %d", port);
-	d = MHD_start_daemon(MHD_USE_SELECT_INTERNALLY, port, NULL, NULL,
-			&ahc_echo, NULL, /* could be data for handler, but we only have a single handler, use global variables instead */
-			MHD_OPTION_NOTIFY_COMPLETED, request_completed, NULL, /* Closure... what's that??? */
-			MHD_OPTION_END);
-	if (d == NULL)
-		return ERROR_FAIL;
-
-	Jim_CreateCommand(interp,
-						  "formfetch",
-						  httpd_Jim_Command_formfetch,
-						  NULL,
-						  NULL);
-
-    Jim_CreateCommand(interp,
-                      "writeform",
-                      httpd_Jim_Command_writeform,
-                      NULL,
-                      NULL);
-
-
-	return ERROR_OK;
-}
-
-void httpd_stop(void)
-{
-	MHD_stop_daemon(d);
-}
-
-void openocd_sleep_prelude(void)
-{
-}
-
-void openocd_sleep_postlude(void)
-{
-}
-
+/***************************************************************************
+ *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   oyvind.harboe at zylin.com                                               *
+ *                                                                         *
+ *   Copyright (C) 2008 Free Software Foundation
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+/* some bits were copied from ahttpd which is under eCos license and
+ * copyright to FSF
+ */
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "replacements.h"
+
+#include "server.h"
+
+#include "log.h"
+#include "telnet_server.h"
+#include "target.h"
+
+#include <command.h>
+#include <string.h>
+#include <stdlib.h>
+#include <errno.h>
+#include <unistd.h>
+#include <sys/types.h>
+#include <fcntl.h>
+#include <signal.h>
+
+#include <sys/types.h>
+#include <sys/select.h>
+#include <sys/socket.h>
+#include <microhttpd.h>
+#include <stdlib.h>
+#include <string.h>
+#include <stdio.h>
+
+#define PAGE_NOT_FOUND "<html><head><title>File not found</title></head><body>File not found</body></html>"
+
+static const char *appendf(const *prev, const char *format, ...)
+{
+	va_list ap;
+	va_start(ap, format);
+	char *string = alloc_vprintf(format, ap);
+	va_end(ap);
+	char *string2 = NULL;
+
+	if (string != NULL)
+	{
+		string2 = alloc_printf("%s%s", (prev == NULL) ? "" : prev, string);
+	}
+
+	if (prev != NULL)
+	{
+		free(prev);
+	}
+
+	if (string == NULL)
+		free(string);
+
+	return string2;
+}
+
+static const char *httpd_exec_cgi_tcl_error(Jim_Interp *interp)
+{
+	int len, i;
+
+	const char *t = NULL;
+	t = appendf(t, "<html><body>\n");
+
+	t = appendf(t, "Runtime error, file \"%s\", line %d:<br>",
+			interp->errorFileName, interp->errorLine);
+	t = appendf(t, "    %s<br>", Jim_GetString(interp->result, NULL));
+	Jim_ListLength(interp, interp->stackTrace, &len);
+	for (i = 0; i < len; i += 3)
+	{
+		Jim_Obj *objPtr;
+		const char *proc, *file, *line;
+
+		Jim_ListIndex(interp, interp->stackTrace, i, &objPtr, JIM_NONE);
+		proc = Jim_GetString(objPtr, NULL);
+		Jim_ListIndex(interp, interp->stackTrace, i + 1, &objPtr, JIM_NONE);
+		file = Jim_GetString(objPtr, NULL);
+		Jim_ListIndex(interp, interp->stackTrace, i + 2, &objPtr, JIM_NONE);
+		line = Jim_GetString(objPtr, NULL);
+		t = appendf(t, "In procedure '%s' called at file \"%s\", line %s<br>",
+				proc, file, line);
+	}
+	t = appendf(t, "</html></body>\n");
+
+	return t;
+}
+
+static int httpd_Jim_Command_writeform(Jim_Interp *interp, int argc,
+		Jim_Obj * const *argv)
+{
+	if (argc != 3)
+	{
+		Jim_WrongNumArgs(interp, 1, argv, "method ?args ...?");
+		return JIM_ERR;
+	}
+	char *name = (char*) Jim_GetString(argv[1], NULL);
+	char *file = (char*) Jim_GetString(argv[2], NULL);
+
+	// Find length
+	char *data;
+	int actual;
+
+	int retcode;
+
+	const char *script = alloc_printf("set dummy_val $httppostdata(%s); set dummy_val",
+			name);
+	retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
+	free((void *) script);
+	if (retcode != JIM_OK)
+		return retcode;
+
+	data = Jim_GetString(Jim_GetResult(interp), &actual);
+
+	FILE *f;
+	f = fopen(file, "wb");
+	if (f != NULL)
+	{
+		int ok;
+		ok = fwrite(data, 1, actual, f) == actual;
+		fclose(f);
+
+		if (!ok)
+		{
+			Jim_SetResultString(interp, "Could not write to file", -1);
+			return JIM_ERR;
+		}
+	}
+	else
+	{
+		Jim_SetResultString(interp, "Could not create file", -1);
+		return JIM_ERR;
+	}
+	return JIM_OK;
+}
+
+
+int
+httpd_Jim_Command_formfetch(Jim_Interp *interp,
+                                   int argc,
+                                   Jim_Obj *const *argv)
+{
+    if (argc!=2)
+    {
+        Jim_WrongNumArgs(interp, 1, argv, "method ?args ...?");
+        return JIM_ERR;
+    }
+    char *name = (char*)Jim_GetString(argv[1], NULL);
+
+
+    const char *script = alloc_printf("set dummy_val $httppostdata(%s); set dummy_val",
+    			name);
+    	int retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
+    	free((void *) script);
+    	if (retcode != JIM_OK)
+    	{
+    	    Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+    	} else
+    	{
+    	    Jim_SetResult(interp, Jim_GetResult(interp));
+    	}
+
+    return JIM_OK;
+}
+
+struct httpd_request
+{
+	int post;
+	struct MHD_PostProcessor *postprocessor;
+
+	//Jim_Obj *dict;
+
+	int complete; /* did we receive the entire post ? */
+
+};
+
+static void request_completed(void *cls, struct MHD_Connection *connection,
+		void **con_cls, enum MHD_RequestTerminationCode toe)
+{
+	struct httpd_request *r = (struct httpd_request*) *con_cls;
+
+	if (NULL == r)
+		return;
+
+	if (r->postprocessor)
+	{
+		MHD_destroy_post_processor(r->postprocessor);
+	}
+
+	free(r);
+	*con_cls = NULL;
+}
+
+/* append to said key in dictonary */
+static void append_key(struct httpd_request *r, const char *key,
+		const char *data, size_t off, size_t size)
+{
+	Jim_Obj *keyObj = Jim_NewStringObj(interp, key, -1);
+	Jim_Obj *value = NULL;
+
+	Jim_Obj *dict = Jim_GetVariableStr(interp, "httppostdata", 0);
+
+	if (dict!=NULL)
+	{
+		if (Jim_DictKey(interp, dict, keyObj, &value, 0) != JIM_OK)
+		{
+			 value = NULL;
+		}
+	}
+	if (value == NULL)
+		value = Jim_NewStringObj(interp, "", -1);
+
+	/* create a new object we append to and insert into this location */
+	Jim_Obj *newObj = Jim_NewStringObj(interp, "", -1);
+	Jim_AppendObj(interp, newObj, value);
+	Jim_AppendString(interp, newObj, data, size);
+	/* uhh... use name here of dictionary */
+	Jim_SetDictKeysVector(interp, Jim_NewStringObj(interp, "httppostdata", -1), &keyObj, 1, newObj);
+}
+
+/* append data to each key */
+static int iterate_post(void *con_cls, enum MHD_ValueKind kind,
+		const char *key, const char *filename, const char *content_type,
+		const char *transfer_encoding, const char *data, size_t off,
+		size_t size)
+{
+	struct httpd_request *r = (struct httpd_request*) con_cls;
+
+	append_key(r, key, data, off, size);
+
+	return MHD_YES;
+}
+
+static int record_arg(void *cls, enum MHD_ValueKind kind, const char *key,
+		const char *value)
+{
+	struct httpd_request *r = (struct httpd_request*) cls;
+	append_key(r, key, value, 0, strlen(value));
+	return MHD_YES;
+}
+
+static int ahc_echo(void * cls, struct MHD_Connection * connection,
+		const char * url, const char * method, const char * version,
+		const char * upload_data, unsigned int * upload_data_size, void ** ptr)
+{
+	struct MHD_Response * response;
+	int ret;
+
+	int post = 0;
+
+	if (0 == strcmp(method, "POST"))
+	{
+		post = 1;
+	}
+	else if (0 == strcmp(method, "GET"))
+	{
+	}
+	else
+	{
+		return MHD_NO; /* unexpected method */
+	}
+
+	struct httpd_request *r;
+	if (*ptr == NULL)
+	{
+		/* The first time only the headers are valid,
+		 do not respond in the first round... */
+
+		*ptr = malloc(sizeof(struct httpd_request));
+		if (*ptr == NULL)
+			return MHD_NO;
+		memset(*ptr, 0, sizeof(struct httpd_request));
+
+		r = (struct httpd_request *) *ptr;
+
+		r->post = post;
+		Jim_SetVariableStr(interp, "httppostdata", Jim_NewDictObj(interp, NULL, 0));
+
+		/* fill in url query strings in dictonary */
+		MHD_get_connection_values(connection, MHD_GET_ARGUMENT_KIND,
+				record_arg, r);
+
+		if (r->post)
+		{
+			r->postprocessor = MHD_create_post_processor(connection, 2048
+					* 1024, iterate_post, r);
+		}
+
+		return MHD_YES;
+	}
+
+	r = (struct httpd_request *) *ptr;
+
+	if (r->post)
+	{
+		/* consume post data */
+		if (*upload_data_size)
+		{
+			MHD_post_process(r->postprocessor, upload_data, *upload_data_size);
+			*upload_data_size = 0;
+			return MHD_YES;
+		}
+		else
+		{
+		}
+	} else
+	{
+	}
+
+	/* hand over to request who will be using it. */
+	//	r->dict = NULL;
+
+
+	/* FIX!!!! we need more advanced handling of url's to avoid them
+	 * being subverted to evil purposes
+	 */
+
+	url++; /* skip '/' */
+
+	const char *suffix;
+	suffix = strrchr(url, '.');
+	if ((suffix != NULL) && (strcmp(suffix, ".tcl") == 0))
+	{
+		printf("Run tcl %s\n", url);
+
+		int retcode;
+
+		const char *script = alloc_printf(
+				"global httpdata; source {%s}; set httpdata", url);
+		retcode = Jim_Eval_Named(interp, script, "httpd.c", __LINE__ );
+		free((void *) script);
+
+		if (retcode == JIM_ERR)
+		{
+			printf("Tcl failed\n");
+			const char *t = httpd_exec_cgi_tcl_error(interp);
+			if (t == NULL)
+				return MHD_NO;
+
+			response = MHD_create_response_from_data(strlen(t), (void *) t,
+					MHD_YES, MHD_NO);
+			ret = MHD_queue_response(connection,
+					MHD_HTTP_INTERNAL_SERVER_ERROR, response);
+			MHD_destroy_response(response);
+			return ret;
+		}
+		else
+		{
+			printf("Tcl OK\n");
+			/* FIX!!! how to handle mime types??? */
+			const char *result;
+			int reslen;
+			result = Jim_GetString(Jim_GetResult(interp), &reslen);
+
+			response = MHD_create_response_from_data(reslen, (void *) result,
+					MHD_NO, MHD_YES);
+			ret = MHD_queue_response(connection,
+					MHD_HTTP_INTERNAL_SERVER_ERROR, response);
+			MHD_destroy_response(response);
+			return ret;
+		}
+	}
+	else
+	{
+		void *data;
+		int len;
+
+		int retval = loadFile(url, &data, &len);
+		if (retval != ERROR_OK)
+		{
+			printf("Did not find %s\n", url);
+
+			response = MHD_create_response_from_data(strlen(PAGE_NOT_FOUND),
+					(void *) PAGE_NOT_FOUND, MHD_NO, MHD_NO);
+			ret = MHD_queue_response(connection, MHD_HTTP_NOT_FOUND, response);
+			MHD_destroy_response(response);
+			return ret;
+		}
+
+		printf("Serving %s length=%d\n", url, len);
+		/* serve file directly */
+		response = MHD_create_response_from_data(len, data, MHD_YES, MHD_NO);
+		MHD_add_response_header(response, "Content-Type", "image/png");
+
+		ret = MHD_queue_response(connection, MHD_HTTP_OK, response);
+		MHD_destroy_response(response);
+
+		//free(data);
+		return ret;
+	}
+}
+
+static struct MHD_Daemon * d;
+
+int httpd_start(void)
+{
+
+	int port = 8888;
+	LOG_USER("Launching httpd server on port %d", port);
+	d = MHD_start_daemon(MHD_USE_SELECT_INTERNALLY, port, NULL, NULL,
+			&ahc_echo, NULL, /* could be data for handler, but we only have a single handler, use global variables instead */
+			MHD_OPTION_NOTIFY_COMPLETED, request_completed, NULL, /* Closure... what's that??? */
+			MHD_OPTION_END);
+	if (d == NULL)
+		return ERROR_FAIL;
+
+	Jim_CreateCommand(interp,
+						  "formfetch",
+						  httpd_Jim_Command_formfetch,
+						  NULL,
+						  NULL);
+
+    Jim_CreateCommand(interp,
+                      "writeform",
+                      httpd_Jim_Command_writeform,
+                      NULL,
+                      NULL);
+
+
+	return ERROR_OK;
+}
+
+void httpd_stop(void)
+{
+	MHD_stop_daemon(d);
+}
+
+void openocd_sleep_prelude(void)
+{
+}
+
+void openocd_sleep_postlude(void)
+{
+}
+


Property changes on: trunk/src/server/httpd.c
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/target/interface/rlink.cfg
===================================================================
--- trunk/src/target/interface/rlink.cfg	2008-12-19 06:49:34 UTC (rev 1259)
+++ trunk/src/target/interface/rlink.cfg	2008-12-19 13:58:15 UTC (rev 1260)
@@ -0,0 +1,3 @@
+# rlink interface
+interface rlink
+


Property changes on: trunk/src/target/interface/rlink.cfg
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/tools/rlink_make_speed_table/rlink_make_speed_table
___________________________________________________________________
Name: svn:eol-style
   + LF


Property changes on: trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + LF


Property changes on: trunk/tools/st7_dtc_as/st7_dtc_as
___________________________________________________________________
Name: svn:eol-style
   + LF


Property changes on: trunk/tools/st7_dtc_as/st7_dtc_as.pl
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + LF



From oharboe at mail.berlios.de  Fri Dec 19 15:48:01 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 19 Dec 2008 15:48:01 +0100
Subject: [Openocd-svn] r1261 - trunk/src/helper
Message-ID: <200812191448.mBJEm12I026497@sheep.berlios.de>

Author: oharboe
Date: 2008-12-19 15:48:00 +0100 (Fri, 19 Dec 2008)
New Revision: 1261

Modified:
   trunk/src/helper/types.h
Log:
Dick Hollenbeck <dick at softplc.com> better comments

Modified: trunk/src/helper/types.h
===================================================================
--- trunk/src/helper/types.h	2008-12-19 13:58:15 UTC (rev 1260)
+++ trunk/src/helper/types.h	2008-12-19 14:48:00 UTC (rev 1261)
@@ -46,18 +46,22 @@
 typedef struct jtag_tap_s jtag_tap_t;
 
 
-/* DANGER!!!! here be dragons! 
- * 
+/* DANGER!!!! here be dragons!
+ *
  * Leave these fn's as byte accesses because it is safe
  * across architectures. Clever usage of 32 bit access
  * will create problems on some hosts.
- * 
- * Note that the pointer in memory might be unaligned. 
- * 
- * On some CPU's, i.e. ARM7, the 2 lsb are ignored for 32 
- * bit access, on others it will cause an exception and 
- * on e.g. x86, it works the same as if aligned.
- * 
+ *
+ * Note that the "buf" pointer in memory is probably unaligned.
+ *
+ * Were these functions to be re-written to take a 32 bit wide or 16 bit wide
+ * memory access shortcut, then on some CPU's, i.e. ARM7, the 2 lsbytes of the address are
+ * ignored for 32 bit access, whereas on other CPU's a 32 bit wide unaligned memory access
+ * will cause an exception, and lastly on x86, an unaligned "greater than bytewide"
+ * memory access works as if aligned.  So what follows below will work for all
+ * platforms and gives the compiler leeway to do its own platform specific optimizations.
+ *
+ * Again, note that the "buf" pointer in memory is probably unaligned.
  */
 
 



From oharboe at mail.berlios.de  Fri Dec 19 20:40:40 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 19 Dec 2008 20:40:40 +0100
Subject: [Openocd-svn] r1262 - trunk/src/helper
Message-ID: <200812191940.mBJJeeRu000942@sheep.berlios.de>

Author: oharboe
Date: 2008-12-19 20:40:38 +0100 (Fri, 19 Dec 2008)
New Revision: 1262

Modified:
   trunk/src/helper/log.c
Log:
Dick Hollenbeck <dick at softplc.com> better logging

Modified: trunk/src/helper/log.c
===================================================================
--- trunk/src/helper/log.c	2008-12-19 14:48:00 UTC (rev 1261)
+++ trunk/src/helper/log.c	2008-12-19 19:40:38 UTC (rev 1262)
@@ -55,13 +55,14 @@
 
 static char *log_strings[5] =
 {
-	"User:   ",
-	"Error:  ",
-	"Warning:",
-	"Info:   ",
-	"Debug:  "
+	"User : ",
+	"Error: ",
+	"Warn : ",  /* want a space after each colon, all same width, colons aligned */
+	"Info : ",
+	"Debug: "
 };
 
+
 static int count = 0;
 
 /* The log_puts() serves to somewhat different goals:
@@ -99,7 +100,7 @@
 			struct mallinfo info;
 			info = mallinfo();
 #endif
-			fprintf(log_output, "%s %d %d %s:%d %s()"
+			fprintf(log_output, "%s%d %d %s:%d %s()"
 #if PRINT_MEM()
 					" %d"
 #endif
@@ -217,7 +218,7 @@
 			LOG_WARNING("enabling log output as we are using pipes");
 		}
 	}
-	
+
 	return ERROR_OK;
 }
 



From oharboe at mail.berlios.de  Fri Dec 19 20:42:00 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 19 Dec 2008 20:42:00 +0100
Subject: [Openocd-svn] r1263 - trunk/src/jtag
Message-ID: <200812191942.mBJJg0np001015@sheep.berlios.de>

Author: oharboe
Date: 2008-12-19 20:41:58 +0100 (Fri, 19 Dec 2008)
New Revision: 1263

Modified:
   trunk/src/jtag/dummy.c
Log:
Dick Hollenbeck <dick at softplc.com> - This patch adds JTAG state tracking to dummy.c

Modified: trunk/src/jtag/dummy.c
===================================================================
--- trunk/src/jtag/dummy.c	2008-12-19 19:40:38 UTC (rev 1262)
+++ trunk/src/jtag/dummy.c	2008-12-19 19:41:58 UTC (rev 1263)
@@ -26,6 +26,15 @@
 #include "jtag.h"
 #include "bitbang.h"
 
+
+/* my private tap controller state, which tracks state for calling code */
+static tap_state_t dummy_state = TAP_RESET;
+
+static int dummy_clock;         /* edge detector */
+
+static tap_state_t tap_state_transition(tap_state_t cur_state, int tms);
+
+
 int dummy_speed(int speed);
 int dummy_register_commands(struct command_context_s *cmd_ctx);
 int dummy_init(void);
@@ -70,12 +79,28 @@
 	return 1;
 }
 
+
 void dummy_write(int tck, int tms, int tdi)
 {
+	/* TAP standard: "state transitions occur on rising edge of clock" */
+	if( tck != dummy_clock )
+	{
+		if( tck )
+		{
+			int old_state = dummy_state;
+			dummy_state = tap_state_transition( dummy_state, tms );
+			if( old_state != dummy_state )
+				LOG_INFO( "dummy_tap=%s", jtag_state_name(dummy_state) );
+		}
+		dummy_clock = tck;
+	}
 }
 
 void dummy_reset(int trst, int srst)
 {
+	dummy_clock = 0;
+	dummy_state = TAP_RESET;
+	LOG_DEBUG( "reset to %s", jtag_state_name(dummy_state) );
 }
 
 static int dummy_khz(int khz, int *jtag_speed)
@@ -130,3 +155,107 @@
 void dummy_led(int on)
 {
 }
+
+
+/**
+ * Function tap_state_transition
+ * takes a current TAP state and returns the next state according to the tms value.
+ *
+ * Even though there is code to duplicate this elsewhere, we do it here a little
+ * differently just to get a second opinion, i.e. a verification, on state tracking
+ * in that other logic. Plus array lookups without index checking are no favorite thing.
+ * This is educational for developers new to TAP controllers.
+ */
+static tap_state_t tap_state_transition(tap_state_t cur_state, int tms)
+{
+	tap_state_t new_state;
+
+	if (tms)
+	{
+		switch (cur_state)
+		{
+		case TAP_RESET:
+			new_state = cur_state;
+			break;
+		case TAP_IDLE:
+		case TAP_DRUPDATE:
+		case TAP_IRUPDATE:
+			new_state = TAP_DRSELECT;
+			break;
+		case TAP_DRSELECT:
+			new_state = TAP_IRSELECT;
+			break;
+		case TAP_DRCAPTURE:
+		case TAP_DRSHIFT:
+			new_state = TAP_DREXIT1;
+			break;
+		case TAP_DREXIT1:
+		case TAP_DREXIT2:
+			new_state = TAP_DRUPDATE;
+			break;
+		case TAP_DRPAUSE:
+			new_state = TAP_DREXIT2;
+			break;
+		case TAP_IRSELECT:
+			new_state = TAP_RESET;
+			break;
+		case TAP_IRCAPTURE:
+		case TAP_IRSHIFT:
+			new_state = TAP_IREXIT1;
+			break;
+		case TAP_IREXIT1:
+		case TAP_IREXIT2:
+			new_state = TAP_IRUPDATE;
+			break;
+		case TAP_IRPAUSE:
+			new_state = TAP_IREXIT2;
+			break;
+		default:
+			LOG_ERROR( "fatal: invalid argument cur_state=%d", cur_state );
+			exit(1);
+			break;
+		}
+	}
+	else
+	{
+		switch (cur_state)
+		{
+		case TAP_RESET:
+		case TAP_IDLE:
+		case TAP_DRUPDATE:
+		case TAP_IRUPDATE:
+			new_state = TAP_IDLE;
+			break;
+		case TAP_DRSELECT:
+			new_state = TAP_DRCAPTURE;
+			break;
+		case TAP_DRCAPTURE:
+		case TAP_DRSHIFT:
+		case TAP_DREXIT2:
+			new_state = TAP_DRSHIFT;
+			break;
+		case TAP_DREXIT1:
+		case TAP_DRPAUSE:
+			new_state = TAP_DRPAUSE;
+			break;
+		case TAP_IRSELECT:
+			new_state = TAP_IRCAPTURE;
+			break;
+		case TAP_IRCAPTURE:
+		case TAP_IRSHIFT:
+		case TAP_IREXIT2:
+			new_state = TAP_IRSHIFT;
+			break;
+		case TAP_IREXIT1:
+		case TAP_IRPAUSE:
+			new_state = TAP_IRPAUSE;
+			break;
+		default:
+			LOG_ERROR( "fatal: invalid argument cur_state=%d", cur_state );
+			exit(1);
+			break;
+		}
+	}
+
+	return new_state;
+}



From oharboe at mail.berlios.de  Fri Dec 19 20:45:03 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 19 Dec 2008 20:45:03 +0100
Subject: [Openocd-svn] r1264 - trunk/src/jtag
Message-ID: <200812191945.mBJJj3Am001220@sheep.berlios.de>

Author: oharboe
Date: 2008-12-19 20:45:01 +0100 (Fri, 19 Dec 2008)
New Revision: 1264

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
Log:
Dick Hollenbeck <dick at softplc.com> better logging

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-19 19:41:58 UTC (rev 1263)
+++ trunk/src/jtag/jtag.c	2008-12-19 19:45:01 UTC (rev 1264)
@@ -1300,7 +1300,7 @@
 				{
 					if (cmd->fields[i].in_handler(cmd->fields[i].in_value, cmd->fields[i].in_handler_priv, cmd->fields+i) != ERROR_OK)
 					{
-						LOG_WARNING("in_handler reported a failed check");
+						LOG_WARNING("in_handler: with \"in_value\", mismatch in %s", cmd->ir_scan ? "SIR" : "SDR" );
 						retval = ERROR_JTAG_QUEUE_FAILED;
 					}
 				}
@@ -1314,7 +1314,7 @@
 					/* We're going to call the error:handler later, but if the in_handler
 					 * reported an error we report this failure upstream
 					 */
-					LOG_WARNING("in_handler reported a failed check");
+					LOG_WARNING("in_handler: w/o \"in_value\", mismatch in %s",  cmd->ir_scan ? "SIR" : "SDR" );
 					retval = ERROR_JTAG_QUEUE_FAILED;
 				}
 			}

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2008-12-19 19:41:58 UTC (rev 1263)
+++ trunk/src/jtag/jtag.h	2008-12-19 19:45:01 UTC (rev 1264)
@@ -35,14 +35,14 @@
 
 /* 16 Tap States, from page 21 of ASSET InterTech, Inc.'s svf.pdf
  */
-enum tap_state
+typedef enum tap_state
 {
 	TAP_RESET = 0x0, TAP_IDLE = 0x8,
 	TAP_DRSELECT = 0x1, TAP_DRCAPTURE = 0x2, TAP_DRSHIFT = 0x3, TAP_DREXIT1 = 0x4,
 	TAP_DRPAUSE = 0x5, TAP_DREXIT2 = 0x6, TAP_DRUPDATE = 0x7,
 	TAP_IRSELECT = 0x9, TAP_IRCAPTURE = 0xa, TAP_IRSHIFT = 0xb, TAP_IREXIT1 = 0xc,
 	TAP_IRPAUSE = 0xd, TAP_IREXIT2 = 0xe, TAP_IRUPDATE = 0xf
-};
+} tap_state_t;
 
 typedef struct tap_transition_s
 {
@@ -530,7 +530,7 @@
 
 /**
  * Function jtag_state_name
- * Returns a string suitable for display representing the JTAG tap_state 
+ * Returns a string suitable for display representing the JTAG tap_state
  */
 const char* jtag_state_name(enum tap_state state);
 



From oharboe at mail.berlios.de  Mon Dec 22 11:27:55 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 22 Dec 2008 11:27:55 +0100
Subject: [Openocd-svn] r1265 - trunk/src/jtag
Message-ID: <200812221027.mBMARtSV008568@sheep.berlios.de>

Author: oharboe
Date: 2008-12-22 11:27:53 +0100 (Mon, 22 Dec 2008)
New Revision: 1265

Modified:
   trunk/src/jtag/dummy.c
Log:
bumped a LOG_INFO to LOG_DEBUG level to reduce excessive output for normal execution

Modified: trunk/src/jtag/dummy.c
===================================================================
--- trunk/src/jtag/dummy.c	2008-12-19 19:45:01 UTC (rev 1264)
+++ trunk/src/jtag/dummy.c	2008-12-22 10:27:53 UTC (rev 1265)
@@ -90,7 +90,7 @@
 			int old_state = dummy_state;
 			dummy_state = tap_state_transition( dummy_state, tms );
 			if( old_state != dummy_state )
-				LOG_INFO( "dummy_tap=%s", jtag_state_name(dummy_state) );
+				LOG_DEBUG( "dummy_tap=%s", jtag_state_name(dummy_state) );
 		}
 		dummy_clock = tck;
 	}



From oharboe at mail.berlios.de  Mon Dec 22 11:28:13 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 22 Dec 2008 11:28:13 +0100
Subject: [Openocd-svn] r1266 - in trunk/src: helper server
Message-ID: <200812221028.mBMASDc1008612@sheep.berlios.de>

Author: oharboe
Date: 2008-12-22 11:28:11 +0100 (Mon, 22 Dec 2008)
New Revision: 1266

Modified:
   trunk/src/helper/ioutil.c
   trunk/src/server/httpd.c
Log:
cygwin fixes

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2008-12-22 10:27:53 UTC (rev 1265)
+++ trunk/src/helper/ioutil.c	2008-12-22 10:28:11 UTC (rev 1266)
@@ -62,8 +62,9 @@
 #include <stdio.h>
 #include <string.h>
 
-
+#if !defined(__CYGWIN__)
 #include <ifaddrs.h>
+#endif
 
 #include <unistd.h>
 #include <stdio.h>
@@ -564,6 +565,7 @@
 static int zylinjtag_Jim_Command_ip(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
+#if !defined(__CYGWIN__)
 	Jim_Obj *tclOutput = Jim_NewStringObj(interp, "", 0);
 
 	struct ifaddrs *ifa = NULL, *ifp = NULL;
@@ -597,13 +599,14 @@
 	}
 
 	freeifaddrs(ifp);
-
+#else
+	Jim_Obj *tclOutput = Jim_NewStringObj(interp, "fixme!!!", 0);
+#endif
 	Jim_SetResult(interp, tclOutput);
 
 	return JIM_OK;
 }
 
-
 /* not so pretty code to fish out eth0 mac address */
 static int zylinjtag_Jim_Command_mac(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2008-12-22 10:27:53 UTC (rev 1265)
+++ trunk/src/server/httpd.c	2008-12-22 10:28:11 UTC (rev 1266)
@@ -54,7 +54,7 @@
 
 #define PAGE_NOT_FOUND "<html><head><title>File not found</title></head><body>File not found</body></html>"
 
-static const char *appendf(const *prev, const char *format, ...)
+static const char *appendf(const char *prev, const char *format, ...)
 {
 	va_list ap;
 	va_start(ap, format);
@@ -69,7 +69,7 @@
 
 	if (prev != NULL)
 	{
-		free(prev);
+		free((void *)prev);
 	}
 
 	if (string == NULL)
@@ -120,7 +120,7 @@
 	char *file = (char*) Jim_GetString(argv[2], NULL);
 
 	// Find length
-	char *data;
+	const char *data;
 	int actual;
 
 	int retcode;
@@ -449,9 +449,11 @@
 
 void openocd_sleep_prelude(void)
 {
+	/* FIX!!!! add locking here!!!! */
 }
 
 void openocd_sleep_postlude(void)
 {
+	/* FIX!!!! add locking here!!!! */
 }
 



From oharboe at mail.berlios.de  Mon Dec 22 15:26:47 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 22 Dec 2008 15:26:47 +0100
Subject: [Openocd-svn] r1267 - trunk/doc
Message-ID: <200812221426.mBMEQlI0015770@sheep.berlios.de>

Author: oharboe
Date: 2008-12-22 15:26:44 +0100 (Mon, 22 Dec 2008)
New Revision: 1267

Modified:
   trunk/doc/openocd.texi
Log:
Dirk Behme <dirk.behme at googlemail.com>
 Add missing tap-enable and tap-disable events to documentation.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-22 10:28:11 UTC (rev 1266)
+++ trunk/doc/openocd.texi	2008-12-22 14:26:44 UTC (rev 1267)
@@ -1744,8 +1744,8 @@
    mychip.cpu configure -event gdb-attach @{ puts "Reset..." ; reset halt @}
 @end example
 
-Current Events
-
+ at section Current Events
+The following events are available:
 @itemize @bullet
 @item @b{debug-halted}
 @* The target has halted for debug reasons (ie: breakpoint)
@@ -1809,6 +1809,22 @@
 @* Success
 @item @b{resumed}
 @* Target has resumed
+ at item @b{tap-enable}
+@* Executed by @b{jtag tapenable DOTTED.NAME} command. Example:
+ at example
+jtag configure DOTTED.NAME -event tap-enable @{
+  puts "Enabling CPU"
+  ...
+@}
+ at end example
+ at item @b{tap-disable}
+@*Executed by @b{jtag tapdisable DOTTED.NAME} command. Example:
+ at example
+jtag configure DOTTED.NAME -event tap-disable @{
+  puts "Disabling CPU"
+  ...
+@}
+ at end example
 @end itemize
 
 



From oharboe at mail.berlios.de  Mon Dec 22 16:10:27 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 22 Dec 2008 16:10:27 +0100
Subject: [Openocd-svn] r1269 - in trunk/src/server: . httpd httpd/menu_cuts
Message-ID: <200812221510.mBMFARKP019801@sheep.berlios.de>

Author: oharboe
Date: 2008-12-22 16:10:18 +0100 (Mon, 22 Dec 2008)
New Revision: 1269

Added:
   trunk/src/server/httpd/menu_cuts/
   trunk/src/server/httpd/menu_cuts/center_bottom.png
   trunk/src/server/httpd/menu_cuts/center_top.png
   trunk/src/server/httpd/menu_cuts/h_tab1.png
   trunk/src/server/httpd/menu_cuts/h_tab1_selected.png
   trunk/src/server/httpd/menu_cuts/h_tab2.png
   trunk/src/server/httpd/menu_cuts/h_tab2_selected.png
   trunk/src/server/httpd/menu_cuts/h_tab_free.png
   trunk/src/server/httpd/menu_cuts/logo_bottom.png
   trunk/src/server/httpd/menu_cuts/logo_top.png
   trunk/src/server/httpd/menu_cuts/right_bottom.png
   trunk/src/server/httpd/menu_cuts/right_top.png
   trunk/src/server/httpd/menu_cuts/right_top_small.png
   trunk/src/server/httpd/menu_cuts/top_right.png
   trunk/src/server/httpd/menu_cuts/v_1.png
   trunk/src/server/httpd/menu_cuts/v_2_tile.png
   trunk/src/server/httpd/menu_cuts/v_3.png
   trunk/src/server/httpd/menu_cuts/v_tab.png
   trunk/src/server/httpd/menu_cuts/v_tab_selected.png
Modified:
   trunk/src/server/httpd.c
   trunk/src/server/httpd/readme.txt
Log:
httpd wip

Added: trunk/src/server/httpd/menu_cuts/center_bottom.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/center_bottom.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/center_top.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/center_top.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/h_tab1.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab1.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/h_tab1_selected.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab1_selected.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/h_tab2.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab2.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/h_tab2_selected.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab2_selected.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/h_tab_free.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab_free.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/logo_bottom.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/logo_bottom.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/logo_top.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/logo_top.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/right_bottom.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/right_bottom.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/right_top.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/right_top.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/right_top_small.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/right_top_small.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/top_right.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/top_right.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/v_1.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/v_1.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/v_2_tile.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/v_2_tile.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/v_3.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/v_3.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/v_tab.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/v_tab.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/src/server/httpd/menu_cuts/v_tab_selected.png
===================================================================
(Binary files differ)


Property changes on: trunk/src/server/httpd/menu_cuts/v_tab_selected.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/src/server/httpd/readme.txt
===================================================================
--- trunk/src/server/httpd/readme.txt	2008-12-22 15:02:09 UTC (rev 1268)
+++ trunk/src/server/httpd/readme.txt	2008-12-22 15:10:18 UTC (rev 1269)
@@ -19,6 +19,6 @@
 ../openocd/configure --enable-httpd --enable-dummy  --enable-ioutil
 make
 make install
-openocd -c "interface dummy" -f target/at91eb40a.cfg
+openocd  -f httpd/httpd.tcl -c "interface dummy" -f target/at91eb40a.cfg
 
 4. Point browser to: http://localhost:8888

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2008-12-22 15:02:09 UTC (rev 1268)
+++ trunk/src/server/httpd.c	2008-12-22 15:10:18 UTC (rev 1269)
@@ -296,7 +296,7 @@
 		}
 		else
 		{
-			printf("Tcl OK\n");
+			LOG_DEBUG("Tcl OK");
 			/* FIX!!! how to handle mime types??? */
 			const char *result;
 			int reslen;



From oharboe at mail.berlios.de  Mon Dec 22 16:14:11 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 22 Dec 2008 16:14:11 +0100
Subject: [Openocd-svn] r1270 - zy1000/trunk/build/tcl/menu_cuts
Message-ID: <200812221514.mBMFEBxi019941@sheep.berlios.de>

Author: oharboe
Date: 2008-12-22 16:14:10 +0100 (Mon, 22 Dec 2008)
New Revision: 1270

Added:
   zy1000/trunk/build/tcl/menu_cuts/zylin_logo_bottom_left.PNG
Log:
httpd wip

Added: zy1000/trunk/build/tcl/menu_cuts/zylin_logo_bottom_left.PNG
===================================================================
(Binary files differ)


Property changes on: zy1000/trunk/build/tcl/menu_cuts/zylin_logo_bottom_left.PNG
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From oharboe at mail.berlios.de  Mon Dec 22 16:24:39 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 22 Dec 2008 16:24:39 +0100
Subject: [Openocd-svn] r1271 - trunk/src/server/httpd
Message-ID: <200812221524.mBMFOd1C020795@sheep.berlios.de>

Author: oharboe
Date: 2008-12-22 16:24:35 +0100 (Mon, 22 Dec 2008)
New Revision: 1271

Modified:
   trunk/src/server/httpd/browsemem.tcl
   trunk/src/server/httpd/downloadmem.tcl
   trunk/src/server/httpd/erase.tcl
   trunk/src/server/httpd/flash.tcl
   trunk/src/server/httpd/flashinfo.tcl
   trunk/src/server/httpd/guiupload.tcl
   trunk/src/server/httpd/httpd.tcl
   trunk/src/server/httpd/index.tcl
   trunk/src/server/httpd/menu.xml
   trunk/src/server/httpd/openocd.tcl
   trunk/src/server/httpd/production.tcl
   trunk/src/server/httpd/run.tcl
   trunk/src/server/httpd/targets.tcl
   trunk/src/server/httpd/terminal.tcl
Log:
httpd wip

Modified: trunk/src/server/httpd/browsemem.tcl
===================================================================
--- trunk/src/server/httpd/browsemem.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/browsemem.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,9 +14,7 @@
 
 
 		
-
 		
-		
 
 		
 

Modified: trunk/src/server/httpd/downloadmem.tcl
===================================================================
--- trunk/src/server/httpd/downloadmem.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/downloadmem.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,9 +14,7 @@
 
 
 		
-
 		
-		
 
 		
 
@@ -317,12 +315,12 @@
 <tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 					
-				Download memory to ZY1000 from target. <br>
+				Download memory from target. <br>
 				<b>Note</b> that download memory can take
 				a long time(potentially minutes for megabytes at low JTAG clk speeds).
 				<p/>
 				Once the memory is downloaded a link is available on the page to download
-				the file from ZY1000 to your PC.
+				the file to your PC.
 				
 			</td>
 </tr>

Modified: trunk/src/server/httpd/erase.tcl
===================================================================
--- trunk/src/server/httpd/erase.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/erase.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,9 +14,7 @@
 
 
 		
-
 		
-		
 
 		
 

Modified: trunk/src/server/httpd/flash.tcl
===================================================================
--- trunk/src/server/httpd/flash.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/flash.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,9 +14,7 @@
 
 
 		
-
 		
-		
 
 		<html xmlns="http://www.w3.org/TR/REC-html40">
 <head>

Modified: trunk/src/server/httpd/flashinfo.tcl
===================================================================
--- trunk/src/server/httpd/flashinfo.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/flashinfo.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,8 +14,6 @@
 
 
 		
-
-		
 		<html xmlns="http://www.w3.org/TR/REC-html40">
 <head>
 <title>OpenOCD debugger</title>

Modified: trunk/src/server/httpd/guiupload.tcl
===================================================================
--- trunk/src/server/httpd/guiupload.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/guiupload.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,9 +14,7 @@
 
 
 		
-
 		
-		
 
 		
 
@@ -95,7 +93,7 @@
 <tr>
 <td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
 <div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="guiupload.tcl" style="font-weight: bold;">Upload File to ZY1000</a>
+<a href="guiupload.tcl" style="font-weight: bold;">Upload File</a>
 </div>
 </td>
 </tr>
@@ -149,7 +147,7 @@
 </tr>
 <tr>
 <td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Upload File to ZY1000</H1>
+<H1>Upload File</H1>
 </td>
 </tr>
 <tr style="height:100%;">
@@ -171,7 +169,7 @@
 					}
 				}
 				
-				append buffer {<table style="padding:0px;border-collapse:collapse;"><tr><td class="formtext">Filename on ZY1000</td><td><input type="text" name="form_filename"></td></tr>}
+				append buffer {<table style="padding:0px;border-collapse:collapse;"><tr><td class="formtext">Filename on OpenOCD machine</td><td><input type="text" name="form_filename"></td></tr>}
 				append buffer {<td class="formtext">File to upload</td><td><input type="file" name="form_filecontent"></td></tr></table>}
 				append buffer {<table><tr><td style="height:15px;width:535px;">&nbsp</td></tr><tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr><tr><td style="height:15px;width:535px;">&nbsp</td></tr></table>}
 				append buffer {<input type="submit" name="form_action" value="Upload" ><br> }
@@ -302,43 +300,7 @@
 <td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
 </tr>
 <tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">	
-				
-				  <p>The ZY1000 has three filing systems "/rom", "/ram" and "/config". "/rom" is a read only filing
-				  embedded into the firmware.</p>
-
-				  <p>Use "/ram" to store temporary files.<p/>
-				  
-				  <p>
-				  You can browse filing systems and download files by pointing your web browser to:
-				  <ul> 
-				  <li><a href="/ram" target="_blank">/ram</a>
-				  <li><a href="/rom" target="_blank">/rom</a>
-				  <li><a href="/config" target="_blank">/config</a>
-				  </ul>
-				  </p> 
-				  
-				  <p>
-				  You can also upload files using e.g. curl from the command line. Example:
-				  </p>
-				  <code>
-				  curl --form form_filecontent=@/tmp/myfile.elf --form form_filename=/ram/myfile.elf }
-append buffer [ip]
-append buffer {upload.tcl
-				  </code>
-				  <p> 
-				  If you have a tftp server installed on your development PC, you can access
-				  files on your developer PC using a /tftp/ip/ prefix to the file to be accessed
-				  on your developer PC. Note that if you do not increase the default packet
-				  size for your tftp server, then the performance will be very poor. Normal
-				  performance is about 500-600kBytes/s.
-				  </p>
-				  <code> 
-				  cp /tftp/10.0.0.106/build/src/openocd /ram/test
-				  </code>
-				  
-				  
-			</td>
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray"/>
 </tr>
 <tr>
 <td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">

Modified: trunk/src/server/httpd/httpd.tcl
===================================================================
--- trunk/src/server/httpd/httpd.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/httpd.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -106,3 +106,8 @@
 	} result
 	return $result
 }
+
+proc zy1000_flash {} {
+	set t [lindex 0 [ocd_flash_banks]]
+	return $t(base)
+}

Modified: trunk/src/server/httpd/index.tcl
===================================================================
--- trunk/src/server/httpd/index.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/index.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -298,10 +298,7 @@
 					See log for details. <br>
 					<p><b>Target power</b> - Detects power on target. <br>
 					If the JTAG cable is not connected, or the target has no power, then no target power will be detected.</p>
-					<p><b>Power on</b> - Turn on ZY1000 target power relay.</p>
-					<p><b>Power off</b> - Turn off ZY1000  target power relay.</p>
 					<p>Type "help power" in telnet for command to control power relay.</p>
-					<p><b>Reboot ZY1000</b> - Reboots ZY1000 unit. Type "help reboot" in telnet.</p>
 				
 			</td>
 </tr>
@@ -325,9 +322,7 @@
 
 
 		
-
 		
-		
 
 		
 

Modified: trunk/src/server/httpd/menu.xml
===================================================================
--- trunk/src/server/httpd/menu.xml	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/menu.xml	2008-12-22 15:24:35 UTC (rev 1271)
@@ -87,10 +87,7 @@
 					See log for details. <br>
 					<p><b>Target power</b> - Detects power on target. <br>
 					If the JTAG cable is not connected, or the target has no power, then no target power will be detected.</p>
-					<p><b>Power on</b> - Turn on ZY1000 target power relay.</p>
-					<p><b>Power off</b> - Turn off ZY1000  target power relay.</p>
 					<p>Type "help power" in telnet for command to control power relay.</p>
-					<p><b>Reboot ZY1000</b> - Reboots ZY1000 unit. Type "help reboot" in telnet.</p>
 				]]></markup_code>
 			</right_column>
 			
@@ -108,13 +105,13 @@
 				<markup_code><![CDATA[
 				
 				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either ZY1000 ships with an
+				the CPU, flash and reset init script. Either OpenOCD ships with an
 				openocd.cfg file for your target or you need to take an existing
 				config file and modify it for your needs.
 				<p> 
 				The reset init script is crucial. It will set up e.g. MMU, chip
 				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls Zylin provides.
+				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
 				<p>
 				Writing an openocd.cfg from scratch is a non-trivial exercise, but
 				fortunally it only has to be done once for a target and afterwards it
@@ -133,33 +130,6 @@
 
 
 
-		<page lang="eng">
-			<outfile>reload.tcl</outfile>
-			<level2parent>index.tcl</level2parent>
-			<pageheading>Reload Config Scripts</pageheading>
-			<pagetext>
-			<markup_code><![CDATA[
-			
-			<tcl>
-				set form_action [formfetch form_action]
-	
-				if {[string compare $form_action "Reload"]==0} {
-					append buffer "Reloading Config Scripts...<p>"
-					reboot
-				}
-			</tcl>
-			<form enctype="multipart/form-data" action="reload.tcl" method="post">
-				<input type="submit" name="form_action" value="Reload">
-			</form>
-			
-			]]></markup_code>
-			<right_column>
-				Restart ZY1000 to reload selected target config script.				
-			</right_column>
-			</pagetext>
-			
-		</page>
-
 		
 		<page lang="eng">
 			<outfile>flashinfo.tcl</outfile>
@@ -789,12 +759,12 @@
 			]]></markup_code>
 			<right_column>
 				<![CDATA[	
-				Download memory to ZY1000 from target. <br>
+				Download memory from target. <br>
 				<b>Note</b> that download memory can take
 				a long time(potentially minutes for megabytes at low JTAG clk speeds).
 				<p/>
 				Once the memory is downloaded a link is available on the page to download
-				the file from ZY1000 to your PC.
+				the file to your PC.
 				]]>
 			</right_column>
 			</pagetext>
@@ -811,9 +781,9 @@
 			<level2parent>openocd.tcl</level2parent>
 			<level2menu href="openocd.tcl" title="Run Command" titlestyle="color:#4e6627;">
 			</level2menu>
-			<level2menu href="guiupload.tcl" title="Upload File to ZY1000" titlestyle="color:#4e6627;">
+			<level2menu href="guiupload.tcl" title="Upload File" titlestyle="color:#4e6627;">
 			<![CDATA[
-			    Upload file to ZY1000
+			    Upload file
 			]]>
 			</level2menu>
 			
@@ -869,7 +839,7 @@
 		<page lang="eng">
 			<outfile>guiupload.tcl</outfile>
 			<level2parent>openocd.tcl</level2parent>
-			<pageheading>Upload File to ZY1000</pageheading>
+			<pageheading>Upload File</pageheading>
 			<pagetext>
 			<markup_code><![CDATA[
 			
@@ -888,7 +858,7 @@
 					}
 				}
 				
-				append buffer {<table style="padding:0px;border-collapse:collapse;"><tr><td class="formtext">Filename on ZY1000</td><td><input type="text" name="form_filename"></td></tr>}
+				append buffer {<table style="padding:0px;border-collapse:collapse;"><tr><td class="formtext">Filename on OpenOCD machine</td><td><input type="text" name="form_filename"></td></tr>}
 				append buffer {<td class="formtext">File to upload</td><td><input type="file" name="form_filecontent"></td></tr></table>}
 				append buffer {<table><tr><td style="height:15px;width:535px;">&nbsp</td></tr><tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr><tr><td style="height:15px;width:535px;">&nbsp</td></tr></table>}
 				append buffer {<input type="submit" name="form_action" value="Upload" ><br> }
@@ -897,41 +867,6 @@
 			</tcl>
 			
 			]]></markup_code>
-			<right_column>	
-				<![CDATA[
-				  <p>The ZY1000 has three filing systems "/rom", "/ram" and "/config". "/rom" is a read only filing
-				  embedded into the firmware.</p>
-
-				  <p>Use "/ram" to store temporary files.<p/>
-				  
-				  <p>
-				  You can browse filing systems and download files by pointing your web browser to:
-				  <ul> 
-				  <li><a href="/ram" target="_blank">/ram</a>
-				  <li><a href="/rom" target="_blank">/rom</a>
-				  <li><a href="/config" target="_blank">/config</a>
-				  </ul>
-				  </p> 
-				  
-				  <p>
-				  You can also upload files using e.g. curl from the command line. Example:
-				  </p>
-				  <code>
-				  curl --form form_filecontent=@/tmp/myfile.elf --form form_filename=/ram/myfile.elf <tcl>append buffer [ip]</tcl>upload.tcl
-				  </code>
-				  <p> 
-				  If you have a tftp server installed on your development PC, you can access
-				  files on your developer PC using a /tftp/ip/ prefix to the file to be accessed
-				  on your developer PC. Note that if you do not increase the default packet
-				  size for your tftp server, then the performance will be very poor. Normal
-				  performance is about 500-600kBytes/s.
-				  </p>
-				  <code> 
-				  cp /tftp/10.0.0.106/build/src/openocd /ram/test
-				  </code>
-				  
-				  ]]>
-			</right_column>
 			</pagetext>
 			
 		</page>
@@ -946,13 +881,13 @@
 				<markup_code><![CDATA[
 				
 				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either ZY1000 ships with an
+				the CPU, flash and reset init script. Either OpenOCD ships with an
 				openocd.cfg file for your target or you need to take an existing
 				config file and modify it for your needs.
 				<p> 
 				The reset init script is crucial. It will set up e.g. MMU, chip
 				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls Zylin provides.
+				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
 				<p>
 				Writing an openocd.cfg from scratch is a non-trivial exercise, but
 				fortunally it only has to be done once for a target and afterwards it

Modified: trunk/src/server/httpd/openocd.tcl
===================================================================
--- trunk/src/server/httpd/openocd.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/openocd.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,9 +14,7 @@
 
 
 		
-
 		
-		
 
 		
 
@@ -91,7 +89,7 @@
 <tr>
 <td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
 <div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="guiupload.tcl" style="">Upload File to ZY1000</a>
+<a href="guiupload.tcl" style="">Upload File</a>
 </div>
 </td>
 </tr>

Modified: trunk/src/server/httpd/production.tcl
===================================================================
--- trunk/src/server/httpd/production.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/production.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,9 +14,7 @@
 
 
 		
-
 		
-		
 
 		
 

Modified: trunk/src/server/httpd/run.tcl
===================================================================
--- trunk/src/server/httpd/run.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/run.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,9 +14,7 @@
 
 
 		
-
 		
-		
 
 		
 

Modified: trunk/src/server/httpd/targets.tcl
===================================================================
--- trunk/src/server/httpd/targets.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/targets.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -105,13 +105,13 @@
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 				
 				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either ZY1000 ships with an
+				the CPU, flash and reset init script. Either OpenOCD ships with an
 				openocd.cfg file for your target or you need to take an existing
 				config file and modify it for your needs.
 				<p> 
 				The reset init script is crucial. It will set up e.g. MMU, chip
 				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls Zylin provides.
+				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
 				<p>
 				Writing an openocd.cfg from scratch is a non-trivial exercise, but
 				fortunally it only has to be done once for a target and afterwards it
@@ -260,9 +260,7 @@
 
 
 		
-
 		
-		
 
 		
 
@@ -392,13 +390,13 @@
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 				
 				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either ZY1000 ships with an
+				the CPU, flash and reset init script. Either OpenOCD ships with an
 				openocd.cfg file for your target or you need to take an existing
 				config file and modify it for your needs.
 				<p> 
 				The reset init script is crucial. It will set up e.g. MMU, chip
 				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls Zylin provides.
+				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
 				<p>
 				Writing an openocd.cfg from scratch is a non-trivial exercise, but
 				fortunally it only has to be done once for a target and afterwards it

Modified: trunk/src/server/httpd/terminal.tcl
===================================================================
--- trunk/src/server/httpd/terminal.tcl	2008-12-22 15:14:10 UTC (rev 1270)
+++ trunk/src/server/httpd/terminal.tcl	2008-12-22 15:24:35 UTC (rev 1271)
@@ -14,9 +14,7 @@
 
 
 		
-
 		
-		
 
 		
 



From oharboe at mail.berlios.de  Tue Dec 23 09:52:05 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 23 Dec 2008 09:52:05 +0100
Subject: [Openocd-svn] r1272 - in trunk/src/server: . httpd
Message-ID: <200812230852.mBN8q5t6019582@sheep.berlios.de>

Author: oharboe
Date: 2008-12-23 09:52:02 +0100 (Tue, 23 Dec 2008)
New Revision: 1272

Added:
   trunk/src/server/httpd/httpd.tcl
Removed:
   trunk/src/server/httpd/httpd.tcl
Modified:
   trunk/src/server/httpd.c
   trunk/src/server/httpd/build.sh
   trunk/src/server/httpd/erase.tcl
   trunk/src/server/httpd/menu.xml
   trunk/src/server/httpd/openocd.tcl
Log:
httpd wip

Modified: trunk/src/server/httpd/build.sh
===================================================================
--- trunk/src/server/httpd/build.sh	2008-12-22 15:24:35 UTC (rev 1271)
+++ trunk/src/server/httpd/build.sh	2008-12-23 08:52:02 UTC (rev 1272)
@@ -1,3 +1,5 @@
 set e
 java -classpath ../../../../zy1000/build/xalan.jar\;. Stylizer menu.xsl menu.xml .
 find . -regex ".*\.tcl" -type f -exec sh html2tcl.sh {} {} \;
+echo "Copy .tcl files to /usr/local/lib/openocd/httpd/"
+cp *.tcl /usr/local/lib/openocd/httpd/
\ No newline at end of file

Modified: trunk/src/server/httpd/erase.tcl
===================================================================
--- trunk/src/server/httpd/erase.tcl	2008-12-22 15:24:35 UTC (rev 1271)
+++ trunk/src/server/httpd/erase.tcl	2008-12-23 08:52:02 UTC (rev 1272)
@@ -161,7 +161,7 @@
 				set form_length 0x10000
 			}  
 			if {[string compare $form_address ""]==0} {
-				if {[catch {[zy1000_flash]} result]==0} {
+				if {[catch {[first_flash_base]} result]==0} {
 						set form_address "0x[tohex $result]"
 					}			
 			}  

Deleted: trunk/src/server/httpd/httpd.tcl
===================================================================
--- trunk/src/server/httpd/httpd.tcl	2008-12-22 15:24:35 UTC (rev 1271)
+++ trunk/src/server/httpd/httpd.tcl	2008-12-23 08:52:02 UTC (rev 1272)
@@ -1,113 +0,0 @@
-# some dummy proc's to get things going for test purposes
-
-
-
-proc ip {} {
-return 10.0.0.55
-}
-
-proc start_chunked {a} {
-	global httpdata
-	global httpmime
-	set httpmime $a
-	set httpdata ""
-}
-
-proc write_chunked {a} {
-	global httpdata
-	append httpdata $a
-}
-
-proc end_chunked {} {
-}
-
-
-
-#proc formfetch {a} {
-#	global httppostdata
-	#catch { 
-#	echo "$a=$httppostdata($a)"
-	#return $httppostdata($a) 
-	#}
-#	
-	#return ""  
-#}
-
-
-
-
-proc tohex {a} {
-   set r ""
-   while 1 {
-
-      set rem [expr $a%16]
-      set a [expr $a/16]
-      set r [string index "0123456789abcdef" $rem]$r
-      if ($a==0) then break
-   }  
-   return $r 
-}
-
-# encode text
-proc encode {a} {
-	return [string map {\n <br/> { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} > &gt; < &lt; / &#47;} $a]
-}
-
-#stubs that can be overriden to save between sessions
-proc load_var {a} {
-	global glob_var
-	catch {
-		return $glob_var($a)
-	}
-	return ""
-}
-#stubs that can be overriden to save between sessions
-proc save_var {a b} {
-	catch { 
-	set glob_var($a) $b
-	return ""
-	} err
-	set glob_var($a) ""
-	return ""
-}
-
-
-
-proc to_textarea {a} {
-	return [string map {& &#38; > &gt; < &lt; / &#47;} $a]
-}	
-
-proc from_textarea {a} {
-	return [string map {&gt; > &lt; < &#38; & &#47; /} $a]
-}
-	
-proc lunion {a b} {
-	foreach e $a {
-		set x($e) {}
-	}
- 	foreach e $b {
-		if {![info exists x($e)]} {
-    		lappend a $e
-		}
-	}
- 	return $a
-}
- 
-
-# encode text
-proc encode {a} {
-	return [string map {\n <br/> { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} > &gt; < &lt; / &#47;} $a]
-}
-
-# catch any exceptions, capture output and return it 
-proc capture_catch {a} {
-	catch {
-		return [eval {capture $a}]
-	} result
-	return $result
-}
-
-proc zy1000_flash {} {
-	set t [lindex 0 [ocd_flash_banks]]
-	return $t(base)
-}

Copied: trunk/src/server/httpd/httpd.tcl (from rev 1271, trunk/src/server/httpd/httpd.tcl)
===================================================================
--- trunk/src/server/httpd/httpd.tcl	2008-12-22 15:24:35 UTC (rev 1271)
+++ trunk/src/server/httpd/httpd.tcl	2008-12-23 08:52:02 UTC (rev 1272)
@@ -0,0 +1,113 @@
+# some dummy proc's to get things going for test purposes
+
+
+
+proc ip {} {
+return 10.0.0.55
+}
+
+proc start_chunked {a} {
+	global httpdata
+	global httpmime
+	set httpmime $a
+	set httpdata ""
+}
+
+proc write_chunked {a} {
+	global httpdata
+	append httpdata $a
+}
+
+proc end_chunked {} {
+}
+
+
+
+#proc formfetch {a} {
+#	global httppostdata
+	#catch { 
+#	echo "$a=$httppostdata($a)"
+	#return $httppostdata($a) 
+	#}
+#	
+	#return ""  
+#}
+
+
+
+
+proc tohex {a} {
+   set r ""
+   while 1 {
+
+      set rem [expr $a%16]
+      set a [expr $a/16]
+      set r [string index "0123456789abcdef" $rem]$r
+      if ($a==0) then break
+   }  
+   return $r 
+}
+
+# encode text
+proc encode {a} {
+	return [string map {\n <br/> { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} > &gt; < &lt; / &#47;} $a]
+}
+
+#stubs that can be overriden to save between sessions
+proc load_var {a} {
+	global glob_var
+	catch {
+		return $glob_var($a)
+	}
+	return ""
+}
+#stubs that can be overriden to save between sessions
+proc save_var {a b} {
+	catch { 
+	set glob_var($a) $b
+	return ""
+	} err
+	set glob_var($a) ""
+	return ""
+}
+
+
+
+proc to_textarea {a} {
+	return [string map {& &#38; > &gt; < &lt; / &#47;} $a]
+}	
+
+proc from_textarea {a} {
+	return [string map {&gt; > &lt; < &#38; & &#47; /} $a]
+}
+	
+proc lunion {a b} {
+	foreach e $a {
+		set x($e) {}
+	}
+ 	foreach e $b {
+		if {![info exists x($e)]} {
+    		lappend a $e
+		}
+	}
+ 	return $a
+}
+ 
+
+# encode text
+proc encode {a} {
+	return [string map {\n <br/> { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} > &gt; < &lt; / &#47;} $a]
+}
+
+# catch any exceptions, capture output and return it 
+proc capture_catch {a} {
+	catch {
+		capture {uplevel $a}
+	} result
+	return $result 
+}
+
+proc first_flash_base {} {
+	set t [lindex 0 [ocd_flash_banks]]
+	return $t(base)
+}


Property changes on: trunk/src/server/httpd/httpd.tcl
___________________________________________________________________
Name: svn:mergeinfo
   + 

Modified: trunk/src/server/httpd/menu.xml
===================================================================
--- trunk/src/server/httpd/menu.xml	2008-12-22 15:24:35 UTC (rev 1271)
+++ trunk/src/server/httpd/menu.xml	2008-12-23 08:52:02 UTC (rev 1272)
@@ -438,7 +438,7 @@
 				set form_length 0x10000
 			}  
 			if {[string compare $form_address ""]==0} {
-				if {[catch {[zy1000_flash]} result]==0} {
+				if {[catch {[first_flash_base]} result]==0} {
 						set form_address "0x[tohex $result]"
 					}			
 			}  
@@ -794,8 +794,8 @@
 				set form_command [formfetch form_command]
 
 				set form_edittext ""
-				if {[string length $form_command]>0} {				
-					catch {capture_catch {eval "$form_command"}} form_edittext
+				if {[string length $form_command]>0} {
+					set form_edittext [capture_catch {eval $form_command}]
 				}
 				
 				append buffer {<form action="openocd.tcl" method="post">} "\n"

Modified: trunk/src/server/httpd/openocd.tcl
===================================================================
--- trunk/src/server/httpd/openocd.tcl	2008-12-22 15:24:35 UTC (rev 1271)
+++ trunk/src/server/httpd/openocd.tcl	2008-12-23 08:52:02 UTC (rev 1272)
@@ -154,8 +154,8 @@
 				set form_command [formfetch form_command]
 
 				set form_edittext ""
-				if {[string length $form_command]>0} {				
-					catch {capture_catch {eval "$form_command"}} form_edittext
+				if {[string length $form_command]>0} {
+					set form_edittext [capture_catch {eval $form_command}]
 				}
 				
 				append buffer {<form action="openocd.tcl" method="post">} "\n"

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2008-12-22 15:24:35 UTC (rev 1271)
+++ trunk/src/server/httpd.c	2008-12-23 08:52:02 UTC (rev 1272)
@@ -429,9 +429,14 @@
 }
 
 static struct MHD_Daemon * d;
+static pthread_mutex_t mutex;
 
+
 int httpd_start(void)
 {
+	pthread_mutexattr_t attr;
+	pthread_mutexattr_init( &attr );
+	pthread_mutex_init( &mutex, &attr );
 
 	int port = 8888;
 	LOG_USER("Launching httpd server on port %d", port);
@@ -461,15 +466,16 @@
 void httpd_stop(void)
 {
 	MHD_stop_daemon(d);
+	pthread_mutex_destroy( &mutex );
 }
 
 void openocd_sleep_prelude(void)
 {
-	/* FIX!!!! add locking here!!!! */
+	pthread_mutex_unlock( &mutex );
 }
 
 void openocd_sleep_postlude(void)
 {
-	/* FIX!!!! add locking here!!!! */
+	pthread_mutex_lock( &mutex );
 }
 



From ntfreak at mail.berlios.de  Tue Dec 23 13:52:20 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Tue, 23 Dec 2008 13:52:20 +0100
Subject: [Openocd-svn] r1273 - in trunk/src/server/httpd: . menu_cuts
Message-ID: <200812231252.mBNCqKY7022574@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-23 13:52:14 +0100 (Tue, 23 Dec 2008)
New Revision: 1273

Modified:
   trunk/src/server/httpd/Stylizer.class
   trunk/src/server/httpd/Stylizer.java
   trunk/src/server/httpd/browsemem.tcl
   trunk/src/server/httpd/build.sh
   trunk/src/server/httpd/downloadmem.tcl
   trunk/src/server/httpd/editconfigs.tcl
   trunk/src/server/httpd/editfile.tcl
   trunk/src/server/httpd/erase.tcl
   trunk/src/server/httpd/flash.tcl
   trunk/src/server/httpd/flashinfo.tcl
   trunk/src/server/httpd/guiupload.tcl
   trunk/src/server/httpd/html2tcl.sh
   trunk/src/server/httpd/httpd.tcl
   trunk/src/server/httpd/index.tcl
   trunk/src/server/httpd/log.tcl
   trunk/src/server/httpd/menu.xml
   trunk/src/server/httpd/menu.xsl
   trunk/src/server/httpd/menu_cuts/center_bottom.png
   trunk/src/server/httpd/menu_cuts/center_top.png
   trunk/src/server/httpd/menu_cuts/h_tab1.png
   trunk/src/server/httpd/menu_cuts/h_tab1_selected.png
   trunk/src/server/httpd/menu_cuts/h_tab2.png
   trunk/src/server/httpd/menu_cuts/h_tab2_selected.png
   trunk/src/server/httpd/menu_cuts/h_tab_free.png
   trunk/src/server/httpd/menu_cuts/logo_bottom.png
   trunk/src/server/httpd/menu_cuts/logo_top.png
   trunk/src/server/httpd/menu_cuts/right_bottom.png
   trunk/src/server/httpd/menu_cuts/right_top.png
   trunk/src/server/httpd/menu_cuts/right_top_small.png
   trunk/src/server/httpd/menu_cuts/top_right.png
   trunk/src/server/httpd/menu_cuts/v_1.png
   trunk/src/server/httpd/menu_cuts/v_2_tile.png
   trunk/src/server/httpd/menu_cuts/v_3.png
   trunk/src/server/httpd/menu_cuts/v_tab.png
   trunk/src/server/httpd/menu_cuts/v_tab_selected.png
   trunk/src/server/httpd/menuweb.css
   trunk/src/server/httpd/openocd.tcl
   trunk/src/server/httpd/preconfig.tcl
   trunk/src/server/httpd/production.tcl
   trunk/src/server/httpd/readme.txt
   trunk/src/server/httpd/reload.tcl
   trunk/src/server/httpd/run.tcl
   trunk/src/server/httpd/support.tcl
   trunk/src/server/httpd/targets.tcl
   trunk/src/server/httpd/terminal.tcl
   trunk/src/server/httpd/upgrade.tcl
Log:
- add missing svn props from r1270 commit
- change mime-type for png files to image/png


Property changes on: trunk/src/server/httpd/Stylizer.class
___________________________________________________________________
Name: svn:executable
   + *


Property changes on: trunk/src/server/httpd/Stylizer.java
___________________________________________________________________
Name: svn:executable
   + *

Modified: trunk/src/server/httpd/browsemem.tcl
===================================================================
--- trunk/src/server/httpd/browsemem.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/browsemem.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,454 +1,454 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="browsemem.tcl" style="font-weight: bold;">Browse / Edit</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="downloadmem.tcl" style="">Download</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl" style="font-weight: bold;">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Browse / Edit Memory</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-
-
-			
-			}
-
-			
-			set form_address [formfetch form_address]
-			set form_length [formfetch form_length]
-			set form_type [formfetch form_type]
-			set form_action [formfetch form_action]
-			set form_value [formfetch form_value]
-			
-			if {[string compare $form_length ""]==0} {
-				set form_length 0
-			}  
-			if {$form_length<=0} {
-				set form_length 0x80
-			} 
-			if {$form_length>0x1000} {
-				set form_length 0x1000
-			} 
-			
-			if {[string compare $form_type ""]==0} {
-				set form_type mdw
-			}
-			
-			if {[string compare $form_type "mdw"]==0} {
-				set wordsize 4
-				set modify_cmd mww 
-			}
-			if {[string compare $form_type "mdh"]==0} {
-				set wordsize 2
-				set modify_cmd mwh 
-			}
-			if {[string compare $form_type "mdb"]==0} {
-				set wordsize 1
-				set modify_cmd mwb 
-			}
-			
-			
-			
-			
-			if {[string compare $form_address ""]!=0} {
-				if {[string compare $form_action "Previous"]==0} {
-					# Kludge! Work around problems parsing hex in Jim Tcl expressions
-					incr form_address ; set form_address [expr $form_address-1]
-					if {$form_address-$form_length>0} {
-						set form_address "0x[tohex [expr $form_address-$form_length]]"
-					} else {
-						set form_address "0x0"
-					}
-				}  
-				if {[string compare $form_action "Next"]==0} {
-					# Kludge! Work around problems parsing hex in Jim Tcl expressions
-					incr form_address ; set form_address [expr $form_address-1]
-					set form_address "0x[tohex [expr $form_address+$form_length]]"
-				}  
-				if {[string compare $form_action "Modify"]==0} {
-					append console [capture_catch "$modify_cmd $form_address $form_value"]
-				}  
-				if {[string compare $form_action "Fill"]==0} {
-					append console [capture_catch "$modify_cmd $form_address $form_value $form_length"]
-				}  
-			}
-			
-			
-			
-append buffer {
-			
-			<form action="browsemem.tcl" method="post"> 
-				<table>
-				<tr><td class="formtext">Address</td><td><input type="text" name="form_address" value="}
-append buffer $form_address
-append buffer {"></td></tr>
-				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="}
-append buffer "0x[tohex $form_length]"
-append buffer {"></td></tr>
-				<tr><td class="formtext">Value</td><td><input type="text" name="form_value" value="}
-append buffer $form_value
-append buffer {"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Modify"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Fill"></td></tr>
-				<tr><td class="formtext">Type</td><td style="padding-top:1px;">
-				<select name="form_type">
-				  <option 
-				    }
-if {[string compare $form_type "mdb"]==0} { append buffer {selected="selected"} }  
-append buffer { value ="mdb">8 bit
-				  </option>
-				  <option 
-				   }
-if {[string compare $form_type "mdh"]==0} { append buffer {selected="selected"} }  
-append buffer { value ="mdh">16 bit
-				  </option>
-			  		<option
-					   }
-if {[string compare $form_type "mdw"]==0} { append buffer {selected="selected"} }  
-append buffer {value ="mdw">32 bit
-				  	</option>
-				</select>
-				
-				</td></tr>
-				</table>
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-				<table><tr>
-					<td><input type="submit" name="form_action" value="Refresh"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Previous" ></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Next" ></td>
-				</tr></table>
-				<br>
-				
-			</form>
-			<p>
-			<div class="fontbigger">Memory:</div><p>
-			<code style="white-space: nowrap; font-size:11px;font:courier new;">
-				}
-
-				if {[string compare $form_address ""]!=0} {
-					append console [encode [capture_catch halt]]
-					append buffer [encode [capture_catch "$form_type $form_address [expr $form_length]"]]
-				} 
-				
-append buffer {
-			</code>
-
-
-			
-
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="browsemem.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				<p>Browse and edit target memory.<br>
-				   Length is in bytes, maximum 4096 bytes.</p> 
-				<p>An error message is shown when trying to browse or edit memory which cases a CPU fault.</p>
-				<p>CPU will be halted if required.</p>
-				<p><b>Modify</b> - Will modify only one byte, half-word or word starting at Address.</p>
-				<p><b>Fill</b> - Will fill the specified region with the specified value.</p>
-				<p><b>Refresh</b> - Display the content of the specified memory area.</p>
-					
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="browsemem.tcl" style="font-weight: bold;">Browse / Edit</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="downloadmem.tcl" style="">Download</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl" style="font-weight: bold;">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Browse / Edit Memory</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+
+
+			
+			}
+
+			
+			set form_address [formfetch form_address]
+			set form_length [formfetch form_length]
+			set form_type [formfetch form_type]
+			set form_action [formfetch form_action]
+			set form_value [formfetch form_value]
+			
+			if {[string compare $form_length ""]==0} {
+				set form_length 0
+			}  
+			if {$form_length<=0} {
+				set form_length 0x80
+			} 
+			if {$form_length>0x1000} {
+				set form_length 0x1000
+			} 
+			
+			if {[string compare $form_type ""]==0} {
+				set form_type mdw
+			}
+			
+			if {[string compare $form_type "mdw"]==0} {
+				set wordsize 4
+				set modify_cmd mww 
+			}
+			if {[string compare $form_type "mdh"]==0} {
+				set wordsize 2
+				set modify_cmd mwh 
+			}
+			if {[string compare $form_type "mdb"]==0} {
+				set wordsize 1
+				set modify_cmd mwb 
+			}
+			
+			
+			
+			
+			if {[string compare $form_address ""]!=0} {
+				if {[string compare $form_action "Previous"]==0} {
+					# Kludge! Work around problems parsing hex in Jim Tcl expressions
+					incr form_address ; set form_address [expr $form_address-1]
+					if {$form_address-$form_length>0} {
+						set form_address "0x[tohex [expr $form_address-$form_length]]"
+					} else {
+						set form_address "0x0"
+					}
+				}  
+				if {[string compare $form_action "Next"]==0} {
+					# Kludge! Work around problems parsing hex in Jim Tcl expressions
+					incr form_address ; set form_address [expr $form_address-1]
+					set form_address "0x[tohex [expr $form_address+$form_length]]"
+				}  
+				if {[string compare $form_action "Modify"]==0} {
+					append console [capture_catch "$modify_cmd $form_address $form_value"]
+				}  
+				if {[string compare $form_action "Fill"]==0} {
+					append console [capture_catch "$modify_cmd $form_address $form_value $form_length"]
+				}  
+			}
+			
+			
+			
+append buffer {
+			
+			<form action="browsemem.tcl" method="post"> 
+				<table>
+				<tr><td class="formtext">Address</td><td><input type="text" name="form_address" value="}
+append buffer $form_address
+append buffer {"></td></tr>
+				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="}
+append buffer "0x[tohex $form_length]"
+append buffer {"></td></tr>
+				<tr><td class="formtext">Value</td><td><input type="text" name="form_value" value="}
+append buffer $form_value
+append buffer {"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Modify"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Fill"></td></tr>
+				<tr><td class="formtext">Type</td><td style="padding-top:1px;">
+				<select name="form_type">
+				  <option 
+				    }
+if {[string compare $form_type "mdb"]==0} { append buffer {selected="selected"} }  
+append buffer { value ="mdb">8 bit
+				  </option>
+				  <option 
+				   }
+if {[string compare $form_type "mdh"]==0} { append buffer {selected="selected"} }  
+append buffer { value ="mdh">16 bit
+				  </option>
+			  		<option
+					   }
+if {[string compare $form_type "mdw"]==0} { append buffer {selected="selected"} }  
+append buffer {value ="mdw">32 bit
+				  	</option>
+				</select>
+				
+				</td></tr>
+				</table>
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+				<table><tr>
+					<td><input type="submit" name="form_action" value="Refresh"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Previous" ></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Next" ></td>
+				</tr></table>
+				<br>
+				
+			</form>
+			<p>
+			<div class="fontbigger">Memory:</div><p>
+			<code style="white-space: nowrap; font-size:11px;font:courier new;">
+				}
+
+				if {[string compare $form_address ""]!=0} {
+					append console [encode [capture_catch halt]]
+					append buffer [encode [capture_catch "$form_type $form_address [expr $form_length]"]]
+				} 
+				
+append buffer {
+			</code>
+
+
+			
+
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="browsemem.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				<p>Browse and edit target memory.<br>
+				   Length is in bytes, maximum 4096 bytes.</p> 
+				<p>An error message is shown when trying to browse or edit memory which cases a CPU fault.</p>
+				<p>CPU will be halted if required.</p>
+				<p><b>Modify</b> - Will modify only one byte, half-word or word starting at Address.</p>
+				<p><b>Fill</b> - Will fill the specified region with the specified value.</p>
+				<p><b>Refresh</b> - Display the content of the specified memory area.</p>
+					
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/browsemem.tcl
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/src/server/httpd/build.sh
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + LF

Modified: trunk/src/server/httpd/downloadmem.tcl
===================================================================
--- trunk/src/server/httpd/downloadmem.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/downloadmem.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,366 +1,366 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="browsemem.tcl" style="">Browse / Edit</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="downloadmem.tcl" style="font-weight: bold;">Download</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl" style="font-weight: bold;">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Download Memory Range</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			}
-
-				set form_address [formfetch form_address]
-				set form_length [formfetch form_length]
-				set form_action [formfetch form_action]
-			
-append buffer {			
-			<form action="downloadmem.tcl" method="post"> 
-				<table>
-				<tr><td class="formtext">Address</td><td><input type="text" name="form_address" value="}
-append buffer $form_address
-append buffer {"></td></tr>
-				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="}
-append buffer $form_length
-append buffer {"></td></tr>
-				</td></tr>
-				</table>
-
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-				<input type="submit" value="Download" name="form_action">
-				
-				
-			</form>
-			}
-
-				if {[string compare $form_action "Download"]==0} {
-					append console [encode [capture_catch "reset init"]]
-					append console [encode [capture_catch "dump_image /tmp/dump.bin $form_address $form_length"]]
-					
-append buffer {
-					<form action="../dump.bin" target="_blank"> 
-						<input type="submit" name="form_action" value="Save downloaded memory">
-					</form>
-					}
- 
-				}
-				
-			
-append buffer {
-
-
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="downloadmem.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-					
-				Download memory from target. <br>
-				<b>Note</b> that download memory can take
-				a long time(potentially minutes for megabytes at low JTAG clk speeds).
-				<p/>
-				Once the memory is downloaded a link is available on the page to download
-				the file to your PC.
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="browsemem.tcl" style="">Browse / Edit</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="downloadmem.tcl" style="font-weight: bold;">Download</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl" style="font-weight: bold;">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Download Memory Range</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			}
+
+				set form_address [formfetch form_address]
+				set form_length [formfetch form_length]
+				set form_action [formfetch form_action]
+			
+append buffer {			
+			<form action="downloadmem.tcl" method="post"> 
+				<table>
+				<tr><td class="formtext">Address</td><td><input type="text" name="form_address" value="}
+append buffer $form_address
+append buffer {"></td></tr>
+				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="}
+append buffer $form_length
+append buffer {"></td></tr>
+				</td></tr>
+				</table>
+
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+				<input type="submit" value="Download" name="form_action">
+				
+				
+			</form>
+			}
+
+				if {[string compare $form_action "Download"]==0} {
+					append console [encode [capture_catch "reset init"]]
+					append console [encode [capture_catch "dump_image /tmp/dump.bin $form_address $form_length"]]
+					
+append buffer {
+					<form action="../dump.bin" target="_blank"> 
+						<input type="submit" name="form_action" value="Save downloaded memory">
+					</form>
+					}
+ 
+				}
+				
+			
+append buffer {
+
+
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="downloadmem.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+					
+				Download memory from target. <br>
+				<b>Note</b> that download memory can take
+				a long time(potentially minutes for megabytes at low JTAG clk speeds).
+				<p/>
+				Once the memory is downloaded a link is available on the page to download
+				the file to your PC.
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/downloadmem.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/editconfigs.tcl
===================================================================
--- trunk/src/server/httpd/editconfigs.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/editconfigs.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,462 +1,462 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="index.tcl" style="">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="preconfig.tcl" style="">Select Target Config</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="editconfigs.tcl" style="font-weight: bold;">Edit Configurations</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="reload.tcl" style="">Reload Config Scripts</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Edit Target Configurations</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			<form action="editconfigs.tcl" method="post">
-			}
-
-				set form_edittext [formfetch form_edittext]
-				set form_action [formfetch form_action]
-				set form_filename [formfetch form_filename]
-				set form_selected [formfetch form_selected] 
-				
-				if {[string compare $form_action "Load"]==0} {
-					set form_filename $form_selected
-				}
-				
-				if {[string compare $form_action "Delete"]==0} {
-					capture_catch "rm /config/settings/$form_selected"
-				}
-				
-				if {[string compare $form_action "Save"]==0} {
-					save_var $form_filename [from_textarea $form_edittext] 
-					append buffer "Wrote file $form_filename<br>"
-				}
-			
-				set form_edittext ""
-				
-				# load original or script saved on disk.
-				if {[string compare $form_action "Show default"]==0} {
-					set form_edittext [load_file "/rom/$form_selected"]
-					set form_filename $form_selected
-				} else {
-				    set form_edittext [load_config $form_filename]
-				}
-			
-				set form_edittext_subst [to_textarea $form_edittext]
-			
-				
-				proc prepend { val list } {
-					set res ""				
-			        foreach value $list {
-			        	set t $val
-			        	append t $value
-			            lappend res $t
-			        }
-			        return $res
-				 }				
-				
-				set files [prepend target/ [ls /rom/target]]
-				set files [lunion $files [prepend event/ [ls /config/settings/event]]]
-				set files [lunion $files [prepend target/ [ls /config/settings/target]]]
-				set files [lsort $files]
-				
-				
-append buffer {
-				<table style="padding:0px;border-collapse:collapse;"><tr>
-					<td style="padding-top:1px;"><select name="form_selected">
-						}
-
-							set foundTarget 0
-							foreach i $files {
-								
-append buffer {
-							  		<option 
-							  		}
-
-								  		if {[string compare $form_filename $i]==0} { 
-											set foundTarget 1
-									  		append buffer {selected="selected"} 
-								  		}
-								  	
-append buffer {
-						  		value="}
-append buffer $i
-append buffer {">}
-append buffer $i
-append buffer {</option>
-								}
-
-							}
-							if {$foundTarget==0} {
-								
-append buffer {
-							  		<option selected="selected" value="">Select target config</option>
-								}
-
-							}
-						
-append buffer {
-					</select></td>
-					<td class="buttonspacesmall">&nbsp</td>
-					<td><input type="submit" value="Load" name="form_action"></td>
-					<td class="buttonspacesmall">&nbsp</td>
-					<td><input type="submit" value="Show default" name="form_action"></td>
-					<td class="buttonspacesmall">&nbsp</td>
-					<td><input type="submit" value="Delete" name="form_action"></td>
-				</tr></table>
-				<textarea  style="overflow:auto;"  rows="21" cols="65" name="form_edittext" wrap="off">}
-append buffer $form_edittext_subst
-append buffer {</textarea>
-				<table style="padding:0px;border-collapse:collapse;"><tr>
-				}
-
-					append buffer {<td class="formtext">File</td><td><input type="text" name="form_filename" } "\n"
-					append buffer "value=\"$form_filename\" ></td>\n"
-					append buffer {<td class="buttonspacesmall">&nbsp</td><td><input type="submit" value="Save" name="form_action"></td><br>} "\n"
-					append buffer {</tr></table>} "\n"
-				
-append buffer {
-			</form>			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="editconfigs.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				<p>Here you can edit predefined target configurations, restore predefined configurations to
-				default state and create new target configurations.<p/>
-				<p>Typically when creating a new target configuration, you would take an existing
-				configuration that resembles the most your needs and modify it for your
-				purposes and save it under a different name.</p>
-				<p><b>Load</b> - Loads a configuration file into the editor.</p>
-				<p><b>Show default</b> - Loads the firmware included version of the
-				configuration file (if any), into the editor.<br>
-				<b>Note</b> that the editor content is not saved.</p>
-				<p><b>Delete</b> - Deletes a custom created configuration file.<br>
-				<b>Note</b> that firmware included configuration files can not be deleted.</p>
-				<p><b>Save</b> - Save the edited file under the a new or the same name.</p>
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="menu_cuts/logo_bottom.png"/>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="index.tcl" style="">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="preconfig.tcl" style="">Select Target Config</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="editconfigs.tcl" style="font-weight: bold;">Edit Configurations</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="reload.tcl" style="">Reload Config Scripts</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Edit Target Configurations</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			<form action="editconfigs.tcl" method="post">
+			}
+
+				set form_edittext [formfetch form_edittext]
+				set form_action [formfetch form_action]
+				set form_filename [formfetch form_filename]
+				set form_selected [formfetch form_selected] 
+				
+				if {[string compare $form_action "Load"]==0} {
+					set form_filename $form_selected
+				}
+				
+				if {[string compare $form_action "Delete"]==0} {
+					capture_catch "rm /config/settings/$form_selected"
+				}
+				
+				if {[string compare $form_action "Save"]==0} {
+					save_var $form_filename [from_textarea $form_edittext] 
+					append buffer "Wrote file $form_filename<br>"
+				}
+			
+				set form_edittext ""
+				
+				# load original or script saved on disk.
+				if {[string compare $form_action "Show default"]==0} {
+					set form_edittext [load_file "/rom/$form_selected"]
+					set form_filename $form_selected
+				} else {
+				    set form_edittext [load_config $form_filename]
+				}
+			
+				set form_edittext_subst [to_textarea $form_edittext]
+			
+				
+				proc prepend { val list } {
+					set res ""				
+			        foreach value $list {
+			        	set t $val
+			        	append t $value
+			            lappend res $t
+			        }
+			        return $res
+				 }				
+				
+				set files [prepend target/ [ls /rom/target]]
+				set files [lunion $files [prepend event/ [ls /config/settings/event]]]
+				set files [lunion $files [prepend target/ [ls /config/settings/target]]]
+				set files [lsort $files]
+				
+				
+append buffer {
+				<table style="padding:0px;border-collapse:collapse;"><tr>
+					<td style="padding-top:1px;"><select name="form_selected">
+						}
+
+							set foundTarget 0
+							foreach i $files {
+								
+append buffer {
+							  		<option 
+							  		}
+
+								  		if {[string compare $form_filename $i]==0} { 
+											set foundTarget 1
+									  		append buffer {selected="selected"} 
+								  		}
+								  	
+append buffer {
+						  		value="}
+append buffer $i
+append buffer {">}
+append buffer $i
+append buffer {</option>
+								}
+
+							}
+							if {$foundTarget==0} {
+								
+append buffer {
+							  		<option selected="selected" value="">Select target config</option>
+								}
+
+							}
+						
+append buffer {
+					</select></td>
+					<td class="buttonspacesmall">&nbsp</td>
+					<td><input type="submit" value="Load" name="form_action"></td>
+					<td class="buttonspacesmall">&nbsp</td>
+					<td><input type="submit" value="Show default" name="form_action"></td>
+					<td class="buttonspacesmall">&nbsp</td>
+					<td><input type="submit" value="Delete" name="form_action"></td>
+				</tr></table>
+				<textarea  style="overflow:auto;"  rows="21" cols="65" name="form_edittext" wrap="off">}
+append buffer $form_edittext_subst
+append buffer {</textarea>
+				<table style="padding:0px;border-collapse:collapse;"><tr>
+				}
+
+					append buffer {<td class="formtext">File</td><td><input type="text" name="form_filename" } "\n"
+					append buffer "value=\"$form_filename\" ></td>\n"
+					append buffer {<td class="buttonspacesmall">&nbsp</td><td><input type="submit" value="Save" name="form_action"></td><br>} "\n"
+					append buffer {</tr></table>} "\n"
+				
+append buffer {
+			</form>			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="editconfigs.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				<p>Here you can edit predefined target configurations, restore predefined configurations to
+				default state and create new target configurations.<p/>
+				<p>Typically when creating a new target configuration, you would take an existing
+				configuration that resembles the most your needs and modify it for your
+				purposes and save it under a different name.</p>
+				<p><b>Load</b> - Loads a configuration file into the editor.</p>
+				<p><b>Show default</b> - Loads the firmware included version of the
+				configuration file (if any), into the editor.<br>
+				<b>Note</b> that the editor content is not saved.</p>
+				<p><b>Delete</b> - Deletes a custom created configuration file.<br>
+				<b>Note</b> that firmware included configuration files can not be deleted.</p>
+				<p><b>Save</b> - Save the edited file under the a new or the same name.</p>
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="menu_cuts/logo_bottom.png"/>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/editconfigs.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/editfile.tcl
===================================================================
--- trunk/src/server/httpd/editfile.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/editfile.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,436 +1,436 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="zy1000.tcl" style="">Set IP Address</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="editfile.tcl" style="font-weight: bold;">Edit File</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="support.tcl" style="">Support Request</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Edit File</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-}
-
-			
-
-#Read a text file, edit it and write it back. Useful for interactive debugging
-#of tcl scripts
-
-set data ""
-append buffer {<form action="editfile.tcl" method="post">} "\n"
-
-set err "";
-
-set form_edittext [formfetch form_edittext];
-set form_action [formfetch form_action];
-set form_filename [formfetch form_filename];
-
-puts Action $form_action
-
-if {[string compare $form_action "Load"]==0} {
-
-	set form_edittext ""
-	catch {
-		set fp [aio.open $form_filename r];
-		set form_edittext [$fp read];
-		$fp close;
-	} err
-}
-if {[string compare $form_action "Delete"]==0} {
-	capture "rm $form_filename"
-}
-
-set form_edittext_subst [to_textarea $form_edittext]
-
-
-if {[string compare $form_action "Save"]==0} {
-	if {[catch {
-		set fp [aio.open $form_filename w];
-		$fp puts [from_textarea $form_edittext]
-		$fp close
-		append buffer "Wrote file $form_filename<br>"
-	} err]} {
-		append buffer "Could not write $form_filename<br>"
-	} 
-}
-
-
-
-
-append buffer {<table><tr><td class="formtext">File</td><td style="padding-top:1px;"><input type="text" name="form_filename" } "\n"
-append buffer "value=\"$form_filename\" ></td>\n"
-append buffer {<td class="buttonspacesmall">&nbsp</td><td><input type="submit" value="Load" name="form_action" ></td><td class="buttonspacesmall">&nbsp</td><td><input type="submit" value="Save" name="form_action"></td><td class="buttonspacesmall">&nbsp</td><td><input type="submit" value="Delete" name="form_action"></td>} "\n"
-append buffer {</tr></table>} "\n"
-append buffer {<br>}	
-
-append buffer {<textarea  style="overflow:auto;"  rows="18" cols="65" name="form_edittext" wrap="off">}
-append buffer $form_edittext_subst
-append buffer {</textarea><br>}
-
-append buffer {</html> } "\n"
-
-
-	
-append buffer {
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="/ram/cgi/editfile.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				Edit any file on the ZY1000 by typing in the
-				filename and pressing Load.
-				</p>
-				<table style="line-height:17px;"><tr>
-					<td><a href="/ram" target="_blank">Browse files on /ram</a><br>
-					<a href="/config" target="_blank">Browse files on /config</a><br>
-					<a href="/rom" target="_blank">Browse files on /rom</a></td>
-				</tr></table>
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="menu_cuts/logo_bottom.png"/>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-
-
-		
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="zy1000.tcl" style="">Set IP Address</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="editfile.tcl" style="font-weight: bold;">Edit File</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="support.tcl" style="">Support Request</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Edit File</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+}
+
+			
+
+#Read a text file, edit it and write it back. Useful for interactive debugging
+#of tcl scripts
+
+set data ""
+append buffer {<form action="editfile.tcl" method="post">} "\n"
+
+set err "";
+
+set form_edittext [formfetch form_edittext];
+set form_action [formfetch form_action];
+set form_filename [formfetch form_filename];
+
+puts Action $form_action
+
+if {[string compare $form_action "Load"]==0} {
+
+	set form_edittext ""
+	catch {
+		set fp [aio.open $form_filename r];
+		set form_edittext [$fp read];
+		$fp close;
+	} err
+}
+if {[string compare $form_action "Delete"]==0} {
+	capture "rm $form_filename"
+}
+
+set form_edittext_subst [to_textarea $form_edittext]
+
+
+if {[string compare $form_action "Save"]==0} {
+	if {[catch {
+		set fp [aio.open $form_filename w];
+		$fp puts [from_textarea $form_edittext]
+		$fp close
+		append buffer "Wrote file $form_filename<br>"
+	} err]} {
+		append buffer "Could not write $form_filename<br>"
+	} 
+}
+
+
+
+
+append buffer {<table><tr><td class="formtext">File</td><td style="padding-top:1px;"><input type="text" name="form_filename" } "\n"
+append buffer "value=\"$form_filename\" ></td>\n"
+append buffer {<td class="buttonspacesmall">&nbsp</td><td><input type="submit" value="Load" name="form_action" ></td><td class="buttonspacesmall">&nbsp</td><td><input type="submit" value="Save" name="form_action"></td><td class="buttonspacesmall">&nbsp</td><td><input type="submit" value="Delete" name="form_action"></td>} "\n"
+append buffer {</tr></table>} "\n"
+append buffer {<br>}	
+
+append buffer {<textarea  style="overflow:auto;"  rows="18" cols="65" name="form_edittext" wrap="off">}
+append buffer $form_edittext_subst
+append buffer {</textarea><br>}
+
+append buffer {</html> } "\n"
+
+
+	
+append buffer {
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="/ram/cgi/editfile.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				Edit any file on the ZY1000 by typing in the
+				filename and pressing Load.
+				</p>
+				<table style="line-height:17px;"><tr>
+					<td><a href="/ram" target="_blank">Browse files on /ram</a><br>
+					<a href="/config" target="_blank">Browse files on /config</a><br>
+					<a href="/rom" target="_blank">Browse files on /rom</a></td>
+				</tr></table>
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="menu_cuts/logo_bottom.png"/>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+
+
+		
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/editfile.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/erase.tcl
===================================================================
--- trunk/src/server/httpd/erase.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/erase.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,387 +1,387 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="font-weight: bold;">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Erase Flash</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-
-
-			
-			}
-
-			
-			set form_address [formfetch form_address]
-			set form_length [formfetch form_length]
-			set form_action [formfetch form_action]
-			
-			if {[string compare $form_length ""]==0} {
-				set form_length 0x10000
-			}  
-			if {[string compare $form_address ""]==0} {
-				if {[catch {[first_flash_base]} result]==0} {
-						set form_address "0x[tohex $result]"
-					}			
-			}  
-			
-			
-			if {[string compare $form_address ""]!=0} {
-				if {[string compare $form_action "Erase"]==0} {
-						append buffer "<code style=\"white-space: nowrap;\">"
-						append console [encode [capture_catch {
-						reset init
-						flash erase_address $form_address $form_length}]]
-						append buffer </code>
-				}  
-			}
-			
-			
-			
-append buffer {
-			
-			<form action="erase.tcl" method="post"> 
-				<table>
-				<tr><td class="formtext" style="padding-right:10px;">Address</td><td><input type="text" name="form_address" value="}
-append buffer $form_address
-append buffer {"></td></tr>
-				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="}
-append buffer $form_length
-append buffer {"></td></tr>
-				</td></tr>
-				</table>
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-				<input type="submit" name="form_action" value="Erase"><br>
-				
-				
-			</form>
-			
-
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="erase.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				<p>Note that flash programming will erase flash if required.<p/>
-				<p>Reset and init CPU, then erase address range.</p>
-				<p>The length field is specified in number of bytes.</p>
-					
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="font-weight: bold;">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Erase Flash</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+
+
+			
+			}
+
+			
+			set form_address [formfetch form_address]
+			set form_length [formfetch form_length]
+			set form_action [formfetch form_action]
+			
+			if {[string compare $form_length ""]==0} {
+				set form_length 0x10000
+			}  
+			if {[string compare $form_address ""]==0} {
+				if {[catch {[first_flash_base]} result]==0} {
+						set form_address "0x[tohex $result]"
+					}			
+			}  
+			
+			
+			if {[string compare $form_address ""]!=0} {
+				if {[string compare $form_action "Erase"]==0} {
+						append buffer "<code style=\"white-space: nowrap;\">"
+						append console [encode [capture_catch {
+						reset init
+						flash erase_address $form_address $form_length}]]
+						append buffer </code>
+				}  
+			}
+			
+			
+			
+append buffer {
+			
+			<form action="erase.tcl" method="post"> 
+				<table>
+				<tr><td class="formtext" style="padding-right:10px;">Address</td><td><input type="text" name="form_address" value="}
+append buffer $form_address
+append buffer {"></td></tr>
+				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="}
+append buffer $form_length
+append buffer {"></td></tr>
+				</td></tr>
+				</table>
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+				<input type="submit" name="form_action" value="Erase"><br>
+				
+				
+			</form>
+			
+
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="erase.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				<p>Note that flash programming will erase flash if required.<p/>
+				<p>Reset and init CPU, then erase address range.</p>
+				<p>The length field is specified in number of bytes.</p>
+					
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/erase.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/flash.tcl
===================================================================
--- trunk/src/server/httpd/flash.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/flash.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,459 +1,459 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="font-weight: bold;">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Program / Verify Flash</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			
-			}
-
-			
-			set form_offset [formfetch form_offset]
-			set form_action [formfetch form_action]
-			set form_type [formfetch form_type]
-			
-			
-			set post ""
-			catch {set post $post_data} err
-			
-			if {[string compare $form_offset ""]==0} {
-				set form_offset 0
-			}
-			if {[string compare $form_type ""]==0} {
-				set form_type ""
-			}
-			
-			
-append buffer {<code style="white-space: nowrap;">}
-
-			
-			set data ""
-			append buffer {<form enctype="multipart/form-data" action="flash.tcl" method="post">}
-			
-			set action_reset [expr {[string length $form_action]!=0}] 
-			set action_flash [expr {[string compare $form_action "Flash"]==0 || [string compare $form_action "Flash and verify"]==0}] 
-			set action_verify [expr {[string compare $form_action "Verify"]==0 || [string compare $form_action "Flash and verify"]==0}]
-			
-			if {$action_reset} {
-				append console [encode [capture_catch "reset init"]]
-			}
-			
-append buffer {
-			</code>}
-
-				
-			append buffer {<table>}
-			append buffer {<tr><td class="formtext">File</td><td><input type="file" name="form_filecontent"></td></tr>}
-			append buffer "<tr><td class=\"formtext\" >Offset</td><td><input type=\"text\" name=\"form_offset\" value=\"$form_offset\"></td></tr>"
-			
-			
-append buffer {
-			<tr><td class="formtext" style="padding-top:1px;">Type</td><td>
-			<select name="form_type">
-			  		<option
-			   }
-if {[string compare $form_type ""]==0} { append buffer {selected="selected"} }  
-append buffer {
-			  		value ="">auto</option>
-			  <option 
-			   }
-if {[string compare $form_type "elf"]==0} { append buffer {selected="selected"} }  
-append buffer {
-			  value ="elf">elf</option>
-			  <option 
-			   }
-if {[string compare $form_type "bin"]==0} { append buffer {selected="selected"} }  
-append buffer {
-			  value ="bin">binary</option>
-			  <option 
-			   }
-if {[string compare $form_type "ihex"]==0} { append buffer {selected="selected"} }  
-append buffer {
-			  value ="ihex">ihex</option>
-			  <!-- broken <option value ="s19">s19</option> -->
-			</select>
-			</td>
-			
-			</tr>
-			
-			
-			</table>
-			
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-			<table><tr>
-				<td><input type="submit" name="form_action" value="Flash" ></td>
-				<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Flash and verify" ></td>
-				<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Verify" ></td>
-			</tr></table>
-		
-			<p>
-			}
-
-			
-			if {$action_flash||$action_verify} {
-				catch {writeform form_filecontent $upload_filename} result
-				append console [encode $result]
-			}
-			append buffer "<br>"
-			if {$action_flash} {
-				append console [encode [capture_catch "halt"]]
-				append buffer "<b>"
-				if {[catch {capture_catch {eval "flash write_image erase $upload_filename $form_offset $form_type"}} result]} {
-					append buffer "Flash write failed<br>"
-					append console [encode $result]
-				} else {
-					append buffer [encode $result]
-					append buffer "Flash write succeed<br>"
-				}
-				append buffer "</b>"
-			}
-			if {$action_verify} {
-				append console [encode [capture_catch "halt"]]
-				append buffer "<b>"
-				if {[catch {capture_catch {eval "verify_image $upload_filename $form_offset $form_type"}} result]} {
-					append buffer "Verify failed<br>"
-					append console [encode $result]
-				} else {
-					append buffer [encode $result]
-					append buffer "Verify succeed<br>"
-				}
-				append buffer "</b>"
-			}
-			
-append buffer {		
-				
-			</form>
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="flash.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				<p>Program and/or verify the flash on your target.</p>
-				<p><b>Flash</b> - Halt CPU, automatically erase flash if required and program flash with image.</p>
-				<p><b>Flash and verify</b> - Programs the flash and verifies the programmed flash content is correct.</p>
-				<p><b>Verify</b> - Halt CPU and verify image in flash or RAM.</p>
-				<p><b>Offset</b> - This value is added to the address of the image.<br> 
-					Binary images start at address 0 by default, whereas elf and ihex have addresses encoded into the image.<br> 
-					Typically 0 for elf/ihex and the address to	write the image to for binary files.</p>
-					 
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="font-weight: bold;">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Program / Verify Flash</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			
+			}
+
+			
+			set form_offset [formfetch form_offset]
+			set form_action [formfetch form_action]
+			set form_type [formfetch form_type]
+			
+			
+			set post ""
+			catch {set post $post_data} err
+			
+			if {[string compare $form_offset ""]==0} {
+				set form_offset 0
+			}
+			if {[string compare $form_type ""]==0} {
+				set form_type ""
+			}
+			
+			
+append buffer {<code style="white-space: nowrap;">}
+
+			
+			set data ""
+			append buffer {<form enctype="multipart/form-data" action="flash.tcl" method="post">}
+			
+			set action_reset [expr {[string length $form_action]!=0}] 
+			set action_flash [expr {[string compare $form_action "Flash"]==0 || [string compare $form_action "Flash and verify"]==0}] 
+			set action_verify [expr {[string compare $form_action "Verify"]==0 || [string compare $form_action "Flash and verify"]==0}]
+			
+			if {$action_reset} {
+				append console [encode [capture_catch "reset init"]]
+			}
+			
+append buffer {
+			</code>}
+
+				
+			append buffer {<table>}
+			append buffer {<tr><td class="formtext">File</td><td><input type="file" name="form_filecontent"></td></tr>}
+			append buffer "<tr><td class=\"formtext\" >Offset</td><td><input type=\"text\" name=\"form_offset\" value=\"$form_offset\"></td></tr>"
+			
+			
+append buffer {
+			<tr><td class="formtext" style="padding-top:1px;">Type</td><td>
+			<select name="form_type">
+			  		<option
+			   }
+if {[string compare $form_type ""]==0} { append buffer {selected="selected"} }  
+append buffer {
+			  		value ="">auto</option>
+			  <option 
+			   }
+if {[string compare $form_type "elf"]==0} { append buffer {selected="selected"} }  
+append buffer {
+			  value ="elf">elf</option>
+			  <option 
+			   }
+if {[string compare $form_type "bin"]==0} { append buffer {selected="selected"} }  
+append buffer {
+			  value ="bin">binary</option>
+			  <option 
+			   }
+if {[string compare $form_type "ihex"]==0} { append buffer {selected="selected"} }  
+append buffer {
+			  value ="ihex">ihex</option>
+			  <!-- broken <option value ="s19">s19</option> -->
+			</select>
+			</td>
+			
+			</tr>
+			
+			
+			</table>
+			
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+			<table><tr>
+				<td><input type="submit" name="form_action" value="Flash" ></td>
+				<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Flash and verify" ></td>
+				<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Verify" ></td>
+			</tr></table>
+		
+			<p>
+			}
+
+			
+			if {$action_flash||$action_verify} {
+				catch {writeform form_filecontent $upload_filename} result
+				append console [encode $result]
+			}
+			append buffer "<br>"
+			if {$action_flash} {
+				append console [encode [capture_catch "halt"]]
+				append buffer "<b>"
+				if {[catch {capture_catch {eval "flash write_image erase $upload_filename $form_offset $form_type"}} result]} {
+					append buffer "Flash write failed<br>"
+					append console [encode $result]
+				} else {
+					append buffer [encode $result]
+					append buffer "Flash write succeed<br>"
+				}
+				append buffer "</b>"
+			}
+			if {$action_verify} {
+				append console [encode [capture_catch "halt"]]
+				append buffer "<b>"
+				if {[catch {capture_catch {eval "verify_image $upload_filename $form_offset $form_type"}} result]} {
+					append buffer "Verify failed<br>"
+					append console [encode $result]
+				} else {
+					append buffer [encode $result]
+					append buffer "Verify succeed<br>"
+				}
+				append buffer "</b>"
+			}
+			
+append buffer {		
+				
+			</form>
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="flash.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				<p>Program and/or verify the flash on your target.</p>
+				<p><b>Flash</b> - Halt CPU, automatically erase flash if required and program flash with image.</p>
+				<p><b>Flash and verify</b> - Programs the flash and verifies the programmed flash content is correct.</p>
+				<p><b>Verify</b> - Halt CPU and verify image in flash or RAM.</p>
+				<p><b>Offset</b> - This value is added to the address of the image.<br> 
+					Binary images start at address 0 by default, whereas elf and ihex have addresses encoded into the image.<br> 
+					Typically 0 for elf/ihex and the address to	write the image to for binary files.</p>
+					 
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/flash.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/flashinfo.tcl
===================================================================
--- trunk/src/server/httpd/flashinfo.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/flashinfo.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,382 +1,382 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="font-weight: bold;">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Flash Information</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-
-			<div style="font-size:14px;">Configured flash banks:</div>
-			<p>			
-			<code style="white-space: nowrap;">
-				}
-
-					set flash_return [ocd_flash_banks]
-					if {[llength $flash_return]!=0} {
-						append buffer [encode [flash banks]]
-					
-						set form_action [formfetch form_action]
-						if {[string compare $form_action "Reset CPU and probe flash"]==0} {
-							append console [encode [capture_catch "reset init"]]
-							append buffer [encode [capture_catch "flash probe 0"]]
-							append buffer [encode [capture_catch "flash info 0"]]
-						}
-					} else {
-						append buffer "No flash bank configured."
-					}
-				
-append buffer {
-				<p>
-				<form action="flashinfo.tcl" method="post"> 
-					<input type="submit" name="form_action" value="Reset CPU and probe flash">
-				</form>
-				}
-
-					foreach a [ocd_flash_banks] {
-						append buffer "Flash bank at [format "0x%08x size 0x%08x" $a(base) $a(size)]: "
-						
-append buffer {
-							<form action="downloadmem.tcl" method="post"> 
-								<input type="hidden" name="form_address" value="}
-append buffer [format "0x%08x" $a(base)]
-append buffer {">
-								<input type="hidden" name="form_length" value="}
-append buffer [format "0x%08x" $a(size)]
-append buffer {">
-		
-								<input type="submit" value="Download" name="form_action">
-								<br>
-							</form>
-						}
-
-					}
-				
-append buffer {
-			</code>
-			
-
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="flashinfo.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				<p>Here you will find information about the flash chips that you have
-				in your configuration.<p/>
-				<p><b>Reset CPU and probe flash</b> - This will reset the CPU and show
-				you more detailed information about your flash. This includes information about
-				the different sectors in the flash, and the flash driver used.</p>
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="font-weight: bold;">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Flash Information</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+
+			<div style="font-size:14px;">Configured flash banks:</div>
+			<p>			
+			<code style="white-space: nowrap;">
+				}
+
+					set flash_return [ocd_flash_banks]
+					if {[llength $flash_return]!=0} {
+						append buffer [encode [flash banks]]
+					
+						set form_action [formfetch form_action]
+						if {[string compare $form_action "Reset CPU and probe flash"]==0} {
+							append console [encode [capture_catch "reset init"]]
+							append buffer [encode [capture_catch "flash probe 0"]]
+							append buffer [encode [capture_catch "flash info 0"]]
+						}
+					} else {
+						append buffer "No flash bank configured."
+					}
+				
+append buffer {
+				<p>
+				<form action="flashinfo.tcl" method="post"> 
+					<input type="submit" name="form_action" value="Reset CPU and probe flash">
+				</form>
+				}
+
+					foreach a [ocd_flash_banks] {
+						append buffer "Flash bank at [format "0x%08x size 0x%08x" $a(base) $a(size)]: "
+						
+append buffer {
+							<form action="downloadmem.tcl" method="post"> 
+								<input type="hidden" name="form_address" value="}
+append buffer [format "0x%08x" $a(base)]
+append buffer {">
+								<input type="hidden" name="form_length" value="}
+append buffer [format "0x%08x" $a(size)]
+append buffer {">
+		
+								<input type="submit" value="Download" name="form_action">
+								<br>
+							</form>
+						}
+
+					}
+				
+append buffer {
+			</code>
+			
+
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="flashinfo.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				<p>Here you will find information about the flash chips that you have
+				in your configuration.<p/>
+				<p><b>Reset CPU and probe flash</b> - This will reset the CPU and show
+				you more detailed information about your flash. This includes information about
+				the different sectors in the flash, and the flash driver used.</p>
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/flashinfo.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/guiupload.tcl
===================================================================
--- trunk/src/server/httpd/guiupload.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/guiupload.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,336 +1,336 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="openocd.tcl" style="">Run Command</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="guiupload.tcl" style="font-weight: bold;">Upload File</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl" style="font-weight: bold;">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Upload File</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			
-			}
-
-				set form_filename [formfetch form_filename];
-				set form_action [formfetch form_action];
-				#set form_filecontent [formfetch form_filecontent];
-				
-				append buffer {<form enctype="multipart/form-data" action="guiupload.tcl" method="post">}
-				append buffer <br> 
-				if {[string compare $form_action "Upload"]==0} {
-					if {[catch {writeform form_filecontent $form_filename} result]==0} {
-						append buffer [encode $result]
-					} else {
-						append buffer Wrote $form_filename
-					}
-				}
-				
-				append buffer {<table style="padding:0px;border-collapse:collapse;"><tr><td class="formtext">Filename on OpenOCD machine</td><td><input type="text" name="form_filename"></td></tr>}
-				append buffer {<td class="formtext">File to upload</td><td><input type="file" name="form_filecontent"></td></tr></table>}
-				append buffer {<table><tr><td style="height:15px;width:535px;">&nbsp</td></tr><tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr><tr><td style="height:15px;width:535px;">&nbsp</td></tr></table>}
-				append buffer {<input type="submit" name="form_action" value="Upload" ><br> }
-				append buffer {</form>}
-			
-			
-append buffer {
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="guiupload.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray"/>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="openocd.tcl" style="">Run Command</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="guiupload.tcl" style="font-weight: bold;">Upload File</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl" style="font-weight: bold;">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Upload File</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			
+			}
+
+				set form_filename [formfetch form_filename];
+				set form_action [formfetch form_action];
+				#set form_filecontent [formfetch form_filecontent];
+				
+				append buffer {<form enctype="multipart/form-data" action="guiupload.tcl" method="post">}
+				append buffer <br> 
+				if {[string compare $form_action "Upload"]==0} {
+					if {[catch {writeform form_filecontent $form_filename} result]==0} {
+						append buffer [encode $result]
+					} else {
+						append buffer Wrote $form_filename
+					}
+				}
+				
+				append buffer {<table style="padding:0px;border-collapse:collapse;"><tr><td class="formtext">Filename on OpenOCD machine</td><td><input type="text" name="form_filename"></td></tr>}
+				append buffer {<td class="formtext">File to upload</td><td><input type="file" name="form_filecontent"></td></tr></table>}
+				append buffer {<table><tr><td style="height:15px;width:535px;">&nbsp</td></tr><tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr><tr><td style="height:15px;width:535px;">&nbsp</td></tr></table>}
+				append buffer {<input type="submit" name="form_action" value="Upload" ><br> }
+				append buffer {</form>}
+			
+			
+append buffer {
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="guiupload.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray"/>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/guiupload.tcl
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/src/server/httpd/html2tcl.sh
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + LF

Modified: trunk/src/server/httpd/httpd.tcl
===================================================================
--- trunk/src/server/httpd/httpd.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/httpd.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,113 +1,113 @@
-# some dummy proc's to get things going for test purposes
-
-
-
-proc ip {} {
-return 10.0.0.55
-}
-
-proc start_chunked {a} {
-	global httpdata
-	global httpmime
-	set httpmime $a
-	set httpdata ""
-}
-
-proc write_chunked {a} {
-	global httpdata
-	append httpdata $a
-}
-
-proc end_chunked {} {
-}
-
-
-
-#proc formfetch {a} {
-#	global httppostdata
-	#catch { 
-#	echo "$a=$httppostdata($a)"
-	#return $httppostdata($a) 
-	#}
-#	
-	#return ""  
-#}
-
-
-
-
-proc tohex {a} {
-   set r ""
-   while 1 {
-
-      set rem [expr $a%16]
-      set a [expr $a/16]
-      set r [string index "0123456789abcdef" $rem]$r
-      if ($a==0) then break
-   }  
-   return $r 
-}
-
-# encode text
-proc encode {a} {
-	return [string map {\n <br/> { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} > &gt; < &lt; / &#47;} $a]
-}
-
-#stubs that can be overriden to save between sessions
-proc load_var {a} {
-	global glob_var
-	catch {
-		return $glob_var($a)
-	}
-	return ""
-}
-#stubs that can be overriden to save between sessions
-proc save_var {a b} {
-	catch { 
-	set glob_var($a) $b
-	return ""
-	} err
-	set glob_var($a) ""
-	return ""
-}
-
-
-
-proc to_textarea {a} {
-	return [string map {& &#38; > &gt; < &lt; / &#47;} $a]
-}	
-
-proc from_textarea {a} {
-	return [string map {&gt; > &lt; < &#38; & &#47; /} $a]
-}
-	
-proc lunion {a b} {
-	foreach e $a {
-		set x($e) {}
-	}
- 	foreach e $b {
-		if {![info exists x($e)]} {
-    		lappend a $e
-		}
-	}
- 	return $a
-}
- 
-
-# encode text
-proc encode {a} {
-	return [string map {\n <br/> { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} > &gt; < &lt; / &#47;} $a]
-}
-
-# catch any exceptions, capture output and return it 
-proc capture_catch {a} {
-	catch {
-		capture {uplevel $a}
-	} result
-	return $result 
-}
-
-proc first_flash_base {} {
-	set t [lindex 0 [ocd_flash_banks]]
-	return $t(base)
-}
+# some dummy proc's to get things going for test purposes
+
+
+
+proc ip {} {
+return 10.0.0.55
+}
+
+proc start_chunked {a} {
+	global httpdata
+	global httpmime
+	set httpmime $a
+	set httpdata ""
+}
+
+proc write_chunked {a} {
+	global httpdata
+	append httpdata $a
+}
+
+proc end_chunked {} {
+}
+
+
+
+#proc formfetch {a} {
+#	global httppostdata
+	#catch { 
+#	echo "$a=$httppostdata($a)"
+	#return $httppostdata($a) 
+	#}
+#	
+	#return ""  
+#}
+
+
+
+
+proc tohex {a} {
+   set r ""
+   while 1 {
+
+      set rem [expr $a%16]
+      set a [expr $a/16]
+      set r [string index "0123456789abcdef" $rem]$r
+      if ($a==0) then break
+   }  
+   return $r 
+}
+
+# encode text
+proc encode {a} {
+	return [string map {\n <br/> { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} > &gt; < &lt; / &#47;} $a]
+}
+
+#stubs that can be overriden to save between sessions
+proc load_var {a} {
+	global glob_var
+	catch {
+		return $glob_var($a)
+	}
+	return ""
+}
+#stubs that can be overriden to save between sessions
+proc save_var {a b} {
+	catch { 
+	set glob_var($a) $b
+	return ""
+	} err
+	set glob_var($a) ""
+	return ""
+}
+
+
+
+proc to_textarea {a} {
+	return [string map {& &#38; > &gt; < &lt; / &#47;} $a]
+}	
+
+proc from_textarea {a} {
+	return [string map {&gt; > &lt; < &#38; & &#47; /} $a]
+}
+	
+proc lunion {a b} {
+	foreach e $a {
+		set x($e) {}
+	}
+ 	foreach e $b {
+		if {![info exists x($e)]} {
+    		lappend a $e
+		}
+	}
+ 	return $a
+}
+ 
+
+# encode text
+proc encode {a} {
+	return [string map {\n <br/> { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} > &gt; < &lt; / &#47;} $a]
+}
+
+# catch any exceptions, capture output and return it 
+proc capture_catch {a} {
+	catch {
+		capture {uplevel $a}
+	} result
+	return $result 
+}
+
+proc first_flash_base {} {
+	set t [lindex 0 [ocd_flash_banks]]
+	return $t(base)
+}


Property changes on: trunk/src/server/httpd/httpd.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/index.tcl
===================================================================
--- trunk/src/server/httpd/index.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/index.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,376 +1,376 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="index.tcl" style="font-weight: bold;">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>OpenOCD debugger</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-
-			
-			<table>
-				<tr><td style="height:10px;width:535px;">&nbsp</td></tr>
-				<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-				<tr><td style="height:5px;width:535px;">&nbsp</td></tr>
-			</table>
-
-			<H1>Target Status</H1>
-
-			<table>
-				<tr>
-					<td class="fontbigger">
-						}
-
-							set form_address [formfetch form_address]
-							set form_action [formfetch form_action]
-							
-							if {[string compare $form_action "Halt"]==0} {
-								append console [encode [capture_catch "halt"]]
-							}
-							if {[string compare $form_action "Resume"]==0} {
-								append console [encode [capture_catch "resume"]]
-							}
-							  
-							if {[string compare $form_action "Reset and run"]==0} {
-								append console [encode [capture_catch "reset run"]]
-							}
-							
-							if {[string compare $form_action "Power on"]==0} {
-								append console [encode [capture_catch "power on"]]
-							}
-							if {[string compare $form_action "Power off"]==0} {
-								append console [encode [capture_catch "power off"]]
-							}
-						
-append buffer {
-					
-						}
-append console [encode [capture_catch poll]]
-append buffer {
-					</td>
-				</tr>
-			</table>
-
-			<form action="index.tcl" method="post"> 
-				<table><tr>
-					<td><input type="submit" name="form_action" value="Reset and run"></td>
-					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Halt"></td>
-					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Resume"></td>
-					<td style="width:50px;"></td><td><input type="submit" name="form_action" value="Power on"></td>
-					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Power off"></td>
-				</tr></table>
-
-				<br>						
-				<br>						
-										
-				<p>
-			</form>
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="index.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-					<p>Target status shows that status of the connected target. </p> 
-					<p><b>Current target</b> - selected target configuration. <br>
-					<p><b>Startup</b> - whether or not the target script ran to completion. Note
-					that even if the target is disconnected, powered down or unresponsive, the
-					startup script will still run to completion. Startup - OK does not mean
-					that the target is fully operational, simply that the configuration script
-					did not contain syntax errors for instance. 
-					See log for details. <br>
-					<p><b>Target power</b> - Detects power on target. <br>
-					If the JTAG cable is not connected, or the target has no power, then no target power will be detected.</p>
-					<p>Type "help power" in telnet for command to control power relay.</p>
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="index.tcl" style="font-weight: bold;">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>OpenOCD debugger</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+
+			
+			<table>
+				<tr><td style="height:10px;width:535px;">&nbsp</td></tr>
+				<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+				<tr><td style="height:5px;width:535px;">&nbsp</td></tr>
+			</table>
+
+			<H1>Target Status</H1>
+
+			<table>
+				<tr>
+					<td class="fontbigger">
+						}
+
+							set form_address [formfetch form_address]
+							set form_action [formfetch form_action]
+							
+							if {[string compare $form_action "Halt"]==0} {
+								append console [encode [capture_catch "halt"]]
+							}
+							if {[string compare $form_action "Resume"]==0} {
+								append console [encode [capture_catch "resume"]]
+							}
+							  
+							if {[string compare $form_action "Reset and run"]==0} {
+								append console [encode [capture_catch "reset run"]]
+							}
+							
+							if {[string compare $form_action "Power on"]==0} {
+								append console [encode [capture_catch "power on"]]
+							}
+							if {[string compare $form_action "Power off"]==0} {
+								append console [encode [capture_catch "power off"]]
+							}
+						
+append buffer {
+					
+						}
+append console [encode [capture_catch poll]]
+append buffer {
+					</td>
+				</tr>
+			</table>
+
+			<form action="index.tcl" method="post"> 
+				<table><tr>
+					<td><input type="submit" name="form_action" value="Reset and run"></td>
+					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Halt"></td>
+					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Resume"></td>
+					<td style="width:50px;"></td><td><input type="submit" name="form_action" value="Power on"></td>
+					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Power off"></td>
+				</tr></table>
+
+				<br>						
+				<br>						
+										
+				<p>
+			</form>
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="index.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+					<p>Target status shows that status of the connected target. </p> 
+					<p><b>Current target</b> - selected target configuration. <br>
+					<p><b>Startup</b> - whether or not the target script ran to completion. Note
+					that even if the target is disconnected, powered down or unresponsive, the
+					startup script will still run to completion. Startup - OK does not mean
+					that the target is fully operational, simply that the configuration script
+					did not contain syntax errors for instance. 
+					See log for details. <br>
+					<p><b>Target power</b> - Detects power on target. <br>
+					If the JTAG cable is not connected, or the target has no power, then no target power will be detected.</p>
+					<p>Type "help power" in telnet for command to control power relay.</p>
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/index.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/log.tcl
===================================================================
--- trunk/src/server/httpd/log.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/log.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,343 +1,343 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="openocd.tcl" style="">Run Command</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="guiupload.tcl" style="">Upload File to ZY1000</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl" style="font-weight: bold;">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>View Tail of Log</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			}
-
-				append buffer "<code style=\"white-space: nowrap;\">"
-				append buffer [encode [log]]
-				append buffer {<p><p><p><a name="tail"/>} 
-				append buffer {<a href="log.tcl}
-				append buffer "?rnd=[rand]"
-				append buffer {#tail">Refresh</a>} 
-				append buffer {<p>} 
-				append buffer "</code>";
-			
-append buffer {
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="log.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray"/>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="menu_cuts/logo_bottom.png"/>
-</td>
-</tr>
-</table>
-</body>
-</html>
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="openocd.tcl" style="">Run Command</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="guiupload.tcl" style="">Upload File to ZY1000</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl" style="font-weight: bold;">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>View Tail of Log</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			}
+
+				append buffer "<code style=\"white-space: nowrap;\">"
+				append buffer [encode [log]]
+				append buffer {<p><p><p><a name="tail"/>} 
+				append buffer {<a href="log.tcl}
+				append buffer "?rnd=[rand]"
+				append buffer {#tail">Refresh</a>} 
+				append buffer {<p>} 
+				append buffer "</code>";
+			
+append buffer {
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="log.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray"/>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="menu_cuts/logo_bottom.png"/>
+</td>
+</tr>
+</table>
+</body>
+</html>
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/log.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/menu.xml
===================================================================
--- trunk/src/server/httpd/menu.xml	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/menu.xml	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,973 +1,973 @@
-<?xml version = "1.0" encoding="iso-8859-1" standalone="yes"?>
-<?xml-stylesheet type="text/xsl" href="plaintext.xsl"?>
-<website>
-	
-	<language lang="Norsk">
-
-		<page lang="eng">
-			<outfile>index.tcl</outfile>
-			<menutext>Config Target</menutext> 
-			<menulink>index.tcl</menulink> 
-			<pageheading>OpenOCD debugger</pageheading>
-			<level2parent>index.tcl</level2parent>
-			<level2menu href="index.tcl" title="Target Status" titlestyle="color:#4e6627;">
-			</level2menu>
-			<!-- 
-			<level2menu href="terminal.tcl" title="UART forwarding" titlestyle="color:#4e6627;">
-			</level2menu>
-			 -->
-		
-			<pagetext>
-			<markup_code><![CDATA[
-
-			
-			<table>
-				<tr><td style="height:10px;width:535px;">&nbsp</td></tr>
-				<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-				<tr><td style="height:5px;width:535px;">&nbsp</td></tr>
-			</table>
-
-			<H1>Target Status</H1>
-
-			<table>
-				<tr>
-					<td class="fontbigger">
-						<tcl>
-							set form_address [formfetch form_address]
-							set form_action [formfetch form_action]
-							
-							if {[string compare $form_action "Halt"]==0} {
-								append console [encode [capture_catch "halt"]]
-							}
-							if {[string compare $form_action "Resume"]==0} {
-								append console [encode [capture_catch "resume"]]
-							}
-							  
-							if {[string compare $form_action "Reset and run"]==0} {
-								append console [encode [capture_catch "reset run"]]
-							}
-							
-							if {[string compare $form_action "Power on"]==0} {
-								append console [encode [capture_catch "power on"]]
-							}
-							if {[string compare $form_action "Power off"]==0} {
-								append console [encode [capture_catch "power off"]]
-							}
-						</tcl>
-					
-						<tcl>append console [encode [capture_catch poll]]</tcl>
-					</td>
-				</tr>
-			</table>
-
-			<form action="index.tcl" method="post"> 
-				<table><tr>
-					<td><input type="submit" name="form_action" value="Reset and run"></td>
-					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Halt"></td>
-					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Resume"></td>
-					<td style="width:50px;"></td><td><input type="submit" name="form_action" value="Power on"></td>
-					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Power off"></td>
-				</tr></table>
-
-				<br>						
-				<br>						
-										
-				<p>
-			</form>
-			]]></markup_code>
-			<right_column>
-				<markup_code><![CDATA[
-					<p>Target status shows that status of the connected target. </p> 
-					<p><b>Current target</b> - selected target configuration. <br>
-					<p><b>Startup</b> - whether or not the target script ran to completion. Note
-					that even if the target is disconnected, powered down or unresponsive, the
-					startup script will still run to completion. Startup - OK does not mean
-					that the target is fully operational, simply that the configuration script
-					did not contain syntax errors for instance. 
-					See log for details. <br>
-					<p><b>Target power</b> - Detects power on target. <br>
-					If the JTAG cable is not connected, or the target has no power, then no target power will be detected.</p>
-					<p>Type "help power" in telnet for command to control power relay.</p>
-				]]></markup_code>
-			</right_column>
-			
-			</pagetext>
-		</page>
-		
-		
-
-
-		<page lang="eng">
-			<outfile>targets.tcl</outfile>
-			<level2parent>documentation.tcl</level2parent>
-			<pageheading>Target config quick start guide</pageheading>
-			<pagetext>
-				<markup_code><![CDATA[
-				
-				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either OpenOCD ships with an
-				openocd.cfg file for your target or you need to take an existing
-				config file and modify it for your needs.
-				<p> 
-				The reset init script is crucial. It will set up e.g. MMU, chip
-				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
-				<p>
-				Writing an openocd.cfg from scratch is a non-trivial exercise, but
-				fortunally it only has to be done once for a target and afterwards it
-				rarely if ever needs to be changed.
-				
-				
-				]]></markup_code>
-				<right_column>
-					
-					  Quick start guide on how to configure a target.
-				</right_column>
-			</pagetext>
-			
-			
-		</page>
-
-
-
-		
-		<page lang="eng">
-			<outfile>flashinfo.tcl</outfile>
-			<menutext>Flash</menutext> 
-			<menulink>flashinfo.tcl</menulink> 
-			<pageheading>Flash Information</pageheading>
-			<level2parent>flashinfo.tcl</level2parent>
-			<level2menu href="flashinfo.tcl" title="Info" titlestyle="color:#4e6627;">
-			</level2menu>
-			<level2menu href="erase.tcl" title="Erase" titlestyle="color:#4e6627;">
-			</level2menu>
-			<level2menu href="flash.tcl" title="Program / Verify" titlestyle="color:#4e6627;">
-			</level2menu>
-			<level2menu href="production.tcl" title="Production" titlestyle="color:#4e6627;">
-			</level2menu>
-
-			<pagetext>
-			<markup_code><![CDATA[
-
-			<div style="font-size:14px;">Configured flash banks:</div>
-			<p>			
-			<code style="white-space: nowrap;">
-				<tcl>
-					set flash_return [ocd_flash_banks]
-					if {[llength $flash_return]!=0} {
-						append buffer [encode [flash banks]]
-					
-						set form_action [formfetch form_action]
-						if {[string compare $form_action "Reset CPU and probe flash"]==0} {
-							append console [encode [capture_catch "reset init"]]
-							append buffer [encode [capture_catch "flash probe 0"]]
-							append buffer [encode [capture_catch "flash info 0"]]
-						}
-					} else {
-						append buffer "No flash bank configured."
-					}
-				</tcl>
-				<p>
-				<form action="flashinfo.tcl" method="post"> 
-					<input type="submit" name="form_action" value="Reset CPU and probe flash">
-				</form>
-				<tcl>
-					foreach a [ocd_flash_banks] {
-						append buffer "Flash bank at [format "0x%08x size 0x%08x" $a(base) $a(size)]: "
-						</tcl>
-							<form action="downloadmem.tcl" method="post"> 
-								<input type="hidden" name="form_address" value="<tcl>append buffer [format "0x%08x" $a(base)]</tcl>">
-								<input type="hidden" name="form_length" value="<tcl>append buffer [format "0x%08x" $a(size)]</tcl>">
-		
-								<input type="submit" value="Download" name="form_action">
-								<br>
-							</form>
-						<tcl>
-					}
-				</tcl>
-			</code>
-			
-
-			]]></markup_code>
-			<right_column>
-				<![CDATA[
-				<p>Here you will find information about the flash chips that you have
-				in your configuration.<p/>
-				<p><b>Reset CPU and probe flash</b> - This will reset the CPU and show
-				you more detailed information about your flash. This includes information about
-				the different sectors in the flash, and the flash driver used.</p>
-				]]>
-			</right_column>
-			
-			</pagetext>
-		</page>
-
-		<page lang="eng">
-			<outfile>flash.tcl</outfile>
-			<level2parent>flashinfo.tcl</level2parent>
-			<pageheading>Program / Verify Flash</pageheading>
-			<pagetext>
-			<markup_code><![CDATA[
-			
-			<tcl>
-			
-			set form_offset [formfetch form_offset]
-			set form_action [formfetch form_action]
-			set form_type [formfetch form_type]
-			
-			
-			set post ""
-			catch {set post $post_data} err
-			
-			if {[string compare $form_offset ""]==0} {
-				set form_offset 0
-			}
-			if {[string compare $form_type ""]==0} {
-				set form_type ""
-			}
-			
-			</tcl><code style="white-space: nowrap;"><tcl>
-			
-			set data ""
-			append buffer {<form enctype="multipart/form-data" action="flash.tcl" method="post">}
-			
-			set action_reset [expr {[string length $form_action]!=0}] 
-			set action_flash [expr {[string compare $form_action "Flash"]==0 || [string compare $form_action "Flash and verify"]==0}] 
-			set action_verify [expr {[string compare $form_action "Verify"]==0 || [string compare $form_action "Flash and verify"]==0}]
-			
-			if {$action_reset} {
-				append console [encode [capture_catch "reset init"]]
-			}
-			</tcl>
-			</code><tcl>
-				
-			append buffer {<table>}
-			append buffer {<tr><td class="formtext">File</td><td><input type="file" name="form_filecontent"></td></tr>}
-			append buffer "<tr><td class=\"formtext\" >Offset</td><td><input type=\"text\" name=\"form_offset\" value=\"$form_offset\"></td></tr>"
-			
-			</tcl>
-			<tr><td class="formtext" style="padding-top:1px;">Type</td><td>
-			<select name="form_type">
-			  		<option
-			   <tcl>if {[string compare $form_type ""]==0} { append buffer {selected="selected"} }  </tcl>
-			  		value ="">auto</option>
-			  <option 
-			   <tcl>if {[string compare $form_type "elf"]==0} { append buffer {selected="selected"} }  </tcl>
-			  value ="elf">elf</option>
-			  <option 
-			   <tcl>if {[string compare $form_type "bin"]==0} { append buffer {selected="selected"} }  </tcl>
-			  value ="bin">binary</option>
-			  <option 
-			   <tcl>if {[string compare $form_type "ihex"]==0} { append buffer {selected="selected"} }  </tcl>
-			  value ="ihex">ihex</option>
-			  <!-- broken <option value ="s19">s19</option> -->
-			</select>
-			</td>
-			
-			</tr>
-			
-			
-			</table>
-			
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-			<table><tr>
-				<td><input type="submit" name="form_action" value="Flash" ></td>
-				<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Flash and verify" ></td>
-				<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Verify" ></td>
-			</tr></table>
-		
-			<p>
-			<tcl>
-			
-			if {$action_flash||$action_verify} {
-				catch {writeform form_filecontent $upload_filename} result
-				append console [encode $result]
-			}
-			append buffer "<br>"
-			if {$action_flash} {
-				append console [encode [capture_catch "halt"]]
-				append buffer "<b>"
-				if {[catch {capture_catch {eval "flash write_image erase $upload_filename $form_offset $form_type"}} result]} {
-					append buffer "Flash write failed<br>"
-					append console [encode $result]
-				} else {
-					append buffer [encode $result]
-					append buffer "Flash write succeed<br>"
-				}
-				append buffer "</b>"
-			}
-			if {$action_verify} {
-				append console [encode [capture_catch "halt"]]
-				append buffer "<b>"
-				if {[catch {capture_catch {eval "verify_image $upload_filename $form_offset $form_type"}} result]} {
-					append buffer "Verify failed<br>"
-					append console [encode $result]
-				} else {
-					append buffer [encode $result]
-					append buffer "Verify succeed<br>"
-				}
-				append buffer "</b>"
-			}
-			</tcl>		
-				
-			</form>
-			
-			]]></markup_code>
-			
-			<right_column>
-				<![CDATA[
-				<p>Program and/or verify the flash on your target.</p>
-				<p><b>Flash</b> - Halt CPU, automatically erase flash if required and program flash with image.</p>
-				<p><b>Flash and verify</b> - Programs the flash and verifies the programmed flash content is correct.</p>
-				<p><b>Verify</b> - Halt CPU and verify image in flash or RAM.</p>
-				<p><b>Offset</b> - This value is added to the address of the image.<br> 
-					Binary images start at address 0 by default, whereas elf and ihex have addresses encoded into the image.<br> 
-					Typically 0 for elf/ihex and the address to	write the image to for binary files.</p>
-					]]> 
-			</right_column>
-			
-			
-			</pagetext>
-			
-		</page>
-
-
-
-
-		<page lang="eng">
-			<outfile>production.tcl</outfile>
-			<level2parent>flashinfo.tcl</level2parent>
-			<pageheading>Production</pageheading>
-			<pagetext>
-			<markup_code><![CDATA[
-			<tcl>
-				set form_action [formfetch form_action]
-				set form_serialnumber [formfetch form_serialnumber]
-				append buffer [production_info]
-			</tcl>
-				
-			<form enctype="multipart/form-data" action="production.tcl" method="post">
-				<code style="white-space: nowrap;">
-					<tcl>	
-						if {[string compare $form_action "Upload firmware"]==0} {
-							set wrotedata [catch {writeform form_filecontent $upload_filename} result]  
-							append buffer [encode $result]
-							if {$wrotedata==0} {
-								append buffer "<br>Running production procedure<p>"
-								append buffer "<br>Reset and init: <br>"
-								
-								append console [encode [capture_catch {catch "production $upload_filename $form_serialnumber"}]]
-							}
-						}
-						if {[string compare $form_action "Test"]==0} {
-							append buffer "<br>Running production test. Output from first 10 seconds printed below. <p>"
-							
-							append console [encode [capture_catch {catch production_test}]]
-						}
-						if {[string compare $form_action "Power on"]==0} {
-							append console [encode [capture_catch "power on"]]
-						}
-						if {[string compare $form_action "Power off"]==0} {
-							append console [encode [capture_catch "power off"]]
-						}
-					</tcl>
-				</code>
-				<tcl>
-					append buffer {<p class="formtext">Firmware file(raw binary) <input type="file" name="form_filecontent"><p>}
-					append buffer {<p class="formtext">Serial number <input type="text" name="form_serialnumber"><p>}
-				</tcl>
-				
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-				<table><tr>
-					<td><input type="submit" name="form_action" value="Upload firmware" ></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Test"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Power on"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Power off">
-				</tr></table>
-			</form>
-			
-			]]></markup_code>
-			
-			<right_column>
-				<![CDATA[
-				The target script can implement the "production", "production_info" and "production_test" tcl proc's. These procedures
-				are used on this page. There are default implementations that do nothing.
-				
-				<p><b>Upload firmware</b> - Power cycle target, reset target and program raw binary file to flash bank 0, offset 0 and verify flash programming. Leave target powered on.</p>
-				<p><b>Test</b> -  Power up target, run 10 second target test. Output is provided via the DCC output channel. </p>
-				<p><b>Power on</b> - Power on target.</p>
-				<p><b>Power off</b> - Power off target.</p>
-				<p><b>Serial number</b> - A target script can use this string in the production procedure. Type "help production" for more info.</p>
-					]]> 
-			</right_column>
-			
-			
-			</pagetext>
-			
-		</page>
-
-
-
-		<page lang="eng">
-			<outfile>erase.tcl</outfile>
-			<menulink>erase.tcl</menulink> 
-			<pageheading>Erase Flash</pageheading>
-			<level2parent>flashinfo.tcl</level2parent>
-			<pagetext>
-			<markup_code><![CDATA[
-
-
-			
-			<tcl>
-			
-			set form_address [formfetch form_address]
-			set form_length [formfetch form_length]
-			set form_action [formfetch form_action]
-			
-			if {[string compare $form_length ""]==0} {
-				set form_length 0x10000
-			}  
-			if {[string compare $form_address ""]==0} {
-				if {[catch {[first_flash_base]} result]==0} {
-						set form_address "0x[tohex $result]"
-					}			
-			}  
-			
-			
-			if {[string compare $form_address ""]!=0} {
-				if {[string compare $form_action "Erase"]==0} {
-						append buffer "<code style=\"white-space: nowrap;\">"
-						append console [encode [capture_catch {
-						reset init
-						flash erase_address $form_address $form_length}]]
-						append buffer </code>
-				}  
-			}
-			
-			
-			</tcl>
-			
-			<form action="erase.tcl" method="post"> 
-				<table>
-				<tr><td class="formtext" style="padding-right:10px;">Address</td><td><input type="text" name="form_address" value="<tcl>append buffer $form_address</tcl>"></td></tr>
-				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="<tcl>append buffer $form_length</tcl>"></td></tr>
-				</td></tr>
-				</table>
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-				<input type="submit" name="form_action" value="Erase"><br>
-				
-				
-			</form>
-			
-
-			
-			]]></markup_code>
-			<right_column>
-				<![CDATA[
-				<p>Note that flash programming will erase flash if required.<p/>
-				<p>Reset and init CPU, then erase address range.</p>
-				<p>The length field is specified in number of bytes.</p>
-					]]>
-			</right_column>
-			
-			</pagetext>
-		</page>
-
-
-		<page lang="eng">
-			<outfile>run.tcl</outfile>
-			<menulink>run.tcl</menulink> 
-			<pageheading>Run program</pageheading>
-			<level2parent>flashinfo.tcl</level2parent>
-			<pagetext>
-			<markup_code><![CDATA[
-
-
-			
-<tcl>
-
-set form_address [formfetch form_address]
-set form_action [formfetch form_action]
-
-if {[string compare $form_action "Run from address"]==0} {
-	append console [encode [capture_catch "halt"]]
-	append console [encode [capture_catch "wait_halt"]]
-	append console [encode [capture_catch "resume $form_address"]]
-}  
-
-if {[string compare $form_action "Halt"]==0} {
-	append console [encode [capture_catch "halt"]]
-	append console [encode [capture_catch "wait_halt"]]
-}
-  
-if {[string compare $form_action "Reset and run"]==0} {
-	append console [encode [capture_catch "reset run"]]
-}
-  
-if {[string compare $form_action "Reset and init"]==0} {
-	append console [encode [capture_catch "reset init"]]
-}  
-
-append console [encode [capture_catch poll]]
-
-</tcl>
-
-<form action="run.tcl" method="post"> 
-	<table>
-	<tr><td class="formtext" style="padding-right:10px;">Address</td><td><input type="text" name="form_address" value="<tcl>append buffer $form_address</tcl>"></td></tr>
-	</td></tr>
-	</table>
-	<table>
-		<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-		<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-		<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-	</table>
-	
-	<input type="submit" name="form_action" value="Reset and run"> <input type="submit" name="form_action" value="Run from address"> <input type="submit" name="form_action" value="Halt"><input type="submit" name="form_action" value="Reset and init"><br>
-</form>
-			
-
-			
-			]]></markup_code>
-			<right_column>
-				<![CDATA[
-				<p>Reset and run - reset CPU and let it run.</p>
-				<p>Halt - halt CPU.</p>
-				<p>Run from address - halt CPU and resume from address. Default is resume from current address.</p>
-				<p>Reset and init - reset CPU and run init script.</p>
-				]]>
-			</right_column>
-			
-			</pagetext>
-		</page>
-
-
-		<page lang="eng">
-			<outfile>browsemem.tcl</outfile>
-			<menutext>Memory</menutext> 
-			<menulink>browsemem.tcl</menulink> 
-			<pageheading>Browse / Edit Memory</pageheading>
-			<level2parent>browsemem.tcl</level2parent>
-			<level2menu href="browsemem.tcl" title="Browse / Edit" titlestyle="color:#4e6627;">
-			<![CDATA[
-				Browse and edit memory.
-			]]>
-			</level2menu>
-			<level2menu href="downloadmem.tcl" title="Download" titlestyle="color:#4e6627;">
-			<![CDATA[
-			    Copy memory range to developer machine
-			]]>
-			</level2menu>
-			
-			<pagetext>
-			<markup_code><![CDATA[
-
-
-			
-			<tcl>
-			
-			set form_address [formfetch form_address]
-			set form_length [formfetch form_length]
-			set form_type [formfetch form_type]
-			set form_action [formfetch form_action]
-			set form_value [formfetch form_value]
-			
-			if {[string compare $form_length ""]==0} {
-				set form_length 0
-			}  
-			if {$form_length<=0} {
-				set form_length 0x80
-			} 
-			if {$form_length>0x1000} {
-				set form_length 0x1000
-			} 
-			
-			if {[string compare $form_type ""]==0} {
-				set form_type mdw
-			}
-			
-			if {[string compare $form_type "mdw"]==0} {
-				set wordsize 4
-				set modify_cmd mww 
-			}
-			if {[string compare $form_type "mdh"]==0} {
-				set wordsize 2
-				set modify_cmd mwh 
-			}
-			if {[string compare $form_type "mdb"]==0} {
-				set wordsize 1
-				set modify_cmd mwb 
-			}
-			
-			
-			
-			
-			if {[string compare $form_address ""]!=0} {
-				if {[string compare $form_action "Previous"]==0} {
-					# Kludge! Work around problems parsing hex in Jim Tcl expressions
-					incr form_address ; set form_address [expr $form_address-1]
-					if {$form_address-$form_length>0} {
-						set form_address "0x[tohex [expr $form_address-$form_length]]"
-					} else {
-						set form_address "0x0"
-					}
-				}  
-				if {[string compare $form_action "Next"]==0} {
-					# Kludge! Work around problems parsing hex in Jim Tcl expressions
-					incr form_address ; set form_address [expr $form_address-1]
-					set form_address "0x[tohex [expr $form_address+$form_length]]"
-				}  
-				if {[string compare $form_action "Modify"]==0} {
-					append console [capture_catch "$modify_cmd $form_address $form_value"]
-				}  
-				if {[string compare $form_action "Fill"]==0} {
-					append console [capture_catch "$modify_cmd $form_address $form_value $form_length"]
-				}  
-			}
-			
-			
-			</tcl>
-			
-			<form action="browsemem.tcl" method="post"> 
-				<table>
-				<tr><td class="formtext">Address</td><td><input type="text" name="form_address" value="<tcl>append buffer $form_address</tcl>"></td></tr>
-				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="<tcl>append buffer "0x[tohex $form_length]"</tcl>"></td></tr>
-				<tr><td class="formtext">Value</td><td><input type="text" name="form_value" value="<tcl>append buffer $form_value</tcl>"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Modify"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Fill"></td></tr>
-				<tr><td class="formtext">Type</td><td style="padding-top:1px;">
-				<select name="form_type">
-				  <option 
-				    <tcl>if {[string compare $form_type "mdb"]==0} { append buffer {selected="selected"} }  </tcl> value ="mdb">8 bit
-				  </option>
-				  <option 
-				   <tcl>if {[string compare $form_type "mdh"]==0} { append buffer {selected="selected"} }  </tcl> value ="mdh">16 bit
-				  </option>
-			  		<option
-					   <tcl>if {[string compare $form_type "mdw"]==0} { append buffer {selected="selected"} }  </tcl>value ="mdw">32 bit
-				  	</option>
-				</select>
-				
-				</td></tr>
-				</table>
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-				<table><tr>
-					<td><input type="submit" name="form_action" value="Refresh"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Previous" ></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Next" ></td>
-				</tr></table>
-				<br>
-				
-			</form>
-			<p>
-			<div class="fontbigger">Memory:</div><p>
-			<code style="white-space: nowrap; font-size:11px;font:courier new;">
-				<tcl>
-				if {[string compare $form_address ""]!=0} {
-					append console [encode [capture_catch halt]]
-					append buffer [encode [capture_catch "$form_type $form_address [expr $form_length]"]]
-				} 
-				</tcl>
-			</code>
-
-
-			
-
-			
-			]]></markup_code>
-			<right_column>
-				<![CDATA[
-				<p>Browse and edit target memory.<br>
-				   Length is in bytes, maximum 4096 bytes.</p> 
-				<p>An error message is shown when trying to browse or edit memory which cases a CPU fault.</p>
-				<p>CPU will be halted if required.</p>
-				<p><b>Modify</b> - Will modify only one byte, half-word or word starting at Address.</p>
-				<p><b>Fill</b> - Will fill the specified region with the specified value.</p>
-				<p><b>Refresh</b> - Display the content of the specified memory area.</p>
-					]]>
-			</right_column>
-			
-			</pagetext>
-		</page>
-
-		
-
-
-		<page lang="eng">
-			<outfile>downloadmem.tcl</outfile>
-			<level2parent>browsemem.tcl</level2parent>
-			<pageheading>Download Memory Range</pageheading>
-			<pagetext>
-			<markup_code><![CDATA[
-			<tcl>
-				set form_address [formfetch form_address]
-				set form_length [formfetch form_length]
-				set form_action [formfetch form_action]
-			</tcl>			
-			<form action="downloadmem.tcl" method="post"> 
-				<table>
-				<tr><td class="formtext">Address</td><td><input type="text" name="form_address" value="<tcl>append buffer $form_address</tcl>"></td></tr>
-				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="<tcl>append buffer $form_length</tcl>"></td></tr>
-				</td></tr>
-				</table>
-
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-				<input type="submit" value="Download" name="form_action">
-				
-				
-			</form>
-			<tcl>
-				if {[string compare $form_action "Download"]==0} {
-					append console [encode [capture_catch "reset init"]]
-					append console [encode [capture_catch "dump_image /tmp/dump.bin $form_address $form_length"]]
-					</tcl>
-					<form action="../dump.bin" target="_blank"> 
-						<input type="submit" name="form_action" value="Save downloaded memory">
-					</form>
-					<tcl> 
-				}
-				
-			</tcl>
-
-
-			
-			]]></markup_code>
-			<right_column>
-				<![CDATA[	
-				Download memory from target. <br>
-				<b>Note</b> that download memory can take
-				a long time(potentially minutes for megabytes at low JTAG clk speeds).
-				<p/>
-				Once the memory is downloaded a link is available on the page to download
-				the file to your PC.
-				]]>
-			</right_column>
-			</pagetext>
-			
-		</page>
-
-
-
-		<page lang="eng">
-			<outfile>openocd.tcl</outfile>
-			<menutext>OpenOCD</menutext> 
-			<menulink>openocd.tcl</menulink> 
-			<pageheading>Run Command</pageheading>
-			<level2parent>openocd.tcl</level2parent>
-			<level2menu href="openocd.tcl" title="Run Command" titlestyle="color:#4e6627;">
-			</level2menu>
-			<level2menu href="guiupload.tcl" title="Upload File" titlestyle="color:#4e6627;">
-			<![CDATA[
-			    Upload file
-			]]>
-			</level2menu>
-			
-			<pagetext>
-			<markup_code><![CDATA[
-
-			<tcl>
-				set form_command [formfetch form_command]
-
-				set form_edittext ""
-				if {[string length $form_command]>0} {
-					set form_edittext [capture_catch {eval $form_command}]
-				}
-				
-				append buffer {<form action="openocd.tcl" method="post">} "\n"
-				append buffer {Command<br>}
-				append buffer {<textarea  style="overflow:auto;"  rows="5" cols="65" name="form_command" wrap="off">}
-				append buffer [to_textarea $form_command]
-				append buffer {</textarea><br>}
-				append buffer {<input type="submit" value="Run" name="form_action" ><br>}
-				append buffer {<textarea  style="overflow:auto;"  rows="21" cols="65" name="form_edittext" readonly=1 wrap="off">}
-				append buffer [to_textarea $form_edittext]
-				append buffer {</textarea><br>}
-				
-				append buffer {</form>} "\n"
-			
-			</tcl>
-
-			]]></markup_code>
-			
-			<right_column>
-				<![CDATA[
-				<p>Run tcl statement(s). Add "ocd_" prefix to OpenOCD commands otherwise
-				there will be no output, e.g. "reset init" use "ocd_reset init".
-				<p/>
-				<p><a href="/ram/log">Click here to download log</a>.</p>
-				<p>To download log you can also use commands like "wget http://<tcl>append buffer [ip]</tcl>/ram/log", or
-				point your web browser to said address.</p>
-				<p>
-				You can also execute tcl commands using curl from your developer PC:
-				</p>
-				<code>
-				curl --form form_command=ocd_version <tcl>append buffer [ip]</tcl>runtcl.tcl
-				</code>
-				
-				]]>
-			</right_column>
-			</pagetext>
-		</page>
-
-		
-		
-		<page lang="eng">
-			<outfile>guiupload.tcl</outfile>
-			<level2parent>openocd.tcl</level2parent>
-			<pageheading>Upload File</pageheading>
-			<pagetext>
-			<markup_code><![CDATA[
-			
-			<tcl>
-				set form_filename [formfetch form_filename];
-				set form_action [formfetch form_action];
-				#set form_filecontent [formfetch form_filecontent];
-				
-				append buffer {<form enctype="multipart/form-data" action="guiupload.tcl" method="post">}
-				append buffer <br> 
-				if {[string compare $form_action "Upload"]==0} {
-					if {[catch {writeform form_filecontent $form_filename} result]==0} {
-						append buffer [encode $result]
-					} else {
-						append buffer Wrote $form_filename
-					}
-				}
-				
-				append buffer {<table style="padding:0px;border-collapse:collapse;"><tr><td class="formtext">Filename on OpenOCD machine</td><td><input type="text" name="form_filename"></td></tr>}
-				append buffer {<td class="formtext">File to upload</td><td><input type="file" name="form_filecontent"></td></tr></table>}
-				append buffer {<table><tr><td style="height:15px;width:535px;">&nbsp</td></tr><tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr><tr><td style="height:15px;width:535px;">&nbsp</td></tr></table>}
-				append buffer {<input type="submit" name="form_action" value="Upload" ><br> }
-				append buffer {</form>}
-			
-			</tcl>
-			
-			]]></markup_code>
-			</pagetext>
-			
-		</page>
-		
-
-
-		<page lang="eng">
-			<outfile>targets.tcl</outfile>
-			<level2parent>documentation.tcl</level2parent>
-			<pageheading>Target config quick start guide</pageheading>
-			<pagetext>
-				<markup_code><![CDATA[
-				
-				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either OpenOCD ships with an
-				openocd.cfg file for your target or you need to take an existing
-				config file and modify it for your needs.
-				<p> 
-				The reset init script is crucial. It will set up e.g. MMU, chip
-				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
-				<p>
-				Writing an openocd.cfg from scratch is a non-trivial exercise, but
-				fortunally it only has to be done once for a target and afterwards it
-				rarely if ever needs to be changed.
-				
-				
-				]]></markup_code>
-				<right_column>
-					
-					  Quick start guide on how to configure a target.
-				</right_column>
-			</pagetext>
-			
-			
-		</page>
-
-
-		
-
-
-		<page lang="eng">
-			<menulink>index.tcl</menulink> 
-			<level2parent>index.tcl</level2parent>
-			<outfile>terminal.tcl</outfile>
-			<pageheading>UART forwarding</pageheading>
-			<pagetext>
-			<markup_code><![CDATA[
-			<tcl>
-				set form_baudrate [formfetch form_baudrate]
-				if {[string length $form_baudrate]==0} {
-					set form_baudrate [ocd_uart]
-					set form_baudrate [string range $form_baudrate 0 [expr [string length $form_baudrate]-2]]
-				}
-				set form_action [formfetch form_action]
-			</tcl>
-			<form action="terminal.tcl" method="post">
-				Target baudrate: 
-					<select name="form_baudrate">
-						<tcl>
-							foreach i {9600 19200 38400 57600 115200} { 
-							</tcl>
-				  				<option <tcl>if {[string compare $form_baudrate $i]==0} { append buffer {selected="selected"} }  </tcl>
-				  				value ="<tcl>append buffer $i</tcl>"><tcl>append buffer $i</tcl></option>
-				  			<tcl>
-				  			}
-				  			</tcl>
-						</select>
-
-					<p>	
-					<input type="submit" name="form_action" value="Set baudrate" >
-				</form>			
-			<tcl>
-				if {[string compare $form_action "Set baudrate"]==0} {
-					append console [encode [ocd_uart $form_baudrate]]
-				}
-			</tcl>
-			
-			<h2>Simple UART</h2>
-			This terminal window is purely for illustrative purposes. Use telnet or a terminal program
-			to talk to the target over TCP/IP for anything but trivial case of reading/writing a few
-			lines of texts in simple tests.
-			<p>
-			]]></markup_code>
-			<right_column>
-				<![CDATA[
-				Serial port data to target is forwarded(both directions) in the simple terminal window
-				to the left. Alternatively you can <b>telnet <tcl>append buffer [ip]</tcl> 5555</b>
-				or connect via TCP/IP from e.g. HyperTerminal.
-				<p>
-				Type "help uart" in telnet for information on how to set uart speed for target. Normally
-				the uart speed is set from the target configuration script by adding an "uart N", where
-				N is the baudrate.
-				]]>
-			</right_column>
-			</pagetext>
-			
-		</page>
-
-
-		
-	</language>
-	
+<?xml version = "1.0" encoding="iso-8859-1" standalone="yes"?>
+<?xml-stylesheet type="text/xsl" href="plaintext.xsl"?>
+<website>
+	
+	<language lang="Norsk">
+
+		<page lang="eng">
+			<outfile>index.tcl</outfile>
+			<menutext>Config Target</menutext> 
+			<menulink>index.tcl</menulink> 
+			<pageheading>OpenOCD debugger</pageheading>
+			<level2parent>index.tcl</level2parent>
+			<level2menu href="index.tcl" title="Target Status" titlestyle="color:#4e6627;">
+			</level2menu>
+			<!-- 
+			<level2menu href="terminal.tcl" title="UART forwarding" titlestyle="color:#4e6627;">
+			</level2menu>
+			 -->
+		
+			<pagetext>
+			<markup_code><![CDATA[
+
+			
+			<table>
+				<tr><td style="height:10px;width:535px;">&nbsp</td></tr>
+				<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+				<tr><td style="height:5px;width:535px;">&nbsp</td></tr>
+			</table>
+
+			<H1>Target Status</H1>
+
+			<table>
+				<tr>
+					<td class="fontbigger">
+						<tcl>
+							set form_address [formfetch form_address]
+							set form_action [formfetch form_action]
+							
+							if {[string compare $form_action "Halt"]==0} {
+								append console [encode [capture_catch "halt"]]
+							}
+							if {[string compare $form_action "Resume"]==0} {
+								append console [encode [capture_catch "resume"]]
+							}
+							  
+							if {[string compare $form_action "Reset and run"]==0} {
+								append console [encode [capture_catch "reset run"]]
+							}
+							
+							if {[string compare $form_action "Power on"]==0} {
+								append console [encode [capture_catch "power on"]]
+							}
+							if {[string compare $form_action "Power off"]==0} {
+								append console [encode [capture_catch "power off"]]
+							}
+						</tcl>
+					
+						<tcl>append console [encode [capture_catch poll]]</tcl>
+					</td>
+				</tr>
+			</table>
+
+			<form action="index.tcl" method="post"> 
+				<table><tr>
+					<td><input type="submit" name="form_action" value="Reset and run"></td>
+					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Halt"></td>
+					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Resume"></td>
+					<td style="width:50px;"></td><td><input type="submit" name="form_action" value="Power on"></td>
+					<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Power off"></td>
+				</tr></table>
+
+				<br>						
+				<br>						
+										
+				<p>
+			</form>
+			]]></markup_code>
+			<right_column>
+				<markup_code><![CDATA[
+					<p>Target status shows that status of the connected target. </p> 
+					<p><b>Current target</b> - selected target configuration. <br>
+					<p><b>Startup</b> - whether or not the target script ran to completion. Note
+					that even if the target is disconnected, powered down or unresponsive, the
+					startup script will still run to completion. Startup - OK does not mean
+					that the target is fully operational, simply that the configuration script
+					did not contain syntax errors for instance. 
+					See log for details. <br>
+					<p><b>Target power</b> - Detects power on target. <br>
+					If the JTAG cable is not connected, or the target has no power, then no target power will be detected.</p>
+					<p>Type "help power" in telnet for command to control power relay.</p>
+				]]></markup_code>
+			</right_column>
+			
+			</pagetext>
+		</page>
+		
+		
+
+
+		<page lang="eng">
+			<outfile>targets.tcl</outfile>
+			<level2parent>documentation.tcl</level2parent>
+			<pageheading>Target config quick start guide</pageheading>
+			<pagetext>
+				<markup_code><![CDATA[
+				
+				A target needs an openocd.cfg file. This config file sets up
+				the CPU, flash and reset init script. Either OpenOCD ships with an
+				openocd.cfg file for your target or you need to take an existing
+				config file and modify it for your needs.
+				<p> 
+				The reset init script is crucial. It will set up e.g. MMU, chip
+				select registers, etc. after a reset. The init.cfg (reset init script)
+				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
+				<p>
+				Writing an openocd.cfg from scratch is a non-trivial exercise, but
+				fortunally it only has to be done once for a target and afterwards it
+				rarely if ever needs to be changed.
+				
+				
+				]]></markup_code>
+				<right_column>
+					
+					  Quick start guide on how to configure a target.
+				</right_column>
+			</pagetext>
+			
+			
+		</page>
+
+
+
+		
+		<page lang="eng">
+			<outfile>flashinfo.tcl</outfile>
+			<menutext>Flash</menutext> 
+			<menulink>flashinfo.tcl</menulink> 
+			<pageheading>Flash Information</pageheading>
+			<level2parent>flashinfo.tcl</level2parent>
+			<level2menu href="flashinfo.tcl" title="Info" titlestyle="color:#4e6627;">
+			</level2menu>
+			<level2menu href="erase.tcl" title="Erase" titlestyle="color:#4e6627;">
+			</level2menu>
+			<level2menu href="flash.tcl" title="Program / Verify" titlestyle="color:#4e6627;">
+			</level2menu>
+			<level2menu href="production.tcl" title="Production" titlestyle="color:#4e6627;">
+			</level2menu>
+
+			<pagetext>
+			<markup_code><![CDATA[
+
+			<div style="font-size:14px;">Configured flash banks:</div>
+			<p>			
+			<code style="white-space: nowrap;">
+				<tcl>
+					set flash_return [ocd_flash_banks]
+					if {[llength $flash_return]!=0} {
+						append buffer [encode [flash banks]]
+					
+						set form_action [formfetch form_action]
+						if {[string compare $form_action "Reset CPU and probe flash"]==0} {
+							append console [encode [capture_catch "reset init"]]
+							append buffer [encode [capture_catch "flash probe 0"]]
+							append buffer [encode [capture_catch "flash info 0"]]
+						}
+					} else {
+						append buffer "No flash bank configured."
+					}
+				</tcl>
+				<p>
+				<form action="flashinfo.tcl" method="post"> 
+					<input type="submit" name="form_action" value="Reset CPU and probe flash">
+				</form>
+				<tcl>
+					foreach a [ocd_flash_banks] {
+						append buffer "Flash bank at [format "0x%08x size 0x%08x" $a(base) $a(size)]: "
+						</tcl>
+							<form action="downloadmem.tcl" method="post"> 
+								<input type="hidden" name="form_address" value="<tcl>append buffer [format "0x%08x" $a(base)]</tcl>">
+								<input type="hidden" name="form_length" value="<tcl>append buffer [format "0x%08x" $a(size)]</tcl>">
+		
+								<input type="submit" value="Download" name="form_action">
+								<br>
+							</form>
+						<tcl>
+					}
+				</tcl>
+			</code>
+			
+
+			]]></markup_code>
+			<right_column>
+				<![CDATA[
+				<p>Here you will find information about the flash chips that you have
+				in your configuration.<p/>
+				<p><b>Reset CPU and probe flash</b> - This will reset the CPU and show
+				you more detailed information about your flash. This includes information about
+				the different sectors in the flash, and the flash driver used.</p>
+				]]>
+			</right_column>
+			
+			</pagetext>
+		</page>
+
+		<page lang="eng">
+			<outfile>flash.tcl</outfile>
+			<level2parent>flashinfo.tcl</level2parent>
+			<pageheading>Program / Verify Flash</pageheading>
+			<pagetext>
+			<markup_code><![CDATA[
+			
+			<tcl>
+			
+			set form_offset [formfetch form_offset]
+			set form_action [formfetch form_action]
+			set form_type [formfetch form_type]
+			
+			
+			set post ""
+			catch {set post $post_data} err
+			
+			if {[string compare $form_offset ""]==0} {
+				set form_offset 0
+			}
+			if {[string compare $form_type ""]==0} {
+				set form_type ""
+			}
+			
+			</tcl><code style="white-space: nowrap;"><tcl>
+			
+			set data ""
+			append buffer {<form enctype="multipart/form-data" action="flash.tcl" method="post">}
+			
+			set action_reset [expr {[string length $form_action]!=0}] 
+			set action_flash [expr {[string compare $form_action "Flash"]==0 || [string compare $form_action "Flash and verify"]==0}] 
+			set action_verify [expr {[string compare $form_action "Verify"]==0 || [string compare $form_action "Flash and verify"]==0}]
+			
+			if {$action_reset} {
+				append console [encode [capture_catch "reset init"]]
+			}
+			</tcl>
+			</code><tcl>
+				
+			append buffer {<table>}
+			append buffer {<tr><td class="formtext">File</td><td><input type="file" name="form_filecontent"></td></tr>}
+			append buffer "<tr><td class=\"formtext\" >Offset</td><td><input type=\"text\" name=\"form_offset\" value=\"$form_offset\"></td></tr>"
+			
+			</tcl>
+			<tr><td class="formtext" style="padding-top:1px;">Type</td><td>
+			<select name="form_type">
+			  		<option
+			   <tcl>if {[string compare $form_type ""]==0} { append buffer {selected="selected"} }  </tcl>
+			  		value ="">auto</option>
+			  <option 
+			   <tcl>if {[string compare $form_type "elf"]==0} { append buffer {selected="selected"} }  </tcl>
+			  value ="elf">elf</option>
+			  <option 
+			   <tcl>if {[string compare $form_type "bin"]==0} { append buffer {selected="selected"} }  </tcl>
+			  value ="bin">binary</option>
+			  <option 
+			   <tcl>if {[string compare $form_type "ihex"]==0} { append buffer {selected="selected"} }  </tcl>
+			  value ="ihex">ihex</option>
+			  <!-- broken <option value ="s19">s19</option> -->
+			</select>
+			</td>
+			
+			</tr>
+			
+			
+			</table>
+			
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+			<table><tr>
+				<td><input type="submit" name="form_action" value="Flash" ></td>
+				<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Flash and verify" ></td>
+				<td class="buttonspacesmall"></td><td><input type="submit" name="form_action" value="Verify" ></td>
+			</tr></table>
+		
+			<p>
+			<tcl>
+			
+			if {$action_flash||$action_verify} {
+				catch {writeform form_filecontent $upload_filename} result
+				append console [encode $result]
+			}
+			append buffer "<br>"
+			if {$action_flash} {
+				append console [encode [capture_catch "halt"]]
+				append buffer "<b>"
+				if {[catch {capture_catch {eval "flash write_image erase $upload_filename $form_offset $form_type"}} result]} {
+					append buffer "Flash write failed<br>"
+					append console [encode $result]
+				} else {
+					append buffer [encode $result]
+					append buffer "Flash write succeed<br>"
+				}
+				append buffer "</b>"
+			}
+			if {$action_verify} {
+				append console [encode [capture_catch "halt"]]
+				append buffer "<b>"
+				if {[catch {capture_catch {eval "verify_image $upload_filename $form_offset $form_type"}} result]} {
+					append buffer "Verify failed<br>"
+					append console [encode $result]
+				} else {
+					append buffer [encode $result]
+					append buffer "Verify succeed<br>"
+				}
+				append buffer "</b>"
+			}
+			</tcl>		
+				
+			</form>
+			
+			]]></markup_code>
+			
+			<right_column>
+				<![CDATA[
+				<p>Program and/or verify the flash on your target.</p>
+				<p><b>Flash</b> - Halt CPU, automatically erase flash if required and program flash with image.</p>
+				<p><b>Flash and verify</b> - Programs the flash and verifies the programmed flash content is correct.</p>
+				<p><b>Verify</b> - Halt CPU and verify image in flash or RAM.</p>
+				<p><b>Offset</b> - This value is added to the address of the image.<br> 
+					Binary images start at address 0 by default, whereas elf and ihex have addresses encoded into the image.<br> 
+					Typically 0 for elf/ihex and the address to	write the image to for binary files.</p>
+					]]> 
+			</right_column>
+			
+			
+			</pagetext>
+			
+		</page>
+
+
+
+
+		<page lang="eng">
+			<outfile>production.tcl</outfile>
+			<level2parent>flashinfo.tcl</level2parent>
+			<pageheading>Production</pageheading>
+			<pagetext>
+			<markup_code><![CDATA[
+			<tcl>
+				set form_action [formfetch form_action]
+				set form_serialnumber [formfetch form_serialnumber]
+				append buffer [production_info]
+			</tcl>
+				
+			<form enctype="multipart/form-data" action="production.tcl" method="post">
+				<code style="white-space: nowrap;">
+					<tcl>	
+						if {[string compare $form_action "Upload firmware"]==0} {
+							set wrotedata [catch {writeform form_filecontent $upload_filename} result]  
+							append buffer [encode $result]
+							if {$wrotedata==0} {
+								append buffer "<br>Running production procedure<p>"
+								append buffer "<br>Reset and init: <br>"
+								
+								append console [encode [capture_catch {catch "production $upload_filename $form_serialnumber"}]]
+							}
+						}
+						if {[string compare $form_action "Test"]==0} {
+							append buffer "<br>Running production test. Output from first 10 seconds printed below. <p>"
+							
+							append console [encode [capture_catch {catch production_test}]]
+						}
+						if {[string compare $form_action "Power on"]==0} {
+							append console [encode [capture_catch "power on"]]
+						}
+						if {[string compare $form_action "Power off"]==0} {
+							append console [encode [capture_catch "power off"]]
+						}
+					</tcl>
+				</code>
+				<tcl>
+					append buffer {<p class="formtext">Firmware file(raw binary) <input type="file" name="form_filecontent"><p>}
+					append buffer {<p class="formtext">Serial number <input type="text" name="form_serialnumber"><p>}
+				</tcl>
+				
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+				<table><tr>
+					<td><input type="submit" name="form_action" value="Upload firmware" ></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Test"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Power on"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Power off">
+				</tr></table>
+			</form>
+			
+			]]></markup_code>
+			
+			<right_column>
+				<![CDATA[
+				The target script can implement the "production", "production_info" and "production_test" tcl proc's. These procedures
+				are used on this page. There are default implementations that do nothing.
+				
+				<p><b>Upload firmware</b> - Power cycle target, reset target and program raw binary file to flash bank 0, offset 0 and verify flash programming. Leave target powered on.</p>
+				<p><b>Test</b> -  Power up target, run 10 second target test. Output is provided via the DCC output channel. </p>
+				<p><b>Power on</b> - Power on target.</p>
+				<p><b>Power off</b> - Power off target.</p>
+				<p><b>Serial number</b> - A target script can use this string in the production procedure. Type "help production" for more info.</p>
+					]]> 
+			</right_column>
+			
+			
+			</pagetext>
+			
+		</page>
+
+
+
+		<page lang="eng">
+			<outfile>erase.tcl</outfile>
+			<menulink>erase.tcl</menulink> 
+			<pageheading>Erase Flash</pageheading>
+			<level2parent>flashinfo.tcl</level2parent>
+			<pagetext>
+			<markup_code><![CDATA[
+
+
+			
+			<tcl>
+			
+			set form_address [formfetch form_address]
+			set form_length [formfetch form_length]
+			set form_action [formfetch form_action]
+			
+			if {[string compare $form_length ""]==0} {
+				set form_length 0x10000
+			}  
+			if {[string compare $form_address ""]==0} {
+				if {[catch {[first_flash_base]} result]==0} {
+						set form_address "0x[tohex $result]"
+					}			
+			}  
+			
+			
+			if {[string compare $form_address ""]!=0} {
+				if {[string compare $form_action "Erase"]==0} {
+						append buffer "<code style=\"white-space: nowrap;\">"
+						append console [encode [capture_catch {
+						reset init
+						flash erase_address $form_address $form_length}]]
+						append buffer </code>
+				}  
+			}
+			
+			
+			</tcl>
+			
+			<form action="erase.tcl" method="post"> 
+				<table>
+				<tr><td class="formtext" style="padding-right:10px;">Address</td><td><input type="text" name="form_address" value="<tcl>append buffer $form_address</tcl>"></td></tr>
+				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="<tcl>append buffer $form_length</tcl>"></td></tr>
+				</td></tr>
+				</table>
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+				<input type="submit" name="form_action" value="Erase"><br>
+				
+				
+			</form>
+			
+
+			
+			]]></markup_code>
+			<right_column>
+				<![CDATA[
+				<p>Note that flash programming will erase flash if required.<p/>
+				<p>Reset and init CPU, then erase address range.</p>
+				<p>The length field is specified in number of bytes.</p>
+					]]>
+			</right_column>
+			
+			</pagetext>
+		</page>
+
+
+		<page lang="eng">
+			<outfile>run.tcl</outfile>
+			<menulink>run.tcl</menulink> 
+			<pageheading>Run program</pageheading>
+			<level2parent>flashinfo.tcl</level2parent>
+			<pagetext>
+			<markup_code><![CDATA[
+
+
+			
+<tcl>
+
+set form_address [formfetch form_address]
+set form_action [formfetch form_action]
+
+if {[string compare $form_action "Run from address"]==0} {
+	append console [encode [capture_catch "halt"]]
+	append console [encode [capture_catch "wait_halt"]]
+	append console [encode [capture_catch "resume $form_address"]]
+}  
+
+if {[string compare $form_action "Halt"]==0} {
+	append console [encode [capture_catch "halt"]]
+	append console [encode [capture_catch "wait_halt"]]
+}
+  
+if {[string compare $form_action "Reset and run"]==0} {
+	append console [encode [capture_catch "reset run"]]
+}
+  
+if {[string compare $form_action "Reset and init"]==0} {
+	append console [encode [capture_catch "reset init"]]
+}  
+
+append console [encode [capture_catch poll]]
+
+</tcl>
+
+<form action="run.tcl" method="post"> 
+	<table>
+	<tr><td class="formtext" style="padding-right:10px;">Address</td><td><input type="text" name="form_address" value="<tcl>append buffer $form_address</tcl>"></td></tr>
+	</td></tr>
+	</table>
+	<table>
+		<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+		<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+		<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+	</table>
+	
+	<input type="submit" name="form_action" value="Reset and run"> <input type="submit" name="form_action" value="Run from address"> <input type="submit" name="form_action" value="Halt"><input type="submit" name="form_action" value="Reset and init"><br>
+</form>
+			
+
+			
+			]]></markup_code>
+			<right_column>
+				<![CDATA[
+				<p>Reset and run - reset CPU and let it run.</p>
+				<p>Halt - halt CPU.</p>
+				<p>Run from address - halt CPU and resume from address. Default is resume from current address.</p>
+				<p>Reset and init - reset CPU and run init script.</p>
+				]]>
+			</right_column>
+			
+			</pagetext>
+		</page>
+
+
+		<page lang="eng">
+			<outfile>browsemem.tcl</outfile>
+			<menutext>Memory</menutext> 
+			<menulink>browsemem.tcl</menulink> 
+			<pageheading>Browse / Edit Memory</pageheading>
+			<level2parent>browsemem.tcl</level2parent>
+			<level2menu href="browsemem.tcl" title="Browse / Edit" titlestyle="color:#4e6627;">
+			<![CDATA[
+				Browse and edit memory.
+			]]>
+			</level2menu>
+			<level2menu href="downloadmem.tcl" title="Download" titlestyle="color:#4e6627;">
+			<![CDATA[
+			    Copy memory range to developer machine
+			]]>
+			</level2menu>
+			
+			<pagetext>
+			<markup_code><![CDATA[
+
+
+			
+			<tcl>
+			
+			set form_address [formfetch form_address]
+			set form_length [formfetch form_length]
+			set form_type [formfetch form_type]
+			set form_action [formfetch form_action]
+			set form_value [formfetch form_value]
+			
+			if {[string compare $form_length ""]==0} {
+				set form_length 0
+			}  
+			if {$form_length<=0} {
+				set form_length 0x80
+			} 
+			if {$form_length>0x1000} {
+				set form_length 0x1000
+			} 
+			
+			if {[string compare $form_type ""]==0} {
+				set form_type mdw
+			}
+			
+			if {[string compare $form_type "mdw"]==0} {
+				set wordsize 4
+				set modify_cmd mww 
+			}
+			if {[string compare $form_type "mdh"]==0} {
+				set wordsize 2
+				set modify_cmd mwh 
+			}
+			if {[string compare $form_type "mdb"]==0} {
+				set wordsize 1
+				set modify_cmd mwb 
+			}
+			
+			
+			
+			
+			if {[string compare $form_address ""]!=0} {
+				if {[string compare $form_action "Previous"]==0} {
+					# Kludge! Work around problems parsing hex in Jim Tcl expressions
+					incr form_address ; set form_address [expr $form_address-1]
+					if {$form_address-$form_length>0} {
+						set form_address "0x[tohex [expr $form_address-$form_length]]"
+					} else {
+						set form_address "0x0"
+					}
+				}  
+				if {[string compare $form_action "Next"]==0} {
+					# Kludge! Work around problems parsing hex in Jim Tcl expressions
+					incr form_address ; set form_address [expr $form_address-1]
+					set form_address "0x[tohex [expr $form_address+$form_length]]"
+				}  
+				if {[string compare $form_action "Modify"]==0} {
+					append console [capture_catch "$modify_cmd $form_address $form_value"]
+				}  
+				if {[string compare $form_action "Fill"]==0} {
+					append console [capture_catch "$modify_cmd $form_address $form_value $form_length"]
+				}  
+			}
+			
+			
+			</tcl>
+			
+			<form action="browsemem.tcl" method="post"> 
+				<table>
+				<tr><td class="formtext">Address</td><td><input type="text" name="form_address" value="<tcl>append buffer $form_address</tcl>"></td></tr>
+				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="<tcl>append buffer "0x[tohex $form_length]"</tcl>"></td></tr>
+				<tr><td class="formtext">Value</td><td><input type="text" name="form_value" value="<tcl>append buffer $form_value</tcl>"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Modify"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Fill"></td></tr>
+				<tr><td class="formtext">Type</td><td style="padding-top:1px;">
+				<select name="form_type">
+				  <option 
+				    <tcl>if {[string compare $form_type "mdb"]==0} { append buffer {selected="selected"} }  </tcl> value ="mdb">8 bit
+				  </option>
+				  <option 
+				   <tcl>if {[string compare $form_type "mdh"]==0} { append buffer {selected="selected"} }  </tcl> value ="mdh">16 bit
+				  </option>
+			  		<option
+					   <tcl>if {[string compare $form_type "mdw"]==0} { append buffer {selected="selected"} }  </tcl>value ="mdw">32 bit
+				  	</option>
+				</select>
+				
+				</td></tr>
+				</table>
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+				<table><tr>
+					<td><input type="submit" name="form_action" value="Refresh"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Previous" ></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Next" ></td>
+				</tr></table>
+				<br>
+				
+			</form>
+			<p>
+			<div class="fontbigger">Memory:</div><p>
+			<code style="white-space: nowrap; font-size:11px;font:courier new;">
+				<tcl>
+				if {[string compare $form_address ""]!=0} {
+					append console [encode [capture_catch halt]]
+					append buffer [encode [capture_catch "$form_type $form_address [expr $form_length]"]]
+				} 
+				</tcl>
+			</code>
+
+
+			
+
+			
+			]]></markup_code>
+			<right_column>
+				<![CDATA[
+				<p>Browse and edit target memory.<br>
+				   Length is in bytes, maximum 4096 bytes.</p> 
+				<p>An error message is shown when trying to browse or edit memory which cases a CPU fault.</p>
+				<p>CPU will be halted if required.</p>
+				<p><b>Modify</b> - Will modify only one byte, half-word or word starting at Address.</p>
+				<p><b>Fill</b> - Will fill the specified region with the specified value.</p>
+				<p><b>Refresh</b> - Display the content of the specified memory area.</p>
+					]]>
+			</right_column>
+			
+			</pagetext>
+		</page>
+
+		
+
+
+		<page lang="eng">
+			<outfile>downloadmem.tcl</outfile>
+			<level2parent>browsemem.tcl</level2parent>
+			<pageheading>Download Memory Range</pageheading>
+			<pagetext>
+			<markup_code><![CDATA[
+			<tcl>
+				set form_address [formfetch form_address]
+				set form_length [formfetch form_length]
+				set form_action [formfetch form_action]
+			</tcl>			
+			<form action="downloadmem.tcl" method="post"> 
+				<table>
+				<tr><td class="formtext">Address</td><td><input type="text" name="form_address" value="<tcl>append buffer $form_address</tcl>"></td></tr>
+				<tr><td class="formtext">Length</td><td><input type="text" name="form_length" value="<tcl>append buffer $form_length</tcl>"></td></tr>
+				</td></tr>
+				</table>
+
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+				<input type="submit" value="Download" name="form_action">
+				
+				
+			</form>
+			<tcl>
+				if {[string compare $form_action "Download"]==0} {
+					append console [encode [capture_catch "reset init"]]
+					append console [encode [capture_catch "dump_image /tmp/dump.bin $form_address $form_length"]]
+					</tcl>
+					<form action="../dump.bin" target="_blank"> 
+						<input type="submit" name="form_action" value="Save downloaded memory">
+					</form>
+					<tcl> 
+				}
+				
+			</tcl>
+
+
+			
+			]]></markup_code>
+			<right_column>
+				<![CDATA[	
+				Download memory from target. <br>
+				<b>Note</b> that download memory can take
+				a long time(potentially minutes for megabytes at low JTAG clk speeds).
+				<p/>
+				Once the memory is downloaded a link is available on the page to download
+				the file to your PC.
+				]]>
+			</right_column>
+			</pagetext>
+			
+		</page>
+
+
+
+		<page lang="eng">
+			<outfile>openocd.tcl</outfile>
+			<menutext>OpenOCD</menutext> 
+			<menulink>openocd.tcl</menulink> 
+			<pageheading>Run Command</pageheading>
+			<level2parent>openocd.tcl</level2parent>
+			<level2menu href="openocd.tcl" title="Run Command" titlestyle="color:#4e6627;">
+			</level2menu>
+			<level2menu href="guiupload.tcl" title="Upload File" titlestyle="color:#4e6627;">
+			<![CDATA[
+			    Upload file
+			]]>
+			</level2menu>
+			
+			<pagetext>
+			<markup_code><![CDATA[
+
+			<tcl>
+				set form_command [formfetch form_command]
+
+				set form_edittext ""
+				if {[string length $form_command]>0} {
+					set form_edittext [capture_catch {eval $form_command}]
+				}
+				
+				append buffer {<form action="openocd.tcl" method="post">} "\n"
+				append buffer {Command<br>}
+				append buffer {<textarea  style="overflow:auto;"  rows="5" cols="65" name="form_command" wrap="off">}
+				append buffer [to_textarea $form_command]
+				append buffer {</textarea><br>}
+				append buffer {<input type="submit" value="Run" name="form_action" ><br>}
+				append buffer {<textarea  style="overflow:auto;"  rows="21" cols="65" name="form_edittext" readonly=1 wrap="off">}
+				append buffer [to_textarea $form_edittext]
+				append buffer {</textarea><br>}
+				
+				append buffer {</form>} "\n"
+			
+			</tcl>
+
+			]]></markup_code>
+			
+			<right_column>
+				<![CDATA[
+				<p>Run tcl statement(s). Add "ocd_" prefix to OpenOCD commands otherwise
+				there will be no output, e.g. "reset init" use "ocd_reset init".
+				<p/>
+				<p><a href="/ram/log">Click here to download log</a>.</p>
+				<p>To download log you can also use commands like "wget http://<tcl>append buffer [ip]</tcl>/ram/log", or
+				point your web browser to said address.</p>
+				<p>
+				You can also execute tcl commands using curl from your developer PC:
+				</p>
+				<code>
+				curl --form form_command=ocd_version <tcl>append buffer [ip]</tcl>runtcl.tcl
+				</code>
+				
+				]]>
+			</right_column>
+			</pagetext>
+		</page>
+
+		
+		
+		<page lang="eng">
+			<outfile>guiupload.tcl</outfile>
+			<level2parent>openocd.tcl</level2parent>
+			<pageheading>Upload File</pageheading>
+			<pagetext>
+			<markup_code><![CDATA[
+			
+			<tcl>
+				set form_filename [formfetch form_filename];
+				set form_action [formfetch form_action];
+				#set form_filecontent [formfetch form_filecontent];
+				
+				append buffer {<form enctype="multipart/form-data" action="guiupload.tcl" method="post">}
+				append buffer <br> 
+				if {[string compare $form_action "Upload"]==0} {
+					if {[catch {writeform form_filecontent $form_filename} result]==0} {
+						append buffer [encode $result]
+					} else {
+						append buffer Wrote $form_filename
+					}
+				}
+				
+				append buffer {<table style="padding:0px;border-collapse:collapse;"><tr><td class="formtext">Filename on OpenOCD machine</td><td><input type="text" name="form_filename"></td></tr>}
+				append buffer {<td class="formtext">File to upload</td><td><input type="file" name="form_filecontent"></td></tr></table>}
+				append buffer {<table><tr><td style="height:15px;width:535px;">&nbsp</td></tr><tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr><tr><td style="height:15px;width:535px;">&nbsp</td></tr></table>}
+				append buffer {<input type="submit" name="form_action" value="Upload" ><br> }
+				append buffer {</form>}
+			
+			</tcl>
+			
+			]]></markup_code>
+			</pagetext>
+			
+		</page>
+		
+
+
+		<page lang="eng">
+			<outfile>targets.tcl</outfile>
+			<level2parent>documentation.tcl</level2parent>
+			<pageheading>Target config quick start guide</pageheading>
+			<pagetext>
+				<markup_code><![CDATA[
+				
+				A target needs an openocd.cfg file. This config file sets up
+				the CPU, flash and reset init script. Either OpenOCD ships with an
+				openocd.cfg file for your target or you need to take an existing
+				config file and modify it for your needs.
+				<p> 
+				The reset init script is crucial. It will set up e.g. MMU, chip
+				select registers, etc. after a reset. The init.cfg (reset init script)
+				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
+				<p>
+				Writing an openocd.cfg from scratch is a non-trivial exercise, but
+				fortunally it only has to be done once for a target and afterwards it
+				rarely if ever needs to be changed.
+				
+				
+				]]></markup_code>
+				<right_column>
+					
+					  Quick start guide on how to configure a target.
+				</right_column>
+			</pagetext>
+			
+			
+		</page>
+
+
+		
+
+
+		<page lang="eng">
+			<menulink>index.tcl</menulink> 
+			<level2parent>index.tcl</level2parent>
+			<outfile>terminal.tcl</outfile>
+			<pageheading>UART forwarding</pageheading>
+			<pagetext>
+			<markup_code><![CDATA[
+			<tcl>
+				set form_baudrate [formfetch form_baudrate]
+				if {[string length $form_baudrate]==0} {
+					set form_baudrate [ocd_uart]
+					set form_baudrate [string range $form_baudrate 0 [expr [string length $form_baudrate]-2]]
+				}
+				set form_action [formfetch form_action]
+			</tcl>
+			<form action="terminal.tcl" method="post">
+				Target baudrate: 
+					<select name="form_baudrate">
+						<tcl>
+							foreach i {9600 19200 38400 57600 115200} { 
+							</tcl>
+				  				<option <tcl>if {[string compare $form_baudrate $i]==0} { append buffer {selected="selected"} }  </tcl>
+				  				value ="<tcl>append buffer $i</tcl>"><tcl>append buffer $i</tcl></option>
+				  			<tcl>
+				  			}
+				  			</tcl>
+						</select>
+
+					<p>	
+					<input type="submit" name="form_action" value="Set baudrate" >
+				</form>			
+			<tcl>
+				if {[string compare $form_action "Set baudrate"]==0} {
+					append console [encode [ocd_uart $form_baudrate]]
+				}
+			</tcl>
+			
+			<h2>Simple UART</h2>
+			This terminal window is purely for illustrative purposes. Use telnet or a terminal program
+			to talk to the target over TCP/IP for anything but trivial case of reading/writing a few
+			lines of texts in simple tests.
+			<p>
+			]]></markup_code>
+			<right_column>
+				<![CDATA[
+				Serial port data to target is forwarded(both directions) in the simple terminal window
+				to the left. Alternatively you can <b>telnet <tcl>append buffer [ip]</tcl> 5555</b>
+				or connect via TCP/IP from e.g. HyperTerminal.
+				<p>
+				Type "help uart" in telnet for information on how to set uart speed for target. Normally
+				the uart speed is set from the target configuration script by adding an "uart N", where
+				N is the baudrate.
+				]]>
+			</right_column>
+			</pagetext>
+			
+		</page>
+
+
+		
+	</language>
+	
 </website>
\ No newline at end of file


Property changes on: trunk/src/server/httpd/menu.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/menu.xsl
===================================================================
--- trunk/src/server/httpd/menu.xsl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/menu.xsl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,298 +1,298 @@
-<?xml version="1.0"?>
-<!DOCTYPE xsl:stylesheet [<!ENTITY nbsp "&#160;">]>
-<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns="http://www.w3.org/TR/REC-html40" version="1.0">
-	<xsl:output method="html" version="4.0" indent="yes" encoding="UTF-8"
-	
-	 media-type="text/plain; charset=UTF-8"/>
-
-	<xsl:param name="pagetogenerate" select="UNDEFINED"/>
-	<xsl:template match="page[outfile!=$pagetogenerate]">
-	</xsl:template>
-
-	<xsl:template match="page[outfile=$pagetogenerate]">
-		<xsl:variable name="Xlevel2parent" select="level2parent"/>
-		<xsl:variable name="Xlevel3parent" select="level3parent"/>
-
-		<html>
-			<head>
-				<title>OpenOCD debugger</title>
-				<meta http-equiv="Content-Type" content="text/html"  charset="utf-8"/>
-				<link href="menuweb.css" rel="stylesheet" type="text/css"/>				
-				
-			</head>
-	
-			
-			<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-			
-			<body style="margin:0px;">
-				<div style="width:974px;height:85px;">
-					<div style="float:left;position:relative;left:32px;width:478px;">
-						<a href="/">
-							OpenOCD
-						</a>
-					</div>
-					<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-						<div class="textlight" style="position:relative;left:15px;top:4px;">
-							<tcl>append buffer [capture version]</tcl>
-						</div>
-					</div>
-				</div>
-				<table style="padding:0px;border-collapse:collapse;">
-					<tr>
-						<td style="width:33px;">
-							<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-						</td>
-						<!-- level 2 menu bar on left -->
-						<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-							<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-								<tr style="height:59px;">
-									<td></td>
-								</tr>
-								<xsl:for-each select="parent::language/page[outfile = $Xlevel2parent]/level2menu">
-									<tr>
-										<td>
-											<xsl:choose>
-												<xsl:when test="contains(@href, $pagetogenerate)">
-													<xsl:attribute name="style">width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;</xsl:attribute>
-												</xsl:when>
-												<xsl:otherwise>
-													<xsl:attribute name="style">width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;</xsl:attribute>
-												</xsl:otherwise>
-											</xsl:choose>
-											<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-												<a>
-													<xsl:attribute name="href">
-														<xsl:value-of select="@href"/>
-													</xsl:attribute>
-													<xsl:choose>
-														<xsl:when test="(@href = $pagetogenerate)">
-															<xsl:attribute name="style">font-weight: bold;</xsl:attribute>
-														</xsl:when>
-														<xsl:otherwise>
-															<xsl:choose>
-																<xsl:when test="(@href = $Xlevel3parent)">
-																	<xsl:attribute name="style">font-weight: bold;</xsl:attribute>
-																</xsl:when>
-																<xsl:otherwise>
-																	<xsl:attribute name="style"></xsl:attribute>
-																</xsl:otherwise>
-															</xsl:choose>
-														</xsl:otherwise>
-													</xsl:choose>
-													<xsl:value-of select="@title"/>
-												</a>
-											</div>
-										</td>
-									</tr>
-								</xsl:for-each>
-								<tr>
-									<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')">
-									
-									</td>
-								</tr>
-								<tr>
-									<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')">
-									
-									</td>
-								</tr>
-								<tr>
-									<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')">
-									
-									</td>
-								</tr>
-							</table>
-						</td>
-						<!-- top level menu -->
-						<td style="vertical-align:top;padding:0px;height:100%">
-							<table style="padding:0px;border-collapse:collapse;height:100%;">
-								<tr>
-									<td>
-										<table style="padding:0px;border-collapse:collapse;">
-											<tr>
-												<xsl:for-each select="parent::language/page">
-													<xsl:if test="menutext">
-														<td>
-															<xsl:choose>
-																<xsl:when test="(outfile = $pagetogenerate) or (outfile = $Xlevel2parent)">
-																	<xsl:attribute name="style">width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;</xsl:attribute>
-																</xsl:when>
-																<xsl:otherwise>
-																	<xsl:attribute name="style">width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;</xsl:attribute>
-																</xsl:otherwise>
-															</xsl:choose>
-															<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-																<a>
-																	<xsl:attribute name="href"><xsl:value-of select="menulink"/></xsl:attribute>
-																	<xsl:if test="(outfile = $pagetogenerate)">
-																		<xsl:attribute name="style">font-weight: bold;</xsl:attribute>
-																	</xsl:if>
-																	<xsl:if test="(outfile = $Xlevel2parent)">
-																		<xsl:attribute name="style">font-weight: bold;</xsl:attribute>
-																	</xsl:if>
-																	<xsl:value-of select="menutext"/>
-																</a>
-															 </div>
-														 </td>
-													</xsl:if>
-												</xsl:for-each>
-											</tr>
-										</table>
-								 	</td>
-								</tr>			
-							 	<tr>
-							 		<td colspan="6" style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;">
-							 			<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-							 		</td>
-							 	</tr>
-							 	<tr>
-							 		<td colspan="6" style="background-color:#ffffff;text-indent:30px;height:40px;">
-							 			<H1><xsl:value-of select="pageheading"/></H1>
-							 		</td>
-							 	</tr>
-							 	<tr style="height:100%;">
-							 		<td colspan="6" style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;">
-										<xsl:value-of disable-output-escaping="yes" select="pagetext/markup_code"/>
-							 		</td>
-							 	</tr>
-							 	<tcl>
-							 		<!-- This is the output from any OpenOCD commands -->
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-									 	<tr style="height:100%;">
-									 		<td colspan="6" style="height:100%;background-color:red;">
-												<table class="textgray" style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%">
-											 		<td style="width:25px;">&nbsp;</td>
-											 		<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <xsl:text disable-output-escaping="yes"><![CDATA[<]]></xsl:text>
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer <xsl:text disable-output-escaping="yes"><![CDATA[>]]></xsl:text>
-												 		} else {
-												 			append buffer <xsl:text disable-output-escaping="yes"><![CDATA[<]]></xsl:text>
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer <xsl:text disable-output-escaping="yes"><![CDATA[>]]></xsl:text>
-												 		}
-												 	</tcl>
-											 			<a class="openocd">
-															<xsl:attribute name="href"><xsl:value-of select="$pagetogenerate"/>?toggle_details=1</xsl:attribute>
-															<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-											 			</a>
-											 			<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl>
-													 <xsl:text disable-output-escaping="yes"><![CDATA[<]]></xsl:text>/td<xsl:text disable-output-escaping="yes"><![CDATA[>]]></xsl:text>
-													 <tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-											 		<td style="width:25px;">&nbsp;</td>
-											 	</table>
-										 	</td>
-										 </tr>
-									 	<tcl>
-									 }
-								</tcl>
-							 	<tr>
-							 		<td colspan="6" style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;">
-							 			<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-							 		</td>
-							 	</tr>
-						 	</table>
-						</td>
-						<td style="width:6px;">
-						</td>
-						<td style="width:245px;height:100%">
-							<table style="padding:0px;border-collapse:collapse;height:100%;">
-								<tr>
-									<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-										<div class="textgray" style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;">
-										    Documentation
-										 </div>
-								 	</td>
-								 	<td width="40px">
-								 		&nbsp;
-								 	</td>		
-								 	<td>
-								 	</td>	
-								</tr>
-							 	<tr>
-							 		<td colspan="3" style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');"></td>
-							 	</tr>
-							 	<tr>
-							 		<td colspan="3" style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;">
-							 			<a href="http://openocd.berlios.de/doc/openocd.pdf" target="_blank">OpenOCD Manual</a><br/>
-							 		</td>
-							 	</tr>
-							 	<tr><td colspan="3" style="background-color:#d8d7d7;height:15px;"></td></tr>
-							 	<tr>
-							 		<td colspan="3">
-							 			<table style="padding:0px;border-collapse:collapse;">
-							 				<td style="background-color:#d8d7d7;width:10px;height:1px"></td>
-							 				<td style="background-color:#999999;width:225px; height:1px;"></td>
-							 				<td style="background-color:#d8d7d7;width:10px;height:1px"></td>
-							 			</table>
-							 		</td>
-							 	</tr>
-							 	<tr><td colspan="3" style="background-color:#d8d7d7;height:15px;"></td></tr>
-							 	<tr style="height:100%;">
-							 		<td class="textgray" colspan="3"  style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;">
-										<xsl:choose>
-											<xsl:when test="(pagetext/right_column)">
-												<xsl:value-of disable-output-escaping="yes" select="pagetext/right_column"/>
-											</xsl:when>
-											<xsl:otherwise>
-		
-											</xsl:otherwise>
-										</xsl:choose>
-							 		</td>
-							 	</tr>
-							 	<tr>
-							 		<td colspan="3" style="height:30px;background-image:url('menu_cuts/right_bottom.png');">
-							 			&nbsp;
-							 		</td>
-							 	</tr>
-							 </table>
-				
-						</td>
-					</tr>
-					
-				</table>
-			</body>
-		</html>
-
-	</xsl:template>
-</xsl:stylesheet>
+<?xml version="1.0"?>
+<!DOCTYPE xsl:stylesheet [<!ENTITY nbsp "&#160;">]>
+<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns="http://www.w3.org/TR/REC-html40" version="1.0">
+	<xsl:output method="html" version="4.0" indent="yes" encoding="UTF-8"
+	
+	 media-type="text/plain; charset=UTF-8"/>
+
+	<xsl:param name="pagetogenerate" select="UNDEFINED"/>
+	<xsl:template match="page[outfile!=$pagetogenerate]">
+	</xsl:template>
+
+	<xsl:template match="page[outfile=$pagetogenerate]">
+		<xsl:variable name="Xlevel2parent" select="level2parent"/>
+		<xsl:variable name="Xlevel3parent" select="level3parent"/>
+
+		<html>
+			<head>
+				<title>OpenOCD debugger</title>
+				<meta http-equiv="Content-Type" content="text/html"  charset="utf-8"/>
+				<link href="menuweb.css" rel="stylesheet" type="text/css"/>				
+				
+			</head>
+	
+			
+			<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+			
+			<body style="margin:0px;">
+				<div style="width:974px;height:85px;">
+					<div style="float:left;position:relative;left:32px;width:478px;">
+						<a href="/">
+							OpenOCD
+						</a>
+					</div>
+					<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+						<div class="textlight" style="position:relative;left:15px;top:4px;">
+							<tcl>append buffer [capture version]</tcl>
+						</div>
+					</div>
+				</div>
+				<table style="padding:0px;border-collapse:collapse;">
+					<tr>
+						<td style="width:33px;">
+							<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+						</td>
+						<!-- level 2 menu bar on left -->
+						<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+							<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+								<tr style="height:59px;">
+									<td></td>
+								</tr>
+								<xsl:for-each select="parent::language/page[outfile = $Xlevel2parent]/level2menu">
+									<tr>
+										<td>
+											<xsl:choose>
+												<xsl:when test="contains(@href, $pagetogenerate)">
+													<xsl:attribute name="style">width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;</xsl:attribute>
+												</xsl:when>
+												<xsl:otherwise>
+													<xsl:attribute name="style">width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;</xsl:attribute>
+												</xsl:otherwise>
+											</xsl:choose>
+											<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+												<a>
+													<xsl:attribute name="href">
+														<xsl:value-of select="@href"/>
+													</xsl:attribute>
+													<xsl:choose>
+														<xsl:when test="(@href = $pagetogenerate)">
+															<xsl:attribute name="style">font-weight: bold;</xsl:attribute>
+														</xsl:when>
+														<xsl:otherwise>
+															<xsl:choose>
+																<xsl:when test="(@href = $Xlevel3parent)">
+																	<xsl:attribute name="style">font-weight: bold;</xsl:attribute>
+																</xsl:when>
+																<xsl:otherwise>
+																	<xsl:attribute name="style"></xsl:attribute>
+																</xsl:otherwise>
+															</xsl:choose>
+														</xsl:otherwise>
+													</xsl:choose>
+													<xsl:value-of select="@title"/>
+												</a>
+											</div>
+										</td>
+									</tr>
+								</xsl:for-each>
+								<tr>
+									<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')">
+									
+									</td>
+								</tr>
+								<tr>
+									<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')">
+									
+									</td>
+								</tr>
+								<tr>
+									<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')">
+									
+									</td>
+								</tr>
+							</table>
+						</td>
+						<!-- top level menu -->
+						<td style="vertical-align:top;padding:0px;height:100%">
+							<table style="padding:0px;border-collapse:collapse;height:100%;">
+								<tr>
+									<td>
+										<table style="padding:0px;border-collapse:collapse;">
+											<tr>
+												<xsl:for-each select="parent::language/page">
+													<xsl:if test="menutext">
+														<td>
+															<xsl:choose>
+																<xsl:when test="(outfile = $pagetogenerate) or (outfile = $Xlevel2parent)">
+																	<xsl:attribute name="style">width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;</xsl:attribute>
+																</xsl:when>
+																<xsl:otherwise>
+																	<xsl:attribute name="style">width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;</xsl:attribute>
+																</xsl:otherwise>
+															</xsl:choose>
+															<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+																<a>
+																	<xsl:attribute name="href"><xsl:value-of select="menulink"/></xsl:attribute>
+																	<xsl:if test="(outfile = $pagetogenerate)">
+																		<xsl:attribute name="style">font-weight: bold;</xsl:attribute>
+																	</xsl:if>
+																	<xsl:if test="(outfile = $Xlevel2parent)">
+																		<xsl:attribute name="style">font-weight: bold;</xsl:attribute>
+																	</xsl:if>
+																	<xsl:value-of select="menutext"/>
+																</a>
+															 </div>
+														 </td>
+													</xsl:if>
+												</xsl:for-each>
+											</tr>
+										</table>
+								 	</td>
+								</tr>			
+							 	<tr>
+							 		<td colspan="6" style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;">
+							 			<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+							 		</td>
+							 	</tr>
+							 	<tr>
+							 		<td colspan="6" style="background-color:#ffffff;text-indent:30px;height:40px;">
+							 			<H1><xsl:value-of select="pageheading"/></H1>
+							 		</td>
+							 	</tr>
+							 	<tr style="height:100%;">
+							 		<td colspan="6" style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;">
+										<xsl:value-of disable-output-escaping="yes" select="pagetext/markup_code"/>
+							 		</td>
+							 	</tr>
+							 	<tcl>
+							 		<!-- This is the output from any OpenOCD commands -->
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+									 	<tr style="height:100%;">
+									 		<td colspan="6" style="height:100%;background-color:red;">
+												<table class="textgray" style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%">
+											 		<td style="width:25px;">&nbsp;</td>
+											 		<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <xsl:text disable-output-escaping="yes"><![CDATA[<]]></xsl:text>
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer <xsl:text disable-output-escaping="yes"><![CDATA[>]]></xsl:text>
+												 		} else {
+												 			append buffer <xsl:text disable-output-escaping="yes"><![CDATA[<]]></xsl:text>
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer <xsl:text disable-output-escaping="yes"><![CDATA[>]]></xsl:text>
+												 		}
+												 	</tcl>
+											 			<a class="openocd">
+															<xsl:attribute name="href"><xsl:value-of select="$pagetogenerate"/>?toggle_details=1</xsl:attribute>
+															<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+											 			</a>
+											 			<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl>
+													 <xsl:text disable-output-escaping="yes"><![CDATA[<]]></xsl:text>/td<xsl:text disable-output-escaping="yes"><![CDATA[>]]></xsl:text>
+													 <tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+											 		<td style="width:25px;">&nbsp;</td>
+											 	</table>
+										 	</td>
+										 </tr>
+									 	<tcl>
+									 }
+								</tcl>
+							 	<tr>
+							 		<td colspan="6" style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;">
+							 			<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+							 		</td>
+							 	</tr>
+						 	</table>
+						</td>
+						<td style="width:6px;">
+						</td>
+						<td style="width:245px;height:100%">
+							<table style="padding:0px;border-collapse:collapse;height:100%;">
+								<tr>
+									<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+										<div class="textgray" style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;">
+										    Documentation
+										 </div>
+								 	</td>
+								 	<td width="40px">
+								 		&nbsp;
+								 	</td>		
+								 	<td>
+								 	</td>	
+								</tr>
+							 	<tr>
+							 		<td colspan="3" style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');"></td>
+							 	</tr>
+							 	<tr>
+							 		<td colspan="3" style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;">
+							 			<a href="http://openocd.berlios.de/doc/openocd.pdf" target="_blank">OpenOCD Manual</a><br/>
+							 		</td>
+							 	</tr>
+							 	<tr><td colspan="3" style="background-color:#d8d7d7;height:15px;"></td></tr>
+							 	<tr>
+							 		<td colspan="3">
+							 			<table style="padding:0px;border-collapse:collapse;">
+							 				<td style="background-color:#d8d7d7;width:10px;height:1px"></td>
+							 				<td style="background-color:#999999;width:225px; height:1px;"></td>
+							 				<td style="background-color:#d8d7d7;width:10px;height:1px"></td>
+							 			</table>
+							 		</td>
+							 	</tr>
+							 	<tr><td colspan="3" style="background-color:#d8d7d7;height:15px;"></td></tr>
+							 	<tr style="height:100%;">
+							 		<td class="textgray" colspan="3"  style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;">
+										<xsl:choose>
+											<xsl:when test="(pagetext/right_column)">
+												<xsl:value-of disable-output-escaping="yes" select="pagetext/right_column"/>
+											</xsl:when>
+											<xsl:otherwise>
+		
+											</xsl:otherwise>
+										</xsl:choose>
+							 		</td>
+							 	</tr>
+							 	<tr>
+							 		<td colspan="3" style="height:30px;background-image:url('menu_cuts/right_bottom.png');">
+							 			&nbsp;
+							 		</td>
+							 	</tr>
+							 </table>
+				
+						</td>
+					</tr>
+					
+				</table>
+			</body>
+		</html>
+
+	</xsl:template>
+</xsl:stylesheet>


Property changes on: trunk/src/server/httpd/menu.xsl
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/src/server/httpd/menu_cuts/center_bottom.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/center_top.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab1.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab1_selected.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab2.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab2_selected.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/h_tab_free.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/logo_bottom.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/logo_top.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/right_bottom.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/right_top.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/right_top_small.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/top_right.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/v_1.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/v_2_tile.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/v_3.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/v_tab.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png


Property changes on: trunk/src/server/httpd/menu_cuts/v_tab_selected.png
___________________________________________________________________
Name: svn:mime-type
   - application/octet-stream
   + image/png

Modified: trunk/src/server/httpd/menuweb.css
===================================================================
--- trunk/src/server/httpd/menuweb.css	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/menuweb.css	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,132 +1,132 @@
-a:link
-{
-	font-size: 12px;
-	color : #024d67;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a:visited
-{
-	font-size: 12px;
-	color : #024d67;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a:active
-{
-	font-size: 12px;
-	color : #024d67;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a:hover
-{
-	font-size: 12px;
-	color : #555555;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a.openocd:link
-{
-	font-size: 12px;
-	color : #555555;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a.openocd:visited
-{
-	font-size: 12px;
-	color : #555555;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a.openocd:active
-{
-	font-size: 12px;
-	color : #555555;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a.openocd:hover
-{
-	font-size: 12px;
-	color : #024d67;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-body
-{
-	background-color : green;
-	background-color : #176e8c;
-	font-family : Arial;
-	font-size: 12px;
-	line-height: 15px;
-	color : #024d67;
-	
-}
-
-h1
-{
-	padding: 0px;
-	font-size: 18px;
-	font-weight:bold;
-	text-decoration : none;
-	margin-bottom: 8px;
-}
-
-td
-{
-	padding: 0px;
-	font-size: 12px;
- 	vertical-align:top;
-
-}
-
-.textlight
-{
-	color: #cccccc;
-	padding: 0px;
-	font-size: 12px;
- 	vertical-align:top;
-
-}
-
-.fontbigger
-{
-	font-size:14px;
-}
-
-.textgray
-{
-	color: #555555;
-}
-
-.formtext
-{
-	padding-top: 4px;
-	font-size: 14px;
-	padding-right:10px;
-}
-
-input
-{
-	font-size: 14px;
-}
-
-.buttonspacelarge
-{
-	width:20px;
-}
-
-.buttonspacesmall
-{
-	width:8px;
-}
+a:link
+{
+	font-size: 12px;
+	color : #024d67;
+	font-weight:bold;
+	text-decoration : none;
+}
+
+a:visited
+{
+	font-size: 12px;
+	color : #024d67;
+	font-weight:bold;
+	text-decoration : none;
+}
+
+a:active
+{
+	font-size: 12px;
+	color : #024d67;
+	font-weight:bold;
+	text-decoration : none;
+}
+
+a:hover
+{
+	font-size: 12px;
+	color : #555555;
+	font-weight:bold;
+	text-decoration : none;
+}
+
+a.openocd:link
+{
+	font-size: 12px;
+	color : #555555;
+	font-weight:bold;
+	text-decoration : none;
+}
+
+a.openocd:visited
+{
+	font-size: 12px;
+	color : #555555;
+	font-weight:bold;
+	text-decoration : none;
+}
+
+a.openocd:active
+{
+	font-size: 12px;
+	color : #555555;
+	font-weight:bold;
+	text-decoration : none;
+}
+
+a.openocd:hover
+{
+	font-size: 12px;
+	color : #024d67;
+	font-weight:bold;
+	text-decoration : none;
+}
+
+body
+{
+	background-color : green;
+	background-color : #176e8c;
+	font-family : Arial;
+	font-size: 12px;
+	line-height: 15px;
+	color : #024d67;
+	
+}
+
+h1
+{
+	padding: 0px;
+	font-size: 18px;
+	font-weight:bold;
+	text-decoration : none;
+	margin-bottom: 8px;
+}
+
+td
+{
+	padding: 0px;
+	font-size: 12px;
+ 	vertical-align:top;
+
+}
+
+.textlight
+{
+	color: #cccccc;
+	padding: 0px;
+	font-size: 12px;
+ 	vertical-align:top;
+
+}
+
+.fontbigger
+{
+	font-size:14px;
+}
+
+.textgray
+{
+	color: #555555;
+}
+
+.formtext
+{
+	padding-top: 4px;
+	font-size: 14px;
+	padding-right:10px;
+}
+
+input
+{
+	font-size: 14px;
+}
+
+.buttonspacelarge
+{
+	width:20px;
+}
+
+.buttonspacesmall
+{
+	width:8px;
+}


Property changes on: trunk/src/server/httpd/menuweb.css
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/openocd.tcl
===================================================================
--- trunk/src/server/httpd/openocd.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/openocd.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,355 +1,355 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="openocd.tcl" style="font-weight: bold;">Run Command</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="guiupload.tcl" style="">Upload File</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl" style="font-weight: bold;">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Run Command</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-
-			}
-
-				set form_command [formfetch form_command]
-
-				set form_edittext ""
-				if {[string length $form_command]>0} {
-					set form_edittext [capture_catch {eval $form_command}]
-				}
-				
-				append buffer {<form action="openocd.tcl" method="post">} "\n"
-				append buffer {Command<br>}
-				append buffer {<textarea  style="overflow:auto;"  rows="5" cols="65" name="form_command" wrap="off">}
-				append buffer [to_textarea $form_command]
-				append buffer {</textarea><br>}
-				append buffer {<input type="submit" value="Run" name="form_action" ><br>}
-				append buffer {<textarea  style="overflow:auto;"  rows="21" cols="65" name="form_edittext" readonly=1 wrap="off">}
-				append buffer [to_textarea $form_edittext]
-				append buffer {</textarea><br>}
-				
-				append buffer {</form>} "\n"
-			
-			
-append buffer {
-
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="openocd.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				<p>Run tcl statement(s). Add "ocd_" prefix to OpenOCD commands otherwise
-				there will be no output, e.g. "reset init" use "ocd_reset init".
-				<p/>
-				<p><a href="/ram/log">Click here to download log</a>.</p>
-				<p>To download log you can also use commands like "wget http://}
-append buffer [ip]
-append buffer {/ram/log", or
-				point your web browser to said address.</p>
-				<p>
-				You can also execute tcl commands using curl from your developer PC:
-				</p>
-				<code>
-				curl --form form_command=ocd_version }
-append buffer [ip]
-append buffer {runtcl.tcl
-				</code>
-				
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="openocd.tcl" style="font-weight: bold;">Run Command</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="guiupload.tcl" style="">Upload File</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl" style="font-weight: bold;">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Run Command</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+
+			}
+
+				set form_command [formfetch form_command]
+
+				set form_edittext ""
+				if {[string length $form_command]>0} {
+					set form_edittext [capture_catch {eval $form_command}]
+				}
+				
+				append buffer {<form action="openocd.tcl" method="post">} "\n"
+				append buffer {Command<br>}
+				append buffer {<textarea  style="overflow:auto;"  rows="5" cols="65" name="form_command" wrap="off">}
+				append buffer [to_textarea $form_command]
+				append buffer {</textarea><br>}
+				append buffer {<input type="submit" value="Run" name="form_action" ><br>}
+				append buffer {<textarea  style="overflow:auto;"  rows="21" cols="65" name="form_edittext" readonly=1 wrap="off">}
+				append buffer [to_textarea $form_edittext]
+				append buffer {</textarea><br>}
+				
+				append buffer {</form>} "\n"
+			
+			
+append buffer {
+
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="openocd.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				<p>Run tcl statement(s). Add "ocd_" prefix to OpenOCD commands otherwise
+				there will be no output, e.g. "reset init" use "ocd_reset init".
+				<p/>
+				<p><a href="/ram/log">Click here to download log</a>.</p>
+				<p>To download log you can also use commands like "wget http://}
+append buffer [ip]
+append buffer {/ram/log", or
+				point your web browser to said address.</p>
+				<p>
+				You can also execute tcl commands using curl from your developer PC:
+				</p>
+				<code>
+				curl --form form_command=ocd_version }
+append buffer [ip]
+append buffer {runtcl.tcl
+				</code>
+				
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/openocd.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/preconfig.tcl
===================================================================
--- trunk/src/server/httpd/preconfig.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/preconfig.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,429 +1,429 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="index.tcl" style="">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="preconfig.tcl" style="font-weight: bold;">Select Target Config</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="editconfigs.tcl" style="">Edit Configurations</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="reload.tcl" style="">Reload Config Scripts</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Select Preconfigured Target</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			
-			}
-
-			
-			set form_target [formfetch form_target]
-			set form_action [formfetch form_action]
-			
-			append buffer {<form enctype="multipart/form-data" action="preconfig.tcl" method="post">}
-			if {[string compare $form_action "Select and reload"]==0} {
-				capture_catch "trunc /config/settings/openocd.cfg"
-				capture_catch "append_file /config/settings/openocd.cfg script target/$form_target"
-				reboot 
-			}
-			
-			set form_target [load_target] 
-			
-			set files [ls /rom/target]
-			set files [lunion $files [ls /config/settings/target]]
-			set files [lsort $files]
-			 
-			if {[string compare $form_action "Select and reload"]!=0} {
-				
-append buffer {
-				<table><tr>
-				<td style="padding-top:1px;">
-					<select name="form_target">
-						}
-
-							set foundTarget 0
-							foreach i $files {
-								if {[string match *.cfg $i]} {
-									
-append buffer {
-								  		<option 
-								  		}
-
-									  		if {[string compare $form_target $i]==0} { 
-											set foundTarget 1
-									  		append buffer {selected="selected"} 
-							  		}
-append buffer {
-							  		value="}
-append buffer $i
-append buffer {">}
-append buffer $i
-append buffer {</option>
-									}
-
-								}
-							}
-							
-							if {$foundTarget==0} {
-								
-append buffer {
-							  		<option selected="selected" value="">Preconfigured target not active</option>
-								}
-
-							}
-						
-append buffer {
-					</select>
-				</td>
-				<td class="buttonspacesmall">&nbsp</td>
-				<td>
-					<input type="submit" name="form_action" value="Select and reload">
-					
-					&nbsp;&nbsp;&nbsp;&nbsp;
-					<a href="editconfigs.tcl?form_action=Load&form_selected=}
-append buffer "target/$form_target"
-append buffer {">Edit target configuration</a>
-				</td>
-				</tr></table>
-			}
-
-			} else {
-			    append buffer "Reloading setting(ca. 30 seconds)..."
-			}
-			
-append buffer {
-				
-			</form>
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="preconfig.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-							
-				<p>ZY1000 comes with complete configurations for various targets.</p>
-				<p>These predefined configurations include reset init scripts and flash configuration.</p>
-				<p><b>Select and reload</b> - Select configuration and reboot ZY1000 unit.</p>
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="menu_cuts/logo_bottom.png"/>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="index.tcl" style="">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="preconfig.tcl" style="font-weight: bold;">Select Target Config</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="editconfigs.tcl" style="">Edit Configurations</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="reload.tcl" style="">Reload Config Scripts</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Select Preconfigured Target</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			
+			}
+
+			
+			set form_target [formfetch form_target]
+			set form_action [formfetch form_action]
+			
+			append buffer {<form enctype="multipart/form-data" action="preconfig.tcl" method="post">}
+			if {[string compare $form_action "Select and reload"]==0} {
+				capture_catch "trunc /config/settings/openocd.cfg"
+				capture_catch "append_file /config/settings/openocd.cfg script target/$form_target"
+				reboot 
+			}
+			
+			set form_target [load_target] 
+			
+			set files [ls /rom/target]
+			set files [lunion $files [ls /config/settings/target]]
+			set files [lsort $files]
+			 
+			if {[string compare $form_action "Select and reload"]!=0} {
+				
+append buffer {
+				<table><tr>
+				<td style="padding-top:1px;">
+					<select name="form_target">
+						}
+
+							set foundTarget 0
+							foreach i $files {
+								if {[string match *.cfg $i]} {
+									
+append buffer {
+								  		<option 
+								  		}
+
+									  		if {[string compare $form_target $i]==0} { 
+											set foundTarget 1
+									  		append buffer {selected="selected"} 
+							  		}
+append buffer {
+							  		value="}
+append buffer $i
+append buffer {">}
+append buffer $i
+append buffer {</option>
+									}
+
+								}
+							}
+							
+							if {$foundTarget==0} {
+								
+append buffer {
+							  		<option selected="selected" value="">Preconfigured target not active</option>
+								}
+
+							}
+						
+append buffer {
+					</select>
+				</td>
+				<td class="buttonspacesmall">&nbsp</td>
+				<td>
+					<input type="submit" name="form_action" value="Select and reload">
+					
+					&nbsp;&nbsp;&nbsp;&nbsp;
+					<a href="editconfigs.tcl?form_action=Load&form_selected=}
+append buffer "target/$form_target"
+append buffer {">Edit target configuration</a>
+				</td>
+				</tr></table>
+			}
+
+			} else {
+			    append buffer "Reloading setting(ca. 30 seconds)..."
+			}
+			
+append buffer {
+				
+			</form>
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="preconfig.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+							
+				<p>ZY1000 comes with complete configurations for various targets.</p>
+				<p>These predefined configurations include reset init scripts and flash configuration.</p>
+				<p><b>Select and reload</b> - Select configuration and reboot ZY1000 unit.</p>
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="menu_cuts/logo_bottom.png"/>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/preconfig.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/production.tcl
===================================================================
--- trunk/src/server/httpd/production.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/production.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,392 +1,392 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="font-weight: bold;">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Production</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			}
-
-				set form_action [formfetch form_action]
-				set form_serialnumber [formfetch form_serialnumber]
-				append buffer [production_info]
-			
-append buffer {
-				
-			<form enctype="multipart/form-data" action="production.tcl" method="post">
-				<code style="white-space: nowrap;">
-					}
-	
-						if {[string compare $form_action "Upload firmware"]==0} {
-							set wrotedata [catch {writeform form_filecontent $upload_filename} result]  
-							append buffer [encode $result]
-							if {$wrotedata==0} {
-								append buffer "<br>Running production procedure<p>"
-								append buffer "<br>Reset and init: <br>"
-								
-								append console [encode [capture_catch {catch "production $upload_filename $form_serialnumber"}]]
-							}
-						}
-						if {[string compare $form_action "Test"]==0} {
-							append buffer "<br>Running production test. Output from first 10 seconds printed below. <p>"
-							
-							append console [encode [capture_catch {catch production_test}]]
-						}
-						if {[string compare $form_action "Power on"]==0} {
-							append console [encode [capture_catch "power on"]]
-						}
-						if {[string compare $form_action "Power off"]==0} {
-							append console [encode [capture_catch "power off"]]
-						}
-					
-append buffer {
-				</code>
-				}
-
-					append buffer {<p class="formtext">Firmware file(raw binary) <input type="file" name="form_filecontent"><p>}
-					append buffer {<p class="formtext">Serial number <input type="text" name="form_serialnumber"><p>}
-				
-append buffer {
-				
-				<table>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-				</table>
-			
-				<table><tr>
-					<td><input type="submit" name="form_action" value="Upload firmware" ></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Test"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Power on"></td>
-					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Power off">
-				</tr></table>
-			</form>
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="production.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				The target script can implement the "production", "production_info" and "production_test" tcl proc's. These procedures
-				are used on this page. There are default implementations that do nothing.
-				
-				<p><b>Upload firmware</b> - Power cycle target, reset target and program raw binary file to flash bank 0, offset 0 and verify flash programming. Leave target powered on.</p>
-				<p><b>Test</b> -  Power up target, run 10 second target test. Output is provided via the DCC output channel. </p>
-				<p><b>Power on</b> - Power on target.</p>
-				<p><b>Power off</b> - Power off target.</p>
-				<p><b>Serial number</b> - A target script can use this string in the production procedure. Type "help production" for more info.</p>
-					 
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		
+
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="font-weight: bold;">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Production</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			}
+
+				set form_action [formfetch form_action]
+				set form_serialnumber [formfetch form_serialnumber]
+				append buffer [production_info]
+			
+append buffer {
+				
+			<form enctype="multipart/form-data" action="production.tcl" method="post">
+				<code style="white-space: nowrap;">
+					}
+	
+						if {[string compare $form_action "Upload firmware"]==0} {
+							set wrotedata [catch {writeform form_filecontent $upload_filename} result]  
+							append buffer [encode $result]
+							if {$wrotedata==0} {
+								append buffer "<br>Running production procedure<p>"
+								append buffer "<br>Reset and init: <br>"
+								
+								append console [encode [capture_catch {catch "production $upload_filename $form_serialnumber"}]]
+							}
+						}
+						if {[string compare $form_action "Test"]==0} {
+							append buffer "<br>Running production test. Output from first 10 seconds printed below. <p>"
+							
+							append console [encode [capture_catch {catch production_test}]]
+						}
+						if {[string compare $form_action "Power on"]==0} {
+							append console [encode [capture_catch "power on"]]
+						}
+						if {[string compare $form_action "Power off"]==0} {
+							append console [encode [capture_catch "power off"]]
+						}
+					
+append buffer {
+				</code>
+				}
+
+					append buffer {<p class="formtext">Firmware file(raw binary) <input type="file" name="form_filecontent"><p>}
+					append buffer {<p class="formtext">Serial number <input type="text" name="form_serialnumber"><p>}
+				
+append buffer {
+				
+				<table>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+					<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+					<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+				</table>
+			
+				<table><tr>
+					<td><input type="submit" name="form_action" value="Upload firmware" ></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Test"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Power on"></td>
+					<td class="buttonspacesmall">&nbsp</td><td><input type="submit" name="form_action" value="Power off">
+				</tr></table>
+			</form>
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="production.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				The target script can implement the "production", "production_info" and "production_test" tcl proc's. These procedures
+				are used on this page. There are default implementations that do nothing.
+				
+				<p><b>Upload firmware</b> - Power cycle target, reset target and program raw binary file to flash bank 0, offset 0 and verify flash programming. Leave target powered on.</p>
+				<p><b>Test</b> -  Power up target, run 10 second target test. Output is provided via the DCC output channel. </p>
+				<p><b>Power on</b> - Power on target.</p>
+				<p><b>Power off</b> - Power off target.</p>
+				<p><b>Serial number</b> - A target script can use this string in the production procedure. Type "help production" for more info.</p>
+					 
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/production.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/readme.txt
===================================================================
--- trunk/src/server/httpd/readme.txt	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/readme.txt	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,24 +1,24 @@
-work in progress... stay tuned....
-
-
-1. To build .tcl pages. This will convert menu.xml and menu.xsl into
-lots of .html pages w/embedded tcl, which are then inverted into
-tcl with embedded html.
-
-sh build.sh
-
-xalan.jar can be gotten from apache.org. 
-
-
-2. libmicrohttpd is a bit tricky to build under Cygwin:
-
-https://gnunet.org/mantis/view.php?id=1440
-
-3. To test:
-
-../openocd/configure --enable-httpd --enable-dummy  --enable-ioutil
-make
-make install
-openocd  -f httpd/httpd.tcl -c "interface dummy" -f target/at91eb40a.cfg
-
-4. Point browser to: http://localhost:8888
+work in progress... stay tuned....
+
+
+1. To build .tcl pages. This will convert menu.xml and menu.xsl into
+lots of .html pages w/embedded tcl, which are then inverted into
+tcl with embedded html.
+
+sh build.sh
+
+xalan.jar can be gotten from apache.org. 
+
+
+2. libmicrohttpd is a bit tricky to build under Cygwin:
+
+https://gnunet.org/mantis/view.php?id=1440
+
+3. To test:
+
+../openocd/configure --enable-httpd --enable-dummy  --enable-ioutil
+make
+make install
+openocd  -f httpd/httpd.tcl -c "interface dummy" -f target/at91eb40a.cfg
+
+4. Point browser to: http://localhost:8888


Property changes on: trunk/src/server/httpd/readme.txt
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/reload.tcl
===================================================================
--- trunk/src/server/httpd/reload.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/reload.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,322 +1,322 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="index.tcl" style="">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Reload Config Scripts</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			
-			}
-
-				set form_action [formfetch form_action]
-	
-				if {[string compare $form_action "Reload"]==0} {
-					append buffer "Reloading Config Scripts...<p>"
-					reboot
-				}
-			
-append buffer {
-			<form enctype="multipart/form-data" action="reload.tcl" method="post">
-				<input type="submit" name="form_action" value="Reload">
-			</form>
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="reload.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				Restart ZY1000 to reload selected target config script.				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="index.tcl" style="">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Reload Config Scripts</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			
+			}
+
+				set form_action [formfetch form_action]
+	
+				if {[string compare $form_action "Reload"]==0} {
+					append buffer "Reloading Config Scripts...<p>"
+					reboot
+				}
+			
+append buffer {
+			<form enctype="multipart/form-data" action="reload.tcl" method="post">
+				<input type="submit" name="form_action" value="Reload">
+			</form>
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="reload.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				Restart ZY1000 to reload selected target config script.				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/reload.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/run.tcl
===================================================================
--- trunk/src/server/httpd/run.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/run.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,382 +1,382 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Run program</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-
-
-			
-}
-
-
-set form_address [formfetch form_address]
-set form_action [formfetch form_action]
-
-if {[string compare $form_action "Run from address"]==0} {
-	append console [encode [capture_catch "halt"]]
-	append console [encode [capture_catch "wait_halt"]]
-	append console [encode [capture_catch "resume $form_address"]]
-}  
-
-if {[string compare $form_action "Halt"]==0} {
-	append console [encode [capture_catch "halt"]]
-	append console [encode [capture_catch "wait_halt"]]
-}
-  
-if {[string compare $form_action "Reset and run"]==0} {
-	append console [encode [capture_catch "reset run"]]
-}
-  
-if {[string compare $form_action "Reset and init"]==0} {
-	append console [encode [capture_catch "reset init"]]
-}  
-
-append console [encode [capture_catch poll]]
-
-
-append buffer {
-
-<form action="run.tcl" method="post"> 
-	<table>
-	<tr><td class="formtext" style="padding-right:10px;">Address</td><td><input type="text" name="form_address" value="}
-append buffer $form_address
-append buffer {"></td></tr>
-	</td></tr>
-	</table>
-	<table>
-		<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-		<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
-		<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
-	</table>
-	
-	<input type="submit" name="form_action" value="Reset and run"> <input type="submit" name="form_action" value="Run from address"> <input type="submit" name="form_action" value="Halt"><input type="submit" name="form_action" value="Reset and init"><br>
-</form>
-			
-
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="run.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				<p>Reset and run - reset CPU and let it run.</p>
-				<p>Halt - halt CPU.</p>
-				<p>Run from address - halt CPU and resume from address. Default is resume from current address.</p>
-				<p>Reset and init - reset CPU and run init script.</p>
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Run program</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+
+
+			
+}
+
+
+set form_address [formfetch form_address]
+set form_action [formfetch form_action]
+
+if {[string compare $form_action "Run from address"]==0} {
+	append console [encode [capture_catch "halt"]]
+	append console [encode [capture_catch "wait_halt"]]
+	append console [encode [capture_catch "resume $form_address"]]
+}  
+
+if {[string compare $form_action "Halt"]==0} {
+	append console [encode [capture_catch "halt"]]
+	append console [encode [capture_catch "wait_halt"]]
+}
+  
+if {[string compare $form_action "Reset and run"]==0} {
+	append console [encode [capture_catch "reset run"]]
+}
+  
+if {[string compare $form_action "Reset and init"]==0} {
+	append console [encode [capture_catch "reset init"]]
+}  
+
+append console [encode [capture_catch poll]]
+
+
+append buffer {
+
+<form action="run.tcl" method="post"> 
+	<table>
+	<tr><td class="formtext" style="padding-right:10px;">Address</td><td><input type="text" name="form_address" value="}
+append buffer $form_address
+append buffer {"></td></tr>
+	</td></tr>
+	</table>
+	<table>
+		<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+		<tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr>
+		<tr><td style="height:15px;width:535px;">&nbsp</td></tr>
+	</table>
+	
+	<input type="submit" name="form_action" value="Reset and run"> <input type="submit" name="form_action" value="Run from address"> <input type="submit" name="form_action" value="Halt"><input type="submit" name="form_action" value="Reset and init"><br>
+</form>
+			
+
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="run.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				<p>Reset and run - reset CPU and let it run.</p>
+				<p>Halt - halt CPU.</p>
+				<p>Run from address - halt CPU and resume from address. Default is resume from current address.</p>
+				<p>Reset and init - reset CPU and run init script.</p>
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/run.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/support.tcl
===================================================================
--- trunk/src/server/httpd/support.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/support.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,431 +1,431 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture zy1000_version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="zy1000.tcl" style="">Set IP Address</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="editfile.tcl" style="">Edit File</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="support.tcl" style="font-weight: bold;">Support Request</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Submit Support Request</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			Before contacting Zylin, please submit a support request with relevant information. 
-			}
-
-			
-			set form_config [load_config "target/[load_target]"]
-			set support_id [string range [rand] 0 7]
-			set form_log ""
-			append form_log "Version: [capture "zy1000_version zy1000"]"
-			append form_log "OpenOCD version: [capture "zy1000_version openocd"]"
-			append form_log "Version date: [capture "zy1000_version date"]"
-			append form_log [log]
-			
-append buffer {
-
-			<form action="supportrequest.tcl" method="POST" target="_blank">
-				<input TYPE="hidden" NAME="id" VALUE="}
-append buffer $support_id
-append buffer {">
-				<input TYPE="hidden" NAME="success" VALUE="http://www.zylin.com/zy1000_support.html">
-				<input size="50" name="subject" type="hidden" value="ZY1000 support request">
-				<table cellspacing="5">
-				<tr><td>Support ID</td><td>}
-append buffer $support_id
-append buffer {</td></tr>
-				<tr><td>Contact person</td><td><input size="50" name="name" type="text"></td></tr>
-				<tr><td>Phone</td><td><input size="50" name="phone" type="text"></td></tr>
-				<tr><td>email</td><td><input size="50" name="email" type="text"></td></tr>
-				<tr><td>MAC address</td><td><input size="50" name="serial" type="text" value="}
-append buffer [mac]
-append buffer {"></td></tr>
-				</td></tr>
-				</table>
-				<p>
-				Summary:
-				<p>
-				<input name="summary" size="50">
-				<p>
-				Description:
-				<p>
-				<textarea  style="overflow:auto;font-size:11px;"  name="description" cols="50" rows="4" type="textarea" wrap="off"></textarea>
-				
-				<p>				
-				Log:<p>
-				<textarea  style="overflow:auto;font-size:11px;"  name="log" cols="50" rows="5" type="textarea" wrap="off">}
-append buffer $form_log
-append buffer {</textarea>
-				<p>				
-				Config:<p>
-				<textarea  style="overflow:auto;font-size:11px;"  name="config" cols="50" rows="5" type="textarea" wrap="off">}
-append buffer $form_config
-append buffer {</textarea>
-				<p>
-			</form>
-			<p>
-			<input value="Creates support request" type="submit"/></td></tr>
-
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="/ram/cgi/support.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				Before contacting Zylin with questions, please fill in and submit this form
-				and allow us time to review the information and answer by email if possible.
-				<p/> 
-				Note that you can see precisely what information is submitted to Zylin in the
-				form: the log and your config files.
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture zy1000_version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="zy1000.tcl" style="">Set IP Address</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="editfile.tcl" style="">Edit File</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="support.tcl" style="font-weight: bold;">Support Request</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Submit Support Request</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			Before contacting Zylin, please submit a support request with relevant information. 
+			}
+
+			
+			set form_config [load_config "target/[load_target]"]
+			set support_id [string range [rand] 0 7]
+			set form_log ""
+			append form_log "Version: [capture "zy1000_version zy1000"]"
+			append form_log "OpenOCD version: [capture "zy1000_version openocd"]"
+			append form_log "Version date: [capture "zy1000_version date"]"
+			append form_log [log]
+			
+append buffer {
+
+			<form action="supportrequest.tcl" method="POST" target="_blank">
+				<input TYPE="hidden" NAME="id" VALUE="}
+append buffer $support_id
+append buffer {">
+				<input TYPE="hidden" NAME="success" VALUE="http://www.zylin.com/zy1000_support.html">
+				<input size="50" name="subject" type="hidden" value="ZY1000 support request">
+				<table cellspacing="5">
+				<tr><td>Support ID</td><td>}
+append buffer $support_id
+append buffer {</td></tr>
+				<tr><td>Contact person</td><td><input size="50" name="name" type="text"></td></tr>
+				<tr><td>Phone</td><td><input size="50" name="phone" type="text"></td></tr>
+				<tr><td>email</td><td><input size="50" name="email" type="text"></td></tr>
+				<tr><td>MAC address</td><td><input size="50" name="serial" type="text" value="}
+append buffer [mac]
+append buffer {"></td></tr>
+				</td></tr>
+				</table>
+				<p>
+				Summary:
+				<p>
+				<input name="summary" size="50">
+				<p>
+				Description:
+				<p>
+				<textarea  style="overflow:auto;font-size:11px;"  name="description" cols="50" rows="4" type="textarea" wrap="off"></textarea>
+				
+				<p>				
+				Log:<p>
+				<textarea  style="overflow:auto;font-size:11px;"  name="log" cols="50" rows="5" type="textarea" wrap="off">}
+append buffer $form_log
+append buffer {</textarea>
+				<p>				
+				Config:<p>
+				<textarea  style="overflow:auto;font-size:11px;"  name="config" cols="50" rows="5" type="textarea" wrap="off">}
+append buffer $form_config
+append buffer {</textarea>
+				<p>
+			</form>
+			<p>
+			<input value="Creates support request" type="submit"/></td></tr>
+
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="/ram/cgi/support.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				Before contacting Zylin with questions, please fill in and submit this form
+				and allow us time to review the information and answer by email if possible.
+				<p/> 
+				Note that you can see precisely what information is submitted to Zylin in the
+				form: the log and your config files.
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/support.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/targets.tcl
===================================================================
--- trunk/src/server/httpd/targets.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/targets.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,560 +1,560 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Target config quick start guide</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-				
-				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either OpenOCD ships with an
-				openocd.cfg file for your target or you need to take an existing
-				config file and modify it for your needs.
-				<p> 
-				The reset init script is crucial. It will set up e.g. MMU, chip
-				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
-				<p>
-				Writing an openocd.cfg from scratch is a non-trivial exercise, but
-				fortunally it only has to be done once for a target and afterwards it
-				rarely if ever needs to be changed.
-				
-				
-				</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="targets.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-					
-					  Quick start guide on how to configure a target.
-				</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Target config quick start guide</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-				
-				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either OpenOCD ships with an
-				openocd.cfg file for your target or you need to take an existing
-				config file and modify it for your needs.
-				<p> 
-				The reset init script is crucial. It will set up e.g. MMU, chip
-				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
-				<p>
-				Writing an openocd.cfg from scratch is a non-trivial exercise, but
-				fortunally it only has to be done once for a target and afterwards it
-				rarely if ever needs to be changed.
-				
-				
-				</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="targets.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-					
-					  Quick start guide on how to configure a target.
-				</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Target config quick start guide</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+				
+				A target needs an openocd.cfg file. This config file sets up
+				the CPU, flash and reset init script. Either OpenOCD ships with an
+				openocd.cfg file for your target or you need to take an existing
+				config file and modify it for your needs.
+				<p> 
+				The reset init script is crucial. It will set up e.g. MMU, chip
+				select registers, etc. after a reset. The init.cfg (reset init script)
+				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
+				<p>
+				Writing an openocd.cfg from scratch is a non-trivial exercise, but
+				fortunally it only has to be done once for a target and afterwards it
+				rarely if ever needs to be changed.
+				
+				
+				</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="targets.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+					
+					  Quick start guide on how to configure a target.
+				</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Target config quick start guide</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+				
+				A target needs an openocd.cfg file. This config file sets up
+				the CPU, flash and reset init script. Either OpenOCD ships with an
+				openocd.cfg file for your target or you need to take an existing
+				config file and modify it for your needs.
+				<p> 
+				The reset init script is crucial. It will set up e.g. MMU, chip
+				select registers, etc. after a reset. The init.cfg (reset init script)
+				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
+				<p>
+				Writing an openocd.cfg from scratch is a non-trivial exercise, but
+				fortunally it only has to be done once for a target and afterwards it
+				rarely if ever needs to be changed.
+				
+				
+				</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="targets.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+					
+					  Quick start guide on how to configure a target.
+				</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/targets.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/terminal.tcl
===================================================================
--- trunk/src/server/httpd/terminal.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/terminal.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,364 +1,364 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>OpenOCD debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-							OpenOCD
-						</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="index.tcl" style="">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="openocd.tcl">OpenOCD</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>UART forwarding</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			}
-
-				set form_baudrate [formfetch form_baudrate]
-				if {[string length $form_baudrate]==0} {
-					set form_baudrate [ocd_uart]
-					set form_baudrate [string range $form_baudrate 0 [expr [string length $form_baudrate]-2]]
-				}
-				set form_action [formfetch form_action]
-			
-append buffer {
-			<form action="terminal.tcl" method="post">
-				Target baudrate: 
-					<select name="form_baudrate">
-						}
-
-							foreach i {9600 19200 38400 57600 115200} { 
-							
-append buffer {
-				  				<option }
-if {[string compare $form_baudrate $i]==0} { append buffer {selected="selected"} }  
-append buffer {
-				  				value ="}
-append buffer $i
-append buffer {">}
-append buffer $i
-append buffer {</option>
-				  			}
-
-				  			}
-				  			
-append buffer {
-						</select>
-
-					<p>	
-					<input type="submit" name="form_action" value="Set baudrate" >
-				</form>			
-			}
-
-				if {[string compare $form_action "Set baudrate"]==0} {
-					append console [encode [ocd_uart $form_baudrate]]
-				}
-			
-append buffer {
-			
-			<h2>Simple UART</h2>
-			This terminal window is purely for illustrative purposes. Use telnet or a terminal program
-			to talk to the target over TCP/IP for anything but trivial case of reading/writing a few
-			lines of texts in simple tests.
-			<p>
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="terminal.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
-<br/>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
-				
-				Serial port data to target is forwarded(both directions) in the simple terminal window
-				to the left. Alternatively you can <b>telnet }
-append buffer [ip]
-append buffer { 5555</b>
-				or connect via TCP/IP from e.g. HyperTerminal.
-				<p>
-				Type "help uart" in telnet for information on how to set uart speed for target. Normally
-				the uart speed is set from the target configuration script by adding an "uart N", where
-				N is the baudrate.
-				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+
+
+		
+
+
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>OpenOCD debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+							OpenOCD
+						</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="index.tcl" style="">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="openocd.tcl">OpenOCD</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>UART forwarding</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			}
+
+				set form_baudrate [formfetch form_baudrate]
+				if {[string length $form_baudrate]==0} {
+					set form_baudrate [ocd_uart]
+					set form_baudrate [string range $form_baudrate 0 [expr [string length $form_baudrate]-2]]
+				}
+				set form_action [formfetch form_action]
+			
+append buffer {
+			<form action="terminal.tcl" method="post">
+				Target baudrate: 
+					<select name="form_baudrate">
+						}
+
+							foreach i {9600 19200 38400 57600 115200} { 
+							
+append buffer {
+				  				<option }
+if {[string compare $form_baudrate $i]==0} { append buffer {selected="selected"} }  
+append buffer {
+				  				value ="}
+append buffer $i
+append buffer {">}
+append buffer $i
+append buffer {</option>
+				  			}
+
+				  			}
+				  			
+append buffer {
+						</select>
+
+					<p>	
+					<input type="submit" name="form_action" value="Set baudrate" >
+				</form>			
+			}
+
+				if {[string compare $form_action "Set baudrate"]==0} {
+					append console [encode [ocd_uart $form_baudrate]]
+				}
+			
+append buffer {
+			
+			<h2>Simple UART</h2>
+			This terminal window is purely for illustrative purposes. Use telnet or a terminal program
+			to talk to the target over TCP/IP for anything but trivial case of reading/writing a few
+			lines of texts in simple tests.
+			<p>
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="terminal.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://openocd.berlios.de/doc/openocd.pdf">OpenOCD Manual</a>
+<br/>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
+				
+				Serial port data to target is forwarded(both directions) in the simple terminal window
+				to the left. Alternatively you can <b>telnet }
+append buffer [ip]
+append buffer { 5555</b>
+				or connect via TCP/IP from e.g. HyperTerminal.
+				<p>
+				Type "help uart" in telnet for information on how to set uart speed for target. Normally
+				the uart speed is set from the target configuration script by adding an "uart N", where
+				N is the baudrate.
+				
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/terminal.tcl
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server/httpd/upgrade.tcl
===================================================================
--- trunk/src/server/httpd/upgrade.tcl	2008-12-23 08:52:02 UTC (rev 1272)
+++ trunk/src/server/httpd/upgrade.tcl	2008-12-23 12:52:14 UTC (rev 1273)
@@ -1,418 +1,418 @@
-# converted to .tcl by html2tcl.tcl
-set buffer ""
-append buffer {
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="menuweb.css"/>
-</head>
-}
-
-				set console ""
-				set upload_filename /ram/upload
-			
-append buffer {
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-}
-append buffer [capture version]
-append buffer {
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="zy1000.tcl" style="">Set IP Address</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="upgrade.tcl" style="font-weight: bold;">ZY1000 Firmware</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="editfile.tcl" style="">Edit File</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="support.tcl" style="">Support Request</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Upgrade ZY1000 Firmware</H1>
-</td>
-</tr>
-<tr style="height:100%;">
-<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
-			
-			}
-
-				set form_action [formfetch form_action];
-				set form_filecontent [formfetch form_filecontent];
-				
-				append buffer {<form enctype="multipart/form-data" action="upgrade.tcl" method="post">}
-				if {[string compare $form_action "Upload"]==0} {
-					
-					if [string match ZylinPhiFirmware* $form_filecontent]==1 {
-						set form_filename /config/firmware.phi 
-						puts "Writing firmware to $form_filename"
-						set fp [aio.open $form_filename w];
-						$fp puts -nonewline $form_filecontent
-						$fp close
-						puts "Done writing firmware to $form_filename"
-						append buffer "<br><div style='font-size:14px;'>Upgraded Zylin JTAG, rebooting (wait ca. 30 seconds)...</div><br>"
-						reboot
-					} else {
-						append buffer "<br>Not a valid Zylin JTAG firmware file.<br>"
-					}
-				} elseif {[string compare $form_action "Restore factory settings"]==0} {
-					proc rmdir { dir } {
-						set entries {}
-						catch {set entries [ls $dir]} err
-						foreach { entry } $entries {
-							rmdir $dir/$entry
-							rm $dir/$entry
-						}
-					}				
-					rmdir /config/settings
-					reboot
-					append buffer "Restoring factory settings (wait ca. 30 seconds)...<br>"
-				} else {
-					append buffer {<div style="font-size:14px;">Upgrade Zylin JTAG firmware + reboot. </div><p>}
-					append buffer {<input type="file" name="form_filecontent"> <br>}
-					append buffer {<table><tr><td style="height:15px;width:535px;">&nbsp</td></tr><tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr><tr><td style="height:15px;width:535px;">&nbsp</td></tr></table>}
-					append buffer {<input type="submit" name="form_action" value="Upload" ><br> }
-					append buffer {<input type="submit" name="form_action" value="Restore factory settings" ><br> }
-					append buffer {</form> }
-				}
-			
-append buffer {
-			
-			</td>
-</tr>
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-}
-
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	
-append buffer {
-<a class="openocd" href="/ram/cgi/upgrade.tcl?toggle_details=1">
-}
-
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															
-append buffer {
-</a>
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {</td>}
-
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 
-append buffer {
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-}
-
-									 }
-								
-append buffer {
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">	
-				
-					Upload new firmware file to ZY1000, verify that it is a valid ZY1000 firmware
-					file, and upgrade flash.
-					<p/>
-					Restore factory settings restores all factory settings except the TCP/IP settings.
-					<p/>
-					The current version of the firmware is visible at the top of the web page.
-					<p/>
-					ZY1000 firmware can also be upgraded using serial port YModem upload.
-					<p/>
-					Check for new firmware at <a target="_blank" href="http://www.zylin.com/zy1000.html">http://www.zylin.com/zy1000.html<a> 
-				  
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="menu_cuts/logo_bottom.png"/>
-</td>
-</tr>
-</table>
-</body>
-</html>
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked "html"
-write_chunked $buffer
-end_chunked
-
+# converted to .tcl by html2tcl.tcl
+set buffer ""
+append buffer {
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="menuweb.css"/>
+</head>
+}
+
+				set console ""
+				set upload_filename /ram/upload
+			
+append buffer {
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+}
+append buffer [capture version]
+append buffer {
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="zy1000.tcl" style="">Set IP Address</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="upgrade.tcl" style="font-weight: bold;">ZY1000 Firmware</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="editfile.tcl" style="">Edit File</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="support.tcl" style="">Support Request</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Upgrade ZY1000 Firmware</H1>
+</td>
+</tr>
+<tr style="height:100%;">
+<td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
+			
+			}
+
+				set form_action [formfetch form_action];
+				set form_filecontent [formfetch form_filecontent];
+				
+				append buffer {<form enctype="multipart/form-data" action="upgrade.tcl" method="post">}
+				if {[string compare $form_action "Upload"]==0} {
+					
+					if [string match ZylinPhiFirmware* $form_filecontent]==1 {
+						set form_filename /config/firmware.phi 
+						puts "Writing firmware to $form_filename"
+						set fp [aio.open $form_filename w];
+						$fp puts -nonewline $form_filecontent
+						$fp close
+						puts "Done writing firmware to $form_filename"
+						append buffer "<br><div style='font-size:14px;'>Upgraded Zylin JTAG, rebooting (wait ca. 30 seconds)...</div><br>"
+						reboot
+					} else {
+						append buffer "<br>Not a valid Zylin JTAG firmware file.<br>"
+					}
+				} elseif {[string compare $form_action "Restore factory settings"]==0} {
+					proc rmdir { dir } {
+						set entries {}
+						catch {set entries [ls $dir]} err
+						foreach { entry } $entries {
+							rmdir $dir/$entry
+							rm $dir/$entry
+						}
+					}				
+					rmdir /config/settings
+					reboot
+					append buffer "Restoring factory settings (wait ca. 30 seconds)...<br>"
+				} else {
+					append buffer {<div style="font-size:14px;">Upgrade Zylin JTAG firmware + reboot. </div><p>}
+					append buffer {<input type="file" name="form_filecontent"> <br>}
+					append buffer {<table><tr><td style="height:15px;width:535px;">&nbsp</td></tr><tr><td style="height:1px;width:535px;background-color:#a2c5d1;"></td></tr><tr><td style="height:15px;width:535px;">&nbsp</td></tr></table>}
+					append buffer {<input type="submit" name="form_action" value="Upload" ><br> }
+					append buffer {<input type="submit" name="form_action" value="Restore factory settings" ><br> }
+					append buffer {</form> }
+				}
+			
+append buffer {
+			
+			</td>
+</tr>
+}
+
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			
+append buffer {
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+}
+
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	
+append buffer {
+<a class="openocd" href="/ram/cgi/upgrade.tcl?toggle_details=1">
+}
+
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															
+append buffer {
+</a>
+}
+
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	
+append buffer {</td>}
+
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 
+append buffer {
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+}
+
+									 }
+								
+append buffer {
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">	
+				
+					Upload new firmware file to ZY1000, verify that it is a valid ZY1000 firmware
+					file, and upgrade flash.
+					<p/>
+					Restore factory settings restores all factory settings except the TCP/IP settings.
+					<p/>
+					The current version of the firmware is visible at the top of the web page.
+					<p/>
+					ZY1000 firmware can also be upgraded using serial port YModem upload.
+					<p/>
+					Check for new firmware at <a target="_blank" href="http://www.zylin.com/zy1000.html">http://www.zylin.com/zy1000.html<a> 
+				  
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="menu_cuts/logo_bottom.png"/>
+</td>
+</tr>
+</table>
+</body>
+</html>
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+
+
+		
+
+
+		
+	
+	
+}
+
+start_chunked "html"
+write_chunked $buffer
+end_chunked
+


Property changes on: trunk/src/server/httpd/upgrade.tcl
___________________________________________________________________
Name: svn:eol-style
   + native



From duane at mail.berlios.de  Thu Dec 25 00:22:25 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Thu, 25 Dec 2008 00:22:25 +0100
Subject: [Openocd-svn] r1274 - trunk/src/target/target
Message-ID: <200812242322.mBONMPMk031102@sheep.berlios.de>

Author: duane
Date: 2008-12-25 00:22:22 +0100 (Thu, 25 Dec 2008)
New Revision: 1274

Modified:
   trunk/src/target/target/str710.cfg
   trunk/src/target/target/str730.cfg
   trunk/src/target/target/str750.cfg
Log:
Typos found by miceal catudal

Modified: trunk/src/target/target/str710.cfg
===================================================================
--- trunk/src/target/target/str710.cfg	2008-12-23 12:52:14 UTC (rev 1273)
+++ trunk/src/target/target/str710.cfg	2008-12-24 23:22:22 UTC (rev 1274)
@@ -24,7 +24,7 @@
 
 #jtag scan chain
 
-tag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
 target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm7tdmi

Modified: trunk/src/target/target/str730.cfg
===================================================================
--- trunk/src/target/target/str730.cfg	2008-12-23 12:52:14 UTC (rev 1273)
+++ trunk/src/target/target/str730.cfg	2008-12-24 23:22:22 UTC (rev 1274)
@@ -25,7 +25,7 @@
 reset_config trst_and_srst srst_pulls_trst
 
 #jtag scan chain
-tag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
 
 #jtag nTRST and nSRST delay
 jtag_nsrst_delay 500

Modified: trunk/src/target/target/str750.cfg
===================================================================
--- trunk/src/target/target/str750.cfg	2008-12-23 12:52:14 UTC (rev 1273)
+++ trunk/src/target/target/str750.cfg	2008-12-24 23:22:22 UTC (rev 1274)
@@ -27,7 +27,7 @@
 
 #jtag scan chain
 
-tag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
 
 #jtag nTRST and nSRST delay
 jtag_nsrst_delay 500



From duane at mail.berlios.de  Sat Dec 27 02:16:02 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 02:16:02 +0100
Subject: [Openocd-svn] r1275 - in trunk: . doc src src/helper src/jtag
	testing testing/build.tests testing/build.tests/mingw32_help
	testing/build.tests/mingw32_help/include
	testing/build.tests/mingw32_help/include/sys
Message-ID: <200812270116.mBR1G2fm010683@sheep.berlios.de>

Author: duane
Date: 2008-12-27 02:15:50 +0100 (Sat, 27 Dec 2008)
New Revision: 1275

Added:
   trunk/testing/build.tests/
   trunk/testing/build.tests/Makefile
   trunk/testing/build.tests/Makefile.confuse
   trunk/testing/build.tests/Makefile.ftd2xx
   trunk/testing/build.tests/Makefile.libftdi
   trunk/testing/build.tests/Makefile.libusb
   trunk/testing/build.tests/Makefile.openocd
   trunk/testing/build.tests/local.uses
   trunk/testing/build.tests/mingw32_help/
   trunk/testing/build.tests/mingw32_help/include/
   trunk/testing/build.tests/mingw32_help/include/elf.h
   trunk/testing/build.tests/mingw32_help/include/sys/
   trunk/testing/build.tests/mingw32_help/include/sys/cdefs.h
   trunk/testing/build.tests/mingw32_help/include/sys/elf32.h
   trunk/testing/build.tests/mingw32_help/include/sys/elf64.h
   trunk/testing/build.tests/mingw32_help/include/sys/elf_common.h
   trunk/testing/build.tests/mingw32_help/include/sys/elf_generic.h
Modified:
   trunk/configure.in
   trunk/doc/openocd.texi
   trunk/src/Makefile.am
   trunk/src/helper/options.c
   trunk/src/jtag/Makefile.am
Log:
Build Permutations with ftd2xx and libftdi addressed. Also added a new se of regression makefiles to build openocd in multiple ways

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/configure.in	2008-12-27 01:15:50 UTC (rev 1275)
@@ -28,6 +28,133 @@
 is_mingw=no
 is_win32=no
 
+# We are not *ALWAYS* being installed in the standard place.
+# We may be installed in a "tool-build" specific location.
+# Normally with other packages - as part of a tool distro.
+# Thus - we should search that 'libdir' also.
+#
+# And - if we are being installed there - the odds are
+# The libraries unique to what we are are there too.
+#
+# what matters is the "exec-prefix"
+if test $exec_prefix != $ac_default_prefix
+then
+    # use build specific install library dir
+    LDFLAGS="$LDFLAGS -L$libdir"
+    # RPATH becomes an issue on Linux only
+    if test $host_os = linux-gnu
+    then
+	LDFLAGS="$LDFLAGS -Wl,-rpath,$libdir"
+    fi
+    # The "INCDIR" is also usable
+    CFLAGS="$CFLAGS -I$includedir"
+fi
+
+AC_ARG_WITH(ftd2xx,
+   AS_HELP_STRING([--with-ftd2xx=<PATH>],[This option has been removed.]),
+[
+# Option Given.
+cat << __EOF__
+
+The option: --with-ftd2xx=<PATH> has been removed replaced.
+On Linux, the new option is:
+  
+  --with-ftd2xx-linux-tardir=/path/to/files
+
+Where <path> is the path the the directory where the "tar.gz" file
+from FTDICHIP.COM was unpacked, for example:
+
+  --with-ftd2xx-linux-tardir=/home/duane/libftd2xx-linux-tardir=/home/duane/libftd2xx0.4.16
+
+On Cygwin/MingW32, the new option is:
+
+  --with-ftd2xx-win32-zipdir=/path/to/files
+
+Where <path> is the path to the directory where the "zip" file from
+FTDICHIP.COM was unpacked, for example:
+
+  --with-ftd2xx-win32-zipdir=/home/duane/ftd2xx.cdm.files
+
+__EOF__
+
+   AC_MSG_ERROR([Sorry Cannot continue])
+],
+[ 
+# Option not given
+true
+]
+)
+
+#========================================
+# FTD2XXX support comes in 3 forms.
+#    (1) win32 - via a zip file
+#    (2) linux - via a tar file
+#    (3) linux/cygwin/mingw - via libftdi
+#
+# In case (1) and (2) we need to know where the package was unpacked.
+
+AC_ARG_WITH(ftd2xx-win32-zipdir,
+  AS_HELP_STRING([--with-ftd2xx-win32-zipdir],[Where (CYGWIN/MINGW) the zip file from ftdichip.com was unpacked <default=search>]),
+  [
+  # option present
+  if test -d $with_ftd2xx_win32_zipdir
+  then
+	with_ftd2xx_win32_zipdir=`cd $with_ftd2xx_win32_zipdir && pwd`
+	AC_MSG_NOTICE([Using: ftdichip.com library: $with_ftd2xx_win32_zipdir])
+  else
+	AC_MSG_ERROR([Parameter to --with-ftd2xx-win32-zipdir is not a dir: $with_ftd2xx_win32_zipdir])
+  fi
+  ],
+  [
+  # not given
+  true
+  ]
+)
+	
+
+AC_ARG_WITH(ftd2xx-linux-tardir,
+  AS_HELP_STRING([--with-ftd2xx-linux-tardir], [Where (Linux/Unix) the tar file from ftdichip.com was unpacked <default=search>]),
+  [
+  # Option present
+  if test $is_win32 = yes ; then
+     AC_MSG_ERROR([The option: --with-ftd2xx-linux-tardir is only usable on linux])
+  fi
+  if test -d $with_ftd2xx_linux_tardir
+  then
+	with_ftd2xx_linux_tardir=`cd $with_ftd2xx_linux_tardir && pwd`
+	AC_MSG_NOTICE([Using: ftdichip.com library: $with_ftd2xx_linux_tardir])
+  else
+	AC_MSG_ERROR([Parameter to --with-ftd2xx-linux-tardir is not a dir: $with_ftd2xx_linux_tardir])
+  fi
+  ],
+  [
+  # Not given 
+  true
+  ]
+)
+
+
+AC_ARG_WITH(ftd2xx-lib,
+	AS_HELP_STRING([--with-ftd2xx-lib], [Use static or shared ftd2xx libs on default static]),
+[
+case "$withval" in
+static)
+	with_ftd2xx_lib=$withval
+	;;
+shared)
+	with_ftd2xx_lib=$withval
+	;;
+*)
+	AC_MSG_ERROR([Option: --with-ftd2xx-lib=static or --with-ftd2xx-lib=shared not, $withval])
+	;;
+esac
+],
+[
+	# Default is static - it is simpler :-(
+	with_ftd2xx_lib=static
+]
+)
+
 AC_ARG_ENABLE(gccwarnings,
 	AS_HELP_STRING([--enable-gccwarnings], [Enable compiler warnings, default no]),
 	[gcc_warnings=$enableval], [gcc_warnings=no])
@@ -52,11 +179,11 @@
 esac
 
 AC_ARG_ENABLE(ft2232_libftdi,
-  AS_HELP_STRING([--enable-ft2232_libftdi], [Enable building support for FT2232 based devices using the libftdi driver]), 
+  AS_HELP_STRING([--enable-ft2232_libftdi], [Enable building support for FT2232 based devices using the libftdi driver, opensource alternate of FTD2XX]), 
   [build_ft2232_libftdi=$enableval], [build_ft2232_libftdi=no])
 
 AC_ARG_ENABLE(ft2232_ftd2xx,
-  AS_HELP_STRING([--enable-ft2232_ftd2xx], [Enable building support for FT2232 based devices using the FTD2XX driver]), 
+  AS_HELP_STRING([--enable-ft2232_ftd2xx], [Enable building support for FT2232 based devices using the FTD2XX driver from ftdichip.com]), 
   [build_ft2232_ftd2xx=$enableval], [build_ft2232_ftd2xx=no])
  
 AC_ARG_ENABLE(amtjtagaccel,
@@ -120,11 +247,6 @@
   AS_HELP_STRING([--enable-rlink], [Enable building support for the Raisonance RLink JTAG Programmer]),
   [build_rlink=$enableval], [build_rlink=no])
 
-AC_ARG_WITH(ftd2xx,
-        [AS_HELP_STRING(--with-ftd2xx,
-           [Where libftd2xx can be found <default=search>])],
-        [],
-        with_ftd2xx=search)
 
 case $host in 
   *-cygwin*) 
@@ -296,6 +418,198 @@
   AC_DEFINE(BUILD_RLINK, 0, [0 if you don't want the RLink JTAG driver.])
 fi
 
+#-- Deal with MingW/Cygwin FTD2XX issues
+
+if test $is_win32 = yes; then
+if test "${with_ftd2xx_linux_tardir+set}" = set
+then
+   AC_MSG_ERROR([The option: with_ftd2xx_linux_tardir is for LINUX only.])
+fi
+
+if test $build_ft2232_ftd2xx = yes ; then
+AC_MSG_CHECKING([for ftd2xx.lib exists (win32)])
+
+   # if we are given a zipdir...
+   if test "${with_ftd2xx_win32_zipdir+set}" = set
+   then
+      # Set the CFLAGS for "ftd2xx.h"
+      f=$with_ftd2xx_win32_zipdir/ftd2xx.h
+      if test ! -f $f ; then
+      	 AC_MSG_ERROR([File: $f cannot be found])
+      fi
+      CFLAGS="$CFLAGS -I$with_ftd2xx_win32_zipdir"
+
+      # And calculate the LDFLAGS for the machine
+      case "$host_cpu" in
+      i?86|x86_*)
+	LDFLAGS="$LFLAGS -L$with_ftd2xx_win32_zipdir/i386"
+	LIBS="$LIBS -lftd2xx"
+	f=$with_ftd2xx_win32_zipdir/i386/ftd2xx.lib
+	;;
+      amd64)
+	LDFLAGS="$LFLAGS -L$with_ftd2xx_win32_zipdir/amd64"
+	LIBS="$LIBS -lftd2xx"
+	f=$with_ftd2xx_win32_zipdir/amd64/ftd2xx.lib
+	;;
+      *)
+	AC_MSG_ERROR([Unknown Win32 host cpu: $host_cpu])
+        ;;
+       esac
+       if test ! -f $f ; then
+       	  AC_MSG_ERROR([Library: $f not found])
+       fi
+   else
+      LIBS="$LIBS -lftd2xx"
+      AC_MSG_WARN([ASSUMPTION: The (win32) FTDICHIP.COM files: ftd2xx.h and ftd2xx.lib are in a proper place])
+   fi
+fi
+fi
+
+
+if test $is_win32 = no; then
+
+if test "${with_ftd2xx_win32_zipdir+set}" = set
+then
+   AC_MSG_ERROR([The option: --with-ftd2xx-win32-zipdir is for win32 only])
+fi
+
+if test $build_ft2232_ftd2xx = yes ; then
+   AC_MSG_CHECKING([for libftd2xx.a (linux)])
+   # Must be linux -
+   # Cause FTDICHIP does not supply a MAC-OS version
+   if test $host_os != linux-gnu; then
+      AC_MSG_ERROR([The (linux) ftd2xx library from FTDICHIP.com is linux only. Try --enable-ft2232-libftdi instead])
+   fi
+   # Are we given a TAR directory?
+   if test "${with_ftd2xx_linux_tardir+set}" = set
+   then
+	# The .H file is simple..
+	f=$with_ftd2xx_linux_tardir/ftd2xx.h
+	if test ! -f $f ; then
+	   AC_MSG_ERROR([Option: --with-ftd2xx-linux-tardir appears wrong, cannot find: $f])
+	fi
+	CFLAGS="$CFLAGS -I$with_ftd2xx_linux_tardir"
+	if test $with_ftd2xx_lib = shared
+	then
+	    LDFLAGS="$LDFLAGS -L$with_ftd2xx_linux_tardir"
+	    LIBS="$LIBS -lftd2xx"
+	    AC_MSG_RESULT([ Assuming: -L$with_ftd2xx_linux_tardir -lftd2xx])
+	else
+	    # Test #1 - Future proof - if/when ftdichip fixes their distro.
+	    # Try it with the simple ".a" suffix.
+	    f=$with_ftd2xx_linux_tardir/static_lib/libftd2xx.a
+	    if test -f $f ; then
+	       # Yea we are done
+	       LDFLAGS="$LDFLAGS -L$with_ftd2xx_linux_tardir/static_lib"
+	       LIBS="$LIBS -lftd2xx"
+            else
+	       # Test Number2.
+	       # Grr.. perhaps it exists as a version number?
+	       f="$with_ftd2xx_linux_tardir/static_lib/libftd2xx.a.*.*.*"
+	       count=`ls $f | wc -l`
+	       if test $count -gt 1 ; then
+	          AC_MSG_ERROR([Multiple libftd2xx.a files found in: $with_ftd2xx_linux_tardir/static_lib sorry cannot handle this yet])
+	       fi
+	       if test $count -ne 1 ; then
+	          AC_MSG_ERROR([Not found: $f, option: --with-ftd2xx-linux-tardir appears to be wrong])
+	       fi
+	       # Because the "-l" rules do not understand version numbers...
+	       # we will just stuff the absolute path onto the LIBS variable
+	       f=`ls $f`
+	       #
+	       LIBS="$LIBS $f -lpthread"
+	       # No need to bother with LDFLAGS...
+	    fi
+	    AC_MSG_RESULT([Found: $f])
+        fi
+   else
+	LIBS="$LIBS -lftd2xx"
+	AC_MSG_RESULT([Assumed: installed])
+	AC_MSG_WARN([The (linux) FTDICHIP.COM files ftd2xx.h and libftd2xx.so are assumed to be in a proper place])
+   fi
+fi
+fi
+
+if test $build_ft2232_ftd2xx = yes; then
+
+# Before we go any further - make sure we can *BUILD* and *RUN*
+# a simple app with the "ftd2xx.lib" file - in what ever form we where given
+# We should be able to compile, link and run this test program now
+  AC_MSG_CHECKING([Test: Build & Link with ftd2xx])
+
+#
+# Save the LDFLAGS for later..
+LDFLAGS_SAVE=$LDFLAGS
+CFLAGS_SAVE=$CFLAGS
+_LDFLAGS=`eval echo $LDFLAGS`
+_CFLAGS=`eval echo $CFLAGS`
+LDFLAGS=$_LDFLAGS
+CFLAGS=$_CFLAGS
+  AC_RUN_IFELSE(
+[
+#include "confdefs.h"
+#if IS_WIN32
+#include "windows.h"
+#endif
+#include <stdio.h>
+#include <ftd2xx.h>
+
+int
+main( int argc, char **argv )
+{
+	DWORD x;
+	FT_GetLibraryVersion( &x );
+	return 0;
+}
+], [ AC_MSG_RESULT([Success!])] , [ AC_MSG_ERROR([Cannot build & run test program using ftd2xx.lib]) ] )
+LDFLAGS=$LDFLAGS_SAVE
+CFLAGS=$CFLAGS_SAVE
+fi
+
+if test $build_ft2232_libftdi = yes ; then
+   # We assume: the package is preinstalled in the proper place
+   # these present as 2 libraries..
+   LIBS="$LIBS -lftdi -lusb"
+   # 
+   # Try to build a small program.
+   AC_MSG_CHECKING([Build & Link with libftdi...])
+
+LDFLAGS_SAVE=$LDFLAGS
+CFLAGS_SAVE=$CFLAGS
+_LDFLAGS=`eval echo $LDFLAGS`
+_CFLAGS=`eval echo $CFLAGS`
+LDFLAGS=$_LDFLAGS
+CFLAGS=$_CFLAGS
+
+   AC_RUN_IFELSE(
+[
+#include <stdio.h>
+#include <ftdi.h>
+
+int
+main( int argc, char **argv )
+{
+	struct ftdi_context *p;
+	p = ftdi_new();
+	if( p != NULL ){
+	    return 0;
+	} else {
+	    fprintf( stderr, "calling ftdi_new() failed\n");
+	    return 1;
+        }
+}
+]
+, 
+[ AC_MSG_RESULT([Success]) ]
+, 
+[ AC_MSG_ERROR([Cannot build & run test program using libftdi]) ] )
+# Restore the 'unexpanded ldflags'
+LDFLAGS=$LDFLAGS_SAVE
+CFLAGS=$CFLAGS_SAVE
+fi
+   
+
+
 AM_CONFIG_HEADER(config.h)
 AM_INIT_AUTOMAKE(openocd, 1.0)
 
@@ -321,7 +635,6 @@
 AM_CONDITIONAL(IS_CYGWIN, test $is_cygwin = yes)
 AM_CONDITIONAL(IS_MINGW, test $is_mingw = yes)
 AM_CONDITIONAL(IS_WIN32, test $is_win32 = yes)
-AM_CONDITIONAL(FTD2XXDIR, test $with_ftd2xx != search)
 AM_CONDITIONAL(BITQ, test $build_bitq = yes)
 
 AC_LANG_C
@@ -377,6 +690,6 @@
 AC_MSG_RESULT([$EXEEXT_FOR_BUILD])
 AC_SUBST(EXEEXT_FOR_BUILD)
 
-AC_SUBST(WITH_FTD2XX, $with_ftd2xx)
+#AC_SUBST(WITH_FTD2XX, $with_ftd2xx)
 
 AC_OUTPUT(Makefile src/Makefile src/helper/Makefile src/jtag/Makefile src/xsvf/Makefile src/target/Makefile src/server/Makefile src/flash/Makefile src/pld/Makefile doc/Makefile)

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/doc/openocd.texi	2008-12-27 01:15:50 UTC (rev 1275)
@@ -127,11 +127,13 @@
 @chapter Building
 @cindex building OpenOCD
 
+ at section Pre-Built Tools
 If you are interested in getting actual work done rather than building
 OpenOCD, then check if your interface supplier provides binaries for
 you. Chances are that that binary is from some SVN version that is more
 stable than SVN trunk where bleeding edge development takes place.
 
+ at section Building From Source
 
 You can download the current SVN version with SVN client of your choice from the
 following repositories:
@@ -166,8 +168,7 @@
 homepage (@uref{www.amontec.com}), as the JTAGkey uses a non-standard VID/PID. 
 @end itemize
 
-libftdi is supported under windows. Versions earlier than 0.13 will require patching.
-see contrib/libftdi for more details.
+libftdi is supported under windows. Do not use versions earlier then 0.14.
 
 In general, the D2XX driver provides superior performance (several times as fast),
 but has the draw-back of being binary-only - though that isn't that bad, as it isn't
@@ -179,36 +180,38 @@
 @end example
 Bootstrap generates the configure script, and prepares building on your system.
 @example
- ./configure 
+ ./configure [options, see below]
 @end example
 Configure generates the Makefiles used to build OpenOCD.
 @example
  make 
+ make install
 @end example
-Make builds OpenOCD, and places the final executable in ./src/.
+Make builds OpenOCD, and places the final executable in ./src/, the last step, ``make install'' is optional.
 
 The configure script takes several options, specifying which JTAG interfaces
 should be included:
 
 @itemize @bullet
 @item
- at option{--enable-parport}
+ at option{--enable-parport} - Bit bang pc printer ports.
 @item
- at option{--enable-parport_ppdev}
+ at option{--enable-parport_ppdev} - Parallel Port [see below]
 @item
- at option{--enable-parport_giveio}
+ at option{--enable-parport_giveio} - Parallel Port [see below]
 @item
- at option{--enable-amtjtagaccel}
+ at option{--enable-amtjtagaccel} - Parallel Port [Amontec, see below]
 @item
- at option{--enable-ft2232_ftd2xx}
- at footnote{Using the latest D2XX drivers from FTDI and following their installation
-instructions, I had to use @option{--enable-ft2232_libftd2xx} for OpenOCD to
-build properly.}
+ at option{--enable-ft2232_ftd2xx} - Numerous USB Type ARM JTAG dongles use the FT2232C chip from this FTDICHIP.COM chip (closed source).
 @item
- at option{--enable-ft2232_libftdi}
+ at option{--enable-ft2232_libftdi} - An open source (free) alternate to FTDICHIP.COM ftd2xx solution (Linux, MacOS, Cygwin)
 @item
- at option{--with-ftd2xx=/path/to/d2xx/}
+ at option{--with-ftd2xx-win32-zipdir=PATH} - If using FTDICHIP.COM ft2232c, point at the directory where the Win32 FTDICHIP.COM 'CDM' driver zip file was unpacked.
 @item
+ at option{--with-ftd2xx-linux-tardir=PATH} - Linux only equal of @option{--with-ftd2xx-win32-zipdir}, where you unpacked the TAR.GZ file.
+ at item
+ at option{--with-ftd2xx-lib=shared|static} - Linux only. Default: static, specifies how the FTDICHIP.COM libftd2xx driver should be linked. Note 'static' only works in conjunction with @option{--with-ftd2xx-linux-tardir}. Shared is supported (12/26/2008), however you must manually install the required header files and shared libraries in an appropriate place. This uses ``libusb'' internally.
+ at item
 @option{--enable-gw16012}
 @item
 @option{--enable-usbprog}
@@ -217,24 +220,73 @@
 @item
 @option{--enable-presto_ftd2xx}
 @item
- at option{--enable-jlink}
+ at option{--enable-jlink} - From SEGGER
 @item
- at option{--enable-rlink}
+ at option{--enable-rlink} - Raisonance.com dongle.
 @end itemize
 
+ at section Parallel Port Dongles
+
 If you want to access the parallel port using the PPDEV interface you have to specify
 both the @option{--enable-parport} AND the @option{--enable-parport_ppdev} option since
 the @option{--enable-parport_ppdev} option actually is an option to the parport driver
 (see @uref{http://forum.sparkfun.com/viewtopic.php?t=3795} for more info).
 
-Cygwin users have to specify the location of the FTDI D2XX package. This should be an
-absolute path containing no spaces.
+ at section FT2232C Based USB Dongles 
 
-Linux users should copy the various parts of the D2XX package to the appropriate
-locations, i.e. /usr/include, /usr/lib. 
+There are 2 methods of using the FTD2232, either (1) using the
+FTDICHIP.COM closed source driver, or (2) the open (and free) driver
+libftdi. Some claim the (closed) FTDICHIP.COM solution is faster.
 
-Miscellaneous configure options
+The FTDICHIP drivers come as either a (win32) ZIP file, or a (linux)
+TAR.GZ file. You must unpack them ``some where'' convient. As of this
+writing (12/26/2008) FTDICHIP does not supply means to install these
+files ``in an appropriate place'' As a result, there are two
+``./configure'' options that help. 
 
+Below is an example build process:
+
+1) Check out the latest version of ``openocd'' from SVN.
+
+2) Download & Unpack either the Windows or Linux FTD2xx Drivers
+    (@uref{http://www.ftdichip.com/Drivers/D2XX.htm})
+
+ at example
+   /home/duane/ftd2xx.win32    => the Cygwin/Win32 ZIP file contents.
+   /home/duane/libftd2xx0.4.16 => the Linux TAR file contents.
+ at end example
+
+3) Configure with these options:
+
+ at example
+Cygwin FTCICHIP solution
+   ./configure --prefix=/home/duane/mytools \ 
+                  --enable-ft2232_ftd2xx \
+                  --with-ftd2xx-win32-zipdir=/home/duane/ftd2xx.win32
+
+Linux FTDICHIP solution
+   ./configure --prefix=/home/duane/mytools \
+                  --enable-ft2232_ftd2xx \
+                  --with-ft2xx-linux-tardir=/home/duane/libftd2xx0.4.16
+
+Cygwin/Linux LIBFTDI solution
+    Assumes: 
+    1a) For Windows: The windows port of LIBUSB is in place.
+    1b) For Linux: libusb has been built and is inplace.
+
+    2) And libftdi has been built and installed
+    Note: libftdi - relies upon libusb.
+
+    ./configure --prefix=/home/duane/mytools \
+                   --enable-ft2232_libftdi
+       
+ at end example
+
+4) Then just type ``make'', and perhaps ``make install''.
+
+
+ at section Miscellaneous configure options
+
 @itemize @bullet
 @item
 @option{--enable-gccwarnings} - enable extra gcc warnings during build

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/src/Makefile.am	2008-12-27 01:15:50 UTC (rev 1275)
@@ -55,33 +55,15 @@
 endif
 endif
 
-if IS_WIN32
-if FTD2XXDIR
-FTD2XXLDADD = @WITH_FTD2XX@/FTD2XX.lib
-else
-FTD2XXLDADD = -lftd2xx
-endif
-else
-FTD2XXLDADD = -lftd2xx 
-endif
-  
-if FT2232_FTD2XX
-FTD2XXLIB = $(FTD2XXLDADD)
-else
-if PRESTO_FTD2XX
-FTD2XXLIB = $(FTD2XXLDADD)
-else
-FTD2XXLIB =
-endif
-endif
 
+
 openocd_LDADD = $(top_builddir)/src/xsvf/libxsvf.a \
 	$(top_builddir)/src/target/libtarget.a $(top_builddir)/src/jtag/libjtag.a \
 	$(top_builddir)/src/helper/libhelper.a \
 	$(top_builddir)/src/server/libserver.a $(top_builddir)/src/helper/libhelper.a \
 	$(top_builddir)/src/flash/libflash.a $(top_builddir)/src/target/libtarget.a \
 	$(top_builddir)/src/pld/libpld.a \
-	$(FTDI2232LIB) $(FTD2XXLIB) $(MINGWLDADD) $(LIBUSB)
+	$(FTDI2232LIB) $(MINGWLDADD) $(LIBUSB)
 
 
 if HTTPD

Modified: trunk/src/helper/options.c
===================================================================
--- trunk/src/helper/options.c	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/src/helper/options.c	2008-12-27 01:15:50 UTC (rev 1275)
@@ -178,7 +178,8 @@
 	if (version_flag)
 	{
 		/* Nothing to do, version gets printed automatically. */
-		exit(-1);
+		// It is not an error to request the VERSION number.
+		exit(0);
 	}
 	
 	return ERROR_OK;

Modified: trunk/src/jtag/Makefile.am
===================================================================
--- trunk/src/jtag/Makefile.am	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/src/jtag/Makefile.am	2008-12-27 01:15:50 UTC (rev 1275)
@@ -1,15 +1,6 @@
 
-if FTD2XXDIR
-if IS_MINGW
-FTD2XXINC = -I at WITH_FTD2XX@
-else
-FTD2XXINC = -I at WITH_FTD2XX@/
-endif
-else
-FTD2XXINC =
-endif
 
-INCLUDES = -I$(top_srcdir)/src -I$(top_srcdir)/src/helper $(FTD2XXINC) $(all_includes) -I$(top_srcdir)/src/target 
+INCLUDES = -I$(top_srcdir)/src -I$(top_srcdir)/src/helper  $(all_includes) -I$(top_srcdir)/src/target 
 METASOURCES = AUTO
 noinst_LIBRARIES = libjtag.a
 

Added: trunk/testing/build.tests/Makefile
===================================================================
--- trunk/testing/build.tests/Makefile	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/Makefile	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,90 @@
+# -*- mode: makefile -*-
+#
+default: _complain_
+include ./local.uses
+
+%: _complain_
+
+
+_complain_:
+	@echo ""
+	@echo " Try the target: cygwin.buildtest or linux.buildtest "
+	@echo ""
+
+remove.install:
+	rm -rf ${INSTALL_DIR}
+
+.PHONY: remove.install
+
+cygwin.buildtest:
+	${MAKE} -f Makefile.ftd2xx clean all
+	${MAKE} -f Makefile.openocd cygwin.easy.permutations
+	${MAKE} -f Makefile.openocd mingw32.easy.permutations
+	${MAKE} -f Makefile.libftdi all
+	${MAKE} -f Makefile.openocd cygwin.libftdi
+
+linux.buildtest: 
+	${MAKE} linux.easy.buildtest
+	${MAKE} linux.ftd2xx_installed 
+	${MAKE} linux.ft2232_libftdi
+	@echo ""
+	@echo ""
+	@echo "========================================"
+	@echo " Linux Build Tests Complete "
+	@echo "========================================"
+	@echo ""
+	@echo ""
+
+
+linux.easy.buildtest:
+	@test -d openocd || (echo "Where the source to openocd?" && exit 1)
+	${MAKE} -f Makefile.openocd bootstrap
+	${MAKE} -f Makefile.ftd2xx  all
+	${MAKE} -f Makefile.openocd linux.easy.permutations
+
+linux.ftd2xx_installed: 
+	${MAKE} remove.install
+	${MAKE} linux.ftd2xx_installed.setup
+	${MAKE} -f Makefile.openocd $@
+
+ linux.ft2232_libftdi:
+	${MAKE} remove.install 
+	${MAKE} -f Makefile.libusb  all
+	${MAKE} -f Makefile.confuse all
+	${MAKE} -f Makefile.libftdi all
+	${MAKE} -f Makefile.openocd $@
+
+# This target is used to "install" files from
+# the FTDICHIP.COM tar.gz unpack directory
+# into "a proper place" - where they should be found.
+linux.ftd2xx_installed.setup:
+	mkdir -p ${INSTALL_DIR}/include
+	mkdir -p ${EXEC_PREFIX}/lib
+	@#
+	@# Sanity check - make sure the .H file is findable
+	@#
+	@f=$(FTD2XX_LINUX_DIR)/ftd2xx.h && \
+	test -f $$f || (echo "Error: $$f not found" ; exit 1)
+	@#
+	@# Header files are simple... just copy them.
+	@#
+	cp $(FTD2XX_LINUX_DIR)/ftd2xx.h   $(PREFIX)/include/.
+	cp $(FTD2XX_LINUX_DIR)/WinTypes.h $(PREFIX)/include/.
+	@#
+	@# .SO files are harder.
+	@#     (1) copy them, (2) make links
+	@#
+	cp $(FTD2XX_LINUX_DIR)/libftd2xx.so.$(FTD2XX_LINUX_VERSION) $(EXEC_PREFIX)/lib/.
+	cd $(EXEC_PREFIX)/lib && rm -f libftd2xx.so.0
+	cd $(EXEC_PREFIX)/lib && ln -s libftd2xx.so.$(FTD2XX_LINUX_VERSION) libftd2xx.so.0
+	cd $(EXEC_PREFIX)/lib && rm -f libftd2xx.so
+	cd $(EXEC_PREFIX)/lib && ln -s libftd2xx.so.$(FTD2XX_LINUX_VERSION) libftd2xx.so
+
+
+.PHONY: linux.buildtest \
+	linux.easy.buildtest \
+	linux.ftd2xx_installed \
+	linux.ft22232_libftdi \
+	linux.ftd2xx_installed.setup
+
+


Property changes on: trunk/testing/build.tests/Makefile
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/Makefile.confuse
===================================================================
--- trunk/testing/build.tests/Makefile.confuse	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/Makefile.confuse	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,46 @@
+# -*- mode: makefile -*-
+default: _complain_
+include ./local.uses
+
+TARFILE_LOCAL=${VIRGINS}/confuse-${LIBCONFUSE_VERSION}.tar.gz
+TARFILE_URL  =http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/confuse-${LIBCONFUSE_VERSION}.tar.gz
+
+CONFUSE_SRC_DIR   =${HERE}/confuse-${LIBCONFUSE_VERSION}
+CONFUSE_BUILD_DIR =${HERE}/confuse-build
+
+download:
+	wget -O ${TARFILE_LOCAL} ${TARFILE_URL}
+
+unpack:
+	rm -rf ${CONFUSE_SRC_DIR}
+	tar xfz ${TARFILE_LOCAL}
+
+clean::
+	rm -rf ${CONFUSE_SRC_DIR}
+
+configure:
+	rm -rf ${CONFUSE_BUILD_DIR} 
+	mkdir ${CONFUSE_BUILD_DIR}
+	cd ${CONFUSE_BUILD_DIR} && ${CONFUSE_SRC_DIR}/configure \
+	   --prefix=${PREFIX} \
+	   --exec-prefix=${EXEC_PREFIX}
+
+clean::
+	rm -rf ${CONFUSE_BUILD_DIR}
+
+build:
+	cd ${CONFUSE_BUILD_DIR} && ${MAKE}
+
+install:
+	cd ${CONFUSE_BUILD_DIR} && ${MAKE} install
+
+all: unpack configure build install
+
+_complain_:
+	@echo ""
+	@echo "Please try one of these targets: bootstrap, clean, configure, build, install"
+	@echo " Or read the makefile and learn about the permutation test targets"
+	@echo ""
+	@echo "You also might find the download and unpack targets helpful."
+	@echo ""
+	@exit 1

Added: trunk/testing/build.tests/Makefile.ftd2xx
===================================================================
--- trunk/testing/build.tests/Makefile.ftd2xx	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/Makefile.ftd2xx	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,88 @@
+# -*- mode: makefile -*-
+#
+default: _complain_
+
+include ./local.uses
+
+# WARNING... the file on the ftdi chip site has a SPACE in the filename GRRR!!!
+# We fix that with the "-O" option to wget.
+ZIPFILE_LOCAL=${VIRGINS}/cdm.${FTD2XX_WIN32_VERSION}.zip
+ZIPFILE_URL  ="http://www.ftdichip.com/Drivers/CDM/CDM ${FTD2XX_WIN32_VERSION}.zip"
+
+TARFILE_LOCAL=${VIRGINS}/libftd2xx${FTD2XX_LINUX_VERSION}.tar.gz
+TARFILE_URL  =http://www.ftdichip.com/Drivers/D2XX/Linux/libftd2xx${FTD2XX_LINUX_VERSION}.tar.gz
+
+TARFILE_64_LOCAL=${VIRGINS}/libftd2xx${FTD2XX_LINUX_VERSION}_x86_64.tar.gz
+TARFILE_64_URL  =http://www.ftdichip.com/Drivers/D2XX/Linux/libftd2xx${FTD2XX_LINUX_VERSION}_x86_64.tar.gz
+
+
+download.win32:
+	mkdir -p ${VIRGINS}
+	wget -O ${ZIPFILE_LOCAL} ${ZIPFILE_URL}
+
+unpack.win32:
+	rm -rf ${FTD2XX_WIN32_DIR}
+	mkdir -p ${FTD2XX_WIN32_DIR}
+	cd ${FTD2XX_WIN32_DIR} && unzip ${ZIPFILE_LOCAL}
+
+clean::
+	rm -rf ${FTD2XX_WIN32_DIR}
+
+download.linux:
+	mkdir -p ${VIRGINS}
+	wget -O ${TARFILE_LOCAL} ${TARFILE_URL}
+
+clean:: 
+	rm -rf ${FTD2XX_LINUX_DIR}
+
+unpack.linux:
+	rm -rf ${FTD2XX_LINUX_DIR}
+	mkdir -p ${FTD2XX_LINUX_DIR}
+	tar xfz ${TARFILE_LOCAL}
+
+download.linux.x86_64:
+	mkdir -p ${VIRGINS}
+	wget -O ${TARFILE_LOCAL} ${TARFILE_URL}
+
+unpack.linux.x86_64:
+	rm -rf ${FTD2XX_LINUX_64_DIR}
+	mkdir -p ${FTD2XX_LINUX_64_DIR}
+	tar xfz ${TARFILE_64_LOCAL}
+
+clean::
+	rm -rf ${FTD2XX_LINUX_64_DIR}
+
+download: download.win32 download.linux
+
+unpack.cygwin unpack.mingw32: unpack.win32
+
+unpack: unpack.${BUILD_SYSNAME}
+
+# Nothing to do here
+build:
+	@echo "Done"
+
+#Nothing to do here
+configure:
+	@echo "Done"
+
+# Nothing to do here
+install: 
+	@echo "Done"
+
+all: unpack configure build install
+
+.PHONY: install
+
+# Nothing to do here
+clean::
+	@echo "Done"
+
+_complain_:
+	@echo ""
+	@echo "Please try one of these targets: bootstrap, clean, configure, build, install"
+	@echo " Or read the makefile and learn about the permutation test targets"
+	@echo ""
+	@echo "You also might find the download and unpack targets helpful."
+	@echo ""
+	@exit 1


Property changes on: trunk/testing/build.tests/Makefile.ftd2xx
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/Makefile.libftdi
===================================================================
--- trunk/testing/build.tests/Makefile.libftdi	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/Makefile.libftdi	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,51 @@
+# -*- mode: makefile -*-
+default: _complain_
+include ./local.uses
+
+TARFILE_LOCAL    = ${VIRGINS}/libftdi-${LIBFTDI_VERSION}.tar.gz
+TARFILE_URL      = http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/libftdi-${LIBFTDI_VERSION}.tar.gz
+
+LIBFTDI_SRC_DIR  = ${HERE}/libftdi-${LIBFTDI_VERSION}
+LIBFTDI_BUILD_DIR= ${HERE}/libftdi-build
+
+download:
+	mkdir -p virgins
+	wget -O  ${TARFILE_LOCAL} ${TARFILE_URL}
+
+clean::
+	rm -rf ${LIBFTDI_SRC_DIR}
+
+unpack:
+	tar xf ${TARFILE_LOCAL}
+
+PATH := ${EXEC_PREFIX}/bin:${PATH}
+export PATH
+
+clean::
+	rm -rf ${LIBFTDI_BUILD_DIR}
+
+configure:
+	rm -rf ${LIBFTDI_BUILD_DIR}
+	mkdir -p ${LIBFTDI_BUILD_DIR}
+	cd ${LIBFTDI_BUILD_DIR} && ${LIBFTDI_SRC_DIR}/configure \
+		--prefix=${PREFIX} \
+		--exec-prefix=${EXEC_PREFIX}
+
+build:
+	cd ${LIBFTDI_BUILD_DIR} && ${MAKE}
+
+install: 
+	cd ${LIBFTDI_BUILD_DIR} && ${MAKE} install
+
+all: unpack configure build install
+
+.PHONY: install
+
+_complain_:
+	@echo ""
+	@echo "Please try one of these targets: bootstrap, clean, configure, build, install"
+	@echo " Or read the makefile and learn about the permutation test targets"
+	@echo ""
+	@echo "You also might find the download and unpack targets helpful."
+	@echo ""
+	@exit 1


Property changes on: trunk/testing/build.tests/Makefile.libftdi
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/Makefile.libusb
===================================================================
--- trunk/testing/build.tests/Makefile.libusb	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/Makefile.libusb	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,55 @@
+# -*- mode: makefile -*-
+default: _complain_
+
+include ./local.uses
+
+ifeq (x"$BUILD_SYSNAME",x"cygwin")
+$(error Please use the Win32 specific port of LibUSB not the Unix version)
+endif
+ifeq (x"$BUILD_SYSNAME",x"mingw32")
+$(error Please use the win32 specific port of LibUSB not the Unix version)
+endif 
+
+TARFILE_LOCAL    = ${VIRGINS}/libusb-${LIBUSB_VERSION}.tar.bz2
+TARFILE_URL      = http://downloads.sourceforge.net/libusb/libusb-${LIBUSB_VERSION}.tar.gz
+
+LIBUSB_SRC_DIR   = ${HERE}/libusb-${LIBUSB_VERSION}
+LIBUSB_BUILD_DIR = ${HERE}/libusb-build
+
+download:
+	wget -O ${TARFILE_LOCAL} ${TARFILE_URL}
+
+unpack:
+	rm -rf ${LIBUSB_SRC_DIR}
+	tar xfz ${TARFILE_LOCAL}
+
+clean::
+	rm -rf ${LIBUSB_SRC_DIR}
+
+configure:
+	rm -rf ${LIBUSB_BUILD_DIR}
+	mkdir -p ${LIBUSB_BUILD_DIR}
+	cd ${LIBUSB_BUILD_DIR} && ${LIBUSB_SRC_DIR}/configure \
+		--prefix=${PREFIX} --exec-prefix=${EXEC_PREFIX}
+
+clean::
+	rm -rf ${LIBUSB_BUILD_DIR}
+
+build:
+	cd ${LIBUSB_BUILD_DIR} && ${MAKE}
+
+install: 
+	cd ${LIBUSB_BUILD_DIR} && ${MAKE} install
+
+all: unpack configure build install
+
+.PHONY: install
+
+_complain_:
+	@echo ""
+	@echo "Please try one of these targets: bootstrap, clean, configure, build, install"
+	@echo " Or read the makefile and learn about the permutation test targets"
+	@echo ""
+	@echo "You also might find the download and unpack targets helpful."
+	@echo ""
+	@exit 1


Property changes on: trunk/testing/build.tests/Makefile.libusb
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/Makefile.openocd
===================================================================
--- trunk/testing/build.tests/Makefile.openocd	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/Makefile.openocd	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,193 @@
+# -*- mode: makefile -*-
+#
+default: _complain_
+
+include ./local.uses
+
+
+SRC_DIR      ?= $(HERE)/openocd
+BUILD_SUFFIX ?= $(BUILD_MACHINE)
+BUILD_DIR =$(HERE)/openocd.$(BUILD_SUFFIX)
+
+checkout:
+	svn co https://svn.berlios.de/svnroot/repos/openocd/trunk openocd
+
+remove.install:
+	rm -rf ${INSTALL_DIR}
+
+#========================================
+# Win32 Build Permutations
+#   none
+#   parport
+#   ftd2xx - (ftdichip)
+#   libftd
+CONFIG_OPTIONS_win32_none     = 
+CONFIG_OPTIONS_win32_parport  = --enable-parport
+CONFIG_OPTIONS_win32_ftd2xx   = --enable-parport --enable-ft2232_ftd2xx --with-ftd2xx-win32-zipdir=$(FTD2XX_WIN32_DIR)
+
+CYGWIN_EASY_PERMUTATIONS += none
+CYGWIN_EASY_PERMUTATIONS += parport
+CYGWIN_EASY_PERMUTATIONS += ftd2xx
+
+MINGW32_EASY_PERMUTATIONS += none
+MINGW32_EASY_PERMUTATIONS += parport
+MINGW32_EASY_PERMUTATIONS += ftd2xx
+
+
+# This is not a possible permutation, it is manual :-(
+# Why? Because "libftdi" installs things into install/include
+# which would efect the 'ftd2xx' win32 build
+CONFIG_OPTIONS_win32_libftdi  = --enable-parport --enable-ft2232_libftdi
+
+# Default build for win32... is the ftd2xx type build.
+PERMUTE_win32          ?= $(BUILD_SYSNAME)_ftd2xx
+CONFIG_OPTIONS_win32   ?= $(CONFIG_OPTIONS_win32_$(PERMUTE_win32))
+CONFIG_OPTIONS_cygwin   = $(CONFIG_OPTIONS_win32)
+CONFIG_OPTIONS_mingw32  = $(CONFIG_OPTIONS_win32)
+
+#========================================
+# Linux Build Permuatations
+#    none
+#    parport
+#    ft2232_ftd2xx
+#    ft2232_libftdi 
+CONFIG_OPTIONS_linux_none    =
+LINUX_EASY_PERMUTATIONS     += none
+
+CONFIG_OPTIONS_linux_parport = --enable-parport
+LINUX_EASY_PERMUTATIONS     += parport
+
+CONFIG_OPTIONS_linux_ft2232_libftdi = --enable-parport --enable-ft2232-libftdi
+#this cannot be done as part of the permutations.
+#LINUX_EASY_PERMUTATIONS += ft2232_libftdi
+
+CONFIG_OPTIONS_linux_ft2232_ftd2xx_static  = \
+	--enable-parport \
+	--enable-ft2232-ftd2xx --with-ftd2xx-lib=static --with-ftd2xx-linux-tardir=$(FTD2XX_LINUX_DIR)
+LINUX_EASY_PERMUTATIONS += ft2232_ftd2xx_static
+
+# this is not a possible permutation it is manual :-(
+# why? because it interfers with the other permutations
+# by "installing files" in the $(INSTALL_DIR)
+CONFIG_OPTIONS_linux_ftd2xx_installed  = \
+	--enable-parport \
+	--enable-ft2232-ftd2xx \
+	--with-ftd2xx-lib=shared
+
+# The default build permutation is
+PERMUTE_linux ?= ft2232_ftd2xx_static
+CONFIG_OPTIONS_linux = $(CONFIG_OPTIONS_linux_$(PERMUTE_linux))
+
+CONFIG_OPTIONS_darwin=\
+	--enable-ftd2232-libftdi
+
+# Which build are we doing?
+CONFIG_OPTIONS := $(CONFIG_OPTIONS_$(BUILD_SYSNAME))
+
+bootstrap:
+	cd $(SRC_DIR) && bash ./bootstrap
+
+clean::
+	rm -rf $(BUILD_DIR)
+
+ifndef CFLAGS
+_CFLAGS=true
+else
+_CFLAGS=export CFLAGS="${CFLAGS}"
+endif
+
+
+# if this was given... then pass it on 
+configure:
+	@echo "     Build Sysname: $(BUILD_SYSNAME)"
+	@echo "    Config Options: $(CONFIG_OPTIONS)"
+	rm -rf $(BUILD_DIR)
+	mkdir $(BUILD_DIR)
+	${_CFLAGS} && \
+	cd $(BUILD_DIR) && \
+		$(SRC_DIR)/configure \
+			--prefix=$(PREFIX) \
+			--exec-prefix=$(EXEC_PREFIX) \
+			$(CONFIG_OPTIONS)
+
+build:
+	cd $(BUILD_DIR) && $(MAKE)
+
+install:
+	cd $(BUILD_DIR) && $(MAKE) install
+
+all: configure build install
+
+.PHONY: install
+
+# The "cygwin.libftdi" requires that libftdi be built
+# and installed *PRIOR* to running this target.
+# it is not part of the permutations because ... 
+# it interfers with the ftd2xx based builds
+cygwin.libftdi: 
+	$(MAKE) -f Makefile.openocd bootstrap
+	$(MAKE) BUILD_SUFFIX=$@ PERMUTE_win32=libftdi -f Makefile.openocd all
+
+cygwin.easy.permutations: remove.install ${CYGWIN_EASY_PERMUTATIONS:%=_cygwin.%}
+
+_cygwin.%:
+	@echo ""
+	@echo ""
+	@echo "========================================"
+	@echo "Permutation Build... $@"
+	@echo "========================================"
+	@echo ""
+	@echo ""
+	$(MAKE) PERMUTE_win32=$* BUILD_SUFFIX=cygwin.$* -f Makefile.openocd all 
+	$(EXEC_PREFIX)/bin/openocd -v   
+
+mingw32.easy.permutations: remove.install ${MINGW32_EASY_PERMUTATIONS:%=_mingw32.%}
+
+# I (duane) build openocd-mingw32 via Cygwin.
+# Sadly, the "mingw32" buid for cygwin does not include
+# the required "elf.h" header files... so ... 
+# we have them in our own private helper place.
+_mingw32.%:
+	@echo ""
+	@echo ""
+	@echo "========================================"
+	@echo "Permutation Build... $@"
+	@echo "========================================"
+	@echo ""
+	@echo ""
+	CFLAGS="-mno-cygwin -I$(HERE)/mingw32_help/include" \
+	$(MAKE) -f Makefile.openocd all ;\
+	$(EXEC_PREFIX)/bin/openocd -v   
+
+win32.permutations: mingw32.permutations cygwin.permutations
+
+
+# SMOKE TEST - Build every linux permuation...
+# If "openocd -v" does exit(0) we are good enough.
+
+linux.easy.permutations: remove.install ${LINUX_EASY_PERMUTATIONS:%=_linux.%}
+
+
+_linux.%:
+	@echo ""
+	@echo ""
+	@echo "========================================"
+	@echo "Permutation Build... $@"
+	@echo "========================================"
+	@echo ""
+	@echo ""
+	$(MAKE) PERMUTE_linux=$* BUILD_SUFFIX=linux.$* -f Makefile.openocd all 
+	$(EXEC_PREFIX)/bin/openocd -v   
+
+linux.ftd2xx_installed:
+	${MAKE} -f Makefile.openocd _$@
+
+linux.ft2232_libftdi:
+	${MAKE} -f Makefile.openocd _$@
+
+_complain_:
+	@echo ""
+	@echo "Please try one of these targets: bootstrap, clean, configure, build, install"
+	@echo " Or read the makefile and learn about the permutation test targets"
+	@echo ""
+	@exit 1


Property changes on: trunk/testing/build.tests/Makefile.openocd
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/local.uses
===================================================================
--- trunk/testing/build.tests/local.uses	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/local.uses	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,39 @@
+# -*- mode: makefile -*-
+HERE := $(shell pwd)
+
+# Solve problems on systems with DASH.. Grrr...
+SHELL=/bin/bash
+export SHELL
+
+VIRGINS=${HERE}/virgins
+
+# Determine the build platform.
+BUILD_SYSNAME_Linux      =linux
+BUILD_SYSNAME_linux      =linux
+BUILD_SYSNAME_CYGWIN_NT  =cygwin
+BUILD_SYSNAME_MINGW32_NT =mingw32
+BUILD_SYSNAME_Darwin     =darwin
+BUILD_SYSNAME_darwin     =darwin
+BUILD_SYSNAME :=$(BUILD_SYSNAME_$(shell uname --sysname | cut -d'-' -f1))
+
+# And machine (ie: i686, x86_64, or what)
+BUILD_MACHINE :=$(BUILD_SYSNAME).$(shell uname -m)
+
+
+INSTALL_DIR     := $(HERE)/install
+PREFIX          := ${INSTALL_DIR}
+EXEC_PREFIX     := ${INSTALL_DIR}/${BUILD_MACHINE}
+
+LIBFTDI_VERSION=0.14
+LIBCONFUSE_VERSION=2.5
+
+LIBUSB_VERSION_linux=0.1.12
+
+LIBUSB_VERSION=${LIBUSB_VERSION_${BUILD_SYSNAME}}
+
+FTD2XX_WIN32_VERSION=2.04.14
+FTD2XX_WIN32_DIR    = ${HERE}/ftd2xx.win32
+
+FTD2XX_LINUX_VERSION=0.4.16
+FTD2XX_LINUX_DIR    = ${HERE}/libftd2xx${FTD2XX_LINUX_VERSION}
+FTD2XX_LINUX_64_DIR = ${HERE}/libftd2xx${FTD2XX_LINUX_VERSION}_x86_64


Property changes on: trunk/testing/build.tests/local.uses
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/mingw32_help/include/elf.h
===================================================================
--- trunk/testing/build.tests/mingw32_help/include/elf.h	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/mingw32_help/include/elf.h	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,38 @@
+/* elf.h
+
+  Copyright 2005 Red Hat, Inc.
+
+This file is part of Cygwin.
+
+This software is a copyrighted work licensed under the terms of the
+Cygwin license.  Please consult the file "CYGWIN_LICENSE" for
+details. */
+
+#ifndef	_ELF_H_
+#define	_ELF_H_
+
+#include <stdint.h>
+
+typedef signed char int8_t;
+typedef unsigned char u_int8_t;
+typedef short int16_t;
+typedef unsigned short u_int16_t;
+typedef int int32_t;
+typedef unsigned int u_int32_t;
+typedef long long int64_t;
+typedef unsigned long long u_int64_t;
+typedef int32_t register_t;
+
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+#include <sys/types.h>
+#include <sys/elf32.h>
+#include <sys/elf64.h>
+#include <sys/elf_generic.h>
+#ifdef __cplusplus
+}
+#endif
+
+#endif /*_ELF_H_*/


Property changes on: trunk/testing/build.tests/mingw32_help/include/elf.h
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/mingw32_help/include/sys/cdefs.h
===================================================================
--- trunk/testing/build.tests/mingw32_help/include/sys/cdefs.h	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/mingw32_help/include/sys/cdefs.h	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,23 @@
+/* sys/cdefs.h
+
+   Copyright 1998, 2000, 2001 Red Hat, Inc.
+
+This file is part of Cygwin.
+
+This software is a copyrighted work licensed under the terms of the
+Cygwin license.  Please consult the file "CYGWIN_LICENSE" for
+details. */
+
+#ifndef	_SYS_CDEFS_H
+#define _SYS_CDEFS_H
+#ifdef	__cplusplus
+#define	__BEGIN_DECLS	extern "C" {
+#define	__END_DECLS	}
+#else
+#define	__BEGIN_DECLS
+#define	__END_DECLS
+#endif
+#define __P(protos)     protos		/* full-blown ANSI C */
+#define  __CONCAT(__x,__y)   __x##__y
+#endif
+


Property changes on: trunk/testing/build.tests/mingw32_help/include/sys/cdefs.h
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/mingw32_help/include/sys/elf32.h
===================================================================
--- trunk/testing/build.tests/mingw32_help/include/sys/elf32.h	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/mingw32_help/include/sys/elf32.h	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,156 @@
+/*-
+ * Copyright (c) 1996-1998 John D. Polstra.
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in the
+ *    documentation and/or other materials provided with the distribution.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
+ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
+ * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ *
+ * $FreeBSD: src/sys/sys/elf32.h,v 1.8 2002/05/30 08:32:18 dfr Exp $
+ */
+
+#ifndef _SYS_ELF32_H_
+#define _SYS_ELF32_H_ 1
+
+#include <sys/elf_common.h>
+
+/*
+ * ELF definitions common to all 32-bit architectures.
+ */
+
+typedef u_int32_t	Elf32_Addr;
+typedef u_int16_t	Elf32_Half;
+typedef u_int32_t	Elf32_Off;
+typedef int32_t		Elf32_Sword;
+typedef u_int32_t	Elf32_Word;
+typedef u_int32_t	Elf32_Size;
+typedef Elf32_Off	Elf32_Hashelt;
+
+/*
+ * ELF header.
+ */
+
+typedef struct {
+	unsigned char	e_ident[EI_NIDENT];	/* File identification. */
+	Elf32_Half	e_type;		/* File type. */
+	Elf32_Half	e_machine;	/* Machine architecture. */
+	Elf32_Word	e_version;	/* ELF format version. */
+	Elf32_Addr	e_entry;	/* Entry point. */
+	Elf32_Off	e_phoff;	/* Program header file offset. */
+	Elf32_Off	e_shoff;	/* Section header file offset. */
+	Elf32_Word	e_flags;	/* Architecture-specific flags. */
+	Elf32_Half	e_ehsize;	/* Size of ELF header in bytes. */
+	Elf32_Half	e_phentsize;	/* Size of program header entry. */
+	Elf32_Half	e_phnum;	/* Number of program header entries. */
+	Elf32_Half	e_shentsize;	/* Size of section header entry. */
+	Elf32_Half	e_shnum;	/* Number of section header entries. */
+	Elf32_Half	e_shstrndx;	/* Section name strings section. */
+} Elf32_Ehdr;
+
+/*
+ * Section header.
+ */
+
+typedef struct {
+	Elf32_Word	sh_name;	/* Section name (index into the
+					   section header string table). */
+	Elf32_Word	sh_type;	/* Section type. */
+	Elf32_Word	sh_flags;	/* Section flags. */
+	Elf32_Addr	sh_addr;	/* Address in memory image. */
+	Elf32_Off	sh_offset;	/* Offset in file. */
+	Elf32_Size	sh_size;	/* Size in bytes. */
+	Elf32_Word	sh_link;	/* Index of a related section. */
+	Elf32_Word	sh_info;	/* Depends on section type. */
+	Elf32_Size	sh_addralign;	/* Alignment in bytes. */
+	Elf32_Size	sh_entsize;	/* Size of each entry in section. */
+} Elf32_Shdr;
+
+/*
+ * Program header.
+ */
+
+typedef struct {
+	Elf32_Word	p_type;		/* Entry type. */
+	Elf32_Off	p_offset;	/* File offset of contents. */
+	Elf32_Addr	p_vaddr;	/* Virtual address in memory image. */
+	Elf32_Addr	p_paddr;	/* Physical address (not used). */
+	Elf32_Size	p_filesz;	/* Size of contents in file. */
+	Elf32_Size	p_memsz;	/* Size of contents in memory. */
+	Elf32_Word	p_flags;	/* Access permission flags. */
+	Elf32_Size	p_align;	/* Alignment in memory and file. */
+} Elf32_Phdr;
+
+/*
+ * Dynamic structure.  The ".dynamic" section contains an array of them.
+ */
+
+typedef struct {
+	Elf32_Sword	d_tag;		/* Entry type. */
+	union {
+		Elf32_Size	d_val;	/* Integer value. */
+		Elf32_Addr	d_ptr;	/* Address value. */
+	} d_un;
+} Elf32_Dyn;
+
+/*
+ * Relocation entries.
+ */
+
+/* Relocations that don't need an addend field. */
+typedef struct {
+	Elf32_Addr	r_offset;	/* Location to be relocated. */
+	Elf32_Word	r_info;		/* Relocation type and symbol index. */
+} Elf32_Rel;
+
+/* Relocations that need an addend field. */
+typedef struct {
+	Elf32_Addr	r_offset;	/* Location to be relocated. */
+	Elf32_Word	r_info;		/* Relocation type and symbol index. */
+	Elf32_Sword	r_addend;	/* Addend. */
+} Elf32_Rela;
+
+/* Macros for accessing the fields of r_info. */
+#define ELF32_R_SYM(info)	((info) >> 8)
+#define ELF32_R_TYPE(info)	((unsigned char)(info))
+
+/* Macro for constructing r_info from field values. */
+#define ELF32_R_INFO(sym, type)	(((sym) << 8) + (unsigned char)(type))
+
+/*
+ * Symbol table entries.
+ */
+
+typedef struct {
+	Elf32_Word	st_name;	/* String table index of name. */
+	Elf32_Addr	st_value;	/* Symbol value. */
+	Elf32_Size	st_size;	/* Size of associated object. */
+	unsigned char	st_info;	/* Type and binding information. */
+	unsigned char	st_other;	/* Reserved (not used). */
+	Elf32_Half	st_shndx;	/* Section index of symbol. */
+} Elf32_Sym;
+
+/* Macros for accessing the fields of st_info. */
+#define ELF32_ST_BIND(info)		((info) >> 4)
+#define ELF32_ST_TYPE(info)		((info) & 0xf)
+
+/* Macro for constructing st_info from field values. */
+#define ELF32_ST_INFO(bind, type)	(((bind) << 4) + ((type) & 0xf))
+
+#endif /* !_SYS_ELF32_H_ */


Property changes on: trunk/testing/build.tests/mingw32_help/include/sys/elf32.h
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/mingw32_help/include/sys/elf64.h
===================================================================
--- trunk/testing/build.tests/mingw32_help/include/sys/elf64.h	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/mingw32_help/include/sys/elf64.h	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,172 @@
+/*-
+ * Copyright (c) 1996-1998 John D. Polstra.
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in the
+ *    documentation and/or other materials provided with the distribution.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
+ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
+ * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ *
+ * $FreeBSD: src/sys/sys/elf64.h,v 1.10 2002/05/30 08:32:18 dfr Exp $
+ */
+
+#ifndef _SYS_ELF64_H_
+#define _SYS_ELF64_H_ 1
+
+#include <sys/elf_common.h>
+
+/*
+ * ELF definitions common to all 64-bit architectures.
+ */
+
+typedef uint64_t	Elf64_Addr;
+typedef uint16_t	Elf64_Half;
+typedef uint32_t	Elf64_Word;
+typedef int32_t		Elf64_Sword;
+typedef uint64_t	Elf64_Xword;
+typedef int64_t		Elf64_Sxword;
+typedef uint64_t	Elf64_Off;
+typedef uint16_t	Elf64_Section;
+typedef Elf64_Half	Elf64_Versym;
+typedef uint16_t	Elf64_Quarter;
+
+/*
+ * Types of dynamic symbol hash table bucket and chain elements.
+ *
+ * This is inconsistent among 64 bit architectures, so a machine dependent
+ * typedef is required.
+ */
+
+#ifdef __alpha__
+typedef Elf64_Off	Elf64_Hashelt;
+#else
+typedef Elf64_Half	Elf64_Hashelt;
+#endif
+
+/*
+ * ELF header.
+ */
+
+typedef struct {
+	unsigned char	e_ident[EI_NIDENT];	/* File identification. */
+	Elf64_Half	e_type;		/* File type. */
+	Elf64_Half	e_machine;	/* Machine architecture. */
+	Elf64_Word	e_version;	/* ELF format version. */
+	Elf64_Addr	e_entry;	/* Entry point. */
+	Elf64_Off	e_phoff;	/* Program header file offset. */
+	Elf64_Off	e_shoff;	/* Section header file offset. */
+	Elf64_Word	e_flags;	/* Architecture-specific flags. */
+	Elf64_Half	e_ehsize;	/* Size of ELF header in bytes. */
+	Elf64_Half	e_phentsize;	/* Size of program header entry. */
+	Elf64_Half	e_phnum;	/* Number of program header entries. */
+	Elf64_Half	e_shentsize;	/* Size of section header entry. */
+	Elf64_Half	e_shnum;	/* Number of section header entries. */
+	Elf64_Half	e_shstrndx;	/* Section name strings section. */
+} Elf64_Ehdr;
+
+/*
+ * Section header.
+ */
+
+typedef struct {
+	Elf64_Word	sh_name;	/* Section name (index into the
+					   section header string table). */
+	Elf64_Word	sh_type;	/* Section type. */
+	Elf64_Xword	sh_flags;	/* Section flags. */
+	Elf64_Addr	sh_addr;	/* Address in memory image. */
+	Elf64_Off	sh_offset;	/* Offset in file. */
+	Elf64_Xword	sh_size;	/* Size in bytes. */
+	Elf64_Word	sh_link;	/* Index of a related section. */
+	Elf64_Word	sh_info;	/* Depends on section type. */
+	Elf64_Xword	sh_addralign;	/* Alignment in bytes. */
+	Elf64_Xword	sh_entsize;	/* Size of each entry in section. */
+} Elf64_Shdr;
+
+/*
+ * Program header.
+ */
+
+typedef struct {
+	Elf64_Word	p_type;		/* Entry type. */
+	Elf64_Word	p_flags;	/* Access permission flags. */
+	Elf64_Off	p_offset;	/* File offset of contents. */
+	Elf64_Addr	p_vaddr;	/* Virtual address in memory image. */
+	Elf64_Addr	p_paddr;	/* Physical address (not used). */
+	Elf64_Xword	p_filesz;	/* Size of contents in file. */
+	Elf64_Xword	p_memsz;	/* Size of contents in memory. */
+	Elf64_Xword	p_align;	/* Alignment in memory and file. */
+} Elf64_Phdr;
+
+/*
+ * Dynamic structure.  The ".dynamic" section contains an array of them.
+ */
+
+typedef struct {
+	Elf64_Sxword	d_tag;		/* Entry type. */
+	union {
+		Elf64_Xword	d_val;	/* Integer value. */
+		Elf64_Addr	d_ptr;	/* Address value. */
+	} d_un;
+} Elf64_Dyn;
+
+/*
+ * Relocation entries.
+ */
+
+/* Relocations that don't need an addend field. */
+typedef struct {
+	Elf64_Addr	r_offset;	/* Location to be relocated. */
+	Elf64_Xword	r_info;		/* Relocation type and symbol index. */
+} Elf64_Rel;
+
+/* Relocations that need an addend field. */
+typedef struct {
+	Elf64_Addr	r_offset;	/* Location to be relocated. */
+	Elf64_Xword	r_info;		/* Relocation type and symbol index. */
+	Elf64_Sxword	r_addend;	/* Addend. */
+} Elf64_Rela;
+
+/* Macros for accessing the fields of r_info. */
+#define ELF64_R_SYM(info)	((info) >> 32)
+#define ELF64_R_TYPE(info)	((unsigned char)(info))
+
+/* Macro for constructing r_info from field values. */
+#define ELF64_R_INFO(sym, type)	(((sym) << 32) + (unsigned char)(type))
+
+/*
+ * Symbol table entries.
+ */
+
+typedef struct {
+	Elf64_Word	st_name;	/* String table index of name. */
+	unsigned char	st_info;	/* Type and binding information. */
+	unsigned char	st_other;	/* Reserved (not used). */
+	Elf64_Section	st_shndx;	/* Section index of symbol. */
+	Elf64_Addr	st_value;	/* Symbol value. */
+	Elf64_Xword	st_size;	/* Size of associated object. */
+} Elf64_Sym;
+
+/* Macros for accessing the fields of st_info. */
+#define ELF64_ST_BIND(info)		((info) >> 4)
+#define ELF64_ST_TYPE(info)		((info) & 0xf)
+
+/* Macro for constructing st_info from field values. */
+#define ELF64_ST_INFO(bind, type)	(((bind) << 4) + ((type) & 0xf))
+
+#endif /* !_SYS_ELF64_H_ */


Property changes on: trunk/testing/build.tests/mingw32_help/include/sys/elf64.h
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/mingw32_help/include/sys/elf_common.h
===================================================================
--- trunk/testing/build.tests/mingw32_help/include/sys/elf_common.h	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/mingw32_help/include/sys/elf_common.h	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,299 @@
+/*-
+ * Copyright (c) 1998 John D. Polstra.
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in the
+ *    documentation and/or other materials provided with the distribution.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
+ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
+ * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ *
+ * $FreeBSD: src/sys/sys/elf_common.h,v 1.15 2004/05/05 02:38:54 marcel Exp $
+ */
+
+#ifndef _SYS_ELF_COMMON_H_
+#define _SYS_ELF_COMMON_H_ 1
+
+/*
+ * ELF definitions that are independent of architecture or word size.
+ */
+
+/*
+ * Note header.  The ".note" section contains an array of notes.  Each
+ * begins with this header, aligned to a word boundary.  Immediately
+ * following the note header is n_namesz bytes of name, padded to the
+ * next word boundary.  Then comes n_descsz bytes of descriptor, again
+ * padded to a word boundary.  The values of n_namesz and n_descsz do
+ * not include the padding.
+ */
+
+typedef struct {
+	u_int32_t	n_namesz;	/* Length of name. */
+	u_int32_t	n_descsz;	/* Length of descriptor. */
+	u_int32_t	n_type;		/* Type of this note. */
+} Elf_Note;
+
+/* Indexes into the e_ident array.  Keep synced with
+   http://www.sco.com/developer/gabi/ch4.eheader.html */
+#define EI_MAG0		0	/* Magic number, byte 0. */
+#define EI_MAG1		1	/* Magic number, byte 1. */
+#define EI_MAG2		2	/* Magic number, byte 2. */
+#define EI_MAG3		3	/* Magic number, byte 3. */
+#define EI_CLASS	4	/* Class of machine. */
+#define EI_DATA		5	/* Data format. */
+#define EI_VERSION	6	/* ELF format version. */
+#define EI_OSABI	7	/* Operating system / ABI identification */
+#define EI_ABIVERSION	8	/* ABI version */
+#define OLD_EI_BRAND	8	/* Start of architecture identification. */
+#define EI_PAD		9	/* Start of padding (per SVR4 ABI). */
+#define EI_NIDENT	16	/* Size of e_ident array. */
+
+/* Values for the magic number bytes. */
+#define ELFMAG0		0x7f
+#define ELFMAG1		'E'
+#define ELFMAG2		'L'
+#define ELFMAG3		'F'
+#define ELFMAG		"\177ELF"	/* magic string */
+#define SELFMAG		4		/* magic string size */
+
+/* Values for e_ident[EI_VERSION] and e_version. */
+#define EV_NONE		0
+#define EV_CURRENT	1
+
+/* Values for e_ident[EI_CLASS]. */
+#define ELFCLASSNONE	0	/* Unknown class. */
+#define ELFCLASS32	1	/* 32-bit architecture. */
+#define ELFCLASS64	2	/* 64-bit architecture. */
+
+/* Values for e_ident[EI_DATA]. */
+#define ELFDATANONE	0	/* Unknown data format. */
+#define ELFDATA2LSB	1	/* 2's complement little-endian. */
+#define ELFDATA2MSB	2	/* 2's complement big-endian. */
+
+/* Values for e_ident[EI_OSABI]. */
+#define ELFOSABI_SYSV		0	/* UNIX System V ABI */
+#define ELFOSABI_NONE		ELFOSABI_SYSV	/* symbol used in old spec */
+#define ELFOSABI_HPUX		1	/* HP-UX operating system */
+#define ELFOSABI_NETBSD		2	/* NetBSD */
+#define ELFOSABI_LINUX		3	/* GNU/Linux */
+#define ELFOSABI_HURD		4	/* GNU/Hurd */
+#define ELFOSABI_86OPEN		5	/* 86Open common IA32 ABI */
+#define ELFOSABI_SOLARIS	6	/* Solaris */
+#define ELFOSABI_MONTEREY	7	/* Monterey */
+#define ELFOSABI_IRIX		8	/* IRIX */
+#define ELFOSABI_FREEBSD	9	/* FreeBSD */
+#define ELFOSABI_TRU64		10	/* TRU64 UNIX */
+#define ELFOSABI_MODESTO	11	/* Novell Modesto */
+#define ELFOSABI_OPENBSD	12	/* OpenBSD */
+#define ELFOSABI_ARM		97	/* ARM */
+#define ELFOSABI_STANDALONE	255	/* Standalone (embedded) application */
+
+/* e_ident */
+#define IS_ELF(ehdr)	((ehdr).e_ident[EI_MAG0] == ELFMAG0 && \
+			 (ehdr).e_ident[EI_MAG1] == ELFMAG1 && \
+			 (ehdr).e_ident[EI_MAG2] == ELFMAG2 && \
+			 (ehdr).e_ident[EI_MAG3] == ELFMAG3)
+
+/* Values for e_type. */
+#define ET_NONE		0	/* Unknown type. */
+#define ET_REL		1	/* Relocatable. */
+#define ET_EXEC		2	/* Executable. */
+#define ET_DYN		3	/* Shared object. */
+#define ET_CORE		4	/* Core file. */
+
+/* Values for e_machine. */
+#define EM_NONE		0	/* Unknown machine. */
+#define EM_M32		1	/* AT&T WE32100. */
+#define EM_SPARC	2	/* Sun SPARC. */
+#define EM_386		3	/* Intel i386. */
+#define EM_68K		4	/* Motorola 68000. */
+#define EM_88K		5	/* Motorola 88000. */
+#define EM_486		6	/* Intel i486. */
+#define EM_860		7	/* Intel i860. */
+#define EM_MIPS		8	/* MIPS R3000 Big-Endian only */
+
+/* Extensions.  This list is not complete. */
+#define EM_S370		9	/* IBM System/370 */
+#define EM_MIPS_RS4_BE	10	/* MIPS R4000 Big-Endian */ /* Depreciated */
+#define EM_PARISC	15	/* HPPA */
+#define EM_SPARC32PLUS	18	/* SPARC v8plus */
+#define EM_PPC		20	/* PowerPC 32-bit */
+#define EM_PPC64	21	/* PowerPC 64-bit */
+#define EM_ARM		40	/* ARM */
+#define EM_SPARCV9	43	/* SPARC v9 64-bit */
+#define EM_IA_64	50	/* Intel IA-64 Processor */
+#define EM_X86_64	62	/* Advanced Micro Devices x86-64 */
+#define EM_ALPHA	0x9026	/* Alpha (written in the absence of an ABI */
+
+/* Special section indexes. */
+#define SHN_UNDEF	     0		/* Undefined, missing, irrelevant. */
+#define SHN_LORESERVE	0xff00		/* First of reserved range. */
+#define SHN_LOPROC	0xff00		/* First processor-specific. */
+#define SHN_HIPROC	0xff1f		/* Last processor-specific. */
+#define SHN_ABS		0xfff1		/* Absolute values. */
+#define SHN_COMMON	0xfff2		/* Common data. */
+#define SHN_HIRESERVE	0xffff		/* Last of reserved range. */
+
+/* sh_type */
+#define SHT_NULL	0		/* inactive */
+#define SHT_PROGBITS	1		/* program defined information */
+#define SHT_SYMTAB	2		/* symbol table section */
+#define SHT_STRTAB	3		/* string table section */
+#define SHT_RELA	4		/* relocation section with addends */
+#define SHT_HASH	5		/* symbol hash table section */
+#define SHT_DYNAMIC	6		/* dynamic section */
+#define SHT_NOTE	7		/* note section */
+#define SHT_NOBITS	8		/* no space section */
+#define SHT_REL		9		/* relocation section - no addends */
+#define SHT_SHLIB	10		/* reserved - purpose unknown */
+#define SHT_DYNSYM	11		/* dynamic symbol table section */
+#define SHT_NUM		12		/* number of section types */
+#define SHT_LOOS	0x60000000	/* First of OS specific semantics */
+#define SHT_HIOS	0x6fffffff	/* Last of OS specific semantics */
+#define SHT_LOPROC	0x70000000	/* reserved range for processor */
+#define SHT_HIPROC	0x7fffffff	/* specific section header types */
+#define SHT_LOUSER	0x80000000	/* reserved range for application */
+#define SHT_HIUSER	0xffffffff	/* specific indexes */
+
+/* Flags for sh_flags. */
+#define SHF_WRITE	0x1		/* Section contains writable data. */
+#define SHF_ALLOC	0x2		/* Section occupies memory. */
+#define SHF_EXECINSTR	0x4		/* Section contains instructions. */
+#define SHF_TLS		0x400		/* Section contains TLS data. */
+#define SHF_MASKPROC	0xf0000000	/* Reserved for processor-specific. */
+
+/* Values for p_type. */
+#define PT_NULL		0	/* Unused entry. */
+#define PT_LOAD		1	/* Loadable segment. */
+#define PT_DYNAMIC	2	/* Dynamic linking information segment. */
+#define PT_INTERP	3	/* Pathname of interpreter. */
+#define PT_NOTE		4	/* Auxiliary information. */
+#define PT_SHLIB	5	/* Reserved (not used). */
+#define PT_PHDR		6	/* Location of program header itself. */
+#define	PT_TLS		7	/* Thread local storage segment */
+
+#define PT_COUNT	8	/* Number of defined p_type values. */
+
+#define	PT_LOOS		0x60000000	/* OS-specific */
+#define	PT_HIOS		0x6fffffff	/* OS-specific */
+#define PT_LOPROC	0x70000000	/* First processor-specific type. */
+#define PT_HIPROC	0x7fffffff	/* Last processor-specific type. */
+
+/* Values for p_flags. */
+#define PF_X		0x1	/* Executable. */
+#define PF_W		0x2	/* Writable. */
+#define PF_R		0x4	/* Readable. */
+
+/* Values for d_tag. */
+#define DT_NULL		0	/* Terminating entry. */
+#define DT_NEEDED	1	/* String table offset of a needed shared
+				   library. */
+#define DT_PLTRELSZ	2	/* Total size in bytes of PLT relocations. */
+#define DT_PLTGOT	3	/* Processor-dependent address. */
+#define DT_HASH		4	/* Address of symbol hash table. */
+#define DT_STRTAB	5	/* Address of string table. */
+#define DT_SYMTAB	6	/* Address of symbol table. */
+#define DT_RELA		7	/* Address of ElfNN_Rela relocations. */
+#define DT_RELASZ	8	/* Total size of ElfNN_Rela relocations. */
+#define DT_RELAENT	9	/* Size of each ElfNN_Rela relocation entry. */
+#define DT_STRSZ	10	/* Size of string table. */
+#define DT_SYMENT	11	/* Size of each symbol table entry. */
+#define DT_INIT		12	/* Address of initialization function. */
+#define DT_FINI		13	/* Address of finalization function. */
+#define DT_SONAME	14	/* String table offset of shared object
+				   name. */
+#define DT_RPATH	15	/* String table offset of library path. [sup] */
+#define DT_SYMBOLIC	16	/* Indicates "symbolic" linking. [sup] */
+#define DT_REL		17	/* Address of ElfNN_Rel relocations. */
+#define DT_RELSZ	18	/* Total size of ElfNN_Rel relocations. */
+#define DT_RELENT	19	/* Size of each ElfNN_Rel relocation. */
+#define DT_PLTREL	20	/* Type of relocation used for PLT. */
+#define DT_DEBUG	21	/* Reserved (not used). */
+#define DT_TEXTREL	22	/* Indicates there may be relocations in
+				   non-writable segments. [sup] */
+#define DT_JMPREL	23	/* Address of PLT relocations. */
+#define	DT_BIND_NOW	24	/* [sup] */
+#define	DT_INIT_ARRAY	25	/* Address of the array of pointers to
+				   initialization functions */
+#define	DT_FINI_ARRAY	26	/* Address of the array of pointers to
+				   termination functions */
+#define	DT_INIT_ARRAYSZ	27	/* Size in bytes of the array of
+				   initialization functions. */
+#define	DT_FINI_ARRAYSZ	28	/* Size in bytes of the array of
+				   terminationfunctions. */
+#define	DT_RUNPATH	29	/* String table offset of a null-terminated
+				   library search path string. */
+#define	DT_FLAGS	30	/* Object specific flag values. */
+#define	DT_ENCODING	32	/* Values greater than or equal to DT_ENCODING
+				   and less than DT_LOOS follow the rules for
+				   the interpretation of the d_un union
+				   as follows: even == 'd_ptr', even == 'd_val'
+				   or none */
+#define	DT_PREINIT_ARRAY 32	/* Address of the array of pointers to
+				   pre-initialization functions. */
+#define	DT_PREINIT_ARRAYSZ 33	/* Size in bytes of the array of
+				   pre-initialization functions. */
+
+#define	DT_COUNT	33	/* Number of defined d_tag values. */
+
+#define	DT_LOOS		0x6000000d	/* First OS-specific */
+#define	DT_HIOS		0x6fff0000	/* Last OS-specific */
+#define	DT_LOPROC	0x70000000	/* First processor-specific type. */
+#define	DT_HIPROC	0x7fffffff	/* Last processor-specific type. */
+
+/* Values for DT_FLAGS */
+#define	DF_ORIGIN	0x0001	/* Indicates that the object being loaded may
+				   make reference to the $ORIGIN substitution
+				   string */
+#define	DF_SYMBOLIC	0x0002	/* Indicates "symbolic" linking. */
+#define	DF_TEXTREL	0x0004	/* Indicates there may be relocations in
+				   non-writable segments. */
+#define	DF_BIND_NOW	0x0008	/* Indicates that the dynamic linker should
+				   process all relocations for the object
+				   containing this entry before transferring
+				   control to the program. */
+#define	DF_STATIC_TLS	0x0010	/* Indicates that the shared object or
+				   executable contains code using a static
+				   thread-local storage scheme. */
+
+/* Values for n_type.  Used in core files. */
+#define NT_PRSTATUS	1	/* Process status. */
+#define NT_FPREGSET	2	/* Floating point registers. */
+#define NT_PRPSINFO	3	/* Process state info. */
+
+/* Symbol Binding - ELFNN_ST_BIND - st_info */
+#define STB_LOCAL	0	/* Local symbol */
+#define STB_GLOBAL	1	/* Global symbol */
+#define STB_WEAK	2	/* like global - lower precedence */
+#define STB_LOPROC	13	/* reserved range for processor */
+#define STB_HIPROC	15	/*  specific symbol bindings */
+
+/* Symbol type - ELFNN_ST_TYPE - st_info */
+#define STT_NOTYPE	0	/* Unspecified type. */
+#define STT_OBJECT	1	/* Data object. */
+#define STT_FUNC	2	/* Function. */
+#define STT_SECTION	3	/* Section. */
+#define STT_FILE	4	/* Source file. */
+#define STT_TLS		6	/* TLS object. */
+#define STT_LOPROC	13	/* reserved range for processor */
+#define STT_HIPROC	15	/*  specific symbol types */
+
+/* Special symbol table indexes. */
+#define STN_UNDEF	0	/* Undefined symbol index. */
+
+#endif /* !_SYS_ELF_COMMON_H_ */


Property changes on: trunk/testing/build.tests/mingw32_help/include/sys/elf_common.h
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.tests/mingw32_help/include/sys/elf_generic.h
===================================================================
--- trunk/testing/build.tests/mingw32_help/include/sys/elf_generic.h	2008-12-24 23:22:22 UTC (rev 1274)
+++ trunk/testing/build.tests/mingw32_help/include/sys/elf_generic.h	2008-12-27 01:15:50 UTC (rev 1275)
@@ -0,0 +1,91 @@
+/*-
+ * Copyright (c) 1998 John D. Polstra.
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in the
+ *    documentation and/or other materials provided with the distribution.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
+ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
+ * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ *
+ * $FreeBSD: src/sys/sys/elf_generic.h,v 1.6 2002/07/20 02:56:11 peter Exp $
+ */
+
+#ifndef _SYS_ELF_GENERIC_H_
+#define _SYS_ELF_GENERIC_H_ 1
+
+#include <sys/cdefs.h>
+
+/*
+ * Definitions of generic ELF names which relieve applications from
+ * needing to know the word size.
+ */
+
+#ifndef __ELF_WORD_SIZE
+# define __ELF_WORD_SIZE 32
+#endif
+
+#if __ELF_WORD_SIZE != 32 && __ELF_WORD_SIZE != 64
+#error "__ELF_WORD_SIZE must be defined as 32 or 64"
+#endif
+
+#define ELF_CLASS	__CONCAT(ELFCLASS,__ELF_WORD_SIZE)
+
+#if BYTE_ORDER == LITTLE_ENDIAN
+#define ELF_DATA	ELFDATA2LSB
+#elif BYTE_ORDER == BIG_ENDIAN
+#define ELF_DATA	ELFDATA2MSB
+#else
+#error "Unknown byte order"
+#endif
+
+#if __ELF_WORD_SIZE == 32
+#define __elfN(x)	elf32_##x
+#define __ElfN(x)	Elf32_##x
+#define __ELFN(x)	ELF32_##x
+#else
+#define __elfN(x)	elf364_##x
+#define __ElfN(x)	Elf364_##x
+#define __ELFN(x)	ELF364_##x
+#endif
+#define __ElfType(x)	typedef __ElfN(x) Elf_##x
+
+#define FOO
+__ElfType(Addr);
+__ElfType(Half);
+__ElfType(Off);
+__ElfType(Sword);
+__ElfType(Word);
+__ElfType(Size);
+__ElfType(Hashelt);
+__ElfType(Ehdr);
+__ElfType(Shdr);
+__ElfType(Phdr);
+__ElfType(Dyn);
+__ElfType(Rel);
+__ElfType(Rela);
+__ElfType(Sym);
+
+#define ELF_R_SYM	__ELFN(R_SYM)
+#define ELF_R_TYPE	__ELFN(R_TYPE)
+#define ELF_R_INFO	__ELFN(R_INFO)
+#define ELF_ST_BIND	__ELFN(ST_BIND)
+#define ELF_ST_TYPE	__ELFN(ST_TYPE)
+#define ELF_ST_INFO	__ELFN(ST_INFO)
+
+#endif /* !_SYS_ELF_GENERIC_H_ */


Property changes on: trunk/testing/build.tests/mingw32_help/include/sys/elf_generic.h
___________________________________________________________________
Name: svn:executable
   + *



From duane at mail.berlios.de  Sat Dec 27 02:30:10 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 02:30:10 +0100
Subject: [Openocd-svn] r1276 - in trunk/testing: . build.test1
Message-ID: <200812270130.mBR1UAHj016270@sheep.berlios.de>

Author: duane
Date: 2008-12-27 02:30:06 +0100 (Sat, 27 Dec 2008)
New Revision: 1276

Added:
   trunk/testing/build.test1/
Removed:
   trunk/testing/build.tests/
Log:
Renamed build.tests to build.test1

Copied: trunk/testing/build.test1 (from rev 1275, trunk/testing/build.tests)


Property changes on: trunk/testing/build.test1
___________________________________________________________________
Name: svn:mergeinfo
   + 



From duane at mail.berlios.de  Sat Dec 27 02:44:34 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 02:44:34 +0100
Subject: [Openocd-svn] r1277 - trunk/testing/build.test1
Message-ID: <200812270144.mBR1iYeY017662@sheep.berlios.de>

Author: duane
Date: 2008-12-27 02:44:29 +0100 (Sat, 27 Dec 2008)
New Revision: 1277

Added:
   trunk/testing/build.test1/README.TXT
Modified:
   trunk/testing/build.test1/Makefile
   trunk/testing/build.test1/Makefile.libusb
Log:
Added documentation for build test case1

Modified: trunk/testing/build.test1/Makefile
===================================================================
--- trunk/testing/build.test1/Makefile	2008-12-27 01:30:06 UTC (rev 1276)
+++ trunk/testing/build.test1/Makefile	2008-12-27 01:44:29 UTC (rev 1277)
@@ -81,6 +81,13 @@
 	cd $(EXEC_PREFIX)/lib && ln -s libftd2xx.so.$(FTD2XX_LINUX_VERSION) libftd2xx.so
 
 
+all.download:
+	mkdir -p ${VIRGINS}
+	${MAKE} -f Makefile.confuse download
+	${MAKE} -f Makefile.libftdi download
+	${MAKE} -f Makefile.ftd2xx  download
+	${MAKE} -f Makefile.libusb  download
+
 .PHONY: linux.buildtest \
 	linux.easy.buildtest \
 	linux.ftd2xx_installed \
@@ -88,3 +95,4 @@
 	linux.ftd2xx_installed.setup
 
 
+

Modified: trunk/testing/build.test1/Makefile.libusb
===================================================================
--- trunk/testing/build.test1/Makefile.libusb	2008-12-27 01:30:06 UTC (rev 1276)
+++ trunk/testing/build.test1/Makefile.libusb	2008-12-27 01:44:29 UTC (rev 1277)
@@ -10,8 +10,8 @@
 $(error Please use the win32 specific port of LibUSB not the Unix version)
 endif 
 
-TARFILE_LOCAL    = ${VIRGINS}/libusb-${LIBUSB_VERSION}.tar.bz2
-TARFILE_URL      = http://downloads.sourceforge.net/libusb/libusb-${LIBUSB_VERSION}.tar.gz
+TARFILE_LOCAL    = ${VIRGINS}/libusb-${LIBUSB_VERSION_linux}.tar.bz2
+TARFILE_URL      = http://downloads.sourceforge.net/libusb/libusb-${LIBUSB_VERSION_linux}.tar.gz
 
 LIBUSB_SRC_DIR   = ${HERE}/libusb-${LIBUSB_VERSION}
 LIBUSB_BUILD_DIR = ${HERE}/libusb-build

Added: trunk/testing/build.test1/README.TXT
===================================================================
--- trunk/testing/build.test1/README.TXT	2008-12-27 01:30:06 UTC (rev 1276)
+++ trunk/testing/build.test1/README.TXT	2008-12-27 01:44:29 UTC (rev 1277)
@@ -0,0 +1,39 @@
+-- Duane Ellis'es test case for building numerous openocd configurations...
+Dec 26,2008
+---------------------------------------------------------------------------
+
+1)	Make a directory some where..
+
+	mkdir ~/test
+
+2)	Change to that directory
+
+	cd  ~/test
+
+3)	Checkout OpenOCD in that directory.
+
+	cd ~/test
+	svn co https://svn.berlios.de/svnroot/repos/openocd/trunk openocd
+
+4)      Copy the "build.test1" directory to the "~/work" directory.
+
+
+	cd ~/test
+	cp ~/openocd/testing/build.test1/.  ~/test/.
+
+5)	If needed, download various components.
+
+	cd ~/work
+	make all.download
+
+
+6)	For Linux - type: 
+
+	cd ~/work
+	make linux.buildtest
+
+7)	For Cygwin - type:
+
+	cd ~/work
+	make cygwin.buildtest
+


Property changes on: trunk/testing/build.test1/README.TXT
___________________________________________________________________
Name: svn:executable
   + *



From duane at mail.berlios.de  Sat Dec 27 03:18:08 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 03:18:08 +0100
Subject: [Openocd-svn] r1278 - trunk/doc
Message-ID: <200812270218.mBR2I8B8023418@sheep.berlios.de>

Author: duane
Date: 2008-12-27 03:18:06 +0100 (Sat, 27 Dec 2008)
New Revision: 1278

Modified:
   trunk/doc/openocd.texi
Log:

From duane at mail.berlios.de  Sat Dec 27 03:21:40 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 03:21:40 +0100
Subject: [Openocd-svn] r1279 - trunk/src/jtag/rlink
Message-ID: <200812270221.mBR2LeA9023652@sheep.berlios.de>

Author: duane
Date: 2008-12-27 03:21:38 +0100 (Sat, 27 Dec 2008)
New Revision: 1279

Modified:
   trunk/src/jtag/rlink/rlink.c
Log:
Warning removal from lou.openocd012 at fixit.nospammail.net

Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2008-12-27 02:18:06 UTC (rev 1278)
+++ trunk/src/jtag/rlink/rlink.c	2008-12-27 02:21:38 UTC (rev 1279)
@@ -132,7 +132,7 @@
 	usb_ret = usb_bulk_write(
 		pHDev,
 		USB_EP1OUT_ADDR,
-		usb_buffer, sizeof(usb_buffer),
+		(char *)usb_buffer, sizeof(usb_buffer),
 		USB_TIMEOUT_MS
 	);
 
@@ -249,7 +249,7 @@
 
       		usb_ret = usb_bulk_write(
 			pHDev, USB_EP1OUT_ADDR,
-			usb_buffer, sizeof(usb_buffer),
+			(char *)usb_buffer, sizeof(usb_buffer),
 			USB_TIMEOUT_MS
 		);
 
@@ -359,7 +359,7 @@
 
 			case DTCLOAD_ENTRY:
 				/* store entry addresses somewhere */
-				if(!strncmp("download", buffer + 1, 8)) {
+				if(!strncmp("download", (char *)buffer + 1, 8)) {
 					dtc_entry_download = buffer[0];
 				}
 				break;
@@ -449,7 +449,7 @@
 	/* read back ep2txr */
 	usb_err = usb_bulk_read(
 		pHDev, USB_EP1IN_ADDR,
-		&ep2txr, 1,
+		(char *)&ep2txr, 1,
 		USB_TIMEOUT_MS
 	);
 	if(usb_err < 0) return(usb_err);
@@ -476,7 +476,7 @@
 	/* wait for completion */
 	usb_err = usb_bulk_read(
 		pHDev, USB_EP1IN_ADDR,
-		&ep2txr, 1,
+		(char *)&ep2txr, 1,
 		USB_TIMEOUT_MS
 	);
 
@@ -502,7 +502,7 @@
 	usb_err = usb_bulk_write(
 		pHDev,
 		USB_EP2OUT_ADDR,
-		command_buffer, USB_EP2BANK_SIZE,
+		(char *)command_buffer, USB_EP2BANK_SIZE,
 		USB_TIMEOUT_MS
 	);
 	if(usb_err < 0) return(usb_err);
@@ -523,7 +523,7 @@
 		usb_err = usb_bulk_read(
 			pHDev,
 			USB_EP1IN_ADDR,
-			ep2_buffer, 1,
+			(char *)ep2_buffer, 1,
 			USB_TIMEOUT_MS
 		);
 		if(usb_err < 0) return(usb_err);
@@ -544,7 +544,7 @@
 		usb_err = usb_bulk_read(
 			pHDev,
 			USB_EP2IN_ADDR,
-			ep2_buffer, sizeof(ep2_buffer),
+			(char *)ep2_buffer, sizeof(ep2_buffer),
 			USB_TIMEOUT_MS
 		);
 
@@ -1662,7 +1662,7 @@
 		}
 		j = usb_bulk_read(
 			pHDev, USB_EP1IN_ADDR,
-			reply_buffer, sizeof(reply_buffer),
+			(char *)reply_buffer, sizeof(reply_buffer),
 			200
 		);
 		if(j != -ETIMEDOUT) break;
@@ -1701,7 +1701,7 @@
 
 	usb_bulk_read(
 		pHDev, USB_EP1IN_ADDR,
-		reply_buffer, 1,
+		(char *)reply_buffer, 1,
 		USB_TIMEOUT_MS
 	);
 
@@ -1726,7 +1726,7 @@
 
 	usb_bulk_read(
 		pHDev, USB_EP1IN_ADDR,
-		reply_buffer, 1,
+		(char *)reply_buffer, 1,
 		USB_TIMEOUT_MS
 	);
 



From duane at mail.berlios.de  Sat Dec 27 03:56:59 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 03:56:59 +0100
Subject: [Openocd-svn] r1280 - in trunk: . doc src src/jtag
	testing/build.test1
Message-ID: <200812270256.mBR2uxgh000147@sheep.berlios.de>

Author: duane
Date: 2008-12-27 03:56:55 +0100 (Sat, 27 Dec 2008)
New Revision: 1280

Modified:
   trunk/configure.in
   trunk/doc/openocd.texi
   trunk/src/Makefile.am
   trunk/src/jtag/Makefile.am
   trunk/src/jtag/jtag.c
   trunk/testing/build.test1/Makefile.openocd
Log:
Added dongle VSLLINK - from Simon Qian

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2008-12-27 02:21:38 UTC (rev 1279)
+++ trunk/configure.in	2008-12-27 02:56:55 UTC (rev 1280)
@@ -156,8 +156,8 @@
 )
 
 AC_ARG_ENABLE(gccwarnings,
-	AS_HELP_STRING([--enable-gccwarnings], [Enable compiler warnings, default no]),
-	[gcc_warnings=$enableval], [gcc_warnings=no])
+	AS_HELP_STRING([--enable-gccwarnings], [Enable compiler warnings, default yes]),
+	[gcc_warnings=$enableval], [gcc_warnings=yes])
 
 AC_ARG_ENABLE(parport,
   AS_HELP_STRING([--enable-parport], [Enable building the pc parallel port driver]), 
@@ -243,6 +243,10 @@
   AS_HELP_STRING([--enable-jlink], [Enable building support for the Segger J-Link JTAG Programmer]),
   [build_jlink=$enableval], [build_jlink=no])
 
+AC_ARG_ENABLE(vsllink,
+  AS_HELP_STRING([--enable-vsllink], [Enable building support for the Versaloon-Link JTAG Programmer]),
+  [build_vsllink=$enableval], [build_vsllink=no])
+
 AC_ARG_ENABLE(rlink,
   AS_HELP_STRING([--enable-rlink], [Enable building support for the Raisonance RLink JTAG Programmer]),
   [build_rlink=$enableval], [build_rlink=no])
@@ -412,6 +416,12 @@
   AC_DEFINE(BUILD_JLINK, 0, [0 if you don't want the J-Link JTAG driver.])
 fi
 
+if test $build_vsllink = yes; then
+  AC_DEFINE(BUILD_VSLLINK, 1, [1 if you want the Versaloon-Link JTAG driver.])
+else
+  AC_DEFINE(BUILD_VSLLINK, 0, [0 if you don't want the Versaloon-Link JTAG driver.])
+fi
+
 if test $build_rlink = yes; then
   AC_DEFINE(BUILD_RLINK, 1, [1 if you want the RLink JTAG driver.])
 else
@@ -631,6 +641,7 @@
 AM_CONDITIONAL(USBPROG, test $build_usbprog = yes)
 AM_CONDITIONAL(OOCD_TRACE, test $build_oocd_trace = yes)
 AM_CONDITIONAL(JLINK, test $build_jlink = yes)
+AM_CONDITIONAL(VSLLINK, test $build_vsllink = yes)
 AM_CONDITIONAL(RLINK, test $build_rlink = yes)
 AM_CONDITIONAL(IS_CYGWIN, test $is_cygwin = yes)
 AM_CONDITIONAL(IS_MINGW, test $is_mingw = yes)

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-27 02:21:38 UTC (rev 1279)
+++ trunk/doc/openocd.texi	2008-12-27 02:56:55 UTC (rev 1280)
@@ -222,6 +222,8 @@
 @item
 @option{--enable-jlink} - From SEGGER
 @item
+ at option{--enable-vsllink}
+ at item
 @option{--enable-rlink} - Raisonance.com dongle.
 @end itemize
 
@@ -395,6 +397,9 @@
 
 @item @b{USB - Presto} 
 @* Link: @url{http://tools.asix.net/prg_presto.htm}
+
+ at item @b{Versaloon-Link}
+@* Link: @url{http://www.simonqian.com/en/Versaloon}
 @end itemize
 
 @section IBM PC Parallel Printer Port Based
@@ -1140,6 +1145,9 @@
 
 @item @b{rlink}
 @* Raisonance RLink usb adapter
+
+ at item @b{vsllink}
+@* vsllink is part of Versaloon which is a versatile USB programmer.
 @comment - End parameters
 @end itemize
 @comment - End Interface

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-27 02:21:38 UTC (rev 1279)
+++ trunk/src/Makefile.am	2008-12-27 02:56:55 UTC (rev 1280)
@@ -50,10 +50,14 @@
 if RLINK
 LIBUSB = -lusb
 else
+if VSLLINK
+LIBUSB = -lusb
+else
 LIBUSB =
 endif
 endif
 endif
+endif
 
 
 

Modified: trunk/src/jtag/Makefile.am
===================================================================
--- trunk/src/jtag/Makefile.am	2008-12-27 02:21:38 UTC (rev 1279)
+++ trunk/src/jtag/Makefile.am	2008-12-27 02:56:55 UTC (rev 1280)
@@ -96,7 +96,13 @@
 RLINKFILES =
 endif
 
+if VSLLINK
+VSLLINKFILES = vsllink.c
+else
+VSLLINKFILES =
+endif
+
 libjtag_a_SOURCES = jtag.c $(BITBANGFILES) $(PARPORTFILES) $(DUMMYFILES) $(FT2232FILES) $(AMTJTAGACCELFILES) $(EP93XXFILES) \
-	$(AT91RM9200FILES) $(GW16012FILES) $(BITQFILES) $(PRESTOFILES) $(USBPROGFILES) $(ECOSBOARDFILES) $(JLINKFILES) $(RLINKFILES)
+	$(AT91RM9200FILES) $(GW16012FILES) $(BITQFILES) $(PRESTOFILES) $(USBPROGFILES) $(ECOSBOARDFILES) $(JLINKFILES) $(RLINKFILES) $(VSLLINKFILES)
 
 noinst_HEADERS = bitbang.h jtag.h

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-27 02:21:38 UTC (rev 1279)
+++ trunk/src/jtag/jtag.c	2008-12-27 02:56:55 UTC (rev 1280)
@@ -196,6 +196,10 @@
 	extern jtag_interface_t jlink_interface;
 #endif
 
+#if BUILD_VSLLINK == 1
+	extern jtag_interface_t vsllink_interface;
+#endif
+
 #if BUILD_RLINK == 1
 	extern jtag_interface_t rlink_interface;
 #endif
@@ -237,6 +241,9 @@
 #if BUILD_JLINK == 1
 	&jlink_interface,
 #endif
+#if BUILD_VSLLINK == 1
+	&vsllink_interface,
+#endif
 #if BUILD_RLINK == 1
 	&rlink_interface,
 #endif

Modified: trunk/testing/build.test1/Makefile.openocd
===================================================================
--- trunk/testing/build.test1/Makefile.openocd	2008-12-27 02:21:38 UTC (rev 1279)
+++ trunk/testing/build.test1/Makefile.openocd	2008-12-27 02:56:55 UTC (rev 1280)
@@ -40,7 +40,7 @@
 CONFIG_OPTIONS_win32_libftdi  = --enable-parport --enable-ft2232_libftdi
 
 # Default build for win32... is the ftd2xx type build.
-PERMUTE_win32          ?= $(BUILD_SYSNAME)_ftd2xx
+PERMUTE_win32          ?= ftd2xx
 CONFIG_OPTIONS_win32   ?= $(CONFIG_OPTIONS_win32_$(PERMUTE_win32))
 CONFIG_OPTIONS_cygwin   = $(CONFIG_OPTIONS_win32)
 CONFIG_OPTIONS_mingw32  = $(CONFIG_OPTIONS_win32)



From duane at mail.berlios.de  Sat Dec 27 04:07:34 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 04:07:34 +0100
Subject: [Openocd-svn] r1281 - trunk/src/jtag
Message-ID: <200812270307.mBR37Ym1001985@sheep.berlios.de>

Author: duane
Date: 2008-12-27 04:07:32 +0100 (Sat, 27 Dec 2008)
New Revision: 1281

Modified:
   trunk/src/jtag/ft2232.c
   trunk/src/jtag/jtag.c
Log:
Quoteify the FT2232 description list, and a missed fix from Dirk Behme about jtag tapisenabled

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2008-12-27 02:56:55 UTC (rev 1280)
+++ trunk/src/jtag/ft2232.c	2008-12-27 03:07:32 UTC (rev 1281)
@@ -1469,7 +1469,7 @@
 			{
 				LOG_ERROR("ListDevices: %lu\n", num_devices);
 				for (i = 0; i < num_devices; i++)
-					LOG_ERROR("%i: %s", i, desc_array[i]);
+					LOG_ERROR("%i: \"%s\"", i, desc_array[i]);
 			}
 
 			for (i = 0; i < num_devices; i++)

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2008-12-27 02:56:55 UTC (rev 1280)
+++ trunk/src/jtag/jtag.c	2008-12-27 03:07:32 UTC (rev 1281)
@@ -2071,7 +2071,7 @@
 			}
 			switch( n->value ){
 			case JTAG_CMD_TAPISENABLED:
-				// below
+				e = t->enabled;
 				break;
 			case JTAG_CMD_TAPENABLE:
 				jtag_tap_handle_event( t, JTAG_TAP_EVENT_ENABLE);



From duane at mail.berlios.de  Sat Dec 27 04:13:53 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 04:13:53 +0100
Subject: [Openocd-svn] r1282 - trunk/src/jtag/rlink
Message-ID: <200812270313.mBR3DrgQ002336@sheep.berlios.de>

Author: duane
Date: 2008-12-27 04:13:50 +0100 (Sat, 27 Dec 2008)
New Revision: 1282

Modified:
   trunk/src/jtag/rlink/rlink.c
Log:

From duane at mail.berlios.de  Sat Dec 27 14:47:49 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 14:47:49 +0100
Subject: [Openocd-svn] r1283 - trunk
Message-ID: <200812271347.mBRDlnR1008277@sheep.berlios.de>

Author: duane
Date: 2008-12-27 14:47:36 +0100 (Sat, 27 Dec 2008)
New Revision: 1283

Modified:
   trunk/configure.in
Log:
Missed support for without --exec-prefix and ftd2xx stuff

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2008-12-27 03:13:50 UTC (rev 1282)
+++ trunk/configure.in	2008-12-27 13:47:36 UTC (rev 1283)
@@ -36,15 +36,28 @@
 # And - if we are being installed there - the odds are
 # The libraries unique to what we are are there too.
 #
+
+# Expand nd deal with NONE - just like configure will do later
+OCDprefix=$prefix
+OCDxprefix=$exec_prefix
+test x"$OCDprefix"  = xNONE && OCDprefix=$ac_default_prefix
+# Let make expand exec_prefix.
+test x"$OCDxprefix" = xNONE && OCDxprefix="$OCDprefix"
+
+
 # what matters is the "exec-prefix"
-if test $exec_prefix != $ac_default_prefix
+if test "$OCDxprefix" != "$ac_default_prefix"
 then
+    # We are installing in a non-standard place
+    # Nonstandard --prefix and/or --exec-prefix
+    # We have an override of some sort.
     # use build specific install library dir
-    LDFLAGS="$LDFLAGS -L$libdir"
+    
+    LDFLAGS="$LDFLAGS -L$OCDxprefix/lib"
     # RPATH becomes an issue on Linux only
     if test $host_os = linux-gnu
     then
-	LDFLAGS="$LDFLAGS -Wl,-rpath,$libdir"
+	LDFLAGS="$LDFLAGS -Wl,-rpath,$OCDxprefix/lib"
     fi
     # The "INCDIR" is also usable
     CFLAGS="$CFLAGS -I$includedir"



From duane at mail.berlios.de  Sat Dec 27 16:00:44 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 16:00:44 +0100
Subject: [Openocd-svn] r1284 - trunk
Message-ID: <200812271500.mBRF0i6f014723@sheep.berlios.de>

Author: duane
Date: 2008-12-27 16:00:36 +0100 (Sat, 27 Dec 2008)
New Revision: 1284

Modified:
   trunk/configure.in
Log:
Some systems report linux as host, others linux-gnu... grrr

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2008-12-27 13:47:36 UTC (rev 1283)
+++ trunk/configure.in	2008-12-27 15:00:36 UTC (rev 1284)
@@ -55,7 +55,7 @@
     
     LDFLAGS="$LDFLAGS -L$OCDxprefix/lib"
     # RPATH becomes an issue on Linux only
-    if test $host_os = linux-gnu
+    if test $host_os = linux-gnu || $host_os = linux
     then
 	LDFLAGS="$LDFLAGS -Wl,-rpath,$OCDxprefix/lib"
     fi
@@ -500,7 +500,7 @@
    AC_MSG_CHECKING([for libftd2xx.a (linux)])
    # Must be linux -
    # Cause FTDICHIP does not supply a MAC-OS version
-   if test $host_os != linux-gnu; then
+   if test $host_os != linux-gnu && $host_os != linux ; then
       AC_MSG_ERROR([The (linux) ftd2xx library from FTDICHIP.com is linux only. Try --enable-ft2232-libftdi instead])
    fi
    # Are we given a TAR directory?



From duane at mail.berlios.de  Sat Dec 27 17:31:30 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 17:31:30 +0100
Subject: [Openocd-svn] r1285 - trunk
Message-ID: <200812271631.mBRGVUIt021976@sheep.berlios.de>

Author: duane
Date: 2008-12-27 17:31:28 +0100 (Sat, 27 Dec 2008)
New Revision: 1285

Modified:
   trunk/configure.in
Log:

From duane at mail.berlios.de  Sat Dec 27 22:00:18 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 22:00:18 +0100
Subject: [Openocd-svn] r1286 - trunk/doc
Message-ID: <200812272100.mBRL0IX2026796@sheep.berlios.de>

Author: duane
Date: 2008-12-27 22:00:16 +0100 (Sat, 27 Dec 2008)
New Revision: 1286

Modified:
   trunk/doc/openocd.texi
Log:
Added note to user manual for packagers of OpenOCD

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2008-12-27 16:31:28 UTC (rev 1285)
+++ trunk/doc/openocd.texi	2008-12-27 21:00:16 UTC (rev 1286)
@@ -133,6 +133,46 @@
 you. Chances are that that binary is from some SVN version that is more
 stable than SVN trunk where bleeding edge development takes place.
 
+ at section Packagers Please Read!
+
+If you are a @b{PACKAGER} of OpenOCD if you
+
+ at enumerate
+ at item @b{Sell dongles} and include pre-built binaries
+ at item @b{Supply tools} ie: A complete development solution
+ at item @b{Supply IDEs} like Eclipse, or RHIDE, etc.
+ at item @b{Build packages} ie: RPM files, or DEB files for a Linux Distro
+ at end enumerate
+
+As a @b{PACKAGER} - you are at the top of the food chain. You solve
+problems for downstream users. What you fix or solve - solves hundreds
+if not thousands of user questions. If something does not work for you
+please let us know. That said, would also like you to follow a few
+suggestions:
+
+ at enumerate
+ at item @b{Always build with Printer Ports Enabled}
+ at item @b{Try where possible to use LIBFTDI + LIBUSB} You cover more bases
+ at end enumerate
+
+It is your decision..
+
+ at itemize @bullet
+ at item @b{Why YES to LIBFTDI + LIBUSB}
+ at itemize @bullet
+ at item @b{LESS} work - libusb perhaps already there
+ at item @b{LESS} work - identical code multiple platforms
+ at item @b{MORE} dongles are supported
+ at item @b{MORE} platforms are supported
+ at item @b{MORE} complete solution
+ at end itemize
+ at item @b{Why not LIBFTDI + LIBUSB} (ie: ftd2xx instead)
+ at itemize @bullet
+ at item @b{LESS} Some say it is slower.
+ at item @b{LESS} complex to distribute (external dependencies)
+ at end itemize
+ at end itemize
+
 @section Building From Source
 
 You can download the current SVN version with SVN client of your choice from the



From duane at mail.berlios.de  Sat Dec 27 23:35:38 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 23:35:38 +0100
Subject: [Openocd-svn] r1287 - in trunk/src/jtag: . rlink
Message-ID: <200812272235.mBRMZcOj006843@sheep.berlios.de>

Author: duane
Date: 2008-12-27 23:35:35 +0100 (Sat, 27 Dec 2008)
New Revision: 1287

Modified:
   trunk/src/jtag/bitq.c
   trunk/src/jtag/rlink/rlink.c
Log:
Tweaks - old crusty code with some warnings & errors - minor stuff

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2008-12-27 21:00:16 UTC (rev 1286)
+++ trunk/src/jtag/bitq.c	2008-12-27 22:35:35 UTC (rev 1287)
@@ -169,10 +169,12 @@
 	int i;
 
 	for (i=0; i<=cmd->num_states; i++) {
-		if (tap_transitions[cur_state].low == cmd->path[i]) bitq_io(0, 0, 0);
-		else if (tap_transitions[cur_state].high == cmd->path[i]) bitq_io(1, 0, 0);
+		if (tap_transitions[cur_state].low == cmd->path[i]) 
+			bitq_io(0, 0, 0);
+		else if (tap_transitions[cur_state].high == cmd->path[i]) 
+			bitq_io(1, 0, 0);
 		else {
-			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(cmd->path[i)]);
+			LOG_ERROR("BUG: %s -> %s isn't a valid TAP transition", jtag_state_name(cur_state), jtag_state_name(cmd->path[i]));
 			exit(-1);
 		}
 

Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2008-12-27 21:00:16 UTC (rev 1286)
+++ trunk/src/jtag/rlink/rlink.c	2008-12-27 22:35:35 UTC (rev 1287)
@@ -427,8 +427,7 @@
  */
 static
 int
-dtc_start_download(
-) {
+dtc_start_download(void) {
 	int	usb_err;
 	u8	ep2txr;
 
@@ -611,8 +610,7 @@
 
 static
 int
-dtc_queue_init(
-) {
+dtc_queue_init(void) {
 	dtc_queue.rq_head = NULL;
 	dtc_queue.rq_tail = NULL;
 	dtc_queue.cmd_index = 0;
@@ -663,8 +661,7 @@
 
 static
 int
-dtc_queue_run(
-) {
+dtc_queue_run(void) {
 	dtc_reply_queue_entry_t	*rq_p, *rq_next;
 	int			retval;
 	int			usb_err;
@@ -808,8 +805,7 @@
 
 static
 int
-tap_state_queue_init(
-) {
+tap_state_queue_init(void) {
 	tap_state_queue.length = 0;
 	tap_state_queue.buffer = 0;
 	return(0);
@@ -818,8 +814,7 @@
 
 static
 int
-tap_state_queue_run(
-) {
+tap_state_queue_run(void) {
 	int	i;
 	int	bits;
 	u8	byte;



From duane at mail.berlios.de  Sat Dec 27 23:40:53 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 23:40:53 +0100
Subject: [Openocd-svn] r1288 - trunk/src/jtag
Message-ID: <200812272240.mBRMerOG007164@sheep.berlios.de>

Author: duane
Date: 2008-12-27 23:40:51 +0100 (Sat, 27 Dec 2008)
New Revision: 1288

Added:
   trunk/src/jtag/vsllink.c
Log:
Missed the svn add on earlier commit, duh

Added: trunk/src/jtag/vsllink.c
===================================================================
--- trunk/src/jtag/vsllink.c	2008-12-27 22:35:35 UTC (rev 1287)
+++ trunk/src/jtag/vsllink.c	2008-12-27 22:40:51 UTC (rev 1288)
@@ -0,0 +1,1334 @@
+/***************************************************************************
+ *   Copyright (C) 2007 by Simon Qian <SimonQian at SimonQian.com>            *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+/* Versaloon is a programming tool for multiple MCUs.
+ * OpenOCD and MSP430 supports are distributed under GPLv2.
+ * You can find it at http://www.SimonQian.com/en/Versaloon.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "replacements.h"
+
+#include "jtag.h"
+
+#include <usb.h>
+#include <string.h>
+
+#include "log.h"
+
+//#define _VSLLINK_IN_DEBUG_MODE_
+
+/* enable this to view USB communication
+ */
+#if 0
+#define _DEBUG_USB_COMMS_
+#endif
+
+#ifdef _DEBUG_JTAG_IO_
+#define DEBUG_JTAG_IO(expr ...)	LOG_DEBUG(expr)
+#else
+#define DEBUG_JTAG_IO(expr ...)
+#endif
+
+#define VID							0x03EB
+#define PID							0x2103
+#define VSLLINK_WRITE_ENDPOINT		0x02
+#define VSLLINK_READ_ENDPOINT		0x82
+
+u16 vsllink_vid = VID;
+u16 vsllink_pid = PID;
+u8 vsllink_bulkout = VSLLINK_WRITE_ENDPOINT;
+u8 vsllink_bulkin = VSLLINK_READ_ENDPOINT;
+
+#define VSLLINK_USB_TIMEOUT			1000
+
+static int VSLLINK_BufferSize = 1024;
+
+/* Global USB buffers */
+static int vsllink_usb_out_buffer_idx;
+static int vsllink_usb_in_want_length;
+static u8* vsllink_usb_in_buffer = NULL;
+static u8* vsllink_usb_out_buffer = NULL;
+
+/* Constants for VSLLink command */
+#define VSLLINK_CMD_CONN			0x80
+#define VSLLINK_CMD_DISCONN			0x81
+#define VSLLINK_CMD_SET_SPEED		0x82
+#define VSLLINK_CMD_SET_PORT		0x90
+#define VSLLINK_CMD_GET_PORT		0x91
+#define VSLLINK_CMD_SET_PORTDIR		0x92
+#define VSLLINK_CMD_HW_JTAGSEQCMD	0xA0
+
+#define VSLLINK_CMDJTAGSEQ_TMSBYTE	0x00
+#define VSLLINK_CMDJTAGSEQ_SCAN		0x80
+
+#define VSLLINK_CMDJTAGSEQ_CMDMSK	0xC0
+#define VSLLINK_CMDJTAGSEQ_LENMSK	0x3F
+
+#define JTAG_PINMSK_SRST			(1 << 0)
+#define JTAG_PINMSK_TRST			(1 << 1)
+#define JTAG_PINMSK_USR1			(1 << 2)
+#define JTAG_PINMSK_USR2			(1 << 3)
+#define JTAG_PINMSK_TCK				(1 << 4)
+#define JTAG_PINMSK_TMS				(1 << 5)
+#define JTAG_PINMSK_TDI				(1 << 6)
+#define JTAG_PINMSK_TDO				(1 << 7)
+
+
+#define VSLLINK_TAP_MOVE(from, to) VSLLINK_tap_move[tap_move_map[from]][tap_move_map[to]]
+
+/* VSLLINK_tap_move[i][j]: tap movement command to go from state i to state j
+ * 0: Test-Logic-Reset
+ * 1: Run-Test/Idle
+ * 2: Shift-DR
+ * 3: Pause-DR
+ * 4: Shift-IR
+ * 5: Pause-IR
+ * 
+ * SD->SD and SI->SI have to be caught in interface specific code
+ */
+u8 VSLLINK_tap_move[6][6] =
+{
+/*	  TLR   RTI   SD    PD    SI    PI             */
+	{0xff, 0x00, 0x2f, 0x0a, 0x37, 0x16},	/* TLR */
+	{0xff, 0x00, 0x45, 0x05, 0x4b, 0x0b},	/* RTI */
+	{0xff, 0x61, 0x00, 0x01, 0x0f, 0x2f},	/* SD  */
+	{0xff, 0x60, 0x40, 0x17, 0x3c, 0x2f},	/* PD  */
+	{0xff, 0x61, 0x07, 0x17, 0x00, 0x01},	/* SI  */
+	{0xff, 0x60, 0x38, 0x17, 0x40, 0x2f}	/* PI  */
+};
+
+u8 VSLLINK_TAP_MOVE_FROM_E1[6] =
+{
+//	TLR		RTI		SD		PD		SI		PI
+	0xff,	0x60,	0x38,	0x5c,	0x3c,	0x5E
+};
+
+u8 VSLLINK_TAP_MOVE_INSERT_INSIGNIFICANT[7][6][2] =
+{
+/*	 stuff	offset   */
+	{/*	TLR	*/
+	{1,		0,},	/* TLR */
+	{1,		0,},	/* RTI */
+	{1,		0,},	/* SD  */
+	{1,		0,},	/* PD  */
+	{1,		0,},	/* SI  */
+	{1,		0,}},	/* PI  */
+	{/*	RTI	*/
+	{1,		0,},	/* TLR */
+	{0,		0,},	/* RTI */
+	{0,		4,},	/* SD  */
+	{0,		7,},	/* PD  */
+	{0,		5,},	/* SI  */
+	{0,		7,}},	/* PI  */
+	{/*	SD	*/
+	{0,		0,},	/* TLR */
+	{0,		0,},	/* RTI */
+	{0,		0,},	/* SD  */
+	{0,		0,},	/* PD  */
+	{0,		0,},	/* SI  */
+	{0,		0,}},	/* PI  */
+	{/*	PD	*/
+	{0,		0,},	/* TLR */
+	{0,		0,},	/* RTI */
+	{0,		0,},	/* SD  */
+	{0,		0,},	/* PD  */
+	{0,		0,},	/* SI  */
+	{0,		0,}},	/* PI  */
+	{/*	SI	*/
+	{0,		0,},	/* TLR */
+	{0,		0,},	/* RTI */
+	{0,		0,},	/* SD  */
+	{0,		0,},	/* PD  */
+	{0,		0,},	/* SI  */
+	{0,		0,}},	/* PI  */
+	{/*	PI	*/
+	{0,		0,},	/* TLR */
+	{0,		0,},	/* RTI */
+	{0,		0,},	/* SD  */
+	{0,		0,},	/* PD  */
+	{0,		0,},	/* SI  */
+	{0,		0,}},	/* PI  */
+};
+
+u8 VSLLINK_BIT_MSK[8] =
+{
+	0x00, 0x01, 0x03, 0x07, 0x0f, 0x1f, 0x3f, 0x7f
+};
+
+/* External interface functions */
+int vsllink_execute_queue(void);
+int vsllink_speed(int speed);
+int vsllink_khz(int khz, int *jtag_speed);
+int vsllink_speed_div(int jtag_speed, int *khz);
+int vsllink_register_commands(struct command_context_s *cmd_ctx);
+int vsllink_init(void);
+int vsllink_quit(void);
+
+/* CLI command handler functions */
+int vsllink_handle_usb_vid_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+int vsllink_handle_usb_pid_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+int vsllink_handle_usb_bulkin_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+int vsllink_handle_usb_bulkout_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+
+/* Queue command functions */
+void vsllink_end_state(enum tap_state state);
+void vsllink_state_move(void);
+void vsllink_path_move(int num_states, enum tap_state *path);
+void vsllink_runtest(int num_cycles);
+void vsllink_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
+void vsllink_reset(int trst, int srst);
+void vsllink_simple_command(u8 command);
+
+/* VSLLink tap buffer functions */
+void vsllink_tap_init();
+int vsllink_tap_execute();
+void vsllink_tap_ensure_space(int scans, int bytes);
+void vsllink_tap_append_scan(int length, u8 *buffer, scan_command_t *command, int offset);
+
+/* VSLLink lowlevel functions */
+typedef struct vsllink_jtag
+{
+	struct usb_dev_handle* usb_handle;
+} vsllink_jtag_t;
+
+vsllink_jtag_t *vsllink_usb_open(void);
+void vsllink_usb_close(vsllink_jtag_t *vsllink_jtag);
+int vsllink_usb_message(vsllink_jtag_t *vsllink_jtag, int out_length, int in_length);
+int vsllink_usb_write(vsllink_jtag_t *vsllink_jtag, int out_length);
+int vsllink_usb_read(vsllink_jtag_t *vsllink_jtag);
+
+void vsllink_debug_buffer(u8 *buffer, int length);
+
+int vsllink_tms_data_len = 0;
+u8* vsllink_tms_cmd_pos;
+
+vsllink_jtag_t* vsllink_jtag_handle;
+
+/***************************************************************************/
+/* External interface implementation */
+
+jtag_interface_t vsllink_interface =
+{
+	.name = "vsllink",
+	.execute_queue = vsllink_execute_queue,
+	.speed = vsllink_speed,
+	.khz = vsllink_khz,
+	.speed_div = vsllink_speed_div,
+	.register_commands = vsllink_register_commands,
+	.init = vsllink_init,
+	.quit = vsllink_quit
+};
+
+int vsllink_execute_queue(void)
+{
+	jtag_command_t *cmd = jtag_command_queue;
+	int scan_size;
+	enum scan_type type;
+	u8 *buffer;
+
+	DEBUG_JTAG_IO("--------------------------------------------------------------------------------");
+
+	vsllink_usb_out_buffer[0] = VSLLINK_CMD_HW_JTAGSEQCMD;
+	vsllink_usb_out_buffer_idx = 3;
+	while (cmd != NULL)
+	{
+		switch (cmd->type)
+		{
+			case JTAG_END_STATE:
+				DEBUG_JTAG_IO("end_state: %i", cmd->cmd.end_state->end_state);
+			
+				if (cmd->cmd.end_state->end_state != -1)
+				{
+					vsllink_end_state(cmd->cmd.end_state->end_state);
+				}
+				break;
+	
+			case JTAG_RUNTEST:
+				DEBUG_JTAG_IO( "runtest %i cycles, end in %i", cmd->cmd.runtest->num_cycles, \
+					cmd->cmd.runtest->end_state);
+				
+				if (cmd->cmd.runtest->end_state != -1)
+				{
+					vsllink_end_state(cmd->cmd.runtest->end_state);
+				}
+				vsllink_runtest(cmd->cmd.runtest->num_cycles);
+				break;
+	
+			case JTAG_STATEMOVE:
+				DEBUG_JTAG_IO("statemove end in %i", cmd->cmd.statemove->end_state);
+			
+				if (cmd->cmd.statemove->end_state != -1)
+				{
+					vsllink_end_state(cmd->cmd.statemove->end_state);
+				}
+				vsllink_state_move();
+				break;
+	
+			case JTAG_PATHMOVE:
+				DEBUG_JTAG_IO("pathmove: %i states, end in %i", \
+					cmd->cmd.pathmove->num_states, \
+					cmd->cmd.pathmove->path[cmd->cmd.pathmove->num_states - 1]);
+			
+				vsllink_path_move(cmd->cmd.pathmove->num_states, cmd->cmd.pathmove->path);
+				break;
+	
+			case JTAG_SCAN:
+				if (cmd->cmd.scan->end_state != -1)
+				{
+					vsllink_end_state(cmd->cmd.scan->end_state);
+				}
+			
+				scan_size = jtag_build_buffer(cmd->cmd.scan, &buffer);
+				if (cmd->cmd.scan->ir_scan)
+				{
+					DEBUG_JTAG_IO("JTAG Scan write IR(%d bits), end in %d:", scan_size, cmd->cmd.scan->end_state);
+				}
+				else
+				{
+					DEBUG_JTAG_IO("JTAG Scan write DR(%d bits), end in %d:", scan_size, cmd->cmd.scan->end_state);
+				}
+
+#ifdef _DEBUG_JTAG_IO_
+				vsllink_debug_buffer(buffer, (scan_size + 7) >> 3);
+#endif
+
+				type = jtag_scan_type(cmd->cmd.scan);
+
+				vsllink_scan(cmd->cmd.scan->ir_scan, type, buffer, scan_size, cmd->cmd.scan);
+				break;
+	
+			case JTAG_RESET:
+				DEBUG_JTAG_IO("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);
+
+				vsllink_tap_execute();
+			
+				if (cmd->cmd.reset->trst == 1)
+				{
+					cur_state = TAP_RESET;
+				}
+				vsllink_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
+
+				vsllink_usb_out_buffer[0] = VSLLINK_CMD_HW_JTAGSEQCMD;
+				vsllink_usb_out_buffer_idx = 3;
+				break;
+	
+			case JTAG_SLEEP:
+				DEBUG_JTAG_IO("sleep %i", cmd->cmd.sleep->us);
+				vsllink_tap_execute();
+				jtag_sleep(cmd->cmd.sleep->us);
+				break;
+	
+			default:
+				LOG_ERROR("BUG: unknown JTAG command type encountered");
+				exit(-1);
+		}
+		cmd = cmd->next;
+	}
+	
+	return vsllink_tap_execute();
+}
+
+int vsllink_speed(int speed)
+{
+	int result;
+
+	vsllink_usb_out_buffer[0] = VSLLINK_CMD_SET_SPEED;
+	vsllink_usb_out_buffer[1] = (speed >> 0) & 0xff;
+	vsllink_usb_out_buffer[2] = (speed >> 8) & 0xFF;
+		
+	result = vsllink_usb_write(vsllink_jtag_handle, 3);
+		
+	if (result == 3)
+	{
+		return ERROR_OK;
+	}
+	else
+	{
+		LOG_ERROR("VSLLink setting speed failed (%d)", result);
+		return ERROR_JTAG_DEVICE_ERROR;
+	}
+	
+	return ERROR_OK;
+}
+
+int vsllink_khz(int khz, int *jtag_speed)
+{
+	*jtag_speed = khz;
+	
+	return ERROR_OK;
+}
+
+int vsllink_speed_div(int jtag_speed, int *khz)
+{
+	*khz = jtag_speed;
+
+	return ERROR_OK;
+}
+
+int vsllink_register_commands(struct command_context_s *cmd_ctx)
+{
+	register_command(cmd_ctx, NULL, "vsllink_usb_vid", vsllink_handle_usb_vid_command, 
+					COMMAND_CONFIG, NULL);
+	register_command(cmd_ctx, NULL, "vsllink_usb_pid", vsllink_handle_usb_pid_command, 
+					COMMAND_CONFIG, NULL);
+	register_command(cmd_ctx, NULL, "vsllink_usb_bulkin", vsllink_handle_usb_bulkin_command, 
+					COMMAND_CONFIG, NULL);
+	register_command(cmd_ctx, NULL, "vsllink_usb_bulkout", vsllink_handle_usb_bulkout_command, 
+					COMMAND_CONFIG, NULL);
+
+	return ERROR_OK;
+}
+
+int vsllink_init(void)
+{
+	int check_cnt;  
+	int result;
+	char version_str[100];
+
+	vsllink_usb_in_buffer = malloc(VSLLINK_BufferSize);
+	vsllink_usb_out_buffer = malloc(VSLLINK_BufferSize);
+	if ((vsllink_usb_in_buffer == NULL) || (vsllink_usb_out_buffer == NULL))
+	{
+		LOG_ERROR("Not enough memory");
+		exit(-1);
+	}
+
+	vsllink_jtag_handle = vsllink_usb_open();
+	
+	if (vsllink_jtag_handle == 0)
+	{
+		LOG_ERROR("Can't find USB JTAG Interface! Please check connection and permissions.");
+		return ERROR_JTAG_INIT_FAILED;
+	}
+		
+	check_cnt = 0;
+	while (check_cnt < 3)
+	{
+		vsllink_simple_command(VSLLINK_CMD_CONN);
+		result = vsllink_usb_read(vsllink_jtag_handle);
+
+		if (result > 2)
+		{
+			vsllink_usb_in_buffer[result] = 0;
+			VSLLINK_BufferSize = vsllink_usb_in_buffer[0] + (vsllink_usb_in_buffer[1] << 8);
+			strncpy(version_str, (char *)vsllink_usb_in_buffer + 2, sizeof(version_str));
+			LOG_INFO(version_str);
+
+			// free the pre-alloc memroy
+			free(vsllink_usb_in_buffer);
+			free(vsllink_usb_out_buffer);
+			vsllink_usb_in_buffer = NULL;
+			vsllink_usb_out_buffer = NULL;
+
+			// alloc new memory
+			vsllink_usb_in_buffer = malloc(VSLLINK_BufferSize);
+			vsllink_usb_out_buffer = malloc(VSLLINK_BufferSize);
+			if ((vsllink_usb_in_buffer == NULL) || (vsllink_usb_out_buffer == NULL))
+			{
+				LOG_ERROR("Not enough memory");
+				exit(-1);
+			}
+			else
+			{
+				LOG_INFO("buffer size for USB is %d bytes", VSLLINK_BufferSize);
+			}
+			break;
+		}
+		vsllink_simple_command(VSLLINK_CMD_DISCONN);
+
+		check_cnt++;
+	}
+
+	if (check_cnt == 3)
+	{
+		// It's dangerout to proced
+		LOG_ERROR("VSLLink initial failed");
+		exit(-1);
+	}
+
+	// Set SRST and TRST to output, Set USR1 and USR2 to input
+	vsllink_usb_out_buffer[0] = VSLLINK_CMD_SET_PORTDIR;
+	vsllink_usb_out_buffer[1] = JTAG_PINMSK_SRST | JTAG_PINMSK_TRST | JTAG_PINMSK_USR1 | JTAG_PINMSK_USR2;
+	vsllink_usb_out_buffer[2] = JTAG_PINMSK_SRST | JTAG_PINMSK_TRST;
+	result = vsllink_usb_write(vsllink_jtag_handle, 3);
+	if (result != 3)
+	{
+		LOG_ERROR("VSLLink USB send data error");
+		exit(-1);
+	}
+
+	vsllink_reset(0, 0);
+
+	LOG_INFO("VSLLink JTAG Interface ready");
+
+	vsllink_tap_init();
+	
+	return ERROR_OK;
+}
+
+int vsllink_quit(void)
+{
+	if ((vsllink_usb_in_buffer != NULL) && (vsllink_usb_out_buffer != NULL))
+	{
+		vsllink_simple_command(VSLLINK_CMD_DISCONN);
+		vsllink_usb_close(vsllink_jtag_handle);
+	}
+
+	if (vsllink_usb_in_buffer != NULL)
+	{
+		free(vsllink_usb_in_buffer);
+	}
+	if (vsllink_usb_out_buffer != NULL)
+	{
+		free(vsllink_usb_out_buffer);
+	}
+	return ERROR_OK;
+}
+
+// when vsllink_tms_data_len > 0, vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx] is the byte that need to be appended.
+// length of VSLLINK_CMDJTAGSEQ_TMSBYTE has been set.
+void VSLLINK_add_tms_from_RTI(enum tap_state state)
+{
+	u8 tms_scan = VSLLINK_TAP_MOVE(TAP_IDLE, state);
+	u16 tms2;
+
+	if ((cur_state != TAP_IDLE) || (state == TAP_IDLE) || (vsllink_tms_data_len <= 0) || (vsllink_tms_data_len >= 8) || (vsllink_tms_cmd_pos == NULL))
+	{
+		LOG_ERROR("There MUST be some bugs in the driver");
+		exit(-1);
+	}
+
+	tms2 = (tms_scan & VSLLINK_BIT_MSK[VSLLINK_TAP_MOVE_INSERT_INSIGNIFICANT[1][tap_move_map[state]][1]]) << vsllink_tms_data_len;
+	if (VSLLINK_TAP_MOVE_INSERT_INSIGNIFICANT[1][tap_move_map[state]][0] == 1)
+	{
+		tms2 |= VSLLINK_BIT_MSK[8 - vsllink_tms_data_len] << (vsllink_tms_data_len + VSLLINK_TAP_MOVE_INSERT_INSIGNIFICANT[1][tap_move_map[state]][1]);
+	}
+	tms2 |= (tms_scan >> VSLLINK_TAP_MOVE_INSERT_INSIGNIFICANT[1][tap_move_map[state]][1]) << (8 + VSLLINK_TAP_MOVE_INSERT_INSIGNIFICANT[1][tap_move_map[state]][1]);
+
+	vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] |= (tms2 >> 0) & 0xff;
+	vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = (tms2 >> 8) & 0xff;
+
+	vsllink_tms_data_len = 0;
+	vsllink_tms_cmd_pos = NULL;
+}
+
+/***************************************************************************/
+/* Queue command implementations */
+
+void vsllink_end_state(enum tap_state state)
+{
+	if (tap_move_map[state] != -1)
+	{
+		end_state = state;
+	}
+	else
+	{
+		LOG_ERROR("BUG: %i is not a valid end state", state);
+		exit(-1);
+	}
+}
+
+/* Goes to the end state. */
+void vsllink_state_move(void)
+{
+	if (vsllink_tms_data_len > 0)
+	{
+		VSLLINK_add_tms_from_RTI(end_state);
+	}
+	else
+	{
+		vsllink_tap_ensure_space(0, 2);
+
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_TMSBYTE;
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_TAP_MOVE(cur_state, end_state);
+	}
+
+	cur_state = end_state;
+}
+
+// write tms from current vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx]
+void vsllink_add_path(int start, int num, enum tap_state *path)
+{
+	int i;
+
+	for (i = start; i < (start + num); i++)
+	{
+		if ((i & 7) == 0)
+		{
+			if (i > 0)
+			{
+				vsllink_usb_out_buffer[++vsllink_usb_out_buffer_idx] = 0;
+			}
+			else
+			{
+				vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx] = 0;
+			}
+		}
+
+		if (path[i - start] == tap_transitions[cur_state].high)
+		{
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx] |= 1 << (i & 7);
+		}
+		else
+		{
+			LOG_ERROR("BUG: %d -> %d isn't a valid TAP transition", cur_state, path[i]);
+			exit(-1);
+		}
+
+		cur_state = path[i];
+	}
+	end_state = cur_state;
+}
+
+void vsllink_path_move(int num_states, enum tap_state *path)
+{
+	int i, tms_len, tms_cmd_pos, path_idx = 0;
+
+	if (vsllink_tms_data_len > 0)
+	{
+		if ((vsllink_tms_data_len + num_states) < 8)
+		{
+			vsllink_add_path(vsllink_tms_data_len, num_states, path);
+			num_states = 0;
+		}
+		else if ((vsllink_tms_data_len + num_states) < 16)
+		{
+			if ((*vsllink_tms_cmd_pos & VSLLINK_CMDJTAGSEQ_LENMSK) \
+					< VSLLINK_CMDJTAGSEQ_LENMSK)
+			{
+				*vsllink_tms_cmd_pos++;
+				vsllink_add_path(vsllink_tms_data_len, num_states, path);
+			}
+			else
+			{
+				// need a new VSLLINK_CMDJTAGSEQ_TMSBYTE command
+				// if vsllink_tms_data_len > 0, length of VSLLINK_CMDJTAGSEQ_TMSBYTE MUST be > 1(tms_len > 2)
+				*vsllink_tms_cmd_pos--;
+				vsllink_add_path(vsllink_tms_data_len, 8 - vsllink_tms_data_len, path);
+				vsllink_usb_out_buffer_idx++;
+				vsllink_tap_ensure_space(0, 3);
+				vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_TMSBYTE | 1;
+				vsllink_tms_cmd_pos = vsllink_usb_out_buffer + vsllink_usb_out_buffer_idx;
+				vsllink_add_path(vsllink_tms_data_len, num_states + vsllink_tms_data_len - 8, path + 8 - vsllink_tms_data_len);
+			}
+			vsllink_tms_data_len = (vsllink_tms_data_len + num_states) & 7;
+			num_states = 0;
+		}
+		else
+		{
+			vsllink_add_path(vsllink_tms_data_len, 16 - vsllink_tms_data_len, path);
+			path_idx = 16 - vsllink_tms_data_len;
+			vsllink_usb_out_buffer_idx++;
+
+			num_states -= 16 - vsllink_tms_data_len;
+			path += 16 - vsllink_tms_data_len;
+			vsllink_tms_data_len = 0;
+			vsllink_tms_cmd_pos = NULL;
+		}
+	}
+
+	if (num_states > 0)
+	{
+		// Normal operation, don't need to append tms data
+		vsllink_tms_data_len = num_states & 7;
+
+		while (num_states > 0)
+		{
+			if (num_states > ((VSLLINK_CMDJTAGSEQ_LENMSK + 1) * 8))
+			{
+				i = (VSLLINK_CMDJTAGSEQ_LENMSK + 1) * 8;
+			}
+			else
+			{
+				i = num_states;
+			}
+			tms_len = (i + 7) >> 3;
+			vsllink_tap_ensure_space(0, tms_len + 2);
+			tms_cmd_pos = vsllink_usb_out_buffer_idx;
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_TMSBYTE | (tms_len - 1);
+
+			vsllink_add_path(0, i, path + path_idx);
+
+			path_idx += i;
+			num_states -= i;
+		}
+
+		if (vsllink_tms_data_len > 0)
+		{
+			if (tms_len < (VSLLINK_CMDJTAGSEQ_LENMSK + 1))
+			{
+				vsllink_usb_out_buffer[tms_cmd_pos]++;
+				vsllink_usb_out_buffer = vsllink_usb_out_buffer + tms_cmd_pos;
+			}
+			else
+			{
+				vsllink_usb_out_buffer[tms_cmd_pos]--;
+				tms_len = vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx];
+				vsllink_tap_ensure_space(0, 3);
+				vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_TMSBYTE | 1;
+				vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx] = tms_len;
+			}
+		}
+	}
+}
+
+void vsllink_runtest(int num_cycles)
+{
+	int i, j;
+	int tms_len, first_tms = 0, tms_cmd_pos;
+	enum tap_state saved_end_state = end_state;
+
+	if (cur_state != TAP_IDLE)
+	{
+		vsllink_end_state(TAP_IDLE);
+
+		if (vsllink_tms_data_len > 0)
+		{
+			VSLLINK_add_tms_from_RTI(end_state);
+		}
+		else
+		{
+			first_tms = 1;
+		}
+	}
+
+	if (vsllink_tms_data_len > 0)
+	{
+		// cur_state == TAP_IDLE
+		if ((vsllink_tms_data_len + num_cycles) < 8)
+		{
+			vsllink_tms_data_len += num_cycles;
+			num_cycles = 0;
+		}
+		else if ((vsllink_tms_data_len + num_cycles) < 16)
+		{
+			if ((*vsllink_tms_cmd_pos & VSLLINK_CMDJTAGSEQ_LENMSK) \
+					< VSLLINK_CMDJTAGSEQ_LENMSK)
+			{
+				*vsllink_tms_cmd_pos++;
+				vsllink_usb_out_buffer[++vsllink_usb_out_buffer_idx] = 0;
+			}
+			else
+			{
+				// need a new VSLLINK_CMDJTAGSEQ_TMSBYTE command
+				// if vsllink_tms_data_len > 0, length of VSLLINK_CMDJTAGSEQ_TMSBYTE MUST be > 1(tms_len > 2)
+				*vsllink_tms_cmd_pos--;
+				vsllink_tap_ensure_space(0, 3);
+				vsllink_usb_out_buffer[++vsllink_usb_out_buffer_idx] = VSLLINK_CMDJTAGSEQ_TMSBYTE | 1;
+				vsllink_tms_cmd_pos = vsllink_usb_out_buffer + vsllink_usb_out_buffer_idx;
+				vsllink_usb_out_buffer[++vsllink_usb_out_buffer_idx] = 0;
+			}
+			vsllink_tms_data_len = (vsllink_tms_data_len + num_cycles) & 7;
+			num_cycles = 0;
+		}
+		else
+		{
+			vsllink_usb_out_buffer[++vsllink_usb_out_buffer_idx] = 0;
+			vsllink_usb_out_buffer_idx++;
+
+			num_cycles -= 16 - vsllink_tms_data_len;
+			vsllink_tms_data_len = 0;
+			vsllink_tms_cmd_pos = NULL;
+		}
+	}
+
+	tms_len = ((num_cycles + 7) >> 3) + first_tms;
+	if (tms_len > 0)
+	{
+		// Normal operation, don't need to append tms data
+		vsllink_tms_data_len = num_cycles & 7;
+
+		if (vsllink_tms_data_len > 0)
+		{
+			tms_len += 1;
+		}
+		// tms_len includes the length of tms byte to append
+
+		// Make sure there is enough space
+		// 1 more byte maybe needed for the last tms move
+		vsllink_tap_ensure_space(0, (tms_len / VSLLINK_CMDJTAGSEQ_LENMSK) + tms_len + 1);
+
+		while(tms_len > 0)
+		{
+			if (tms_len > (VSLLINK_CMDJTAGSEQ_LENMSK + 1))
+			{
+				i = VSLLINK_CMDJTAGSEQ_LENMSK + 1;
+			}
+			else
+			{
+				i = tms_len;
+			}
+
+			tms_cmd_pos = vsllink_usb_out_buffer_idx;
+
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_TMSBYTE | (i - 1);
+
+			if (first_tms)
+			{
+				vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_TAP_MOVE(cur_state, end_state);
+				first_tms = 0;
+				j = i - 1;
+			}
+			else
+			{
+				j = i;
+			}
+
+			while (j-- > 0)
+			{
+				vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = 0;
+			}
+
+			tms_len -= i;
+		}
+
+		// post process vsllink_usb_out_buffer_idx
+		if (vsllink_tms_data_len > 0)
+		{
+			vsllink_usb_out_buffer_idx -= 2;
+		}
+
+		// Set end_state
+		vsllink_end_state(saved_end_state);
+		cur_state = TAP_IDLE;
+		if (saved_end_state != TAP_IDLE)
+		{
+			if (vsllink_tms_data_len > 0)
+			{
+				VSLLINK_add_tms_from_RTI(end_state);
+			}
+			else
+			{
+				if (i < (VSLLINK_CMDJTAGSEQ_LENMSK + 1))
+				{
+					vsllink_usb_out_buffer[tms_cmd_pos]++;
+					vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_TAP_MOVE(TAP_IDLE, end_state);
+				}
+				else
+				{
+					vsllink_tap_ensure_space(0, 2);
+					vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_TMSBYTE;
+					vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_TAP_MOVE(TAP_IDLE, end_state);
+				}
+			}
+			cur_state = saved_end_state;
+		}
+
+		if (vsllink_tms_data_len > 0)
+		{
+			vsllink_tms_cmd_pos = vsllink_usb_out_buffer + tms_cmd_pos;
+		}
+	}
+	else
+	{
+		// Set end_state if no RTI shifts
+		vsllink_end_state(saved_end_state);
+		cur_state = TAP_IDLE;
+		if (saved_end_state != TAP_IDLE)
+		{
+			vsllink_tap_ensure_space(0, 2);
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_TMSBYTE;
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_TAP_MOVE(TAP_IDLE, end_state);
+
+			cur_state = saved_end_state;
+		}
+	}
+}
+
+void vsllink_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
+{
+	enum tap_state saved_end_state;
+	u8 bits_left, tms_tmp, tdi_len;
+	int i;
+
+	tdi_len = ((scan_size + 7) >> 3);
+	if ((tdi_len + 7) > VSLLINK_BufferSize)
+	{
+		LOG_ERROR("Your implementation of VSLLink has not enough buffer");
+		exit(-1);
+	}
+	
+	saved_end_state = end_state;
+	
+	/* Move to appropriate scan state */
+	vsllink_end_state(ir_scan ? TAP_IRSHIFT : TAP_DRSHIFT);
+
+	if (vsllink_tms_data_len > 0)
+	{
+		if (cur_state == end_state)
+		{
+			*vsllink_tms_cmd_pos--;
+			tms_tmp = vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx];
+			vsllink_tap_ensure_space(1, tdi_len + 7);
+
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_SCAN | 1;
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = ((tdi_len + 1) >> 0) & 0xff;
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = ((tdi_len + 1)>> 8) & 0xff;
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = tms_tmp;
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = buffer[0] << (8 - vsllink_tms_data_len);
+
+			for (i = 0; i < tdi_len; i++)
+			{
+				buffer[i] >>= 8 - vsllink_tms_data_len;
+				if (i != tdi_len)
+				{
+					buffer[i] += buffer[i + 1] << vsllink_tms_data_len;
+				}
+			}
+
+			vsllink_tap_append_scan(scan_size - vsllink_tms_data_len, buffer, command, vsllink_tms_data_len);
+			scan_size -= 8 - vsllink_tms_data_len;
+		}
+		else
+		{
+			VSLLINK_add_tms_from_RTI(end_state);
+			vsllink_tap_ensure_space(1, tdi_len + 5);
+
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_SCAN;
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = (tdi_len >> 0) & 0xff;
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = (tdi_len >> 8) & 0xff;
+
+			vsllink_tap_append_scan(scan_size, buffer, command, 0);
+		}
+	}
+	else
+	{
+		vsllink_tap_ensure_space(1, tdi_len + 7);
+
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_CMDJTAGSEQ_SCAN | 1;
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = ((tdi_len + 1) >> 0) & 0xff;
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = ((tdi_len + 1)>> 8) & 0xff;
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_TAP_MOVE(cur_state, end_state);
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = 0;
+
+		vsllink_tap_append_scan(scan_size, buffer, command, 8);
+	}
+	vsllink_end_state(saved_end_state);
+
+	bits_left = scan_size & 0x07;
+	cur_state = ir_scan ? TAP_IRPAUSE : TAP_DRPAUSE;
+
+	if (bits_left > 0)
+	{
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = 1 << (bits_left - 1);
+	}
+	else
+	{
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = 1 << 7;
+	}
+
+	if (cur_state != end_state)
+	{
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = VSLLINK_TAP_MOVE_FROM_E1[tap_move_map[end_state]];
+	}
+	else
+	{
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = 0;
+	}
+
+	cur_state = end_state;
+}
+
+void vsllink_reset(int trst, int srst)
+{
+	int result;
+
+	LOG_DEBUG("trst: %i, srst: %i", trst, srst);
+	
+	/* Signals are active low */
+	vsllink_usb_out_buffer[0] = VSLLINK_CMD_SET_PORT;
+	vsllink_usb_out_buffer[1] = JTAG_PINMSK_SRST | JTAG_PINMSK_TRST;
+	vsllink_usb_out_buffer[2] = 0;
+	if (srst == 0)
+	{
+		vsllink_usb_out_buffer[2] |= JTAG_PINMSK_SRST;
+	}
+	if (trst == 0)
+	{
+		vsllink_usb_out_buffer[2] |= JTAG_PINMSK_TRST;
+	}
+
+	result = vsllink_usb_write(vsllink_jtag_handle, 3);
+	if (result != 3)
+	{
+		LOG_ERROR("VSLLink command VSLLINK_CMD_SET_PORT failed (%d)");
+	}
+}
+
+void vsllink_simple_command(u8 command)
+{
+	int result;
+	
+	DEBUG_JTAG_IO("0x%02x", command);
+	
+	vsllink_usb_out_buffer[0] = command;
+	result = vsllink_usb_write(vsllink_jtag_handle, 1);
+	
+	if (result != 1)
+	{
+		LOG_ERROR("VSLLink command 0x%02x failed (%d)", command, result);
+	}
+}
+
+int vsllink_handle_usb_vid_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 1) {
+	    LOG_ERROR("parameter error, should be one parameter for VID");
+		return ERROR_OK;
+	}
+
+	vsllink_vid = strtol(args[0], NULL, 0);
+
+	return ERROR_OK;
+}
+
+int vsllink_handle_usb_pid_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 1) {
+	    LOG_ERROR("parameter error, should be one parameter for PID");
+		return ERROR_OK;
+	}
+
+	vsllink_pid = strtol(args[0], NULL, 0);
+
+	return ERROR_OK;
+}
+
+int vsllink_handle_usb_bulkin_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 1) {
+	    LOG_ERROR("parameter error, should be one parameter for BULKIN endpoint");
+		return ERROR_OK;
+	}
+
+	vsllink_bulkin = strtol(args[0], NULL, 0) | 0x80;
+
+	return ERROR_OK;
+}
+
+int vsllink_handle_usb_bulkout_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc != 1) {
+	    LOG_ERROR("parameter error, should be one parameter for BULKOUT endpoint");
+		return ERROR_OK;
+	}
+
+	vsllink_bulkout = strtol(args[0], NULL, 0);
+
+	return ERROR_OK;
+}
+
+/***************************************************************************/
+/* VSLLink tap functions */
+
+typedef struct
+{
+	int length; /* Number of bits to read */
+	int offset;
+	scan_command_t *command; /* Corresponding scan command */
+	u8 *buffer;
+} pending_scan_result_t;
+
+#define MAX_PENDING_SCAN_RESULTS 256
+
+static int pending_scan_results_length;
+static pending_scan_result_t pending_scan_results_buffer[MAX_PENDING_SCAN_RESULTS];
+
+static int last_tms;
+
+void vsllink_tap_init()
+{
+	vsllink_usb_out_buffer_idx = 0;
+	vsllink_usb_in_want_length = 0;
+	pending_scan_results_length = 0;
+}
+
+void vsllink_tap_ensure_space(int scans, int bytes)
+{
+	int available_scans = MAX_PENDING_SCAN_RESULTS - pending_scan_results_length;
+	int available_bytes = VSLLINK_BufferSize - vsllink_usb_out_buffer_idx;
+	
+	if (scans > available_scans || bytes > available_bytes)
+	{
+		vsllink_tap_execute();
+		vsllink_usb_out_buffer[0] = VSLLINK_CMD_HW_JTAGSEQCMD;
+		vsllink_usb_out_buffer_idx = 3;
+	}
+}
+
+void vsllink_tap_append_scan(int length, u8 *buffer, scan_command_t *command, int offset)
+{
+	pending_scan_result_t *pending_scan_result = &pending_scan_results_buffer[pending_scan_results_length];
+	int i;
+
+	if (offset > 0)
+	{
+		vsllink_usb_in_want_length += ((length + 7) >> 3) + 1;
+	}
+	else
+	{
+		vsllink_usb_in_want_length += (length + 7) >> 3;
+	}
+	pending_scan_result->length = length;
+	pending_scan_result->offset = offset;
+	pending_scan_result->command = command;
+	pending_scan_result->buffer = buffer;
+
+	for (i = 0; i < ((length + 7) >> 3); i++)
+	{
+		vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = buffer[i];
+	}
+
+	pending_scan_results_length++;
+}
+
+/* Pad and send a tap sequence to the device, and receive the answer.
+ * For the purpose of padding we assume that we are in idle or pause state. */
+int vsllink_tap_execute()
+{
+	int i, j;
+	int result;
+	int first = 0;
+
+	if (vsllink_tms_data_len > 0)
+	{
+		if (vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx] & (1 << (vsllink_tms_data_len - 1)))
+		{
+			// last tms bit is '1'
+			// the only possible state is TLR, no need to control the number of shifts in RLT
+			// There MUST be some errors in the code
+			LOG_ERROR("last tms bit is '1'");
+			exit(-1);
+		}
+		else
+		{
+			// last tms bit is '0'
+			vsllink_usb_out_buffer_idx++;
+			vsllink_usb_out_buffer[vsllink_usb_out_buffer_idx++] = 0;
+			vsllink_tms_data_len = 0;
+		}
+	}
+	
+	if (vsllink_usb_out_buffer_idx > 3)
+	{
+		if (vsllink_usb_out_buffer[0] == VSLLINK_CMD_HW_JTAGSEQCMD)
+		{
+			vsllink_usb_out_buffer[1] = (vsllink_usb_out_buffer_idx >> 0) & 0xff;
+			vsllink_usb_out_buffer[2] = (vsllink_usb_out_buffer_idx >> 8) & 0xff;
+		}
+
+		result = vsllink_usb_message(vsllink_jtag_handle, vsllink_usb_out_buffer_idx, vsllink_usb_in_want_length);
+	
+		if (result == vsllink_usb_in_want_length)
+		{
+			for (i = 0; i < pending_scan_results_length; i++)
+			{
+				pending_scan_result_t *pending_scan_result = &pending_scan_results_buffer[i];
+				u8 *buffer = pending_scan_result->buffer;
+				int length = pending_scan_result->length;
+				int offset = pending_scan_result->offset;
+				scan_command_t *command = pending_scan_result->command;
+	
+				/* Copy to buffer */
+				buf_set_buf(vsllink_usb_in_buffer, first * 8 + offset, buffer, 0, length);
+				first += (length + offset + 7) >> 3;
+	
+				DEBUG_JTAG_IO("JTAG scan read(%d bits):", length);
+#ifdef _DEBUG_JTAG_IO_
+				vsllink_debug_buffer(buffer, (length + 7) >> 3);
+#endif
+
+				if (jtag_read_buffer(buffer, command) != ERROR_OK)
+				{
+					vsllink_tap_init();
+					return ERROR_JTAG_QUEUE_FAILED;
+				}
+		
+				if (pending_scan_result->buffer != NULL)
+				{
+					free(pending_scan_result->buffer);
+					pending_scan_result->buffer = NULL;
+				}
+			}
+		}
+		else
+		{
+			LOG_ERROR("vsllink_tap_execute, wrong result %d, expected %d", result, vsllink_usb_in_want_length);
+			return ERROR_JTAG_QUEUE_FAILED;
+		}
+		
+		vsllink_tap_init();
+	}
+	
+	return ERROR_OK;
+}
+
+/*****************************************************************************/
+/* VSLLink USB low-level functions */
+
+vsllink_jtag_t* vsllink_usb_open()
+{
+	struct usb_bus *busses;
+	struct usb_bus *bus;
+	struct usb_device *dev;
+	
+	vsllink_jtag_t *result;
+	
+	result = (vsllink_jtag_t*) malloc(sizeof(vsllink_jtag_t));
+	
+	usb_init();
+	usb_find_busses();
+	usb_find_devices();
+	
+	busses = usb_get_busses();
+	
+	/* find vsllink_jtag device in usb bus */
+	
+	for (bus = busses; bus; bus = bus->next)
+	{
+		for (dev = bus->devices; dev; dev = dev->next)
+		{
+			if ((dev->descriptor.idVendor == vsllink_vid) && (dev->descriptor.idProduct == vsllink_pid))
+			{
+				result->usb_handle = usb_open(dev);
+				
+				/* usb_set_configuration required under win32 */
+				usb_set_configuration(result->usb_handle, dev->config[0].bConfigurationValue);
+				usb_claim_interface(result->usb_handle, 0);
+				
+#if 0
+				/* 
+				 * This makes problems under Mac OS X. And is not needed
+				 * under Windows. Hopefully this will not break a linux build
+				 */
+				usb_set_altinterface(result->usb_handle, 0);
+#endif				
+				return result;
+			}
+		}
+	}
+	
+	free(result);
+	return NULL;
+}
+
+void vsllink_usb_close(vsllink_jtag_t *vsllink_jtag)
+{
+	usb_close(vsllink_jtag->usb_handle);
+	free(vsllink_jtag);
+}
+
+/* Send a message and receive the reply. */
+int vsllink_usb_message(vsllink_jtag_t *vsllink_jtag, int out_length, int in_length)
+{
+	int result;
+	int result2;
+	
+	result = vsllink_usb_write(vsllink_jtag, out_length);
+	if (result == out_length)
+	{
+		if (in_length > 0)
+		{
+			result = vsllink_usb_read(vsllink_jtag);
+			if (result == in_length )
+			{
+				return result;
+			}
+			else
+			{
+				LOG_ERROR("usb_bulk_read failed (requested=%d, result=%d)", in_length, result);
+				return -1;
+			}
+		}
+		return 0;
+	}
+	else
+	{
+		LOG_ERROR("usb_bulk_write failed (requested=%d, result=%d)", out_length, result);
+		return -1;
+	}
+}
+
+/* Write data from out_buffer to USB. */
+int vsllink_usb_write(vsllink_jtag_t *vsllink_jtag, int out_length)
+{
+	int result;
+	
+	if (out_length > VSLLINK_BufferSize)
+	{
+		LOG_ERROR("vsllink_jtag_write illegal out_length=%d (max=%d)", out_length, VSLLINK_BufferSize);
+		return -1;
+	}
+	
+	result = usb_bulk_write(vsllink_jtag->usb_handle, vsllink_bulkout, \
+		(char *)vsllink_usb_out_buffer, out_length, VSLLINK_USB_TIMEOUT);
+	
+	DEBUG_JTAG_IO("vsllink_usb_write, out_length = %d, result = %d", out_length, result);
+	
+#ifdef _DEBUG_USB_COMMS_
+	LOG_DEBUG("USB out:");
+	vsllink_debug_buffer(vsllink_usb_out_buffer, out_length);
+#endif
+
+#ifdef _VSLLINK_IN_DEBUG_MODE_
+	usleep(100000);
+#endif
+
+	return result;
+}
+
+/* Read data from USB into in_buffer. */
+int vsllink_usb_read(vsllink_jtag_t *vsllink_jtag)
+{
+	int result = usb_bulk_read(vsllink_jtag->usb_handle, vsllink_bulkin, \
+		(char *)vsllink_usb_in_buffer, VSLLINK_BufferSize, VSLLINK_USB_TIMEOUT);
+
+	DEBUG_JTAG_IO("vsllink_usb_read, result = %d", result);
+	
+#ifdef _DEBUG_USB_COMMS_
+	LOG_DEBUG("USB in:");
+	vsllink_debug_buffer(vsllink_usb_in_buffer, result);
+#endif
+	return result;
+}
+
+#define BYTES_PER_LINE  16
+
+void vsllink_debug_buffer(u8 *buffer, int length)
+{
+	char line[81];
+	char s[4];
+	int i;
+	int j;
+	
+	for (i = 0; i < length; i += BYTES_PER_LINE)
+	{
+		snprintf(line, 5, "%04x", i);
+		for (j = i; j < i + BYTES_PER_LINE && j < length; j++)
+		{
+			snprintf(s, 4, " %02x", buffer[j]);
+			strcat(line, s);
+		}
+		LOG_DEBUG(line);
+	}
+}



From duane at mail.berlios.de  Sat Dec 27 23:43:58 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 27 Dec 2008 23:43:58 +0100
Subject: [Openocd-svn] r1289 - trunk/src/jtag
Message-ID: <200812272243.mBRMhw5U007337@sheep.berlios.de>

Author: duane
Date: 2008-12-27 23:43:56 +0100 (Sat, 27 Dec 2008)
New Revision: 1289

Modified:
   trunk/src/jtag/vsllink.c
Log:
Warnings cleanup ... finish up earlier commit

Modified: trunk/src/jtag/vsllink.c
===================================================================
--- trunk/src/jtag/vsllink.c	2008-12-27 22:40:51 UTC (rev 1288)
+++ trunk/src/jtag/vsllink.c	2008-12-27 22:43:56 UTC (rev 1289)
@@ -200,8 +200,8 @@
 void vsllink_simple_command(u8 command);
 
 /* VSLLink tap buffer functions */
-void vsllink_tap_init();
-int vsllink_tap_execute();
+void vsllink_tap_init(void);
+int vsllink_tap_execute(void);
 void vsllink_tap_ensure_space(int scans, int bytes);
 void vsllink_tap_append_scan(int length, u8 *buffer, scan_command_t *command, int offset);
 
@@ -971,7 +971,7 @@
 	result = vsllink_usb_write(vsllink_jtag_handle, 3);
 	if (result != 3)
 	{
-		LOG_ERROR("VSLLink command VSLLINK_CMD_SET_PORT failed (%d)");
+	  LOG_ERROR("VSLLink command VSLLINK_CMD_SET_PORT failed (%d)", result);
 	}
 }
 
@@ -1054,7 +1054,6 @@
 static int pending_scan_results_length;
 static pending_scan_result_t pending_scan_results_buffer[MAX_PENDING_SCAN_RESULTS];
 
-static int last_tms;
 
 void vsllink_tap_init()
 {
@@ -1106,7 +1105,7 @@
  * For the purpose of padding we assume that we are in idle or pause state. */
 int vsllink_tap_execute()
 {
-	int i, j;
+	int i;
 	int result;
 	int first = 0;
 
@@ -1242,7 +1241,6 @@
 int vsllink_usb_message(vsllink_jtag_t *vsllink_jtag, int out_length, int in_length)
 {
 	int result;
-	int result2;
 	
 	result = vsllink_usb_write(vsllink_jtag, out_length);
 	if (result == out_length)



From duane at mail.berlios.de  Sun Dec 28 00:23:09 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sun, 28 Dec 2008 00:23:09 +0100
Subject: [Openocd-svn] r1290 - in trunk/testing: . build.test2
Message-ID: <200812272323.mBRNN9AS010947@sheep.berlios.de>

Author: duane
Date: 2008-12-28 00:23:06 +0100 (Sun, 28 Dec 2008)
New Revision: 1290

Added:
   trunk/testing/build.test2/
   trunk/testing/build.test2/Makefile
   trunk/testing/build.test2/README.txt
   trunk/testing/build.test2/local.uses
Log:
Added another test build configuration

Added: trunk/testing/build.test2/Makefile
===================================================================
--- trunk/testing/build.test2/Makefile	2008-12-27 22:43:56 UTC (rev 1289)
+++ trunk/testing/build.test2/Makefile	2008-12-27 23:23:06 UTC (rev 1290)
@@ -0,0 +1,193 @@
+# -*- mode: makefile -*-
+#========================================
+# DO NOT DELETE THE LINE BELOW
+_default: default
+# DO NOT DELETE THE LINE_ABOVE
+#========================================
+
+#========================================
+#
+# There are no user configurable options here.
+#
+# All user configurable options are in local.uses
+#
+include ./local.uses
+#
+#========================================
+
+#========================================
+# This is the USB driver for the FTDI2XX chips.
+# It is a "closed" solution from FTDICHIP.COM
+# Some claim it is faster then the open/free
+# solution:  win32-libusb+libftdi.
+# 
+ftd2xx.download:
+	mkdir -p ${VIRGINS}
+	wget -O ${FTD2XX_ZIPFILE_LOCAL} \
+		 ${FTD2XX_ZIPFILE_URL}
+
+ftd2xx.unpack:
+	rm -rf ${FTD2XX_WIN32_DIR}
+	mkdir -p ${FTD2XX_WIN32_DIR}
+	cd ${FTD2XX_WIN32_DIR} && unzip \
+		${FTD2XX_ZIPFILE_LOCAL}
+
+ftd2xx.build:
+	@echo "Nothing to do for: $@"
+
+ftd2xx.configure:
+	@echo "Nothing to do for: $@"
+
+ftd2xx.install:
+	@echo "Nothing to do for: $@"
+
+clean::
+	rm -rf ${FTD2XX_WIN32_DIR}
+
+ftd2xx.all: ftd2xx.unpack ftd2xx.configure \
+	ftd2xx.build ftd2xx.install
+
+
+#========================================-
+# LIBFTDI - requires LIBCONFUSE..
+#   So we handle it here :-(
+
+libconfuse.download: 
+	mkdir -p virgins
+	wget -O ${LIBCONFUSE_TARFILE_LOCAL} \
+		${LIBCONFUSE_TARFILE_URL}
+
+libconfuse.unpack:
+	tar xfz ${LIBCONFUSE_TARFILE_LOCAL}
+
+clean::
+	rm -rf ${LIBCONFUSE_SRC_DIR}
+
+libconfuse.configure:
+	rm -rf ${LIBCONFUSE_BUILD_DIR}
+	mkdir -p ${LIBCONFUSE_BUILD_DIR}
+	cd ${LIBCONFUSE_BUILD_DIR} && \
+		${LIBCONFUSE_SRC_DIR}/configure \
+		--prefix=${PREFIX}
+
+clean::
+	rm -rf ${LIBCONFUSE_BUILD_DIR}
+
+libconfuse.build:
+	cd ${LIBCONFUSE_BUILD_DIR} && ${MAKE}
+
+libconfuse.install:
+	cd ${LIBCONFUSE_BUILD_DIR} && ${MAKE} install
+
+libconfuse.all: libconfuse.unpack libconfuse.configure \
+	 libconfuse.build libconfuse.install
+
+#========================================
+# LIBFTDI - the open source (and free)
+# alternative to (closed) FTD2XX drivers.
+
+libftdi.download: 
+	mkdir -p virgins
+	wget -O ${LIBFTDI_TARFILE_LOCAL} \
+		${LIBFTDI_TARFILE_URL}
+
+libftdi.unpack:
+	tar xfz ${LIBFTDI_TARFILE_LOCAL}
+
+clean::
+	rm -rf ${LIBFTDI_SRC_DIR}
+
+libftdi.configure:
+	rm -rf ${LIBFTDI_BUILD_DIR}
+	mkdir -p ${LIBFTDI_BUILD_DIR}
+	cd ${LIBFTDI_BUILD_DIR} && \
+		${LIBFTDI_SRC_DIR}/configure \
+		--prefix=${PREFIX}
+
+clean::
+	rm -rf ${LIBFTDI_BUILD_DIR}
+
+libftdi.build:
+	cd ${LIBFTDI_BUILD_DIR} && ${MAKE}
+
+libftdi.install:
+	cd ${LIBFTDI_BUILD_DIR} && ${MAKE} install
+
+libftdi.all: libftdi.unpack libftdi.configure \
+	libftdi.build libftdi.install
+
+#========================================
+# Openocd...
+
+openocd.bootstrap:
+	cd ${OPENOCD_SRC_DIR} && bash ./bootstrap
+
+openocd.configure:
+	rm -rf ${OPENOCD_BUILD_DIR}
+	mkdir -p ${OPENOCD_BUILD_DIR}
+	cd ${OPENOCD_BUILD_DIR} && ${OPENOCD_SRC_DIR}/configure \
+		--prefix=${INSTALL_DIR} \
+		${OPENOCD_CONFIG_OPTIONS}
+
+openocd.build:
+	cd ${OPENOCD_BUILD_DIR} && ${MAKE}
+
+openocd.docs:
+	cd ${OPENOCD_BUILD_DIR}/docs && ${MAKE}
+
+openocd.docs.pdf:
+	cd ${OPENOCD_BUILD_DIR}/docs && ${MAKE} pdf
+
+openocd.docs.html:
+	cd ${OPENOCD_BUILD_DIR}/docs && ${MAKE} html
+
+# fixme:
+#   need to add a "make one huge html file target"
+
+openocd.install:
+	cd ${OPENOCD_BUILD_DIR} && ${MAKE} install
+
+#========================================
+# The world...
+
+# Manual step.
+download.all: \
+	ftd2xx.download		\
+	libconfuse.download	\
+	libftdi.download
+
+ifeq (x"${FT2232_DRIVER}",x"ftd2xx")
+prebuild: ftd2xx.all
+endif
+
+ifeq (x"${FT2232_DRIVER}",x"libftdi")
+prebuild: libconfuse.all libftdi.all
+endif
+
+remake: \
+	openocd.bootstrap \
+	openocd.configure \
+	openocd.build     \
+	openocd.install
+
+initial.build : download.all prebuild remake
+
+all: 
+	@echo ""
+	@echo " This makefile does not support an 'all' target"
+	@echo ""
+	@echo " If this is your *FIRST* time building... "
+	@echo " Then use this command: \"make initial.build\""
+	@echo ""
+	@echo " The \"default\" target is for openocd developers"
+	@echo " and rebuilds openocd completely.."
+	@echo ""
+
+default: 
+	test -d ${OPENOCD_SRC_DIR} || (echo "Where is: The OPENOCD source?"; exit 1)
+	${MAKE} remake
+
+whatis_%:
+	@echo ""
+	@echo "Makevariable: $*  => ${${*}}"
+	@echo ""


Property changes on: trunk/testing/build.test2/Makefile
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.test2/README.txt
===================================================================
--- trunk/testing/build.test2/README.txt	2008-12-27 22:43:56 UTC (rev 1289)
+++ trunk/testing/build.test2/README.txt	2008-12-27 23:23:06 UTC (rev 1290)
@@ -0,0 +1,59 @@
+
+This makefile is how I Duane Ellis (openocd at duaneellis.com) builds
+openocd test purposes on Cygwin. I have included it here so others
+might also make use of the same configuration that I use to develop
+Openocd.
+
+--Duane Ellis
+
+To make use of it do the following:
+
+(1)	Check out openocd in the standard way.
+
+For example - in cygwin, type this:
+
+    bash$  mkdir -p /home/duane/test
+    bash$  cd /home/duane/test
+    bash$  svn co https://svn.berlios.de/svnroot/repos/openocd/trunk openocd
+
+(2)	COPY this folder "right above" where you have OpenOCD.
+
+    bash$  cd /home/duane/test
+    bash$  cp ./openocd/testing/build.test2/*   /home/duane/test/.
+
+(3) OPTIONALLY
+
+    You might want to review the file "local.uses"
+    Change options and so forth at the top of the file.
+
+(4) 	Initially, you need to download some additional files.
+	These include "libftdi", "libconfuse", and the ftd2xx drivers.
+
+(5)	You also need to build the supporting libraries and install them
+	(They are installed "locally" only)
+
+	Type this command:
+
+    bash$ cd /home/duane/test
+
+    bash$ make initial.build
+
+    	  which:  (1) downloads files
+	  	  (2) builds the libs
+		  (3) builds OpenOCD
+
+(6)     As you hack upon OpenOCD... to rebuild OpenOCD...
+	
+    bash$ cd /home/duane/test
+
+    bash$ make remake
+
+    	  which: (1) re-bootstraps 
+	  	 (2) re-configures
+		 (3) re-builds
+		 (4) re-installs.
+   
+=======
+**END**
+=======
+


Property changes on: trunk/testing/build.test2/README.txt
___________________________________________________________________
Name: svn:executable
   + *

Added: trunk/testing/build.test2/local.uses
===================================================================
--- trunk/testing/build.test2/local.uses	2008-12-27 22:43:56 UTC (rev 1289)
+++ trunk/testing/build.test2/local.uses	2008-12-27 23:23:06 UTC (rev 1290)
@@ -0,0 +1,161 @@
+# -*- mode: makefile -*-
+#========================================
+# DO NOT REMOVE THE LINE BELOW
+HERE := $(shell pwd)
+# DO NOT REMOVE THE LINE ABOVE
+#========================================
+
+# These are common CYGWIN build settings.
+# Comment out things you do not want.
+# Or unComment things you want.
+
+# PCs always have printer ports...
+X86_PRINTER_PORT   ?= y
+
+# Chose *ONE* of these three solutions.
+#FTD2232_DRIVER = none
+FT2232_DRIVER  = ftd2xx
+#FT2232_DRIVER  = libftdi
+
+# Do you have "libusb" installed?
+ifeq (x"${FT2232_DRIVER}",x"libftdi")
+# With LIBFTDI... LIBUSB is manditory.
+USE_LIBUSB     = y
+endif
+
+# By default... we assume libusb not present.
+USE_LIBUSB    ?= n
+
+#========================================
+# DO NOT EDIT SETTINGS BELOW THIS LINE
+#========================================
+
+
+
+#========================================
+# House keeping...
+
+# Solve problems on systems with DASH.. Grrr...
+SHELL=/bin/bash
+export SHELL
+
+VIRGINS         ?= ${HERE}/virgins
+INSTALL_DIR     ?= $(HERE)/install
+PREFIX          ?= ${INSTALL_DIR}
+
+# Determine the build platform.
+BUILD_SYSNAME_Linux      =linux
+BUILD_SYSNAME_linux      =linux
+BUILD_SYSNAME_CYGWIN_NT  =cygwin
+BUILD_SYSNAME_MINGW32_NT =mingw32
+BUILD_SYSNAME_Darwin     =darwin
+BUILD_SYSNAME_darwin     =darwin
+BUILD_SYSNAME :=$(BUILD_SYSNAME_$(shell uname --sysname | cut -d'-' -f1))
+
+# And machine (ie: i686, x86_64, or what ever)
+BUILD_MACHINE :=$(BUILD_SYSNAME).$(shell uname -m)
+
+
+#========================================
+# 
+
+FTD2XX_LINUX_VERSION=0.4.16
+FTD2XX_LINUX_DIR    = ${HERE}/libftd2xx${FTD2XX_LINUX_VERSION}
+FTD2XX_LINUX_64_DIR = ${HERE}/libftd2xx${FTD2XX_LINUX_VERSION}_x86_64
+
+
+# Wiggler type interfaces are here.
+OPENOCD_CONFIG_OPTIONS_printer_y += --enable-parport 
+OPENOCD_CONFIG_OPTIONS_printer_y += --enable-parport-giveio
+OPENOCD_CONFIG_OPTIONS_printer_y += --enable-gw16012
+OPENOCD_CONFIG_OPTIONS_printer_y += --enable-parport-giveio
+OPENOCD_CONFIG_OPTIONS_printer_y += --enable-amtjtagaccel
+
+
+# FTD2XX only supports these
+OPENOCD_CONFIG_OPTIONS_ft2232_none    =
+OPENOCD_CONFIG_OPTIONS_ft2232_ftd2xx  = --enable-ft2232_ftd2xx  --enable-presto_ftd2xx --with-ftd2xx-win32-zipdir=${FTD2XX_WIN32_DIR}
+OPENOCD_CONFIG_OPTIONS_ft2232_libftdi = --enable-ft2232_libftdi --enable-presto_libftdi 
+
+# LIBUSB - adds support for these.
+OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-jlink 
+OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-usbprog
+OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-rlink 
+OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-vsllink
+OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-usbprog
+
+#========================================
+# EXPLICITY NOT SUPPORTED INTERFACES
+#
+#  zy1000.c
+#     This is a standalone hardware box
+#     it is *NOT* a cygwin thing.
+#
+#  at91rm9200.c
+#     This is a uC/Linux (or linux) that
+#     runs uC/Linux and uses the gpio pins
+#     to bit-bang JTAG stuff.
+#
+#  ep93xx.c
+#     Just like at91rm9200 - different chip.
+
+#========================================
+# Build OPENOCD config options...
+# Always enable "dummy"
+OPENOCD_CONFIG_OPTIONS += --enable-dummy
+# 
+# Today: Cannot enable 'oocd_trace' on cygwin.
+# it assumes/uses termios functions like
+# cfmakeraw() which do not exist on cygwin.
+#
+#OPENOCD_CONFIG_OPTIONS += --enable-oocd-trace
+#
+# Add printer options..
+OPENOCD_CONFIG_OPTIONS += ${OPENOCD_CONFIG_OPTIONS_printer_${X86_PRINTER_PORT}}
+
+# Add the FTD2232 based options.
+OPENOCD_CONFIG_OPTIONS += ${OPENOCD_CONFIG_OPTIONS_ft2232_${FT2232_DRIVER}}
+
+# Add LIBUSB based options.
+OPENOCD_CONFIG_OPTIONS += ${OPENOCD_CONFIG_OPTIONS_libusb_${USE_LIBUSB}}
+
+
+#========================================
+# WARNING... the file on the ftdi chip site has a SPACE in the filename GRRR!!!
+# We fix that with the "-O" option to wget.
+FTD2XX_WIN32_VERSION=2.04.14
+FTD2XX_WIN32_DIR    = ${HERE}/ftd2xx.win32
+
+FTD2XX_ZIPFILE_LOCAL=${VIRGINS}/cdm.${FTD2XX_WIN32_VERSION}.zip
+# Damn thing has a space in the F-ing filename!
+FTD2XX_ZIPFILE_URL  ="http://www.ftdichip.com/Drivers/CDM/CDM ${FTD2XX_WIN32_VERSION}.zip"
+
+
+#========================================
+# LIBCONFUSE - used by LIBFTDI..
+LIBCONFUSE_VERSION=2.5
+LIBCONFUSE_TARFILE_LOCAL=${VIRGINS}/confuse-${LIBCONFUSE_VERSION}.tar.gz
+LIBCONFUSE_TARFILE_URL  =http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/confuse-${LIBCONFUSE_VERSION}.tar.gz
+
+LIBCONFUSE_SRC_DIR   =${HERE}/confuse-${LIBCONFUSE_VERSION}
+LIBCONFUSE_BUILD_DIR =${HERE}/confuse-build
+
+
+#========================================
+# LIBFTDI... (which uses libusb, and libconfuse)
+LIBFTDI_VERSION=0.14
+LIBFTDI_TARFILE_LOCAL    = ${VIRGINS}/libftdi-${LIBFTDI_VERSION}.tar.gz
+LIBFTDI_TARFILE_URL      = http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/libftdi-${LIBFTDI_VERSION}.tar.gz
+
+LIBFTDI_SRC_DIR  = ${HERE}/libftdi-${LIBFTDI_VERSION}
+LIBFTDI_BUILD_DIR= ${HERE}/libftdi-build
+
+#========================================
+# Finally - OpenOCD...
+#
+OPENOCD_BUILD_DIR =${HERE}/openocd-build
+OPENOCD_SRC_DIR   =${HERE}/openocd
+
+#========================================
+# END ..
+#========================================


Property changes on: trunk/testing/build.test2/local.uses
___________________________________________________________________
Name: svn:executable
   + *



From duane at mail.berlios.de  Sun Dec 28 02:08:59 2008
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sun, 28 Dec 2008 02:08:59 +0100
Subject: [Openocd-svn] r1291 - trunk/src/jtag
Message-ID: <200812280108.mBS18xjP004333@sheep.berlios.de>

Author: duane
Date: 2008-12-28 02:08:56 +0100 (Sun, 28 Dec 2008)
New Revision: 1291

Modified:
   trunk/src/jtag/vsllink.c
Log:
Updates from SimonQian

Modified: trunk/src/jtag/vsllink.c
===================================================================
--- trunk/src/jtag/vsllink.c	2008-12-27 23:23:06 UTC (rev 1290)
+++ trunk/src/jtag/vsllink.c	2008-12-28 01:08:56 UTC (rev 1291)
@@ -694,8 +694,8 @@
 
 void vsllink_runtest(int num_cycles)
 {
-	int i, j;
-	int tms_len, first_tms = 0, tms_cmd_pos;
+	int i = 0, j;
+	int tms_len, first_tms = 0, tms_cmd_pos = 0;
 	enum tap_state saved_end_state = end_state;
 
 	if (cur_state != TAP_IDLE)
@@ -971,7 +971,7 @@
 	result = vsllink_usb_write(vsllink_jtag_handle, 3);
 	if (result != 3)
 	{
-	  LOG_ERROR("VSLLink command VSLLINK_CMD_SET_PORT failed (%d)", result);
+		LOG_ERROR("VSLLink command VSLLINK_CMD_SET_PORT failed (%d)", result);
 	}
 }
 
@@ -1054,8 +1054,7 @@
 static int pending_scan_results_length;
 static pending_scan_result_t pending_scan_results_buffer[MAX_PENDING_SCAN_RESULTS];
 
-
-void vsllink_tap_init()
+void vsllink_tap_init(void)
 {
 	vsllink_usb_out_buffer_idx = 0;
 	vsllink_usb_in_want_length = 0;
@@ -1103,7 +1102,7 @@
 
 /* Pad and send a tap sequence to the device, and receive the answer.
  * For the purpose of padding we assume that we are in idle or pause state. */
-int vsllink_tap_execute()
+int vsllink_tap_execute(void)
 {
 	int i;
 	int result;
@@ -1185,7 +1184,7 @@
 /*****************************************************************************/
 /* VSLLink USB low-level functions */
 
-vsllink_jtag_t* vsllink_usb_open()
+vsllink_jtag_t* vsllink_usb_open(void)
 {
 	struct usb_bus *busses;
 	struct usb_bus *bus;



From ntfreak at mail.berlios.de  Sun Dec 28 11:58:34 2008
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Sun, 28 Dec 2008 11:58:34 +0100
Subject: [Openocd-svn] r1292 - in trunk: src/jtag testing/build.test1
	testing/build.test1/mingw32_help/include
	testing/build.test1/mingw32_help/include/sys testing/build.test2
Message-ID: <200812281058.mBSAwYV9008725@sheep.berlios.de>

Author: ntfreak
Date: 2008-12-28 11:58:34 +0100 (Sun, 28 Dec 2008)
New Revision: 1292

Modified:
   trunk/src/jtag/vsllink.c
   trunk/testing/build.test1/Makefile
   trunk/testing/build.test1/Makefile.confuse
   trunk/testing/build.test1/Makefile.ftd2xx
   trunk/testing/build.test1/Makefile.libftdi
   trunk/testing/build.test1/Makefile.libusb
   trunk/testing/build.test1/Makefile.openocd
   trunk/testing/build.test1/README.TXT
   trunk/testing/build.test1/local.uses
   trunk/testing/build.test1/mingw32_help/include/elf.h
   trunk/testing/build.test1/mingw32_help/include/sys/cdefs.h
   trunk/testing/build.test1/mingw32_help/include/sys/elf32.h
   trunk/testing/build.test1/mingw32_help/include/sys/elf64.h
   trunk/testing/build.test1/mingw32_help/include/sys/elf_common.h
   trunk/testing/build.test1/mingw32_help/include/sys/elf_generic.h
   trunk/testing/build.test2/Makefile
   trunk/testing/build.test2/README.txt
   trunk/testing/build.test2/local.uses
Log:
- fix missing/incorrect svn file props


Property changes on: trunk/src/jtag/vsllink.c
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/Makefile
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/Makefile.confuse
___________________________________________________________________
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/Makefile.ftd2xx
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/Makefile.libftdi
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/Makefile.libusb
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/Makefile.openocd
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native

Modified: trunk/testing/build.test1/README.TXT
===================================================================
--- trunk/testing/build.test1/README.TXT	2008-12-28 01:08:56 UTC (rev 1291)
+++ trunk/testing/build.test1/README.TXT	2008-12-28 10:58:34 UTC (rev 1292)
@@ -1,39 +1,39 @@
--- Duane Ellis'es test case for building numerous openocd configurations...
-Dec 26,2008
----------------------------------------------------------------------------
-
-1)	Make a directory some where..
-
-	mkdir ~/test
-
-2)	Change to that directory
-
-	cd  ~/test
-
-3)	Checkout OpenOCD in that directory.
-
-	cd ~/test
-	svn co https://svn.berlios.de/svnroot/repos/openocd/trunk openocd
-
-4)      Copy the "build.test1" directory to the "~/work" directory.
-
-
-	cd ~/test
-	cp ~/openocd/testing/build.test1/.  ~/test/.
-
-5)	If needed, download various components.
-
-	cd ~/work
-	make all.download
-
-
-6)	For Linux - type: 
-
-	cd ~/work
-	make linux.buildtest
-
-7)	For Cygwin - type:
-
-	cd ~/work
-	make cygwin.buildtest
-
+-- Duane Ellis'es test case for building numerous openocd configurations...
+Dec 26,2008
+---------------------------------------------------------------------------
+
+1)	Make a directory some where..
+
+	mkdir ~/test
+
+2)	Change to that directory
+
+	cd  ~/test
+
+3)	Checkout OpenOCD in that directory.
+
+	cd ~/test
+	svn co https://svn.berlios.de/svnroot/repos/openocd/trunk openocd
+
+4)      Copy the "build.test1" directory to the "~/work" directory.
+
+
+	cd ~/test
+	cp ~/openocd/testing/build.test1/.  ~/test/.
+
+5)	If needed, download various components.
+
+	cd ~/work
+	make all.download
+
+
+6)	For Linux - type: 
+
+	cd ~/work
+	make linux.buildtest
+
+7)	For Cygwin - type:
+
+	cd ~/work
+	make cygwin.buildtest
+


Property changes on: trunk/testing/build.test1/README.TXT
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/local.uses
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/mingw32_help/include/elf.h
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/mingw32_help/include/sys/cdefs.h
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/mingw32_help/include/sys/elf32.h
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/mingw32_help/include/sys/elf64.h
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/mingw32_help/include/sys/elf_common.h
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test1/mingw32_help/include/sys/elf_generic.h
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test2/Makefile
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native

Modified: trunk/testing/build.test2/README.txt
===================================================================
--- trunk/testing/build.test2/README.txt	2008-12-28 01:08:56 UTC (rev 1291)
+++ trunk/testing/build.test2/README.txt	2008-12-28 10:58:34 UTC (rev 1292)
@@ -1,59 +1,59 @@
-
-This makefile is how I Duane Ellis (openocd at duaneellis.com) builds
-openocd test purposes on Cygwin. I have included it here so others
-might also make use of the same configuration that I use to develop
-Openocd.
-
---Duane Ellis
-
-To make use of it do the following:
-
-(1)	Check out openocd in the standard way.
-
-For example - in cygwin, type this:
-
-    bash$  mkdir -p /home/duane/test
-    bash$  cd /home/duane/test
-    bash$  svn co https://svn.berlios.de/svnroot/repos/openocd/trunk openocd
-
-(2)	COPY this folder "right above" where you have OpenOCD.
-
-    bash$  cd /home/duane/test
-    bash$  cp ./openocd/testing/build.test2/*   /home/duane/test/.
-
-(3) OPTIONALLY
-
-    You might want to review the file "local.uses"
-    Change options and so forth at the top of the file.
-
-(4) 	Initially, you need to download some additional files.
-	These include "libftdi", "libconfuse", and the ftd2xx drivers.
-
-(5)	You also need to build the supporting libraries and install them
-	(They are installed "locally" only)
-
-	Type this command:
-
-    bash$ cd /home/duane/test
-
-    bash$ make initial.build
-
-    	  which:  (1) downloads files
-	  	  (2) builds the libs
-		  (3) builds OpenOCD
-
-(6)     As you hack upon OpenOCD... to rebuild OpenOCD...
-	
-    bash$ cd /home/duane/test
-
-    bash$ make remake
-
-    	  which: (1) re-bootstraps 
-	  	 (2) re-configures
-		 (3) re-builds
-		 (4) re-installs.
-   
-=======
-**END**
-=======
-
+
+This makefile is how I Duane Ellis (openocd at duaneellis.com) builds
+openocd test purposes on Cygwin. I have included it here so others
+might also make use of the same configuration that I use to develop
+Openocd.
+
+--Duane Ellis
+
+To make use of it do the following:
+
+(1)	Check out openocd in the standard way.
+
+For example - in cygwin, type this:
+
+    bash$  mkdir -p /home/duane/test
+    bash$  cd /home/duane/test
+    bash$  svn co https://svn.berlios.de/svnroot/repos/openocd/trunk openocd
+
+(2)	COPY this folder "right above" where you have OpenOCD.
+
+    bash$  cd /home/duane/test
+    bash$  cp ./openocd/testing/build.test2/*   /home/duane/test/.
+
+(3) OPTIONALLY
+
+    You might want to review the file "local.uses"
+    Change options and so forth at the top of the file.
+
+(4) 	Initially, you need to download some additional files.
+	These include "libftdi", "libconfuse", and the ftd2xx drivers.
+
+(5)	You also need to build the supporting libraries and install them
+	(They are installed "locally" only)
+
+	Type this command:
+
+    bash$ cd /home/duane/test
+
+    bash$ make initial.build
+
+    	  which:  (1) downloads files
+	  	  (2) builds the libs
+		  (3) builds OpenOCD
+
+(6)     As you hack upon OpenOCD... to rebuild OpenOCD...
+	
+    bash$ cd /home/duane/test
+
+    bash$ make remake
+
+    	  which: (1) re-bootstraps 
+	  	 (2) re-configures
+		 (3) re-builds
+		 (4) re-installs.
+   
+=======
+**END**
+=======
+


Property changes on: trunk/testing/build.test2/README.txt
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native


Property changes on: trunk/testing/build.test2/local.uses
___________________________________________________________________
Name: svn:executable
   - *
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Sun Dec 28 22:40:46 2008
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 28 Dec 2008 22:40:46 +0100
Subject: [Openocd-svn] r1293 - in trunk/src: flash helper jtag target
Message-ID: <200812282140.mBSLekvw001511@sheep.berlios.de>

Author: oharboe
Date: 2008-12-28 22:40:39 +0100 (Sun, 28 Dec 2008)
New Revision: 1293

Modified:
   trunk/src/flash/nand.c
   trunk/src/helper/jim.c
   trunk/src/jtag/usbprog.c
   trunk/src/target/target.c
Log:
Uwe Hermann <uwe at hermann-uwe.de> One of them is fixing a few compiler warnings (see attached patch) and
likely also one (non-cosmetic) bug (the 'id_buff' change, which seems to
be a buffer overflow).

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2008-12-28 10:58:34 UTC (rev 1292)
+++ trunk/src/flash/nand.c	2008-12-28 21:40:39 UTC (rev 1293)
@@ -375,7 +375,7 @@
 int nand_probe(struct nand_device_s *device)
 {
 	u8 manufacturer_id, device_id;
-	u8 id_buff[5];
+	u8 id_buff[6];
 	int retval;
 	int i;
 

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2008-12-28 10:58:34 UTC (rev 1292)
+++ trunk/src/helper/jim.c	2008-12-28 21:40:39 UTC (rev 1293)
@@ -49,6 +49,7 @@
 #define JIM_DYNLIB      /* Dynamic library support for UNIX and WIN32 */
 #endif /* JIM_ANSIC */
 
+#define _GNU_SOURCE	/* for vasprintf() */
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2008-12-28 10:58:34 UTC (rev 1292)
+++ trunk/src/jtag/usbprog.c	2008-12-28 21:40:39 UTC (rev 1293)
@@ -93,7 +93,7 @@
 
 struct usbprog_jtag * usbprog_jtag_handle;
 
-struct usbprog_jtag* usbprog_jtag_open();
+struct usbprog_jtag* usbprog_jtag_open(void);
 void usbprog_jtag_close(struct usbprog_jtag *usbprog_jtag);
 void usbprog_jtag_init(struct usbprog_jtag *usbprog_jtag);
 unsigned char usbprog_jtag_message(struct usbprog_jtag *usbprog_jtag, char *msg, int msglen);
@@ -405,7 +405,7 @@
 
 struct usb_bus *busses;
 
-struct usbprog_jtag* usbprog_jtag_open()
+struct usbprog_jtag* usbprog_jtag_open(void)
 {
 	struct usb_bus *bus;
 	struct usb_device *dev;

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2008-12-28 10:58:34 UTC (rev 1292)
+++ trunk/src/target/target.c	2008-12-28 21:40:39 UTC (rev 1293)
@@ -4014,7 +4014,7 @@
 static int fastload_num;
 static struct FastLoad *fastload;
 
-static void free_fastload()
+static void free_fastload(void)
 {
 	if (fastload!=NULL)
 	{



