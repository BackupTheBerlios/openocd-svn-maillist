From zwelch at mail.berlios.de  Fri May  1 01:19:59 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 1 May 2009 01:19:59 +0200
Subject: [Openocd-svn] r1585 - in trunk/src/target: board target
Message-ID: <200904302319.n3UNJx4M008972@sheep.berlios.de>

Author: zwelch
Date: 2009-05-01 01:19:46 +0200 (Fri, 01 May 2009)
New Revision: 1585

Added:
   trunk/src/target/board/hitex_str9_comstick.cfg
Modified:
   trunk/src/target/target/str9comstick.cfg
Log:
Uwe Hermann <uwe at hermann-uwe.de>: Support both rev -A1 and -A2 of Hitex STR9-comStick.

Added: trunk/src/target/board/hitex_str9_comstick.cfg
===================================================================
--- trunk/src/target/board/hitex_str9_comstick.cfg	2009-04-30 21:04:34 UTC (rev 1584)
+++ trunk/src/target/board/hitex_str9_comstick.cfg	2009-04-30 23:19:46 UTC (rev 1585)
@@ -0,0 +1,11 @@
+#
+# Hitex STR9-comStick
+#
+# http://www.hitex.com/index.php?id=383
+#
+
+# This works for the STR9-comStick revisions STR912CS-A1 and STR912CS-A2.
+
+source [find interface/str9-comstick.cfg]
+source [find target/str9comstick.cfg]
+


Property changes on: trunk/src/target/board/hitex_str9_comstick.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/target/str9comstick.cfg
===================================================================
--- trunk/src/target/target/str9comstick.cfg	2009-04-30 21:04:34 UTC (rev 1584)
+++ trunk/src/target/target/str9comstick.cfg	2009-04-30 23:19:46 UTC (rev 1585)
@@ -39,9 +39,12 @@
 if { [info exists BSTAPID ] } {
    set _BSTAPID $BSTAPID
 } else {
-   set _BSTAPID 0x1457f041
+   # Found on STR9-comStick, revision STR912CS-A1
+   set _BSTAPID1 0x1457f041
+   # Found on STR9-comStick, revision STR912CS-A2
+   set _BSTAPID2 0x2457f041
 }
-jtag newtap $_CHIPNAME bs    -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID
+jtag newtap $_CHIPNAME bs -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID1 -expected-id $_BSTAPID2
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
 target create $_TARGETNAME arm966e -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm966e



From zwelch at mail.berlios.de  Fri May  1 03:18:10 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 1 May 2009 03:18:10 +0200
Subject: [Openocd-svn] r1586 - trunk/src
Message-ID: <200905010118.n411IAeL014885@sheep.berlios.de>

Author: zwelch
Date: 2009-05-01 03:18:05 +0200 (Fri, 01 May 2009)
New Revision: 1586

Modified:
   trunk/src/openocd.c
Log:
Dick Hollenbeck <dick at softplc.com>: move OPENOCD_VERSION to use config.h

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-04-30 23:19:46 UTC (rev 1585)
+++ trunk/src/openocd.c	2009-05-01 01:18:05 UTC (rev 1586)
@@ -24,8 +24,6 @@
  *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
  ***************************************************************************/
 
-#define OPENOCD_VERSION "Open On-Chip Debugger " VERSION " (" PKGBLDDATE ") "RELSTR PKGBLDREV
-
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
@@ -57,6 +55,11 @@
 #include <unistd.h>
 #include <errno.h>
 
+
+#define OPENOCD_VERSION \
+		"Open On-Chip Debugger " VERSION " (" PKGBLDDATE ") " RELSTR PKGBLDREV
+
+
 void print_version(void)
 {
 	/* DANGER!!! make sure that the line below does not appear in a patch, do not remove */



From zwelch at mail.berlios.de  Fri May  1 05:07:40 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 1 May 2009 05:07:40 +0200
Subject: [Openocd-svn] r1587 - trunk/src
Message-ID: <200905010307.n4137eYO031758@sheep.berlios.de>

Author: zwelch
Date: 2009-05-01 05:07:32 +0200 (Fri, 01 May 2009)
New Revision: 1587

Modified:
   trunk/src/openocd.c
Log:
Add static keywords to main application helper functions.

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-05-01 01:18:05 UTC (rev 1586)
+++ trunk/src/openocd.c	2009-05-01 03:07:32 UTC (rev 1587)
@@ -59,8 +59,7 @@
 #define OPENOCD_VERSION \
 		"Open On-Chip Debugger " VERSION " (" PKGBLDDATE ") " RELSTR PKGBLDREV
 
-
-void print_version(void)
+static void print_version(void)
 {
 	/* DANGER!!! make sure that the line below does not appear in a patch, do not remove */
 	/* DANGER!!! make sure that the line below does not appear in a patch, do not remove */
@@ -76,7 +75,7 @@
 }
 
 /* Give TELNET a way to find out what version this is */
-int handle_version_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_version_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	if (argc!=0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -86,7 +85,7 @@
 	return ERROR_OK;
 }
 
-void exit_handler(void)
+static void exit_handler(void)
 {
 	/* close JTAG interface */
 	if (jtag && jtag->quit)
@@ -120,7 +119,7 @@
 int ioutil_init(struct command_context_s *cmd_ctx);
 
 /* OpenOCD can't really handle failure of this command. Patches welcome! :-) */
-int handle_init_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_init_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 
 	if (argc!=0)
@@ -188,7 +187,7 @@
 
 command_context_t *global_cmd_ctx;
 
-command_context_t *setup_command_handler(void)
+static command_context_t *setup_command_handler(void)
 {
 	command_context_t *cmd_ctx;
 



From zwelch at mail.berlios.de  Sat May  2 01:42:46 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 2 May 2009 01:42:46 +0200
Subject: [Openocd-svn] r1588 - trunk/src/jtag
Message-ID: <200905012342.n41NgkaB008279@sheep.berlios.de>

Author: zwelch
Date: 2009-05-02 01:42:43 +0200 (Sat, 02 May 2009)
New Revision: 1588

Modified:
   trunk/src/jtag/jtag.c
Log:
Remove superflous spaces from new JTAG table to fix formatting.

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-01 03:07:32 UTC (rev 1587)
+++ trunk/src/jtag/jtag.c	2009-05-01 23:42:43 UTC (rev 1588)
@@ -3153,13 +3153,13 @@
 #else	/* this is the old table, converted from hex and with the bit_count set to 7 for each combo, like before */
 
 	/* to state: */
-	/*	RESET			IDLE				DRSHIFT			DRPAUSE			IRSHIFT	  		IRPAUSE */		/* from state: */
-	{	B8(1111111,7),	B8(0000000,7),	B8(0010111,7), 	B8(0001010,7),	B8(0011011,7), 	B8(0010110,7) },	/* RESET */
-	{	B8(1111111,7),	B8(0000000,7),	B8(0100101,7),  	B8(0000101,7),	B8(0101011,7),  	B8(0001011,7) },	/* IDLE */
+	/*	RESET			IDLE			DRSHIFT			DRPAUSE			IRSHIFT			IRPAUSE 	*/		/* from state: */
+	{	B8(1111111,7),	B8(0000000,7),	B8(0010111,7),	B8(0001010,7),	B8(0011011,7),	B8(0010110,7) },	/* RESET */
+	{	B8(1111111,7),	B8(0000000,7),	B8(0100101,7),	B8(0000101,7),	B8(0101011,7),	B8(0001011,7) },	/* IDLE */
 	{	B8(1111111,7),	B8(0110001,7),	B8(0000000,7),	B8(0000001,7),	B8(0001111,7),	B8(0101111,7) },	/* DRSHIFT */
-	{	B8(1111111,7),	B8(0110000,7),	B8(0100000,7),  	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },	/* DRPAUSE */
-	{	B8(1111111,7),	B8(0110001,7),	B8(0000111,7),	B8(0010111,7), 	B8(0000000,7),	B8(0000001,7) },	/* IRSHIFT */
-	{	B8(1111111,7),	B8(0110000,7),	B8(0011100,7),	B8(0010111,7),	B8(0100000,7),  	B8(0101111,7) } 	/* IRPAUSE */
+	{	B8(1111111,7),	B8(0110000,7),	B8(0100000,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },	/* DRPAUSE */
+	{	B8(1111111,7),	B8(0110001,7),	B8(0000111,7),	B8(0010111,7),	B8(0000000,7),	B8(0000001,7) },	/* IRSHIFT */
+	{	B8(1111111,7),	B8(0110000,7),	B8(0011100,7),	B8(0010111,7),	B8(0100000,7),	B8(0101111,7) },	/* IRPAUSE */
 
 #endif
 



From oharboe at mail.berlios.de  Sat May  2 14:26:12 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 2 May 2009 14:26:12 +0200
Subject: [Openocd-svn] r1589 - trunk/src/helper
Message-ID: <200905021226.n42CQCdh001507@sheep.berlios.de>

Author: oharboe
Date: 2009-05-02 14:26:10 +0200 (Sat, 02 May 2009)
New Revision: 1589

Modified:
   trunk/src/helper/jim.c
Log:
Zach Welch <zw at superlucidity.net> fix warnings

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-01 23:42:43 UTC (rev 1588)
+++ trunk/src/helper/jim.c	2009-05-02 12:26:10 UTC (rev 1589)
@@ -89,7 +89,7 @@
 #endif /* WIN32 */
 #endif /* JIM_DYNLIB */
 
-#ifndef WIN32
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
 #endif
 
@@ -118,7 +118,7 @@
 static void JimFreeCallFrame(Jim_Interp *interp, Jim_CallFrame *cf, int flags);
 static void JimRegisterCoreApi(Jim_Interp *interp);
 
-static Jim_HashTableType JimVariablesHashTableType;
+static Jim_HashTableType *getJimVariablesHashTableType(void);
 
 /* -----------------------------------------------------------------------------
  * Utility functions
@@ -3237,7 +3237,7 @@
         Jim_ListLength(interp, staticsListObjPtr, &len);
         if (len != 0) {
             cmdPtr->staticVars = Jim_Alloc(sizeof(Jim_HashTable));
-            Jim_InitHashTable(cmdPtr->staticVars, &JimVariablesHashTableType,
+            Jim_InitHashTable(cmdPtr->staticVars, getJimVariablesHashTableType(),
                     interp);
             for (i = 0; i < len; i++) {
                 Jim_Obj *objPtr, *initObjPtr, *nameObjPtr;
@@ -3440,6 +3440,11 @@
     JimVariablesHTValDestructor       /* val destructor */
 };
 
+static Jim_HashTableType *getJimVariablesHashTableType(void)
+{
+	return &JimVariablesHashTableType;
+}
+
 /* -----------------------------------------------------------------------------
  * Variable object
  * ---------------------------------------------------------------------------*/



From oharboe at mail.berlios.de  Sat May  2 21:31:32 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 2 May 2009 21:31:32 +0200
Subject: [Openocd-svn] r1590 - trunk/src
Message-ID: <200905021931.n42JVWEo018751@sheep.berlios.de>

Author: oharboe
Date: 2009-05-02 21:31:30 +0200 (Sat, 02 May 2009)
New Revision: 1590

Modified:
   trunk/src/main.c
   trunk/src/openocd.c
Log:
Dick Hollenbeck <dick at softplc.com> moved stuff into openocd.c - should never have been in main.c in the first place. DLL will now build.

Modified: trunk/src/main.c
===================================================================
--- trunk/src/main.c	2009-05-02 12:26:10 UTC (rev 1589)
+++ trunk/src/main.c	2009-05-02 19:31:30 UTC (rev 1590)
@@ -23,19 +23,6 @@
 #include "config.h"
 #endif
 
-#if !BUILD_HTTPD
-/* implementations of OpenOCD that uses multithreading needs to know when
- * OpenOCD is sleeping. No-op in vanilla OpenOCD
- */
-void openocd_sleep_prelude(void)
-{
-}
-
-void openocd_sleep_postlude(void)
-{
-}
-#endif
-
 /* This is the main entry for developer PC hosted OpenOCD.
  *
  * OpenOCD can also be used as a library that is linked with

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-05-02 12:26:10 UTC (rev 1589)
+++ trunk/src/openocd.c	2009-05-02 19:31:30 UTC (rev 1590)
@@ -228,6 +228,21 @@
 int httpd_start(void);
 void httpd_stop(void);
 
+
+#if !BUILD_HTTPD
+/* implementations of OpenOCD that uses multithreading needs to know when
+ * OpenOCD is sleeping. No-op in vanilla OpenOCD
+ */
+void openocd_sleep_prelude(void)
+{
+}
+
+void openocd_sleep_postlude(void)
+{
+}
+#endif
+
+
 /* normally this is the main() function entry, but if OpenOCD is linked
  * into application, then this fn will not be invoked, but rather that
  * application will have it's own implementation of main(). */



From zwelch at mail.berlios.de  Sun May  3 00:35:33 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 3 May 2009 00:35:33 +0200
Subject: [Openocd-svn] r1591 - in trunk: . src src/flash src/helper src/jtag
	src/pld src/server src/svf src/target src/xsvf
Message-ID: <200905022235.n42MZXfu001816@sheep.berlios.de>

Author: zwelch
Date: 2009-05-03 00:35:02 +0200 (Sun, 03 May 2009)
New Revision: 1591

Modified:
   trunk/Makefile.am
   trunk/configure.in
   trunk/src/Makefile.am
   trunk/src/flash/Makefile.am
   trunk/src/helper/Makefile.am
   trunk/src/jtag/Makefile.am
   trunk/src/pld/Makefile.am
   trunk/src/server/Makefile.am
   trunk/src/svf/Makefile.am
   trunk/src/target/Makefile.am
   trunk/src/xsvf/Makefile.am
Log:
Update autotools scripts to require automake 1.6.  The configure.in script
already required autoconf 2.59 (circa 2006), so there is no reason to
support versions of automake older than 1.6 (circa 2002).

The first part of this patch upgrades the configure.in script:

     1. Use current calling conventions for the AC_INIT and
        AM_INIT_AUTOMAKE macros, bringing their usage up-to-date with
        the version of autoconf already specified by AC_PREREQ.
     2. Add AC_CONFIG_SRCDIR macro, required by new version of AC_INIT.
     3. Automatically enable all of automake's warnings except Makefile
        portability (which OpenOCD violates by using GNU make's $(wildcard)).
        [[ While automake has its own -Werror option, I did not enabled it
        due to existing warnings. ]]
     4. Add the missing AM_PROG_C_O check, required by the build rules for
        openocd.o in src/Makefile.am.
     5. Adjust version number to show progress toward the next release.
     6. Include a bug reporting e-mail address to direct users to this list.

This patch makes the following adjustments to the Makefile.am files:

     1. Update AUTOMAKE_OPTIONS to require automake version 1.6
     2. Rewrite all deprecated INCLUDES assignments as AM_CPPFLAGS
     3. Clean-up all AM_CPPFLAGS declarations to be patch-friendly.
     4. Remove vestigial references to $(all_includes)
     5. Remove erroneous references to @CPPFLAGS@ (only use AM_CPPFLAGS)
     6. Remove unused -I and -D directives in helper/, flash/, target/


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -1,6 +1,6 @@
 # not a GNU package. You can remove this line, if
 # have all needed files, that a GNU package needs
-AUTOMAKE_OPTIONS = foreign 1.4
+AUTOMAKE_OPTIONS = foreign 1.6
 
 nobase_dist_pkgdata_DATA = \
 	contrib/libdcc/dcc_stdio.c \
@@ -18,6 +18,8 @@
 	config.guess \
 	config.sub \
 	config.h.in \
+	config.h.in~ \
+	compile \
 	missing \
 	aclocal.m4 \
 	install-sh

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/configure.in	2009-05-02 22:35:02 UTC (rev 1591)
@@ -1,5 +1,7 @@
 AC_PREREQ(2.59)
-AC_INIT(configure.in)
+AC_INIT([openocd], [0.2.0-in-development],
+	[OpenOCD Mailing List <openocd-development at lists.berlios.de>])
+AC_CONFIG_SRCDIR([src/openocd.c])
 
 AC_CANONICAL_HOST
 
@@ -738,7 +740,7 @@
 fi
 
 AM_CONFIG_HEADER(config.h)
-AM_INIT_AUTOMAKE(openocd, 1.0)
+AM_INIT_AUTOMAKE([-Wall -Wno-portability])
 AM_MAINTAINER_MODE
 
 AM_CONDITIONAL(RELEASE, test $build_release = yes)
@@ -771,6 +773,7 @@
 
 AC_LANG_C
 AC_PROG_CC
+AM_PROG_CC_C_O
 AC_PROG_RANLIB
 
 # set default gcc warnings

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/src/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -9,9 +9,16 @@
 openocd_SOURCES = $(MAINFILE) openocd.c
 
 # set the include path found by configure
-INCLUDES = -I$(top_srcdir)/src -I$(top_srcdir)/src/helper \
-	-I$(top_srcdir)/src/jtag -I$(top_srcdir)/src/target -I$(top_srcdir)/src/xsvf -I$(top_srcdir)/src/svf \
-	-I$(top_srcdir)/src/server -I$(top_srcdir)/src/flash -I$(top_srcdir)/src/pld $(all_includes)
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/src \
+	-I$(top_srcdir)/src/helper \
+	-I$(top_srcdir)/src/jtag \
+	-I$(top_srcdir)/src/target \
+	-I$(top_srcdir)/src/xsvf \
+	-I$(top_srcdir)/src/svf \
+	-I$(top_srcdir)/src/server \
+	-I$(top_srcdir)/src/flash \
+	-I$(top_srcdir)/src/pld
 
 # pass path to prefix path
 openocd_CPPFLAGS = \
@@ -25,7 +32,7 @@
 endif
 
 # add default CPPFLAGS
-openocd_CPPFLAGS += @CPPFLAGS@
+openocd_CPPFLAGS += $(AM_CPPFLAGS) $(CPPFLAGS)
 
 # the library search path.
 openocd_LDFLAGS = $(all_libraries) 

Modified: trunk/src/flash/Makefile.am
===================================================================
--- trunk/src/flash/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/src/flash/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -1,5 +1,8 @@
-INCLUDES = -I$(top_srcdir)/src/helper -I$(top_srcdir)/src/jtag -I$(top_srcdir)/src/target $(all_includes)
-AM_CPPFLAGS = -DPKGLIBDIR=\"$(pkglibdir)\" @CPPFLAGS@
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/src/helper \
+	-I$(top_srcdir)/src/jtag \
+	-I$(top_srcdir)/src/target
+
 METASOURCES = AUTO
 noinst_LIBRARIES = libflash.a
 libflash_a_SOURCES = \

Modified: trunk/src/helper/Makefile.am
===================================================================
--- trunk/src/helper/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/src/helper/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -1,6 +1,10 @@
-INCLUDES = -I$(top_srcdir)/src $(all_includes) -I$(top_srcdir)/src/target -I$(top_srcdir)/src/server
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/src/server \
+	-I$(top_srcdir)/src/target \
+	-DPKGDATADIR=\"$(pkgdatadir)\" \
+	-DPKGLIBDIR=\"$(pkglibdir)\"
+
 METASOURCES = AUTO
-AM_CPPFLAGS = -DPKGDATADIR=\"$(pkgdatadir)\" -DPKGLIBDIR=\"$(pkglibdir)\" @CPPFLAGS@
 noinst_LIBRARIES = libhelper.a
 
 if ECOSBOARD

Modified: trunk/src/jtag/Makefile.am
===================================================================
--- trunk/src/jtag/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/src/jtag/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -1,6 +1,7 @@
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/src/helper \
+	-I$(top_srcdir)/src/target
 
-
-INCLUDES = -I$(top_srcdir)/src -I$(top_srcdir)/src/helper  $(all_includes) -I$(top_srcdir)/src/target 
 METASOURCES = AUTO
 noinst_LIBRARIES = libjtag.a
 

Modified: trunk/src/pld/Makefile.am
===================================================================
--- trunk/src/pld/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/src/pld/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -1,4 +1,8 @@
-INCLUDES = -I$(top_srcdir)/src/server -I$(top_srcdir)/src/helper -I$(top_srcdir)/src/jtag $(all_includes)
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/src/server \
+	-I$(top_srcdir)/src/helper \
+	-I$(top_srcdir)/src/jtag
+
 METASOURCES = AUTO
 noinst_LIBRARIES = libpld.a
 noinst_HEADERS = pld.h xilinx_bit.h virtex2.h

Modified: trunk/src/server/Makefile.am
===================================================================
--- trunk/src/server/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/src/server/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -1,4 +1,10 @@
-INCLUDES = -I$(top_srcdir)/src/helper -I$(top_srcdir)/src/target -I$(top_srcdir)/src/flash -I$(top_srcdir)/src/jtag $(all_includes)
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/src/helper \
+	-I$(top_srcdir)/src/target \
+	-I$(top_srcdir)/src/flash \
+	-I$(top_srcdir)/src/jtag  \
+	-DPKGLIBDIR=\"$(pkglibdir)\"
+
 METASOURCES = AUTO
 noinst_LIBRARIES = libserver.a
 noinst_HEADERS = server.h telnet_server.h gdb_server.h
@@ -21,6 +27,5 @@
 if HTTPD
 nobase_dist_pkglib_DATA = $(wildcard $(srcdir)/httpd/*.tcl $(srcdir)/httpd/*.css $(srcdir)/httpd/menu_cuts/*.png)
 endif
-AM_CPPFLAGS = -DPKGLIBDIR=\"$(pkglibdir)\" @CPPFLAGS@
 
 MAINTAINERCLEANFILES = Makefile.in

Modified: trunk/src/svf/Makefile.am
===================================================================
--- trunk/src/svf/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/src/svf/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -1,4 +1,8 @@
-INCLUDES = -I$(top_srcdir)/src/server -I$(top_srcdir)/src/helper 	-I$(top_srcdir)/src/jtag $(all_includes)
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/src/server \
+	-I$(top_srcdir)/src/helper \
+	-I$(top_srcdir)/src/jtag
+
 METASOURCES = AUTO
 noinst_LIBRARIES = libsvf.a
 noinst_HEADERS = svf.h

Modified: trunk/src/target/Makefile.am
===================================================================
--- trunk/src/target/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/src/target/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -5,9 +5,12 @@
 OOCD_TRACE_FILES =
 endif
 
-INCLUDES = -I$(top_srcdir)/src/gdb -I$(top_srcdir)/src/helper 	-I$(top_srcdir)/src/jtag -I$(top_srcdir)/src/xsvf $(all_includes)
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/src/helper \
+	-I$(top_srcdir)/src/jtag \
+	-I$(top_srcdir)/src/xsvf
+
 METASOURCES = AUTO
-AM_CPPFLAGS = -DPKGLIBDIR=\"$(pkglibdir)\" @CPPFLAGS@
 noinst_LIBRARIES = libtarget.a
 libtarget_a_SOURCES = target.c register.c breakpoints.c armv4_5.c embeddedice.c etm.c arm7tdmi.c arm9tdmi.c \
 	arm_jtag.c arm7_9_common.c algorithm.c arm920t.c arm720t.c armv4_5_mmu.c armv4_5_cache.c arm_disassembler.c \

Modified: trunk/src/xsvf/Makefile.am
===================================================================
--- trunk/src/xsvf/Makefile.am	2009-05-02 19:31:30 UTC (rev 1590)
+++ trunk/src/xsvf/Makefile.am	2009-05-02 22:35:02 UTC (rev 1591)
@@ -1,4 +1,8 @@
-INCLUDES = -I$(top_srcdir)/src/server -I$(top_srcdir)/src/helper 	-I$(top_srcdir)/src/jtag $(all_includes)
+AM_CPPFLAGS = \
+	-I$(top_srcdir)/src/server \
+	-I$(top_srcdir)/src/helper \
+	-I$(top_srcdir)/src/jtag
+
 METASOURCES = AUTO
 noinst_LIBRARIES = libxsvf.a
 noinst_HEADERS = xsvf.h



From zwelch at mail.berlios.de  Sun May  3 00:46:18 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 3 May 2009 00:46:18 +0200
Subject: [Openocd-svn] r1592 - trunk
Message-ID: <200905022246.n42MkIuO009928@sheep.berlios.de>

Author: zwelch
Date: 2009-05-03 00:46:14 +0200 (Sun, 03 May 2009)
New Revision: 1592

Modified:
   trunk/configure.in
Log:
Add configure check for usb.h; required by a USB drivers.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-02 22:35:02 UTC (rev 1591)
+++ trunk/configure.in	2009-05-02 22:46:14 UTC (rev 1592)
@@ -739,6 +739,14 @@
 CFLAGS=$CFLAGS_SAVE
 fi
 
+# check for usb.h when a driver will require it
+if test $build_jlink = yes -o $build_vsllink = yes -o $build_usbprog = yes -o \
+	$build_rlink = yes -o $build_armjtagew = yes
+then 
+  AC_CHECK_HEADERS([usb.h],[],
+	[AC_MSG_ERROR([usb.h is required to build some OpenOCD driver(s)])])
+fi
+
 AM_CONFIG_HEADER(config.h)
 AM_INIT_AUTOMAKE([-Wall -Wno-portability])
 AM_MAINTAINER_MODE



From zwelch at mail.berlios.de  Sun May  3 05:35:10 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 3 May 2009 05:35:10 +0200
Subject: [Openocd-svn] r1593 - trunk
Message-ID: <200905030335.n433ZAeP017491@sheep.berlios.de>

Author: zwelch
Date: 2009-05-03 05:35:01 +0200 (Sun, 03 May 2009)
New Revision: 1593

Modified:
   trunk/configure.in
Log:
Fix build when enabling presto+ftd2xx driver only.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-02 22:46:14 UTC (rev 1592)
+++ trunk/configure.in	2009-05-03 03:35:01 UTC (rev 1593)
@@ -537,7 +537,7 @@
    AC_MSG_ERROR([The option: with_ftd2xx_linux_tardir is for LINUX only.])
 fi
 
-if test $build_ft2232_ftd2xx = yes ; then
+if test $build_ft2232_ftd2xx = yes -o $build_presto_ftd2xx = yes ; then
 AC_MSG_CHECKING([for ftd2xx.lib exists (win32)])
 
    # if we are given a zipdir...
@@ -586,7 +586,7 @@
    AC_MSG_ERROR([The option: with_ftd2xx_linux_tardir is for LINUX only.])
 fi
 
-if test $build_ft2232_ftd2xx = yes ; then
+if test $build_ft2232_ftd2xx = yes -o $build_presto_ftd2xx = yes ; then
    AC_MSG_CHECKING([for libftd2xx.a (darwin)])
 
    if test ! -f /usr/local/include/ftd2xx.h ; then
@@ -607,7 +607,7 @@
    AC_MSG_ERROR([The option: --with-ftd2xx-win32-zipdir is for win32 only])
 fi
 
-if test $build_ft2232_ftd2xx = yes ; then
+if test $build_ft2232_ftd2xx = yes -o $build_presto_ftd2xx = yes ; then
    # Must be linux
    if test $host_os != linux-gnu && test $host_os != linux ; then
       AC_MSG_ERROR([The (linux) ftd2xx library from FTDICHIP.com is linux only. Try --enable-ft2232-libftdi instead])
@@ -661,7 +661,7 @@
 fi
 fi
 
-if test $build_ft2232_ftd2xx = yes; then
+if test $build_ft2232_ftd2xx = yes -o $build_presto_ftd2xx = yes; then
 
 # Before we go any further - make sure we can *BUILD* and *RUN*
 # a simple app with the "ftd2xx.lib" file - in what ever form we where given



From oharboe at mail.berlios.de  Sun May  3 17:10:18 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 3 May 2009 17:10:18 +0200
Subject: [Openocd-svn] r1594 - in trunk/src: flash target
Message-ID: <200905031510.n43FAIPt013830@sheep.berlios.de>

Author: oharboe
Date: 2009-05-03 17:10:16 +0200 (Sun, 03 May 2009)
New Revision: 1594

Modified:
   trunk/src/flash/avrf.c
   trunk/src/target/avrt.c
Log:
Piotr Esden-Tempski <piotr at esden.net> Mac OS X compile fixes

Modified: trunk/src/flash/avrf.c
===================================================================
--- trunk/src/flash/avrf.c	2009-05-03 03:35:01 UTC (rev 1593)
+++ trunk/src/flash/avrf.c	2009-05-03 15:10:16 UTC (rev 1594)
@@ -247,13 +247,13 @@
 
 static int avrf_erase(struct flash_bank_s *bank, int first, int last)
 {
-	LOG_INFO(__FUNCTION__);
+	LOG_INFO("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
 static int avrf_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
-	LOG_INFO(__FUNCTION__);
+	LOG_INFO("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
@@ -386,7 +386,7 @@
 
 static int avrf_protect_check(struct flash_bank_s *bank)
 {
-	LOG_INFO(__FUNCTION__);
+	LOG_INFO("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
@@ -495,6 +495,6 @@
 		command_print(cmd_ctx, "avr mass erase failed");
 	}
 	
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }

Modified: trunk/src/target/avrt.c
===================================================================
--- trunk/src/target/avrt.c	2009-05-03 03:35:01 UTC (rev 1593)
+++ trunk/src/target/avrt.c	2009-05-03 15:10:16 UTC (rev 1594)
@@ -119,7 +119,7 @@
 
 int avr_register_commands(struct command_context_s *cmd_ctx)
 {
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
@@ -135,19 +135,19 @@
 
 int avr_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
 int avr_quit(void)
 {
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
 int avr_arch_state(struct target_s *target)
 {
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
@@ -158,25 +158,25 @@
 		target->state = TARGET_HALTED;
 	}
 	
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
 int avr_halt(target_t *target)
 {
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
 int avr_resume(struct target_s *target, int current, u32 address, int handle_breakpoints, int debug_execution)
 {
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
 int avr_step(struct target_s *target, int current, u32 address, int handle_breakpoints)
 {
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
@@ -184,7 +184,7 @@
 {
 	target->state = TARGET_RESET;
 	
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
@@ -192,13 +192,13 @@
 {
 	target->state = TARGET_RUNNING;
 	
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 
 int avr_soft_reset_halt(struct target_s *target)
 {
-	LOG_DEBUG(__FUNCTION__);
+	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
 



From oharboe at mail.berlios.de  Sun May  3 17:11:19 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 3 May 2009 17:11:19 +0200
Subject: [Openocd-svn] r1595 - trunk/src/helper
Message-ID: <200905031511.n43FBJQw014008@sheep.berlios.de>

Author: oharboe
Date: 2009-05-03 17:11:17 +0200 (Sun, 03 May 2009)
New Revision: 1595

Modified:
   trunk/src/helper/jim.c
Log:
Piotr Esden-Tempski <piotr at esden.net> Mac OS X compile fixes

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-03 15:10:16 UTC (rev 1594)
+++ trunk/src/helper/jim.c	2009-05-03 15:11:17 UTC (rev 1595)
@@ -11984,7 +11984,7 @@
 
     if (argc == 1) {
 
-#ifndef HAVE_UNISTD_H
+#if ! HAVE_UNISTD_H || IS_DARWIN
         extern char **environ;
 #endif
 



From zwelch at mail.berlios.de  Sun May  3 17:21:44 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 3 May 2009 17:21:44 +0200
Subject: [Openocd-svn] r1596 - trunk/src/helper
Message-ID: <200905031521.n43FLise015166@sheep.berlios.de>

Author: zwelch
Date: 2009-05-03 17:21:40 +0200 (Sun, 03 May 2009)
New Revision: 1596

Modified:
   trunk/src/helper/jim.c
Log:
Fix compilation when HAVE_UNISTD_H is not defined.

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-03 15:11:17 UTC (rev 1595)
+++ trunk/src/helper/jim.c	2009-05-03 15:21:40 UTC (rev 1596)
@@ -11984,7 +11984,7 @@
 
     if (argc == 1) {
 
-#if ! HAVE_UNISTD_H || IS_DARWIN
+#if !defined(HAVE_UNISTD_H) || IS_DARWIN
         extern char **environ;
 #endif
 



From oharboe at mail.berlios.de  Sun May  3 22:21:33 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 3 May 2009 22:21:33 +0200
Subject: [Openocd-svn] r1597 - trunk/src/helper
Message-ID: <200905032021.n43KLXO1024633@sheep.berlios.de>

Author: oharboe
Date: 2009-05-03 22:21:32 +0200 (Sun, 03 May 2009)
New Revision: 1597

Modified:
   trunk/src/helper/jim.c
Log:
Backed out change to solve Mac OS compilation problems.

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-03 15:21:40 UTC (rev 1596)
+++ trunk/src/helper/jim.c	2009-05-03 20:21:32 UTC (rev 1597)
@@ -11984,7 +11984,7 @@
 
     if (argc == 1) {
 
-#if !defined(HAVE_UNISTD_H) || IS_DARWIN
+#ifndef HAVE_UNISTD_H
         extern char **environ;
 #endif
 



From oharboe at mail.berlios.de  Sun May  3 22:48:20 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 3 May 2009 22:48:20 +0200
Subject: [Openocd-svn] r1598 - trunk/src
Message-ID: <200905032048.n43KmKOe026464@sheep.berlios.de>

Author: oharboe
Date: 2009-05-03 22:48:20 +0200 (Sun, 03 May 2009)
New Revision: 1598

Modified:
   trunk/src/openocd.c
Log:
fix embedded builds

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-05-03 20:21:32 UTC (rev 1597)
+++ trunk/src/openocd.c	2009-05-03 20:48:20 UTC (rev 1598)
@@ -187,7 +187,8 @@
 
 command_context_t *global_cmd_ctx;
 
-static command_context_t *setup_command_handler(void)
+/* NB! this fn can be invoked outside this file for non PC hosted builds */
+command_context_t *setup_command_handler(void)
 {
 	command_context_t *cmd_ctx;
 
@@ -229,7 +230,7 @@
 void httpd_stop(void);
 
 
-#if !BUILD_HTTPD
+#if !BUILD_HTTPD && !BUILD_ECOSBOARD
 /* implementations of OpenOCD that uses multithreading needs to know when
  * OpenOCD is sleeping. No-op in vanilla OpenOCD
  */



From kc8apf at mail.berlios.de  Mon May  4 08:22:55 2009
From: kc8apf at mail.berlios.de (kc8apf at mail.berlios.de)
Date: Mon, 4 May 2009 08:22:55 +0200
Subject: [Openocd-svn] r1599 - trunk/src/helper
Message-ID: <200905040622.n446MtZN028613@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-04 08:22:49 +0200 (Mon, 04 May 2009)
New Revision: 1599

Modified:
   trunk/src/helper/jim.c
Log:
Fix environ declaration for non-glibc systems

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-03 20:48:20 UTC (rev 1598)
+++ trunk/src/helper/jim.c	2009-05-04 06:22:49 UTC (rev 1599)
@@ -11984,7 +11984,7 @@
 
     if (argc == 1) {
 
-#ifndef HAVE_UNISTD_H
+#if !defined(HAVE_UNISTD_H) || !defined(__GNU_LIBRARY__)
         extern char **environ;
 #endif
 



From oharboe at mail.berlios.de  Mon May  4 13:03:41 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 4 May 2009 13:03:41 +0200
Subject: [Openocd-svn] r1600 - trunk/src/helper
Message-ID: <200905041103.n44B3f2n015223@sheep.berlios.de>

Author: oharboe
Date: 2009-05-04 13:03:40 +0200 (Mon, 04 May 2009)
New Revision: 1600

Modified:
   trunk/src/helper/command.c
Log:
Mariano Alvira <mar at devl.org> fixes warning as error about a signed vs. unsigned comparison by casting the local unsigned variable as (long long).

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2009-05-04 06:22:49 UTC (rev 1599)
+++ trunk/src/helper/command.c	2009-05-04 11:03:40 UTC (rev 1600)
@@ -783,7 +783,7 @@
 	} else
 	{
 		long long then=timeval_ms();
-		while ((timeval_ms()-then)<duration)
+		while ((timeval_ms()-then)<(long long)duration)
 		{
 			target_call_timer_callbacks_now();
 			usleep(1000);



From oharboe at mail.berlios.de  Mon May  4 13:06:30 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 4 May 2009 13:06:30 +0200
Subject: [Openocd-svn] r1601 - trunk/src/target
Message-ID: <200905041106.n44B6Uxc016064@sheep.berlios.de>

Author: oharboe
Date: 2009-05-04 13:06:21 +0200 (Mon, 04 May 2009)
New Revision: 1601

Modified:
   trunk/src/target/etb.c
   trunk/src/target/etm.c
   trunk/src/target/xscale.c
Log:
Mariano Alvira <mar at devl.org> fixes warnings

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-04 11:03:40 UTC (rev 1600)
+++ trunk/src/target/etb.c	2009-05-04 11:06:21 UTC (rev 1601)
@@ -448,7 +448,7 @@
 		arm7_9->etm_ctx->capture_driver_priv = etb;
 
 		etb->tap  = tap;
-		etb->cur_scan_chain = ~0UL;
+		etb->cur_scan_chain = 0xffffffff;
 		etb->reg_cache = NULL;
 		etb->ram_width = 0;
 		etb->ram_depth = 0;

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-04 11:03:40 UTC (rev 1600)
+++ trunk/src/target/etm.c	2009-05-04 11:06:21 UTC (rev 1601)
@@ -992,9 +992,9 @@
 		if ((pipestat == STAT_IE) || (pipestat == STAT_ID))
 		{
 			if (((instruction.type == ARM_B) ||
-				(instruction.type == ARM_BL) ||
-				(instruction.type == ARM_BLX)) &&
-				(instruction.info.b_bl_bx_blx.target_address != ~0UL))
+			     (instruction.type == ARM_BL) ||
+			     (instruction.type == ARM_BLX)) &&	 
+			    (instruction.info.b_bl_bx_blx.target_address != 0xffffffff))
 			{
 				next_pc = instruction.info.b_bl_bx_blx.target_address;
 			}

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-04 11:03:40 UTC (rev 1600)
+++ trunk/src/target/xscale.c	2009-05-04 11:06:21 UTC (rev 1601)
@@ -2933,7 +2933,7 @@
 						(((instruction.type == ARM_B) ||
 							(instruction.type == ARM_BL) ||
 							(instruction.type == ARM_BLX)) &&
-							(instruction.info.b_bl_bx_blx.target_address != ~0UL)))
+							(instruction.info.b_bl_bx_blx.target_address != 0xffffffff)))
 					{
 						xscale->trace.current_pc = instruction.info.b_bl_bx_blx.target_address;
 					}



From oharboe at mail.berlios.de  Mon May  4 20:44:17 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 4 May 2009 20:44:17 +0200
Subject: [Openocd-svn] r1602 - trunk/src/target
Message-ID: <200905041844.n44IiHND013629@sheep.berlios.de>

Author: oharboe
Date: 2009-05-04 20:44:12 +0200 (Mon, 04 May 2009)
New Revision: 1602

Added:
   trunk/src/target/cortex_a8.c
   trunk/src/target/cortex_a8.h
Modified:
   trunk/src/target/Makefile.am
   trunk/src/target/target.c
Log:
Dirk Behme <dirk.behme at googlemail.com> Add minimalist Cortex A8 file

Modified: trunk/src/target/Makefile.am
===================================================================
--- trunk/src/target/Makefile.am	2009-05-04 11:06:21 UTC (rev 1601)
+++ trunk/src/target/Makefile.am	2009-05-04 18:44:12 UTC (rev 1602)
@@ -14,12 +14,12 @@
 noinst_LIBRARIES = libtarget.a
 libtarget_a_SOURCES = target.c register.c breakpoints.c armv4_5.c embeddedice.c etm.c arm7tdmi.c arm9tdmi.c \
 	arm_jtag.c arm7_9_common.c algorithm.c arm920t.c arm720t.c armv4_5_mmu.c armv4_5_cache.c arm_disassembler.c \
-	arm966e.c arm926ejs.c feroceon.c etb.c xscale.c arm_simulator.c image.c armv7m.c cortex_m3.c arm_adi_v5.c \
+	arm966e.c arm926ejs.c feroceon.c etb.c xscale.c arm_simulator.c image.c armv7m.c cortex_m3.c cortex_a8.c arm_adi_v5.c \
 	etm_dummy.c $(OOCD_TRACE_FILES) target_request.c trace.c arm11.c arm11_dbgtap.c mips32.c mips_m4k.c \
 	mips32_pracc.c mips32_dmaacc.c mips_ejtag.c avrt.c
 noinst_HEADERS = target.h trace.h register.h armv4_5.h embeddedice.h etm.h arm7tdmi.h arm9tdmi.h \
 	arm_jtag.h arm7_9_common.h arm920t.h arm720t.h armv4_5_mmu.h armv4_5_cache.h breakpoints.h algorithm.h \
-	arm_disassembler.h arm966e.h arm926ejs.h etb.h xscale.h arm_simulator.h image.h armv7m.h cortex_m3.h arm_adi_v5.h \
+	arm_disassembler.h arm966e.h arm926ejs.h etb.h xscale.h arm_simulator.h image.h armv7m.h cortex_m3.h cortex_a8.h arm_adi_v5.h \
 	etm_dummy.h oocd_trace.h target_request.h trace.h arm11.h mips32.h mips_m4k.h mips_ejtag.h mips32_pracc.h mips32_dmaacc.h avrt.h
 
 nobase_dist_pkglib_DATA =

Added: trunk/src/target/cortex_a8.c
===================================================================
--- trunk/src/target/cortex_a8.c	2009-05-04 11:06:21 UTC (rev 1601)
+++ trunk/src/target/cortex_a8.c	2009-05-04 18:44:12 UTC (rev 1602)
@@ -0,0 +1,273 @@
+/***************************************************************************
+ *   Copyright (C) 2005 by Dominic Rath                                    *
+ *   Dominic.Rath at gmx.de                                                   *
+ *                                                                         *
+ *   Copyright (C) 2006 by Magnus Lundin                                   *
+ *   lundin at mlu.mine.nu                                                    *
+ *                                                                         *
+ *   Copyright (C) 2008 by Spencer Oliver                                  *
+ *   spen at spen-soft.co.uk                                                  *
+ *                                                                         *
+ *   Copyright (C) 2009 by Dirk Behme                                      *
+ *   dirk.behme at gmail.com - copy from cortex_m3                            *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ *                                                                         *
+ *   Cortex-A8(tm) TRM, ARM DDI 0344H                                      *
+ *                                                                         *
+ ***************************************************************************/
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "replacements.h"
+
+#include "cortex_a8.h"
+#include "armv7m.h"
+
+#include "register.h"
+#include "target.h"
+#include "target_request.h"
+#include "log.h"
+#include "jtag.h"
+#include "arm_jtag.h"
+
+#include <stdlib.h>
+#include <string.h>
+
+/* cli handling */
+int cortex_a8_register_commands(struct command_context_s *cmd_ctx);
+
+/* forward declarations */
+int cortex_a8_target_create(struct target_s *target, Jim_Interp *interp);
+
+target_type_t cortexa8_target =
+{
+	.name = "cortex_a8",
+
+	.poll = NULL,
+	.arch_state = armv7m_arch_state,
+
+	.target_request_data = NULL,
+
+	.halt = NULL,
+	.resume = NULL,
+	.step = NULL,
+
+	.assert_reset = NULL,
+	.deassert_reset = NULL,
+	.soft_reset_halt = NULL,
+
+	.get_gdb_reg_list = armv7m_get_gdb_reg_list,
+
+	.read_memory = cortex_a8_read_memory,
+	.write_memory = cortex_a8_write_memory,
+	.bulk_write_memory = NULL,
+	.checksum_memory = NULL,
+	.blank_check_memory = NULL,
+
+	.run_algorithm = armv7m_run_algorithm,
+
+	.add_breakpoint = NULL,
+	.remove_breakpoint = NULL,
+	.add_watchpoint = NULL,
+	.remove_watchpoint = NULL,
+
+	.register_commands = cortex_a8_register_commands,
+	.target_create = cortex_a8_target_create,
+	.init_target = NULL,
+	.examine = NULL,
+	.quit = NULL
+};
+
+int cortex_a8_dcc_read(swjdp_common_t *swjdp, u8 *value, u8 *ctrl)
+{
+	u16 dcrdr;
+
+	mem_ap_read_buf_u16( swjdp, (u8*)&dcrdr, 1, DCB_DCRDR);
+	*ctrl = (u8)dcrdr;
+	*value = (u8)(dcrdr >> 8);
+
+	LOG_DEBUG("data 0x%x ctrl 0x%x", *value, *ctrl);
+
+	/* write ack back to software dcc register
+	 * signify we have read data */
+	if (dcrdr & (1 << 0))
+	{
+		dcrdr = 0;
+		mem_ap_write_buf_u16( swjdp, (u8*)&dcrdr, 1, DCB_DCRDR);
+	}
+
+	return ERROR_OK;
+}
+
+int cortex_a8_read_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
+{
+	/* get pointers to arch-specific information */
+	armv7m_common_t *armv7m = target->arch_info;
+	swjdp_common_t *swjdp = &armv7m->swjdp_info;
+	int retval;
+
+	/* sanitize arguments */
+	if (((size != 4) && (size != 2) && (size != 1)) || (count == 0) || !(buffer))
+		return ERROR_INVALID_ARGUMENTS;
+
+	/* cortex_a8 handles unaligned memory access */
+
+	switch (size)
+	{
+		case 4:
+			retval = mem_ap_read_buf_u32(swjdp, buffer, 4 * count, address);
+			break;
+		case 2:
+			retval = mem_ap_read_buf_u16(swjdp, buffer, 2 * count, address);
+			break;
+		case 1:
+			retval = mem_ap_read_buf_u8(swjdp, buffer, count, address);
+			break;
+		default:
+			LOG_ERROR("BUG: we shouldn't get here");
+			exit(-1);
+	}
+
+	return retval;
+}
+
+int cortex_a8_write_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
+{
+	/* get pointers to arch-specific information */
+	armv7m_common_t *armv7m = target->arch_info;
+	swjdp_common_t *swjdp = &armv7m->swjdp_info;
+	int retval;
+
+	/* sanitize arguments */
+	if (((size != 4) && (size != 2) && (size != 1)) || (count == 0) || !(buffer))
+		return ERROR_INVALID_ARGUMENTS;
+
+	switch (size)
+	{
+		case 4:
+			retval = mem_ap_write_buf_u32(swjdp, buffer, 4 * count, address);
+			break;
+		case 2:
+			retval = mem_ap_write_buf_u16(swjdp, buffer, 2 * count, address);
+			break;
+		case 1:
+			retval = mem_ap_write_buf_u8(swjdp, buffer, count, address);
+			break;
+		default:
+			LOG_ERROR("BUG: we shouldn't get here");
+			exit(-1);
+	}
+
+	return retval;
+}
+
+int cortex_a8_handle_target_request(void *priv)
+{
+	target_t *target = priv;
+	if (!target->type->examined)
+		return ERROR_OK;
+	armv7m_common_t *armv7m = target->arch_info;
+	swjdp_common_t *swjdp = &armv7m->swjdp_info;
+
+	if (!target->dbg_msg_enabled)
+		return ERROR_OK;
+
+	if (target->state == TARGET_RUNNING)
+	{
+		u8 data;
+		u8 ctrl;
+
+		cortex_a8_dcc_read(swjdp, &data, &ctrl);
+
+		/* check if we have data */
+		if (ctrl & (1 << 0))
+		{
+			u32 request;
+
+			/* we assume target is quick enough */
+			request = data;
+			cortex_a8_dcc_read(swjdp, &data, &ctrl);
+			request |= (data << 8);
+			cortex_a8_dcc_read(swjdp, &data, &ctrl);
+			request |= (data << 16);
+			cortex_a8_dcc_read(swjdp, &data, &ctrl);
+			request |= (data << 24);
+			target_request(target, request);
+		}
+	}
+
+	return ERROR_OK;
+}
+
+int cortex_a8_init_arch_info(target_t *target, cortex_a8_common_t *cortex_a8, jtag_tap_t *tap)
+{
+	armv7m_common_t *armv7m;
+	armv7m = &cortex_a8->armv7m;
+
+	/* prepare JTAG information for the new target */
+	cortex_a8->jtag_info.tap = tap;
+	cortex_a8->jtag_info.scann_size = 4;
+
+	armv7m->swjdp_info.dp_select_value = -1;
+	armv7m->swjdp_info.ap_csw_value = -1;
+	armv7m->swjdp_info.ap_tar_value = -1;
+	armv7m->swjdp_info.jtag_info = &cortex_a8->jtag_info;
+
+	/* initialize arch-specific breakpoint handling */
+
+	cortex_a8->common_magic = CORTEX_A8_COMMON_MAGIC;
+	cortex_a8->arch_info = NULL;
+
+	/* register arch-specific functions */
+	armv7m->examine_debug_reason = NULL;
+
+	armv7m->pre_debug_entry = NULL;
+	armv7m->post_debug_entry = NULL;
+
+	armv7m->pre_restore_context = NULL;
+	armv7m->post_restore_context = NULL;
+
+	armv7m_init_arch_info(target, armv7m);
+	armv7m->arch_info = cortex_a8;
+	armv7m->load_core_reg_u32 = NULL;
+	armv7m->store_core_reg_u32 = NULL;
+
+	target_register_timer_callback(cortex_a8_handle_target_request, 1, 1, target);
+
+	return ERROR_OK;
+}
+
+int cortex_a8_target_create(struct target_s *target, Jim_Interp *interp)
+{
+	cortex_a8_common_t *cortex_a8 = calloc(1,sizeof(cortex_a8_common_t));
+
+	cortex_a8_init_arch_info(target, cortex_a8, target->tap);
+
+	return ERROR_OK;
+}
+
+int cortex_a8_register_commands(struct command_context_s *cmd_ctx)
+{
+	int retval;
+
+	retval = armv7m_register_commands(cmd_ctx);
+
+	register_command(cmd_ctx, NULL, "cortex_a8", NULL, COMMAND_ANY, "cortex_a8 specific commands");
+
+	return retval;
+}


Property changes on: trunk/src/target/cortex_a8.c
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/target/cortex_a8.h
===================================================================
--- trunk/src/target/cortex_a8.h	2009-05-04 11:06:21 UTC (rev 1601)
+++ trunk/src/target/cortex_a8.h	2009-05-04 18:44:12 UTC (rev 1602)
@@ -0,0 +1,99 @@
+/***************************************************************************
+ *   Copyright (C) 2005 by Dominic Rath                                    *
+ *   Dominic.Rath at gmx.de                                                   *
+ *                                                                         *
+ *   Copyright (C) 2006 by Magnus Lundin                                   *
+ *   lundin at mlu.mine.nu                                                    *
+ *                                                                         *
+ *   Copyright (C) 2008 by Spencer Oliver                                  *
+ *   spen at spen-soft.co.uk                                                  *
+ *                                                                         *
+ *   Copyright (C) 2009 by Dirk Behme                                      *
+ *   dirk.behme at gmail.com - copy from cortex_m3                            *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+#ifndef CORTEX_A8_H
+#define CORTEX_A8_H
+
+#include "register.h"
+#include "target.h"
+#include "armv7m.h"
+
+extern char* cortex_a8_state_strings[];
+
+#define CORTEX_A8_COMMON_MAGIC 0x411fc082
+
+#define CPUID		0x54011D00
+/* Debug Control Block */
+#define DCB_DHCSR	0x54011DF0
+#define DCB_DCRSR	0x54011DF4
+#define DCB_DCRDR	0x54011DF8
+#define DCB_DEMCR	0x54011DFC
+
+typedef struct  cortex_a8_fp_comparator_s
+{
+	int used;
+	int type;
+	u32 fpcr_value;
+	u32 fpcr_address;
+} cortex_a8_fp_comparator_t;
+
+typedef struct  cortex_a8_dwt_comparator_s
+{
+	int used;
+	u32 comp;
+	u32 mask;
+	u32 function;
+	u32 dwt_comparator_address;
+} cortex_a8_dwt_comparator_t;
+
+typedef struct cortex_a8_common_s
+{
+	int common_magic;
+	arm_jtag_t jtag_info;
+
+	/* Context information */
+	u32 dcb_dhcsr;
+	u32 nvic_dfsr;  /* Debug Fault Status Register - shows reason for debug halt */
+	u32 nvic_icsr;  /* Interrupt Control State Register - shows active and pending IRQ */
+
+	/* Flash Patch and Breakpoint (FPB) */
+	int fp_num_lit;
+	int fp_num_code;
+	int fp_code_available;
+	int fpb_enabled;
+	int auto_bp_type;
+	cortex_a8_fp_comparator_t *fp_comparator_list;
+
+	/* Data Watchpoint and Trace (DWT) */
+	int dwt_num_comp;
+	int dwt_comp_available;
+	cortex_a8_dwt_comparator_t *dwt_comparator_list;
+
+	/* Interrupts */
+	int intlinesnum;
+	u32 *intsetenable;
+
+	armv7m_common_t armv7m;
+	void *arch_info;
+} cortex_a8_common_t;
+
+extern int cortex_a8_init_arch_info(target_t *target, cortex_a8_common_t *cortex_a8, jtag_tap_t *tap);
+int cortex_a8_read_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
+int cortex_a8_write_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
+
+#endif /* CORTEX_A8_H */


Property changes on: trunk/src/target/cortex_a8.h
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-04 11:06:21 UTC (rev 1601)
+++ trunk/src/target/target.c	2009-05-04 18:44:12 UTC (rev 1602)
@@ -101,6 +101,7 @@
 extern target_type_t feroceon_target;
 extern target_type_t xscale_target;
 extern target_type_t cortexm3_target;
+extern target_type_t cortexa8_target;
 extern target_type_t arm11_target;
 extern target_type_t mips_m4k_target;
 extern target_type_t avr_target;
@@ -116,6 +117,7 @@
 	&feroceon_target,
 	&xscale_target,
 	&cortexm3_target,
+	&cortexa8_target,
 	&arm11_target,
 	&mips_m4k_target,
 	&avr_target,



From oharboe at mail.berlios.de  Tue May  5 07:55:15 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 5 May 2009 07:55:15 +0200
Subject: [Openocd-svn] r1603 - trunk/src/target
Message-ID: <200905050555.n455tFlR010246@sheep.berlios.de>

Author: oharboe
Date: 2009-05-05 07:55:14 +0200 (Tue, 05 May 2009)
New Revision: 1603

Modified:
   trunk/src/target/mips32.h
Log:
Oleksandr Tymoshenko <gonzo at bluezbox.com> "resume" command fix for EJTAG

Modified: trunk/src/target/mips32.h
===================================================================
--- trunk/src/target/mips32.h	2009-05-04 18:44:12 UTC (rev 1602)
+++ trunk/src/target/mips32.h	2009-05-05 05:55:14 UTC (rev 1603)
@@ -112,8 +112,8 @@
 #define MIPS32_LW(reg, off, base)	MIPS32_I_INST(MIPS32_OP_LW, base, reg, off)
 #define MIPS32_MFLO(reg)			MIPS32_R_INST(0, 0, 0, reg, 0, MIPS32_OP_MFLO)
 #define MIPS32_MFHI(reg)			MIPS32_R_INST(0, 0, 0, reg, 0, MIPS32_OP_MFHI)
-#define MIPS32_MTLO(reg)			MIPS32_R_INST(0, 0, 0, reg, 0, MIPS32_OP_MTLO)
-#define MIPS32_MTHI(reg)			MIPS32_R_INST(0, 0, 0, reg, 0, MIPS32_OP_MTHI)
+#define MIPS32_MTLO(reg)			MIPS32_R_INST(0, reg, 0, 0, 0, MIPS32_OP_MTLO)
+#define MIPS32_MTHI(reg)			MIPS32_R_INST(0, reg, 0, 0, 0, MIPS32_OP_MTHI)
 #define MIPS32_ORI(src, tar, val)	MIPS32_I_INST(MIPS32_OP_ORI, src, tar, val)
 #define MIPS32_SB(reg, off, base)	MIPS32_I_INST(MIPS32_OP_SB, base, reg, off)
 #define MIPS32_SH(reg, off, base)	MIPS32_I_INST(MIPS32_OP_SH, base, reg, off)



From oharboe at mail.berlios.de  Tue May  5 08:49:56 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 5 May 2009 08:49:56 +0200
Subject: [Openocd-svn] r1604 - trunk/src/target
Message-ID: <200905050649.n456nuaj020989@sheep.berlios.de>

Author: oharboe
Date: 2009-05-05 08:49:55 +0200 (Tue, 05 May 2009)
New Revision: 1604

Modified:
   trunk/src/target/mips32.h
Log:
Gabor Juhos juhosg at openwrt.org  MIPS: fix a shift value in the MIPS32_R_INST macro

Modified: trunk/src/target/mips32.h
===================================================================
--- trunk/src/target/mips32.h	2009-05-05 05:55:14 UTC (rev 1603)
+++ trunk/src/target/mips32.h	2009-05-05 06:49:55 UTC (rev 1604)
@@ -94,7 +94,7 @@
 #define MIPS32_COP0_MF	0x00
 #define MIPS32_COP0_MT	0x04
 
-#define MIPS32_R_INST(opcode, rs, rt, rd, shamt, funct)	(((opcode)<<26) |((rs)<<21)|((rt)<<16)|((rd)<<11)| ((shamt)<<5) | (funct))
+#define MIPS32_R_INST(opcode, rs, rt, rd, shamt, funct)	(((opcode)<<26) |((rs)<<21)|((rt)<<16)|((rd)<<11)| ((shamt)<<6) | (funct))
 #define MIPS32_I_INST(opcode, rs, rt, immd)	(((opcode)<<26) |((rs)<<21)|((rt)<<16)|(immd))
 #define MIPS32_J_INST(opcode, addr)	(((opcode)<<26) |(addr))
 



From oharboe at mail.berlios.de  Tue May  5 14:06:26 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 5 May 2009 14:06:26 +0200
Subject: [Openocd-svn] r1605 - trunk/src/helper
Message-ID: <200905051206.n45C6Qh7030785@sheep.berlios.de>

Author: oharboe
Date: 2009-05-05 14:06:26 +0200 (Tue, 05 May 2009)
New Revision: 1605

Modified:
   trunk/src/helper/command.c
Log:
remove extra newline before prompt

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2009-05-05 06:49:55 UTC (rev 1604)
+++ trunk/src/helper/command.c	2009-05-05 12:06:26 UTC (rev 1605)
@@ -479,19 +479,22 @@
 		int reslen;
 
 		result = Jim_GetString(Jim_GetResult(interp), &reslen);
-		int i;
-		char buff[256+1];
-		for (i = 0; i < reslen; i += 256)
+		if (reslen>0)
 		{
-			int chunk;
-			chunk = reslen - i;
-			if (chunk > 256)
-				chunk = 256;
-			strncpy(buff, result+i, chunk);
-			buff[chunk] = 0;
-			LOG_USER_N("%s", buff);
+			int i;
+			char buff[256+1];
+			for (i = 0; i < reslen; i += 256)
+			{
+				int chunk;
+				chunk = reslen - i;
+				if (chunk > 256)
+					chunk = 256;
+				strncpy(buff, result+i, chunk);
+				buff[chunk] = 0;
+				LOG_USER_N("%s", buff);
+			}
+			LOG_USER_N("%s", "\n");
 		}
-		LOG_USER_N("%s", "\n");
 		retval=ERROR_OK;
 	}
 	return retval;
@@ -691,7 +694,7 @@
 #if defined( _MSC_VER )
 	/* WinXX - is generic, the forward
 	 * looking problem is this:
-	 * 
+	 *
 	 *   "win32" or "win64"
 	 *
 	 * "winxx" is generic.



From oharboe at mail.berlios.de  Tue May  5 14:07:04 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 5 May 2009 14:07:04 +0200
Subject: [Openocd-svn] r1606 - trunk/src/helper
Message-ID: <200905051207.n45C74dI030919@sheep.berlios.de>

Author: oharboe
Date: 2009-05-05 14:07:02 +0200 (Tue, 05 May 2009)
New Revision: 1606

Modified:
   trunk/src/helper/log.c
Log:
made warning about keep_alive() not being invoked more helpful

Modified: trunk/src/helper/log.c
===================================================================
--- trunk/src/helper/log.c	2009-05-05 12:06:26 UTC (rev 1605)
+++ trunk/src/helper/log.c	2009-05-05 12:07:02 UTC (rev 1606)
@@ -389,7 +389,7 @@
 	current_time=timeval_ms();
 	if (current_time-last_time>1000)
 	{
-		LOG_WARNING("BUG: keep_alive() was not invoked in the 1000ms timelimit. GDB alive packet not sent! (%lld)", current_time-last_time);
+		LOG_WARNING("keep_alive() was not invoked in the 1000ms timelimit. GDB alive packet not sent! (%lld). Workaround: increase \"set remotetimeout\" in GDB", current_time-last_time);
 	}
 	if (current_time-last_time>500)
 	{



From oharboe at mail.berlios.de  Tue May  5 21:30:24 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 5 May 2009 21:30:24 +0200
Subject: [Openocd-svn] r1607 - in trunk/src: pld target
Message-ID: <200905051930.n45JUO6c021136@sheep.berlios.de>

Author: oharboe
Date: 2009-05-05 21:30:13 +0200 (Tue, 05 May 2009)
New Revision: 1607

Modified:
   trunk/src/pld/virtex2.c
   trunk/src/target/arm11_dbgtap.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/arm_adi_v5.c
   trunk/src/target/embeddedice.c
   trunk/src/target/etb.c
   trunk/src/target/xscale.c
Log:
mark usage of in_handler that can be converted into user code

Modified: trunk/src/pld/virtex2.c
===================================================================
--- trunk/src/pld/virtex2.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/pld/virtex2.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -121,7 +121,7 @@
 	scan_field.in_value = NULL;
 	scan_field.in_check_value = NULL;
 	scan_field.in_check_mask = NULL;
-	scan_field.in_handler = virtex2_jtag_buf_to_u32;
+	scan_field.in_handler = virtex2_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 
 	virtex2_set_instr(virtex2_info->tap, 0x4); /* CFG_OUT */
 

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/arm11_dbgtap.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -180,7 +180,7 @@
 
 	arm11_setup_field(arm11, 5, &chain, NULL, &field);
 
-	field.in_handler = arm11_in_handler_SCAN_N;
+	field.in_handler = arm11_in_handler_SCAN_N; /* deprecated! invoke this from user code! */
 
 	arm11_add_dr_scan_vc(1, &field, state == ARM11_TAP_DEFAULT ? TAP_DRPAUSE : state);
 }

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/arm720t.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -126,7 +126,7 @@
 	fields[1].in_value = NULL;
 	if (in)
 	{
-		fields[1].in_handler = arm_jtag_buf_to_u32_flip;
+		fields[1].in_handler = arm_jtag_buf_to_u32_flip; /* deprecated! invoke this from user code! */
 		fields[1].in_handler_priv = in;
 	} else
 	{

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/arm7tdmi.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -210,7 +210,7 @@
 	fields[1].out_value = NULL;
 	fields[1].out_mask = NULL;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = arm_jtag_buf_to_u32_flip;
+	fields[1].in_handler = arm_jtag_buf_to_u32_flip; /* deprecated! invoke this from user code! */
 	fields[1].in_handler_priv = in;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -274,13 +274,13 @@
 	switch (size)
 	{
 		case 4:
-			fields[1].in_handler = (be) ? arm_jtag_buf_to_be32_flip : arm_jtag_buf_to_le32_flip;
+			fields[1].in_handler = (be) ? arm_jtag_buf_to_be32_flip : arm_jtag_buf_to_le32_flip; /* deprecated! invoke this from user code! */
 			break;
 		case 2:
-			fields[1].in_handler = (be) ? arm_jtag_buf_to_be16_flip : arm_jtag_buf_to_le16_flip;
+			fields[1].in_handler = (be) ? arm_jtag_buf_to_be16_flip : arm_jtag_buf_to_le16_flip; /* deprecated! invoke this from user code! */
 			break;
 		case 1:
-			fields[1].in_handler = arm_jtag_buf_to_8_flip;
+			fields[1].in_handler = arm_jtag_buf_to_8_flip; /* deprecated! invoke this from user code! */
 			break;
 	}
 	fields[1].in_handler_priv = in;

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/arm920t.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -153,7 +153,7 @@
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 	fields[1].in_handler_priv = value;
-	fields[1].in_handler = arm_jtag_buf_to_u32;
+	fields[1].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/arm926ejs.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -177,7 +177,7 @@
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 	fields[0].in_handler_priv = value;
-	fields[0].in_handler = arm_jtag_buf_to_u32;
+	fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 
 	/*TODO: add timeout*/
 	do

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/arm966e.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -217,7 +217,7 @@
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_handler_priv = value;
-	fields[0].in_handler = arm_jtag_buf_to_u32;
+	fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/arm9tdmi.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -220,7 +220,7 @@
 	fields[0].in_value = NULL;
 	if (in)
 	{
-		fields[0].in_handler = arm_jtag_buf_to_u32;
+		fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 		fields[0].in_handler_priv = in;
 	}
 	else
@@ -293,7 +293,7 @@
 	fields[0].out_value = NULL;
 	fields[0].out_mask = NULL;
 	fields[0].in_value = NULL;
-	fields[0].in_handler = arm_jtag_buf_to_u32;
+	fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 	fields[0].in_handler_priv = in;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -368,13 +368,13 @@
 	switch (size)
 	{
 		case 4:
-			fields[0].in_handler = (be) ? arm_jtag_buf_to_be32 : arm_jtag_buf_to_le32;
+			fields[0].in_handler = (be) ? arm_jtag_buf_to_be32 : arm_jtag_buf_to_le32; /* deprecated! invoke this from user code! */
 			break;
 		case 2:
-			fields[0].in_handler = (be) ? arm_jtag_buf_to_be16 : arm_jtag_buf_to_le16;
+			fields[0].in_handler = (be) ? arm_jtag_buf_to_be16 : arm_jtag_buf_to_le16; /* deprecated! invoke this from user code! */
 			break;
 		case 1:
-			fields[0].in_handler = arm_jtag_buf_to_8;
+			fields[0].in_handler = arm_jtag_buf_to_8; /* deprecated! invoke this from user code! */
 			break;
 	}
 	fields[0].in_handler_priv = in;

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/arm_adi_v5.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -127,7 +127,7 @@
 	fields[1].in_value = NULL;
 	if (invalue)
 	{
-		fields[1].in_handler = arm_jtag_buf_to_u32;
+		fields[1].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 		fields[1].in_handler_priv = invalue;
 	}
 	else

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/embeddedice.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -352,7 +352,7 @@
 		if (size == 1)
 			buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_CTRL]);
 
-		fields[0].in_handler = arm_jtag_buf_to_u32;
+		fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 		fields[0].in_handler_priv = data;
 		jtag_add_dr_scan(3, fields, TAP_INVALID);
 

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/etb.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -217,7 +217,7 @@
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	fields[0].in_handler = buf_to_u32_handler;
+	fields[0].in_handler = buf_to_u32_handler; /* deprecated! invoke this from user code! */
 
 	for (i = 0; i < num_frames; i++)
 	{

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-05 12:07:02 UTC (rev 1606)
+++ trunk/src/target/xscale.c	2009-05-05 19:30:13 UTC (rev 1607)
@@ -373,8 +373,8 @@
 		for (i = words_done; i < num_words; i++)
 		{
 			fields[0].in_value = &field0[i];
-			fields[1].in_handler = buf_to_u32_handler;
-			fields[1].in_handler_priv = (u8*)&field1[i];
+			fields[1].in_handler = buf_to_u32_handler; /* deprecated! invoke this from user code! */
+			fields[1].in_handler_priv = (u8*)&field1[i]; 
 
 			jtag_add_pathmove(3, path);
 			jtag_add_dr_scan(3, fields, TAP_IDLE);



From oharboe at mail.berlios.de  Wed May  6 08:20:56 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 6 May 2009 08:20:56 +0200
Subject: [Openocd-svn] r1608 - in trunk: . src/flash src/helper src/jtag
	src/pld src/svf src/target src/xsvf
Message-ID: <200905060620.n466Kuer012942@sheep.berlios.de>

Author: oharboe
Date: 2009-05-06 08:20:52 +0200 (Wed, 06 May 2009)
New Revision: 1608

Modified:
   trunk/
   trunk/src/flash/str9xpec.c
   trunk/src/helper/tclapi.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/zy1000.c
   trunk/src/pld/virtex2.c
   trunk/src/svf/svf.c
   trunk/src/target/arm11_dbgtap.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/arm_adi_v5.c
   trunk/src/target/arm_jtag.c
   trunk/src/target/avrt.c
   trunk/src/target/embeddedice.c
   trunk/src/target/etb.c
   trunk/src/target/etm.c
   trunk/src/target/feroceon.c
   trunk/src/target/mips_ejtag.c
   trunk/src/target/xscale.c
   trunk/src/xsvf/xsvf.c
Log:
retire out_mask - not used anywhere


Property changes on: trunk
___________________________________________________________________
Name: svn:ignore
   - autom4te.cache
.project
aclocal.m4
config.guess
config.h.in
config.sub
configure
depcomp
install-sh
Makefile.in
missing

   + autom4te.cache
.project
aclocal.m4
config.guess
config.h.in
config.sub
configure
depcomp
install-sh
Makefile.in
missing
compile


Modified: trunk/src/flash/str9xpec.c
===================================================================
--- trunk/src/flash/str9xpec.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/flash/str9xpec.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -125,7 +125,7 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		field.out_mask = NULL;
+		
 		field.in_value = NULL;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;
@@ -151,7 +151,7 @@
 	field.tap = tap;
 	field.num_bits = 8;
 	field.out_value = NULL;
-	field.out_mask = NULL;
+	
 	field.in_value = &status;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -243,7 +243,7 @@
 	field.tap = tap;
 	field.num_bits = 64;
 	field.out_value = NULL;
-	field.out_mask = NULL;
+	
 	field.in_value = str9xpec_info->options;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -395,7 +395,7 @@
 	field.tap = tap;
 	field.num_bits = 64;
 	field.out_value = buffer;
-	field.out_mask = NULL;
+	
 	field.in_value = NULL;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -409,7 +409,7 @@
 	field.tap = tap;
 	field.num_bits = 64;
 	field.out_value = NULL;
-	field.out_mask = NULL;
+	
 	field.in_value = buffer;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -511,7 +511,7 @@
 	field.tap = tap;
 	field.num_bits = 64;
 	field.out_value = buffer;
-	field.out_mask = NULL;
+	
 	field.in_value = NULL;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -577,7 +577,7 @@
 		field.tap = tap;
 		field.num_bits = 8;
 		field.out_value = NULL;
-		field.out_mask = NULL;
+		
 		field.in_value = &status;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;
@@ -663,7 +663,7 @@
 	field.tap = tap;
 	field.num_bits = 8;
 	field.out_value = &sector;
-	field.out_mask = NULL;
+	
 	field.in_value = NULL;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -752,7 +752,7 @@
 			field.tap = tap;
 			field.num_bits = 64;
 			field.out_value = (buffer + bytes_written);
-			field.out_mask = NULL;
+			
 			field.in_value = NULL;
 			field.in_check_value = NULL;
 			field.in_check_mask = NULL;
@@ -770,7 +770,7 @@
 				field.tap = tap;
 				field.num_bits = 8;
 				field.out_value = NULL;
-				field.out_mask = NULL;
+				
 				field.in_value = scanbuf;
 				field.in_check_value = NULL;
 				field.in_check_mask = NULL;
@@ -812,7 +812,7 @@
 		field.tap = tap;
 		field.num_bits = 64;
 		field.out_value = last_dword;
-		field.out_mask = NULL;
+		
 		field.in_value = NULL;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;
@@ -830,7 +830,7 @@
 			field.tap = tap;
 			field.num_bits = 8;
 			field.out_value = NULL;
-			field.out_mask = NULL;
+			
 			field.in_value = scanbuf;
 			field.in_check_value = NULL;
 			field.in_check_mask = NULL;
@@ -894,7 +894,7 @@
 	field.tap = tap;
 	field.num_bits = 32;
 	field.out_value = NULL;
-	field.out_mask = NULL;
+	
 	field.in_value = buffer;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -1019,7 +1019,7 @@
 	field.tap = tap;
 	field.num_bits = 64;
 	field.out_value = str9xpec_info->options;
-	field.out_mask = NULL;
+	
 	field.in_value = NULL;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -1037,7 +1037,7 @@
 		field.tap = tap;
 		field.num_bits = 8;
 		field.out_value = NULL;
-		field.out_mask = NULL;
+		
 		field.in_value = &status;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;

Modified: trunk/src/helper/tclapi.c
===================================================================
--- trunk/src/helper/tclapi.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/helper/tclapi.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -447,7 +447,6 @@
 		fields[field_count].num_bits = bits;
 		fields[field_count].out_value = malloc(CEIL(bits, 8));
 		str_to_buf(str, len, fields[field_count].out_value, bits, 0);
-		fields[field_count].out_mask = NULL;
 		fields[field_count].in_value = fields[field_count].out_value;
 		fields[field_count].in_check_mask = NULL;
 		fields[field_count].in_check_value = NULL;

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/jtag/jtag.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -579,8 +579,7 @@
 			{
 				found = 1;
 				(*last_cmd)->cmd.scan->fields[nth_tap].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				(*last_cmd)->cmd.scan->fields[nth_tap].out_mask = buf_cpy(fields[j].out_mask, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-
+				
 				if (jtag_verify_capture_ir)
 				{
 					if (fields[j].in_handler==NULL)
@@ -604,7 +603,6 @@
 		{
 			/* if a tap isn't listed, set it to BYPASS */
 			(*last_cmd)->cmd.scan->fields[nth_tap].out_value = buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-			(*last_cmd)->cmd.scan->fields[nth_tap].out_mask = NULL;
 			tap->bypass = 1;
 		}
 
@@ -652,7 +650,6 @@
 		(*last_cmd)->cmd.scan->fields[i].tap = fields[i].tap;
 		(*last_cmd)->cmd.scan->fields[i].num_bits = num_bits;
 		(*last_cmd)->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		(*last_cmd)->cmd.scan->fields[i].out_mask = buf_cpy(fields[i].out_mask, cmd_queue_alloc(num_bytes), num_bits);
 		(*last_cmd)->cmd.scan->fields[i].in_value = fields[i].in_value;
 		(*last_cmd)->cmd.scan->fields[i].in_check_value = fields[i].in_check_value;
 		(*last_cmd)->cmd.scan->fields[i].in_check_mask = fields[i].in_check_mask;
@@ -729,7 +726,6 @@
 				scan_size = fields[j].num_bits;
 				(*last_cmd)->cmd.scan->fields[field_count].num_bits = scan_size;
 				(*last_cmd)->cmd.scan->fields[field_count].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				(*last_cmd)->cmd.scan->fields[field_count].out_mask = buf_cpy(fields[j].out_mask, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 				(*last_cmd)->cmd.scan->fields[field_count].in_value = fields[j].in_value;
 				(*last_cmd)->cmd.scan->fields[field_count].in_check_value = fields[j].in_check_value;
 				(*last_cmd)->cmd.scan->fields[field_count].in_check_mask = fields[j].in_check_mask;
@@ -750,7 +746,6 @@
 			/* program the scan field to 1 bit length, and ignore it's value */
 			(*last_cmd)->cmd.scan->fields[field_count].num_bits = 1;
 			(*last_cmd)->cmd.scan->fields[field_count].out_value = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].out_mask = NULL;
 			(*last_cmd)->cmd.scan->fields[field_count].in_value = NULL;
 			(*last_cmd)->cmd.scan->fields[field_count].in_check_value = NULL;
 			(*last_cmd)->cmd.scan->fields[field_count].in_check_mask = NULL;
@@ -840,7 +835,6 @@
 				buf_set_u32(out_value, 0, scan_size, value[j]);
 				(*last_cmd)->cmd.scan->fields[field_count].num_bits = scan_size;
 				(*last_cmd)->cmd.scan->fields[field_count].out_value = buf_cpy(out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				(*last_cmd)->cmd.scan->fields[field_count].out_mask = NULL;
 				(*last_cmd)->cmd.scan->fields[field_count].in_value = NULL;
 				(*last_cmd)->cmd.scan->fields[field_count].in_check_value = NULL;
 				(*last_cmd)->cmd.scan->fields[field_count].in_check_mask = NULL;
@@ -860,7 +854,6 @@
 			/* program the scan field to 1 bit length, and ignore it's value */
 			(*last_cmd)->cmd.scan->fields[field_count].num_bits = 1;
 			(*last_cmd)->cmd.scan->fields[field_count].out_value = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].out_mask = NULL;
 			(*last_cmd)->cmd.scan->fields[field_count].in_value = NULL;
 			(*last_cmd)->cmd.scan->fields[field_count].in_check_value = NULL;
 			(*last_cmd)->cmd.scan->fields[field_count].in_check_mask = NULL;
@@ -906,7 +899,6 @@
 		(*last_cmd)->cmd.scan->fields[i].tap = fields[i].tap;
 		(*last_cmd)->cmd.scan->fields[i].num_bits = num_bits;
 		(*last_cmd)->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		(*last_cmd)->cmd.scan->fields[i].out_mask = buf_cpy(fields[i].out_mask, cmd_queue_alloc(num_bytes), num_bits);
 		(*last_cmd)->cmd.scan->fields[i].in_value = fields[i].in_value;
 		(*last_cmd)->cmd.scan->fields[i].in_check_value = fields[i].in_check_value;
 		(*last_cmd)->cmd.scan->fields[i].in_check_mask = fields[i].in_check_mask;
@@ -1492,7 +1484,7 @@
 	field.tap = NULL;
 	field.num_bits = sizeof(idcode_buffer) * 8;
 	field.out_value = idcode_buffer;
-	field.out_mask = NULL;
+	
 	field.in_value = idcode_buffer;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -1670,7 +1662,7 @@
 	field.tap = NULL;
 	field.num_bits = total_ir_length;
 	field.out_value = ir_test;
-	field.out_mask = NULL;
+	
 	field.in_value = ir_test;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -2792,7 +2784,6 @@
 		fields[i].tap = tap;
 		fields[i].out_value = malloc(CEIL(field_size, 8));
 		buf_set_u32(fields[i].out_value, 0, field_size, strtoul(args[i*2+1], NULL, 0));
-		fields[i].out_mask = NULL;
 		fields[i].in_value = NULL;
 		fields[i].in_check_mask = NULL;
 		fields[i].in_handler = NULL;
@@ -2908,7 +2899,6 @@
 		fields[field_count].num_bits = bits;
 		fields[field_count].out_value = malloc(CEIL(bits, 8));
 		str_to_buf(str, len, fields[field_count].out_value, bits, 0);
-		fields[field_count].out_mask = NULL;
 		fields[field_count].in_value = fields[field_count].out_value;
 		fields[field_count].in_check_mask = NULL;
 		fields[field_count].in_check_value = NULL;

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/jtag/jtag.h	2009-05-06 06:20:52 UTC (rev 1608)
@@ -271,7 +271,6 @@
 	jtag_tap_t* tap;                /* tap pointer this instruction refers to */
 	int         num_bits;           /* number of bits this field specifies (up to 32) */
 	u8*         out_value;          /* value to be scanned into the device */
-	u8*         out_mask;           /* only masked bits care */
 	u8*         in_value;           /* pointer to a 32-bit memory location to take data scanned out */
 	/* in_check_value/mask, in_handler_error_handler, in_handler_priv can be used by the in handler, otherwise they contain garbage  */
 	u8*          in_check_value;    /* used to validate scan results */

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/jtag/zy1000.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -650,7 +650,6 @@
 			/* program the scan field to 1 bit length, and ignore it's value */
 			tmp.num_bits = 1;
 			tmp.out_value = NULL;
-			tmp.out_mask = NULL;
 			tmp.in_value = NULL;
 			tmp.in_check_value = NULL;
 			tmp.in_check_mask = NULL;

Modified: trunk/src/pld/virtex2.c
===================================================================
--- trunk/src/pld/virtex2.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/pld/virtex2.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -56,7 +56,7 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		field.out_mask = NULL;
+		
 		field.in_value = NULL;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;
@@ -83,7 +83,6 @@
 	scan_field.tap = virtex2_info->tap;
 	scan_field.num_bits = num_words * 32;
 	scan_field.out_value = values;
-	scan_field.out_mask = NULL;
 	scan_field.in_value = NULL;
 	scan_field.in_check_value = NULL;
 	scan_field.in_check_mask = NULL;
@@ -117,7 +116,6 @@
 	scan_field.tap = virtex2_info->tap;
 	scan_field.num_bits = 32;
 	scan_field.out_value = NULL;
-	scan_field.out_mask = NULL;
 	scan_field.in_value = NULL;
 	scan_field.in_check_value = NULL;
 	scan_field.in_check_mask = NULL;
@@ -166,7 +164,7 @@
 	scan_field_t field;
 
 	field.tap = virtex2_info->tap;
-	field.out_mask = NULL;
+	
 	field.in_value = NULL;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;

Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/svf/svf.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -975,7 +975,7 @@
 			field.tap = tap;
 			field.num_bits = i;
 			field.out_value = &svf_tdi_buffer[svf_buffer_index];
-			field.out_mask = NULL;
+			
 			field.in_value = &svf_tdi_buffer[svf_buffer_index];
 			field.in_check_value = NULL;
 			field.in_check_mask = NULL;
@@ -1076,7 +1076,7 @@
 			field.tap = tap;
 			field.num_bits = i;
 			field.out_value = &svf_tdi_buffer[svf_buffer_index];
-			field.out_mask = NULL;
+			
 			field.in_value = &svf_tdi_buffer[svf_buffer_index];
 			field.in_check_value = NULL;
 			field.in_check_mask = NULL;

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/arm11_dbgtap.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -87,7 +87,6 @@
 {
 	field->tap   			= arm11->jtag_info.tap;
 	field->num_bits			= num_bits;
-	field->out_mask			= NULL;
 	field->in_check_mask	= NULL;
 	field->in_check_value	= NULL;
 	field->in_handler		= NULL;

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/arm720t.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -112,7 +112,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &instruction_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -122,7 +122,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = out_buf;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	if (in)
 	{

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/arm7tdmi.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -111,7 +111,7 @@
 		fields[0].tap = arm7_9->jtag_info.tap;
 		fields[0].num_bits = 1;
 		fields[0].out_value = NULL;
-		fields[0].out_mask = NULL;
+		
 		fields[0].in_value = &breakpoint;
 		fields[0].in_check_value = NULL;
 		fields[0].in_check_mask = NULL;
@@ -121,7 +121,7 @@
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 32;
 		fields[1].out_value = NULL;
-		fields[1].out_mask = NULL;
+		
 		fields[1].in_value = databus;
 		fields[1].in_check_value = NULL;
 		fields[1].in_check_mask = NULL;
@@ -198,7 +198,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -208,7 +208,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = arm_jtag_buf_to_u32_flip; /* deprecated! invoke this from user code! */
 	fields[1].in_handler_priv = in;
@@ -259,7 +259,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -269,7 +269,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	switch (size)
 	{

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/arm920t.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -113,7 +113,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -123,7 +123,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -133,7 +133,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -143,7 +143,7 @@
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	fields[3].out_mask = NULL;
+	
 	fields[3].in_value = NULL;
 	fields[3].in_check_value = NULL;
 	fields[3].in_check_mask = NULL;
@@ -185,7 +185,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -195,7 +195,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = value_buf;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -205,7 +205,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -215,7 +215,7 @@
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	fields[3].out_mask = NULL;
+	
 	fields[3].in_value = NULL;
 	fields[3].in_check_value = NULL;
 	fields[3].in_check_mask = NULL;
@@ -252,7 +252,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -262,7 +262,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = cp15_opcode_buf;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -272,7 +272,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -282,7 +282,7 @@
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	fields[3].out_mask = NULL;
+	
 	fields[3].in_value = NULL;
 	fields[3].in_check_value = NULL;
 	fields[3].in_check_mask = NULL;

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/arm926ejs.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -137,7 +137,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -147,7 +147,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 1;
 	fields[1].out_value = &access;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = &access;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -157,7 +157,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -167,7 +167,7 @@
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	fields[3].out_mask = NULL;
+	
 	fields[3].in_value = NULL;
 	fields[3].in_check_value = NULL;
 	fields[3].in_check_mask = NULL;
@@ -227,7 +227,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = value_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -237,7 +237,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 1;
 	fields[1].out_value = &access;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = &access;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -247,7 +247,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -257,7 +257,7 @@
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	fields[3].out_mask = NULL;
+	
 	fields[3].in_value = NULL;
 	fields[3].in_check_value = NULL;
 	fields[3].in_check_mask = NULL;

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/arm966e.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -187,7 +187,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -197,7 +197,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 6;
 	fields[1].out_value = &reg_addr_buf;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -207,7 +207,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &nr_w_buf;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -255,7 +255,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = value_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -265,7 +265,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 6;
 	fields[1].out_value = &reg_addr_buf;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -275,7 +275,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &nr_w_buf;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/arm9tdmi.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -128,7 +128,7 @@
 		fields[0].tap = arm7_9->jtag_info.tap;
 		fields[0].num_bits = 32;
 		fields[0].out_value = NULL;
-		fields[0].out_mask = NULL;
+		
 		fields[0].in_value = databus;
 		fields[0].in_check_value = NULL;
 		fields[0].in_check_mask = NULL;
@@ -138,7 +138,7 @@
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 3;
 		fields[1].out_value = NULL;
-		fields[1].out_mask = NULL;
+		
 		fields[1].in_value = &debug_reason;
 		fields[1].in_check_value = NULL;
 		fields[1].in_check_mask = NULL;
@@ -148,7 +148,7 @@
 		fields[2].tap = arm7_9->jtag_info.tap;
 		fields[2].num_bits = 32;
 		fields[2].out_value = NULL;
-		fields[2].out_mask = NULL;
+		
 		fields[2].in_value = instructionbus;
 		fields[2].in_check_value = NULL;
 		fields[2].in_check_mask = NULL;
@@ -216,7 +216,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	if (in)
 	{
@@ -234,7 +234,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -244,7 +244,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -291,7 +291,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 	fields[0].in_handler_priv = in;
@@ -301,7 +301,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
@@ -311,7 +311,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -363,7 +363,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	switch (size)
 	{
@@ -384,7 +384,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
@@ -394,7 +394,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/arm_adi_v5.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -76,7 +76,7 @@
 	fields[0].num_bits = 3;
 	buf_set_u32(&out_addr_buf, 0, 3, ((reg_addr >> 1) & 0x6) | (RnW & 0x1));
 	fields[0].out_value = &out_addr_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = ack;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -86,7 +86,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = outvalue;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = invalue;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
@@ -112,7 +112,7 @@
 	fields[0].num_bits = 3;
 	buf_set_u32(&out_addr_buf, 0, 3, ((reg_addr >> 1) & 0x6) | (RnW & 0x1));
 	fields[0].out_value = &out_addr_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = ack;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -123,7 +123,7 @@
 	fields[1].num_bits = 32;
 	buf_set_u32(out_value_buf, 0, 32, outvalue);
 	fields[1].out_value = out_value_buf;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	if (invalue)
 	{

Modified: trunk/src/target/arm_jtag.c
===================================================================
--- trunk/src/target/arm_jtag.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/arm_jtag.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -52,7 +52,7 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = t;
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		field.out_mask = NULL;
+		
 		field.in_value = NULL;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;

Modified: trunk/src/target/avrt.c
===================================================================
--- trunk/src/target/avrt.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/avrt.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -232,7 +232,6 @@
 		field[0].tap = tap;
 		field[0].num_bits = tap->ir_length;
 		field[0].out_value = ir_out;
-		field[0].out_mask = NULL;
 		field[0].in_value = ir_in;
 		field[0].in_check_value = NULL;
 		field[0].in_check_mask = NULL;
@@ -258,7 +257,6 @@
 		field[0].tap = tap;
 		field[0].num_bits = dr_len;
 		field[0].out_value = dr_out;
-		field[0].out_mask = NULL;
 		field[0].in_value = dr_in;
 		field[0].in_check_value = NULL;
 		field[0].in_check_mask = NULL;

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/embeddedice.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -251,7 +251,7 @@
 	fields[0].tap = ice_reg->jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -262,7 +262,7 @@
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, reg_addr);
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -273,7 +273,7 @@
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -313,7 +313,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -324,7 +324,7 @@
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_DATA]);
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -335,7 +335,7 @@
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -430,7 +430,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = field0_out;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -441,7 +441,7 @@
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_DATA]);
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -452,7 +452,7 @@
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -499,7 +499,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = field0_in;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -510,7 +510,7 @@
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_CTRL]);
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -521,7 +521,7 @@
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/etb.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -70,7 +70,7 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		field.out_mask = NULL;
+		
 		field.in_value = NULL;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;
@@ -95,7 +95,7 @@
 		field.num_bits = 5;
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_scan_chain);
-		field.out_mask = NULL;
+		
 		field.in_value = NULL;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;
@@ -186,7 +186,7 @@
 	fields[0].tap = etb->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -197,7 +197,7 @@
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, 4);
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -208,7 +208,7 @@
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -257,7 +257,7 @@
 	fields[0].tap = etb_reg->etb->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -268,7 +268,7 @@
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -279,7 +279,7 @@
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -354,7 +354,7 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = malloc(4);
 	buf_set_u32(fields[0].out_value, 0, 32, value);
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -365,7 +365,7 @@
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -376,7 +376,7 @@
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/etm.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -339,7 +339,7 @@
 	fields[0].tap = etm_reg->jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -350,7 +350,7 @@
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -361,7 +361,7 @@
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;
@@ -431,7 +431,7 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = malloc(4);
 	buf_set_u32(fields[0].out_value, 0, 32, value);
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -442,7 +442,7 @@
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -453,7 +453,7 @@
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/feroceon.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -135,7 +135,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_handler = NULL;
 	fields[0].in_handler_priv = NULL;
@@ -145,7 +145,7 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -155,7 +155,7 @@
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	fields[2].in_check_value = NULL;
 	fields[2].in_check_mask = NULL;

Modified: trunk/src/target/mips_ejtag.c
===================================================================
--- trunk/src/target/mips_ejtag.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/mips_ejtag.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -49,7 +49,7 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = t;
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		field.out_mask = NULL;
+		
 		field.in_value = NULL;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;
@@ -72,7 +72,7 @@
 	field.tap = ejtag_info->tap;
 	field.num_bits = 32;
 	field.out_value = NULL;
-	field.out_mask = NULL;
+	
 	field.in_value = (void*)idcode;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -99,7 +99,7 @@
 	field.tap = ejtag_info->tap;
 	field.num_bits = 32;
 	field.out_value = NULL;
-	field.out_mask = NULL;
+	
 	field.in_value = (void*)impcode;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -130,7 +130,7 @@
 	field.num_bits = 32;
 	field.out_value = t;
 	buf_set_u32(field.out_value, 0, field.num_bits, *data);
-	field.out_mask = NULL;
+	
 	field.in_value = (u8*)data;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/target/xscale.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -225,7 +225,7 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		field.out_mask = NULL;
+		
 		field.in_value = NULL;
 		jtag_set_check_value(&field, tap->expected, tap->expected_mask, NULL);
 
@@ -261,14 +261,14 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = &field0;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
@@ -278,7 +278,7 @@
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -339,14 +339,14 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
@@ -356,7 +356,7 @@
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -458,14 +458,14 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = NULL;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = &field0_in;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_TX].value;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
@@ -475,7 +475,7 @@
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -554,14 +554,14 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = &field0_out;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = &field0_in;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_RX].value;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
@@ -571,7 +571,7 @@
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -729,14 +729,14 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = &field0;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
@@ -746,7 +746,7 @@
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
-	fields[2].out_mask = NULL;
+	
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -805,7 +805,7 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 6;
 	fields[0].out_value = &cmd;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -815,7 +815,7 @@
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 27;
 	fields[1].out_value = packet;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
@@ -863,7 +863,7 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 6;
 	fields[0].out_value = &cmd;
-	fields[0].out_mask = NULL;
+	
 	fields[0].in_value = NULL;
 	fields[0].in_check_value = NULL;
 	fields[0].in_check_mask = NULL;
@@ -873,7 +873,7 @@
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 27;
 	fields[1].out_value = packet;
-	fields[1].out_mask = NULL;
+	
 	fields[1].in_value = NULL;
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-05 19:30:13 UTC (rev 1607)
+++ trunk/src/xsvf/xsvf.c	2009-05-06 06:20:52 UTC (rev 1608)
@@ -486,7 +486,7 @@
 					field.tap = tap;
 					field.num_bits = xsdrsize;
 					field.out_value = dr_out_buf;
-					field.out_mask = NULL;
+					
 					field.in_value = NULL;
 
 					jtag_set_check_value(&field, dr_in_buf, dr_in_mask, NULL);
@@ -705,7 +705,7 @@
 					field.tap = tap;
 					field.num_bits = bitcount;
 					field.out_value = ir_buf;
-					field.out_mask = NULL;
+					
 					field.in_value = NULL;
 					field.in_check_value = NULL;
 					field.in_check_mask = NULL;
@@ -937,7 +937,7 @@
 					field.tap = tap;
 					field.num_bits = xsdrsize;
 					field.out_value = dr_out_buf;
-					field.out_mask = NULL;
+					
 					field.in_value = NULL;
 
 					if (attempt > 0 && verbose)



From oharboe at mail.berlios.de  Wed May  6 08:41:02 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 6 May 2009 08:41:02 +0200
Subject: [Openocd-svn] r1609 - in trunk/src: jtag target
Message-ID: <200905060641.n466f2aS014820@sheep.berlios.de>

Author: oharboe
Date: 2009-05-06 08:40:56 +0200 (Wed, 06 May 2009)
New Revision: 1609

Modified:
   trunk/src/jtag/jtag.h
   trunk/src/target/mips_ejtag.c
   trunk/src/target/mips_ejtag.h
Log:
add warnings about not using in_handler

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-06 06:20:52 UTC (rev 1608)
+++ trunk/src/jtag/jtag.h	2009-05-06 06:40:56 UTC (rev 1609)
@@ -273,9 +273,9 @@
 	u8*         out_value;          /* value to be scanned into the device */
 	u8*         in_value;           /* pointer to a 32-bit memory location to take data scanned out */
 	/* in_check_value/mask, in_handler_error_handler, in_handler_priv can be used by the in handler, otherwise they contain garbage  */
-	u8*          in_check_value;    /* used to validate scan results */
-	u8*          in_check_mask;     /* check specified bits against check_value */
-	in_handler_t in_handler;        /* process received buffer using this handler */
+	u8*          in_check_value;    /* deprecated! only used from jtag_set_check_value. used to validate scan results */
+	u8*          in_check_mask;     /* deprecated! only used from jtag_set_check_value.  check specified bits against check_value */
+	in_handler_t in_handler;        /* deprecated! DO NOT USE! process received buffer using this handler */
 	void*        in_handler_priv;   /* additional information for the in_handler */
 } scan_field_t;
 
@@ -580,10 +580,10 @@
  * of the same interface over time. Even if the OpenOCD code
  * is unchanged, the actual path taken may vary over time
  * and versions of interface firmware or PCB revisions.
- * 
+ *
  * Use jtag_add_pathmove() when specific transition sequences
  * are required.
- * 
+ *
  * Do not use jtag_add_pathmove() unless you need to, but do use it
  * if you have to.
  *

Modified: trunk/src/target/mips_ejtag.c
===================================================================
--- trunk/src/target/mips_ejtag.c	2009-05-06 06:20:52 UTC (rev 1608)
+++ trunk/src/target/mips_ejtag.c	2009-05-06 06:40:56 UTC (rev 1609)
@@ -32,7 +32,7 @@
 
 #include <stdlib.h>
 
-int mips_ejtag_set_instr(mips_ejtag_t *ejtag_info, int new_instr, in_handler_t handler)
+int mips_ejtag_set_instr(mips_ejtag_t *ejtag_info, int new_instr, void *delete_me_and_submit_patch)
 {
 	jtag_tap_t *tap;
 
@@ -49,11 +49,11 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = t;
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		
+
 		field.in_value = NULL;
 		field.in_check_value = NULL;
 		field.in_check_mask = NULL;
-		field.in_handler = handler;
+		field.in_handler = NULL;
 		field.in_handler_priv = NULL;
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 	}
@@ -72,7 +72,7 @@
 	field.tap = ejtag_info->tap;
 	field.num_bits = 32;
 	field.out_value = NULL;
-	
+
 	field.in_value = (void*)idcode;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -99,7 +99,7 @@
 	field.tap = ejtag_info->tap;
 	field.num_bits = 32;
 	field.out_value = NULL;
-	
+
 	field.in_value = (void*)impcode;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;
@@ -130,7 +130,7 @@
 	field.num_bits = 32;
 	field.out_value = t;
 	buf_set_u32(field.out_value, 0, field.num_bits, *data);
-	
+
 	field.in_value = (u8*)data;
 	field.in_check_value = NULL;
 	field.in_check_mask = NULL;

Modified: trunk/src/target/mips_ejtag.h
===================================================================
--- trunk/src/target/mips_ejtag.h	2009-05-06 06:20:52 UTC (rev 1608)
+++ trunk/src/target/mips_ejtag.h	2009-05-06 06:40:56 UTC (rev 1609)
@@ -107,7 +107,7 @@
 	u32 ejtag_ctrl;
 } mips_ejtag_t;
 
-extern int mips_ejtag_set_instr(mips_ejtag_t *ejtag_info, int new_instr, in_handler_t handler);
+extern int mips_ejtag_set_instr(mips_ejtag_t *ejtag_info, int new_instr, void *delete_me_and_submit_patch);
 extern int mips_ejtag_enter_debug(mips_ejtag_t *ejtag_info);
 extern int mips_ejtag_exit_debug(mips_ejtag_t *ejtag_info, int enable_interrupts);
 extern int mips_ejtag_get_impcode(mips_ejtag_t *ejtag_info, u32 *impcode, in_handler_t handler);



From zwelch at mail.berlios.de  Wed May  6 09:18:04 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 6 May 2009 09:18:04 +0200
Subject: [Openocd-svn] r1610 - in trunk: . src/helper
Message-ID: <200905060718.n467I4Lh022548@sheep.berlios.de>

Author: zwelch
Date: 2009-05-06 09:17:57 +0200 (Wed, 06 May 2009)
New Revision: 1610

Modified:
   trunk/configure.in
   trunk/src/helper/jim.c
Log:
Add autoconf check to determine where environ should be declared.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-06 06:40:56 UTC (rev 1609)
+++ trunk/configure.in	2009-05-06 07:17:57 UTC (rev 1610)
@@ -784,6 +784,37 @@
 AM_PROG_CC_C_O
 AC_PROG_RANLIB
 
+# Look for environ alternatives.  Possibility #1: is environ in unistd.h?
+AC_MSG_CHECKING([for environ in unistd.h])
+AC_COMPILE_IFELSE([
+#define _GNU_SOURCE
+#include <unistd.h>
+int main(int argc, char **argv) { char **ep = environ; }
+  ], [
+    AC_MSG_RESULT([yes])
+    has_environ=yes
+  ], [
+    AC_MSG_RESULT([no])
+
+    # Possibility #2: can environ be found in an available library?
+    AC_MSG_CHECKING([for extern environ])
+    AC_LINK_IFELSE([
+extern char **environ;
+int main(int argc, char **argv) { char **ep = environ; }
+      ], [
+        AC_DEFINE(NEED_ENVIRON_EXTERN, [1], [Must declare 'environ' to use it.])
+        has_environ=yes
+      ], [
+        has_environ=no
+      ])
+    AC_MSG_RESULT([${has_environ}])
+  ])
+
+if test "${has_environ}" != "yes" ; then
+     AC_MSG_FAILURE([Could find 'environ' in unistd.h or available libraries.]) 
+fi
+
+
 # set default gcc warnings
 GCC_WARNINGS="-Wall -Wstrict-prototypes -Wformat-security"
 if test "${gcc_wextra}" = yes; then

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-06 06:40:56 UTC (rev 1609)
+++ trunk/src/helper/jim.c	2009-05-06 07:17:57 UTC (rev 1610)
@@ -11984,7 +11984,7 @@
 
     if (argc == 1) {
 
-#if !defined(HAVE_UNISTD_H) || !defined(__GNU_LIBRARY__)
+#ifdef NEED_ENVIRON_EXTERN
         extern char **environ;
 #endif
 



From oharboe at mail.berlios.de  Wed May  6 09:21:48 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 6 May 2009 09:21:48 +0200
Subject: [Openocd-svn] r1611 - in trunk/src: flash jtag pld svf target xsvf
Message-ID: <200905060721.n467LmOX023858@sheep.berlios.de>

Author: oharboe
Date: 2009-05-06 09:21:46 +0200 (Wed, 06 May 2009)
New Revision: 1611

Modified:
   trunk/src/flash/str9xpec.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/pld/virtex2.c
   trunk/src/svf/svf.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/arm_adi_v5.c
   trunk/src/target/arm_jtag.c
   trunk/src/target/embeddedice.c
   trunk/src/target/etb.c
   trunk/src/target/etm.c
   trunk/src/target/feroceon.c
   trunk/src/target/mips_ejtag.c
   trunk/src/target/xscale.c
   trunk/src/xsvf/xsvf.c
Log:
remove unecessary setting of deprecated fields to NULL

Modified: trunk/src/flash/str9xpec.c
===================================================================
--- trunk/src/flash/str9xpec.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/flash/str9xpec.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -127,10 +127,10 @@
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
 		
 		field.in_value = NULL;
-		field.in_check_value = NULL;
-		field.in_check_mask = NULL;
+		
+		
 		field.in_handler = NULL;
-		field.in_handler_priv = NULL;
+		
 
 		jtag_add_ir_scan(1, &field, end_state);
 
@@ -153,10 +153,10 @@
 	field.out_value = NULL;
 	
 	field.in_value = &status;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
@@ -245,10 +245,10 @@
 	field.out_value = NULL;
 	
 	field.in_value = str9xpec_info->options;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
@@ -397,10 +397,10 @@
 	field.out_value = buffer;
 	
 	field.in_value = NULL;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_add_sleep(40000);
@@ -411,10 +411,10 @@
 	field.out_value = NULL;
 	
 	field.in_value = buffer;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IRPAUSE);
 	jtag_execute_queue();
@@ -513,10 +513,10 @@
 	field.out_value = buffer;
 	
 	field.in_value = NULL;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
@@ -579,10 +579,10 @@
 		field.out_value = NULL;
 		
 		field.in_value = &status;
-		field.in_check_value = NULL;
-		field.in_check_mask = NULL;
+		
+		
 		field.in_handler = NULL;
-		field.in_handler_priv = NULL;
+		
 
 		jtag_add_dr_scan(1, &field, -1);
 		jtag_execute_queue();
@@ -665,10 +665,10 @@
 	field.out_value = &sector;
 	
 	field.in_value = NULL;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(1, &field, -1);
 
@@ -754,10 +754,10 @@
 			field.out_value = (buffer + bytes_written);
 			
 			field.in_value = NULL;
-			field.in_check_value = NULL;
-			field.in_check_mask = NULL;
+			
+			
 			field.in_handler = NULL;
-			field.in_handler_priv = NULL;
+			
 
 			jtag_add_dr_scan(1, &field, TAP_IDLE);
 
@@ -772,10 +772,10 @@
 				field.out_value = NULL;
 				
 				field.in_value = scanbuf;
-				field.in_check_value = NULL;
-				field.in_check_mask = NULL;
+				
+				
 				field.in_handler = NULL;
-				field.in_handler_priv = NULL;
+				
 
 				jtag_add_dr_scan(1, &field, -1);
 				jtag_execute_queue();
@@ -814,10 +814,10 @@
 		field.out_value = last_dword;
 		
 		field.in_value = NULL;
-		field.in_check_value = NULL;
-		field.in_check_mask = NULL;
+		
+		
 		field.in_handler = NULL;
-		field.in_handler_priv = NULL;
+		
 
 		jtag_add_dr_scan(1, &field, TAP_IDLE);
 
@@ -832,10 +832,10 @@
 			field.out_value = NULL;
 			
 			field.in_value = scanbuf;
-			field.in_check_value = NULL;
-			field.in_check_mask = NULL;
+			
+			
 			field.in_handler = NULL;
-			field.in_handler_priv = NULL;
+			
 
 			jtag_add_dr_scan(1, &field, -1);
 			jtag_execute_queue();
@@ -896,10 +896,10 @@
 	field.out_value = NULL;
 	
 	field.in_value = buffer;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
@@ -1021,10 +1021,10 @@
 	field.out_value = str9xpec_info->options;
 	
 	field.in_value = NULL;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 
@@ -1039,10 +1039,10 @@
 		field.out_value = NULL;
 		
 		field.in_value = &status;
-		field.in_check_value = NULL;
-		field.in_check_mask = NULL;
+		
+		
 		field.in_handler = NULL;
-		field.in_handler_priv = NULL;
+		
 
 		jtag_add_dr_scan(1, &field, -1);
 		jtag_execute_queue();

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/jtag/jtag.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -1486,10 +1486,10 @@
 	field.out_value = idcode_buffer;
 	
 	field.in_value = idcode_buffer;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	for (i = 0; i < JTAG_MAX_CHAIN_SIZE; i++)
 	{
@@ -1664,10 +1664,10 @@
 	field.out_value = ir_test;
 	
 	field.in_value = ir_test;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 
 	jtag_add_plain_ir_scan(1, &field, TAP_RESET);
 	jtag_execute_queue();

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/jtag/jtag.h	2009-05-06 07:21:46 UTC (rev 1611)
@@ -275,8 +275,8 @@
 	/* in_check_value/mask, in_handler_error_handler, in_handler_priv can be used by the in handler, otherwise they contain garbage  */
 	u8*          in_check_value;    /* deprecated! only used from jtag_set_check_value. used to validate scan results */
 	u8*          in_check_mask;     /* deprecated! only used from jtag_set_check_value.  check specified bits against check_value */
-	in_handler_t in_handler;        /* deprecated! DO NOT USE! process received buffer using this handler */
-	void*        in_handler_priv;   /* additional information for the in_handler */
+	in_handler_t in_handler;        /* deprecated! SET TO NULL. DO NOT USE! process received buffer using this handler */
+	void*        in_handler_priv;   /* deprecated! only used by obsolete in_handler implementations */
 } scan_field_t;
 
 enum scan_type {

Modified: trunk/src/pld/virtex2.c
===================================================================
--- trunk/src/pld/virtex2.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/pld/virtex2.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -56,13 +56,13 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		
+
 		field.in_value = NULL;
-		field.in_check_value = NULL;
-		field.in_check_mask = NULL;
+
+
 		field.in_handler = NULL;
-		field.in_handler_priv = NULL;
 
+
 		jtag_add_ir_scan(1, &field, TAP_IDLE);
 
 		free(field.out_value);
@@ -84,10 +84,7 @@
 	scan_field.num_bits = num_words * 32;
 	scan_field.out_value = values;
 	scan_field.in_value = NULL;
-	scan_field.in_check_value = NULL;
-	scan_field.in_check_mask = NULL;
 	scan_field.in_handler = NULL;
-	scan_field.in_handler_priv = NULL;
 
 	for (i = 0; i < num_words; i++)
 		buf_set_u32(values + 4 * i, 0, 32, flip_u32(*words++, 32));
@@ -117,8 +114,6 @@
 	scan_field.num_bits = 32;
 	scan_field.out_value = NULL;
 	scan_field.in_value = NULL;
-	scan_field.in_check_value = NULL;
-	scan_field.in_check_mask = NULL;
 	scan_field.in_handler = virtex2_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 
 	virtex2_set_instr(virtex2_info->tap, 0x4); /* CFG_OUT */
@@ -164,13 +159,13 @@
 	scan_field_t field;
 
 	field.tap = virtex2_info->tap;
-	
+
 	field.in_value = NULL;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+
+
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
 
+
 	if ((retval = xilinx_read_bit_file(&bit_file, filename)) != ERROR_OK)
 		return retval;
 

Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/svf/svf.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -977,10 +977,10 @@
 			field.out_value = &svf_tdi_buffer[svf_buffer_index];
 			
 			field.in_value = &svf_tdi_buffer[svf_buffer_index];
-			field.in_check_value = NULL;
-			field.in_check_mask = NULL;
+			
+			
 			field.in_handler = NULL;
-			field.in_handler_priv = NULL;
+			
 			jtag_add_plain_dr_scan(1, &field, svf_para.dr_end_state);
 
 			svf_buffer_index += (i + 7) >> 3;
@@ -1078,10 +1078,10 @@
 			field.out_value = &svf_tdi_buffer[svf_buffer_index];
 			
 			field.in_value = &svf_tdi_buffer[svf_buffer_index];
-			field.in_check_value = NULL;
-			field.in_check_mask = NULL;
+			
+			
 			field.in_handler = NULL;
-			field.in_handler_priv = NULL;
+			
 			jtag_add_plain_ir_scan(1, &field, svf_para.ir_end_state);
 
 			svf_buffer_index += (i + 7) >> 3;

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/arm720t.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -114,10 +114,10 @@
 	fields[0].out_value = &instruction_buf;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
@@ -131,10 +131,10 @@
 	} else
 	{
 		fields[1].in_handler = NULL;
-		fields[1].in_handler_priv = NULL;
+		
 	}
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/arm7tdmi.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -113,20 +113,20 @@
 		fields[0].out_value = NULL;
 		
 		fields[0].in_value = &breakpoint;
-		fields[0].in_check_value = NULL;
-		fields[0].in_check_mask = NULL;
+		
+		
 		fields[0].in_handler = NULL;
-		fields[0].in_handler_priv = NULL;
+		
 
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 32;
 		fields[1].out_value = NULL;
 		
 		fields[1].in_value = databus;
-		fields[1].in_check_value = NULL;
-		fields[1].in_check_mask = NULL;
+		
+		
 		fields[1].in_handler = NULL;
-		fields[1].in_handler_priv = NULL;
+		
 
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
@@ -200,10 +200,10 @@
 	fields[0].out_value = NULL;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
@@ -212,8 +212,8 @@
 	fields[1].in_value = NULL;
 	fields[1].in_handler = arm_jtag_buf_to_u32_flip; /* deprecated! invoke this from user code! */
 	fields[1].in_handler_priv = in;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
@@ -261,10 +261,10 @@
 	fields[0].out_value = NULL;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
@@ -284,8 +284,8 @@
 			break;
 	}
 	fields[1].in_handler_priv = in;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/arm920t.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -115,40 +115,40 @@
 	fields[0].out_value = &access_type_buf;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
 	
 	fields[3].in_value = NULL;
-	fields[3].in_check_value = NULL;
-	fields[3].in_check_mask = NULL;
+	
+	
 	fields[3].in_handler = NULL;
-	fields[3].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
@@ -187,40 +187,40 @@
 	fields[0].out_value = &access_type_buf;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = value_buf;
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
 	
 	fields[3].in_value = NULL;
-	fields[3].in_check_value = NULL;
-	fields[3].in_check_mask = NULL;
+	
+	
 	fields[3].in_handler = NULL;
-	fields[3].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
@@ -254,40 +254,40 @@
 	fields[0].out_value = &access_type_buf;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = cp15_opcode_buf;
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
 	
 	fields[3].in_value = NULL;
-	fields[3].in_check_value = NULL;
-	fields[3].in_check_mask = NULL;
+	
+	
 	fields[3].in_handler = NULL;
-	fields[3].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/arm926ejs.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -139,40 +139,40 @@
 	fields[0].out_value = NULL;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 1;
 	fields[1].out_value = &access;
 	
 	fields[1].in_value = &access;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
 	
 	fields[3].in_value = NULL;
-	fields[3].in_check_value = NULL;
-	fields[3].in_check_mask = NULL;
+	
+	
 	fields[3].in_handler = NULL;
-	fields[3].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
@@ -229,40 +229,40 @@
 	fields[0].out_value = value_buf;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 1;
 	fields[1].out_value = &access;
 	
 	fields[1].in_value = &access;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
 	
 	fields[3].in_value = NULL;
-	fields[3].in_check_value = NULL;
-	fields[3].in_check_mask = NULL;
+	
+	
 	fields[3].in_handler = NULL;
-	fields[3].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 	/*TODO: add timeout*/

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/arm966e.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -189,30 +189,30 @@
 	fields[0].out_value = NULL;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 6;
 	fields[1].out_value = &reg_addr_buf;
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &nr_w_buf;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -257,30 +257,30 @@
 	fields[0].out_value = value_buf;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 6;
 	fields[1].out_value = &reg_addr_buf;
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &nr_w_buf;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/arm9tdmi.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -130,30 +130,30 @@
 		fields[0].out_value = NULL;
 		
 		fields[0].in_value = databus;
-		fields[0].in_check_value = NULL;
-		fields[0].in_check_mask = NULL;
+		
+		
 		fields[0].in_handler = NULL;
-		fields[0].in_handler_priv = NULL;
+		
 
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 3;
 		fields[1].out_value = NULL;
 		
 		fields[1].in_value = &debug_reason;
-		fields[1].in_check_value = NULL;
-		fields[1].in_check_mask = NULL;
+		
+		
 		fields[1].in_handler = NULL;
-		fields[1].in_handler_priv = NULL;
+		
 
 		fields[2].tap = arm7_9->jtag_info.tap;
 		fields[2].num_bits = 32;
 		fields[2].out_value = NULL;
 		
 		fields[2].in_value = instructionbus;
-		fields[2].in_check_value = NULL;
-		fields[2].in_check_mask = NULL;
+		
+		
 		fields[2].in_handler = NULL;
-		fields[2].in_handler_priv = NULL;
+		
 
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
@@ -226,30 +226,30 @@
 	else
 	{
 		fields[0].in_handler = NULL;
-		fields[0].in_handler_priv = NULL;
+		
 	}
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -295,8 +295,8 @@
 	fields[0].in_value = NULL;
 	fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 	fields[0].in_handler_priv = in;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
@@ -304,19 +304,19 @@
 	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -378,8 +378,8 @@
 			break;
 	}
 	fields[0].in_handler_priv = in;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
@@ -387,19 +387,19 @@
 	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/arm_adi_v5.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -78,10 +78,10 @@
 	fields[0].out_value = &out_addr_buf;
 	
 	fields[0].in_value = ack;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
@@ -89,9 +89,9 @@
 	
 	fields[1].in_value = invalue;
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
+	
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
@@ -114,10 +114,10 @@
 	fields[0].out_value = &out_addr_buf;
 	
 	fields[0].in_value = ack;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
@@ -133,10 +133,10 @@
 	else
 	{
 		fields[1].in_handler = NULL;
-		fields[1].in_handler_priv = NULL;
+		
 	}
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm_jtag.c
===================================================================
--- trunk/src/target/arm_jtag.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/arm_jtag.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -54,10 +54,10 @@
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
 		
 		field.in_value = NULL;
-		field.in_check_value = NULL;
-		field.in_check_mask = NULL;
+		
+		
 		field.in_handler = handler;
-		field.in_handler_priv = NULL;
+		
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 	}
 

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/embeddedice.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -253,10 +253,10 @@
 	fields[0].out_value = reg->value;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = ice_reg->jtag_info->tap;
 	fields[1].num_bits = 5;
@@ -264,10 +264,10 @@
 	buf_set_u32(fields[1].out_value, 0, 5, reg_addr);
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = ice_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
@@ -275,10 +275,10 @@
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -315,10 +315,10 @@
 	fields[0].out_value = NULL;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
@@ -326,10 +326,10 @@
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_DATA]);
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
@@ -337,10 +337,10 @@
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -432,10 +432,10 @@
 	fields[0].out_value = field0_out;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
@@ -443,10 +443,10 @@
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_DATA]);
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
@@ -454,10 +454,10 @@
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	while (size > 0)
 	{
@@ -501,10 +501,10 @@
 	fields[0].out_value = NULL;
 	
 	fields[0].in_value = field0_in;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
@@ -512,10 +512,10 @@
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_CTRL]);
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
@@ -523,10 +523,10 @@
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 	gettimeofday(&lap, NULL);

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/etb.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -72,10 +72,10 @@
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
 		
 		field.in_value = NULL;
-		field.in_check_value = NULL;
-		field.in_check_mask = NULL;
+		
+		
 		field.in_handler = NULL;
-		field.in_handler_priv = NULL;
+		
 
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 
@@ -97,10 +97,10 @@
 		buf_set_u32(field.out_value, 0, field.num_bits, new_scan_chain);
 		
 		field.in_value = NULL;
-		field.in_check_value = NULL;
-		field.in_check_mask = NULL;
+		
+		
 		field.in_handler = NULL;
-		field.in_handler_priv = NULL;
+		
 
 		/* select INTEST instruction */
 		etb_set_instr(etb, 0x2);
@@ -188,10 +188,10 @@
 	fields[0].out_value = NULL;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = etb->tap;
 	fields[1].num_bits = 7;
@@ -199,10 +199,10 @@
 	buf_set_u32(fields[1].out_value, 0, 7, 4);
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = etb->tap;
 	fields[2].num_bits = 1;
@@ -210,10 +210,10 @@
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -259,10 +259,10 @@
 	fields[0].out_value = reg->value;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = etb_reg->etb->tap;
 	fields[1].num_bits = 7;
@@ -270,10 +270,10 @@
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = etb_reg->etb->tap;
 	fields[2].num_bits = 1;
@@ -281,10 +281,10 @@
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -356,10 +356,10 @@
 	buf_set_u32(fields[0].out_value, 0, 32, value);
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = etb_reg->etb->tap;
 	fields[1].num_bits = 7;
@@ -367,10 +367,10 @@
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = etb_reg->etb->tap;
 	fields[2].num_bits = 1;
@@ -378,10 +378,10 @@
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/etm.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -341,10 +341,10 @@
 	fields[0].out_value = reg->value;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = etm_reg->jtag_info->tap;
 	fields[1].num_bits = 7;
@@ -352,10 +352,10 @@
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = etm_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
@@ -363,10 +363,10 @@
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -433,10 +433,10 @@
 	buf_set_u32(fields[0].out_value, 0, 32, value);
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = etm_reg->jtag_info->tap;
 	fields[1].num_bits = 7;
@@ -444,10 +444,10 @@
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = etm_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
@@ -455,10 +455,10 @@
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/feroceon.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -138,29 +138,29 @@
 	
 	fields[0].in_value = NULL;
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
 	
 	fields[2].in_value = NULL;
-	fields[2].in_check_value = NULL;
-	fields[2].in_check_mask = NULL;
+	
+	
 	fields[2].in_handler = NULL;
-	fields[2].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 

Modified: trunk/src/target/mips_ejtag.c
===================================================================
--- trunk/src/target/mips_ejtag.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/mips_ejtag.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -51,10 +51,10 @@
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
 
 		field.in_value = NULL;
-		field.in_check_value = NULL;
-		field.in_check_mask = NULL;
+		
+		
 		field.in_handler = NULL;
-		field.in_handler_priv = NULL;
+		
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 	}
 
@@ -74,10 +74,10 @@
 	field.out_value = NULL;
 
 	field.in_value = (void*)idcode;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 	jtag_add_dr_scan(1, &field, TAP_INVALID);
 
 	if (jtag_execute_queue() != ERROR_OK)
@@ -101,10 +101,10 @@
 	field.out_value = NULL;
 
 	field.in_value = (void*)impcode;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 	jtag_add_dr_scan(1, &field, TAP_INVALID);
 
 	if (jtag_execute_queue() != ERROR_OK)
@@ -132,10 +132,10 @@
 	buf_set_u32(field.out_value, 0, field.num_bits, *data);
 
 	field.in_value = (u8*)data;
-	field.in_check_value = NULL;
-	field.in_check_mask = NULL;
+	
+	
 	field.in_handler = NULL;
-	field.in_handler_priv = NULL;
+	
 	jtag_add_dr_scan(1, &field, TAP_INVALID);
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/target/xscale.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -271,9 +271,9 @@
 	
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -349,9 +349,9 @@
 	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -468,9 +468,9 @@
 	
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_TX].value;
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -564,9 +564,9 @@
 	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -739,9 +739,9 @@
 	
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -807,20 +807,20 @@
 	fields[0].out_value = &cmd;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 27;
 	fields[1].out_value = packet;
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
@@ -865,20 +865,20 @@
 	fields[0].out_value = &cmd;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_check_value = NULL;
-	fields[0].in_check_mask = NULL;
+	
+	
 	fields[0].in_handler = NULL;
-	fields[0].in_handler_priv = NULL;
+	
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 27;
 	fields[1].out_value = packet;
 	
 	fields[1].in_value = NULL;
-	fields[1].in_check_value = NULL;
-	fields[1].in_check_mask = NULL;
+	
+	
 	fields[1].in_handler = NULL;
-	fields[1].in_handler_priv = NULL;
+	
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-06 07:17:57 UTC (rev 1610)
+++ trunk/src/xsvf/xsvf.c	2009-05-06 07:21:46 UTC (rev 1611)
@@ -707,10 +707,10 @@
 					field.out_value = ir_buf;
 					
 					field.in_value = NULL;
-					field.in_check_value = NULL;
-					field.in_check_mask = NULL;
+					
+					
 					field.in_handler = NULL;
-					field.in_handler_priv = NULL;
+					
 
 					if (tap == NULL)
 						jtag_add_plain_ir_scan(1, &field, my_end_state);



From zwelch at mail.berlios.de  Wed May  6 10:30:53 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 6 May 2009 10:30:53 +0200
Subject: [Openocd-svn] r1612 - trunk
Message-ID: <200905060830.n468UrDq021682@sheep.berlios.de>

Author: zwelch
Date: 2009-05-06 10:30:50 +0200 (Wed, 06 May 2009)
New Revision: 1612

Modified:
   trunk/configure.in
Log:
Fix enviorn configure test failure message (thanks to Anders Montonen).

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-06 07:21:46 UTC (rev 1611)
+++ trunk/configure.in	2009-05-06 08:30:50 UTC (rev 1612)
@@ -811,7 +811,7 @@
   ])
 
 if test "${has_environ}" != "yes" ; then
-     AC_MSG_FAILURE([Could find 'environ' in unistd.h or available libraries.]) 
+     AC_MSG_FAILURE([Could not find 'environ' in unistd.h or available libraries.]) 
 fi
 
 



From oharboe at mail.berlios.de  Wed May  6 13:22:32 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 6 May 2009 13:22:32 +0200
Subject: [Openocd-svn] r1613 - trunk/src/jtag zy1000/trunk/build
	zy1000/trunk/build/menu zy1000/trunk/build/tcl
Message-ID: <200905061122.n46BMWYr023612@sheep.berlios.de>

Author: oharboe
Date: 2009-05-06 13:22:30 +0200 (Wed, 06 May 2009)
New Revision: 1613

Modified:
   trunk/src/jtag/zy1000.c
   zy1000/trunk/build/menu/zy1000menu.xml
   zy1000/trunk/build/menu/zy1000menu.xsl
   zy1000/trunk/build/tcl/browsemem.tcl
   zy1000/trunk/build/tcl/downloadmem.tcl
   zy1000/trunk/build/tcl/editconfigs.tcl
   zy1000/trunk/build/tcl/editfile.tcl
   zy1000/trunk/build/tcl/erase.tcl
   zy1000/trunk/build/tcl/flash.tcl
   zy1000/trunk/build/tcl/flashinfo.tcl
   zy1000/trunk/build/tcl/guiupload.tcl
   zy1000/trunk/build/tcl/index.tcl
   zy1000/trunk/build/tcl/log.tcl
   zy1000/trunk/build/tcl/openocd.tcl
   zy1000/trunk/build/tcl/preconfig.tcl
   zy1000/trunk/build/tcl/production.tcl
   zy1000/trunk/build/tcl/reload.tcl
   zy1000/trunk/build/tcl/run.tcl
   zy1000/trunk/build/tcl/support.tcl
   zy1000/trunk/build/tcl/targets.tcl
   zy1000/trunk/build/tcl/terminal.tcl
   zy1000/trunk/build/tcl/upgrade.tcl
   zy1000/trunk/build/tcl/zy1000.tcl
   zy1000/trunk/build/testhttpd.tcl
Log:
log noise reduction

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2009-05-06 08:30:50 UTC (rev 1612)
+++ trunk/src/jtag/zy1000.c	2009-05-06 11:22:30 UTC (rev 1613)
@@ -285,37 +285,43 @@
 
 
 /* Give TELNET a way to find out what version this is */
-int handle_zy1000_version_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
+static int jim_zy1000_version(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 {
-	if (argc > 1)
+	if ((argc < 1) || (argc > 2))
+		return JIM_ERR;
+	char buff[128];
+	const char *version_str=NULL;
+
+	if (argc == 1)
 	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-	if (argc == 0)
+		version_str=ZYLIN_OPENOCD_VERSION;
+	} else
 	{
-		command_print(cmd_ctx, ZYLIN_OPENOCD_VERSION);
+		const char *str = Jim_GetString(argv[1], NULL);
+		if (strcmp("openocd", str) == 0)
+		{
+			int revision;
+			revision = atol(ZYLIN_OPENOCD+strlen("XRevision: "));
+			sprintf(buff, "%d", revision);
+			version_str=buff;
+		}
+		else if (strcmp("zy1000", str) == 0)
+		{
+			version_str=ZYLIN_VERSION;
+		}
+		else if (strcmp("date", str) == 0)
+		{
+			version_str=ZYLIN_DATE;
+		}
+		else
+		{
+			return JIM_ERR;
+		}
 	}
-	else if (strcmp("openocd", args[0]) == 0)
-	{
-		int revision;
-		revision = atol(ZYLIN_OPENOCD+strlen("XRevision: "));
-		command_print(cmd_ctx, "%d", revision);
-	}
-	else if (strcmp("zy1000", args[0]) == 0)
-	{
-		command_print(cmd_ctx, "%s", ZYLIN_VERSION);
-	}
-	else if (strcmp("date", args[0]) == 0)
-	{
-		command_print(cmd_ctx, "%s", ZYLIN_DATE);
-	}
-	else
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
 
-	return ERROR_OK;
+	Jim_SetResult(interp, Jim_NewStringObj(interp, version_str, -1));
+
+	return JIM_OK;
 }
 
 
@@ -342,9 +348,10 @@
 {
 	register_command(cmd_ctx, NULL, "power", handle_power_command, COMMAND_ANY,
 			"power <on/off> - turn power switch to target on/off. No arguments - print status.");
-	register_command(cmd_ctx, NULL, "zy1000_version", handle_zy1000_version_command,
-			COMMAND_EXEC, "show zy1000 version numbers");
 
+	Jim_CreateCommand(interp, "zy1000_version", jim_zy1000_version, NULL, NULL);
+
+
 	Jim_CreateCommand(interp, "powerstatus", zylinjtag_Jim_Command_powerstatus, NULL, NULL);
 
 	return ERROR_OK;

Modified: zy1000/trunk/build/menu/zy1000menu.xml
===================================================================
--- zy1000/trunk/build/menu/zy1000menu.xml	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/menu/zy1000menu.xml	2009-05-06 11:22:30 UTC (rev 1613)
@@ -62,9 +62,9 @@
 							append buffer [ocd_jtag_khz]
 						</tcl>
 						<br>
-						<tcl>append buffer [capture {zy1000_version zy1000}]</tcl><br>
-						<tcl>append buffer [capture {zy1000_version openocd}]</tcl><br>
-						<tcl>append buffer [capture {zy1000_version date}]</tcl><br>
+						<tcl>append buffer [zy1000_version zy1000]</tcl><br>
+						<tcl>append buffer [zy1000_version openocd]</tcl><br>
+						<tcl>append buffer [zy1000_version date]</tcl><br>
 						<tcl>append buffer [ip]</tcl><br>
 						<tcl>append buffer [ocd_gdb_port]</tcl>
 					</td>
@@ -1556,9 +1556,9 @@
 			set form_config [load_config "[load_target]"]
 			set support_id [string range [rand] 0 7]
 			set form_log ""
-			append form_log "Version: [capture "zy1000_version zy1000"]"
-			append form_log "OpenOCD version: [capture "zy1000_version openocd"]"
-			append form_log "Version date: [capture "zy1000_version date"]"
+			append form_log "Version: [zy1000_version zy1000]"
+			append form_log "OpenOCD version: [zy1000_version openocd]"
+			append form_log "Version date: [zy1000_version date]"
 			append form_log [log]
 			</tcl>
 

Modified: zy1000/trunk/build/menu/zy1000menu.xsl
===================================================================
--- zy1000/trunk/build/menu/zy1000menu.xsl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/menu/zy1000menu.xsl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -36,7 +36,7 @@
 					</div>
 					<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 						<div class="textlight" style="position:relative;left:15px;top:4px;">
-							<tcl>append buffer [capture zy1000_version]</tcl>
+							<tcl>append buffer [zy1000_version]</tcl>
 						</div>
 					</div>
 				</div>

Modified: zy1000/trunk/build/tcl/browsemem.tcl
===================================================================
--- zy1000/trunk/build/tcl/browsemem.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/browsemem.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -54,7 +54,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/downloadmem.tcl
===================================================================
--- zy1000/trunk/build/tcl/downloadmem.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/downloadmem.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -59,7 +59,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/editconfigs.tcl
===================================================================
--- zy1000/trunk/build/tcl/editconfigs.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/editconfigs.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -27,7 +27,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/editfile.tcl
===================================================================
--- zy1000/trunk/build/tcl/editfile.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/editfile.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -75,7 +75,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/erase.tcl
===================================================================
--- zy1000/trunk/build/tcl/erase.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/erase.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -48,7 +48,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/flash.tcl
===================================================================
--- zy1000/trunk/build/tcl/flash.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/flash.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -39,7 +39,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/flashinfo.tcl
===================================================================
--- zy1000/trunk/build/tcl/flashinfo.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/flashinfo.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -37,7 +37,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/guiupload.tcl
===================================================================
--- zy1000/trunk/build/tcl/guiupload.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/guiupload.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -69,7 +69,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/index.tcl
===================================================================
--- zy1000/trunk/build/tcl/index.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/index.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -21,7 +21,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -164,9 +164,9 @@
 							append buffer [ocd_jtag_khz]
 						</tcl>
 						<br>
-						<tcl>append buffer [capture {zy1000_version zy1000}]</tcl><br>
-						<tcl>append buffer [capture {zy1000_version openocd}]</tcl><br>
-						<tcl>append buffer [capture {zy1000_version date}]</tcl><br>
+						<tcl>append buffer [zy1000_version zy1000]</tcl><br>
+						<tcl>append buffer [zy1000_version openocd]</tcl><br>
+						<tcl>append buffer [zy1000_version date]</tcl><br>
 						<tcl>append buffer [ip]</tcl><br>
 						<tcl>append buffer [ocd_gdb_port]</tcl>
 					</td>

Modified: zy1000/trunk/build/tcl/log.tcl
===================================================================
--- zy1000/trunk/build/tcl/log.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/log.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -66,7 +66,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/openocd.tcl
===================================================================
--- zy1000/trunk/build/tcl/openocd.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/openocd.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -63,7 +63,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/preconfig.tcl
===================================================================
--- zy1000/trunk/build/tcl/preconfig.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/preconfig.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -24,7 +24,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/production.tcl
===================================================================
--- zy1000/trunk/build/tcl/production.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/production.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -44,7 +44,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/reload.tcl
===================================================================
--- zy1000/trunk/build/tcl/reload.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/reload.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -34,7 +34,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/run.tcl
===================================================================
--- zy1000/trunk/build/tcl/run.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/run.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -51,7 +51,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/support.tcl
===================================================================
--- zy1000/trunk/build/tcl/support.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/support.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -85,7 +85,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -202,9 +202,9 @@
 			set form_config [load_config "[load_target]"]
 			set support_id [string range [rand] 0 7]
 			set form_log ""
-			append form_log "Version: [capture "zy1000_version zy1000"]"
-			append form_log "OpenOCD version: [capture "zy1000_version openocd"]"
-			append form_log "Version date: [capture "zy1000_version date"]"
+			append form_log "Version: [zy1000_version zy1000]"
+			append form_log "OpenOCD version: [zy1000_version openocd]"
+			append form_log "Version date: [zy1000_version date]"
 			append form_log [log]
 			</tcl>
 

Modified: zy1000/trunk/build/tcl/targets.tcl
===================================================================
--- zy1000/trunk/build/tcl/targets.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/targets.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -30,7 +30,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>
@@ -325,7 +325,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/terminal.tcl
===================================================================
--- zy1000/trunk/build/tcl/terminal.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/terminal.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -89,7 +89,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/upgrade.tcl
===================================================================
--- zy1000/trunk/build/tcl/upgrade.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/upgrade.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -72,7 +72,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/tcl/zy1000.tcl
===================================================================
--- zy1000/trunk/build/tcl/zy1000.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/tcl/zy1000.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -82,7 +82,7 @@
 </div>
 <div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
 <div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [capture zy1000_version]</tcl>
+<tcl>append buffer [zy1000_version]</tcl>
 </div>
 </div>
 </div>

Modified: zy1000/trunk/build/testhttpd.tcl
===================================================================
--- zy1000/trunk/build/testhttpd.tcl	2009-05-06 08:30:50 UTC (rev 1612)
+++ zy1000/trunk/build/testhttpd.tcl	2009-05-06 11:22:30 UTC (rev 1613)
@@ -1,8 +1,5 @@
 # some dummy proc's to get things going for test purposes
 
-proc zy1000_version {args} {
-return abc
-}
 
 script ../zy1000/linux_zy1000/build/tcl/openocd.cfg 
 



From oharboe at mail.berlios.de  Wed May  6 15:33:07 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 6 May 2009 15:33:07 +0200
Subject: [Openocd-svn] r1614 - trunk/src/xsvf
Message-ID: <200905061333.n46DX7pX031800@sheep.berlios.de>

Author: oharboe
Date: 2009-05-06 15:32:43 +0200 (Wed, 06 May 2009)
New Revision: 1614

Modified:
   trunk/src/xsvf/xsvf.c
Log:
Dick Hollenbeck <dick at softplc.com> simplifies XSTATE handling, and protects against illegal state
transitions that might be in an SVF file.

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-06 11:22:30 UTC (rev 1613)
+++ trunk/src/xsvf/xsvf.c	2009-05-06 13:32:43 UTC (rev 1614)
@@ -53,6 +53,7 @@
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <string.h>
+#include <assert.h>
 
 #include <sys/time.h>
 #include <time.h>
@@ -173,46 +174,52 @@
 }
 
 
-/* xsvf has it's own definition of a statemove. This needs
+/**
+ * Function xsvf_add_statemove
+ * moves from the current state to the goal \a state. This needs
  * to be handled according to the xsvf spec, which has nothing
  * to do with the JTAG spec or OpenOCD as such.
  *
  * Implemented via jtag_add_pathmove().
  */
-static void xsvf_add_statemove(tap_state_t state)
+static void xsvf_add_statemove(tap_state_t goal_state)
 {
-	tap_state_t moves[7]; 	/* max # of transitions */
-	tap_state_t curstate = cmd_queue_cur_state;
+	tap_state_t moves[8];
+	tap_state_t cur_state = cmd_queue_cur_state;
 	int i;
+	int tms_bits;
+	int	tms_count;
 
-	u8 move = tap_get_tms_path(cmd_queue_cur_state, state);
+	LOG_DEBUG( "cur_state=%s goal_state=%s",
+		tap_state_name(cur_state),
+		tap_state_name(goal_state) );
 
-	if (state != TAP_RESET  &&  state==cmd_queue_cur_state)
+	if (goal_state==cur_state )
 		return;
 
-	if(state==TAP_RESET)
+	if( goal_state==TAP_RESET )
 	{
 		jtag_add_tlr();
 		return;
 	}
 
-	for (i=0; i<7; i++)
+	tms_bits  = tap_get_tms_path(cur_state, goal_state);
+	tms_count = tap_get_tms_path_len(cur_state, goal_state);
+
+	assert( (unsigned) tms_count < DIM(moves) );
+
+	for (i=0;   i<tms_count;   i++, tms_bits>>=1)
 	{
-		int j = (move >> i) & 1;
-		if (j)
-		{
-			curstate = tap_state_transition(curstate, true);
-		}
-		else
-		{
-			curstate = tap_state_transition(curstate, false);
-		}
-		moves[i] = curstate;
+		bool bit = tms_bits & 1;
+
+		cur_state = tap_state_transition(cur_state, bit);
+		moves[i] = cur_state;
 	}
 
-	jtag_add_pathmove(7, moves);
+	jtag_add_pathmove(tms_count, moves);
 }
 
+
 int xsvf_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, "xsvf", handle_xsvf_command,
@@ -236,38 +243,6 @@
 }
 
 
-static int xsvf_read_xstates(int fd, tap_state_t *path, int max_path, int *path_len)
-{
-	char c;
-	u8   uc;
-
-	while ((read(fd, &c, 1) > 0) && (c == XSTATE))
-	{
-		tap_state_t	mystate;
-
-		if (*path_len > max_path)
-		{
-			LOG_WARNING("XSTATE path longer than max_path");
-			break;
-		}
-		if (read(fd, &uc, 1) < 0)
-		{
-			return ERROR_XSVF_EOF;
-		}
-
-		mystate = xsvf_to_tap(uc);
-
-		LOG_DEBUG("XSTATE %02X %s", uc, tap_state_name(mystate) );
-
-		path[(*path_len)++] = mystate;
-	}
-
-	lseek(fd, -1, SEEK_CUR);
-
-	return ERROR_OK;
-}
-
-
 static int handle_xsvf_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	u8 *dr_out_buf = NULL; 				/* from host to device (TDI) */
@@ -477,7 +452,7 @@
 							TAP_IDLE,
 						};
 
-						jtag_add_pathmove( sizeof(exception_path)/sizeof(exception_path[0]), exception_path);
+						jtag_add_pathmove( DIM(exception_path), exception_path );
 
 						if (verbose)
 							LOG_USER("%s mismatch, xsdrsize=%d retry=%d", op_name, xsdrsize, attempt);
@@ -570,8 +545,7 @@
 		case XSTATE:
 			{
 				tap_state_t	mystate;
-				tap_state_t*	path;
-				int 			path_len;
+				u8			uc;
 
 				if (read(xsvf_fd, &uc, 1) < 0)
 				{
@@ -583,38 +557,7 @@
 
 				LOG_DEBUG("XSTATE 0x%02X %s", uc, tap_state_name(mystate) );
 
-				path = calloc(XSTATE_MAX_PATH, 4);
-				path_len = 1;
-
-				path[0] = mystate;
-				if (xsvf_read_xstates(xsvf_fd, path, XSTATE_MAX_PATH, &path_len) != ERROR_OK)
-					do_abort = 1;
-				else
-				{
-					int i,lasti;
-
-					/* here the trick is that jtag_add_pathmove() must end in a stable
-					 * state, so we must only invoke jtag_add_tlr() when we absolutely
-					 * have to
-					 */
-					for(i=0,lasti=0;  i<path_len;  i++)
-					{
-						if(path[i]==TAP_RESET)
-						{
-							if(i>lasti)
-							{
-								jtag_add_pathmove(i-lasti,path+lasti);
-							}
-							lasti=i+1;
-							jtag_add_tlr();
-						}
-					}
-					if(i>=lasti)
-					{
-						jtag_add_pathmove(i-lasti, path+lasti);
-					}
-				}
-				free(path);
+				xsvf_add_statemove( mystate );
 			}
 			break;
 
@@ -710,7 +653,6 @@
 					
 					
 					field.in_handler = NULL;
-					
 
 					if (tap == NULL)
 						jtag_add_plain_ir_scan(1, &field, my_end_state);
@@ -761,7 +703,7 @@
 
 				comment[sizeof(comment)-1] = 0;		/* regardless, terminate */
 				if (verbose)
-					LOG_USER("%s", comment);
+					LOG_USER("\"# %s\"", comment);
 			}
 			break;
 



From oharboe at mail.berlios.de  Wed May  6 19:25:16 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 6 May 2009 19:25:16 +0200
Subject: [Openocd-svn] r1615 - trunk/src/jtag
Message-ID: <200905061725.n46HPGSg010168@sheep.berlios.de>

Author: oharboe
Date: 2009-05-06 19:25:14 +0200 (Wed, 06 May 2009)
New Revision: 1615

Modified:
   trunk/src/jtag/bitbang.c
Log:
transition more directly to the end state + reuse more of the state move code/paths

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2009-05-06 13:32:43 UTC (rev 1614)
+++ trunk/src/jtag/bitbang.c	2009-05-06 17:25:14 UTC (rev 1615)
@@ -84,12 +84,12 @@
 	}
 }
 
-static void bitbang_state_move(void)
+static void bitbang_state_move(int skip)
 {
 	int i=0, tms=0;
 	u8 tms_scan = tap_get_tms_path(tap_get_state(), tap_get_end_state());
 
-	for (i = 0; i < 7; i++)
+	for (i = skip; i < 7; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		bitbang_interface->write(0, tms, 0);
@@ -146,7 +146,7 @@
 	if (tap_get_state() != TAP_IDLE)
 	{
 		bitbang_end_state(TAP_IDLE);
-		bitbang_state_move();
+		bitbang_state_move(0);
 	}
 
 	/* execute num_cycles */
@@ -160,7 +160,7 @@
 	/* finish in end_state */
 	bitbang_end_state(saved_end_state);
 	if (tap_get_state() != tap_get_end_state())
-		bitbang_state_move();
+		bitbang_state_move(0);
 }
 
 
@@ -191,7 +191,7 @@
 		else
 			bitbang_end_state(TAP_DRSHIFT);
 
-		bitbang_state_move();
+		bitbang_state_move(0);
 		bitbang_end_state(saved_end_state);
 	}
 
@@ -227,22 +227,14 @@
 		}
 	}
 
-	/* TAP_DRSHIFT & TAP_IRSHIFT are illegal end states, so we always transition to the pause
-	 * state which is a legal stable state from which statemove will work.
-	 *
-	 * Exit1 -> Pause
-	 */
-	bitbang_interface->write(0, 0, 0);
-	bitbang_interface->write(1, 0, 0);
-	bitbang_interface->write(CLOCK_IDLE(), 0, 0);
-
-	if (ir_scan)
-		tap_set_state(TAP_IRPAUSE);
-	else
-		tap_set_state(TAP_DRPAUSE);
-
 	if (tap_get_state() != tap_get_end_state())
-		bitbang_state_move();
+	{
+		/* we *KNOW* the above loop transitioned out of
+		 * the shift state, so we skip the first state
+		 * and move directly to the end state.
+		 */
+		bitbang_state_move(1);
+	}
 }
 
 int bitbang_execute_queue(void)
@@ -310,7 +302,7 @@
 #endif
 				if (cmd->cmd.statemove->end_state != TAP_INVALID)
 					bitbang_end_state(cmd->cmd.statemove->end_state);
-				bitbang_state_move();
+				bitbang_state_move(0);
 				break;
 			case JTAG_PATHMOVE:
 #ifdef _DEBUG_JTAG_IO_



From mlu at mail.berlios.de  Wed May  6 19:28:46 2009
From: mlu at mail.berlios.de (mlu at mail.berlios.de)
Date: Wed, 6 May 2009 19:28:46 +0200
Subject: [Openocd-svn] r1616 - trunk/src/jtag
Message-ID: <200905061728.n46HSkNH015108@sheep.berlios.de>

Author: mlu
Date: 2009-05-06 19:28:39 +0200 (Wed, 06 May 2009)
New Revision: 1616

Modified:
   trunk/src/jtag/jlink.c
Log:
Small changes that might improve stability.
Implemented new jtag sequences tap_get_tms_path and tap_get_tms_path_len

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-05-06 17:25:14 UTC (rev 1615)
+++ trunk/src/jtag/jlink.c	2009-05-06 17:28:39 UTC (rev 1616)
@@ -57,8 +57,11 @@
 #define EMU_CMD_VERSION     		0x01
 #define EMU_CMD_SET_SPEED   		0x05
 #define EMU_CMD_GET_STATE   		0x07
+#define EMU_CMD_HW_CLOCK			0xc8
+#define EMU_CMD_HW_TMS0 			0xc9
+#define EMU_CMD_HW_TMS1 			0xca
 #define EMU_CMD_HW_JTAG3    		0xcf
-#define EMU_CMD_GET_MAX_MEM_BLOCK   0xd4
+#define EMU_CMD_GET_MAX_MEM_BLOCK	0xd4
 #define EMU_CMD_HW_RESET0   		0xdc
 #define EMU_CMD_HW_RESET1   		0xdd
 #define EMU_CMD_HW_TRST0    		0xde
@@ -183,7 +186,7 @@
 	enum scan_type type;
 	u8 *buffer;
 
-	DEBUG_JTAG_IO("scan end in %i", cmd->cmd.scan->end_state);
+	DEBUG_JTAG_IO("scan end in %s", tap_state_name(cmd->cmd.scan->end_state));
 
 	if (cmd->cmd.scan->end_state != TAP_INVALID)
 		jlink_end_state(cmd->cmd.scan->end_state);
@@ -206,10 +209,13 @@
 
 	jlink_tap_execute();
 
-	if (cmd->cmd.reset->trst == 1)
+	if ( (cmd->cmd.reset->trst == 1) || ( cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST) ) )
+	{
 		tap_set_state(TAP_RESET);
+	}
 
 	jlink_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
+	jlink_tap_execute();
 }
 
 static void jlink_execute_sleep(jtag_command_t *cmd)
@@ -333,6 +339,7 @@
 	LOG_INFO("J-Link JTAG Interface ready");
 
 	jlink_reset(0, 0);
+	jtag_sleep(3000);
 	jlink_tap_init();
 	jlink_speed(jtag_speed);
 
@@ -367,8 +374,9 @@
 	int i;
 	int tms = 0;
 	u8 tms_scan = tap_get_tms_path(tap_get_state(), tap_get_end_state());
+	u8 tms_scan_bits = tap_get_tms_path_len(tap_get_state(), tap_get_end_state());
 
-	for (i = 0; i < 7; i++)
+	for (i = 0; i < tms_scan_bits; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		jlink_tap_append_step(tms, 0);
@@ -414,6 +422,7 @@
 	{
 		jlink_end_state(TAP_IDLE);
 		jlink_state_move();
+//		num_cycles--;
 	}
 
 	/* execute num_cycles */
@@ -469,24 +478,23 @@
 	if (srst == 0)
 	{
 		jlink_simple_command(EMU_CMD_HW_RESET1);
-		jlink_end_state(TAP_RESET);
-		jlink_state_move();
 	}
-	else if (srst == 1)
+	if (srst == 1)
 	{
 		jlink_simple_command(EMU_CMD_HW_RESET0);
 	}
 
+	if (trst == 1)
+	{
+		jlink_simple_command(EMU_CMD_HW_TRST0);
+	}
 	if (trst == 0)
 	{
 		jlink_simple_command(EMU_CMD_HW_TRST1);
+		jtag_sleep(5000);
 		jlink_end_state(TAP_RESET);
 		jlink_state_move();
 	}
-	else if (trst == 1)
-	{
-		jlink_simple_command(EMU_CMD_HW_TRST0);
-	}
 }
 
 static void jlink_simple_command(u8 command)
@@ -602,9 +610,9 @@
 /* J-Link tap functions */
 
 /* 2048 is the max value we can use here */
-#define JLINK_TAP_BUFFER_SIZE 2048
+#define JLINK_TAP_BUFFER_SIZE 1024
 
-static unsigned tap_length;
+static unsigned tap_length=0;
 static u8 tms_buffer[JLINK_TAP_BUFFER_SIZE];
 static u8 tdi_buffer[JLINK_TAP_BUFFER_SIZE];
 static u8 tdo_buffer[JLINK_TAP_BUFFER_SIZE];
@@ -631,7 +639,7 @@
 static void jlink_tap_ensure_space(int scans, int bits)
 {
 	int available_scans = MAX_PENDING_SCAN_RESULTS - pending_scan_results_length;
-	int available_bits = JLINK_TAP_BUFFER_SIZE * 8 - tap_length;
+	int available_bits = JLINK_TAP_BUFFER_SIZE * 8 - tap_length - 64;
 
 	if (scans > available_scans || bits > available_bits)
 	{
@@ -654,7 +662,9 @@
 
 	// we do not pad TMS, so be sure to initialize all bits
 	if (0 == bit_index)
+	{
 		tms_buffer[index] = tdi_buffer[index] = 0;
+	}
 
 	if (tms)
 		tms_buffer[index] |= bit;
@@ -682,8 +692,8 @@
 
 	for (i = 0; i < length; i++)
 	{
-		int tms = i < length - 1 ? 0 : 1;
-		int tdi = buffer[i / 8] & (1 << (i % 8));
+		int tms = (i < (length - 1)) ? 0 : 1;
+		int tdi = (buffer[i / 8] & (1 << (i % 8)))!=0;
 		jlink_tap_append_step(tms, tdi);
 	}
 	pending_scan_results_length++;
@@ -700,6 +710,13 @@
 	if (!tap_length)
 		return ERROR_OK;
 
+	/* JLink returns an extra NULL in packet when size of in message is a multiple of 64, creates problems with usb comms */
+	/* WARNING This will interfere with tap state counting */
+	while ((TAP_SCAN_BYTES(tap_length)%64)==0)
+	{
+		jlink_tap_append_step((tap_get_state() == TAP_RESET)?1:0, 0);
+	}
+
 	// number of full bytes (plus one if some would be left over)
 	byte_length = TAP_SCAN_BYTES(tap_length);
 
@@ -839,9 +856,15 @@
 		result2 = jlink_usb_read_emu_result(jlink_jtag);
 		if (1 != result2)
 		{
-			LOG_ERROR("jlink_usb_read_emu_result failed "
-				"(requested=1, result=%d)", result2);
-			return ERROR_JTAG_DEVICE_ERROR;
+			LOG_ERROR("jlink_usb_read_emu_result retried requested=1, result=%d, in_length=%i", result2,in_length);
+			/* Try again once, should only happen if (in_length%64==0) */
+			result2 = jlink_usb_read_emu_result(jlink_jtag);
+			if (1 != result2)
+			{
+				LOG_ERROR("jlink_usb_read_emu_result failed "
+					"(requested=1, result=%d)", result2);
+				return ERROR_JTAG_DEVICE_ERROR;
+			}
 		}
 
 		/* Check the result itself */
@@ -975,3 +998,4 @@
 	}
 }
 #endif
+



From oharboe at mail.berlios.de  Wed May  6 20:18:01 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 6 May 2009 20:18:01 +0200
Subject: [Openocd-svn] r1617 - trunk/src/xsvf
Message-ID: <200905061818.n46II1hk009707@sheep.berlios.de>

Author: oharboe
Date: 2009-05-06 20:18:00 +0200 (Wed, 06 May 2009)
New Revision: 1617

Modified:
   trunk/src/xsvf/xsvf.c
Log:
Dick Hollenbeck <dick at softplc.com> part deux of previous changes just committed.

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-06 17:28:39 UTC (rev 1616)
+++ trunk/src/xsvf/xsvf.c	2009-05-06 18:18:00 UTC (rev 1617)
@@ -177,13 +177,13 @@
 /**
  * Function xsvf_add_statemove
  * moves from the current state to the goal \a state. This needs
- * to be handled according to the xsvf spec, which has nothing
- * to do with the JTAG spec or OpenOCD as such.
- *
- * Implemented via jtag_add_pathmove().
+ * to be handled according to the xsvf spec, see the XSTATE command
+ * description.
  */
-static void xsvf_add_statemove(tap_state_t goal_state)
+static int xsvf_add_statemove(tap_state_t goal_state)
 {
+	int retval = ERROR_OK;
+
 	tap_state_t moves[8];
 	tap_state_t cur_state = cmd_queue_cur_state;
 	int i;
@@ -194,29 +194,69 @@
 		tap_state_name(cur_state),
 		tap_state_name(goal_state) );
 
+
+	/*	From the XSVF spec, pertaining to XSTATE:
+
+		For special states known as stable states (Test-Logic-Reset,
+		Run-Test/Idle, Pause-DR, Pause- IR), an XSVF interpreter follows
+		predefined TAP state paths when the starting state is a stable state and
+		when the XSTATE specifies a new stable state (see the STATE command in
+		the [Ref 5] for the TAP state paths between stable states). For
+		non-stable states, XSTATE should specify a state that is only one TAP
+		state transition distance from the current TAP state to avoid undefined
+		TAP state paths. A sequence of multiple XSTATE commands can be issued to
+		transition the TAP through a specific state path.
+	*/
+
 	if (goal_state==cur_state )
-		return;
+		;	/* nothing to do */
 
-	if( goal_state==TAP_RESET )
+	else if( goal_state==TAP_RESET )
 	{
 		jtag_add_tlr();
-		return;
 	}
 
-	tms_bits  = tap_get_tms_path(cur_state, goal_state);
-	tms_count = tap_get_tms_path_len(cur_state, goal_state);
+	else if( tap_is_state_stable(cur_state) && tap_is_state_stable(goal_state) )
+	{
+		/* 	note: unless tms_bits holds a path that agrees with [Ref 5] in above
+			spec, then this code is not fully conformant to the xsvf spec.  This
+			puts a burden on tap_get_tms_path() function from the xsvf spec.
+			If in doubt, you should confirm that that burden is being met.
+		*/
 
-	assert( (unsigned) tms_count < DIM(moves) );
+		tms_bits  = tap_get_tms_path(cur_state, goal_state);
+		tms_count = tap_get_tms_path_len(cur_state, goal_state);
 
-	for (i=0;   i<tms_count;   i++, tms_bits>>=1)
+		assert( (unsigned) tms_count < DIM(moves) );
+
+		for (i=0;   i<tms_count;   i++, tms_bits>>=1)
+		{
+			bool bit = tms_bits & 1;
+
+			cur_state = tap_state_transition(cur_state, bit);
+			moves[i] = cur_state;
+		}
+
+		jtag_add_pathmove(tms_count, moves);
+	}
+
+	/* 	else state must be immediately reachable in one clock cycle, and does not
+		need to be a stable state.
+	*/
+	else if( tap_state_transition(cur_state, true)  == goal_state
+		||   tap_state_transition(cur_state, false) == goal_state )
 	{
-		bool bit = tms_bits & 1;
+		/* move a single state */
+		moves[0] = goal_state;
+		jtag_add_pathmove( 1, moves );
+	}
 
-		cur_state = tap_state_transition(cur_state, bit);
-		moves[i] = cur_state;
+	else
+	{
+		retval = ERROR_FAIL;
 	}
 
-	jtag_add_pathmove(tms_count, moves);
+	return retval;
 }
 
 
@@ -557,7 +597,32 @@
 
 				LOG_DEBUG("XSTATE 0x%02X %s", uc, tap_state_name(mystate) );
 
-				xsvf_add_statemove( mystate );
+				/* 	there is no need for the lookahead code that was here since we
+					queue up the jtag commands anyway.  This is a simple way to handle
+					the XSTATE.
+				*/
+
+				if( xsvf_add_statemove( mystate ) != ERROR_OK )
+				{
+					/*	For special states known as stable states
+						(Test-Logic-Reset, Run-Test/Idle, Pause-DR, Pause- IR),
+						an XSVF interpreter follows predefined TAP state paths
+						when the starting state is a stable state and when the
+						XSTATE specifies a new stable state (see the STATE
+						command in the [Ref 5] for the TAP state paths between
+						stable states). For non-stable states, XSTATE should
+						specify a state that is only one TAP state transition
+						distance from the current TAP state to avoid undefined
+						TAP state paths. A sequence of multiple XSTATE commands
+						can be issued to transition the TAP through a specific
+						state path.
+					*/
+
+					LOG_ERROR("XSTATE %s is not reachable from current state %s in one clock cycle",
+						tap_state_name(mystate),
+						tap_state_name(cmd_queue_cur_state)
+						);
+				}
 			}
 			break;
 
@@ -703,7 +768,7 @@
 
 				comment[sizeof(comment)-1] = 0;		/* regardless, terminate */
 				if (verbose)
-					LOG_USER("\"# %s\"", comment);
+					LOG_USER("# %s", comment);
 			}
 			break;
 



From oharboe at mail.berlios.de  Wed May  6 20:24:26 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 6 May 2009 20:24:26 +0200
Subject: [Openocd-svn] r1618 - trunk/src/jtag
Message-ID: <200905061824.n46IOQsp010485@sheep.berlios.de>

Author: oharboe
Date: 2009-05-06 20:24:24 +0200 (Wed, 06 May 2009)
New Revision: 1618

Modified:
   trunk/src/jtag/jtag.c
Log:
Dick Hollenbeck <dick at softplc.com> comments & 7 clock TMS reset for good measure

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-06 18:18:00 UTC (rev 1617)
+++ trunk/src/jtag/jtag.c	2009-05-06 18:24:24 UTC (rev 1618)
@@ -579,7 +579,7 @@
 			{
 				found = 1;
 				(*last_cmd)->cmd.scan->fields[nth_tap].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				
+
 				if (jtag_verify_capture_ir)
 				{
 					if (fields[j].in_handler==NULL)
@@ -938,7 +938,7 @@
 
 void jtag_add_pathmove(int num_states, tap_state_t *path)
 {
-	tap_state_t cur_state=cmd_queue_cur_state;
+	tap_state_t cur_state = cmd_queue_cur_state;
 	int i;
 	int retval;
 
@@ -956,6 +956,7 @@
 			LOG_ERROR("BUG: TAP_RESET is not a valid state for pathmove sequences");
 			exit(-1);
 		}
+
 		if ( tap_state_transition(cur_state, true)  != path[i]
 		  && tap_state_transition(cur_state, false) != path[i])
 		{
@@ -967,7 +968,7 @@
 
 	jtag_prelude1();
 
-	retval=interface_jtag_add_pathmove(num_states, path);
+	retval = interface_jtag_add_pathmove(num_states, path);
 	cmd_queue_cur_state = path[num_states - 1];
 	if (retval!=ERROR_OK)
 		jtag_error=retval;
@@ -1489,7 +1490,6 @@
 	
 	
 	field.in_handler = NULL;
-	
 
 	for (i = 0; i < JTAG_MAX_CHAIN_SIZE; i++)
 	{
@@ -1667,7 +1667,6 @@
 	
 	
 	field.in_handler = NULL;
-	
 
 	jtag_add_plain_ir_scan(1, &field, TAP_RESET);
 	jtag_execute_queue();
@@ -3127,29 +3126,40 @@
 		some long-standing problems.
 		Jeff
 
-		I added the bit count into the table
+		I added the bit count into the table, reduced RESET column to 7 bits from 8.
 		Dick
+
+		state specific comments:
+		------------------------
+		*->RESET		   tried the 5 bit reset and it gave me problems, 7 bits seems to
+					   work better on ARM9 with ft2232 driver.  (Dick)
+
+		RESET->DRSHIFT add 1 extra clock cycles in the RESET state before advancing.
+						needed on ARM9 with ft2232 driver.  (Dick)
+
+		RESET->IRSHIFT add 1 extra clock cycles in the RESET state before advancing.
+						needed on ARM9 with ft2232 driver.  (Dick)
 	*/
 
 	/* to state: */
-	/*	RESET			IDLE				DRSHIFT			DRPAUSE			IRSHIFT	  		IRPAUSE */		/* from state: */
-	{	B8(11111,5),		B8(0,1),			B8(0010,4), 		B8(01010,5),		B8(00110,5), 	B8(010110,6) },	/* RESET */
-	{	B8(11111,5),		B8(0,1),			B8(001,3),  		B8(0101,4),		B8(0011,4),  	B8(01011,5) },	/* IDLE */
-	{	B8(11111,5),		B8(011,3),		B8(00111,5),		B8(01,2),		B8(001111,6),	B8(0101111,7) },	/* DRSHIFT */
-	{	B8(11111,5),		B8(011,3),		B8(01,2),   		B8(0,1),			B8(001111,6),	B8(0101111,7) },	/* DRPAUSE */
-	{	B8(11111,5),		B8(011,3),		B8(00111,5),		B8(010111,6), 	B8(001111,6),	B8(01,2) },		/* IRSHIFT */
-	{	B8(11111,5),		B8(011,3),		B8(00111,5),		B8(010111,6),	B8(01,2),   		B8(0,1) } 		/* IRPAUSE */
+	/*	RESET			IDLE				DRSHIFT			DRPAUSE			IRSHIFT	  		IRPAUSE */			/* from state: */
+	{	B8(1111111,7),	B8(0,1),			B8(00101,5), 	B8(01010,5),		B8(001101,6), 	B8(010110,6) },		/* RESET */
+	{	B8(1111111,7),	B8(0,1),			B8(001,3),		B8(0101,4),		B8(0011,4),  	B8(01011,5) },		/* IDLE */
+	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(01,2),		B8(001111,6),	B8(0101111,7) },		/* DRSHIFT */
+	{	B8(1111111,7),	B8(011,3),		B8(01,2),   		B8(0,1),			B8(001111,6),	B8(0101111,7) },		/* DRPAUSE */
+	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(010111,6), 	B8(001111,6),	B8(01,2) },			/* IRSHIFT */
+	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(010111,6),	B8(01,2),		B8(0,1) } 			/* IRPAUSE */
 
 #else	/* this is the old table, converted from hex and with the bit_count set to 7 for each combo, like before */
 
 	/* to state: */
-	/*	RESET			IDLE			DRSHIFT			DRPAUSE			IRSHIFT			IRPAUSE 	*/		/* from state: */
-	{	B8(1111111,7),	B8(0000000,7),	B8(0010111,7),	B8(0001010,7),	B8(0011011,7),	B8(0010110,7) },	/* RESET */
-	{	B8(1111111,7),	B8(0000000,7),	B8(0100101,7),	B8(0000101,7),	B8(0101011,7),	B8(0001011,7) },	/* IDLE */
-	{	B8(1111111,7),	B8(0110001,7),	B8(0000000,7),	B8(0000001,7),	B8(0001111,7),	B8(0101111,7) },	/* DRSHIFT */
-	{	B8(1111111,7),	B8(0110000,7),	B8(0100000,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },	/* DRPAUSE */
-	{	B8(1111111,7),	B8(0110001,7),	B8(0000111,7),	B8(0010111,7),	B8(0000000,7),	B8(0000001,7) },	/* IRSHIFT */
-	{	B8(1111111,7),	B8(0110000,7),	B8(0011100,7),	B8(0010111,7),	B8(0100000,7),	B8(0101111,7) },	/* IRPAUSE */
+	/*	RESET			IDLE				DRSHIFT			DRPAUSE			IRSHIFT	  		IRPAUSE */			/* from state: */
+	{	B8(1111111,7),	B8(0000000,7),	B8(0010111,7), 	B8(0001010,7),	B8(0011011,7), 	B8(0010110,7) },		/* RESET */
+	{	B8(1111111,7),	B8(0000000,7),	B8(0100101,7),	B8(0000101,7),	B8(0101011,7),	B8(0001011,7) },		/* IDLE */
+	{	B8(1111111,7),	B8(0110001,7),	B8(0000000,7),	B8(0000001,7),	B8(0001111,7),	B8(0101111,7) },		/* DRSHIFT */
+	{	B8(1111111,7),	B8(0110000,7),	B8(0100000,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },		/* DRPAUSE */
+	{	B8(1111111,7),	B8(0110001,7),	B8(0000111,7),	B8(0010111,7), 	B8(0000000,7),	B8(0000001,7) },		/* IRSHIFT */
+	{	B8(1111111,7),	B8(0110000,7),	B8(0011100,7),	B8(0010111,7),	B8(0100000,7),	B8(0101111,7) } 		/* IRPAUSE */
 
 #endif
 



From mlu at mail.berlios.de  Wed May  6 20:47:16 2009
From: mlu at mail.berlios.de (mlu at mail.berlios.de)
Date: Wed, 6 May 2009 20:47:16 +0200
Subject: [Openocd-svn] r1619 - trunk/src/jtag
Message-ID: <200905061847.n46IlG7m013387@sheep.berlios.de>

Author: mlu
Date: 2009-05-06 20:47:15 +0200 (Wed, 06 May 2009)
New Revision: 1619

Modified:
   trunk/src/jtag/jtag.c
Log:
Added  (BUILD_JLINK==1) condition to us new tables with JLink


Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-06 18:24:24 UTC (rev 1618)
+++ trunk/src/jtag/jtag.c	2009-05-06 18:47:15 UTC (rev 1619)
@@ -3116,7 +3116,7 @@
 
 #define B8(bits,count)		{ ((u8)B8__(HEX__(bits))), (count) }
 
-#if 0 && ((BUILD_FT2232_FTD2XX==1) || (BUILD_FT2232_LIBFTDI==1))
+#if 0 && ((BUILD_FT2232_FTD2XX==1) || (BUILD_FT2232_LIBFTDI==1) || (BUILD_JLINK==1))
 	/* 	this is the table submitted by Jeff Williams on 3/30/2009 with this comment:
 
 		OK, I added Peter's version of the state table, and it works OK for



From zwelch at mail.berlios.de  Wed May  6 23:21:22 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 6 May 2009 23:21:22 +0200
Subject: [Openocd-svn] r1620 - trunk/src/helper
Message-ID: <200905062121.n46LLMe4031249@sheep.berlios.de>

Author: zwelch
Date: 2009-05-06 23:21:18 +0200 (Wed, 06 May 2009)
New Revision: 1620

Modified:
   trunk/src/helper/jim.c
Log:
Fix pointer cast alignment warnings in jim.c.

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-06 18:47:15 UTC (rev 1619)
+++ trunk/src/helper/jim.c	2009-05-06 21:21:18 UTC (rev 1620)
@@ -7650,6 +7650,8 @@
                 scanned += 1;
                 break;
             case 'd': case 'o': case 'x': case 'u': case 'i': {
+                jim_wide jwvalue;
+                long lvalue;
                 char *endp;  /* Position where the number finished */
                 int base = descr->type == 'o' ? 8
                     : descr->type == 'x' ? 16
@@ -7659,16 +7661,22 @@
                 do {
                     /* Try to scan a number with the given base */
                     if (descr->modifier == 'l')
+                    {
 #ifdef HAVE_LONG_LONG
-                      *(jim_wide*)value = JimStrtoll(tok, &endp, base);
+                        jwvalue = JimStrtoll(tok, &endp, base),
 #else
-                      *(jim_wide*)value = strtol(tok, &endp, base);
+                        jwvalue = strtol(tok, &endp, base),
 #endif
+                        memcpy(value, &jwvalue, sizeof(jim_wide));
+                    }
                     else
+                    {
                       if (descr->type == 'u')
-                        *(long*)value = strtoul(tok, &endp, base);
+                        lvalue = strtoul(tok, &endp, base);
                       else
-                        *(long*)value = strtol(tok, &endp, base);
+                        lvalue = strtol(tok, &endp, base);
+                      memcpy(value, &lvalue, sizeof(lvalue));
+                    }
                     /* If scanning failed, and base was undetermined, simply
                      * put it to 10 and try once more. This should catch the
                      * case where %i begin to parse a number prefix (e.g. 
@@ -7680,9 +7688,9 @@
                 if (endp != tok) {
                     /* There was some number sucessfully scanned! */
                     if (descr->modifier == 'l')
-                        *valObjPtr = Jim_NewIntObj(interp, *(jim_wide*)value);
+                        *valObjPtr = Jim_NewIntObj(interp, jwvalue);
                     else
-                        *valObjPtr = Jim_NewIntObj(interp, *(long*)value);
+                        *valObjPtr = Jim_NewIntObj(interp, lvalue);
                     /* Adjust the number-of-chars scanned so far */
                     scanned += endp - tok;
                 } else {
@@ -7701,10 +7709,11 @@
             case 'e': case 'f': case 'g': {
                 char *endp;
 
-                *(double*)value = strtod(tok, &endp);
+                double dvalue = strtod(tok, &endp);
+                memcpy(value, &dvalue, sizeof(double));
                 if (endp != tok) {
                     /* There was some number sucessfully scanned! */
-                    *valObjPtr = Jim_NewDoubleObj(interp, *(double*)value);
+                    *valObjPtr = Jim_NewDoubleObj(interp, dvalue);
                     /* Adjust the number-of-chars scanned so far */
                     scanned += endp - tok;
                 } else {



From zwelch at mail.berlios.de  Wed May  6 23:48:42 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 6 May 2009 23:48:42 +0200
Subject: [Openocd-svn] r1621 - trunk
Message-ID: <200905062148.n46Lmg4t000374@sheep.berlios.de>

Author: zwelch
Date: 2009-05-06 23:48:39 +0200 (Wed, 06 May 2009)
New Revision: 1621

Modified:
   trunk/configure.in
Log:
Add configure script check to enable C99 build option.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-06 21:21:18 UTC (rev 1620)
+++ trunk/configure.in	2009-05-06 21:48:39 UTC (rev 1621)
@@ -781,6 +781,7 @@
 
 AC_LANG_C
 AC_PROG_CC
+AC_PROG_CC_C99
 AM_PROG_CC_C_O
 AC_PROG_RANLIB
 



From zwelch at mail.berlios.de  Thu May  7 01:06:08 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 7 May 2009 01:06:08 +0200
Subject: [Openocd-svn] r1622 - trunk/src/svf
Message-ID: <200905062306.n46N68Hs032580@sheep.berlios.de>

Author: zwelch
Date: 2009-05-07 01:05:57 +0200 (Thu, 07 May 2009)
New Revision: 1622

Modified:
   trunk/src/svf/svf.c
Log:
Fix pointer cast alignment issues in svf.c

Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-06 21:48:39 UTC (rev 1621)
+++ trunk/src/svf/svf.c	2009-05-06 23:05:57 UTC (rev 1622)
@@ -653,11 +653,17 @@
 			{
 				if ((svf_tdi_buffer[index + j] & svf_mask_buffer[index + j]) != svf_tdo_buffer[index + j])
 				{
-					LOG_ERROR("tdo check error at line %d, read = 0x%X, want = 0x%X, mask = 0x%X",
+					unsigned bitmask = (1 << svf_check_tdo_para[i].bit_len) - 1;
+					unsigned received, expected, tapmask;
+					memcpy(&received, svf_tdi_buffer + index, sizeof(unsigned));
+					memcpy(&expected, svf_tdo_buffer + index, sizeof(unsigned));
+					memcpy(&tapmask, svf_mask_buffer + index, sizeof(unsigned));
+					LOG_ERROR("tdo check error at line %d, "
+						"read = 0x%X, want = 0x%X, mask = 0x%X",
 								svf_check_tdo_para[i].line_num,
-								(*(int*)(svf_tdi_buffer + index)) & ((1 << svf_check_tdo_para[i].bit_len) - 1),
-								(*(int*)(svf_tdo_buffer + index)) & ((1 << svf_check_tdo_para[i].bit_len) - 1),
-								(*(int*)(svf_mask_buffer + index)) & ((1 << svf_check_tdo_para[i].bit_len) - 1));
+								received & bitmask,
+								expected & bitmask,
+								tapmask & bitmask);
 					return ERROR_FAIL;
 				}
 			}
@@ -1381,8 +1387,11 @@
 			// output debug info
 			if ((SIR == command) || (SDR == command))
 			{
+				int read_value;
+				memcpy(&read_value, svf_tdi_buffer, sizeof(int));
 				// in debug mode, data is from index 0
-				LOG_DEBUG("\tTDO read = 0x%X", (*(int*)svf_tdi_buffer) & ((1 << (svf_check_tdo_para[0].bit_len)) - 1));
+				int read_mask = (1 << (svf_check_tdo_para[0].bit_len)) - 1;
+				LOG_DEBUG("\tTDO read = 0x%X", read_value & read_mask);
 			}
 		}
 	}



From zwelch at mail.berlios.de  Thu May  7 01:25:34 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 7 May 2009 01:25:34 +0200
Subject: [Openocd-svn] r1623 - trunk/src/target
Message-ID: <200905062325.n46NPYKb023179@sheep.berlios.de>

Author: zwelch
Date: 2009-05-07 01:25:27 +0200 (Thu, 07 May 2009)
New Revision: 1623

Modified:
   trunk/src/target/armv7m.c
   trunk/src/target/register.h
Log:
Change reg_s value field from u8 * to void *; it must always be cast.

Modified: trunk/src/target/armv7m.c
===================================================================
--- trunk/src/target/armv7m.c	2009-05-06 23:05:57 UTC (rev 1622)
+++ trunk/src/target/armv7m.c	2009-05-06 23:25:27 UTC (rev 1623)
@@ -289,7 +289,7 @@
 
 	/* ARMV7M is always in thumb mode, try to make GDB understand this
 	 * if it does not support this arch */
-	armv7m->core_cache->reg_list[15].value[0] |= 1;
+	*((char*)armv7m->core_cache->reg_list[15].value) |= 1;
 #else
 	(*reg_list)[25] = &armv7m->core_cache->reg_list[ARMV7M_xPSR];
 #endif

Modified: trunk/src/target/register.h
===================================================================
--- trunk/src/target/register.h	2009-05-06 23:05:57 UTC (rev 1622)
+++ trunk/src/target/register.h	2009-05-06 23:25:27 UTC (rev 1623)
@@ -37,7 +37,7 @@
 typedef struct reg_s
 {
 	char *name;
-	u8 *value;
+	void *value;
 	int dirty;
 	int valid;
 	u32 size;



From zwelch at mail.berlios.de  Thu May  7 01:28:41 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 7 May 2009 01:28:41 +0200
Subject: [Openocd-svn] r1624 - trunk/src/target
Message-ID: <200905062328.n46NSfK0025954@sheep.berlios.de>

Author: zwelch
Date: 2009-05-07 01:28:38 +0200 (Thu, 07 May 2009)
New Revision: 1624

Modified:
   trunk/src/target/image.c
Log:
Fix pointer cast alignment warnings in target/image.c.

Modified: trunk/src/target/image.c
===================================================================
--- trunk/src/target/image.c	2009-05-06 23:25:27 UTC (rev 1623)
+++ trunk/src/target/image.c	2009-05-06 23:28:38 UTC (rev 1624)
@@ -217,7 +217,9 @@
 
 			while (count-- > 0)
 			{
-				sscanf(&lpszLine[bytes_read], "%2x", (u32*)&ihex->buffer[cooked_bytes]);
+				unsigned value;
+				sscanf(&lpszLine[bytes_read], "%2x", &value);
+				ihex->buffer[cooked_bytes] = (u8)value;
 				cal_checksum += (u8)ihex->buffer[cooked_bytes];
 				bytes_read += 2;
 				cooked_bytes += 1;
@@ -594,7 +596,9 @@
 
 			while (count-- > 0)
 			{
-				sscanf(&lpszLine[bytes_read], "%2x", (u32*)&mot->buffer[cooked_bytes]);
+				unsigned value;
+				sscanf(&lpszLine[bytes_read], "%2x", &value);
+				mot->buffer[cooked_bytes] = (u8)value;
 				cal_checksum += (u8)mot->buffer[cooked_bytes];
 				bytes_read += 2;
 				cooked_bytes += 1;



From zwelch at mail.berlios.de  Thu May  7 01:31:54 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 7 May 2009 01:31:54 +0200
Subject: [Openocd-svn] r1625 - trunk/src/target
Message-ID: <200905062331.n46NVssW028677@sheep.berlios.de>

Author: zwelch
Date: 2009-05-07 01:31:50 +0200 (Thu, 07 May 2009)
New Revision: 1625

Modified:
   trunk/src/target/xscale.c
Log:
Fix pointer cast alignment warning in XScale miniIC loader parity calc.

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-06 23:28:38 UTC (rev 1624)
+++ trunk/src/target/xscale.c	2009-05-06 23:31:50 UTC (rev 1625)
@@ -833,7 +833,11 @@
 	for (word = 0; word < 8; word++)
 	{
 		buf_set_u32(packet, 0, 32, buffer[word]);
-		cmd = parity(*((u32*)packet));
+
+		u32 value;
+		memcpy(&value, packet, sizeof(u32));
+		cmd = parity(value);
+
 		jtag_add_dr_scan(2, fields, TAP_INVALID);
 	}
 



From zwelch at mail.berlios.de  Thu May  7 02:22:08 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 7 May 2009 02:22:08 +0200
Subject: [Openocd-svn] r1626 - trunk/src/flash
Message-ID: <200905070022.n470M8QR021151@sheep.berlios.de>

Author: zwelch
Date: 2009-05-07 02:21:59 +0200 (Thu, 07 May 2009)
New Revision: 1626

Modified:
   trunk/src/flash/pic32mx.c
   trunk/src/flash/stm32x.c
Log:
Fix stm32x and pic32mx flash pointer cast alignment warnings, simplify their last word handling.

Modified: trunk/src/flash/pic32mx.c
===================================================================
--- trunk/src/flash/pic32mx.c	2009-05-06 23:31:50 UTC (rev 1625)
+++ trunk/src/flash/pic32mx.c	2009-05-07 00:21:59 UTC (rev 1626)
@@ -463,9 +463,10 @@
 
 	while(count > 0)
 	{
-		u32 status;
+		u32 value;
+		memcpy(&value, buffer, sizeof(u32));
 
-		status = pic32mx_write_word(bank, address, *(u32*)buffer);
+		u32 status = pic32mx_write_word(bank, address, value);
 		if( status & NVMCON_NVMERR ) {
 			LOG_ERROR("Flash write error NVMERR (status=0x%08x)", status);
 			retval = ERROR_FLASH_OPERATION_FAILED;
@@ -568,8 +569,10 @@
 
 	while (words_remaining > 0)
 	{
-		status = pic32mx_write_word(bank, address, *(u32*)(buffer + bytes_written));
+		u32 value;
+		memcpy(&value, buffer + bytes_written, sizeof(u32));
 
+		status = pic32mx_write_word(bank, address, value);
 		if( status & NVMCON_NVMERR )
 			return ERROR_FLASH_OPERATION_FAILED;
 		if( status & NVMCON_LVDERR )
@@ -582,19 +585,10 @@
 
 	if (bytes_remaining)
 	{
-		u8 last_word[4] = {0xff, 0xff, 0xff, 0xff};
-		int i = 0;
+		u32 value = 0xffffffff;
+		memcpy(&value, buffer + bytes_written, bytes_remaining);
 
-		while(bytes_remaining > 0)
-		{
-			/* Assumes little endian */
-			last_word[i++] = *(buffer + bytes_written);
-			bytes_remaining--;
-			bytes_written++;
-		}
-
-		status = pic32mx_write_word(bank, address, *(u32*)last_word);
-
+		status = pic32mx_write_word(bank, address, value);
 		if( status & NVMCON_NVMERR )
 			return ERROR_FLASH_OPERATION_FAILED;
 		if( status & NVMCON_LVDERR )

Modified: trunk/src/flash/stm32x.c
===================================================================
--- trunk/src/flash/stm32x.c	2009-05-06 23:31:50 UTC (rev 1625)
+++ trunk/src/flash/stm32x.c	2009-05-07 00:21:59 UTC (rev 1626)
@@ -658,8 +658,11 @@
 
 	while (words_remaining > 0)
 	{
+		u16 value;
+		memcpy(&value, buffer + bytes_written, sizeof(u16));
+
 		target_write_u32(target, STM32_FLASH_CR, FLASH_PG);
-		target_write_u16(target, address, *(u16*)(buffer + bytes_written));
+		target_write_u16(target, address, value);
 		
 		status = stm32x_wait_status_busy(bank, 5);
 		
@@ -681,18 +684,11 @@
 	
 	if (bytes_remaining)
 	{
-		u8 last_halfword[2] = {0xff, 0xff};
-		int i = 0;
-				
-		while(bytes_remaining > 0)
-		{
-			last_halfword[i++] = *(buffer + bytes_written); 
-			bytes_remaining--;
-			bytes_written++;
-		}
-		
+		u16 value = 0xffff;
+		memcpy(&value, buffer + bytes_written, bytes_remaining);
+
 		target_write_u32(target, STM32_FLASH_CR, FLASH_PG);
-		target_write_u16(target, address, *(u16*)last_halfword);
+		target_write_u16(target, address, value);
 		
 		status = stm32x_wait_status_busy(bank, 5);
 		



From zwelch at mail.berlios.de  Thu May  7 02:58:41 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 7 May 2009 02:58:41 +0200
Subject: [Openocd-svn] r1627 - trunk/src/target
Message-ID: <200905070058.n470wftL026937@sheep.berlios.de>

Author: zwelch
Date: 2009-05-07 02:58:38 +0200 (Thu, 07 May 2009)
New Revision: 1627

Modified:
   trunk/src/target/arm_adi_v5.c
Log:
Fix pointer cast alignment warnings in arm_adi_v5.c

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-07 00:21:59 UTC (rev 1626)
+++ trunk/src/target/arm_adi_v5.c	2009-05-07 00:58:38 UTC (rev 1627)
@@ -45,6 +45,7 @@
 #include "log.h"
 #include "time_support.h"
 #include <stdlib.h>
+#include <string.h>
 
 /*
  * Transaction Mode:
@@ -448,7 +449,6 @@
 *****************************************************************************/
 int mem_ap_write_buf_u32(swjdp_common_t *swjdp, u8 *buffer, int count, u32 address)
 {
-	u32 outvalue;
 	int wcount, blocksize, writecount, errorcount = 0, retval = ERROR_OK;
 	u32 adr = address;
 	u8* pBuffer = buffer;
@@ -464,7 +464,8 @@
 		for (writecount = 0; writecount < count; writecount++)
 		{
 			int i;
-			outvalue = *((u32*)pBuffer);
+			u32 outvalue;
+			memcpy(&outvalue, pBuffer, sizeof(u32));
 
 			for (i = 0; i < 4; i++ )
 			{
@@ -472,7 +473,7 @@
 				outvalue >>= 8;
 				adr++;
 			}
-			pBuffer += 4;
+			pBuffer += sizeof(u32);
 		}
 	}
 
@@ -517,7 +518,6 @@
 
 int mem_ap_write_buf_packed_u16(swjdp_common_t *swjdp, u8 *buffer, int count, u32 address)
 {
-	u32 outvalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, writecount, i;
 
@@ -558,7 +558,8 @@
 			}
 			else
 			{
-				outvalue = *((u32*)buffer);
+				u32 outvalue;
+				memcpy(&outvalue, buffer, sizeof(u32));
 
 				for (i = 0; i < nbytes; i++ )
 				{
@@ -567,7 +568,7 @@
 					address++;
 				}
 
-				outvalue = *((u32*)buffer);
+				memcpy(&outvalue, buffer, sizeof(u32));
 				dap_ap_write_reg_u32(swjdp, AP_REG_DRW, outvalue);
 				if (swjdp_transaction_endcheck(swjdp) != ERROR_OK)
 				{
@@ -588,7 +589,6 @@
 
 int mem_ap_write_buf_u16(swjdp_common_t *swjdp, u8 *buffer, int count, u32 address)
 {
-	u32 outvalue;
 	int retval = ERROR_OK;
 
 	if (count >= 4)
@@ -599,7 +599,9 @@
 	while (count > 0)
 	{
 		dap_setup_accessport(swjdp, CSW_16BIT | CSW_ADDRINC_SINGLE, address);
-		outvalue = *((u16*)buffer) << 8 * (address & 0x3);
+		u16 svalue;
+		memcpy(&svalue, buffer, sizeof(u16));
+		u32 outvalue = (u32)svalue << 8 * (address & 0x3);
 		dap_ap_write_reg_u32(swjdp, AP_REG_DRW, outvalue );
 		retval = swjdp_transaction_endcheck(swjdp);
 		count -= 2;
@@ -612,7 +614,6 @@
 
 int mem_ap_write_buf_packed_u8(swjdp_common_t *swjdp, u8 *buffer, int count, u32 address)
 {
-	u32 outvalue;
 	int retval = ERROR_OK;
 	int wcount, blocksize, writecount, i;
 
@@ -649,7 +650,8 @@
 			}
 			else
 			{
-				outvalue = *((u32*)buffer);
+				u32 outvalue;
+				memcpy(&outvalue, buffer, sizeof(u32));
 
 				for (i = 0; i < nbytes; i++ )
 				{
@@ -658,7 +660,7 @@
 					address++;
 				}
 
-				outvalue = *((u32*)buffer);
+				memcpy(&outvalue, buffer, sizeof(u32));
 				dap_ap_write_reg_u32(swjdp, AP_REG_DRW, outvalue);
 				if (swjdp_transaction_endcheck(swjdp) != ERROR_OK)
 				{
@@ -679,7 +681,6 @@
 
 int mem_ap_write_buf_u8(swjdp_common_t *swjdp, u8 *buffer, int count, u32 address)
 {
-	u32 outvalue;
 	int retval = ERROR_OK;
 
 	if (count >= 4)
@@ -690,7 +691,7 @@
 	while (count > 0)
 	{
 		dap_setup_accessport(swjdp, CSW_8BIT | CSW_ADDRINC_SINGLE, address);
-		outvalue = *((u8*)buffer) << 8 * (address & 0x3);
+		u32 outvalue = (u32)*buffer << 8 * (address & 0x3);
 		dap_ap_write_reg_u32(swjdp, AP_REG_DRW, outvalue );
 		retval = swjdp_transaction_endcheck(swjdp);
 		count--;
@@ -766,7 +767,8 @@
 		for (readcount = 0; readcount < count; readcount++)
 		{
 			int i;
-			u32 data = *((u32*)pBuffer);
+			u32 data;
+			memcpy(&data, pBuffer, sizeof(u32));
 
 			for (i = 0; i < 4; i++ )
 			{
@@ -858,7 +860,8 @@
 		}
 		else
 		{
-			*((u16*)buffer) = (invalue >> 8 * (address & 0x3));
+			u16 svalue = (invalue >> 8 * (address & 0x3));
+			memcpy(buffer, &svalue, sizeof(u16));
 			address += 2;
 			buffer += 2;
 		}



From zwelch at mail.berlios.de  Thu May  7 03:27:03 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 7 May 2009 03:27:03 +0200
Subject: [Openocd-svn] r1628 - trunk/src/target
Message-ID: <200905070127.n471R323001596@sheep.berlios.de>

Author: zwelch
Date: 2009-05-07 03:26:56 +0200 (Thu, 07 May 2009)
New Revision: 1628

Modified:
   trunk/src/target/arm11.c
Log:
Fix most pointer cast alignment warnings in arm11.c; fix u16 memory reads..

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-07 00:58:38 UTC (rev 1627)
+++ trunk/src/target/arm11.c	2009-05-07 01:26:56 UTC (rev 1628)
@@ -1144,10 +1144,7 @@
 		{
 			arm11->reg_list[ARM11_RC_R1].dirty = 1;
 
-			u16 * buf16 = (u16*)buffer;
-
-			{size_t i;
-			for (i = 0; i < count; i++)
+			for (size_t i = 0; i < count; i++)
 			{
 				/* ldrh    r1, [r0], #2 */
 				arm11_run_instr_no_data1(arm11,
@@ -1158,20 +1155,24 @@
 				/* MCR p14,0,R1,c0,c5,0 */
 				arm11_run_instr_data_from_core(arm11, 0xEE001E15, &res, 1);
 
-				*buf16++ = res;
-			}}
+				u16 svalue = res;
+				memcpy(buffer + count * sizeof(u16), &svalue, sizeof(u16));
+			}
 
 			break;
 		}
 
 	case 4:
+		{
+		u32 instr = !arm11_config_memrw_no_increment ? 0xecb05e01 : 0xed905e00;
+		/** \todo TODO: buffer cast to u32* causes alignment warnings */
+		u32 *words = (u32 *)buffer;
 
 		/* LDC p14,c5,[R0],#4 */
 		/* LDC p14,c5,[R0] */
-		arm11_run_instr_data_from_core(arm11,
-			(!arm11_config_memrw_no_increment ? 0xecb05e01 : 0xed905e00),
-			(u32 *)buffer, count);
+		arm11_run_instr_data_from_core(arm11, instr, words, count);
 		break;
+		}
 	}
 
 	arm11_run_instr_data_finish(arm11);
@@ -1223,45 +1224,45 @@
 		{
 			arm11->reg_list[ARM11_RC_R1].dirty = 1;
 
-			u16 * buf16 = (u16*)buffer;
+			for (size_t i = 0; i < count; i++)
+			{
+				u16 value;
+				memcpy(&value, buffer + count * sizeof(u16), sizeof(u16));
 
-			{size_t i;
-			for (i = 0; i < count; i++)
-			{
 				/* MRC p14,0,r1,c0,c5,0 */
-				arm11_run_instr_data_to_core1(arm11, 0xee101e15, *buf16++);
+				arm11_run_instr_data_to_core1(arm11, 0xee101e15, value);
 
 				/* strh    r1, [r0], #2 */
 				/* strh    r1, [r0] */
 				arm11_run_instr_no_data1(arm11,
 					!arm11_config_memrw_no_increment ? 0xe0c010b2 : 0xe1c010b0);
-			}}
+			}
 
 			break;
 		}
 
-	case 4:
-		/** \todo TODO: check if buffer cast to u32* might cause alignment problems */
+	case 4: {
+		u32 instr = !arm11_config_memrw_no_increment ? 0xeca05e01 : 0xed805e00;
 
+		/** \todo TODO: buffer cast to u32* causes alignment warnings */
+		u32 *words = (u32*)buffer;
+
 		if (!arm11_config_memwrite_burst)
 		{
 			/* STC p14,c5,[R0],#4 */
 			/* STC p14,c5,[R0]*/
-			arm11_run_instr_data_to_core(arm11,
-				(!arm11_config_memrw_no_increment ? 0xeca05e01 : 0xed805e00),
-				(u32 *)buffer, count);
+			arm11_run_instr_data_to_core(arm11, instr, words, count);
 		}
 		else
 		{
 			/* STC p14,c5,[R0],#4 */
 			/* STC p14,c5,[R0]*/
-			arm11_run_instr_data_to_core_noack(arm11,
-				(!arm11_config_memrw_no_increment ? 0xeca05e01 : 0xed805e00),
-				(u32 *)buffer, count);
+			arm11_run_instr_data_to_core_noack(arm11, instr, words, count);
 		}
 
 		break;
 	}
+	}
 
 #if 1
 	/* r0 verification */



From oharboe at mail.berlios.de  Thu May  7 08:29:09 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 08:29:09 +0200
Subject: [Openocd-svn] r1629 - in trunk/src: jtag target
Message-ID: <200905070629.n476T9pm002010@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 08:29:08 +0200 (Thu, 07 May 2009)
New Revision: 1629

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/zy1000.c
   trunk/src/target/arm7tdmi.c
Log:
added template for removing in_handler 

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-07 01:26:56 UTC (rev 1628)
+++ trunk/src/jtag/jtag.c	2009-05-07 06:29:08 UTC (rev 1629)
@@ -42,6 +42,8 @@
 #include <strings.h>
 #endif
 
+static void jtag_execute_queue_noclear(void);
+
 /* note that this is not marked as static as it must be available from outside jtag.c for those
    that implement the jtag_xxx() minidriver layer
 */
@@ -670,6 +672,12 @@
 		jtag_error=retval;
 }
 
+void jtag_add_dr_scan_now(int num_fields, scan_field_t *fields, tap_state_t state)
+{
+	jtag_add_dr_scan(num_fields, fields, state);
+	jtag_execute_queue_noclear();
+}
+
 int MINIDRIVER(interface_jtag_add_dr_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
 {
 	int j;
@@ -1438,13 +1446,21 @@
 	return retval;
 }
 
-int jtag_execute_queue(void)
+static void jtag_execute_queue_noclear(void)
 {
 	int retval=interface_jtag_execute_queue();
-	if (retval==ERROR_OK)
+	/* we keep the first error */
+	if ((jtag_error==ERROR_OK)&&(retval!=ERROR_OK))
 	{
-		retval=jtag_error;
+		jtag_error=retval;
 	}
+}
+
+int jtag_execute_queue(void)
+{
+	int retval;
+	jtag_execute_queue_noclear();
+	retval=jtag_error;
 	jtag_error=ERROR_OK;
 	return retval;
 }
@@ -1485,10 +1501,10 @@
 	field.tap = NULL;
 	field.num_bits = sizeof(idcode_buffer) * 8;
 	field.out_value = idcode_buffer;
-	
+
 	field.in_value = idcode_buffer;
-	
-	
+
+
 	field.in_handler = NULL;
 
 	for (i = 0; i < JTAG_MAX_CHAIN_SIZE; i++)
@@ -1662,10 +1678,7 @@
 	field.tap = NULL;
 	field.num_bits = total_ir_length;
 	field.out_value = ir_test;
-	
 	field.in_value = ir_test;
-	
-	
 	field.in_handler = NULL;
 
 	jtag_add_plain_ir_scan(1, &field, TAP_RESET);

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-07 01:26:56 UTC (rev 1628)
+++ trunk/src/jtag/jtag.h	2009-05-07 06:29:08 UTC (rev 1629)
@@ -561,6 +561,10 @@
 extern void jtag_add_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern int  interface_jtag_add_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern void jtag_add_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
+/* same as jtag_add_dr_scan but the scan is executed immediately. sets jtag_error if there
+ * was a failure.
+ */
+extern void jtag_add_dr_scan_now(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern int  interface_jtag_add_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern void jtag_add_plain_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern int  interface_jtag_add_plain_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
@@ -696,6 +700,16 @@
  */
 extern int            jtag_execute_queue(void);
 
+/* this flag is set when an error occurs while executing the queue. cleared
+ * by jtag_execute_queue()
+ *
+ * this flag can also be set from application code if some error happens
+ * during processing that should be reported during jtag_execute_queue().
+ */
+extern int jtag_error;
+
+
+
 /* can be implemented by hw+sw */
 extern int            interface_jtag_execute_queue(void);
 extern int            jtag_power_dropout(int* dropout);

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2009-05-07 01:26:56 UTC (rev 1628)
+++ trunk/src/jtag/zy1000.c	2009-05-07 06:29:08 UTC (rev 1629)
@@ -39,8 +39,6 @@
 #define ZYLIN_OPENOCD_VERSION "Zylin JTAG ZY1000 " ZYLIN_VERSION " " ZYLIN_DATE " " ZYLIN_TIME
 const char *zylin_config_dir="/config/settings";
 
-extern int jtag_error;
-
 /* low level command set
  */
 int zy1000_read(void);

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-07 01:26:56 UTC (rev 1628)
+++ trunk/src/target/arm7tdmi.c	2009-05-07 06:29:08 UTC (rev 1629)
@@ -5,6 +5,9 @@
  *   Copyright (C) 2008 by Spencer Oliver                                  *
  *   spen at spen-soft.co.uk                                                  *
  *                                                                         *
+ *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   oyvind.harboe at zylin.com                                               *
+ *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *
  *   the Free Software Foundation; either version 2 of the License, or     *
@@ -111,22 +114,14 @@
 		fields[0].tap = arm7_9->jtag_info.tap;
 		fields[0].num_bits = 1;
 		fields[0].out_value = NULL;
-		
 		fields[0].in_value = &breakpoint;
-		
-		
 		fields[0].in_handler = NULL;
-		
 
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 32;
 		fields[1].out_value = NULL;
-		
 		fields[1].in_value = databus;
-		
-		
 		fields[1].in_handler = NULL;
-		
 
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
@@ -198,25 +193,24 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
-	
 	fields[0].in_value = NULL;
-	
-	
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	
-	fields[1].in_value = NULL;
-	fields[1].in_handler = arm_jtag_buf_to_u32_flip; /* deprecated! invoke this from user code! */
-	fields[1].in_handler_priv = in;
-	
-	
+	u8 tmp[4];
+	fields[1].in_value = tmp;
+	fields[1].in_handler = NULL;
 
-	jtag_add_dr_scan(2, fields, TAP_INVALID);
+	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 
+	if (jtag_error==ERROR_OK)
+	{
+		*in=flip_u32(le_to_h_u32(tmp), 32);
+	}
+
 	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
@@ -259,17 +253,13 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
-	
 	fields[0].in_value = NULL;
-	
-	
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	
 	fields[1].in_value = NULL;
 	switch (size)
 	{
@@ -284,9 +274,9 @@
 			break;
 	}
 	fields[1].in_handler_priv = in;
-	
-	
 
+
+
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	jtag_add_runtest(0, TAP_INVALID);



From oharboe at mail.berlios.de  Thu May  7 08:47:09 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 08:47:09 +0200
Subject: [Openocd-svn] r1630 - trunk/src/target
Message-ID: <200905070647.n476l9mt003629@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 08:47:09 +0200 (Thu, 07 May 2009)
New Revision: 1630

Modified:
   trunk/src/target/arm7tdmi.c
Log:
another example of removing in_handler usage

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-07 06:29:08 UTC (rev 1629)
+++ trunk/src/target/arm7tdmi.c	2009-05-07 06:47:09 UTC (rev 1630)
@@ -256,29 +256,40 @@
 	fields[0].in_value = NULL;
 	fields[0].in_handler = NULL;
 
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	fields[1].in_value = NULL;
+	u8 tmp[4];
+	fields[1].in_value = tmp;
+	fields[1].in_handler = NULL;
+
+	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
+
 	switch (size)
 	{
 		case 4:
-			fields[1].in_handler = (be) ? arm_jtag_buf_to_be32_flip : arm_jtag_buf_to_le32_flip; /* deprecated! invoke this from user code! */
+			if (be)
+			{
+				h_u32_to_be(((u8*)in), flip_u32(le_to_h_u32(tmp), 32));
+			} else
+			{
+				 h_u32_to_le(((u8*)in), flip_u32(le_to_h_u32(tmp), 32));
+			}
 			break;
 		case 2:
-			fields[1].in_handler = (be) ? arm_jtag_buf_to_be16_flip : arm_jtag_buf_to_le16_flip; /* deprecated! invoke this from user code! */
+			if (be)
+			{
+				h_u16_to_be(((u8*)in), flip_u32(le_to_h_u32(tmp), 32) & 0xffff);
+			} else
+			{
+				h_u16_to_le(((u8*)in), flip_u32(le_to_h_u32(tmp), 32) & 0xffff);
+			}
 			break;
 		case 1:
-			fields[1].in_handler = arm_jtag_buf_to_8_flip; /* deprecated! invoke this from user code! */
+			*((u8 *)in)= flip_u32(le_to_h_u32(tmp), 32) & 0xff;
 			break;
 	}
-	fields[1].in_handler_priv = in;
 
-
-
-	jtag_add_dr_scan(2, fields, TAP_INVALID);
-
 	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_



From oharboe at mail.berlios.de  Thu May  7 08:51:27 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 08:51:27 +0200
Subject: [Openocd-svn] r1631 - trunk/src/target
Message-ID: <200905070651.n476pRNI004084@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 08:51:27 +0200 (Thu, 07 May 2009)
New Revision: 1631

Modified:
   trunk/src/target/arm7tdmi.c
Log:
slightly increase readability of code

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-07 06:47:09 UTC (rev 1630)
+++ trunk/src/target/arm7tdmi.c	2009-05-07 06:51:27 UTC (rev 1631)
@@ -265,28 +265,29 @@
 
 	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 
+	u32 readback=flip_u32(le_to_h_u32(tmp), 32);
 	switch (size)
 	{
 		case 4:
 			if (be)
 			{
-				h_u32_to_be(((u8*)in), flip_u32(le_to_h_u32(tmp), 32));
+				h_u32_to_be(((u8*)in), readback);
 			} else
 			{
-				 h_u32_to_le(((u8*)in), flip_u32(le_to_h_u32(tmp), 32));
+				 h_u32_to_le(((u8*)in), readback);
 			}
 			break;
 		case 2:
 			if (be)
 			{
-				h_u16_to_be(((u8*)in), flip_u32(le_to_h_u32(tmp), 32) & 0xffff);
+				h_u16_to_be(((u8*)in), readback & 0xffff);
 			} else
 			{
-				h_u16_to_le(((u8*)in), flip_u32(le_to_h_u32(tmp), 32) & 0xffff);
+				h_u16_to_le(((u8*)in), readback & 0xffff);
 			}
 			break;
 		case 1:
-			*((u8 *)in)= flip_u32(le_to_h_u32(tmp), 32) & 0xff;
+			*((u8 *)in)= readback & 0xff;
 			break;
 	}
 



From oharboe at mail.berlios.de  Thu May  7 08:58:53 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 08:58:53 +0200
Subject: [Openocd-svn] r1632 - trunk/src/flash
Message-ID: <200905070658.n476wr9m004738@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 08:58:52 +0200 (Thu, 07 May 2009)
New Revision: 1632

Removed:
   trunk/src/flash/at91sam7_old.c
   trunk/src/flash/at91sam7_old.h
Modified:
   trunk/src/flash/Makefile.am
   trunk/src/flash/flash.c
Log:
Deleted at9sam7_old driver. Nobody has complained about the new one yet.

Modified: trunk/src/flash/Makefile.am
===================================================================
--- trunk/src/flash/Makefile.am	2009-05-07 06:51:27 UTC (rev 1631)
+++ trunk/src/flash/Makefile.am	2009-05-07 06:58:52 UTC (rev 1632)
@@ -6,13 +6,13 @@
 METASOURCES = AUTO
 noinst_LIBRARIES = libflash.a
 libflash_a_SOURCES = \
-	flash.c lpc2000.c cfi.c non_cfi.c at91sam7.c at91sam7_old.c \
+	flash.c lpc2000.c cfi.c non_cfi.c at91sam7.c \
 	str7x.c str9x.c aduc702x.c nand.c nand_ecc.c \
 	lpc3180_nand_controller.c stellaris.c str9xpec.c stm32x.c tms470.c \
 	ecos.c orion_nand.c s3c24xx_nand.c s3c2410_nand.c s3c2412_nand.c \
 	s3c2440_nand.c s3c2443_nand.c lpc288x.c ocl.c mflash.c pic32mx.c avrf.c
 noinst_HEADERS = \
-	flash.h lpc2000.h cfi.h non_cfi.h at91sam7.h at91sam7_old.h str7x.h \
+	flash.h lpc2000.h cfi.h non_cfi.h at91sam7.h str7x.h \
 	str9x.h nand.h lpc3180_nand_controller.h stellaris.h str9xpec.h \
 	stm32x.h tms470.h s3c24xx_nand.h s3c24xx_regs_nand.h lpc288x.h \
 	mflash.h ocl.h pic32mx.h avrf.h

Deleted: trunk/src/flash/at91sam7_old.c
===================================================================
--- trunk/src/flash/at91sam7_old.c	2009-05-07 06:51:27 UTC (rev 1631)
+++ trunk/src/flash/at91sam7_old.c	2009-05-07 06:58:52 UTC (rev 1632)
@@ -1,956 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2006 by Magnus Lundin                                   *
- *   lundin at mlu.mine.nu                                                    *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-/***************************************************************************
-There are some things to notice
-
-* AT91SAM7S64 is tested
-* All AT91SAM7Sxx  and  AT91SAM7Xxx should work but is not tested
-* All parameters are identified from onchip configuartion registers 
-*
-* The flash controller handles erases automatically on a page (128/265 byte) basis
-* Only an EraseAll command is supported by the controller
-* Partial erases can be implemented in software by writing one 0xFFFFFFFF word to 
-* some location in every page in the region to be erased
-*  
-* Lock regions (sectors) are 32 or 64 pages
-*
- ***************************************************************************/
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
-#include "replacements.h"
-
-#include "at91sam7_old.h"
-
-#include "flash.h"
-#include "target.h"
-#include "log.h"
-#include "binarybuffer.h"
-#include "types.h"
-
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
-
-static int at91sam7_old_register_commands(struct command_context_s *cmd_ctx);
-static int at91sam7_old_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int at91sam7_old_erase(struct flash_bank_s *bank, int first, int last);
-static int at91sam7_old_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int at91sam7_old_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-static int at91sam7_old_probe(struct flash_bank_s *bank);
-//static int at91sam7_old_auto_probe(struct flash_bank_s *bank);
-static int at91sam7_old_erase_check(struct flash_bank_s *bank);
-static int at91sam7_old_protect_check(struct flash_bank_s *bank);
-static int at91sam7_old_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-static u32 at91sam7_old_get_flash_status(flash_bank_t *bank, u8 flashplane);
-static void at91sam7_old_set_flash_mode(flash_bank_t *bank, u8 flashplane, int mode);
-static u32 at91sam7_old_wait_status_busy(flash_bank_t *bank, u8 flashplane, u32 waitbits, int timeout);
-static int at91sam7_old_flash_command(struct flash_bank_s *bank, u8 flashplane, u8 cmd, u16 pagen); 
-static int at91sam7_old_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
-flash_driver_t at91sam7_old_flash =
-{
-	.name = "at91sam7",
-	.register_commands = at91sam7_old_register_commands,
-	.flash_bank_command = at91sam7_old_flash_bank_command,
-	.erase = at91sam7_old_erase,
-	.protect = at91sam7_old_protect,
-	.write = at91sam7_old_write,
-	.probe = at91sam7_old_probe,
-	.auto_probe = at91sam7_old_probe,
-	.erase_check = at91sam7_old_erase_check,
-	.protect_check = at91sam7_old_protect_check,
-	.info = at91sam7_old_info
-};
-
-static u32 MC_FMR_old[4] =	{ 0xFFFFFF60, 0xFFFFFF70, 0xFFFFFF80, 0xFFFFFF90 };
-static u32 MC_FCR_old[4] =	{ 0xFFFFFF64, 0xFFFFFF74, 0xFFFFFF84, 0xFFFFFF94 };
-static u32 MC_FSR_old[4] =	{ 0xFFFFFF68, 0xFFFFFF78, 0xFFFFFF88, 0xFFFFFF98 };
-
-static char * EPROC_old[8]= {"Unknown","ARM946-E","ARM7TDMI","Unknown","ARM920T","ARM926EJ-S","Unknown","Unknown"};
-static long NVPSIZ_old[16] = {
-   0,
-   0x2000, /*  8K */
-   0x4000, /* 16K */ 
-   0x8000, /* 32K */
-   -1,
-   0x10000, /* 64K */
-   -1,
-   0x20000, /* 128K */
-   -1,
-   0x40000, /* 256K */
-   0x80000, /* 512K */
-   -1,
-   0x100000, /* 1024K */
-   -1,
-   0x200000, /* 2048K */
-   -1
-};
-
-#if 0
-static long SRAMSIZ_old[16] = {
-   -1,
-   0x0400, /*  1K */
-   0x0800, /*  2K */ 
-   -1, 
-   0x1c000,  /* 112K */
-   0x1000,  /*   4K */
-   0x14000, /*  80K */
-   0x28000, /* 160K */
-   0x2000,  /*   8K */
-   0x4000,  /*  16K */
-   0x8000,  /*  32K */
-   0x10000, /*  64K */
-   0x20000, /* 128K */
-   0x40000, /* 256K */
-   0x18000, /* 96K */
-   0x80000, /* 512K */
-};
-#endif
-
-static int at91sam7_old_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *at91sam7_old_cmd = register_command(cmd_ctx, NULL, "at91sam7", NULL, COMMAND_ANY, NULL);
-	register_command(cmd_ctx, at91sam7_old_cmd, "gpnvm", at91sam7_old_handle_gpnvm_command, COMMAND_EXEC,
-			"at91sam7 gpnvm <num> <bit> set|clear, set or clear at91sam7 gpnvm bit");
-
-	return ERROR_OK;
-}
-
-static u32 at91sam7_old_get_flash_status(flash_bank_t *bank, u8 flashplane)
-{
-	target_t *target = bank->target;
-	u32 fsr;
-	
-	target_read_u32(target, MC_FSR_old[flashplane], &fsr);
-	
-	return fsr;
-}
-
-/* Read clock configuration and set at91sam7_old_info->usec_clocks*/
-static void at91sam7_old_read_clock_info(flash_bank_t *bank)
-{
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	target_t *target = bank->target;
-	u32 mckr, mcfr, pllr;
-	unsigned long tmp = 0, mainfreq;
-	int flashplane;
-
-	/* Read main clock freqency register */
-	target_read_u32(target, CKGR_MCFR_old, &mcfr);
-	/* Read master clock register */
-	target_read_u32(target, PMC_MCKR_old, &mckr);
-	/* Read Clock Generator PLL Register  */
-	target_read_u32(target, CKGR_PLLR_old, &pllr);
-
-	at91sam7_old_info->mck_valid = 0;
-	switch (mckr & PMC_MCKR_CSS_old) 
-	{
-		case 0:			/* Slow Clock */
-			at91sam7_old_info->mck_valid = 1;
-			mainfreq = RC_FREQ_old / 16ul * (mcfr & 0xffff);
-			tmp = mainfreq;
-			break;
-		case 1:			/* Main Clock */
-			if (mcfr & CKGR_MCFR_MAINRDY_old) 
-			{
-				at91sam7_old_info->mck_valid = 1;
-				mainfreq = RC_FREQ_old / 16ul * (mcfr & 0xffff);
-				tmp = mainfreq;
-			}
-			break;
-
-		case 2:			/* Reserved */
-			break;
-		case 3:			/* PLL Clock */
-			if (mcfr & CKGR_MCFR_MAINRDY_old) 
-			{
-				target_read_u32(target, CKGR_PLLR_old, &pllr);
-				if (!(pllr & CKGR_PLLR_DIV_old))
-					break; /* 0 Hz */
-				at91sam7_old_info->mck_valid = 1;
-				mainfreq = RC_FREQ_old / 16ul * (mcfr & 0xffff);
-				/* Integer arithmetic should have sufficient precision
-				   as long as PLL is properly configured. */
-				tmp = mainfreq / (pllr & CKGR_PLLR_DIV_old) *
-				  (((pllr & CKGR_PLLR_MUL_old) >> 16) + 1);
-			}
-			break;
-	}
-	
-	/* Prescaler adjust */
-	if (((mckr & PMC_MCKR_PRES_old) >> 2) == 7)
-		at91sam7_old_info->mck_valid = 0;
-	else
-		at91sam7_old_info->mck_freq = tmp >> ((mckr & PMC_MCKR_PRES_old) >> 2);
-
-	/* Forget old flash timing */
-	for (flashplane = 0; flashplane<at91sam7_old_info->num_planes; flashplane++)
-	{
-		at91sam7_old_set_flash_mode(bank, flashplane, FMR_TIMING_NONE_old);
-	}
-}
-
-/* Setup the timimg registers for nvbits or normal flash */
-static void at91sam7_old_set_flash_mode(flash_bank_t *bank, u8 flashplane, int mode)
-{
-	u32 fmr, fmcn = 0, fws = 0;
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	target_t *target = bank->target;
-	
-	if (mode && (mode != at91sam7_old_info->flashmode[flashplane]))
-	{
-		/* Always round up (ceil) */
-		if (mode==FMR_TIMING_NVBITS_old)
-		{
-			if (at91sam7_old_info->cidr_arch == 0x60)
-			{
-				/* AT91SAM7A3 uses master clocks in 100 ns */
-				fmcn = (at91sam7_old_info->mck_freq/10000000ul)+1;
-			}
-			else
-			{
-				/* master clocks in 1uS for ARCH 0x7 types */
-				fmcn = (at91sam7_old_info->mck_freq/1000000ul)+1;
-			}
-		}
-		else if (mode==FMR_TIMING_FLASH_old)
-			/* main clocks in 1.5uS */
-			fmcn = (at91sam7_old_info->mck_freq/666666ul)+1;
-
-		/* Only allow fmcn=0 if clock period is > 30 us = 33kHz. */
- 		if (at91sam7_old_info->mck_freq <= 33333ul)
-			fmcn = 0;
-		/* Only allow fws=0 if clock frequency is < 30 MHz. */
-		if (at91sam7_old_info->mck_freq > 30000000ul)
-			fws = 1;
-
-		LOG_DEBUG("fmcn[%i]: %i", flashplane, fmcn); 
-		fmr = fmcn << 16 | fws << 8;
-		target_write_u32(target, MC_FMR_old[flashplane], fmr);
-	}
-	
-	at91sam7_old_info->flashmode[flashplane] = mode;		
-}
-
-static u32 at91sam7_old_wait_status_busy(flash_bank_t *bank, u8 flashplane, u32 waitbits, int timeout)
-{
-	u32 status;
-	
-	while ((!((status = at91sam7_old_get_flash_status(bank,flashplane)) & waitbits)) && (timeout-- > 0))
-	{
-		LOG_DEBUG("status[%i]: 0x%x", flashplane, status);
-		alive_sleep(1);
-	}
-	
-	LOG_DEBUG("status[%i]: 0x%x", flashplane, status);
-
-	if (status & 0x0C)
-	{
-		LOG_ERROR("status register: 0x%x", status);
-		if (status & 0x4)
-			LOG_ERROR("Lock Error Bit Detected, Operation Abort");
-		if (status & 0x8)
-			LOG_ERROR("Invalid command and/or bad keyword, Operation Abort");
-		if (status & 0x10)
-			LOG_ERROR("Security Bit Set, Operation Abort");
-	}
-	
-	return status;
-}
-
-
-/* Send one command to the AT91SAM flash controller */
-static int at91sam7_old_flash_command(struct flash_bank_s *bank, u8 flashplane, u8 cmd, u16 pagen) 
-{
-	u32 fcr;
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	target_t *target = bank->target;
-
-	fcr = (0x5A<<24) | ((pagen&0x3FF)<<8) | cmd; 
-	target_write_u32(target, MC_FCR_old[flashplane], fcr);
-	LOG_DEBUG("Flash command: 0x%x, flashplane: %i, pagenumber:%u", fcr, flashplane, pagen);
-
-	if ((at91sam7_old_info->cidr_arch == 0x60)&&((cmd==SLB_old)|(cmd==CLB_old)))
-	{
-		/* Lock bit manipulation on AT91SAM7A3 waits for FC_FSR bit 1, EOL */
-		if (at91sam7_old_wait_status_busy(bank, flashplane, MC_FSR_EOL_old, 10)&0x0C) 
-		{
-			return ERROR_FLASH_OPERATION_FAILED;
-		}
-		return ERROR_OK;
-	}
-
-	if (at91sam7_old_wait_status_busy(bank, flashplane, MC_FSR_FRDY_old, 10)&0x0C) 
-	{
-		return ERROR_FLASH_OPERATION_FAILED;
-	}
-	return ERROR_OK;
-}
-
-/* Read device id register, main clock frequency register and fill in driver info structure */
-static int at91sam7_old_read_part_info(struct flash_bank_s *bank)
-{
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	target_t *target = bank->target;
-	u32 cidr, status;
-	int sectornum;
-
-	if (at91sam7_old_info->cidr != 0)
-		return ERROR_OK; /* already probed, multiple probes may cause memory leak, not allowed */
-	
-	/* Read and parse chip identification register */
-	target_read_u32(target, DBGU_CIDR_old, &cidr);
-	
-	if (cidr == 0)
-	{
-		LOG_WARNING("Cannot identify target as an AT91SAM");
-		return ERROR_FLASH_OPERATION_FAILED;
-	}
-	
-	at91sam7_old_info->cidr = cidr;
-	at91sam7_old_info->cidr_ext = (cidr>>31)&0x0001;
-	at91sam7_old_info->cidr_nvptyp = (cidr>>28)&0x0007;
-	at91sam7_old_info->cidr_arch = (cidr>>20)&0x00FF;
-	at91sam7_old_info->cidr_sramsiz = (cidr>>16)&0x000F;
-	at91sam7_old_info->cidr_nvpsiz2 = (cidr>>12)&0x000F;
-	at91sam7_old_info->cidr_nvpsiz = (cidr>>8)&0x000F;
-	at91sam7_old_info->cidr_eproc = (cidr>>5)&0x0007;
-	at91sam7_old_info->cidr_version = cidr&0x001F;
-	bank->size = NVPSIZ_old[at91sam7_old_info->cidr_nvpsiz];
-	at91sam7_old_info->target_name = "Unknown";
-
-	/* Support just for bulk erase of a single flash plane, whole device if flash size <= 256k */
-	if (NVPSIZ_old[at91sam7_old_info->cidr_nvpsiz]<0x80000)  /* Flash size less than 512K, one flash plane */
-	{
-		bank->num_sectors = 1;
-		bank->sectors = malloc(sizeof(flash_sector_t));
-		bank->sectors[0].offset = 0;
-		bank->sectors[0].size = bank->size;
-		bank->sectors[0].is_erased = -1;
-		bank->sectors[0].is_protected = -1;
-	}
-	else	/* Flash size 512K or larger, several flash planes */
-	{
-		bank->num_sectors = NVPSIZ_old[at91sam7_old_info->cidr_nvpsiz]/0x40000;
-		bank->sectors = malloc(bank->num_sectors*sizeof(flash_sector_t));
-		for (sectornum=0; sectornum<bank->num_sectors; sectornum++)
-		{
-			bank->sectors[sectornum].offset = sectornum*0x40000;
-			bank->sectors[sectornum].size = 0x40000;
-			bank->sectors[sectornum].is_erased = -1;
-			bank->sectors[sectornum].is_protected = -1;
-		}
-	}
-		
-	
-
-	LOG_DEBUG("nvptyp: 0x%3.3x, arch: 0x%4.4x", at91sam7_old_info->cidr_nvptyp, at91sam7_old_info->cidr_arch );
-
-	/* Read main and master clock freqency register */
-	at91sam7_old_read_clock_info(bank);
-	
-	at91sam7_old_info->num_planes = 1;
-	status = at91sam7_old_get_flash_status(bank, 0);
-	at91sam7_old_info->securitybit = (status>>4)&0x01;
-	at91sam7_old_protect_check(bank);   /* TODO Check the protect check */
-	
-	if (at91sam7_old_info->cidr_arch == 0x70 )
-	{
-		at91sam7_old_info->num_nvmbits = 2;
-		at91sam7_old_info->nvmbits = (status>>8)&0x03;
-		bank->base = 0x100000;
-		bank->bus_width = 4;
-		if (bank->size==0x80000)  /* AT91SAM7S512 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7S512";
-			at91sam7_old_info->num_planes = 2;
-			if (at91sam7_old_info->num_planes != bank->num_sectors)
-				LOG_WARNING("Internal error: Number of flash planes and erase sectors does not match, please report");;
-			at91sam7_old_info->num_lockbits = 2*16;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 2*16*64;
-		}
-		if (bank->size==0x40000)  /* AT91SAM7S256 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7S256";
-			at91sam7_old_info->num_lockbits = 16;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 16*64;
-		}
-		if (bank->size==0x20000)  /* AT91SAM7S128 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7S128";
-			at91sam7_old_info->num_lockbits = 8;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 8*64;
-		}
-		if (bank->size==0x10000)  /* AT91SAM7S64 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7S64";
-			at91sam7_old_info->num_lockbits = 16;
-			at91sam7_old_info->pagesize = 128;
-			at91sam7_old_info->pages_in_lockregion = 32;
-			at91sam7_old_info->num_pages = 16*32;
-		}
-		if (bank->size==0x08000)  /* AT91SAM7S321/32 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7S321/32";
-			at91sam7_old_info->num_lockbits = 8;
-			at91sam7_old_info->pagesize = 128;
-			at91sam7_old_info->pages_in_lockregion = 32;
-			at91sam7_old_info->num_pages = 8*32;
-		}
-		
-		return ERROR_OK;
-	}
-
-	if (at91sam7_old_info->cidr_arch == 0x71 )
-	{
-		at91sam7_old_info->num_nvmbits = 3;
-		at91sam7_old_info->nvmbits = (status>>8)&0x07;
-		bank->base = 0x100000;
-		bank->bus_width = 4;
-		if (bank->size==0x80000)  /* AT91SAM7XC512 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7XC512";
-			at91sam7_old_info->num_planes = 2;
-			if (at91sam7_old_info->num_planes != bank->num_sectors)
-				LOG_WARNING("Internal error: Number of flash planes and erase sectors does not match, please report");;
-			at91sam7_old_info->num_lockbits = 2*16;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 2*16*64;
-		}
-		if (bank->size==0x40000)  /* AT91SAM7XC256 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7XC256";
-			at91sam7_old_info->num_lockbits = 16;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 16*64;
-		}
-		if (bank->size==0x20000)  /* AT91SAM7XC128 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7XC128";
-			at91sam7_old_info->num_lockbits = 8;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 8*64;
-		}
-		
-		return ERROR_OK;
-	}
-	
-	if (at91sam7_old_info->cidr_arch == 0x72 )
-	{
-		at91sam7_old_info->num_nvmbits = 3;
-		at91sam7_old_info->nvmbits = (status>>8)&0x07;
-		bank->base = 0x100000;
-		bank->bus_width = 4;
-		if (bank->size==0x80000) /* AT91SAM7SE512 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7SE512";
-			at91sam7_old_info->num_planes = 2;
-			if (at91sam7_old_info->num_planes != bank->num_sectors)
-				LOG_WARNING("Internal error: Number of flash planes and erase sectors does not match, please report");;
-			at91sam7_old_info->num_lockbits = 32;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 32*64;
-		}
-		if (bank->size==0x40000)
-		{
-			at91sam7_old_info->target_name = "AT91SAM7SE256";
-			at91sam7_old_info->num_lockbits = 16;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 16*64;
-		}
-		if (bank->size==0x08000)
-		{
-			at91sam7_old_info->target_name = "AT91SAM7SE32";
-			at91sam7_old_info->num_lockbits = 8;
-			at91sam7_old_info->pagesize = 128;
-			at91sam7_old_info->pages_in_lockregion = 32;
-			at91sam7_old_info->num_pages = 8*32;
-		}
-		
-		return ERROR_OK;
-	}
-	
-	if (at91sam7_old_info->cidr_arch == 0x75 )
-	{
-		at91sam7_old_info->num_nvmbits = 3;
-		at91sam7_old_info->nvmbits = (status>>8)&0x07;
-		bank->base = 0x100000;
-		bank->bus_width = 4;
-		if (bank->size==0x80000)  /* AT91SAM7X512 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7X512";
-			at91sam7_old_info->num_planes = 2;
-			if (at91sam7_old_info->num_planes != bank->num_sectors)
-				LOG_WARNING("Internal error: Number of flash planes and erase sectors does not match, please report");;
-			at91sam7_old_info->num_lockbits = 32;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 2*16*64;
-			LOG_DEBUG("Support for AT91SAM7X512 is experimental in this version!");
-		}
-		if (bank->size==0x40000)  /* AT91SAM7X256 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7X256";
-			at91sam7_old_info->num_lockbits = 16;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 16*64;
-		}
-		if (bank->size==0x20000)  /* AT91SAM7X128 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7X128";
-			at91sam7_old_info->num_lockbits = 8;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 64;
-			at91sam7_old_info->num_pages = 8*64;
-		}
-	
-		return ERROR_OK;
-	}
-	
-	if (at91sam7_old_info->cidr_arch == 0x60 )
-	{
-		at91sam7_old_info->num_nvmbits = 3;
-		at91sam7_old_info->nvmbits = (status>>8)&0x07;
-		bank->base = 0x100000;
-		bank->bus_width = 4;
-		
-		if (bank->size == 0x40000)  /* AT91SAM7A3 */
-		{
-			at91sam7_old_info->target_name = "AT91SAM7A3";
-			at91sam7_old_info->num_lockbits = 16;
-			at91sam7_old_info->pagesize = 256;
-			at91sam7_old_info->pages_in_lockregion = 16;
-			at91sam7_old_info->num_pages = 16*64;
-		}
-		return ERROR_OK;
-	}
-	
-	LOG_WARNING("at91sam7_old flash only tested for AT91SAM7Sxx series");
-	return ERROR_OK;
-}
-
-int at91sam7_old_erase_check(struct flash_bank_s *bank)
-{
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	
-	if (!at91sam7_old_info->working_area_size)
-	{
-	}
-	else
-	{	
-	}
-	
-	return ERROR_OK;
-}
-
-static int at91sam7_old_protect_check(struct flash_bank_s *bank)
-{
-	u32 status;
-	int flashplane;
-	
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-
-	if (at91sam7_old_info->cidr == 0)
-	{
-		return ERROR_FLASH_BANK_NOT_PROBED;
-	}
-
-	if (bank->target->state != TARGET_HALTED)
-	{
-		LOG_ERROR("Target not halted");
-		return ERROR_TARGET_NOT_HALTED;
-	}
-
-	for (flashplane=0;flashplane<at91sam7_old_info->num_planes;flashplane++)
-	{
-		status = at91sam7_old_get_flash_status(bank, flashplane);
-		at91sam7_old_info->lockbits[flashplane] = (status >> 16);
-	}
-	
-	return ERROR_OK;
-}
-
-/* flash_bank at91sam7_old 0 0 0 0 <target#>
- */
-int at91sam7_old_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
-{
-	at91sam7_old_flash_bank_t *at91sam7_old_info;
-	int i;
-	
-	if (argc < 6)
-	{
-		LOG_WARNING("incomplete flash_bank at91sam7_old configuration");
-		return ERROR_FLASH_BANK_INVALID;
-	}
-	
-	at91sam7_old_info = malloc(sizeof(at91sam7_old_flash_bank_t));
-	bank->driver_priv = at91sam7_old_info;
-	
-	/* part wasn't probed for info yet */
-	at91sam7_old_info->cidr = 0;
-	for (i=0;i<4;i++)
-		at91sam7_old_info->flashmode[i]=0;
-	
-	return ERROR_OK;
-}
-
-static int at91sam7_old_erase(struct flash_bank_s *bank, int first, int last)
-{
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	u8 flashplane;
-
-	if (at91sam7_old_info->cidr == 0)
-	{
-		return ERROR_FLASH_BANK_NOT_PROBED;
-	}
-
-	if (bank->target->state != TARGET_HALTED)
-	{
-		LOG_ERROR("Target not halted");
-		return ERROR_TARGET_NOT_HALTED;
-	}
-	
-	if ((first < 0) || (last < first) || (last >= bank->num_sectors))
-	{
-		if ((first == 0) && (last == (at91sam7_old_info->num_lockbits-1)))
-		{
-			LOG_WARNING("Sector numbers based on lockbit count, probably a deprecated script");
-			last = bank->num_sectors-1;
-		}
-		else return ERROR_FLASH_SECTOR_INVALID;
-	}
-
-	/* Configure the flash controller timing */
-	at91sam7_old_read_clock_info(bank);	
-	for (flashplane = first; flashplane<=last; flashplane++)
-	{
-		/* Configure the flash controller timing */
-		at91sam7_old_set_flash_mode(bank, flashplane, FMR_TIMING_FLASH_old);
-		if (at91sam7_old_flash_command(bank, flashplane, EA_old, 0) != ERROR_OK) 
-		{
-			return ERROR_FLASH_OPERATION_FAILED;
-		}	
-	}
-	return ERROR_OK;
-
-}
-
-int at91sam7_old_protect(struct flash_bank_s *bank, int set, int first, int last)
-{
-	u32 cmd, pagen;
-	u8 flashplane;
-	int lockregion;
-	
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	
-	if (at91sam7_old_info->cidr == 0)
-	{
-		return ERROR_FLASH_BANK_NOT_PROBED;
-	}
-
-	if (bank->target->state != TARGET_HALTED)
-	{
-		LOG_ERROR("Target not halted");
-		return ERROR_TARGET_NOT_HALTED;
-	}
-	
-	if ((first < 0) || (last < first) || (last >= at91sam7_old_info->num_lockbits))
-	{
-		return ERROR_FLASH_SECTOR_INVALID;
-	}
-	
-	at91sam7_old_read_clock_info(bank);	
-	
-	for (lockregion=first;lockregion<=last;lockregion++) 
-	{
-		pagen = lockregion*at91sam7_old_info->pages_in_lockregion;
-		flashplane = (pagen>>10)&0x03;
-		/* Configure the flash controller timing */
-		at91sam7_old_set_flash_mode(bank, flashplane, FMR_TIMING_NVBITS_old);
-		
-		if (set)
-			 cmd = SLB_old; 
-		else
-			 cmd = CLB_old; 		
-
-		if (at91sam7_old_flash_command(bank, flashplane, cmd, pagen) != ERROR_OK) 
-		{
-			return ERROR_FLASH_OPERATION_FAILED;
-		}	
-	}
-	
-	at91sam7_old_protect_check(bank);
-		
-	return ERROR_OK;
-}
-
-
-static int at91sam7_old_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
-{
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	target_t *target = bank->target;
-	u32 dst_min_alignment, wcount, bytes_remaining = count;
-	u32 first_page, last_page, pagen, buffer_pos;
-	u8 flashplane;
-	
-	if (at91sam7_old_info->cidr == 0)
-	{
-		return ERROR_FLASH_BANK_NOT_PROBED;
-	}
-
-	if (bank->target->state != TARGET_HALTED)
-	{
-		LOG_ERROR("Target not halted");
-		return ERROR_TARGET_NOT_HALTED;
-	}
-
-	if (offset + count > bank->size)
-		return ERROR_FLASH_DST_OUT_OF_BANK;
-	
-	dst_min_alignment = at91sam7_old_info->pagesize;
-
-	if (offset % dst_min_alignment)
-	{
-		LOG_WARNING("offset 0x%x breaks required alignment 0x%x", offset, dst_min_alignment);
-		return ERROR_FLASH_DST_BREAKS_ALIGNMENT;
-	}
-	
-	if (at91sam7_old_info->cidr_arch == 0)
-		return ERROR_FLASH_BANK_NOT_PROBED;
-
-	first_page = offset/dst_min_alignment;
-	last_page = CEIL(offset + count, dst_min_alignment);
-	
-	LOG_DEBUG("first_page: %i, last_page: %i, count %i", first_page, last_page, count);
-	
-	at91sam7_old_read_clock_info(bank);	
-
-	for (pagen=first_page; pagen<last_page; pagen++) 
-	{
-		if (bytes_remaining<dst_min_alignment)
-			count = bytes_remaining;
-		else
-			count = dst_min_alignment;
-		bytes_remaining -= count;
-		
-		/* Write one block to the PageWriteBuffer */
-		buffer_pos = (pagen-first_page)*dst_min_alignment;
-		wcount = CEIL(count,4);
-		target->type->write_memory(target, bank->base+pagen*dst_min_alignment, 4, wcount, buffer+buffer_pos);
-		flashplane = (pagen>>10)&0x3;
-		
-		/* Configure the flash controller timing */	
-		at91sam7_old_set_flash_mode(bank, flashplane, FMR_TIMING_FLASH_old);
-		/* Send Write Page command to Flash Controller */
-		if (at91sam7_old_flash_command(bank, flashplane, WP_old, pagen) != ERROR_OK) 
-		{
-				return ERROR_FLASH_OPERATION_FAILED;
-		}
-		LOG_DEBUG("Write flash plane:%i page number:%i", flashplane, pagen);
-	}
-	
-	return ERROR_OK;
-}
-
-
-static int at91sam7_old_probe(struct flash_bank_s *bank)
-{
-	/* we can't probe on an at91sam7_old
-	 * if this is an at91sam7_old, it has the configured flash
-	 */
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	int retval;
-	
-	if (at91sam7_old_info->cidr != 0)
-	{
-		return ERROR_OK; /* already probed */
-	}
-
-	if (bank->target->state != TARGET_HALTED)
-	{
-		LOG_ERROR("Target not halted");
-		return ERROR_TARGET_NOT_HALTED;
-	}
-
-	retval = at91sam7_old_read_part_info(bank);
-	if (retval != ERROR_OK)
-		return retval;
-	
-	return ERROR_OK;
-}
-
-
-static int at91sam7_old_info(struct flash_bank_s *bank, char *buf, int buf_size)
-{
-	int printed, flashplane;
-	at91sam7_old_flash_bank_t *at91sam7_old_info = bank->driver_priv;
-	
-	if (at91sam7_old_info->cidr == 0)
-	{
-		return ERROR_FLASH_BANK_NOT_PROBED;
-	}
-	
-	printed = snprintf(buf, buf_size, "\nat91sam7_old information: Chip is %s\n",at91sam7_old_info->target_name);
-	buf += printed;
-	buf_size -= printed;
-	
-	printed = snprintf(buf, buf_size, "cidr: 0x%8.8x, arch: 0x%4.4x, eproc: %s, version:0x%3.3x,  flashsize: 0x%8.8x\n",
-		  at91sam7_old_info->cidr, at91sam7_old_info->cidr_arch, EPROC_old[at91sam7_old_info->cidr_eproc], at91sam7_old_info->cidr_version, bank->size);
-	buf += printed;
-	buf_size -= printed;
-			
-	printed = snprintf(buf, buf_size, "master clock(estimated): %ikHz \n", at91sam7_old_info->mck_freq / 1000);
-	buf += printed;
-	buf_size -= printed;
-	
-	if (at91sam7_old_info->num_planes>1) {		
-		printed = snprintf(buf, buf_size, "flashplanes: %i, pagesize: %i, lock regions: %i, pages in lock region: %i \n", 
-			   at91sam7_old_info->num_planes, at91sam7_old_info->pagesize, at91sam7_old_info->num_lockbits, at91sam7_old_info->num_pages/at91sam7_old_info->num_lockbits);
-		buf += printed;
-		buf_size -= printed;
-		for (flashplane=0; flashplane<at91sam7_old_info->num_planes; flashplane++)
-		{
-			printed = snprintf(buf, buf_size, "lockbits[%i]: 0x%4.4x,  ", flashplane, at91sam7_old_info->lockbits[flashplane]);
-			buf += printed;
-			buf_size -= printed;
-		}
-	}
-	else
-	if (at91sam7_old_info->num_lockbits>0) {		
-		printed = snprintf(buf, buf_size, "pagesize: %i, lockbits: %i 0x%4.4x, pages in lock region: %i \n", 
-			   at91sam7_old_info->pagesize, at91sam7_old_info->num_lockbits, at91sam7_old_info->lockbits[0], at91sam7_old_info->num_pages/at91sam7_old_info->num_lockbits);
-		buf += printed;
-		buf_size -= printed;
-	}
-			
-	printed = snprintf(buf, buf_size, "securitybit: %i,  nvmbits(%i): 0x%1.1x\n", at91sam7_old_info->securitybit, at91sam7_old_info->num_nvmbits, at91sam7_old_info->nvmbits);
-	buf += printed;
-	buf_size -= printed;
-
-	return ERROR_OK;
-}
-
-/* 
-* On AT91SAM7S: When the gpnvm bits are set with 
-* > at91sam7_old gpnvm 0 bitnr set
-* the changes are not visible in the flash controller status register MC_FSR_old 
-* until the processor has been reset.
-* On the Olimex board this requires a power cycle.
-* Note that the AT91SAM7S has the following errata (doc6175.pdf sec 14.1.3):
-* 	The maximum number of write/erase cycles for Non Volatile Memory bits is 100. This includes
-*	Lock Bits (LOCKx), General Purpose NVM bits (GPNVMx) and the Security Bit.
-*/
-static int at91sam7_old_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	flash_bank_t *bank;
-	int bit;
-	u8  flashcmd;
-	u32 status;
-	char *value;
-	at91sam7_old_flash_bank_t *at91sam7_old_info;
-	int retval;
-
-	if (argc < 3)
-	{
-		command_print(cmd_ctx, "at91sam7_old gpnvm <num> <bit> <set|clear>");
-		return ERROR_OK;
-	}
-	
-	bank = get_flash_bank_by_num_noprobe(strtoul(args[0], NULL, 0));
-	bit = atoi(args[1]);
-	value = args[2];
-
-	if (bank ==  NULL)
-	{
-		return ERROR_FLASH_BANK_INVALID;
-	}
-
-	if (bank->driver != &at91sam7_old_flash)
-	{
-		command_print(cmd_ctx, "not an at91sam7_old flash bank '%s'", args[0]);
-		return ERROR_FLASH_BANK_INVALID;
-	}
-
-	if (strcmp(value, "set") == 0)
-	{
-		flashcmd = SGPB_old;
-	}
-	else if (strcmp(value, "clear") == 0)
-	{
-		flashcmd = CGPB_old;
-	}
-	else
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-
-	at91sam7_old_info = bank->driver_priv;
-
-	if (bank->target->state != TARGET_HALTED)
-	{
-		LOG_ERROR("target has to be halted to perform flash operation");
-		return ERROR_TARGET_NOT_HALTED;
-	}
-	
-	if (at91sam7_old_info->cidr == 0)
-	{
-		retval = at91sam7_old_read_part_info(bank);
-		if (retval != ERROR_OK) {
-			return retval;
-		}
-	}
-
-	if ((bit<0) || (at91sam7_old_info->num_nvmbits <= bit))
-	{ 
-		command_print(cmd_ctx, "gpnvm bit '#%s' is out of bounds for target %s", args[1],at91sam7_old_info->target_name);
-		return ERROR_OK;
-	}
-
-	/* Configure the flash controller timing */
-	at91sam7_old_read_clock_info(bank);	
-	at91sam7_old_set_flash_mode(bank, 0, FMR_TIMING_NVBITS_old);
-	
-	if (at91sam7_old_flash_command(bank, 0, flashcmd, (u16)(bit)) != ERROR_OK) 
-	{
-		return ERROR_FLASH_OPERATION_FAILED;
-	}	
-
-	status = at91sam7_old_get_flash_status(bank, 0);
-	LOG_DEBUG("at91sam7_handle_gpnvm_command: cmd 0x%x, value 0x%x, status 0x%x \n",flashcmd,bit,status);
-	at91sam7_old_info->nvmbits = (status>>8)&((1<<at91sam7_old_info->num_nvmbits)-1);
-
-	return ERROR_OK;
-}

Deleted: trunk/src/flash/at91sam7_old.h
===================================================================
--- trunk/src/flash/at91sam7_old.h	2009-05-07 06:51:27 UTC (rev 1631)
+++ trunk/src/flash/at91sam7_old.h	2009-05-07 06:58:52 UTC (rev 1632)
@@ -1,98 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2006 by Magnus Lundin                                   *
- *   lundin at mlu.mine.nu                                                    *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-#ifndef AT91SAM7_OLD_H
-#define AT91SAM7_OLD_H
-
-#include "flash.h"
-#include "target.h"
-
-typedef struct at91sam7_old_flash_bank_s
-{
-	u32 working_area;
-	u32 working_area_size;
-
-	/* chip id register */
-	u32 cidr;
-	u16 cidr_ext;
-	u16 cidr_nvptyp;
-	u16 cidr_arch;
-	u16 cidr_sramsiz;
-	u16 cidr_nvpsiz;
-	u16 cidr_nvpsiz2;
-	u16 cidr_eproc;
-	u16 cidr_version;
-	char * target_name;
-
-	/* flash geometry */
-	u16 num_pages;
-	u16 pagesize;
-	u16 pages_in_lockregion;
-	u8 num_erase_regions;
-	u8 num_planes;
-	u32 *erase_region_info;
-
-	/* nv memory bits */
-	u16 num_lockbits;
-	u16 lockbits[4];
-	u16 num_nvmbits;
-	u16 nvmbits;
-	u8  securitybit;
-	u8  flashmode[4];         /* 0: not init, 1: fmcn for nvbits (1uS), 2: fmcn for flash (1.5uS) */
-
-	/* main clock status */
-	u8  mck_valid;
-	u32 mck_freq;
-
-} at91sam7_old_flash_bank_t;
-
-/* AT91SAM7 control registers */
-#define DBGU_CIDR_old 0xFFFFF240
-#define CKGR_MCFR_old 0xFFFFFC24
-#define CKGR_MCFR_MAINRDY_old  0x10000
-#define CKGR_PLLR_old 0xFFFFFC2c
-#define CKGR_PLLR_DIV_old 0xff
-#define CKGR_PLLR_MUL_old 0x07ff0000
-#define PMC_MCKR_old  0xFFFFFC30
-#define PMC_MCKR_CSS_old  0x03
-#define PMC_MCKR_PRES_old 0x1c
-
-/* Flash Controller Commands */
-#define  WP_old   0x01
-#define  SLB_old  0x02
-#define  WPL_old  0x03
-#define  CLB_old  0x04
-#define  EA_old   0x08
-#define  SGPB_old 0x0B
-#define  CGPB_old 0x0D
-#define  SSB_old  0x0F
-
-/* MC_FSR bit definitions */
-#define        MC_FSR_FRDY_old 1
-#define        MC_FSR_EOL_old 2
-
-/* AT91SAM7 constants */
-#define RC_FREQ_old  32000
-
-/*  FLASH_TIMING_MODES */
-#define  FMR_TIMING_NONE_old    0
-#define  FMR_TIMING_NVBITS_old  1
-#define  FMR_TIMING_FLASH_old   2
-
-#endif /* AT91SAM7_OLD_H */

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2009-05-07 06:51:27 UTC (rev 1631)
+++ trunk/src/flash/flash.c	2009-05-07 06:58:52 UTC (rev 1632)
@@ -65,7 +65,6 @@
 extern flash_driver_t lpc2000_flash;
 extern flash_driver_t cfi_flash;
 extern flash_driver_t at91sam7_flash;
-extern flash_driver_t at91sam7_old_flash;
 extern flash_driver_t str7x_flash;
 extern flash_driver_t str9x_flash;
 extern flash_driver_t aduc702x_flash;
@@ -83,7 +82,6 @@
 	&lpc2000_flash,
 	&cfi_flash,
 	&at91sam7_flash,
-	&at91sam7_old_flash,
 	&str7x_flash,
 	&str9x_flash,
 	&aduc702x_flash,



From oharboe at mail.berlios.de  Thu May  7 10:19:07 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 10:19:07 +0200
Subject: [Openocd-svn] r1633 - trunk/src/target/target
Message-ID: <200905070819.n478J7sx015775@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 10:19:07 +0200 (Thu, 07 May 2009)
New Revision: 1633

Added:
   trunk/src/target/target/ti_dm355.cfg
Log:
David Brownell <david-b at pacbell.net> DaVinci DM355 SoC support

Added: trunk/src/target/target/ti_dm355.cfg
===================================================================
--- trunk/src/target/target/ti_dm355.cfg	2009-05-07 06:58:52 UTC (rev 1632)
+++ trunk/src/target/target/ti_dm355.cfg	2009-05-07 08:19:07 UTC (rev 1633)
@@ -0,0 +1,63 @@
+#
+# Texas Instruments DaVinci family:  TMS320DM355
+#
+if { [info exists CHIPNAME] } {
+   set  _CHIPNAME $CHIPNAME
+} else {
+   set  _CHIPNAME dm355
+}
+if { [info exists ENDIAN] } {
+   set  _ENDIAN $ENDIAN
+} else {
+   set  _ENDIAN little
+}
+
+#
+# For now, expect EMU0/EMU1 jumpered LOW (not TI's default) so ARM and ETB
+# are enabled without making ICEpick route ARM and ETB into the JTAG chain.
+#
+# Also note:  when running without RTCK before the PLLs are set up, you
+# may need to slow the JTAG clock down quite a lot (under 2 MHz).
+#
+
+# Subsidiary TAP: ARM ETB11, with scan chain for 4K of ETM trace buffer
+if { [info exists ETB_TAPID ] } {
+   set _ETB_TAPID $ETB_TAPID
+} else {
+   set _ETB_TAPID 0x2b900f0f
+}
+jtag newtap $_CHIPNAME etb -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_ETB_TAPID
+
+# Subsidiary TAP: ARM926ejs with scan chains for ARM Debug, EmbeddedICE-RT, ETM.
+if { [info exists CPU_TAPID ] } {
+   set _CPU_TAPID $CPU_TAPID
+} else {
+   set _CPU_TAPID 0x07926001
+}
+jtag newtap $_CHIPNAME arm -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPU_TAPID
+
+# Primary TAP: ICEpick (JTAG route controller) and boundary scan
+if { [info exists JRC_TAPID ] } {
+   set _JRC_TAPID $JRC_TAPID
+} else {
+   set _JRC_TAPID 0x0b73b02f
+}
+jtag newtap $_CHIPNAME jrc -irlen 6 -ircapture 0x1 -irmask 0x3f -expected-id $_JRC_TAPID
+
+# GDB target:  the ARM, using SRAM1 for scratch.  SRAM0 (also 16K)
+# and the ETB memory (4K) are other options, while trace is unused.
+set _TARGETNAME $_CHIPNAME.arm
+
+target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00014000 -work-area-size 0x4000 -work-area-backup 0
+
+arm7_9 dbgrq enable
+arm7_9 fast_memory_access enable
+arm7_9 dcc_downloads enable
+
+# trace setup
+# FIXME we ought to be able to say "... config $_TARGETNAME ..."
+# (not "config 0") facilitating additional targets (e.g. other chips)
+etm config 0 16 normal full etb
+etb config 0 $_CHIPNAME.etb
+



From oharboe at mail.berlios.de  Thu May  7 11:57:13 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 11:57:13 +0200
Subject: [Openocd-svn] r1634 - trunk/src/target/target
Message-ID: <200905070957.n479vDhJ027608@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 11:57:13 +0200 (Thu, 07 May 2009)
New Revision: 1634

Modified:
   trunk/src/target/target/ti_dm355.cfg
Log:
fix line endings

Modified: trunk/src/target/target/ti_dm355.cfg
===================================================================
--- trunk/src/target/target/ti_dm355.cfg	2009-05-07 08:19:07 UTC (rev 1633)
+++ trunk/src/target/target/ti_dm355.cfg	2009-05-07 09:57:13 UTC (rev 1634)
@@ -1,63 +1,63 @@
-#
-# Texas Instruments DaVinci family:  TMS320DM355
-#
-if { [info exists CHIPNAME] } {
-   set  _CHIPNAME $CHIPNAME
-} else {
-   set  _CHIPNAME dm355
-}
-if { [info exists ENDIAN] } {
-   set  _ENDIAN $ENDIAN
-} else {
-   set  _ENDIAN little
-}
-
-#
-# For now, expect EMU0/EMU1 jumpered LOW (not TI's default) so ARM and ETB
-# are enabled without making ICEpick route ARM and ETB into the JTAG chain.
-#
-# Also note:  when running without RTCK before the PLLs are set up, you
-# may need to slow the JTAG clock down quite a lot (under 2 MHz).
-#
-
-# Subsidiary TAP: ARM ETB11, with scan chain for 4K of ETM trace buffer
-if { [info exists ETB_TAPID ] } {
-   set _ETB_TAPID $ETB_TAPID
-} else {
-   set _ETB_TAPID 0x2b900f0f
-}
-jtag newtap $_CHIPNAME etb -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_ETB_TAPID
-
-# Subsidiary TAP: ARM926ejs with scan chains for ARM Debug, EmbeddedICE-RT, ETM.
-if { [info exists CPU_TAPID ] } {
-   set _CPU_TAPID $CPU_TAPID
-} else {
-   set _CPU_TAPID 0x07926001
-}
-jtag newtap $_CHIPNAME arm -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPU_TAPID
-
-# Primary TAP: ICEpick (JTAG route controller) and boundary scan
-if { [info exists JRC_TAPID ] } {
-   set _JRC_TAPID $JRC_TAPID
-} else {
-   set _JRC_TAPID 0x0b73b02f
-}
-jtag newtap $_CHIPNAME jrc -irlen 6 -ircapture 0x1 -irmask 0x3f -expected-id $_JRC_TAPID
-
-# GDB target:  the ARM, using SRAM1 for scratch.  SRAM0 (also 16K)
-# and the ETB memory (4K) are other options, while trace is unused.
-set _TARGETNAME $_CHIPNAME.arm
-
-target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00014000 -work-area-size 0x4000 -work-area-backup 0
-
-arm7_9 dbgrq enable
-arm7_9 fast_memory_access enable
-arm7_9 dcc_downloads enable
-
-# trace setup
-# FIXME we ought to be able to say "... config $_TARGETNAME ..."
-# (not "config 0") facilitating additional targets (e.g. other chips)
-etm config 0 16 normal full etb
-etb config 0 $_CHIPNAME.etb
-
+#
+# Texas Instruments DaVinci family:  TMS320DM355
+#
+if { [info exists CHIPNAME] } {
+   set  _CHIPNAME $CHIPNAME
+} else {
+   set  _CHIPNAME dm355
+}
+if { [info exists ENDIAN] } {
+   set  _ENDIAN $ENDIAN
+} else {
+   set  _ENDIAN little
+}
+
+#
+# For now, expect EMU0/EMU1 jumpered LOW (not TI's default) so ARM and ETB
+# are enabled without making ICEpick route ARM and ETB into the JTAG chain.
+#
+# Also note:  when running without RTCK before the PLLs are set up, you
+# may need to slow the JTAG clock down quite a lot (under 2 MHz).
+#
+
+# Subsidiary TAP: ARM ETB11, with scan chain for 4K of ETM trace buffer
+if { [info exists ETB_TAPID ] } {
+   set _ETB_TAPID $ETB_TAPID
+} else {
+   set _ETB_TAPID 0x2b900f0f
+}
+jtag newtap $_CHIPNAME etb -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_ETB_TAPID
+
+# Subsidiary TAP: ARM926ejs with scan chains for ARM Debug, EmbeddedICE-RT, ETM.
+if { [info exists CPU_TAPID ] } {
+   set _CPU_TAPID $CPU_TAPID
+} else {
+   set _CPU_TAPID 0x07926001
+}
+jtag newtap $_CHIPNAME arm -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPU_TAPID
+
+# Primary TAP: ICEpick (JTAG route controller) and boundary scan
+if { [info exists JRC_TAPID ] } {
+   set _JRC_TAPID $JRC_TAPID
+} else {
+   set _JRC_TAPID 0x0b73b02f
+}
+jtag newtap $_CHIPNAME jrc -irlen 6 -ircapture 0x1 -irmask 0x3f -expected-id $_JRC_TAPID
+
+# GDB target:  the ARM, using SRAM1 for scratch.  SRAM0 (also 16K)
+# and the ETB memory (4K) are other options, while trace is unused.
+set _TARGETNAME $_CHIPNAME.arm
+
+target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00014000 -work-area-size 0x4000 -work-area-backup 0
+
+arm7_9 dbgrq enable
+arm7_9 fast_memory_access enable
+arm7_9 dcc_downloads enable
+
+# trace setup
+# FIXME we ought to be able to say "... config $_TARGETNAME ..."
+# (not "config 0") facilitating additional targets (e.g. other chips)
+etm config 0 16 normal full etb
+etb config 0 $_CHIPNAME.etb
+


Property changes on: trunk/src/target/target/ti_dm355.cfg
___________________________________________________________________
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Thu May  7 12:59:07 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 12:59:07 +0200
Subject: [Openocd-svn] r1635 - trunk/src/target
Message-ID: <200905071059.n47Ax7hS023979@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 12:59:06 +0200 (Thu, 07 May 2009)
New Revision: 1635

Modified:
   trunk/src/target/oocd_trace.c
Log:
David Brownell david-b at pacbell.net  fix warnings

Modified: trunk/src/target/oocd_trace.c
===================================================================
--- trunk/src/target/oocd_trace.c	2009-05-07 09:57:13 UTC (rev 1634)
+++ trunk/src/target/oocd_trace.c	2009-05-07 10:59:06 UTC (rev 1635)
@@ -98,7 +98,7 @@
 		if ((bytes_read = read(oocd_trace->tty_fd,
 				((u8*)data) + (size * 16) - bytes_to_read, bytes_to_read)) < 0)
 		{
-			LOG_DEBUG("read() returned %i (%s)", bytes_read, strerror(errno));
+			LOG_DEBUG("read() returned %zi (%s)", bytes_read, strerror(errno));
 		}
 		else
 			bytes_to_read -= bytes_read;
@@ -148,7 +148,7 @@
 	 * read up any leftover characters to ensure communication is in sync */
 	while ((bytes_read = read(oocd_trace->tty_fd, trash, sizeof(trash))) > 0)
 	{
-		LOG_DEBUG("%i bytes read\n", bytes_read);
+		LOG_DEBUG("%zi bytes read\n", bytes_read);
 	};
 	
 	return ERROR_OK;



From oharboe at mail.berlios.de  Thu May  7 14:29:31 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 14:29:31 +0200
Subject: [Openocd-svn] r1636 - trunk/src/pld
Message-ID: <200905071229.n47CTVHr022792@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 14:29:31 +0200 (Thu, 07 May 2009)
New Revision: 1636

Modified:
   trunk/src/pld/virtex2.c
Log:
remove in_handler usage

Modified: trunk/src/pld/virtex2.c
===================================================================
--- trunk/src/pld/virtex2.c	2009-05-07 10:59:06 UTC (rev 1635)
+++ trunk/src/pld/virtex2.c	2009-05-07 12:29:31 UTC (rev 1636)
@@ -98,12 +98,6 @@
 	return ERROR_OK;
 }
 
-int virtex2_jtag_buf_to_u32(u8 *in_buf, void *priv, struct scan_field_s *field)
-{
-	u32 *dest = priv;
-	*dest = flip_u32(le_to_h_u32(in_buf), 32);
-	return ERROR_OK;
-}
 
 int virtex2_receive_32(struct pld_device_s *pld_device, int num_words, u32 *words)
 {
@@ -113,15 +107,17 @@
 	scan_field.tap = virtex2_info->tap;
 	scan_field.num_bits = 32;
 	scan_field.out_value = NULL;
-	scan_field.in_value = NULL;
-	scan_field.in_handler = virtex2_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
+	u8 tmp[4];
+	scan_field.in_value = tmp;
+	scan_field.in_handler = NULL;
 
 	virtex2_set_instr(virtex2_info->tap, 0x4); /* CFG_OUT */
 
 	while (num_words--)
 	{
-		scan_field.in_handler_priv = words++;
-		jtag_add_dr_scan(1, &scan_field, TAP_DRPAUSE);
+		jtag_add_dr_scan_now(1, &scan_field, TAP_DRPAUSE);
+
+		*words++=flip_u32(le_to_h_u32(tmp), 32);
 	}
 
 	return ERROR_OK;



From oharboe at mail.berlios.de  Thu May  7 14:33:28 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 14:33:28 +0200
Subject: [Openocd-svn] r1637 - trunk/src/target
Message-ID: <200905071233.n47CXSXM023395@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 14:33:26 +0200 (Thu, 07 May 2009)
New Revision: 1637

Modified:
   trunk/src/target/arm_adi_v5.c
Log:
remove in_handler usage

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-07 12:29:31 UTC (rev 1636)
+++ trunk/src/target/arm_adi_v5.c	2009-05-07 12:33:26 UTC (rev 1637)
@@ -77,23 +77,23 @@
 	fields[0].num_bits = 3;
 	buf_set_u32(&out_addr_buf, 0, 3, ((reg_addr >> 1) & 0x6) | (RnW & 0x1));
 	fields[0].out_value = &out_addr_buf;
-	
+
 	fields[0].in_value = ack;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = outvalue;
-	
+
 	fields[1].in_value = invalue;
 	fields[1].in_handler = NULL;
-	
-	
-	
 
+
+
+
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	return ERROR_OK;
@@ -113,34 +113,30 @@
 	fields[0].num_bits = 3;
 	buf_set_u32(&out_addr_buf, 0, 3, ((reg_addr >> 1) & 0x6) | (RnW & 0x1));
 	fields[0].out_value = &out_addr_buf;
-	
 	fields[0].in_value = ack;
-	
-	
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	buf_set_u32(out_value_buf, 0, 32, outvalue);
 	fields[1].out_value = out_value_buf;
-	
 	fields[1].in_value = NULL;
+	fields[1].in_handler = NULL;
+
 	if (invalue)
 	{
-		fields[1].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
-		fields[1].in_handler_priv = invalue;
-	}
-	else
+		u8 tmp[4];
+		fields[1].in_value = tmp;
+		jtag_add_dr_scan_now(2, fields, TAP_INVALID);
+
+		*invalue=flip_u32(le_to_h_u32(tmp), 32);
+	} else
 	{
-		fields[1].in_handler = NULL;
-		
+
+		jtag_add_dr_scan(2, fields, TAP_INVALID);
 	}
-	
-	
 
-	jtag_add_dr_scan(2, fields, TAP_INVALID);
-
 	return ERROR_OK;
 }
 
@@ -296,7 +292,7 @@
 {
 	return scan_inout_check_u32(swjdp, SWJDP_IR_DPACC, reg_addr, DPAP_READ, 0, value);
 }
- 
+
 int dap_ap_select(swjdp_common_t *swjdp,u8 apsel)
 {
 	u32 select;
@@ -1012,7 +1008,7 @@
 
 	u32 dbgbase,apid;
 	int romtable_present = 0;
-	u8 mem_ap; 
+	u8 mem_ap;
 	u32 apselold;
 
 	apselold = swjdp->apsel;
@@ -1028,23 +1024,23 @@
 		switch (apid&0x0F)
 		{
 			case 0:
-				command_print(cmd_ctx, "\tType is jtag-ap");		
+				command_print(cmd_ctx, "\tType is jtag-ap");
 				break;
 			case 1:
-				command_print(cmd_ctx, "\tType is mem-ap AHB");		
+				command_print(cmd_ctx, "\tType is mem-ap AHB");
 				break;
 			case 2:
-				command_print(cmd_ctx, "\tType is mem-ap APB");				
+				command_print(cmd_ctx, "\tType is mem-ap APB");
 				break;
 			default:
-				command_print(cmd_ctx, "\tUnknown AP-type");	
+				command_print(cmd_ctx, "\tUnknown AP-type");
 			break;
 		}
 		command_print(cmd_ctx, "ap debugbase 0x%8.8x", dbgbase);
 	}
 	else
 	{
-		command_print(cmd_ctx, "No AP found at this apsel 0x%x", apsel);	
+		command_print(cmd_ctx, "No AP found at this apsel 0x%x", apsel);
 	}
 
 	romtable_present = ((mem_ap)&&(dbgbase != 0xFFFFFFFF));
@@ -1062,11 +1058,11 @@
 			command_print(cmd_ctx, "\tROM table in legacy format" );
 		}
 		/* Now we read ROM table ID registers, ref. ARM IHI 0029B sec  */
-		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFF0, &cid0);		
-		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFF4, &cid1);		
-		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFF8, &cid2);		
-		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFFC, &cid3);		
-		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFCC, &memtype);		
+		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFF0, &cid0);
+		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFF4, &cid1);
+		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFF8, &cid2);
+		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFFC, &cid3);
+		mem_ap_read_u32(swjdp, (dbgbase&0xFFFFF000)|0xFCC, &memtype);
 		swjdp_transaction_endcheck(swjdp);
 		command_print(cmd_ctx, "\tCID3 0x%x, CID2 0x%x, CID1 0x%x, CID0, 0x%x",cid3,cid2,cid1,cid0);
 		if (memtype&0x01)
@@ -1077,10 +1073,10 @@
 		{
 			command_print(cmd_ctx, "\tMEMTYPE system memory not present. Dedicated debug bus" );
 		}
-		
+
 		/* Now we read ROM table entries from dbgbase&0xFFFFF000)|0x000 until we get 0x00000000 */
 		entry_offset = 0;
-		do 
+		do
 		{
 			mem_ap_read_atomic_u32(swjdp, (dbgbase&0xFFFFF000)|entry_offset, &romentry);
 			command_print(cmd_ctx, "\tROMTABLE[0x%x] = 0x%x",entry_offset,romentry);
@@ -1107,16 +1103,16 @@
 			else
 			{
 				if (romentry)
-					command_print(cmd_ctx, "\t\tComponent not present");		
+					command_print(cmd_ctx, "\t\tComponent not present");
 				else
-					command_print(cmd_ctx, "\t\tEnd of ROM table");							
+					command_print(cmd_ctx, "\t\tEnd of ROM table");
 			}
 			entry_offset += 4;
 		} while (romentry>0);
 	}
 	else
 	{
-		command_print(cmd_ctx, "\tNo ROM table present");		
+		command_print(cmd_ctx, "\tNo ROM table present");
 	}
 	dap_ap_select(swjdp, apselold);
 



From oharboe at mail.berlios.de  Thu May  7 15:04:13 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 15:04:13 +0200
Subject: [Openocd-svn] r1638 - trunk/src/jtag
Message-ID: <200905071304.n47D4Dn1026729@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 15:04:13 +0200 (Thu, 07 May 2009)
New Revision: 1638

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
Log:
jtag API error handling refactoring.

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-07 12:33:26 UTC (rev 1637)
+++ trunk/src/jtag/jtag.c	2009-05-07 13:04:13 UTC (rev 1638)
@@ -42,8 +42,8 @@
 #include <strings.h>
 #endif
 
-static void jtag_execute_queue_noclear(void);
 
+
 /* note that this is not marked as static as it must be available from outside jtag.c for those
    that implement the jtag_xxx() minidriver layer
 */
@@ -1446,7 +1446,7 @@
 	return retval;
 }
 
-static void jtag_execute_queue_noclear(void)
+void jtag_execute_queue_noclear(void)
 {
 	int retval=interface_jtag_execute_queue();
 	/* we keep the first error */

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-07 12:33:26 UTC (rev 1637)
+++ trunk/src/jtag/jtag.h	2009-05-07 13:04:13 UTC (rev 1638)
@@ -700,6 +700,9 @@
  */
 extern int            jtag_execute_queue(void);
 
+/* same as jtag_execute_queue() but does not clear the error flag */
+extern void jtag_execute_queue_noclear(void);
+
 /* this flag is set when an error occurs while executing the queue. cleared
  * by jtag_execute_queue()
  *
@@ -708,8 +711,18 @@
  */
 extern int jtag_error;
 
+static __inline__ void jtag_set_error(int error)
+{
+	if ((error==ERROR_OK)||(jtag_error!=ERROR_OK))
+	{
+		/* keep first error */
+		return;
+	}
+	jtag_error=error;
+}
 
 
+
 /* can be implemented by hw+sw */
 extern int            interface_jtag_execute_queue(void);
 extern int            jtag_power_dropout(int* dropout);



From oharboe at mail.berlios.de  Thu May  7 15:23:15 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 15:23:15 +0200
Subject: [Openocd-svn] r1639 - trunk/src/target
Message-ID: <200905071323.n47DNFt8029190@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 15:23:14 +0200 (Thu, 07 May 2009)
New Revision: 1639

Modified:
   trunk/src/target/arm11_dbgtap.c
Log:
stop using in_handler

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2009-05-07 13:04:13 UTC (rev 1638)
+++ trunk/src/target/arm11_dbgtap.c	2009-05-07 13:23:14 UTC (rev 1639)
@@ -130,7 +130,7 @@
  *  arm11_add_debug_SCAN_N().
  *
  */
-static int arm11_in_handler_SCAN_N(u8 *in_value, void *priv, struct scan_field_s *field)
+static void arm11_in_handler_SCAN_N(u8 *in_value)
 {
 	/** \todo TODO: clarify why this isnt properly masked in jtag.c jtag_read_buffer() */
 	u8 v = *in_value & 0x1F;
@@ -138,11 +138,10 @@
 	if (v != 0x10)
 	{
 		LOG_ERROR("'arm11 target' JTAG communication error SCREG SCAN OUT 0x%02x (expected 0x10)", v);
-		return ERROR_FAIL;
+		jtag_set_error(ERROR_FAIL);
 	}
 
 	JTAG_DEBUG("SCREG SCAN OUT 0x%02x", v);
-	return ERROR_OK;
 }
 
 /** Select and write to Scan Chain Register (SCREG)
@@ -177,11 +176,14 @@
 
 	scan_field_t		field;
 
-	arm11_setup_field(arm11, 5, &chain, NULL, &field);
+	u8 tmp[1];
+	arm11_setup_field(arm11, 5, &chain, &tmp, &field);
 
-	field.in_handler = arm11_in_handler_SCAN_N; /* deprecated! invoke this from user code! */
+	arm11_add_dr_scan_vc(1, &field, state == ARM11_TAP_DEFAULT ? TAP_DRPAUSE : state);
 
-	arm11_add_dr_scan_vc(1, &field, state == ARM11_TAP_DEFAULT ? TAP_DRPAUSE : state);
+	jtag_execute_queue_noclear();
+
+	arm11_in_handler_SCAN_N(tmp); /* deprecated! invoke this from user code! */
 }
 
 /** Write an instruction into the ITR register



From oharboe at mail.berlios.de  Thu May  7 15:26:35 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 15:26:35 +0200
Subject: [Openocd-svn] r1640 - trunk/src/target
Message-ID: <200905071326.n47DQZaq029593@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 15:26:35 +0200 (Thu, 07 May 2009)
New Revision: 1640

Modified:
   trunk/src/target/arm720t.c
Log:
remove in_handler usage

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-07 13:23:14 UTC (rev 1639)
+++ trunk/src/target/arm720t.c	2009-05-07 13:26:35 UTC (rev 1640)
@@ -112,32 +112,25 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &instruction_buf;
-	
 	fields[0].in_value = NULL;
-	
-	
 	fields[0].in_handler = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = out_buf;
-	
 	fields[1].in_value = NULL;
+	fields[1].in_handler = NULL;
 	if (in)
 	{
-		fields[1].in_handler = arm_jtag_buf_to_u32_flip; /* deprecated! invoke this from user code! */
-		fields[1].in_handler_priv = in;
+		u8 tmp[4];
+		fields[1].in_value = tmp;
+		jtag_add_dr_scan_now(2, fields, TAP_INVALID);
+		*in=flip_u32(le_to_h_u32(tmp), 32);
 	} else
 	{
-		fields[1].in_handler = NULL;
-		
+		jtag_add_dr_scan(2, fields, TAP_INVALID);
 	}
-	
-	
 
-	jtag_add_dr_scan(2, fields, TAP_INVALID);
-
 	if (clock)
 		jtag_add_runtest(0, TAP_INVALID);
 



From oharboe at mail.berlios.de  Thu May  7 15:31:34 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 15:31:34 +0200
Subject: [Openocd-svn] r1641 - trunk/src/target
Message-ID: <200905071331.n47DVYDT030159@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 15:31:34 +0200 (Thu, 07 May 2009)
New Revision: 1641

Modified:
   trunk/src/target/arm11_dbgtap.c
   trunk/src/target/arm920t.c
Log:
remove in_handler usage

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2009-05-07 13:26:35 UTC (rev 1640)
+++ trunk/src/target/arm11_dbgtap.c	2009-05-07 13:31:34 UTC (rev 1641)
@@ -183,7 +183,7 @@
 
 	jtag_execute_queue_noclear();
 
-	arm11_in_handler_SCAN_N(tmp); /* deprecated! invoke this from user code! */
+	arm11_in_handler_SCAN_N(tmp);
 }
 
 /** Write an instruction into the ITR register

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-07 13:26:35 UTC (rev 1640)
+++ trunk/src/target/arm920t.c	2009-05-07 13:31:34 UTC (rev 1641)
@@ -113,51 +113,37 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
-	
 	fields[0].in_value = NULL;
-	
-	
 	fields[0].in_handler = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	
 	fields[1].in_value = NULL;
-	
-	
 	fields[1].in_handler = NULL;
-	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
-	
 	fields[2].in_value = NULL;
-	
-	
 	fields[2].in_handler = NULL;
-	
 
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	
 	fields[3].in_value = NULL;
-	
-	
 	fields[3].in_handler = NULL;
-	
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
-	fields[1].in_handler_priv = value;
-	fields[1].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
+	u8 tmp[4];
+	fields[1].in_value = tmp;
 
-	jtag_add_dr_scan(4, fields, TAP_INVALID);
+	jtag_add_dr_scan_now(4, fields, TAP_INVALID);
 
-#ifdef _DEBUG_INSTRUCTION_EXECUTION_
+	*value=le_to_h_u32(tmp);
+
+	#ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	jtag_execute_queue();
 	LOG_DEBUG("addr: 0x%x value: %8.8x", reg_addr, *value);
 #endif
@@ -185,43 +171,43 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = value_buf;
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	
+
 	fields[3].in_value = NULL;
-	
-	
+
+
 	fields[3].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
@@ -252,43 +238,43 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = cp15_opcode_buf;
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	
+
 	fields[3].in_value = NULL;
-	
-	
+
+
 	fields[3].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 	arm9tdmi_clock_out(jtag_info, arm_opcode, 0, NULL, 0);



From oharboe at mail.berlios.de  Thu May  7 15:36:35 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 15:36:35 +0200
Subject: [Openocd-svn] r1642 - trunk/src/target
Message-ID: <200905071336.n47DaZcM031178@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 15:36:35 +0200 (Thu, 07 May 2009)
New Revision: 1642

Modified:
   trunk/src/target/arm966e.c
Log:
remove in_handler usage

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-07 13:31:34 UTC (rev 1641)
+++ trunk/src/target/arm966e.c	2009-05-07 13:36:35 UTC (rev 1642)
@@ -187,40 +187,31 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	
 	fields[0].in_value = NULL;
-	
-	
 	fields[0].in_handler = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 6;
 	fields[1].out_value = &reg_addr_buf;
-	
 	fields[1].in_value = NULL;
-	
-	
 	fields[1].in_handler = NULL;
-	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &nr_w_buf;
-	
 	fields[2].in_value = NULL;
-	
-	
 	fields[2].in_handler = NULL;
-	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	fields[0].in_handler_priv = value;
-	fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
+	u8 tmp[4];
+	fields[1].in_value = tmp;
 
-	jtag_add_dr_scan(3, fields, TAP_INVALID);
+	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
+	*value=flip_u32(le_to_h_u32(tmp), 32);
+
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	if((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -255,33 +246,33 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = value_buf;
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 6;
 	fields[1].out_value = &reg_addr_buf;
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &nr_w_buf;
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_



From oharboe at mail.berlios.de  Thu May  7 15:40:11 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 15:40:11 +0200
Subject: [Openocd-svn] r1643 - trunk/src/target
Message-ID: <200905071340.n47DeB9N032053@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 15:40:11 +0200 (Thu, 07 May 2009)
New Revision: 1643

Modified:
   trunk/src/target/arm9tdmi.c
Log:
remove in_handler usage

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-07 13:36:35 UTC (rev 1642)
+++ trunk/src/target/arm9tdmi.c	2009-05-07 13:40:11 UTC (rev 1643)
@@ -128,33 +128,33 @@
 		fields[0].tap = arm7_9->jtag_info.tap;
 		fields[0].num_bits = 32;
 		fields[0].out_value = NULL;
-		
+
 		fields[0].in_value = databus;
-		
-		
+
+
 		fields[0].in_handler = NULL;
-		
 
+
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 3;
 		fields[1].out_value = NULL;
-		
+
 		fields[1].in_value = &debug_reason;
-		
-		
+
+
 		fields[1].in_handler = NULL;
-		
 
+
 		fields[2].tap = arm7_9->jtag_info.tap;
 		fields[2].num_bits = 32;
 		fields[2].out_value = NULL;
-		
+
 		fields[2].in_value = instructionbus;
-		
-		
+
+
 		fields[2].in_handler = NULL;
-		
 
+
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
 			return retval;
@@ -216,43 +216,35 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
-	
 	fields[0].in_value = NULL;
-	if (in)
-	{
-		fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
-		fields[0].in_handler_priv = in;
-	}
-	else
-	{
-		fields[0].in_handler = NULL;
-		
-	}
-	
-	
+	fields[0].in_handler = NULL;
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
-	
 	fields[1].in_value = NULL;
-	
-	
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
-	
 	fields[2].in_value = NULL;
-	
-	
 	fields[2].in_handler = NULL;
-	
 
-	jtag_add_dr_scan(3, fields, TAP_INVALID);
+	if (in)
+	{
+		u8 tmp[4];
+		fields[0].in_value=tmp;
+		jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
+		*in=flip_u32(le_to_h_u32(tmp), 32);
+	}
+	else
+	{
+		jtag_add_dr_scan(3, fields, TAP_INVALID);
+	}
+
 	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
@@ -291,33 +283,33 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	
+
 	fields[0].in_value = NULL;
 	fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
 	fields[0].in_handler_priv = in;
-	
-	
 
+
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
-	
+
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
-	
-	
-	
 
+
+
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	jtag_add_runtest(0, TAP_INVALID);
@@ -363,7 +355,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	
+
 	fields[0].in_value = NULL;
 	switch (size)
 	{
@@ -378,29 +370,29 @@
 			break;
 	}
 	fields[0].in_handler_priv = in;
-	
-	
 
+
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
-	
+
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
-	
-	
-	
 
+
+
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	jtag_add_runtest(0, TAP_INVALID);
@@ -1032,11 +1024,11 @@
 {
 	int retval;
 	command_t *arm9tdmi_cmd;
-	
+
 	retval = arm7_9_register_commands(cmd_ctx);
 	arm9tdmi_cmd = register_command(cmd_ctx, NULL, "arm9tdmi", NULL, COMMAND_ANY, "arm9tdmi specific commands");
 	register_command(cmd_ctx, arm9tdmi_cmd, "vector_catch", handle_arm9tdmi_catch_vectors_command, COMMAND_EXEC, "catch arm920t vectors ['all'|'none'|'<vec1 vec2 ...>']");
-	
+
 	return retval;
 }
 



From oharboe at mail.berlios.de  Thu May  7 15:50:38 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 15:50:38 +0200
Subject: [Openocd-svn] r1644 - trunk/src/target
Message-ID: <200905071350.n47DocNj000966@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 15:50:37 +0200 (Thu, 07 May 2009)
New Revision: 1644

Modified:
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm9tdmi.c
Log:
remove in_handler usage

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-07 13:40:11 UTC (rev 1643)
+++ trunk/src/target/arm7tdmi.c	2009-05-07 13:50:37 UTC (rev 1644)
@@ -234,6 +234,36 @@
 	return ERROR_OK;
 }
 
+void arm_endianness(u8 *tmp, void *in, int size, int be)
+{
+	u32 readback=flip_u32(le_to_h_u32(tmp), 32);
+	switch (size)
+	{
+		case 4:
+			if (be)
+			{
+				h_u32_to_be(((u8*)in), readback);
+			} else
+			{
+				 h_u32_to_le(((u8*)in), readback);
+			}
+			break;
+		case 2:
+			if (be)
+			{
+				h_u16_to_be(((u8*)in), readback & 0xffff);
+			} else
+			{
+				h_u16_to_le(((u8*)in), readback & 0xffff);
+			}
+			break;
+		case 1:
+			*((u8 *)in)= readback & 0xff;
+			break;
+	}
+
+}
+
 /* clock the target, and read the databus
  * the *in pointer points to a buffer where elements of 'size' bytes
  * are stored in big (be==1) or little (be==0) endianness
@@ -265,31 +295,7 @@
 
 	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 
-	u32 readback=flip_u32(le_to_h_u32(tmp), 32);
-	switch (size)
-	{
-		case 4:
-			if (be)
-			{
-				h_u32_to_be(((u8*)in), readback);
-			} else
-			{
-				 h_u32_to_le(((u8*)in), readback);
-			}
-			break;
-		case 2:
-			if (be)
-			{
-				h_u16_to_be(((u8*)in), readback & 0xffff);
-			} else
-			{
-				h_u16_to_le(((u8*)in), readback & 0xffff);
-			}
-			break;
-		case 1:
-			*((u8 *)in)= readback & 0xff;
-			break;
-	}
+	arm_endianness(tmp, in, size, be);
 
 	jtag_add_runtest(0, TAP_INVALID);
 

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-07 13:40:11 UTC (rev 1643)
+++ trunk/src/target/arm9tdmi.c	2009-05-07 13:50:37 UTC (rev 1644)
@@ -283,34 +283,25 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
+	u8 tmp[4];
+	fields[0].in_value = tmp;
+	fields[0].in_handler = NULL;
 
-	fields[0].in_value = NULL;
-	fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
-	fields[0].in_handler_priv = in;
-
-
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
-
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
 
-
-
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
-
 	fields[2].in_value = NULL;
-
-
 	fields[2].in_handler = NULL;
 
+	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
-	jtag_add_dr_scan(3, fields, TAP_INVALID);
+	*in=flip_u32(le_to_h_u32(tmp), 32);
 
 	jtag_add_runtest(0, TAP_INVALID);
 
@@ -335,6 +326,8 @@
 	return ERROR_OK;
 }
 
+extern void arm_endianness(u8 *tmp, void *in, int size, int be);
+
 /* clock the target, and read the databus
  * the *in pointer points to a buffer where elements of 'size' bytes
  * are stored in big (be==1) or little (be==0) endianness
@@ -355,46 +348,27 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
+	u8 tmp[4];
+	fields[0].in_value = tmp;
+	fields[0].in_handler = NULL;
 
-	fields[0].in_value = NULL;
-	switch (size)
-	{
-		case 4:
-			fields[0].in_handler = (be) ? arm_jtag_buf_to_be32 : arm_jtag_buf_to_le32; /* deprecated! invoke this from user code! */
-			break;
-		case 2:
-			fields[0].in_handler = (be) ? arm_jtag_buf_to_be16 : arm_jtag_buf_to_le16; /* deprecated! invoke this from user code! */
-			break;
-		case 1:
-			fields[0].in_handler = arm_jtag_buf_to_8; /* deprecated! invoke this from user code! */
-			break;
-	}
-	fields[0].in_handler_priv = in;
-
-
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
-
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
 
-
-
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
-
 	fields[2].in_value = NULL;
-
-
 	fields[2].in_handler = NULL;
 
+	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
-	jtag_add_dr_scan(3, fields, TAP_INVALID);
+	arm_endianness(tmp, in, size, be);
 
+
 	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_



From oharboe at mail.berlios.de  Thu May  7 15:54:42 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 15:54:42 +0200
Subject: [Openocd-svn] r1645 - trunk/src/target
Message-ID: <200905071354.n47DsgdT001398@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 15:54:41 +0200 (Thu, 07 May 2009)
New Revision: 1645

Modified:
   trunk/src/target/embeddedice.c
Log:
remove in_handler usage

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-07 13:50:37 UTC (rev 1644)
+++ trunk/src/target/embeddedice.c	2009-05-07 13:54:41 UTC (rev 1645)
@@ -251,35 +251,35 @@
 	fields[0].tap = ice_reg->jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = ice_reg->jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, reg_addr);
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = ice_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_value = reg->value;
@@ -313,34 +313,23 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	
-	fields[0].in_value = NULL;
-	
-	
+	u8 tmp[4];
+	fields[0].in_value = tmp;
 	fields[0].in_handler = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_DATA]);
-	
 	fields[1].in_value = NULL;
-	
-	
 	fields[1].in_handler = NULL;
-	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	
 	fields[2].in_value = NULL;
-	
-	
 	fields[2].in_handler = NULL;
-	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -352,10 +341,10 @@
 		if (size == 1)
 			buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_CTRL]);
 
-		fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
-		fields[0].in_handler_priv = data;
-		jtag_add_dr_scan(3, fields, TAP_INVALID);
+		jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
+		*data = le_to_h_u32(tmp);
+
 		data++;
 		size--;
 	}
@@ -430,35 +419,35 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = field0_out;
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_DATA]);
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	while (size > 0)
 	{
 		buf_set_u32(fields[0].out_value, 0, 32, *data);
@@ -499,35 +488,35 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	
+
 	fields[0].in_value = field0_in;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_CTRL]);
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 	gettimeofday(&lap, NULL);
 	do



From oharboe at mail.berlios.de  Thu May  7 15:57:43 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 15:57:43 +0200
Subject: [Openocd-svn] r1646 - trunk/src/target
Message-ID: <200905071357.n47DvhJ7001680@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 15:57:43 +0200 (Thu, 07 May 2009)
New Revision: 1646

Modified:
   trunk/src/target/etb.c
Log:
remove in_handler usage

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-07 13:54:41 UTC (rev 1645)
+++ trunk/src/target/etb.c	2009-05-07 13:57:43 UTC (rev 1646)
@@ -70,13 +70,13 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		
+
 		field.in_value = NULL;
-		
-		
+
+
 		field.in_handler = NULL;
-		
 
+
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 
 		free(field.out_value);
@@ -95,13 +95,13 @@
 		field.num_bits = 5;
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_scan_chain);
-		
+
 		field.in_value = NULL;
-		
-		
+
+
 		field.in_handler = NULL;
-		
 
+
 		/* select INTEST instruction */
 		etb_set_instr(etb, 0x2);
 		jtag_add_dr_scan(1, &field, TAP_INVALID);
@@ -186,38 +186,26 @@
 	fields[0].tap = etb->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	
-	fields[0].in_value = NULL;
-	
-	
+	u8 tmp[4];
+	fields[0].in_value = tmp;
 	fields[0].in_handler = NULL;
-	
 
 	fields[1].tap = etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, 4);
-	
 	fields[1].in_value = NULL;
-	
-	
 	fields[1].in_handler = NULL;
-	
 
 	fields[2].tap = etb->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	
 	fields[2].in_value = NULL;
-	
-	
 	fields[2].in_handler = NULL;
-	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	fields[0].in_handler = buf_to_u32_handler; /* deprecated! invoke this from user code! */
 
 	for (i = 0; i < num_frames; i++)
 	{
@@ -230,8 +218,9 @@
 		else
 			buf_set_u32(fields[1].out_value, 0, 7, 0);
 
-		fields[0].in_handler_priv = &data[i];
-		jtag_add_dr_scan(3, fields, TAP_INVALID);
+		jtag_add_dr_scan_now(3, fields, TAP_INVALID);
+
+		data[i]=buf_get_u32(tmp, 0, 32);
 	}
 
 	jtag_execute_queue();
@@ -257,35 +246,35 @@
 	fields[0].tap = etb_reg->etb->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = etb_reg->etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = etb_reg->etb->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	/* read the identification register in the second run, to make sure we
@@ -354,35 +343,35 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = malloc(4);
 	buf_set_u32(fields[0].out_value, 0, 32, value);
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = etb_reg->etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = etb_reg->etb->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	free(fields[0].out_value);



From oharboe at mail.berlios.de  Thu May  7 16:02:21 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 16:02:21 +0200
Subject: [Openocd-svn] r1647 - trunk/src/target
Message-ID: <200905071402.n47E2Lcd002208@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 16:02:21 +0200 (Thu, 07 May 2009)
New Revision: 1647

Modified:
   trunk/src/target/xscale.c
Log:
remove in_handler usage

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-07 13:57:43 UTC (rev 1646)
+++ trunk/src/target/xscale.c	2009-05-07 14:02:21 UTC (rev 1647)
@@ -225,7 +225,7 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		
+
 		field.in_value = NULL;
 		jtag_set_check_value(&field, tap->expected, tap->expected_mask, NULL);
 
@@ -261,24 +261,24 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = &field0;
-	
+
 	fields[0].in_value = NULL;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	
+
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
 	fields[1].in_handler = NULL;
-	
-	
-	
 
+
+
+
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
-	
+
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -339,24 +339,19 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = NULL;
-	
 	fields[0].in_value = NULL;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	
-	fields[1].in_value = NULL;
+	u8 tmp[4];
+	fields[1].in_value = tmp;
 	fields[1].in_handler = NULL;
-	
-	
-	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
-	
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -373,11 +368,12 @@
 		for (i = words_done; i < num_words; i++)
 		{
 			fields[0].in_value = &field0[i];
-			fields[1].in_handler = buf_to_u32_handler; /* deprecated! invoke this from user code! */
-			fields[1].in_handler_priv = (u8*)&field1[i]; 
 
 			jtag_add_pathmove(3, path);
-			jtag_add_dr_scan(3, fields, TAP_IDLE);
+			jtag_add_dr_scan_now(3, fields, TAP_IDLE);
+
+			field1[i]=buf_get_u32(tmp, 0, 32);
+
 			words_scheduled++;
 		}
 
@@ -458,24 +454,24 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = NULL;
-	
+
 	fields[0].in_value = &field0_in;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	
+
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_TX].value;
 	fields[1].in_handler = NULL;
-	
-	
-	
 
+
+
+
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
-	
+
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -554,24 +550,24 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = &field0_out;
-	
+
 	fields[0].in_value = &field0_in;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_RX].value;
-	
+
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
-	
-	
-	
 
+
+
+
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
-	
+
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -729,24 +725,24 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = &field0;
-	
+
 	fields[0].in_value = NULL;
 	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
-	
+
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
-	
-	
-	
 
+
+
+
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
-	
+
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
 
@@ -805,23 +801,23 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 6;
 	fields[0].out_value = &cmd;
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 27;
 	fields[1].out_value = packet;
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	fields[0].num_bits = 32;
@@ -867,23 +863,23 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 6;
 	fields[0].out_value = &cmd;
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 27;
 	fields[1].out_value = packet;
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	return ERROR_OK;



From oharboe at mail.berlios.de  Thu May  7 16:20:25 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 16:20:25 +0200
Subject: [Openocd-svn] r1648 - trunk/src/target
Message-ID: <200905071420.n47EKPv7004654@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 16:20:25 +0200 (Thu, 07 May 2009)
New Revision: 1648

Modified:
   trunk/src/target/arm926ejs.c
Log:
remove usage of in_handler

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-07 14:02:21 UTC (rev 1647)
+++ trunk/src/target/arm926ejs.c	2009-05-07 14:20:25 UTC (rev 1648)
@@ -137,55 +137,41 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	
-	fields[0].in_value = NULL;
-	
-	
+	u8 tmp[4];
+	fields[0].in_value = tmp;
 	fields[0].in_handler = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 1;
 	fields[1].out_value = &access;
-	
 	fields[1].in_value = &access;
-	
-	
 	fields[1].in_handler = NULL;
-	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
-	
 	fields[2].in_value = NULL;
-	
-	
 	fields[2].in_handler = NULL;
-	
 
+
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	
 	fields[3].in_value = NULL;
-	
-	
 	fields[3].in_handler = NULL;
-	
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
-	fields[0].in_handler_priv = value;
-	fields[0].in_handler = arm_jtag_buf_to_u32; /* deprecated! invoke this from user code! */
-
 	/*TODO: add timeout*/
 	do
 	{
 		/* rescan with NOP, to wait for the access to complete */
 		access = 0;
 		nr_w_buf = 0;
-		jtag_add_dr_scan(4, fields, TAP_INVALID);
+		jtag_add_dr_scan_now(4, fields, TAP_INVALID);
+
+		*value=le_to_h_u32(tmp);
+
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
@@ -227,43 +213,43 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = value_buf;
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 1;
 	fields[1].out_value = &access;
-	
+
 	fields[1].in_value = &access;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-	
+
 	fields[3].in_value = NULL;
-	
-	
+
+
 	fields[3].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 	/*TODO: add timeout*/
 	do



From oharboe at mail.berlios.de  Thu May  7 16:22:15 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 7 May 2009 16:22:15 +0200
Subject: [Openocd-svn] r1649 - trunk/src/target
Message-ID: <200905071422.n47EMFxa004784@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 16:22:15 +0200 (Thu, 07 May 2009)
New Revision: 1649

Modified:
   trunk/src/target/arm_jtag.c
Log:
marker for in_handler to remove

Modified: trunk/src/target/arm_jtag.c
===================================================================
--- trunk/src/target/arm_jtag.c	2009-05-07 14:20:25 UTC (rev 1648)
+++ trunk/src/target/arm_jtag.c	2009-05-07 14:22:15 UTC (rev 1649)
@@ -52,12 +52,12 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = t;
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-		
+
 		field.in_value = NULL;
-		
-		
-		field.in_handler = handler;
-		
+
+
+		field.in_handler = handler; /* deprecated! move into calling code */
+
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 	}
 



From oharboe at mail.berlios.de  Thu May  7 22:19:06 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Thu, 7 May 2009 22:19:06 +0200
Subject: [Openocd-svn] r1650 - trunk/src/target
Message-ID: <200905072019.n47KJ6Ud018013@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 22:19:04 +0200 (Thu, 07 May 2009)
New Revision: 1650

Modified:
   trunk/src/target/arm11.c
Log:
fix c99 compile errors

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-07 14:22:15 UTC (rev 1649)
+++ trunk/src/target/arm11.c	2009-05-07 20:19:04 UTC (rev 1650)
@@ -1144,7 +1144,8 @@
 		{
 			arm11->reg_list[ARM11_RC_R1].dirty = 1;
 
-			for (size_t i = 0; i < count; i++)
+			size_t i;
+			for (i = 0; i < count; i++)
 			{
 				/* ldrh    r1, [r0], #2 */
 				arm11_run_instr_no_data1(arm11,
@@ -1224,7 +1225,8 @@
 		{
 			arm11->reg_list[ARM11_RC_R1].dirty = 1;
 
-			for (size_t i = 0; i < count; i++)
+			size_t i;
+			for (i = 0; i < count; i++)
 			{
 				u16 value;
 				memcpy(&value, buffer + count * sizeof(u16), sizeof(u16));



From oharboe at mail.berlios.de  Thu May  7 22:24:25 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Thu, 7 May 2009 22:24:25 +0200
Subject: [Openocd-svn] r1651 - trunk/src/jtag
Message-ID: <200905072024.n47KOPlp018527@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 22:24:23 +0200 (Thu, 07 May 2009)
New Revision: 1651

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
Log:
verified that an argument is unused

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-07 20:19:04 UTC (rev 1650)
+++ trunk/src/jtag/jtag.c	2009-05-07 20:24:23 UTC (rev 1651)
@@ -1399,7 +1399,7 @@
   set up checking of this field using the in_handler. The values passed in must be valid until
   after jtag_execute() has completed.
  */
-void jtag_set_check_value(scan_field_t *field, u8 *value, u8 *mask, error_handler_t *in_error_handler)
+void jtag_set_check_value(scan_field_t *field, u8 *value, u8 *mask, struct invalidstruct *obsolete)
 {
 	if (value)
 		field->in_handler = jtag_check_value;

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-07 20:19:04 UTC (rev 1650)
+++ trunk/src/jtag/jtag.h	2009-05-07 20:24:23 UTC (rev 1651)
@@ -729,7 +729,12 @@
 extern int            jtag_srst_asserted(int* srst_asserted);
 
 /* JTAG support functions */
-extern void           jtag_set_check_value(scan_field_t* field, u8* value, u8* mask, error_handler_t* in_error_handler);
+struct invalidstruct
+{
+	
+};
+
+extern void           jtag_set_check_value(scan_field_t* field, u8* value, u8* mask, struct invalidstruct *obsolete);
 extern enum scan_type jtag_scan_type(scan_command_t* cmd);
 extern int            jtag_scan_size(scan_command_t* cmd);
 extern int            jtag_read_buffer(u8* buffer, scan_command_t* cmd);



From oharboe at mail.berlios.de  Thu May  7 22:53:35 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Thu, 7 May 2009 22:53:35 +0200
Subject: [Openocd-svn] r1652 - trunk/src/jtag
Message-ID: <200905072053.n47KrZhq021864@sheep.berlios.de>

Author: oharboe
Date: 2009-05-07 22:53:32 +0200 (Thu, 07 May 2009)
New Revision: 1652

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
Log:
refactor to be able to remove more in_handler stuff

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-07 20:24:23 UTC (rev 1651)
+++ trunk/src/jtag/jtag.c	2009-05-07 20:53:32 UTC (rev 1652)
@@ -1347,7 +1347,7 @@
 	return (tap == NULL) ? "(unknown)" : tap->dotted_name;
 }
 
-int jtag_check_value(u8 *captured, void *priv, scan_field_t *field)
+int jtag_check_value_inner(u8 *captured, scan_field_t *field, u8 *in_check_value, u8 *in_check_mask)
 {
 	int retval = ERROR_OK;
 	int num_bits = field->num_bits;
@@ -1355,9 +1355,9 @@
 	int compare_failed = 0;
 
 	if (field->in_check_mask)
-		compare_failed = buf_cmp_mask(captured, field->in_check_value, field->in_check_mask, num_bits);
+		compare_failed = buf_cmp_mask(captured, in_check_value, in_check_mask, num_bits);
 	else
-		compare_failed = buf_cmp(captured, field->in_check_value, num_bits);
+		compare_failed = buf_cmp(captured, in_check_value, num_bits);
 
 	if (compare_failed){
 		/* An error handler could have caught the failing check
@@ -1369,12 +1369,12 @@
 		if (compare_failed)
 		{
 			char *captured_char = buf_to_str(captured, (num_bits > DEBUG_JTAG_IOZ) ? DEBUG_JTAG_IOZ : num_bits, 16);
-			char *in_check_value_char = buf_to_str(field->in_check_value, (num_bits > DEBUG_JTAG_IOZ) ? DEBUG_JTAG_IOZ : num_bits, 16);
+			char *in_check_value_char = buf_to_str(in_check_value, (num_bits > DEBUG_JTAG_IOZ) ? DEBUG_JTAG_IOZ : num_bits, 16);
 
-			if (field->in_check_mask)
+			if (in_check_mask)
 			{
 				char *in_check_mask_char;
-				in_check_mask_char = buf_to_str(field->in_check_mask, (num_bits > DEBUG_JTAG_IOZ) ? DEBUG_JTAG_IOZ : num_bits, 16);
+				in_check_mask_char = buf_to_str(in_check_mask, (num_bits > DEBUG_JTAG_IOZ) ? DEBUG_JTAG_IOZ : num_bits, 16);
 				LOG_WARNING("value captured during scan didn't pass the requested check:");
 				LOG_WARNING("captured: 0x%s check_value: 0x%s check_mask: 0x%s",
 							captured_char, in_check_value_char, in_check_mask_char);
@@ -1395,6 +1395,11 @@
 	return retval;
 }
 
+int jtag_check_value(u8 *captured, void *priv, scan_field_t *field)
+{
+	return jtag_check_value_inner(captured, field, field->in_check_value, field->in_check_mask);
+}
+
 /*
   set up checking of this field using the in_handler. The values passed in must be valid until
   after jtag_execute() has completed.
@@ -1410,6 +1415,17 @@
 	field->in_check_mask = mask;
 }
 
+void jtag_check_value_mask(scan_field_t *field, u8 *value, u8 *mask)
+{
+	jtag_execute_queue_noclear();
+	
+	int retval=jtag_check_value_inner(field->in_value, field, value, mask);
+	jtag_set_error(retval);
+	
+}
+
+
+
 enum scan_type jtag_scan_type(scan_command_t *cmd)
 {
 	int i;

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-07 20:24:23 UTC (rev 1651)
+++ trunk/src/jtag/jtag.h	2009-05-07 20:53:32 UTC (rev 1652)
@@ -735,6 +735,9 @@
 };
 
 extern void           jtag_set_check_value(scan_field_t* field, u8* value, u8* mask, struct invalidstruct *obsolete);
+/* execute jtag queue and check value and use mask if mask is != NULL. invokes
+ * jtag_set_error() with any error. */
+extern void jtag_check_value_mask(scan_field_t *field, u8 *value, u8 *mask);
 extern enum scan_type jtag_scan_type(scan_command_t* cmd);
 extern int            jtag_scan_size(scan_command_t* cmd);
 extern int            jtag_read_buffer(u8* buffer, scan_command_t* cmd);



From oharboe at mail.berlios.de  Fri May  8 00:45:19 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 8 May 2009 00:45:19 +0200
Subject: [Openocd-svn] r1653 - trunk/src/target
Message-ID: <200905072245.n47MjJrp015112@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 00:45:17 +0200 (Fri, 08 May 2009)
New Revision: 1653

Modified:
   trunk/src/target/arm_adi_v5.c
Log:
fix copy & paste error when retiring in_handler

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-07 20:53:32 UTC (rev 1652)
+++ trunk/src/target/arm_adi_v5.c	2009-05-07 22:45:17 UTC (rev 1653)
@@ -130,7 +130,7 @@
 		fields[1].in_value = tmp;
 		jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 
-		*invalue=flip_u32(le_to_h_u32(tmp), 32);
+		*invalue=le_to_h_u32(in_buf);
 	} else
 	{
 



From oharboe at mail.berlios.de  Fri May  8 00:55:30 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 8 May 2009 00:55:30 +0200
Subject: [Openocd-svn] r1654 - trunk/src/target
Message-ID: <200905072255.n47MtU5P026174@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 00:55:28 +0200 (Fri, 08 May 2009)
New Revision: 1654

Modified:
   trunk/src/target/arm966e.c
Log:
in_handler removal typo fixed

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-07 22:45:17 UTC (rev 1653)
+++ trunk/src/target/arm966e.c	2009-05-07 22:55:28 UTC (rev 1654)
@@ -209,7 +209,7 @@
 
 	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
-	*value=flip_u32(le_to_h_u32(tmp), 32);
+	*value=le_to_h_u32(tmp);
 
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_



From zwelch at mail.berlios.de  Fri May  8 00:59:23 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 8 May 2009 00:59:23 +0200
Subject: [Openocd-svn] r1655 - trunk/src/helper
Message-ID: <200905072259.n47MxNsI029352@sheep.berlios.de>

Author: zwelch
Date: 2009-05-08 00:59:20 +0200 (Fri, 08 May 2009)
New Revision: 1655

Removed:
   trunk/src/helper/tclapi.c
Log:
Remove unreferenced tcpapi.c source file.

Deleted: trunk/src/helper/tclapi.c
===================================================================
--- trunk/src/helper/tclapi.c	2009-05-07 22:55:28 UTC (rev 1654)
+++ trunk/src/helper/tclapi.c	2009-05-07 22:59:20 UTC (rev 1655)
@@ -1,534 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
- *   Copyright (C) 2008 Duane Ellis                                        *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
-#include "replacements.h"
-#include "target.h"
-#include "target_request.h"
-
-#include "log.h"
-#include "configuration.h"
-#include "binarybuffer.h"
-#include "jtag.h"
-#include "flash.h"
-
-#include <string.h>
-#include <stdlib.h>
-#include <inttypes.h>
-
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <unistd.h>
-#include <errno.h>
-
-#include <sys/time.h>
-#include <time.h>
-
-#include <time_support.h>
-
-#include <fileio.h>
-#include <image.h>
-
-static int new_int_array_element(Jim_Interp * interp, const char *varname, int idx, u32 val)
-{
-	char *namebuf;
-	Jim_Obj *nameObjPtr, *valObjPtr;
-	int result;
-
-	namebuf = alloc_printf("%s(%d)", varname, idx);
-	if (!namebuf)
-		return JIM_ERR;
-
-	nameObjPtr = Jim_NewStringObj(interp, namebuf, -1);
-	valObjPtr = Jim_NewIntObj(interp, val);
-	if (!nameObjPtr || !valObjPtr)
-	{
-		free(namebuf);
-		return JIM_ERR;
-	}
-
-	Jim_IncrRefCount(nameObjPtr);
-	Jim_IncrRefCount(valObjPtr);
-	result = Jim_SetVariable(interp, nameObjPtr, valObjPtr);
-	Jim_DecrRefCount(interp, nameObjPtr);
-	Jim_DecrRefCount(interp, valObjPtr);
-	free(namebuf);
-	/* printf("%s(%d) <= 0%08x\n", varname, idx, val); */
-	return result;
-}
-
-static int jim_mem2array(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
-{
-	target_t *target;
-	command_context_t *context;
-	long l;
-	u32 width;
-	u32 len;
-	u32 addr;
-	u32 count;
-	u32 v;
-	const char *varname;
-	u8 buffer[4096];
-	int  i, n, e, retval;
-
-	/* argv[1] = name of array to receive the data
-	 * argv[2] = desired width
-	 * argv[3] = memory address
-	 * argv[4] = count of times to read
-	 */
-	if (argc != 5) {
-		Jim_WrongNumArgs(interp, 1, argv, "varname width addr nelems");
-		return JIM_ERR;
-	}
-	varname = Jim_GetString(argv[1], &len);
-	/* given "foo" get space for worse case "foo(%d)" .. add 20 */
-
-	e = Jim_GetLong(interp, argv[2], &l);
-	width = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-
-	e = Jim_GetLong(interp, argv[3], &l);
-	addr = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-	e = Jim_GetLong(interp, argv[4], &l);
-	len = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-	switch (width) {
-		case 8:
-			width = 1;
-			break;
-		case 16:
-			width = 2;
-			break;
-		case 32:
-			width = 4;
-			break;
-		default:
-			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-			Jim_AppendStrings( interp, Jim_GetResult(interp), "Invalid width param, must be 8/16/32", NULL );
-			return JIM_ERR;
-	}
-	if (len == 0) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: zero width read?", NULL);
-		return JIM_ERR;
-	}
-	if ((addr + (len * width)) < addr) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: addr + len - wraps to zero?", NULL);
-		return JIM_ERR;
-	}
-	/* absurd transfer size? */
-	if (len > 65536) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: absurd > 64K item request", NULL);
-		return JIM_ERR;
-	}
-
-	if ((width == 1) ||
-		((width == 2) && ((addr & 1) == 0)) ||
-		((width == 4) && ((addr & 3) == 0))) {
-		/* all is well */
-	} else {
-		char buf[100];
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		sprintf(buf, "mem2array address: 0x%08x is not aligned for %d byte reads", addr, width);
-		Jim_AppendStrings(interp, Jim_GetResult(interp), buf , NULL);
-		return JIM_ERR;
-	}
-
-	context = Jim_GetAssocData(interp, "context");
-	if (context == NULL)
-	{
-		LOG_ERROR("mem2array: no command context");
-		return JIM_ERR;
-	}
-	target = get_current_target(context);
-	if (target == NULL)
-	{
-		LOG_ERROR("mem2array: no current target");
-		return JIM_ERR;
-	}
-
-	/* Transfer loop */
-
-	/* index counter */
-	n = 0;
-	/* assume ok */
-	e = JIM_OK;
-	while (len) {
-		/* Slurp... in buffer size chunks */
-
-		count = len; /* in objects.. */
-		if (count > (sizeof(buffer)/width)) {
-			count = (sizeof(buffer)/width);
-		}
-
-		retval = target->type->read_memory( target, addr, width, count, buffer );
-		if (retval != ERROR_OK) {
-			/* BOO !*/
-			LOG_ERROR("mem2array: Read @ 0x%08x, w=%d, cnt=%d, failed", addr, width, count);
-			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-			Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: cannot read memory", NULL);
-			e = JIM_ERR;
-			len = 0;
-		} else {
-			v = 0; /* shut up gcc */
-			for (i = 0 ;i < count ;i++, n++) {
-				switch (width) {
-					case 4:
-						v = target_buffer_get_u32(target, &buffer[i*width]);
-						break;
-					case 2:
-						v = target_buffer_get_u16(target, &buffer[i*width]);
-						break;
-					case 1:
-						v = buffer[i] & 0x0ff;
-						break;
-				}
-				new_int_array_element(interp, varname, n, v);
-			}
-			len -= count;
-		}
-	}
-
-	Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-
-	return JIM_OK;
-}
-
-static int get_int_array_element(Jim_Interp * interp, const char *varname, int idx, u32 *val)
-{
-	char *namebuf;
-	Jim_Obj *nameObjPtr, *valObjPtr;
-	int result;
-	long l;
-
-	namebuf = alloc_printf("%s(%d)", varname, idx);
-	if (!namebuf)
-		return JIM_ERR;
-
-	nameObjPtr = Jim_NewStringObj(interp, namebuf, -1);
-	if (!nameObjPtr)
-	{
-		free(namebuf);
-		return JIM_ERR;
-	}
-
-	Jim_IncrRefCount(nameObjPtr);
-	valObjPtr = Jim_GetVariable(interp, nameObjPtr, JIM_ERRMSG);
-	Jim_DecrRefCount(interp, nameObjPtr);
-	free(namebuf);
-	if (valObjPtr == NULL)
-		return JIM_ERR;
-
-	result = Jim_GetLong(interp, valObjPtr, &l);
-	/* printf("%s(%d) => 0%08x\n", varname, idx, val); */
-	*val = l;
-	return result;
-}
-
-static int jim_array2mem(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
-{
-	target_t *target;
-	command_context_t *context;
-	long l;
-	u32 width;
-	u32 len;
-	u32 addr;
-	u32 count;
-	u32 v;
-	const char *varname;
-	u8 buffer[4096];
-	int  i, n, e, retval;
-
-	/* argv[1] = name of array to get the data
-	 * argv[2] = desired width
-	 * argv[3] = memory address
-	 * argv[4] = count to write
-	 */
-	if (argc != 5) {
-		Jim_WrongNumArgs(interp, 1, argv, "varname width addr nelems");
-		return JIM_ERR;
-	}
-	varname = Jim_GetString(argv[1], &len);
-	/* given "foo" get space for worse case "foo(%d)" .. add 20 */
-
-	e = Jim_GetLong(interp, argv[2], &l);
-	width = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-
-	e = Jim_GetLong(interp, argv[3], &l);
-	addr = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-	e = Jim_GetLong(interp, argv[4], &l);
-	len = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-	switch (width) {
-		case 8:
-			width = 1;
-			break;
-		case 16:
-			width = 2;
-			break;
-		case 32:
-			width = 4;
-			break;
-		default:
-			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-			Jim_AppendStrings( interp, Jim_GetResult(interp), "Invalid width param, must be 8/16/32", NULL );
-			return JIM_ERR;
-	}
-	if (len == 0) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "array2mem: zero width read?", NULL);
-		return JIM_ERR;
-	}
-	if ((addr + (len * width)) < addr) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "array2mem: addr + len - wraps to zero?", NULL);
-		return JIM_ERR;
-	}
-	/* absurd transfer size? */
-	if (len > 65536) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "array2mem: absurd > 64K item request", NULL);
-		return JIM_ERR;
-	}
-
-	if ((width == 1) ||
-		((width == 2) && ((addr & 1) == 0)) ||
-		((width == 4) && ((addr & 3) == 0))) {
-		/* all is well */
-	} else {
-		char buf[100];
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		sprintf(buf, "array2mem address: 0x%08x is not aligned for %d byte reads", addr, width);
-		Jim_AppendStrings(interp, Jim_GetResult(interp), buf , NULL);
-		return JIM_ERR;
-	}
-
-	context = Jim_GetAssocData(interp, "context");
-	if (context == NULL)
-	{
-		LOG_ERROR("array2mem: no command context");
-		return JIM_ERR;
-	}
-	target = get_current_target(context);
-	if (target == NULL)
-	{
-		LOG_ERROR("array2mem: no current target");
-		return JIM_ERR;
-	}
-
-	/* Transfer loop */
-
-	/* index counter */
-	n = 0;
-	/* assume ok */
-	e = JIM_OK;
-	while (len) {
-		/* Slurp... in buffer size chunks */
-
-		count = len; /* in objects.. */
-		if (count > (sizeof(buffer)/width)) {
-			count = (sizeof(buffer)/width);
-		}
-
-		v = 0; /* shut up gcc */
-		for (i = 0 ;i < count ;i++, n++) {
-			get_int_array_element(interp, varname, n, &v);
-			switch (width) {
-			case 4:
-				target_buffer_set_u32(target, &buffer[i*width], v);
-				break;
-			case 2:
-				target_buffer_set_u16(target, &buffer[i*width], v);
-				break;
-			case 1:
-				buffer[i] = v & 0x0ff;
-				break;
-			}
-		}
-		len -= count;
-
-		retval = target->type->write_memory(target, addr, width, count, buffer);
-		if (retval != ERROR_OK) {
-			/* BOO !*/
-			LOG_ERROR("array2mem: Write @ 0x%08x, w=%d, cnt=%d, failed", addr, width, count);
-			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-			Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: cannot read memory", NULL);
-			e = JIM_ERR;
-			len = 0;
-		}
-	}
-
-	Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-
-	return JIM_OK;
-}
-
-int Jim_Command_drscan(Jim_Interp *interp, int argc, Jim_Obj *const *args)
-{
-	int retval;
-	scan_field_t *fields;
-	int num_fields;
-	int field_count = 0;
-	int i, e;
-	long device;
-
-	/* args[1] = device
-	 * args[2] = num_bits
-	 * args[3] = hex string
-	 * ... repeat num bits and hex string ...
-	 */
-	if ((argc < 4) || ((argc % 2)!=0))
-	{
-		Jim_WrongNumArgs(interp, 1, args, "<device> <num_bits1> <value1> <num_bits2> <value2> ...");
-		return JIM_ERR;
-	}
-
-	for (i = 2; i < argc; i+=2)
-	{
-		long bits;
-
-		e = Jim_GetLong(interp, args[i], &bits);
-		if (e != JIM_OK)
-			return e;
-	}
-
-	e = Jim_GetLong(interp, args[1], &device);
-	if (e != JIM_OK)
-		return e;
-
-	num_fields=(argc-2)/2;
-	fields = malloc(sizeof(scan_field_t) * num_fields);
-	for (i = 2; i < argc; i+=2)
-	{
-		long bits;
-		int len;
-		const char *str;
-
-		Jim_GetLong(interp, args[i], &bits);
-		str = Jim_GetString(args[i+1], &len);
-
-		fields[field_count].device = device;
-		fields[field_count].num_bits = bits;
-		fields[field_count].out_value = malloc(CEIL(bits, 8));
-		str_to_buf(str, len, fields[field_count].out_value, bits, 0);
-		fields[field_count].in_value = fields[field_count].out_value;
-		fields[field_count].in_check_mask = NULL;
-		fields[field_count].in_check_value = NULL;
-		fields[field_count].in_handler = NULL;
-		fields[field_count++].in_handler_priv = NULL;
-	}
-
-	jtag_add_dr_scan(num_fields, fields, TAP_INVALID);
-	retval = jtag_execute_queue();
-	if (retval != ERROR_OK)
-	{
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "drscan: jtag execute failed", NULL);
-		return JIM_ERR;
-	}
-
-	field_count=0;
-	Jim_Obj *list = Jim_NewListObj(interp, NULL, 0);
-	for (i = 2; i < argc; i+=2)
-	{
-		long bits;
-		char *str;
-
-		Jim_GetLong(interp, args[i], &bits);
-		str = buf_to_str(fields[field_count].in_value, bits, 16);
-		free(fields[field_count].out_value);
-
-		Jim_ListAppendElement(interp, list, Jim_NewStringObj(interp, str, strlen(str)));
-		free(str);
-		field_count++;
-	}
-
-	Jim_SetResult(interp, list);
-
-	free(fields);
-
-	return JIM_OK;
-}
-
-static int jim_flash_banks(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
-{
-	flash_bank_t *p;
-
-	if (argc != 1) {
-		Jim_WrongNumArgs(interp, 1, argv, "no arguments to flash_banks command");
-		return JIM_ERR;
-	}
-
-	if (!flash_banks)
-	{
-		return JIM_ERR;
-	}
-
-	Jim_Obj *list=Jim_NewListObj(interp, NULL, 0);
-	for (p = flash_banks; p; p = p->next)
-	{
-		Jim_Obj *elem=Jim_NewListObj(interp, NULL, 0);
-
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "name", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, p->driver->name, -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "base", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->base));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "size", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->size));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "bus_width", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->bus_width));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "chip_width", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->chip_width));
-
-		Jim_ListAppendElement(interp, list, elem);
-	}
-
-	Jim_SetResult(interp, list);
-
-	return JIM_OK;
-}
-
-int tclapi_register_commands()
-{
-	register_jim("ocd_mem2array", jim_mem2array, "read memory and return as a TCL array for script processing");
-	register_jim("ocd_array2mem", jim_array2mem, "convert a TCL array to memory locations and write the values");
-	register_jim("drscan", Jim_Command_drscan, "execute DR scan <device> <num_bits> <value> <num_bits1> <value2> ...");
-	register_jim("ocd_flash_banks", jim_flash_banks, "return information about the flash banks");
-
-}



From oharboe at mail.berlios.de  Fri May  8 00:59:52 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 8 May 2009 00:59:52 +0200
Subject: [Openocd-svn] r1656 - trunk/src/target
Message-ID: <200905072259.n47MxqJR029969@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 00:59:51 +0200 (Fri, 08 May 2009)
New Revision: 1656

Modified:
   trunk/src/target/arm_adi_v5.c
Log:
ouch - typo in last commit

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-07 22:59:20 UTC (rev 1655)
+++ trunk/src/target/arm_adi_v5.c	2009-05-07 22:59:51 UTC (rev 1656)
@@ -130,7 +130,7 @@
 		fields[1].in_value = tmp;
 		jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 
-		*invalue=le_to_h_u32(in_buf);
+		*invalue=le_to_h_u32(tmp);
 	} else
 	{
 



From oharboe at mail.berlios.de  Fri May  8 01:00:48 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 8 May 2009 01:00:48 +0200
Subject: [Openocd-svn] r1657 - trunk/src/target
Message-ID: <200905072300.n47N0mLZ030555@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 01:00:28 +0200 (Fri, 08 May 2009)
New Revision: 1657

Modified:
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm9tdmi.c
Log:
more in_handler typo fixes

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-07 22:59:51 UTC (rev 1656)
+++ trunk/src/target/arm7tdmi.c	2009-05-07 23:00:28 UTC (rev 1657)
@@ -234,9 +234,11 @@
 	return ERROR_OK;
 }
 
-void arm_endianness(u8 *tmp, void *in, int size, int be)
+void arm_endianness(u8 *tmp, void *in, int size, int be, int flip)
 {
-	u32 readback=flip_u32(le_to_h_u32(tmp), 32);
+	u32 readback=le_to_h_u32(tmp);
+	if (flip)
+		readback=flip_u32(readback, 32);
 	switch (size)
 	{
 		case 4:
@@ -295,7 +297,7 @@
 
 	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 
-	arm_endianness(tmp, in, size, be);
+	arm_endianness(tmp, in, size, be, 1);
 
 	jtag_add_runtest(0, TAP_INVALID);
 

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-07 22:59:51 UTC (rev 1656)
+++ trunk/src/target/arm9tdmi.c	2009-05-07 23:00:28 UTC (rev 1657)
@@ -238,7 +238,7 @@
 		fields[0].in_value=tmp;
 		jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
-		*in=flip_u32(le_to_h_u32(tmp), 32);
+		*in=le_to_h_u32(tmp);
 	}
 	else
 	{
@@ -301,7 +301,7 @@
 
 	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
-	*in=flip_u32(le_to_h_u32(tmp), 32);
+	*in=le_to_h_u32(tmp);
 
 	jtag_add_runtest(0, TAP_INVALID);
 
@@ -326,7 +326,7 @@
 	return ERROR_OK;
 }
 
-extern void arm_endianness(u8 *tmp, void *in, int size, int be);
+extern void arm_endianness(u8 *tmp, void *in, int size, int be, int flip);
 
 /* clock the target, and read the databus
  * the *in pointer points to a buffer where elements of 'size' bytes
@@ -366,7 +366,7 @@
 
 	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
-	arm_endianness(tmp, in, size, be);
+	arm_endianness(tmp, in, size, be, 0);
 
 
 	jtag_add_runtest(0, TAP_INVALID);



From zwelch at mail.berlios.de  Fri May  8 06:46:08 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 8 May 2009 06:46:08 +0200
Subject: [Openocd-svn] r1658 - trunk/src/helper
Message-ID: <200905080446.n484k8Hf013543@sheep.berlios.de>

Author: zwelch
Date: 2009-05-08 06:46:00 +0200 (Fri, 08 May 2009)
New Revision: 1658

Modified:
   trunk/src/helper/ioutil.c
Log:
Fix warnings in ioutil.c; improves loadFile inteface.

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-07 23:00:28 UTC (rev 1657)
+++ trunk/src/helper/ioutil.c	2009-05-08 04:46:00 UTC (rev 1658)
@@ -89,7 +89,7 @@
 
 /* loads a file and returns a pointer to it in memory. The file contains
  * a 0 byte(sentinel) after len bytes - the length of the file. */
-int loadFile(const char *fileName, void **data, int *len)
+int loadFile(const char *fileName, void **data, size_t *len)
 {
 	FILE * pFile;
 	pFile = fopen(fileName,"rb");
@@ -104,8 +104,8 @@
 		fclose(pFile);
 		return ERROR_FAIL;
 	}
-	*len=ftell(pFile);
-	if (*len==-1)
+	long fsize = ftell(pFile);
+	if (fsize == -1)
 	{
 		LOG_ERROR("Can't open %s\n", fileName);
 		fclose(pFile);
@@ -118,7 +118,7 @@
 		fclose(pFile);
 		return ERROR_FAIL;
 	}
-	*data=malloc(*len+1);
+	*data = malloc(fsize + 1);
 	if (*data==NULL)
 	{
 		LOG_ERROR("Can't open %s\n", fileName);
@@ -155,7 +155,7 @@
 
 	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
 	void *data;
-	int len;
+	size_t len;
 
 	int retval = loadFile(args[0], &data, &len);
 	if (retval == ERROR_OK)
@@ -256,7 +256,7 @@
 
 	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
 	void *data;
-	int len;
+	size_t len;
 
 	int retval = loadFile(args[0], &data, &len);
 	if (retval != ERROR_OK)
@@ -266,11 +266,11 @@
 	if (f == NULL)
 		retval = ERROR_INVALID_ARGUMENTS;
 
-	int pos = 0;
+	size_t pos = 0;
 	for (;;)
 	{
-		int chunk = len - pos;
-		static const int maxChunk = 512 * 1024; // ~1/sec
+		size_t chunk = len - pos;
+		static const size_t maxChunk = 512 * 1024; // ~1/sec
 		if (chunk > maxChunk)
 		{
 			chunk = maxChunk;
@@ -497,8 +497,9 @@
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	volatile int *address=(volatile int *)strtoul(args[0], NULL, 0);
-	int value=*address;
+	unsigned long addr = strtoul(args[0], NULL, 0);
+	volatile unsigned *address = (volatile unsigned *)addr;
+	unsigned value = *address;
 	command_print(cmd_ctx, "0x%x : 0x%x", address, value);
 	return ERROR_OK;
 }
@@ -509,7 +510,8 @@
 	{
 		return ERROR_INVALID_ARGUMENTS;
 	}
-	volatile int *address=(volatile int *)strtoul(args[0], NULL, 0);
+	unsigned long addr = strtoul(args[0], NULL, 0);
+	volatile int *address = (volatile int *)addr;
 	int value=strtoul(args[1], NULL, 0);
 	*address=value;
 	return ERROR_OK;



From zwelch at mail.berlios.de  Fri May  8 06:49:33 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 8 May 2009 06:49:33 +0200
Subject: [Openocd-svn] r1659 - trunk/src/server
Message-ID: <200905080449.n484nXsV018968@sheep.berlios.de>

Author: zwelch
Date: 2009-05-08 06:49:27 +0200 (Fri, 08 May 2009)
New Revision: 1659

Modified:
   trunk/src/server/httpd.c
Log:
Fix warnings in httpd.c; builds with libmicrohttpd-0.4.1.

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2009-05-08 04:46:00 UTC (rev 1658)
+++ trunk/src/server/httpd.c	2009-05-08 04:49:27 UTC (rev 1659)
@@ -42,6 +42,7 @@
 #include <unistd.h>
 #include <sys/types.h>
 #include <fcntl.h>
+#include <pthread.h>
 #include <signal.h>
 
 #include <sys/types.h>
@@ -54,6 +55,8 @@
 
 #define PAGE_NOT_FOUND "<html><head><title>File not found</title></head><body>File not found</body></html>"
 
+int loadFile(const char *name, void **data, size_t *len);
+
 static const char *appendf(const char *prev, const char *format, ...)
 {
 	va_list ap;
@@ -134,23 +137,19 @@
 
 	data = Jim_GetString(Jim_GetResult(interp), &actual);
 
-	FILE *f;
-	f = fopen(file, "wb");
-	if (f != NULL)
+	FILE *f = fopen(file, "wb");
+	if (NULL == f)
 	{
-		int ok;
-		ok = fwrite(data, 1, actual, f) == actual;
-		fclose(f);
-
-		if (!ok)
-		{
-			Jim_SetResultString(interp, "Could not write to file", -1);
-			return JIM_ERR;
-		}
+		Jim_SetResultString(interp, "Could not create file", -1);
+		return JIM_ERR;
 	}
-	else
+
+	int result = fwrite(data, 1, actual, f);
+	fclose(f);
+
+	if (result != actual)
 	{
-		Jim_SetResultString(interp, "Could not create file", -1);
+		Jim_SetResultString(interp, "Could not write to file", -1);
 		return JIM_ERR;
 	}
 	return JIM_OK;
@@ -243,7 +242,7 @@
 /* append data to each key */
 static int iterate_post(void *con_cls, enum MHD_ValueKind kind,
 		const char *key, const char *filename, const char *content_type,
-		const char *transfer_encoding, const char *data, size_t off,
+		const char *transfer_encoding, const char *data, uint64_t off,
 		size_t size)
 {
 	struct httpd_request *r = (struct httpd_request*) con_cls;
@@ -313,7 +312,7 @@
 	else
 	{
 		void *data;
-		int len;
+		size_t len;
 
 		int retval = loadFile(url, &data, &len);
 		if (retval != ERROR_OK)
@@ -327,7 +326,7 @@
 			return ret;
 		}
 
-		LOG_DEBUG("Serving %s length=%d", url, len);
+		LOG_DEBUG("Serving %s length=%u", url, len);
 		/* serve file directly */
 		response = MHD_create_response_from_data(len, data, MHD_YES, MHD_NO);
 		MHD_add_response_header(response, "Content-Type", "image/png");
@@ -381,7 +380,7 @@
 		if (r->post)
 		{
 			r->postprocessor = MHD_create_post_processor(connection, 2048
-					* 1024, iterate_post, r);
+					* 1024, &iterate_post, r);
 		}
 
 		return MHD_YES;



From zwelch at mail.berlios.de  Fri May  8 06:59:11 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 8 May 2009 06:59:11 +0200
Subject: [Openocd-svn] r1660 - trunk
Message-ID: <200905080459.n484xBFg026069@sheep.berlios.de>

Author: zwelch
Date: 2009-05-08 06:59:05 +0200 (Fri, 08 May 2009)
New Revision: 1660

Modified:
   trunk/configure.in
Log:
Re-order and extend header file tests in configure script.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-08 04:49:27 UTC (rev 1659)
+++ trunk/configure.in	2009-05-08 04:59:05 UTC (rev 1660)
@@ -8,13 +8,16 @@
 AC_SEARCH_LIBS([ioperm], [ioperm])
 AC_SEARCH_LIBS([dlopen], [dl])
 
+AC_CHECK_HEADERS(elf.h)
+AC_CHECK_HEADERS(ifaddrs.h)
 AC_CHECK_HEADERS(jtag_minidriver.h)
+AC_CHECK_HEADERS(malloc.h)
+AC_CHECK_HEADERS(pthread.h)
+AC_CHECK_HEADERS(stdbool.h)
+AC_CHECK_HEADERS(strings.h)
 AC_CHECK_HEADERS(sys/param.h)
 AC_CHECK_HEADERS(sys/time.h)
 AC_CHECK_HEADERS(sys/select.h)
-AC_CHECK_HEADERS(elf.h)
-AC_CHECK_HEADERS(strings.h)
-AC_CHECK_HEADERS(stdbool.h)
 
 AC_HEADER_TIME
 



From zwelch at mail.berlios.de  Fri May  8 07:30:50 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 8 May 2009 07:30:50 +0200
Subject: [Openocd-svn] r1661 - trunk/src/helper
Message-ID: <200905080530.n485Uooe024468@sheep.berlios.de>

Author: zwelch
Date: 2009-05-08 07:30:37 +0200 (Fri, 08 May 2009)
New Revision: 1661

Modified:
   trunk/src/helper/ioutil.c
Log:
Fix loadFile to return file length once again.

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-08 04:59:05 UTC (rev 1660)
+++ trunk/src/helper/ioutil.c	2009-05-08 05:30:37 UTC (rev 1661)
@@ -91,6 +91,9 @@
  * a 0 byte(sentinel) after len bytes - the length of the file. */
 int loadFile(const char *fileName, void **data, size_t *len)
 {
+	// ensure returned length is always sane
+	*len = 0;
+
 	FILE * pFile;
 	pFile = fopen(fileName,"rb");
 	if (pFile==NULL)
@@ -111,6 +114,7 @@
 		fclose(pFile);
 		return ERROR_FAIL;
 	}
+	*len = fsize;
 
 	if (fseek(pFile, 0, SEEK_SET)!=0)
 	{
@@ -118,7 +122,7 @@
 		fclose(pFile);
 		return ERROR_FAIL;
 	}
-	*data = malloc(fsize + 1);
+	*data = malloc(*len + 1);
 	if (*data==NULL)
 	{
 		LOG_ERROR("Can't open %s\n", fileName);
@@ -134,12 +138,12 @@
 		return ERROR_FAIL;
 	}
 	fclose(pFile);
-	*(((char *)(*data))+*len)=0; /* sentinel */
 
+	// 0-byte after buffer (not included in *len) serves as a sentinel
+	char *buf = (char *)*data;
+	buf[*len = 0;
+
 	return ERROR_OK;
-
-
-
 }
 
 



From zwelch at mail.berlios.de  Fri May  8 07:33:17 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 8 May 2009 07:33:17 +0200
Subject: [Openocd-svn] r1662 - trunk/src/helper
Message-ID: <200905080533.n485XHYG026078@sheep.berlios.de>

Author: zwelch
Date: 2009-05-08 07:33:08 +0200 (Fri, 08 May 2009)
New Revision: 1662

Modified:
   trunk/src/helper/ioutil.c
Log:
Fix typo from hurrying the last commit.  Nothing to see here.

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-08 05:30:37 UTC (rev 1661)
+++ trunk/src/helper/ioutil.c	2009-05-08 05:33:08 UTC (rev 1662)
@@ -141,7 +141,7 @@
 
 	// 0-byte after buffer (not included in *len) serves as a sentinel
 	char *buf = (char *)*data;
-	buf[*len = 0;
+	buf[*len] = 0;
 
 	return ERROR_OK;
 }



From oharboe at mail.berlios.de  Fri May  8 08:14:08 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 08:14:08 +0200
Subject: [Openocd-svn] r1663 - trunk/src/target
Message-ID: <200905080614.n486E860026788@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 08:14:08 +0200 (Fri, 08 May 2009)
New Revision: 1663

Modified:
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm_adi_v5.c
Log:
added comments w.r.t. potential performance problems

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-08 05:33:08 UTC (rev 1662)
+++ trunk/src/target/arm7tdmi.c	2009-05-08 06:14:08 UTC (rev 1663)
@@ -372,6 +372,13 @@
 	*pc -= 0xa;
 }
 
+
+/* FIX!!! is this a potential performance bottleneck w.r.t. requiring too many
+ * roundtrips when jtag_execute_queue() has a large overhead(e.g. for USB)s?
+ *
+ * The solution is to arrange for a large out/in scan in this loop and
+ * and convert data afterwards.
+ */
 void arm7tdmi_read_core_regs(target_t *target, u32 mask, u32* core_regs[16])
 {
 	int i;

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-08 05:33:08 UTC (rev 1662)
+++ trunk/src/target/arm_adi_v5.c	2009-05-08 06:14:08 UTC (rev 1663)
@@ -867,6 +867,12 @@
 	return retval;
 }
 
+/* FIX!!! is this a potential performance bottleneck w.r.t. requiring too many
+ * roundtrips when jtag_execute_queue() has a large overhead(e.g. for USB)s?
+ *
+ * The solution is to arrange for a large out/in scan in this loop and
+ * and convert data afterwards.
+ */
 int mem_ap_read_buf_packed_u8(swjdp_common_t *swjdp, u8 *buffer, int count, u32 address)
 {
 	u32 invalue;



From oharboe at mail.berlios.de  Fri May  8 08:45:28 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 08:45:28 +0200
Subject: [Openocd-svn] r1664 - in trunk/src: jtag target
Message-ID: <200905080645.n486jS91031311@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 08:45:27 +0200 (Fri, 08 May 2009)
New Revision: 1664

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/target/embeddedice.c
Log:
first jtag_check_value_mask usage. tested by using "arm7_9 fast_memory_access enable" & "mdw 0 0x10"

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-08 06:14:08 UTC (rev 1663)
+++ trunk/src/jtag/jtag.c	2009-05-08 06:45:27 UTC (rev 1664)
@@ -1417,11 +1417,23 @@
 
 void jtag_check_value_mask(scan_field_t *field, u8 *value, u8 *mask)
 {
+	if (field->in_value==NULL)
+	{
+		LOG_ERROR("remember to fill in in_value for jtag_check_value_mask() to work!");
+		return;
+	}
+
+	if (value==NULL)
+	{
+		/* no checking to do */
+		return;
+	}
+
 	jtag_execute_queue_noclear();
-	
+
 	int retval=jtag_check_value_inner(field->in_value, field, value, mask);
 	jtag_set_error(retval);
-	
+
 }
 
 

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-08 06:14:08 UTC (rev 1663)
+++ trunk/src/target/embeddedice.c	2009-05-08 06:45:27 UTC (rev 1664)
@@ -251,39 +251,26 @@
 	fields[0].tap = ice_reg->jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
-
 	fields[0].in_value = NULL;
-
-
 	fields[0].in_handler = NULL;
 
-
 	fields[1].tap = ice_reg->jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, reg_addr);
-
 	fields[1].in_value = NULL;
-
-
 	fields[1].in_handler = NULL;
 
-
 	fields[2].tap = ice_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-
 	fields[2].in_value = NULL;
-
-
 	fields[2].in_handler = NULL;
 
-
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_value = reg->value;
-	jtag_set_check_value(fields+0, check_value, check_mask, NULL);
 
 	/* when reading the DCC data register, leaving the address field set to
 	 * EICE_COMMS_DATA would read the register twice
@@ -293,6 +280,8 @@
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
+	jtag_check_value_mask(fields+0, check_value, check_mask);
+
 	return ERROR_OK;
 }
 



From oharboe at mail.berlios.de  Fri May  8 09:09:33 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 09:09:33 +0200
Subject: [Openocd-svn] r1665 - trunk/src/target
Message-ID: <200905080709.n4879XgK004512@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 09:09:32 +0200 (Fri, 08 May 2009)
New Revision: 1665

Modified:
   trunk/src/target/etb.c
Log:
retire jtag_set_check_value

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-08 06:45:27 UTC (rev 1664)
+++ trunk/src/target/etb.c	2009-05-08 07:09:32 UTC (rev 1665)
@@ -283,10 +283,10 @@
 	buf_set_u32(fields[1].out_value, 0, 7, 0x0);
 	fields[0].in_value = reg->value;
 
-	jtag_set_check_value(fields+0, check_value, check_mask, NULL);
-
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
+	jtag_check_value_mask(fields+0, check_value, check_mask);
+
 	free(fields[1].out_value);
 	free(fields[2].out_value);
 



From oharboe at mail.berlios.de  Fri May  8 09:14:23 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 09:14:23 +0200
Subject: [Openocd-svn] r1666 - trunk/src/target
Message-ID: <200905080714.n487ENhR005144@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 09:14:23 +0200 (Fri, 08 May 2009)
New Revision: 1666

Modified:
   trunk/src/target/etm.c
Log:
retire jtag_set_check_value

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-08 07:09:32 UTC (rev 1665)
+++ trunk/src/target/etm.c	2009-05-08 07:14:23 UTC (rev 1666)
@@ -339,42 +339,31 @@
 	fields[0].tap = etm_reg->jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
-	
 	fields[0].in_value = NULL;
-	
-	
 	fields[0].in_handler = NULL;
-	
 
 	fields[1].tap = etm_reg->jtag_info->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-	
 	fields[1].in_value = NULL;
-	
-	
 	fields[1].in_handler = NULL;
-	
 
 	fields[2].tap = etm_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-	
 	fields[2].in_value = NULL;
-	
-	
 	fields[2].in_handler = NULL;
-	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_value = reg->value;
-	jtag_set_check_value(fields+0, check_value, check_mask, NULL);
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
+	jtag_check_value_mask(fields+0, check_value, check_mask);
+
 	free(fields[1].out_value);
 	free(fields[2].out_value);
 
@@ -431,35 +420,35 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = malloc(4);
 	buf_set_u32(fields[0].out_value, 0, 32, value);
-	
+
 	fields[0].in_value = NULL;
-	
-	
+
+
 	fields[0].in_handler = NULL;
-	
 
+
 	fields[1].tap = etm_reg->jtag_info->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-	
+
 	fields[1].in_value = NULL;
-	
-	
+
+
 	fields[1].in_handler = NULL;
-	
 
+
 	fields[2].tap = etm_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
-	
+
 	fields[2].in_value = NULL;
-	
-	
+
+
 	fields[2].in_handler = NULL;
-	
 
+
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	free(fields[0].out_value);
@@ -993,7 +982,7 @@
 		{
 			if (((instruction.type == ARM_B) ||
 			     (instruction.type == ARM_BL) ||
-			     (instruction.type == ARM_BLX)) &&	 
+			     (instruction.type == ARM_BLX)) &&
 			    (instruction.info.b_bl_bx_blx.target_address != 0xffffffff))
 			{
 				next_pc = instruction.info.b_bl_bx_blx.target_address;



From oharboe at mail.berlios.de  Fri May  8 09:22:32 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 09:22:32 +0200
Subject: [Openocd-svn] r1667 - trunk/src/target
Message-ID: <200905080722.n487MWlG012062@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 09:22:31 +0200 (Fri, 08 May 2009)
New Revision: 1667

Modified:
   trunk/src/target/xscale.c
Log:
retire jtag_set_check_value

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-08 07:14:23 UTC (rev 1666)
+++ trunk/src/target/xscale.c	2009-05-08 07:22:31 UTC (rev 1667)
@@ -226,11 +226,13 @@
 		field.out_value = calloc(CEIL(field.num_bits, 8), 1);
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
 
-		field.in_value = NULL;
-		jtag_set_check_value(&field, tap->expected, tap->expected_mask, NULL);
+		u8 tmp[4];
+		field.in_value = tmp;
 
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 
+		jtag_check_value_mask(&field, tap->expected, tap->expected_mask);
+
 		free(field.out_value);
 	}
 
@@ -261,29 +263,26 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = &field0;
+	u8 tmp;
+	fields[0].in_value = &tmp;
 
-	fields[0].in_value = NULL;
-	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
-
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
 	fields[1].in_handler = NULL;
 
-
-
-
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
+	u8 tmp2;
+	fields[2].in_value = &tmp2;
 
-	fields[2].in_value = NULL;
-	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
-
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
+	jtag_check_value_mask(fields+0, &field0_check_value, &field0_check_mask);
+	jtag_check_value_mask(fields+2, &field2_check_value, &field2_check_mask);
+
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		LOG_ERROR("JTAG error while reading DCSR");
@@ -339,8 +338,8 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = NULL;
-	fields[0].in_value = NULL;
-	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
+	u8 tmp2;
+	fields[0].in_value = &tmp2;
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
@@ -352,8 +351,8 @@
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
-	fields[2].in_value = NULL;
-	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
+	u8 tmp3;
+	fields[2].in_value = &tmp3;
 
 	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgtx);
@@ -372,6 +371,9 @@
 			jtag_add_pathmove(3, path);
 			jtag_add_dr_scan_now(3, fields, TAP_IDLE);
 
+			jtag_check_value_mask(fields+0, &field0_check_value, &field0_check_mask);
+			jtag_check_value_mask(fields+2, &field2_check_value, &field2_check_mask);
+
 			field1[i]=buf_get_u32(tmp, 0, 32);
 
 			words_scheduled++;
@@ -454,27 +456,20 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = NULL;
-
 	fields[0].in_value = &field0_in;
-	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_TX].value;
 	fields[1].in_handler = NULL;
 
-
-
-
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
+	u8 tmp;
+	fields[2].in_value = &tmp;
 
-	fields[2].in_value = NULL;
-	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
-
 	gettimeofday(&timeout, NULL);
 	timeval_add_time(&timeout, 1, 0);
 
@@ -493,6 +488,9 @@
 
 		jtag_add_dr_scan(3, fields, TAP_IDLE);
 
+		jtag_check_value_mask(fields+0, &field0_check_value, &field0_check_mask);
+		jtag_check_value_mask(fields+2, &field2_check_value, &field2_check_mask);
+
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			LOG_ERROR("JTAG error while reading TX");
@@ -550,27 +548,20 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = &field0_out;
-
 	fields[0].in_value = &field0_in;
-	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_RX].value;
-
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
 
-
-
-
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
+	u8 tmp;
+	fields[2].in_value = &tmp;
 
-	fields[2].in_value = NULL;
-	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
-
 	gettimeofday(&timeout, NULL);
 	timeval_add_time(&timeout, 1, 0);
 
@@ -580,6 +571,9 @@
 	{
 		jtag_add_dr_scan(3, fields, TAP_IDLE);
 
+		jtag_check_value_mask(fields+0, &field0_check_value, &field0_check_mask);
+		jtag_check_value_mask(fields+2, &field2_check_value, &field2_check_mask);
+
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			LOG_ERROR("JTAG error while writing RX");
@@ -725,29 +719,26 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = &field0;
+	u8 tmp;
+	fields[0].in_value = &tmp;
 
-	fields[0].in_value = NULL;
-	jtag_set_check_value(fields+0, &field0_check_value, &field0_check_mask, NULL);
-
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
-
 	fields[1].in_value = NULL;
 	fields[1].in_handler = NULL;
 
-
-
-
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
+	u8 tmp2;
+	fields[2].in_value = &tmp2;
 
-	fields[2].in_value = NULL;
-	jtag_set_check_value(fields+2, &field2_check_value, &field2_check_mask, NULL);
-
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
+	jtag_check_value_mask(fields+0, &field0_check_value, &field0_check_mask);
+	jtag_check_value_mask(fields+2, &field2_check_value, &field2_check_mask);
+
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		LOG_ERROR("JTAG error while writing DCSR");



From oharboe at mail.berlios.de  Fri May  8 09:28:02 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 09:28:02 +0200
Subject: [Openocd-svn] r1668 - trunk/src/xsvf
Message-ID: <200905080728.n487S2Cc014040@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 09:28:00 +0200 (Fri, 08 May 2009)
New Revision: 1668

Modified:
   trunk/src/xsvf/xsvf.c
Log:
retire jtag_set_check_value

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-08 07:22:31 UTC (rev 1667)
+++ trunk/src/xsvf/xsvf.c	2009-05-08 07:28:00 UTC (rev 1668)
@@ -501,16 +501,18 @@
 					field.tap = tap;
 					field.num_bits = xsdrsize;
 					field.out_value = dr_out_buf;
-					
-					field.in_value = NULL;
+					field.in_value = calloc(CEIL(field.num_bits, 8), 1);
 
-					jtag_set_check_value(&field, dr_in_buf, dr_in_mask, NULL);
-
 					if (tap == NULL)
 						jtag_add_plain_dr_scan(1, &field, TAP_DRPAUSE);
 					else
 						jtag_add_dr_scan(1, &field, TAP_DRPAUSE);
 
+					jtag_check_value_mask(&field, dr_in_buf, dr_in_mask);
+
+					free(field.in_value);
+
+
 					/* LOG_DEBUG("FLUSHING QUEUE"); */
 					result = jtag_execute_queue();
 					if (result == ERROR_OK)
@@ -713,10 +715,10 @@
 					field.tap = tap;
 					field.num_bits = bitcount;
 					field.out_value = ir_buf;
-					
+
 					field.in_value = NULL;
-					
-					
+
+
 					field.in_handler = NULL;
 
 					if (tap == NULL)
@@ -944,18 +946,21 @@
 					field.tap = tap;
 					field.num_bits = xsdrsize;
 					field.out_value = dr_out_buf;
-					
-					field.in_value = NULL;
+					field.in_value = calloc(CEIL(field.num_bits, 8), 1);
 
 					if (attempt > 0 && verbose)
 						LOG_USER("LSDR retry %d", attempt);
 
-					jtag_set_check_value(&field, dr_in_buf, dr_in_mask, NULL);
 					if (tap == NULL)
 						jtag_add_plain_dr_scan(1, &field, TAP_DRPAUSE);
 					else
 						jtag_add_dr_scan(1, &field, TAP_DRPAUSE);
 
+					jtag_check_value_mask(&field, dr_in_buf, dr_in_mask);
+
+					free(field.in_value);
+
+
 					/* LOG_DEBUG("FLUSHING QUEUE"); */
 					result = jtag_execute_queue();
 					if(result == ERROR_OK)



From oharboe at mail.berlios.de  Fri May  8 10:46:29 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 10:46:29 +0200
Subject: [Openocd-svn] r1669 - in trunk/src: jtag target
Message-ID: <200905080846.n488kTed007985@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 10:46:28 +0200 (Fri, 08 May 2009)
New Revision: 1669

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/target/arm_jtag.c
   trunk/src/target/arm_jtag.h
Log:
pull up verify_capture_ir one level in api stack

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-08 07:28:00 UTC (rev 1668)
+++ trunk/src/jtag/jtag.c	2009-05-08 08:46:28 UTC (rev 1669)
@@ -521,17 +521,67 @@
 	cmd_queue_cur_state = cmd_queue_end_state;
 }
 
-void jtag_add_ir_scan(int num_fields, scan_field_t *fields, tap_state_t state)
+void jtag_add_ir_scan_noverify(int num_fields, scan_field_t *fields, tap_state_t state)
 {
 	int retval;
-
 	jtag_prelude(state);
 
 	retval=interface_jtag_add_ir_scan(num_fields, fields, cmd_queue_end_state);
 	if (retval!=ERROR_OK)
 		jtag_error=retval;
+
 }
 
+
+void jtag_add_ir_scan(int num_fields, scan_field_t *fields, tap_state_t state)
+{
+	/* 8 x 32 bit id's is enough for all invoations */
+	u32 id[8];
+	int modified[8];
+
+	/* if we are to run a verification of the ir scan, we need to get the input back.
+	 * We may have to allocate space if the caller didn't ask for the input back.
+	 *
+	 */
+	if (jtag_verify_capture_ir)
+	{
+		int j;
+		for (j = 0; j < num_fields; j++)
+		{
+			modified[j]=0;
+			if ((fields[j].in_value==NULL)&&(fields[j].num_bits<=32))
+			{
+				if (j<8)
+				{
+					modified[j]=1;
+					fields[j].in_value=(u8 *)(id+j);
+				} else
+				{
+					LOG_DEBUG("caller must provide in_value space for verify_capture_ir to work");
+				}
+			}
+		}
+	}
+
+	jtag_add_ir_scan_noverify(num_fields, fields, state);
+
+	if (jtag_verify_capture_ir)
+	{
+		int j;
+		for (j = 0; j < num_fields; j++)
+		{
+			jtag_tap_t *tap=fields[j].tap;
+			jtag_check_value_mask(fields+j, tap->expected, tap->expected_mask);
+
+			if (modified[j])
+			{
+				fields[j].in_value=NULL;
+			}
+		}
+	}
+
+}
+
 int MINIDRIVER(interface_jtag_add_ir_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
 {
 	jtag_command_t **last_cmd;
@@ -582,20 +632,6 @@
 				found = 1;
 				(*last_cmd)->cmd.scan->fields[nth_tap].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 
-				if (jtag_verify_capture_ir)
-				{
-					if (fields[j].in_handler==NULL)
-					{
-						jtag_set_check_value((*last_cmd)->cmd.scan->fields+nth_tap, tap->expected, tap->expected_mask, NULL);
-					} else
-					{
-						(*last_cmd)->cmd.scan->fields[nth_tap].in_handler = fields[j].in_handler;
-						(*last_cmd)->cmd.scan->fields[nth_tap].in_handler_priv = fields[j].in_handler_priv;
-						(*last_cmd)->cmd.scan->fields[nth_tap].in_check_value = tap->expected;
-						(*last_cmd)->cmd.scan->fields[nth_tap].in_check_mask = tap->expected_mask;
-					}
-				}
-
 				tap->bypass = 0;
 				break;
 			}

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-08 07:28:00 UTC (rev 1668)
+++ trunk/src/jtag/jtag.h	2009-05-08 08:46:28 UTC (rev 1669)
@@ -559,6 +559,8 @@
  *
  */
 extern void jtag_add_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
+/* same as jtag_add_ir_scan except no verify is performed */
+extern void jtag_add_ir_scan_noverify(int num_fields, scan_field_t *fields, tap_state_t state);
 extern int  interface_jtag_add_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern void jtag_add_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 /* same as jtag_add_dr_scan but the scan is executed immediately. sets jtag_error if there
@@ -731,7 +733,7 @@
 /* JTAG support functions */
 struct invalidstruct
 {
-	
+
 };
 
 extern void           jtag_set_check_value(scan_field_t* field, u8* value, u8* mask, struct invalidstruct *obsolete);

Modified: trunk/src/target/arm_jtag.c
===================================================================
--- trunk/src/target/arm_jtag.c	2009-05-08 07:28:00 UTC (rev 1668)
+++ trunk/src/target/arm_jtag.c	2009-05-08 08:46:28 UTC (rev 1669)
@@ -36,7 +36,7 @@
 #define _ARM_JTAG_SCAN_N_CHECK_
 #endif
 
-int arm_jtag_set_instr(arm_jtag_t *jtag_info, u32 new_instr,  in_handler_t handler)
+int arm_jtag_set_instr(arm_jtag_t *jtag_info, u32 new_instr,  void *no_verify_capture)
 {
 	jtag_tap_t *tap;
 	tap = jtag_info->tap;
@@ -52,13 +52,20 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = t;
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-
 		field.in_value = NULL;
+		field.in_handler = NULL;
 
 
-		field.in_handler = handler; /* deprecated! move into calling code */
-
-		jtag_add_ir_scan(1, &field, TAP_INVALID);
+		if (no_verify_capture==NULL)
+		{
+			jtag_add_ir_scan(1, &field, TAP_INVALID);
+		} else
+		{
+			/* FIX!!!! this is a kludge!!! arm926ejs.c should reimplement this arm_jtag_set_instr to
+			 * have special verification code.
+			 */
+			jtag_add_ir_scan_noverify(1, &field, TAP_INVALID);
+		}
 	}
 
 	return ERROR_OK;

Modified: trunk/src/target/arm_jtag.h
===================================================================
--- trunk/src/target/arm_jtag.h	2009-05-08 07:28:00 UTC (rev 1668)
+++ trunk/src/target/arm_jtag.h	2009-05-08 08:46:28 UTC (rev 1669)
@@ -29,15 +29,15 @@
 typedef struct arm_jtag_s
 {
 	jtag_tap_t *tap;
-	
+
 	u32 scann_size;
 	u32 scann_instr;
 	u32 cur_scan_chain;
-	
+
 	u32 intest_instr;
 } arm_jtag_t;
 
-extern int arm_jtag_set_instr(arm_jtag_t *jtag_info, u32 new_instr, in_handler_t handler);
+extern int arm_jtag_set_instr(arm_jtag_t *jtag_info, u32 new_instr, void *verify_capture);
 extern int arm_jtag_scann(arm_jtag_t *jtag_info, u32 new_scan_chain);
 extern int arm_jtag_setup_connection(arm_jtag_t *jtag_info);
 



From oharboe at mail.berlios.de  Fri May  8 10:49:24 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 10:49:24 +0200
Subject: [Openocd-svn] r1670 - trunk/src/jtag
Message-ID: <200905080849.n488nOfk008414@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 10:49:24 +0200 (Fri, 08 May 2009)
New Revision: 1670

Modified:
   trunk/src/jtag/jtag.c
Log:
use assert instead of adding code that always runs

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-08 08:46:28 UTC (rev 1669)
+++ trunk/src/jtag/jtag.c	2009-05-08 08:49:24 UTC (rev 1670)
@@ -41,6 +41,7 @@
 #ifdef HAVE_STRINGS_H
 #include <strings.h>
 #endif
+#include <assert.h>
 
 
 
@@ -1453,11 +1454,7 @@
 
 void jtag_check_value_mask(scan_field_t *field, u8 *value, u8 *mask)
 {
-	if (field->in_value==NULL)
-	{
-		LOG_ERROR("remember to fill in in_value for jtag_check_value_mask() to work!");
-		return;
-	}
+	assert(field->in_value != NULL);
 
 	if (value==NULL)
 	{



From oharboe at mail.berlios.de  Fri May  8 11:37:26 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 11:37:26 +0200
Subject: [Openocd-svn] r1671 - trunk/src/jtag
Message-ID: <200905080937.n489bQ7T015227@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 11:37:25 +0200 (Fri, 08 May 2009)
New Revision: 1671

Modified:
   trunk/src/jtag/jtag.c
Log:
fix one gaffe in previous commit.

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-08 08:49:24 UTC (rev 1670)
+++ trunk/src/jtag/jtag.c	2009-05-08 09:37:25 UTC (rev 1671)
@@ -1391,7 +1391,7 @@
 
 	int compare_failed = 0;
 
-	if (field->in_check_mask)
+	if (in_check_mask)
 		compare_failed = buf_cmp_mask(captured, in_check_value, in_check_mask, num_bits);
 	else
 		compare_failed = buf_cmp(captured, in_check_value, num_bits);



From oharboe at mail.berlios.de  Fri May  8 11:48:02 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 11:48:02 +0200
Subject: [Openocd-svn] r1672 - in trunk/src: flash jtag pld svf target xsvf
Message-ID: <200905080948.n489m2bl016333@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 11:48:00 +0200 (Fri, 08 May 2009)
New Revision: 1672

Modified:
   trunk/src/flash/str9xpec.c
   trunk/src/jtag/bitq.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/zy1000.c
   trunk/src/pld/virtex2.c
   trunk/src/svf/svf.c
   trunk/src/target/arm11_dbgtap.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/arm_adi_v5.c
   trunk/src/target/arm_jtag.c
   trunk/src/target/avrt.c
   trunk/src/target/embeddedice.c
   trunk/src/target/etb.c
   trunk/src/target/etm.c
   trunk/src/target/feroceon.c
   trunk/src/target/mips_ejtag.c
   trunk/src/target/xscale.c
   trunk/src/xsvf/xsvf.c
Log:
in_handler in_check_mask and in_check_value now removed from field. Last big patch in the series of JTAG API cleanup.

Modified: trunk/src/flash/str9xpec.c
===================================================================
--- trunk/src/flash/str9xpec.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/flash/str9xpec.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -129,8 +129,8 @@
 		field.in_value = NULL;
 		
 		
-		field.in_handler = NULL;
 		
+		
 
 		jtag_add_ir_scan(1, &field, end_state);
 
@@ -155,8 +155,8 @@
 	field.in_value = &status;
 	
 	
-	field.in_handler = NULL;
 	
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
@@ -247,8 +247,8 @@
 	field.in_value = str9xpec_info->options;
 	
 	
-	field.in_handler = NULL;
 	
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
@@ -399,8 +399,8 @@
 	field.in_value = NULL;
 	
 	
-	field.in_handler = NULL;
 	
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_add_sleep(40000);
@@ -413,8 +413,8 @@
 	field.in_value = buffer;
 	
 	
-	field.in_handler = NULL;
 	
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IRPAUSE);
 	jtag_execute_queue();
@@ -515,8 +515,8 @@
 	field.in_value = NULL;
 	
 	
-	field.in_handler = NULL;
 	
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
@@ -581,8 +581,8 @@
 		field.in_value = &status;
 		
 		
-		field.in_handler = NULL;
 		
+		
 
 		jtag_add_dr_scan(1, &field, -1);
 		jtag_execute_queue();
@@ -667,8 +667,8 @@
 	field.in_value = NULL;
 	
 	
-	field.in_handler = NULL;
 	
+	
 
 	jtag_add_dr_scan(1, &field, -1);
 
@@ -756,8 +756,8 @@
 			field.in_value = NULL;
 			
 			
-			field.in_handler = NULL;
 			
+			
 
 			jtag_add_dr_scan(1, &field, TAP_IDLE);
 
@@ -774,8 +774,8 @@
 				field.in_value = scanbuf;
 				
 				
-				field.in_handler = NULL;
 				
+				
 
 				jtag_add_dr_scan(1, &field, -1);
 				jtag_execute_queue();
@@ -816,8 +816,8 @@
 		field.in_value = NULL;
 		
 		
-		field.in_handler = NULL;
 		
+		
 
 		jtag_add_dr_scan(1, &field, TAP_IDLE);
 
@@ -834,8 +834,8 @@
 			field.in_value = scanbuf;
 			
 			
-			field.in_handler = NULL;
 			
+			
 
 			jtag_add_dr_scan(1, &field, -1);
 			jtag_execute_queue();
@@ -898,8 +898,8 @@
 	field.in_value = buffer;
 	
 	
-	field.in_handler = NULL;
 	
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 	jtag_execute_queue();
@@ -1023,8 +1023,8 @@
 	field.in_value = NULL;
 	
 	
-	field.in_handler = NULL;
 	
+	
 
 	jtag_add_dr_scan(1, &field, TAP_IDLE);
 
@@ -1041,8 +1041,8 @@
 		field.in_value = &status;
 		
 		
-		field.in_handler = NULL;
 		
+		
 
 		jtag_add_dr_scan(1, &field, -1);
 		jtag_execute_queue();

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/jtag/bitq.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -66,7 +66,7 @@
 			while (bitq_in_state.field_idx<bitq_in_state.cmd->cmd.scan->num_fields)
 			{
 				field = &bitq_in_state.cmd->cmd.scan->fields[bitq_in_state.field_idx];
-				if (field->in_value || field->in_handler)
+				if (field->in_value)
 				{
 					if (bitq_in_state.bit_pos==0)
 					{
@@ -124,12 +124,6 @@
 							in_mask <<= 1;
 						bitq_in_state.bit_pos++;
 					}
-
-
-					if (field->in_handler && bitq_in_state.status==ERROR_OK)
-					{
-						bitq_in_state.status = (*field->in_handler)(in_buff, field->in_handler_priv, field);
-					}
 				}
 
 				bitq_in_state.field_idx++;  /* advance to next field */
@@ -238,7 +232,7 @@
 	u8* out_ptr;
 	u8  out_mask;
 
-	if (field->in_value || field->in_handler)
+	if (field->in_value)
 		tdo_req = 1;
 	else
 		tdo_req = 0;

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/jtag/jtag.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -623,7 +623,6 @@
 		(*last_cmd)->cmd.scan->fields[nth_tap].tap = tap;
 		(*last_cmd)->cmd.scan->fields[nth_tap].num_bits = scan_size;
 		(*last_cmd)->cmd.scan->fields[nth_tap].in_value = NULL;
-		(*last_cmd)->cmd.scan->fields[nth_tap].in_handler = NULL;	/* disable verification by default */
 
 		/* search the list */
 		for (j = 0; j < num_fields; j++)
@@ -690,10 +689,6 @@
 		(*last_cmd)->cmd.scan->fields[i].num_bits = num_bits;
 		(*last_cmd)->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
 		(*last_cmd)->cmd.scan->fields[i].in_value = fields[i].in_value;
-		(*last_cmd)->cmd.scan->fields[i].in_check_value = fields[i].in_check_value;
-		(*last_cmd)->cmd.scan->fields[i].in_check_mask = fields[i].in_check_mask;
-		(*last_cmd)->cmd.scan->fields[i].in_handler = NULL;
-		(*last_cmd)->cmd.scan->fields[i].in_handler_priv = NULL;
 	}
 	return ERROR_OK;
 }
@@ -772,10 +767,7 @@
 				(*last_cmd)->cmd.scan->fields[field_count].num_bits = scan_size;
 				(*last_cmd)->cmd.scan->fields[field_count].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 				(*last_cmd)->cmd.scan->fields[field_count].in_value = fields[j].in_value;
-				(*last_cmd)->cmd.scan->fields[field_count].in_check_value = fields[j].in_check_value;
-				(*last_cmd)->cmd.scan->fields[field_count].in_check_mask = fields[j].in_check_mask;
-				(*last_cmd)->cmd.scan->fields[field_count].in_handler = fields[j].in_handler;
-				(*last_cmd)->cmd.scan->fields[field_count++].in_handler_priv = fields[j].in_handler_priv;
+				field_count++;
 			}
 		}
 		if (!found)
@@ -792,10 +784,7 @@
 			(*last_cmd)->cmd.scan->fields[field_count].num_bits = 1;
 			(*last_cmd)->cmd.scan->fields[field_count].out_value = NULL;
 			(*last_cmd)->cmd.scan->fields[field_count].in_value = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].in_check_value = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].in_check_mask = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].in_handler = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count++].in_handler_priv = NULL;
+			field_count++;
 		}
 		else
 		{
@@ -881,10 +870,7 @@
 				(*last_cmd)->cmd.scan->fields[field_count].num_bits = scan_size;
 				(*last_cmd)->cmd.scan->fields[field_count].out_value = buf_cpy(out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 				(*last_cmd)->cmd.scan->fields[field_count].in_value = NULL;
-				(*last_cmd)->cmd.scan->fields[field_count].in_check_value = NULL;
-				(*last_cmd)->cmd.scan->fields[field_count].in_check_mask = NULL;
-				(*last_cmd)->cmd.scan->fields[field_count].in_handler = NULL;
-				(*last_cmd)->cmd.scan->fields[field_count++].in_handler_priv = NULL;
+				field_count++;
 			}
 		} else
 		{
@@ -900,10 +886,7 @@
 			(*last_cmd)->cmd.scan->fields[field_count].num_bits = 1;
 			(*last_cmd)->cmd.scan->fields[field_count].out_value = NULL;
 			(*last_cmd)->cmd.scan->fields[field_count].in_value = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].in_check_value = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].in_check_mask = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].in_handler = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count++].in_handler_priv = NULL;
+			field_count++;
 		}
 	}
 }
@@ -945,10 +928,6 @@
 		(*last_cmd)->cmd.scan->fields[i].num_bits = num_bits;
 		(*last_cmd)->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
 		(*last_cmd)->cmd.scan->fields[i].in_value = fields[i].in_value;
-		(*last_cmd)->cmd.scan->fields[i].in_check_value = fields[i].in_check_value;
-		(*last_cmd)->cmd.scan->fields[i].in_check_mask = fields[i].in_check_mask;
-		(*last_cmd)->cmd.scan->fields[i].in_handler = fields[i].in_handler;
-		(*last_cmd)->cmd.scan->fields[i].in_handler_priv = fields[i].in_handler_priv;
 	}
 
 	return ERROR_OK;
@@ -1333,7 +1312,7 @@
 		/* if neither in_value nor in_handler
 		 * are specified we don't have to examine this field
 		 */
-		if (cmd->fields[i].in_value || cmd->fields[i].in_handler)
+		if (cmd->fields[i].in_value)
 		{
 			int num_bits = cmd->fields[i].num_bits;
 			u8 *captured = buf_set_buf(buffer, bit_count, malloc(CEIL(num_bits, 8)), 0, num_bits);
@@ -1347,30 +1326,8 @@
 			if (cmd->fields[i].in_value)
 			{
 				buf_cpy(captured, cmd->fields[i].in_value, num_bits);
-
-				if (cmd->fields[i].in_handler)
-				{
-					if (cmd->fields[i].in_handler(cmd->fields[i].in_value, cmd->fields[i].in_handler_priv, cmd->fields+i) != ERROR_OK)
-					{
-						LOG_WARNING("in_handler: with \"in_value\", mismatch in %s", cmd->ir_scan ? "SIR" : "SDR" );
-						retval = ERROR_JTAG_QUEUE_FAILED;
-					}
-				}
 			}
 
-			/* no in_value specified, but a handler takes care of the scanned data */
-			if (cmd->fields[i].in_handler && (!cmd->fields[i].in_value))
-			{
-				if (cmd->fields[i].in_handler(captured, cmd->fields[i].in_handler_priv, cmd->fields+i) != ERROR_OK)
-				{
-					/* We're going to call the error:handler later, but if the in_handler
-					 * reported an error we report this failure upstream
-					 */
-					LOG_WARNING("in_handler: w/o \"in_value\", mismatch in %s",  cmd->ir_scan ? "SIR" : "SDR" );
-					retval = ERROR_JTAG_QUEUE_FAILED;
-				}
-			}
-
 			free(captured);
 		}
 		bit_count += cmd->fields[i].num_bits;
@@ -1432,26 +1389,6 @@
 	return retval;
 }
 
-int jtag_check_value(u8 *captured, void *priv, scan_field_t *field)
-{
-	return jtag_check_value_inner(captured, field, field->in_check_value, field->in_check_mask);
-}
-
-/*
-  set up checking of this field using the in_handler. The values passed in must be valid until
-  after jtag_execute() has completed.
- */
-void jtag_set_check_value(scan_field_t *field, u8 *value, u8 *mask, struct invalidstruct *obsolete)
-{
-	if (value)
-		field->in_handler = jtag_check_value;
-	else
-		field->in_handler = NULL;	/* No check, e.g. embeddedice uses value==NULL to indicate no check */
-	field->in_handler_priv = NULL;
-	field->in_check_value = value;
-	field->in_check_mask = mask;
-}
-
 void jtag_check_value_mask(scan_field_t *field, u8 *value, u8 *mask)
 {
 	assert(field->in_value != NULL);
@@ -1466,7 +1403,6 @@
 
 	int retval=jtag_check_value_inner(field->in_value, field, value, mask);
 	jtag_set_error(retval);
-
 }
 
 
@@ -1478,7 +1414,7 @@
 
 	for (i = 0; i < cmd->num_fields; i++)
 	{
-		if (cmd->fields[i].in_value || cmd->fields[i].in_handler)
+		if (cmd->fields[i].in_value)
 			type |= SCAN_IN;
 		if (cmd->fields[i].out_value)
 			type |= SCAN_OUT;
@@ -1566,8 +1502,8 @@
 	field.in_value = idcode_buffer;
 
 
-	field.in_handler = NULL;
 
+
 	for (i = 0; i < JTAG_MAX_CHAIN_SIZE; i++)
 	{
 		buf_set_u32(idcode_buffer, i * 32, 32, 0x000000FF);
@@ -1740,8 +1676,8 @@
 	field.num_bits = total_ir_length;
 	field.out_value = ir_test;
 	field.in_value = ir_test;
-	field.in_handler = NULL;
 
+
 	jtag_add_plain_ir_scan(1, &field, TAP_RESET);
 	jtag_execute_queue();
 
@@ -2858,9 +2794,6 @@
 		fields[i].out_value = malloc(CEIL(field_size, 8));
 		buf_set_u32(fields[i].out_value, 0, field_size, strtoul(args[i*2+1], NULL, 0));
 		fields[i].in_value = NULL;
-		fields[i].in_check_mask = NULL;
-		fields[i].in_handler = NULL;
-		fields[i].in_handler_priv = NULL;
 	}
 
 	jtag_add_ir_scan(argc / 2, fields, TAP_INVALID);
@@ -2973,10 +2906,7 @@
 		fields[field_count].out_value = malloc(CEIL(bits, 8));
 		str_to_buf(str, len, fields[field_count].out_value, bits, 0);
 		fields[field_count].in_value = fields[field_count].out_value;
-		fields[field_count].in_check_mask = NULL;
-		fields[field_count].in_check_value = NULL;
-		fields[field_count].in_handler = NULL;
-		fields[field_count++].in_handler_priv = NULL;
+		field_count++;
 	}
 
 	jtag_add_dr_scan(num_fields, fields, TAP_INVALID);

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/jtag/jtag.h	2009-05-08 09:48:00 UTC (rev 1672)
@@ -272,11 +272,6 @@
 	int         num_bits;           /* number of bits this field specifies (up to 32) */
 	u8*         out_value;          /* value to be scanned into the device */
 	u8*         in_value;           /* pointer to a 32-bit memory location to take data scanned out */
-	/* in_check_value/mask, in_handler_error_handler, in_handler_priv can be used by the in handler, otherwise they contain garbage  */
-	u8*          in_check_value;    /* deprecated! only used from jtag_set_check_value. used to validate scan results */
-	u8*          in_check_mask;     /* deprecated! only used from jtag_set_check_value.  check specified bits against check_value */
-	in_handler_t in_handler;        /* deprecated! SET TO NULL. DO NOT USE! process received buffer using this handler */
-	void*        in_handler_priv;   /* deprecated! only used by obsolete in_handler implementations */
 } scan_field_t;
 
 enum scan_type {
@@ -736,7 +731,6 @@
 
 };
 
-extern void           jtag_set_check_value(scan_field_t* field, u8* value, u8* mask, struct invalidstruct *obsolete);
 /* execute jtag queue and check value and use mask if mask is != NULL. invokes
  * jtag_set_error() with any error. */
 extern void jtag_check_value_mask(scan_field_t *field, u8 *value, u8 *mask);

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/jtag/zy1000.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -468,24 +468,6 @@
 		if (fields[i].in_value!=NULL)
 		{
 			inBuffer=fields[i].in_value;
-		} else if (fields[i].in_handler!=NULL)
-		{
-			if (in_buff_size*8<num_bits)
-			{
-				// we need more space
-				if (in_buff!=NULL)
-					free(in_buff);
-				in_buff=NULL;
-				in_buff_size=(num_bits+7)/8;
-				in_buff=malloc(in_buff_size);
-				if (in_buff==NULL)
-				{
-					LOG_ERROR("Out of memory");
-					jtag_error=ERROR_JTAG_QUEUE_FAILED;
-					return;
-				}
-			}
-			inBuffer=in_buff;
 		}
 
 		// here we shuffle N bits out/in
@@ -535,17 +517,6 @@
 			}
 			j+=k;
 		}
-
-		if (fields[i].in_handler!=NULL)
-		{
-			// invoke callback
-			int r=fields[i].in_handler(inBuffer, fields[i].in_handler_priv, fields+i);
-			if (r!=ERROR_OK)
-			{
-				/* this will cause jtag_execute_queue() to return an error */
-				jtag_error=r;
-			}
-		}
 	}
 }
 
@@ -577,15 +548,6 @@
 			{
 				found = 1;
 
-				if ((jtag_verify_capture_ir)&&(fields[j].in_handler==NULL))
-				{
-					jtag_set_check_value(fields+j, tap->expected, tap->expected_mask, NULL);
-				} else if (jtag_verify_capture_ir)
-				{
-					fields[j].in_check_value = tap->expected;
-					fields[j].in_check_mask = tap->expected_mask;
-				}
-
 				scanFields(1, fields+j, TAP_IRSHIFT, pause);
 				/* update device information */
 				buf_cpy(fields[j].out_value, tap->cur_instr, scan_size);
@@ -656,10 +618,6 @@
 			tmp.num_bits = 1;
 			tmp.out_value = NULL;
 			tmp.in_value = NULL;
-			tmp.in_check_value = NULL;
-			tmp.in_check_mask = NULL;
-			tmp.in_handler = NULL;
-			tmp.in_handler_priv = NULL;
 
 			scanFields(1, &tmp, TAP_DRSHIFT, pause);
 		}

Modified: trunk/src/pld/virtex2.c
===================================================================
--- trunk/src/pld/virtex2.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/pld/virtex2.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -60,9 +60,9 @@
 		field.in_value = NULL;
 
 
-		field.in_handler = NULL;
 
 
+
 		jtag_add_ir_scan(1, &field, TAP_IDLE);
 
 		free(field.out_value);
@@ -84,7 +84,6 @@
 	scan_field.num_bits = num_words * 32;
 	scan_field.out_value = values;
 	scan_field.in_value = NULL;
-	scan_field.in_handler = NULL;
 
 	for (i = 0; i < num_words; i++)
 		buf_set_u32(values + 4 * i, 0, 32, flip_u32(*words++, 32));
@@ -109,7 +108,6 @@
 	scan_field.out_value = NULL;
 	u8 tmp[4];
 	scan_field.in_value = tmp;
-	scan_field.in_handler = NULL;
 
 	virtex2_set_instr(virtex2_info->tap, 0x4); /* CFG_OUT */
 
@@ -159,9 +157,9 @@
 	field.in_value = NULL;
 
 
-	field.in_handler = NULL;
 
 
+
 	if ((retval = xilinx_read_bit_file(&bit_file, filename)) != ERROR_OK)
 		return retval;
 

Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/svf/svf.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -985,8 +985,8 @@
 			field.in_value = &svf_tdi_buffer[svf_buffer_index];
 			
 			
-			field.in_handler = NULL;
 			
+			
 			jtag_add_plain_dr_scan(1, &field, svf_para.dr_end_state);
 
 			svf_buffer_index += (i + 7) >> 3;
@@ -1086,8 +1086,8 @@
 			field.in_value = &svf_tdi_buffer[svf_buffer_index];
 			
 			
-			field.in_handler = NULL;
 			
+			
 			jtag_add_plain_ir_scan(1, &field, svf_para.ir_end_state);
 
 			svf_buffer_index += (i + 7) >> 3;

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/arm11_dbgtap.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -87,11 +87,6 @@
 {
 	field->tap   			= arm11->jtag_info.tap;
 	field->num_bits			= num_bits;
-	field->in_check_mask	= NULL;
-	field->in_check_value	= NULL;
-	field->in_handler		= NULL;
-	field->in_handler_priv	= NULL;
-
 	field->out_value		= out_data;
 	field->in_value			= in_data;
 }

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/arm720t.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -113,13 +113,13 @@
 	fields[0].num_bits = 1;
 	fields[0].out_value = &instruction_buf;
 	fields[0].in_value = NULL;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = out_buf;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 	if (in)
 	{
 		u8 tmp[4];

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/arm7tdmi.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -115,13 +115,13 @@
 		fields[0].num_bits = 1;
 		fields[0].out_value = NULL;
 		fields[0].in_value = &breakpoint;
-		fields[0].in_handler = NULL;
+		
 
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 32;
 		fields[1].out_value = NULL;
 		fields[1].in_value = databus;
-		fields[1].in_handler = NULL;
+		
 
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
@@ -194,7 +194,7 @@
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
 	fields[0].in_value = NULL;
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = jtag_info->tap;
@@ -202,7 +202,7 @@
 	fields[1].out_value = NULL;
 	u8 tmp[4];
 	fields[1].in_value = tmp;
-	fields[1].in_handler = NULL;
+	
 
 	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 
@@ -286,14 +286,14 @@
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
 	fields[0].in_value = NULL;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	u8 tmp[4];
 	fields[1].in_value = tmp;
-	fields[1].in_handler = NULL;
+	
 
 	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/arm920t.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -114,25 +114,25 @@
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
 	fields[0].in_value = NULL;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
+	
 
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
 	fields[3].in_value = NULL;
-	fields[3].in_handler = NULL;
+	
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
@@ -175,7 +175,7 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = jtag_info->tap;
@@ -185,7 +185,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	fields[2].tap = jtag_info->tap;
@@ -195,7 +195,7 @@
 	fields[2].in_value = NULL;
 
 
-	fields[2].in_handler = NULL;
+	
 
 
 	fields[3].tap = jtag_info->tap;
@@ -205,7 +205,7 @@
 	fields[3].in_value = NULL;
 
 
-	fields[3].in_handler = NULL;
+	
 
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
@@ -242,7 +242,7 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = jtag_info->tap;
@@ -252,7 +252,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	fields[2].tap = jtag_info->tap;
@@ -262,7 +262,7 @@
 	fields[2].in_value = NULL;
 
 
-	fields[2].in_handler = NULL;
+	
 
 
 	fields[3].tap = jtag_info->tap;
@@ -272,7 +272,7 @@
 	fields[3].in_value = NULL;
 
 
-	fields[3].in_handler = NULL;
+	
 
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/arm926ejs.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -96,6 +96,10 @@
 
 int arm926ejs_catch_broken_irscan(u8 *captured, void *priv, scan_field_t *field)
 {
+	/* FIX!!!! this code should be reenabled. For now it does not check
+	 * the queue...*/
+	return 0;
+#if 0
 	/* The ARM926EJ-S' instruction register is 4 bits wide */
 	u8 t = *captured & 0xf;
 	u8 t2 = *field->in_check_value & 0xf;
@@ -109,6 +113,7 @@
 		return ERROR_OK;
 	}
 	return ERROR_JTAG_QUEUE_FAILED;;
+#endif
 }
 
 #define ARM926EJS_CP15_ADDR(opcode_1, opcode_2, CRn, CRm) ((opcode_1 << 11) | (opcode_2 << 8) | (CRn << 4) | (CRm << 0))
@@ -139,27 +144,27 @@
 	fields[0].out_value = NULL;
 	u8 tmp[4];
 	fields[0].in_value = tmp;
-	fields[0].in_handler = NULL;
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 1;
 	fields[1].out_value = &access;
 	fields[1].in_value = &access;
-	fields[1].in_handler = NULL;
 
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
 
 
+
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
 	fields[3].in_value = NULL;
-	fields[3].in_handler = NULL;
 
+
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 	/*TODO: add timeout*/
@@ -217,9 +222,9 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
 
 
+
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 1;
 	fields[1].out_value = &access;
@@ -227,9 +232,9 @@
 	fields[1].in_value = &access;
 
 
-	fields[1].in_handler = NULL;
 
 
+
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
@@ -237,9 +242,9 @@
 	fields[2].in_value = NULL;
 
 
-	fields[2].in_handler = NULL;
 
 
+
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
@@ -247,9 +252,9 @@
 	fields[3].in_value = NULL;
 
 
-	fields[3].in_handler = NULL;
 
 
+
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 	/*TODO: add timeout*/
 	do

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/arm966e.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -188,19 +188,19 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
 	fields[0].in_value = NULL;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 6;
 	fields[1].out_value = &reg_addr_buf;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &nr_w_buf;
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -250,7 +250,7 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = jtag_info->tap;
@@ -260,7 +260,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	fields[2].tap = jtag_info->tap;
@@ -270,7 +270,7 @@
 	fields[2].in_value = NULL;
 
 
-	fields[2].in_handler = NULL;
+	
 
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/arm9tdmi.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -132,7 +132,7 @@
 		fields[0].in_value = databus;
 
 
-		fields[0].in_handler = NULL;
+		
 
 
 		fields[1].tap = arm7_9->jtag_info.tap;
@@ -142,7 +142,7 @@
 		fields[1].in_value = &debug_reason;
 
 
-		fields[1].in_handler = NULL;
+		
 
 
 		fields[2].tap = arm7_9->jtag_info.tap;
@@ -152,7 +152,7 @@
 		fields[2].in_value = instructionbus;
 
 
-		fields[2].in_handler = NULL;
+		
 
 
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
@@ -217,20 +217,20 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
 	fields[0].in_value = NULL;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
+	
 
 	if (in)
 	{
@@ -285,19 +285,19 @@
 	fields[0].out_value = NULL;
 	u8 tmp[4];
 	fields[0].in_value = tmp;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
+	
 
 	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
@@ -350,19 +350,19 @@
 	fields[0].out_value = NULL;
 	u8 tmp[4];
 	fields[0].in_value = tmp;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
+	
 
 	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/arm_adi_v5.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -81,7 +81,7 @@
 	fields[0].in_value = ack;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = jtag_info->tap;
@@ -89,7 +89,7 @@
 	fields[1].out_value = outvalue;
 
 	fields[1].in_value = invalue;
-	fields[1].in_handler = NULL;
+	
 
 
 
@@ -114,7 +114,7 @@
 	buf_set_u32(&out_addr_buf, 0, 3, ((reg_addr >> 1) & 0x6) | (RnW & 0x1));
 	fields[0].out_value = &out_addr_buf;
 	fields[0].in_value = ack;
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = jtag_info->tap;
@@ -122,7 +122,7 @@
 	buf_set_u32(out_value_buf, 0, 32, outvalue);
 	fields[1].out_value = out_value_buf;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	if (invalue)
 	{

Modified: trunk/src/target/arm_jtag.c
===================================================================
--- trunk/src/target/arm_jtag.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/arm_jtag.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -53,7 +53,7 @@
 		field.out_value = t;
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
 		field.in_value = NULL;
-		field.in_handler = NULL;
+		
 
 
 		if (no_verify_capture==NULL)

Modified: trunk/src/target/avrt.c
===================================================================
--- trunk/src/target/avrt.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/avrt.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -126,10 +126,10 @@
 int avr_target_create(struct target_s *target, Jim_Interp *interp)
 {
 	avr_common_t *avr = calloc(1, sizeof(avr_common_t));
-	
+
 	avr->jtag_info.tap = target->tap;
 	target->arch_info = avr;
-	
+
 	return ERROR_OK;
 }
 
@@ -157,7 +157,7 @@
 	{
 		target->state = TARGET_HALTED;
 	}
-	
+
 	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
@@ -183,7 +183,7 @@
 int avr_assert_reset(target_t *target)
 {
 	target->state = TARGET_RESET;
-	
+
 	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
@@ -191,7 +191,7 @@
 int avr_deassert_reset(target_t *target)
 {
 	target->state = TARGET_RUNNING;
-	
+
 	LOG_DEBUG("%s", __FUNCTION__);
 	return ERROR_OK;
 }
@@ -225,21 +225,17 @@
 		LOG_ERROR("invalid ir_len");
 		return ERROR_FAIL;
 	}
-	
+
 	{
 		scan_field_t field[1];
-		
+
 		field[0].tap = tap;
 		field[0].num_bits = tap->ir_length;
 		field[0].out_value = ir_out;
 		field[0].in_value = ir_in;
-		field[0].in_check_value = NULL;
-		field[0].in_check_mask = NULL;
-		field[0].in_handler = NULL;
-		field[0].in_handler_priv = NULL;
 		jtag_add_plain_ir_scan(sizeof(field) / sizeof(field[0]), field, TAP_IDLE);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -250,21 +246,17 @@
 		LOG_ERROR("invalid tap");
 		return ERROR_FAIL;
 	}
-	
+
 	{
 		scan_field_t field[1];
-		
+
 		field[0].tap = tap;
 		field[0].num_bits = dr_len;
 		field[0].out_value = dr_out;
 		field[0].in_value = dr_in;
-		field[0].in_check_value = NULL;
-		field[0].in_check_mask = NULL;
-		field[0].in_handler = NULL;
-		field[0].in_handler_priv = NULL;
 		jtag_add_plain_dr_scan(sizeof(field) / sizeof(field[0]), field, TAP_IDLE);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -275,9 +267,9 @@
 		LOG_ERROR("ir_len overflow, maxium is 8");
 		return ERROR_FAIL;
 	}
-	
+
 	mcu_write_ir(tap, ir_in, &ir_out, ir_len, rti);
-	
+
 	return ERROR_OK;
 }
 
@@ -288,9 +280,9 @@
 		LOG_ERROR("dr_len overflow, maxium is 8");
 		return ERROR_FAIL;
 	}
-	
+
 	mcu_write_dr(tap, dr_in, &dr_out, dr_len, rti);
-	
+
 	return ERROR_OK;
 }
 
@@ -301,9 +293,9 @@
 		LOG_ERROR("ir_len overflow, maxium is 16");
 		return ERROR_FAIL;
 	}
-	
+
 	mcu_write_ir(tap, (u8*)ir_in, (u8*)&ir_out, ir_len, rti);
-	
+
 	return ERROR_OK;
 }
 
@@ -314,9 +306,9 @@
 		LOG_ERROR("dr_len overflow, maxium is 16");
 		return ERROR_FAIL;
 	}
-	
+
 	mcu_write_dr(tap, (u8*)dr_in, (u8*)&dr_out, dr_len, rti);
-	
+
 	return ERROR_OK;
 }
 
@@ -327,9 +319,9 @@
 		LOG_ERROR("ir_len overflow, maxium is 32");
 		return ERROR_FAIL;
 	}
-	
+
 	mcu_write_ir(tap, (u8*)ir_in, (u8*)&ir_out, ir_len, rti);
-	
+
 	return ERROR_OK;
 }
 
@@ -340,9 +332,9 @@
 		LOG_ERROR("dr_len overflow, maxium is 32");
 		return ERROR_FAIL;
 	}
-	
+
 	mcu_write_dr(tap, (u8*)dr_in, (u8*)&dr_out, dr_len, rti);
-	
+
 	return ERROR_OK;
 }
 

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/embeddedice.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -252,21 +252,21 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
 	fields[0].in_value = NULL;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = ice_reg->jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, reg_addr);
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = ice_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -304,21 +304,21 @@
 	fields[0].out_value = NULL;
 	u8 tmp[4];
 	fields[0].in_value = tmp;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_DATA]);
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -412,7 +412,7 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = jtag_info->tap;
@@ -423,7 +423,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	fields[2].tap = jtag_info->tap;
@@ -434,7 +434,7 @@
 	fields[2].in_value = NULL;
 
 
-	fields[2].in_handler = NULL;
+	
 
 
 	while (size > 0)
@@ -481,7 +481,7 @@
 	fields[0].in_value = field0_in;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = jtag_info->tap;
@@ -492,7 +492,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	fields[2].tap = jtag_info->tap;
@@ -503,7 +503,7 @@
 	fields[2].in_value = NULL;
 
 
-	fields[2].in_handler = NULL;
+	
 
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/etb.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -74,7 +74,7 @@
 		field.in_value = NULL;
 
 
-		field.in_handler = NULL;
+		
 
 
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
@@ -99,7 +99,7 @@
 		field.in_value = NULL;
 
 
-		field.in_handler = NULL;
+		
 
 
 		/* select INTEST instruction */
@@ -188,21 +188,21 @@
 	fields[0].out_value = NULL;
 	u8 tmp[4];
 	fields[0].in_value = tmp;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, 4);
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = etb->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -250,7 +250,7 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = etb_reg->etb->tap;
@@ -261,7 +261,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	fields[2].tap = etb_reg->etb->tap;
@@ -272,7 +272,7 @@
 	fields[2].in_value = NULL;
 
 
-	fields[2].in_handler = NULL;
+	
 
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
@@ -347,7 +347,7 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = etb_reg->etb->tap;
@@ -358,7 +358,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	fields[2].tap = etb_reg->etb->tap;
@@ -369,7 +369,7 @@
 	fields[2].in_value = NULL;
 
 
-	fields[2].in_handler = NULL;
+	
 
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/etm.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -340,21 +340,21 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
 	fields[0].in_value = NULL;
-	fields[0].in_handler = NULL;
+	
 
 	fields[1].tap = etm_reg->jtag_info->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = etm_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
-	fields[2].in_handler = NULL;
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -424,7 +424,7 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = etm_reg->jtag_info->tap;
@@ -435,7 +435,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	fields[2].tap = etm_reg->jtag_info->tap;
@@ -446,7 +446,7 @@
 	fields[2].in_value = NULL;
 
 
-	fields[2].in_handler = NULL;
+	
 
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/feroceon.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -137,10 +137,10 @@
 	fields[0].out_value = out_buf;
 	
 	fields[0].in_value = NULL;
-	fields[0].in_handler = NULL;
 	
 	
 	
+	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
@@ -149,8 +149,8 @@
 	fields[1].in_value = NULL;
 	
 	
-	fields[1].in_handler = NULL;
 	
+	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
@@ -159,8 +159,8 @@
 	fields[2].in_value = NULL;
 	
 	
-	fields[2].in_handler = NULL;
 	
+	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 

Modified: trunk/src/target/mips_ejtag.c
===================================================================
--- trunk/src/target/mips_ejtag.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/mips_ejtag.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -53,8 +53,8 @@
 		field.in_value = NULL;
 		
 		
-		field.in_handler = NULL;
 		
+		
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 	}
 
@@ -76,8 +76,8 @@
 	field.in_value = (void*)idcode;
 	
 	
-	field.in_handler = NULL;
 	
+	
 	jtag_add_dr_scan(1, &field, TAP_INVALID);
 
 	if (jtag_execute_queue() != ERROR_OK)
@@ -103,8 +103,8 @@
 	field.in_value = (void*)impcode;
 	
 	
-	field.in_handler = NULL;
 	
+	
 	jtag_add_dr_scan(1, &field, TAP_INVALID);
 
 	if (jtag_execute_queue() != ERROR_OK)
@@ -134,8 +134,8 @@
 	field.in_value = (u8*)data;
 	
 	
-	field.in_handler = NULL;
 	
+	
 	jtag_add_dr_scan(1, &field, TAP_INVALID);
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/target/xscale.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -270,7 +270,7 @@
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -346,7 +346,7 @@
 	fields[1].out_value = NULL;
 	u8 tmp[4];
 	fields[1].in_value = tmp;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -462,7 +462,7 @@
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_TX].value;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -554,7 +554,7 @@
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_RX].value;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -726,7 +726,7 @@
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
 	fields[1].in_value = NULL;
-	fields[1].in_handler = NULL;
+	
 
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
@@ -796,7 +796,7 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = xscale->jtag_info.tap;
@@ -806,7 +806,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
@@ -858,7 +858,7 @@
 	fields[0].in_value = NULL;
 
 
-	fields[0].in_handler = NULL;
+	
 
 
 	fields[1].tap = xscale->jtag_info.tap;
@@ -868,7 +868,7 @@
 	fields[1].in_value = NULL;
 
 
-	fields[1].in_handler = NULL;
+	
 
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-08 09:37:25 UTC (rev 1671)
+++ trunk/src/xsvf/xsvf.c	2009-05-08 09:48:00 UTC (rev 1672)
@@ -719,7 +719,7 @@
 					field.in_value = NULL;
 
 
-					field.in_handler = NULL;
+					
 
 					if (tap == NULL)
 						jtag_add_plain_ir_scan(1, &field, my_end_state);



From oharboe at mail.berlios.de  Fri May  8 13:18:42 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 13:18:42 +0200
Subject: [Openocd-svn] r1673 - trunk/src/jtag
Message-ID: <200905081118.n48BIg32026582@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 13:18:41 +0200 (Fri, 08 May 2009)
New Revision: 1673

Modified:
   trunk/src/jtag/jtag.c
Log:
fix (old?) bug in jtag_add_ir_scan()

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-08 09:48:00 UTC (rev 1672)
+++ trunk/src/jtag/jtag.c	2009-05-08 11:18:41 UTC (rev 1673)
@@ -540,6 +540,7 @@
 	u32 id[8];
 	int modified[8];
 
+
 	/* if we are to run a verification of the ir scan, we need to get the input back.
 	 * We may have to allocate space if the caller didn't ask for the input back.
 	 *
@@ -622,7 +623,7 @@
 		scan_size = tap->ir_length;
 		(*last_cmd)->cmd.scan->fields[nth_tap].tap = tap;
 		(*last_cmd)->cmd.scan->fields[nth_tap].num_bits = scan_size;
-		(*last_cmd)->cmd.scan->fields[nth_tap].in_value = NULL;
+		(*last_cmd)->cmd.scan->fields[nth_tap].in_value = fields[nth_tap].in_value;
 
 		/* search the list */
 		for (j = 0; j < num_fields; j++)



From oharboe at mail.berlios.de  Fri May  8 13:46:01 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 13:46:01 +0200
Subject: [Openocd-svn] r1674 - trunk/src/jtag
Message-ID: <200905081146.n48Bk1H2003953@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 13:46:01 +0200 (Fri, 08 May 2009)
New Revision: 1674

Modified:
   trunk/src/jtag/jtag.c
Log:
add flush_count jtag queue profiling feature

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-08 11:18:41 UTC (rev 1673)
+++ trunk/src/jtag/jtag.c	2009-05-08 11:46:01 UTC (rev 1674)
@@ -43,8 +43,8 @@
 #endif
 #include <assert.h>
 
+int jtag_flush_queue_count; /* count # of flushes for profiling / debugging purposes */
 
-
 /* note that this is not marked as static as it must be available from outside jtag.c for those
    that implement the jtag_xxx() minidriver layer
 */
@@ -243,6 +243,7 @@
 static int handle_runtest_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int handle_irscan_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int Jim_Command_drscan(Jim_Interp *interp, int argc, Jim_Obj *const *argv);
+static int Jim_Command_flush_count(Jim_Interp *interp, int argc, Jim_Obj *const *args);
 
 static int handle_verify_ircapture_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
@@ -1446,6 +1447,11 @@
 
 void jtag_execute_queue_noclear(void)
 {
+	/* each flush can take as much as 1-2ms on high bandwidth low latency interfaces.
+	 * E.g. a JTAG over TCP/IP or USB....
+	 */
+	jtag_flush_queue_count++; 
+
 	int retval=interface_jtag_execute_queue();
 	/* we keep the first error */
 	if ((jtag_error==ERROR_OK)&&(retval!=ERROR_OK))
@@ -2180,6 +2186,7 @@
 	register_command(cmd_ctx, NULL, "irscan", handle_irscan_command,
 		COMMAND_EXEC, "execute IR scan <device> <instr> [dev2] [instr2] ...");
 	register_jim(cmd_ctx, "drscan", Jim_Command_drscan, "execute DR scan <device> <num_bits> <value> <num_bits1> <value2> ...");
+	register_jim(cmd_ctx, "flush_count", Jim_Command_flush_count, "returns number of times the JTAG queue has been flushed");
 
 	register_command(cmd_ctx, NULL, "verify_ircapture", handle_verify_ircapture_command,
 		COMMAND_ANY, "verify value captured during Capture-IR <enable|disable>");
@@ -2945,6 +2952,15 @@
 	return JIM_OK;
 }
 
+
+static int Jim_Command_flush_count(Jim_Interp *interp, int argc, Jim_Obj *const *args)
+{
+	Jim_SetResult(interp, Jim_NewIntObj(interp, jtag_flush_queue_count));
+
+	return JIM_OK;
+}
+
+
 static int handle_verify_ircapture_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	if (argc == 1)



From oharboe at mail.berlios.de  Fri May  8 14:26:51 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 14:26:51 +0200
Subject: [Openocd-svn] r1675 - trunk/testing
Message-ID: <200905081226.n48CQp5B009046@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 14:26:50 +0200 (Fri, 08 May 2009)
New Revision: 1675

Added:
   trunk/testing/profile.txt
Log:
profiling numbers

Added: trunk/testing/profile.txt
===================================================================
--- trunk/testing/profile.txt	2009-05-08 11:46:01 UTC (rev 1674)
+++ trunk/testing/profile.txt	2009-05-08 12:26:50 UTC (rev 1675)
@@ -0,0 +1,14 @@
+old version rev 1606:
+
+single step:   59 ms
+flash 64k :  24kB/s
+mdb 0 128 :  44ms
+
+
+trunk rev 1662:
+
+single step:   99 ms
+flash 64k :  21.5kB/s
+mdb 0 128 :  72ms
+
+



From oharboe at mail.berlios.de  Fri May  8 15:30:45 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 15:30:45 +0200
Subject: [Openocd-svn] r1676 - trunk/testing
Message-ID: <200905081330.n48DUjW2017609@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 15:30:45 +0200 (Fri, 08 May 2009)
New Revision: 1676

Added:
   trunk/testing/profile_stm32.txt
Removed:
   trunk/testing/profile.txt
Log:
stm32 profiling wip

Deleted: trunk/testing/profile.txt
===================================================================
--- trunk/testing/profile.txt	2009-05-08 12:26:50 UTC (rev 1675)
+++ trunk/testing/profile.txt	2009-05-08 13:30:45 UTC (rev 1676)
@@ -1,14 +0,0 @@
-old version rev 1606:
-
-single step:   59 ms
-flash 64k :  24kB/s
-mdb 0 128 :  44ms
-
-
-trunk rev 1662:
-
-single step:   99 ms
-flash 64k :  21.5kB/s
-mdb 0 128 :  72ms
-
-

Copied: trunk/testing/profile_stm32.txt (from rev 1675, trunk/testing/profile.txt)
===================================================================
--- trunk/testing/profile.txt	2009-05-08 12:26:50 UTC (rev 1675)
+++ trunk/testing/profile_stm32.txt	2009-05-08 13:30:45 UTC (rev 1676)
@@ -0,0 +1,52 @@
+These are profile tests for the stm32 target.
+
+old version rev 1606:
+
+single step:   59 ms
+flash 64k :  24kB/s
+mdb 0 128 :  44ms
+
+
+trunk rev 1662:
+
+single step:   99 ms
+flash 64k :  21.5kB/s
+mdb 0 128 :  72ms
+
+
+How to run tests:
+
+poll off
+set before [flush_count]
+step
+set step_count [expr [flush_count]-$before]
+
+set before [flush_count]
+mdb 0 128
+set mem_count [expr [flush_count]-$before]
+
+set before [flush_count]
+flash erase_address 0x8000000 0x10000
+set erase_count [expr [flush_count]-$before]
+
+set before [flush_count]
+flash fillb 0x8000000 0x55 0x10000
+set flash_fill_count [expr [flush_count]-$before]
+
+puts "counts" ; puts "step       $step_count" ; puts "mem        $mem_count" ; puts "erase      $erase_count" ; puts "flash fill $flash_fill_count" 
+
+parport trunk rev 1675
+======================
+
+step       336
+mem        160
+erase      3076
+flash fill 32754
+
+verify_ircapture disable
+
+step       114
+mem        96
+erase      1547
+flash fill 15564
+


Property changes on: trunk/testing/profile_stm32.txt
___________________________________________________________________
Name: svn:mergeinfo
   + 



From oharboe at mail.berlios.de  Fri May  8 20:12:44 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 20:12:44 +0200
Subject: [Openocd-svn] r1677 - trunk/src/jtag
Message-ID: <200905081812.n48ICiPk027122@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 20:12:43 +0200 (Fri, 08 May 2009)
New Revision: 1677

Modified:
   trunk/src/jtag/jtag.c
Log:
fix gaffe in 1672

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-08 13:30:45 UTC (rev 1676)
+++ trunk/src/jtag/jtag.c	2009-05-08 18:12:43 UTC (rev 1677)
@@ -45,6 +45,7 @@
 
 int jtag_flush_queue_count; /* count # of flushes for profiling / debugging purposes */
 
+
 /* note that this is not marked as static as it must be available from outside jtag.c for those
    that implement the jtag_xxx() minidriver layer
 */
@@ -541,7 +542,6 @@
 	u32 id[8];
 	int modified[8];
 
-
 	/* if we are to run a verification of the ir scan, we need to get the input back.
 	 * We may have to allocate space if the caller didn't ask for the input back.
 	 *
@@ -621,10 +621,13 @@
 			break;
 		}
 		nth_tap++;
+
+		assert(nth_tap < x );
+
 		scan_size = tap->ir_length;
 		(*last_cmd)->cmd.scan->fields[nth_tap].tap = tap;
 		(*last_cmd)->cmd.scan->fields[nth_tap].num_bits = scan_size;
-		(*last_cmd)->cmd.scan->fields[nth_tap].in_value = fields[nth_tap].in_value;
+		(*last_cmd)->cmd.scan->fields[nth_tap].in_value = NULL; /* do not collect input for tap's in bypass */
 
 		/* search the list */
 		for (j = 0; j < num_fields; j++)
@@ -632,6 +635,7 @@
 			if (tap == fields[j].tap)
 			{
 				found = 1;
+				(*last_cmd)->cmd.scan->fields[nth_tap].in_value = fields[j].in_value;
 				(*last_cmd)->cmd.scan->fields[nth_tap].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 
 				tap->bypass = 0;
@@ -649,6 +653,7 @@
 		/* update device information */
 		buf_cpy((*last_cmd)->cmd.scan->fields[nth_tap].out_value, tap->cur_instr, scan_size);
 	}
+	assert(nth_tap == (x-1));
 
 	return ERROR_OK;
 }
@@ -1450,7 +1455,7 @@
 	/* each flush can take as much as 1-2ms on high bandwidth low latency interfaces.
 	 * E.g. a JTAG over TCP/IP or USB....
 	 */
-	jtag_flush_queue_count++; 
+	jtag_flush_queue_count++;
 
 	int retval=interface_jtag_execute_queue();
 	/* we keep the first error */



From oharboe at mail.berlios.de  Fri May  8 20:55:00 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 20:55:00 +0200
Subject: [Openocd-svn] r1678 - trunk/src/flash
Message-ID: <200905081855.n48It0d9030001@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 20:54:59 +0200 (Fri, 08 May 2009)
New Revision: 1678

Modified:
   trunk/src/flash/cfi.c
Log:
Michael Fischer <fischermi at t-online.de> fix compile problems on Mac

Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-05-08 18:12:43 UTC (rev 1677)
+++ trunk/src/flash/cfi.c	2009-05-08 18:54:59 UTC (rev 1678)
@@ -121,7 +121,7 @@
 }
 
 /* inline u32 flash_address(flash_bank_t *bank, int sector, u32 offset) */
-__inline__ u32 flash_address(flash_bank_t *bank, int sector, u32 offset)
+static __inline__ u32 flash_address(flash_bank_t *bank, int sector, u32 offset)
 {
 	/* while the sector list isn't built, only accesses to sector 0 work */
 	if (sector == 0)



From oharboe at mail.berlios.de  Fri May  8 21:24:41 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 21:24:41 +0200
Subject: [Openocd-svn] r1679 - trunk/src/jtag
Message-ID: <200905081924.n48JOfE2032363@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 21:24:40 +0200 (Fri, 08 May 2009)
New Revision: 1679

Modified:
   trunk/src/jtag/zy1000.c
Log:
sync up zy1000 interface to bitbang driver's handling of exiting the shift state

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2009-05-08 18:54:59 UTC (rev 1678)
+++ trunk/src/jtag/zy1000.c	2009-05-08 19:24:40 UTC (rev 1679)
@@ -448,7 +448,7 @@
 	setCurrentState(cmd_queue_end_state);
 }
 
-static __inline void scanFields(int num_fields, scan_field_t *fields, tap_state_t shiftState, int pause)
+static __inline void scanFields(int num_fields, scan_field_t *fields, tap_state_t shiftState, tap_state_t end_state)
 {
 	int i;
 	int j;
@@ -482,10 +482,10 @@
 			{
 				k=32;
 				/* we have more to shift out */
-			} else if (pause&&(i == num_fields-1))
+			} else if (i == num_fields-1)
 			{
 				/* this was the last to shift out this time */
-				pause_state=(shiftState==TAP_DRSHIFT)?TAP_DRPAUSE:TAP_IRPAUSE;
+				pause_state=end_state;
 			}
 
 			// we have (num_bits+7)/8 bytes of bits to toggle out.
@@ -535,7 +535,14 @@
 	for(tap = jtag_NextEnabledTap(NULL); tap!= NULL; tap=nextTap)
 	{
 		nextTap=jtag_NextEnabledTap(tap);
-		int pause=(nextTap==NULL);
+		tap_state_t end_state;
+		if (nextTap==NULL)
+		{
+			end_state = cmd_queue_end_state;
+		} else
+		{
+			end_state = TAP_IRSHIFT;
+		}
 
 		int found = 0;
 
@@ -548,7 +555,7 @@
 			{
 				found = 1;
 
-				scanFields(1, fields+j, TAP_IRSHIFT, pause);
+				scanFields(1, fields+j, TAP_IRSHIFT, end_state);
 				/* update device information */
 				buf_cpy(fields[j].out_value, tap->cur_instr, scan_size);
 
@@ -566,13 +573,12 @@
 			memset(&tmp, 0, sizeof(tmp));
 			tmp.out_value = ones;
 			tmp.num_bits = scan_size;
-			scanFields(1, &tmp, TAP_IRSHIFT, pause);
+			scanFields(1, &tmp, TAP_IRSHIFT, end_state);
 			/* update device information */
 			buf_cpy(tmp.out_value, tap->cur_instr, scan_size);
 			tap->bypass = 1;
 		}
 	}
-	gotoEndState();
 
 	return ERROR_OK;
 }
@@ -583,8 +589,7 @@
 
 int interface_jtag_add_plain_ir_scan(int num_fields, scan_field_t *fields, tap_state_t state)
 {
-	scanFields(num_fields, fields, TAP_IRSHIFT, 1);
-	gotoEndState();
+	scanFields(num_fields, fields, TAP_IRSHIFT, cmd_queue_end_state);
 
 	return ERROR_OK;
 }
@@ -600,7 +605,14 @@
 	{
 		nextTap=jtag_NextEnabledTap(tap);
 		int found=0;
-		int pause=(nextTap==NULL);
+		tap_state_t end_state;
+		if (nextTap==NULL)
+		{
+			end_state = cmd_queue_end_state;
+		} else
+		{
+			end_state = TAP_DRSHIFT;
+		}
 
 		for (j=0; j < num_fields; j++)
 		{
@@ -608,7 +620,7 @@
 			{
 				found = 1;
 
-				scanFields(1, fields+j, TAP_DRSHIFT, pause);
+				scanFields(1, fields+j, TAP_DRSHIFT, end_state);
 			}
 		}
 		if (!found)
@@ -619,20 +631,18 @@
 			tmp.out_value = NULL;
 			tmp.in_value = NULL;
 
-			scanFields(1, &tmp, TAP_DRSHIFT, pause);
+			scanFields(1, &tmp, TAP_DRSHIFT, end_state);
 		}
 		else
 		{
 		}
 	}
-	gotoEndState();
 	return ERROR_OK;
 }
 
 int interface_jtag_add_plain_dr_scan(int num_fields, scan_field_t *fields, tap_state_t state)
 {
-	scanFields(num_fields, fields, TAP_DRSHIFT, 1);
-	gotoEndState();
+	scanFields(num_fields, fields, TAP_DRSHIFT, cmd_queue_end_state);
 	return ERROR_OK;
 }
 



From oharboe at mail.berlios.de  Fri May  8 22:27:19 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 22:27:19 +0200
Subject: [Openocd-svn] r1680 - trunk/src/target/target
Message-ID: <200905082027.n48KRJFp005344@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 22:27:19 +0200 (Fri, 08 May 2009)
New Revision: 1680

Added:
   trunk/src/target/target/ti_dm6446.cfg
Log:
David Brownell <david-b at pacbell.net> DaVinci dm6446

Added: trunk/src/target/target/ti_dm6446.cfg
===================================================================
--- trunk/src/target/target/ti_dm6446.cfg	2009-05-08 19:24:40 UTC (rev 1679)
+++ trunk/src/target/target/ti_dm6446.cfg	2009-05-08 20:27:19 UTC (rev 1680)
@@ -0,0 +1,66 @@
+#
+# Texas Instruments DaVinci family:  TMS320DM6446
+#
+if { [info exists CHIPNAME] } {
+   set  _CHIPNAME $CHIPNAME
+} else {
+   set  _CHIPNAME dm6446
+}
+if { [info exists ENDIAN] } {
+   set  _ENDIAN $ENDIAN
+} else {
+   set  _ENDIAN little
+}
+
+#
+# For now, expect EMU0/EMU1 jumpered LOW (not TI's default) so ARM and ETB
+# are enabled without making ICEpick route ARM and ETB into the JTAG chain.
+#
+# Also note:  when running without RTCK before the PLLs are set up, you
+# may need to slow the JTAG clock down quite a lot (under 2 MHz).
+#
+
+# Subsidiary TAP: ARM ETB11, with scan chain for 4K of ETM trace buffer
+if { [info exists ETB_TAPID ] } {
+   set _ETB_TAPID $ETB_TAPID
+} else {
+   set _ETB_TAPID 0x2b900f0f
+}
+jtag newtap $_CHIPNAME etb -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_ETB_TAPID
+
+# Subsidiary TAP: ARM926ejs with scan chains for ARM Debug, EmbeddedICE-RT, ETM.
+if { [info exists CPU_TAPID ] } {
+   set _CPU_TAPID $CPU_TAPID
+} else {
+   set _CPU_TAPID 0x07926001
+}
+jtag newtap $_CHIPNAME arm -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPU_TAPID
+
+# Subsidiary TAP: C64x+ DSP ... NOT CURRENTLY INCLUDED, must add via ICEpick.
+# Documentation for DSP JTAG interfaces evidently needs NDAs.
+
+# Primary TAP: ICEpick (JTAG route controller) and boundary scan
+if { [info exists JRC_TAPID ] } {
+   set _JRC_TAPID $JRC_TAPID
+} else {
+   set _JRC_TAPID 0x0b70002f
+}
+jtag newtap $_CHIPNAME jrc -irlen 6 -ircapture 0x1 -irmask 0x3f -expected-id $_JRC_TAPID
+
+# GDB target:  the ARM, using SRAM1 for scratch.  SRAM0 (also 8K)
+# and the ETB memory (4K) are other options, while trace is unused.
+set _TARGETNAME $_CHIPNAME.arm
+
+target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x0000a000 -work-area-size 0x2000 -work-area-backup 0
+
+arm7_9 dbgrq enable
+arm7_9 fast_memory_access enable
+arm7_9 dcc_downloads enable
+
+# trace setup
+# FIXME we ought to be able to say "... config $_TARGETNAME ..."
+# (not "config 0") facilitating additional targets (e.g. other chips)
+etm config 0 16 normal full etb
+etb config 0 $_CHIPNAME.etb
+


Property changes on: trunk/src/target/target/ti_dm6446.cfg
___________________________________________________________________
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Fri May  8 22:36:10 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 22:36:10 +0200
Subject: [Openocd-svn] r1681 -
	zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf
Message-ID: <200905082036.n48KaAfM005870@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 22:36:09 +0200 (Fri, 08 May 2009)
New Revision: 1681

Modified:
   zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi
Log:
tinkered with linker script

Modified: zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi
===================================================================
--- zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi	2009-05-08 20:27:19 UTC (rev 1680)
+++ zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi	2009-05-08 20:36:09 UTC (rev 1681)
@@ -35,14 +35,31 @@
  *phi_misc* (*hal_delay_us*)    ;  
  * (*tftp_client_get*)    ;  
  *phi_misc* (*busy*)    ;  
+* (*Cyg_Mempool_dlmalloc_Implementation*free*) ;
+ * (*phi_misc*)    ;  
+ * (*cyg_sbdrop*)    ;  
+ * (*target_call_event_callbacks*)    ;  
+ 
+ 
 
 * (*tftp_client_get*) ;
+* (*cyg_callout_stop*) ;
+* (*embeddeqdice_set_reg*) ;
+* (*arm7_9_set_breakpoint*) ;
+* (*arm7_9_init_arch_info*) ;
+* (*arm7_9_add_breakpoint*) ;
+
+
+* (*cyg_m_adj*) ;
 * (*select*) ;
+* (*cyg_arpresolve*) ;
 * (*cyg_sorceive*) ;
 * (*cmd_queue_cur_state*) ;
 * (*cmd_queue_end_state*) ;
 * (*jtag_err*) ;
 * (*jtag_num_devices*) ;
+* (*jtag_execute_queue*) ;
+* (*jtag_flush_queue_count*) ;
 
 
 
@@ -92,7 +109,10 @@
 * (*armv4_5_mode_to_number*);
 * (*arm7_9_debug_entry*);
 * (*arm7_9_restore_context*);
+* (*armv4_5_run_algorithm_inner*);
+* (*cyg_uiomove*);
 
+
 //;* (*armv4_5_*);
 //;* (*armv4_5_*);
 //;* (*arm7_9*);
@@ -116,6 +136,9 @@
 * (*cyg_sosend*);
 * (*cyg_splimp*);
 * (*cyg_ether_output*);
+* (*cyg_ether_input*);
+* (*cyg_in_pcblookup_hash*);
+* (*cyg_netint*);
 * (*ipintr*);
 * (*cyg_tcp_output*);
 * (*eth_drv_send*);
@@ -126,6 +149,7 @@
 * (*cyg_wakeup*);
 * (*openeth_can_send*);
 * (*eth_drv_recv*);
+* (*eth_drv_dsr*);
 * (*cyg_splnet*);
 * (*cyg_in_cksum_hdr*);
 * (*cyg_sbcompress*);



From oharboe at mail.berlios.de  Fri May  8 22:44:52 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 22:44:52 +0200
Subject: [Openocd-svn] r1682 - trunk/src/target
Message-ID: <200905082044.n48Kiq22006632@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 22:44:52 +0200 (Fri, 08 May 2009)
New Revision: 1682

Modified:
   trunk/src/target/etb.c
   trunk/src/target/etm.h
Log:
whitespace fixes

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-08 20:36:09 UTC (rev 1681)
+++ trunk/src/target/etb.c	2009-05-08 20:44:52 UTC (rev 1682)
@@ -58,6 +58,7 @@
 static int etb_set_instr(etb_t *etb, u32 new_instr)
 {
 	jtag_tap_t *tap;
+
 	tap = etb->tap;
 	if (tap==NULL)
 		return ERROR_FAIL;
@@ -73,10 +74,6 @@
 
 		field.in_value = NULL;
 
-
-		
-
-
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 
 		free(field.out_value);
@@ -87,7 +84,7 @@
 
 static int etb_scann(etb_t *etb, u32 new_scan_chain)
 {
-	if(etb->cur_scan_chain != new_scan_chain)
+	if (etb->cur_scan_chain != new_scan_chain)
 	{
 		scan_field_t field;
 
@@ -98,10 +95,6 @@
 
 		field.in_value = NULL;
 
-
-		
-
-
 		/* select INTEST instruction */
 		etb_set_instr(etb, 0x2);
 		jtag_add_dr_scan(1, &field, TAP_INVALID);
@@ -159,6 +152,7 @@
 static int etb_get_reg(reg_t *reg)
 {
 	int retval;
+
 	if ((retval = etb_read_reg(reg)) != ERROR_OK)
 	{
 		LOG_ERROR("BUG: error scheduling etm register read");
@@ -188,25 +182,21 @@
 	fields[0].out_value = NULL;
 	u8 tmp[4];
 	fields[0].in_value = tmp;
-	
 
 	fields[1].tap = etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, 4);
 	fields[1].in_value = NULL;
-	
 
 	fields[2].tap = etb->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
-	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-
 	for (i = 0; i < num_frames; i++)
 	{
 		/* ensure nR/W reamins set to read */
@@ -246,35 +236,20 @@
 	fields[0].tap = etb_reg->etb->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
-
 	fields[0].in_value = NULL;
 
-
-	
-
-
 	fields[1].tap = etb_reg->etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-
 	fields[1].in_value = NULL;
 
-
-	
-
-
 	fields[2].tap = etb_reg->etb->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-
 	fields[2].in_value = NULL;
 
-
-	
-
-
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	/* read the identification register in the second run, to make sure we
@@ -301,6 +276,7 @@
 int etb_set_reg(reg_t *reg, u32 value)
 {
 	int retval;
+
 	if ((retval = etb_write_reg(reg, value)) != ERROR_OK)
 	{
 		LOG_ERROR("BUG: error scheduling etm register write");
@@ -317,6 +293,7 @@
 int etb_set_reg_w_exec(reg_t *reg, u8 *buf)
 {
 	int retval;
+
 	etb_set_reg(reg, buf_get_u32(buf, 0, reg->size));
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
@@ -343,24 +320,14 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = malloc(4);
 	buf_set_u32(fields[0].out_value, 0, 32, value);
-
 	fields[0].in_value = NULL;
 
-
-	
-
-
 	fields[1].tap = etb_reg->etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-
 	fields[1].in_value = NULL;
 
-
-	
-
-
 	fields[2].tap = etb_reg->etb->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
@@ -368,12 +335,6 @@
 
 	fields[2].in_value = NULL;
 
-
-	
-
-
-	jtag_add_dr_scan(3, fields, TAP_INVALID);
-
 	free(fields[0].out_value);
 	free(fields[1].out_value);
 	free(fields[2].out_value);
@@ -424,12 +385,12 @@
 	}
 
 	tap = jtag_TapByString( args[1] );
-	if( tap == NULL ){
+	if (tap == NULL)
+	{
 		command_print(cmd_ctx, "Tap: %s does not exist", args[1] );
 		return ERROR_FAIL;
 	}
 
-
 	if (arm7_9->etm_ctx)
 	{
 		etb_t *etb = malloc(sizeof(etb_t));

Modified: trunk/src/target/etm.h
===================================================================
--- trunk/src/target/etm.h	2009-05-08 20:36:09 UTC (rev 1681)
+++ trunk/src/target/etm.h	2009-05-08 20:44:52 UTC (rev 1682)
@@ -62,7 +62,7 @@
 	ETM_SEQUENCER_STATE = 0x67,
 	ETM_EXTERNAL_OUTPUT = 0x68,
 	ETM_CONTEXTID_COMPARATOR_VALUE = 0x6c,
-	ETM_CONTEXTID_COMPARATOR_MASK = 0x6f,	
+	ETM_CONTEXTID_COMPARATOR_MASK = 0x6f,
 };
 
 typedef struct etm_reg_s
@@ -77,7 +77,7 @@
 	ETM_PORT_4BIT		= 0x00,
 	ETM_PORT_8BIT		= 0x10,
 	ETM_PORT_16BIT		= 0x20,
-	ETM_PORT_WIDTH_MASK	= 0x70, 
+	ETM_PORT_WIDTH_MASK	= 0x70,
 	/* Port modes */
 	ETM_PORT_NORMAL    = 0x00000,
 	ETM_PORT_MUXED     = 0x10000,
@@ -146,11 +146,11 @@
 	etm_capture_driver_t *capture_driver;	/* driver used to access ETM data */
 	void *capture_driver_priv;		/* capture driver private data */
 	u32 trigger_percent;			/* percent of trace buffer to be filled after the trigger */
-	trace_status_t capture_status;	/* current state of capture run */ 
+	trace_status_t capture_status;	/* current state of capture run */
 	etmv1_trace_data_t *trace_data;	/* trace data */
 	u32 trace_depth;				/* number of trace cycles to be analyzed, 0 if no trace data available */
 	etm_portmode_t portmode;		/* normal, multiplexed or demultiplexed */
-	etmv1_tracemode_t tracemode;	/* type of information the trace contains (data, addres, contextID, ...) */ 
+	etmv1_tracemode_t tracemode;	/* type of information the trace contains (data, addres, contextID, ...) */
 	armv4_5_state_t core_state;		/* current core state (ARM, Thumb, Jazelle) */
 	image_t *image;					/* source for target opcodes */
 	u32 pipe_index;					/* current trace cycle */
@@ -158,10 +158,10 @@
 	int data_half;					/* port half on a 16 bit port */
 	u32 current_pc;					/* current program counter */
 	u32 pc_ok;						/* full PC has been acquired */
-	u32 last_branch;				/* last branch address output */ 
+	u32 last_branch;				/* last branch address output */
 	u32 last_branch_reason;			/* branch reason code for the last branch encountered */
 	u32 last_ptr;					/* address of the last data access */
-	u32 ptr_ok;						/* whether last_ptr is valid */ 
+	u32 ptr_ok;						/* whether last_ptr is valid */
 	u32 context_id;					/* context ID of the code being traced */
 	u32 last_instruction;			/* index of last instruction executed (to calculate cycle timings) */
 } etm_context_t;



From oharboe at mail.berlios.de  Fri May  8 22:48:28 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 22:48:28 +0200
Subject: [Openocd-svn] r1683 - trunk/src/jtag
Message-ID: <200905082048.n48KmS85006849@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 22:48:28 +0200 (Fri, 08 May 2009)
New Revision: 1683

Modified:
   trunk/src/jtag/jtag.c
Log:
plugged bug w/irlen > 32 introduce in 1672

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-08 20:44:52 UTC (rev 1682)
+++ trunk/src/jtag/jtag.c	2009-05-08 20:48:28 UTC (rev 1683)
@@ -574,7 +574,11 @@
 		for (j = 0; j < num_fields; j++)
 		{
 			jtag_tap_t *tap=fields[j].tap;
-			jtag_check_value_mask(fields+j, tap->expected, tap->expected_mask);
+			if (fields[j].in_value!=NULL)
+			{
+				/* we verify max 32 bit long irlens. */
+				jtag_check_value_mask(fields+j, tap->expected, tap->expected_mask);
+			}
 
 			if (modified[j])
 			{



From oharboe at mail.berlios.de  Fri May  8 23:03:29 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 8 May 2009 23:03:29 +0200
Subject: [Openocd-svn] r1684 - trunk/src/target
Message-ID: <200905082103.n48L3Tov009474@sheep.berlios.de>

Author: oharboe
Date: 2009-05-08 23:03:28 +0200 (Fri, 08 May 2009)
New Revision: 1684

Modified:
   trunk/src/target/etb.h
   trunk/src/target/etm.c
Log:
whitespace fixes

Modified: trunk/src/target/etb.h
===================================================================
--- trunk/src/target/etb.h	2009-05-08 20:48:28 UTC (rev 1683)
+++ trunk/src/target/etb.h	2009-05-08 21:03:28 UTC (rev 1684)
@@ -48,7 +48,7 @@
 	jtag_tap_t *tap;
 	u32 cur_scan_chain;
 	reg_cache_t *reg_cache;
-	
+
 	/* ETB parameters */
 	u32 ram_depth;
 	u32 ram_width;

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-08 20:48:28 UTC (rev 1683)
+++ trunk/src/target/etm.c	2009-05-08 21:03:28 UTC (rev 1684)
@@ -280,6 +280,7 @@
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
 	etm_context_t *etm_ctx = arm7_9->etm_ctx;
 	reg_t *etm_ctrl_reg = &arm7_9->etm_ctx->reg_cache->reg_list[ETM_CTRL];
+
 	/* initialize some ETM control register settings */
 	etm_get_reg(etm_ctrl_reg);
 	etm_ctrl_value = buf_get_u32(etm_ctrl_reg->value, 0, etm_ctrl_reg->size);
@@ -309,6 +310,7 @@
 int etm_get_reg(reg_t *reg)
 {
 	int retval;
+
 	if ((retval = etm_read_reg(reg)) != ERROR_OK)
 	{
 		LOG_ERROR("BUG: error scheduling etm register read");
@@ -340,21 +342,18 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
 	fields[0].in_value = NULL;
-	
 
 	fields[1].tap = etm_reg->jtag_info->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
 	fields[1].in_value = NULL;
-	
 
 	fields[2].tap = etm_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
-	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -378,6 +377,7 @@
 int etm_set_reg(reg_t *reg, u32 value)
 {
 	int retval;
+
 	if ((retval = etm_write_reg(reg, value)) != ERROR_OK)
 	{
 		LOG_ERROR("BUG: error scheduling etm register write");
@@ -394,6 +394,7 @@
 int etm_set_reg_w_exec(reg_t *reg, u8 *buf)
 {
 	int retval;
+
 	etm_set_reg(reg, buf_get_u32(buf, 0, reg->size));
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
@@ -423,10 +424,6 @@
 
 	fields[0].in_value = NULL;
 
-
-	
-
-
 	fields[1].tap = etm_reg->jtag_info->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
@@ -434,10 +431,6 @@
 
 	fields[1].in_value = NULL;
 
-
-	
-
-
 	fields[2].tap = etm_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
@@ -445,10 +438,6 @@
 
 	fields[2].in_value = NULL;
 
-
-	
-
-
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	free(fields[0].out_value);
@@ -1648,7 +1637,7 @@
 	fileio_read_u32(&file, &etm_ctx->trace_depth);
 
 	etm_ctx->trace_data = malloc(sizeof(etmv1_trace_data_t) * etm_ctx->trace_depth);
-	if(etm_ctx->trace_data == NULL)
+	if (etm_ctx->trace_data == NULL)
 	{
 		command_print(cmd_ctx, "not enough memory to perform operation");
 		fileio_close(&file);
@@ -1816,7 +1805,7 @@
 
 	if ((retval = etmv1_analyze_trace(etm_ctx, cmd_ctx)) != ERROR_OK)
 	{
-		switch(retval)
+		switch (retval)
 		{
 			case ERROR_ETM_ANALYSIS_FAILED:
 				command_print(cmd_ctx, "further analysis failed (corrupted trace data or just end of data");



From oharboe at mail.berlios.de  Sat May  9 09:36:22 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 9 May 2009 09:36:22 +0200
Subject: [Openocd-svn] r1685 - trunk/src/target
Message-ID: <200905090736.n497aMLT021380@sheep.berlios.de>

Author: oharboe
Date: 2009-05-09 09:36:19 +0200 (Sat, 09 May 2009)
New Revision: 1685

Modified:
   trunk/src/target/arm11.c
   trunk/src/target/arm11.h
   trunk/src/target/arm11_dbgtap.c
Log:
Michael Bruck <mbruck at digenius.de> ARM11 C99 updates

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-08 21:03:28 UTC (rev 1684)
+++ trunk/src/target/arm11.c	2009-05-09 07:36:19 UTC (rev 1685)
@@ -373,12 +373,11 @@
 {
 	FNC_INFO;
 
-	{size_t i;
-	for(i = 0; i < asizeof(arm11->reg_values); i++)
+	for (size_t i = 0; i < asizeof(arm11->reg_values); i++)
 	{
 		arm11->reg_list[i].valid	= 1;
 		arm11->reg_list[i].dirty	= 0;
-	}}
+	}
 
 	/* Save DSCR */
 	CHECK_RETVAL(arm11_read_DSCR(arm11, &R(DSCR)));
@@ -454,12 +453,11 @@
 
 	/** \todo TODO: handle other mode registers */
 
-	{size_t i;
-	for (i = 0; i < 15; i++)
+	for (size_t i = 0; i < 15; i++)
 	{
 		/* MCR p14,0,R?,c0,c5,0 */
 		arm11_run_instr_data_from_core(arm11, 0xEE000E15 | (i << 12), &R(RX + i), 1);
-	}}
+	}
 
 	/* save rDTR */
 
@@ -528,8 +526,7 @@
 		return;
 	}
 
-	{size_t i;
-	for(i = 0; i < ARM11_REGCACHE_COUNT; i++)
+	for (size_t i = 0; i < ARM11_REGCACHE_COUNT; i++)
 	{
 		if (!arm11->reg_list[i].valid)
 		{
@@ -548,7 +545,7 @@
 				LOG_DEBUG("%8s %08x (INVALID)", arm11_reg_defs[i].name, arm11->reg_values[i]);
 			}
 		}
-	}}
+	}
 }
 
 /** Restore processor state
@@ -565,8 +562,8 @@
 	/** \todo TODO: handle other mode registers */
 
 	/* restore R1 - R14 */
-	{size_t i;
-	for (i = 1; i < 15; i++)
+
+	for (size_t i = 1; i < 15; i++)
 	{
 		if (!arm11->reg_list[ARM11_RC_RX + i].dirty)
 			continue;
@@ -575,7 +572,7 @@
 		arm11_run_instr_data_to_core1(arm11, 0xee100e15 | (i << 12), R(RX + i));
 
 		//	LOG_DEBUG("RESTORE R" ZU " %08x", i, R(RX + i));
-	}}
+	}
 
 	arm11_run_instr_data_finish(arm11);
 
@@ -650,15 +647,14 @@
 
 void arm11_record_register_history(arm11_common_t * arm11)
 {
-	{size_t i;
-	for(i = 0; i < ARM11_REGCACHE_COUNT; i++)
+	for (size_t i = 0; i < ARM11_REGCACHE_COUNT; i++)
 	{
 		arm11->reg_history[i].value	= arm11->reg_values[i];
 		arm11->reg_history[i].valid	= arm11->reg_list[i].valid;
 
 		arm11->reg_list[i].valid	= 0;
 		arm11->reg_list[i].dirty	= 0;
-	}}
+	}
 }
 
 
@@ -1072,22 +1068,20 @@
 	*reg_list_size	= ARM11_GDB_REGISTER_COUNT;
 	*reg_list		= malloc(sizeof(reg_t*) * ARM11_GDB_REGISTER_COUNT);
 
-	{size_t i;
-	for (i = 16; i < 24; i++)
+	for (size_t i = 16; i < 24; i++)
 	{
 		(*reg_list)[i] = &arm11_gdb_dummy_fp_reg;
-	}}
+	}
 
 	(*reg_list)[24] = &arm11_gdb_dummy_fps_reg;
 
-	{size_t i;
-	for (i = 0; i < ARM11_REGCACHE_COUNT; i++)
+	for (size_t i = 0; i < ARM11_REGCACHE_COUNT; i++)
 	{
 		if (arm11_reg_defs[i].gdb_num == -1)
 			continue;
 
 		(*reg_list)[arm11_reg_defs[i].gdb_num] = arm11->reg_list + i;
-	}}
+	}
 
 	return ERROR_OK;
 }
@@ -1123,8 +1117,7 @@
 		/** \todo TODO: check if dirty is the right choice to force a rewrite on arm11_resume() */
 		arm11->reg_list[ARM11_RC_R1].dirty = 1;
 
-		{size_t i;
-		for (i = 0; i < count; i++)
+		for (size_t i = 0; i < count; i++)
 		{
 			/* ldrb    r1, [r0], #1 */
 			/* ldrb    r1, [r0] */
@@ -1136,7 +1129,7 @@
 			arm11_run_instr_data_from_core(arm11, 0xEE001E15, &res, 1);
 
 			*buffer++ = res;
-		}}
+		}
 
 		break;
 
@@ -1144,8 +1137,7 @@
 		{
 			arm11->reg_list[ARM11_RC_R1].dirty = 1;
 
-			size_t i;
-			for (i = 0; i < count; i++)
+			for (size_t i = 0; i < count; i++)
 			{
 				/* ldrh    r1, [r0], #2 */
 				arm11_run_instr_no_data1(arm11,
@@ -1206,8 +1198,7 @@
 		{
 			arm11->reg_list[ARM11_RC_R1].dirty = 1;
 
-			{size_t i;
-			for (i = 0; i < count; i++)
+			for (size_t i = 0; i < count; i++)
 			{
 				/* MRC p14,0,r1,c0,c5,0 */
 				arm11_run_instr_data_to_core1(arm11, 0xee101e15, *buffer++);
@@ -1216,7 +1207,7 @@
 				/* strb    r1, [r0] */
 				arm11_run_instr_no_data1(arm11,
 					!arm11_config_memrw_no_increment ? 0xe4c01001 : 0xe5c01000);
-			}}
+			}
 
 			break;
 		}
@@ -1225,8 +1216,7 @@
 		{
 			arm11->reg_list[ARM11_RC_R1].dirty = 1;
 
-			size_t i;
-			for (i = 0; i < count; i++)
+			for (size_t i = 0; i < count; i++)
 			{
 				u16 value;
 				memcpy(&value, buffer + count * sizeof(u16), sizeof(u16));
@@ -1389,7 +1379,6 @@
 	u32 context[16];
 	u32 cpsr;
 	int exit_breakpoint_size = 0;
-	int i;
 	int retval = ERROR_OK;
 		LOG_DEBUG("Running algorithm");
 
@@ -1410,7 +1399,7 @@
 //		return ERROR_FAIL;
 
 	// Save regs
-	for (i = 0; i < 16; i++)
+	for (size_t i = 0; i < 16; i++)
 	{
 		context[i] = buf_get_u32((u8*)(&arm11->reg_values[i]),0,32);
 		LOG_DEBUG("Save %i: 0x%x",i,context[i]);
@@ -1419,13 +1408,13 @@
 	cpsr = buf_get_u32((u8*)(arm11->reg_values+ARM11_RC_CPSR),0,32);
 	LOG_DEBUG("Save CPSR: 0x%x", cpsr);
 
-	for (i = 0; i < num_mem_params; i++)
+	for (int i = 0; i < num_mem_params; i++)
 	{
 		target_write_buffer(target, mem_params[i].address, mem_params[i].size, mem_params[i].value);
 	}
 
 	// Set register parameters
-	for (i = 0; i < num_reg_params; i++)
+	for (int i = 0; i < num_reg_params; i++)
 	{
 		reg_t *reg = register_get_by_name(arm11->core_cache, reg_params[i].reg_name, 0);
 		if (!reg)
@@ -1495,13 +1484,13 @@
 		goto del_breakpoint;
 	}
 
-	for (i = 0; i < num_mem_params; i++)
+	for (int i = 0; i < num_mem_params; i++)
 	{
 		if (mem_params[i].direction != PARAM_OUT)
 			target_read_buffer(target, mem_params[i].address, mem_params[i].size, mem_params[i].value);
 	}
 
-	for (i = 0; i < num_reg_params; i++)
+	for (int i = 0; i < num_reg_params; i++)
 	{
 		if (reg_params[i].direction != PARAM_OUT)
 		{
@@ -1527,7 +1516,7 @@
 
 restore:
 	// Restore context
-	for (i = 0; i < 16; i++)
+	for (size_t i = 0; i < 16; i++)
 	{
 		LOG_DEBUG("restoring register %s with value 0x%8.8x",
 			 arm11->reg_list[i].name, context[i]);
@@ -1897,8 +1886,7 @@
 
 	u32	values[6];
 
-	{size_t i;
-	for (i = 0; i < (read ? 5 : 6); i++)
+	for (size_t i = 0; i < (read ? 5 : 6); i++)
 	{
 		values[i] = strtoul(args[i + 1], NULL, 0);
 
@@ -1909,7 +1897,7 @@
 				read ? arm11_mrc_syntax : arm11_mcr_syntax);
 			return -1;
 		}
-	}}
+	}
 
 	u32 instr = 0xEE000010	|
 		(values[0] <<  8) |

Modified: trunk/src/target/arm11.h
===================================================================
--- trunk/src/target/arm11.h	2009-05-08 21:03:28 UTC (rev 1684)
+++ trunk/src/target/arm11.h	2009-05-09 07:36:19 UTC (rev 1685)
@@ -252,14 +252,14 @@
 void arm11_add_IR				(arm11_common_t * arm11, u8 instr, tap_state_t state);
 void arm11_add_debug_SCAN_N		(arm11_common_t * arm11, u8 chain, tap_state_t state);
 void arm11_add_debug_INST		(arm11_common_t * arm11, u32 inst, u8 * flag, tap_state_t state);
-int arm11_read_DSCR			(arm11_common_t * arm11, u32 *dscr);
+int arm11_read_DSCR				(arm11_common_t * arm11, u32 *dscr);
 int arm11_write_DSCR			(arm11_common_t * arm11, u32 dscr);
 
 enum target_debug_reason arm11_get_DSCR_debug_reason(u32 dscr);
 
 void arm11_run_instr_data_prepare			(arm11_common_t * arm11);
 void arm11_run_instr_data_finish			(arm11_common_t * arm11);
-int arm11_run_instr_no_data				(arm11_common_t * arm11, u32 * opcode, size_t count);
+int arm11_run_instr_no_data					(arm11_common_t * arm11, u32 * opcode, size_t count);
 void arm11_run_instr_no_data1				(arm11_common_t * arm11, u32 opcode);
 int arm11_run_instr_data_to_core			(arm11_common_t * arm11, u32 opcode, u32 * data, size_t count);
 int arm11_run_instr_data_to_core_noack		(arm11_common_t * arm11, u32 opcode, u32 * data, size_t count);

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2009-05-08 21:03:28 UTC (rev 1684)
+++ trunk/src/target/arm11_dbgtap.c	2009-05-09 07:36:19 UTC (rev 1685)
@@ -549,14 +549,13 @@
 
 	size_t error_count = 0;
 
-	{size_t i;
-	for (i = 0; i < asizeof(Readies); i++)
+	for (size_t i = 0; i < asizeof(Readies); i++)
 	{
 		if (Readies[i] != 1)
 		{
 			error_count++;
 		}
-	}}
+	}
 
 	if (error_count)
 		LOG_ERROR("Transfer errors " ZU, error_count);
@@ -699,8 +698,7 @@
 	arm11_setup_field(arm11, 32, &DataOut,		&DataIn,	chain7_fields + 1);
 	arm11_setup_field(arm11,  7, &AddressOut,	&AddressIn,	chain7_fields + 2);
 
-	{size_t i;
-	for (i = 0; i < count + 1; i++)
+	for (size_t i = 0; i < count + 1; i++)
 	{
 		if (i < count)
 		{
@@ -746,13 +744,12 @@
 				}
 			}
 		}
-	}}
+	}
 
-	{size_t i;
-	for (i = 0; i < count; i++)
+	for (size_t i = 0; i < count; i++)
 	{
 		JTAG_DEBUG("SC7 %02d: %02x %s %08x", i, actions[i].address, actions[i].write ? "<=" : "=>", actions[i].value);
-	}}
+	}
 
 	return ERROR_OK;
 }
@@ -767,23 +764,20 @@
 	arm11_sc7_action_t		clear_bw[arm11->brp + arm11->wrp + 1];
 	arm11_sc7_action_t *	pos = clear_bw;
 
-	{size_t i;
-	for (i = 0; i < asizeof(clear_bw); i++)
+	for (size_t i = 0; i < asizeof(clear_bw); i++)
 	{
 		clear_bw[i].write	= true;
 		clear_bw[i].value	= 0;
-	}}
+	}
 
-	{size_t i;
-	for (i = 0; i < arm11->brp; i++)
+	for (size_t i = 0; i < arm11->brp; i++)
 		(pos++)->address = ARM11_SC7_BCR0 + i;
-	}
 
-	{size_t i;
-	for (i = 0; i < arm11->wrp; i++)
+
+	for (size_t i = 0; i < arm11->wrp; i++)
 		(pos++)->address = ARM11_SC7_WCR0 + i;
-	}
 
+
 	(pos++)->address = ARM11_SC7_VCR;
 
 	arm11_sc7_run(arm11, clear_bw, asizeof(clear_bw));



From oharboe at mail.berlios.de  Sat May  9 11:30:03 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 9 May 2009 11:30:03 +0200
Subject: [Openocd-svn] r1686 - trunk/src/helper
Message-ID: <200905090930.n499U3w0000098@sheep.berlios.de>

Author: oharboe
Date: 2009-05-09 11:30:00 +0200 (Sat, 09 May 2009)
New Revision: 1686

Modified:
   trunk/src/helper/binarybuffer.c
   trunk/src/helper/binarybuffer.h
Log:
Michael Bruck <mbruck at digenius.de> use more const

Modified: trunk/src/helper/binarybuffer.c
===================================================================
--- trunk/src/helper/binarybuffer.c	2009-05-09 07:36:19 UTC (rev 1685)
+++ trunk/src/helper/binarybuffer.c	2009-05-09 09:30:00 UTC (rev 1686)
@@ -53,7 +53,7 @@
 };
 
 
-u8* buf_cpy(u8 *from, u8 *to, int size)
+u8* buf_cpy(const u8 *from, u8 *to, int size)
 {
 	unsigned int num_bytes = CEIL(size, 8);
 	unsigned int i;
@@ -73,7 +73,7 @@
 	return to;
 }
 
-int buf_cmp(u8 *buf1, u8 *buf2, int size)
+int buf_cmp(const u8 *buf1, const u8 *buf2, int size)
 {
 	int num_bytes = CEIL(size, 8);
 	int i;
@@ -100,7 +100,7 @@
 	return 0;
 }
 
-int buf_cmp_mask(u8 *buf1, u8 *buf2, u8 *mask, int size)
+int buf_cmp_mask(const u8 *buf1, const u8 *buf2, const u8 *mask, int size)
 {
 	int num_bytes = CEIL(size, 8);
 	int i;
@@ -143,7 +143,7 @@
 	return buf;
 }
 
-u8* buf_set_buf(u8 *src, int src_start, u8 *dst, int dst_start, int len)
+u8* buf_set_buf(const u8 *src, int src_start, u8 *dst, int dst_start, int len)
 {
 	int src_idx = src_start, dst_idx = dst_start;
 	int i;

Modified: trunk/src/helper/binarybuffer.h
===================================================================
--- trunk/src/helper/binarybuffer.h	2009-05-09 07:36:19 UTC (rev 1685)
+++ trunk/src/helper/binarybuffer.h	2009-05-09 09:30:00 UTC (rev 1686)
@@ -30,7 +30,7 @@
  */
 
 /* inlining this will help show what fn that is taking time during profiling. */
-static __inline void buf_set_u32(u8* buffer, unsigned int first, unsigned int num, u32 value)
+static inline void buf_set_u32(u8* buffer, unsigned int first, unsigned int num, u32 value)
 {
 	if ((num==32)&&(first==0))
 	{
@@ -51,7 +51,7 @@
 		}
 	}
 }
-static __inline u32 buf_get_u32(u8* buffer, unsigned int first, unsigned int num)
+static inline u32 buf_get_u32(const u8* buffer, unsigned int first, unsigned int num)
 {
 	if ((num==32)&&(first==0))
 	{
@@ -73,12 +73,12 @@
 
 extern u32 flip_u32(u32 value, unsigned int num);
 
-extern int buf_cmp(u8 *buf1, u8 *buf2, int size);
-extern int buf_cmp_mask(u8 *buf1, u8 *buf2, u8 *mask, int size);
-extern u8* buf_cpy(u8 *from, u8 *to, int size);
+extern int buf_cmp(const u8 *buf1, const u8 *buf2, int size);
+extern int buf_cmp_mask(const u8 *buf1, const u8 *buf2, const u8 *mask, int size);
+extern u8* buf_cpy(const u8 *from, u8 *to, int size);
 
 extern u8* buf_set_ones(u8 *buf, int count);
-extern u8* buf_set_buf(u8 *src, int src_start, u8 *dst, int dst_start, int len);
+extern u8* buf_set_buf(const u8 *src, int src_start, u8 *dst, int dst_start, int len);
 
 extern int str_to_buf(const char *str, int len, u8 *bin_buf, int buf_size, int radix);
 extern char* buf_to_str(const u8 *buf, int size, int radix);
@@ -89,7 +89,7 @@
 #define CEIL(m, n)	((m + n - 1) / n)
 
 /* read a u32 from a buffer in target memory endianness */
-static __inline u32 fast_target_buffer_get_u32(u8 *buffer, int little)
+static inline u32 fast_target_buffer_get_u32(const u8 *buffer, int little)
 {
 	if (little)
 		return le_to_h_u32(buffer);



From oharboe at mail.berlios.de  Sun May 10 14:55:18 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 10 May 2009 14:55:18 +0200
Subject: [Openocd-svn] r1687 - trunk/src/helper
Message-ID: <200905101255.n4ACtIIU026296@sheep.berlios.de>

Author: oharboe
Date: 2009-05-10 14:55:16 +0200 (Sun, 10 May 2009)
New Revision: 1687

Modified:
   trunk/src/helper/fileio.c
   trunk/src/helper/fileio.h
Log:
Michael Bruck <mbruck at digenius.de> use more const

Modified: trunk/src/helper/fileio.c
===================================================================
--- trunk/src/helper/fileio.c	2009-05-09 09:30:00 UTC (rev 1686)
+++ trunk/src/helper/fileio.c	2009-05-10 12:55:16 UTC (rev 1687)
@@ -43,9 +43,7 @@
 #include <errno.h>
 #include <ctype.h>
 
-int fileio_dispatch_read(fileio_t *fileio, u32 size, u8 *buffer, u32 *size_read);
-
-int fileio_open_local(fileio_t *fileio)
+static inline int fileio_open_local(fileio_t *fileio)
 {
 	char access[4];
 	
@@ -112,7 +110,7 @@
 	return ERROR_OK;
 }
 
-int fileio_open(fileio_t *fileio, char *url, enum fileio_access access,	enum fileio_type type)
+int fileio_open(fileio_t *fileio, const char *url, enum fileio_access access,	enum fileio_type type)
 {
 	int retval = ERROR_OK;
 
@@ -125,7 +123,7 @@
 	return retval;
 }
 
-int fileio_close_local(fileio_t *fileio)
+static inline int fileio_close_local(fileio_t *fileio)
 {
 	int retval;
 	if ((retval = fclose(fileio->file)) != 0)
@@ -169,7 +167,7 @@
 	return ERROR_OK;
 }
 
-int fileio_local_read(fileio_t *fileio, u32 size, u8 *buffer, u32 *size_read)
+static inline int fileio_local_read(fileio_t *fileio, u32 size, u8 *buffer, u32 *size_read)
 {
 	*size_read = fread(buffer, 1, size, fileio->file);
 	
@@ -194,7 +192,7 @@
 	return ERROR_OK;
 }
 
-int fileio_local_fgets(fileio_t *fileio, u32 size, char *buffer)
+static inline int fileio_local_fgets(fileio_t *fileio, u32 size, char *buffer)
 {
 	if( fgets(buffer, size, fileio->file) == NULL)
 		return ERROR_FILEIO_OPERATION_FAILED;
@@ -207,14 +205,14 @@
 	return fileio_local_fgets(fileio, size, buffer);
 }
 
-int fileio_local_write(fileio_t *fileio, u32 size, u8 *buffer, u32 *size_written)
+static inline int fileio_local_write(fileio_t *fileio, u32 size, const u8 *buffer, u32 *size_written)
 {
 	*size_written = fwrite(buffer, 1, size, fileio->file);
 	
 	return ERROR_OK;
 }
 
-int fileio_write(fileio_t *fileio, u32 size, u8 *buffer, u32 *size_written)
+int fileio_write(fileio_t *fileio, u32 size, const u8 *buffer, u32 *size_written)
 {
 	int retval;
 	

Modified: trunk/src/helper/fileio.h
===================================================================
--- trunk/src/helper/fileio.h	2009-05-09 09:30:00 UTC (rev 1686)
+++ trunk/src/helper/fileio.h	2009-05-10 12:55:16 UTC (rev 1687)
@@ -62,12 +62,12 @@
 	FILE *file;
 } fileio_t;
 
-extern int fileio_write(fileio_t *fileio, u32 size, u8 *buffer, u32 *size_written);
+extern int fileio_write(fileio_t *fileio, u32 size, const u8 *buffer, u32 *size_written);
 extern int fileio_read(fileio_t *fileio, u32 size, u8 *buffer, u32 *size_read);
 extern int fileio_fgets(fileio_t *fileio, u32 size, char *buffer);
 extern int fileio_seek(fileio_t *fileio, u32 position);
 extern int fileio_close(fileio_t *fileio);
-extern int fileio_open(fileio_t *fileio, char *url, enum fileio_access access, enum fileio_type type);
+extern int fileio_open(fileio_t *fileio, const char *url, enum fileio_access access, enum fileio_type type);
 extern int fileio_read_u32(fileio_t *fileio, u32 *data);
 extern int fileio_write_u32(fileio_t *fileio, u32 data);
 



From oharboe at mail.berlios.de  Sun May 10 20:01:51 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 10 May 2009 20:01:51 +0200
Subject: [Openocd-svn] r1688 - trunk/src/target
Message-ID: <200905101801.n4AI1pAr006848@sheep.berlios.de>

Author: oharboe
Date: 2009-05-10 20:01:50 +0200 (Sun, 10 May 2009)
New Revision: 1688

Modified:
   trunk/src/target/arm11.c
Log:
David Brownell <david-b at pacbell.net> fix warnings

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-10 12:55:16 UTC (rev 1687)
+++ trunk/src/target/arm11.c	2009-05-10 18:01:50 UTC (rev 1688)
@@ -1402,7 +1402,7 @@
 	for (size_t i = 0; i < 16; i++)
 	{
 		context[i] = buf_get_u32((u8*)(&arm11->reg_values[i]),0,32);
-		LOG_DEBUG("Save %i: 0x%x",i,context[i]);
+		LOG_DEBUG("Save %zi: 0x%x",i,context[i]);
 	}
 
 	cpsr = buf_get_u32((u8*)(arm11->reg_values+ARM11_RC_CPSR),0,32);



From oharboe at mail.berlios.de  Sun May 10 21:01:03 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 10 May 2009 21:01:03 +0200
Subject: [Openocd-svn] r1689 - trunk/src/target
Message-ID: <200905101901.n4AJ13Vn016967@sheep.berlios.de>

Author: oharboe
Date: 2009-05-10 21:01:03 +0200 (Sun, 10 May 2009)
New Revision: 1689

Modified:
   trunk/src/target/arm966e.c
Log:
David Brownell <david-b at pacbell.net> whitespace fixes. Testing out on one file first...

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-10 18:01:50 UTC (rev 1688)
+++ trunk/src/target/arm966e.c	2009-05-10 19:01:03 UTC (rev 1689)
@@ -178,7 +178,7 @@
 	u8 nr_w_buf = 0;
 
 	jtag_add_end_state(TAP_IDLE);
-	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
+	if ((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -188,19 +188,16 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
 	fields[0].in_value = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 6;
 	fields[1].out_value = &reg_addr_buf;
 	fields[1].in_value = NULL;
-	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &nr_w_buf;
 	fields[2].in_value = NULL;
-	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -213,7 +210,7 @@
 
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
-	if((retval = jtag_execute_queue()) != ERROR_OK)
+	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -237,7 +234,7 @@
 	buf_set_u32(value_buf, 0, 32, value);
 
 	jtag_add_end_state(TAP_IDLE);
-	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
+	if ((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -246,33 +243,18 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = value_buf;
-
 	fields[0].in_value = NULL;
 
-
-	
-
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 6;
 	fields[1].out_value = &reg_addr_buf;
-
 	fields[1].in_value = NULL;
 
-
-	
-
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &nr_w_buf;
-
 	fields[2].in_value = NULL;
 
-
-	
-
-
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
@@ -319,7 +301,7 @@
 				command_print(cmd_ctx, "couldn't access reg %i", address);
 				return ERROR_OK;
 			}
-			if((retval = jtag_execute_queue()) != ERROR_OK)
+			if ((retval = jtag_execute_queue()) != ERROR_OK)
 			{
 				return retval;
 			}



From oharboe at mail.berlios.de  Sun May 10 21:02:10 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 10 May 2009 21:02:10 +0200
Subject: [Openocd-svn] r1690 - trunk/src/target
Message-ID: <200905101902.n4AJ2A0O017076@sheep.berlios.de>

Author: oharboe
Date: 2009-05-10 21:02:07 +0200 (Sun, 10 May 2009)
New Revision: 1690

Modified:
   trunk/src/target/arm720t.c
   trunk/src/target/arm7_9_common.c
   trunk/src/target/arm7_9_common.h
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/armv4_5.c
   trunk/src/target/armv4_5.h
   trunk/src/target/armv4_5_cache.c
   trunk/src/target/armv4_5_mmu.c
Log:
David Brownell <david-b at pacbell.net> whitespace fixes.

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/arm720t.c	2009-05-10 19:02:07 UTC (rev 1690)
@@ -113,13 +113,12 @@
 	fields[0].num_bits = 1;
 	fields[0].out_value = &instruction_buf;
 	fields[0].in_value = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = out_buf;
 	fields[1].in_value = NULL;
-	
+
 	if (in)
 	{
 		u8 tmp[4];

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/arm7_9_common.c	2009-05-10 19:02:07 UTC (rev 1690)
@@ -1287,7 +1287,7 @@
 	/* iterate through processor modes (User, FIQ, IRQ, SVC, ABT, UND)
 	 * SYS shares registers with User, so we don't touch SYS
 	 */
-	for(i = 0; i < 6; i++)
+	for (i = 0; i < 6; i++)
 	{
 		u32 mask = 0;
 		u32* reg_p[16];

Modified: trunk/src/target/arm7_9_common.h
===================================================================
--- trunk/src/target/arm7_9_common.h	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/arm7_9_common.h	2009-05-10 19:02:07 UTC (rev 1690)
@@ -41,10 +41,10 @@
 typedef struct arm7_9_common_s
 {
 	u32 common_magic;
-	
+
 	arm_jtag_t jtag_info;
 	reg_cache_t *eice_cache;
-	
+
 	u32 arm_bkpt;
 	u16 thumb_bkpt;
 	int sw_breakpoints_added;
@@ -58,32 +58,32 @@
 	int dbgreq_adjust_pc;
 	int use_dbgrq;
 	int need_bypass_before_restart;
-	
+
 	etm_context_t *etm_ctx;
-	
+
 	int has_single_step;
 	int has_monitor_mode;
 	int has_vector_catch;
-	
+
 	int debug_entry_from_reset;
-	
+
 	struct working_area_s *dcc_working_area;
-	
+
 	int fast_memory_access;
 	int dcc_downloads;
 
 	int (*examine_debug_reason)(target_t *target);
-	
+
 	void (*change_to_arm)(target_t *target, u32 *r0, u32 *pc);
-	
+
 	void (*read_core_regs)(target_t *target, u32 mask, u32 *core_regs[16]);
 	void (*read_core_regs_target_buffer)(target_t *target, u32 mask, void *buffer, int size);
 	void (*read_xpsr)(target_t *target, u32 *xpsr, int spsr);
-	
+
 	void (*write_xpsr)(target_t *target, u32 xpsr, int spsr);
 	void (*write_xpsr_im8)(target_t *target, u8 xpsr_im, int rot, int spsr);
 	void (*write_core_regs)(target_t *target, u32 mask, u32 core_regs[16]);
-	
+
 	void (*load_word_regs)(target_t *target, u32 mask);
 	void (*load_hword_reg)(target_t *target, int num);
 	void (*load_byte_reg)(target_t *target, int num);
@@ -91,22 +91,22 @@
 	void (*store_word_regs)(target_t *target, u32 mask);
 	void (*store_hword_reg)(target_t *target, int num);
 	void (*store_byte_reg)(target_t *target, int num);
-	
+
 	void (*write_pc)(target_t *target, u32 pc);
 	void (*branch_resume)(target_t *target);
 	void (*branch_resume_thumb)(target_t *target);
-	
+
 	void (*enable_single_step)(target_t *target, u32 next_pc);
 	void (*disable_single_step)(target_t *target);
-	
+
 	void (*set_special_dbgrq)(target_t *target);
 
 	void (*pre_debug_entry)(target_t *target);
 	void (*post_debug_entry)(target_t *target);
-	
+
 	void (*pre_restore_context)(target_t *target);
 	void (*post_restore_context)(target_t *target);
-	
+
 	armv4_5_common_t armv4_5_common;
 	void *arch_info;
 

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/arm7tdmi.c	2009-05-10 19:02:07 UTC (rev 1690)
@@ -115,13 +115,11 @@
 		fields[0].num_bits = 1;
 		fields[0].out_value = NULL;
 		fields[0].in_value = &breakpoint;
-		
 
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 32;
 		fields[1].out_value = NULL;
 		fields[1].in_value = databus;
-		
 
 		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
@@ -194,15 +192,12 @@
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
 	fields[0].in_value = NULL;
-	
 
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	u8 tmp[4];
 	fields[1].in_value = tmp;
-	
 
 	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 
@@ -286,14 +281,12 @@
 	fields[0].num_bits = 1;
 	fields[0].out_value = NULL;
 	fields[0].in_value = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	u8 tmp[4];
 	fields[1].in_value = tmp;
-	
 
 	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
 

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/arm920t.c	2009-05-10 19:02:07 UTC (rev 1690)
@@ -114,25 +114,21 @@
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
 	fields[0].in_value = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	fields[1].in_value = NULL;
-	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
 	fields[2].in_value = NULL;
-	
 
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
 	fields[3].in_value = NULL;
-	
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
@@ -171,43 +167,23 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
-
 	fields[0].in_value = NULL;
 
-
-	
-
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = value_buf;
-
 	fields[1].in_value = NULL;
 
-
-	
-
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
-
 	fields[2].in_value = NULL;
 
-
-	
-
-
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-
 	fields[3].in_value = NULL;
 
-
-	
-
-
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
@@ -238,43 +214,23 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 1;
 	fields[0].out_value = &access_type_buf;
-
 	fields[0].in_value = NULL;
 
-
-	
-
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = cp15_opcode_buf;
-
 	fields[1].in_value = NULL;
 
-
-	
-
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 6;
 	fields[2].out_value = &reg_addr_buf;
-
 	fields[2].in_value = NULL;
 
-
-	
-
-
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-
 	fields[3].in_value = NULL;
 
-
-	
-
-
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 	arm9tdmi_clock_out(jtag_info, arm_opcode, 0, NULL, 0);
@@ -621,7 +577,7 @@
 	arm920t_common_t *arm920t = arm9tdmi->arch_info;
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
 
-	if((retval = target_halt(target)) != ERROR_OK)
+	if ((retval = target_halt(target)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -633,7 +589,7 @@
 		if (buf_get_u32(dbg_stat->value, EICE_DBG_STATUS_DBGACK, 1) == 0)
 		{
 			embeddedice_read_reg(dbg_stat);
-			if((retval = jtag_execute_queue()) != ERROR_OK)
+			if ((retval = jtag_execute_queue()) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -676,7 +632,7 @@
 	arm920t->armv4_5_mmu.armv4_5_cache.d_u_cache_enabled = 0;
 	arm920t->armv4_5_mmu.armv4_5_cache.i_cache_enabled = 0;
 
-	if((retval = target_call_event_callbacks(target, TARGET_EVENT_HALTED)) != ERROR_OK)
+	if ((retval = target_call_event_callbacks(target, TARGET_EVENT_HALTED)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -814,7 +770,7 @@
 
 	/* disable MMU and Caches */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), &cp15_ctrl);
-	if((retval = jtag_execute_queue()) != ERROR_OK)
+	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -877,7 +833,7 @@
 
 			/* read D RAM and CAM content */
 			arm9tdmi_read_core_regs(target, 0x3fe, regs_p);
-			if((retval = jtag_execute_queue()) != ERROR_OK)
+			if ((retval = jtag_execute_queue()) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -963,7 +919,7 @@
 
 			/* read I RAM and CAM content */
 			arm9tdmi_read_core_regs(target, 0x3fe, regs_p);
-			if((retval = jtag_execute_queue()) != ERROR_OK)
+			if ((retval = jtag_execute_queue()) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -1066,7 +1022,7 @@
 
 	/* disable MMU and Caches */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), &cp15_ctrl);
-	if((retval = jtag_execute_queue()) != ERROR_OK)
+	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -1076,7 +1032,7 @@
 
 	/* read CP15 test state register */
 	arm920t_read_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0xf, 0), &cp15c15);
-	if((retval = jtag_execute_queue()) != ERROR_OK)
+	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -1097,7 +1053,7 @@
 
 	/* read D TLB lockdown stored to r1 */
 	arm9tdmi_read_core_regs(target, 0x2, regs_p);
-	if((retval = jtag_execute_queue()) != ERROR_OK)
+	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -1126,7 +1082,7 @@
 
 		/* read D TLB CAM content stored to r2-r9 */
 		arm9tdmi_read_core_regs(target, 0x3fc, regs_p);
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -1161,7 +1117,7 @@
 
 		/* read D TLB RAM content stored to r2 and r3 */
 		arm9tdmi_read_core_regs(target, 0xc, regs_p);
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -1193,7 +1149,7 @@
 
 	/* read I TLB lockdown stored to r1 */
 	arm9tdmi_read_core_regs(target, 0x2, regs_p);
-	if((retval = jtag_execute_queue()) != ERROR_OK)
+	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -1222,7 +1178,7 @@
 
 		/* read I TLB CAM content stored to r2-r9 */
 		arm9tdmi_read_core_regs(target, 0x3fc, regs_p);
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -1257,7 +1213,7 @@
 
 		/* read I TLB RAM content stored to r2 and r3 */
 		arm9tdmi_read_core_regs(target, 0xc, regs_p);
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -1347,7 +1303,7 @@
 				command_print(cmd_ctx, "couldn't access reg %i", address);
 				return ERROR_OK;
 			}
-			if((retval = jtag_execute_queue()) != ERROR_OK)
+			if ((retval = jtag_execute_queue()) != ERROR_OK)
 			{
 				return retval;
 			}

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/arm926ejs.c	2009-05-10 19:02:07 UTC (rev 1690)
@@ -133,7 +133,7 @@
 	buf_set_u32(address_buf, 0, 14, address);
 
 	jtag_add_end_state(TAP_IDLE);
-	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
+	if ((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -151,20 +151,16 @@
 	fields[1].out_value = &access;
 	fields[1].in_value = &access;
 
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
 	fields[2].in_value = NULL;
 
-
-
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
 	fields[3].in_value = NULL;
 
-
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 	/*TODO: add timeout*/
@@ -177,7 +173,7 @@
 
 		*value=le_to_h_u32(tmp);
 
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -209,7 +205,7 @@
 	buf_set_u32(value_buf, 0, 32, value);
 
 	jtag_add_end_state(TAP_IDLE);
-	if((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
+	if ((retval = arm_jtag_scann(jtag_info, 0xf)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -218,43 +214,23 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = value_buf;
-
 	fields[0].in_value = NULL;
 
-
-
-
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 1;
 	fields[1].out_value = &access;
-
 	fields[1].in_value = &access;
 
-
-
-
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 14;
 	fields[2].out_value = address_buf;
-
 	fields[2].in_value = NULL;
 
-
-
-
-
 	fields[3].tap = jtag_info->tap;
 	fields[3].num_bits = 1;
 	fields[3].out_value = &nr_w_buf;
-
 	fields[3].in_value = NULL;
 
-
-
-
-
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 	/*TODO: add timeout*/
 	do
@@ -263,7 +239,7 @@
 		access = 0;
 		nr_w_buf = 0;
 		jtag_add_dr_scan(4, fields, TAP_INVALID);
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -595,7 +571,7 @@
 	arm926ejs_common_t *arm926ejs = arm9tdmi->arch_info;
 	reg_t *dbg_stat = &arm7_9->eice_cache->reg_list[EICE_DBG_STAT];
 
-	if((retval = target_halt(target)) != ERROR_OK)
+	if ((retval = target_halt(target)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -607,7 +583,7 @@
 		if (buf_get_u32(dbg_stat->value, EICE_DBG_STATUS_DBGACK, 1) == 0)
 		{
 			embeddedice_read_reg(dbg_stat);
-			if((retval = jtag_execute_queue()) != ERROR_OK)
+			if ((retval = jtag_execute_queue()) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -812,7 +788,7 @@
 			command_print(cmd_ctx, "couldn't access register");
 			return ERROR_OK;
 		}
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/arm9tdmi.c	2009-05-10 19:02:07 UTC (rev 1690)
@@ -128,41 +128,26 @@
 		fields[0].tap = arm7_9->jtag_info.tap;
 		fields[0].num_bits = 32;
 		fields[0].out_value = NULL;
-
 		fields[0].in_value = databus;
 
-
-		
-
-
 		fields[1].tap = arm7_9->jtag_info.tap;
 		fields[1].num_bits = 3;
 		fields[1].out_value = NULL;
-
 		fields[1].in_value = &debug_reason;
 
-
-		
-
-
 		fields[2].tap = arm7_9->jtag_info.tap;
 		fields[2].num_bits = 32;
 		fields[2].out_value = NULL;
-
 		fields[2].in_value = instructionbus;
 
-
-		
-
-
-		if((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
+		if ((retval = arm_jtag_scann(&arm7_9->jtag_info, 0x1)) != ERROR_OK)
 		{
 			return retval;
 		}
 		arm_jtag_set_instr(&arm7_9->jtag_info, arm7_9->jtag_info.intest_instr, NULL);
 
 		jtag_add_dr_scan(3, fields, TAP_DRPAUSE);
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -206,7 +191,7 @@
 		buf_set_u32(&sysspeed_buf, 2, 1, 1);
 
 	jtag_add_end_state(TAP_DRPAUSE);
-	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
+	if ((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -217,20 +202,16 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
 	fields[0].in_value = NULL;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
 	fields[1].in_value = NULL;
-	
 
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
 	fields[2].in_value = NULL;
-	
 
 	if (in)
 	{
@@ -249,7 +230,7 @@
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -273,7 +254,7 @@
 	scan_field_t fields[3];
 
 	jtag_add_end_state(TAP_DRPAUSE);
-	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
+	if ((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -285,19 +266,16 @@
 	fields[0].out_value = NULL;
 	u8 tmp[4];
 	fields[0].in_value = tmp;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
 	fields[1].in_value = NULL;
-	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
 	fields[2].in_value = NULL;
-	
 
 	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
@@ -307,7 +285,7 @@
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -338,7 +316,7 @@
 	scan_field_t fields[3];
 
 	jtag_add_end_state(TAP_DRPAUSE);
-	if((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
+	if ((retval = arm_jtag_scann(jtag_info, 0x1)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -350,19 +328,16 @@
 	fields[0].out_value = NULL;
 	u8 tmp[4];
 	fields[0].in_value = tmp;
-	
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = NULL;
 	fields[1].in_value = NULL;
-	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = NULL;
 	fields[2].in_value = NULL;
-	
 
 	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
 
@@ -373,7 +348,7 @@
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
-		if((retval = jtag_execute_queue()) != ERROR_OK)
+		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -435,7 +410,7 @@
 	/* NOP fetched, BX in Execute (1) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
 
-	if((retval = jtag_execute_queue()) != ERROR_OK)
+	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
 		return;
 	}
@@ -1047,7 +1022,7 @@
 			for (i = 0; i < argc; i++)
 			{
 				/* go through list of vectors */
-				for(j = 0; arm9tdmi_vectors[j].name; j++)
+				for (j = 0; arm9tdmi_vectors[j].name; j++)
 				{
 					if (strcmp(args[i], arm9tdmi_vectors[j].name) == 0)
 					{

Modified: trunk/src/target/armv4_5.c
===================================================================
--- trunk/src/target/armv4_5.c	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/armv4_5.c	2009-05-10 19:02:07 UTC (rev 1690)
@@ -428,23 +428,23 @@
 
 	for (i = 0; i < count; i++)
 	{
-		if(thumb)
+		if (thumb)
 		{
-			if((retval = target_read_u16(target, address, &thumb_opcode)) != ERROR_OK)
+			if ((retval = target_read_u16(target, address, &thumb_opcode)) != ERROR_OK)
 			{
 				return retval;
 			}
-			if((retval = thumb_evaluate_opcode(thumb_opcode, address, &cur_instruction)) != ERROR_OK)
+			if ((retval = thumb_evaluate_opcode(thumb_opcode, address, &cur_instruction)) != ERROR_OK)
 			{
 				return retval;
 			}
 		}
 		else {
-			if((retval = target_read_u32(target, address, &opcode)) != ERROR_OK)
+			if ((retval = target_read_u32(target, address, &opcode)) != ERROR_OK)
 			{
 				return retval;
 			}
-			if((retval = arm_evaluate_opcode(opcode, address, &cur_instruction)) != ERROR_OK)
+			if ((retval = arm_evaluate_opcode(opcode, address, &cur_instruction)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -502,7 +502,7 @@
 	int retval;
 	armv4_5_common_t *armv4_5 = target->arch_info;
 
-	if((retval = target_wait_state(target, TARGET_HALTED, timeout_ms)) != ERROR_OK)
+	if ((retval = target_wait_state(target, TARGET_HALTED, timeout_ms)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -564,7 +564,7 @@
 
 	for (i = 0; i < num_mem_params; i++)
 	{
-		if((retval = target_write_buffer(target, mem_params[i].address, mem_params[i].size, mem_params[i].value)) != ERROR_OK)
+		if ((retval = target_write_buffer(target, mem_params[i].address, mem_params[i].size, mem_params[i].value)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -585,7 +585,7 @@
 			exit(-1);
 		}
 
-		if((retval = armv4_5_set_core_reg(reg, reg_params[i].value)) != ERROR_OK)
+		if ((retval = armv4_5_set_core_reg(reg, reg_params[i].value)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -616,7 +616,7 @@
 		return ERROR_TARGET_FAILURE;
 	}
 
-	if((retval = target_resume(target, 0, entry_point, 1, 1)) != ERROR_OK)
+	if ((retval = target_resume(target, 0, entry_point, 1, 1)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -631,7 +631,7 @@
 	for (i = 0; i < num_mem_params; i++)
 	{
 		if (mem_params[i].direction != PARAM_OUT)
-			if((retvaltemp = target_read_buffer(target, mem_params[i].address, mem_params[i].size, mem_params[i].value)) != ERROR_OK)
+			if ((retvaltemp = target_read_buffer(target, mem_params[i].address, mem_params[i].size, mem_params[i].value)) != ERROR_OK)
 			{
 					retval = retvaltemp;
 			}

Modified: trunk/src/target/armv4_5.h
===================================================================
--- trunk/src/target/armv4_5.h	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/armv4_5.h	2009-05-10 19:02:07 UTC (rev 1690)
@@ -29,10 +29,10 @@
 
 typedef enum armv4_5_mode
 {
-	ARMV4_5_MODE_USR = 16, 
-	ARMV4_5_MODE_FIQ = 17, 
-	ARMV4_5_MODE_IRQ = 18, 
-	ARMV4_5_MODE_SVC = 19, 
+	ARMV4_5_MODE_USR = 16,
+	ARMV4_5_MODE_FIQ = 17,
+	ARMV4_5_MODE_IRQ = 18,
+	ARMV4_5_MODE_SVC = 19,
 	ARMV4_5_MODE_ABT = 23,
 	ARMV4_5_MODE_UND = 27,
 	ARMV4_5_MODE_SYS = 31,
@@ -58,7 +58,7 @@
 		cache->reg_list[armv4_5_core_reg_map[mode][num]]
 
 /* offsets into armv4_5 core register cache */
-enum 
+enum
 {
 	ARMV4_5_CPSR = 31,
 	ARMV4_5_SPSR_FIQ = 32,
@@ -85,7 +85,7 @@
 typedef struct armv4_5_algorithm_s
 {
 	int common_magic;
-		
+
 	enum armv4_5_mode core_mode;
 	enum armv4_5_state core_state;
 } armv4_5_algorithm_t;
@@ -113,7 +113,7 @@
 		case ARMV4_5_MODE_UND: return 5; break;
 		case ARMV4_5_MODE_SYS: return 6; break;
 		case ARMV4_5_MODE_ANY: return 0; break;	/* map MODE_ANY to user mode */
-		default: 
+		default:
 			LOG_ERROR("invalid mode value encountered");
 			return -1;
 	}
@@ -122,7 +122,7 @@
 /* map linear number to mode bits */
 static __inline enum armv4_5_mode armv4_5_number_to_mode(int number)
 {
-	switch(number)
+	switch (number)
 	{
 		case 0: return ARMV4_5_MODE_USR; break;
 		case 1: return ARMV4_5_MODE_FIQ; break;
@@ -131,7 +131,7 @@
 		case 4: return ARMV4_5_MODE_ABT; break;
 		case 5: return ARMV4_5_MODE_UND; break;
 		case 6: return ARMV4_5_MODE_SYS; break;
-		default: 
+		default:
 			LOG_ERROR("mode index out of bounds");
 			return ARMV4_5_MODE_ANY;
 	}
@@ -149,7 +149,7 @@
 
 /* ARM mode instructions
  */
- 
+
 /* Store multiple increment after
  * Rn: base register
  * List: for each bit in list: store register
@@ -239,7 +239,7 @@
  * CRm: second coprocessor operand
  * op2: Second coprocessor opcode
  */
-#define ARMV4_5_MRC(CP, op1, Rd, CRn, CRm, op2) (0xee100010 | (CRm) | ((op2) << 5) | ((CP) << 8) | ((Rd) << 12) | ((CRn) << 16) | ((op1) << 21)) 
+#define ARMV4_5_MRC(CP, op1, Rd, CRn, CRm, op2) (0xee100010 | (CRm) | ((op2) << 5) | ((CP) << 8) | ((Rd) << 12) | ((CRn) << 16) | ((op1) << 21))
 
 /* Move to coprocessor from ARM register
  * CP: Coprocessor number
@@ -249,7 +249,7 @@
  * CRm: second coprocessor operand
  * op2: Second coprocessor opcode
  */
-#define ARMV4_5_MCR(CP, op1, Rd, CRn, CRm, op2) (0xee000010 | (CRm) | ((op2) << 5) | ((CP) << 8) | ((Rd) << 12) | ((CRn) << 16) | ((op1) << 21)) 
+#define ARMV4_5_MCR(CP, op1, Rd, CRn, CRm, op2) (0xee000010 | (CRm) | ((op2) << 5) | ((CP) << 8) | ((Rd) << 12) | ((CRn) << 16) | ((op1) << 21))
 
 /* Breakpoint instruction (ARMv5)
  * Im: 16-bit immediate
@@ -259,7 +259,7 @@
 
 /* Thumb mode instructions
  */
- 
+
 /* Store register (Thumb mode)
  * Rd: source register
  * Rn: base register
@@ -277,12 +277,12 @@
  * List: for each bit in list: store register
  */
 #define ARMV4_5_T_LDMIA(Rn, List) ((0xc800 | ((Rn) << 8) | (List)) | ((0xc800 | ((Rn) << 8) | List) << 16))
- 
+
 /* Load register with PC relative addressing
  * Rd: register to load
  */
-#define ARMV4_5_T_LDR_PCREL(Rd)	((0x4800 | ((Rd) << 8)) | ((0x4800 | ((Rd) << 8)) << 16)) 
- 
+#define ARMV4_5_T_LDR_PCREL(Rd)	((0x4800 | ((Rd) << 8)) | ((0x4800 | ((Rd) << 8)) << 16))
+
 /* Move hi register (Thumb mode)
  * Rd: destination register
  * Rm: source register

Modified: trunk/src/target/armv4_5_cache.c
===================================================================
--- trunk/src/target/armv4_5_cache.c	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/armv4_5_cache.c	2009-05-10 19:02:07 UTC (rev 1690)
@@ -63,7 +63,7 @@
 		M = (cache_type_reg & 0x4) >> 2;
 		len = (cache_type_reg & 0x3);
 		multiplier = 2 + M;
-		
+
 		if ((assoc != 0) || (M != 1)) /* assoc 0 and M 1 means cache absent */
 		{
 			/* cache is present */
@@ -85,7 +85,7 @@
 	{
 		cache->i_size = cache->d_u_size;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -96,21 +96,21 @@
 		command_print(cmd_ctx, "cache not yet identified");
 		return ERROR_OK;
 	}
-		
-	command_print(cmd_ctx, "cache type: 0x%1.1x, %s", armv4_5_cache->ctype, 
+
+	command_print(cmd_ctx, "cache type: 0x%1.1x, %s", armv4_5_cache->ctype,
 		(armv4_5_cache->separate) ? "separate caches" : "unified cache");
 
-	command_print(cmd_ctx, "D-Cache: linelen %i, associativity %i, nsets %i, cachesize 0x%x", 
+	command_print(cmd_ctx, "D-Cache: linelen %i, associativity %i, nsets %i, cachesize 0x%x",
 		armv4_5_cache->d_u_size.linelen,
 		armv4_5_cache->d_u_size.associativity,
 		armv4_5_cache->d_u_size.nsets,
 		armv4_5_cache->d_u_size.cachesize);
 
-	command_print(cmd_ctx, "I-Cache: linelen %i, associativity %i, nsets %i, cachesize 0x%x", 
+	command_print(cmd_ctx, "I-Cache: linelen %i, associativity %i, nsets %i, cachesize 0x%x",
 		armv4_5_cache->i_size.linelen,
 		armv4_5_cache->i_size.associativity,
 		armv4_5_cache->i_size.nsets,
 		armv4_5_cache->i_size.cachesize);
-	
+
 	return ERROR_OK;
 }

Modified: trunk/src/target/armv4_5_mmu.c
===================================================================
--- trunk/src/target/armv4_5_mmu.c	2009-05-10 19:01:03 UTC (rev 1689)
+++ trunk/src/target/armv4_5_mmu.c	2009-05-10 19:02:07 UTC (rev 1690)
@@ -89,9 +89,9 @@
 			(first_lvl_descriptor & 0xfffff000) | ((va & 0x000ffc00) >> 8),
 			4, 1, (u8*)&second_lvl_descriptor);
 	}
-	
+
 	second_lvl_descriptor = target_buffer_get_u32(target, (u8*)&second_lvl_descriptor);
-	
+
 	LOG_DEBUG("2nd lvl desc: %8.8x", second_lvl_descriptor);
 
 	if ((second_lvl_descriptor & 0x3) == 0)
@@ -163,14 +163,14 @@
 
 	/* disable MMU and data (or unified) cache */
 	armv4_5_mmu->disable_mmu_caches(target, 1, 1, 0);
-	
+
 	retval = armv4_5_mmu->write_memory(target, address, size, count, buffer);
 
 	/* reenable MMU / cache */
 	armv4_5_mmu->enable_mmu_caches(target, armv4_5_mmu->mmu_enabled,
 		armv4_5_mmu->armv4_5_cache.d_u_cache_enabled,
 		armv4_5_mmu->armv4_5_cache.i_cache_enabled);
-	
+
 	return retval;
 }
 
@@ -182,7 +182,7 @@
 	u32 cb;
 	int domain;
 	u32 ap;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		command_print(cmd_ctx, "target must be stopped for \"virt2phys\" command");
@@ -211,11 +211,11 @@
 			}
 			return ERROR_OK;
 		}
-	
+
 		command_print(cmd_ctx, "0x%8.8x -> 0x%8.8x, type: %s, cb: %i, domain: %i, ap: %2.2x",
 			va, pa, armv4_5_mmu_page_type_names[type], cb, domain, ap);
-	}			
-	
+	}
+
 	return ERROR_OK;
 }
 
@@ -272,7 +272,7 @@
 				break;
 			case ERROR_TARGET_NOT_HALTED:
 				command_print(cmd_ctx, "error: target must be halted for memory accesses");
-				break;			
+				break;
 			case ERROR_TARGET_DATA_ABORT:
 				command_print(cmd_ctx, "error: access caused data abort, system possibly corrupted");
 				break;
@@ -287,7 +287,7 @@
 	{
 		if (i%8 == 0)
 			output_len += snprintf(output + output_len, 128 - output_len, "0x%8.8x: ", address + (i*size));
-		
+
 		switch (size)
 		{
 			case 4:
@@ -309,7 +309,7 @@
 	}
 
 	free(buffer);
-	
+
 	return ERROR_OK;
 }
 
@@ -365,7 +365,7 @@
 			break;
 		default:
 			command_print(cmd_ctx, "error: unknown error");
-	}	
+	}
 
 	return ERROR_OK;
 }



From zwelch at mail.berlios.de  Sun May 10 21:44:49 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 10 May 2009 21:44:49 +0200
Subject: [Openocd-svn] r1691 - in trunk/src: . helper
Message-ID: <200905101944.n4AJinV0022815@sheep.berlios.de>

Author: zwelch
Date: 2009-05-10 21:44:38 +0200 (Sun, 10 May 2009)
New Revision: 1691

Added:
   trunk/src/helper/tclapi.c
   trunk/src/helper/tclapi.h
Modified:
   trunk/src/helper/Makefile.am
   trunk/src/openocd.c
Log:

Revive tclapi.c from r1650:
* Remove superfluous #include directives.
* Fix warnings and API usage to cure its bit rot.
* Build into libhelper library (for now).
Add tclapi.h to export tclapi_register_commands().
Register tclapi commands in openocd.c:setup_command_handler().



Modified: trunk/src/helper/Makefile.am
===================================================================
--- trunk/src/helper/Makefile.am	2009-05-10 19:02:07 UTC (rev 1690)
+++ trunk/src/helper/Makefile.am	2009-05-10 19:44:38 UTC (rev 1691)
@@ -15,7 +15,9 @@
 
 
 
-libhelper_a_SOURCES = binarybuffer.c $(CONFIGFILES) configuration.c log.c command.c time_support.c \
+libhelper_a_SOURCES = \
+	binarybuffer.c $(CONFIGFILES) configuration.c \
+	log.c command.c time_support.c tclapi.c \
 	replacements.c fileio.c startup_tcl.c
 
 if IOUTIL

Copied: trunk/src/helper/tclapi.c (from rev 1650, trunk/src/helper/tclapi.c)
===================================================================
--- trunk/src/helper/tclapi.c	2009-05-07 20:19:04 UTC (rev 1650)
+++ trunk/src/helper/tclapi.c	2009-05-10 19:44:38 UTC (rev 1691)
@@ -0,0 +1,516 @@
+/***************************************************************************
+ *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2008 Duane Ellis                                        *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "tclapi.h"
+#include "../target/target.h"
+#include "../jtag/jtag.h"
+#include "../flash/flash.h"
+
+#include <string.h>
+
+
+static int new_int_array_element(Jim_Interp * interp, const char *varname, int idx, u32 val)
+{
+	char *namebuf;
+	Jim_Obj *nameObjPtr, *valObjPtr;
+	int result;
+
+	namebuf = alloc_printf("%s(%d)", varname, idx);
+	if (!namebuf)
+		return JIM_ERR;
+
+	nameObjPtr = Jim_NewStringObj(interp, namebuf, -1);
+	valObjPtr = Jim_NewIntObj(interp, val);
+	if (!nameObjPtr || !valObjPtr)
+	{
+		free(namebuf);
+		return JIM_ERR;
+	}
+
+	Jim_IncrRefCount(nameObjPtr);
+	Jim_IncrRefCount(valObjPtr);
+	result = Jim_SetVariable(interp, nameObjPtr, valObjPtr);
+	Jim_DecrRefCount(interp, nameObjPtr);
+	Jim_DecrRefCount(interp, valObjPtr);
+	free(namebuf);
+	/* printf("%s(%d) <= 0%08x\n", varname, idx, val); */
+	return result;
+}
+
+static int jim_mem2array(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
+{
+	target_t *target;
+	command_context_t *context;
+	long l;
+	u32 width;
+	int len;
+	u32 addr;
+	unsigned count;
+	u32 v;
+	const char *varname;
+	u8 buffer[4096];
+	unsigned i, n;
+	int e, retval;
+
+	/* argv[1] = name of array to receive the data
+	 * argv[2] = desired width
+	 * argv[3] = memory address
+	 * argv[4] = count of times to read
+	 */
+	if (argc != 5) {
+		Jim_WrongNumArgs(interp, 1, argv, "varname width addr nelems");
+		return JIM_ERR;
+	}
+	varname = Jim_GetString(argv[1], &len);
+	/* given "foo" get space for worse case "foo(%d)" .. add 20 */
+
+	e = Jim_GetLong(interp, argv[2], &l);
+	width = l;
+	if (e != JIM_OK) {
+		return e;
+	}
+
+	e = Jim_GetLong(interp, argv[3], &l);
+	addr = l;
+	if (e != JIM_OK) {
+		return e;
+	}
+	e = Jim_GetLong(interp, argv[4], &l);
+	len = l;
+	if (e != JIM_OK) {
+		return e;
+	}
+	switch (width) {
+		case 8:
+			width = 1;
+			break;
+		case 16:
+			width = 2;
+			break;
+		case 32:
+			width = 4;
+			break;
+		default:
+			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+			Jim_AppendStrings( interp, Jim_GetResult(interp), "Invalid width param, must be 8/16/32", NULL );
+			return JIM_ERR;
+	}
+	if (len == 0) {
+		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+		Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: zero width read?", NULL);
+		return JIM_ERR;
+	}
+	if ((addr + (len * width)) < addr) {
+		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+		Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: addr + len - wraps to zero?", NULL);
+		return JIM_ERR;
+	}
+	/* absurd transfer size? */
+	if (len > 65536) {
+		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+		Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: absurd > 64K item request", NULL);
+		return JIM_ERR;
+	}
+
+	if ((width == 1) ||
+		((width == 2) && ((addr & 1) == 0)) ||
+		((width == 4) && ((addr & 3) == 0))) {
+		/* all is well */
+	} else {
+		char buf[100];
+		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+		sprintf(buf, "mem2array address: 0x%08x is not aligned for %d byte reads", addr, width);
+		Jim_AppendStrings(interp, Jim_GetResult(interp), buf , NULL);
+		return JIM_ERR;
+	}
+
+	context = Jim_GetAssocData(interp, "context");
+	if (context == NULL)
+	{
+		LOG_ERROR("mem2array: no command context");
+		return JIM_ERR;
+	}
+	target = get_current_target(context);
+	if (target == NULL)
+	{
+		LOG_ERROR("mem2array: no current target");
+		return JIM_ERR;
+	}
+
+	/* Transfer loop */
+
+	/* index counter */
+	n = 0;
+	/* assume ok */
+	e = JIM_OK;
+	while (len) {
+		/* Slurp... in buffer size chunks */
+
+		count = len; /* in objects.. */
+		if (count > (sizeof(buffer)/width)) {
+			count = (sizeof(buffer)/width);
+		}
+
+		retval = target->type->read_memory( target, addr, width, count, buffer );
+		if (retval != ERROR_OK) {
+			/* BOO !*/
+			LOG_ERROR("mem2array: Read @ 0x%08x, w=%d, cnt=%d, failed", addr, width, count);
+			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+			Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: cannot read memory", NULL);
+			e = JIM_ERR;
+			len = 0;
+		} else {
+			v = 0; /* shut up gcc */
+			for (i = 0 ;i < count ;i++, n++) {
+				switch (width) {
+					case 4:
+						v = target_buffer_get_u32(target, &buffer[i*width]);
+						break;
+					case 2:
+						v = target_buffer_get_u16(target, &buffer[i*width]);
+						break;
+					case 1:
+						v = buffer[i] & 0x0ff;
+						break;
+				}
+				new_int_array_element(interp, varname, n, v);
+			}
+			len -= count;
+		}
+	}
+
+	Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+
+	return JIM_OK;
+}
+
+static int get_int_array_element(Jim_Interp * interp, const char *varname, int idx, u32 *val)
+{
+	char *namebuf;
+	Jim_Obj *nameObjPtr, *valObjPtr;
+	int result;
+	long l;
+
+	namebuf = alloc_printf("%s(%d)", varname, idx);
+	if (!namebuf)
+		return JIM_ERR;
+
+	nameObjPtr = Jim_NewStringObj(interp, namebuf, -1);
+	if (!nameObjPtr)
+	{
+		free(namebuf);
+		return JIM_ERR;
+	}
+
+	Jim_IncrRefCount(nameObjPtr);
+	valObjPtr = Jim_GetVariable(interp, nameObjPtr, JIM_ERRMSG);
+	Jim_DecrRefCount(interp, nameObjPtr);
+	free(namebuf);
+	if (valObjPtr == NULL)
+		return JIM_ERR;
+
+	result = Jim_GetLong(interp, valObjPtr, &l);
+	/* printf("%s(%d) => 0%08x\n", varname, idx, val); */
+	*val = l;
+	return result;
+}
+
+static int jim_array2mem(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
+{
+	target_t *target;
+	command_context_t *context;
+	long l;
+	u32 width;
+	int len;
+	u32 addr;
+	u32 count;
+	u32 v;
+	const char *varname;
+	u8 buffer[4096];
+	int  n, e, retval;
+
+	/* argv[1] = name of array to get the data
+	 * argv[2] = desired width
+	 * argv[3] = memory address
+	 * argv[4] = count to write
+	 */
+	if (argc != 5) {
+		Jim_WrongNumArgs(interp, 1, argv, "varname width addr nelems");
+		return JIM_ERR;
+	}
+	varname = Jim_GetString(argv[1], &len);
+	/* given "foo" get space for worse case "foo(%d)" .. add 20 */
+
+	e = Jim_GetLong(interp, argv[2], &l);
+	width = l;
+	if (e != JIM_OK) {
+		return e;
+	}
+
+	e = Jim_GetLong(interp, argv[3], &l);
+	addr = l;
+	if (e != JIM_OK) {
+		return e;
+	}
+	e = Jim_GetLong(interp, argv[4], &l);
+	len = l;
+	if (e != JIM_OK) {
+		return e;
+	}
+	switch (width) {
+		case 8:
+			width = 1;
+			break;
+		case 16:
+			width = 2;
+			break;
+		case 32:
+			width = 4;
+			break;
+		default:
+			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+			Jim_AppendStrings( interp, Jim_GetResult(interp), "Invalid width param, must be 8/16/32", NULL );
+			return JIM_ERR;
+	}
+	if (len == 0) {
+		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+		Jim_AppendStrings(interp, Jim_GetResult(interp), "array2mem: zero width read?", NULL);
+		return JIM_ERR;
+	}
+	if ((addr + (len * width)) < addr) {
+		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+		Jim_AppendStrings(interp, Jim_GetResult(interp), "array2mem: addr + len - wraps to zero?", NULL);
+		return JIM_ERR;
+	}
+	/* absurd transfer size? */
+	if (len > 65536) {
+		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+		Jim_AppendStrings(interp, Jim_GetResult(interp), "array2mem: absurd > 64K item request", NULL);
+		return JIM_ERR;
+	}
+
+	if ((width == 1) ||
+		((width == 2) && ((addr & 1) == 0)) ||
+		((width == 4) && ((addr & 3) == 0))) {
+		/* all is well */
+	} else {
+		char buf[100];
+		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+		sprintf(buf, "array2mem address: 0x%08x is not aligned for %d byte reads", addr, width);
+		Jim_AppendStrings(interp, Jim_GetResult(interp), buf , NULL);
+		return JIM_ERR;
+	}
+
+	context = Jim_GetAssocData(interp, "context");
+	if (context == NULL)
+	{
+		LOG_ERROR("array2mem: no command context");
+		return JIM_ERR;
+	}
+	target = get_current_target(context);
+	if (target == NULL)
+	{
+		LOG_ERROR("array2mem: no current target");
+		return JIM_ERR;
+	}
+
+	/* Transfer loop */
+
+	/* index counter */
+	n = 0;
+	/* assume ok */
+	e = JIM_OK;
+	while (len) {
+		/* Slurp... in buffer size chunks */
+
+		count = len; /* in objects.. */
+		if (count > (sizeof(buffer)/width)) {
+			count = (sizeof(buffer)/width);
+		}
+
+		v = 0; /* shut up gcc */
+		for (unsigned i = 0 ;i < count ;i++, n++) {
+			get_int_array_element(interp, varname, n, &v);
+			switch (width) {
+			case 4:
+				target_buffer_set_u32(target, &buffer[i*width], v);
+				break;
+			case 2:
+				target_buffer_set_u16(target, &buffer[i*width], v);
+				break;
+			case 1:
+				buffer[i] = v & 0x0ff;
+				break;
+			}
+		}
+		len -= count;
+
+		retval = target->type->write_memory(target, addr, width, count, buffer);
+		if (retval != ERROR_OK) {
+			/* BOO !*/
+			LOG_ERROR("array2mem: Write @ 0x%08x, w=%d, cnt=%d, failed", addr, width, count);
+			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+			Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: cannot read memory", NULL);
+			e = JIM_ERR;
+			len = 0;
+		}
+	}
+
+	Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+
+	return JIM_OK;
+}
+
+int Jim_Command_drscan(Jim_Interp *interp, int argc, Jim_Obj *const *args)
+{
+	int retval;
+	scan_field_t *fields;
+	int num_fields;
+	int field_count = 0;
+	int i, e;
+	long device;
+
+	/* args[1] = device
+	 * args[2] = num_bits
+	 * args[3] = hex string
+	 * ... repeat num bits and hex string ...
+	 */
+	if ((argc < 4) || ((argc % 2)!=0))
+	{
+		Jim_WrongNumArgs(interp, 1, args, "<device> <num_bits1> <value1> <num_bits2> <value2> ...");
+		return JIM_ERR;
+	}
+
+	for (i = 2; i < argc; i+=2)
+	{
+		long bits;
+
+		e = Jim_GetLong(interp, args[i], &bits);
+		if (e != JIM_OK)
+			return e;
+	}
+
+	e = Jim_GetLong(interp, args[1], &device);
+	if (e != JIM_OK)
+		return e;
+
+	num_fields=(argc-2)/2;
+	fields = malloc(sizeof(scan_field_t) * num_fields);
+	for (i = 2; i < argc; i+=2)
+	{
+		long bits;
+		int len;
+		const char *str;
+
+		Jim_GetLong(interp, args[i], &bits);
+		str = Jim_GetString(args[i+1], &len);
+
+		fields[field_count].num_bits = bits;
+		fields[field_count].out_value = malloc(CEIL(bits, 8));
+		str_to_buf(str, len, fields[field_count].out_value, bits, 0);
+		fields[field_count].in_value = fields[field_count].out_value;
+	}
+
+	jtag_add_dr_scan(num_fields, fields, TAP_INVALID);
+	retval = jtag_execute_queue();
+	if (retval != ERROR_OK)
+	{
+		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
+		Jim_AppendStrings(interp, Jim_GetResult(interp), "drscan: jtag execute failed", NULL);
+		return JIM_ERR;
+	}
+
+	field_count=0;
+	Jim_Obj *list = Jim_NewListObj(interp, NULL, 0);
+	for (i = 2; i < argc; i+=2)
+	{
+		long bits;
+		char *str;
+
+		Jim_GetLong(interp, args[i], &bits);
+		str = buf_to_str(fields[field_count].in_value, bits, 16);
+		free(fields[field_count].out_value);
+
+		Jim_ListAppendElement(interp, list, Jim_NewStringObj(interp, str, strlen(str)));
+		free(str);
+		field_count++;
+	}
+
+	Jim_SetResult(interp, list);
+
+	free(fields);
+
+	return JIM_OK;
+}
+
+static int jim_flash_banks(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
+{
+
+	if (argc != 1) {
+		Jim_WrongNumArgs(interp, 1, argv, "no arguments to flash_banks command");
+		return JIM_ERR;
+	}
+
+	unsigned flash_banks = flash_get_bank_count();
+	if (!flash_banks)
+	{
+		return JIM_ERR;
+	}
+
+	Jim_Obj *list=Jim_NewListObj(interp, NULL, 0);
+	for (unsigned i = 0; i < flash_banks; i++)
+	{
+		flash_bank_t *p = get_flash_bank_by_num(i);
+		Jim_Obj *elem=Jim_NewListObj(interp, NULL, 0);
+
+		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "name", -1));
+		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, p->driver->name, -1));
+		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "base", -1));
+		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->base));
+		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "size", -1));
+		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->size));
+		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "bus_width", -1));
+		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->bus_width));
+		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "chip_width", -1));
+		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->chip_width));
+
+		Jim_ListAppendElement(interp, list, elem);
+	}
+
+	Jim_SetResult(interp, list);
+
+	return JIM_OK;
+}
+
+int tclapi_register_commands(struct command_context_s *cmd_ctx)
+{
+	register_jim(cmd_ctx, "ocd_mem2array", &jim_mem2array,
+		"read memory and return as a TCL array for script processing");
+	register_jim(cmd_ctx, "ocd_array2mem", &jim_array2mem,
+		"convert a TCL array to memory locations and write the values");
+	register_jim(cmd_ctx, "drscan", &Jim_Command_drscan,
+		"execute DR scan <device> <num_bits> <value> <num_bits1> <value2> ...");
+	register_jim(cmd_ctx, "ocd_flash_banks", &jim_flash_banks,
+		"return information about the flash banks");
+	return ERROR_OK;
+}

Added: trunk/src/helper/tclapi.h
===================================================================
--- trunk/src/helper/tclapi.h	2009-05-10 19:02:07 UTC (rev 1690)
+++ trunk/src/helper/tclapi.h	2009-05-10 19:44:38 UTC (rev 1691)
@@ -0,0 +1,26 @@
+/***************************************************************************
+ *   Copyright (C) 2009 by Zachary T Welch <zw at superlucidity.net>          *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+#ifndef TCLAPI_H
+#define TCLAPI_H
+
+#include "command.h"
+
+int tclapi_register_commands(struct command_context_s *ctx);
+
+#endif // TCLAPI_H

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-05-10 19:02:07 UTC (rev 1690)
+++ trunk/src/openocd.c	2009-05-10 19:44:38 UTC (rev 1691)
@@ -41,6 +41,7 @@
 #include "mflash.h"
 
 #include "command.h"
+#include "tclapi.h"
 #include "server.h"
 #include "telnet_server.h"
 #include "gdb_server.h"
@@ -202,6 +203,7 @@
 	telnet_register_commands(cmd_ctx);
 	gdb_register_commands(cmd_ctx);
 	tcl_register_commands(cmd_ctx); /* tcl server commands */
+	tclapi_register_commands(cmd_ctx); /* misc tcl commands */
 	log_register_commands(cmd_ctx);
 	jtag_register_commands(cmd_ctx);
 	xsvf_register_commands(cmd_ctx);



From oharboe at mail.berlios.de  Sun May 10 21:48:11 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 10 May 2009 21:48:11 +0200
Subject: [Openocd-svn] r1692 - trunk/src/jtag zy1000/trunk/build/include
Message-ID: <200905101948.n4AJmBuK023342@sheep.berlios.de>

Author: oharboe
Date: 2009-05-10 21:48:09 +0200 (Sun, 10 May 2009)
New Revision: 1692

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   zy1000/trunk/build/include/jtag_minidriver.h
Log:
Wrote up post processing JTAG API. Not used yet, but reference implementation will be used in subsequent explanations of new scheme + patches to use it.

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-10 19:44:38 UTC (rev 1691)
+++ trunk/src/jtag/jtag.c	2009-05-10 19:48:09 UTC (rev 1692)
@@ -76,6 +76,24 @@
 int jtag_trst = 0;
 int jtag_srst = 0;
 
+#ifndef HAVE_JTAG_MINIDRIVER_H
+struct jtag_callback_entry
+{
+	struct jtag_callback_entry *next;
+
+	jtag_callback_t callback;
+	u8 *in;
+	jtag_callback_data_t data1;
+	jtag_callback_data_t data2;
+
+};
+
+
+static struct jtag_callback_entry *jtag_callback_queue_head = NULL;
+static struct jtag_callback_entry *jtag_callback_queue_tail = NULL;
+#endif
+
+
 jtag_command_t *jtag_command_queue = NULL;
 jtag_command_t **last_comand_pointer = &jtag_command_queue;
 static jtag_tap_t *jtag_all_taps = NULL;
@@ -1434,8 +1452,47 @@
 	return type;
 }
 
-int MINIDRIVER(interface_jtag_execute_queue)(void)
+
+#ifndef HAVE_JTAG_MINIDRIVER_H
+/* add callback to end of queue */
+void jtag_add_callback3(jtag_callback_t callback, u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2)
 {
+	struct jtag_callback_entry *entry=cmd_queue_alloc(sizeof(struct jtag_callback_entry));
+
+	entry->next=NULL;
+	entry->callback=callback;
+	entry->in=in;
+	entry->data1=data1;
+	entry->data2=data2;
+
+	if (jtag_callback_queue_head==NULL)
+	{
+		jtag_callback_queue_head=entry;
+		jtag_callback_queue_tail=entry;
+	} else
+	{
+		jtag_callback_queue_tail->next=entry;
+		jtag_callback_queue_tail=entry;
+	}
+}
+
+
+static int jtag_convert_to_callback3(u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2)
+{
+	((jtag_callback1_t)data1)(in);
+	return ERROR_OK;
+}
+
+void jtag_add_callback(jtag_callback1_t callback, u8 *in)
+{
+	jtag_add_callback3(jtag_convert_to_callback3, in, (jtag_callback_data_t)callback, 0);
+}
+#endif
+
+#ifndef HAVE_JTAG_MINIDRIVER_H
+
+int interface_jtag_execute_queue(void)
+{
 	int retval;
 
 	if (jtag==NULL)
@@ -1446,13 +1503,28 @@
 
 	retval = jtag->execute_queue();
 
+	if (retval == ERROR_OK)
+	{
+		struct jtag_callback_entry *entry;
+		for (entry=jtag_callback_queue_head; entry!=NULL; entry=entry->next)
+		{
+			retval=entry->callback(entry->in, entry->data1, entry->data2);
+			if (retval!=ERROR_OK)
+				break;
+		}
+	}
+
 	cmd_queue_free();
 
+	jtag_callback_queue_head = NULL;
+	jtag_callback_queue_tail = NULL;
+
 	jtag_command_queue = NULL;
 	last_comand_pointer = &jtag_command_queue;
 
 	return retval;
 }
+#endif
 
 void jtag_execute_queue_noclear(void)
 {

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-10 19:44:38 UTC (rev 1691)
+++ trunk/src/jtag/jtag.h	2009-05-10 19:48:09 UTC (rev 1692)
@@ -568,6 +568,70 @@
 extern void jtag_add_plain_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern int  interface_jtag_add_plain_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 
+
+/* Simplest/typical callback - do some conversion on the data clocked in.
+ * This callback is for such conversion that can not fail.
+ * For conversion types or checks that can
+ * fail, use the jtag_callback_t variant */
+typedef void (*jtag_callback1_t)(u8 *in);
+
+#ifndef HAVE_JTAG_MINIDRIVER_H
+/* A simpler version of jtag_add_callback3 */
+extern void jtag_add_callback(jtag_callback1_t, u8 *in);
+#else
+/* implemented by minidriver */
+#endif
+
+/* This type can store an integer safely by a normal cast on 64 and
+ * 32 bit systems. */
+typedef void *jtag_callback_data_t;
+
+/* The generic callback mechanism.
+ *
+ * The callback is invoked with three arguments. The first argument is
+ * the pointer to the data clocked in.
+ */
+typedef int (*jtag_callback_t)(u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2);
+
+
+/* This callback can be executed immediately the queue has been flushed. Note that
+ * the JTAG queue can either be executed synchronously or asynchronously. Typically
+ * for USB the queue is executed asynchronously. For low latency interfaces, the
+ * queue may be executed synchronously.
+ *
+ * These callbacks are typically executed *after* the *entire* JTAG queue has been
+ * executed for e.g. USB interfaces.
+ *
+ * The callbacks are guaranteeed to be invoked in the order that they were queued.
+ *
+ * The strange name is due to C's lack of overloading using function arguments
+ *
+ * The callback mechansim is very general and does not really make any assumptions
+ * about what the callback does and what the arguments are.
+ *
+ * in - typically used to point to the data to operate on. More often than not
+ * this will be the data clocked in during a shift operation
+ *
+ * data1 - an integer that is big enough to be used either as an 'int' or
+ * cast to/from a pointer
+ *
+ * data2 - an integer that is big enough to be used either as an 'int' or
+ * cast to/from a pointer
+ *
+ * Why stop at 'data2' for arguments? Somewhat historical reasons. This is
+ * sufficient to implement the jtag_check_value_mask(), besides the
+ * line is best drawn somewhere...
+ *
+ * If the execution of the queue fails before the callbacks, then the
+ * callbacks may or may not be invoked depending on driver implementation.
+ */
+#ifndef HAVE_JTAG_MINIDRIVER_H
+extern void jtag_add_callback3(jtag_callback_t, u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2);
+#else
+/* implemented by minidriver */
+#endif
+
+
 /* run a TAP_RESET reset. End state is TAP_RESET, regardless
  * of start state.
  */

Modified: zy1000/trunk/build/include/jtag_minidriver.h
===================================================================
--- zy1000/trunk/build/include/jtag_minidriver.h	2009-05-10 19:44:38 UTC (rev 1691)
+++ zy1000/trunk/build/include/jtag_minidriver.h	2009-05-10 19:48:09 UTC (rev 1692)
@@ -208,3 +208,6 @@
 	}
 }
 
+#define jtag_add_callback(callback, in) callback(in)
+
+#define jtag_add_callback3(callback, in, data1, data2) jtag_set_error(callback(in, data1, data2))



From zwelch at mail.berlios.de  Sun May 10 22:10:15 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 10 May 2009 22:10:15 +0200
Subject: [Openocd-svn] r1693 - trunk
Message-ID: <200905102010.n4AKAFD3026760@sheep.berlios.de>

Author: zwelch
Date: 2009-05-10 22:10:11 +0200 (Sun, 10 May 2009)
New Revision: 1693

Modified:
   trunk/configure.in
Log:
Extend configure script to check for environ declaration in stdlib.h.

Patch contributed by Martin Thomas <mthomas at rhrk.uni-kl.de>.


Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-10 19:48:09 UTC (rev 1692)
+++ trunk/configure.in	2009-05-10 20:10:11 UTC (rev 1693)
@@ -788,11 +788,12 @@
 AM_PROG_CC_C_O
 AC_PROG_RANLIB
 
-# Look for environ alternatives.  Possibility #1: is environ in unistd.h?
-AC_MSG_CHECKING([for environ in unistd.h])
+# Look for environ alternatives.  Possibility #1: is environ in unistd.h or stdlib.h?
+AC_MSG_CHECKING([for environ in unistd.h and stdlib.h])
 AC_COMPILE_IFELSE([
 #define _GNU_SOURCE
 #include <unistd.h>
+#include <stdlib.h>
 int main(int argc, char **argv) { char **ep = environ; }
   ], [
     AC_MSG_RESULT([yes])



From zwelch at mail.berlios.de  Sun May 10 23:33:58 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 10 May 2009 23:33:58 +0200
Subject: [Openocd-svn] r1694 - in trunk/src: . helper
Message-ID: <200905102133.n4ALXwi6007341@sheep.berlios.de>

Author: zwelch
Date: 2009-05-10 23:33:53 +0200 (Sun, 10 May 2009)
New Revision: 1694

Removed:
   trunk/src/helper/tclapi.c
   trunk/src/helper/tclapi.h
Modified:
   trunk/src/helper/Makefile.am
   trunk/src/openocd.c
Log:
Reverse revision 1691: all of its functionality has migrated elsewhere.

Modified: trunk/src/helper/Makefile.am
===================================================================
--- trunk/src/helper/Makefile.am	2009-05-10 20:10:11 UTC (rev 1693)
+++ trunk/src/helper/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
@@ -17,7 +17,7 @@
 
 libhelper_a_SOURCES = \
 	binarybuffer.c $(CONFIGFILES) configuration.c \
-	log.c command.c time_support.c tclapi.c \
+	log.c command.c time_support.c \
 	replacements.c fileio.c startup_tcl.c
 
 if IOUTIL

Deleted: trunk/src/helper/tclapi.c
===================================================================
--- trunk/src/helper/tclapi.c	2009-05-10 20:10:11 UTC (rev 1693)
+++ trunk/src/helper/tclapi.c	2009-05-10 21:33:53 UTC (rev 1694)
@@ -1,516 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
- *   Copyright (C) 2008 Duane Ellis                                        *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
-#include "tclapi.h"
-#include "../target/target.h"
-#include "../jtag/jtag.h"
-#include "../flash/flash.h"
-
-#include <string.h>
-
-
-static int new_int_array_element(Jim_Interp * interp, const char *varname, int idx, u32 val)
-{
-	char *namebuf;
-	Jim_Obj *nameObjPtr, *valObjPtr;
-	int result;
-
-	namebuf = alloc_printf("%s(%d)", varname, idx);
-	if (!namebuf)
-		return JIM_ERR;
-
-	nameObjPtr = Jim_NewStringObj(interp, namebuf, -1);
-	valObjPtr = Jim_NewIntObj(interp, val);
-	if (!nameObjPtr || !valObjPtr)
-	{
-		free(namebuf);
-		return JIM_ERR;
-	}
-
-	Jim_IncrRefCount(nameObjPtr);
-	Jim_IncrRefCount(valObjPtr);
-	result = Jim_SetVariable(interp, nameObjPtr, valObjPtr);
-	Jim_DecrRefCount(interp, nameObjPtr);
-	Jim_DecrRefCount(interp, valObjPtr);
-	free(namebuf);
-	/* printf("%s(%d) <= 0%08x\n", varname, idx, val); */
-	return result;
-}
-
-static int jim_mem2array(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
-{
-	target_t *target;
-	command_context_t *context;
-	long l;
-	u32 width;
-	int len;
-	u32 addr;
-	unsigned count;
-	u32 v;
-	const char *varname;
-	u8 buffer[4096];
-	unsigned i, n;
-	int e, retval;
-
-	/* argv[1] = name of array to receive the data
-	 * argv[2] = desired width
-	 * argv[3] = memory address
-	 * argv[4] = count of times to read
-	 */
-	if (argc != 5) {
-		Jim_WrongNumArgs(interp, 1, argv, "varname width addr nelems");
-		return JIM_ERR;
-	}
-	varname = Jim_GetString(argv[1], &len);
-	/* given "foo" get space for worse case "foo(%d)" .. add 20 */
-
-	e = Jim_GetLong(interp, argv[2], &l);
-	width = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-
-	e = Jim_GetLong(interp, argv[3], &l);
-	addr = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-	e = Jim_GetLong(interp, argv[4], &l);
-	len = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-	switch (width) {
-		case 8:
-			width = 1;
-			break;
-		case 16:
-			width = 2;
-			break;
-		case 32:
-			width = 4;
-			break;
-		default:
-			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-			Jim_AppendStrings( interp, Jim_GetResult(interp), "Invalid width param, must be 8/16/32", NULL );
-			return JIM_ERR;
-	}
-	if (len == 0) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: zero width read?", NULL);
-		return JIM_ERR;
-	}
-	if ((addr + (len * width)) < addr) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: addr + len - wraps to zero?", NULL);
-		return JIM_ERR;
-	}
-	/* absurd transfer size? */
-	if (len > 65536) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: absurd > 64K item request", NULL);
-		return JIM_ERR;
-	}
-
-	if ((width == 1) ||
-		((width == 2) && ((addr & 1) == 0)) ||
-		((width == 4) && ((addr & 3) == 0))) {
-		/* all is well */
-	} else {
-		char buf[100];
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		sprintf(buf, "mem2array address: 0x%08x is not aligned for %d byte reads", addr, width);
-		Jim_AppendStrings(interp, Jim_GetResult(interp), buf , NULL);
-		return JIM_ERR;
-	}
-
-	context = Jim_GetAssocData(interp, "context");
-	if (context == NULL)
-	{
-		LOG_ERROR("mem2array: no command context");
-		return JIM_ERR;
-	}
-	target = get_current_target(context);
-	if (target == NULL)
-	{
-		LOG_ERROR("mem2array: no current target");
-		return JIM_ERR;
-	}
-
-	/* Transfer loop */
-
-	/* index counter */
-	n = 0;
-	/* assume ok */
-	e = JIM_OK;
-	while (len) {
-		/* Slurp... in buffer size chunks */
-
-		count = len; /* in objects.. */
-		if (count > (sizeof(buffer)/width)) {
-			count = (sizeof(buffer)/width);
-		}
-
-		retval = target->type->read_memory( target, addr, width, count, buffer );
-		if (retval != ERROR_OK) {
-			/* BOO !*/
-			LOG_ERROR("mem2array: Read @ 0x%08x, w=%d, cnt=%d, failed", addr, width, count);
-			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-			Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: cannot read memory", NULL);
-			e = JIM_ERR;
-			len = 0;
-		} else {
-			v = 0; /* shut up gcc */
-			for (i = 0 ;i < count ;i++, n++) {
-				switch (width) {
-					case 4:
-						v = target_buffer_get_u32(target, &buffer[i*width]);
-						break;
-					case 2:
-						v = target_buffer_get_u16(target, &buffer[i*width]);
-						break;
-					case 1:
-						v = buffer[i] & 0x0ff;
-						break;
-				}
-				new_int_array_element(interp, varname, n, v);
-			}
-			len -= count;
-		}
-	}
-
-	Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-
-	return JIM_OK;
-}
-
-static int get_int_array_element(Jim_Interp * interp, const char *varname, int idx, u32 *val)
-{
-	char *namebuf;
-	Jim_Obj *nameObjPtr, *valObjPtr;
-	int result;
-	long l;
-
-	namebuf = alloc_printf("%s(%d)", varname, idx);
-	if (!namebuf)
-		return JIM_ERR;
-
-	nameObjPtr = Jim_NewStringObj(interp, namebuf, -1);
-	if (!nameObjPtr)
-	{
-		free(namebuf);
-		return JIM_ERR;
-	}
-
-	Jim_IncrRefCount(nameObjPtr);
-	valObjPtr = Jim_GetVariable(interp, nameObjPtr, JIM_ERRMSG);
-	Jim_DecrRefCount(interp, nameObjPtr);
-	free(namebuf);
-	if (valObjPtr == NULL)
-		return JIM_ERR;
-
-	result = Jim_GetLong(interp, valObjPtr, &l);
-	/* printf("%s(%d) => 0%08x\n", varname, idx, val); */
-	*val = l;
-	return result;
-}
-
-static int jim_array2mem(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
-{
-	target_t *target;
-	command_context_t *context;
-	long l;
-	u32 width;
-	int len;
-	u32 addr;
-	u32 count;
-	u32 v;
-	const char *varname;
-	u8 buffer[4096];
-	int  n, e, retval;
-
-	/* argv[1] = name of array to get the data
-	 * argv[2] = desired width
-	 * argv[3] = memory address
-	 * argv[4] = count to write
-	 */
-	if (argc != 5) {
-		Jim_WrongNumArgs(interp, 1, argv, "varname width addr nelems");
-		return JIM_ERR;
-	}
-	varname = Jim_GetString(argv[1], &len);
-	/* given "foo" get space for worse case "foo(%d)" .. add 20 */
-
-	e = Jim_GetLong(interp, argv[2], &l);
-	width = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-
-	e = Jim_GetLong(interp, argv[3], &l);
-	addr = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-	e = Jim_GetLong(interp, argv[4], &l);
-	len = l;
-	if (e != JIM_OK) {
-		return e;
-	}
-	switch (width) {
-		case 8:
-			width = 1;
-			break;
-		case 16:
-			width = 2;
-			break;
-		case 32:
-			width = 4;
-			break;
-		default:
-			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-			Jim_AppendStrings( interp, Jim_GetResult(interp), "Invalid width param, must be 8/16/32", NULL );
-			return JIM_ERR;
-	}
-	if (len == 0) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "array2mem: zero width read?", NULL);
-		return JIM_ERR;
-	}
-	if ((addr + (len * width)) < addr) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "array2mem: addr + len - wraps to zero?", NULL);
-		return JIM_ERR;
-	}
-	/* absurd transfer size? */
-	if (len > 65536) {
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "array2mem: absurd > 64K item request", NULL);
-		return JIM_ERR;
-	}
-
-	if ((width == 1) ||
-		((width == 2) && ((addr & 1) == 0)) ||
-		((width == 4) && ((addr & 3) == 0))) {
-		/* all is well */
-	} else {
-		char buf[100];
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		sprintf(buf, "array2mem address: 0x%08x is not aligned for %d byte reads", addr, width);
-		Jim_AppendStrings(interp, Jim_GetResult(interp), buf , NULL);
-		return JIM_ERR;
-	}
-
-	context = Jim_GetAssocData(interp, "context");
-	if (context == NULL)
-	{
-		LOG_ERROR("array2mem: no command context");
-		return JIM_ERR;
-	}
-	target = get_current_target(context);
-	if (target == NULL)
-	{
-		LOG_ERROR("array2mem: no current target");
-		return JIM_ERR;
-	}
-
-	/* Transfer loop */
-
-	/* index counter */
-	n = 0;
-	/* assume ok */
-	e = JIM_OK;
-	while (len) {
-		/* Slurp... in buffer size chunks */
-
-		count = len; /* in objects.. */
-		if (count > (sizeof(buffer)/width)) {
-			count = (sizeof(buffer)/width);
-		}
-
-		v = 0; /* shut up gcc */
-		for (unsigned i = 0 ;i < count ;i++, n++) {
-			get_int_array_element(interp, varname, n, &v);
-			switch (width) {
-			case 4:
-				target_buffer_set_u32(target, &buffer[i*width], v);
-				break;
-			case 2:
-				target_buffer_set_u16(target, &buffer[i*width], v);
-				break;
-			case 1:
-				buffer[i] = v & 0x0ff;
-				break;
-			}
-		}
-		len -= count;
-
-		retval = target->type->write_memory(target, addr, width, count, buffer);
-		if (retval != ERROR_OK) {
-			/* BOO !*/
-			LOG_ERROR("array2mem: Write @ 0x%08x, w=%d, cnt=%d, failed", addr, width, count);
-			Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-			Jim_AppendStrings(interp, Jim_GetResult(interp), "mem2array: cannot read memory", NULL);
-			e = JIM_ERR;
-			len = 0;
-		}
-	}
-
-	Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-
-	return JIM_OK;
-}
-
-int Jim_Command_drscan(Jim_Interp *interp, int argc, Jim_Obj *const *args)
-{
-	int retval;
-	scan_field_t *fields;
-	int num_fields;
-	int field_count = 0;
-	int i, e;
-	long device;
-
-	/* args[1] = device
-	 * args[2] = num_bits
-	 * args[3] = hex string
-	 * ... repeat num bits and hex string ...
-	 */
-	if ((argc < 4) || ((argc % 2)!=0))
-	{
-		Jim_WrongNumArgs(interp, 1, args, "<device> <num_bits1> <value1> <num_bits2> <value2> ...");
-		return JIM_ERR;
-	}
-
-	for (i = 2; i < argc; i+=2)
-	{
-		long bits;
-
-		e = Jim_GetLong(interp, args[i], &bits);
-		if (e != JIM_OK)
-			return e;
-	}
-
-	e = Jim_GetLong(interp, args[1], &device);
-	if (e != JIM_OK)
-		return e;
-
-	num_fields=(argc-2)/2;
-	fields = malloc(sizeof(scan_field_t) * num_fields);
-	for (i = 2; i < argc; i+=2)
-	{
-		long bits;
-		int len;
-		const char *str;
-
-		Jim_GetLong(interp, args[i], &bits);
-		str = Jim_GetString(args[i+1], &len);
-
-		fields[field_count].num_bits = bits;
-		fields[field_count].out_value = malloc(CEIL(bits, 8));
-		str_to_buf(str, len, fields[field_count].out_value, bits, 0);
-		fields[field_count].in_value = fields[field_count].out_value;
-	}
-
-	jtag_add_dr_scan(num_fields, fields, TAP_INVALID);
-	retval = jtag_execute_queue();
-	if (retval != ERROR_OK)
-	{
-		Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-		Jim_AppendStrings(interp, Jim_GetResult(interp), "drscan: jtag execute failed", NULL);
-		return JIM_ERR;
-	}
-
-	field_count=0;
-	Jim_Obj *list = Jim_NewListObj(interp, NULL, 0);
-	for (i = 2; i < argc; i+=2)
-	{
-		long bits;
-		char *str;
-
-		Jim_GetLong(interp, args[i], &bits);
-		str = buf_to_str(fields[field_count].in_value, bits, 16);
-		free(fields[field_count].out_value);
-
-		Jim_ListAppendElement(interp, list, Jim_NewStringObj(interp, str, strlen(str)));
-		free(str);
-		field_count++;
-	}
-
-	Jim_SetResult(interp, list);
-
-	free(fields);
-
-	return JIM_OK;
-}
-
-static int jim_flash_banks(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
-{
-
-	if (argc != 1) {
-		Jim_WrongNumArgs(interp, 1, argv, "no arguments to flash_banks command");
-		return JIM_ERR;
-	}
-
-	unsigned flash_banks = flash_get_bank_count();
-	if (!flash_banks)
-	{
-		return JIM_ERR;
-	}
-
-	Jim_Obj *list=Jim_NewListObj(interp, NULL, 0);
-	for (unsigned i = 0; i < flash_banks; i++)
-	{
-		flash_bank_t *p = get_flash_bank_by_num(i);
-		Jim_Obj *elem=Jim_NewListObj(interp, NULL, 0);
-
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "name", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, p->driver->name, -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "base", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->base));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "size", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->size));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "bus_width", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->bus_width));
-		Jim_ListAppendElement(interp, elem, Jim_NewStringObj(interp, "chip_width", -1));
-		Jim_ListAppendElement(interp, elem, Jim_NewIntObj(interp, p->chip_width));
-
-		Jim_ListAppendElement(interp, list, elem);
-	}
-
-	Jim_SetResult(interp, list);
-
-	return JIM_OK;
-}
-
-int tclapi_register_commands(struct command_context_s *cmd_ctx)
-{
-	register_jim(cmd_ctx, "ocd_mem2array", &jim_mem2array,
-		"read memory and return as a TCL array for script processing");
-	register_jim(cmd_ctx, "ocd_array2mem", &jim_array2mem,
-		"convert a TCL array to memory locations and write the values");
-	register_jim(cmd_ctx, "drscan", &Jim_Command_drscan,
-		"execute DR scan <device> <num_bits> <value> <num_bits1> <value2> ...");
-	register_jim(cmd_ctx, "ocd_flash_banks", &jim_flash_banks,
-		"return information about the flash banks");
-	return ERROR_OK;
-}

Deleted: trunk/src/helper/tclapi.h
===================================================================
--- trunk/src/helper/tclapi.h	2009-05-10 20:10:11 UTC (rev 1693)
+++ trunk/src/helper/tclapi.h	2009-05-10 21:33:53 UTC (rev 1694)
@@ -1,26 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2009 by Zachary T Welch <zw at superlucidity.net>          *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-#ifndef TCLAPI_H
-#define TCLAPI_H
-
-#include "command.h"
-
-int tclapi_register_commands(struct command_context_s *ctx);
-
-#endif // TCLAPI_H

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-05-10 20:10:11 UTC (rev 1693)
+++ trunk/src/openocd.c	2009-05-10 21:33:53 UTC (rev 1694)
@@ -41,7 +41,6 @@
 #include "mflash.h"
 
 #include "command.h"
-#include "tclapi.h"
 #include "server.h"
 #include "telnet_server.h"
 #include "gdb_server.h"
@@ -203,7 +202,6 @@
 	telnet_register_commands(cmd_ctx);
 	gdb_register_commands(cmd_ctx);
 	tcl_register_commands(cmd_ctx); /* tcl server commands */
-	tclapi_register_commands(cmd_ctx); /* misc tcl commands */
 	log_register_commands(cmd_ctx);
 	jtag_register_commands(cmd_ctx);
 	xsvf_register_commands(cmd_ctx);



From zwelch at mail.berlios.de  Mon May 11 00:04:09 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 00:04:09 +0200
Subject: [Openocd-svn] r1695 - in trunk: . src src/flash src/helper src/jtag
	src/pld src/server src/svf src/target src/xsvf
Message-ID: <200905102204.n4AM49cu010841@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 00:03:57 +0200 (Mon, 11 May 2009)
New Revision: 1695

Modified:
   trunk/Makefile.am
   trunk/bootstrap
   trunk/configure.in
   trunk/src/Makefile.am
   trunk/src/flash/Makefile.am
   trunk/src/helper/Makefile.am
   trunk/src/jtag/Makefile.am
   trunk/src/pld/Makefile.am
   trunk/src/server/Makefile.am
   trunk/src/svf/Makefile.am
   trunk/src/target/Makefile.am
   trunk/src/xsvf/Makefile.am
Log:
Extend autotools build to create shared library libopenocd with libtool:
- Add libtoolize step too bootstrap script; creates ltmain.sh script.
- Add AC_PROG_LIBTOOL to configure.in to add libtool support to build.
- Change Makefile.am library rules from static (_a) to libtool (_la).
- Install libopenocd.{la,so,a} in $(libdir); update openocd link rules.
- Extend MAINTAINERCLEANFILES in top-level Makefile.am to remove ltmain.sh.


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -20,6 +20,7 @@
 	config.h.in \
 	config.h.in~ \
 	compile \
+	ltmain.sh \
 	missing \
 	aclocal.m4 \
 	install-sh

Modified: trunk/bootstrap
===================================================================
--- trunk/bootstrap	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/bootstrap	2009-05-10 22:03:57 UTC (rev 1695)
@@ -1,5 +1,6 @@
 aclocal \
 && autoheader \
+&& libtoolize --automake \
 && automake --foreign --add-missing --copy \
 && autoconf
 

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/configure.in	2009-05-10 22:03:57 UTC (rev 1695)
@@ -787,6 +787,7 @@
 AC_PROG_CC_C99
 AM_PROG_CC_C_O
 AC_PROG_RANLIB
+AC_PROG_LIBTOOL
 
 # Look for environ alternatives.  Possibility #1: is environ in unistd.h or stdlib.h?
 AC_MSG_CHECKING([for environ in unistd.h and stdlib.h])

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/src/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -1,3 +1,6 @@
+SUBDIRS = helper jtag xsvf svf target server flash pld
+
+lib_LTLIBRARIES = libopenocd.la
 bin_PROGRAMS = openocd
 
 if ECOSBOARD
@@ -6,8 +9,11 @@
 MAINFILE = main.c
 endif
 
-openocd_SOURCES = $(MAINFILE) openocd.c
+openocd_SOURCES = $(MAINFILE) 
+openocd_LDADD = libopenocd.la
 
+libopenocd_la_SOURCES = openocd.c
+
 # set the include path found by configure
 AM_CPPFLAGS = \
 	-I$(top_srcdir)/src \
@@ -21,22 +27,21 @@
 	-I$(top_srcdir)/src/pld
 
 # pass path to prefix path
-openocd_CPPFLAGS = \
+libopenocd_la_CPPFLAGS = \
  -DPKGLIBDIR=\"$(pkglibdir)\" \
  -DPKGBLDDATE=\"`date +%F-%R`\"
 
 if RELEASE
-openocd_CPPFLAGS += -DRELSTR=\"Release\" -DPKGBLDREV=\"\"
+libopenocd_la_CPPFLAGS += -DRELSTR=\"Release\" -DPKGBLDREV=\"\"
 else
-openocd_CPPFLAGS += -DRELSTR=\"svn:\" -DPKGBLDREV=\"`$(top_srcdir)/guess-rev.sh $(top_srcdir)`\"
+libopenocd_la_CPPFLAGS += -DRELSTR=\"svn:\" -DPKGBLDREV=\"`$(top_srcdir)/guess-rev.sh $(top_srcdir)`\"
 endif
 
 # add default CPPFLAGS
-openocd_CPPFLAGS += $(AM_CPPFLAGS) $(CPPFLAGS)
+libopenocd_la_CPPFLAGS += $(AM_CPPFLAGS) $(CPPFLAGS)
 
 # the library search path.
-openocd_LDFLAGS = $(all_libraries) 
-SUBDIRS = helper jtag xsvf svf target server flash pld
+libopenocd_la_LDFLAGS = $(all_libraries) 
 
 if IS_MINGW
 MINGWLDADD = -lwsock32
@@ -72,16 +77,19 @@
 endif
 endif
 
-openocd_LDADD = $(top_builddir)/src/xsvf/libxsvf.a $(top_builddir)/src/svf/libsvf.a \
-	$(top_builddir)/src/target/libtarget.a $(top_builddir)/src/jtag/libjtag.a \
-	$(top_builddir)/src/helper/libhelper.a \
-	$(top_builddir)/src/server/libserver.a $(top_builddir)/src/helper/libhelper.a \
-	$(top_builddir)/src/flash/libflash.a $(top_builddir)/src/target/libtarget.a \
-	$(top_builddir)/src/pld/libpld.a \
+libopenocd_la_LIBADD = \
+	$(top_builddir)/src/xsvf/libxsvf.la \
+	$(top_builddir)/src/svf/libsvf.la \
+	$(top_builddir)/src/pld/libpld.la \
+	$(top_builddir)/src/jtag/libjtag.la \
+	$(top_builddir)/src/flash/libflash.la \
+	$(top_builddir)/src/target/libtarget.la \
+	$(top_builddir)/src/server/libserver.la \
+	$(top_builddir)/src/helper/libhelper.la \
 	$(FTDI2232LIB) $(MINGWLDADD) $(LIBUSB)
 
 if HTTPD
-openocd_LDADD += -lmicrohttpd
+libopenocd_la_LIBADD += -lmicrohttpd
 endif
 
 nobase_dist_pkglib_DATA = \

Modified: trunk/src/flash/Makefile.am
===================================================================
--- trunk/src/flash/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/src/flash/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -4,8 +4,8 @@
 	-I$(top_srcdir)/src/target
 
 METASOURCES = AUTO
-noinst_LIBRARIES = libflash.a
-libflash_a_SOURCES = \
+noinst_LTLIBRARIES = libflash.la
+libflash_la_SOURCES = \
 	flash.c lpc2000.c cfi.c non_cfi.c at91sam7.c \
 	str7x.c str9x.c aduc702x.c nand.c nand_ecc.c \
 	lpc3180_nand_controller.c stellaris.c str9xpec.c stm32x.c tms470.c \

Modified: trunk/src/helper/Makefile.am
===================================================================
--- trunk/src/helper/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/src/helper/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -5,7 +5,7 @@
 	-DPKGLIBDIR=\"$(pkglibdir)\"
 
 METASOURCES = AUTO
-noinst_LIBRARIES = libhelper.a
+noinst_LTLIBRARIES = libhelper.la
 
 if ECOSBOARD
 CONFIGFILES = 
@@ -15,19 +15,19 @@
 
 
 
-libhelper_a_SOURCES = \
+libhelper_la_SOURCES = \
 	binarybuffer.c $(CONFIGFILES) configuration.c \
 	log.c command.c time_support.c \
 	replacements.c fileio.c startup_tcl.c
 
 if IOUTIL
-libhelper_a_SOURCES += ioutil.c
+libhelper_la_SOURCES += ioutil.c
 endif
 
-libhelper_a_CFLAGS =
+libhelper_la_CFLAGS =
 if IS_MINGW
 # FD_* macros are sloppy with their signs on MinGW32 platform
-libhelper_a_CFLAGS += -Wno-sign-compare
+libhelper_la_CFLAGS += -Wno-sign-compare
 endif
 
 noinst_HEADERS = binarybuffer.h configuration.h types.h log.h command.h \

Modified: trunk/src/jtag/Makefile.am
===================================================================
--- trunk/src/jtag/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/src/jtag/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -3,7 +3,7 @@
 	-I$(top_srcdir)/src/target
 
 METASOURCES = AUTO
-noinst_LIBRARIES = libjtag.a
+noinst_LTLIBRARIES = libjtag.la
 
 if BITBANG
 BITBANGFILES = bitbang.c
@@ -109,8 +109,12 @@
 ARMJTAGEWFILES =
 endif
 
-libjtag_a_SOURCES = jtag.c $(BITBANGFILES) $(PARPORTFILES) $(DUMMYFILES) $(FT2232FILES) $(AMTJTAGACCELFILES) $(EP93XXFILES) \
-	$(AT91RM9200FILES) $(GW16012FILES) $(BITQFILES) $(PRESTOFILES) $(USBPROGFILES) $(ECOSBOARDFILES) $(JLINKFILES) $(RLINKFILES) $(VSLLINKFILES) $(ARMJTAGEWFILES)
+libjtag_la_SOURCES = jtag.c \
+	$(BITBANGFILES) $(PARPORTFILES) $(DUMMYFILES) \
+	$(FT2232FILES) $(AMTJTAGACCELFILES) $(EP93XXFILES) \
+	$(AT91RM9200FILES) $(GW16012FILES) $(BITQFILES) \
+	$(PRESTOFILES) $(USBPROGFILES) $(ECOSBOARDFILES) \
+	$(JLINKFILES) $(RLINKFILES) $(VSLLINKFILES) $(ARMJTAGEWFILES)
 
 noinst_HEADERS = bitbang.h jtag.h bitq.h rlink/dtc_cmd.h rlink/ep1_cmd.h rlink/rlink.h rlink/st7.h
 

Modified: trunk/src/pld/Makefile.am
===================================================================
--- trunk/src/pld/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/src/pld/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -4,8 +4,8 @@
 	-I$(top_srcdir)/src/jtag
 
 METASOURCES = AUTO
-noinst_LIBRARIES = libpld.a
+noinst_LTLIBRARIES = libpld.la
 noinst_HEADERS = pld.h xilinx_bit.h virtex2.h
-libpld_a_SOURCES = pld.c xilinx_bit.c virtex2.c
+libpld_la_SOURCES = pld.c xilinx_bit.c virtex2.c
 
 MAINTAINERCLEANFILES = Makefile.in

Modified: trunk/src/server/Makefile.am
===================================================================
--- trunk/src/server/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/src/server/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -6,23 +6,23 @@
 	-DPKGLIBDIR=\"$(pkglibdir)\"
 
 METASOURCES = AUTO
-noinst_LIBRARIES = libserver.a
+noinst_LTLIBRARIES = libserver.la
 noinst_HEADERS = server.h telnet_server.h gdb_server.h
-libserver_a_SOURCES = server.c telnet_server.c gdb_server.c
+libserver_la_SOURCES = server.c telnet_server.c gdb_server.c
 
 if HTTPD
-libserver_a_SOURCES += httpd.c
+libserver_la_SOURCES += httpd.c
 endif
 
-libserver_a_CFLAGS =
+libserver_la_CFLAGS =
 if IS_MINGW
 # FD_* macros are sloppy with their signs on MinGW32 platform
-libserver_a_CFLAGS += -Wno-sign-compare
+libserver_la_CFLAGS += -Wno-sign-compare
 endif
 
 # tcl server addons
 noinst_HEADERS += tcl_server.h
-libserver_a_SOURCES += tcl_server.c
+libserver_la_SOURCES += tcl_server.c
 
 if HTTPD
 nobase_dist_pkglib_DATA = $(wildcard $(srcdir)/httpd/*.tcl $(srcdir)/httpd/*.css $(srcdir)/httpd/menu_cuts/*.png)

Modified: trunk/src/svf/Makefile.am
===================================================================
--- trunk/src/svf/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/src/svf/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -4,8 +4,8 @@
 	-I$(top_srcdir)/src/jtag
 
 METASOURCES = AUTO
-noinst_LIBRARIES = libsvf.a
+noinst_LTLIBRARIES = libsvf.la
 noinst_HEADERS = svf.h
-libsvf_a_SOURCES = svf.c
+libsvf_la_SOURCES = svf.c
 
 MAINTAINERCLEANFILES = Makefile.in

Modified: trunk/src/target/Makefile.am
===================================================================
--- trunk/src/target/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/src/target/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -11,8 +11,9 @@
 	-I$(top_srcdir)/src/xsvf
 
 METASOURCES = AUTO
-noinst_LIBRARIES = libtarget.a
-libtarget_a_SOURCES = target.c register.c breakpoints.c armv4_5.c embeddedice.c etm.c arm7tdmi.c arm9tdmi.c \
+noinst_LTLIBRARIES = libtarget.la
+libtarget_la_SOURCES = target.c register.c breakpoints.c \
+	armv4_5.c embeddedice.c etm.c arm7tdmi.c arm9tdmi.c \
 	arm_jtag.c arm7_9_common.c algorithm.c arm920t.c arm720t.c armv4_5_mmu.c armv4_5_cache.c arm_disassembler.c \
 	arm966e.c arm926ejs.c feroceon.c etb.c xscale.c arm_simulator.c image.c armv7m.c cortex_m3.c cortex_a8.c arm_adi_v5.c \
 	etm_dummy.c $(OOCD_TRACE_FILES) target_request.c trace.c arm11.c arm11_dbgtap.c mips32.c mips_m4k.c \

Modified: trunk/src/xsvf/Makefile.am
===================================================================
--- trunk/src/xsvf/Makefile.am	2009-05-10 21:33:53 UTC (rev 1694)
+++ trunk/src/xsvf/Makefile.am	2009-05-10 22:03:57 UTC (rev 1695)
@@ -4,8 +4,8 @@
 	-I$(top_srcdir)/src/jtag
 
 METASOURCES = AUTO
-noinst_LIBRARIES = libxsvf.a
+noinst_LTLIBRARIES = libxsvf.la
 noinst_HEADERS = xsvf.h
-libxsvf_a_SOURCES = xsvf.c
+libxsvf_la_SOURCES = xsvf.c
 
 MAINTAINERCLEANFILES = Makefile.in



From zwelch at mail.berlios.de  Mon May 11 02:45:03 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 02:45:03 +0200
Subject: [Openocd-svn] r1696 - trunk
Message-ID: <200905110045.n4B0j3QE000235@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 02:44:59 +0200 (Mon, 11 May 2009)
New Revision: 1696

Modified:
   trunk/configure.in
Log:
OpenOCD now requires autoconf 2.60 to process AC_PROG_CC_C99 macro.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-10 22:03:57 UTC (rev 1695)
+++ trunk/configure.in	2009-05-11 00:44:59 UTC (rev 1696)
@@ -1,4 +1,4 @@
-AC_PREREQ(2.59)
+AC_PREREQ(2.60)
 AC_INIT([openocd], [0.2.0-in-development],
 	[OpenOCD Mailing List <openocd-development at lists.berlios.de>])
 AC_CONFIG_SRCDIR([src/openocd.c])



From zwelch at mail.berlios.de  Mon May 11 02:49:56 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 02:49:56 +0200
Subject: [Openocd-svn] r1697 - trunk
Message-ID: <200905110049.n4B0nuew000656@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 02:49:51 +0200 (Mon, 11 May 2009)
New Revision: 1697

Modified:
   trunk/configure.in
Log:
Use AC_HEADER_STDBOOL macro instead of AC_CHEACK_HEADERS(stdbool.h).

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-11 00:44:59 UTC (rev 1696)
+++ trunk/configure.in	2009-05-11 00:49:51 UTC (rev 1697)
@@ -13,12 +13,12 @@
 AC_CHECK_HEADERS(jtag_minidriver.h)
 AC_CHECK_HEADERS(malloc.h)
 AC_CHECK_HEADERS(pthread.h)
-AC_CHECK_HEADERS(stdbool.h)
 AC_CHECK_HEADERS(strings.h)
 AC_CHECK_HEADERS(sys/param.h)
 AC_CHECK_HEADERS(sys/time.h)
 AC_CHECK_HEADERS(sys/select.h)
 
+AC_HEADER_STDBOOL
 AC_HEADER_TIME
 
 AC_C_BIGENDIAN



From zwelch at mail.berlios.de  Mon May 11 02:57:24 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 02:57:24 +0200
Subject: [Openocd-svn] r1698 - trunk
Message-ID: <200905110057.n4B0vOvV002740@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 02:57:19 +0200 (Mon, 11 May 2009)
New Revision: 1698

Modified:
   trunk/configure.in
Log:
Add AC_HEADER_ASSERT macro to configure; provides --disable-assert option.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-11 00:49:51 UTC (rev 1697)
+++ trunk/configure.in	2009-05-11 00:57:19 UTC (rev 1698)
@@ -18,6 +18,7 @@
 AC_CHECK_HEADERS(sys/time.h)
 AC_CHECK_HEADERS(sys/select.h)
 
+AC_HEADER_ASSERT
 AC_HEADER_STDBOOL
 AC_HEADER_TIME
 



From zwelch at mail.berlios.de  Mon May 11 04:25:06 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 04:25:06 +0200
Subject: [Openocd-svn] r1699 - in trunk: . src/helper
Message-ID: <200905110225.n4B2P62U011234@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 04:24:58 +0200 (Mon, 11 May 2009)
New Revision: 1699

Modified:
   trunk/configure.in
   trunk/src/helper/types.h
Log:
Add configure check for sys/types.h; include in our types.h.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-11 00:57:19 UTC (rev 1698)
+++ trunk/configure.in	2009-05-11 02:24:58 UTC (rev 1699)
@@ -17,6 +17,7 @@
 AC_CHECK_HEADERS(sys/param.h)
 AC_CHECK_HEADERS(sys/time.h)
 AC_CHECK_HEADERS(sys/select.h)
+AC_CHECK_HEADERS(sys/types.h)
 
 AC_HEADER_ASSERT
 AC_HEADER_STDBOOL

Modified: trunk/src/helper/types.h
===================================================================
--- trunk/src/helper/types.h	2009-05-11 00:57:19 UTC (rev 1698)
+++ trunk/src/helper/types.h	2009-05-11 02:24:58 UTC (rev 1699)
@@ -27,6 +27,10 @@
 #include "config.h"
 #endif
 
+#ifdef HAVE_SYS_TYPES_H
+#include <sys/types.h>
+#endif
+
 #ifndef u8
 typedef unsigned char u8;
 #endif



From zwelch at mail.berlios.de  Mon May 11 04:27:43 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 04:27:43 +0200
Subject: [Openocd-svn] r1700 - in trunk/src: . flash helper jtag jtag/rlink
	pld server svf target xsvf
Message-ID: <200905110227.n4B2RhG1011310@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 04:27:16 +0200 (Mon, 11 May 2009)
New Revision: 1700

Modified:
   trunk/src/ecosboard.c
   trunk/src/flash/flash.c
   trunk/src/flash/mflash.c
   trunk/src/helper/fileio.c
   trunk/src/helper/fileio.h
   trunk/src/helper/ioutil.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/parport.c
   trunk/src/jtag/rlink/rlink.h
   trunk/src/openocd.c
   trunk/src/pld/pld.c
   trunk/src/pld/xilinx_bit.c
   trunk/src/server/httpd.c
   trunk/src/server/server.c
   trunk/src/server/server.h
   trunk/src/svf/svf.c
   trunk/src/target/arm7_9_common.c
   trunk/src/target/avrt.c
   trunk/src/target/target.c
   trunk/src/target/xscale.c
   trunk/src/xsvf/xsvf.c
Log:
Remove redundant sys/types.h #include directives (now in types.h).

Modified: trunk/src/ecosboard.c
===================================================================
--- trunk/src/ecosboard.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/ecosboard.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -39,7 +39,6 @@
 
 #include <time_support.h>
 #include <sys/time.h>
-#include <sys/types.h>
 #include <strings.h>
 #include <stdio.h>
 #include <stdlib.h>

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/flash/flash.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -42,7 +42,6 @@
 #include <string.h>
 #include <unistd.h>
 #include <stdlib.h>
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <errno.h>
 #include <inttypes.h>

Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/flash/mflash.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -25,7 +25,6 @@
 #include <string.h>
 #include <unistd.h>
 #include <stdlib.h>
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <errno.h>
 #include <inttypes.h>

Modified: trunk/src/helper/fileio.c
===================================================================
--- trunk/src/helper/fileio.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/helper/fileio.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -38,7 +38,6 @@
 #include <string.h>
 #include <unistd.h>
 #include <stdlib.h>
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <errno.h>
 #include <ctype.h>

Modified: trunk/src/helper/fileio.h
===================================================================
--- trunk/src/helper/fileio.h	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/helper/fileio.h	2009-05-11 02:27:16 UTC (rev 1700)
@@ -33,7 +33,6 @@
 #include <stdio.h>
 #include <unistd.h>
 #include <stdlib.h>
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <errno.h>
 #include <ctype.h>

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/helper/ioutil.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -32,7 +32,6 @@
 
 #include <time_support.h>
 #include <sys/time.h>
-#include <sys/types.h>
 #include <strings.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -53,7 +52,6 @@
 #include <netinet/in.h>
 #include <net/if.h>
 #include <arpa/inet.h>
-#include <sys/types.h>
 #include <sys/socket.h>
 #include <netdb.h>
 #include <netinet/in.h>

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/jtag/gw16012.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -33,7 +33,6 @@
 /*  -ino: 060521-1036 */
 #if defined(__FreeBSD__) || defined(__FreeBSD_kernel__)
 
-#include <sys/types.h>
 #include <machine/sysarch.h>
 #include <machine/cpufunc.h>
 #define ioperm(startport,length,enable)\

Modified: trunk/src/jtag/parport.c
===================================================================
--- trunk/src/jtag/parport.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/jtag/parport.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -33,7 +33,6 @@
 /* -ino: 060521-1036 */
 #if defined(__FreeBSD__) || defined(__FreeBSD_kernel__)
 
-#include <sys/types.h>
 #include <machine/sysarch.h>
 #include <machine/cpufunc.h>
 #define ioperm(startport,length,enable)\

Modified: trunk/src/jtag/rlink/rlink.h
===================================================================
--- trunk/src/jtag/rlink/rlink.h	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/jtag/rlink/rlink.h	2009-05-11 02:27:16 UTC (rev 1700)
@@ -19,7 +19,6 @@
  ***************************************************************************/
 
 #include "types.h"
-#include <sys/types.h>
 
 typedef
 struct rlink_speed_table_s {

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/openocd.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -47,7 +47,6 @@
 #include "tcl_server.h"
 
 #include <sys/time.h>
-#include <sys/types.h>
 #include <strings.h>
 #include <stdio.h>
 #include <stdlib.h>

Modified: trunk/src/pld/pld.c
===================================================================
--- trunk/src/pld/pld.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/pld/pld.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -32,7 +32,6 @@
 
 #include <stdlib.h>
 #include <unistd.h>
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <string.h>

Modified: trunk/src/pld/xilinx_bit.c
===================================================================
--- trunk/src/pld/xilinx_bit.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/pld/xilinx_bit.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -28,7 +28,6 @@
 
 #include <stdlib.h>
 #include <unistd.h>
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <string.h>

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/server/httpd.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -40,12 +40,10 @@
 #include <stdlib.h>
 #include <errno.h>
 #include <unistd.h>
-#include <sys/types.h>
 #include <fcntl.h>
 #include <pthread.h>
 #include <signal.h>
 
-#include <sys/types.h>
 #include <sys/select.h>
 #include <sys/socket.h>
 #include <microhttpd.h>

Modified: trunk/src/server/server.c
===================================================================
--- trunk/src/server/server.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/server/server.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -40,7 +40,6 @@
 #include <stdlib.h>
 #include <errno.h>
 #include <unistd.h>
-#include <sys/types.h>
 #include <fcntl.h>
 #include <signal.h>
 #ifndef _WIN32

Modified: trunk/src/server/server.h
===================================================================
--- trunk/src/server/server.h	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/server/server.h	2009-05-11 02:27:16 UTC (rev 1700)
@@ -30,8 +30,6 @@
 #include "binarybuffer.h"
 #include "replacements.h"
 
-#include <sys/types.h>
-
 enum connection_type
 {
 	CONNECTION_TCP,

Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/svf/svf.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -42,7 +42,6 @@
 #include <ctype.h>
 #include <stdlib.h>
 #include <unistd.h>
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <string.h>

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/target/arm7_9_common.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -48,7 +48,6 @@
 #include <string.h>
 #include <unistd.h>
 
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <sys/time.h>
 #include <errno.h>

Modified: trunk/src/target/avrt.c
===================================================================
--- trunk/src/target/avrt.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/target/avrt.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -37,7 +37,6 @@
 #include <stdlib.h>
 #include <string.h>
 
-#include <sys/types.h>
 #include <unistd.h>
 #include <errno.h>
 

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/target/target.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -46,7 +46,6 @@
 #include <stdlib.h>
 #include <inttypes.h>
 
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <unistd.h>
 #include <errno.h>

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/target/xscale.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -44,7 +44,6 @@
 #include <stdlib.h>
 #include <string.h>
 
-#include <sys/types.h>
 #include <unistd.h>
 #include <errno.h>
 

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-11 02:24:58 UTC (rev 1699)
+++ trunk/src/xsvf/xsvf.c	2009-05-11 02:27:16 UTC (rev 1700)
@@ -49,7 +49,6 @@
 
 #include <stdlib.h>
 #include <unistd.h>
-#include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <string.h>



From zwelch at mail.berlios.de  Mon May 11 04:29:55 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 04:29:55 +0200
Subject: [Openocd-svn] r1701 - trunk/src/helper
Message-ID: <200905110229.n4B2Ttm5011529@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 04:29:53 +0200 (Mon, 11 May 2009)
New Revision: 1701

Modified:
   trunk/src/helper/types.h
Log:
Finish portability support for AC_HEADER_STDBOOL configure macro.

Modified: trunk/src/helper/types.h
===================================================================
--- trunk/src/helper/types.h	2009-05-11 02:27:16 UTC (rev 1700)
+++ trunk/src/helper/types.h	2009-05-11 02:29:53 UTC (rev 1701)
@@ -54,15 +54,20 @@
 #else	/* HAVE_STDBOOL_H */
 #define __bool_true_false_are_defined 1
 
+#ifndef HAVE__BOOL
 #ifndef __cplusplus
 
 #define false	0
 #define true		1
 
-#define bool		_Bool
 typedef int _Bool;
+#else 
+typedef bool _Bool;
 #endif	/* __cplusplus */
+#endif	/* HAVE__BOOL */
 
+#define bool _Bool
+
 #endif	/* HAVE_STDBOOL_H */
 
 /* DANGER!!!! here be dragons!



From zwelch at mail.berlios.de  Mon May 11 04:52:07 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 04:52:07 +0200
Subject: [Openocd-svn] r1702 - in trunk: . src/helper
Message-ID: <200905110252.n4B2q79J013040@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 04:52:00 +0200 (Mon, 11 May 2009)
New Revision: 1702

Added:
   trunk/src/helper/system.h
Modified:
   trunk/configure.in
   trunk/src/helper/Makefile.am
   trunk/src/helper/replacements.h
Log:
Factor system #includes out of replacements.h into new system.h.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-11 02:29:53 UTC (rev 1701)
+++ trunk/configure.in	2009-05-11 02:52:00 UTC (rev 1702)
@@ -9,15 +9,20 @@
 AC_SEARCH_LIBS([dlopen], [dl])
 
 AC_CHECK_HEADERS(elf.h)
+AC_CHECK_HEADERS(fcntl.h)
 AC_CHECK_HEADERS(ifaddrs.h)
 AC_CHECK_HEADERS(jtag_minidriver.h)
 AC_CHECK_HEADERS(malloc.h)
+AC_CHECK_HEADERS(netinet/in.h)
 AC_CHECK_HEADERS(pthread.h)
 AC_CHECK_HEADERS(strings.h)
 AC_CHECK_HEADERS(sys/param.h)
+AC_CHECK_HEADERS(sys/poll.h)
+AC_CHECK_HEADERS(sys/select.h)
+AC_CHECK_HEADERS(sys/socket.h)
 AC_CHECK_HEADERS(sys/time.h)
-AC_CHECK_HEADERS(sys/select.h)
 AC_CHECK_HEADERS(sys/types.h)
+AC_CHECK_HEADERS(unistd.h)
 
 AC_HEADER_ASSERT
 AC_HEADER_STDBOOL

Modified: trunk/src/helper/Makefile.am
===================================================================
--- trunk/src/helper/Makefile.am	2009-05-11 02:29:53 UTC (rev 1701)
+++ trunk/src/helper/Makefile.am	2009-05-11 02:52:00 UTC (rev 1702)
@@ -32,7 +32,7 @@
 
 noinst_HEADERS = binarybuffer.h configuration.h types.h log.h command.h \
 	time_support.h replacements.h fileio.h jim.h jim-eventloop.h \
-	startup.tcl bin2char.c
+	system.h startup.tcl bin2char.c
 
 bin2char$(EXEEXT_FOR_BUILD): bin2char.c
 	${CC_FOR_BUILD} ${CFLAGS_FOR_BUILD} $(srcdir)/bin2char.c -o $@

Modified: trunk/src/helper/replacements.h
===================================================================
--- trunk/src/helper/replacements.h	2009-05-11 02:29:53 UTC (rev 1701)
+++ trunk/src/helper/replacements.h	2009-05-11 02:52:00 UTC (rev 1702)
@@ -31,36 +31,8 @@
 #endif
 
 #include "types.h"
+#include "system.h"
 
-#if BUILD_ECOSBOARD
-#include <pkgconf/system.h>
-#include <stdlib.h>
-#endif
-
-#ifdef HAVE_SYS_SELECT_H 
-#include <sys/select.h> /* select, FD_SET and friends (POSIX.1-2001) */
-#endif
-
-#ifdef HAVE_SYS_TIME_H 
-#include <sys/time.h> /* FD_SET and friends (pre-POSIX.1-2001) */
-#endif
-
-/* include necessary headers for socket functionality */
-#ifdef _WIN32
-#include <winsock2.h>
-#include <ws2tcpip.h>
-#else
-#include <sys/socket.h>
-#include <sys/poll.h>
-#include <netinet/in.h>
-#include <unistd.h>
-#include <fcntl.h>
-#endif
-
-#ifdef HAVE_SYS_PARAM_H
-#include <sys/param.h> /* for MIN/MAX macros */
-#endif
-
 /* MIN,MAX macros */
 #ifndef MIN
 #define MIN(a,b) (((a)<(b))?(a):(b))

Added: trunk/src/helper/system.h
===================================================================
--- trunk/src/helper/system.h	2009-05-11 02:29:53 UTC (rev 1701)
+++ trunk/src/helper/system.h	2009-05-11 02:52:00 UTC (rev 1702)
@@ -0,0 +1,77 @@
+/***************************************************************************
+ *   Copyright (C) 2006 by Dominic Rath <Dominic.Rath at gmx.de>              *
+ *   Copyright (C) 2007-2008 by ?yvind Harboe <oyvind.harboe at zylin.com>    *
+ *   Copyright (C) 2008 by Spencer Oliver <spen at spen-soft.co.uk>           *
+ *   Copyright (C) 2009 by Zachary T Welch <zw at superlucidity.net>          *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+#ifndef SYSTEM_H
+#define SYSTEM_H
+
+// standard C library header files
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <ctype.h>
+#include <errno.h>
+
+// +++ AC_HEADER_TIME +++
+#ifdef TIME_WITH_SYS_TIME
+# include <sys/time.h>
+# include <time.h>
+#else
+# ifdef HAVE_SYS_TIME_H
+#  include <sys/time.h>
+# else
+#  include <time.h>
+# endif
+#endif
+// --- AC_HEADER_TIME ---
+
+// +++ platform specific headers +++
+#if BUILD_ECOSBOARD == 1
+#include <pkgconf/system.h>
+#endif
+#ifdef _WIN32
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#endif
+// --- platform specific headers ---
+
+#ifdef HAVE_SYS_SOCKET_H
+#include <sys/socket.h>
+#endif
+#ifdef HAVE_SYS_POLL_H
+#include <sys/poll.h>
+#endif
+#ifdef HAVE_NETINET_IN_H
+#include <netinet/in.h>
+#endif
+#ifdef HAVE_SYS_SELECT_H
+#include <sys/select.h> /* select, FD_SET and friends (POSIX.1-2001) */
+#endif
+#ifdef HAVE_SYS_PARAM_H
+#include <sys/param.h> /* for MIN/MAX macros */
+#endif
+#ifdef HAVE_UNISTD_H
+#include <unistd.h>
+#endif
+#ifdef HAVE_FCNTL_H
+#include <fcntl.h>
+#endif
+
+#endif // SYSTEM_H



From zwelch at mail.berlios.de  Mon May 11 05:35:30 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 05:35:30 +0200
Subject: [Openocd-svn] r1703 - in trunk: . src/helper
Message-ID: <200905110335.n4B3ZUfD019817@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 05:35:25 +0200 (Mon, 11 May 2009)
New Revision: 1703

Modified:
   trunk/configure.in
   trunk/src/helper/log.c
Log:
Add --enable-malloc-logging configure option and update log.c to match.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-11 02:52:00 UTC (rev 1702)
+++ trunk/configure.in	2009-05-11 03:35:25 UTC (rev 1703)
@@ -250,6 +250,19 @@
 fi
 
 
+debug_malloc=no
+AC_ARG_ENABLE(malloc_logging,
+	AS_HELP_STRING([--enable-malloc-logging],
+  		[Include free space in logging messages (requires malloc.h).]), 
+	[debug_malloc=$enableval], [])
+
+AC_MSG_CHECKING([whether to enable malloc free space logging]);
+AC_MSG_RESULT($debug_malloc)
+if test $debug_malloc = yes; then
+  AC_DEFINE([_DEBUG_FREE_SPACE_],[1], [Include malloc free space in logging])
+fi
+
+
 AC_ARG_ENABLE(parport,
   AS_HELP_STRING([--enable-parport], [Enable building the pc parallel port driver]), 
   [build_parport=$enableval], [build_parport=no])

Modified: trunk/src/helper/log.c
===================================================================
--- trunk/src/helper/log.c	2009-05-11 02:52:00 UTC (rev 1702)
+++ trunk/src/helper/log.c	2009-05-11 03:35:25 UTC (rev 1703)
@@ -41,10 +41,13 @@
 #include <unistd.h>
 #include <stdarg.h>
 
-#define PRINT_MEM() 0
-#if PRINT_MEM()
+#ifdef _DEBUG_FREE_SPACE_
+#ifdef HAVE_MALLOC_H
 #include <malloc.h>
+#else
+#error "malloc.h is required to use --enable-malloc-logging"
 #endif
+#endif
 
 int debug_level = -1;
 
@@ -99,16 +102,16 @@
 		{
 			/* print with count and time information */
 			int t=(int)(timeval_ms()-start);
-#if PRINT_MEM()
+#ifdef _DEBUG_FREE_SPACE_
 			struct mallinfo info;
 			info = mallinfo();
 #endif
 			fprintf(log_output, "%s%d %d %s:%d %s()"
-#if PRINT_MEM()
+#ifdef _DEBUG_FREE_SPACE_
 					" %d"
 #endif
 					": %s", log_strings[level+1], count, t, file, line, function,
-#if PRINT_MEM()
+#ifdef _DEBUG_FREE_SPACE_
 					info.fordblks,
 #endif
 					string);



From zwelch at mail.berlios.de  Mon May 11 05:48:01 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 05:48:01 +0200
Subject: [Openocd-svn] r1704 - trunk
Message-ID: <200905110348.n4B3m1OG020485@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 05:47:56 +0200 (Mon, 11 May 2009)
New Revision: 1704

Modified:
   trunk/configure.in
Log:
Add remaining header checks to be used in subsequent patches.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-11 03:35:25 UTC (rev 1703)
+++ trunk/configure.in	2009-05-11 03:47:56 UTC (rev 1704)
@@ -8,18 +8,25 @@
 AC_SEARCH_LIBS([ioperm], [ioperm])
 AC_SEARCH_LIBS([dlopen], [dl])
 
+AC_CHECK_HEADERS(arpa/inet.h)
 AC_CHECK_HEADERS(elf.h)
+AC_CHECK_HEADERS(dirent.h)
 AC_CHECK_HEADERS(fcntl.h)
 AC_CHECK_HEADERS(ifaddrs.h)
 AC_CHECK_HEADERS(jtag_minidriver.h)
 AC_CHECK_HEADERS(malloc.h)
+AC_CHECK_HEADERS(netdb.h)
 AC_CHECK_HEADERS(netinet/in.h)
+AC_CHECK_HEADERS(netinet/tcp.h)
+AC_CHECK_HEADERS(net/if.h)
 AC_CHECK_HEADERS(pthread.h)
 AC_CHECK_HEADERS(strings.h)
+AC_CHECK_HEADERS(sys/ioctl.h)
 AC_CHECK_HEADERS(sys/param.h)
 AC_CHECK_HEADERS(sys/poll.h)
 AC_CHECK_HEADERS(sys/select.h)
 AC_CHECK_HEADERS(sys/socket.h)
+AC_CHECK_HEADERS(sys/stat.h)
 AC_CHECK_HEADERS(sys/time.h)
 AC_CHECK_HEADERS(sys/types.h)
 AC_CHECK_HEADERS(unistd.h)



From zwelch at mail.berlios.de  Mon May 11 05:48:36 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 05:48:36 +0200
Subject: [Openocd-svn] r1705 - trunk/src/helper
Message-ID: <200905110348.n4B3maYp020511@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 05:48:32 +0200 (Mon, 11 May 2009)
New Revision: 1705

Modified:
   trunk/src/helper/ioutil.c
Log:
Simplify #include directives in ioutil.c, use new header checks.

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-11 03:47:56 UTC (rev 1704)
+++ trunk/src/helper/ioutil.c	2009-05-11 03:48:32 UTC (rev 1705)
@@ -24,48 +24,39 @@
 #endif
 
 #include "log.h"
-#include "types.h"
-#include "configuration.h"
-#include "target.h"
+#include "time_support.h"
 
-#include "command.h"
-
-#include <time_support.h>
-#include <sys/time.h>
-#include <strings.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
-#if !BUILD_ECOSBOARD
-#include <malloc.h>
+#ifdef HAVE_ARPA_INET_H
+#include <arpa/inet.h>
 #endif
-#include <errno.h>
-
-
-#include <fcntl.h>
-#include <sys/stat.h>
+#ifdef HAVE_DIRENT_H
 #include <dirent.h>
-#include <netinet/tcp.h>
-#include <sys/ioctl.h>
-#include <sys/socket.h>
-#include <netinet/in.h>
-#include <net/if.h>
-#include <arpa/inet.h>
-#include <sys/socket.h>
+#endif
+#ifdef HAVE_NETDB_H
 #include <netdb.h>
-#include <netinet/in.h>
-#include <unistd.h>
-#include <arpa/inet.h>
-#include <stdio.h>
-#include <string.h>
-
-#if !defined(__CYGWIN__)
+#endif
+#ifdef HAVE_NET_IF_H
+#include <net/if.h>
+#endif
+//#ifdef HAVE_NETINET_TCP_H
+//#include <netinet/tcp.h>
+//#endif
+#ifdef HAVE_SYS_IOCTL_H
+#include <sys/ioctl.h>
+#endif
+#ifdef HAVE_SYS_STAT_H
+#include <sys/stat.h>
+#endif
+#ifdef HAVE_IFADDRS_H
 #include <ifaddrs.h>
 #endif
+#ifdef HAVE_MALLOC_H
+#include <malloc.h>
+#endif
+//#ifdef HAVE_STRINGS_H
+//#include <strings.h>
+//#endif
 
-#include <unistd.h>
-#include <stdio.h>
 
 int handle_rm_command(struct command_context_s *cmd_ctx, char *cmd,
 		char **args, int argc)



From zwelch at mail.berlios.de  Mon May 11 05:59:20 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 05:59:20 +0200
Subject: [Openocd-svn] r1706 - trunk/src/helper
Message-ID: <200905110359.n4B3xKOd021839@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 05:59:02 +0200 (Mon, 11 May 2009)
New Revision: 1706

Modified:
   trunk/src/helper/binarybuffer.c
   trunk/src/helper/command.c
   trunk/src/helper/command.h
   trunk/src/helper/configuration.c
   trunk/src/helper/configuration.h
   trunk/src/helper/fileio.c
   trunk/src/helper/fileio.h
   trunk/src/helper/log.c
   trunk/src/helper/log.h
   trunk/src/helper/options.c
   trunk/src/helper/time_support.c
Log:
Audit and eliminate redundant helper #include directives.

Modified: trunk/src/helper/binarybuffer.c
===================================================================
--- trunk/src/helper/binarybuffer.c	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/binarybuffer.c	2009-05-11 03:59:02 UTC (rev 1706)
@@ -24,12 +24,7 @@
 #include "config.h"
 #endif
 
-#include <stdlib.h>
-#include <string.h>
-
-#include "types.h"
 #include "log.h"
-
 #include "binarybuffer.h"
 
 const unsigned char bit_reverse_table256[] =

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/command.c	2009-05-11 03:59:02 UTC (rev 1706)
@@ -30,22 +30,14 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
+// @todo the inclusion of target.h here is a layering violation
 #include "target.h"
 #include "command.h"
 #include "configuration.h"
-
 #include "log.h"
 #include "time_support.h"
 #include "jim-eventloop.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <ctype.h>
-#include <stdarg.h>
-#include <stdio.h>
-#include <unistd.h>
-#include <errno.h>
 
 int fast_and_dangerous = 0;
 Jim_Interp *interp = NULL;

Modified: trunk/src/helper/command.h
===================================================================
--- trunk/src/helper/command.h	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/command.h	2009-05-11 03:59:02 UTC (rev 1706)
@@ -23,7 +23,16 @@
 #ifndef COMMAND_H
 #define COMMAND_H
 
+/* Integrate the JIM TCL interpretor into the command processing. */
+#if BUILD_ECOSBOARD
 #include <stdio.h>
+#include <stdarg.h>
+/* Jim is provied by eCos */
+#include <cyg/jimtcl/jim.h>
+#else
+#define JIM_EMBEDDED
+#include "jim.h"
+#endif
 
 enum command_mode
 {
@@ -87,16 +96,6 @@
 
 extern int fast_and_dangerous;
 
-/* Integrate the JIM TCL interpretor into the command processing. */
-#include <stdarg.h>
-#if BUILD_ECOSBOARD
-/* Jim is provied by eCos */
-#include <cyg/jimtcl/jim.h>
-#else
-#define JIM_EMBEDDED
-#include "jim.h"
-#endif
-
 extern Jim_Interp *interp;
 
 void register_jim(command_context_t *context, const char *name, int (*cmd)(Jim_Interp *interp, int argc, Jim_Obj *const *argv), const char *help);

Modified: trunk/src/helper/configuration.c
===================================================================
--- trunk/src/helper/configuration.c	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/configuration.c	2009-05-11 03:59:02 UTC (rev 1706)
@@ -24,14 +24,9 @@
 #include "config.h"
 #endif
 
-#include "types.h"
-#include "command.h"
 #include "configuration.h"
 #include "log.h"
 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
 
 static size_t num_config_files;
 static char** config_file_names;

Modified: trunk/src/helper/configuration.h
===================================================================
--- trunk/src/helper/configuration.h	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/configuration.h	2009-05-11 03:59:02 UTC (rev 1706)
@@ -24,7 +24,6 @@
 #define CONFIGURATION_H
 
 #include "command.h"
-#include "types.h"
 
 extern int parse_cmdline_args(struct command_context_s *cmd_ctx, int argc, char *argv[]);
 extern int parse_config_file(struct command_context_s *cmd_ctx);

Modified: trunk/src/helper/fileio.c
===================================================================
--- trunk/src/helper/fileio.c	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/fileio.c	2009-05-11 03:59:02 UTC (rev 1706)
@@ -27,21 +27,10 @@
 #include "config.h"
 #endif
 
-#include "types.h"
-#include "replacements.h"
 #include "log.h"
 #include "configuration.h"
-
 #include "fileio.h"
 
-#include <stdio.h>
-#include <string.h>
-#include <unistd.h>
-#include <stdlib.h>
-#include <sys/stat.h>
-#include <errno.h>
-#include <ctype.h>
-
 static inline int fileio_open_local(fileio_t *fileio)
 {
 	char access[4];

Modified: trunk/src/helper/fileio.h
===================================================================
--- trunk/src/helper/fileio.h	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/fileio.h	2009-05-11 03:59:02 UTC (rev 1706)
@@ -28,15 +28,8 @@
 
 #define FILEIO_MAX_ERROR_STRING		(128)
 
-#include "types.h"
+#include "replacements.h"
 
-#include <stdio.h>
-#include <unistd.h>
-#include <stdlib.h>
-#include <sys/stat.h>
-#include <errno.h>
-#include <ctype.h>
-
 enum fileio_type
 {
 	FILEIO_TEXT,

Modified: trunk/src/helper/log.c
===================================================================
--- trunk/src/helper/log.c	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/log.c	2009-05-11 03:59:02 UTC (rev 1706)
@@ -27,18 +27,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "log.h"
-#include "configuration.h"
 #include "time_support.h"
-#include "command.h"
 #include "server.h"
 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 #include <stdarg.h>
 
 #ifdef _DEBUG_FREE_SPACE_

Modified: trunk/src/helper/log.h
===================================================================
--- trunk/src/helper/log.h	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/log.h	2009-05-11 03:59:02 UTC (rev 1706)
@@ -29,8 +29,6 @@
 #include "replacements.h"
 #include "command.h"
 
-#include <stdarg.h>
-
 /* logging priorities 
  * LOG_LVL_SILENT - turn off all output. In lieu of try+catch this can be used as a 
  *                  feeble ersatz.

Modified: trunk/src/helper/options.c
===================================================================
--- trunk/src/helper/options.c	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/options.c	2009-05-11 03:59:02 UTC (rev 1706)
@@ -24,18 +24,11 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
-#include "types.h"
-#include "command.h"
 #include "configuration.h"
 #include "log.h"
 #include "server.h"
 
-#include <stdio.h>
-#include <stdlib.h>
 #include <getopt.h>
-#include <string.h>
 
 static int help_flag, version_flag;
 

Modified: trunk/src/helper/time_support.c
===================================================================
--- trunk/src/helper/time_support.c	2009-05-11 03:48:32 UTC (rev 1705)
+++ trunk/src/helper/time_support.c	2009-05-11 03:59:02 UTC (rev 1706)
@@ -27,13 +27,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
 #include "time_support.h"
 #include "log.h"
 
-#include <stdlib.h>
 
-
 /* calculate difference between two struct timeval values */
 int timeval_subtract(struct timeval *result, struct timeval *x, struct timeval *y)
 {



From zwelch at mail.berlios.de  Mon May 11 06:05:27 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 06:05:27 +0200
Subject: [Openocd-svn] r1707 - in trunk/src/jtag: . rlink
Message-ID: <200905110405.n4B45RGq022362@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 06:04:58 +0200 (Mon, 11 May 2009)
New Revision: 1707

Modified:
   trunk/src/jtag/amt_jtagaccel.c
   trunk/src/jtag/arm-jtag-ew.c
   trunk/src/jtag/at91rm9200.c
   trunk/src/jtag/bitbang.c
   trunk/src/jtag/bitq.c
   trunk/src/jtag/dummy.c
   trunk/src/jtag/ep93xx.c
   trunk/src/jtag/ft2232.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/jlink.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/parport.c
   trunk/src/jtag/presto.c
   trunk/src/jtag/rlink/rlink.c
   trunk/src/jtag/usbprog.c
   trunk/src/jtag/vsllink.c
   trunk/src/jtag/zy1000.c
Log:
Audit and eliminate redundant #include directives from src/jtag.

Modified: trunk/src/jtag/amt_jtagaccel.c
===================================================================
--- trunk/src/jtag/amt_jtagaccel.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/amt_jtagaccel.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -21,25 +21,13 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "jtag.h"
 
-/* system includes */
 
-#ifdef _WIN32
-#include "errno.h"
-#endif /* _WIN32 */
-
-#include <string.h>
-#include <stdlib.h>
-
 #if PARPORT_USE_PPDEV == 1
 #include <linux/parport.h>
 #include <linux/ppdev.h>
-#include <fcntl.h>
 #include <sys/ioctl.h>
-#include <unistd.h>
 #else /* not PARPORT_USE_PPDEV */
 #ifndef _WIN32
 #include <sys/io.h>
@@ -49,12 +37,9 @@
 #if PARPORT_USE_GIVEIO == 1
 #if IS_CYGWIN == 1
 #include <windows.h>
-#include <errno.h>
 #endif
 #endif
 
-#include "log.h"
-
 /* configuration */
 static u16 amt_jtagaccel_port;
 

Modified: trunk/src/jtag/arm-jtag-ew.c
===================================================================
--- trunk/src/jtag/arm-jtag-ew.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/arm-jtag-ew.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -24,17 +24,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "jtag.h"
 #include <usb.h>
-#include <string.h>
-#include <ctype.h>
 
-/* system includes */
 
-#include "log.h"
-
 #define USB_VID						0x15ba
 #define USB_PID						0x001e
 

Modified: trunk/src/jtag/at91rm9200.c
===================================================================
--- trunk/src/jtag/at91rm9200.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/at91rm9200.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -21,18 +21,12 @@
 #include "config.h"
 #endif
 
-#include "log.h"
 #include "jtag.h"
 #include "bitbang.h"
 
-/* system includes */
-#include <string.h>
-#include <stdlib.h>
-#include <stdio.h>
 #include <sys/mman.h>
-#include <unistd.h>
-#include <fcntl.h>
 
+
 /* AT91RM9200 */
 #define AT91C_BASE_SYS	(0xfffff000)
 

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/bitbang.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -25,19 +25,8 @@
 #endif
 
 #include "bitbang.h"
-
-/* project specific includes */
-#include "log.h"
-#include "types.h"
 #include "jtag.h"
-#include "configuration.h"
 
-/* system includes */
-#include <string.h>
-#include <stdlib.h>
-#include <unistd.h>
-
-
 /**
  * Function bitbang_stableclocks
  * issues a number of clock cycles while staying in a stable state.

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/bitq.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -23,17 +23,7 @@
 
 #include "bitq.h"
 
-/* project specific includes */
-#include "log.h"
-#include "types.h"
-#include "jtag.h"
-#include "configuration.h"
 
-/* system includes */
-#include <string.h>
-#include <stdlib.h>
-#include <unistd.h>
-
 bitq_interface_t* bitq_interface;       /* low level bit queue interface */
 
 static bitq_state_t      bitq_in_state;        /* state of input queue */

Modified: trunk/src/jtag/dummy.c
===================================================================
--- trunk/src/jtag/dummy.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/dummy.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -21,8 +21,6 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "jtag.h"
 #include "bitbang.h"
 

Modified: trunk/src/jtag/ep93xx.c
===================================================================
--- trunk/src/jtag/ep93xx.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/ep93xx.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -21,7 +21,6 @@
 #include "config.h"
 #endif
 
-#include "log.h"
 #include "jtag.h"
 #include "bitbang.h"
 
@@ -33,14 +32,7 @@
 #define SRST_BIT	32
 #define VCC_BIT		64
 
-/* system includes */
-#include <string.h>
-#include <stdlib.h>
-#include <stdio.h>
-#include <time.h>
 #include <sys/mman.h>
-#include <unistd.h>
-#include <fcntl.h>
 
 static u8 output_value = 0x0;
 static int dev_mem_fd;

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/ft2232.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -33,23 +33,14 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #if IS_CYGWIN == 1
 #include "windows.h"
 #endif
 
 /* project specific includes */
-#include "log.h"
-#include "types.h"
 #include "jtag.h"
-#include "configuration.h"
 #include "time_support.h"
 
-/* system includes */
-#include <string.h>
-#include <stdlib.h>
-#include <unistd.h>
 
 /* FT2232 access library includes */
 #if BUILD_FT2232_FTD2XX == 1

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/gw16012.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -21,10 +21,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "jtag.h"
 
+
 #if 1
 #define _DEBUG_GW16012_IO_
 #endif
@@ -40,14 +39,8 @@
 
 #else
 
-#ifdef _WIN32
-#include "errno.h"
-#endif /* _WIN32 */
-
 #endif /* __FreeBSD__, __FreeBSD_kernel__ */
 
-#include <string.h>
-#include <stdlib.h>
 
 #if PARPORT_USE_PPDEV == 1
 #if defined(__FreeBSD__) || defined(__FreeBSD_kernel__)
@@ -67,14 +60,10 @@
 #endif
 #endif
 
-#if PARPORT_USE_GIVEIO == 1
-#if IS_CYGWIN == 1
+#if PARPORT_USE_GIVEIO == 1 && IS_CYGWIN == 1
 #include <windows.h>
-#include <errno.h>
 #endif
-#endif
 
-#include "log.h"
 
 /* configuration */
 u16 gw16012_port;

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/jlink.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -25,15 +25,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "jtag.h"
 
 #include <usb.h>
-#include <string.h>
-#include <errno.h>
 
-#include "log.h"
 
 #define VID 0x1366
 #define PID 0x0101

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/jtag.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -28,16 +28,8 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "jtag.h"
 
-#include "command.h"
-#include "log.h"
-
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 #ifdef HAVE_STRINGS_H
 #include <strings.h>
 #endif

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/jtag.h	2009-05-11 04:04:58 UTC (rev 1707)
@@ -23,13 +23,10 @@
 #ifndef JTAG_H
 #define JTAG_H
 
-#include "types.h"
 #include "binarybuffer.h"
 #include "log.h"
 
-#include "command.h"
 
-
 #ifdef _DEBUG_JTAG_IO_
 #define DEBUG_JTAG_IO(expr ...)		LOG_DEBUG(expr)
 #else

Modified: trunk/src/jtag/parport.c
===================================================================
--- trunk/src/jtag/parport.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/parport.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -24,32 +24,17 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "jtag.h"
 #include "bitbang.h"
 
-/* system includes */
 /* -ino: 060521-1036 */
 #if defined(__FreeBSD__) || defined(__FreeBSD_kernel__)
-
 #include <machine/sysarch.h>
 #include <machine/cpufunc.h>
 #define ioperm(startport,length,enable)\
   i386_set_ioperm((startport), (length), (enable))
-
-#else
-
-#ifdef _WIN32
-#include "errno.h"
-#endif /* _WIN32 */
-
 #endif /* __FreeBSD__ */
 
-#include <string.h>
-#include <stdlib.h>
-#include <stdio.h>
-
 #if PARPORT_USE_PPDEV == 1
 #if defined(__FreeBSD__) || defined(__FreeBSD_kernel__)
 #include <dev/ppbus/ppi.h>
@@ -60,7 +45,6 @@
 #include <linux/parport.h>
 #include <linux/ppdev.h>
 #endif
-#include <fcntl.h>
 #include <sys/ioctl.h>
 #else /* not PARPORT_USE_PPDEV */
 #ifndef _WIN32
@@ -68,14 +52,10 @@
 #endif
 #endif
 
-#if PARPORT_USE_GIVEIO == 1
-#if IS_CYGWIN == 1
+#if PARPORT_USE_GIVEIO == 1 && IS_CYGWIN == 1
 #include <windows.h>
-#include <errno.h>
 #endif
-#endif
 
-#include "log.h"
 
 /* parallel port cable description
  */

Modified: trunk/src/jtag/presto.c
===================================================================
--- trunk/src/jtag/presto.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/presto.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -25,20 +25,10 @@
 #include "windows.h"
 #endif
 
-#include "replacements.h"
-
-/* project specific includes */
-#include "log.h"
-#include "types.h"
 #include "jtag.h"
-#include "configuration.h"
 #include "time_support.h"
 #include "bitq.h"
 
-/* system includes */
-#include <string.h>
-#include <stdlib.h>
-#include <unistd.h>
 
 /* PRESTO access library includes */
 #if BUILD_PRESTO_FTD2XX == 1

Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/rlink/rlink.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -27,23 +27,18 @@
 #include "config.h"
 #endif
 
-/* system includes */
-#include <errno.h>
-#include <string.h>
-#include <usb.h>
-#include <stdint.h>
-
 /* project specific includes */
-#include "log.h"
-#include "types.h"
 #include "jtag.h"
-#include "configuration.h"
 #include "rlink.h"
 #include "st7.h"
 #include "ep1_cmd.h"
 #include "dtc_cmd.h"
 
+/* system includes */
+#include <usb.h>
+#include <stdint.h>
 
+
 /* This feature is made useless by running the DTC all the time.  When automatic, the LED is on whenever the DTC is running.  Otherwise, USB messages are sent to turn it on and off. */
 #undef AUTOMATIC_BUSY_LED
 

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/usbprog.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -34,15 +34,11 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "jtag.h"
+
 #include <usb.h>
 
-/* system includes */
 
-#include "log.h"
-
 #define VID 0x1781
 #define PID 0x0c63
 

Modified: trunk/src/jtag/vsllink.c
===================================================================
--- trunk/src/jtag/vsllink.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/vsllink.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -26,14 +26,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "jtag.h"
 
 #include <usb.h>
-#include <string.h>
 
-#include "log.h"
 
 //#define _VSLLINK_IN_DEBUG_MODE_
 

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2009-05-11 03:59:02 UTC (rev 1706)
+++ trunk/src/jtag/zy1000.c	2009-05-11 04:04:58 UTC (rev 1707)
@@ -20,17 +20,12 @@
 #include "config.h"
 #endif
 
-
-#include "log.h"
-#include "jtag.h"
+#include "embeddedice.h"
 #include "bitbang.h"
-#include "../target/embeddedice.h"
 
-
 #include <cyg/hal/hal_io.h>             // low level i/o
 #include <cyg/hal/hal_diag.h>
 
-#include <stdlib.h>
 
 #define ZYLIN_VERSION "1.51"
 #define ZYLIN_DATE __DATE__



From zwelch at mail.berlios.de  Mon May 11 06:21:30 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 06:21:30 +0200
Subject: [Openocd-svn] r1708 - trunk/src/target
Message-ID: <200905110421.n4B4LUmX028451@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 06:21:24 +0200 (Mon, 11 May 2009)
New Revision: 1708

Modified:
   trunk/src/target/target_request.h
Log:
Fix compilation of target_request.h when it is included first.

Modified: trunk/src/target/target_request.h
===================================================================
--- trunk/src/target/target_request.h	2009-05-11 04:04:58 UTC (rev 1707)
+++ trunk/src/target/target_request.h	2009-05-11 04:21:24 UTC (rev 1708)
@@ -26,7 +26,7 @@
 #ifndef TARGET_REQUEST_H
 #define TARGET_REQUEST_H
 
-#include "command.h"
+#include "target.h"
 
 typedef enum target_req_cmd
 {



From zwelch at mail.berlios.de  Mon May 11 06:22:26 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 06:22:26 +0200
Subject: [Openocd-svn] r1709 - trunk/src/server
Message-ID: <200905110422.n4B4MQRE028515@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 06:22:15 +0200 (Mon, 11 May 2009)
New Revision: 1709

Modified:
   trunk/src/server/gdb_server.c
   trunk/src/server/gdb_server.h
   trunk/src/server/httpd.c
   trunk/src/server/server.c
   trunk/src/server/server.h
   trunk/src/server/tcl_server.c
   trunk/src/server/telnet_server.c
Log:
Audit and eliminate redundant #include directives from src/server.

Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2009-05-11 04:21:24 UTC (rev 1708)
+++ trunk/src/server/gdb_server.c	2009-05-11 04:22:15 UTC (rev 1709)
@@ -27,24 +27,14 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "gdb_server.h"
-
+#include "target_request.h"
+#include "register.h"
 #include "server.h"
-#include "log.h"
-#include "binarybuffer.h"
-#include "jtag.h"
-#include "breakpoints.h"
 #include "flash.h"
-#include "target.h"
-#include "target_request.h"
-#include "configuration.h"
+#include "image.h"
+#include "jtag.h"
 
-#include <string.h>
-#include <errno.h>
-#include <unistd.h>
-#include <stdlib.h>
 
 #if 0
 #define _DEBUG_GDB_IO_

Modified: trunk/src/server/gdb_server.h
===================================================================
--- trunk/src/server/gdb_server.h	2009-05-11 04:21:24 UTC (rev 1708)
+++ trunk/src/server/gdb_server.h	2009-05-11 04:22:15 UTC (rev 1709)
@@ -27,9 +27,9 @@
 #define GDB_SERVER_H
 
 #include "target.h"
-#include "server.h"
-#include "image.h"
 
+struct image_s;
+
 #define GDB_BUFFER_SIZE	16384
 
 typedef struct gdb_connection_s
@@ -39,7 +39,7 @@
 	int buf_cnt;
 	int ctrl_c;
 	enum target_state frontend_state;
-	image_t *vflash_image;
+	struct image_s *vflash_image;
 	int closed;
 	int busy;
 	int noack_mode;

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2009-05-11 04:21:24 UTC (rev 1708)
+++ trunk/src/server/httpd.c	2009-05-11 04:22:15 UTC (rev 1709)
@@ -27,30 +27,13 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
-#include "server.h"
-
-#include "log.h"
 #include "telnet_server.h"
 #include "target.h"
 
-#include <command.h>
-#include <string.h>
-#include <stdlib.h>
-#include <errno.h>
-#include <unistd.h>
-#include <fcntl.h>
+#include <microhttpd.h>
 #include <pthread.h>
 #include <signal.h>
 
-#include <sys/select.h>
-#include <sys/socket.h>
-#include <microhttpd.h>
-#include <stdlib.h>
-#include <string.h>
-#include <stdio.h>
-
 #define PAGE_NOT_FOUND "<html><head><title>File not found</title></head><body>File not found</body></html>"
 
 int loadFile(const char *name, void **data, size_t *len);

Modified: trunk/src/server/server.c
===================================================================
--- trunk/src/server/server.c	2009-05-11 04:21:24 UTC (rev 1708)
+++ trunk/src/server/server.c	2009-05-11 04:22:15 UTC (rev 1709)
@@ -27,25 +27,16 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "server.h"
-
-#include "log.h"
-#include "telnet_server.h"
 #include "target.h"
 
-#include <command.h>
-#include <string.h>
-#include <stdlib.h>
-#include <errno.h>
-#include <unistd.h>
-#include <fcntl.h>
 #include <signal.h>
+
 #ifndef _WIN32
 #include <netinet/tcp.h>
 #endif
 
+
 service_t *services = NULL;
 
 /* shutdown_openocd == 1: exit the main event loop, and quit the debugger */

Modified: trunk/src/server/server.h
===================================================================
--- trunk/src/server/server.h	2009-05-11 04:21:24 UTC (rev 1708)
+++ trunk/src/server/server.h	2009-05-11 04:22:15 UTC (rev 1709)
@@ -26,10 +26,12 @@
 #ifndef SERVER_H
 #define SERVER_H
 
-#include "command.h"
-#include "binarybuffer.h"
-#include "replacements.h"
+#include "log.h"
 
+#ifdef HAVE_NETINET_IN_H
+#include <netinet/in.h>
+#endif
+
 enum connection_type
 {
 	CONNECTION_TCP,

Modified: trunk/src/server/tcl_server.c
===================================================================
--- trunk/src/server/tcl_server.c	2009-05-11 04:21:24 UTC (rev 1708)
+++ trunk/src/server/tcl_server.c	2009-05-11 04:22:15 UTC (rev 1709)
@@ -21,18 +21,9 @@
 #include "config.h"
 #endif
 
-#include <stdarg.h>
 #include "tcl_server.h"
 
-#include "log.h"
-#include "command.h"
 
-#include <stdlib.h>
-#include <unistd.h>
-#include <errno.h>
-#include <string.h>
-#include <ctype.h>
-
 #define TCL_SERVER_VERSION	"TCL Server 0.1"
 #define TCL_MAX_LINE		(4096)
 

Modified: trunk/src/server/telnet_server.c
===================================================================
--- trunk/src/server/telnet_server.c	2009-05-11 04:21:24 UTC (rev 1708)
+++ trunk/src/server/telnet_server.c	2009-05-11 04:22:15 UTC (rev 1709)
@@ -27,22 +27,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "telnet_server.h"
-
-#include "server.h"
-#include "log.h"
-#include "command.h"
-#include "target.h"
 #include "target_request.h"
 
-#include <stdlib.h>
-#include <unistd.h>
-#include <errno.h>
-#include <string.h>
-#include <ctype.h>
-
 static unsigned short telnet_port = 0;
 
 int handle_exit_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);



From zwelch at mail.berlios.de  Mon May 11 06:25:17 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 06:25:17 +0200
Subject: [Openocd-svn] r1710 - in trunk/src: pld svf xsvf
Message-ID: <200905110425.n4B4PHaC028747@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 06:25:09 +0200 (Mon, 11 May 2009)
New Revision: 1710

Modified:
   trunk/src/pld/pld.c
   trunk/src/pld/virtex2.c
   trunk/src/pld/virtex2.h
   trunk/src/pld/xilinx_bit.c
   trunk/src/svf/svf.c
   trunk/src/xsvf/xsvf.c
Log:
Audit and eliminate redundant #include directives in src/{pld,svf,xsvf}.

Modified: trunk/src/pld/pld.c
===================================================================
--- trunk/src/pld/pld.c	2009-05-11 04:22:15 UTC (rev 1709)
+++ trunk/src/pld/pld.c	2009-05-11 04:25:09 UTC (rev 1710)
@@ -21,24 +21,11 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "pld.h"
-
-#include "jtag.h"
-#include "command.h"
 #include "log.h"
 #include "time_support.h"
 
-#include <stdlib.h>
-#include <unistd.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <string.h>
 
-#include <sys/time.h>
-#include <time.h>
-
 /* pld drivers
  */
 extern pld_driver_t virtex2_pld;

Modified: trunk/src/pld/virtex2.c
===================================================================
--- trunk/src/pld/virtex2.c	2009-05-11 04:22:15 UTC (rev 1709)
+++ trunk/src/pld/virtex2.c	2009-05-11 04:25:09 UTC (rev 1710)
@@ -22,14 +22,9 @@
 #endif
 
 #include "virtex2.h"
-
-#include "pld.h"
 #include "xilinx_bit.h"
-#include "command.h"
-#include "log.h"
-#include "jtag.h"
+#include "pld.h"
 
-#include <stdlib.h>
 
 int virtex2_register_commands(struct command_context_s *cmd_ctx);
 int virtex2_pld_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct pld_device_s *pld_device);

Modified: trunk/src/pld/virtex2.h
===================================================================
--- trunk/src/pld/virtex2.h	2009-05-11 04:22:15 UTC (rev 1709)
+++ trunk/src/pld/virtex2.h	2009-05-11 04:25:09 UTC (rev 1710)
@@ -20,9 +20,7 @@
 #ifndef VIRTEX2_H
 #define VIRTEX2_H
 
-#include "types.h"
-#include "pld.h"
-#include "xilinx_bit.h"
+#include "jtag.h"
 
 typedef struct virtex2_pld_device_s
 {

Modified: trunk/src/pld/xilinx_bit.c
===================================================================
--- trunk/src/pld/xilinx_bit.c	2009-05-11 04:22:15 UTC (rev 1709)
+++ trunk/src/pld/xilinx_bit.c	2009-05-11 04:25:09 UTC (rev 1710)
@@ -22,19 +22,11 @@
 #endif
 
 #include "xilinx_bit.h"
-
 #include "pld.h"
 #include "log.h"
 
-#include <stdlib.h>
-#include <unistd.h>
 #include <sys/stat.h>
-#include <fcntl.h>
-#include <string.h>
-#include <errno.h>
 
-#include <sys/time.h>
-#include <time.h>
 
 int read_section(FILE *input_file, int length_size, char section, u32 *buffer_length, u8 **buffer) 
 {

Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-11 04:22:15 UTC (rev 1709)
+++ trunk/src/svf/svf.c	2009-05-11 04:25:09 UTC (rev 1710)
@@ -33,22 +33,10 @@
 #endif
 
 #include "svf.h"
-
 #include "jtag.h"
-#include "command.h"
-#include "log.h"
 #include "time_support.h"
 
-#include <ctype.h>
-#include <stdlib.h>
-#include <unistd.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <string.h>
 
-#include <sys/time.h>
-#include <time.h>
-
 // SVF command
 typedef enum
 {

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-11 04:22:15 UTC (rev 1709)
+++ trunk/src/xsvf/xsvf.c	2009-05-11 04:25:09 UTC (rev 1710)
@@ -42,22 +42,11 @@
 #endif
 
 #include "xsvf.h"
-
 #include "jtag.h"
-#include "command.h"
-#include "log.h"
 
-#include <stdlib.h>
-#include <unistd.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <string.h>
 #include <assert.h>
 
-#include <sys/time.h>
-#include <time.h>
 
-
 /* XSVF commands, from appendix B of xapp503.pdf  */
 #define XCOMPLETE		0x00
 #define XTDOMASK			0x01



From zwelch at mail.berlios.de  Mon May 11 06:28:57 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 06:28:57 +0200
Subject: [Openocd-svn] r1711 - trunk/src/flash
Message-ID: <200905110428.n4B4SvBe029635@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 06:28:24 +0200 (Mon, 11 May 2009)
New Revision: 1711

Modified:
   trunk/src/flash/at91sam7.h
   trunk/src/flash/avrf.h
   trunk/src/flash/cfi.h
   trunk/src/flash/flash.h
   trunk/src/flash/lpc2000.h
   trunk/src/flash/lpc288x.h
   trunk/src/flash/mflash.h
   trunk/src/flash/non_cfi.h
   trunk/src/flash/pic32mx.h
   trunk/src/flash/s3c24xx_nand.h
   trunk/src/flash/stellaris.h
   trunk/src/flash/stm32x.h
   trunk/src/flash/str7x.h
   trunk/src/flash/str9x.h
   trunk/src/flash/str9xpec.h
Log:
Audit and eliminate redundant #include directives in src/flash headers.

Modified: trunk/src/flash/at91sam7.h
===================================================================
--- trunk/src/flash/at91sam7.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/at91sam7.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -24,7 +24,6 @@
 #define AT91SAM7_H
 
 #include "flash.h"
-#include "target.h"
 
 typedef struct at91sam7_flash_bank_s
 {

Modified: trunk/src/flash/avrf.h
===================================================================
--- trunk/src/flash/avrf.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/avrf.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -20,6 +20,8 @@
 #ifndef AVRF_H
 #define AVRF_H
 
+#include "types.h"
+
 typedef struct avrf_type_s
 {
 	char name[15];

Modified: trunk/src/flash/cfi.h
===================================================================
--- trunk/src/flash/cfi.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/cfi.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -21,7 +21,6 @@
 #define CFI_H
 
 #include "flash.h"
-#include "target.h"
 
 #define CFI_STATUS_POLL_MASK_DQ5_DQ6_DQ7 0xE0 /* DQ5..DQ7 */
 #define CFI_STATUS_POLL_MASK_DQ6_DQ7     0xC0 /* DQ6..DQ7 */

Modified: trunk/src/flash/flash.h
===================================================================
--- trunk/src/flash/flash.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/flash.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -27,8 +27,10 @@
 #define FLASH_H
 
 #include "target.h"
-#include "image.h"
+#include "log.h"
 
+struct image_s;
+
 #define FLASH_MAX_ERROR_STR	(128)
 
 typedef struct flash_sector_s
@@ -65,7 +67,7 @@
 
 typedef struct flash_bank_s
 {
-	target_t *target;
+	struct target_s *target;
 	flash_driver_t *driver;
 	void *driver_priv;
 	int bank_number;
@@ -81,8 +83,8 @@
 extern int flash_register_commands(struct command_context_s *cmd_ctx);
 extern int flash_init_drivers(struct command_context_s *cmd_ctx);
 
-extern int flash_erase_address_range(target_t *target, u32 addr, u32 length);
-extern int flash_write(target_t *target, image_t *image, u32 *written, int erase);
+extern int flash_erase_address_range(struct target_s *target, u32 addr, u32 length);
+extern int flash_write(struct target_s *target, struct image_s *image, u32 *written, int erase);
 extern void flash_set_dirty(void);
 extern int flash_get_bank_count(void);
 extern int default_flash_blank_check(struct flash_bank_s *bank);
@@ -90,7 +92,7 @@
 
 extern flash_bank_t *get_flash_bank_by_num(int num);
 extern flash_bank_t *get_flash_bank_by_num_noprobe(int num);
-extern flash_bank_t *get_flash_bank_by_addr(target_t *target, u32 addr);
+extern flash_bank_t *get_flash_bank_by_addr(struct target_s *target, u32 addr);
 
 #define ERROR_FLASH_BANK_INVALID			(-900)
 #define ERROR_FLASH_SECTOR_INVALID			(-901)

Modified: trunk/src/flash/lpc2000.h
===================================================================
--- trunk/src/flash/lpc2000.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/lpc2000.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -21,7 +21,6 @@
 #define LPC2000_H
 
 #include "flash.h"
-#include "target.h"
 
 typedef struct lpc2000_flash_bank_s
 {

Modified: trunk/src/flash/lpc288x.h
===================================================================
--- trunk/src/flash/lpc288x.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/lpc288x.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -22,7 +22,6 @@
 #define lpc288x_H
 
 #include "flash.h"
-#include "target.h"
 
 typedef struct lpc288x_flash_bank_s
 {

Modified: trunk/src/flash/mflash.h
===================================================================
--- trunk/src/flash/mflash.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/mflash.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -20,6 +20,8 @@
 #ifndef _MFLASH_H
 #define _MFLASH_H
 
+#include "target.h"
+
 typedef unsigned long mg_io_uint32;
 typedef unsigned short mg_io_uint16;
 typedef unsigned char mg_io_uint8;

Modified: trunk/src/flash/non_cfi.h
===================================================================
--- trunk/src/flash/non_cfi.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/non_cfi.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -20,7 +20,7 @@
 #ifndef NON_CFI_H
 #define NON_CFI_H
 
-#include "types.h"
+#include "flash.h"
 
 typedef struct non_cfi_s
 {

Modified: trunk/src/flash/pic32mx.h
===================================================================
--- trunk/src/flash/pic32mx.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/pic32mx.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -27,7 +27,6 @@
 #define PIC32MX_H
 
 #include "flash.h"
-#include "target.h"
 
 typedef struct pic32mx_flash_bank_s
 {

Modified: trunk/src/flash/s3c24xx_nand.h
===================================================================
--- trunk/src/flash/s3c24xx_nand.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/s3c24xx_nand.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -24,7 +24,7 @@
  * Many thanks to Simtec Electronics for sponsoring this work.
  */
 
-#include "target.h"
+#include "nand.h"
 #include "s3c24xx_regs_nand.h"
 
 typedef struct s3c24xx_nand_controller_s

Modified: trunk/src/flash/stellaris.h
===================================================================
--- trunk/src/flash/stellaris.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/stellaris.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -21,7 +21,6 @@
 #define STELLARIS_FLASH_H
 
 #include "flash.h"
-#include "target.h"
 
 typedef struct stellaris_flash_bank_s
 {

Modified: trunk/src/flash/stm32x.h
===================================================================
--- trunk/src/flash/stm32x.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/stm32x.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -24,7 +24,6 @@
 #define STM32X_H
 
 #include "flash.h"
-#include "target.h"
 
 typedef struct stm32x_options_s
 {

Modified: trunk/src/flash/str7x.h
===================================================================
--- trunk/src/flash/str7x.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/str7x.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -24,7 +24,6 @@
 #define STR7X_H
 
 #include "flash.h"
-#include "target.h"
 
 typedef struct str7x_flash_bank_s
 {

Modified: trunk/src/flash/str9x.h
===================================================================
--- trunk/src/flash/str9x.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/str9x.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -24,7 +24,6 @@
 #define STR9X_H
 
 #include "flash.h"
-#include "target.h"
 
 typedef struct str9x_flash_bank_s
 {

Modified: trunk/src/flash/str9xpec.h
===================================================================
--- trunk/src/flash/str9xpec.h	2009-05-11 04:25:09 UTC (rev 1710)
+++ trunk/src/flash/str9xpec.h	2009-05-11 04:28:24 UTC (rev 1711)
@@ -24,7 +24,6 @@
 #define STR9XPEC_H
 
 #include "flash.h"
-#include "target.h"
 #include "jtag.h"
 
 typedef struct str9xpec_flash_controller_s



From zwelch at mail.berlios.de  Mon May 11 06:31:42 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 06:31:42 +0200
Subject: [Openocd-svn] r1712 - trunk/src/flash
Message-ID: <200905110431.n4B4VgPu030849@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 06:30:41 +0200 (Mon, 11 May 2009)
New Revision: 1712

Modified:
   trunk/src/flash/aduc702x.c
   trunk/src/flash/at91sam7.c
   trunk/src/flash/avrf.c
   trunk/src/flash/cfi.c
   trunk/src/flash/ecos.c
   trunk/src/flash/flash.c
   trunk/src/flash/lpc2000.c
   trunk/src/flash/lpc288x.c
   trunk/src/flash/lpc3180_nand_controller.c
   trunk/src/flash/mflash.c
   trunk/src/flash/nand.c
   trunk/src/flash/nand_ecc.c
   trunk/src/flash/non_cfi.c
   trunk/src/flash/ocl.c
   trunk/src/flash/orion_nand.c
   trunk/src/flash/pic32mx.c
   trunk/src/flash/s3c2410_nand.c
   trunk/src/flash/s3c2412_nand.c
   trunk/src/flash/s3c2440_nand.c
   trunk/src/flash/s3c2443_nand.c
   trunk/src/flash/s3c24xx_nand.c
   trunk/src/flash/stellaris.c
   trunk/src/flash/stm32x.c
   trunk/src/flash/str7x.c
   trunk/src/flash/str9x.c
   trunk/src/flash/str9xpec.c
   trunk/src/flash/tms470.c
Log:
Audit and eliminate redundant #include directives in src/flash sources.

Modified: trunk/src/flash/aduc702x.c
===================================================================
--- trunk/src/flash/aduc702x.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/aduc702x.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -23,18 +23,11 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-#include "time_support.h"
 #include "flash.h"
-#include "target.h"
-#include "log.h"
 #include "armv4_5.h"
-#include "algorithm.h"
 #include "binarybuffer.h"
+#include "time_support.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
 static int aduc702x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
 static int aduc702x_register_commands(struct command_context_s *cmd_ctx);

Modified: trunk/src/flash/at91sam7.c
===================================================================
--- trunk/src/flash/at91sam7.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/at91sam7.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -39,19 +39,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "at91sam7.h"
-
-#include "flash.h"
-#include "target.h"
-#include "log.h"
 #include "binarybuffer.h"
-#include "types.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
 static int at91sam7_register_commands(struct command_context_s *cmd_ctx);
 static int at91sam7_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);

Modified: trunk/src/flash/avrf.c
===================================================================
--- trunk/src/flash/avrf.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/avrf.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -21,18 +21,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "avrf.h"
 #include "avrt.h"
 #include "flash.h"
-#include "target.h"
-#include "log.h"
-#include "algorithm.h"
-#include "binarybuffer.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 /* AVR_JTAG_Instructions */
 #define AVR_JTAG_INS_LEN							4

Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/cfi.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -23,22 +23,11 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "cfi.h"
 #include "non_cfi.h"
-
-#include "flash.h"
-#include "target.h"
-#include "log.h"
 #include "armv4_5.h"
-#include "algorithm.h"
 #include "binarybuffer.h"
-#include "types.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
 static int cfi_register_commands(struct command_context_s *cmd_ctx);
 static int cfi_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);

Modified: trunk/src/flash/ecos.c
===================================================================
--- trunk/src/flash/ecos.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/ecos.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -21,21 +21,11 @@
 #include "config.h"
 #endif
 
-#include <string.h>
-
-#include "replacements.h"
-
 #include "flash.h"
+#include "embeddedice.h"
+#include "image.h"
 
-#include "target.h"
 
-#include "flash.h"
-#include "target.h"
-#include "log.h"
-#include "binarybuffer.h"
-#include "../target/embeddedice.h"
-#include "types.h"
-
 static int ecosflash_register_commands(struct command_context_s *cmd_ctx);
 static int ecosflash_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
 static int ecosflash_erase(struct flash_bank_s *bank, int first, int last);

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/flash.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -28,22 +28,9 @@
 #endif
 
 #include "flash.h"
-#include "command.h"
-#include "target.h"
-#include "time_support.h"
-#include "fileio.h"
 #include "image.h"
-#include "log.h"
-#include "armv4_5.h"
-#include "algorithm.h"
-#include "binarybuffer.h"
-#include "armv7m.h"
+#include "time_support.h"
 
-#include <string.h>
-#include <unistd.h>
-#include <stdlib.h>
-#include <sys/stat.h>
-#include <errno.h>
 #include <inttypes.h>
 
 /* command handlers */

Modified: trunk/src/flash/lpc2000.c
===================================================================
--- trunk/src/flash/lpc2000.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/lpc2000.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -23,16 +23,9 @@
 #endif
 
 #include "lpc2000.h"
-
-#include "flash.h"
-#include "target.h"
-#include "log.h"
 #include "armv4_5.h"
-#include "algorithm.h"
 #include "binarybuffer.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 /* flash programming support for Philips LPC2xxx devices
  * currently supported devices:

Modified: trunk/src/flash/lpc288x.c
===================================================================
--- trunk/src/flash/lpc288x.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/lpc288x.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -31,19 +31,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "lpc288x.h"
-
-#include "flash.h"
-#include "target.h"
-#include "log.h"
 #include "binarybuffer.h"
-#include "types.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
 #define LOAD_TIMER_ERASE	0
 #define LOAD_TIMER_WRITE	1

Modified: trunk/src/flash/lpc3180_nand_controller.c
===================================================================
--- trunk/src/flash/lpc3180_nand_controller.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/lpc3180_nand_controller.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -22,15 +22,7 @@
 #endif
 
 #include "lpc3180_nand_controller.h"
-
-#include "replacements.h"
-#include "log.h"
-
-#include <stdlib.h>
-#include <string.h>
-
 #include "nand.h"
-#include "target.h"
 
 static int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
 static int lpc3180_register_commands(struct command_context_s *cmd_ctx);

Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/mflash.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -21,21 +21,12 @@
 #include "config.h"
 #endif
 
-#include <ctype.h>
-#include <string.h>
-#include <unistd.h>
-#include <stdlib.h>
-#include <sys/stat.h>
-#include <errno.h>
-#include <inttypes.h>
-
-#include "command.h"
-#include "log.h"
-#include "target.h"
+#include "mflash.h"
 #include "time_support.h"
 #include "fileio.h"
-#include "mflash.h"
+#include "log.h"
 
+
 static int s3c2440_set_gpio_to_output (mflash_gpio_num_t gpio);
 static int s3c2440_set_gpio_output_val (mflash_gpio_num_t gpio, u8 val);
 static int pxa270_set_gpio_to_output (mflash_gpio_num_t gpio);

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/nand.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -24,21 +24,13 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-#include "log.h"
-
-#include <stdlib.h>
-#include <string.h>
-#include <inttypes.h>
-
-#include <errno.h>
-
 #include "nand.h"
-#include "flash.h"
 #include "time_support.h"
 #include "fileio.h"
-#include "image.h"
 
+#include <inttypes.h>
+
+
 static int handle_nand_list_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int handle_nand_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int handle_nand_check_bad_blocks_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);

Modified: trunk/src/flash/nand_ecc.c
===================================================================
--- trunk/src/flash/nand_ecc.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/nand_ecc.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -41,10 +41,6 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
-#include <inttypes.h>
-
 #include "nand.h"
 
 /*

Modified: trunk/src/flash/non_cfi.c
===================================================================
--- trunk/src/flash/non_cfi.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/non_cfi.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -23,14 +23,10 @@
 #include "config.h"
 #endif
 
-#include <stdlib.h>
-
-#include "log.h"
-
-#include "flash.h"
-#include "cfi.h"
 #include "non_cfi.h"
+#include "cfi.h"
 
+
 #define KB 1024
 #define MB (1024*1024)
 #define ERASE_REGION(num, size) (((size/256)<<16)|(num-1))

Modified: trunk/src/flash/ocl.c
===================================================================
--- trunk/src/flash/ocl.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/ocl.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -21,21 +21,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "ocl.h"
-
 #include "flash.h"
-#include "target.h"
-#include "log.h"
-#include "binarybuffer.h"
-#include "types.h"
 #include "embeddedice.h"
-#include "arm7_9_common.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
 static int ocl_register_commands(struct command_context_s *cmd_ctx);
 static int ocl_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);

Modified: trunk/src/flash/orion_nand.c
===================================================================
--- trunk/src/flash/orion_nand.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/orion_nand.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -26,17 +26,11 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-#include "log.h"
-
-#include <stdlib.h>
-#include <string.h>
-
 #include "nand.h"
-#include "target.h"
 #include "armv4_5.h"
 #include "binarybuffer.h"
 
+
 typedef struct orion_nand_controller_s
 {
 	struct target_s	*target;

Modified: trunk/src/flash/pic32mx.c
===================================================================
--- trunk/src/flash/pic32mx.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/pic32mx.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -27,18 +27,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "pic32mx.h"
-#include "flash.h"
-#include "target.h"
-#include "log.h"
 #include "mips32.h"
-#include "algorithm.h"
-#include "binarybuffer.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 static
 struct pic32mx_devs_s {

Modified: trunk/src/flash/s3c2410_nand.c
===================================================================
--- trunk/src/flash/s3c2410_nand.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/s3c2410_nand.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -28,16 +28,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-#include "log.h"
-
-#include <stdlib.h>
-#include <string.h>
-
-#include "nand.h"
 #include "s3c24xx_nand.h"
-#include "target.h"
 
+
 static int s3c2410_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
 static int s3c2410_init(struct nand_device_s *device);
 static int s3c2410_read_data(struct nand_device_s *device, void *data);

Modified: trunk/src/flash/s3c2412_nand.c
===================================================================
--- trunk/src/flash/s3c2412_nand.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/s3c2412_nand.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -28,16 +28,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-#include "log.h"
-
-#include <stdlib.h>
-#include <string.h>
-
-#include "nand.h"
 #include "s3c24xx_nand.h"
-#include "target.h"
 
+
 static int s3c2412_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
 static int s3c2412_init(struct nand_device_s *device);
 

Modified: trunk/src/flash/s3c2440_nand.c
===================================================================
--- trunk/src/flash/s3c2440_nand.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/s3c2440_nand.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -28,16 +28,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-#include "log.h"
-
-#include <stdlib.h>
-#include <string.h>
-
-#include "nand.h"
 #include "s3c24xx_nand.h"
-#include "target.h"
 
+
 static int s3c2440_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
 static int s3c2440_init(struct nand_device_s *device);
 //static int s3c2440_nand_ready(struct nand_device_s *device, int timeout);

Modified: trunk/src/flash/s3c2443_nand.c
===================================================================
--- trunk/src/flash/s3c2443_nand.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/s3c2443_nand.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -28,16 +28,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-#include "log.h"
-
-#include <stdlib.h>
-#include <string.h>
-
-#include "nand.h"
 #include "s3c24xx_nand.h"
-#include "target.h"
 
+
 static int s3c2443_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
 static int s3c2443_init(struct nand_device_s *device);
 

Modified: trunk/src/flash/s3c24xx_nand.c
===================================================================
--- trunk/src/flash/s3c24xx_nand.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/s3c24xx_nand.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -28,16 +28,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-#include "log.h"
-
-#include <stdlib.h>
-#include <string.h>
-
-#include "nand.h"
 #include "s3c24xx_nand.h"
-#include "target.h"
 
+
 s3c24xx_nand_controller_t *
 s3c24xx_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
 			    char **args, int argc,

Modified: trunk/src/flash/stellaris.c
===================================================================
--- trunk/src/flash/stellaris.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/stellaris.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -28,20 +28,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "stellaris.h"
-#include "cortex_m3.h"
-
-#include "flash.h"
-#include "target.h"
-#include "log.h"
+#include "armv7m.h"
 #include "binarybuffer.h"
-#include "types.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
 #define DID0_VER(did0) ((did0>>28)&0x07)
 static int stellaris_register_commands(struct command_context_s *cmd_ctx);

Modified: trunk/src/flash/stm32x.c
===================================================================
--- trunk/src/flash/stm32x.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/stm32x.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -24,18 +24,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "stm32x.h"
-#include "flash.h"
-#include "target.h"
-#include "log.h"
 #include "armv7m.h"
-#include "algorithm.h"
 #include "binarybuffer.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 static int stm32x_register_commands(struct command_context_s *cmd_ctx);
 static int stm32x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);

Modified: trunk/src/flash/str7x.c
===================================================================
--- trunk/src/flash/str7x.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/str7x.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -24,19 +24,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "str7x.h"
-#include "flash.h"
-#include "target.h"
-#include "log.h"
 #include "armv4_5.h"
-#include "algorithm.h"
 #include "binarybuffer.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
 str7x_mem_layout_t mem_layout_str7bank0[] = {
 	{0x00000000, 0x02000, 0x01},

Modified: trunk/src/flash/str9x.c
===================================================================
--- trunk/src/flash/str9x.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/str9x.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -27,20 +27,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "str9x.h"
-#include "flash.h"
-#include "target.h"
-#include "log.h"
-#include "armv4_5.h"
 #include "arm966e.h"
-#include "algorithm.h"
-#include "binarybuffer.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
 static u32 bank1start = 0x00080000;
 

Modified: trunk/src/flash/str9xpec.c
===================================================================
--- trunk/src/flash/str9xpec.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/str9xpec.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -24,21 +24,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "str9xpec.h"
-#include "flash.h"
-#include "target.h"
-#include "log.h"
-#include "armv4_5.h"
 #include "arm7_9_common.h"
-#include "jtag.h"
-#include "binarybuffer.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
-#include <getopt.h>
 
 static int str9xpec_register_commands(struct command_context_s *cmd_ctx);
 static int str9xpec_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);

Modified: trunk/src/flash/tms470.c
===================================================================
--- trunk/src/flash/tms470.c	2009-05-11 04:28:24 UTC (rev 1711)
+++ trunk/src/flash/tms470.c	2009-05-11 04:30:41 UTC (rev 1712)
@@ -21,11 +21,9 @@
 #include "config.h"
 #endif
 
-#include "log.h"
 #include "tms470.h"
-#include <string.h>
-#include <unistd.h>
 
+
 static int tms470_register_commands(struct command_context_s *cmd_ctx);
 static int tms470_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
 static int tms470_erase(struct flash_bank_s *bank, int first, int last);



From zwelch at mail.berlios.de  Mon May 11 06:38:29 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 06:38:29 +0200
Subject: [Openocd-svn] r1713 - trunk/src/target
Message-ID: <200905110438.n4B4cT9S002538@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 06:38:18 +0200 (Mon, 11 May 2009)
New Revision: 1713

Modified:
   trunk/src/target/breakpoints.h
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Audit and eliminate redundant #include directives in core target files.

Modified: trunk/src/target/breakpoints.h
===================================================================
--- trunk/src/target/breakpoints.h	2009-05-11 04:30:41 UTC (rev 1712)
+++ trunk/src/target/breakpoints.h	2009-05-11 04:38:18 UTC (rev 1713)
@@ -20,7 +20,7 @@
 #ifndef BREAKPOINTS_H
 #define BREAKPOINTS_H
 
-#include "target.h"
+#include "types.h"
 
 struct target_s;
 

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-11 04:30:41 UTC (rev 1712)
+++ trunk/src/target/target.c	2009-05-11 04:38:18 UTC (rev 1713)
@@ -33,31 +33,17 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
 #include "target.h"
 #include "target_request.h"
-
-#include "log.h"
-#include "configuration.h"
-#include "binarybuffer.h"
+#include "time_support.h"
+#include "register.h"
+#include "trace.h"
+#include "image.h"
 #include "jtag.h"
 
-#include <string.h>
-#include <stdlib.h>
 #include <inttypes.h>
 
-#include <sys/stat.h>
-#include <unistd.h>
-#include <errno.h>
 
-#include <sys/time.h>
-#include <time.h>
-
-#include <time_support.h>
-
-#include <fileio.h>
-#include <image.h>
-
 static int handle_targets_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 static int handle_reg_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-11 04:30:41 UTC (rev 1712)
+++ trunk/src/target/target.h	2009-05-11 04:38:18 UTC (rev 1713)
@@ -26,19 +26,16 @@
 #ifndef TARGET_H
 #define TARGET_H
 
-#include "register.h"
 #include "breakpoints.h"
 #include "algorithm.h"
-#include "trace.h"
-
 #include "command.h"
-#include "types.h"
 
-#include <sys/time.h>
-#include <time.h>
+#include "replacements.h"
 
 struct reg_s;
+struct trace_s;
 struct command_context_s;
+
 /*
  * TARGET_UNKNOWN = 0: we don't know anything about the target yet
  * TARGET_RUNNING = 1: the target is executing user code



From zwelch at mail.berlios.de  Mon May 11 06:47:22 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 06:47:22 +0200
Subject: [Openocd-svn] r1714 - trunk/src/target
Message-ID: <200905110447.n4B4lMfb008922@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 06:46:21 +0200 (Mon, 11 May 2009)
New Revision: 1714

Modified:
   trunk/src/target/arm11.c
   trunk/src/target/arm11.h
   trunk/src/target/arm11_dbgtap.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm720t.h
   trunk/src/target/arm7_9_common.c
   trunk/src/target/arm7_9_common.h
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm7tdmi.h
   trunk/src/target/arm920t.c
   trunk/src/target/arm920t.h
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm926ejs.h
   trunk/src/target/arm966e.c
   trunk/src/target/arm966e.h
   trunk/src/target/arm9tdmi.c
   trunk/src/target/arm9tdmi.h
   trunk/src/target/arm_adi_v5.c
   trunk/src/target/arm_disassembler.c
   trunk/src/target/arm_jtag.c
   trunk/src/target/arm_jtag.h
   trunk/src/target/arm_simulator.c
   trunk/src/target/arm_simulator.h
   trunk/src/target/armv4_5.c
   trunk/src/target/armv4_5_cache.c
   trunk/src/target/armv4_5_cache.h
   trunk/src/target/armv4_5_mmu.c
   trunk/src/target/armv4_5_mmu.h
   trunk/src/target/armv7m.c
   trunk/src/target/armv7m.h
Log:
Audit and eliminate redundant #include directives in arm target files.

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm11.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -26,11 +26,7 @@
 #endif
 
 #include "arm11.h"
-#include "jtag.h"
-#include "log.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 #if 0
 #define _DEBUG_INSTRUCTION_EXECUTION_

Modified: trunk/src/target/arm11.h
===================================================================
--- trunk/src/target/arm11.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm11.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -22,11 +22,7 @@
 #ifndef ARM11_H
 #define ARM11_H
 
-#include "target.h"
-#include "register.h"
 #include "embeddedice.h"
-#include "arm_jtag.h"
-#include "types.h"
 
 #define asizeof(x)	(sizeof(x) / sizeof((x)[0]))
 

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm11_dbgtap.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -24,11 +24,7 @@
 #endif
 
 #include "arm11.h"
-#include "jtag.h"
-#include "log.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 #if 0
 #define JTAG_DEBUG(expr ...)	DEBUG(expr)

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm720t.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -22,12 +22,8 @@
 #endif
 
 #include "arm720t.h"
-#include "jtag.h"
-#include "log.h"
 #include "time_support.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 #if 0
 #define _DEBUG_INSTRUCTION_EXECUTION_

Modified: trunk/src/target/arm720t.h
===================================================================
--- trunk/src/target/arm720t.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm720t.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -20,13 +20,8 @@
 #ifndef ARM720T_H
 #define ARM720T_H
 
-#include "target.h"
-#include "register.h"
-#include "embeddedice.h"
-#include "arm_jtag.h"
 #include "arm7tdmi.h"
 #include "armv4_5_mmu.h"
-#include "armv4_5_cache.h"
 
 #define	ARM720T_COMMON_MAGIC 0xa720a720
 

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm7_9_common.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -30,28 +30,13 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "embeddedice.h"
-#include "target.h"
 #include "target_request.h"
-#include "armv4_5.h"
-#include "arm_jtag.h"
-#include "jtag.h"
-#include "log.h"
 #include "arm7_9_common.h"
-#include "breakpoints.h"
 #include "time_support.h"
 #include "arm_simulator.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
-#include <sys/stat.h>
-#include <sys/time.h>
-#include <errno.h>
-
 int arm7_9_debug_entry(target_t *target);
 int arm7_9_enable_sw_bkpts(struct target_s *target);
 

Modified: trunk/src/target/arm7_9_common.h
===================================================================
--- trunk/src/target/arm7_9_common.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm7_9_common.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -29,11 +29,7 @@
 #ifndef ARM7_9_COMMON_H
 #define ARM7_9_COMMON_H
 
-#include "armv4_5.h"
-#include "arm_jtag.h"
 #include "breakpoints.h"
-#include "target.h"
-
 #include "etm.h"
 
 #define	ARM7_9_COMMON_MAGIC 0x0a790a79

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm7tdmi.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -29,19 +29,7 @@
 
 #include "arm7tdmi.h"
 
-#include "arm7_9_common.h"
-#include "register.h"
-#include "target.h"
-#include "armv4_5.h"
-#include "embeddedice.h"
-#include "etm.h"
-#include "log.h"
-#include "jtag.h"
-#include "arm_jtag.h"
 
-#include <stdlib.h>
-#include <string.h>
-
 #if 0
 #define _DEBUG_INSTRUCTION_EXECUTION_
 #endif

Modified: trunk/src/target/arm7tdmi.h
===================================================================
--- trunk/src/target/arm7tdmi.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm7tdmi.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -23,12 +23,7 @@
 #ifndef ARM7TDMI_H
 #define ARM7TDMI_H
 
-#include "target.h"
-#include "register.h"
-#include "armv4_5.h"
 #include "embeddedice.h"
-#include "arm_jtag.h"
-#include "arm7_9_common.h"
 
 #define	ARM7TDMI_COMMON_MAGIC 0x00a700a7
 

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm920t.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -22,12 +22,8 @@
 #endif
 
 #include "arm920t.h"
-#include "jtag.h"
-#include "log.h"
 #include "time_support.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 #if 0
 #define _DEBUG_INSTRUCTION_EXECUTION_

Modified: trunk/src/target/arm920t.h
===================================================================
--- trunk/src/target/arm920t.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm920t.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -20,13 +20,8 @@
 #ifndef ARM920T_H
 #define ARM920T_H
 
-#include "target.h"
-#include "register.h"
-#include "embeddedice.h"
-#include "arm_jtag.h"
 #include "arm9tdmi.h"
 #include "armv4_5_mmu.h"
-#include "armv4_5_cache.h"
 
 #define	ARM920T_COMMON_MAGIC 0xa920a920
 

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm926ejs.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -22,12 +22,8 @@
 #endif
 
 #include "arm926ejs.h"
-#include "jtag.h"
-#include "log.h"
 #include "time_support.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 #if 0
 #define _DEBUG_INSTRUCTION_EXECUTION_

Modified: trunk/src/target/arm926ejs.h
===================================================================
--- trunk/src/target/arm926ejs.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm926ejs.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -20,13 +20,8 @@
 #ifndef ARM926EJS_H
 #define ARM926EJS_H
 
-#include "target.h"
-#include "register.h"
-#include "embeddedice.h"
-#include "arm_jtag.h"
 #include "arm9tdmi.h"
 #include "armv4_5_mmu.h"
-#include "armv4_5_cache.h"
 
 #define	ARM926EJS_COMMON_MAGIC 0xa926a926
 

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm966e.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -26,18 +26,7 @@
 
 #include "arm966e.h"
 
-#include "arm7_9_common.h"
-#include "register.h"
-#include "target.h"
-#include "armv4_5.h"
-#include "embeddedice.h"
-#include "log.h"
-#include "jtag.h"
-#include "arm_jtag.h"
 
-#include <stdlib.h>
-#include <string.h>
-
 #if 0
 #define _DEBUG_INSTRUCTION_EXECUTION_
 #endif

Modified: trunk/src/target/arm966e.h
===================================================================
--- trunk/src/target/arm966e.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm966e.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -23,10 +23,6 @@
 #ifndef ARM966E_H
 #define ARM966E_H
 
-#include "target.h"
-#include "register.h"
-#include "embeddedice.h"
-#include "arm_jtag.h"
 #include "arm9tdmi.h"
 
 #define	ARM966E_COMMON_MAGIC 0x20f920f9

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm9tdmi.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -29,20 +29,7 @@
 
 #include "arm9tdmi.h"
 
-#include "arm7_9_common.h"
-#include "register.h"
-#include "target.h"
-#include "armv4_5.h"
-#include "embeddedice.h"
-#include "etm.h"
-#include "etb.h"
-#include "log.h"
-#include "jtag.h"
-#include "arm_jtag.h"
 
-#include <stdlib.h>
-#include <string.h>
-
 #if 0
 #define _DEBUG_INSTRUCTION_EXECUTION_
 #endif

Modified: trunk/src/target/arm9tdmi.h
===================================================================
--- trunk/src/target/arm9tdmi.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm9tdmi.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -23,12 +23,7 @@
 #ifndef ARM9TDMI_H
 #define ARM9TDMI_H
 
-#include "target.h"
-#include "register.h"
-#include "armv4_5.h"
 #include "embeddedice.h"
-#include "arm_jtag.h"
-#include "arm7_9_common.h"
 
 #define	ARM9TDMI_COMMON_MAGIC 0x00a900a9
 

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm_adi_v5.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -38,14 +38,8 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "arm_adi_v5.h"
-#include "jtag.h"
-#include "log.h"
 #include "time_support.h"
-#include <stdlib.h>
-#include <string.h>
 
 /*
  * Transaction Mode:

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm_disassembler.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -22,10 +22,8 @@
 #endif
 
 #include "arm_disassembler.h"
-
 #include "log.h"
 
-#include <string.h>
 
 /* textual represenation of the condition field */
 /* ALways (default) is ommitted (empty string) */

Modified: trunk/src/target/arm_jtag.c
===================================================================
--- trunk/src/target/arm_jtag.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm_jtag.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -26,12 +26,7 @@
 
 #include "arm_jtag.h"
 
-#include "binarybuffer.h"
-#include "log.h"
-#include "jtag.h"
 
-#include <stdlib.h>
-
 #if 0
 #define _ARM_JTAG_SCAN_N_CHECK_
 #endif

Modified: trunk/src/target/arm_jtag.h
===================================================================
--- trunk/src/target/arm_jtag.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm_jtag.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -23,7 +23,6 @@
 #ifndef ARM_JTAG
 #define ARM_JTAG
 
-#include "types.h"
 #include "jtag.h"
 
 typedef struct arm_jtag_s

Modified: trunk/src/target/arm_simulator.c
===================================================================
--- trunk/src/target/arm_simulator.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm_simulator.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -24,14 +24,12 @@
 #include "config.h"
 #endif
 
-#include "target.h"
 #include "armv4_5.h"
 #include "arm_disassembler.h"
 #include "arm_simulator.h"
 #include "log.h"
 #include "binarybuffer.h"
 
-#include <string.h>
 
 u32 arm_shift(u8 shift, u32 Rm, u32 shift_amount, u8 *carry)
 {

Modified: trunk/src/target/arm_simulator.h
===================================================================
--- trunk/src/target/arm_simulator.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/arm_simulator.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -20,11 +20,11 @@
 #ifndef ARM_SIMULATOR_H
 #define ARM_SIMULATOR_H
 
-#include "target.h"
 #include "types.h"
 
-extern int arm_simulate_step(target_t *target, u32 *dry_run_pc);
+struct target_s;
 
+extern int arm_simulate_step(struct target_s *target, u32 *dry_run_pc);
 
 #define ERROR_ARM_SIMULATOR_NOT_IMPLEMENTED	(-700)
 

Modified: trunk/src/target/armv4_5.c
===================================================================
--- trunk/src/target/armv4_5.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/armv4_5.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -27,21 +27,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
-#include "arm_disassembler.h"
-
 #include "armv4_5.h"
-
-#include "target.h"
-#include "register.h"
-#include "log.h"
+#include "arm_disassembler.h"
 #include "binarybuffer.h"
-#include "command.h"
 
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
 
 bitfield_desc_t armv4_5_psr_bitfield_desc[] =
 {

Modified: trunk/src/target/armv4_5_cache.c
===================================================================
--- trunk/src/target/armv4_5_cache.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/armv4_5_cache.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -22,9 +22,7 @@
 #endif
 
 #include "armv4_5_cache.h"
-
 #include "log.h"
-#include "command.h"
 
 int armv4_5_identify_cache(u32 cache_type_reg, armv4_5_cache_common_t *cache)
 {

Modified: trunk/src/target/armv4_5_cache.h
===================================================================
--- trunk/src/target/armv4_5_cache.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/armv4_5_cache.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -21,8 +21,9 @@
 #define ARMV4_5_CACHE_H
 
 #include "types.h"
-#include "command.h"
 
+struct command_context_s;
+
 typedef struct armv4_5_cachesize_s
 {
 	int linelen;

Modified: trunk/src/target/armv4_5_mmu.c
===================================================================
--- trunk/src/target/armv4_5_mmu.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/armv4_5_mmu.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -21,13 +21,9 @@
 #include "config.h"
 #endif
 
-#include "arm7_9_common.h"
 #include "log.h"
-#include "command.h"
 #include "armv4_5_mmu.h"
-#include "target.h"
 
-#include <stdlib.h>
 
 u32 armv4mmu_translate_va(target_t *target, armv4_5_mmu_common_t *armv4_5_mmu, u32 va, int *type, u32 *cb, int *domain, u32 *ap);
 

Modified: trunk/src/target/armv4_5_mmu.h
===================================================================
--- trunk/src/target/armv4_5_mmu.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/armv4_5_mmu.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -21,6 +21,7 @@
 #define ARMV4_5_MMU_H
 
 #include "armv4_5_cache.h"
+#include "target.h"
 
 typedef struct armv4_5_mmu_common_s
 {

Modified: trunk/src/target/armv7m.c
===================================================================
--- trunk/src/target/armv7m.c	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/armv7m.c	2009-05-11 04:46:21 UTC (rev 1714)
@@ -30,17 +30,8 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "armv7m.h"
-#include "register.h"
-#include "target.h"
-#include "log.h"
-#include "jtag.h"
-#include "arm_jtag.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 #if 0
 #define _DEBUG_INSTRUCTION_EXECUTION_

Modified: trunk/src/target/armv7m.h
===================================================================
--- trunk/src/target/armv7m.h	2009-05-11 04:38:18 UTC (rev 1713)
+++ trunk/src/target/armv7m.h	2009-05-11 04:46:21 UTC (rev 1714)
@@ -26,9 +26,6 @@
 #ifndef ARMV7M_COMMON_H
 #define ARMV7M_COMMON_H
 
-#include "register.h"
-#include "target.h"
-#include "arm_jtag.h"
 #include "arm_adi_v5.h"
 
 /* define for enabling armv7 gdb workarounds */



From zwelch at mail.berlios.de  Mon May 11 06:57:32 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 06:57:32 +0200
Subject: [Openocd-svn] r1715 - trunk/src/target
Message-ID: <200905110457.n4B4vWH4016735@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 06:56:37 +0200 (Mon, 11 May 2009)
New Revision: 1715

Modified:
   trunk/src/target/algorithm.c
   trunk/src/target/avrt.c
   trunk/src/target/avrt.h
   trunk/src/target/breakpoints.c
   trunk/src/target/cortex_a8.c
   trunk/src/target/cortex_m3.c
   trunk/src/target/embeddedice.c
   trunk/src/target/embeddedice.h
   trunk/src/target/etb.c
   trunk/src/target/etb.h
   trunk/src/target/etm.c
   trunk/src/target/etm.h
   trunk/src/target/etm_dummy.c
   trunk/src/target/etm_dummy.h
   trunk/src/target/feroceon.c
   trunk/src/target/image.c
   trunk/src/target/image.h
   trunk/src/target/mips32.c
   trunk/src/target/mips32.h
   trunk/src/target/mips32_dmaacc.c
   trunk/src/target/mips32_pracc.c
   trunk/src/target/mips_ejtag.c
   trunk/src/target/mips_ejtag.h
   trunk/src/target/mips_m4k.c
   trunk/src/target/mips_m4k.h
   trunk/src/target/oocd_trace.c
   trunk/src/target/oocd_trace.h
   trunk/src/target/register.c
   trunk/src/target/register.h
   trunk/src/target/target_request.c
   trunk/src/target/trace.c
   trunk/src/target/trace.h
   trunk/src/target/xscale.c
   trunk/src/target/xscale.h
Log:
Audit and eliminate redundant #include directives in other target files.

Modified: trunk/src/target/algorithm.c
===================================================================
--- trunk/src/target/algorithm.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/algorithm.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -22,14 +22,10 @@
 #endif
 
 #include "algorithm.h"
-
-#include "log.h"
-#include "configuration.h"
+#include "replacements.h"
 #include "binarybuffer.h"
 
-#include <stdlib.h>
 
-
 void init_mem_param(mem_param_t *param, u32 address, u32 size, enum param_direction direction)
 {
 	param->address = address;

Modified: trunk/src/target/avrt.c
===================================================================
--- trunk/src/target/avrt.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/avrt.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -21,27 +21,12 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "avrt.h"
-
-#include "register.h"
 #include "target.h"
-#include "log.h"
-#include "jtag.h"
-#include "binarybuffer.h"
-#include "time_support.h"
-#include "breakpoints.h"
-#include "fileio.h"
 
-#include <stdlib.h>
-#include <string.h>
 
-#include <unistd.h>
-#include <errno.h>
+#define AVR_JTAG_INS_LEN	4
 
-#define AVR_JTAG_INS_LEN							4
-
 /* cli handling */
 int avr_register_commands(struct command_context_s *cmd_ctx);
 

Modified: trunk/src/target/avrt.h
===================================================================
--- trunk/src/target/avrt.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/avrt.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -20,6 +20,8 @@
 #ifndef AVRT_H
 #define AVRT_H
 
+#include "jtag.h"
+
 typedef struct mcu_jtag_s
 {
 	jtag_tap_t *tap;

Modified: trunk/src/target/breakpoints.c
===================================================================
--- trunk/src/target/breakpoints.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/breakpoints.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -21,15 +21,11 @@
 #include "config.h"
 #endif
 
-#include <stdlib.h>
-
-#include "binarybuffer.h"
 #include "target.h"
 #include "log.h"
-#include "types.h"
-
 #include "breakpoints.h"
 
+
 static char *breakpoint_type_strings[] =
 {
 	"hardware",

Modified: trunk/src/target/cortex_a8.c
===================================================================
--- trunk/src/target/cortex_a8.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/cortex_a8.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -33,20 +33,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "cortex_a8.h"
-#include "armv7m.h"
-
-#include "register.h"
-#include "target.h"
 #include "target_request.h"
-#include "log.h"
-#include "jtag.h"
-#include "arm_jtag.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 /* cli handling */
 int cortex_a8_register_commands(struct command_context_s *cmd_ctx);

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/cortex_m3.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -31,20 +31,9 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "cortex_m3.h"
-#include "armv7m.h"
-
-#include "register.h"
-#include "target.h"
 #include "target_request.h"
-#include "log.h"
-#include "jtag.h"
-#include "arm_jtag.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 /* cli handling */
 int cortex_m3_register_commands(struct command_context_s *cmd_ctx);

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/embeddedice.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -29,19 +29,7 @@
 
 #include "embeddedice.h"
 
-#include "armv4_5.h"
-#include "arm7_9_common.h"
 
-#include "log.h"
-#include "arm_jtag.h"
-#include "types.h"
-#include "binarybuffer.h"
-#include "target.h"
-#include "register.h"
-#include "jtag.h"
-
-#include <stdlib.h>
-
 #if 0
 static bitfield_desc_t embeddedice_comms_ctrl_bitfield_desc[] =
 {

Modified: trunk/src/target/embeddedice.h
===================================================================
--- trunk/src/target/embeddedice.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/embeddedice.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -26,9 +26,6 @@
 #ifndef EMBEDDED_ICE_H
 #define EMBEDDED_ICE_H
 
-#include "target.h"
-#include "register.h"
-#include "arm_jtag.h"
 #include "arm7_9_common.h"
 
 enum

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/etb.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -21,21 +21,10 @@
 #include "config.h"
 #endif
 
-#include <string.h>
-
 #include "arm7_9_common.h"
 #include "etb.h"
-#include "etm.h"
 
-#include "log.h"
-#include "types.h"
-#include "binarybuffer.h"
-#include "target.h"
-#include "register.h"
-#include "jtag.h"
 
-#include <stdlib.h>
-
 static char* etb_reg_list[] =
 {
 	"ETB_identification",

Modified: trunk/src/target/etb.h
===================================================================
--- trunk/src/target/etb.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/etb.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -20,12 +20,6 @@
 #ifndef ETB_H
 #define ETB_H
 
-#include "command.h"
-#include "target.h"
-#include "register.h"
-#include "arm_jtag.h"
-
-#include "etb.h"
 #include "etm.h"
 
 /* ETB registers */

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/etm.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -21,27 +21,13 @@
 #include "config.h"
 #endif
 
-#include <string.h>
-
 #include "etm.h"
 #include "etb.h"
-
-#include "armv4_5.h"
+#include "image.h"
 #include "arm7_9_common.h"
 #include "arm_disassembler.h"
-#include "arm_simulator.h"
 
-#include "log.h"
-#include "arm_jtag.h"
-#include "types.h"
-#include "binarybuffer.h"
-#include "target.h"
-#include "register.h"
-#include "jtag.h"
-#include "fileio.h"
 
-#include <stdlib.h>
-
 /* ETM register access functionality
  *
  */

Modified: trunk/src/target/etm.h
===================================================================
--- trunk/src/target/etm.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/etm.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -23,14 +23,12 @@
 #ifndef ETM_H
 #define ETM_H
 
-#include "image.h"
 #include "trace.h"
-#include "target.h"
-#include "register.h"
 #include "arm_jtag.h"
-
 #include "armv4_5.h"
 
+struct image_s;
+
 /* ETM registers (V1.3 protocol) */
 enum
 {
@@ -152,7 +150,7 @@
 	etm_portmode_t portmode;		/* normal, multiplexed or demultiplexed */
 	etmv1_tracemode_t tracemode;	/* type of information the trace contains (data, addres, contextID, ...) */
 	armv4_5_state_t core_state;		/* current core state (ARM, Thumb, Jazelle) */
-	image_t *image;					/* source for target opcodes */
+	struct image_s *image;					/* source for target opcodes */
 	u32 pipe_index;					/* current trace cycle */
 	u32 data_index;					/* cycle holding next data packet */
 	int data_half;					/* port half on a 16 bit port */

Modified: trunk/src/target/etm_dummy.c
===================================================================
--- trunk/src/target/etm_dummy.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/etm_dummy.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -21,20 +21,9 @@
 #include "config.h"
 #endif
 
-#include <string.h>
-
 #include "etm_dummy.h"
-#include "etm.h"
-
 #include "arm7_9_common.h"
-#include "log.h"
-#include "types.h"
-#include "binarybuffer.h"
-#include "target.h"
-#include "register.h"
-#include "jtag.h"
 
-#include <stdlib.h>
 
 static int handle_etm_dummy_config_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {

Modified: trunk/src/target/etm_dummy.h
===================================================================
--- trunk/src/target/etm_dummy.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/etm_dummy.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -20,11 +20,6 @@
 #ifndef ETM_DUMMY_H
 #define ETM_DUMMY_H
 
-#include "command.h"
-#include "target.h"
-#include "register.h"
-#include "arm_jtag.h"
-
 #include "etm.h"
 
 extern etm_capture_driver_t etm_dummy_capture_driver;

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/feroceon.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -50,11 +50,7 @@
 #endif
 
 #include "arm926ejs.h"
-#include "jtag.h"
-#include "log.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 int feroceon_examine(struct target_s *target);
 int feroceon_target_create(struct target_s *target, Jim_Interp *interp);

Modified: trunk/src/target/image.c
===================================================================
--- trunk/src/target/image.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/image.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -27,20 +27,10 @@
 #include "config.h"
 #endif
 
-#include <stdlib.h>
-#include <string.h>
-#ifdef HAVE_ELF_H
-#include <elf.h>
-#endif
-
 #include "image.h"
-
-#include "types.h"
-#include "replacements.h"
+#include "target.h"
 #include "log.h"
 
-#include "fileio.h"
-#include "target.h"
 
 /* convert ELF header field to host endianness */
 #define field16(elf,field)\

Modified: trunk/src/target/image.h
===================================================================
--- trunk/src/target/image.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/image.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -26,16 +26,11 @@
 #ifndef IMAGE_H
 #define IMAGE_H
 
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
+#include "fileio.h"
 
 #ifdef HAVE_ELF_H
 #include <elf.h>
 #endif
-#include "replacements.h"
-#include "fileio.h"
-#include "target.h"
 
 #define IMAGE_MAX_ERROR_STRING		(256)
 #define IMAGE_MAX_SECTIONS			(128)
@@ -85,7 +80,7 @@
 
 typedef struct image_memory_s
 {
-	target_t *target;
+	struct target_s *target;
 	u8 *cache;
 	u32 cache_address;
 } image_memory_t;

Modified: trunk/src/target/mips32.c
===================================================================
--- trunk/src/target/mips32.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/mips32.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -27,11 +27,7 @@
 #endif
 
 #include "mips32.h"
-#include "jtag.h"
-#include "log.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 char* mips32_core_reg_list[] =
 {

Modified: trunk/src/target/mips32.h
===================================================================
--- trunk/src/target/mips32.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/mips32.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -25,9 +25,9 @@
 
 #include "target.h"
 #include "register.h"
-#include "mips_ejtag.h"
 #include "mips32_pracc.h"
 
+
 #define MIPS32_COMMON_MAGIC		0xB320B320
 
 /* offsets into mips32 core register cache */
@@ -69,7 +69,7 @@
 typedef struct mips32_core_reg_s
 {
 	u32 num;
-	target_t *target;
+	struct target_s *target;
 	mips32_common_t *mips32_common;
 } mips32_core_reg_t;
 

Modified: trunk/src/target/mips32_dmaacc.c
===================================================================
--- trunk/src/target/mips32_dmaacc.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/mips32_dmaacc.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -26,11 +26,9 @@
 #include "config.h"
 #endif
 
-#include <string.h>
-#include "log.h"
-#include "mips32.h"
 #include "mips32_dmaacc.h"
 
+
 /*
  * The following logic shamelessly cloned from HairyDairyMaid's wrt54g_debrick
  * to support the Broadcom BCM5352 SoC in the Linksys WRT54GL wireless router

Modified: trunk/src/target/mips32_pracc.c
===================================================================
--- trunk/src/target/mips32_pracc.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/mips32_pracc.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -74,8 +74,6 @@
 #include "config.h"
 #endif
 
-#include <string.h>
-#include "log.h"
 #include "mips32.h"
 #include "mips32_pracc.h"
 

Modified: trunk/src/target/mips_ejtag.c
===================================================================
--- trunk/src/target/mips_ejtag.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/mips_ejtag.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -26,12 +26,7 @@
 #include "mips32.h"
 #include "mips_ejtag.h"
 
-#include "binarybuffer.h"
-#include "log.h"
-#include "jtag.h"
 
-#include <stdlib.h>
-
 int mips_ejtag_set_instr(mips_ejtag_t *ejtag_info, int new_instr, void *delete_me_and_submit_patch)
 {
 	jtag_tap_t *tap;

Modified: trunk/src/target/mips_ejtag.h
===================================================================
--- trunk/src/target/mips_ejtag.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/mips_ejtag.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -23,7 +23,6 @@
 #ifndef MIPS_EJTAG
 #define MIPS_EJTAG
 
-#include "types.h"
 #include "jtag.h"
 
 /* tap instructions */

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/mips_m4k.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -26,11 +26,7 @@
 #include "mips32.h"
 #include "mips_m4k.h"
 #include "mips32_dmaacc.h"
-#include "jtag.h"
-#include "log.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 /* cli handling */
 

Modified: trunk/src/target/mips_m4k.h
===================================================================
--- trunk/src/target/mips_m4k.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/mips_m4k.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -23,9 +23,10 @@
 #ifndef MIPS_M4K_H
 #define MIPS_M4K_H
 
-#include "register.h"
-#include "target.h"
+#include "types.h"
 
+struct target_s;
+
 #define MIPSM4K_COMMON_MAGIC	0xB321B321
 
 typedef struct mips_m4k_common_s
@@ -34,7 +35,7 @@
 	mips32_common_t mips32_common;
 } mips_m4k_common_t;
 
-extern int mips_m4k_bulk_write_memory(target_t *target, u32 address, u32 count, u8 *buffer);
+extern int mips_m4k_bulk_write_memory(struct target_s *target, u32 address, u32 count, u8 *buffer);
 
 extern void mips_m4k_enable_breakpoints(struct target_s *target);
 extern int mips_m4k_set_breakpoint(struct target_s *target, breakpoint_t *breakpoint);

Modified: trunk/src/target/oocd_trace.c
===================================================================
--- trunk/src/target/oocd_trace.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/oocd_trace.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -21,25 +21,14 @@
 #include "config.h"
 #endif
 
+// we must define _GNU_SOURCE to get strndup
 #ifndef _GNU_SOURCE
 #define _GNU_SOURCE
 #endif
-#include <string.h>
-#include <errno.h>
 
 #include "oocd_trace.h"
-#include "etm.h"
-
-#include "log.h"
-#include "types.h"
-#include "binarybuffer.h"
-#include "target.h"
-#include "register.h"
-#include "jtag.h"
 #include "arm7_9_common.h"
-#include "replacements.h"
 
-#include <stdlib.h>
 
 static int oocd_trace_register_commands(struct command_context_s *cmd_ctx);
 

Modified: trunk/src/target/oocd_trace.h
===================================================================
--- trunk/src/target/oocd_trace.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/oocd_trace.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -20,12 +20,9 @@
 #ifndef OOCD_TRACE_H
 #define OOCD_TRACE_H
 
-#include "command.h"
-
 #include "etm.h"
 
 #include <termios.h>
-#include <unistd.h>
 
 /* registers */
 enum

Modified: trunk/src/target/register.c
===================================================================
--- trunk/src/target/register.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/register.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -25,12 +25,8 @@
 #endif
 
 #include "register.h"
-
 #include "log.h"
-#include "command.h"
 
-#include <string.h>
-#include <stdlib.h>
 
 reg_arch_type_t *reg_arch_types = NULL;
 

Modified: trunk/src/target/register.h
===================================================================
--- trunk/src/target/register.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/register.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -24,7 +24,6 @@
 #define REGISTER_H
 
 #include "types.h"
-#include "target.h"
 
 struct target_s;
 

Modified: trunk/src/target/target_request.c
===================================================================
--- trunk/src/target/target_request.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/target_request.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -27,16 +27,11 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-#include "log.h"
-#include "target.h"
 #include "target_request.h"
 #include "binarybuffer.h"
-#include "command.h"
 #include "trace.h"
+#include "log.h"
 
-#include <stdlib.h>
-#include <string.h>
 
 static command_t *target_request_cmd = NULL;
 static int charmsg_mode = 0;

Modified: trunk/src/target/trace.c
===================================================================
--- trunk/src/target/trace.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/trace.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -21,14 +21,10 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
 #include "log.h"
 #include "trace.h"
 #include "target.h"
-#include "command.h"
 
-#include <stdlib.h>
-#include <string.h>
 #include <inttypes.h>
 
 int trace_point(target_t *target, u32 number)

Modified: trunk/src/target/trace.h
===================================================================
--- trunk/src/target/trace.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/trace.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -20,10 +20,11 @@
 #ifndef TRACE_H
 #define TRACE_H
 
-#include "target.h"
-#include "command.h"
 #include "types.h"
 
+struct target_s;
+struct command_context_s;
+
 typedef struct trace_point_s
 {
 	u32 address;

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/xscale.c	2009-05-11 04:56:37 UTC (rev 1715)
@@ -24,30 +24,13 @@
 #include "config.h"
 #endif
 
-#include "replacements.h"
-
 #include "xscale.h"
-
 #include "arm7_9_common.h"
-#include "register.h"
-#include "target.h"
-#include "armv4_5.h"
 #include "arm_simulator.h"
 #include "arm_disassembler.h"
-#include "log.h"
-#include "jtag.h"
-#include "binarybuffer.h"
 #include "time_support.h"
-#include "breakpoints.h"
-#include "fileio.h"
+#include "image.h"
 
-#include <stdlib.h>
-#include <string.h>
-
-#include <unistd.h>
-#include <errno.h>
-
-
 /* cli handling */
 int xscale_register_commands(struct command_context_s *cmd_ctx);
 

Modified: trunk/src/target/xscale.h
===================================================================
--- trunk/src/target/xscale.h	2009-05-11 04:46:21 UTC (rev 1714)
+++ trunk/src/target/xscale.h	2009-05-11 04:56:37 UTC (rev 1715)
@@ -23,12 +23,9 @@
 #ifndef XSCALE_H
 #define XSCALE_H
 
-#include "target.h"
-#include "register.h"
 #include "armv4_5.h"
 #include "armv4_5_mmu.h"
 #include "trace.h"
-#include "image.h"
 
 #define	XSCALE_COMMON_MAGIC 0x58534341
 
@@ -77,7 +74,7 @@
 typedef struct xscale_trace_s
 {
 	trace_status_t capture_status;	/* current state of capture run */
-	image_t *image;					/* source for target opcodes */
+	struct image_s *image;					/* source for target opcodes */
 	xscale_trace_data_t *data;		/* linked list of collected trace data */
 	int buffer_enabled;				/* whether trace buffer is enabled */
 	int buffer_fill;				/* maximum number of trace runs to read (-1 for wrap-around) */



From zwelch at mail.berlios.de  Mon May 11 07:00:38 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 07:00:38 +0200
Subject: [Openocd-svn] r1716 - trunk/src
Message-ID: <200905110500.n4B50cDB018669@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 07:00:17 +0200 (Mon, 11 May 2009)
New Revision: 1716

Modified:
   trunk/src/ecosboard.c
   trunk/src/openocd.c
Log:
Audit and eliminate redundant #include directives in main src/ files.

Modified: trunk/src/ecosboard.c
===================================================================
--- trunk/src/ecosboard.c	2009-05-11 04:56:37 UTC (rev 1715)
+++ trunk/src/ecosboard.c	2009-05-11 05:00:17 UTC (rev 1716)
@@ -21,68 +21,54 @@
 #include "config.h"
 #endif
 
-#include "log.h"
-#include "types.h"
-#include "jtag.h"
 #include "configuration.h"
+#include "time_support.h"
+
+#include "jtag.h"
 #include "xsvf.h"
 #include "svf.h"
 #include "target.h"
 #include "flash.h"
 #include "nand.h"
 #include "pld.h"
+#include "rom.h"
 
-#include "command.h"
 #include "server.h"
 #include "telnet_server.h"
 #include "gdb_server.h"
 
-#include <time_support.h>
-#include <sys/time.h>
-#include <strings.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
-#include <errno.h>
-
-#include <cyg/io/flash.h>
 #include <pkgconf/fs_jffs2.h>	// Address of JFFS2
 #include <network.h>
 
-#include <fcntl.h>
-#include <sys/stat.h>
-#include <cyg/fileio/fileio.h>
+#include <arpa/inet.h>
 #include <dirent.h>
+#include <net/if.h>
+#include <netdb.h>
+#include <netinet/tcp.h>
+#include <stdarg.h>
+#include <sys/ioctl.h>
+#include <sys/stat.h>
+
 #include <cyg/athttpd/http.h>
 #include <cyg/athttpd/socket.h>
 #include <cyg/athttpd/handler.h>
 #include <cyg/athttpd/cgi.h>
 #include <cyg/athttpd/forms.h>
 #include <cyg/discover/discover.h>
+#include <cyg/fileio/fileio.h>
 #include <cyg/hal/hal_diag.h>
-#include <cyg/kernel/kapi.h>
+#include <cyg/io/flash.h>
 #include <cyg/io/serialio.h>
 #include <cyg/io/io.h>
-#include <netinet/tcp.h>
-#include "rom.h"
-#include <sys/ioctl.h>
-#include <sys/socket.h>
-#include <netinet/in.h>
-#include <net/if.h>
-#include <arpa/inet.h>
-#include <sys/types.h>
-#include <sys/socket.h>
-#include <netdb.h>
-#include <netinet/in.h>
-#include <unistd.h>
-#include <arpa/inet.h>
-#include <stdio.h>
+#include <cyg/kernel/kapi.h>
+
+#ifdef HAVE_IFADDRS_H
 #include <ifaddrs.h>
-#include <string.h>
+#endif
+#ifdef HAVE_STRINGS_H
+#include <strings.h>
+#endif
 
-#include <unistd.h>
-#include <stdio.h>
 #define MAX_IFS 64
 #if defined(CYGPKG_NET_FREEBSD_STACK)
 #include <tftp_support.h>
@@ -1096,20 +1082,7 @@
 #include <cyg/kernel/ktypes.h>         // base kernel types
 #include <cyg/infra/cyg_trac.h>        // tracing macros
 #include <cyg/infra/cyg_ass.h>         // assertion macros
-#include <unistd.h>
-#include <sys/types.h>
-#include <fcntl.h>
-#include <sys/stat.h>
-#include <errno.h>
-#include <dirent.h>
-
-#include <stdarg.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-
 #include <cyg/fileio/fileio.h>
-
 #include <cyg/kernel/kapi.h>
 #include <cyg/infra/diag.h>
 

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-05-11 04:56:37 UTC (rev 1715)
+++ trunk/src/openocd.c	2009-05-11 05:00:17 UTC (rev 1716)
@@ -28,8 +28,6 @@
 #include "config.h"
 #endif
 
-#include "log.h"
-#include "types.h"
 #include "jtag.h"
 #include "configuration.h"
 #include "xsvf.h"
@@ -40,19 +38,14 @@
 #include "pld.h"
 #include "mflash.h"
 
-#include "command.h"
 #include "server.h"
 #include "telnet_server.h"
 #include "gdb_server.h"
 #include "tcl_server.h"
 
-#include <sys/time.h>
+#ifdef HAVE_STRINGS_H
 #include <strings.h>
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
-#include <errno.h>
+#endif
 
 
 #define OPENOCD_VERSION \



From zwelch at mail.berlios.de  Mon May 11 07:33:44 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 07:33:44 +0200
Subject: [Openocd-svn] r1717 - trunk/src/helper
Message-ID: <200905110533.n4B5Xif4011491@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 07:33:39 +0200 (Mon, 11 May 2009)
New Revision: 1717

Modified:
   trunk/src/helper/replacements.h
Log:
Remove redundant config.h from replacements.h, obtained from types.h.

Modified: trunk/src/helper/replacements.h
===================================================================
--- trunk/src/helper/replacements.h	2009-05-11 05:00:17 UTC (rev 1716)
+++ trunk/src/helper/replacements.h	2009-05-11 05:33:39 UTC (rev 1717)
@@ -26,10 +26,6 @@
 #ifndef REPLACEMENTS_H
 #define REPLACEMENTS_H
 
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
 #include "types.h"
 #include "system.h"
 



From zwelch at mail.berlios.de  Mon May 11 07:50:27 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 07:50:27 +0200
Subject: [Openocd-svn] r1718 - trunk/src/helper
Message-ID: <200905110550.n4B5oReQ023206@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 07:50:21 +0200 (Mon, 11 May 2009)
New Revision: 1718

Modified:
   trunk/src/helper/log.c
   trunk/src/helper/options.c
Log:
Mark API layering violations in the helper module with @todo notes.

Modified: trunk/src/helper/log.c
===================================================================
--- trunk/src/helper/log.c	2009-05-11 05:33:39 UTC (rev 1717)
+++ trunk/src/helper/log.c	2009-05-11 05:50:21 UTC (rev 1718)
@@ -29,6 +29,7 @@
 
 #include "log.h"
 #include "time_support.h"
+// @todo the inclusion of server.h here is a layering violation
 #include "server.h"
 
 #include <stdarg.h>

Modified: trunk/src/helper/options.c
===================================================================
--- trunk/src/helper/options.c	2009-05-11 05:33:39 UTC (rev 1717)
+++ trunk/src/helper/options.c	2009-05-11 05:50:21 UTC (rev 1718)
@@ -26,6 +26,7 @@
 
 #include "configuration.h"
 #include "log.h"
+// @todo the inclusion of server.h here is a layering violation
 #include "server.h"
 
 #include <getopt.h>



From zwelch at mail.berlios.de  Mon May 11 08:33:07 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 08:33:07 +0200
Subject: [Openocd-svn] r1719 - trunk
Message-ID: <200905110633.n4B6X7Ne024246@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 08:32:59 +0200 (Mon, 11 May 2009)
New Revision: 1719

Modified:
   trunk/Doxyfile
Log:
Update Doxyfile configuration for doxygen 1.5.8:
- Enable doxygen's C language optimizations.
- Use dot command (from graphviz package) to generate visual graphs.


Modified: trunk/Doxyfile
===================================================================
--- trunk/Doxyfile	2009-05-11 05:50:21 UTC (rev 1718)
+++ trunk/Doxyfile	2009-05-11 06:32:59 UTC (rev 1719)
@@ -1,4 +1,4 @@
-# Doxyfile 1.5.5
+# Doxyfile 1.5.8
 
 # This file describes the settings to be used by the documentation system
 # doxygen (www.doxygen.org) for a project
@@ -57,8 +57,8 @@
 # Croatian, Czech, Danish, Dutch, Farsi, Finnish, French, German, Greek,
 # Hungarian, Italian, Japanese, Japanese-en (Japanese with English messages),
 # Korean, Korean-en, Lithuanian, Norwegian, Macedonian, Persian, Polish,
-# Portuguese, Romanian, Russian, Serbian, Slovak, Slovene, Spanish, Swedish,
-# and Ukrainian.
+# Portuguese, Romanian, Russian, Serbian, Serbian-Cyrilic, Slovak, Slovene, 
+# Spanish, Swedish, and Ukrainian.
 
 OUTPUT_LANGUAGE        = English
 
@@ -155,13 +155,6 @@
 
 MULTILINE_CPP_IS_BRIEF = NO
 
-# If the DETAILS_AT_TOP tag is set to YES then Doxygen
-# will output the detailed description near the top, like JavaDoc.
-# If set to NO, the detailed description appears after the member
-# documentation.
-
-DETAILS_AT_TOP         = YES
-
 # If the INHERIT_DOCS tag is set to YES (the default) then an undocumented
 # member inherits the documentation from any documented member that it
 # re-implements.
@@ -193,7 +186,7 @@
 # For instance, some of the names that are used will be different. The list
 # of all members will be omitted, etc.
 
-OPTIMIZE_OUTPUT_FOR_C  = NO
+OPTIMIZE_OUTPUT_FOR_C  = YES
 
 # Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java
 # sources only. Doxygen will then generate output that is more tailored for
@@ -214,6 +207,17 @@
 
 OPTIMIZE_OUTPUT_VHDL   = NO
 
+# Doxygen selects the parser to use depending on the extension of the files it parses. 
+# With this tag you can assign which parser to use for a given extension. 
+# Doxygen has a built-in mapping, but you can override or extend it using this tag. 
+# The format is ext=language, where ext is a file extension, and language is one of 
+# the parsers supported by doxygen: IDL, Java, Javascript, C#, C, C++, D, PHP, 
+# Objective-C, Python, Fortran, VHDL, C, C++. For instance to make doxygen treat 
+# .inc files as Fortran files (default is PHP), and .f files as C (default is Fortran), 
+# use: inc=Fortran f=C
+
+EXTENSION_MAPPING      = 
+
 # If you use STL classes (i.e. std::string, std::vector, etc.) but do not want
 # to include (a tag file for) the STL sources as input, then you should
 # set this tag to YES in order to let doxygen match functions declarations and
@@ -234,6 +238,15 @@
 
 SIP_SUPPORT            = NO
 
+# For Microsoft's IDL there are propget and propput attributes to indicate getter 
+# and setter methods for a property. Setting this option to YES (the default) 
+# will make doxygen to replace the get and set methods by a property in the 
+# documentation. This will only work if the methods are indeed getting or 
+# setting a simple type. If this is not the case, or you want to show the 
+# methods anyway, you should set this option to NO.
+
+IDL_PROPERTY_SUPPORT   = NO
+
 # If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC
 # tag is set to YES, then doxygen will reuse the documentation of the first
 # member in the group (if any) for the other members of the group. By default
@@ -259,6 +272,22 @@
 
 TYPEDEF_HIDES_STRUCT   = NO
 
+# The SYMBOL_CACHE_SIZE determines the size of the internal cache use to 
+# determine which symbols to keep in memory and which to flush to disk. 
+# When the cache is full, less often used symbols will be written to disk. 
+# For small to medium size projects (<1000 input files) the default value is 
+# probably good enough. For larger projects a too small cache size can cause 
+# doxygen to be busy swapping symbols to and from disk most of the time 
+# causing a significant performance penality. 
+# If the system has enough physical memory increasing the cache will improve the 
+# performance by keeping more symbols in memory. Note that the value works on 
+# a logarithmic scale so increasing the size by one will rougly double the 
+# memory usage. The cache size is given by this formula: 
+# 2^(16+SYMBOL_CACHE_SIZE). The valid range is 0..9, the default is 0, 
+# corresponding to a cache size of 2^16 = 65536 symbols
+
+SYMBOL_CACHE_SIZE      = 0
+
 #---------------------------------------------------------------------------
 # Build related configuration options
 #---------------------------------------------------------------------------
@@ -443,6 +472,19 @@
 
 SHOW_DIRECTORIES       = YES
 
+# Set the SHOW_FILES tag to NO to disable the generation of the Files page. 
+# This will remove the Files entry from the Quick Index and from the 
+# Folder Tree View (if specified). The default is YES.
+
+SHOW_FILES             = YES
+
+# Set the SHOW_NAMESPACES tag to NO to disable the generation of the 
+# Namespaces page. 
+# This will remove the Namespaces entry from the Quick Index 
+# and from the Folder Tree View (if specified). The default is YES.
+
+SHOW_NAMESPACES        = YES
+
 # The FILE_VERSION_FILTER tag can be used to specify a program or script that
 # doxygen should invoke to get the current version for each file (typically from
 # the version control system). Doxygen will invoke the program by executing (via
@@ -453,6 +495,15 @@
 
 FILE_VERSION_FILTER    =
 
+# The LAYOUT_FILE tag can be used to specify a layout file which will be parsed by 
+# doxygen. The layout file controls the global structure of the generated output files 
+# in an output format independent way. The create the layout file that represents 
+# doxygen's defaults, run doxygen with the -l option. You can optionally specify a 
+# file name after the option, if omitted DoxygenLayout.xml will be used as the name 
+# of the layout file.
+
+LAYOUT_FILE            = 
+
 #---------------------------------------------------------------------------
 # configuration options related to warning and progress messages
 #---------------------------------------------------------------------------
@@ -513,7 +564,7 @@
 # directories like "/usr/src/myproject". Separate the files or directories
 # with spaces.
 
-INPUT                  = src
+INPUT                  = config.h src
 
 # This tag can be used to specify the character encoding of the source files
 # that doxygen parses. Internally doxygen uses the UTF-8 encoding, which is
@@ -598,14 +649,17 @@
 # by executing (via popen()) the command <filter> <input-file>, where <filter>
 # is the value of the INPUT_FILTER tag, and <input-file> is the name of an
 # input file. Doxygen will then use the output that the filter program writes
-# to standard output.  If FILTER_PATTERNS is specified, this tag will be
+# to standard output. 
+# If FILTER_PATTERNS is specified, this tag will be 
 # ignored.
 
 INPUT_FILTER           =
 
 # The FILTER_PATTERNS tag can be used to specify filters on a per file pattern
-# basis.  Doxygen will compare the file name with each pattern and apply the
-# filter if there is a match.  The filters are a list of the form:
+# basis. 
+# Doxygen will compare the file name with each pattern and apply the 
+# filter if there is a match. 
+# The filters are a list of the form: 
 # pattern=filter (like *.cpp=my_cpp_filter). See INPUT_FILTER for further
 # info on how filters are used. If FILTER_PATTERNS is empty, INPUT_FILTER
 # is applied to all files.
@@ -640,13 +694,13 @@
 
 STRIP_CODE_COMMENTS    = YES
 
-# If the REFERENCED_BY_RELATION tag is set to YES (the default)
+# If the REFERENCED_BY_RELATION tag is set to YES 
 # then for each documented function all documented
 # functions referencing it will be listed.
 
 REFERENCED_BY_RELATION = YES
 
-# If the REFERENCES_RELATION tag is set to YES (the default)
+# If the REFERENCES_RELATION tag is set to YES 
 # then for each documented function all documented entities
 # called/used by that function will be listed.
 
@@ -655,7 +709,8 @@
 # If the REFERENCES_LINK_SOURCE tag is set to YES (the default)
 # and SOURCE_BROWSER tag is set to YES, then the hyperlinks from
 # functions in REFERENCES_RELATION and REFERENCED_BY_RELATION lists will
-# link to the source code.  Otherwise they will link to the documentstion.
+# link to the source code. 
+# Otherwise they will link to the documentation.
 
 REFERENCES_LINK_SOURCE = YES
 
@@ -744,12 +799,13 @@
 
 HTML_ALIGN_MEMBERS     = YES
 
-# If the GENERATE_HTMLHELP tag is set to YES, additional index files
-# will be generated that can be used as input for tools like the
-# Microsoft HTML help workshop to generate a compiled HTML help file (.chm)
-# of the generated HTML documentation.
+# If the HTML_DYNAMIC_SECTIONS tag is set to YES then the generated HTML 
+# documentation will contain sections that can be hidden and shown after the 
+# page has loaded. For this to work a browser that supports 
+# JavaScript and DHTML is required (for instance Mozilla 1.0+, Firefox 
+# Netscape 6.0+, Internet explorer 5.0+, Konqueror, or Safari).
 
-GENERATE_HTMLHELP      = NO
+HTML_DYNAMIC_SECTIONS  = NO
 
 # If the GENERATE_DOCSET tag is set to YES, additional index files
 # will be generated that can be used as input for Apple's Xcode 3
@@ -759,6 +815,7 @@
 # directory and running "make install" will install the docset in
 # ~/Library/Developer/Shared/Documentation/DocSets so that Xcode will find
 # it at startup.
+# See http://developer.apple.com/tools/creatingdocsetswithdoxygen.html for more information.
 
 GENERATE_DOCSET        = NO
 
@@ -776,13 +833,12 @@
 
 DOCSET_BUNDLE_ID       = org.doxygen.Project
 
-# If the HTML_DYNAMIC_SECTIONS tag is set to YES then the generated HTML
-# documentation will contain sections that can be hidden and shown after the
-# page has loaded. For this to work a browser that supports
-# JavaScript and DHTML is required (for instance Mozilla 1.0+, Firefox
-# Netscape 6.0+, Internet explorer 5.0+, Konqueror, or Safari).
+# If the GENERATE_HTMLHELP tag is set to YES, additional index files 
+# will be generated that can be used as input for tools like the 
+# Microsoft HTML help workshop to generate a compiled HTML help file (.chm) 
+# of the generated HTML documentation.
 
-HTML_DYNAMIC_SECTIONS  = NO
+GENERATE_HTMLHELP      = NO
 
 # If the GENERATE_HTMLHELP tag is set to YES, the CHM_FILE tag can
 # be used to specify the file name of the resulting .chm file. You
@@ -804,6 +860,12 @@
 
 GENERATE_CHI           = NO
 
+# If the GENERATE_HTMLHELP tag is set to YES, the CHM_INDEX_ENCODING 
+# is used to encode HtmlHelp index (hhk), content (hhc) and project file 
+# content.
+
+CHM_INDEX_ENCODING     = 
+
 # If the GENERATE_HTMLHELP tag is set to YES, the BINARY_TOC flag
 # controls whether a binary table of contents is generated (YES) or a
 # normal table of contents (NO) in the .chm file.
@@ -815,6 +877,55 @@
 
 TOC_EXPAND             = NO
 
+# If the GENERATE_QHP tag is set to YES and both QHP_NAMESPACE and QHP_VIRTUAL_FOLDER 
+# are set, an additional index file will be generated that can be used as input for 
+# Qt's qhelpgenerator to generate a Qt Compressed Help (.qch) of the generated 
+# HTML documentation.
+
+GENERATE_QHP           = NO
+
+# If the QHG_LOCATION tag is specified, the QCH_FILE tag can 
+# be used to specify the file name of the resulting .qch file. 
+# The path specified is relative to the HTML output folder.
+
+QCH_FILE               = 
+
+# The QHP_NAMESPACE tag specifies the namespace to use when generating 
+# Qt Help Project output. For more information please see 
+# http://doc.trolltech.com/qthelpproject.html#namespace
+
+QHP_NAMESPACE          = 
+
+# The QHP_VIRTUAL_FOLDER tag specifies the namespace to use when generating 
+# Qt Help Project output. For more information please see 
+# http://doc.trolltech.com/qthelpproject.html#virtual-folders
+
+QHP_VIRTUAL_FOLDER     = doc
+
+# If QHP_CUST_FILTER_NAME is set, it specifies the name of a custom filter to add. 
+# For more information please see 
+# http://doc.trolltech.com/qthelpproject.html#custom-filters
+
+QHP_CUST_FILTER_NAME   = 
+
+# The QHP_CUST_FILT_ATTRS tag specifies the list of the attributes of the custom filter to add.For more information please see 
+# <a href="http://doc.trolltech.com/qthelpproject.html#custom-filters">Qt Help Project / Custom Filters</a>.
+
+QHP_CUST_FILTER_ATTRS  = 
+
+# The QHP_SECT_FILTER_ATTRS tag specifies the list of the attributes this project's 
+# filter section matches. 
+# <a href="http://doc.trolltech.com/qthelpproject.html#filter-attributes">Qt Help Project / Filter Attributes</a>.
+
+QHP_SECT_FILTER_ATTRS  = 
+
+# If the GENERATE_QHP tag is set to YES, the QHG_LOCATION tag can 
+# be used to specify the location of Qt's qhelpgenerator. 
+# If non-empty doxygen will try to run qhelpgenerator on the generated 
+# .qhp file.
+
+QHG_LOCATION           = 
+
 # The DISABLE_INDEX tag can be used to turn on/off the condensed index at
 # top of each HTML page. The value NO (the default) enables the index and
 # the value YES disables it.
@@ -826,12 +937,20 @@
 
 ENUM_VALUES_PER_LINE   = 4
 
-# If the GENERATE_TREEVIEW tag is set to YES, a side panel will be
-# generated containing a tree-like index structure (just like the one that
+# The GENERATE_TREEVIEW tag is used to specify whether a tree-like index 
+# structure should be generated to display hierarchical information. 
+# If the tag value is set to FRAME, a side panel will be generated 
+# containing a tree-like index structure (just like the one that 
 # is generated for HTML Help). For this to work a browser that supports
 # JavaScript, DHTML, CSS and frames is required (for instance Mozilla 1.0+,
 # Netscape 6.0+, Internet explorer 5.0+, or Konqueror). Windows users are
-# probably better off using the HTML help feature.
+# probably better off using the HTML help feature. Other possible values 
+# for this tag are: HIERARCHIES, which will generate the Groups, Directories, 
+# and Class Hierarchy pages using a tree view instead of an ordered list; 
+# ALL, which combines the behavior of FRAME and HIERARCHIES; and NONE, which 
+# disables this behavior completely. For backwards compatibility with previous 
+# releases of Doxygen, the values YES and NO are equivalent to FRAME and NONE 
+# respectively.
 
 GENERATE_TREEVIEW      = YES
 
@@ -841,6 +960,14 @@
 
 TREEVIEW_WIDTH         = 250
 
+# Use this tag to change the font size of Latex formulas included 
+# as images in the HTML documentation. The default is 10. Note that 
+# when you change the font size after a successful doxygen run you need 
+# to manually remove any form_*.png images from the HTML output directory 
+# to force them to be regenerated.
+
+FORMULA_FONTSIZE       = 10
+
 #---------------------------------------------------------------------------
 # configuration options related to the LaTeX output
 #---------------------------------------------------------------------------
@@ -1053,8 +1180,10 @@
 PERLMOD_LATEX          = NO
 
 # If the PERLMOD_PRETTY tag is set to YES the Perl module output will be
-# nicely formatted so it can be parsed by a human reader.  This is useful
-# if you want to understand what is going on.  On the other hand, if this
+# nicely formatted so it can be parsed by a human reader. 
+# This is useful 
+# if you want to understand what is going on. 
+# On the other hand, if this 
 # tag is set to NO the size of the Perl module output will be much smaller
 # and Perl will parse it just the same.
 
@@ -1099,14 +1228,7 @@
 # contain include files that are not input files but should be processed by
 # the preprocessor.
 
-INCLUDE_PATH           = src/target \
-                         src/pld \
-                         src/xsvf \
-                         src/jtag \
-                         src/flash \
-                         src/flash/at91sam7x \
-                         src/helper \
-                         src/server
+INCLUDE_PATH           =
 
 # You can use the INCLUDE_FILE_PATTERNS tag to specify one or more wildcard
 # patterns (like *.h and *.hpp) to filter out the header-files in the
@@ -1123,7 +1245,7 @@
 # undefined via #undef or recursively expanded use the := operator
 # instead of the = operator.
 
-PREDEFINED             =
+PREDEFINED             = HAVE_CONFIG_H
 
 # If the MACRO_EXPANSION and EXPAND_ONLY_PREDEF tags are set to YES then
 # this tag can be used to specify a list of macro names that should be expanded.
@@ -1148,8 +1270,10 @@
 # Optionally an initial location of the external documentation
 # can be added for each tagfile. The format of a tag file without
 # this location is as follows:
+#  
 #   TAGFILES = file1 file2 ...
 # Adding location for the tag files is done as follows:
+#  
 #   TAGFILES = file1=loc1 "file2 = loc2" ...
 # where "loc1" and "loc2" can be relative or absolute paths or
 # URLs. If a location is present for each tag, the installdox tool
@@ -1216,8 +1340,31 @@
 # toolkit from AT&T and Lucent Bell Labs. The other options in this section
 # have no effect if this option is set to NO (the default)
 
-HAVE_DOT               = NO
+HAVE_DOT               = YES
 
+# By default doxygen will write a font called FreeSans.ttf to the output 
+# directory and reference it in all dot files that doxygen generates. This 
+# font does not include all possible unicode characters however, so when you need 
+# these (or just want a differently looking font) you can specify the font name 
+# using DOT_FONTNAME. You need need to make sure dot is able to find the font, 
+# which can be done by putting it in a standard location or by setting the 
+# DOTFONTPATH environment variable or by setting DOT_FONTPATH to the directory 
+# containing the font.
+
+DOT_FONTNAME           = FreeSans
+
+# The DOT_FONTSIZE tag can be used to set the size of the font of dot graphs. 
+# The default size is 10pt.
+
+DOT_FONTSIZE           = 10
+
+# By default doxygen will tell dot to use the output directory to look for the 
+# FreeSans.ttf font (which doxygen will put there itself). If you specify a 
+# different font using DOT_FONTNAME you can set the path where dot 
+# can find it using this tag.
+
+DOT_FONTPATH           = 
+
 # If the CLASS_GRAPH and HAVE_DOT tags are set to YES then doxygen
 # will generate a graph for each documented class showing the direct and
 # indirect inheritance relations. Setting this tag to YES will force the
@@ -1307,7 +1454,7 @@
 
 DOTFILE_DIRS           =
 
-# The MAX_DOT_GRAPH_MAX_NODES tag can be used to set the maximum number of
+# The DOT_GRAPH_MAX_NODES tag can be used to set the maximum number of 
 # nodes that will be shown in the graph. If the number of nodes in a graph
 # becomes larger than this value, doxygen will truncate the graph, which is
 # visualized by representing a node as a red box. Note that doxygen if the
@@ -1328,10 +1475,10 @@
 MAX_DOT_GRAPH_DEPTH    = 0
 
 # Set the DOT_TRANSPARENT tag to YES to generate images with a transparent
-# background. This is enabled by default, which results in a transparent
-# background. Warning: Depending on the platform used, enabling this option
-# may lead to badly anti-aliased labels on the edges of a graph (i.e. they
-# become hard to read).
+# background. This is disabled by default, because dot on Windows does not 
+# seem to support this out of the box. Warning: Depending on the platform used, 
+# enabling this option may lead to badly anti-aliased labels on the edges of 
+# a graph (i.e. they become hard to read).
 
 DOT_TRANSPARENT        = NO
 
@@ -1355,7 +1502,7 @@
 DOT_CLEANUP            = YES
 
 #---------------------------------------------------------------------------
-# Configuration::additions related to the search engine
+# Options related to the search engine
 #---------------------------------------------------------------------------
 
 # The SEARCHENGINE tag specifies whether or not a search engine should be



From oharboe at mail.berlios.de  Mon May 11 08:54:01 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 08:54:01 +0200
Subject: [Openocd-svn] r1720 - trunk
Message-ID: <200905110654.n4B6s1q4031562@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 08:54:00 +0200 (Mon, 11 May 2009)
New Revision: 1720

Modified:
   trunk/
Log:
add to svn ignore


Property changes on: trunk
___________________________________________________________________
Name: svn:ignore
   - autom4te.cache
.project
aclocal.m4
config.guess
config.h.in
config.sub
configure
depcomp
install-sh
Makefile.in
missing
compile

   + autom4te.cache
.project
aclocal.m4
config.guess
config.h.in
config.sub
configure
depcomp
install-sh
Makefile.in
missing
compile
ltmain.sh.lnk




From oharboe at mail.berlios.de  Mon May 11 08:55:01 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 08:55:01 +0200
Subject: [Openocd-svn] r1721 - trunk/src/target
Message-ID: <200905110655.n4B6t1Qv031678@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 08:55:00 +0200 (Mon, 11 May 2009)
New Revision: 1721

Modified:
   trunk/src/target/arm_jtag.h
Log:
used by upcoming commits

Modified: trunk/src/target/arm_jtag.h
===================================================================
--- trunk/src/target/arm_jtag.h	2009-05-11 06:54:00 UTC (rev 1720)
+++ trunk/src/target/arm_jtag.h	2009-05-11 06:55:00 UTC (rev 1721)
@@ -56,5 +56,18 @@
 int arm_jtag_buf_to_be16(u8 *in_buf, void *priv, struct scan_field_s *field);
 int arm_jtag_buf_to_8(u8 *in_buf, void *priv, struct scan_field_s *field);
 
+
+/* use this as a static so we can inline it in -O3 and refer to it via a pointer  */
+static __inline__ void arm7flip32(u8 *in)
+{
+	*((u32 *)in)=flip_u32(le_to_h_u32(in), 32);
+}
+
+static __inline__ void arm_le_to_h_u32(u8 *in)
+{
+	*((u32 *)in)=le_to_h_u32(in);
+}
+
+
 #endif /* ARM_JTAG */
 



From zwelch at mail.berlios.de  Mon May 11 09:04:32 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 09:04:32 +0200
Subject: [Openocd-svn] r1722 - trunk/src/helper
Message-ID: <200905110704.n4B74WeA000142@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 09:04:25 +0200 (Mon, 11 May 2009)
New Revision: 1722

Modified:
   trunk/src/helper/system.h
Log:
Add svn:eol-style property to recently added system.h.


Property changes on: trunk/src/helper/system.h
___________________________________________________________________
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Mon May 11 09:26:13 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:26:13 +0200
Subject: [Openocd-svn] r1723 - in trunk/src: . helper
Message-ID: <200905110726.n4B7QDh7010040@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:26:11 +0200 (Mon, 11 May 2009)
New Revision: 1723

Modified:
   trunk/src/ecosboard.c
   trunk/src/helper/ioutil.c
Log:
leave eCos include file issues alone for now. 

Modified: trunk/src/ecosboard.c
===================================================================
--- trunk/src/ecosboard.c	2009-05-11 07:04:25 UTC (rev 1722)
+++ trunk/src/ecosboard.c	2009-05-11 07:26:11 UTC (rev 1723)
@@ -21,54 +21,70 @@
 #include "config.h"
 #endif
 
+#include "log.h"
+#include "types.h"
+#include "jtag.h"
 #include "configuration.h"
-#include "time_support.h"
-
-#include "jtag.h"
 #include "xsvf.h"
 #include "svf.h"
 #include "target.h"
 #include "flash.h"
 #include "nand.h"
 #include "pld.h"
-#include "rom.h"
 
+#include "command.h"
 #include "server.h"
 #include "telnet_server.h"
 #include "gdb_server.h"
 
+#include <time_support.h>
+#include <sys/time.h>
+#include <strings.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <unistd.h>
+#include <errno.h>
+
+#include <cyg/io/flash.h>
 #include <pkgconf/fs_jffs2.h>	// Address of JFFS2
 #include <network.h>
 
-#include <arpa/inet.h>
+#include <fcntl.h>
+#include <sys/stat.h>
+#include <cyg/fileio/fileio.h>
 #include <dirent.h>
-#include <net/if.h>
-#include <netdb.h>
-#include <netinet/tcp.h>
-#include <stdarg.h>
-#include <sys/ioctl.h>
-#include <sys/stat.h>
-
 #include <cyg/athttpd/http.h>
 #include <cyg/athttpd/socket.h>
 #include <cyg/athttpd/handler.h>
 #include <cyg/athttpd/cgi.h>
 #include <cyg/athttpd/forms.h>
 #include <cyg/discover/discover.h>
-#include <cyg/fileio/fileio.h>
 #include <cyg/hal/hal_diag.h>
-#include <cyg/io/flash.h>
+#include <cyg/kernel/kapi.h>
 #include <cyg/io/serialio.h>
 #include <cyg/io/io.h>
-#include <cyg/kernel/kapi.h>
-
-#ifdef HAVE_IFADDRS_H
+#include <netinet/tcp.h>
+#include "rom.h"
+#include <sys/ioctl.h>
+#include <sys/socket.h>
+#include <netinet/in.h>
+#include <net/if.h>
+#include <arpa/inet.h>
+#include <sys/types.h>
+#include <sys/socket.h>
+#include <netdb.h>
+#include <netinet/in.h>
+#include <unistd.h>
+#include <arpa/inet.h>
+#include <stdio.h>
 #include <ifaddrs.h>
-#endif
-#ifdef HAVE_STRINGS_H
-#include <strings.h>
-#endif
+#include <string.h>
 
+#include <unistd.h>
+#include <stdio.h>
+
+
 #define MAX_IFS 64
 #if defined(CYGPKG_NET_FREEBSD_STACK)
 #include <tftp_support.h>

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-11 07:04:25 UTC (rev 1722)
+++ trunk/src/helper/ioutil.c	2009-05-11 07:26:11 UTC (rev 1723)
@@ -51,8 +51,10 @@
 #include <ifaddrs.h>
 #endif
 #ifdef HAVE_MALLOC_H
+#if !BUILD_ECOSBOARD
 #include <malloc.h>
 #endif
+#endif
 //#ifdef HAVE_STRINGS_H
 //#include <strings.h>
 //#endif



From oharboe at mail.berlios.de  Mon May 11 09:27:00 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:27:00 +0200
Subject: [Openocd-svn] r1724 - trunk/src/target
Message-ID: <200905110727.n4B7R0pc010125@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:26:59 +0200 (Mon, 11 May 2009)
New Revision: 1724

Modified:
   trunk/src/target/arm_adi_v5.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-05-11 07:26:11 UTC (rev 1723)
+++ trunk/src/target/arm_adi_v5.c	2009-05-11 07:26:59 UTC (rev 1724)
@@ -120,11 +120,10 @@
 
 	if (invalue)
 	{
-		u8 tmp[4];
-		fields[1].in_value = tmp;
-		jtag_add_dr_scan_now(2, fields, TAP_INVALID);
+		fields[1].in_value = (u8 *)invalue;
+		jtag_add_dr_scan(2, fields, TAP_INVALID);
 
-		*invalue=le_to_h_u32(tmp);
+		jtag_add_callback(arm_le_to_h_u32, (u8 *)invalue);
 	} else
 	{
 



From oharboe at mail.berlios.de  Mon May 11 09:33:45 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:33:45 +0200
Subject: [Openocd-svn] r1725 - trunk/src/target
Message-ID: <200905110733.n4B7XjvY010973@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:33:43 +0200 (Mon, 11 May 2009)
New Revision: 1725

Modified:
   trunk/src/target/arm720t.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-11 07:26:59 UTC (rev 1724)
+++ trunk/src/target/arm720t.c	2009-05-11 07:33:43 UTC (rev 1725)
@@ -117,10 +117,9 @@
 
 	if (in)
 	{
-		u8 tmp[4];
-		fields[1].in_value = tmp;
-		jtag_add_dr_scan_now(2, fields, TAP_INVALID);
-		*in=flip_u32(le_to_h_u32(tmp), 32);
+		fields[1].in_value = (u8 *)in;
+		jtag_add_dr_scan(2, fields, TAP_INVALID);
+		jtag_add_callback(arm7flip32, (u8 *)in);
 	} else
 	{
 		jtag_add_dr_scan(2, fields, TAP_INVALID);



From oharboe at mail.berlios.de  Mon May 11 09:35:06 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:35:06 +0200
Subject: [Openocd-svn] r1726 - trunk/src/target
Message-ID: <200905110735.n4B7Z6o5011123@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:35:05 +0200 (Mon, 11 May 2009)
New Revision: 1726

Modified:
   trunk/src/target/arm7tdmi.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-11 07:33:43 UTC (rev 1725)
+++ trunk/src/target/arm7tdmi.c	2009-05-11 07:35:05 UTC (rev 1726)
@@ -184,15 +184,11 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	u8 tmp[4];
-	fields[1].in_value = tmp;
+	fields[1].in_value = (u8 *)in;
 
-	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
+	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
-	if (jtag_error==ERROR_OK)
-	{
-		*in=flip_u32(le_to_h_u32(tmp), 32);
-	}
+	jtag_add_callback(arm7flip32, (u8 *)in);
 
 	jtag_add_runtest(0, TAP_INVALID);
 
@@ -246,7 +242,12 @@
 			*((u8 *)in)= readback & 0xff;
 			break;
 	}
+}
 
+static int arm7endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be)
+{
+	arm_endianness(in, in, (int)size, (int)be, 1);
+	return ERROR_OK;
 }
 
 /* clock the target, and read the databus
@@ -273,12 +274,11 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	u8 tmp[4];
-	fields[1].in_value = tmp;
+	fields[1].in_value = (u8 *)in;
 
-	jtag_add_dr_scan_now(2, fields, TAP_INVALID);
+	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
-	arm_endianness(tmp, in, size, be, 1);
+	jtag_add_callback3(arm7endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be);
 
 	jtag_add_runtest(0, TAP_INVALID);
 



From oharboe at mail.berlios.de  Mon May 11 09:36:16 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:36:16 +0200
Subject: [Openocd-svn] r1727 - trunk/src/target
Message-ID: <200905110736.n4B7aGqj011208@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:36:16 +0200 (Mon, 11 May 2009)
New Revision: 1727

Modified:
   trunk/src/target/arm920t.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-11 07:35:05 UTC (rev 1726)
+++ trunk/src/target/arm920t.c	2009-05-11 07:36:16 UTC (rev 1727)
@@ -128,12 +128,11 @@
 
 	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
-	u8 tmp[4];
-	fields[1].in_value = tmp;
+	fields[1].in_value = (u8 *)value;
 
-	jtag_add_dr_scan_now(4, fields, TAP_INVALID);
+	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
-	*value=le_to_h_u32(tmp);
+	jtag_add_callback(arm_le_to_h_u32, (u8 *)value);
 
 	#ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	jtag_execute_queue();



From oharboe at mail.berlios.de  Mon May 11 09:38:10 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:38:10 +0200
Subject: [Openocd-svn] r1728 - trunk/src/target
Message-ID: <200905110738.n4B7cAfN013130@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:38:10 +0200 (Mon, 11 May 2009)
New Revision: 1728

Modified:
   trunk/src/target/arm926ejs.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-11 07:36:16 UTC (rev 1727)
+++ trunk/src/target/arm926ejs.c	2009-05-11 07:38:10 UTC (rev 1728)
@@ -138,8 +138,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	u8 tmp[4];
-	fields[0].in_value = tmp;
+	fields[0].in_value = (u8 *)value;
 
 
 	fields[1].tap = jtag_info->tap;
@@ -165,9 +164,9 @@
 		/* rescan with NOP, to wait for the access to complete */
 		access = 0;
 		nr_w_buf = 0;
-		jtag_add_dr_scan_now(4, fields, TAP_INVALID);
+		jtag_add_dr_scan(4, fields, TAP_INVALID);
 
-		*value=le_to_h_u32(tmp);
+		jtag_add_callback(arm_le_to_h_u32, (u8 *)value);
 
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
 		{



From oharboe at mail.berlios.de  Mon May 11 09:39:36 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:39:36 +0200
Subject: [Openocd-svn] r1729 - trunk/src/target
Message-ID: <200905110739.n4B7da8f017019@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:39:36 +0200 (Mon, 11 May 2009)
New Revision: 1729

Modified:
   trunk/src/target/arm966e.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-11 07:38:10 UTC (rev 1728)
+++ trunk/src/target/arm966e.c	2009-05-11 07:39:36 UTC (rev 1729)
@@ -190,12 +190,11 @@
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	u8 tmp[4];
-	fields[1].in_value = tmp;
+	fields[1].in_value = (u8 *)value;
 
-	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	*value=le_to_h_u32(tmp);
+	jtag_add_callback(arm_le_to_h_u32, (u8 *)value);
 
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_



From oharboe at mail.berlios.de  Mon May 11 09:40:43 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:40:43 +0200
Subject: [Openocd-svn] r1730 - trunk/src/target
Message-ID: <200905110740.n4B7ehgF018723@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:40:42 +0200 (Mon, 11 May 2009)
New Revision: 1730

Modified:
   trunk/src/target/arm9tdmi.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-11 07:39:36 UTC (rev 1729)
+++ trunk/src/target/arm9tdmi.c	2009-05-11 07:40:42 UTC (rev 1730)
@@ -202,11 +202,10 @@
 
 	if (in)
 	{
-		u8 tmp[4];
-		fields[0].in_value=tmp;
-		jtag_add_dr_scan_now(3, fields, TAP_INVALID);
+		fields[0].in_value=(u8 *)in;
+		jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-		*in=le_to_h_u32(tmp);
+		jtag_add_callback(arm_le_to_h_u32, (u8 *)in);
 	}
 	else
 	{
@@ -251,8 +250,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	u8 tmp[4];
-	fields[0].in_value = tmp;
+	fields[0].in_value = (u8 *)in;
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
@@ -264,9 +262,9 @@
 	fields[2].out_value = NULL;
 	fields[2].in_value = NULL;
 
-	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	*in=le_to_h_u32(tmp);
+	jtag_add_callback(arm_le_to_h_u32, (u8 *)in);
 
 	jtag_add_runtest(0, TAP_INVALID);
 
@@ -293,6 +291,12 @@
 
 extern void arm_endianness(u8 *tmp, void *in, int size, int be, int flip);
 
+static int arm9endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be)
+{
+	arm_endianness(in, in, (int)size, (int)be, 0);
+	return ERROR_OK;
+}
+
 /* clock the target, and read the databus
  * the *in pointer points to a buffer where elements of 'size' bytes
  * are stored in big (be==1) or little (be==0) endianness
@@ -313,8 +317,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	u8 tmp[4];
-	fields[0].in_value = tmp;
+	fields[0].in_value = (u8 *)in;
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
@@ -326,11 +329,10 @@
 	fields[2].out_value = NULL;
 	fields[2].in_value = NULL;
 
-	jtag_add_dr_scan_now(3, fields, TAP_INVALID);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	arm_endianness(tmp, in, size, be, 0);
+	jtag_add_callback3(arm9endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be);
 
-
 	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_



From oharboe at mail.berlios.de  Mon May 11 09:47:21 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:47:21 +0200
Subject: [Openocd-svn] r1731 - trunk/src/target
Message-ID: <200905110747.n4B7lLGE021991@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:47:21 +0200 (Mon, 11 May 2009)
New Revision: 1731

Modified:
   trunk/src/target/embeddedice.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-11 07:40:42 UTC (rev 1730)
+++ trunk/src/target/embeddedice.c	2009-05-11 07:47:21 UTC (rev 1731)
@@ -240,21 +240,18 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
 	fields[0].in_value = NULL;
-	
 
 	fields[1].tap = ice_reg->jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, reg_addr);
 	fields[1].in_value = NULL;
-	
 
 	fields[2].tap = ice_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
-	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -290,23 +287,19 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	u8 tmp[4];
-	fields[0].in_value = tmp;
-	
+	fields[0].in_value = NULL;
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_DATA]);
 	fields[1].in_value = NULL;
-	
 
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
-	
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -318,10 +311,10 @@
 		if (size == 1)
 			buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_CTRL]);
 
-		jtag_add_dr_scan_now(3, fields, TAP_INVALID);
+		fields[0].in_value = (u8 *)data;
+		jtag_add_dr_scan(3, fields, TAP_INVALID);
+		jtag_add_callback(arm_le_to_h_u32, (u8 *)data);
 
-		*data = le_to_h_u32(tmp);
-
 		data++;
 		size--;
 	}
@@ -396,24 +389,14 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = field0_out;
-
 	fields[0].in_value = NULL;
 
-
-	
-
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_DATA]);
-
 	fields[1].in_value = NULL;
 
-
-	
-
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
@@ -421,10 +404,6 @@
 
 	fields[2].in_value = NULL;
 
-
-	
-
-
 	while (size > 0)
 	{
 		buf_set_u32(fields[0].out_value, 0, 32, *data);
@@ -465,35 +444,20 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-
 	fields[0].in_value = field0_in;
 
-
-	
-
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_CTRL]);
-
 	fields[1].in_value = NULL;
 
-
-	
-
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
-
 	fields[2].in_value = NULL;
 
-
-	
-
-
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 	gettimeofday(&lap, NULL);
 	do



From oharboe at mail.berlios.de  Mon May 11 09:47:53 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:47:53 +0200
Subject: [Openocd-svn] r1732 - trunk/src/target
Message-ID: <200905110747.n4B7lr5j022040@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:47:53 +0200 (Mon, 11 May 2009)
New Revision: 1732

Modified:
   trunk/src/target/etb.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-11 07:47:21 UTC (rev 1731)
+++ trunk/src/target/etb.c	2009-05-11 07:47:53 UTC (rev 1732)
@@ -157,6 +157,13 @@
 	return ERROR_OK;
 }
 
+
+static void etb_getbuf(u8 *in)
+{
+	*((u32 *)in)=buf_get_u32(in, 0, 32);
+}
+
+
 static int etb_read_ram(etb_t *etb, u32 *data, int num_frames)
 {
 	scan_field_t fields[3];
@@ -169,9 +176,8 @@
 	fields[0].tap = etb->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	u8 tmp[4];
-	fields[0].in_value = tmp;
-
+	fields[0].in_value = NULL;
+	
 	fields[1].tap = etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
@@ -197,9 +203,10 @@
 		else
 			buf_set_u32(fields[1].out_value, 0, 7, 0);
 
-		jtag_add_dr_scan_now(3, fields, TAP_INVALID);
+		fields[0].in_value = (u8 *)(data+i);
+		jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-		data[i]=buf_get_u32(tmp, 0, 32);
+		jtag_add_callback(etb_getbuf, (u8 *)(data+i));
 	}
 
 	jtag_execute_queue();



From oharboe at mail.berlios.de  Mon May 11 09:48:27 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 09:48:27 +0200
Subject: [Openocd-svn] r1733 - trunk/src/target
Message-ID: <200905110748.n4B7mRWS022097@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 09:48:26 +0200 (Mon, 11 May 2009)
New Revision: 1733

Modified:
   trunk/src/target/xscale.c
Log:
switch to jtag_add_callback() - USB performance fix

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-11 07:47:53 UTC (rev 1732)
+++ trunk/src/target/xscale.c	2009-05-11 07:48:26 UTC (rev 1733)
@@ -252,8 +252,8 @@
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
-	
 
+
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
@@ -290,6 +290,12 @@
 	return jtag_execute_queue();
 }
 
+
+static void xscale_getbuf(u8 *in)
+{
+	*((u32 *)in)=buf_get_u32(in, 0, 32);
+}
+
 int xscale_receive(target_t *target, u32 *buffer, int num_words)
 {
 	if (num_words==0)
@@ -326,10 +332,8 @@
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	u8 tmp[4];
-	fields[1].in_value = tmp;
-	
 
+
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
@@ -351,13 +355,15 @@
 			fields[0].in_value = &field0[i];
 
 			jtag_add_pathmove(3, path);
-			jtag_add_dr_scan_now(3, fields, TAP_IDLE);
 
+			fields[1].in_value = (u8 *)(field1+i);
+			jtag_add_dr_scan(3, fields, TAP_IDLE);
+
+			jtag_add_callback(xscale_getbuf, (u8 *)(field1+i));
+
 			jtag_check_value_mask(fields+0, &field0_check_value, &field0_check_mask);
 			jtag_check_value_mask(fields+2, &field2_check_value, &field2_check_mask);
 
-			field1[i]=buf_get_u32(tmp, 0, 32);
-
 			words_scheduled++;
 		}
 
@@ -444,8 +450,8 @@
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
 	fields[1].in_value = xscale->reg_cache->reg_list[XSCALE_TX].value;
-	
 
+
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
@@ -536,8 +542,8 @@
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_RX].value;
 	fields[1].in_value = NULL;
-	
 
+
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
@@ -708,8 +714,8 @@
 	fields[1].num_bits = 32;
 	fields[1].out_value = xscale->reg_cache->reg_list[XSCALE_DCSR].value;
 	fields[1].in_value = NULL;
-	
 
+
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &field2;
@@ -778,9 +784,9 @@
 	fields[0].in_value = NULL;
 
 
-	
 
 
+
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 27;
 	fields[1].out_value = packet;
@@ -788,9 +794,9 @@
 	fields[1].in_value = NULL;
 
 
-	
 
 
+
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	fields[0].num_bits = 32;
@@ -840,9 +846,9 @@
 	fields[0].in_value = NULL;
 
 
-	
 
 
+
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 27;
 	fields[1].out_value = packet;
@@ -850,9 +856,9 @@
 	fields[1].in_value = NULL;
 
 
-	
 
 
+
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	return ERROR_OK;



From zwelch at mail.berlios.de  Mon May 11 10:26:45 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 10:26:45 +0200
Subject: [Openocd-svn] r1734 - trunk/src/jtag
Message-ID: <200905110826.n4B8Qjf2001357@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 10:26:42 +0200 (Mon, 11 May 2009)
New Revision: 1734

Modified:
   trunk/src/jtag/ft2232.c
Log:
Fix ft2232 for CygWin, provided by Michael Bruck <mbruck at digenius.de>.

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-11 07:48:26 UTC (rev 1733)
+++ trunk/src/jtag/ft2232.c	2009-05-11 08:26:42 UTC (rev 1734)
@@ -33,15 +33,15 @@
 #include "config.h"
 #endif
 
-#if IS_CYGWIN == 1
-#include "windows.h"
-#endif
-
 /* project specific includes */
 #include "jtag.h"
 #include "time_support.h"
 
+#if IS_CYGWIN == 1
+#include <windows.h>
+#endif
 
+
 /* FT2232 access library includes */
 #if BUILD_FT2232_FTD2XX == 1
 #include <ftd2xx.h>



From oharboe at mail.berlios.de  Mon May 11 10:39:50 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 10:39:50 +0200
Subject: [Openocd-svn] r1735 - in trunk/src: jtag target
Message-ID: <200905110839.n4B8doRN003250@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 10:39:49 +0200 (Mon, 11 May 2009)
New Revision: 1735

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm9tdmi.c
Log:
change jtag_add_callback API to be able to support check_value/mask

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-11 08:26:42 UTC (rev 1734)
+++ trunk/src/jtag/jtag.c	2009-05-11 08:39:49 UTC (rev 1735)
@@ -77,7 +77,7 @@
 	u8 *in;
 	jtag_callback_data_t data1;
 	jtag_callback_data_t data2;
-
+	jtag_callback_data_t data3;
 };
 
 
@@ -725,6 +725,62 @@
 		jtag_error=retval;
 }
 
+
+int jtag_check_value_inner(u8 *captured, u8 *in_check_value, u8 *in_check_mask, int num_bits);
+
+static int jtag_check_value_mask_callback(u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2, jtag_callback_data_t data3)
+{
+	return jtag_check_value_inner(in, (u8 *)data1, (u8 *)data2, (int)data3);
+}
+
+void jtag_add_dr_scan_check(int num_fields, scan_field_t *fields, tap_state_t state)
+{
+	for (int i=0; i<num_fields; i++)
+	{
+		fields[i].allocated=0;
+		fields[i].modified=0;
+		if ((fields[i].check_value!=NULL)&&(fields[i].in_value==NULL))
+		{
+			fields[i].modified=1;
+			/* we need storage space... */
+#ifdef HAVE_JTAG_MINIDRIVER_H
+			if (fields[i].num_bits<=32)
+			{
+				/* This is enough space and we're executing this synchronously */
+				fields[i].in_value=(u8 *)&fields[i].intmp;
+			} else
+			{
+				fields[i].in_value=(u8 *)malloc(CEIL(fields[i].num_bits, 8));
+				fields[i].allocated=1;
+			}
+#else
+			fields[i].in_value=(u8 *)cmd_queue_alloc(CEIL(fields[i].num_bits, 8));
+#endif
+		}
+	}
+
+	jtag_add_dr_scan(num_fields, fields, state);
+
+	for (int i=0; i<num_fields; i++)
+	{
+		if ((fields[i].check_value!=NULL)&&(fields[i].in_value!=NULL))
+		{
+			/* this is synchronous for a minidriver */
+			jtag_add_callback4(jtag_check_value_mask_callback, fields[i].in_value, fields[i].check_value, fields[i].check_mask, (jtag_callback_data_t)fields[i].num_bits);
+		}
+		if (fields[i].allocated)
+		{
+			free(fields[i].in_value);
+		}
+		if (fields[i].modified)
+		{
+			fields[i].in_value=NULL;
+		}
+	}
+
+
+}
+
 void jtag_add_dr_scan_now(int num_fields, scan_field_t *fields, tap_state_t state)
 {
 	jtag_add_dr_scan(num_fields, fields, state);
@@ -1362,10 +1418,9 @@
 	return (tap == NULL) ? "(unknown)" : tap->dotted_name;
 }
 
-int jtag_check_value_inner(u8 *captured, scan_field_t *field, u8 *in_check_value, u8 *in_check_mask)
+int jtag_check_value_inner(u8 *captured, u8 *in_check_value, u8 *in_check_mask, int num_bits)
 {
 	int retval = ERROR_OK;
-	int num_bits = field->num_bits;
 
 	int compare_failed = 0;
 
@@ -1379,8 +1434,10 @@
 		 * only report a problem when there wasn't a handler, or if the handler
 		 * acknowledged the error
 		 */
+		/*
 		LOG_WARNING("TAP %s:",
 					jtag_tap_name(field->tap));
+					*/
 		if (compare_failed)
 		{
 			char *captured_char = buf_to_str(captured, (num_bits > DEBUG_JTAG_IOZ) ? DEBUG_JTAG_IOZ : num_bits, 16);
@@ -1422,7 +1479,7 @@
 
 	jtag_execute_queue_noclear();
 
-	int retval=jtag_check_value_inner(field->in_value, field, value, mask);
+	int retval=jtag_check_value_inner(field->in_value, value, mask, field->num_bits);
 	jtag_set_error(retval);
 }
 
@@ -1447,7 +1504,7 @@
 
 #ifndef HAVE_JTAG_MINIDRIVER_H
 /* add callback to end of queue */
-void jtag_add_callback3(jtag_callback_t callback, u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2)
+void jtag_add_callback4(jtag_callback_t callback, u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2, jtag_callback_data_t data3)
 {
 	struct jtag_callback_entry *entry=cmd_queue_alloc(sizeof(struct jtag_callback_entry));
 
@@ -1456,6 +1513,7 @@
 	entry->in=in;
 	entry->data1=data1;
 	entry->data2=data2;
+	entry->data3=data3;
 
 	if (jtag_callback_queue_head==NULL)
 	{
@@ -1469,7 +1527,7 @@
 }
 
 
-static int jtag_convert_to_callback3(u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2)
+static int jtag_convert_to_callback4(u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2, jtag_callback_data_t data3)
 {
 	((jtag_callback1_t)data1)(in);
 	return ERROR_OK;
@@ -1477,7 +1535,7 @@
 
 void jtag_add_callback(jtag_callback1_t callback, u8 *in)
 {
-	jtag_add_callback3(jtag_convert_to_callback3, in, (jtag_callback_data_t)callback, 0);
+	jtag_add_callback4(jtag_convert_to_callback4, in, (jtag_callback_data_t)callback, 0, 0);
 }
 #endif
 
@@ -1500,7 +1558,7 @@
 		struct jtag_callback_entry *entry;
 		for (entry=jtag_callback_queue_head; entry!=NULL; entry=entry->next)
 		{
-			retval=entry->callback(entry->in, entry->data1, entry->data2);
+			retval=entry->callback(entry->in, entry->data1, entry->data2, entry->data3);
 			if (retval!=ERROR_OK)
 				break;
 		}

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-11 08:26:42 UTC (rev 1734)
+++ trunk/src/jtag/jtag.h	2009-05-11 08:39:49 UTC (rev 1735)
@@ -269,6 +269,15 @@
 	int         num_bits;           /* number of bits this field specifies (up to 32) */
 	u8*         out_value;          /* value to be scanned into the device */
 	u8*         in_value;           /* pointer to a 32-bit memory location to take data scanned out */
+
+	u8*         check_value;        /* Used together with jtag_add_dr_scan_check() to check data clocked
+	                                   in */
+	u8*         check_mask;         /* mask to go with check_value */
+
+	/* internal work space */
+	int			allocated;			/* in_value has been allocated for the queue */
+	int			modified;			/* did we modify the in_value? */
+	u32			intmp;				/* temporary storage for checking synchronously */
 } scan_field_t;
 
 enum scan_type {
@@ -555,6 +564,9 @@
 extern void jtag_add_ir_scan_noverify(int num_fields, scan_field_t *fields, tap_state_t state);
 extern int  interface_jtag_add_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern void jtag_add_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
+
+/* This version of jtag_add_dr_scan() uses the check_value/mask fields */
+extern void jtag_add_dr_scan_check(int num_fields, scan_field_t* fields, tap_state_t endstate);
 /* same as jtag_add_dr_scan but the scan is executed immediately. sets jtag_error if there
  * was a failure.
  */
@@ -573,7 +585,7 @@
 typedef void (*jtag_callback1_t)(u8 *in);
 
 #ifndef HAVE_JTAG_MINIDRIVER_H
-/* A simpler version of jtag_add_callback3 */
+/* A simpler version of jtag_add_callback4 */
 extern void jtag_add_callback(jtag_callback1_t, u8 *in);
 #else
 /* implemented by minidriver */
@@ -588,7 +600,7 @@
  * The callback is invoked with three arguments. The first argument is
  * the pointer to the data clocked in.
  */
-typedef int (*jtag_callback_t)(u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2);
+typedef int (*jtag_callback_t)(u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2, jtag_callback_data_t data3);
 
 
 /* This callback can be executed immediately the queue has been flushed. Note that
@@ -623,7 +635,7 @@
  * callbacks may or may not be invoked depending on driver implementation.
  */
 #ifndef HAVE_JTAG_MINIDRIVER_H
-extern void jtag_add_callback3(jtag_callback_t, u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2);
+extern void jtag_add_callback4(jtag_callback_t, u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2, jtag_callback_data_t data3);
 #else
 /* implemented by minidriver */
 #endif

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-11 08:26:42 UTC (rev 1734)
+++ trunk/src/target/arm7tdmi.c	2009-05-11 08:39:49 UTC (rev 1735)
@@ -244,7 +244,7 @@
 	}
 }
 
-static int arm7endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be)
+static int arm7endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be, jtag_callback_data_t dummy)
 {
 	arm_endianness(in, in, (int)size, (int)be, 1);
 	return ERROR_OK;
@@ -278,7 +278,7 @@
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
-	jtag_add_callback3(arm7endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be);
+	jtag_add_callback4(arm7endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be, NULL);
 
 	jtag_add_runtest(0, TAP_INVALID);
 

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-11 08:26:42 UTC (rev 1734)
+++ trunk/src/target/arm9tdmi.c	2009-05-11 08:39:49 UTC (rev 1735)
@@ -291,7 +291,7 @@
 
 extern void arm_endianness(u8 *tmp, void *in, int size, int be, int flip);
 
-static int arm9endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be)
+static int arm9endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be, jtag_callback_data_t dummy)
 {
 	arm_endianness(in, in, (int)size, (int)be, 0);
 	return ERROR_OK;
@@ -331,7 +331,7 @@
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	jtag_add_callback3(arm9endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be);
+	jtag_add_callback4(arm9endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be, 0);
 
 	jtag_add_runtest(0, TAP_INVALID);
 



From oharboe at mail.berlios.de  Mon May 11 10:43:19 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 10:43:19 +0200
Subject: [Openocd-svn] r1736 - zy1000/trunk/build/include
Message-ID: <200905110843.n4B8hJsU003809@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 10:43:18 +0200 (Mon, 11 May 2009)
New Revision: 1736

Modified:
   zy1000/trunk/build/include/jtag_minidriver.h
Log:
change jtag_add_callback API to be able to support check_value/mask

Modified: zy1000/trunk/build/include/jtag_minidriver.h
===================================================================
--- zy1000/trunk/build/include/jtag_minidriver.h	2009-05-11 08:39:49 UTC (rev 1735)
+++ zy1000/trunk/build/include/jtag_minidriver.h	2009-05-11 08:43:18 UTC (rev 1736)
@@ -210,4 +210,4 @@
 
 #define jtag_add_callback(callback, in) callback(in)
 
-#define jtag_add_callback3(callback, in, data1, data2) jtag_set_error(callback(in, data1, data2))
+#define jtag_add_callback4(callback, in, data1, data2, data3) jtag_set_error(callback(in, data1, data2, data3))



From oharboe at mail.berlios.de  Mon May 11 11:10:04 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 11:10:04 +0200
Subject: [Openocd-svn] r1737 - trunk/src/target
Message-ID: <200905110910.n4B9A4mc011161@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 11:10:03 +0200 (Mon, 11 May 2009)
New Revision: 1737

Modified:
   trunk/src/target/embeddedice.c
Log:
switch to jtag_add_dr_scan_check() - USB performance fix

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-11 08:43:18 UTC (rev 1736)
+++ trunk/src/target/embeddedice.c	2009-05-11 09:10:03 UTC (rev 1737)
@@ -240,22 +240,30 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
 	fields[0].in_value = NULL;
+	fields[0].check_value = NULL;
+	fields[0].check_mask = NULL;
 
 	fields[1].tap = ice_reg->jtag_info->tap;
 	fields[1].num_bits = 5;
 	fields[1].out_value = field1_out;
 	buf_set_u32(fields[1].out_value, 0, 5, reg_addr);
 	fields[1].in_value = NULL;
+	fields[1].check_value = NULL;
+	fields[1].check_mask = NULL;
 
 	fields[2].tap = ice_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = field2_out;
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
+	fields[2].check_value = NULL;
+	fields[2].check_mask = NULL;
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_value = reg->value;
+	fields[0].check_value = check_value;
+	fields[0].check_mask = check_mask;
 
 	/* when reading the DCC data register, leaving the address field set to
 	 * EICE_COMMS_DATA would read the register twice
@@ -263,10 +271,8 @@
 	 */
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_CTRL]);
 
-	jtag_add_dr_scan(3, fields, TAP_INVALID);
+	jtag_add_dr_scan_check(3, fields, TAP_INVALID);
 
-	jtag_check_value_mask(fields+0, check_value, check_mask);
-
 	return ERROR_OK;
 }
 



From oharboe at mail.berlios.de  Mon May 11 11:12:32 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 11:12:32 +0200
Subject: [Openocd-svn] r1738 - trunk/src/target
Message-ID: <200905110912.n4B9CWUc011487@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 11:12:32 +0200 (Mon, 11 May 2009)
New Revision: 1738

Modified:
   trunk/src/target/etb.c
Log:
switch to jtag_add_dr_scan_check() - USB performance fix

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-11 09:10:03 UTC (rev 1737)
+++ trunk/src/target/etb.c	2009-05-11 09:12:32 UTC (rev 1738)
@@ -177,7 +177,7 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
 	fields[0].in_value = NULL;
-	
+
 	fields[1].tap = etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
@@ -233,18 +233,24 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
 	fields[0].in_value = NULL;
+	fields[0].check_value = NULL;
+	fields[0].check_mask = NULL;
 
 	fields[1].tap = etb_reg->etb->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
 	fields[1].in_value = NULL;
+	fields[1].check_value = NULL;
+	fields[1].check_mask = NULL;
 
 	fields[2].tap = etb_reg->etb->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
+	fields[2].check_value = NULL;
+	fields[2].check_mask = NULL;
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
@@ -253,11 +259,11 @@
 	 */
 	buf_set_u32(fields[1].out_value, 0, 7, 0x0);
 	fields[0].in_value = reg->value;
+	fields[0].check_value = check_value;
+	fields[0].check_mask = check_mask;
 
-	jtag_add_dr_scan(3, fields, TAP_INVALID);
+	jtag_add_dr_scan_check(3, fields, TAP_INVALID);
 
-	jtag_check_value_mask(fields+0, check_value, check_mask);
-
 	free(fields[1].out_value);
 	free(fields[2].out_value);
 



From oharboe at mail.berlios.de  Mon May 11 11:14:48 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 11:14:48 +0200
Subject: [Openocd-svn] r1739 - trunk/src/target
Message-ID: <200905110914.n4B9Em7s013031@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 11:14:47 +0200 (Mon, 11 May 2009)
New Revision: 1739

Modified:
   trunk/src/target/etm.c
Log:
switch to jtag_add_dr_scan_check() - USB performance fix

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-11 09:12:32 UTC (rev 1738)
+++ trunk/src/target/etm.c	2009-05-11 09:14:47 UTC (rev 1739)
@@ -328,27 +328,33 @@
 	fields[0].num_bits = 32;
 	fields[0].out_value = reg->value;
 	fields[0].in_value = NULL;
+	fields[0].check_value = NULL;
+	fields[0].check_mask = NULL;
 
 	fields[1].tap = etm_reg->jtag_info->tap;
 	fields[1].num_bits = 7;
 	fields[1].out_value = malloc(1);
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
 	fields[1].in_value = NULL;
+	fields[1].check_value = NULL;
+	fields[1].check_mask = NULL;
 
 	fields[2].tap = etm_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = malloc(1);
 	buf_set_u32(fields[2].out_value, 0, 1, 0);
 	fields[2].in_value = NULL;
+	fields[2].check_value = NULL;
+	fields[2].check_mask = NULL;
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_value = reg->value;
+	fields[0].check_value = check_value;
+	fields[0].check_mask = check_mask;
 
-	jtag_add_dr_scan(3, fields, TAP_INVALID);
+	jtag_add_dr_scan_check(3, fields, TAP_INVALID);
 
-	jtag_check_value_mask(fields+0, check_value, check_mask);
-
 	free(fields[1].out_value);
 	free(fields[2].out_value);
 



From oharboe at mail.berlios.de  Mon May 11 11:18:02 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 11:18:02 +0200
Subject: [Openocd-svn] r1740 - trunk/src/pld
Message-ID: <200905110918.n4B9I2sX013427@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 11:18:02 +0200 (Mon, 11 May 2009)
New Revision: 1740

Modified:
   trunk/src/pld/virtex2.c
Log:
switch to jtag_add_dr_scan() from the synchronous version - USB performance fix

Modified: trunk/src/pld/virtex2.c
===================================================================
--- trunk/src/pld/virtex2.c	2009-05-11 09:14:47 UTC (rev 1739)
+++ trunk/src/pld/virtex2.c	2009-05-11 09:18:02 UTC (rev 1740)
@@ -92,6 +92,10 @@
 	return ERROR_OK;
 }
 
+static __inline__ void virtexflip32(u8 *in)
+{
+	*((u32 *)in)=flip_u32(le_to_h_u32(in), 32);
+}
 
 int virtex2_receive_32(struct pld_device_s *pld_device, int num_words, u32 *words)
 {
@@ -101,16 +105,19 @@
 	scan_field.tap = virtex2_info->tap;
 	scan_field.num_bits = 32;
 	scan_field.out_value = NULL;
-	u8 tmp[4];
-	scan_field.in_value = tmp;
+	scan_field.in_value = NULL;
 
 	virtex2_set_instr(virtex2_info->tap, 0x4); /* CFG_OUT */
 
 	while (num_words--)
 	{
-		jtag_add_dr_scan_now(1, &scan_field, TAP_DRPAUSE);
+		scan_field.in_value = (u8 *)words;
+		
+		jtag_add_dr_scan(1, &scan_field, TAP_DRPAUSE);
 
-		*words++=flip_u32(le_to_h_u32(tmp), 32);
+		jtag_add_callback(virtexflip32, (u8 *)words);
+
+		words++;;
 	}
 
 	return ERROR_OK;



From oharboe at mail.berlios.de  Mon May 11 11:36:57 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 11:36:57 +0200
Subject: [Openocd-svn] r1741 - trunk/src/jtag
Message-ID: <200905110936.n4B9avXq017345@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 11:36:55 +0200 (Mon, 11 May 2009)
New Revision: 1741

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
Log:
retire jtag_add_dr_scan_now

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-11 09:18:02 UTC (rev 1740)
+++ trunk/src/jtag/jtag.c	2009-05-11 09:36:55 UTC (rev 1741)
@@ -781,12 +781,6 @@
 
 }
 
-void jtag_add_dr_scan_now(int num_fields, scan_field_t *fields, tap_state_t state)
-{
-	jtag_add_dr_scan(num_fields, fields, state);
-	jtag_execute_queue_noclear();
-}
-
 int MINIDRIVER(interface_jtag_add_dr_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
 {
 	int j;

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-11 09:18:02 UTC (rev 1740)
+++ trunk/src/jtag/jtag.h	2009-05-11 09:36:55 UTC (rev 1741)
@@ -567,10 +567,6 @@
 
 /* This version of jtag_add_dr_scan() uses the check_value/mask fields */
 extern void jtag_add_dr_scan_check(int num_fields, scan_field_t* fields, tap_state_t endstate);
-/* same as jtag_add_dr_scan but the scan is executed immediately. sets jtag_error if there
- * was a failure.
- */
-extern void jtag_add_dr_scan_now(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern int  interface_jtag_add_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern void jtag_add_plain_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern int  interface_jtag_add_plain_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);



From oharboe at mail.berlios.de  Mon May 11 11:43:51 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 11:43:51 +0200
Subject: [Openocd-svn] r1742 - trunk/src/target
Message-ID: <200905110943.n4B9hpAf018477@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 11:43:50 +0200 (Mon, 11 May 2009)
New Revision: 1742

Modified:
   trunk/src/target/xscale.c
Log:
USB performance regression fix

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-11 09:36:55 UTC (rev 1741)
+++ trunk/src/target/xscale.c	2009-05-11 09:43:50 UTC (rev 1742)
@@ -213,6 +213,7 @@
 
 		jtag_add_ir_scan(1, &field, TAP_INVALID);
 
+		/* FIX!!!! isn't this check superfluous? verify_ircapture handles this? */
 		jtag_check_value_mask(&field, tap->expected, tap->expected_mask);
 
 		free(field.out_value);
@@ -326,19 +327,22 @@
 	fields[0].tap = xscale->jtag_info.tap;
 	fields[0].num_bits = 3;
 	fields[0].out_value = NULL;
-	u8 tmp2;
-	fields[0].in_value = &tmp2;
+	fields[0].in_value = NULL;
+	fields[0].check_value = &field0_check_value;
+	fields[0].check_mask = &field0_check_mask;
 
 	fields[1].tap = xscale->jtag_info.tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
+	fields[1].check_value = NULL;
+	fields[1].check_mask = NULL;
 
-
 	fields[2].tap = xscale->jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
-	u8 tmp3;
-	fields[2].in_value = &tmp3;
+	fields[2].in_value = NULL;
+	fields[2].check_value = &field2_check_value;
+	fields[2].check_mask = &field2_check_mask;
 
 	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale->jtag_info.tap, xscale->jtag_info.dbgtx);
@@ -357,13 +361,11 @@
 			jtag_add_pathmove(3, path);
 
 			fields[1].in_value = (u8 *)(field1+i);
-			jtag_add_dr_scan(3, fields, TAP_IDLE);
 
+			jtag_add_dr_scan_check(3, fields, TAP_IDLE);
+
 			jtag_add_callback(xscale_getbuf, (u8 *)(field1+i));
 
-			jtag_check_value_mask(fields+0, &field0_check_value, &field0_check_mask);
-			jtag_check_value_mask(fields+2, &field2_check_value, &field2_check_mask);
-
 			words_scheduled++;
 		}
 



From oharboe at mail.berlios.de  Mon May 11 12:10:12 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 12:10:12 +0200
Subject: [Openocd-svn] r1743 - trunk/src/jtag
Message-ID: <200905111010.n4BAACeq022542@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 12:10:11 +0200 (Mon, 11 May 2009)
New Revision: 1743

Modified:
   trunk/src/jtag/jtag.c
Log:
fix USB performance regression for verify_ircapture

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-11 09:43:50 UTC (rev 1742)
+++ trunk/src/jtag/jtag.c	2009-05-11 10:10:11 UTC (rev 1743)
@@ -37,6 +37,8 @@
 
 int jtag_flush_queue_count; /* count # of flushes for profiling / debugging purposes */
 
+static void jtag_add_scan_check(void (*jtag_add_scan)(int num_fields, scan_field_t *fields, tap_state_t state),
+		int num_fields, scan_field_t *fields, tap_state_t state);
 
 /* note that this is not marked as static as it must be available from outside jtag.c for those
    that implement the jtag_xxx() minidriver layer
@@ -549,54 +551,22 @@
 void jtag_add_ir_scan(int num_fields, scan_field_t *fields, tap_state_t state)
 {
 	/* 8 x 32 bit id's is enough for all invoations */
-	u32 id[8];
-	int modified[8];
-
-	/* if we are to run a verification of the ir scan, we need to get the input back.
-	 * We may have to allocate space if the caller didn't ask for the input back.
-	 *
-	 */
-	if (jtag_verify_capture_ir)
+	int j;
+	for (j = 0; j < num_fields; j++)
 	{
-		int j;
-		for (j = 0; j < num_fields; j++)
+		fields[j].check_value=NULL;
+		fields[j].check_mask=NULL;
+		/* if we are to run a verification of the ir scan, we need to get the input back.
+		 * We may have to allocate space if the caller didn't ask for the input back.
+		 */
+		if (jtag_verify_capture_ir)
 		{
-			modified[j]=0;
-			if ((fields[j].in_value==NULL)&&(fields[j].num_bits<=32))
-			{
-				if (j<8)
-				{
-					modified[j]=1;
-					fields[j].in_value=(u8 *)(id+j);
-				} else
-				{
-					LOG_DEBUG("caller must provide in_value space for verify_capture_ir to work");
-				}
-			}
+			fields[j].check_value=fields[j].tap->expected;
+			fields[j].check_mask=fields[j].tap->expected_mask;
 		}
 	}
 
-	jtag_add_ir_scan_noverify(num_fields, fields, state);
-
-	if (jtag_verify_capture_ir)
-	{
-		int j;
-		for (j = 0; j < num_fields; j++)
-		{
-			jtag_tap_t *tap=fields[j].tap;
-			if (fields[j].in_value!=NULL)
-			{
-				/* we verify max 32 bit long irlens. */
-				jtag_check_value_mask(fields+j, tap->expected, tap->expected_mask);
-			}
-
-			if (modified[j])
-			{
-				fields[j].in_value=NULL;
-			}
-		}
-	}
-
+	jtag_add_scan_check(jtag_add_ir_scan_noverify, num_fields, fields, state);
 }
 
 int MINIDRIVER(interface_jtag_add_ir_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
@@ -733,7 +703,8 @@
 	return jtag_check_value_inner(in, (u8 *)data1, (u8 *)data2, (int)data3);
 }
 
-void jtag_add_dr_scan_check(int num_fields, scan_field_t *fields, tap_state_t state)
+static void jtag_add_scan_check(void (*jtag_add_scan)(int num_fields, scan_field_t *fields, tap_state_t state),
+		int num_fields, scan_field_t *fields, tap_state_t state)
 {
 	for (int i=0; i<num_fields; i++)
 	{
@@ -759,7 +730,7 @@
 		}
 	}
 
-	jtag_add_dr_scan(num_fields, fields, state);
+	jtag_add_scan(num_fields, fields, state);
 
 	for (int i=0; i<num_fields; i++)
 	{
@@ -777,10 +748,16 @@
 			fields[i].in_value=NULL;
 		}
 	}
+}
 
-
+void jtag_add_dr_scan_check(int num_fields, scan_field_t *fields, tap_state_t state)
+{
+	jtag_add_scan_check(jtag_add_dr_scan, num_fields, fields, state);
 }
 
+
+
+
 int MINIDRIVER(interface_jtag_add_dr_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
 {
 	int j;



From zwelch at mail.berlios.de  Mon May 11 13:20:53 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 11 May 2009 13:20:53 +0200
Subject: [Openocd-svn] r1744 - in trunk: . src/helper
Message-ID: <200905111120.n4BBKrA1009404@sheep.berlios.de>

Author: zwelch
Date: 2009-05-11 13:20:45 +0200 (Mon, 11 May 2009)
New Revision: 1744

Modified:
   trunk/configure.in
   trunk/src/helper/jim-eventloop.c
   trunk/src/helper/jim.c
   trunk/src/helper/jim.h
Log:
Update jim helper files to use proper configure script support:
- configure.in: Add AC_TYPE_LONG_LONG_INT to detect 'long long int' support.
- configure.in: Add AC_C_CONST to provide equivalent support as jim.h.
- jim*.c: include config.h when HAVE_CONFIG_H is defined.
- jim*.{h,c}: use HAVE_LONG_LONG_INT definition from config.h.
- jim.h: Remove hard-coded const and HAVE_LONG_LONG definitions.
- jim.h: -DJIM_NO_CONST has been obsoleted; -Dconst is equivalent.


Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-11 10:10:11 UTC (rev 1743)
+++ trunk/configure.in	2009-05-11 11:20:45 UTC (rev 1744)
@@ -816,6 +816,10 @@
 AC_PROG_RANLIB
 AC_PROG_LIBTOOL
 
+dnl configure checks required for Jim files (these are obsolete w/ C99)
+AC_C_CONST
+AC_TYPE_LONG_LONG_INT
+
 # Look for environ alternatives.  Possibility #1: is environ in unistd.h or stdlib.h?
 AC_MSG_CHECKING([for environ in unistd.h and stdlib.h])
 AC_COMPILE_IFELSE([

Modified: trunk/src/helper/jim-eventloop.c
===================================================================
--- trunk/src/helper/jim-eventloop.c	2009-05-11 10:10:11 UTC (rev 1743)
+++ trunk/src/helper/jim-eventloop.c	2009-05-11 11:20:45 UTC (rev 1744)
@@ -44,6 +44,9 @@
  *  - more complete [after] command with [after info] and other subcommands.
  *  - Win32 port
  */
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
 
 #define JIM_EXTENSION
 #define __JIM_EVENTLOOP_CORE__

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-11 10:10:11 UTC (rev 1743)
+++ trunk/src/helper/jim.c	2009-05-11 11:20:45 UTC (rev 1744)
@@ -39,6 +39,10 @@
  * are those of the authors and should not be interpreted as representing
  * official policies, either expressed or implied, of the Jim Tcl Project.
  **/
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
 #define __JIM_CORE__
 #define JIM_OPTIMIZATION /* comment to avoid optimizations and reduce size */
 
@@ -160,7 +164,7 @@
  * Ignores `locale' stuff.  Assumes that the upper and lower case
  * alphabets and digits are each contiguous.
  */
-#ifdef HAVE_LONG_LONG
+#ifdef HAVE_LONG_LONG_INT
 #define JimIsAscii(c) (((c) & ~0x7f) == 0)
 static jim_wide JimStrtoll(const char *nptr, char **endptr, register int base)
 {
@@ -424,7 +428,7 @@
 {
     char *endptr;
 
-#ifdef HAVE_LONG_LONG
+#ifdef HAVE_LONG_LONG_INT
     *widePtr = JimStrtoll(str, &endptr, base);
 #else
     *widePtr = strtol(str, &endptr, base);
@@ -7662,7 +7666,7 @@
                     /* Try to scan a number with the given base */
                     if (descr->modifier == 'l')
                     {
-#ifdef HAVE_LONG_LONG
+#ifdef HAVE_LONG_LONG_INT
                         jwvalue = JimStrtoll(tok, &endp, base),
 #else
                         jwvalue = strtol(tok, &endp, base),

Modified: trunk/src/helper/jim.h
===================================================================
--- trunk/src/helper/jim.h	2009-05-11 10:10:11 UTC (rev 1743)
+++ trunk/src/helper/jim.h	2009-05-11 11:20:45 UTC (rev 1744)
@@ -78,25 +78,6 @@
 #include <stdarg.h> /* In order to get type va_list */
 
 /* -----------------------------------------------------------------------------
-* Some /very/ old compiler maybe do not know how to
-* handle 'const'. They even do not know, how to ignore
-* it. For those compiler it may be better to compile with
-* define JIM_NO_CONST activated
-* ---------------------------------------------------------------------------*/
-
-#ifdef JIM_NO_CONST
-#  define const
-#endif
-
-/* -----------------------------------------------------------------------------
- * System configuration
- * For most modern systems, you can leave the default.
- * For embedded systems some change may be required.
- * ---------------------------------------------------------------------------*/
-
-#define HAVE_LONG_LONG
-
-/* -----------------------------------------------------------------------------
  * Compiler specific fixes.
  * ---------------------------------------------------------------------------*/
 
@@ -106,7 +87,7 @@
 #endif /* _MSC_VER */
 
 /* Long Long type and related issues */
-#ifdef HAVE_LONG_LONG
+#ifdef HAVE_LONG_LONG_INT
 #  ifdef _MSC_VER /* MSC compiler */
 #    define jim_wide _int64
 #    ifndef LLONG_MAX
@@ -138,7 +119,7 @@
  * LIBC specific fixes
  * ---------------------------------------------------------------------------*/
 
-#ifdef HAVE_LONG_LONG
+#ifdef HAVE_LONG_LONG_INT
 # if defined(_MSC_VER) || defined(__MSVCRT__)
 #    define JIM_WIDE_MODIFIER "I64d"
 # else



From oharboe at mail.berlios.de  Mon May 11 13:27:36 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 13:27:36 +0200
Subject: [Openocd-svn] r1745 -
	zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf
Message-ID: <200905111127.n4BBRaGQ016951@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 13:27:35 +0200 (Mon, 11 May 2009)
New Revision: 1745

Modified:
   zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi
Log:
wip

Modified: zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi
===================================================================
--- zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi	2009-05-11 11:20:45 UTC (rev 1744)
+++ zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi	2009-05-11 11:27:35 UTC (rev 1745)
@@ -39,6 +39,13 @@
  * (*phi_misc*)    ;  
  * (*cyg_sbdrop*)    ;  
  * (*target_call_event_callbacks*)    ;  
+ * (*alarm_thread*)    ;  
+ * (*embedded_set_reg*)    ;  
+ * (*bcmp*)    ;  
+ * (text.write)    ;  
+ * (text.malloc)    ;  
+ * (text.cyg_ticks)    ;  
+ * (text.free)    ;  
  
  
 



From oharboe at mail.berlios.de  Mon May 11 14:03:41 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 14:03:41 +0200
Subject: [Openocd-svn] r1746 - trunk/src/target
Message-ID: <200905111203.n4BC3fGF016134@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 14:03:40 +0200 (Mon, 11 May 2009)
New Revision: 1746

Modified:
   trunk/src/target/etm.c
Log:
fix jtag_add_dr_scan() usage a bit... avoid lots of malloc()'s.

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-11 11:27:35 UTC (rev 1745)
+++ trunk/src/target/etm.c	2009-05-11 12:03:40 UTC (rev 1746)
@@ -411,31 +411,27 @@
 
 	fields[0].tap = etm_reg->jtag_info->tap;
 	fields[0].num_bits = 32;
-	fields[0].out_value = malloc(4);
+	u8 tmp1[4];
+	fields[0].out_value = tmp1;
 	buf_set_u32(fields[0].out_value, 0, 32, value);
-
 	fields[0].in_value = NULL;
 
 	fields[1].tap = etm_reg->jtag_info->tap;
 	fields[1].num_bits = 7;
-	fields[1].out_value = malloc(1);
+	u8 tmp2;
+	fields[1].out_value = &tmp2;
 	buf_set_u32(fields[1].out_value, 0, 7, reg_addr);
-
 	fields[1].in_value = NULL;
 
 	fields[2].tap = etm_reg->jtag_info->tap;
 	fields[2].num_bits = 1;
-	fields[2].out_value = malloc(1);
+	u8 tmp3;
+	fields[2].out_value = &tmp3;
 	buf_set_u32(fields[2].out_value, 0, 1, 1);
-
 	fields[2].in_value = NULL;
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	free(fields[0].out_value);
-	free(fields[1].out_value);
-	free(fields[2].out_value);
-
 	return ERROR_OK;
 }
 



From oharboe at mail.berlios.de  Mon May 11 15:40:50 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 11 May 2009 15:40:50 +0200
Subject: [Openocd-svn] r1747 - zy1000/trunk/build/include
Message-ID: <200905111340.n4BDeol7030588@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 15:40:48 +0200 (Mon, 11 May 2009)
New Revision: 1747

Modified:
   zy1000/trunk/build/include/jtag_minidriver.h
Log:
sync up to bitbang driver when exiting scans

Modified: zy1000/trunk/build/include/jtag_minidriver.h
===================================================================
--- zy1000/trunk/build/include/jtag_minidriver.h	2009-05-11 12:03:40 UTC (rev 1746)
+++ zy1000/trunk/build/include/jtag_minidriver.h	2009-05-11 13:40:48 UTC (rev 1747)
@@ -162,7 +162,7 @@
 		nextTap=jtag_NextEnabledTap(tap);
 		if (nextTap==NULL)
 		{
-			pause_state = TAP_DRPAUSE;
+			pause_state = end_state;
 		}
 		if (tap == target_tap)
 		{
@@ -178,7 +178,6 @@
 			shiftValueInner(TAP_DRSHIFT, pause_state, 1, 0);
 		}
 	}
-	setCurrentState(end_state);
 }
 
 static __inline__ void interface_jtag_add_dr_out(jtag_tap_t *target_tap,
@@ -194,14 +193,12 @@
 		/* used by embeddedice_write_reg_inner() */
 		shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, num_bits[0], value[0]);
 		shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, num_bits[1], value[1]);
-		shiftValueInner(TAP_DRSHIFT, TAP_DRPAUSE, num_bits[2], value[2]);
-		setCurrentState(end_state);
+		shiftValueInner(TAP_DRSHIFT, end_state, num_bits[2], value[2]);
 	} else if ((singletap)&&(num_fields==2))
 	{
 		/* used by arm7 code */
 		shiftValueInner(TAP_DRSHIFT, TAP_DRSHIFT, num_bits[0], value[0]);
-		shiftValueInner(TAP_DRSHIFT, TAP_DRPAUSE, num_bits[1], value[1]);
-		setCurrentState(end_state);
+		shiftValueInner(TAP_DRSHIFT, end_state, num_bits[1], value[1]);
 	} else
 	{
 		interface_jtag_add_dr_out_core(target_tap, num_fields, num_bits, value, end_state);



From oharboe at mail.berlios.de  Mon May 11 23:05:54 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 11 May 2009 23:05:54 +0200
Subject: [Openocd-svn] r1748 - in trunk/src: jtag target
Message-ID: <200905112105.n4BL5spa006944@sheep.berlios.de>

Author: oharboe
Date: 2009-05-11 23:05:51 +0200 (Mon, 11 May 2009)
New Revision: 1748

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/target/arm7tdmi.c
Log:
now builds on 64 and 32 bit systems

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-11 13:40:48 UTC (rev 1747)
+++ trunk/src/jtag/jtag.c	2009-05-11 21:05:51 UTC (rev 1748)
@@ -737,7 +737,7 @@
 		if ((fields[i].check_value!=NULL)&&(fields[i].in_value!=NULL))
 		{
 			/* this is synchronous for a minidriver */
-			jtag_add_callback4(jtag_check_value_mask_callback, fields[i].in_value, fields[i].check_value, fields[i].check_mask, (jtag_callback_data_t)fields[i].num_bits);
+			jtag_add_callback4(jtag_check_value_mask_callback, fields[i].in_value, (jtag_callback_data_t)fields[i].check_value, (jtag_callback_data_t)fields[i].check_mask, (jtag_callback_data_t)fields[i].num_bits);
 		}
 		if (fields[i].allocated)
 		{

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-11 13:40:48 UTC (rev 1747)
+++ trunk/src/jtag/jtag.h	2009-05-11 21:05:51 UTC (rev 1748)
@@ -589,7 +589,7 @@
 
 /* This type can store an integer safely by a normal cast on 64 and
  * 32 bit systems. */
-typedef void *jtag_callback_data_t;
+typedef intptr_t jtag_callback_data_t;
 
 /* The generic callback mechanism.
  *

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-11 13:40:48 UTC (rev 1747)
+++ trunk/src/target/arm7tdmi.c	2009-05-11 21:05:51 UTC (rev 1748)
@@ -278,7 +278,7 @@
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
-	jtag_add_callback4(arm7endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be, NULL);
+	jtag_add_callback4(arm7endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be, (jtag_callback_data_t)NULL);
 
 	jtag_add_runtest(0, TAP_INVALID);
 



From zwelch at mail.berlios.de  Tue May 12 00:38:04 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 00:38:04 +0200
Subject: [Openocd-svn] r1749 - trunk/src/server/httpd
Message-ID: <200905112238.n4BMc42x019722@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 00:37:52 +0200 (Tue, 12 May 2009)
New Revision: 1749

Modified:
   trunk/src/server/httpd/httpd.tcl
Log:
Remove duplicate definition of encode in httpd.tcl.

Modified: trunk/src/server/httpd/httpd.tcl
===================================================================
--- trunk/src/server/httpd/httpd.tcl	2009-05-11 21:05:51 UTC (rev 1748)
+++ trunk/src/server/httpd/httpd.tcl	2009-05-11 22:37:52 UTC (rev 1749)
@@ -94,11 +94,6 @@
 }
  
 
-# encode text
-proc encode {a} {
-	return [string map {\n <br/> { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} > &gt; < &lt; / &#47;} $a]
-}
-
 proc first_flash_base {} {
 	set t [lindex 0 [ocd_flash_banks]]
 	return $t(base)



From zwelch at mail.berlios.de  Tue May 12 06:52:23 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 06:52:23 +0200
Subject: [Openocd-svn] r1750 - in trunk/src: helper jtag xsvf
Message-ID: <200905120452.n4C4qNO9017595@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 06:52:15 +0200 (Tue, 12 May 2009)
New Revision: 1750

Modified:
   trunk/src/helper/system.h
   trunk/src/jtag/jtag.c
   trunk/src/xsvf/xsvf.c
Log:
Include assert.h in system.h to promote tree-wide use of assertions.

Modified: trunk/src/helper/system.h
===================================================================
--- trunk/src/helper/system.h	2009-05-11 22:37:52 UTC (rev 1749)
+++ trunk/src/helper/system.h	2009-05-12 04:52:15 UTC (rev 1750)
@@ -26,6 +26,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
+#include <assert.h>
 #include <ctype.h>
 #include <errno.h>
 

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-11 22:37:52 UTC (rev 1749)
+++ trunk/src/jtag/jtag.c	2009-05-12 04:52:15 UTC (rev 1750)
@@ -33,8 +33,8 @@
 #ifdef HAVE_STRINGS_H
 #include <strings.h>
 #endif
-#include <assert.h>
 
+
 int jtag_flush_queue_count; /* count # of flushes for profiling / debugging purposes */
 
 static void jtag_add_scan_check(void (*jtag_add_scan)(int num_fields, scan_field_t *fields, tap_state_t state),

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-11 22:37:52 UTC (rev 1749)
+++ trunk/src/xsvf/xsvf.c	2009-05-12 04:52:15 UTC (rev 1750)
@@ -44,9 +44,7 @@
 #include "xsvf.h"
 #include "jtag.h"
 
-#include <assert.h>
 
-
 /* XSVF commands, from appendix B of xapp503.pdf  */
 #define XCOMPLETE		0x00
 #define XTDOMASK			0x01



From oharboe at mail.berlios.de  Tue May 12 08:17:24 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 12 May 2009 08:17:24 +0200
Subject: [Openocd-svn] r1751 - trunk/src/jtag
Message-ID: <200905120617.n4C6HOuL031219@sheep.berlios.de>

Author: oharboe
Date: 2009-05-12 08:17:22 +0200 (Tue, 12 May 2009)
New Revision: 1751

Modified:
   trunk/src/jtag/jtag.c
Log:
fix ancient bug & SEGFAULT in irscan

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-12 04:52:15 UTC (rev 1750)
+++ trunk/src/jtag/jtag.c	2009-05-12 06:17:22 UTC (rev 1751)
@@ -2889,9 +2889,11 @@
 		}
 	}
 
-	fields = malloc(sizeof(scan_field_t) * argc / 2);
+	int num_fields= num_fields;
 
-	for (i = 0; i < argc / 2; i++)
+	fields = malloc(sizeof(scan_field_t) * num_fields);
+
+	for (i = 0; i < num_fields; i++)
 	{
 		tap = jtag_TapByString( args[i*2] );
 		if (tap==NULL)
@@ -2901,19 +2903,20 @@
 		}
 		int field_size = tap->ir_length;
 		fields[i].tap = tap;
+		fields[i].num_bits = field_size;
 		fields[i].out_value = malloc(CEIL(field_size, 8));
 		buf_set_u32(fields[i].out_value, 0, field_size, strtoul(args[i*2+1], NULL, 0));
 		fields[i].in_value = NULL;
 	}
 
-	jtag_add_ir_scan(argc / 2, fields, TAP_INVALID);
+	jtag_add_ir_scan(num_fields, fields, TAP_INVALID);
 	/* did we have an endstate? */
 	if (endstate != TAP_INVALID)
 		jtag_add_end_state(endstate);
 
 	jtag_execute_queue();
 
-	for (i = 0; i < argc / 2; i++)
+	for (i = 0; i < num_fields; i++)
 		free(fields[i].out_value);
 
 	free (fields);



From oharboe at mail.berlios.de  Tue May 12 08:59:22 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 12 May 2009 08:59:22 +0200
Subject: [Openocd-svn] r1752 - trunk/src/jtag
Message-ID: <200905120659.n4C6xMbJ019677@sheep.berlios.de>

Author: oharboe
Date: 2009-05-12 08:59:21 +0200 (Tue, 12 May 2009)
New Revision: 1752

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
Log:
added jtag_alloc_in_value32 - not used in this commit.

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-12 06:17:22 UTC (rev 1751)
+++ trunk/src/jtag/jtag.c	2009-05-12 06:59:21 UTC (rev 1752)
@@ -718,7 +718,7 @@
 			if (fields[i].num_bits<=32)
 			{
 				/* This is enough space and we're executing this synchronously */
-				fields[i].in_value=(u8 *)&fields[i].intmp;
+				fields[i].in_value=fields[i].intmp;
 			} else
 			{
 				fields[i].in_value=(u8 *)malloc(CEIL(fields[i].num_bits, 8));
@@ -3562,4 +3562,12 @@
 }
 #endif // _DEBUG_JTAG_IO_
 
+#ifndef HAVE_JTAG_MINIDRIVER_H
+void jtag_alloc_in_value32(scan_field_t *field)
+{
+	field->in_value=(u8 *)cmd_queue_alloc(4);
+}
+#endif
+
+
 /*-----</Cable Helper API>--------------------------------------*/

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-12 06:17:22 UTC (rev 1751)
+++ trunk/src/jtag/jtag.h	2009-05-12 06:59:21 UTC (rev 1752)
@@ -277,7 +277,7 @@
 	/* internal work space */
 	int			allocated;			/* in_value has been allocated for the queue */
 	int			modified;			/* did we modify the in_value? */
-	u32			intmp;				/* temporary storage for checking synchronously */
+	u8			intmp[4];			/* temporary storage for checking synchronously */
 } scan_field_t;
 
 enum scan_type {
@@ -565,6 +565,26 @@
 extern int  interface_jtag_add_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern void jtag_add_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 
+/* set in_value to point to 32 bits of memory to scan into. This function
+ * is a way to handle the case of synchronous and asynchronous
+ * JTAG queues.
+ *
+ * In the event of an asynchronous queue execution the queue buffer
+ * allocation method is used, for the synchronous case the temporary 32 bits come
+ * from the input field itself.
+ */
+
+#ifndef HAVE_JTAG_MINIDRIVER_H
+extern void jtag_alloc_in_value32(scan_field_t *field);
+#else
+static __inline__ void jtag_alloc_in_value32(scan_field_t *field)
+{
+	field->in_value=field->intmp;
+}
+#endif
+
+
+
 /* This version of jtag_add_dr_scan() uses the check_value/mask fields */
 extern void jtag_add_dr_scan_check(int num_fields, scan_field_t* fields, tap_state_t endstate);
 extern int  interface_jtag_add_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);



From oharboe at mail.berlios.de  Tue May 12 09:03:50 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 12 May 2009 09:03:50 +0200
Subject: [Openocd-svn] r1753 - trunk/src/target
Message-ID: <200905120703.n4C73oRW020332@sheep.berlios.de>

Author: oharboe
Date: 2009-05-12 09:03:50 +0200 (Tue, 12 May 2009)
New Revision: 1753

Modified:
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm9tdmi.c
Log:
fix memory corruption introduce in 1730

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-12 06:59:21 UTC (rev 1752)
+++ trunk/src/target/arm7tdmi.c	2009-05-12 07:03:50 UTC (rev 1753)
@@ -244,9 +244,9 @@
 	}
 }
 
-static int arm7endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be, jtag_callback_data_t dummy)
+static int arm7endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be, jtag_callback_data_t captured)
 {
-	arm_endianness(in, in, (int)size, (int)be, 1);
+	arm_endianness((u8 *)captured, in, (int)size, (int)be, 1);
 	return ERROR_OK;
 }
 
@@ -274,11 +274,11 @@
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 32;
 	fields[1].out_value = NULL;
-	fields[1].in_value = (u8 *)in;
+	jtag_alloc_in_value32(&fields[1]);
 
 	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
-	jtag_add_callback4(arm7endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be, (jtag_callback_data_t)NULL);
+	jtag_add_callback4(arm7endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be, (jtag_callback_data_t)fields[1].in_value);
 
 	jtag_add_runtest(0, TAP_INVALID);
 

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-12 06:59:21 UTC (rev 1752)
+++ trunk/src/target/arm9tdmi.c	2009-05-12 07:03:50 UTC (rev 1753)
@@ -291,9 +291,9 @@
 
 extern void arm_endianness(u8 *tmp, void *in, int size, int be, int flip);
 
-static int arm9endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be, jtag_callback_data_t dummy)
+static int arm9endianness(u8 *in, jtag_callback_data_t size, jtag_callback_data_t be, jtag_callback_data_t captured)
 {
-	arm_endianness(in, in, (int)size, (int)be, 0);
+	arm_endianness((u8 *)captured, in, (int)size, (int)be, 0);
 	return ERROR_OK;
 }
 
@@ -317,7 +317,7 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = NULL;
-	fields[0].in_value = (u8 *)in;
+	jtag_alloc_in_value32(&fields[0]);
 
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
@@ -331,7 +331,7 @@
 
 	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	jtag_add_callback4(arm9endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be, 0);
+	jtag_add_callback4(arm9endianness, in, (jtag_callback_data_t)size, (jtag_callback_data_t)be, (jtag_callback_data_t)fields[0].in_value);
 
 	jtag_add_runtest(0, TAP_INVALID);
 



From zwelch at mail.berlios.de  Tue May 12 09:12:14 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 09:12:14 +0200
Subject: [Openocd-svn] r1754 - trunk/tools/rlink_make_speed_table
Message-ID: <200905120712.n4C7CEEE021372@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 09:12:10 +0200 (Tue, 12 May 2009)
New Revision: 1754

Modified:
   trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl
Log:
Update rlink_make_speed_table.pl script to add config.h to its output.

Modified: trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl
===================================================================
--- trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl	2009-05-12 07:03:50 UTC (rev 1753)
+++ trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl	2009-05-12 07:12:10 UTC (rev 1754)
@@ -21,14 +21,21 @@
 
 # A simple utility to read a list of files (names composed by numeric prescaler arguments) and compose a C source file defining data structures which hold the binary data read from those files.
 
- at speed_table = ();
+my @speed_table = ();
 
-printf("/* This file was created automatically by %s. */\n\n", $0);
-for $i ('rlink', 'st7') {
-	printf("#include \"$i.h\"\n");
-}
-printf("\n");
+print <<HEADER;
+/* This file was created automatically by the following script:
+ *   $0
+ */
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
 
+#include "rlink.h"
+#include "st7.h"
+
+HEADER
+
 for $prescaler (sort {$b <=> $a} @ARGV) {
 	my(@ary) = (
 		byte_array_from_file(${prescaler} . "_init.dtc"),



From zwelch at mail.berlios.de  Tue May 12 09:13:16 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 09:13:16 +0200
Subject: [Openocd-svn] r1755 - trunk/src/jtag/rlink
Message-ID: <200905120713.n4C7DGu1021479@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 09:13:12 +0200 (Tue, 12 May 2009)
New Revision: 1755

Modified:
   trunk/src/jtag/rlink/rlink_speed_table.c
Log:
Include config.h in pregenerated rlink_speed_table.c source.

Modified: trunk/src/jtag/rlink/rlink_speed_table.c
===================================================================
--- trunk/src/jtag/rlink/rlink_speed_table.c	2009-05-12 07:12:10 UTC (rev 1754)
+++ trunk/src/jtag/rlink/rlink_speed_table.c	2009-05-12 07:13:12 UTC (rev 1755)
@@ -1,4 +1,7 @@
 /* This file was created automatically by ../../../tools/rlink_make_speed_table/rlink_make_speed_table.pl. */
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
 
 #include "rlink.h"
 #include "st7.h"



From zwelch at mail.berlios.de  Tue May 12 09:22:10 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 09:22:10 +0200
Subject: [Openocd-svn] r1756 - trunk/src/helper
Message-ID: <200905120722.n4C7MAWm022487@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 09:22:07 +0200 (Tue, 12 May 2009)
New Revision: 1756

Modified:
   trunk/src/helper/types.h
Log:
Remove config.h from types.h; all .c files are required to include it.

Modified: trunk/src/helper/types.h
===================================================================
--- trunk/src/helper/types.h	2009-05-12 07:13:12 UTC (rev 1755)
+++ trunk/src/helper/types.h	2009-05-12 07:22:07 UTC (rev 1756)
@@ -23,10 +23,6 @@
 #ifndef TYPES_H
 #define TYPES_H
 
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
 #ifdef HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif



From zwelch at mail.berlios.de  Tue May 12 09:35:07 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 09:35:07 +0200
Subject: [Openocd-svn] r1757 - in trunk: . src/helper src/target
Message-ID: <200905120735.n4C7Z7bS024178@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 09:35:00 +0200 (Tue, 12 May 2009)
New Revision: 1757

Modified:
   trunk/configure.in
   trunk/src/helper/jim.c
   trunk/src/target/oocd_trace.c
Log:
Define _GNU_SOURCE in config.h, remove definitions from source files.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-12 07:22:07 UTC (rev 1756)
+++ trunk/configure.in	2009-05-12 07:35:00 UTC (rev 1757)
@@ -851,6 +851,7 @@
      AC_MSG_FAILURE([Could not find 'environ' in unistd.h or available libraries.]) 
 fi
 
+AC_DEFINE([_GNU_SOURCE],[1],[Use GNU C library extensions (e.g. stdndup).])
 
 # set default gcc warnings
 GCC_WARNINGS="-Wall -Wstrict-prototypes -Wformat-security"

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-12 07:22:07 UTC (rev 1756)
+++ trunk/src/helper/jim.c	2009-05-12 07:35:00 UTC (rev 1757)
@@ -53,9 +53,6 @@
 #define JIM_DYNLIB      /* Dynamic library support for UNIX and WIN32 */
 #endif /* JIM_ANSIC */
 
-#ifndef _GNU_SOURCE
-#define _GNU_SOURCE	/* for vasprintf() */
-#endif
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>

Modified: trunk/src/target/oocd_trace.c
===================================================================
--- trunk/src/target/oocd_trace.c	2009-05-12 07:22:07 UTC (rev 1756)
+++ trunk/src/target/oocd_trace.c	2009-05-12 07:35:00 UTC (rev 1757)
@@ -21,11 +21,6 @@
 #include "config.h"
 #endif
 
-// we must define _GNU_SOURCE to get strndup
-#ifndef _GNU_SOURCE
-#define _GNU_SOURCE
-#endif
-
 #include "oocd_trace.h"
 #include "arm7_9_common.h"
 



From zwelch at mail.berlios.de  Tue May 12 09:45:03 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 09:45:03 +0200
Subject: [Openocd-svn] r1758 - trunk/src/helper
Message-ID: <200905120745.n4C7j33F025392@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 09:44:57 +0200 (Tue, 12 May 2009)
New Revision: 1758

Modified:
   trunk/src/helper/jim-eventloop.c
   trunk/src/helper/jim.c
Log:
Audit and reduce #include directives in jim source files.

Modified: trunk/src/helper/jim-eventloop.c
===================================================================
--- trunk/src/helper/jim-eventloop.c	2009-05-12 07:35:00 UTC (rev 1757)
+++ trunk/src/helper/jim-eventloop.c	2009-05-12 07:44:57 UTC (rev 1758)
@@ -61,13 +61,6 @@
 #include "jim-eventloop.h"
 #endif
 
-/* POSIX includes */
-#include <sys/time.h>
-#include <sys/types.h>
-#include <unistd.h>
-#include <stdio.h>
-#include <errno.h>
-
 #include "replacements.h"
 
 

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-12 07:35:00 UTC (rev 1757)
+++ trunk/src/helper/jim.c	2009-05-12 07:44:57 UTC (rev 1758)
@@ -53,20 +53,8 @@
 #define JIM_DYNLIB      /* Dynamic library support for UNIX and WIN32 */
 #endif /* JIM_ANSIC */
 
-#include <stdio.h>
-#include <stdlib.h>
-#include <string.h>
 #include <stdarg.h>
-#include <ctype.h>
 #include <limits.h>
-#include <assert.h>
-#include <errno.h>
-#include <time.h>
-#if defined(WIN32)
-/* sys/time - need is different */
-#else
-#include <sys/time.h> // for gettimeofday()
-#endif
 
 #include "replacements.h"
 
@@ -90,10 +78,6 @@
 #endif /* WIN32 */
 #endif /* JIM_DYNLIB */
 
-#ifdef HAVE_UNISTD_H
-#include <unistd.h>
-#endif
-
 #ifdef __ECOS
 #include <cyg/jimtcl/jim.h>
 #else



From zwelch at mail.berlios.de  Tue May 12 10:24:52 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 10:24:52 +0200
Subject: [Openocd-svn] r1759 - in trunk: . src/helper
Message-ID: <200905120824.n4C8OqGr030268@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 10:24:47 +0200 (Tue, 12 May 2009)
New Revision: 1759

Modified:
   trunk/configure.in
   trunk/src/helper/replacements.h
Log:
Make system.h private by including it from config.h autoheader.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-12 07:44:57 UTC (rev 1758)
+++ trunk/configure.in	2009-05-12 08:24:47 UTC (rev 1759)
@@ -778,6 +778,10 @@
 fi
 
 AM_CONFIG_HEADER(config.h)
+AH_BOTTOM([
+#include "system.h"
+])
+
 AM_INIT_AUTOMAKE([-Wall -Wno-portability])
 AM_MAINTAINER_MODE
 

Modified: trunk/src/helper/replacements.h
===================================================================
--- trunk/src/helper/replacements.h	2009-05-12 07:44:57 UTC (rev 1758)
+++ trunk/src/helper/replacements.h	2009-05-12 08:24:47 UTC (rev 1759)
@@ -27,7 +27,6 @@
 #define REPLACEMENTS_H
 
 #include "types.h"
-#include "system.h"
 
 /* MIN,MAX macros */
 #ifndef MIN



From zwelch at mail.berlios.de  Tue May 12 10:33:21 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 10:33:21 +0200
Subject: [Openocd-svn] r1760 - trunk
Message-ID: <200905120833.n4C8XLXs031310@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 10:33:18 +0200 (Tue, 12 May 2009)
New Revision: 1760

Modified:
   trunk/configure.in
Log:
Make replacements.h private by including it from config.h autoheader.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-12 08:24:47 UTC (rev 1759)
+++ trunk/configure.in	2009-05-12 08:33:18 UTC (rev 1760)
@@ -780,6 +780,7 @@
 AM_CONFIG_HEADER(config.h)
 AH_BOTTOM([
 #include "system.h"
+#include "replacements.h"
 ])
 
 AM_INIT_AUTOMAKE([-Wall -Wno-portability])



From zwelch at mail.berlios.de  Tue May 12 10:35:29 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 10:35:29 +0200
Subject: [Openocd-svn] r1761 - in trunk/src: helper target
Message-ID: <200905120835.n4C8ZThq031525@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 10:35:17 +0200 (Tue, 12 May 2009)
New Revision: 1761

Modified:
   trunk/src/helper/fileio.h
   trunk/src/helper/jim-eventloop.c
   trunk/src/helper/jim.c
   trunk/src/helper/log.h
   trunk/src/helper/replacements.c
   trunk/src/helper/replacements.h
   trunk/src/target/algorithm.c
   trunk/src/target/target.h
Log:
Audit and remove redundant uses of replacements.h in the tree.

Modified: trunk/src/helper/fileio.h
===================================================================
--- trunk/src/helper/fileio.h	2009-05-12 08:33:18 UTC (rev 1760)
+++ trunk/src/helper/fileio.h	2009-05-12 08:35:17 UTC (rev 1761)
@@ -26,10 +26,10 @@
 #ifndef FILEIO_H
 #define FILEIO_H
 
+#include "types.h"
+
 #define FILEIO_MAX_ERROR_STRING		(128)
 
-#include "replacements.h"
-
 enum fileio_type
 {
 	FILEIO_TEXT,

Modified: trunk/src/helper/jim-eventloop.c
===================================================================
--- trunk/src/helper/jim-eventloop.c	2009-05-12 08:33:18 UTC (rev 1760)
+++ trunk/src/helper/jim-eventloop.c	2009-05-12 08:35:17 UTC (rev 1761)
@@ -61,11 +61,6 @@
 #include "jim-eventloop.h"
 #endif
 
-#include "replacements.h"
-
-
-/* --- */
-
 /* File event structure */
 typedef struct Jim_FileEvent {
     void *handle;

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-12 08:33:18 UTC (rev 1760)
+++ trunk/src/helper/jim.c	2009-05-12 08:35:17 UTC (rev 1761)
@@ -56,8 +56,6 @@
 #include <stdarg.h>
 #include <limits.h>
 
-#include "replacements.h"
-
 /* Include the platform dependent libraries for
  * dynamic loading of libraries. */
 #ifdef JIM_DYNLIB

Modified: trunk/src/helper/log.h
===================================================================
--- trunk/src/helper/log.h	2009-05-12 08:33:18 UTC (rev 1760)
+++ trunk/src/helper/log.h	2009-05-12 08:35:17 UTC (rev 1761)
@@ -26,7 +26,6 @@
 #ifndef ERROR_H
 #define ERROR_H
 
-#include "replacements.h"
 #include "command.h"
 
 /* logging priorities 

Modified: trunk/src/helper/replacements.c
===================================================================
--- trunk/src/helper/replacements.c	2009-05-12 08:33:18 UTC (rev 1760)
+++ trunk/src/helper/replacements.c	2009-05-12 08:35:17 UTC (rev 1761)
@@ -23,17 +23,10 @@
  *   Free Software Foundation, Inc.,                                       *
  *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
  ***************************************************************************/
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
 /* DANGER!!!! These must be defined *BEFORE* replacements.h and the malloc() macro!!!! */
 
 #include <stdlib.h>
 #include <string.h>
-#ifdef HAVE_STRINGS_H
-#include <strings.h>
-#endif
 /* 
  * clear_malloc
  *
@@ -65,10 +58,13 @@
 }
 
 #define IN_REPLACEMENTS_C
-#include "replacements.h"
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+#ifdef HAVE_STRINGS_H
+#include <strings.h>
+#endif
 
-#include <stdio.h>
-
 #ifdef _WIN32
 #include <io.h>
 #endif

Modified: trunk/src/helper/replacements.h
===================================================================
--- trunk/src/helper/replacements.h	2009-05-12 08:33:18 UTC (rev 1760)
+++ trunk/src/helper/replacements.h	2009-05-12 08:35:17 UTC (rev 1761)
@@ -26,8 +26,6 @@
 #ifndef REPLACEMENTS_H
 #define REPLACEMENTS_H
 
-#include "types.h"
-
 /* MIN,MAX macros */
 #ifndef MIN
 #define MIN(a,b) (((a)<(b))?(a):(b))

Modified: trunk/src/target/algorithm.c
===================================================================
--- trunk/src/target/algorithm.c	2009-05-12 08:33:18 UTC (rev 1760)
+++ trunk/src/target/algorithm.c	2009-05-12 08:35:17 UTC (rev 1761)
@@ -22,7 +22,6 @@
 #endif
 
 #include "algorithm.h"
-#include "replacements.h"
 #include "binarybuffer.h"
 
 

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-12 08:33:18 UTC (rev 1760)
+++ trunk/src/target/target.h	2009-05-12 08:35:17 UTC (rev 1761)
@@ -30,8 +30,6 @@
 #include "algorithm.h"
 #include "command.h"
 
-#include "replacements.h"
-
 struct reg_s;
 struct trace_s;
 struct command_context_s;



From zwelch at mail.berlios.de  Tue May 12 10:56:25 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 10:56:25 +0200
Subject: [Openocd-svn] r1762 - trunk
Message-ID: <200905120856.n4C8uPKa001484@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 10:56:22 +0200 (Tue, 12 May 2009)
New Revision: 1762

Modified:
   trunk/Makefile.am
Log:
Include project doxygen configuration with distribution tarballs.

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-05-12 08:35:17 UTC (rev 1761)
+++ trunk/Makefile.am	2009-05-12 08:56:22 UTC (rev 1762)
@@ -11,6 +11,8 @@
 
 SUBDIRS = src doc
 
+EXTRA_DIST = Doxyfile
+
 MAINTAINERCLEANFILES = \
 	configure \
 	Makefile.in \



From oharboe at mail.berlios.de  Tue May 12 12:02:48 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 12 May 2009 12:02:48 +0200
Subject: [Openocd-svn] r1763 - in trunk/src: helper jtag
Message-ID: <200905121002.n4CA2mw8010930@sheep.berlios.de>

Author: oharboe
Date: 2009-05-12 12:02:47 +0200 (Tue, 12 May 2009)
New Revision: 1763

Modified:
   trunk/src/helper/jim.c
   trunk/src/jtag/jtag.h
Log:
eCos fixes

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-12 08:56:22 UTC (rev 1762)
+++ trunk/src/helper/jim.c	2009-05-12 10:02:47 UTC (rev 1763)
@@ -48,6 +48,15 @@
 
 #ifdef __ECOS
 #include <pkgconf/jimtcl.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <stdarg.h>
+#include <ctype.h>
+#include <limits.h>
+#include <assert.h>
+#include <errno.h>
+#include <time.h>
 #endif
 #ifndef JIM_ANSIC
 #define JIM_DYNLIB      /* Dynamic library support for UNIX and WIN32 */

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-12 08:56:22 UTC (rev 1762)
+++ trunk/src/jtag/jtag.h	2009-05-12 10:02:47 UTC (rev 1763)
@@ -607,6 +607,11 @@
 /* implemented by minidriver */
 #endif
 
+
+#ifdef __ECOS
+typedef CYG_ADDRWORD intptr_t;
+#endif
+
 /* This type can store an integer safely by a normal cast on 64 and
  * 32 bit systems. */
 typedef intptr_t jtag_callback_data_t;



From ntfreak at mail.berlios.de  Tue May 12 12:47:48 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Tue, 12 May 2009 12:47:48 +0200
Subject: [Openocd-svn] r1764 - trunk/src/helper
Message-ID: <200905121047.n4CAlmTG028233@sheep.berlios.de>

Author: ntfreak
Date: 2009-05-12 12:47:48 +0200 (Tue, 12 May 2009)
New Revision: 1764

Modified:
   trunk/src/helper/replacements.h
Log:
- fix build issue when HAVE_ELF_H is not defined

Modified: trunk/src/helper/replacements.h
===================================================================
--- trunk/src/helper/replacements.h	2009-05-12 10:02:47 UTC (rev 1763)
+++ trunk/src/helper/replacements.h	2009-05-12 10:47:48 UTC (rev 1764)
@@ -210,22 +210,30 @@
 
 #ifndef HAVE_ELF_H
 
+typedef uint32_t	Elf32_Addr;
+typedef uint16_t	Elf32_Half;
+typedef uint32_t	Elf32_Off;
+typedef int32_t		Elf32_Sword;
+typedef uint32_t	Elf32_Word;
+typedef uint32_t	Elf32_Size;
+typedef Elf32_Off	Elf32_Hashelt;
+
 typedef struct
 {
 	unsigned char	e_ident[16];	/* Magic number and other info */
-	u16	e_type;			/* Object file type */
-	u16	e_machine;		/* Architecture */
-	u32	e_version;		/* Object file version */
-	u32 e_entry;		/* Entry point virtual address */
-	u32 e_phoff;		/* Program header table file offset */
-	u32	e_shoff;		/* Section header table file offset */
-	u32	e_flags;		/* Processor-specific flags */
-	u16	e_ehsize;		/* ELF header size in bytes */
-	u16	e_phentsize;	/* Program header table entry size */
-	u16	e_phnum;		/* Program header table entry count */
-	u16	e_shentsize;	/* Section header table entry size */
-	u16	e_shnum;		/* Section header table entry count */
-	u16	e_shstrndx;		/* Section header string table index */
+	Elf32_Half	e_type;			/* Object file type */
+	Elf32_Half	e_machine;		/* Architecture */
+	Elf32_Word	e_version;		/* Object file version */
+	Elf32_Addr	e_entry;		/* Entry point virtual address */
+	Elf32_Off	e_phoff;		/* Program header table file offset */
+	Elf32_Off	e_shoff;		/* Section header table file offset */
+	Elf32_Word	e_flags;		/* Processor-specific flags */
+	Elf32_Half	e_ehsize;		/* ELF header size in bytes */
+	Elf32_Half	e_phentsize;	/* Program header table entry size */
+	Elf32_Half	e_phnum;		/* Program header table entry count */
+	Elf32_Half	e_shentsize;	/* Section header table entry size */
+	Elf32_Half	e_shnum;		/* Section header table entry count */
+	Elf32_Half	e_shstrndx;		/* Section header string table index */
 } Elf32_Ehdr;
 
 #define	ELFMAG		"\177ELF"
@@ -241,14 +249,14 @@
 
 typedef struct
 {
-	u32 p_type;			/* Segment type */
-	u32 p_offset;		/* Segment file offset */
-	u32 p_vaddr;		/* Segment virtual address */
-	u32 p_paddr;		/* Segment physical address */
-	u32 p_filesz;		/* Segment size in file */
-	u32 p_memsz;		/* Segment size in memory */
-	u32 p_flags;		/* Segment flags */
-	u32 p_align;		/* Segment alignment */
+	Elf32_Word p_type;		/* Segment type */
+	Elf32_Off p_offset;		/* Segment file offset */
+	Elf32_Addr p_vaddr;		/* Segment virtual address */
+	Elf32_Addr p_paddr;		/* Segment physical address */
+	Elf32_Size p_filesz;	/* Segment size in file */
+	Elf32_Size p_memsz;		/* Segment size in memory */
+	Elf32_Word p_flags;		/* Segment flags */
+	Elf32_Size p_align;		/* Segment alignment */
 } Elf32_Phdr;
 
 #define PT_LOAD		1		/* Loadable program segment */



From zwelch at mail.berlios.de  Tue May 12 12:52:18 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 12 May 2009 12:52:18 +0200
Subject: [Openocd-svn] r1765 - in trunk/src: helper jtag/rlink
Message-ID: <200905121052.n4CAqI7w031206@sheep.berlios.de>

Author: zwelch
Date: 2009-05-12 12:52:01 +0200 (Tue, 12 May 2009)
New Revision: 1765

Modified:
   trunk/src/helper/types.h
   trunk/src/jtag/rlink/rlink.c
Log:
Add stdint.h to types.h to provide intptr_t.

Modified: trunk/src/helper/types.h
===================================================================
--- trunk/src/helper/types.h	2009-05-12 10:47:48 UTC (rev 1764)
+++ trunk/src/helper/types.h	2009-05-12 10:52:01 UTC (rev 1765)
@@ -26,6 +26,9 @@
 #ifdef HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
+#ifdef HAVE_STDINT_H
+#include <stdint.h>
+#endif
 
 #ifndef u8
 typedef unsigned char u8;

Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2009-05-12 10:47:48 UTC (rev 1764)
+++ trunk/src/jtag/rlink/rlink.c	2009-05-12 10:52:01 UTC (rev 1765)
@@ -36,7 +36,6 @@
 
 /* system includes */
 #include <usb.h>
-#include <stdint.h>
 
 
 /* This feature is made useless by running the DTC all the time.  When automatic, the LED is on whenever the DTC is running.  Otherwise, USB messages are sent to turn it on and off. */



From oharboe at mail.berlios.de  Tue May 12 14:16:31 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 12 May 2009 14:16:31 +0200
Subject: [Openocd-svn] r1766 - in trunk/src: helper jtag
Message-ID: <200905121216.n4CCGVUX003712@sheep.berlios.de>

Author: oharboe
Date: 2009-05-12 14:16:31 +0200 (Tue, 12 May 2009)
New Revision: 1766

Modified:
   trunk/src/helper/types.h
   trunk/src/jtag/jtag.h
Log:
move eCos type definition to types.h where it belongs. 

Modified: trunk/src/helper/types.h
===================================================================
--- trunk/src/helper/types.h	2009-05-12 10:52:01 UTC (rev 1765)
+++ trunk/src/helper/types.h	2009-05-12 12:16:31 UTC (rev 1766)
@@ -60,7 +60,7 @@
 #define true		1
 
 typedef int _Bool;
-#else 
+#else
 typedef bool _Bool;
 #endif	/* __cplusplus */
 #endif	/* HAVE__BOOL */
@@ -136,4 +136,9 @@
 	buf[1] = (u8) (val >> 0);
 }
 
+#ifdef __ECOS
+/* eCos plain lacks this definition... */
+typedef CYG_ADDRWORD intptr_t;
+#endif
+
 #endif /* TYPES_H */

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-12 10:52:01 UTC (rev 1765)
+++ trunk/src/jtag/jtag.h	2009-05-12 12:16:31 UTC (rev 1766)
@@ -608,10 +608,6 @@
 #endif
 
 
-#ifdef __ECOS
-typedef CYG_ADDRWORD intptr_t;
-#endif
-
 /* This type can store an integer safely by a normal cast on 64 and
  * 32 bit systems. */
 typedef intptr_t jtag_callback_data_t;



From oharboe at mail.berlios.de  Tue May 12 19:14:18 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 12 May 2009 19:14:18 +0200
Subject: [Openocd-svn] r1767 - trunk/src/target/interface
Message-ID: <200905121714.n4CHEI0C016786@sheep.berlios.de>

Author: oharboe
Date: 2009-05-12 19:14:10 +0200 (Tue, 12 May 2009)
New Revision: 1767

Modified:
   trunk/src/target/interface/sheevaplug.cfg
Log:
Nicolas Pitre <nico at cam.org> lower JTAG clock for SheevaPlug

Modified: trunk/src/target/interface/sheevaplug.cfg
===================================================================
--- trunk/src/target/interface/sheevaplug.cfg	2009-05-12 12:16:31 UTC (rev 1766)
+++ trunk/src/target/interface/sheevaplug.cfg	2009-05-12 17:14:10 UTC (rev 1767)
@@ -8,5 +8,5 @@
 ft2232_layout sheevaplug
 ft2232_vid_pid 0x9e88 0x9e8f
 ft2232_device_desc "SheevaPlug JTAGKey FT2232D B"
-jtag_khz 3000
+jtag_khz 2000
 



From oharboe at mail.berlios.de  Tue May 12 19:29:25 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 12 May 2009 19:29:25 +0200
Subject: [Openocd-svn] r1768 - in trunk/src: flash target/board
Message-ID: <200905121729.n4CHTPX8005168@sheep.berlios.de>

Author: oharboe
Date: 2009-05-12 19:29:16 +0200 (Tue, 12 May 2009)
New Revision: 1768

Added:
   trunk/src/flash/nand_ecc_kw.c
Modified:
   trunk/src/flash/Makefile.am
   trunk/src/flash/nand.c
   trunk/src/flash/nand.h
   trunk/src/target/board/sheevaplug.cfg
Log:
4-bit ECC support for Marvell Kirkwood SOC

Modified: trunk/src/flash/Makefile.am
===================================================================
--- trunk/src/flash/Makefile.am	2009-05-12 17:14:10 UTC (rev 1767)
+++ trunk/src/flash/Makefile.am	2009-05-12 17:29:16 UTC (rev 1768)
@@ -7,7 +7,7 @@
 noinst_LTLIBRARIES = libflash.la
 libflash_la_SOURCES = \
 	flash.c lpc2000.c cfi.c non_cfi.c at91sam7.c \
-	str7x.c str9x.c aduc702x.c nand.c nand_ecc.c \
+	str7x.c str9x.c aduc702x.c nand.c nand_ecc.c nand_ecc_kw.c \
 	lpc3180_nand_controller.c stellaris.c str9xpec.c stm32x.c tms470.c \
 	ecos.c orion_nand.c s3c24xx_nand.c s3c2410_nand.c s3c2412_nand.c \
 	s3c2440_nand.c s3c2443_nand.c lpc288x.c ocl.c mflash.c pic32mx.c avrf.c

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2009-05-12 17:14:10 UTC (rev 1767)
+++ trunk/src/flash/nand.c	2009-05-12 17:29:16 UTC (rev 1768)
@@ -1332,6 +1332,8 @@
 					oob_format |= NAND_OOB_RAW | NAND_OOB_ONLY;
 				else if (!strcmp(args[i], "oob_softecc"))
 					oob_format |= NAND_OOB_SW_ECC;
+				else if (!strcmp(args[i], "oob_softecc_kw"))
+					oob_format |= NAND_OOB_SW_ECC_KW;
 				else
 				{
 					command_print(cmd_ctx, "unknown option: %s", args[i]);
@@ -1355,7 +1357,7 @@
 			page = malloc(p->page_size);
 		}
 
-		if (oob_format & (NAND_OOB_RAW | NAND_OOB_SW_ECC))
+		if (oob_format & (NAND_OOB_RAW | NAND_OOB_SW_ECC | NAND_OOB_SW_ECC_KW))
 		{
 			if (p->page_size == 512) {
 				oob_size = 16;
@@ -1401,6 +1403,21 @@
 					oob[eccpos[j++]] = ecc[1];
 					oob[eccpos[j++]] = ecc[2];
 				}
+			} else if (oob_format & NAND_OOB_SW_ECC_KW)
+			{
+				/*
+				 * In this case eccpos is not used as
+				 * the ECC data is always stored contigously
+				 * at the end of the OOB area.  It consists
+				 * of 10 bytes per 512-byte data block.
+				 */
+				u32 i;
+				u8 *ecc = oob + oob_size - page_size/512 * 10;
+				memset(oob, 0xff, oob_size);
+				for (i = 0; i < page_size; i += 512) {
+					nand_calculate_ecc_kw(p, page+i, ecc);
+					ecc += 10;
+				}
 			}
 			else if (NULL != oob)
 			{

Modified: trunk/src/flash/nand.h
===================================================================
--- trunk/src/flash/nand.h	2009-05-12 17:14:10 UTC (rev 1767)
+++ trunk/src/flash/nand.h	2009-05-12 17:29:16 UTC (rev 1768)
@@ -200,6 +200,7 @@
 	NAND_OOB_ONLY = 0x2,	/* only OOB data */
 	NAND_OOB_SW_ECC = 0x10,	/* when writing, use SW ECC (as opposed to no ECC) */ 
 	NAND_OOB_HW_ECC = 0x20, /* when writing, use HW ECC (as opposed to no ECC) */
+	NAND_OOB_SW_ECC_KW = 0x40, /* when writing, use Marvell's Kirkwood bootrom format */
 	NAND_OOB_JFFS2 = 0x100,	/* when writing, use JFFS2 OOB layout */
 	NAND_OOB_YAFFS2 = 0x100,/* when writing, use YAFFS2 OOB layout */
 };
@@ -210,6 +211,7 @@
 extern int nand_write_page_raw(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
 extern int nand_read_status(struct nand_device_s *device, u8 *status);
 extern int nand_calculate_ecc(struct nand_device_s *device, const u8 *dat, u8 *ecc_code);
+extern int nand_calculate_ecc_kw(struct nand_device_s *device, const u8 *dat, u8 *ecc_code);
 
 extern int nand_register_commands(struct command_context_s *cmd_ctx);
 extern int nand_init(struct command_context_s *cmd_ctx);

Added: trunk/src/flash/nand_ecc_kw.c
===================================================================
--- trunk/src/flash/nand_ecc_kw.c	2009-05-12 17:14:10 UTC (rev 1767)
+++ trunk/src/flash/nand_ecc_kw.c	2009-05-12 17:29:16 UTC (rev 1768)
@@ -0,0 +1,174 @@
+/*
+ * Reed-Solomon ECC handling for the Marvell Kirkwood SOC
+ * Copyright (C) 2009 Marvell Semiconductor, Inc.
+ *
+ * Authors: Lennert Buytenhek <buytenh at wantstofly.org>
+ *          Nicolas Pitre <nico at cam.org>
+ *
+ * This file is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU General Public License as published by the
+ * Free Software Foundation; either version 2 or (at your option) any
+ * later version.
+ *
+ * This file is distributed in the hope that it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+ * for more details.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include <sys/types.h>
+#include "nand.h"
+
+
+/*****************************************************************************
+ * Arithmetic in GF(2^10) ("F") modulo x^10 + x^3 + 1.
+ *
+ * For multiplication, a discrete log/exponent table is used, with
+ * primitive element x (F is a primitive field, so x is primitive).
+ */
+#define MODPOLY		0x409		/* x^10 + x^3 + 1 in binary */
+
+/*
+ * Maps an integer a [0..1022] to a polynomial b = gf_exp[a] in
+ * GF(2^10) mod x^10 + x^3 + 1 such that b = x ^ a.  There's two
+ * identical copies of this array back-to-back so that we can save
+ * the mod 1023 operation when doing a GF multiplication.
+ */
+static uint16_t gf_exp[1023 + 1023];
+
+/*
+ * Maps a polynomial b in GF(2^10) mod x^10 + x^3 + 1 to an index
+ * a = gf_log[b] in [0..1022] such that b = x ^ a.
+ */
+static uint16_t gf_log[1024];
+
+static void gf_build_log_exp_table(void)
+{
+	int i;
+	int p_i;
+
+	/*
+	 * p_i = x ^ i
+	 *
+	 * Initialise to 1 for i = 0.
+	 */
+	p_i = 1;
+
+	for (i = 0; i < 1023; i++) {
+		gf_exp[i] = p_i;
+		gf_exp[i + 1023] = p_i;
+		gf_log[p_i] = i;
+
+		/*
+		 * p_i = p_i * x
+		 */
+		p_i <<= 1;
+		if (p_i & (1 << 10))
+			p_i ^= MODPOLY;
+	}
+}
+
+
+/*****************************************************************************
+ * Reed-Solomon code
+ *
+ * This implements a (1023,1015) Reed-Solomon ECC code over GF(2^10)
+ * mod x^10 + x^3 + 1, shortened to (520,512).  The ECC data consists
+ * of 8 10-bit symbols, or 10 8-bit bytes.
+ *
+ * Given 512 bytes of data, computes 10 bytes of ECC.
+ *
+ * This is done by converting the 512 bytes to 512 10-bit symbols
+ * (elements of F), interpreting those symbols as a polynomial in F[X]
+ * by taking symbol 0 as the coefficient of X^8 and symbol 511 as the
+ * coefficient of X^519, and calculating the residue of that polynomial
+ * divided by the generator polynomial, which gives us the 8 ECC symbols
+ * as the remainder.  Finally, we convert the 8 10-bit ECC symbols to 10
+ * 8-bit bytes.
+ *
+ * The generator polynomial is hardcoded, as that is faster, but it
+ * can be computed by taking the primitive element a = x (in F), and
+ * constructing a polynomial in F[X] with roots a, a^2, a^3, ..., a^8
+ * by multiplying the minimal polynomials for those roots (which are
+ * just 'x - a^i' for each i).
+ *
+ * Note: due to unfortunate circumstances, the bootrom in the Kirkwood SOC
+ * expects the ECC to be computed backward, i.e. from the last byte down
+ * to the first one.
+ */
+int nand_calculate_ecc_kw(struct nand_device_s *device, const u8 *data, u8 *ecc)
+{
+	unsigned int r7, r6, r5, r4, r3, r2, r1, r0;
+	int i;
+	static int tables_initialized = 0;
+
+	if (!tables_initialized) {
+		gf_build_log_exp_table();
+		tables_initialized = 1;
+	}
+
+	/*
+	 * Load bytes 504..511 of the data into r.
+	 */
+	r0 = data[504];
+	r1 = data[505];
+	r2 = data[506];
+	r3 = data[507];
+	r4 = data[508];
+	r5 = data[509];
+	r6 = data[510];
+	r7 = data[511];
+
+
+	/*
+	 * Shift bytes 503..0 (in that order) into r0, followed
+	 * by eight zero bytes, while reducing the polynomial by the
+	 * generator polynomial in every step.
+	 */
+	for (i = 503; i >= -8; i--) {
+		unsigned int d;
+
+		d = 0;
+		if (i >= 0)
+			d = data[i];
+
+		if (r7) {
+			u16 *t = gf_exp + gf_log[r7];
+
+			r7 = r6 ^ t[0x21c];
+			r6 = r5 ^ t[0x181];
+			r5 = r4 ^ t[0x18e];
+			r4 = r3 ^ t[0x25f];
+			r3 = r2 ^ t[0x197];
+			r2 = r1 ^ t[0x193];
+			r1 = r0 ^ t[0x237];
+			r0 = d  ^ t[0x024];
+		} else {
+			r7 = r6;
+			r6 = r5;
+			r5 = r4;
+			r4 = r3;
+			r3 = r2;
+			r2 = r1;
+			r1 = r0;
+			r0 = d;
+		}
+	}
+
+	ecc[0] = r0;
+	ecc[1] = (r0 >> 8) | (r1 << 2);
+	ecc[2] = (r1 >> 6) | (r2 << 4);
+	ecc[3] = (r2 >> 4) | (r3 << 6);
+	ecc[4] = (r3 >> 2);
+	ecc[5] = r4;
+	ecc[6] = (r4 >> 8) | (r5 << 2);
+	ecc[7] = (r5 >> 6) | (r6 << 4);
+	ecc[8] = (r6 >> 4) | (r7 << 6);
+	ecc[9] = (r7 >> 2);
+
+	return 0;
+}

Modified: trunk/src/target/board/sheevaplug.cfg
===================================================================
--- trunk/src/target/board/sheevaplug.cfg	2009-05-12 17:14:10 UTC (rev 1767)
+++ trunk/src/target/board/sheevaplug.cfg	2009-05-12 17:29:16 UTC (rev 1768)
@@ -99,7 +99,7 @@
 	sheevaplug_init
 	nand probe 0
 	nand erase 0 0 4
-	nand write 0 uboot.bin 0 oob_softecc
+	nand write 0 uboot.bin 0 oob_softecc_kw
 	resume
 
 }
@@ -108,7 +108,7 @@
 
 	# load u-Boot into RAM and execute it
 	sheevaplug_init
-	load_image /tmp/uboot.elf
+	load_image uboot.elf
 	verify_image uboot.elf
 	resume 0x00600000
 



From ntfreak at mail.berlios.de  Tue May 12 20:32:57 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Tue, 12 May 2009 20:32:57 +0200
Subject: [Openocd-svn] r1769 - trunk/src/flash
Message-ID: <200905121832.n4CIWvYx008009@sheep.berlios.de>

Author: ntfreak
Date: 2009-05-12 20:32:57 +0200 (Tue, 12 May 2009)
New Revision: 1769

Modified:
   trunk/src/flash/nand_ecc_kw.c
Log:
- add missing svn props from svn 1768 commit

Modified: trunk/src/flash/nand_ecc_kw.c
===================================================================
--- trunk/src/flash/nand_ecc_kw.c	2009-05-12 17:29:16 UTC (rev 1768)
+++ trunk/src/flash/nand_ecc_kw.c	2009-05-12 18:32:57 UTC (rev 1769)
@@ -1,174 +1,174 @@
-/*
- * Reed-Solomon ECC handling for the Marvell Kirkwood SOC
- * Copyright (C) 2009 Marvell Semiconductor, Inc.
- *
- * Authors: Lennert Buytenhek <buytenh at wantstofly.org>
- *          Nicolas Pitre <nico at cam.org>
- *
- * This file is free software; you can redistribute it and/or modify it
- * under the terms of the GNU General Public License as published by the
- * Free Software Foundation; either version 2 or (at your option) any
- * later version.
- *
- * This file is distributed in the hope that it will be useful, but WITHOUT
- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
- * for more details.
- */
-
-#ifdef HAVE_CONFIG_H
-#include "config.h"
-#endif
-
-#include <sys/types.h>
-#include "nand.h"
-
-
-/*****************************************************************************
- * Arithmetic in GF(2^10) ("F") modulo x^10 + x^3 + 1.
- *
- * For multiplication, a discrete log/exponent table is used, with
- * primitive element x (F is a primitive field, so x is primitive).
- */
-#define MODPOLY		0x409		/* x^10 + x^3 + 1 in binary */
-
-/*
- * Maps an integer a [0..1022] to a polynomial b = gf_exp[a] in
- * GF(2^10) mod x^10 + x^3 + 1 such that b = x ^ a.  There's two
- * identical copies of this array back-to-back so that we can save
- * the mod 1023 operation when doing a GF multiplication.
- */
-static uint16_t gf_exp[1023 + 1023];
-
-/*
- * Maps a polynomial b in GF(2^10) mod x^10 + x^3 + 1 to an index
- * a = gf_log[b] in [0..1022] such that b = x ^ a.
- */
-static uint16_t gf_log[1024];
-
-static void gf_build_log_exp_table(void)
-{
-	int i;
-	int p_i;
-
-	/*
-	 * p_i = x ^ i
-	 *
-	 * Initialise to 1 for i = 0.
-	 */
-	p_i = 1;
-
-	for (i = 0; i < 1023; i++) {
-		gf_exp[i] = p_i;
-		gf_exp[i + 1023] = p_i;
-		gf_log[p_i] = i;
-
-		/*
-		 * p_i = p_i * x
-		 */
-		p_i <<= 1;
-		if (p_i & (1 << 10))
-			p_i ^= MODPOLY;
-	}
-}
-
-
-/*****************************************************************************
- * Reed-Solomon code
- *
- * This implements a (1023,1015) Reed-Solomon ECC code over GF(2^10)
- * mod x^10 + x^3 + 1, shortened to (520,512).  The ECC data consists
- * of 8 10-bit symbols, or 10 8-bit bytes.
- *
- * Given 512 bytes of data, computes 10 bytes of ECC.
- *
- * This is done by converting the 512 bytes to 512 10-bit symbols
- * (elements of F), interpreting those symbols as a polynomial in F[X]
- * by taking symbol 0 as the coefficient of X^8 and symbol 511 as the
- * coefficient of X^519, and calculating the residue of that polynomial
- * divided by the generator polynomial, which gives us the 8 ECC symbols
- * as the remainder.  Finally, we convert the 8 10-bit ECC symbols to 10
- * 8-bit bytes.
- *
- * The generator polynomial is hardcoded, as that is faster, but it
- * can be computed by taking the primitive element a = x (in F), and
- * constructing a polynomial in F[X] with roots a, a^2, a^3, ..., a^8
- * by multiplying the minimal polynomials for those roots (which are
- * just 'x - a^i' for each i).
- *
- * Note: due to unfortunate circumstances, the bootrom in the Kirkwood SOC
- * expects the ECC to be computed backward, i.e. from the last byte down
- * to the first one.
- */
-int nand_calculate_ecc_kw(struct nand_device_s *device, const u8 *data, u8 *ecc)
-{
-	unsigned int r7, r6, r5, r4, r3, r2, r1, r0;
-	int i;
-	static int tables_initialized = 0;
-
-	if (!tables_initialized) {
-		gf_build_log_exp_table();
-		tables_initialized = 1;
-	}
-
-	/*
-	 * Load bytes 504..511 of the data into r.
-	 */
-	r0 = data[504];
-	r1 = data[505];
-	r2 = data[506];
-	r3 = data[507];
-	r4 = data[508];
-	r5 = data[509];
-	r6 = data[510];
-	r7 = data[511];
-
-
-	/*
-	 * Shift bytes 503..0 (in that order) into r0, followed
-	 * by eight zero bytes, while reducing the polynomial by the
-	 * generator polynomial in every step.
-	 */
-	for (i = 503; i >= -8; i--) {
-		unsigned int d;
-
-		d = 0;
-		if (i >= 0)
-			d = data[i];
-
-		if (r7) {
-			u16 *t = gf_exp + gf_log[r7];
-
-			r7 = r6 ^ t[0x21c];
-			r6 = r5 ^ t[0x181];
-			r5 = r4 ^ t[0x18e];
-			r4 = r3 ^ t[0x25f];
-			r3 = r2 ^ t[0x197];
-			r2 = r1 ^ t[0x193];
-			r1 = r0 ^ t[0x237];
-			r0 = d  ^ t[0x024];
-		} else {
-			r7 = r6;
-			r6 = r5;
-			r5 = r4;
-			r4 = r3;
-			r3 = r2;
-			r2 = r1;
-			r1 = r0;
-			r0 = d;
-		}
-	}
-
-	ecc[0] = r0;
-	ecc[1] = (r0 >> 8) | (r1 << 2);
-	ecc[2] = (r1 >> 6) | (r2 << 4);
-	ecc[3] = (r2 >> 4) | (r3 << 6);
-	ecc[4] = (r3 >> 2);
-	ecc[5] = r4;
-	ecc[6] = (r4 >> 8) | (r5 << 2);
-	ecc[7] = (r5 >> 6) | (r6 << 4);
-	ecc[8] = (r6 >> 4) | (r7 << 6);
-	ecc[9] = (r7 >> 2);
-
-	return 0;
-}
+/*
+ * Reed-Solomon ECC handling for the Marvell Kirkwood SOC
+ * Copyright (C) 2009 Marvell Semiconductor, Inc.
+ *
+ * Authors: Lennert Buytenhek <buytenh at wantstofly.org>
+ *          Nicolas Pitre <nico at cam.org>
+ *
+ * This file is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU General Public License as published by the
+ * Free Software Foundation; either version 2 or (at your option) any
+ * later version.
+ *
+ * This file is distributed in the hope that it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+ * for more details.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include <sys/types.h>
+#include "nand.h"
+
+
+/*****************************************************************************
+ * Arithmetic in GF(2^10) ("F") modulo x^10 + x^3 + 1.
+ *
+ * For multiplication, a discrete log/exponent table is used, with
+ * primitive element x (F is a primitive field, so x is primitive).
+ */
+#define MODPOLY		0x409		/* x^10 + x^3 + 1 in binary */
+
+/*
+ * Maps an integer a [0..1022] to a polynomial b = gf_exp[a] in
+ * GF(2^10) mod x^10 + x^3 + 1 such that b = x ^ a.  There's two
+ * identical copies of this array back-to-back so that we can save
+ * the mod 1023 operation when doing a GF multiplication.
+ */
+static uint16_t gf_exp[1023 + 1023];
+
+/*
+ * Maps a polynomial b in GF(2^10) mod x^10 + x^3 + 1 to an index
+ * a = gf_log[b] in [0..1022] such that b = x ^ a.
+ */
+static uint16_t gf_log[1024];
+
+static void gf_build_log_exp_table(void)
+{
+	int i;
+	int p_i;
+
+	/*
+	 * p_i = x ^ i
+	 *
+	 * Initialise to 1 for i = 0.
+	 */
+	p_i = 1;
+
+	for (i = 0; i < 1023; i++) {
+		gf_exp[i] = p_i;
+		gf_exp[i + 1023] = p_i;
+		gf_log[p_i] = i;
+
+		/*
+		 * p_i = p_i * x
+		 */
+		p_i <<= 1;
+		if (p_i & (1 << 10))
+			p_i ^= MODPOLY;
+	}
+}
+
+
+/*****************************************************************************
+ * Reed-Solomon code
+ *
+ * This implements a (1023,1015) Reed-Solomon ECC code over GF(2^10)
+ * mod x^10 + x^3 + 1, shortened to (520,512).  The ECC data consists
+ * of 8 10-bit symbols, or 10 8-bit bytes.
+ *
+ * Given 512 bytes of data, computes 10 bytes of ECC.
+ *
+ * This is done by converting the 512 bytes to 512 10-bit symbols
+ * (elements of F), interpreting those symbols as a polynomial in F[X]
+ * by taking symbol 0 as the coefficient of X^8 and symbol 511 as the
+ * coefficient of X^519, and calculating the residue of that polynomial
+ * divided by the generator polynomial, which gives us the 8 ECC symbols
+ * as the remainder.  Finally, we convert the 8 10-bit ECC symbols to 10
+ * 8-bit bytes.
+ *
+ * The generator polynomial is hardcoded, as that is faster, but it
+ * can be computed by taking the primitive element a = x (in F), and
+ * constructing a polynomial in F[X] with roots a, a^2, a^3, ..., a^8
+ * by multiplying the minimal polynomials for those roots (which are
+ * just 'x - a^i' for each i).
+ *
+ * Note: due to unfortunate circumstances, the bootrom in the Kirkwood SOC
+ * expects the ECC to be computed backward, i.e. from the last byte down
+ * to the first one.
+ */
+int nand_calculate_ecc_kw(struct nand_device_s *device, const u8 *data, u8 *ecc)
+{
+	unsigned int r7, r6, r5, r4, r3, r2, r1, r0;
+	int i;
+	static int tables_initialized = 0;
+
+	if (!tables_initialized) {
+		gf_build_log_exp_table();
+		tables_initialized = 1;
+	}
+
+	/*
+	 * Load bytes 504..511 of the data into r.
+	 */
+	r0 = data[504];
+	r1 = data[505];
+	r2 = data[506];
+	r3 = data[507];
+	r4 = data[508];
+	r5 = data[509];
+	r6 = data[510];
+	r7 = data[511];
+
+
+	/*
+	 * Shift bytes 503..0 (in that order) into r0, followed
+	 * by eight zero bytes, while reducing the polynomial by the
+	 * generator polynomial in every step.
+	 */
+	for (i = 503; i >= -8; i--) {
+		unsigned int d;
+
+		d = 0;
+		if (i >= 0)
+			d = data[i];
+
+		if (r7) {
+			u16 *t = gf_exp + gf_log[r7];
+
+			r7 = r6 ^ t[0x21c];
+			r6 = r5 ^ t[0x181];
+			r5 = r4 ^ t[0x18e];
+			r4 = r3 ^ t[0x25f];
+			r3 = r2 ^ t[0x197];
+			r2 = r1 ^ t[0x193];
+			r1 = r0 ^ t[0x237];
+			r0 = d  ^ t[0x024];
+		} else {
+			r7 = r6;
+			r6 = r5;
+			r5 = r4;
+			r4 = r3;
+			r3 = r2;
+			r2 = r1;
+			r1 = r0;
+			r0 = d;
+		}
+	}
+
+	ecc[0] = r0;
+	ecc[1] = (r0 >> 8) | (r1 << 2);
+	ecc[2] = (r1 >> 6) | (r2 << 4);
+	ecc[3] = (r2 >> 4) | (r3 << 6);
+	ecc[4] = (r3 >> 2);
+	ecc[5] = r4;
+	ecc[6] = (r4 >> 8) | (r5 << 2);
+	ecc[7] = (r5 >> 6) | (r6 << 4);
+	ecc[8] = (r6 >> 4) | (r7 << 6);
+	ecc[9] = (r7 >> 2);
+
+	return 0;
+}


Property changes on: trunk/src/flash/nand_ecc_kw.c
___________________________________________________________________
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Tue May 12 21:31:51 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 12 May 2009 21:31:51 +0200
Subject: [Openocd-svn] r1770 - trunk/src/jtag
Message-ID: <200905121931.n4CJVpxX016145@sheep.berlios.de>

Author: oharboe
Date: 2009-05-12 21:31:50 +0200 (Tue, 12 May 2009)
New Revision: 1770

Modified:
   trunk/src/jtag/jtag.c
Log:
irscan now also works correctly in addition to not crashing :-)

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-12 18:32:57 UTC (rev 1769)
+++ trunk/src/jtag/jtag.c	2009-05-12 19:31:50 UTC (rev 1770)
@@ -2889,7 +2889,7 @@
 		}
 	}
 
-	int num_fields= num_fields;
+	int num_fields = argc / 2;
 
 	fields = malloc(sizeof(scan_field_t) * num_fields);
 



From zwelch at mail.berlios.de  Wed May 13 10:58:19 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 13 May 2009 10:58:19 +0200
Subject: [Openocd-svn] r1771 - in trunk: . doc doc/manual
Message-ID: <200905130858.n4D8wJkh016825@sheep.berlios.de>

Author: zwelch
Date: 2009-05-13 10:58:08 +0200 (Wed, 13 May 2009)
New Revision: 1771

Added:
   trunk/doc/manual/
   trunk/doc/manual/app.txt
   trunk/doc/manual/flash.txt
   trunk/doc/manual/helper.txt
   trunk/doc/manual/jtag.txt
   trunk/doc/manual/main.txt
   trunk/doc/manual/server.txt
   trunk/doc/manual/target.txt
Modified:
   trunk/Doxyfile
   trunk/doc/Makefile.am
Log:
Commit skeleton files for high-level developer manual using doxygen.

Modified: trunk/Doxyfile
===================================================================
--- trunk/Doxyfile	2009-05-12 19:31:50 UTC (rev 1770)
+++ trunk/Doxyfile	2009-05-13 08:58:08 UTC (rev 1771)
@@ -564,7 +564,9 @@
 # directories like "/usr/src/myproject". Separate the files or directories
 # with spaces.
 
-INPUT                  = config.h src
+INPUT                  = doc/manual \
+                         src \
+                         config.h
 
 # This tag can be used to specify the character encoding of the source files
 # that doxygen parses. Internally doxygen uses the UTF-8 encoding, which is
@@ -582,7 +584,8 @@
 # *.hpp *.h++ *.idl *.odl *.cs *.php *.php3 *.inc *.m *.mm *.py *.f90
 
 FILE_PATTERNS          = *.h \
-                         *.c
+                         *.c \
+			 *.txt
 
 # The RECURSIVE tag can be used to turn specify whether or not subdirectories
 # should be searched for input files as well. Possible values are YES and NO.

Modified: trunk/doc/Makefile.am
===================================================================
--- trunk/doc/Makefile.am	2009-05-12 19:31:50 UTC (rev 1770)
+++ trunk/doc/Makefile.am	2009-05-13 08:58:08 UTC (rev 1771)
@@ -3,4 +3,8 @@
 man_MANS = openocd.1
 EXTRA_DIST = openocd.1
 
+dist-hook:
+	mkdir $(distdir)/manual
+	cp -p $(srcdir)/manual/*.txt $(distdir)/manual
+
 MAINTAINERCLEANFILES = Makefile.in mdate-sh texinfo.tex

Added: trunk/doc/manual/app.txt
===================================================================
--- trunk/doc/manual/app.txt	2009-05-12 19:31:50 UTC (rev 1770)
+++ trunk/doc/manual/app.txt	2009-05-13 08:58:08 UTC (rev 1771)
@@ -0,0 +1,9 @@
+/** @page appdocs OpenOCD Application APIs
+
+The top-level APIs in the OpenOCD library allow applications to integrate
+all of the low-level functionality using a set of simple function calls.
+
+These function calls do not exist in a re-usable form, but
+contributions to create and document them will be welcome.
+
+ */


Property changes on: trunk/doc/manual/app.txt
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/doc/manual/flash.txt
===================================================================
--- trunk/doc/manual/flash.txt	2009-05-12 19:31:50 UTC (rev 1770)
+++ trunk/doc/manual/flash.txt	2009-05-13 08:58:08 UTC (rev 1771)
@@ -0,0 +1,35 @@
+/** @page flashdocs OpenOCD Flash APIs
+
+OpenOCD provides its Flash APIs for developers to support different
+types of flash devices, some of which are built-in to target devices
+while others may be connected via standard memory interface (e.g. CFI,
+FMI, etc.).
+
+The Flash module provides the following APIs:
+
+  - @subpage flashcfi 
+  - @subpage flashnand
+  - @subpage flashtarget
+
+This section needs to be expanded.
+
+*/
+
+
+/** @page flashcfi OpenOCD CFI Flash API
+
+This section needs to be expanded to describe OpenOCD's CFI Flash API.
+
+*/
+
+/** @page flashnand OpenOCD NAND Flash API
+
+This section needs to be expanded to describe OpenOCD's NAND Flash API.
+
+*/
+
+/** @page flashtarget OpenOCD Target Flash API
+
+This section needs to be expanded to describe OpenOCD's Target Flash API.
+
+*/


Property changes on: trunk/doc/manual/flash.txt
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/doc/manual/helper.txt
===================================================================
--- trunk/doc/manual/helper.txt	2009-05-12 19:31:50 UTC (rev 1770)
+++ trunk/doc/manual/helper.txt	2009-05-13 08:58:08 UTC (rev 1771)
@@ -0,0 +1,48 @@
+/** @page helperdocs OpenOCD Helper APIs
+
+OpenOCD uses several low-level APIs as the foundation for high-level APIs:
+
+  - @subpage helperporting
+  - @subpage helperjim
+  - @subpage helpercommand
+  - @subpage helperlogging
+  - @subpage helperbuffers
+
+This section needs to be expanded.
+
+ */
+
+/** @page helperporting OpenOCD Types/Portability APIs
+
+This section needs to be expanded to describe OpenOCD's type and
+portability API.
+
+ */
+
+/** @page helperjim OpenOCD Jim API
+
+The Jim API provides access to a small-footprint TCL implementation.
+
+Visit http://jim.berlios.de/ for more information on Jim.
+
+This section needs to be expanded to describe OpenOCD's Jim API.
+
+ */
+
+/** @page helpercommand OpenOCD Command API
+
+This section needs to be expanded to describe OpenOCD's Command API.
+
+ */
+
+/** @page helperlogging OpenOCD Logging API
+
+This section needs to be expanded to describe OpenOCD's Logging API.
+
+ */
+
+/** @page helperbuffers OpenOCD Byte Buffer API
+
+This section needs to be expanded to describe OpenOCD's Byte Buffer API.
+
+ */


Property changes on: trunk/doc/manual/helper.txt
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/doc/manual/jtag.txt
===================================================================
--- trunk/doc/manual/jtag.txt	2009-05-12 19:31:50 UTC (rev 1770)
+++ trunk/doc/manual/jtag.txt	2009-05-13 08:58:08 UTC (rev 1771)
@@ -0,0 +1,39 @@
+/** @page jtagdocs OpenOCD JTAG APIs
+
+This document contains @subpage jtagprimer, which introduces the
+IEEE JTAG interface.
+
+The OpenOCD JTAG library API covers several functional areas:
+
+  - @subpage jtagcable
+  - @subpage jtagtap
+  - @subpage jtagmdriver
+  - @subpage jtagdriver
+
+This section needs to be expanded.
+
+ */
+
+/** @page jtagcable OpenOCD JTAG Cable API
+
+This section needs to be expanded.
+
+ */
+
+/** @page jtagtap OpenOCD JTAG TAP API
+
+This section needs to be expanded.
+
+ */
+
+/** @page jtagmdriver OpenOCD JTAG Interface API
+
+This section needs to be expanded.
+
+ */
+
+/** @page jtagdriver OpenOCD JTAG Driver API
+
+This section needs to be expanded.
+
+ */


Property changes on: trunk/doc/manual/jtag.txt
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-05-12 19:31:50 UTC (rev 1770)
+++ trunk/doc/manual/main.txt	2009-05-13 08:58:08 UTC (rev 1771)
@@ -0,0 +1,45 @@
+/** @mainpage OpenOCD Reference Manual
+
+The @ref primer page provides introductory materials for new developers.
+
+The @ref oocd page explains how the code has been organized into layers
+of APIs and gives an overview of how they fit together.
+ 
+ */
+
+/** @page oocd OpenOCD Architecture
+
+The OpenOCD library consists of several APIs that build together to
+provide the support functionality.  The following list shows how these
+modules are stacked in the current implementation (from bottom to top):
+
+- @subpage helperdocs
+  - @ref helperporting
+  - @ref helperjim
+  - @ref helpercommand
+  - @ref helperlogging
+- @subpage jtagdocs
+  - @ref jtagcable
+  - @ref jtagtap
+  - @ref jtagmdriver
+  - @ref jtagdriver
+- @subpage targetdocs
+  - @ref targetarm
+  - @ref targetnotarm
+  - @ref targetregister
+  - @ref targetimage
+  - @ref targettrace
+- @subpage flashdocs
+  - @ref flashcfi
+  - @ref flashnand
+  - @ref flashtarget
+- @subpage serverdocs
+  - @ref servergdb
+  - @ref servertelnet
+  - @ref serverhttp
+- @subpage appdocs
+
+Obviously, there are some nuances to the stack that are not shown by
+this linear list of layers.
+
+ */


Property changes on: trunk/doc/manual/main.txt
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/doc/manual/server.txt
===================================================================
--- trunk/doc/manual/server.txt	2009-05-12 19:31:50 UTC (rev 1770)
+++ trunk/doc/manual/server.txt	2009-05-13 08:58:08 UTC (rev 1771)
@@ -0,0 +1,30 @@
+/** @page serverdocs OpenOCD Server APIs
+
+OpenOCD provides support for implementing different types of servers.
+Presently, the following servers have APIs that can be used.
+
+  - @subpage servergdb
+  - @subpage servertelnet
+  - @subpage serverhttp
+
+This section needs to be expanded.
+
+ */
+
+/** @page servergdb OpenOCD GDB Server API
+
+This section needs to be expanded.
+
+ */
+
+/** @page servertelnet OpenOCD Telnet Server API
+
+This section needs to be expanded.
+
+ */
+
+/** @page serverhttp OpenOCD HTTP Server API
+
+This section needs to be expanded.
+
+ */


Property changes on: trunk/doc/manual/server.txt
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/doc/manual/target.txt
===================================================================
--- trunk/doc/manual/target.txt	2009-05-12 19:31:50 UTC (rev 1770)
+++ trunk/doc/manual/target.txt	2009-05-13 08:58:08 UTC (rev 1771)
@@ -0,0 +1,51 @@
+/** @page targetdocs OpenOCD Target APIs
+
+OpenOCD provides its Target APIs to allow developers to provide trace and
+debugging support for specific device targets.  These primarily consist of
+ARM cores, but other types have been supported.  New targets should be
+developed by following or using these APIs.
+
+The Target Support module contains APIs that cover several functional areas:
+
+  - @subpage targetarm
+  - @subpage targetnotarm
+  - @subpage targetregister
+  - @subpage targetimage
+  - @subpage targettrace
+
+This section needs to be expanded.
+
+*/
+
+/** @page targetarm OpenOCD ARM Targets
+
+This section needs to describe OpenOCD's ARM target support.
+
+ */
+
+/** @page targetnotarm OpenOCD Non-ARM Targets
+
+This section needs to describe OpenOCD's non-ARM target support.
+
+ */
+
+/** @page targetregister OpenOCD Target Register API
+
+This section needs to describe OpenOCD's Target Register API, as
+provided by 'src/target/register.h'.
+
+ */
+
+/** @page targetimage OpenOCD Target Image API
+
+This section needs to describe OpenOCD's Target Image API, as provided
+by 'src/target/image.h'.
+
+ */
+
+/** @page targettrace OpenOCD Target Trace API
+
+This section needs to describe OpenOCD's Target Trace API, as provided
+by 'src/target/trace.h'.
+
+ */


Property changes on: trunk/doc/manual/target.txt
___________________________________________________________________
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Wed May 13 11:53:24 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 13 May 2009 11:53:24 +0200
Subject: [Openocd-svn] r1772 - trunk/src/jtag
Message-ID: <200905130953.n4D9rO2p022592@sheep.berlios.de>

Author: oharboe
Date: 2009-05-13 11:53:23 +0200 (Wed, 13 May 2009)
New Revision: 1772

Modified:
   trunk/src/jtag/jtag.h
Log:
shuffled comments about for jtag_add_dr_out() fn.

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-13 08:58:08 UTC (rev 1771)
+++ trunk/src/jtag/jtag.h	2009-05-13 09:53:23 UTC (rev 1772)
@@ -856,8 +856,15 @@
 #define MINIDRIVER(a) notused ## a
 #else
 #define MINIDRIVER(a) a
+extern void interface_jtag_add_dr_out(jtag_tap_t* tap, int num_fields, const int* num_bits, const u32* value,
+		tap_state_t end_state);
 
-/* jtag_add_dr_out() is a faster version of jtag_add_dr_scan()
+#endif
+
+/* jtag_add_dr_out() is a version of jtag_add_dr_scan() which
+ * only scans data out. It operates on 32 bit integers instead
+ * of 8 bit, which makes it a better impedance match with
+ * the calling code which often operate on 32 bit integers.
  *
  * Current or end_state can not be TAP_RESET. end_state can be TAP_INVALID
  *
@@ -872,13 +879,13 @@
  * return an error. There is no way to determine if there was a failure
  * during this function call.
  *
- * Note that this jtag_add_dr_out can be defined as an inline function.
+ * This is an inline fn to speed up embedded hosts. Also note that
+ * interface_jtag_add_dr_out() can be a *small* inline function for
+ * embedded hosts.
+ *
+ * There is no jtag_add_dr_outin() version of this fn that also allows
+ * clocking data back in. Patches gladly accepted!
  */
-extern void interface_jtag_add_dr_out(jtag_tap_t* tap, int num_fields, const int* num_bits, const u32* value,
-		tap_state_t end_state);
-
-#endif
-
 static __inline__ void jtag_add_dr_out(jtag_tap_t* tap, int num_fields, const int* num_bits, const u32* value,
 		tap_state_t end_state)
 {



From zwelch at mail.berlios.de  Wed May 13 12:14:43 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 13 May 2009 12:14:43 +0200
Subject: [Openocd-svn] r1773 - trunk/src/server
Message-ID: <200905131014.n4DAEh2I024174@sheep.berlios.de>

Author: zwelch
Date: 2009-05-13 12:14:40 +0200 (Wed, 13 May 2009)
New Revision: 1773

Modified:
   trunk/src/server/Makefile.am
Log:
Include files required to rebuild the HTTP web pages in distribution.

Modified: trunk/src/server/Makefile.am
===================================================================
--- trunk/src/server/Makefile.am	2009-05-13 09:53:23 UTC (rev 1772)
+++ trunk/src/server/Makefile.am	2009-05-13 10:14:40 UTC (rev 1773)
@@ -28,4 +28,13 @@
 nobase_dist_pkglib_DATA = $(wildcard $(srcdir)/httpd/*.tcl $(srcdir)/httpd/*.css $(srcdir)/httpd/menu_cuts/*.png)
 endif
 
+EXTRA_DIST = \
+	httpd/readme.txt \
+	httpd/menu.xml \
+	httpd/menu.xsl \
+	httpd/build.sh \
+	httpd/html2tcl.sh \
+	httpd/Stylizer.java \
+	httpd/Stylizer.class
+
 MAINTAINERCLEANFILES = Makefile.in



From oharboe at mail.berlios.de  Wed May 13 12:21:50 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 13 May 2009 12:21:50 +0200
Subject: [Openocd-svn] r1774 - trunk/src/jtag
Message-ID: <200905131021.n4DALo8m024667@sheep.berlios.de>

Author: oharboe
Date: 2009-05-13 12:21:50 +0200 (Wed, 13 May 2009)
New Revision: 1774

Modified:
   trunk/src/jtag/jtag.c
Log:
added verify_jtag command

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-13 10:14:40 UTC (rev 1773)
+++ trunk/src/jtag/jtag.c	2009-05-13 10:21:50 UTC (rev 1774)
@@ -97,6 +97,7 @@
 tap_state_t cmd_queue_cur_state = TAP_RESET;
 
 int jtag_verify_capture_ir = 1;
+int jtag_verify = 1;
 
 /* how long the OpenOCD should wait before attempting JTAG communication after reset lines deasserted (in ms) */
 static int jtag_nsrst_delay = 0; /* default to no nSRST delay */
@@ -259,6 +260,7 @@
 static int Jim_Command_flush_count(Jim_Interp *interp, int argc, Jim_Obj *const *args);
 
 static int handle_verify_ircapture_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_verify_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 jtag_tap_t *jtag_AllTaps(void)
 {
@@ -550,23 +552,25 @@
 
 void jtag_add_ir_scan(int num_fields, scan_field_t *fields, tap_state_t state)
 {
-	/* 8 x 32 bit id's is enough for all invoations */
-	int j;
-	for (j = 0; j < num_fields; j++)
+	if (jtag_verify&&jtag_verify_capture_ir)
 	{
-		fields[j].check_value=NULL;
-		fields[j].check_mask=NULL;
-		/* if we are to run a verification of the ir scan, we need to get the input back.
-		 * We may have to allocate space if the caller didn't ask for the input back.
-		 */
-		if (jtag_verify_capture_ir)
+		/* 8 x 32 bit id's is enough for all invoations */
+		int j;
+		for (j = 0; j < num_fields; j++)
 		{
+			fields[j].check_value=NULL;
+			fields[j].check_mask=NULL;
+			/* if we are to run a verification of the ir scan, we need to get the input back.
+			 * We may have to allocate space if the caller didn't ask for the input back.
+			 */
 			fields[j].check_value=fields[j].tap->expected;
 			fields[j].check_mask=fields[j].tap->expected_mask;
 		}
+		jtag_add_scan_check(jtag_add_ir_scan_noverify, num_fields, fields, state);
+	} else
+	{
+		jtag_add_ir_scan_noverify(num_fields, fields, state);
 	}
-
-	jtag_add_scan_check(jtag_add_ir_scan_noverify, num_fields, fields, state);
 }
 
 int MINIDRIVER(interface_jtag_add_ir_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
@@ -752,12 +756,15 @@
 
 void jtag_add_dr_scan_check(int num_fields, scan_field_t *fields, tap_state_t state)
 {
-	jtag_add_scan_check(jtag_add_dr_scan, num_fields, fields, state);
+	if (jtag_verify)
+	{
+		jtag_add_scan_check(jtag_add_dr_scan, num_fields, fields, state);
+	} else
+	{
+		jtag_add_dr_scan(num_fields, fields, state);
+	}
 }
 
-
-
-
 int MINIDRIVER(interface_jtag_add_dr_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
 {
 	int j;
@@ -2292,6 +2299,8 @@
 
 	register_command(cmd_ctx, NULL, "verify_ircapture", handle_verify_ircapture_command,
 		COMMAND_ANY, "verify value captured during Capture-IR <enable|disable>");
+	register_command(cmd_ctx, NULL, "verify_jtag", handle_verify_jtag_command,
+		COMMAND_ANY, "verify value capture <enable|disable>");
 	return ERROR_OK;
 }
 
@@ -3091,6 +3100,31 @@
 	return ERROR_OK;
 }
 
+static int handle_verify_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc == 1)
+	{
+		if (strcmp(args[0], "enable") == 0)
+		{
+			jtag_verify = 1;
+		}
+		else if (strcmp(args[0], "disable") == 0)
+		{
+			jtag_verify = 0;
+		} else
+		{
+			return ERROR_COMMAND_SYNTAX_ERROR;
+		}
+	} else if (argc != 0)
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+
+	command_print(cmd_ctx, "verify jtag capture is %s", (jtag_verify) ? "enabled": "disabled");
+
+	return ERROR_OK;
+}
+
 int jtag_power_dropout(int *dropout)
 {
 	return jtag->power_dropout(dropout);



From zwelch at mail.berlios.de  Wed May 13 12:50:45 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 13 May 2009 12:50:45 +0200
Subject: [Openocd-svn] r1775 - trunk/src/helper
Message-ID: <200905131050.n4DAojY9008412@sheep.berlios.de>

Author: zwelch
Date: 2009-05-13 12:50:32 +0200 (Wed, 13 May 2009)
New Revision: 1775

Modified:
   trunk/src/helper/command.h
Log:
Include types.h in command.h to make stdint.h available through it.

Modified: trunk/src/helper/command.h
===================================================================
--- trunk/src/helper/command.h	2009-05-13 10:21:50 UTC (rev 1774)
+++ trunk/src/helper/command.h	2009-05-13 10:50:32 UTC (rev 1775)
@@ -23,6 +23,8 @@
 #ifndef COMMAND_H
 #define COMMAND_H
 
+#include "types.h"
+
 /* Integrate the JIM TCL interpretor into the command processing. */
 #if BUILD_ECOSBOARD
 #include <stdio.h>



From zwelch at mail.berlios.de  Wed May 13 13:10:43 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 13 May 2009 13:10:43 +0200
Subject: [Openocd-svn] r1776 - in trunk/doc/manual: . primer
Message-ID: <200905131110.n4DBAh8n030611@sheep.berlios.de>

Author: zwelch
Date: 2009-05-13 13:10:35 +0200 (Wed, 13 May 2009)
New Revision: 1776

Added:
   trunk/doc/manual/primer/
   trunk/doc/manual/primer/jtag.txt
Modified:
   trunk/doc/manual/main.txt
Log:
Add JTAG Primer to doxygen manual, contributed by Strontium.

Modified: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-05-13 10:50:32 UTC (rev 1775)
+++ trunk/doc/manual/main.txt	2009-05-13 11:10:35 UTC (rev 1776)
@@ -7,6 +7,18 @@
  
  */
 
+/** @page primer OpenOCD Techincal Primers
+
+This pages lists Techincal Primers available for OpenOCD Developers.
+They seek to provide information to pull novices up the learning curves
+associated with the fundamental technologies used by OpenOCD.
+
+- @subpage primerjtag
+
+Contributions or suggestions for new Technical Primers are welcome.
+
+ */
+
 /** @page oocd OpenOCD Architecture
 
 The OpenOCD library consists of several APIs that build together to

Added: trunk/doc/manual/primer/jtag.txt
===================================================================
--- trunk/doc/manual/primer/jtag.txt	2009-05-13 10:50:32 UTC (rev 1775)
+++ trunk/doc/manual/primer/jtag.txt	2009-05-13 11:10:35 UTC (rev 1776)
@@ -0,0 +1,109 @@
+/** @page primerjtag OpenOCD JTAG Primer
+
+JTAG is unnecessarily confusing, because JTAG is often confused with 
+boundary scan, which is just one of its possible functions.
+
+JTAG is simply a communication interface designed to allow communication 
+to functions contained on devices, for the designed purposes of 
+initialisation, programming, testing, debugging, and anything else you 
+want to use it for (as a chip designer).
+
+Think of JTAG as I2C for testing.  It doesn't define what it can do, 
+just a logical interface that allows a uniform channel for communication.
+
+See:
+
+	http://en.wikipedia.org/wiki/Joint_Test_Action_Group
+
+and
+
+	http://www.inaccessnetworks.com/projects/ianjtag/jtag-intro/jtag-state-machine-large.png
+
+The first page (among other things) shows a logical representation 
+describing how multiple devices are wired up using JTAG.  JTAG does not 
+specify, data rates or interface levels (3.3V/1.8V, etc) each device can 
+support different data rates/interface logic levels.  How to wire them 
+in a compatible way is an exercise for an engineer.
+
+Basically TMS controls which shift register is placed on the device, 
+between TDI and TDO.  The second diagram shows the state transitions on 
+TMS which will select different shift registers.
+
+The first thing you need to do is reset the state machine, because when 
+you connect to a chip you dont know what state the jtag is in,you need 
+to clock TMS as 1, at least 7 times.  This will put you into "Test Logic 
+Reset" State.  Knowing this, you can, once reset, then track what each 
+transition on TMS will do, and hence know what state the jtag state 
+machine is in.
+
+There are 2 "types" of shift registers.  The Instruction shift register 
+and the data shift register.  The sizes of these are undefined, and can 
+change from chip to chip.  The Instruction register is used to select 
+which Data register/data register function is used, and the data 
+register is used to read data from that function or write data to it.
+
+Each of the states control what happens to either the data register or 
+instruction register.
+
+For example, one of the data registers will be known as "bypass" this is 
+(usually) a single bit which has no function and is used to bypass the 
+chip.  Eg, assume we have 3 identical chips, wired up like the picture 
+and each has a 3 bit instruction register, and there are 2 known 
+instructions (110 = bypass, 010 = some other function) if we want to use 
+"some other function", on the second chip in the line, and not change 
+the other chips we would do the following transitions.
+
+From Test Logic Reset, TMS goes:
+ 
+  0 1 1 0 0
+
+which puts every chip in the chain into the "Shift IR state"
+Then (while holding TMS as 0) TDI goes:
+
+  0 1 1  0 1 0  0 1 1
+
+which puts the following values in the instruction shift register for 
+each chip [110] [010] [110]
+
+The order is reversed, because we shift out the least significant bit
+first.  Then we transition TMS:
+
+  1 1 1 1 0 0
+
+which puts us in the "Shift DR state".
+
+Now when we clock data onto TDI (again while holding TMS to 0) , the 
+data shifts through the data registers, and because of the instruction 
+registers we selected (some other function has 8 bits in its data 
+register), our total data register in the chain looks like this:
+
+  0 00000000 0
+
+The first and last bit are in the "bypassed" chips, so values read from 
+them are irrelevant and data written to them is ignored.  But we need to 
+write bits for those registers, because they are in the chain.
+
+If we wanted to write 0xF5 to the data register we would clock out of 
+TDI (holding TMS to 0):
+
+  0 1 0 1 0 1 1 1 1 0
+
+Again, we are clocking the lsbit first.  Then we would clock TMS:
+
+  1 1 0
+
+which updates the selected data register with the value 0xF5 and returns 
+us to run test idle.
+
+If we needed to read the data register before over-writing it with F5, 
+no sweat, that's already done, because the TDI/TDO are set up as a 
+circular shift register, so if you write enough bits to fill the shift 
+register, you will receive the "captured" contents of the data registers 
+simultaneously on TDO.
+
+That's JTAG in a nutshell.  On top of this, you need to get specs for
+target chips and work out what the various instruction registers/data
+registers do, so you can actually do something useful.  That's where it
+gets interesting.  But in and of itself, JTAG is actually very simple.
+
+ */



From oharboe at mail.berlios.de  Wed May 13 20:58:56 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 13 May 2009 20:58:56 +0200
Subject: [Openocd-svn] r1777 - trunk/src/jtag
Message-ID: <200905131858.n4DIwuEG027089@sheep.berlios.de>

Author: oharboe
Date: 2009-05-13 20:58:55 +0200 (Wed, 13 May 2009)
New Revision: 1777

Modified:
   trunk/src/jtag/zy1000.c
Log:
zy1000 1.52 snapshot

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2009-05-13 11:10:35 UTC (rev 1776)
+++ trunk/src/jtag/zy1000.c	2009-05-13 18:58:55 UTC (rev 1777)
@@ -27,7 +27,7 @@
 #include <cyg/hal/hal_diag.h>
 
 
-#define ZYLIN_VERSION "1.51"
+#define ZYLIN_VERSION "1.52"
 #define ZYLIN_DATE __DATE__
 #define ZYLIN_TIME __TIME__
 #define ZYLIN_OPENOCD "$Revision$"



From oharboe at mail.berlios.de  Wed May 13 21:13:38 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 13 May 2009 21:13:38 +0200
Subject: [Openocd-svn] r1778 - in zy1000/trunk: build/include snapshots
Message-ID: <200905131913.n4DJDcHk029953@sheep.berlios.de>

Author: oharboe
Date: 2009-05-13 21:13:32 +0200 (Wed, 13 May 2009)
New Revision: 1778

Modified:
   zy1000/trunk/build/include/rom.h
   zy1000/trunk/snapshots/athttpd.zip
   zy1000/trunk/snapshots/discover.zip
   zy1000/trunk/snapshots/jimtcl.zip
Log:
zy1000 1.52 snapshot

Modified: zy1000/trunk/build/include/rom.h
===================================================================
--- zy1000/trunk/build/include/rom.h	2009-05-13 18:58:55 UTC (rev 1777)
+++ zy1000/trunk/build/include/rom.h	2009-05-13 19:13:32 UTC (rev 1778)
@@ -1,818 +1,830 @@
 /* This is a generated file. Do not edit. */
 
 static CYGBLD_ATTRIB_ALIGN(4) const unsigned char filedata[] = {
-    0x2e, 0x6d, 0x6f, 0x52, 0xca, 0x00, 0x00, 0x00,
-    0x20, 0x4f, 0x08, 0x00, 0x04, 0x03, 0x02, 0x01,
+    0x2e, 0x6d, 0x6f, 0x52, 0xcd, 0x00, 0x00, 0x00,
+    0x80, 0x5f, 0x08, 0x00, 0x04, 0x03, 0x02, 0x01,
     0x52, 0x4f, 0x4d, 0x46, 0x53, 0x20, 0x76, 0x31,
     0x2e, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x01, 0x00, 0x6f, 0x01, 0x0a, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x60, 0x05, 0x00, 0x00,
-    0x91, 0x79, 0xf9, 0x49, 0x60, 0x19, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x19, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xe0, 0x8f, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x00, 0x37, 0x00, 0x00,
+    0x0c, 0x1b, 0x0b, 0x4a, 0xc0, 0x37, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x31, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x00, 0x03, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xc0, 0x1e, 0x00, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x20, 0x03, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x20, 0x1f, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xa8, 0x37, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0xe0, 0xc6, 0x00, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xa0, 0x37, 0x00, 0x00,
+    0x1e, 0x1b, 0x0b, 0x4a, 0xa0, 0xc7, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x96, 0x2b, 0x00, 0x00,
-    0x49, 0x79, 0xf9, 0x49, 0xa0, 0xfe, 0x00, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x8e, 0x2b, 0x00, 0x00,
+    0x1e, 0x1b, 0x0b, 0x4a, 0x40, 0xff, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x34, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xc0, 0x21, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x40, 0x22, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x16, 0x37, 0x00, 0x00,
-    0x49, 0x79, 0xf9, 0x49, 0x40, 0x2a, 0x01, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x0e, 0x37, 0x00, 0x00,
+    0x1e, 0x1b, 0x0b, 0x4a, 0xe0, 0x2a, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x9d, 0x2f, 0x00, 0x00,
-    0x49, 0x79, 0xf9, 0x49, 0x60, 0x61, 0x01, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x95, 0x2f, 0x00, 0x00,
+    0x1e, 0x1b, 0x0b, 0x4a, 0x00, 0x62, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xff, 0x2d, 0x00, 0x00,
-    0x49, 0x79, 0xf9, 0x49, 0x00, 0x91, 0x01, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xf7, 0x2d, 0x00, 0x00,
+    0x1e, 0x1b, 0x0b, 0x4a, 0xa0, 0x91, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x9e, 0x00, 0x00, 0x00,
-    0x4a, 0x79, 0xf9, 0x49, 0x00, 0xbf, 0x01, 0x00,
+    0x1f, 0x1b, 0x0b, 0x4a, 0xa0, 0xbf, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x90, 0x38, 0x00, 0x00,
-    0x4a, 0x79, 0xf9, 0x49, 0xa0, 0xbf, 0x01, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x88, 0x38, 0x00, 0x00,
+    0x20, 0x1b, 0x0b, 0x4a, 0x40, 0xc0, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x18, 0x2e, 0x00, 0x00,
-    0x4a, 0x79, 0xf9, 0x49, 0x40, 0xf8, 0x01, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x10, 0x2e, 0x00, 0x00,
+    0x20, 0x1b, 0x0b, 0x4a, 0xe0, 0xf8, 0x01, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x8b, 0x65, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x60, 0x26, 0x02, 0x00,
+    0x0c, 0x1b, 0x0b, 0x4a, 0x00, 0x27, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x32, 0x3e,
     0x08, 0x00, 0x6f, 0x01, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x92, 0x02, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x80, 0x4c, 0x08, 0x00,
+    0x0c, 0x1b, 0x0b, 0x4a, 0xe0, 0x5c, 0x08, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x5b, 0x2f, 0x00, 0x00,
-    0x4b, 0x79, 0xf9, 0x49, 0x00, 0x8c, 0x02, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x53, 0x2f, 0x00, 0x00,
+    0x20, 0x1b, 0x0b, 0x4a, 0xa0, 0x8c, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xbb, 0x39, 0x00, 0x00,
-    0x4b, 0x79, 0xf9, 0x49, 0x60, 0xbb, 0x02, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x95, 0x39, 0x00, 0x00,
+    0x21, 0x1b, 0x0b, 0x4a, 0x00, 0xbc, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x35, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x40, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x20, 0x22, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xa0, 0x22, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x59, 0x26, 0x00, 0x00,
-    0x4b, 0x79, 0xf9, 0x49, 0x20, 0xf5, 0x02, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x51, 0x26, 0x00, 0x00,
+    0x21, 0x1b, 0x0b, 0x4a, 0xa0, 0xf5, 0x02, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x22, 0x03, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x80, 0x1b, 0x03, 0x00,
+    0x0c, 0x1b, 0x0b, 0x4a, 0x00, 0x1c, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x6a, 0x08, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0xc0, 0x1e, 0x03, 0x00,
+    0x0c, 0x1b, 0x0b, 0x4a, 0x40, 0x1f, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x31, 0x39, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xc0, 0x02, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x60, 0x26, 0x00, 0x00,
+    0x1d, 0x1b, 0x0b, 0x4a, 0xe0, 0x26, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x83, 0x09, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x40, 0x27, 0x03, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0xc0, 0x27, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xdd, 0x2a, 0x00, 0x00,
-    0x50, 0x79, 0xf9, 0x49, 0xe0, 0x30, 0x03, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xd5, 0x2a, 0x00, 0x00,
+    0x26, 0x1b, 0x0b, 0x4a, 0x60, 0x31, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xb9, 0x30, 0x00, 0x00,
-    0x50, 0x79, 0xf9, 0x49, 0xc0, 0x5b, 0x03, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xb1, 0x30, 0x00, 0x00,
+    0x26, 0x1b, 0x0b, 0x4a, 0x40, 0x5c, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xcd, 0x32, 0x00, 0x00,
-    0x51, 0x79, 0xf9, 0x49, 0x80, 0x8c, 0x03, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xc5, 0x32, 0x00, 0x00,
+    0x26, 0x1b, 0x0b, 0x4a, 0x00, 0x8d, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x0d, 0x29, 0x00, 0x00,
-    0x51, 0x79, 0xf9, 0x49, 0x60, 0xbf, 0x03, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x05, 0x29, 0x00, 0x00,
+    0x27, 0x1b, 0x0b, 0x4a, 0xe0, 0xbf, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x07, 0x2e, 0x00, 0x00,
-    0x51, 0x79, 0xf9, 0x49, 0x80, 0xe8, 0x03, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xff, 0x2d, 0x00, 0x00,
+    0x27, 0x1b, 0x0b, 0x4a, 0x00, 0xe9, 0x03, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x26, 0x01, 0x00, 0x00,
-    0x51, 0x79, 0xf9, 0x49, 0xa0, 0x16, 0x04, 0x00,
+    0x28, 0x1b, 0x0b, 0x4a, 0x00, 0x17, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x3f, 0x0b, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0xe0, 0x17, 0x04, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x40, 0x18, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x8a, 0x30, 0x00, 0x00,
-    0x52, 0x79, 0xf9, 0x49, 0x20, 0x23, 0x04, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x64, 0x30, 0x00, 0x00,
+    0x28, 0x1b, 0x0b, 0x4a, 0x80, 0x23, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x32, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x41, 0x07, 0x00, 0x00,
-    0x52, 0x79, 0xf9, 0x49, 0xc0, 0x53, 0x04, 0x00,
+    0x2a, 0x1b, 0x0b, 0x4a, 0x00, 0x54, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x30, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x00, 0x08, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x20, 0x29, 0x00, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x40, 0x08, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0xa0, 0x29, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x22, 0x48, 0x00, 0x00,
-    0x52, 0x79, 0xf9, 0x49, 0x20, 0x5b, 0x04, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x12, 0x48, 0x00, 0x00,
+    0x2b, 0x1b, 0x0b, 0x4a, 0x60, 0x5b, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x32, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x04, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x00, 0x01, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x20, 0x31, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0xe0, 0x31, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xca, 0x2e, 0x00, 0x00,
-    0x52, 0x79, 0xf9, 0x49, 0x60, 0xa3, 0x04, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xc2, 0x2e, 0x00, 0x00,
+    0x2b, 0x1b, 0x0b, 0x4a, 0x80, 0xa3, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x34, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x20, 0x32, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0xe0, 0x32, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xab, 0x30, 0x00, 0x00,
-    0x53, 0x79, 0xf9, 0x49, 0x40, 0xd2, 0x04, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xa3, 0x30, 0x00, 0x00,
+    0x2b, 0x1b, 0x0b, 0x4a, 0x60, 0xd2, 0x04, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x70, 0x01, 0x00, 0x00,
-    0x53, 0x79, 0xf9, 0x49, 0x00, 0x03, 0x05, 0x00,
+    0x2b, 0x1b, 0x0b, 0x4a, 0x20, 0x03, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x37, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x91, 0x79, 0xf9, 0x49, 0x80, 0x32, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x40, 0x33, 0x00, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xb3, 0x35, 0x00, 0x00,
-    0x53, 0x79, 0xf9, 0x49, 0x80, 0x04, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xab, 0x35, 0x00, 0x00,
+    0x2b, 0x1b, 0x0b, 0x4a, 0xa0, 0x04, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x33, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x13, 0x06, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x40, 0x3a, 0x05, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x60, 0x3a, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x65, 0x03, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x60, 0x40, 0x05, 0x00,
+    0x0c, 0x1b, 0x0b, 0x4a, 0x80, 0x40, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xce, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xe0, 0x43, 0x05, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x00, 0x44, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x51, 0x08, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xc0, 0x44, 0x05, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xe0, 0x44, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x62, 0x09, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x20, 0x4d, 0x05, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x40, 0x4d, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x14, 0x04, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xa0, 0x56, 0x05, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xc0, 0x56, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xc0, 0x5a, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xec, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xe0, 0x5a, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xbe, 0x07, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x20, 0x5b, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xe0, 0x5b, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x11, 0x0a, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xe0, 0x62, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xbe, 0x07, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x40, 0x5c, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x75, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x00, 0x6d, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x11, 0x0a, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x00, 0x64, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x34, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x23, 0x01, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x80, 0x6d, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x75, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x20, 0x6e, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x15, 0x01, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xc0, 0x6e, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x23, 0x01, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xa0, 0x6e, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x7a, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xe0, 0x6f, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x15, 0x01, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xe0, 0x6f, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x64, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x60, 0x70, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x7a, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x00, 0x71, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xc4, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xe0, 0x70, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x64, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x80, 0x71, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x76, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xc0, 0x71, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xc4, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x00, 0x72, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x89, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x40, 0x72, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x76, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xe0, 0x72, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x8c, 0x10, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xe0, 0x72, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x89, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x60, 0x73, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x69, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x80, 0x83, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x8a, 0x10, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x00, 0x74, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x6b, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x00, 0x84, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x69, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xa0, 0x84, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x35, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x90, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x80, 0x84, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x6b, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x20, 0x85, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x4b, 0x0c, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x20, 0x85, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x90, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xa0, 0x85, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x5c, 0x03, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x80, 0x91, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x4b, 0x0c, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x40, 0x86, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xe0, 0x8f, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xe0, 0x94, 0x05, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x5c, 0x03, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xa0, 0x92, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x68, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xc0, 0x24, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xe0, 0x8f, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x00, 0x96, 0x05, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xca, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x40, 0x25, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x68, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0xe0, 0x25, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x6f, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x20, 0x26, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xca, 0x00, 0x00, 0x00,
+    0x60, 0x1b, 0x0b, 0x4a, 0x60, 0x26, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xaf, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xa0, 0x26, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x6f, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x40, 0x27, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x02, 0x01, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x60, 0x27, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xaf, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0x27, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x02, 0x01, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x80, 0x28, 0x06, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x28, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x36, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xb7, 0x01, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xa0, 0x29, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x02, 0x01, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xa0, 0x29, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x7c, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x60, 0x2b, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xb7, 0x01, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0x2a, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x45, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0xe0, 0x2b, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x7c, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x2c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xde, 0x00, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x40, 0x2c, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x45, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0x2d, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x82, 0x02, 0x00, 0x00,
-    0x8e, 0x79, 0xf9, 0x49, 0x20, 0x2d, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xde, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x60, 0x2d, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x53, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xc0, 0x2f, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x9f, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x40, 0x2e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xb8, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x20, 0x30, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x53, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xe0, 0x2e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xb7, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xe0, 0x30, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xb8, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x40, 0x2f, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xa5, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xa0, 0x31, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xb7, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0x30, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xea, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x60, 0x32, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xa5, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0x30, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x37, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x0a, 0x01, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x60, 0x33, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xea, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x31, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xc8, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x80, 0x34, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x0a, 0x01, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x32, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xb7, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x60, 0x35, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xc8, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xa0, 0x33, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xcf, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x20, 0x36, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xb7, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x34, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xda, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0x37, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xcf, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x40, 0x35, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x0b, 0x01, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xe0, 0x37, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xda, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x36, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x97, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0x39, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x0b, 0x01, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0x37, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xda, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xa0, 0x39, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x97, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x38, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xa3, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x80, 0x3a, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xda, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0x38, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x17, 0x01, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x40, 0x3b, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xa3, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xa0, 0x39, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x38, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xf7, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x60, 0x3c, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x17, 0x01, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x60, 0x3a, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xcf, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x60, 0x3d, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xf7, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x3b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xbb, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x40, 0x3e, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xcf, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x3c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xe1, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0x3f, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xbb, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x60, 0x3d, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x73, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0x40, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xe1, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x3e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xf0, 0x01, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x80, 0x40, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x73, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x3f, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x35, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x80, 0x42, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xf0, 0x01, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xa0, 0x3f, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x33, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0xc0, 0x43, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x35, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0xa0, 0x41, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x6c, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x00, 0x45, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x33, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0xe0, 0x42, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x36, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x80, 0x46, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x6c, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x20, 0x44, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x20, 0x39, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x5d, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0xc0, 0x47, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x36, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0xa0, 0x45, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x4a, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x20, 0x49, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x5d, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0xe0, 0x46, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xc6, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x80, 0x4a, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x4a, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x40, 0x48, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xc0, 0x03, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x60, 0x4c, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xc6, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0xa0, 0x49, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x0a, 0x0c, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x20, 0x50, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xc0, 0x03, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x80, 0x4b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x5f, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x40, 0x5c, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x0a, 0x0c, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x40, 0x4f, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x19, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0xa0, 0x5d, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x5f, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x60, 0x5b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x09, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0xc0, 0x5e, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x19, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0xc0, 0x5c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x60, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0xe0, 0x5f, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x09, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0xe0, 0x5d, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x31, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x40, 0x61, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x60, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x00, 0x5f, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x30, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xa9, 0x00, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x80, 0x62, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x31, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x60, 0x60, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xf1, 0x08, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x40, 0x63, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xa9, 0x00, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0xa0, 0x61, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x86, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x40, 0x6c, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xf1, 0x08, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x60, 0x62, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x65, 0x01, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0xe0, 0x6d, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x86, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x60, 0x6b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x84, 0x0f, 0x00, 0x00,
-    0x48, 0x79, 0xf9, 0x49, 0x60, 0x6f, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x65, 0x01, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x00, 0x6d, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x8a, 0x06, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0x7f, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x84, 0x0f, 0x00, 0x00,
+    0x13, 0x1b, 0x0b, 0x4a, 0x80, 0x6e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x27, 0x07, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xa0, 0x85, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x8a, 0x06, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x7e, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x47, 0x05, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xe0, 0x8c, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x27, 0x07, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0x84, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x37, 0x06, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x40, 0x92, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x47, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0x8c, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xfa, 0x03, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x80, 0x98, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x37, 0x06, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x60, 0x91, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x31, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x95, 0x0f, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x80, 0x9c, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xfa, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xa0, 0x97, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x9f, 0x03, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x20, 0xac, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x95, 0x0f, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xa0, 0x9b, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xdf, 0x02, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xc0, 0xaf, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x9f, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x40, 0xab, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xf2, 0x05, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xa0, 0xb2, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xdf, 0x02, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xe0, 0xae, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x01, 0x03, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xa0, 0xb8, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xf2, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0xb1, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x77, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xc0, 0xbb, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x01, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0xb7, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x1d, 0x07, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x40, 0xc0, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x77, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xe0, 0xba, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x3c, 0x05, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x60, 0xc7, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x1d, 0x07, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x60, 0xbf, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x17, 0x03, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xa0, 0xcc, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x3c, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0xc6, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xe2, 0x05, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xc0, 0xcf, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x17, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0xcb, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x32, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x17, 0x03, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xc0, 0xd5, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xe2, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xe0, 0xce, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x19, 0x05, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xe0, 0xd8, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x17, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xe0, 0xd4, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xc2, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0xde, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x19, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0xd8, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xbd, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xe0, 0xe2, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xc2, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0xdd, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x24, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xa0, 0xe7, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xbd, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0xe2, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x0d, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xe0, 0xeb, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x24, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0xe6, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xf6, 0x03, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0xf0, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x0d, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0xeb, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x1e, 0x07, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0xf4, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xf6, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0xef, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x34, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x20, 0xfb, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x1e, 0x07, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0xf3, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x31, 0x00, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x60, 0xfb, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x34, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x40, 0xfa, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x33, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x4c, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xa0, 0xfb, 0x06, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x31, 0x00, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0xfa, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xda, 0x05, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0x00, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x4c, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0xfa, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x60, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xe0, 0x05, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xda, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0xff, 0x06, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xb2, 0x03, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x40, 0x0a, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x60, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0x05, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x25, 0x03, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0x0e, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xb2, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x60, 0x09, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x14, 0x01, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x40, 0x11, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x25, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x0d, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x58, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x60, 0x12, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x14, 0x01, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x60, 0x10, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x3d, 0x06, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0xc0, 0x16, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x58, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x11, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x55, 0x04, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0x1d, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x3d, 0x06, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xe0, 0x15, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x88, 0x09, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x60, 0x21, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x55, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x1c, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x34, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x15, 0x02, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x00, 0x2b, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x88, 0x09, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x20, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x9d, 0x05, 0x00, 0x00,
-    0x8f, 0x79, 0xf9, 0x49, 0x20, 0x2d, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x15, 0x02, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x2a, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x18, 0x03, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xc0, 0x32, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x9d, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x40, 0x2c, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x03, 0x04, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xe0, 0x35, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x18, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xe0, 0x31, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x98, 0x05, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x00, 0x3a, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x03, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0x35, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xe3, 0x03, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xa0, 0x3f, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x98, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x39, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x3f, 0x04, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xa0, 0x43, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xe3, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0x3e, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x4e, 0x02, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xe0, 0x47, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x3f, 0x04, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0x42, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x97, 0x05, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x40, 0x4a, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x4e, 0x02, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0x47, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x67, 0x02, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xe0, 0x4f, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x97, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x60, 0x49, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x35, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x33, 0x01, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x60, 0x52, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x67, 0x02, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x00, 0x4f, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x02, 0x03, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xa0, 0x53, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x33, 0x01, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x80, 0x51, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x2e, 0x06, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xc0, 0x56, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x02, 0x03, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xc0, 0x52, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x2c, 0x05, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x00, 0x5d, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x2e, 0x06, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0xe0, 0x55, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x49, 0x05, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x40, 0x62, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x2c, 0x05, 0x00, 0x00,
+    0x61, 0x1b, 0x0b, 0x4a, 0x20, 0x5c, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xfd, 0x04, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xa0, 0x67, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x49, 0x05, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x60, 0x61, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x5e, 0x05, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xa0, 0x6c, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xfd, 0x04, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x66, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x9e, 0x06, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x00, 0x72, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x5e, 0x05, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x6b, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x84, 0x07, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xa0, 0x78, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x9e, 0x06, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x20, 0x71, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x19, 0x07, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x40, 0x80, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x84, 0x07, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x77, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x36, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xcc, 0x01, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x60, 0x87, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xb3, 0x07, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x60, 0x7f, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x5a, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x40, 0x89, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xcc, 0x01, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x20, 0x87, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0x1a, 0x0f, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xa0, 0x89, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x5a, 0x00, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x00, 0x89, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xfa, 0x09, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xc0, 0x98, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xfd, 0x07, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x60, 0x89, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
-    0xeb, 0x03, 0x01, 0x02, 0xf5, 0x0b, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xc0, 0xa2, 0x07, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x8e, 0x08, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x60, 0x91, 0x07, 0x00,
     0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0x1a, 0x0f, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x00, 0x9a, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x35, 0x3e,
+    0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xfa, 0x09, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x20, 0xa9, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x36, 0x3e,
+    0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
+    0xeb, 0x03, 0x01, 0x02, 0xf5, 0x0b, 0x00, 0x00,
+    0x62, 0x1b, 0x0b, 0x4a, 0x20, 0xb3, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x37, 0x3e,
+    0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x7f, 0x06, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xc0, 0xae, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x35, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x20, 0xbf, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x38, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x04, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x80, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xe0, 0x32, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x36, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xa0, 0x33, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x39, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x03, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x60, 0x33, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x37, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x20, 0x34, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x88, 0x0e, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x40, 0xb5, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x38, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xa0, 0xc5, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xe0, 0x06, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xe0, 0xc3, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x37, 0x39, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x40, 0xd4, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x5e, 0x02, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xc0, 0xca, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x30, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x20, 0xdb, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x33, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x03, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xc0, 0x33, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x31, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x80, 0x34, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x34, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x03, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x60, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x20, 0x34, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x32, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xe0, 0x34, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x35, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x00, 0x01, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x80, 0x34, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x33, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x40, 0x35, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x36, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x18, 0x0c, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x20, 0xcd, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x34, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x80, 0xdd, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x21, 0x0f, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x40, 0xd9, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x35, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xa0, 0xe9, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xa9, 0x10, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x80, 0xe8, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x36, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xe0, 0xf8, 0x07, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x66, 0x01, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x40, 0xf9, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x37, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xa0, 0x09, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xaf, 0x05, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xc0, 0xfa, 0x07, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x38, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x20, 0x0b, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xcf, 0x0e, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x80, 0x00, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x38, 0x39, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xe0, 0x10, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x32, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xa0, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x80, 0x35, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x30, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x40, 0x36, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xec, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x60, 0x0f, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x31, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x1f, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x34, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xf1, 0x1d, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x60, 0x10, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x32, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x20, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x35, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xf6, 0x11, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x60, 0x2e, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x33, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x3e, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x36, 0x3e,
     0x01, 0x00, 0x6f, 0x01, 0x02, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0xe0, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x20, 0x36, 0x00, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x34, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xe0, 0x36, 0x00, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x37, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x79, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x60, 0x40, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x35, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x50, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x38, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x77, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xe0, 0x40, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x36, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x40, 0x51, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x39, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x78, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x60, 0x41, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x37, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x51, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x32, 0x30, 0x30, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x78, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0xe0, 0x41, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x38, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x40, 0x52, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x32, 0x30, 0x31, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x79, 0x00, 0x00, 0x00,
-    0x90, 0x79, 0xf9, 0x49, 0x60, 0x42, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x31, 0x39, 0x39, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xc0, 0x52, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x32, 0x30, 0x32, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x58, 0x03, 0x00, 0x00,
-    0x91, 0x79, 0xf9, 0x49, 0xe0, 0x42, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x32, 0x30, 0x30, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0x40, 0x53, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x32, 0x30, 0x33, 0x3e,
     0x08, 0x00, 0x4b, 0x00, 0x01, 0x00, 0x00, 0x00,
     0xeb, 0x03, 0x01, 0x02, 0x38, 0x06, 0x00, 0x00,
-    0x91, 0x79, 0xf9, 0x49, 0x40, 0x46, 0x08, 0x00,
-    0x3c, 0x20, 0x20, 0x20, 0x32, 0x30, 0x31, 0x3e,
+    0x62, 0x1b, 0x0b, 0x4a, 0xa0, 0x56, 0x08, 0x00,
+    0x3c, 0x20, 0x20, 0x20, 0x32, 0x30, 0x34, 0x3e,
     0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1010,66 +1022,70 @@
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0x68, 0x69, 0x74, 0x65, 0x78, 0x5f, 0x73, 0x74,
+    0x72, 0x39, 0x5f, 0x63, 0x6f, 0x6d, 0x73, 0x74,
+    0x69, 0x63, 0x6b, 0x2e, 0x63, 0x66, 0x67, 0x00,
+    0x2f, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
     0x69, 0x61, 0x72, 0x5f, 0x73, 0x74, 0x72, 0x39,
     0x31, 0x32, 0x5f, 0x73, 0x6b, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x2f, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
+    0x30, 0x00, 0x00, 0x00, 0x20, 0x01, 0x00, 0x00,
     0x69, 0x6d, 0x78, 0x32, 0x37, 0x61, 0x64, 0x73,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x30, 0x00, 0x00, 0x00, 0x20, 0x01, 0x00, 0x00,
+    0x31, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00,
     0x69, 0x6d, 0x78, 0x33, 0x31, 0x70, 0x64, 0x6b,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x31, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00,
+    0x32, 0x00, 0x00, 0x00, 0x60, 0x01, 0x00, 0x00,
     0x6b, 0x65, 0x69, 0x6c, 0x5f, 0x6d, 0x63, 0x62,
     0x32, 0x31, 0x34, 0x30, 0x2e, 0x63, 0x66, 0x67,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x32, 0x00, 0x00, 0x00, 0x60, 0x01, 0x00, 0x00,
+    0x33, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00,
     0x6c, 0x6f, 0x67, 0x69, 0x63, 0x70, 0x64, 0x5f,
     0x69, 0x6d, 0x78, 0x32, 0x37, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x33, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00,
+    0x34, 0x00, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x00,
     0x6f, 0x6c, 0x69, 0x6d, 0x65, 0x78, 0x5f, 0x4c,
     0x50, 0x43, 0x32, 0x33, 0x37, 0x38, 0x53, 0x54,
     0x4b, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
-    0x34, 0x00, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x00,
+    0x35, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00,
     0x6f, 0x6c, 0x69, 0x6d, 0x65, 0x78, 0x5f, 0x6c,
     0x70, 0x63, 0x5f, 0x68, 0x32, 0x31, 0x34, 0x38,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
-    0x35, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00,
+    0x36, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00,
     0x6f, 0x6c, 0x69, 0x6d, 0x65, 0x78, 0x5f, 0x73,
     0x61, 0x6d, 0x37, 0x5f, 0x65, 0x78, 0x32, 0x35,
     0x36, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
-    0x36, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00,
+    0x37, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
     0x6f, 0x6c, 0x69, 0x6d, 0x65, 0x78, 0x5f, 0x73,
     0x61, 0x6d, 0x39, 0x5f, 0x6c, 0x39, 0x32, 0x36,
     0x30, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
-    0x37, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
+    0x38, 0x00, 0x00, 0x00, 0x20, 0x02, 0x00, 0x00,
     0x6f, 0x6c, 0x69, 0x6d, 0x65, 0x78, 0x5f, 0x73,
     0x74, 0x6d, 0x33, 0x32, 0x5f, 0x68, 0x31, 0x30,
     0x33, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
-    0x38, 0x00, 0x00, 0x00, 0x20, 0x02, 0x00, 0x00,
+    0x39, 0x00, 0x00, 0x00, 0x40, 0x02, 0x00, 0x00,
     0x70, 0x69, 0x63, 0x2d, 0x70, 0x33, 0x32, 0x6d,
     0x78, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x39, 0x00, 0x00, 0x00, 0x40, 0x02, 0x00, 0x00,
+    0x3a, 0x00, 0x00, 0x00, 0x60, 0x02, 0x00, 0x00,
     0x73, 0x68, 0x65, 0x65, 0x76, 0x61, 0x70, 0x6c,
     0x75, 0x67, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x3a, 0x00, 0x00, 0x00, 0x60, 0x02, 0x00, 0x00,
+    0x3b, 0x00, 0x00, 0x00, 0x80, 0x02, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x31, 0x30, 0x65,
     0x5f, 0x65, 0x76, 0x61, 0x6c, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x3b, 0x00, 0x00, 0x00, 0x80, 0x02, 0x00, 0x00,
+    0x3c, 0x00, 0x00, 0x00, 0xa0, 0x02, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x66, 0x31, 0x30,
     0x78, 0x5f, 0x31, 0x32, 0x38, 0x6b, 0x5f, 0x65,
     0x76, 0x61, 0x6c, 0x2e, 0x63, 0x66, 0x67, 0x00,
-    0x3c, 0x00, 0x00, 0x00, 0xa0, 0x02, 0x00, 0x00,
+    0x3d, 0x00, 0x00, 0x00, 0xc0, 0x02, 0x00, 0x00,
     0x74, 0x69, 0x5f, 0x62, 0x65, 0x61, 0x67, 0x6c,
     0x65, 0x62, 0x6f, 0x61, 0x72, 0x64, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x3d, 0x00, 0x00, 0x00, 0xe0, 0x02, 0x00, 0x00,
+    0x3e, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00,
     0x75, 0x6e, 0x6b, 0x6e, 0x6f, 0x77, 0x6e, 0x2d,
     0x62, 0x6f, 0x61, 0x72, 0x64, 0x2d, 0x61, 0x74,
     0x6d, 0x65, 0x6c, 0x2d, 0x61, 0x74, 0x39, 0x31,
@@ -1077,7 +1093,7 @@
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x3e, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00,
+    0x3f, 0x00, 0x00, 0x00, 0x20, 0x03, 0x00, 0x00,
     0x78, 0x33, 0x30, 0x30, 0x74, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1089,7 +1105,7 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x3f, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0x40, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x65, 0x62, 0x34, 0x30,
     0x61, 0x2e, 0x65, 0x6c, 0x66, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1101,131 +1117,131 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x40, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0x41, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x2d, 0x6a, 0x74, 0x61, 0x67,
     0x2d, 0x65, 0x77, 0x2e, 0x63, 0x66, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x41, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0x42, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x2d, 0x75, 0x73, 0x62, 0x2d,
     0x6f, 0x63, 0x64, 0x2e, 0x63, 0x66, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x42, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0x43, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x72, 0x6d, 0x39, 0x32,
     0x30, 0x30, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x43, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
+    0x44, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
     0x61, 0x78, 0x6d, 0x30, 0x34, 0x33, 0x32, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x44, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0x45, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
     0x63, 0x61, 0x6c, 0x61, 0x6f, 0x2d, 0x75, 0x73,
     0x62, 0x2d, 0x61, 0x39, 0x32, 0x36, 0x30, 0x2d,
     0x63, 0x30, 0x31, 0x2e, 0x63, 0x66, 0x67, 0x00,
-    0x45, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
+    0x46, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
     0x63, 0x61, 0x6c, 0x61, 0x6f, 0x2d, 0x75, 0x73,
     0x62, 0x2d, 0x61, 0x39, 0x32, 0x36, 0x30, 0x2d,
     0x63, 0x30, 0x32, 0x2e, 0x63, 0x66, 0x67, 0x00,
-    0x46, 0x00, 0x00, 0x00, 0x20, 0x01, 0x00, 0x00,
+    0x47, 0x00, 0x00, 0x00, 0x20, 0x01, 0x00, 0x00,
     0x63, 0x61, 0x6c, 0x61, 0x6f, 0x2d, 0x75, 0x73,
     0x62, 0x2d, 0x61, 0x39, 0x32, 0x36, 0x30, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x47, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00,
+    0x48, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00,
     0x63, 0x68, 0x61, 0x6d, 0x65, 0x6c, 0x65, 0x6f,
     0x6e, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x48, 0x00, 0x00, 0x00, 0x60, 0x01, 0x00, 0x00,
+    0x49, 0x00, 0x00, 0x00, 0x60, 0x01, 0x00, 0x00,
     0x64, 0x75, 0x6d, 0x6d, 0x79, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x49, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00,
+    0x4a, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00,
     0x66, 0x6c, 0x79, 0x73, 0x77, 0x61, 0x74, 0x74,
     0x65, 0x72, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x4a, 0x00, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x00,
+    0x4b, 0x00, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x00,
     0x69, 0x63, 0x65, 0x62, 0x65, 0x61, 0x72, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x4b, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00,
+    0x4c, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00,
     0x6a, 0x6c, 0x69, 0x6e, 0x6b, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x4c, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00,
+    0x4d, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00,
     0x6a, 0x74, 0x61, 0x67, 0x6b, 0x65, 0x79, 0x2d,
     0x74, 0x69, 0x6e, 0x79, 0x2e, 0x63, 0x66, 0x67,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x4d, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
+    0x4e, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
     0x6a, 0x74, 0x61, 0x67, 0x6b, 0x65, 0x79, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x4e, 0x00, 0x00, 0x00, 0x20, 0x02, 0x00, 0x00,
+    0x4f, 0x00, 0x00, 0x00, 0x20, 0x02, 0x00, 0x00,
     0x6c, 0x75, 0x6d, 0x69, 0x6e, 0x61, 0x72, 0x79,
     0x2d, 0x6c, 0x69, 0x62, 0x66, 0x74, 0x64, 0x69,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
-    0x4f, 0x00, 0x00, 0x00, 0x40, 0x02, 0x00, 0x00,
+    0x50, 0x00, 0x00, 0x00, 0x40, 0x02, 0x00, 0x00,
     0x6c, 0x75, 0x6d, 0x69, 0x6e, 0x61, 0x72, 0x79,
     0x2d, 0x6c, 0x6d, 0x33, 0x73, 0x38, 0x31, 0x31,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
-    0x50, 0x00, 0x00, 0x00, 0x60, 0x02, 0x00, 0x00,
+    0x51, 0x00, 0x00, 0x00, 0x60, 0x02, 0x00, 0x00,
     0x6c, 0x75, 0x6d, 0x69, 0x6e, 0x61, 0x72, 0x79,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x51, 0x00, 0x00, 0x00, 0x80, 0x02, 0x00, 0x00,
+    0x52, 0x00, 0x00, 0x00, 0x80, 0x02, 0x00, 0x00,
     0x6f, 0x6c, 0x69, 0x6d, 0x65, 0x78, 0x2d, 0x61,
     0x72, 0x6d, 0x2d, 0x75, 0x73, 0x62, 0x2d, 0x6f,
     0x63, 0x64, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
-    0x52, 0x00, 0x00, 0x00, 0xa0, 0x02, 0x00, 0x00,
+    0x53, 0x00, 0x00, 0x00, 0xa0, 0x02, 0x00, 0x00,
     0x6f, 0x6c, 0x69, 0x6d, 0x65, 0x78, 0x2d, 0x6a,
     0x74, 0x61, 0x67, 0x2d, 0x74, 0x69, 0x6e, 0x79,
     0x2d, 0x61, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
-    0x53, 0x00, 0x00, 0x00, 0xc0, 0x02, 0x00, 0x00,
+    0x54, 0x00, 0x00, 0x00, 0xc0, 0x02, 0x00, 0x00,
     0x6f, 0x6c, 0x69, 0x6d, 0x65, 0x78, 0x2d, 0x6a,
     0x74, 0x61, 0x67, 0x2d, 0x74, 0x69, 0x6e, 0x79,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
-    0x54, 0x00, 0x00, 0x00, 0xe0, 0x02, 0x00, 0x00,
+    0x55, 0x00, 0x00, 0x00, 0xe0, 0x02, 0x00, 0x00,
     0x6f, 0x6f, 0x63, 0x64, 0x6c, 0x69, 0x6e, 0x6b,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x55, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00,
+    0x56, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00,
     0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x2d,
     0x75, 0x73, 0x62, 0x2e, 0x63, 0x66, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x56, 0x00, 0x00, 0x00, 0x20, 0x03, 0x00, 0x00,
+    0x57, 0x00, 0x00, 0x00, 0x20, 0x03, 0x00, 0x00,
     0x70, 0x61, 0x72, 0x70, 0x6f, 0x72, 0x74, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x57, 0x00, 0x00, 0x00, 0x40, 0x03, 0x00, 0x00,
+    0x58, 0x00, 0x00, 0x00, 0x40, 0x03, 0x00, 0x00,
     0x70, 0x61, 0x72, 0x70, 0x6f, 0x72, 0x74, 0x5f,
     0x64, 0x6c, 0x63, 0x35, 0x2e, 0x63, 0x66, 0x67,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x58, 0x00, 0x00, 0x00, 0x60, 0x03, 0x00, 0x00,
+    0x59, 0x00, 0x00, 0x00, 0x60, 0x03, 0x00, 0x00,
     0x72, 0x6c, 0x69, 0x6e, 0x6b, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x59, 0x00, 0x00, 0x00, 0x80, 0x03, 0x00, 0x00,
+    0x5a, 0x00, 0x00, 0x00, 0x80, 0x03, 0x00, 0x00,
     0x73, 0x68, 0x65, 0x65, 0x76, 0x61, 0x70, 0x6c,
     0x75, 0x67, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x5a, 0x00, 0x00, 0x00, 0xa0, 0x03, 0x00, 0x00,
+    0x5b, 0x00, 0x00, 0x00, 0xa0, 0x03, 0x00, 0x00,
     0x73, 0x69, 0x67, 0x6e, 0x61, 0x6c, 0x79, 0x7a,
     0x65, 0x72, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x5b, 0x00, 0x00, 0x00, 0xc0, 0x03, 0x00, 0x00,
+    0x5c, 0x00, 0x00, 0x00, 0xc0, 0x03, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x2d, 0x73, 0x74,
     0x69, 0x63, 0x6b, 0x2e, 0x63, 0x66, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x5c, 0x00, 0x00, 0x00, 0xe0, 0x03, 0x00, 0x00,
+    0x5d, 0x00, 0x00, 0x00, 0xe0, 0x03, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x39, 0x2d, 0x63, 0x6f, 0x6d,
     0x73, 0x74, 0x69, 0x63, 0x6b, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x5d, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00,
+    0x5e, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00,
     0x74, 0x75, 0x72, 0x74, 0x65, 0x6c, 0x69, 0x7a,
     0x65, 0x72, 0x32, 0x2e, 0x63, 0x66, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x5e, 0x00, 0x00, 0x00, 0x20, 0x04, 0x00, 0x00,
+    0x5f, 0x00, 0x00, 0x00, 0x20, 0x04, 0x00, 0x00,
     0x75, 0x73, 0x62, 0x70, 0x72, 0x6f, 0x67, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x5f, 0x00, 0x00, 0x00, 0x40, 0x04, 0x00, 0x00,
+    0x60, 0x00, 0x00, 0x00, 0x40, 0x04, 0x00, 0x00,
     0x76, 0x73, 0x6c, 0x6c, 0x69, 0x6e, 0x6b, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1237,79 +1253,79 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x60, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0x61, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x63, 0x65, 0x6e, 0x74, 0x65, 0x72, 0x5f, 0x62,
     0x6f, 0x74, 0x74, 0x6f, 0x6d, 0x2e, 0x70, 0x6e,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x61, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0x62, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x63, 0x65, 0x6e, 0x74, 0x65, 0x72, 0x5f, 0x74,
     0x6f, 0x70, 0x2e, 0x70, 0x6e, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x62, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0x63, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x68, 0x5f, 0x74, 0x61, 0x62, 0x31, 0x2e, 0x70,
     0x6e, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x63, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
+    0x64, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
     0x68, 0x5f, 0x74, 0x61, 0x62, 0x31, 0x5f, 0x73,
     0x65, 0x6c, 0x65, 0x63, 0x74, 0x65, 0x64, 0x2e,
     0x70, 0x6e, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x64, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0x65, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
     0x68, 0x5f, 0x74, 0x61, 0x62, 0x32, 0x2e, 0x70,
     0x6e, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x65, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
+    0x66, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
     0x68, 0x5f, 0x74, 0x61, 0x62, 0x32, 0x5f, 0x73,
     0x65, 0x6c, 0x65, 0x63, 0x74, 0x65, 0x64, 0x2e,
     0x70, 0x6e, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x66, 0x00, 0x00, 0x00, 0x20, 0x01, 0x00, 0x00,
+    0x67, 0x00, 0x00, 0x00, 0x20, 0x01, 0x00, 0x00,
     0x68, 0x5f, 0x74, 0x61, 0x62, 0x5f, 0x66, 0x72,
     0x65, 0x65, 0x2e, 0x70, 0x6e, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x67, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00,
+    0x68, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00,
     0x6c, 0x6f, 0x67, 0x6f, 0x5f, 0x62, 0x6f, 0x74,
     0x74, 0x6f, 0x6d, 0x2e, 0x70, 0x6e, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x68, 0x00, 0x00, 0x00, 0x60, 0x01, 0x00, 0x00,
+    0x69, 0x00, 0x00, 0x00, 0x60, 0x01, 0x00, 0x00,
     0x6c, 0x6f, 0x67, 0x6f, 0x5f, 0x74, 0x6f, 0x70,
     0x2e, 0x70, 0x6e, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x69, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00,
+    0x6a, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00,
     0x72, 0x69, 0x67, 0x68, 0x74, 0x5f, 0x62, 0x6f,
     0x74, 0x74, 0x6f, 0x6d, 0x2e, 0x70, 0x6e, 0x67,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x6a, 0x00, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x00,
+    0x6b, 0x00, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x00,
     0x72, 0x69, 0x67, 0x68, 0x74, 0x5f, 0x74, 0x6f,
     0x70, 0x2e, 0x70, 0x6e, 0x67, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x6b, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00,
+    0x6c, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00,
     0x72, 0x69, 0x67, 0x68, 0x74, 0x5f, 0x74, 0x6f,
     0x70, 0x5f, 0x73, 0x6d, 0x61, 0x6c, 0x6c, 0x2e,
     0x70, 0x6e, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x6c, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00,
+    0x6d, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00,
     0x74, 0x6f, 0x70, 0x5f, 0x72, 0x69, 0x67, 0x68,
     0x74, 0x2e, 0x70, 0x6e, 0x67, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x6d, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
+    0x6e, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
     0x76, 0x5f, 0x31, 0x2e, 0x70, 0x6e, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x6e, 0x00, 0x00, 0x00, 0x20, 0x02, 0x00, 0x00,
+    0x6f, 0x00, 0x00, 0x00, 0x20, 0x02, 0x00, 0x00,
     0x76, 0x5f, 0x32, 0x5f, 0x74, 0x69, 0x6c, 0x65,
     0x2e, 0x70, 0x6e, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x6f, 0x00, 0x00, 0x00, 0x40, 0x02, 0x00, 0x00,
+    0x70, 0x00, 0x00, 0x00, 0x40, 0x02, 0x00, 0x00,
     0x76, 0x5f, 0x33, 0x2e, 0x70, 0x6e, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x70, 0x00, 0x00, 0x00, 0x60, 0x02, 0x00, 0x00,
+    0x71, 0x00, 0x00, 0x00, 0x60, 0x02, 0x00, 0x00,
     0x76, 0x5f, 0x74, 0x61, 0x62, 0x2e, 0x70, 0x6e,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x71, 0x00, 0x00, 0x00, 0x80, 0x02, 0x00, 0x00,
+    0x72, 0x00, 0x00, 0x00, 0x80, 0x02, 0x00, 0x00,
     0x76, 0x5f, 0x74, 0x61, 0x62, 0x5f, 0x73, 0x65,
     0x6c, 0x65, 0x63, 0x74, 0x65, 0x64, 0x2e, 0x70,
     0x6e, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x72, 0x00, 0x00, 0x00, 0xc0, 0x02, 0x00, 0x00,
+    0x73, 0x00, 0x00, 0x00, 0xc0, 0x02, 0x00, 0x00,
     0x7a, 0x79, 0x6c, 0x69, 0x6e, 0x5f, 0x6c, 0x6f,
     0x67, 0x6f, 0x5f, 0x62, 0x6f, 0x74, 0x74, 0x6f,
     0x6d, 0x5f, 0x6c, 0x65, 0x66, 0x74, 0x2e, 0x50,
@@ -1325,27 +1341,27 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x73, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0x74, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x64, 0x75, 0x63, 0x37, 0x30, 0x32, 0x78,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x74, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0x75, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x65, 0x62, 0x34, 0x30,
     0x61, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x75, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0x76, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x72, 0x34, 0x30, 0x30,
     0x30, 0x38, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x76, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
+    0x77, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x72, 0x6d, 0x39, 0x32,
     0x30, 0x30, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x77, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0x78, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x73, 0x61, 0x6d, 0x39,
     0x32, 0x36, 0x30, 0x2e, 0x63, 0x66, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x78, 0x00, 0x00, 0x00, 0x20, 0x01, 0x00, 0x00,
+    0x79, 0x00, 0x00, 0x00, 0x20, 0x01, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x73, 0x61, 0x6d, 0x39,
     0x32, 0x36, 0x30, 0x5f, 0x65, 0x78, 0x74, 0x5f,
     0x52, 0x41, 0x4d, 0x5f, 0x65, 0x78, 0x74, 0x5f,
@@ -1353,203 +1369,203 @@
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x79, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00,
+    0x7a, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00, 0x00,
     0x65, 0x70, 0x63, 0x39, 0x33, 0x30, 0x31, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x7a, 0x00, 0x00, 0x00, 0x60, 0x01, 0x00, 0x00,
+    0x7b, 0x00, 0x00, 0x00, 0x60, 0x01, 0x00, 0x00,
     0x66, 0x65, 0x72, 0x6f, 0x63, 0x65, 0x6f, 0x6e,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x7b, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00,
+    0x7c, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00, 0x00,
     0x69, 0x6d, 0x6f, 0x74, 0x65, 0x32, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x7c, 0x00, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x00,
+    0x7d, 0x00, 0x00, 0x00, 0xa0, 0x01, 0x00, 0x00,
     0x69, 0x6d, 0x78, 0x32, 0x31, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x7d, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00,
+    0x7e, 0x00, 0x00, 0x00, 0xc0, 0x01, 0x00, 0x00,
     0x69, 0x6d, 0x78, 0x32, 0x37, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x7e, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00,
+    0x7f, 0x00, 0x00, 0x00, 0xe0, 0x01, 0x00, 0x00,
     0x69, 0x6d, 0x78, 0x33, 0x31, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x7f, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
+    0x80, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00,
     0x69, 0x6d, 0x78, 0x33, 0x35, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x80, 0x00, 0x00, 0x00, 0x20, 0x02, 0x00, 0x00,
+    0x81, 0x00, 0x00, 0x00, 0x20, 0x02, 0x00, 0x00,
     0x69, 0x70, 0x78, 0x34, 0x32, 0x78, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x81, 0x00, 0x00, 0x00, 0x40, 0x02, 0x00, 0x00,
+    0x82, 0x00, 0x00, 0x00, 0x40, 0x02, 0x00, 0x00,
     0x69, 0x73, 0x35, 0x31, 0x31, 0x34, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x82, 0x00, 0x00, 0x00, 0x60, 0x02, 0x00, 0x00,
+    0x83, 0x00, 0x00, 0x00, 0x60, 0x02, 0x00, 0x00,
     0x69, 0x78, 0x70, 0x34, 0x32, 0x78, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x83, 0x00, 0x00, 0x00, 0x80, 0x02, 0x00, 0x00,
+    0x84, 0x00, 0x00, 0x00, 0x80, 0x02, 0x00, 0x00,
     0x6c, 0x6d, 0x33, 0x73, 0x33, 0x37, 0x34, 0x38,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x84, 0x00, 0x00, 0x00, 0xa0, 0x02, 0x00, 0x00,
+    0x85, 0x00, 0x00, 0x00, 0xa0, 0x02, 0x00, 0x00,
     0x6c, 0x6d, 0x33, 0x73, 0x36, 0x39, 0x36, 0x35,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x85, 0x00, 0x00, 0x00, 0xc0, 0x02, 0x00, 0x00,
+    0x86, 0x00, 0x00, 0x00, 0xc0, 0x02, 0x00, 0x00,
     0x6c, 0x6d, 0x33, 0x73, 0x38, 0x31, 0x31, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x86, 0x00, 0x00, 0x00, 0xe0, 0x02, 0x00, 0x00,
+    0x87, 0x00, 0x00, 0x00, 0xe0, 0x02, 0x00, 0x00,
     0x6c, 0x70, 0x63, 0x32, 0x31, 0x30, 0x33, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x87, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00,
+    0x88, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00,
     0x6c, 0x70, 0x63, 0x32, 0x31, 0x32, 0x34, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x88, 0x00, 0x00, 0x00, 0x20, 0x03, 0x00, 0x00,
+    0x89, 0x00, 0x00, 0x00, 0x20, 0x03, 0x00, 0x00,
     0x6c, 0x70, 0x63, 0x32, 0x31, 0x32, 0x39, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x89, 0x00, 0x00, 0x00, 0x40, 0x03, 0x00, 0x00,
+    0x8a, 0x00, 0x00, 0x00, 0x40, 0x03, 0x00, 0x00,
     0x6c, 0x70, 0x63, 0x32, 0x31, 0x34, 0x38, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8a, 0x00, 0x00, 0x00, 0x60, 0x03, 0x00, 0x00,
+    0x8b, 0x00, 0x00, 0x00, 0x60, 0x03, 0x00, 0x00,
     0x6c, 0x70, 0x63, 0x32, 0x31, 0x34, 0x38, 0x5f,
     0x32, 0x6d, 0x68, 0x7a, 0x2e, 0x63, 0x66, 0x67,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8b, 0x00, 0x00, 0x00, 0x80, 0x03, 0x00, 0x00,
+    0x8c, 0x00, 0x00, 0x00, 0x80, 0x03, 0x00, 0x00,
     0x6c, 0x70, 0x63, 0x32, 0x31, 0x34, 0x38, 0x5f,
     0x72, 0x63, 0x6c, 0x6b, 0x2e, 0x63, 0x66, 0x67,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8c, 0x00, 0x00, 0x00, 0xa0, 0x03, 0x00, 0x00,
+    0x8d, 0x00, 0x00, 0x00, 0xa0, 0x03, 0x00, 0x00,
     0x6c, 0x70, 0x63, 0x32, 0x32, 0x39, 0x34, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8d, 0x00, 0x00, 0x00, 0xc0, 0x03, 0x00, 0x00,
+    0x8e, 0x00, 0x00, 0x00, 0xc0, 0x03, 0x00, 0x00,
     0x6c, 0x70, 0x63, 0x32, 0x33, 0x37, 0x38, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8e, 0x00, 0x00, 0x00, 0xe0, 0x03, 0x00, 0x00,
+    0x8f, 0x00, 0x00, 0x00, 0xe0, 0x03, 0x00, 0x00,
     0x6c, 0x70, 0x63, 0x32, 0x34, 0x37, 0x38, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x8f, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00,
+    0x90, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00,
     0x6d, 0x65, 0x67, 0x61, 0x31, 0x32, 0x38, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x90, 0x00, 0x00, 0x00, 0x20, 0x04, 0x00, 0x00,
+    0x91, 0x00, 0x00, 0x00, 0x20, 0x04, 0x00, 0x00,
     0x6e, 0x65, 0x74, 0x78, 0x35, 0x30, 0x30, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x91, 0x00, 0x00, 0x00, 0x40, 0x04, 0x00, 0x00,
+    0x92, 0x00, 0x00, 0x00, 0x40, 0x04, 0x00, 0x00,
     0x6e, 0x73, 0x6c, 0x75, 0x32, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x92, 0x00, 0x00, 0x00, 0x60, 0x04, 0x00, 0x00,
+    0x93, 0x00, 0x00, 0x00, 0x60, 0x04, 0x00, 0x00,
     0x6f, 0x6d, 0x61, 0x70, 0x33, 0x35, 0x33, 0x30,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x93, 0x00, 0x00, 0x00, 0x80, 0x04, 0x00, 0x00,
+    0x94, 0x00, 0x00, 0x00, 0x80, 0x04, 0x00, 0x00,
     0x6f, 0x6d, 0x61, 0x70, 0x35, 0x39, 0x31, 0x32,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x94, 0x00, 0x00, 0x00, 0xa0, 0x04, 0x00, 0x00,
+    0x95, 0x00, 0x00, 0x00, 0xa0, 0x04, 0x00, 0x00,
     0x70, 0x69, 0x63, 0x33, 0x32, 0x6d, 0x78, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x95, 0x00, 0x00, 0x00, 0xc0, 0x04, 0x00, 0x00,
+    0x96, 0x00, 0x00, 0x00, 0xc0, 0x04, 0x00, 0x00,
     0x70, 0x78, 0x61, 0x32, 0x35, 0x35, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x96, 0x00, 0x00, 0x00, 0xe0, 0x04, 0x00, 0x00,
+    0x97, 0x00, 0x00, 0x00, 0xe0, 0x04, 0x00, 0x00,
     0x70, 0x78, 0x61, 0x32, 0x35, 0x35, 0x5f, 0x73,
     0x73, 0x74, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x97, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00,
+    0x98, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00,
     0x70, 0x78, 0x61, 0x32, 0x37, 0x30, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x98, 0x00, 0x00, 0x00, 0x20, 0x05, 0x00, 0x00,
+    0x99, 0x00, 0x00, 0x00, 0x20, 0x05, 0x00, 0x00,
     0x70, 0x78, 0x69, 0x34, 0x32, 0x78, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x99, 0x00, 0x00, 0x00, 0x40, 0x05, 0x00, 0x00,
+    0x9a, 0x00, 0x00, 0x00, 0x40, 0x05, 0x00, 0x00,
     0x73, 0x61, 0x6d, 0x37, 0x73, 0x65, 0x35, 0x31,
     0x32, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9a, 0x00, 0x00, 0x00, 0x60, 0x05, 0x00, 0x00,
+    0x9b, 0x00, 0x00, 0x00, 0x60, 0x05, 0x00, 0x00,
     0x73, 0x61, 0x6d, 0x37, 0x78, 0x32, 0x35, 0x36,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9b, 0x00, 0x00, 0x00, 0x80, 0x05, 0x00, 0x00,
+    0x9c, 0x00, 0x00, 0x00, 0x80, 0x05, 0x00, 0x00,
     0x73, 0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x5f,
     0x73, 0x33, 0x63, 0x32, 0x34, 0x31, 0x30, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9c, 0x00, 0x00, 0x00, 0xa0, 0x05, 0x00, 0x00,
+    0x9d, 0x00, 0x00, 0x00, 0xa0, 0x05, 0x00, 0x00,
     0x73, 0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x5f,
     0x73, 0x33, 0x63, 0x32, 0x34, 0x34, 0x30, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9d, 0x00, 0x00, 0x00, 0xc0, 0x05, 0x00, 0x00,
+    0x9e, 0x00, 0x00, 0x00, 0xc0, 0x05, 0x00, 0x00,
     0x73, 0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x5f,
     0x73, 0x33, 0x63, 0x34, 0x35, 0x31, 0x30, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9e, 0x00, 0x00, 0x00, 0xe0, 0x05, 0x00, 0x00,
+    0x9f, 0x00, 0x00, 0x00, 0xe0, 0x05, 0x00, 0x00,
     0x73, 0x61, 0x6d, 0x73, 0x75, 0x6e, 0x67, 0x5f,
     0x73, 0x33, 0x63, 0x36, 0x34, 0x31, 0x30, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x9f, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00,
+    0xa0, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00,
     0x73, 0x68, 0x61, 0x72, 0x70, 0x5f, 0x6c, 0x68,
     0x37, 0x39, 0x35, 0x33, 0x32, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa0, 0x00, 0x00, 0x00, 0x20, 0x06, 0x00, 0x00,
+    0xa1, 0x00, 0x00, 0x00, 0x20, 0x06, 0x00, 0x00,
     0x73, 0x6d, 0x64, 0x6b, 0x36, 0x34, 0x31, 0x30,
     0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa1, 0x00, 0x00, 0x00, 0x40, 0x06, 0x00, 0x00,
+    0xa2, 0x00, 0x00, 0x00, 0x40, 0x06, 0x00, 0x00,
     0x73, 0x6d, 0x70, 0x38, 0x36, 0x33, 0x34, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa2, 0x00, 0x00, 0x00, 0x60, 0x06, 0x00, 0x00,
+    0xa3, 0x00, 0x00, 0x00, 0x60, 0x06, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa3, 0x00, 0x00, 0x00, 0x80, 0x06, 0x00, 0x00,
+    0xa4, 0x00, 0x00, 0x00, 0x80, 0x06, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x73, 0x74, 0x69,
     0x63, 0x6b, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa4, 0x00, 0x00, 0x00, 0xa0, 0x06, 0x00, 0x00,
+    0xa5, 0x00, 0x00, 0x00, 0xa0, 0x06, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x37, 0x31, 0x30, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa5, 0x00, 0x00, 0x00, 0xc0, 0x06, 0x00, 0x00,
+    0xa6, 0x00, 0x00, 0x00, 0xc0, 0x06, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x37, 0x33, 0x30, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa6, 0x00, 0x00, 0x00, 0xe0, 0x06, 0x00, 0x00,
+    0xa7, 0x00, 0x00, 0x00, 0xe0, 0x06, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x37, 0x35, 0x30, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa7, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00,
+    0xa8, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x39, 0x31, 0x30, 0x2d, 0x65,
     0x76, 0x61, 0x6c, 0x2e, 0x63, 0x66, 0x67, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa8, 0x00, 0x00, 0x00, 0x20, 0x07, 0x00, 0x00,
+    0xa9, 0x00, 0x00, 0x00, 0x20, 0x07, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x39, 0x31, 0x32, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xa9, 0x00, 0x00, 0x00, 0x40, 0x07, 0x00, 0x00,
+    0xaa, 0x00, 0x00, 0x00, 0x40, 0x07, 0x00, 0x00,
     0x73, 0x74, 0x72, 0x39, 0x63, 0x6f, 0x6d, 0x73,
     0x74, 0x69, 0x63, 0x6b, 0x2e, 0x63, 0x66, 0x67,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xaa, 0x00, 0x00, 0x00, 0x80, 0x07, 0x00, 0x00,
+    0xab, 0x00, 0x00, 0x00, 0x80, 0x07, 0x00, 0x00,
     0x74, 0x65, 0x73, 0x74, 0x5f, 0x72, 0x65, 0x73,
     0x65, 0x74, 0x5f, 0x73, 0x79, 0x6e, 0x74, 0x61,
     0x78, 0x5f, 0x65, 0x72, 0x72, 0x6f, 0x72, 0x2e,
@@ -1557,19 +1573,27 @@
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xab, 0x00, 0x00, 0x00, 0xa0, 0x07, 0x00, 0x00,
+    0xac, 0x00, 0x00, 0x00, 0xa0, 0x07, 0x00, 0x00,
     0x74, 0x65, 0x73, 0x74, 0x5f, 0x73, 0x79, 0x6e,
     0x74, 0x61, 0x78, 0x5f, 0x65, 0x72, 0x72, 0x6f,
     0x72, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
-    0xac, 0x00, 0x00, 0x00, 0xc0, 0x07, 0x00, 0x00,
+    0xad, 0x00, 0x00, 0x00, 0xc0, 0x07, 0x00, 0x00,
+    0x74, 0x69, 0x5f, 0x64, 0x6d, 0x33, 0x35, 0x35,
+    0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0xae, 0x00, 0x00, 0x00, 0xe0, 0x07, 0x00, 0x00,
+    0x74, 0x69, 0x5f, 0x64, 0x6d, 0x36, 0x34, 0x34,
+    0x36, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0xaf, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00,
     0x77, 0x69, 0x2d, 0x39, 0x63, 0x2e, 0x63, 0x66,
     0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xad, 0x00, 0x00, 0x00, 0xe0, 0x07, 0x00, 0x00,
+    0xb0, 0x00, 0x00, 0x00, 0x20, 0x08, 0x00, 0x00,
     0x78, 0x62, 0x61, 0x5f, 0x72, 0x65, 0x76, 0x41,
     0x33, 0x2e, 0x63, 0x66, 0x67, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xae, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00,
+    0xb1, 0x00, 0x00, 0x00, 0x40, 0x08, 0x00, 0x00,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x2e, 0x63,
     0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1581,27 +1605,27 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xaf, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xb2, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x62, 0x69, 0x74, 0x73, 0x62, 0x79, 0x74, 0x65,
     0x73, 0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb0, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0xb3, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x63, 0x68, 0x69, 0x70, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb1, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0xb4, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x63, 0x70, 0x75, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb2, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
+    0xb5, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
     0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb3, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0xb6, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
     0x6d, 0x6d, 0x72, 0x5f, 0x68, 0x65, 0x6c, 0x70,
     0x65, 0x72, 0x73, 0x2e, 0x74, 0x63, 0x6c, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb4, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
+    0xb7, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
     0x72, 0x65, 0x61, 0x64, 0x61, 0x62, 0x6c, 0x65,
     0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1613,7 +1637,7 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc8, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xcb, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x73, 0x79, 0x6e, 0x74, 0x61, 0x78, 0x31, 0x2e,
     0x63, 0x66, 0x67, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1625,11 +1649,11 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc9, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xcc, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x64, 0x65, 0x62, 0x75, 0x67, 0x5f, 0x68, 0x61,
     0x6e, 0x64, 0x6c, 0x65, 0x72, 0x2e, 0x62, 0x69,
     0x6e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb0, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0xb3, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1637,15 +1661,15 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb5, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xb8, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x6d, 0x65, 0x6c, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb6, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0xb9, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb1, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0xb4, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -1653,111 +1677,111 @@
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc2, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xc5, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb5, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0xb8, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb0, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0xb3, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb7, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xba, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb6, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0xb9, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb0, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0xb3, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xbe, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xc1, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb7, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0xba, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb5, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0xb8, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb8, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xbb, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x69, 0x63, 0x2e, 0x74, 0x63, 0x6c, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb9, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0xbc, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x73, 0x61, 0x6d, 0x37,
     0x78, 0x31, 0x32, 0x38, 0x2e, 0x74, 0x63, 0x6c,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xba, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0xbd, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x61, 0x74, 0x39, 0x31, 0x73, 0x61, 0x6d, 0x37,
     0x78, 0x32, 0x35, 0x36, 0x2e, 0x74, 0x63, 0x6c,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xbb, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
+    0xbe, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
     0x70, 0x6d, 0x63, 0x2e, 0x74, 0x63, 0x6c, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xbc, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0xbf, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
     0x72, 0x74, 0x74, 0x2e, 0x74, 0x63, 0x6c, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xbd, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
+    0xc0, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
     0x75, 0x73, 0x61, 0x72, 0x74, 0x73, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xbe, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0xc1, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb6, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0xb9, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xbf, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xc2, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x2e, 0x74, 0x63,
     0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc0, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0xc3, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x5f, 0x72, 0x63,
     0x63, 0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc1, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0xc4, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x73, 0x74, 0x6d, 0x33, 0x32, 0x5f, 0x72, 0x65,
     0x67, 0x73, 0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc2, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
+    0xc5, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xb1, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
+    0xb4, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
     0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc3, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
+    0xc6, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x37, 0x74, 0x64, 0x6d, 0x69,
     0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc4, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
+    0xc7, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x39, 0x32, 0x30, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc5, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
+    0xc8, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x39, 0x34, 0x36, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc6, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
+    0xc9, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00,
     0x61, 0x72, 0x6d, 0x39, 0x36, 0x36, 0x2e, 0x74,
     0x63, 0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0xc7, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
+    0xca, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00, 0x00,
     0x63, 0x6f, 0x72, 0x74, 0x65, 0x78, 0x5f, 0x6d,
     0x33, 0x2e, 0x74, 0x63, 0x6c, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
@@ -6483,8 +6507,7 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -8146,9 +8169,6 @@
     0x24, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x0d,
     0x0a, 0x65, 0x6e, 0x64, 0x5f, 0x63, 0x68, 0x75,
     0x6e, 0x6b, 0x65, 0x64, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -8269,8 +8289,7 @@
     0x74, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x22, 0x3e,
     0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
-    0x75, 0x72, 0x65, 0x20, 0x7a, 0x79, 0x31, 0x30,
+    0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30,
     0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73, 0x69,
     0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
@@ -9545,6 +9564,7 @@
     0x6e, 0x64, 0x5f, 0x63, 0x68, 0x75, 0x6e, 0x6b,
     0x65, 0x64, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -9654,8 +9674,7 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -11309,6 +11328,7 @@
     0x6e, 0x64, 0x5f, 0x63, 0x68, 0x75, 0x6e, 0x6b,
     0x65, 0x64, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -11436,7 +11456,6 @@
     0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
-    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
     0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
@@ -12833,6 +12852,7 @@
     0x66, 0x66, 0x65, 0x72, 0x0d, 0x0a, 0x65, 0x6e,
     0x64, 0x5f, 0x63, 0x68, 0x75, 0x6e, 0x6b, 0x65,
     0x64, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -12949,8 +12969,7 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -14305,6 +14324,7 @@
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x0d, 0x0a,
     0x65, 0x6e, 0x64, 0x5f, 0x63, 0x68, 0x75, 0x6e,
     0x6b, 0x65, 0x64, 0x0d, 0x0a, 0x0d, 0x0a, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x77, 0x72, 0x69, 0x74, 0x65, 0x66, 0x6f, 0x72,
     0x6d, 0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x66,
     0x69, 0x6c, 0x65, 0x63, 0x6f, 0x6e, 0x74, 0x65,
@@ -14439,7 +14459,6 @@
     0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
-    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
     0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
@@ -16137,6 +16156,7 @@
     0x6e, 0x6b, 0x65, 0x64, 0x0d, 0x0a, 0x0d, 0x0a,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -16250,8 +16270,7 @@
     0x69, 0x67, 0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a,
     0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
-    0x65, 0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
+    0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
     0x5f, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e,
     0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
@@ -17613,6 +17632,7 @@
     0x0a, 0x65, 0x6e, 0x64, 0x5f, 0x63, 0x68, 0x75,
     0x6e, 0x6b, 0x65, 0x64, 0x0d, 0x0a, 0x0d, 0x0a,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a,
     0x00, 0x00, 0x00, 0x0d, 0x49, 0x48, 0x44, 0x52,
     0x00, 0x00, 0x00, 0xc8, 0x00, 0x00, 0x00, 0x7e,
@@ -20989,8 +21009,7 @@
     0x74, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x22, 0x3e,
     0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
-    0x75, 0x72, 0x65, 0x20, 0x7a, 0x79, 0x31, 0x30,
+    0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30,
     0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73, 0x69,
     0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
@@ -22381,6 +22400,7 @@
     0x65, 0x72, 0x0d, 0x0a, 0x65, 0x6e, 0x64, 0x5f,
     0x63, 0x68, 0x75, 0x6e, 0x6b, 0x65, 0x64, 0x0d,
     0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -22488,8 +22508,7 @@
     0x69, 0x67, 0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a,
     0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
-    0x65, 0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
+    0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
     0x5f, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e,
     0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
@@ -23125,185 +23144,148 @@
     0x09, 0x3c, 0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
-    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63,
-    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7b,
-    0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
-    0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x7a,
-    0x79, 0x31, 0x30, 0x30, 0x30, 0x7d, 0x5d, 0x0d,
-    0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
-    0x3c, 0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x61,
-    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7b, 0x7a,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a,
     0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65,
-    0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x7d, 0x5d, 0x0d,
-    0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
-    0x3c, 0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x61,
+    0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x7a, 0x79,
+    0x31, 0x30, 0x30, 0x30, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7b, 0x7a,
-    0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65,
-    0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x64, 0x61,
-    0x74, 0x65, 0x7d, 0x5d, 0x0d, 0x0a, 0x61, 0x70,
-    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x7b, 0x3c, 0x62, 0x72,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x5b, 0x69, 0x70, 0x5d, 0x0d, 0x0a,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x3c, 0x62,
+    0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
+    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
+    0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30,
+    0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73, 0x69,
+    0x6f, 0x6e, 0x20, 0x6f, 0x70, 0x65, 0x6e, 0x6f,
+    0x63, 0x64, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
+    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
+    0x65, 0x72, 0x20, 0x7b, 0x3c, 0x62, 0x72, 0x3e,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
+    0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
+    0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
+    0x5f, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e,
+    0x20, 0x64, 0x61, 0x74, 0x65, 0x5d, 0x0d, 0x0a,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
     0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x3c,
     0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x61, 0x70,
     0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f, 0x63, 0x64,
-    0x5f, 0x67, 0x64, 0x62, 0x5f, 0x70, 0x6f, 0x72,
-    0x74, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x74,
-    0x64, 0x3e, 0x3c, 0x69, 0x6d, 0x67, 0x20, 0x73,
-    0x72, 0x63, 0x3d, 0x22, 0x2f, 0x72, 0x61, 0x6d,
-    0x2f, 0x63, 0x67, 0x69, 0x2f, 0x66, 0x72, 0x6f,
-    0x6e, 0x74, 0x5f, 0x6a, 0x74, 0x61, 0x67, 0x32,
-    0x30, 0x5f, 0x33, 0x5f, 0x32, 0x30, 0x30, 0x2e,
-    0x70, 0x6e, 0x67, 0x22, 0x3e, 0x3c, 0x2f, 0x74,
-    0x64, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x66, 0x65, 0x72, 0x20, 0x5b, 0x69, 0x70, 0x5d,
+    0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
+    0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
+    0x7b, 0x3c, 0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a,
+    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x6f,
+    0x63, 0x64, 0x5f, 0x67, 0x64, 0x62, 0x5f, 0x70,
+    0x6f, 0x72, 0x74, 0x5d, 0x0d, 0x0a, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x3c, 0x2f, 0x74, 0x64,
+    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x3c, 0x74, 0x64, 0x3e, 0x3c, 0x69, 0x6d, 0x67,
+    0x20, 0x73, 0x72, 0x63, 0x3d, 0x22, 0x2f, 0x72,
+    0x61, 0x6d, 0x2f, 0x63, 0x67, 0x69, 0x2f, 0x66,
+    0x72, 0x6f, 0x6e, 0x74, 0x5f, 0x6a, 0x74, 0x61,
+    0x67, 0x32, 0x30, 0x5f, 0x33, 0x5f, 0x32, 0x30,
+    0x30, 0x2e, 0x70, 0x6e, 0x67, 0x22, 0x3e, 0x3c,
+    0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x3c, 0x2f, 0x74, 0x61,
+    0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x3c, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x74, 0x72,
+    0x3e, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79,
+    0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65, 0x69, 0x67,
+    0x68, 0x74, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b,
+    0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x35, 0x33,
+    0x35, 0x70, 0x78, 0x3b, 0x22, 0x3e, 0x26, 0x6e,
+    0x62, 0x73, 0x70, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
     0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c,
-    0x65, 0x3e, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c, 0x74,
-    0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x3c, 0x74, 0x72, 0x3e, 0x3c,
     0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
     0x3d, 0x22, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74,
-    0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x77, 0x69,
+    0x3a, 0x31, 0x70, 0x78, 0x3b, 0x77, 0x69, 0x64,
+    0x74, 0x68, 0x3a, 0x35, 0x33, 0x35, 0x70, 0x78,
+    0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f,
+    0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f,
+    0x72, 0x3a, 0x23, 0x61, 0x32, 0x63, 0x35, 0x64,
+    0x31, 0x3b, 0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64,
+    0x3e, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x3c, 0x74, 0x72, 0x3e,
+    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x68, 0x65, 0x69, 0x67, 0x68,
+    0x74, 0x3a, 0x35, 0x70, 0x78, 0x3b, 0x77, 0x69,
     0x64, 0x74, 0x68, 0x3a, 0x35, 0x33, 0x35, 0x70,
     0x78, 0x3b, 0x22, 0x3e, 0x26, 0x6e, 0x62, 0x73,
     0x70, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f,
     0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74, 0x64,
-    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
-    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31,
-    0x70, 0x78, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3a, 0x35, 0x33, 0x35, 0x70, 0x78, 0x3b, 0x62,
-    0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e,
-    0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a,
-    0x23, 0x61, 0x32, 0x63, 0x35, 0x64, 0x31, 0x3b,
-    0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c,
-    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74,
-    0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
-    0x35, 0x70, 0x78, 0x3b, 0x77, 0x69, 0x64, 0x74,
-    0x68, 0x3a, 0x35, 0x33, 0x35, 0x70, 0x78, 0x3b,
-    0x22, 0x3e, 0x26, 0x6e, 0x62, 0x73, 0x70, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f, 0x74, 0x72,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c, 0x2f,
-    0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c, 0x48, 0x31,
-    0x3e, 0x54, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20,
-    0x53, 0x74, 0x61, 0x74, 0x75, 0x73, 0x3c, 0x2f,
-    0x48, 0x31, 0x3e, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x3c, 0x74, 0x61, 0x62, 0x6c, 0x65,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x3c, 0x74, 0x64, 0x20, 0x63, 0x6c,
-    0x61, 0x73, 0x73, 0x3d, 0x22, 0x66, 0x6f, 0x6e,
-    0x74, 0x62, 0x69, 0x67, 0x67, 0x65, 0x72, 0x22,
-    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
-    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x32,
-    0x30, 0x70, 0x78, 0x3b, 0x70, 0x61, 0x64, 0x64,
-    0x69, 0x6e, 0x67, 0x2d, 0x72, 0x69, 0x67, 0x68,
-    0x74, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x22,
-    0x3e, 0x54, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20,
-    0x70, 0x6f, 0x77, 0x65, 0x72, 0x3a, 0x20, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b, 0x70,
-    0x6f, 0x77, 0x65, 0x72, 0x73, 0x74, 0x61, 0x74,
-    0x75, 0x73, 0x5d, 0x21, 0x3d, 0x30, 0x7d, 0x20,
-    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
-    0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
-    0x22, 0x6e, 0x6f, 0x22, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x7d, 0x20, 0x65, 0x6c,
-    0x73, 0x65, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
+    0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c,
+    0x48, 0x31, 0x3e, 0x54, 0x61, 0x72, 0x67, 0x65,
+    0x74, 0x20, 0x53, 0x74, 0x61, 0x74, 0x75, 0x73,
+    0x3c, 0x2f, 0x48, 0x31, 0x3e, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x3c, 0x74, 0x61, 0x62,
+    0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x3c, 0x74, 0x64, 0x20,
+    0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x66,
+    0x6f, 0x6e, 0x74, 0x62, 0x69, 0x67, 0x67, 0x65,
+    0x72, 0x22, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
+    0x3d, 0x22, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74,
+    0x3a, 0x32, 0x30, 0x70, 0x78, 0x3b, 0x70, 0x61,
+    0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d, 0x72, 0x69,
+    0x67, 0x68, 0x74, 0x3a, 0x31, 0x30, 0x70, 0x78,
+    0x3b, 0x22, 0x3e, 0x54, 0x61, 0x72, 0x67, 0x65,
+    0x74, 0x20, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x3a,
+    0x20, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b,
+    0x5b, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x73, 0x74,
+    0x61, 0x74, 0x75, 0x73, 0x5d, 0x21, 0x3d, 0x30,
+    0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
+    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
+    0x72, 0x20, 0x22, 0x6e, 0x6f, 0x22, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x20,
+    0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x61,
+    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x22, 0x79, 0x65,
+    0x73, 0x22, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x22, 0x79, 0x65, 0x73, 0x22,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
-    0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x3c, 0x2f, 0x74, 0x72,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c,
+    0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x2f,
     0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x3c, 0x74, 0x64, 0x20, 0x63, 0x6c,
-    0x61, 0x73, 0x73, 0x3d, 0x22, 0x66, 0x6f, 0x6e,
-    0x74, 0x62, 0x69, 0x67, 0x67, 0x65, 0x72, 0x22,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x73, 0x65, 0x74,
-    0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x64,
-    0x64, 0x72, 0x65, 0x73, 0x73, 0x20, 0x5b, 0x66,
-    0x6f, 0x72, 0x6d, 0x66, 0x65, 0x74, 0x63, 0x68,
-    0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x64,
-    0x64, 0x72, 0x65, 0x73, 0x73, 0x5d, 0x0d, 0x0a,
+    0x09, 0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x3c, 0x74, 0x64, 0x20,
+    0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x66,
+    0x6f, 0x6e, 0x74, 0x62, 0x69, 0x67, 0x67, 0x65,
+    0x72, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x73,
     0x65, 0x74, 0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f,
-    0x61, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x5b,
-    0x66, 0x6f, 0x72, 0x6d, 0x66, 0x65, 0x74, 0x63,
-    0x68, 0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61,
-    0x63, 0x74, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72,
-    0x69, 0x6e, 0x67, 0x20, 0x63, 0x6f, 0x6d, 0x70,
-    0x61, 0x72, 0x65, 0x20, 0x24, 0x66, 0x6f, 0x72,
+    0x61, 0x64, 0x64, 0x72, 0x65, 0x73, 0x73, 0x20,
+    0x5b, 0x66, 0x6f, 0x72, 0x6d, 0x66, 0x65, 0x74,
+    0x63, 0x68, 0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f,
+    0x61, 0x64, 0x64, 0x72, 0x65, 0x73, 0x73, 0x5d,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x73, 0x65, 0x74, 0x20, 0x66, 0x6f, 0x72,
     0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69, 0x6f, 0x6e,
-    0x20, 0x22, 0x48, 0x61, 0x6c, 0x74, 0x22, 0x5d,
-    0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63,
-    0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b,
-    0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b,
-    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x5f,
-    0x63, 0x61, 0x74, 0x63, 0x68, 0x20, 0x22, 0x68,
-    0x61, 0x6c, 0x74, 0x22, 0x5d, 0x5d, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d,
+    0x20, 0x5b, 0x66, 0x6f, 0x72, 0x6d, 0x66, 0x65,
+    0x74, 0x63, 0x68, 0x20, 0x66, 0x6f, 0x72, 0x6d,
+    0x5f, 0x61, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x5d,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74,
-    0x72, 0x69, 0x6e, 0x67, 0x20, 0x63, 0x6f, 0x6d,
-    0x70, 0x61, 0x72, 0x65, 0x20, 0x24, 0x66, 0x6f,
-    0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69, 0x6f,
-    0x6e, 0x20, 0x22, 0x52, 0x65, 0x73, 0x75, 0x6d,
-    0x65, 0x22, 0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20,
-    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
-    0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c,
-    0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64,
-    0x65, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75,
-    0x72, 0x65, 0x5f, 0x63, 0x61, 0x74, 0x63, 0x68,
-    0x20, 0x22, 0x72, 0x65, 0x73, 0x75, 0x6d, 0x65,
-    0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x20,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74,
-    0x72, 0x69, 0x6e, 0x67, 0x20, 0x63, 0x6f, 0x6d,
-    0x70, 0x61, 0x72, 0x65, 0x20, 0x24, 0x66, 0x6f,
-    0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69, 0x6f,
-    0x6e, 0x20, 0x22, 0x52, 0x65, 0x73, 0x65, 0x74,
-    0x20, 0x61, 0x6e, 0x64, 0x20, 0x72, 0x75, 0x6e,
+    0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73,
+    0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x63, 0x6f,
+    0x6d, 0x70, 0x61, 0x72, 0x65, 0x20, 0x24, 0x66,
+    0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69,
+    0x6f, 0x6e, 0x20, 0x22, 0x48, 0x61, 0x6c, 0x74,
     0x22, 0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
@@ -23311,33 +23293,50 @@
     0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65,
     0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
     0x65, 0x5f, 0x63, 0x61, 0x74, 0x63, 0x68, 0x20,
-    0x22, 0x72, 0x65, 0x73, 0x65, 0x74, 0x20, 0x72,
-    0x75, 0x6e, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x22, 0x68, 0x61, 0x6c, 0x74, 0x22, 0x5d, 0x5d,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74,
-    0x72, 0x69, 0x6e, 0x67, 0x20, 0x63, 0x6f, 0x6d,
-    0x70, 0x61, 0x72, 0x65, 0x20, 0x24, 0x66, 0x6f,
-    0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69, 0x6f,
-    0x6e, 0x20, 0x22, 0x52, 0x65, 0x6c, 0x61, 0x79,
-    0x20, 0x6f, 0x6e, 0x22, 0x5d, 0x3d, 0x3d, 0x30,
+    0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b,
+    0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x63,
+    0x6f, 0x6d, 0x70, 0x61, 0x72, 0x65, 0x20, 0x24,
+    0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74,
+    0x69, 0x6f, 0x6e, 0x20, 0x22, 0x52, 0x65, 0x73,
+    0x75, 0x6d, 0x65, 0x22, 0x5d, 0x3d, 0x3d, 0x30,
     0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73,
     0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63,
     0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70,
     0x74, 0x75, 0x72, 0x65, 0x5f, 0x63, 0x61, 0x74,
-    0x63, 0x68, 0x20, 0x22, 0x70, 0x6f, 0x77, 0x65,
-    0x72, 0x20, 0x6f, 0x6e, 0x22, 0x5d, 0x5d, 0x0d,
+    0x63, 0x68, 0x20, 0x22, 0x72, 0x65, 0x73, 0x75,
+    0x6d, 0x65, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x20, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b,
+    0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x63,
+    0x6f, 0x6d, 0x70, 0x61, 0x72, 0x65, 0x20, 0x24,
+    0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74,
+    0x69, 0x6f, 0x6e, 0x20, 0x22, 0x52, 0x65, 0x73,
+    0x65, 0x74, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x72,
+    0x75, 0x6e, 0x22, 0x5d, 0x3d, 0x3d, 0x30, 0x7d,
+    0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
+    0x6e, 0x64, 0x20, 0x63, 0x6f, 0x6e, 0x73, 0x6f,
+    0x6c, 0x65, 0x20, 0x5b, 0x65, 0x6e, 0x63, 0x6f,
+    0x64, 0x65, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
+    0x75, 0x72, 0x65, 0x5f, 0x63, 0x61, 0x74, 0x63,
+    0x68, 0x20, 0x22, 0x72, 0x65, 0x73, 0x65, 0x74,
+    0x20, 0x72, 0x75, 0x6e, 0x22, 0x5d, 0x5d, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73,
-    0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x63, 0x6f,
-    0x6d, 0x70, 0x61, 0x72, 0x65, 0x20, 0x24, 0x66,
-    0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69,
-    0x6f, 0x6e, 0x20, 0x22, 0x52, 0x65, 0x6c, 0x61,
-    0x79, 0x20, 0x6f, 0x66, 0x66, 0x22, 0x5d, 0x3d,
+    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b,
+    0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x63,
+    0x6f, 0x6d, 0x70, 0x61, 0x72, 0x65, 0x20, 0x24,
+    0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74,
+    0x69, 0x6f, 0x6e, 0x20, 0x22, 0x52, 0x65, 0x6c,
+    0x61, 0x79, 0x20, 0x6f, 0x6e, 0x22, 0x5d, 0x3d,
     0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f,
@@ -23345,44 +23344,99 @@
     0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63,
     0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x5f, 0x63,
     0x61, 0x74, 0x63, 0x68, 0x20, 0x22, 0x70, 0x6f,
-    0x77, 0x65, 0x72, 0x20, 0x6f, 0x66, 0x66, 0x22,
-    0x5d, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70,
-    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x61,
-    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x63, 0x6f,
-    0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20, 0x5b, 0x65,
-    0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x5b, 0x63,
-    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x5f, 0x63,
-    0x61, 0x74, 0x63, 0x68, 0x20, 0x70, 0x6f, 0x6c,
-    0x6c, 0x5d, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
-    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x2f,
+    0x77, 0x65, 0x72, 0x20, 0x6f, 0x6e, 0x22, 0x5d,
+    0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b,
+    0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20,
+    0x63, 0x6f, 0x6d, 0x70, 0x61, 0x72, 0x65, 0x20,
+    0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63,
+    0x74, 0x69, 0x6f, 0x6e, 0x20, 0x22, 0x52, 0x65,
+    0x6c, 0x61, 0x79, 0x20, 0x6f, 0x66, 0x66, 0x22,
+    0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
+    0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20,
+    0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20,
+    0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65,
+    0x5f, 0x63, 0x61, 0x74, 0x63, 0x68, 0x20, 0x22,
+    0x70, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x6f, 0x66,
+    0x66, 0x22, 0x5d, 0x5d, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a,
+    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d,
+    0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
+    0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65, 0x20,
+    0x5b, 0x65, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x20,
+    0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65,
+    0x5f, 0x63, 0x61, 0x74, 0x63, 0x68, 0x20, 0x70,
+    0x6f, 0x6c, 0x6c, 0x5d, 0x5d, 0x0d, 0x0a, 0x61,
+    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x2f, 0x74,
+    0x64, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c,
+    0x65, 0x3e, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x3c, 0x66, 0x6f, 0x72, 0x6d, 0x20, 0x61,
+    0x63, 0x74, 0x69, 0x6f, 0x6e, 0x3d, 0x22, 0x2f,
+    0x72, 0x61, 0x6d, 0x2f, 0x63, 0x67, 0x69, 0x2f,
+    0x69, 0x6e, 0x64, 0x65, 0x78, 0x2e, 0x74, 0x63,
+    0x6c, 0x22, 0x20, 0x6d, 0x65, 0x74, 0x68, 0x6f,
+    0x64, 0x3d, 0x22, 0x70, 0x6f, 0x73, 0x74, 0x22,
+    0x3e, 0x20, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x3c, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x3c,
     0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c,
-    0x66, 0x6f, 0x72, 0x6d, 0x20, 0x61, 0x63, 0x74,
-    0x69, 0x6f, 0x6e, 0x3d, 0x22, 0x2f, 0x72, 0x61,
-    0x6d, 0x2f, 0x63, 0x67, 0x69, 0x2f, 0x69, 0x6e,
-    0x64, 0x65, 0x78, 0x2e, 0x74, 0x63, 0x6c, 0x22,
-    0x20, 0x6d, 0x65, 0x74, 0x68, 0x6f, 0x64, 0x3d,
-    0x22, 0x70, 0x6f, 0x73, 0x74, 0x22, 0x3e, 0x20,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x74,
-    0x61, 0x62, 0x6c, 0x65, 0x3e, 0x3c, 0x74, 0x72,
+    0x09, 0x09, 0x3c, 0x74, 0x64, 0x3e, 0x3c, 0x69,
+    0x6e, 0x70, 0x75, 0x74, 0x20, 0x74, 0x79, 0x70,
+    0x65, 0x3d, 0x22, 0x73, 0x75, 0x62, 0x6d, 0x69,
+    0x74, 0x22, 0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d,
+    0x22, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63,
+    0x74, 0x69, 0x6f, 0x6e, 0x22, 0x20, 0x76, 0x61,
+    0x6c, 0x75, 0x65, 0x3d, 0x22, 0x52, 0x65, 0x73,
+    0x65, 0x74, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x72,
+    0x75, 0x6e, 0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64,
     0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x3c, 0x74, 0x64, 0x3e, 0x3c, 0x69, 0x6e, 0x70,
-    0x75, 0x74, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3d,
-    0x22, 0x73, 0x75, 0x62, 0x6d, 0x69, 0x74, 0x22,
-    0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22, 0x66,
-    0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69,
-    0x6f, 0x6e, 0x22, 0x20, 0x76, 0x61, 0x6c, 0x75,
-    0x65, 0x3d, 0x22, 0x52, 0x65, 0x73, 0x65, 0x74,
-    0x20, 0x61, 0x6e, 0x64, 0x20, 0x72, 0x75, 0x6e,
+    0x3c, 0x74, 0x64, 0x20, 0x63, 0x6c, 0x61, 0x73,
+    0x73, 0x3d, 0x22, 0x62, 0x75, 0x74, 0x74, 0x6f,
+    0x6e, 0x73, 0x70, 0x61, 0x63, 0x65, 0x73, 0x6d,
+    0x61, 0x6c, 0x6c, 0x22, 0x3e, 0x3c, 0x2f, 0x74,
+    0x64, 0x3e, 0x3c, 0x74, 0x64, 0x3e, 0x3c, 0x69,
+    0x6e, 0x70, 0x75, 0x74, 0x20, 0x74, 0x79, 0x70,
+    0x65, 0x3d, 0x22, 0x73, 0x75, 0x62, 0x6d, 0x69,
+    0x74, 0x22, 0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d,
+    0x22, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63,
+    0x74, 0x69, 0x6f, 0x6e, 0x22, 0x20, 0x76, 0x61,
+    0x6c, 0x75, 0x65, 0x3d, 0x22, 0x48, 0x61, 0x6c,
+    0x74, 0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c,
+    0x74, 0x64, 0x20, 0x63, 0x6c, 0x61, 0x73, 0x73,
+    0x3d, 0x22, 0x62, 0x75, 0x74, 0x74, 0x6f, 0x6e,
+    0x73, 0x70, 0x61, 0x63, 0x65, 0x73, 0x6d, 0x61,
+    0x6c, 0x6c, 0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64,
+    0x3e, 0x3c, 0x74, 0x64, 0x3e, 0x3c, 0x69, 0x6e,
+    0x70, 0x75, 0x74, 0x20, 0x74, 0x79, 0x70, 0x65,
+    0x3d, 0x22, 0x73, 0x75, 0x62, 0x6d, 0x69, 0x74,
+    0x22, 0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22,
+    0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74,
+    0x69, 0x6f, 0x6e, 0x22, 0x20, 0x76, 0x61, 0x6c,
+    0x75, 0x65, 0x3d, 0x22, 0x52, 0x65, 0x73, 0x75,
+    0x6d, 0x65, 0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64,
+    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x77, 0x69, 0x64, 0x74, 0x68,
+    0x3a, 0x35, 0x30, 0x70, 0x78, 0x3b, 0x22, 0x3e,
+    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x74, 0x64,
+    0x3e, 0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74, 0x20,
+    0x74, 0x79, 0x70, 0x65, 0x3d, 0x22, 0x73, 0x75,
+    0x62, 0x6d, 0x69, 0x74, 0x22, 0x20, 0x6e, 0x61,
+    0x6d, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x72, 0x6d,
+    0x5f, 0x61, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x22,
+    0x20, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x3d, 0x22,
+    0x52, 0x65, 0x6c, 0x61, 0x79, 0x20, 0x6f, 0x6e,
     0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x74,
     0x64, 0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d,
@@ -23395,587 +23449,502 @@
     0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22, 0x66,
     0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69,
     0x6f, 0x6e, 0x22, 0x20, 0x76, 0x61, 0x6c, 0x75,
-    0x65, 0x3d, 0x22, 0x48, 0x61, 0x6c, 0x74, 0x22,
-    0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x74, 0x64,
-    0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22,
-    0x62, 0x75, 0x74, 0x74, 0x6f, 0x6e, 0x73, 0x70,
-    0x61, 0x63, 0x65, 0x73, 0x6d, 0x61, 0x6c, 0x6c,
-    0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c,
-    0x74, 0x64, 0x3e, 0x3c, 0x69, 0x6e, 0x70, 0x75,
-    0x74, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3d, 0x22,
-    0x73, 0x75, 0x62, 0x6d, 0x69, 0x74, 0x22, 0x20,
-    0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22, 0x66, 0x6f,
-    0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69, 0x6f,
-    0x6e, 0x22, 0x20, 0x76, 0x61, 0x6c, 0x75, 0x65,
-    0x3d, 0x22, 0x52, 0x65, 0x73, 0x75, 0x6d, 0x65,
-    0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x74,
-    0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x35,
-    0x30, 0x70, 0x78, 0x3b, 0x22, 0x3e, 0x3c, 0x2f,
-    0x74, 0x64, 0x3e, 0x3c, 0x74, 0x64, 0x3e, 0x3c,
-    0x69, 0x6e, 0x70, 0x75, 0x74, 0x20, 0x74, 0x79,
-    0x70, 0x65, 0x3d, 0x22, 0x73, 0x75, 0x62, 0x6d,
-    0x69, 0x74, 0x22, 0x20, 0x6e, 0x61, 0x6d, 0x65,
-    0x3d, 0x22, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61,
-    0x63, 0x74, 0x69, 0x6f, 0x6e, 0x22, 0x20, 0x76,
-    0x61, 0x6c, 0x75, 0x65, 0x3d, 0x22, 0x52, 0x65,
-    0x6c, 0x61, 0x79, 0x20, 0x6f, 0x6e, 0x22, 0x3e,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x3c, 0x74, 0x64, 0x20,
-    0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x62,
-    0x75, 0x74, 0x74, 0x6f, 0x6e, 0x73, 0x70, 0x61,
-    0x63, 0x65, 0x73, 0x6d, 0x61, 0x6c, 0x6c, 0x22,
-    0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x74,
-    0x64, 0x3e, 0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74,
+    0x65, 0x3d, 0x22, 0x52, 0x65, 0x6c, 0x61, 0x79,
+    0x20, 0x6f, 0x66, 0x66, 0x22, 0x3e, 0x3c, 0x2f,
+    0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x3c, 0x2f,
+    0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x62,
+    0x72, 0x3e, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x62,
+    0x72, 0x3e, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74,
     0x20, 0x74, 0x79, 0x70, 0x65, 0x3d, 0x22, 0x73,
     0x75, 0x62, 0x6d, 0x69, 0x74, 0x22, 0x20, 0x6e,
     0x61, 0x6d, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x72,
     0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69, 0x6f, 0x6e,
     0x22, 0x20, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x3d,
-    0x22, 0x52, 0x65, 0x6c, 0x61, 0x79, 0x20, 0x6f,
-    0x66, 0x66, 0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64,
+    0x22, 0x52, 0x65, 0x62, 0x6f, 0x6f, 0x74, 0x20,
+    0x5a, 0x59, 0x31, 0x30, 0x30, 0x30, 0x22, 0x3e,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x70,
     0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x2f, 0x74, 0x72, 0x3e, 0x3c, 0x2f, 0x74, 0x61,
-    0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x3c, 0x62, 0x72, 0x3e,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x3c, 0x62, 0x72, 0x3e,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74, 0x20, 0x74,
-    0x79, 0x70, 0x65, 0x3d, 0x22, 0x73, 0x75, 0x62,
-    0x6d, 0x69, 0x74, 0x22, 0x20, 0x6e, 0x61, 0x6d,
-    0x65, 0x3d, 0x22, 0x66, 0x6f, 0x72, 0x6d, 0x5f,
-    0x61, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x22, 0x20,
-    0x76, 0x61, 0x6c, 0x75, 0x65, 0x3d, 0x22, 0x52,
-    0x65, 0x62, 0x6f, 0x6f, 0x74, 0x20, 0x5a, 0x59,
-    0x31, 0x30, 0x30, 0x30, 0x22, 0x3e, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x3c, 0x70, 0x3e, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x61, 0x20,
-    0x68, 0x72, 0x65, 0x66, 0x3d, 0x22, 0x2f, 0x72,
-    0x61, 0x6d, 0x2f, 0x63, 0x67, 0x69, 0x2f, 0x74,
-    0x65, 0x72, 0x6d, 0x69, 0x6e, 0x61, 0x6c, 0x2e,
-    0x74, 0x63, 0x6c, 0x22, 0x20, 0x74, 0x61, 0x72,
-    0x67, 0x65, 0x74, 0x3d, 0x22, 0x5f, 0x62, 0x6c,
-    0x61, 0x6e, 0x6b, 0x22, 0x3e, 0x55, 0x41, 0x52,
-    0x54, 0x20, 0x66, 0x6f, 0x72, 0x77, 0x61, 0x72,
-    0x64, 0x69, 0x6e, 0x67, 0x3c, 0x2f, 0x61, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c, 0x2f, 0x66,
-    0x6f, 0x72, 0x6d, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73,
-    0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x63, 0x6f,
-    0x6d, 0x70, 0x61, 0x72, 0x65, 0x20, 0x24, 0x66,
-    0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63, 0x74, 0x69,
-    0x6f, 0x6e, 0x20, 0x22, 0x52, 0x65, 0x62, 0x6f,
-    0x6f, 0x74, 0x20, 0x5a, 0x59, 0x31, 0x30, 0x30,
-    0x30, 0x22, 0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20,
-    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x61, 0x20, 0x68, 0x72, 0x65, 0x66, 0x3d, 0x22,
+    0x2f, 0x72, 0x61, 0x6d, 0x2f, 0x63, 0x67, 0x69,
+    0x2f, 0x74, 0x65, 0x72, 0x6d, 0x69, 0x6e, 0x61,
+    0x6c, 0x2e, 0x74, 0x63, 0x6c, 0x22, 0x20, 0x74,
+    0x61, 0x72, 0x67, 0x65, 0x74, 0x3d, 0x22, 0x5f,
+    0x62, 0x6c, 0x61, 0x6e, 0x6b, 0x22, 0x3e, 0x55,
+    0x41, 0x52, 0x54, 0x20, 0x66, 0x6f, 0x72, 0x77,
+    0x61, 0x72, 0x64, 0x69, 0x6e, 0x67, 0x3c, 0x2f,
+    0x61, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c,
+    0x2f, 0x66, 0x6f, 0x72, 0x6d, 0x3e, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b,
+    0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20,
+    0x63, 0x6f, 0x6d, 0x70, 0x61, 0x72, 0x65, 0x20,
+    0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x61, 0x63,
+    0x74, 0x69, 0x6f, 0x6e, 0x20, 0x22, 0x52, 0x65,
+    0x62, 0x6f, 0x6f, 0x74, 0x20, 0x5a, 0x59, 0x31,
+    0x30, 0x30, 0x30, 0x22, 0x5d, 0x3d, 0x3d, 0x30,
+    0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
+    0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
+    0x22, 0x52, 0x65, 0x62, 0x6f, 0x6f, 0x74, 0x69,
+    0x6e, 0x67, 0x20, 0x5a, 0x59, 0x31, 0x30, 0x30,
+    0x30, 0x2e, 0x2e, 0x2e, 0x22, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x72, 0x65, 0x62, 0x6f,
+    0x6f, 0x74, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x0d, 0x0a,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
-    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x22, 0x52,
-    0x65, 0x62, 0x6f, 0x6f, 0x74, 0x69, 0x6e, 0x67,
-    0x20, 0x5a, 0x59, 0x31, 0x30, 0x30, 0x30, 0x2e,
-    0x2e, 0x2e, 0x22, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x72, 0x65, 0x62, 0x6f, 0x6f, 0x74,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70,
-    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x3c, 0x2f, 0x74, 0x64,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e,
-    0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c, 0x2f,
+    0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
+    0x72, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x73,
+    0x65, 0x74, 0x20, 0x74, 0x6f, 0x67, 0x67, 0x6c,
+    0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
+    0x73, 0x20, 0x5b, 0x66, 0x6f, 0x72, 0x6d, 0x66,
+    0x65, 0x74, 0x63, 0x68, 0x20, 0x74, 0x6f, 0x67,
+    0x67, 0x6c, 0x65, 0x5f, 0x64, 0x65, 0x74, 0x61,
+    0x69, 0x6c, 0x73, 0x5d, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x73, 0x65, 0x74,
-    0x20, 0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65, 0x5f,
-    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x20,
-    0x5b, 0x66, 0x6f, 0x72, 0x6d, 0x66, 0x65, 0x74,
-    0x63, 0x68, 0x20, 0x74, 0x6f, 0x67, 0x67, 0x6c,
-    0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x69, 0x66,
-    0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e,
-    0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68,
-    0x20, 0x24, 0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65,
+    0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72,
+    0x69, 0x6e, 0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67,
+    0x74, 0x68, 0x20, 0x24, 0x74, 0x6f, 0x67, 0x67,
+    0x6c, 0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69,
+    0x6c, 0x73, 0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20,
+    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x73, 0x65,
+    0x74, 0x20, 0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65,
     0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73,
-    0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0d,
+    0x20, 0x30, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x7d, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x20, 0x09, 0x73, 0x65, 0x74, 0x20, 0x73,
+    0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61,
+    0x69, 0x6c, 0x73, 0x20, 0x5b, 0x6c, 0x6f, 0x61,
+    0x64, 0x5f, 0x76, 0x61, 0x72, 0x20, 0x73, 0x68,
+    0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69,
+    0x6c, 0x73, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x69,
+    0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69,
+    0x6e, 0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74,
+    0x68, 0x20, 0x24, 0x73, 0x68, 0x6f, 0x77, 0x5f,
+    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x5d,
+    0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x73,
+    0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61,
+    0x69, 0x6c, 0x73, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
+    0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x69, 0x66,
+    0x20, 0x7b, 0x24, 0x74, 0x6f, 0x67, 0x67, 0x6c,
+    0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
+    0x73, 0x3d, 0x3d, 0x31, 0x7d, 0x20, 0x7b, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x20, 0x09, 0x09, 0x73, 0x65, 0x74, 0x20,
-    0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65, 0x5f, 0x64,
-    0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x20, 0x30,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x20, 0x09, 0x7d, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x09, 0x73, 0x65, 0x74, 0x20, 0x73, 0x68, 0x6f,
-    0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x20, 0x5b, 0x6c, 0x6f, 0x61, 0x64, 0x5f,
-    0x76, 0x61, 0x72, 0x20, 0x73, 0x68, 0x6f, 0x77,
-    0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73,
-    0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x69, 0x66, 0x20,
-    0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67,
-    0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68, 0x20,
-    0x24, 0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65,
-    0x74, 0x61, 0x69, 0x6c, 0x73, 0x5d, 0x3d, 0x3d,
-    0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x73, 0x65, 0x74, 0x20, 0x73, 0x68, 0x6f,
-    0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x20, 0x30, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x7d,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x20, 0x09, 0x69, 0x66, 0x20, 0x7b,
-    0x24, 0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65, 0x5f,
-    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x3d,
-    0x3d, 0x31, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x73, 0x68,
+    0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74,
+    0x61, 0x69, 0x6c, 0x73, 0x20, 0x5b, 0x65, 0x78,
+    0x70, 0x72, 0x20, 0x31, 0x2d, 0x24, 0x73, 0x68,
     0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69,
-    0x6c, 0x73, 0x20, 0x5b, 0x65, 0x78, 0x70, 0x72,
-    0x20, 0x31, 0x2d, 0x24, 0x73, 0x68, 0x6f, 0x77,
-    0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73,
-    0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x73, 0x61,
-    0x76, 0x65, 0x5f, 0x76, 0x61, 0x72, 0x20, 0x73,
+    0x6c, 0x73, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
+    0x73, 0x61, 0x76, 0x65, 0x5f, 0x76, 0x61, 0x72,
+    0x20, 0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65,
+    0x74, 0x61, 0x69, 0x6c, 0x73, 0x20, 0x24, 0x73,
     0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61,
-    0x69, 0x6c, 0x73, 0x20, 0x24, 0x73, 0x68, 0x6f,
-    0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x7d, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x69, 0x66,
-    0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e,
-    0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68,
-    0x20, 0x24, 0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c,
-    0x65, 0x5d, 0x21, 0x3d, 0x30, 0x7d, 0x20, 0x7b,
+    0x69, 0x6c, 0x73, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x7d,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x20, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61,
-    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a,
-    0x3c, 0x74, 0x72, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x68, 0x65, 0x69, 0x67, 0x68,
-    0x74, 0x3a, 0x31, 0x30, 0x30, 0x25, 0x3b, 0x22,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73,
-    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65,
-    0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x30, 0x30,
-    0x25, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
-    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c,
-    0x6f, 0x72, 0x3a, 0x72, 0x65, 0x64, 0x3b, 0x22,
-    0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e,
-    0x3d, 0x22, 0x36, 0x22, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x74, 0x61, 0x62, 0x6c, 0x65, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70, 0x61, 0x64,
-    0x64, 0x69, 0x6e, 0x67, 0x3a, 0x30, 0x70, 0x78,
-    0x3b, 0x62, 0x6f, 0x72, 0x64, 0x65, 0x72, 0x2d,
-    0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73, 0x65,
-    0x3a, 0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73,
-    0x65, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
-    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c,
-    0x6f, 0x72, 0x3a, 0x23, 0x66, 0x66, 0x66, 0x66,
-    0x66, 0x66, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3a, 0x31, 0x30, 0x30, 0x25, 0x22, 0x20, 0x63,
-    0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x74, 0x65,
-    0x78, 0x74, 0x67, 0x72, 0x61, 0x79, 0x22, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69, 0x64,
-    0x74, 0x68, 0x3a, 0x32, 0x35, 0x70, 0x78, 0x3b,
-    0x22, 0x3e, 0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x7d,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x24,
-    0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74,
-    0x61, 0x69, 0x6c, 0x73, 0x3d, 0x3d, 0x31, 0x7d,
+    0x09, 0x09, 0x20, 0x09, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
+    0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72,
+    0x69, 0x6e, 0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67,
+    0x74, 0x68, 0x20, 0x24, 0x63, 0x6f, 0x6e, 0x73,
+    0x6f, 0x6c, 0x65, 0x5d, 0x21, 0x3d, 0x30, 0x7d,
     0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x0d,
+    0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
+    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
+    0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65, 0x69,
+    0x67, 0x68, 0x74, 0x3a, 0x31, 0x30, 0x30, 0x25,
+    0x3b, 0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
+    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
+    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31,
+    0x30, 0x30, 0x25, 0x3b, 0x62, 0x61, 0x63, 0x6b,
+    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63,
+    0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x72, 0x65, 0x64,
+    0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70,
+    0x61, 0x6e, 0x3d, 0x22, 0x36, 0x22, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70,
+    0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x3a, 0x30,
+    0x70, 0x78, 0x3b, 0x62, 0x6f, 0x72, 0x64, 0x65,
+    0x72, 0x2d, 0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70,
+    0x73, 0x65, 0x3a, 0x63, 0x6f, 0x6c, 0x6c, 0x61,
+    0x70, 0x73, 0x65, 0x3b, 0x62, 0x61, 0x63, 0x6b,
+    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63,
+    0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x66, 0x66,
+    0x66, 0x66, 0x66, 0x66, 0x3b, 0x77, 0x69, 0x64,
+    0x74, 0x68, 0x3a, 0x31, 0x30, 0x30, 0x25, 0x22,
+    0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22,
+    0x74, 0x65, 0x78, 0x74, 0x67, 0x72, 0x61, 0x79,
+    0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x77,
+    0x69, 0x64, 0x74, 0x68, 0x3a, 0x32, 0x35, 0x70,
+    0x78, 0x3b, 0x22, 0x3e, 0x26, 0x6e, 0x62, 0x73,
+    0x70, 0x3b, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
+    0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x3c, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x20, 0x09, 0x09, 0x69, 0x66, 0x20,
+    0x7b, 0x24, 0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64,
+    0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x3d, 0x3d,
+    0x31, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
-    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x7b, 0x74, 0x64, 0x20, 0x73,
-    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61,
-    0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64,
-    0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23,
-    0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x3b, 0x70,
-    0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d, 0x6c,
-    0x65, 0x66, 0x74, 0x3a, 0x35, 0x70, 0x78, 0x3b,
-    0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d,
-    0x72, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x35, 0x70,
+    0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x3c, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x61,
+    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x74, 0x64,
+    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
+    0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75,
+    0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72,
+    0x3a, 0x23, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64,
+    0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67,
+    0x2d, 0x6c, 0x65, 0x66, 0x74, 0x3a, 0x35, 0x70,
     0x78, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
-    0x67, 0x2d, 0x74, 0x6f, 0x70, 0x3a, 0x33, 0x70,
-    0x78, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
-    0x67, 0x2d, 0x62, 0x6f, 0x74, 0x74, 0x6f, 0x6d,
-    0x3a, 0x33, 0x70, 0x78, 0x3b, 0x22, 0x7d, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
-    0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x7d, 0x20, 0x65, 0x6c, 0x73, 0x65, 0x20,
-    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x67, 0x2d, 0x72, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x35, 0x70, 0x78, 0x3b, 0x70, 0x61, 0x64, 0x64,
+    0x69, 0x6e, 0x67, 0x2d, 0x74, 0x6f, 0x70, 0x3a,
+    0x33, 0x70, 0x78, 0x3b, 0x70, 0x61, 0x64, 0x64,
+    0x69, 0x6e, 0x67, 0x2d, 0x62, 0x6f, 0x74, 0x74,
+    0x6f, 0x6d, 0x3a, 0x33, 0x70, 0x78, 0x3b, 0x22,
+    0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
     0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x3c, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x7b, 0x74, 0x64, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63,
-    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
-    0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a, 0x75, 0x72,
-    0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f,
-    0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74,
-    0x73, 0x2f, 0x68, 0x5f, 0x74, 0x61, 0x62, 0x5f,
-    0x66, 0x72, 0x65, 0x65, 0x2e, 0x70, 0x6e, 0x67,
-    0x27, 0x29, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3a, 0x31, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x68,
-    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x32, 0x39,
-    0x70, 0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67,
-    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x72, 0x65,
-    0x70, 0x65, 0x61, 0x74, 0x3a, 0x20, 0x6e, 0x6f,
-    0x2d, 0x72, 0x65, 0x70, 0x65, 0x61, 0x74, 0x3b,
-    0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75,
-    0x6e, 0x64, 0x2d, 0x70, 0x6f, 0x73, 0x69, 0x74,
-    0x69, 0x6f, 0x6e, 0x3a, 0x74, 0x6f, 0x70, 0x20,
-    0x6c, 0x65, 0x66, 0x74, 0x3b, 0x22, 0x7d, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
-    0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x09, 0x09, 0x7d, 0x20, 0x65, 0x6c, 0x73,
+    0x65, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c, 0x61, 0x20,
-    0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x22, 0x20,
-    0x68, 0x72, 0x65, 0x66, 0x3d, 0x22, 0x2f, 0x72,
-    0x61, 0x6d, 0x2f, 0x63, 0x67, 0x69, 0x2f, 0x69,
-    0x6e, 0x64, 0x65, 0x78, 0x2e, 0x74, 0x63, 0x6c,
-    0x3f, 0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65, 0x5f,
-    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x3d,
-    0x31, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
+    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
+    0x65, 0x72, 0x20, 0x3c, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x69, 0x66, 0x20, 0x7b, 0x24, 0x73, 0x68,
-    0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69,
-    0x6c, 0x73, 0x3d, 0x3d, 0x31, 0x7d, 0x20, 0x7b,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x7b, 0x74, 0x64, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62,
+    0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e,
+    0x64, 0x2d, 0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a,
+    0x75, 0x72, 0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f,
+    0x6d, 0x2f, 0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63,
+    0x75, 0x74, 0x73, 0x2f, 0x68, 0x5f, 0x74, 0x61,
+    0x62, 0x5f, 0x66, 0x72, 0x65, 0x65, 0x2e, 0x70,
+    0x6e, 0x67, 0x27, 0x29, 0x3b, 0x77, 0x69, 0x64,
+    0x74, 0x68, 0x3a, 0x31, 0x31, 0x30, 0x70, 0x78,
+    0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x32, 0x39, 0x70, 0x78, 0x3b, 0x62, 0x61, 0x63,
+    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
+    0x72, 0x65, 0x70, 0x65, 0x61, 0x74, 0x3a, 0x20,
+    0x6e, 0x6f, 0x2d, 0x72, 0x65, 0x70, 0x65, 0x61,
+    0x74, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
+    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x70, 0x6f, 0x73,
+    0x69, 0x74, 0x69, 0x6f, 0x6e, 0x3a, 0x74, 0x6f,
+    0x70, 0x20, 0x6c, 0x65, 0x66, 0x74, 0x3b, 0x22,
+    0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
+    0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
+    0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
+    0x20, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
-    0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
-    0x22, 0x48, 0x69, 0x64, 0x65, 0x20, 0x64, 0x65,
-    0x74, 0x61, 0x69, 0x6c, 0x73, 0x22, 0x0d, 0x0a,
+    0x20, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
-    0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x3c,
-    0x62, 0x72, 0x2f, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x20, 0x09, 0x0d, 0x0a, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c,
+    0x61, 0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d,
+    0x22, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
+    0x22, 0x20, 0x68, 0x72, 0x65, 0x66, 0x3d, 0x22,
+    0x2f, 0x72, 0x61, 0x6d, 0x2f, 0x63, 0x67, 0x69,
+    0x2f, 0x69, 0x6e, 0x64, 0x65, 0x78, 0x2e, 0x74,
+    0x63, 0x6c, 0x3f, 0x74, 0x6f, 0x67, 0x67, 0x6c,
+    0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
+    0x73, 0x3d, 0x31, 0x22, 0x3e, 0x0d, 0x0a, 0x7d,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x7d, 0x20, 0x65,
-    0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x24,
+    0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74,
+    0x61, 0x69, 0x6c, 0x73, 0x3d, 0x3d, 0x31, 0x7d,
+    0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x61,
-    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x3c, 0x64,
-    0x69, 0x76, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
-    0x3d, 0x22, 0x70, 0x6f, 0x73, 0x69, 0x74, 0x69,
-    0x6f, 0x6e, 0x3a, 0x72, 0x65, 0x6c, 0x61, 0x74,
-    0x69, 0x76, 0x65, 0x3b, 0x74, 0x6f, 0x70, 0x3a,
-    0x37, 0x70, 0x78, 0x3b, 0x74, 0x65, 0x78, 0x74,
-    0x2d, 0x61, 0x6c, 0x69, 0x67, 0x6e, 0x3a, 0x63,
-    0x65, 0x6e, 0x74, 0x65, 0x72, 0x3b, 0x22, 0x3e,
-    0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
+    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
+    0x72, 0x20, 0x22, 0x48, 0x69, 0x64, 0x65, 0x20,
+    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x22,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
     0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x22, 0x53, 0x68, 0x6f, 0x77, 0x20, 0x64,
-    0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x22, 0x0d,
+    0x20, 0x3c, 0x62, 0x72, 0x2f, 0x3e, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d,
+    0x20, 0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
-    0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x7d, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x3c, 0x64, 0x69, 0x76, 0x20, 0x73, 0x74, 0x79,
+    0x6c, 0x65, 0x3d, 0x22, 0x70, 0x6f, 0x73, 0x69,
+    0x74, 0x69, 0x6f, 0x6e, 0x3a, 0x72, 0x65, 0x6c,
+    0x61, 0x74, 0x69, 0x76, 0x65, 0x3b, 0x74, 0x6f,
+    0x70, 0x3a, 0x37, 0x70, 0x78, 0x3b, 0x74, 0x65,
+    0x78, 0x74, 0x2d, 0x61, 0x6c, 0x69, 0x67, 0x6e,
+    0x3a, 0x63, 0x65, 0x6e, 0x74, 0x65, 0x72, 0x3b,
+    0x22, 0x3e, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
+    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
+    0x65, 0x72, 0x20, 0x22, 0x53, 0x68, 0x6f, 0x77,
+    0x20, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73,
+    0x22, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
+    0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
+    0x20, 0x7b, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e,
     0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
+    0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c,
+    0x2f, 0x61, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
+    0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x24, 0x73,
+    0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61,
+    0x69, 0x6c, 0x73, 0x3d, 0x3d, 0x31, 0x7d, 0x20,
+    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
     0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c, 0x2f, 0x61,
-    0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x72, 0x20, 0x24, 0x63, 0x6f, 0x6e, 0x73, 0x6f,
+    0x6c, 0x65, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
+    0x09, 0x20, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x0d, 0x0a,
+    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x3c,
+    0x2f, 0x74, 0x64, 0x3e, 0x7d, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
     0x69, 0x66, 0x20, 0x7b, 0x24, 0x73, 0x68, 0x6f,
     0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x3d, 0x3d, 0x31, 0x7d, 0x20, 0x7b, 0x0d,
+    0x73, 0x21, 0x3d, 0x31, 0x7d, 0x20, 0x7b, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
-    0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
-    0x24, 0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c, 0x65,
+    0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
+    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
+    0x3c, 0x74, 0x64, 0x3e, 0x26, 0x6e, 0x62, 0x73,
+    0x70, 0x3b, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x7d,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x20, 0x09, 0x0d, 0x0a, 0x61, 0x70,
+    0x09, 0x20, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
+    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
+    0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
+    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
+    0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x32, 0x35,
+    0x70, 0x78, 0x3b, 0x22, 0x3e, 0x26, 0x6e, 0x62,
+    0x73, 0x70, 0x3b, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c,
+    0x65, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e,
+    0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70,
     0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x7b, 0x3c, 0x2f, 0x74,
-    0x64, 0x3e, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x69, 0x66,
-    0x20, 0x7b, 0x24, 0x73, 0x68, 0x6f, 0x77, 0x5f,
-    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x21,
-    0x3d, 0x31, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x61,
-    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x3c, 0x74,
-    0x64, 0x3e, 0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x7d, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x7d,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
-    0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
-    0x7b, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73,
-    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69,
-    0x64, 0x74, 0x68, 0x3a, 0x32, 0x35, 0x70, 0x78,
-    0x3b, 0x22, 0x3e, 0x26, 0x6e, 0x62, 0x73, 0x70,
-    0x3b, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
-    0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x7d,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c, 0x74, 0x72,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73,
-    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65,
-    0x69, 0x67, 0x68, 0x74, 0x3a, 0x33, 0x30, 0x70,
-    0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
-    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x69, 0x6d, 0x61,
-    0x67, 0x65, 0x3a, 0x75, 0x72, 0x6c, 0x28, 0x27,
-    0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x6d, 0x65, 0x6e,
-    0x75, 0x5f, 0x63, 0x75, 0x74, 0x73, 0x2f, 0x63,
-    0x65, 0x6e, 0x74, 0x65, 0x72, 0x5f, 0x62, 0x6f,
-    0x74, 0x74, 0x6f, 0x6d, 0x2e, 0x70, 0x6e, 0x67,
-    0x27, 0x29, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67,
-    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x72, 0x65,
-    0x70, 0x65, 0x61, 0x74, 0x3a, 0x20, 0x6e, 0x6f,
-    0x2d, 0x72, 0x65, 0x70, 0x65, 0x61, 0x74, 0x3b,
+    0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c,
+    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
+    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
+    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x33,
+    0x30, 0x70, 0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b,
+    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x69,
+    0x6d, 0x61, 0x67, 0x65, 0x3a, 0x75, 0x72, 0x6c,
+    0x28, 0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x6d,
+    0x65, 0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74, 0x73,
+    0x2f, 0x63, 0x65, 0x6e, 0x74, 0x65, 0x72, 0x5f,
+    0x62, 0x6f, 0x74, 0x74, 0x6f, 0x6d, 0x2e, 0x70,
+    0x6e, 0x67, 0x27, 0x29, 0x3b, 0x62, 0x61, 0x63,
+    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
+    0x72, 0x65, 0x70, 0x65, 0x61, 0x74, 0x3a, 0x20,
+    0x6e, 0x6f, 0x2d, 0x72, 0x65, 0x70, 0x65, 0x61,
+    0x74, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
+    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x70, 0x6f, 0x73,
+    0x69, 0x74, 0x69, 0x6f, 0x6e, 0x3a, 0x74, 0x6f,
+    0x70, 0x20, 0x72, 0x69, 0x67, 0x68, 0x74, 0x3b,
+    0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61,
+    0x6e, 0x3d, 0x22, 0x36, 0x22, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x64, 0x69, 0x76, 0x20, 0x73, 0x74, 0x79,
+    0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69, 0x64, 0x74,
+    0x68, 0x3a, 0x35, 0x30, 0x30, 0x70, 0x78, 0x3b,
     0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75,
-    0x6e, 0x64, 0x2d, 0x70, 0x6f, 0x73, 0x69, 0x74,
-    0x69, 0x6f, 0x6e, 0x3a, 0x74, 0x6f, 0x70, 0x20,
-    0x72, 0x69, 0x67, 0x68, 0x74, 0x3b, 0x22, 0x20,
-    0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e, 0x3d,
-    0x22, 0x36, 0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x64,
-    0x69, 0x76, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
-    0x3d, 0x22, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a,
-    0x35, 0x30, 0x30, 0x70, 0x78, 0x3b, 0x62, 0x61,
-    0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64,
-    0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23,
-    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3b, 0x68,
-    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x30,
-    0x30, 0x25, 0x3b, 0x22, 0x3e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x09, 0x09, 0x09, 0x26, 0x6e, 0x62, 0x73, 0x70,
-    0x3b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x3c, 0x2f,
-    0x64, 0x69, 0x76, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x61,
-    0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
-    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
-    0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x36, 0x70,
-    0x78, 0x3b, 0x22, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72,
+    0x3a, 0x23, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,
+    0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x31, 0x30, 0x30, 0x25, 0x3b, 0x22, 0x3e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x20, 0x09, 0x09, 0x09, 0x26, 0x6e, 0x62,
+    0x73, 0x70, 0x3b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x09,
+    0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
+    0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c,
     0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
     0x3d, 0x22, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a,
-    0x32, 0x34, 0x35, 0x70, 0x78, 0x3b, 0x68, 0x65,
-    0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x30, 0x30,
-    0x25, 0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x61,
-    0x62, 0x6c, 0x65, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x70, 0x61, 0x64, 0x64, 0x69,
-    0x6e, 0x67, 0x3a, 0x30, 0x70, 0x78, 0x3b, 0x62,
-    0x6f, 0x72, 0x64, 0x65, 0x72, 0x2d, 0x63, 0x6f,
-    0x6c, 0x6c, 0x61, 0x70, 0x73, 0x65, 0x3a, 0x63,
-    0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73, 0x65, 0x3b,
+    0x36, 0x70, 0x78, 0x3b, 0x22, 0x2f, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79,
+    0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69, 0x64, 0x74,
+    0x68, 0x3a, 0x32, 0x34, 0x35, 0x70, 0x78, 0x3b,
     0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31,
-    0x30, 0x30, 0x25, 0x3b, 0x22, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
-    0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x31,
-    0x30, 0x33, 0x70, 0x78, 0x3b, 0x68, 0x65, 0x69,
-    0x67, 0x68, 0x74, 0x3a, 0x32, 0x39, 0x70, 0x78,
-    0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f,
-    0x75, 0x6e, 0x64, 0x2d, 0x69, 0x6d, 0x61, 0x67,
-    0x65, 0x3a, 0x75, 0x72, 0x6c, 0x28, 0x27, 0x2f,
-    0x72, 0x6f, 0x6d, 0x2f, 0x6d, 0x65, 0x6e, 0x75,
-    0x5f, 0x63, 0x75, 0x74, 0x73, 0x2f, 0x68, 0x5f,
-    0x74, 0x61, 0x62, 0x32, 0x5f, 0x73, 0x65, 0x6c,
-    0x65, 0x63, 0x74, 0x65, 0x64, 0x2e, 0x70, 0x6e,
-    0x67, 0x27, 0x29, 0x3b, 0x62, 0x61, 0x63, 0x6b,
-    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x72,
-    0x65, 0x70, 0x65, 0x61, 0x74, 0x3a, 0x20, 0x6e,
-    0x6f, 0x2d, 0x72, 0x65, 0x70, 0x65, 0x61, 0x74,
-    0x3b, 0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x64, 0x69,
-    0x76, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x70, 0x6f, 0x73, 0x69, 0x74, 0x69, 0x6f,
-    0x6e, 0x3a, 0x72, 0x65, 0x6c, 0x61, 0x74, 0x69,
-    0x76, 0x65, 0x3b, 0x74, 0x6f, 0x70, 0x3a, 0x37,
-    0x70, 0x78, 0x3b, 0x3b, 0x66, 0x6f, 0x6e, 0x74,
-    0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
-    0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x74, 0x65, 0x78,
-    0x74, 0x2d, 0x61, 0x6c, 0x69, 0x67, 0x6e, 0x3a,
-    0x63, 0x65, 0x6e, 0x74, 0x65, 0x72, 0x3b, 0x77,
-    0x69, 0x64, 0x74, 0x68, 0x3a, 0x31, 0x30, 0x30,
-    0x70, 0x78, 0x3b, 0x22, 0x20, 0x63, 0x6c, 0x61,
-    0x73, 0x73, 0x3d, 0x22, 0x74, 0x65, 0x78, 0x74,
-    0x67, 0x72, 0x61, 0x79, 0x22, 0x3e, 0x0d, 0x0a,
+    0x30, 0x30, 0x25, 0x22, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x74, 0x61, 0x62, 0x6c, 0x65, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70, 0x61, 0x64,
+    0x64, 0x69, 0x6e, 0x67, 0x3a, 0x30, 0x70, 0x78,
+    0x3b, 0x62, 0x6f, 0x72, 0x64, 0x65, 0x72, 0x2d,
+    0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73, 0x65,
+    0x3a, 0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73,
+    0x65, 0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74,
+    0x3a, 0x31, 0x30, 0x30, 0x25, 0x3b, 0x22, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x77, 0x69, 0x64, 0x74, 0x68,
+    0x3a, 0x31, 0x30, 0x33, 0x70, 0x78, 0x3b, 0x68,
+    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x32, 0x39,
+    0x70, 0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67,
+    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x69, 0x6d,
+    0x61, 0x67, 0x65, 0x3a, 0x75, 0x72, 0x6c, 0x28,
+    0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x6d, 0x65,
+    0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74, 0x73, 0x2f,
+    0x68, 0x5f, 0x74, 0x61, 0x62, 0x32, 0x5f, 0x73,
+    0x65, 0x6c, 0x65, 0x63, 0x74, 0x65, 0x64, 0x2e,
+    0x70, 0x6e, 0x67, 0x27, 0x29, 0x3b, 0x62, 0x61,
+    0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64,
+    0x2d, 0x72, 0x65, 0x70, 0x65, 0x61, 0x74, 0x3a,
+    0x20, 0x6e, 0x6f, 0x2d, 0x72, 0x65, 0x70, 0x65,
+    0x61, 0x74, 0x3b, 0x22, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x64, 0x69, 0x76, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x70, 0x6f, 0x73, 0x69, 0x74,
+    0x69, 0x6f, 0x6e, 0x3a, 0x72, 0x65, 0x6c, 0x61,
+    0x74, 0x69, 0x76, 0x65, 0x3b, 0x74, 0x6f, 0x70,
+    0x3a, 0x37, 0x70, 0x78, 0x3b, 0x3b, 0x66, 0x6f,
+    0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68,
+    0x74, 0x3a, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x74,
+    0x65, 0x78, 0x74, 0x2d, 0x61, 0x6c, 0x69, 0x67,
+    0x6e, 0x3a, 0x63, 0x65, 0x6e, 0x74, 0x65, 0x72,
+    0x3b, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x31,
+    0x30, 0x30, 0x70, 0x78, 0x3b, 0x22, 0x20, 0x63,
+    0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x74, 0x65,
+    0x78, 0x74, 0x67, 0x72, 0x61, 0x79, 0x22, 0x3e,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x20, 0x20, 0x20, 0x20,
+    0x44, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74,
+    0x61, 0x74, 0x69, 0x6f, 0x6e, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x20, 0x20, 0x20, 0x20, 0x44, 0x6f,
-    0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x61, 0x74,
-    0x69, 0x6f, 0x6e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x20, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x74, 0x64, 0x20, 0x77, 0x69, 0x64,
+    0x74, 0x68, 0x3d, 0x22, 0x34, 0x30, 0x70, 0x78,
+    0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x26,
+    0x6e, 0x62, 0x73, 0x70, 0x3b, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x74, 0x64, 0x20, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3d, 0x22, 0x34, 0x30, 0x70, 0x78, 0x22, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x20, 0x09, 0x09, 0x26, 0x6e, 0x62,
-    0x73, 0x70, 0x3b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
-    0x64, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65, 0x69,
-    0x67, 0x68, 0x74, 0x3a, 0x31, 0x30, 0x70, 0x78,
-    0x3b, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x32,
-    0x34, 0x35, 0x70, 0x78, 0x3b, 0x62, 0x61, 0x63,
-    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
-    0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a, 0x75, 0x72,
-    0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f,
-    0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74,
-    0x73, 0x2f, 0x72, 0x69, 0x67, 0x68, 0x74, 0x5f,
-    0x74, 0x6f, 0x70, 0x5f, 0x73, 0x6d, 0x61, 0x6c,
-    0x6c, 0x2e, 0x70, 0x6e, 0x67, 0x27, 0x29, 0x3b,
-    0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61,
-    0x6e, 0x3d, 0x22, 0x33, 0x22, 0x2f, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
-    0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f,
-    0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f,
-    0x72, 0x3a, 0x23, 0x64, 0x38, 0x64, 0x37, 0x64,
-    0x37, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a,
-    0x32, 0x34, 0x35, 0x70, 0x78, 0x3b, 0x70, 0x61,
-    0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d, 0x6c, 0x65,
-    0x66, 0x74, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b,
+    0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x74, 0x64, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
+    0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68,
+    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x30,
+    0x70, 0x78, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68,
+    0x3a, 0x32, 0x34, 0x35, 0x70, 0x78, 0x3b, 0x62,
+    0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e,
+    0x64, 0x2d, 0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a,
+    0x75, 0x72, 0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f,
+    0x6d, 0x2f, 0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63,
+    0x75, 0x74, 0x73, 0x2f, 0x72, 0x69, 0x67, 0x68,
+    0x74, 0x5f, 0x74, 0x6f, 0x70, 0x5f, 0x73, 0x6d,
+    0x61, 0x6c, 0x6c, 0x2e, 0x70, 0x6e, 0x67, 0x27,
+    0x29, 0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73,
+    0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22, 0x2f,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b, 0x67,
+    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f,
+    0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x64, 0x38, 0x64,
+    0x37, 0x64, 0x37, 0x3b, 0x77, 0x69, 0x64, 0x74,
+    0x68, 0x3a, 0x32, 0x34, 0x35, 0x70, 0x78, 0x3b,
     0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d,
-    0x62, 0x75, 0x74, 0x74, 0x6f, 0x6d, 0x3a, 0x31,
-    0x30, 0x70, 0x78, 0x3b, 0x6c, 0x69, 0x6e, 0x65,
-    0x2d, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
-    0x31, 0x37, 0x70, 0x78, 0x3b, 0x22, 0x20, 0x63,
-    0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22,
-    0x33, 0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x61, 0x20,
-    0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x3d, 0x22,
-    0x5f, 0x62, 0x6c, 0x61, 0x6e, 0x6b, 0x22, 0x20,
-    0x68, 0x72, 0x65, 0x66, 0x3d, 0x22, 0x68, 0x74,
-    0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x77, 0x77, 0x77,
-    0x2e, 0x7a, 0x79, 0x6c, 0x69, 0x6e, 0x2e, 0x63,
-    0x6f, 0x6d, 0x2f, 0x7a, 0x79, 0x31, 0x30, 0x30,
-    0x30, 0x2f, 0x5a, 0x59, 0x31, 0x30, 0x30, 0x30,
-    0x5f, 0x51, 0x75, 0x69, 0x63, 0x6b, 0x5f, 0x53,
-    0x74, 0x61, 0x72, 0x74, 0x5f, 0x47, 0x75, 0x69,
-    0x64, 0x65, 0x2e, 0x70, 0x64, 0x66, 0x22, 0x3e,
-    0x51, 0x75, 0x69, 0x63, 0x6b, 0x20, 0x53, 0x74,
-    0x61, 0x72, 0x74, 0x20, 0x4d, 0x61, 0x6e, 0x75,
-    0x61, 0x6c, 0x3c, 0x2f, 0x61, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x62, 0x72, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x6c, 0x65, 0x66, 0x74, 0x3a, 0x31, 0x30, 0x70,
+    0x78, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
+    0x67, 0x2d, 0x62, 0x75, 0x74, 0x74, 0x6f, 0x6d,
+    0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x6c, 0x69,
+    0x6e, 0x65, 0x2d, 0x68, 0x65, 0x69, 0x67, 0x68,
+    0x74, 0x3a, 0x31, 0x37, 0x70, 0x78, 0x3b, 0x22,
+    0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e,
+    0x3d, 0x22, 0x33, 0x22, 0x3e, 0x0d, 0x0a, 0x3c,
     0x61, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74,
     0x3d, 0x22, 0x5f, 0x62, 0x6c, 0x61, 0x6e, 0x6b,
     0x22, 0x20, 0x68, 0x72, 0x65, 0x66, 0x3d, 0x22,
     0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x77,
     0x77, 0x77, 0x2e, 0x7a, 0x79, 0x6c, 0x69, 0x6e,
     0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x7a, 0x79, 0x31,
-    0x30, 0x30, 0x30, 0x2f, 0x6f, 0x70, 0x65, 0x6e,
-    0x6f, 0x63, 0x64, 0x2e, 0x70, 0x64, 0x66, 0x22,
-    0x3e, 0x4f, 0x70, 0x65, 0x6e, 0x4f, 0x43, 0x44,
-    0x20, 0x4d, 0x61, 0x6e, 0x75, 0x61, 0x6c, 0x3c,
-    0x2f, 0x61, 0x3e, 0x0d, 0x0a, 0x3c, 0x62, 0x72,
-    0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x61, 0x20, 0x74,
-    0x61, 0x72, 0x67, 0x65, 0x74, 0x3d, 0x22, 0x5f,
-    0x62, 0x6c, 0x61, 0x6e, 0x6b, 0x22, 0x20, 0x68,
-    0x72, 0x65, 0x66, 0x3d, 0x22, 0x68, 0x74, 0x74,
-    0x70, 0x3a, 0x2f, 0x2f, 0x77, 0x77, 0x77, 0x2e,
-    0x7a, 0x79, 0x6c, 0x69, 0x6e, 0x2e, 0x63, 0x6f,
-    0x6d, 0x2f, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
-    0x5f, 0x63, 0x6f, 0x6e, 0x74, 0x61, 0x63, 0x74,
-    0x2e, 0x68, 0x74, 0x6d, 0x6c, 0x22, 0x3e, 0x43,
-    0x6f, 0x6e, 0x74, 0x61, 0x63, 0x74, 0x20, 0x5a,
-    0x79, 0x6c, 0x69, 0x6e, 0x20, 0x41, 0x53, 0x3c,
-    0x2f, 0x61, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
-    0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79,
-    0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b,
-    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63,
-    0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x64, 0x38,
-    0x64, 0x37, 0x64, 0x37, 0x3b, 0x68, 0x65, 0x69,
-    0x67, 0x68, 0x74, 0x3a, 0x31, 0x35, 0x70, 0x78,
-    0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70,
-    0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22, 0x2f, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x74, 0x64, 0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70,
-    0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x20,
-    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70,
-    0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x3a, 0x30,
-    0x70, 0x78, 0x3b, 0x62, 0x6f, 0x72, 0x64, 0x65,
-    0x72, 0x2d, 0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70,
-    0x73, 0x65, 0x3a, 0x63, 0x6f, 0x6c, 0x6c, 0x61,
-    0x70, 0x73, 0x65, 0x3b, 0x22, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b, 0x67,
-    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f,
-    0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x64, 0x38, 0x64,
-    0x37, 0x64, 0x37, 0x3b, 0x77, 0x69, 0x64, 0x74,
-    0x68, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x68,
-    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x70,
-    0x78, 0x22, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
-    0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f,
-    0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f,
-    0x72, 0x3a, 0x23, 0x39, 0x39, 0x39, 0x39, 0x39,
-    0x39, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a,
-    0x32, 0x32, 0x35, 0x70, 0x78, 0x3b, 0x20, 0x68,
-    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x70,
-    0x78, 0x3b, 0x22, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
-    0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
-    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c,
-    0x6f, 0x72, 0x3a, 0x23, 0x64, 0x38, 0x64, 0x37,
-    0x64, 0x37, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x68, 0x65,
-    0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x70, 0x78,
-    0x22, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
-    0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x30, 0x30, 0x30, 0x2f, 0x5a, 0x59, 0x31, 0x30,
+    0x30, 0x30, 0x5f, 0x51, 0x75, 0x69, 0x63, 0x6b,
+    0x5f, 0x53, 0x74, 0x61, 0x72, 0x74, 0x5f, 0x47,
+    0x75, 0x69, 0x64, 0x65, 0x2e, 0x70, 0x64, 0x66,
+    0x22, 0x3e, 0x51, 0x75, 0x69, 0x63, 0x6b, 0x20,
+    0x53, 0x74, 0x61, 0x72, 0x74, 0x20, 0x4d, 0x61,
+    0x6e, 0x75, 0x61, 0x6c, 0x3c, 0x2f, 0x61, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x62, 0x72, 0x2f, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x61, 0x20, 0x74, 0x61, 0x72, 0x67,
+    0x65, 0x74, 0x3d, 0x22, 0x5f, 0x62, 0x6c, 0x61,
+    0x6e, 0x6b, 0x22, 0x20, 0x68, 0x72, 0x65, 0x66,
+    0x3d, 0x22, 0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f,
+    0x2f, 0x77, 0x77, 0x77, 0x2e, 0x7a, 0x79, 0x6c,
+    0x69, 0x6e, 0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x7a,
+    0x79, 0x31, 0x30, 0x30, 0x30, 0x2f, 0x6f, 0x70,
+    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x2e, 0x70, 0x64,
+    0x66, 0x22, 0x3e, 0x4f, 0x70, 0x65, 0x6e, 0x4f,
+    0x43, 0x44, 0x20, 0x4d, 0x61, 0x6e, 0x75, 0x61,
+    0x6c, 0x3c, 0x2f, 0x61, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x62, 0x72, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x61,
+    0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x3d,
+    0x22, 0x5f, 0x62, 0x6c, 0x61, 0x6e, 0x6b, 0x22,
+    0x20, 0x68, 0x72, 0x65, 0x66, 0x3d, 0x22, 0x68,
+    0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x77, 0x77,
+    0x77, 0x2e, 0x7a, 0x79, 0x6c, 0x69, 0x6e, 0x2e,
+    0x63, 0x6f, 0x6d, 0x2f, 0x7a, 0x79, 0x31, 0x30,
+    0x30, 0x30, 0x5f, 0x63, 0x6f, 0x6e, 0x74, 0x61,
+    0x63, 0x74, 0x2e, 0x68, 0x74, 0x6d, 0x6c, 0x22,
+    0x3e, 0x43, 0x6f, 0x6e, 0x74, 0x61, 0x63, 0x74,
+    0x20, 0x5a, 0x79, 0x6c, 0x69, 0x6e, 0x20, 0x41,
+    0x53, 0x3c, 0x2f, 0x61, 0x3e, 0x0d, 0x0a, 0x3c,
     0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
     0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72,
     0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73,
@@ -23987,248 +23956,295 @@
     0x70, 0x78, 0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c,
     0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22,
     0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x20, 0x73,
-    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65,
-    0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x30, 0x30,
-    0x25, 0x3b, 0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
-    0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
-    0x31, 0x30, 0x30, 0x25, 0x3b, 0x62, 0x61, 0x63,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x74, 0x64, 0x20, 0x63, 0x6f, 0x6c,
+    0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x61, 0x62, 0x6c,
+    0x65, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
+    0x22, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67,
+    0x3a, 0x30, 0x70, 0x78, 0x3b, 0x62, 0x6f, 0x72,
+    0x64, 0x65, 0x72, 0x2d, 0x63, 0x6f, 0x6c, 0x6c,
+    0x61, 0x70, 0x73, 0x65, 0x3a, 0x63, 0x6f, 0x6c,
+    0x6c, 0x61, 0x70, 0x73, 0x65, 0x3b, 0x22, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63,
     0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
     0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x64,
-    0x38, 0x64, 0x37, 0x64, 0x37, 0x3b, 0x70, 0x61,
-    0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d, 0x6c, 0x65,
-    0x66, 0x74, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b,
+    0x38, 0x64, 0x37, 0x64, 0x37, 0x3b, 0x77, 0x69,
+    0x64, 0x74, 0x68, 0x3a, 0x31, 0x30, 0x70, 0x78,
+    0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x31, 0x70, 0x78, 0x22, 0x2f, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b, 0x67,
+    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f,
+    0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x39, 0x39, 0x39,
+    0x39, 0x39, 0x39, 0x3b, 0x77, 0x69, 0x64, 0x74,
+    0x68, 0x3a, 0x32, 0x32, 0x35, 0x70, 0x78, 0x3b,
+    0x20, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x31, 0x70, 0x78, 0x3b, 0x22, 0x2f, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79,
+    0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b,
+    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63,
+    0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x64, 0x38,
+    0x64, 0x37, 0x64, 0x37, 0x3b, 0x77, 0x69, 0x64,
+    0x74, 0x68, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b,
+    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31,
+    0x70, 0x78, 0x22, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
+    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
+    0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75,
+    0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72,
+    0x3a, 0x23, 0x64, 0x38, 0x64, 0x37, 0x64, 0x37,
+    0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x31, 0x35, 0x70, 0x78, 0x3b, 0x22, 0x20, 0x63,
+    0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22,
+    0x33, 0x22, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
+    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72,
+    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
+    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31,
+    0x30, 0x30, 0x25, 0x3b, 0x22, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x68, 0x65, 0x69, 0x67, 0x68,
+    0x74, 0x3a, 0x31, 0x30, 0x30, 0x25, 0x3b, 0x62,
+    0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e,
+    0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a,
+    0x23, 0x64, 0x38, 0x64, 0x37, 0x64, 0x37, 0x3b,
     0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d,
-    0x72, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x30,
-    0x70, 0x78, 0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c,
-    0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22,
-    0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22,
-    0x74, 0x65, 0x78, 0x74, 0x67, 0x72, 0x61, 0x79,
-    0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x70, 0x3e, 0x54, 0x61, 0x72, 0x67, 0x65, 0x74,
-    0x20, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20,
-    0x73, 0x68, 0x6f, 0x77, 0x73, 0x20, 0x74, 0x68,
-    0x61, 0x74, 0x20, 0x73, 0x74, 0x61, 0x74, 0x75,
-    0x73, 0x20, 0x6f, 0x66, 0x20, 0x74, 0x68, 0x65,
-    0x20, 0x63, 0x6f, 0x6e, 0x6e, 0x65, 0x63, 0x74,
-    0x65, 0x64, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65,
-    0x74, 0x2e, 0x20, 0x3c, 0x2f, 0x70, 0x3e, 0x20,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x70, 0x3e, 0x3c, 0x62, 0x3e, 0x43, 0x75, 0x72,
-    0x72, 0x65, 0x6e, 0x74, 0x20, 0x74, 0x61, 0x72,
-    0x67, 0x65, 0x74, 0x3c, 0x2f, 0x62, 0x3e, 0x20,
-    0x2d, 0x20, 0x73, 0x65, 0x6c, 0x65, 0x63, 0x74,
-    0x65, 0x64, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65,
-    0x74, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
-    0x75, 0x72, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x2e,
+    0x6c, 0x65, 0x66, 0x74, 0x3a, 0x31, 0x30, 0x70,
+    0x78, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
+    0x67, 0x2d, 0x72, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x31, 0x30, 0x70, 0x78, 0x3b, 0x22, 0x20, 0x63,
+    0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22,
+    0x33, 0x22, 0x20, 0x63, 0x6c, 0x61, 0x73, 0x73,
+    0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x67, 0x72,
+    0x61, 0x79, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x3c, 0x70, 0x3e, 0x54, 0x61, 0x72, 0x67,
+    0x65, 0x74, 0x20, 0x73, 0x74, 0x61, 0x74, 0x75,
+    0x73, 0x20, 0x73, 0x68, 0x6f, 0x77, 0x73, 0x20,
+    0x74, 0x68, 0x61, 0x74, 0x20, 0x73, 0x74, 0x61,
+    0x74, 0x75, 0x73, 0x20, 0x6f, 0x66, 0x20, 0x74,
+    0x68, 0x65, 0x20, 0x63, 0x6f, 0x6e, 0x6e, 0x65,
+    0x63, 0x74, 0x65, 0x64, 0x20, 0x74, 0x61, 0x72,
+    0x67, 0x65, 0x74, 0x2e, 0x20, 0x3c, 0x2f, 0x70,
+    0x3e, 0x20, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x3c, 0x70, 0x3e, 0x3c, 0x62, 0x3e, 0x43,
+    0x75, 0x72, 0x72, 0x65, 0x6e, 0x74, 0x20, 0x74,
+    0x61, 0x72, 0x67, 0x65, 0x74, 0x3c, 0x2f, 0x62,
+    0x3e, 0x20, 0x2d, 0x20, 0x73, 0x65, 0x6c, 0x65,
+    0x63, 0x74, 0x65, 0x64, 0x20, 0x74, 0x61, 0x72,
+    0x67, 0x65, 0x74, 0x20, 0x63, 0x6f, 0x6e, 0x66,
+    0x69, 0x67, 0x75, 0x72, 0x61, 0x74, 0x69, 0x6f,
+    0x6e, 0x2e, 0x20, 0x3c, 0x62, 0x72, 0x3e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x70,
+    0x3e, 0x3c, 0x62, 0x3e, 0x53, 0x74, 0x61, 0x72,
+    0x74, 0x75, 0x70, 0x3c, 0x2f, 0x62, 0x3e, 0x20,
+    0x2d, 0x20, 0x77, 0x68, 0x65, 0x74, 0x68, 0x65,
+    0x72, 0x20, 0x6f, 0x72, 0x20, 0x6e, 0x6f, 0x74,
+    0x20, 0x74, 0x68, 0x65, 0x20, 0x74, 0x61, 0x72,
+    0x67, 0x65, 0x74, 0x20, 0x73, 0x63, 0x72, 0x69,
+    0x70, 0x74, 0x20, 0x72, 0x61, 0x6e, 0x20, 0x74,
+    0x6f, 0x20, 0x63, 0x6f, 0x6d, 0x70, 0x6c, 0x65,
+    0x74, 0x69, 0x6f, 0x6e, 0x2e, 0x20, 0x4e, 0x6f,
+    0x74, 0x65, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x74, 0x68, 0x61, 0x74, 0x20, 0x65, 0x76,
+    0x65, 0x6e, 0x20, 0x69, 0x66, 0x20, 0x74, 0x68,
+    0x65, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74,
+    0x20, 0x69, 0x73, 0x20, 0x64, 0x69, 0x73, 0x63,
+    0x6f, 0x6e, 0x6e, 0x65, 0x63, 0x74, 0x65, 0x64,
+    0x2c, 0x20, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x65,
+    0x64, 0x20, 0x64, 0x6f, 0x77, 0x6e, 0x20, 0x6f,
+    0x72, 0x20, 0x75, 0x6e, 0x72, 0x65, 0x73, 0x70,
+    0x6f, 0x6e, 0x73, 0x69, 0x76, 0x65, 0x2c, 0x20,
+    0x74, 0x68, 0x65, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x73, 0x74, 0x61, 0x72, 0x74, 0x75,
+    0x70, 0x20, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74,
+    0x20, 0x77, 0x69, 0x6c, 0x6c, 0x20, 0x73, 0x74,
+    0x69, 0x6c, 0x6c, 0x20, 0x72, 0x75, 0x6e, 0x20,
+    0x74, 0x6f, 0x20, 0x63, 0x6f, 0x6d, 0x70, 0x6c,
+    0x65, 0x74, 0x69, 0x6f, 0x6e, 0x2e, 0x20, 0x53,
+    0x74, 0x61, 0x72, 0x74, 0x75, 0x70, 0x20, 0x2d,
+    0x20, 0x4f, 0x4b, 0x20, 0x64, 0x6f, 0x65, 0x73,
+    0x20, 0x6e, 0x6f, 0x74, 0x20, 0x6d, 0x65, 0x61,
+    0x6e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x74, 0x68, 0x61, 0x74, 0x20, 0x74, 0x68, 0x65,
+    0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20,
+    0x69, 0x73, 0x20, 0x66, 0x75, 0x6c, 0x6c, 0x79,
+    0x20, 0x6f, 0x70, 0x65, 0x72, 0x61, 0x74, 0x69,
+    0x6f, 0x6e, 0x61, 0x6c, 0x2c, 0x20, 0x73, 0x69,
+    0x6d, 0x70, 0x6c, 0x79, 0x20, 0x74, 0x68, 0x61,
+    0x74, 0x20, 0x74, 0x68, 0x65, 0x20, 0x63, 0x6f,
+    0x6e, 0x66, 0x69, 0x67, 0x75, 0x72, 0x61, 0x74,
+    0x69, 0x6f, 0x6e, 0x20, 0x73, 0x63, 0x72, 0x69,
+    0x70, 0x74, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x64, 0x69, 0x64, 0x20, 0x6e, 0x6f, 0x74,
+    0x20, 0x63, 0x6f, 0x6e, 0x74, 0x61, 0x69, 0x6e,
+    0x20, 0x73, 0x79, 0x6e, 0x74, 0x61, 0x78, 0x20,
+    0x65, 0x72, 0x72, 0x6f, 0x72, 0x73, 0x20, 0x66,
+    0x6f, 0x72, 0x20, 0x69, 0x6e, 0x73, 0x74, 0x61,
+    0x6e, 0x63, 0x65, 0x2e, 0x20, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x53, 0x65, 0x65, 0x20,
+    0x6c, 0x6f, 0x67, 0x20, 0x66, 0x6f, 0x72, 0x20,
+    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x2e,
     0x20, 0x3c, 0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x3c, 0x70, 0x3e, 0x3c,
-    0x62, 0x3e, 0x53, 0x74, 0x61, 0x72, 0x74, 0x75,
-    0x70, 0x3c, 0x2f, 0x62, 0x3e, 0x20, 0x2d, 0x20,
-    0x77, 0x68, 0x65, 0x74, 0x68, 0x65, 0x72, 0x20,
-    0x6f, 0x72, 0x20, 0x6e, 0x6f, 0x74, 0x20, 0x74,
-    0x68, 0x65, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65,
-    0x74, 0x20, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74,
-    0x20, 0x72, 0x61, 0x6e, 0x20, 0x74, 0x6f, 0x20,
-    0x63, 0x6f, 0x6d, 0x70, 0x6c, 0x65, 0x74, 0x69,
-    0x6f, 0x6e, 0x2e, 0x20, 0x4e, 0x6f, 0x74, 0x65,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x74,
-    0x68, 0x61, 0x74, 0x20, 0x65, 0x76, 0x65, 0x6e,
-    0x20, 0x69, 0x66, 0x20, 0x74, 0x68, 0x65, 0x20,
-    0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20, 0x69,
-    0x73, 0x20, 0x64, 0x69, 0x73, 0x63, 0x6f, 0x6e,
-    0x6e, 0x65, 0x63, 0x74, 0x65, 0x64, 0x2c, 0x20,
-    0x70, 0x6f, 0x77, 0x65, 0x72, 0x65, 0x64, 0x20,
-    0x64, 0x6f, 0x77, 0x6e, 0x20, 0x6f, 0x72, 0x20,
-    0x75, 0x6e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e,
-    0x73, 0x69, 0x76, 0x65, 0x2c, 0x20, 0x74, 0x68,
-    0x65, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x73, 0x74, 0x61, 0x72, 0x74, 0x75, 0x70, 0x20,
-    0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x20, 0x77,
-    0x69, 0x6c, 0x6c, 0x20, 0x73, 0x74, 0x69, 0x6c,
-    0x6c, 0x20, 0x72, 0x75, 0x6e, 0x20, 0x74, 0x6f,
-    0x20, 0x63, 0x6f, 0x6d, 0x70, 0x6c, 0x65, 0x74,
-    0x69, 0x6f, 0x6e, 0x2e, 0x20, 0x53, 0x74, 0x61,
-    0x72, 0x74, 0x75, 0x70, 0x20, 0x2d, 0x20, 0x4f,
-    0x4b, 0x20, 0x64, 0x6f, 0x65, 0x73, 0x20, 0x6e,
-    0x6f, 0x74, 0x20, 0x6d, 0x65, 0x61, 0x6e, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x74, 0x68,
-    0x61, 0x74, 0x20, 0x74, 0x68, 0x65, 0x20, 0x74,
-    0x61, 0x72, 0x67, 0x65, 0x74, 0x20, 0x69, 0x73,
-    0x20, 0x66, 0x75, 0x6c, 0x6c, 0x79, 0x20, 0x6f,
-    0x70, 0x65, 0x72, 0x61, 0x74, 0x69, 0x6f, 0x6e,
-    0x61, 0x6c, 0x2c, 0x20, 0x73, 0x69, 0x6d, 0x70,
-    0x6c, 0x79, 0x20, 0x74, 0x68, 0x61, 0x74, 0x20,
-    0x74, 0x68, 0x65, 0x20, 0x63, 0x6f, 0x6e, 0x66,
-    0x69, 0x67, 0x75, 0x72, 0x61, 0x74, 0x69, 0x6f,
-    0x6e, 0x20, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x64,
-    0x69, 0x64, 0x20, 0x6e, 0x6f, 0x74, 0x20, 0x63,
-    0x6f, 0x6e, 0x74, 0x61, 0x69, 0x6e, 0x20, 0x73,
-    0x79, 0x6e, 0x74, 0x61, 0x78, 0x20, 0x65, 0x72,
-    0x72, 0x6f, 0x72, 0x73, 0x20, 0x66, 0x6f, 0x72,
-    0x20, 0x69, 0x6e, 0x73, 0x74, 0x61, 0x6e, 0x63,
-    0x65, 0x2e, 0x20, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x53, 0x65, 0x65, 0x20, 0x6c, 0x6f,
-    0x67, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x64, 0x65,
-    0x74, 0x61, 0x69, 0x6c, 0x73, 0x2e, 0x20, 0x3c,
-    0x62, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x3c, 0x70, 0x3e, 0x3c, 0x62, 0x3e,
-    0x54, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20, 0x70,
-    0x6f, 0x77, 0x65, 0x72, 0x3c, 0x2f, 0x62, 0x3e,
-    0x20, 0x2d, 0x20, 0x44, 0x65, 0x74, 0x65, 0x63,
-    0x74, 0x73, 0x20, 0x70, 0x6f, 0x77, 0x65, 0x72,
-    0x20, 0x6f, 0x6e, 0x20, 0x74, 0x61, 0x72, 0x67,
-    0x65, 0x74, 0x2e, 0x20, 0x3c, 0x62, 0x72, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x49,
-    0x66, 0x20, 0x74, 0x68, 0x65, 0x20, 0x4a, 0x54,
-    0x41, 0x47, 0x20, 0x63, 0x61, 0x62, 0x6c, 0x65,
-    0x20, 0x69, 0x73, 0x20, 0x6e, 0x6f, 0x74, 0x20,
-    0x63, 0x6f, 0x6e, 0x6e, 0x65, 0x63, 0x74, 0x65,
-    0x64, 0x2c, 0x20, 0x6f, 0x72, 0x20, 0x74, 0x68,
-    0x65, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74,
-    0x20, 0x68, 0x61, 0x73, 0x20, 0x6e, 0x6f, 0x20,
-    0x70, 0x6f, 0x77, 0x65, 0x72, 0x2c, 0x20, 0x74,
-    0x68, 0x65, 0x6e, 0x20, 0x6e, 0x6f, 0x20, 0x74,
-    0x61, 0x72, 0x67, 0x65, 0x74, 0x20, 0x70, 0x6f,
-    0x77, 0x65, 0x72, 0x20, 0x77, 0x69, 0x6c, 0x6c,
-    0x20, 0x62, 0x65, 0x20, 0x64, 0x65, 0x74, 0x65,
-    0x63, 0x74, 0x65, 0x64, 0x2e, 0x3c, 0x2f, 0x70,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x3c, 0x70, 0x3e, 0x3c, 0x62, 0x3e, 0x52, 0x65,
-    0x6c, 0x61, 0x79, 0x20, 0x6f, 0x6e, 0x3c, 0x2f,
-    0x62, 0x3e, 0x20, 0x2d, 0x20, 0x54, 0x75, 0x72,
-    0x6e, 0x20, 0x6f, 0x6e, 0x20, 0x5a, 0x59, 0x31,
-    0x30, 0x30, 0x30, 0x20, 0x74, 0x61, 0x72, 0x67,
-    0x65, 0x74, 0x20, 0x70, 0x6f, 0x77, 0x65, 0x72,
-    0x20, 0x72, 0x65, 0x6c, 0x61, 0x79, 0x2e, 0x3c,
+    0x62, 0x3e, 0x54, 0x61, 0x72, 0x67, 0x65, 0x74,
+    0x20, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x3c, 0x2f,
+    0x62, 0x3e, 0x20, 0x2d, 0x20, 0x44, 0x65, 0x74,
+    0x65, 0x63, 0x74, 0x73, 0x20, 0x70, 0x6f, 0x77,
+    0x65, 0x72, 0x20, 0x6f, 0x6e, 0x20, 0x74, 0x61,
+    0x72, 0x67, 0x65, 0x74, 0x2e, 0x20, 0x3c, 0x62,
+    0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x49, 0x66, 0x20, 0x74, 0x68, 0x65, 0x20,
+    0x4a, 0x54, 0x41, 0x47, 0x20, 0x63, 0x61, 0x62,
+    0x6c, 0x65, 0x20, 0x69, 0x73, 0x20, 0x6e, 0x6f,
+    0x74, 0x20, 0x63, 0x6f, 0x6e, 0x6e, 0x65, 0x63,
+    0x74, 0x65, 0x64, 0x2c, 0x20, 0x6f, 0x72, 0x20,
+    0x74, 0x68, 0x65, 0x20, 0x74, 0x61, 0x72, 0x67,
+    0x65, 0x74, 0x20, 0x68, 0x61, 0x73, 0x20, 0x6e,
+    0x6f, 0x20, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x2c,
+    0x20, 0x74, 0x68, 0x65, 0x6e, 0x20, 0x6e, 0x6f,
+    0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20,
+    0x70, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x77, 0x69,
+    0x6c, 0x6c, 0x20, 0x62, 0x65, 0x20, 0x64, 0x65,
+    0x74, 0x65, 0x63, 0x74, 0x65, 0x64, 0x2e, 0x3c,
     0x2f, 0x70, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x3c, 0x70, 0x3e, 0x3c, 0x62, 0x3e,
-    0x52, 0x65, 0x6c, 0x61, 0x79, 0x20, 0x6f, 0x66,
-    0x66, 0x3c, 0x2f, 0x62, 0x3e, 0x20, 0x2d, 0x20,
-    0x54, 0x75, 0x72, 0x6e, 0x20, 0x6f, 0x66, 0x66,
-    0x20, 0x5a, 0x59, 0x31, 0x30, 0x30, 0x30, 0x20,
-    0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20,
-    0x70, 0x6f, 0x77, 0x65, 0x72, 0x20, 0x72, 0x65,
-    0x6c, 0x61, 0x79, 0x2e, 0x3c, 0x2f, 0x70, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x70, 0x3e, 0x54, 0x79, 0x70, 0x65, 0x20, 0x22,
-    0x68, 0x65, 0x6c, 0x70, 0x20, 0x70, 0x6f, 0x77,
-    0x65, 0x72, 0x22, 0x20, 0x69, 0x6e, 0x20, 0x74,
-    0x65, 0x6c, 0x6e, 0x65, 0x74, 0x20, 0x66, 0x6f,
-    0x72, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x61, 0x6e,
-    0x64, 0x20, 0x74, 0x6f, 0x20, 0x63, 0x6f, 0x6e,
-    0x74, 0x72, 0x6f, 0x6c, 0x20, 0x70, 0x6f, 0x77,
+    0x52, 0x65, 0x6c, 0x61, 0x79, 0x20, 0x6f, 0x6e,
+    0x3c, 0x2f, 0x62, 0x3e, 0x20, 0x2d, 0x20, 0x54,
+    0x75, 0x72, 0x6e, 0x20, 0x6f, 0x6e, 0x20, 0x5a,
+    0x59, 0x31, 0x30, 0x30, 0x30, 0x20, 0x74, 0x61,
+    0x72, 0x67, 0x65, 0x74, 0x20, 0x70, 0x6f, 0x77,
     0x65, 0x72, 0x20, 0x72, 0x65, 0x6c, 0x61, 0x79,
     0x2e, 0x3c, 0x2f, 0x70, 0x3e, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x3c, 0x70, 0x3e, 0x3c,
-    0x62, 0x3e, 0x52, 0x65, 0x62, 0x6f, 0x6f, 0x74,
-    0x20, 0x5a, 0x59, 0x31, 0x30, 0x30, 0x30, 0x3c,
-    0x2f, 0x62, 0x3e, 0x20, 0x2d, 0x20, 0x52, 0x65,
-    0x62, 0x6f, 0x6f, 0x74, 0x73, 0x20, 0x5a, 0x59,
-    0x31, 0x30, 0x30, 0x30, 0x20, 0x75, 0x6e, 0x69,
-    0x74, 0x2e, 0x20, 0x54, 0x79, 0x70, 0x65, 0x20,
-    0x22, 0x68, 0x65, 0x6c, 0x70, 0x20, 0x72, 0x65,
-    0x62, 0x6f, 0x6f, 0x74, 0x22, 0x20, 0x69, 0x6e,
-    0x20, 0x74, 0x65, 0x6c, 0x6e, 0x65, 0x74, 0x2e,
-    0x3c, 0x2f, 0x70, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73,
-    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65,
-    0x69, 0x67, 0x68, 0x74, 0x3a, 0x33, 0x30, 0x70,
-    0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
-    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x69, 0x6d, 0x61,
-    0x67, 0x65, 0x3a, 0x75, 0x72, 0x6c, 0x28, 0x27,
-    0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x6d, 0x65, 0x6e,
-    0x75, 0x5f, 0x63, 0x75, 0x74, 0x73, 0x2f, 0x72,
-    0x69, 0x67, 0x68, 0x74, 0x5f, 0x62, 0x6f, 0x74,
-    0x74, 0x6f, 0x6d, 0x2e, 0x70, 0x6e, 0x67, 0x27,
-    0x29, 0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73,
-    0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22, 0x3e,
+    0x62, 0x3e, 0x52, 0x65, 0x6c, 0x61, 0x79, 0x20,
+    0x6f, 0x66, 0x66, 0x3c, 0x2f, 0x62, 0x3e, 0x20,
+    0x2d, 0x20, 0x54, 0x75, 0x72, 0x6e, 0x20, 0x6f,
+    0x66, 0x66, 0x20, 0x5a, 0x59, 0x31, 0x30, 0x30,
+    0x30, 0x20, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65,
+    0x74, 0x20, 0x70, 0x6f, 0x77, 0x65, 0x72, 0x20,
+    0x72, 0x65, 0x6c, 0x61, 0x79, 0x2e, 0x3c, 0x2f,
+    0x70, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x3c, 0x70, 0x3e, 0x54, 0x79, 0x70, 0x65,
+    0x20, 0x22, 0x68, 0x65, 0x6c, 0x70, 0x20, 0x70,
+    0x6f, 0x77, 0x65, 0x72, 0x22, 0x20, 0x69, 0x6e,
+    0x20, 0x74, 0x65, 0x6c, 0x6e, 0x65, 0x74, 0x20,
+    0x66, 0x6f, 0x72, 0x20, 0x63, 0x6f, 0x6d, 0x6d,
+    0x61, 0x6e, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x63,
+    0x6f, 0x6e, 0x74, 0x72, 0x6f, 0x6c, 0x20, 0x70,
+    0x6f, 0x77, 0x65, 0x72, 0x20, 0x72, 0x65, 0x6c,
+    0x61, 0x79, 0x2e, 0x3c, 0x2f, 0x70, 0x3e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x70,
+    0x3e, 0x3c, 0x62, 0x3e, 0x52, 0x65, 0x62, 0x6f,
+    0x6f, 0x74, 0x20, 0x5a, 0x59, 0x31, 0x30, 0x30,
+    0x30, 0x3c, 0x2f, 0x62, 0x3e, 0x20, 0x2d, 0x20,
+    0x52, 0x65, 0x62, 0x6f, 0x6f, 0x74, 0x73, 0x20,
+    0x5a, 0x59, 0x31, 0x30, 0x30, 0x30, 0x20, 0x75,
+    0x6e, 0x69, 0x74, 0x2e, 0x20, 0x54, 0x79, 0x70,
+    0x65, 0x20, 0x22, 0x68, 0x65, 0x6c, 0x70, 0x20,
+    0x72, 0x65, 0x62, 0x6f, 0x6f, 0x74, 0x22, 0x20,
+    0x69, 0x6e, 0x20, 0x74, 0x65, 0x6c, 0x6e, 0x65,
+    0x74, 0x2e, 0x3c, 0x2f, 0x70, 0x3e, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
+    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
+    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x33,
+    0x30, 0x70, 0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b,
+    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x69,
+    0x6d, 0x61, 0x67, 0x65, 0x3a, 0x75, 0x72, 0x6c,
+    0x28, 0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x6d,
+    0x65, 0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74, 0x73,
+    0x2f, 0x72, 0x69, 0x67, 0x68, 0x74, 0x5f, 0x62,
+    0x6f, 0x74, 0x74, 0x6f, 0x6d, 0x2e, 0x70, 0x6e,
+    0x67, 0x27, 0x29, 0x3b, 0x22, 0x20, 0x63, 0x6f,
+    0x6c, 0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33,
+    0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x26,
+    0x6e, 0x62, 0x73, 0x70, 0x3b, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
+    0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
+    0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x69, 0x6d, 0x67, 0x20, 0x62,
+    0x6f, 0x72, 0x64, 0x65, 0x72, 0x3d, 0x22, 0x30,
+    0x22, 0x20, 0x73, 0x72, 0x63, 0x3d, 0x22, 0x2f,
+    0x72, 0x6f, 0x6d, 0x2f, 0x6d, 0x65, 0x6e, 0x75,
+    0x5f, 0x63, 0x75, 0x74, 0x73, 0x2f, 0x6c, 0x6f,
+    0x67, 0x6f, 0x5f, 0x62, 0x6f, 0x74, 0x74, 0x6f,
+    0x6d, 0x2e, 0x70, 0x6e, 0x67, 0x22, 0x2f, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79,
+    0x6c, 0x65, 0x3d, 0x22, 0x70, 0x61, 0x64, 0x64,
+    0x69, 0x6e, 0x67, 0x2d, 0x74, 0x6f, 0x70, 0x3a,
+    0x31, 0x30, 0x70, 0x78, 0x3b, 0x70, 0x61, 0x64,
+    0x64, 0x69, 0x6e, 0x67, 0x2d, 0x6c, 0x65, 0x66,
+    0x74, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x6d,
+    0x61, 0x72, 0x67, 0x69, 0x6e, 0x2d, 0x74, 0x6f,
+    0x70, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x22,
+    0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22,
+    0x74, 0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68,
+    0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x5a, 0x79, 0x6c, 0x69,
+    0x6e, 0x20, 0x41, 0x53, 0x2c, 0x20, 0x41, 0x75,
+    0x67, 0x6c, 0x65, 0x6e, 0x64, 0x73, 0x64, 0x61,
+    0x6c, 0x65, 0x6e, 0x20, 0x37, 0x38, 0x2c, 0x20,
+    0x4e, 0x2d, 0x34, 0x30, 0x31, 0x37, 0x20, 0x53,
+    0x74, 0x61, 0x76, 0x61, 0x6e, 0x67, 0x65, 0x72,
+    0x2c, 0x20, 0x4e, 0x6f, 0x72, 0x77, 0x61, 0x79,
+    0x20, 0x2d, 0x20, 0x77, 0x77, 0x77, 0x2e, 0x7a,
+    0x79, 0x6c, 0x69, 0x6e, 0x2e, 0x63, 0x6f, 0x6d,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x20, 0x09, 0x09, 0x09, 0x26, 0x6e, 0x62,
-    0x73, 0x70, 0x3b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
-    0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x2f, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x69, 0x6d, 0x67, 0x20, 0x62, 0x6f, 0x72,
-    0x64, 0x65, 0x72, 0x3d, 0x22, 0x30, 0x22, 0x20,
-    0x73, 0x72, 0x63, 0x3d, 0x22, 0x2f, 0x72, 0x6f,
-    0x6d, 0x2f, 0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63,
-    0x75, 0x74, 0x73, 0x2f, 0x6c, 0x6f, 0x67, 0x6f,
-    0x5f, 0x62, 0x6f, 0x74, 0x74, 0x6f, 0x6d, 0x2e,
-    0x70, 0x6e, 0x67, 0x22, 0x2f, 0x3e, 0x0d, 0x0a,
     0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
-    0x3d, 0x22, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
-    0x67, 0x2d, 0x74, 0x6f, 0x70, 0x3a, 0x31, 0x30,
-    0x70, 0x78, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69,
-    0x6e, 0x67, 0x2d, 0x6c, 0x65, 0x66, 0x74, 0x3a,
-    0x31, 0x30, 0x70, 0x78, 0x3b, 0x6d, 0x61, 0x72,
-    0x67, 0x69, 0x6e, 0x2d, 0x74, 0x6f, 0x70, 0x3a,
-    0x31, 0x30, 0x70, 0x78, 0x3b, 0x22, 0x20, 0x63,
-    0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x74, 0x65,
-    0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x22,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x5a, 0x79, 0x6c, 0x69, 0x6e, 0x20,
-    0x41, 0x53, 0x2c, 0x20, 0x41, 0x75, 0x67, 0x6c,
-    0x65, 0x6e, 0x64, 0x73, 0x64, 0x61, 0x6c, 0x65,
-    0x6e, 0x20, 0x37, 0x38, 0x2c, 0x20, 0x4e, 0x2d,
-    0x34, 0x30, 0x31, 0x37, 0x20, 0x53, 0x74, 0x61,
-    0x76, 0x61, 0x6e, 0x67, 0x65, 0x72, 0x2c, 0x20,
-    0x4e, 0x6f, 0x72, 0x77, 0x61, 0x79, 0x20, 0x2d,
-    0x20, 0x77, 0x77, 0x77, 0x2e, 0x7a, 0x79, 0x6c,
-    0x69, 0x6e, 0x2e, 0x63, 0x6f, 0x6d, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x2f,
-    0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x61,
-    0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x62, 0x6f, 0x64, 0x79, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x68, 0x74, 0x6d, 0x6c, 0x3e, 0x0d, 0x0a,
-    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
-    0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
+    0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x62, 0x6f, 0x64, 0x79, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x68, 0x74, 0x6d, 0x6c, 0x3e,
+    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
     0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
     0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
+    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
     0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
     0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
     0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
-    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
-    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
     0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
     0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
+    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
     0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a,
     0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x0d, 0x0a, 0x09,
-    0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x73,
-    0x74, 0x61, 0x72, 0x74, 0x5f, 0x63, 0x68, 0x75,
-    0x6e, 0x6b, 0x65, 0x64, 0x20, 0x22, 0x68, 0x74,
-    0x6d, 0x6c, 0x22, 0x0d, 0x0a, 0x77, 0x72, 0x69,
-    0x74, 0x65, 0x5f, 0x63, 0x68, 0x75, 0x6e, 0x6b,
-    0x65, 0x64, 0x20, 0x24, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x0d, 0x0a, 0x65, 0x6e, 0x64, 0x5f,
-    0x63, 0x68, 0x75, 0x6e, 0x6b, 0x65, 0x64, 0x0d,
-    0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x0d,
+    0x0a, 0x09, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x73, 0x74, 0x61, 0x72, 0x74, 0x5f, 0x63,
+    0x68, 0x75, 0x6e, 0x6b, 0x65, 0x64, 0x20, 0x22,
+    0x68, 0x74, 0x6d, 0x6c, 0x22, 0x0d, 0x0a, 0x77,
+    0x72, 0x69, 0x74, 0x65, 0x5f, 0x63, 0x68, 0x75,
+    0x6e, 0x6b, 0x65, 0x64, 0x20, 0x24, 0x62, 0x75,
+    0x66, 0x66, 0x65, 0x72, 0x0d, 0x0a, 0x65, 0x6e,
+    0x64, 0x5f, 0x63, 0x68, 0x75, 0x6e, 0x6b, 0x65,
+    0x64, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -24352,7 +24368,6 @@
     0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
-    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
     0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
@@ -25457,6 +25472,7 @@
     0x0d, 0x0a, 0x65, 0x6e, 0x64, 0x5f, 0x63, 0x68,
     0x75, 0x6e, 0x6b, 0x65, 0x64, 0x0d, 0x0a, 0x0d,
     0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a,
     0x00, 0x00, 0x00, 0x0d, 0x49, 0x48, 0x44, 0x52,
     0x00, 0x00, 0x00, 0x4b, 0x00, 0x00, 0x00, 0x2d,
@@ -26262,8 +26278,7 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -27513,6 +27528,7 @@
     0x66, 0x66, 0x65, 0x72, 0x0d, 0x0a, 0x65, 0x6e,
     0x64, 0x5f, 0x63, 0x68, 0x75, 0x6e, 0x6b, 0x65,
     0x64, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -27621,8 +27637,7 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -29073,6 +29088,7 @@
     0x0d, 0x0a, 0x65, 0x6e, 0x64, 0x5f, 0x63, 0x68,
     0x75, 0x6e, 0x6b, 0x65, 0x64, 0x0d, 0x0a, 0x0d,
     0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -29188,8 +29204,7 @@
     0x74, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x22, 0x3e,
     0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
-    0x75, 0x72, 0x65, 0x20, 0x7a, 0x79, 0x31, 0x30,
+    0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30,
     0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73, 0x69,
     0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
@@ -30701,6 +30716,7 @@
     0x64, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -30813,7 +30829,6 @@
     0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
-    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
     0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
     0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d,
     0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
@@ -32017,6 +32032,7 @@
     0x64, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -32134,8 +32150,7 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -33490,9 +33505,6 @@
     0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x0d, 0x0a,
     0x65, 0x6e, 0x64, 0x5f, 0x63, 0x68, 0x75, 0x6e,
     0x6b, 0x65, 0x64, 0x0d, 0x0a, 0x0d, 0x0a, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x45, 0x78, 0x65, 0x63, 0x75, 0x74,
     0x65, 0x64, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x61,
     0x6e, 0x64, 0x73, 0x0d, 0x0a, 0x23, 0x20, 0x63,
@@ -34023,8 +34035,7 @@
     0x74, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x22, 0x3e,
     0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x5b, 0x63, 0x61, 0x70, 0x74,
-    0x75, 0x72, 0x65, 0x20, 0x7a, 0x79, 0x31, 0x30,
+    0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30,
     0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73, 0x69,
     0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
@@ -34585,728 +34596,678 @@
     0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x6c,
     0x6f, 0x67, 0x20, 0x22, 0x56, 0x65, 0x72, 0x73,
-    0x69, 0x6f, 0x6e, 0x3a, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x7a,
-    0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65,
-    0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x7a, 0x79,
-    0x31, 0x30, 0x30, 0x30, 0x22, 0x5d, 0x22, 0x0d,
+    0x69, 0x6f, 0x6e, 0x3a, 0x20, 0x5b, 0x7a, 0x79,
+    0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
+    0x73, 0x69, 0x6f, 0x6e, 0x20, 0x7a, 0x79, 0x31,
+    0x30, 0x30, 0x30, 0x5d, 0x22, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
+    0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x6c, 0x6f,
+    0x67, 0x20, 0x22, 0x4f, 0x70, 0x65, 0x6e, 0x4f,
+    0x43, 0x44, 0x20, 0x76, 0x65, 0x72, 0x73, 0x69,
+    0x6f, 0x6e, 0x3a, 0x20, 0x5b, 0x7a, 0x79, 0x31,
+    0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72, 0x73,
+    0x69, 0x6f, 0x6e, 0x20, 0x6f, 0x70, 0x65, 0x6e,
+    0x6f, 0x63, 0x64, 0x5d, 0x22, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
+    0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x6c, 0x6f,
+    0x67, 0x20, 0x22, 0x56, 0x65, 0x72, 0x73, 0x69,
+    0x6f, 0x6e, 0x20, 0x64, 0x61, 0x74, 0x65, 0x3a,
+    0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
+    0x5f, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e,
+    0x20, 0x64, 0x61, 0x74, 0x65, 0x5d, 0x22, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
     0x6e, 0x64, 0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f,
-    0x6c, 0x6f, 0x67, 0x20, 0x22, 0x4f, 0x70, 0x65,
-    0x6e, 0x4f, 0x43, 0x44, 0x20, 0x76, 0x65, 0x72,
-    0x73, 0x69, 0x6f, 0x6e, 0x3a, 0x20, 0x5b, 0x63,
-    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22,
-    0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76,
-    0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x22, 0x5d,
-    0x22, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x61, 0x70,
-    0x70, 0x65, 0x6e, 0x64, 0x20, 0x66, 0x6f, 0x72,
-    0x6d, 0x5f, 0x6c, 0x6f, 0x67, 0x20, 0x22, 0x56,
-    0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x64,
-    0x61, 0x74, 0x65, 0x3a, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x22, 0x7a,
-    0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65,
-    0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x64, 0x61,
-    0x74, 0x65, 0x22, 0x5d, 0x22, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
-    0x20, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x6c, 0x6f,
-    0x67, 0x20, 0x5b, 0x6c, 0x6f, 0x67, 0x5d, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70,
-    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x3c, 0x66, 0x6f, 0x72,
-    0x6d, 0x20, 0x61, 0x63, 0x74, 0x69, 0x6f, 0x6e,
-    0x3d, 0x22, 0x73, 0x75, 0x70, 0x70, 0x6f, 0x72,
-    0x74, 0x72, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74,
-    0x2e, 0x74, 0x63, 0x6c, 0x22, 0x20, 0x6d, 0x65,
-    0x74, 0x68, 0x6f, 0x64, 0x3d, 0x22, 0x50, 0x4f,
-    0x53, 0x54, 0x22, 0x20, 0x74, 0x61, 0x72, 0x67,
-    0x65, 0x74, 0x3d, 0x22, 0x5f, 0x62, 0x6c, 0x61,
-    0x6e, 0x6b, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x6c, 0x6f, 0x67, 0x20, 0x5b, 0x6c, 0x6f, 0x67,
+    0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x0d, 0x0a,
+    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c, 0x66,
+    0x6f, 0x72, 0x6d, 0x20, 0x61, 0x63, 0x74, 0x69,
+    0x6f, 0x6e, 0x3d, 0x22, 0x73, 0x75, 0x70, 0x70,
+    0x6f, 0x72, 0x74, 0x72, 0x65, 0x71, 0x75, 0x65,
+    0x73, 0x74, 0x2e, 0x74, 0x63, 0x6c, 0x22, 0x20,
+    0x6d, 0x65, 0x74, 0x68, 0x6f, 0x64, 0x3d, 0x22,
+    0x50, 0x4f, 0x53, 0x54, 0x22, 0x20, 0x74, 0x61,
+    0x72, 0x67, 0x65, 0x74, 0x3d, 0x22, 0x5f, 0x62,
+    0x6c, 0x61, 0x6e, 0x6b, 0x22, 0x3e, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x3c, 0x69, 0x6e, 0x70,
+    0x75, 0x74, 0x20, 0x54, 0x59, 0x50, 0x45, 0x3d,
+    0x22, 0x68, 0x69, 0x64, 0x64, 0x65, 0x6e, 0x22,
+    0x20, 0x4e, 0x41, 0x4d, 0x45, 0x3d, 0x22, 0x69,
+    0x64, 0x22, 0x20, 0x56, 0x41, 0x4c, 0x55, 0x45,
+    0x3d, 0x22, 0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70,
+    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
+    0x65, 0x72, 0x20, 0x24, 0x73, 0x75, 0x70, 0x70,
+    0x6f, 0x72, 0x74, 0x5f, 0x69, 0x64, 0x0d, 0x0a,
+    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x22,
+    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c,
+    0x69, 0x6e, 0x70, 0x75, 0x74, 0x20, 0x54, 0x59,
+    0x50, 0x45, 0x3d, 0x22, 0x68, 0x69, 0x64, 0x64,
+    0x65, 0x6e, 0x22, 0x20, 0x4e, 0x41, 0x4d, 0x45,
+    0x3d, 0x22, 0x73, 0x75, 0x63, 0x63, 0x65, 0x73,
+    0x73, 0x22, 0x20, 0x56, 0x41, 0x4c, 0x55, 0x45,
+    0x3d, 0x22, 0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f,
+    0x2f, 0x77, 0x77, 0x77, 0x2e, 0x7a, 0x79, 0x6c,
+    0x69, 0x6e, 0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x7a,
+    0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x73, 0x75,
+    0x70, 0x70, 0x6f, 0x72, 0x74, 0x2e, 0x68, 0x74,
+    0x6d, 0x6c, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74,
-    0x20, 0x54, 0x59, 0x50, 0x45, 0x3d, 0x22, 0x68,
-    0x69, 0x64, 0x64, 0x65, 0x6e, 0x22, 0x20, 0x4e,
-    0x41, 0x4d, 0x45, 0x3d, 0x22, 0x69, 0x64, 0x22,
-    0x20, 0x56, 0x41, 0x4c, 0x55, 0x45, 0x3d, 0x22,
-    0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
+    0x20, 0x73, 0x69, 0x7a, 0x65, 0x3d, 0x22, 0x35,
+    0x30, 0x22, 0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d,
+    0x22, 0x73, 0x75, 0x62, 0x6a, 0x65, 0x63, 0x74,
+    0x22, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3d, 0x22,
+    0x68, 0x69, 0x64, 0x64, 0x65, 0x6e, 0x22, 0x20,
+    0x76, 0x61, 0x6c, 0x75, 0x65, 0x3d, 0x22, 0x5a,
+    0x59, 0x31, 0x30, 0x30, 0x30, 0x20, 0x73, 0x75,
+    0x70, 0x70, 0x6f, 0x72, 0x74, 0x20, 0x72, 0x65,
+    0x71, 0x75, 0x65, 0x73, 0x74, 0x22, 0x3e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x74, 0x61,
+    0x62, 0x6c, 0x65, 0x20, 0x63, 0x65, 0x6c, 0x6c,
+    0x73, 0x70, 0x61, 0x63, 0x69, 0x6e, 0x67, 0x3d,
+    0x22, 0x35, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74,
+    0x64, 0x3e, 0x53, 0x75, 0x70, 0x70, 0x6f, 0x72,
+    0x74, 0x20, 0x49, 0x44, 0x3c, 0x2f, 0x74, 0x64,
+    0x3e, 0x3c, 0x74, 0x64, 0x3e, 0x7d, 0x0d, 0x0a,
+    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x24, 0x73,
+    0x75, 0x70, 0x70, 0x6f, 0x72, 0x74, 0x5f, 0x69,
+    0x64, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x24, 0x73, 0x75, 0x70, 0x70, 0x6f, 0x72,
-    0x74, 0x5f, 0x69, 0x64, 0x0d, 0x0a, 0x61, 0x70,
-    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x7b, 0x22, 0x3e, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x69, 0x6e,
-    0x70, 0x75, 0x74, 0x20, 0x54, 0x59, 0x50, 0x45,
-    0x3d, 0x22, 0x68, 0x69, 0x64, 0x64, 0x65, 0x6e,
-    0x22, 0x20, 0x4e, 0x41, 0x4d, 0x45, 0x3d, 0x22,
-    0x73, 0x75, 0x63, 0x63, 0x65, 0x73, 0x73, 0x22,
-    0x20, 0x56, 0x41, 0x4c, 0x55, 0x45, 0x3d, 0x22,
-    0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x77,
-    0x77, 0x77, 0x2e, 0x7a, 0x79, 0x6c, 0x69, 0x6e,
-    0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x7a, 0x79, 0x31,
-    0x30, 0x30, 0x30, 0x5f, 0x73, 0x75, 0x70, 0x70,
-    0x6f, 0x72, 0x74, 0x2e, 0x68, 0x74, 0x6d, 0x6c,
-    0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x7b, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c,
+    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74,
+    0x64, 0x3e, 0x43, 0x6f, 0x6e, 0x74, 0x61, 0x63,
+    0x74, 0x20, 0x70, 0x65, 0x72, 0x73, 0x6f, 0x6e,
+    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x74, 0x64,
+    0x3e, 0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74, 0x20,
+    0x73, 0x69, 0x7a, 0x65, 0x3d, 0x22, 0x35, 0x30,
+    0x22, 0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22,
+    0x6e, 0x61, 0x6d, 0x65, 0x22, 0x20, 0x74, 0x79,
+    0x70, 0x65, 0x3d, 0x22, 0x74, 0x65, 0x78, 0x74,
+    0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c,
+    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74,
+    0x64, 0x3e, 0x50, 0x68, 0x6f, 0x6e, 0x65, 0x3c,
+    0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x74, 0x64, 0x3e,
     0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74, 0x20, 0x73,
     0x69, 0x7a, 0x65, 0x3d, 0x22, 0x35, 0x30, 0x22,
-    0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22, 0x73,
-    0x75, 0x62, 0x6a, 0x65, 0x63, 0x74, 0x22, 0x20,
-    0x74, 0x79, 0x70, 0x65, 0x3d, 0x22, 0x68, 0x69,
-    0x64, 0x64, 0x65, 0x6e, 0x22, 0x20, 0x76, 0x61,
-    0x6c, 0x75, 0x65, 0x3d, 0x22, 0x5a, 0x59, 0x31,
-    0x30, 0x30, 0x30, 0x20, 0x73, 0x75, 0x70, 0x70,
-    0x6f, 0x72, 0x74, 0x20, 0x72, 0x65, 0x71, 0x75,
-    0x65, 0x73, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x3c, 0x74, 0x61, 0x62, 0x6c,
-    0x65, 0x20, 0x63, 0x65, 0x6c, 0x6c, 0x73, 0x70,
-    0x61, 0x63, 0x69, 0x6e, 0x67, 0x3d, 0x22, 0x35,
-    0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74, 0x64, 0x3e,
-    0x53, 0x75, 0x70, 0x70, 0x6f, 0x72, 0x74, 0x20,
-    0x49, 0x44, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c,
-    0x74, 0x64, 0x3e, 0x7d, 0x0d, 0x0a, 0x61, 0x70,
-    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x24, 0x73, 0x75, 0x70,
-    0x70, 0x6f, 0x72, 0x74, 0x5f, 0x69, 0x64, 0x0d,
-    0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74, 0x64, 0x3e,
-    0x43, 0x6f, 0x6e, 0x74, 0x61, 0x63, 0x74, 0x20,
-    0x70, 0x65, 0x72, 0x73, 0x6f, 0x6e, 0x3c, 0x2f,
-    0x74, 0x64, 0x3e, 0x3c, 0x74, 0x64, 0x3e, 0x3c,
-    0x69, 0x6e, 0x70, 0x75, 0x74, 0x20, 0x73, 0x69,
-    0x7a, 0x65, 0x3d, 0x22, 0x35, 0x30, 0x22, 0x20,
-    0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22, 0x6e, 0x61,
-    0x6d, 0x65, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65,
-    0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x22, 0x3e,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74, 0x64, 0x3e,
-    0x50, 0x68, 0x6f, 0x6e, 0x65, 0x3c, 0x2f, 0x74,
+    0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22, 0x70,
+    0x68, 0x6f, 0x6e, 0x65, 0x22, 0x20, 0x74, 0x79,
+    0x70, 0x65, 0x3d, 0x22, 0x74, 0x65, 0x78, 0x74,
+    0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c,
+    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74,
+    0x64, 0x3e, 0x65, 0x6d, 0x61, 0x69, 0x6c, 0x3c,
+    0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x74, 0x64, 0x3e,
+    0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74, 0x20, 0x73,
+    0x69, 0x7a, 0x65, 0x3d, 0x22, 0x35, 0x30, 0x22,
+    0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22, 0x65,
+    0x6d, 0x61, 0x69, 0x6c, 0x22, 0x20, 0x74, 0x79,
+    0x70, 0x65, 0x3d, 0x22, 0x74, 0x65, 0x78, 0x74,
+    0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c,
+    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74,
+    0x64, 0x3e, 0x4d, 0x41, 0x43, 0x20, 0x61, 0x64,
+    0x64, 0x72, 0x65, 0x73, 0x73, 0x3c, 0x2f, 0x74,
     0x64, 0x3e, 0x3c, 0x74, 0x64, 0x3e, 0x3c, 0x69,
     0x6e, 0x70, 0x75, 0x74, 0x20, 0x73, 0x69, 0x7a,
     0x65, 0x3d, 0x22, 0x35, 0x30, 0x22, 0x20, 0x6e,
-    0x61, 0x6d, 0x65, 0x3d, 0x22, 0x70, 0x68, 0x6f,
-    0x6e, 0x65, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65,
-    0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x22, 0x3e,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74, 0x64, 0x3e,
-    0x65, 0x6d, 0x61, 0x69, 0x6c, 0x3c, 0x2f, 0x74,
-    0x64, 0x3e, 0x3c, 0x74, 0x64, 0x3e, 0x3c, 0x69,
-    0x6e, 0x70, 0x75, 0x74, 0x20, 0x73, 0x69, 0x7a,
-    0x65, 0x3d, 0x22, 0x35, 0x30, 0x22, 0x20, 0x6e,
-    0x61, 0x6d, 0x65, 0x3d, 0x22, 0x65, 0x6d, 0x61,
-    0x69, 0x6c, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65,
-    0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x22, 0x3e,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x3c, 0x74, 0x72, 0x3e, 0x3c, 0x74, 0x64, 0x3e,
-    0x4d, 0x41, 0x43, 0x20, 0x61, 0x64, 0x64, 0x72,
-    0x65, 0x73, 0x73, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
-    0x3c, 0x74, 0x64, 0x3e, 0x3c, 0x69, 0x6e, 0x70,
-    0x75, 0x74, 0x20, 0x73, 0x69, 0x7a, 0x65, 0x3d,
-    0x22, 0x35, 0x30, 0x22, 0x20, 0x6e, 0x61, 0x6d,
-    0x65, 0x3d, 0x22, 0x73, 0x65, 0x72, 0x69, 0x61,
-    0x6c, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3d,
-    0x22, 0x74, 0x65, 0x78, 0x74, 0x22, 0x20, 0x76,
-    0x61, 0x6c, 0x75, 0x65, 0x3d, 0x22, 0x7d, 0x0d,
-    0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b,
-    0x6d, 0x61, 0x63, 0x5d, 0x0d, 0x0a, 0x61, 0x70,
-    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x7b, 0x22, 0x3e, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f, 0x74, 0x72,
+    0x61, 0x6d, 0x65, 0x3d, 0x22, 0x73, 0x65, 0x72,
+    0x69, 0x61, 0x6c, 0x22, 0x20, 0x74, 0x79, 0x70,
+    0x65, 0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x22,
+    0x20, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x3d, 0x22,
+    0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
+    0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
+    0x20, 0x5b, 0x6d, 0x61, 0x63, 0x5d, 0x0d, 0x0a,
+    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x22,
+    0x3e, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f,
+    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f,
+    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65,
     0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f, 0x74, 0x72,
+    0x70, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x53, 0x75, 0x6d, 0x6d, 0x61, 0x72, 0x79, 0x3a,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x70,
     0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d,
+    0x69, 0x6e, 0x70, 0x75, 0x74, 0x20, 0x6e, 0x61,
+    0x6d, 0x65, 0x3d, 0x22, 0x73, 0x75, 0x6d, 0x6d,
+    0x61, 0x72, 0x79, 0x22, 0x20, 0x73, 0x69, 0x7a,
+    0x65, 0x3d, 0x22, 0x35, 0x30, 0x22, 0x3e, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x70, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x53, 0x75,
-    0x6d, 0x6d, 0x61, 0x72, 0x79, 0x3a, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x3c, 0x70, 0x3e, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x69, 0x6e,
-    0x70, 0x75, 0x74, 0x20, 0x6e, 0x61, 0x6d, 0x65,
-    0x3d, 0x22, 0x73, 0x75, 0x6d, 0x6d, 0x61, 0x72,
-    0x79, 0x22, 0x20, 0x73, 0x69, 0x7a, 0x65, 0x3d,
-    0x22, 0x35, 0x30, 0x22, 0x3e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x3c, 0x70, 0x3e, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x44, 0x65, 0x73, 0x63,
-    0x72, 0x69, 0x70, 0x74, 0x69, 0x6f, 0x6e, 0x3a,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x70,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x74, 0x65, 0x78, 0x74, 0x61, 0x72, 0x65, 0x61,
-    0x20, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x6f, 0x76, 0x65, 0x72, 0x66, 0x6c, 0x6f,
-    0x77, 0x3a, 0x61, 0x75, 0x74, 0x6f, 0x3b, 0x66,
-    0x6f, 0x6e, 0x74, 0x2d, 0x73, 0x69, 0x7a, 0x65,
-    0x3a, 0x31, 0x31, 0x70, 0x78, 0x3b, 0x22, 0x20,
-    0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22, 0x64,
-    0x65, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x69,
-    0x6f, 0x6e, 0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73,
-    0x3d, 0x22, 0x35, 0x30, 0x22, 0x20, 0x72, 0x6f,
-    0x77, 0x73, 0x3d, 0x22, 0x34, 0x22, 0x20, 0x74,
-    0x79, 0x70, 0x65, 0x3d, 0x22, 0x74, 0x65, 0x78,
-    0x74, 0x61, 0x72, 0x65, 0x61, 0x22, 0x20, 0x77,
-    0x72, 0x61, 0x70, 0x3d, 0x22, 0x6f, 0x66, 0x66,
-    0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x65, 0x78, 0x74,
-    0x61, 0x72, 0x65, 0x61, 0x3e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x3c, 0x70, 0x3e, 0x09, 0x09, 0x09, 0x09,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x4c, 0x6f,
-    0x67, 0x3a, 0x3c, 0x70, 0x3e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x3c, 0x74, 0x65, 0x78, 0x74,
-    0x61, 0x72, 0x65, 0x61, 0x20, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x6f, 0x76, 0x65,
-    0x72, 0x66, 0x6c, 0x6f, 0x77, 0x3a, 0x61, 0x75,
-    0x74, 0x6f, 0x3b, 0x66, 0x6f, 0x6e, 0x74, 0x2d,
-    0x73, 0x69, 0x7a, 0x65, 0x3a, 0x31, 0x31, 0x70,
-    0x78, 0x3b, 0x22, 0x20, 0x20, 0x6e, 0x61, 0x6d,
-    0x65, 0x3d, 0x22, 0x6c, 0x6f, 0x67, 0x22, 0x20,
-    0x63, 0x6f, 0x6c, 0x73, 0x3d, 0x22, 0x35, 0x30,
-    0x22, 0x20, 0x72, 0x6f, 0x77, 0x73, 0x3d, 0x22,
-    0x35, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3d,
-    0x22, 0x74, 0x65, 0x78, 0x74, 0x61, 0x72, 0x65,
-    0x61, 0x22, 0x20, 0x77, 0x72, 0x61, 0x70, 0x3d,
-    0x22, 0x6f, 0x66, 0x66, 0x22, 0x3e, 0x7d, 0x0d,
-    0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x24,
-    0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x6c, 0x6f, 0x67,
-    0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
-    0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
-    0x7b, 0x3c, 0x2f, 0x74, 0x65, 0x78, 0x74, 0x61,
-    0x72, 0x65, 0x61, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x3c, 0x70, 0x3e, 0x09, 0x09, 0x09,
-    0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x43,
-    0x6f, 0x6e, 0x66, 0x69, 0x67, 0x3a, 0x3c, 0x70,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x74, 0x65, 0x78, 0x74, 0x61, 0x72, 0x65, 0x61,
-    0x20, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x6f, 0x76, 0x65, 0x72, 0x66, 0x6c, 0x6f,
-    0x77, 0x3a, 0x61, 0x75, 0x74, 0x6f, 0x3b, 0x66,
-    0x6f, 0x6e, 0x74, 0x2d, 0x73, 0x69, 0x7a, 0x65,
-    0x3a, 0x31, 0x31, 0x70, 0x78, 0x3b, 0x22, 0x20,
-    0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d, 0x22, 0x63,
-    0x6f, 0x6e, 0x66, 0x69, 0x67, 0x22, 0x20, 0x63,
-    0x6f, 0x6c, 0x73, 0x3d, 0x22, 0x35, 0x30, 0x22,
-    0x20, 0x72, 0x6f, 0x77, 0x73, 0x3d, 0x22, 0x35,
-    0x22, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3d, 0x22,
-    0x74, 0x65, 0x78, 0x74, 0x61, 0x72, 0x65, 0x61,
-    0x22, 0x20, 0x77, 0x72, 0x61, 0x70, 0x3d, 0x22,
-    0x6f, 0x66, 0x66, 0x22, 0x3e, 0x7d, 0x0d, 0x0a,
-    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
-    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x24, 0x66,
-    0x6f, 0x72, 0x6d, 0x5f, 0x63, 0x6f, 0x6e, 0x66,
-    0x69, 0x67, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x44, 0x65,
+    0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x69, 0x6f,
+    0x6e, 0x3a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x3c, 0x70, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x3c, 0x74, 0x65, 0x78, 0x74, 0x61, 0x72,
+    0x65, 0x61, 0x20, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x6f, 0x76, 0x65, 0x72, 0x66,
+    0x6c, 0x6f, 0x77, 0x3a, 0x61, 0x75, 0x74, 0x6f,
+    0x3b, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x73, 0x69,
+    0x7a, 0x65, 0x3a, 0x31, 0x31, 0x70, 0x78, 0x3b,
+    0x22, 0x20, 0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d,
+    0x22, 0x64, 0x65, 0x73, 0x63, 0x72, 0x69, 0x70,
+    0x74, 0x69, 0x6f, 0x6e, 0x22, 0x20, 0x63, 0x6f,
+    0x6c, 0x73, 0x3d, 0x22, 0x35, 0x30, 0x22, 0x20,
+    0x72, 0x6f, 0x77, 0x73, 0x3d, 0x22, 0x34, 0x22,
+    0x20, 0x74, 0x79, 0x70, 0x65, 0x3d, 0x22, 0x74,
+    0x65, 0x78, 0x74, 0x61, 0x72, 0x65, 0x61, 0x22,
+    0x20, 0x77, 0x72, 0x61, 0x70, 0x3d, 0x22, 0x6f,
+    0x66, 0x66, 0x22, 0x3e, 0x3c, 0x2f, 0x74, 0x65,
+    0x78, 0x74, 0x61, 0x72, 0x65, 0x61, 0x3e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x3c, 0x70, 0x3e, 0x09, 0x09,
+    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x4c, 0x6f, 0x67, 0x3a, 0x3c, 0x70, 0x3e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x74, 0x65,
+    0x78, 0x74, 0x61, 0x72, 0x65, 0x61, 0x20, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x6f,
+    0x76, 0x65, 0x72, 0x66, 0x6c, 0x6f, 0x77, 0x3a,
+    0x61, 0x75, 0x74, 0x6f, 0x3b, 0x66, 0x6f, 0x6e,
+    0x74, 0x2d, 0x73, 0x69, 0x7a, 0x65, 0x3a, 0x31,
+    0x31, 0x70, 0x78, 0x3b, 0x22, 0x20, 0x20, 0x6e,
+    0x61, 0x6d, 0x65, 0x3d, 0x22, 0x6c, 0x6f, 0x67,
+    0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73, 0x3d, 0x22,
+    0x35, 0x30, 0x22, 0x20, 0x72, 0x6f, 0x77, 0x73,
+    0x3d, 0x22, 0x35, 0x22, 0x20, 0x74, 0x79, 0x70,
+    0x65, 0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x61,
+    0x72, 0x65, 0x61, 0x22, 0x20, 0x77, 0x72, 0x61,
+    0x70, 0x3d, 0x22, 0x6f, 0x66, 0x66, 0x22, 0x3e,
+    0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
+    0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
+    0x20, 0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x6c,
+    0x6f, 0x67, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
     0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
     0x72, 0x20, 0x7b, 0x3c, 0x2f, 0x74, 0x65, 0x78,
     0x74, 0x61, 0x72, 0x65, 0x61, 0x3e, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x3c, 0x70, 0x3e, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x3c, 0x2f, 0x66, 0x6f,
-    0x72, 0x6d, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x3c, 0x70, 0x3e, 0x09,
+    0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x43, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x3a,
     0x3c, 0x70, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74, 0x20, 0x76,
-    0x61, 0x6c, 0x75, 0x65, 0x3d, 0x22, 0x43, 0x72,
-    0x65, 0x61, 0x74, 0x65, 0x73, 0x20, 0x73, 0x75,
-    0x70, 0x70, 0x6f, 0x72, 0x74, 0x20, 0x72, 0x65,
-    0x71, 0x75, 0x65, 0x73, 0x74, 0x22, 0x20, 0x74,
-    0x79, 0x70, 0x65, 0x3d, 0x22, 0x73, 0x75, 0x62,
-    0x6d, 0x69, 0x74, 0x22, 0x2f, 0x3e, 0x3c, 0x2f,
-    0x74, 0x64, 0x3e, 0x3c, 0x2f, 0x74, 0x72, 0x3e,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x3c, 0x2f, 0x74, 0x64,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e,
-    0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
+    0x09, 0x3c, 0x74, 0x65, 0x78, 0x74, 0x61, 0x72,
+    0x65, 0x61, 0x20, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x6f, 0x76, 0x65, 0x72, 0x66,
+    0x6c, 0x6f, 0x77, 0x3a, 0x61, 0x75, 0x74, 0x6f,
+    0x3b, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x73, 0x69,
+    0x7a, 0x65, 0x3a, 0x31, 0x31, 0x70, 0x78, 0x3b,
+    0x22, 0x20, 0x20, 0x6e, 0x61, 0x6d, 0x65, 0x3d,
+    0x22, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x22,
+    0x20, 0x63, 0x6f, 0x6c, 0x73, 0x3d, 0x22, 0x35,
+    0x30, 0x22, 0x20, 0x72, 0x6f, 0x77, 0x73, 0x3d,
+    0x22, 0x35, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65,
+    0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x61, 0x72,
+    0x65, 0x61, 0x22, 0x20, 0x77, 0x72, 0x61, 0x70,
+    0x3d, 0x22, 0x6f, 0x66, 0x66, 0x22, 0x3e, 0x7d,
+    0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
+    0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
+    0x24, 0x66, 0x6f, 0x72, 0x6d, 0x5f, 0x63, 0x6f,
+    0x6e, 0x66, 0x69, 0x67, 0x0d, 0x0a, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x7b, 0x3c, 0x2f, 0x74,
+    0x65, 0x78, 0x74, 0x61, 0x72, 0x65, 0x61, 0x3e,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x70,
+    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c, 0x2f,
+    0x66, 0x6f, 0x72, 0x6d, 0x3e, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x3c, 0x70, 0x3e, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x3c, 0x69, 0x6e, 0x70, 0x75, 0x74,
+    0x20, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x3d, 0x22,
+    0x43, 0x72, 0x65, 0x61, 0x74, 0x65, 0x73, 0x20,
+    0x73, 0x75, 0x70, 0x70, 0x6f, 0x72, 0x74, 0x20,
+    0x72, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x22,
+    0x20, 0x74, 0x79, 0x70, 0x65, 0x3d, 0x22, 0x73,
+    0x75, 0x62, 0x6d, 0x69, 0x74, 0x22, 0x2f, 0x3e,
+    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x3c, 0x2f, 0x74,
+    0x72, 0x3e, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x3c, 0x2f,
+    0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
+    0x72, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x73,
+    0x65, 0x74, 0x20, 0x74, 0x6f, 0x67, 0x67, 0x6c,
+    0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
+    0x73, 0x20, 0x5b, 0x66, 0x6f, 0x72, 0x6d, 0x66,
+    0x65, 0x74, 0x63, 0x68, 0x20, 0x74, 0x6f, 0x67,
+    0x67, 0x6c, 0x65, 0x5f, 0x64, 0x65, 0x74, 0x61,
+    0x69, 0x6c, 0x73, 0x5d, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x73, 0x65, 0x74,
-    0x20, 0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65, 0x5f,
-    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x20,
-    0x5b, 0x66, 0x6f, 0x72, 0x6d, 0x66, 0x65, 0x74,
-    0x63, 0x68, 0x20, 0x74, 0x6f, 0x67, 0x67, 0x6c,
-    0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x69, 0x66,
-    0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e,
-    0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68,
-    0x20, 0x24, 0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65,
+    0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72,
+    0x69, 0x6e, 0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67,
+    0x74, 0x68, 0x20, 0x24, 0x74, 0x6f, 0x67, 0x67,
+    0x6c, 0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69,
+    0x6c, 0x73, 0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20,
+    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x73, 0x65,
+    0x74, 0x20, 0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65,
     0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73,
-    0x5d, 0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0d,
+    0x20, 0x30, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x7d, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x20, 0x09, 0x73, 0x65, 0x74, 0x20, 0x73,
+    0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61,
+    0x69, 0x6c, 0x73, 0x20, 0x5b, 0x6c, 0x6f, 0x61,
+    0x64, 0x5f, 0x76, 0x61, 0x72, 0x20, 0x73, 0x68,
+    0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69,
+    0x6c, 0x73, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x69,
+    0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69,
+    0x6e, 0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74,
+    0x68, 0x20, 0x24, 0x73, 0x68, 0x6f, 0x77, 0x5f,
+    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x5d,
+    0x3d, 0x3d, 0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x73,
+    0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61,
+    0x69, 0x6c, 0x73, 0x20, 0x30, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
+    0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x69, 0x66,
+    0x20, 0x7b, 0x24, 0x74, 0x6f, 0x67, 0x67, 0x6c,
+    0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
+    0x73, 0x3d, 0x3d, 0x31, 0x7d, 0x20, 0x7b, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x20, 0x09, 0x09, 0x73, 0x65, 0x74, 0x20,
-    0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65, 0x5f, 0x64,
-    0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x20, 0x30,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x20, 0x09, 0x7d, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x09, 0x73, 0x65, 0x74, 0x20, 0x73, 0x68, 0x6f,
-    0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x20, 0x5b, 0x6c, 0x6f, 0x61, 0x64, 0x5f,
-    0x76, 0x61, 0x72, 0x20, 0x73, 0x68, 0x6f, 0x77,
-    0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73,
-    0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x69, 0x66, 0x20,
-    0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67,
-    0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68, 0x20,
-    0x24, 0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65,
-    0x74, 0x61, 0x69, 0x6c, 0x73, 0x5d, 0x3d, 0x3d,
-    0x30, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x73, 0x65, 0x74, 0x20, 0x73, 0x68, 0x6f,
-    0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x20, 0x30, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x7d,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x20, 0x09, 0x69, 0x66, 0x20, 0x7b,
-    0x24, 0x74, 0x6f, 0x67, 0x67, 0x6c, 0x65, 0x5f,
-    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x3d,
-    0x3d, 0x31, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x09, 0x09, 0x73, 0x65, 0x74, 0x20, 0x73, 0x68,
+    0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74,
+    0x61, 0x69, 0x6c, 0x73, 0x20, 0x5b, 0x65, 0x78,
+    0x70, 0x72, 0x20, 0x31, 0x2d, 0x24, 0x73, 0x68,
     0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69,
-    0x6c, 0x73, 0x20, 0x5b, 0x65, 0x78, 0x70, 0x72,
-    0x20, 0x31, 0x2d, 0x24, 0x73, 0x68, 0x6f, 0x77,
-    0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73,
-    0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x73, 0x61,
-    0x76, 0x65, 0x5f, 0x76, 0x61, 0x72, 0x20, 0x73,
+    0x6c, 0x73, 0x5d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
+    0x73, 0x61, 0x76, 0x65, 0x5f, 0x76, 0x61, 0x72,
+    0x20, 0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65,
+    0x74, 0x61, 0x69, 0x6c, 0x73, 0x20, 0x24, 0x73,
     0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61,
-    0x69, 0x6c, 0x73, 0x20, 0x24, 0x73, 0x68, 0x6f,
-    0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x7d, 0x0d, 0x0a,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x69, 0x66,
-    0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72, 0x69, 0x6e,
-    0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68,
-    0x20, 0x24, 0x63, 0x6f, 0x6e, 0x73, 0x6f, 0x6c,
-    0x65, 0x5d, 0x21, 0x3d, 0x30, 0x7d, 0x20, 0x7b,
+    0x69, 0x6c, 0x73, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x7d,
     0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x20, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61,
-    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a,
-    0x3c, 0x74, 0x72, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x68, 0x65, 0x69, 0x67, 0x68,
-    0x74, 0x3a, 0x31, 0x30, 0x30, 0x25, 0x3b, 0x22,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73,
-    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65,
-    0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x30, 0x30,
-    0x25, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
-    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c,
-    0x6f, 0x72, 0x3a, 0x72, 0x65, 0x64, 0x3b, 0x22,
-    0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e,
-    0x3d, 0x22, 0x36, 0x22, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x74, 0x61, 0x62, 0x6c, 0x65, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70, 0x61, 0x64,
-    0x64, 0x69, 0x6e, 0x67, 0x3a, 0x30, 0x70, 0x78,
-    0x3b, 0x62, 0x6f, 0x72, 0x64, 0x65, 0x72, 0x2d,
-    0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73, 0x65,
-    0x3a, 0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73,
-    0x65, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
-    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c,
-    0x6f, 0x72, 0x3a, 0x23, 0x66, 0x66, 0x66, 0x66,
-    0x66, 0x66, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3a, 0x31, 0x30, 0x30, 0x25, 0x22, 0x20, 0x63,
-    0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x74, 0x65,
-    0x78, 0x74, 0x67, 0x72, 0x61, 0x79, 0x22, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69, 0x64,
-    0x74, 0x68, 0x3a, 0x32, 0x35, 0x70, 0x78, 0x3b,
-    0x22, 0x3e, 0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x7d,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x24,
-    0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74,
-    0x61, 0x69, 0x6c, 0x73, 0x3d, 0x3d, 0x31, 0x7d,
+    0x09, 0x09, 0x20, 0x09, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
+    0x69, 0x66, 0x20, 0x7b, 0x5b, 0x73, 0x74, 0x72,
+    0x69, 0x6e, 0x67, 0x20, 0x6c, 0x65, 0x6e, 0x67,
+    0x74, 0x68, 0x20, 0x24, 0x63, 0x6f, 0x6e, 0x73,
+    0x6f, 0x6c, 0x65, 0x5d, 0x21, 0x3d, 0x30, 0x7d,
     0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x0d,
+    0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
+    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
+    0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65, 0x69,
+    0x67, 0x68, 0x74, 0x3a, 0x31, 0x30, 0x30, 0x25,
+    0x3b, 0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
+    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
+    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31,
+    0x30, 0x30, 0x25, 0x3b, 0x62, 0x61, 0x63, 0x6b,
+    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63,
+    0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x72, 0x65, 0x64,
+    0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70,
+    0x61, 0x6e, 0x3d, 0x22, 0x36, 0x22, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70,
+    0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x3a, 0x30,
+    0x70, 0x78, 0x3b, 0x62, 0x6f, 0x72, 0x64, 0x65,
+    0x72, 0x2d, 0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70,
+    0x73, 0x65, 0x3a, 0x63, 0x6f, 0x6c, 0x6c, 0x61,
+    0x70, 0x73, 0x65, 0x3b, 0x62, 0x61, 0x63, 0x6b,
+    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63,
+    0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x66, 0x66,
+    0x66, 0x66, 0x66, 0x66, 0x3b, 0x77, 0x69, 0x64,
+    0x74, 0x68, 0x3a, 0x31, 0x30, 0x30, 0x25, 0x22,
+    0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22,
+    0x74, 0x65, 0x78, 0x74, 0x67, 0x72, 0x61, 0x79,
+    0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x77,
+    0x69, 0x64, 0x74, 0x68, 0x3a, 0x32, 0x35, 0x70,
+    0x78, 0x3b, 0x22, 0x3e, 0x26, 0x6e, 0x62, 0x73,
+    0x70, 0x3b, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
+    0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x3c, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x20, 0x09, 0x09, 0x69, 0x66, 0x20,
+    0x7b, 0x24, 0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64,
+    0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x3d, 0x3d,
+    0x31, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
-    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x7b, 0x74, 0x64, 0x20, 0x73,
-    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61,
-    0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64,
-    0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23,
-    0x64, 0x64, 0x64, 0x64, 0x64, 0x64, 0x3b, 0x70,
-    0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d, 0x6c,
-    0x65, 0x66, 0x74, 0x3a, 0x35, 0x70, 0x78, 0x3b,
-    0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d,
-    0x72, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x35, 0x70,
+    0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x3c, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x61,
+    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x74, 0x64,
+    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
+    0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75,
+    0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72,
+    0x3a, 0x23, 0x64, 0x64, 0x64, 0x64, 0x64, 0x64,
+    0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67,
+    0x2d, 0x6c, 0x65, 0x66, 0x74, 0x3a, 0x35, 0x70,
     0x78, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
-    0x67, 0x2d, 0x74, 0x6f, 0x70, 0x3a, 0x33, 0x70,
-    0x78, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
-    0x67, 0x2d, 0x62, 0x6f, 0x74, 0x74, 0x6f, 0x6d,
-    0x3a, 0x33, 0x70, 0x78, 0x3b, 0x22, 0x7d, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
-    0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x7d, 0x20, 0x65, 0x6c, 0x73, 0x65, 0x20,
-    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x67, 0x2d, 0x72, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x35, 0x70, 0x78, 0x3b, 0x70, 0x61, 0x64, 0x64,
+    0x69, 0x6e, 0x67, 0x2d, 0x74, 0x6f, 0x70, 0x3a,
+    0x33, 0x70, 0x78, 0x3b, 0x70, 0x61, 0x64, 0x64,
+    0x69, 0x6e, 0x67, 0x2d, 0x62, 0x6f, 0x74, 0x74,
+    0x6f, 0x6d, 0x3a, 0x33, 0x70, 0x78, 0x3b, 0x22,
+    0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
     0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x3c, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x7b, 0x74, 0x64, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63,
-    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
-    0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a, 0x75, 0x72,
-    0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f,
-    0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74,
-    0x73, 0x2f, 0x68, 0x5f, 0x74, 0x61, 0x62, 0x5f,
-    0x66, 0x72, 0x65, 0x65, 0x2e, 0x70, 0x6e, 0x67,
-    0x27, 0x29, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3a, 0x31, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x68,
-    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x32, 0x39,
-    0x70, 0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67,
-    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x72, 0x65,
-    0x70, 0x65, 0x61, 0x74, 0x3a, 0x20, 0x6e, 0x6f,
-    0x2d, 0x72, 0x65, 0x70, 0x65, 0x61, 0x74, 0x3b,
-    0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75,
-    0x6e, 0x64, 0x2d, 0x70, 0x6f, 0x73, 0x69, 0x74,
-    0x69, 0x6f, 0x6e, 0x3a, 0x74, 0x6f, 0x70, 0x20,
-    0x6c, 0x65, 0x66, 0x74, 0x3b, 0x22, 0x7d, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
-    0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x09, 0x09, 0x7d, 0x20, 0x65, 0x6c, 0x73,
+    0x65, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c, 0x61, 0x20,
-    0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x6f,
-    0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x22, 0x20,
-    0x68, 0x72, 0x65, 0x66, 0x3d, 0x22, 0x2f, 0x72,
-    0x61, 0x6d, 0x2f, 0x63, 0x67, 0x69, 0x2f, 0x73,
-    0x75, 0x70, 0x70, 0x6f, 0x72, 0x74, 0x2e, 0x74,
-    0x63, 0x6c, 0x3f, 0x74, 0x6f, 0x67, 0x67, 0x6c,
-    0x65, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x3d, 0x31, 0x22, 0x3e, 0x0d, 0x0a, 0x7d,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
+    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
+    0x65, 0x72, 0x20, 0x3c, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x24,
-    0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74,
-    0x61, 0x69, 0x6c, 0x73, 0x3d, 0x3d, 0x31, 0x7d,
-    0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x22, 0x48, 0x69, 0x64, 0x65, 0x20,
-    0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x22,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x7b, 0x74, 0x64, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62,
+    0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e,
+    0x64, 0x2d, 0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a,
+    0x75, 0x72, 0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f,
+    0x6d, 0x2f, 0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63,
+    0x75, 0x74, 0x73, 0x2f, 0x68, 0x5f, 0x74, 0x61,
+    0x62, 0x5f, 0x66, 0x72, 0x65, 0x65, 0x2e, 0x70,
+    0x6e, 0x67, 0x27, 0x29, 0x3b, 0x77, 0x69, 0x64,
+    0x74, 0x68, 0x3a, 0x31, 0x31, 0x30, 0x70, 0x78,
+    0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x32, 0x39, 0x70, 0x78, 0x3b, 0x62, 0x61, 0x63,
+    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
+    0x72, 0x65, 0x70, 0x65, 0x61, 0x74, 0x3a, 0x20,
+    0x6e, 0x6f, 0x2d, 0x72, 0x65, 0x70, 0x65, 0x61,
+    0x74, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
+    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x70, 0x6f, 0x73,
+    0x69, 0x74, 0x69, 0x6f, 0x6e, 0x3a, 0x74, 0x6f,
+    0x70, 0x20, 0x6c, 0x65, 0x66, 0x74, 0x3b, 0x22,
+    0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
     0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x3c, 0x62, 0x72, 0x2f, 0x3e, 0x0d, 0x0a,
+    0x20, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x7d,
-    0x20, 0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
-    0x3c, 0x64, 0x69, 0x76, 0x20, 0x73, 0x74, 0x79,
-    0x6c, 0x65, 0x3d, 0x22, 0x70, 0x6f, 0x73, 0x69,
-    0x74, 0x69, 0x6f, 0x6e, 0x3a, 0x72, 0x65, 0x6c,
-    0x61, 0x74, 0x69, 0x76, 0x65, 0x3b, 0x74, 0x6f,
-    0x70, 0x3a, 0x37, 0x70, 0x78, 0x3b, 0x74, 0x65,
-    0x78, 0x74, 0x2d, 0x61, 0x6c, 0x69, 0x67, 0x6e,
-    0x3a, 0x63, 0x65, 0x6e, 0x74, 0x65, 0x72, 0x3b,
-    0x22, 0x3e, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x20, 0x09, 0x0d, 0x0a, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c,
+    0x61, 0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d,
+    0x22, 0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64,
+    0x22, 0x20, 0x68, 0x72, 0x65, 0x66, 0x3d, 0x22,
+    0x2f, 0x72, 0x61, 0x6d, 0x2f, 0x63, 0x67, 0x69,
+    0x2f, 0x73, 0x75, 0x70, 0x70, 0x6f, 0x72, 0x74,
+    0x2e, 0x74, 0x63, 0x6c, 0x3f, 0x74, 0x6f, 0x67,
+    0x67, 0x6c, 0x65, 0x5f, 0x64, 0x65, 0x74, 0x61,
+    0x69, 0x6c, 0x73, 0x3d, 0x31, 0x22, 0x3e, 0x0d,
+    0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x69, 0x66, 0x20,
+    0x7b, 0x24, 0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64,
+    0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x3d, 0x3d,
+    0x31, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x22, 0x48, 0x69, 0x64,
+    0x65, 0x20, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
+    0x73, 0x22, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
     0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
-    0x65, 0x72, 0x20, 0x22, 0x53, 0x68, 0x6f, 0x77,
-    0x20, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73,
-    0x22, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x65, 0x72, 0x20, 0x3c, 0x62, 0x72, 0x2f, 0x3e,
+    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x7d, 0x20, 0x65, 0x6c, 0x73, 0x65, 0x20,
+    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x7b, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e,
-    0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x20, 0x7b, 0x3c, 0x64, 0x69, 0x76, 0x20, 0x73,
+    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70, 0x6f,
+    0x73, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x3a, 0x72,
+    0x65, 0x6c, 0x61, 0x74, 0x69, 0x76, 0x65, 0x3b,
+    0x74, 0x6f, 0x70, 0x3a, 0x37, 0x70, 0x78, 0x3b,
+    0x74, 0x65, 0x78, 0x74, 0x2d, 0x61, 0x6c, 0x69,
+    0x67, 0x6e, 0x3a, 0x63, 0x65, 0x6e, 0x74, 0x65,
+    0x72, 0x3b, 0x22, 0x3e, 0x7d, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x61,
+    0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x22, 0x53, 0x68,
+    0x6f, 0x77, 0x20, 0x64, 0x65, 0x74, 0x61, 0x69,
+    0x6c, 0x73, 0x22, 0x0d, 0x0a, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70,
-    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
-    0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x61, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x09, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x24, 0x73,
-    0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61,
-    0x69, 0x6c, 0x73, 0x3d, 0x3d, 0x31, 0x7d, 0x20,
-    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70,
+    0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66,
+    0x65, 0x72, 0x20, 0x7b, 0x3c, 0x2f, 0x64, 0x69,
+    0x76, 0x3e, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x09, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x24, 0x63, 0x6f, 0x6e, 0x73, 0x6f,
-    0x6c, 0x65, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x20, 0x09, 0x09, 0x7d, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a,
+    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x61, 0x3e, 0x0d, 0x0a, 0x7d,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x0d, 0x0a,
-    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
-    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x7d, 0x0d, 0x0a, 0x0d,
+    0x09, 0x20, 0x09, 0x09, 0x69, 0x66, 0x20, 0x7b,
+    0x24, 0x73, 0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65,
+    0x74, 0x61, 0x69, 0x6c, 0x73, 0x3d, 0x3d, 0x31,
+    0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x61, 0x70,
+    0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x20, 0x24, 0x63, 0x6f, 0x6e,
+    0x73, 0x6f, 0x6c, 0x65, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x7d, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x69, 0x66, 0x20, 0x7b, 0x24, 0x73, 0x68, 0x6f,
-    0x77, 0x5f, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c,
-    0x73, 0x21, 0x3d, 0x31, 0x7d, 0x20, 0x7b, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
-    0x09, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20,
-    0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b,
-    0x3c, 0x74, 0x64, 0x3e, 0x26, 0x6e, 0x62, 0x73,
-    0x70, 0x3b, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x7d,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e, 0x64,
+    0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72, 0x20,
+    0x7b, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x7d, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x20, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65,
-    0x6e, 0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
-    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
-    0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x32, 0x35,
-    0x70, 0x78, 0x3b, 0x22, 0x3e, 0x26, 0x6e, 0x62,
-    0x73, 0x70, 0x3b, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c,
-    0x65, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e,
-    0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
+    0x20, 0x09, 0x69, 0x66, 0x20, 0x7b, 0x24, 0x73,
+    0x68, 0x6f, 0x77, 0x5f, 0x64, 0x65, 0x74, 0x61,
+    0x69, 0x6c, 0x73, 0x21, 0x3d, 0x31, 0x7d, 0x20,
+    0x7b, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
     0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x20, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x61, 0x70,
+    0x20, 0x09, 0x09, 0x61, 0x70, 0x70, 0x65, 0x6e,
+    0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
+    0x20, 0x7b, 0x3c, 0x74, 0x64, 0x3e, 0x26, 0x6e,
+    0x62, 0x73, 0x70, 0x3b, 0x3c, 0x2f, 0x74, 0x64,
+    0x3e, 0x7d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x20, 0x09, 0x7d, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x0d, 0x0a, 0x61, 0x70,
     0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75, 0x66,
     0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d, 0x0a, 0x3c,
-    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
-    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
-    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x33,
-    0x30, 0x70, 0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b,
-    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x69,
-    0x6d, 0x61, 0x67, 0x65, 0x3a, 0x75, 0x72, 0x6c,
-    0x28, 0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x6d,
-    0x65, 0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74, 0x73,
-    0x2f, 0x63, 0x65, 0x6e, 0x74, 0x65, 0x72, 0x5f,
-    0x62, 0x6f, 0x74, 0x74, 0x6f, 0x6d, 0x2e, 0x70,
-    0x6e, 0x67, 0x27, 0x29, 0x3b, 0x62, 0x61, 0x63,
-    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
-    0x72, 0x65, 0x70, 0x65, 0x61, 0x74, 0x3a, 0x20,
-    0x6e, 0x6f, 0x2d, 0x72, 0x65, 0x70, 0x65, 0x61,
-    0x74, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
-    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x70, 0x6f, 0x73,
-    0x69, 0x74, 0x69, 0x6f, 0x6e, 0x3a, 0x74, 0x6f,
-    0x70, 0x20, 0x72, 0x69, 0x67, 0x68, 0x74, 0x3b,
-    0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61,
-    0x6e, 0x3d, 0x22, 0x36, 0x22, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x64, 0x69, 0x76, 0x20, 0x73, 0x74, 0x79,
-    0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69, 0x64, 0x74,
-    0x68, 0x3a, 0x35, 0x30, 0x30, 0x70, 0x78, 0x3b,
-    0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75,
-    0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72,
-    0x3a, 0x23, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66,
-    0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
-    0x31, 0x30, 0x30, 0x25, 0x3b, 0x22, 0x3e, 0x0d,
+    0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
+    0x3d, 0x22, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a,
+    0x32, 0x35, 0x70, 0x78, 0x3b, 0x22, 0x3e, 0x26,
+    0x6e, 0x62, 0x73, 0x70, 0x3b, 0x3c, 0x2f, 0x74,
+    0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x61,
+    0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
+    0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
+    0x72, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d,
     0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x20, 0x09, 0x09, 0x09, 0x26, 0x6e, 0x62,
-    0x73, 0x70, 0x3b, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x09,
-    0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x09, 0x09, 0x20, 0x7d, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a,
+    0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x7b, 0x0d,
+    0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
     0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
-    0x3d, 0x22, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a,
-    0x36, 0x70, 0x78, 0x3b, 0x22, 0x2f, 0x3e, 0x0d,
+    0x3d, 0x22, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74,
+    0x3a, 0x33, 0x30, 0x70, 0x78, 0x3b, 0x62, 0x61,
+    0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64,
+    0x2d, 0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a, 0x75,
+    0x72, 0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f, 0x6d,
+    0x2f, 0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63, 0x75,
+    0x74, 0x73, 0x2f, 0x63, 0x65, 0x6e, 0x74, 0x65,
+    0x72, 0x5f, 0x62, 0x6f, 0x74, 0x74, 0x6f, 0x6d,
+    0x2e, 0x70, 0x6e, 0x67, 0x27, 0x29, 0x3b, 0x62,
+    0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e,
+    0x64, 0x2d, 0x72, 0x65, 0x70, 0x65, 0x61, 0x74,
+    0x3a, 0x20, 0x6e, 0x6f, 0x2d, 0x72, 0x65, 0x70,
+    0x65, 0x61, 0x74, 0x3b, 0x62, 0x61, 0x63, 0x6b,
+    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x70,
+    0x6f, 0x73, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x3a,
+    0x74, 0x6f, 0x70, 0x20, 0x72, 0x69, 0x67, 0x68,
+    0x74, 0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73,
+    0x70, 0x61, 0x6e, 0x3d, 0x22, 0x36, 0x22, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x64, 0x69, 0x76, 0x20, 0x73,
+    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69,
+    0x64, 0x74, 0x68, 0x3a, 0x35, 0x30, 0x30, 0x70,
+    0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
+    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c,
+    0x6f, 0x72, 0x3a, 0x23, 0x66, 0x66, 0x66, 0x66,
+    0x66, 0x66, 0x3b, 0x68, 0x65, 0x69, 0x67, 0x68,
+    0x74, 0x3a, 0x31, 0x30, 0x30, 0x25, 0x3b, 0x22,
+    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x26,
+    0x6e, 0x62, 0x73, 0x70, 0x3b, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
+    0x09, 0x09, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
     0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79,
     0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69, 0x64, 0x74,
-    0x68, 0x3a, 0x32, 0x34, 0x35, 0x70, 0x78, 0x3b,
-    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31,
-    0x30, 0x30, 0x25, 0x22, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x74, 0x61, 0x62, 0x6c, 0x65, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70, 0x61, 0x64,
-    0x64, 0x69, 0x6e, 0x67, 0x3a, 0x30, 0x70, 0x78,
-    0x3b, 0x62, 0x6f, 0x72, 0x64, 0x65, 0x72, 0x2d,
-    0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73, 0x65,
-    0x3a, 0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73,
-    0x65, 0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74,
-    0x3a, 0x31, 0x30, 0x30, 0x25, 0x3b, 0x22, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3a, 0x31, 0x30, 0x33, 0x70, 0x78, 0x3b, 0x68,
-    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x32, 0x39,
-    0x70, 0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67,
-    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x69, 0x6d,
-    0x61, 0x67, 0x65, 0x3a, 0x75, 0x72, 0x6c, 0x28,
-    0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x6d, 0x65,
-    0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74, 0x73, 0x2f,
-    0x68, 0x5f, 0x74, 0x61, 0x62, 0x32, 0x5f, 0x73,
-    0x65, 0x6c, 0x65, 0x63, 0x74, 0x65, 0x64, 0x2e,
-    0x70, 0x6e, 0x67, 0x27, 0x29, 0x3b, 0x62, 0x61,
-    0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64,
-    0x2d, 0x72, 0x65, 0x70, 0x65, 0x61, 0x74, 0x3a,
-    0x20, 0x6e, 0x6f, 0x2d, 0x72, 0x65, 0x70, 0x65,
-    0x61, 0x74, 0x3b, 0x22, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x64, 0x69, 0x76, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x70, 0x6f, 0x73, 0x69, 0x74,
-    0x69, 0x6f, 0x6e, 0x3a, 0x72, 0x65, 0x6c, 0x61,
-    0x74, 0x69, 0x76, 0x65, 0x3b, 0x74, 0x6f, 0x70,
-    0x3a, 0x37, 0x70, 0x78, 0x3b, 0x3b, 0x66, 0x6f,
-    0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68,
-    0x74, 0x3a, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x74,
-    0x65, 0x78, 0x74, 0x2d, 0x61, 0x6c, 0x69, 0x67,
-    0x6e, 0x3a, 0x63, 0x65, 0x6e, 0x74, 0x65, 0x72,
-    0x3b, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x31,
-    0x30, 0x30, 0x70, 0x78, 0x3b, 0x22, 0x20, 0x63,
-    0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x74, 0x65,
-    0x78, 0x74, 0x67, 0x72, 0x61, 0x79, 0x22, 0x3e,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x20, 0x20, 0x20, 0x20,
-    0x44, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74,
-    0x61, 0x74, 0x69, 0x6f, 0x6e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x20, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x74, 0x64, 0x20, 0x77, 0x69, 0x64,
-    0x74, 0x68, 0x3d, 0x22, 0x34, 0x30, 0x70, 0x78,
+    0x68, 0x3a, 0x36, 0x70, 0x78, 0x3b, 0x22, 0x2f,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73,
+    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69,
+    0x64, 0x74, 0x68, 0x3a, 0x32, 0x34, 0x35, 0x70,
+    0x78, 0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74,
+    0x3a, 0x31, 0x30, 0x30, 0x25, 0x22, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70,
+    0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x3a, 0x30,
+    0x70, 0x78, 0x3b, 0x62, 0x6f, 0x72, 0x64, 0x65,
+    0x72, 0x2d, 0x63, 0x6f, 0x6c, 0x6c, 0x61, 0x70,
+    0x73, 0x65, 0x3a, 0x63, 0x6f, 0x6c, 0x6c, 0x61,
+    0x70, 0x73, 0x65, 0x3b, 0x68, 0x65, 0x69, 0x67,
+    0x68, 0x74, 0x3a, 0x31, 0x30, 0x30, 0x25, 0x3b,
+    0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69, 0x64,
+    0x74, 0x68, 0x3a, 0x31, 0x30, 0x33, 0x70, 0x78,
+    0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x32, 0x39, 0x70, 0x78, 0x3b, 0x62, 0x61, 0x63,
+    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
+    0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a, 0x75, 0x72,
+    0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f,
+    0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74,
+    0x73, 0x2f, 0x68, 0x5f, 0x74, 0x61, 0x62, 0x32,
+    0x5f, 0x73, 0x65, 0x6c, 0x65, 0x63, 0x74, 0x65,
+    0x64, 0x2e, 0x70, 0x6e, 0x67, 0x27, 0x29, 0x3b,
+    0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75,
+    0x6e, 0x64, 0x2d, 0x72, 0x65, 0x70, 0x65, 0x61,
+    0x74, 0x3a, 0x20, 0x6e, 0x6f, 0x2d, 0x72, 0x65,
+    0x70, 0x65, 0x61, 0x74, 0x3b, 0x22, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x64, 0x69, 0x76, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70, 0x6f, 0x73,
+    0x69, 0x74, 0x69, 0x6f, 0x6e, 0x3a, 0x72, 0x65,
+    0x6c, 0x61, 0x74, 0x69, 0x76, 0x65, 0x3b, 0x74,
+    0x6f, 0x70, 0x3a, 0x37, 0x70, 0x78, 0x3b, 0x3b,
+    0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69,
+    0x67, 0x68, 0x74, 0x3a, 0x62, 0x6f, 0x6c, 0x64,
+    0x3b, 0x74, 0x65, 0x78, 0x74, 0x2d, 0x61, 0x6c,
+    0x69, 0x67, 0x6e, 0x3a, 0x63, 0x65, 0x6e, 0x74,
+    0x65, 0x72, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68,
+    0x3a, 0x31, 0x30, 0x30, 0x70, 0x78, 0x3b, 0x22,
+    0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22,
+    0x74, 0x65, 0x78, 0x74, 0x67, 0x72, 0x61, 0x79,
     0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x26,
-    0x6e, 0x62, 0x73, 0x70, 0x3b, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
-    0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x74, 0x64, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20,
-    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68,
-    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x30,
-    0x70, 0x78, 0x3b, 0x77, 0x69, 0x64, 0x74, 0x68,
-    0x3a, 0x32, 0x34, 0x35, 0x70, 0x78, 0x3b, 0x62,
-    0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e,
-    0x64, 0x2d, 0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a,
-    0x75, 0x72, 0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f,
-    0x6d, 0x2f, 0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63,
-    0x75, 0x74, 0x73, 0x2f, 0x72, 0x69, 0x67, 0x68,
-    0x74, 0x5f, 0x74, 0x6f, 0x70, 0x5f, 0x73, 0x6d,
-    0x61, 0x6c, 0x6c, 0x2e, 0x70, 0x6e, 0x67, 0x27,
-    0x29, 0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73,
-    0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22, 0x2f,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b, 0x67,
-    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f,
-    0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x64, 0x38, 0x64,
-    0x37, 0x64, 0x37, 0x3b, 0x77, 0x69, 0x64, 0x74,
-    0x68, 0x3a, 0x32, 0x34, 0x35, 0x70, 0x78, 0x3b,
-    0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d,
-    0x6c, 0x65, 0x66, 0x74, 0x3a, 0x31, 0x30, 0x70,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x20,
+    0x20, 0x20, 0x44, 0x6f, 0x63, 0x75, 0x6d, 0x65,
+    0x6e, 0x74, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x20, 0x3c, 0x2f, 0x64, 0x69,
+    0x76, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x77,
+    0x69, 0x64, 0x74, 0x68, 0x3d, 0x22, 0x34, 0x30,
+    0x70, 0x78, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09,
+    0x09, 0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x20, 0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x2f, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
+    0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
+    0x22, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x31, 0x30, 0x70, 0x78, 0x3b, 0x77, 0x69, 0x64,
+    0x74, 0x68, 0x3a, 0x32, 0x34, 0x35, 0x70, 0x78,
+    0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f,
+    0x75, 0x6e, 0x64, 0x2d, 0x69, 0x6d, 0x61, 0x67,
+    0x65, 0x3a, 0x75, 0x72, 0x6c, 0x28, 0x27, 0x2f,
+    0x72, 0x6f, 0x6d, 0x2f, 0x6d, 0x65, 0x6e, 0x75,
+    0x5f, 0x63, 0x75, 0x74, 0x73, 0x2f, 0x72, 0x69,
+    0x67, 0x68, 0x74, 0x5f, 0x74, 0x6f, 0x70, 0x5f,
+    0x73, 0x6d, 0x61, 0x6c, 0x6c, 0x2e, 0x70, 0x6e,
+    0x67, 0x27, 0x29, 0x3b, 0x22, 0x20, 0x63, 0x6f,
+    0x6c, 0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33,
+    0x22, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
+    0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63,
+    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
+    0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x64,
+    0x38, 0x64, 0x37, 0x64, 0x37, 0x3b, 0x77, 0x69,
+    0x64, 0x74, 0x68, 0x3a, 0x32, 0x34, 0x35, 0x70,
     0x78, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
-    0x67, 0x2d, 0x62, 0x75, 0x74, 0x74, 0x6f, 0x6d,
-    0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x6c, 0x69,
-    0x6e, 0x65, 0x2d, 0x68, 0x65, 0x69, 0x67, 0x68,
-    0x74, 0x3a, 0x31, 0x37, 0x70, 0x78, 0x3b, 0x22,
-    0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e,
-    0x3d, 0x22, 0x33, 0x22, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x61, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74,
-    0x3d, 0x22, 0x5f, 0x62, 0x6c, 0x61, 0x6e, 0x6b,
-    0x22, 0x20, 0x68, 0x72, 0x65, 0x66, 0x3d, 0x22,
-    0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x77,
-    0x77, 0x77, 0x2e, 0x7a, 0x79, 0x6c, 0x69, 0x6e,
-    0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x7a, 0x79, 0x31,
-    0x30, 0x30, 0x30, 0x2f, 0x5a, 0x59, 0x31, 0x30,
-    0x30, 0x30, 0x5f, 0x51, 0x75, 0x69, 0x63, 0x6b,
-    0x5f, 0x53, 0x74, 0x61, 0x72, 0x74, 0x5f, 0x47,
-    0x75, 0x69, 0x64, 0x65, 0x2e, 0x70, 0x64, 0x66,
-    0x22, 0x3e, 0x51, 0x75, 0x69, 0x63, 0x6b, 0x20,
-    0x53, 0x74, 0x61, 0x72, 0x74, 0x20, 0x4d, 0x61,
-    0x6e, 0x75, 0x61, 0x6c, 0x3c, 0x2f, 0x61, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x62, 0x72, 0x2f, 0x3e, 0x0d,
+    0x67, 0x2d, 0x6c, 0x65, 0x66, 0x74, 0x3a, 0x31,
+    0x30, 0x70, 0x78, 0x3b, 0x70, 0x61, 0x64, 0x64,
+    0x69, 0x6e, 0x67, 0x2d, 0x62, 0x75, 0x74, 0x74,
+    0x6f, 0x6d, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b,
+    0x6c, 0x69, 0x6e, 0x65, 0x2d, 0x68, 0x65, 0x69,
+    0x67, 0x68, 0x74, 0x3a, 0x31, 0x37, 0x70, 0x78,
+    0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70,
+    0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22, 0x3e, 0x0d,
     0x0a, 0x3c, 0x61, 0x20, 0x74, 0x61, 0x72, 0x67,
     0x65, 0x74, 0x3d, 0x22, 0x5f, 0x62, 0x6c, 0x61,
     0x6e, 0x6b, 0x22, 0x20, 0x68, 0x72, 0x65, 0x66,
     0x3d, 0x22, 0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f,
     0x2f, 0x77, 0x77, 0x77, 0x2e, 0x7a, 0x79, 0x6c,
     0x69, 0x6e, 0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x7a,
-    0x79, 0x31, 0x30, 0x30, 0x30, 0x2f, 0x6f, 0x70,
-    0x65, 0x6e, 0x6f, 0x63, 0x64, 0x2e, 0x70, 0x64,
-    0x66, 0x22, 0x3e, 0x4f, 0x70, 0x65, 0x6e, 0x4f,
-    0x43, 0x44, 0x20, 0x4d, 0x61, 0x6e, 0x75, 0x61,
-    0x6c, 0x3c, 0x2f, 0x61, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x62, 0x72, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x61,
-    0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x3d,
-    0x22, 0x5f, 0x62, 0x6c, 0x61, 0x6e, 0x6b, 0x22,
-    0x20, 0x68, 0x72, 0x65, 0x66, 0x3d, 0x22, 0x68,
-    0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x77, 0x77,
-    0x77, 0x2e, 0x7a, 0x79, 0x6c, 0x69, 0x6e, 0x2e,
-    0x63, 0x6f, 0x6d, 0x2f, 0x7a, 0x79, 0x31, 0x30,
-    0x30, 0x30, 0x5f, 0x63, 0x6f, 0x6e, 0x74, 0x61,
-    0x63, 0x74, 0x2e, 0x68, 0x74, 0x6d, 0x6c, 0x22,
-    0x3e, 0x43, 0x6f, 0x6e, 0x74, 0x61, 0x63, 0x74,
-    0x20, 0x5a, 0x79, 0x6c, 0x69, 0x6e, 0x20, 0x41,
-    0x53, 0x3c, 0x2f, 0x61, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73,
-    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61,
-    0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64,
-    0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23,
-    0x64, 0x38, 0x64, 0x37, 0x64, 0x37, 0x3b, 0x68,
-    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31, 0x35,
-    0x70, 0x78, 0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c,
-    0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22,
-    0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x74, 0x64, 0x20, 0x63, 0x6f, 0x6c,
-    0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x61, 0x62, 0x6c,
-    0x65, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
-    0x22, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67,
-    0x3a, 0x30, 0x70, 0x78, 0x3b, 0x62, 0x6f, 0x72,
-    0x64, 0x65, 0x72, 0x2d, 0x63, 0x6f, 0x6c, 0x6c,
-    0x61, 0x70, 0x73, 0x65, 0x3a, 0x63, 0x6f, 0x6c,
-    0x6c, 0x61, 0x70, 0x73, 0x65, 0x3b, 0x22, 0x3e,
-    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
-    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63,
-    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
-    0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x64,
-    0x38, 0x64, 0x37, 0x64, 0x37, 0x3b, 0x77, 0x69,
-    0x64, 0x74, 0x68, 0x3a, 0x31, 0x30, 0x70, 0x78,
-    0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
-    0x31, 0x70, 0x78, 0x22, 0x2f, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b, 0x67,
-    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f,
-    0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x39, 0x39, 0x39,
-    0x39, 0x39, 0x39, 0x3b, 0x77, 0x69, 0x64, 0x74,
-    0x68, 0x3a, 0x32, 0x32, 0x35, 0x70, 0x78, 0x3b,
-    0x20, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
-    0x31, 0x70, 0x78, 0x3b, 0x22, 0x2f, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79,
-    0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b,
-    0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63,
-    0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x64, 0x38,
-    0x64, 0x37, 0x64, 0x37, 0x3b, 0x77, 0x69, 0x64,
-    0x74, 0x68, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b,
-    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31,
-    0x70, 0x78, 0x22, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d,
+    0x79, 0x31, 0x30, 0x30, 0x30, 0x2f, 0x5a, 0x59,
+    0x31, 0x30, 0x30, 0x30, 0x5f, 0x51, 0x75, 0x69,
+    0x63, 0x6b, 0x5f, 0x53, 0x74, 0x61, 0x72, 0x74,
+    0x5f, 0x47, 0x75, 0x69, 0x64, 0x65, 0x2e, 0x70,
+    0x64, 0x66, 0x22, 0x3e, 0x51, 0x75, 0x69, 0x63,
+    0x6b, 0x20, 0x53, 0x74, 0x61, 0x72, 0x74, 0x20,
+    0x4d, 0x61, 0x6e, 0x75, 0x61, 0x6c, 0x3c, 0x2f,
+    0x61, 0x3e, 0x0d, 0x0a, 0x3c, 0x62, 0x72, 0x2f,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x61, 0x20, 0x74, 0x61,
+    0x72, 0x67, 0x65, 0x74, 0x3d, 0x22, 0x5f, 0x62,
+    0x6c, 0x61, 0x6e, 0x6b, 0x22, 0x20, 0x68, 0x72,
+    0x65, 0x66, 0x3d, 0x22, 0x68, 0x74, 0x74, 0x70,
+    0x3a, 0x2f, 0x2f, 0x77, 0x77, 0x77, 0x2e, 0x7a,
+    0x79, 0x6c, 0x69, 0x6e, 0x2e, 0x63, 0x6f, 0x6d,
+    0x2f, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30, 0x2f,
+    0x6f, 0x70, 0x65, 0x6e, 0x6f, 0x63, 0x64, 0x2e,
+    0x70, 0x64, 0x66, 0x22, 0x3e, 0x4f, 0x70, 0x65,
+    0x6e, 0x4f, 0x43, 0x44, 0x20, 0x4d, 0x61, 0x6e,
+    0x75, 0x61, 0x6c, 0x3c, 0x2f, 0x61, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x62, 0x72, 0x2f, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x61, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65,
+    0x74, 0x3d, 0x22, 0x5f, 0x62, 0x6c, 0x61, 0x6e,
+    0x6b, 0x22, 0x20, 0x68, 0x72, 0x65, 0x66, 0x3d,
+    0x22, 0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f,
+    0x77, 0x77, 0x77, 0x2e, 0x7a, 0x79, 0x6c, 0x69,
+    0x6e, 0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x7a, 0x79,
+    0x31, 0x30, 0x30, 0x30, 0x5f, 0x63, 0x6f, 0x6e,
+    0x74, 0x61, 0x63, 0x74, 0x2e, 0x68, 0x74, 0x6d,
+    0x6c, 0x22, 0x3e, 0x43, 0x6f, 0x6e, 0x74, 0x61,
+    0x63, 0x74, 0x20, 0x5a, 0x79, 0x6c, 0x69, 0x6e,
+    0x20, 0x41, 0x53, 0x3c, 0x2f, 0x61, 0x3e, 0x0d,
     0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
     0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
     0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
@@ -35319,136 +35280,183 @@
     0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22,
     0x33, 0x22, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
     0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x72,
-    0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22,
-    0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x31,
-    0x30, 0x30, 0x25, 0x3b, 0x22, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x68, 0x65, 0x69, 0x67, 0x68,
-    0x74, 0x3a, 0x31, 0x30, 0x30, 0x25, 0x3b, 0x62,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x63,
+    0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22,
+    0x33, 0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x61,
+    0x62, 0x6c, 0x65, 0x20, 0x73, 0x74, 0x79, 0x6c,
+    0x65, 0x3d, 0x22, 0x70, 0x61, 0x64, 0x64, 0x69,
+    0x6e, 0x67, 0x3a, 0x30, 0x70, 0x78, 0x3b, 0x62,
+    0x6f, 0x72, 0x64, 0x65, 0x72, 0x2d, 0x63, 0x6f,
+    0x6c, 0x6c, 0x61, 0x70, 0x73, 0x65, 0x3a, 0x63,
+    0x6f, 0x6c, 0x6c, 0x61, 0x70, 0x73, 0x65, 0x3b,
+    0x22, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20,
+    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62,
     0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e,
     0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a,
     0x23, 0x64, 0x38, 0x64, 0x37, 0x64, 0x37, 0x3b,
-    0x70, 0x61, 0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d,
-    0x6c, 0x65, 0x66, 0x74, 0x3a, 0x31, 0x30, 0x70,
-    0x78, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
-    0x67, 0x2d, 0x72, 0x69, 0x67, 0x68, 0x74, 0x3a,
-    0x31, 0x30, 0x70, 0x78, 0x3b, 0x22, 0x20, 0x63,
+    0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x31, 0x30,
+    0x70, 0x78, 0x3b, 0x68, 0x65, 0x69, 0x67, 0x68,
+    0x74, 0x3a, 0x31, 0x70, 0x78, 0x22, 0x2f, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63,
+    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
+    0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23, 0x39,
+    0x39, 0x39, 0x39, 0x39, 0x39, 0x3b, 0x77, 0x69,
+    0x64, 0x74, 0x68, 0x3a, 0x32, 0x32, 0x35, 0x70,
+    0x78, 0x3b, 0x20, 0x68, 0x65, 0x69, 0x67, 0x68,
+    0x74, 0x3a, 0x31, 0x70, 0x78, 0x3b, 0x22, 0x2f,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73,
+    0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61,
+    0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64,
+    0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x23,
+    0x64, 0x38, 0x64, 0x37, 0x64, 0x37, 0x3b, 0x77,
+    0x69, 0x64, 0x74, 0x68, 0x3a, 0x31, 0x30, 0x70,
+    0x78, 0x3b, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74,
+    0x3a, 0x31, 0x70, 0x78, 0x22, 0x2f, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
+    0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72,
+    0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c,
+    0x6f, 0x72, 0x3a, 0x23, 0x64, 0x38, 0x64, 0x37,
+    0x64, 0x37, 0x3b, 0x68, 0x65, 0x69, 0x67, 0x68,
+    0x74, 0x3a, 0x31, 0x35, 0x70, 0x78, 0x3b, 0x22,
+    0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e,
+    0x3d, 0x22, 0x33, 0x22, 0x2f, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x74, 0x72, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65,
+    0x3d, 0x22, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74,
+    0x3a, 0x31, 0x30, 0x30, 0x25, 0x3b, 0x22, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68, 0x65, 0x69,
+    0x67, 0x68, 0x74, 0x3a, 0x31, 0x30, 0x30, 0x25,
+    0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f,
+    0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f,
+    0x72, 0x3a, 0x23, 0x64, 0x38, 0x64, 0x37, 0x64,
+    0x37, 0x3b, 0x70, 0x61, 0x64, 0x64, 0x69, 0x6e,
+    0x67, 0x2d, 0x6c, 0x65, 0x66, 0x74, 0x3a, 0x31,
+    0x30, 0x70, 0x78, 0x3b, 0x70, 0x61, 0x64, 0x64,
+    0x69, 0x6e, 0x67, 0x2d, 0x72, 0x69, 0x67, 0x68,
+    0x74, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x22,
+    0x20, 0x63, 0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e,
+    0x3d, 0x22, 0x33, 0x22, 0x20, 0x63, 0x6c, 0x61,
+    0x73, 0x73, 0x3d, 0x22, 0x74, 0x65, 0x78, 0x74,
+    0x67, 0x72, 0x61, 0x79, 0x22, 0x3e, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x42, 0x65, 0x66, 0x6f, 0x72, 0x65,
+    0x20, 0x63, 0x6f, 0x6e, 0x74, 0x61, 0x63, 0x74,
+    0x69, 0x6e, 0x67, 0x20, 0x5a, 0x79, 0x6c, 0x69,
+    0x6e, 0x20, 0x77, 0x69, 0x74, 0x68, 0x20, 0x71,
+    0x75, 0x65, 0x73, 0x74, 0x69, 0x6f, 0x6e, 0x73,
+    0x2c, 0x20, 0x70, 0x6c, 0x65, 0x61, 0x73, 0x65,
+    0x20, 0x66, 0x69, 0x6c, 0x6c, 0x20, 0x69, 0x6e,
+    0x20, 0x61, 0x6e, 0x64, 0x20, 0x73, 0x75, 0x62,
+    0x6d, 0x69, 0x74, 0x20, 0x74, 0x68, 0x69, 0x73,
+    0x20, 0x66, 0x6f, 0x72, 0x6d, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x61, 0x6e, 0x64, 0x20, 0x61,
+    0x6c, 0x6c, 0x6f, 0x77, 0x20, 0x75, 0x73, 0x20,
+    0x74, 0x69, 0x6d, 0x65, 0x20, 0x74, 0x6f, 0x20,
+    0x72, 0x65, 0x76, 0x69, 0x65, 0x77, 0x20, 0x74,
+    0x68, 0x65, 0x20, 0x69, 0x6e, 0x66, 0x6f, 0x72,
+    0x6d, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x61,
+    0x6e, 0x64, 0x20, 0x61, 0x6e, 0x73, 0x77, 0x65,
+    0x72, 0x20, 0x62, 0x79, 0x20, 0x65, 0x6d, 0x61,
+    0x69, 0x6c, 0x20, 0x69, 0x66, 0x20, 0x70, 0x6f,
+    0x73, 0x73, 0x69, 0x62, 0x6c, 0x65, 0x2e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x3c, 0x70, 0x2f,
+    0x3e, 0x20, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
+    0x4e, 0x6f, 0x74, 0x65, 0x20, 0x74, 0x68, 0x61,
+    0x74, 0x20, 0x79, 0x6f, 0x75, 0x20, 0x63, 0x61,
+    0x6e, 0x20, 0x73, 0x65, 0x65, 0x20, 0x70, 0x72,
+    0x65, 0x63, 0x69, 0x73, 0x65, 0x6c, 0x79, 0x20,
+    0x77, 0x68, 0x61, 0x74, 0x20, 0x69, 0x6e, 0x66,
+    0x6f, 0x72, 0x6d, 0x61, 0x74, 0x69, 0x6f, 0x6e,
+    0x20, 0x69, 0x73, 0x20, 0x73, 0x75, 0x62, 0x6d,
+    0x69, 0x74, 0x74, 0x65, 0x64, 0x20, 0x74, 0x6f,
+    0x20, 0x5a, 0x79, 0x6c, 0x69, 0x6e, 0x20, 0x69,
+    0x6e, 0x20, 0x74, 0x68, 0x65, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x09, 0x66, 0x6f, 0x72, 0x6d, 0x3a,
+    0x20, 0x74, 0x68, 0x65, 0x20, 0x6c, 0x6f, 0x67,
+    0x20, 0x61, 0x6e, 0x64, 0x20, 0x79, 0x6f, 0x75,
+    0x72, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
+    0x20, 0x66, 0x69, 0x6c, 0x65, 0x73, 0x2e, 0x0d,
+    0x0a, 0x09, 0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09,
+    0x09, 0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
+    0x64, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d,
+    0x22, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a,
+    0x33, 0x30, 0x70, 0x78, 0x3b, 0x62, 0x61, 0x63,
+    0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d,
+    0x69, 0x6d, 0x61, 0x67, 0x65, 0x3a, 0x75, 0x72,
+    0x6c, 0x28, 0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f,
+    0x6d, 0x65, 0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74,
+    0x73, 0x2f, 0x72, 0x69, 0x67, 0x68, 0x74, 0x5f,
+    0x62, 0x6f, 0x74, 0x74, 0x6f, 0x6d, 0x2e, 0x70,
+    0x6e, 0x67, 0x27, 0x29, 0x3b, 0x22, 0x20, 0x63,
     0x6f, 0x6c, 0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22,
-    0x33, 0x22, 0x20, 0x63, 0x6c, 0x61, 0x73, 0x73,
-    0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x67, 0x72,
-    0x61, 0x79, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x42, 0x65, 0x66, 0x6f, 0x72, 0x65, 0x20, 0x63,
-    0x6f, 0x6e, 0x74, 0x61, 0x63, 0x74, 0x69, 0x6e,
-    0x67, 0x20, 0x5a, 0x79, 0x6c, 0x69, 0x6e, 0x20,
-    0x77, 0x69, 0x74, 0x68, 0x20, 0x71, 0x75, 0x65,
-    0x73, 0x74, 0x69, 0x6f, 0x6e, 0x73, 0x2c, 0x20,
-    0x70, 0x6c, 0x65, 0x61, 0x73, 0x65, 0x20, 0x66,
-    0x69, 0x6c, 0x6c, 0x20, 0x69, 0x6e, 0x20, 0x61,
-    0x6e, 0x64, 0x20, 0x73, 0x75, 0x62, 0x6d, 0x69,
-    0x74, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x66,
-    0x6f, 0x72, 0x6d, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x61, 0x6e, 0x64, 0x20, 0x61, 0x6c, 0x6c,
-    0x6f, 0x77, 0x20, 0x75, 0x73, 0x20, 0x74, 0x69,
-    0x6d, 0x65, 0x20, 0x74, 0x6f, 0x20, 0x72, 0x65,
-    0x76, 0x69, 0x65, 0x77, 0x20, 0x74, 0x68, 0x65,
-    0x20, 0x69, 0x6e, 0x66, 0x6f, 0x72, 0x6d, 0x61,
-    0x74, 0x69, 0x6f, 0x6e, 0x20, 0x61, 0x6e, 0x64,
-    0x20, 0x61, 0x6e, 0x73, 0x77, 0x65, 0x72, 0x20,
-    0x62, 0x79, 0x20, 0x65, 0x6d, 0x61, 0x69, 0x6c,
-    0x20, 0x69, 0x66, 0x20, 0x70, 0x6f, 0x73, 0x73,
-    0x69, 0x62, 0x6c, 0x65, 0x2e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x3c, 0x70, 0x2f, 0x3e, 0x20,
-    0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x4e, 0x6f,
-    0x74, 0x65, 0x20, 0x74, 0x68, 0x61, 0x74, 0x20,
-    0x79, 0x6f, 0x75, 0x20, 0x63, 0x61, 0x6e, 0x20,
-    0x73, 0x65, 0x65, 0x20, 0x70, 0x72, 0x65, 0x63,
-    0x69, 0x73, 0x65, 0x6c, 0x79, 0x20, 0x77, 0x68,
-    0x61, 0x74, 0x20, 0x69, 0x6e, 0x66, 0x6f, 0x72,
-    0x6d, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x69,
-    0x73, 0x20, 0x73, 0x75, 0x62, 0x6d, 0x69, 0x74,
-    0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x5a,
-    0x79, 0x6c, 0x69, 0x6e, 0x20, 0x69, 0x6e, 0x20,
-    0x74, 0x68, 0x65, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x09, 0x66, 0x6f, 0x72, 0x6d, 0x3a, 0x20, 0x74,
-    0x68, 0x65, 0x20, 0x6c, 0x6f, 0x67, 0x20, 0x61,
-    0x6e, 0x64, 0x20, 0x79, 0x6f, 0x75, 0x72, 0x20,
-    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x20, 0x66,
-    0x69, 0x6c, 0x65, 0x73, 0x2e, 0x0d, 0x0a, 0x09,
-    0x09, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x09, 0x09,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20,
-    0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x68,
-    0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x33, 0x30,
-    0x70, 0x78, 0x3b, 0x62, 0x61, 0x63, 0x6b, 0x67,
-    0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x69, 0x6d,
-    0x61, 0x67, 0x65, 0x3a, 0x75, 0x72, 0x6c, 0x28,
-    0x27, 0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x6d, 0x65,
-    0x6e, 0x75, 0x5f, 0x63, 0x75, 0x74, 0x73, 0x2f,
-    0x72, 0x69, 0x67, 0x68, 0x74, 0x5f, 0x62, 0x6f,
-    0x74, 0x74, 0x6f, 0x6d, 0x2e, 0x70, 0x6e, 0x67,
-    0x27, 0x29, 0x3b, 0x22, 0x20, 0x63, 0x6f, 0x6c,
-    0x73, 0x70, 0x61, 0x6e, 0x3d, 0x22, 0x33, 0x22,
-    0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x20, 0x09, 0x09, 0x09, 0x26, 0x6e,
-    0x62, 0x73, 0x70, 0x3b, 0x0d, 0x0a, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
-    0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x2f,
-    0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x69, 0x6d, 0x67, 0x20, 0x62, 0x6f,
-    0x72, 0x64, 0x65, 0x72, 0x3d, 0x22, 0x30, 0x22,
-    0x20, 0x73, 0x72, 0x63, 0x3d, 0x22, 0x2f, 0x72,
-    0x6f, 0x6d, 0x2f, 0x6d, 0x65, 0x6e, 0x75, 0x5f,
-    0x63, 0x75, 0x74, 0x73, 0x2f, 0x6c, 0x6f, 0x67,
-    0x6f, 0x5f, 0x62, 0x6f, 0x74, 0x74, 0x6f, 0x6d,
-    0x2e, 0x70, 0x6e, 0x67, 0x22, 0x2f, 0x3e, 0x0d,
-    0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6c,
-    0x65, 0x3d, 0x22, 0x70, 0x61, 0x64, 0x64, 0x69,
-    0x6e, 0x67, 0x2d, 0x74, 0x6f, 0x70, 0x3a, 0x31,
-    0x30, 0x70, 0x78, 0x3b, 0x70, 0x61, 0x64, 0x64,
-    0x69, 0x6e, 0x67, 0x2d, 0x6c, 0x65, 0x66, 0x74,
-    0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x6d, 0x61,
-    0x72, 0x67, 0x69, 0x6e, 0x2d, 0x74, 0x6f, 0x70,
-    0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x22, 0x20,
-    0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d, 0x22, 0x74,
-    0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
-    0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09,
-    0x09, 0x09, 0x09, 0x5a, 0x79, 0x6c, 0x69, 0x6e,
-    0x20, 0x41, 0x53, 0x2c, 0x20, 0x41, 0x75, 0x67,
-    0x6c, 0x65, 0x6e, 0x64, 0x73, 0x64, 0x61, 0x6c,
-    0x65, 0x6e, 0x20, 0x37, 0x38, 0x2c, 0x20, 0x4e,
-    0x2d, 0x34, 0x30, 0x31, 0x37, 0x20, 0x53, 0x74,
-    0x61, 0x76, 0x61, 0x6e, 0x67, 0x65, 0x72, 0x2c,
-    0x20, 0x4e, 0x6f, 0x72, 0x77, 0x61, 0x79, 0x20,
-    0x2d, 0x20, 0x77, 0x77, 0x77, 0x2e, 0x7a, 0x79,
-    0x6c, 0x69, 0x6e, 0x2e, 0x63, 0x6f, 0x6d, 0x0d,
-    0x0a, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x3c,
-    0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f,
-    0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74,
-    0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d, 0x0a, 0x3c,
-    0x2f, 0x62, 0x6f, 0x64, 0x79, 0x3e, 0x0d, 0x0a,
-    0x3c, 0x2f, 0x68, 0x74, 0x6d, 0x6c, 0x3e, 0x0d,
-    0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
-    0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x09,
-    0x09, 0x0d, 0x0a, 0x09, 0x0d, 0x0a, 0x09, 0x0d,
-    0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x73, 0x74,
-    0x61, 0x72, 0x74, 0x5f, 0x63, 0x68, 0x75, 0x6e,
-    0x6b, 0x65, 0x64, 0x20, 0x22, 0x68, 0x74, 0x6d,
-    0x6c, 0x22, 0x0d, 0x0a, 0x77, 0x72, 0x69, 0x74,
-    0x65, 0x5f, 0x63, 0x68, 0x75, 0x6e, 0x6b, 0x65,
-    0x64, 0x20, 0x24, 0x62, 0x75, 0x66, 0x66, 0x65,
-    0x72, 0x0d, 0x0a, 0x65, 0x6e, 0x64, 0x5f, 0x63,
-    0x68, 0x75, 0x6e, 0x6b, 0x65, 0x64, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x33, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x20, 0x09, 0x09, 0x09,
+    0x26, 0x6e, 0x62, 0x73, 0x70, 0x3b, 0x0d, 0x0a,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x20,
+    0x09, 0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c, 0x74,
+    0x64, 0x2f, 0x3e, 0x0d, 0x0a, 0x3c, 0x74, 0x64,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x69, 0x6d, 0x67, 0x20,
+    0x62, 0x6f, 0x72, 0x64, 0x65, 0x72, 0x3d, 0x22,
+    0x30, 0x22, 0x20, 0x73, 0x72, 0x63, 0x3d, 0x22,
+    0x2f, 0x72, 0x6f, 0x6d, 0x2f, 0x6d, 0x65, 0x6e,
+    0x75, 0x5f, 0x63, 0x75, 0x74, 0x73, 0x2f, 0x6c,
+    0x6f, 0x67, 0x6f, 0x5f, 0x62, 0x6f, 0x74, 0x74,
+    0x6f, 0x6d, 0x2e, 0x70, 0x6e, 0x67, 0x22, 0x2f,
+    0x3e, 0x0d, 0x0a, 0x3c, 0x2f, 0x74, 0x64, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x74, 0x64, 0x20, 0x73, 0x74,
+    0x79, 0x6c, 0x65, 0x3d, 0x22, 0x70, 0x61, 0x64,
+    0x64, 0x69, 0x6e, 0x67, 0x2d, 0x74, 0x6f, 0x70,
+    0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b, 0x70, 0x61,
+    0x64, 0x64, 0x69, 0x6e, 0x67, 0x2d, 0x6c, 0x65,
+    0x66, 0x74, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b,
+    0x6d, 0x61, 0x72, 0x67, 0x69, 0x6e, 0x2d, 0x74,
+    0x6f, 0x70, 0x3a, 0x31, 0x30, 0x70, 0x78, 0x3b,
+    0x22, 0x20, 0x63, 0x6c, 0x61, 0x73, 0x73, 0x3d,
+    0x22, 0x74, 0x65, 0x78, 0x74, 0x6c, 0x69, 0x67,
+    0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x09, 0x09,
+    0x09, 0x09, 0x09, 0x09, 0x09, 0x5a, 0x79, 0x6c,
+    0x69, 0x6e, 0x20, 0x41, 0x53, 0x2c, 0x20, 0x41,
+    0x75, 0x67, 0x6c, 0x65, 0x6e, 0x64, 0x73, 0x64,
+    0x61, 0x6c, 0x65, 0x6e, 0x20, 0x37, 0x38, 0x2c,
+    0x20, 0x4e, 0x2d, 0x34, 0x30, 0x31, 0x37, 0x20,
+    0x53, 0x74, 0x61, 0x76, 0x61, 0x6e, 0x67, 0x65,
+    0x72, 0x2c, 0x20, 0x4e, 0x6f, 0x72, 0x77, 0x61,
+    0x79, 0x20, 0x2d, 0x20, 0x77, 0x77, 0x77, 0x2e,
+    0x7a, 0x79, 0x6c, 0x69, 0x6e, 0x2e, 0x63, 0x6f,
+    0x6d, 0x0d, 0x0a, 0x09, 0x09, 0x09, 0x09, 0x09,
+    0x09, 0x3c, 0x2f, 0x74, 0x64, 0x3e, 0x0d, 0x0a,
+    0x3c, 0x2f, 0x74, 0x72, 0x3e, 0x0d, 0x0a, 0x3c,
+    0x2f, 0x74, 0x61, 0x62, 0x6c, 0x65, 0x3e, 0x0d,
+    0x0a, 0x3c, 0x2f, 0x62, 0x6f, 0x64, 0x79, 0x3e,
+    0x0d, 0x0a, 0x3c, 0x2f, 0x68, 0x74, 0x6d, 0x6c,
+    0x3e, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x09, 0x09, 0x0d, 0x0a, 0x09, 0x0d, 0x0a,
+    0x09, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x73, 0x74, 0x61, 0x72, 0x74, 0x5f, 0x63, 0x68,
+    0x75, 0x6e, 0x6b, 0x65, 0x64, 0x20, 0x22, 0x68,
+    0x74, 0x6d, 0x6c, 0x22, 0x0d, 0x0a, 0x77, 0x72,
+    0x69, 0x74, 0x65, 0x5f, 0x63, 0x68, 0x75, 0x6e,
+    0x6b, 0x65, 0x64, 0x20, 0x24, 0x62, 0x75, 0x66,
+    0x66, 0x65, 0x72, 0x0d, 0x0a, 0x65, 0x6e, 0x64,
+    0x5f, 0x63, 0x68, 0x75, 0x6e, 0x6b, 0x65, 0x64,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -35795,8 +35803,7 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -36944,8 +36951,7 @@
     0x74, 0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68,
     0x74, 0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
-    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63,
-    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a,
+    0x75, 0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a,
     0x79, 0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65,
     0x72, 0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a,
     0x61, 0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62,
@@ -37995,8 +38001,6 @@
     0x68, 0x75, 0x6e, 0x6b, 0x65, 0x64, 0x0d, 0x0a,
     0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -38128,8 +38132,7 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -39497,6 +39500,7 @@
     0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x63, 0x6f, 0x6e, 0x76, 0x65, 0x72,
     0x74, 0x65, 0x64, 0x20, 0x74, 0x6f, 0x20, 0x2e,
     0x74, 0x63, 0x6c, 0x20, 0x62, 0x79, 0x20, 0x68,
@@ -39622,8 +39626,7 @@
     0x65, 0x78, 0x74, 0x6c, 0x69, 0x67, 0x68, 0x74,
     0x22, 0x3e, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
-    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x63, 0x61,
-    0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x7a, 0x79,
+    0x66, 0x66, 0x65, 0x72, 0x20, 0x5b, 0x7a, 0x79,
     0x31, 0x30, 0x30, 0x30, 0x5f, 0x76, 0x65, 0x72,
     0x73, 0x69, 0x6f, 0x6e, 0x5d, 0x0d, 0x0a, 0x61,
     0x70, 0x70, 0x65, 0x6e, 0x64, 0x20, 0x62, 0x75,
@@ -41057,6 +41060,7 @@
     0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x55, 0x70, 0x6c, 0x6f, 0x61, 0x64,
     0x20, 0x61, 0x20, 0x66, 0x69, 0x6c, 0x65, 0x20,
     0x74, 0x6f, 0x20, 0x74, 0x68, 0x65, 0x20, 0x74,
@@ -41234,8 +41238,7 @@
     0x69, 0x67, 0x68, 0x74, 0x22, 0x3e, 0x0d, 0x0a,
     0x7d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
-    0x20, 0x5b, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
-    0x65, 0x20, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
+    0x20, 0x5b, 0x7a, 0x79, 0x31, 0x30, 0x30, 0x30,
     0x5f, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e,
     0x5d, 0x0d, 0x0a, 0x61, 0x70, 0x70, 0x65, 0x6e,
     0x64, 0x20, 0x62, 0x75, 0x66, 0x66, 0x65, 0x72,
@@ -42825,6 +42828,7 @@
     0x63, 0x68, 0x75, 0x6e, 0x6b, 0x65, 0x64, 0x0d,
     0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x61, 0x3a, 0x6c, 0x69, 0x6e, 0x6b, 0x0d, 0x0a,
     0x7b, 0x0d, 0x0a, 0x09, 0x66, 0x6f, 0x6e, 0x74,
     0x2d, 0x73, 0x69, 0x7a, 0x65, 0x3a, 0x20, 0x31,
@@ -43865,6 +43869,38 @@
     0x30, 0x30, 0x30, 0x30, 0x20, 0x32, 0x20, 0x32,
     0x20, 0x30, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x23, 0x0d, 0x0a, 0x23, 0x20, 0x48, 0x69, 0x74,
+    0x65, 0x78, 0x20, 0x53, 0x54, 0x52, 0x39, 0x2d,
+    0x63, 0x6f, 0x6d, 0x53, 0x74, 0x69, 0x63, 0x6b,
+    0x0d, 0x0a, 0x23, 0x0d, 0x0a, 0x23, 0x20, 0x68,
+    0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x77, 0x77,
+    0x77, 0x2e, 0x68, 0x69, 0x74, 0x65, 0x78, 0x2e,
+    0x63, 0x6f, 0x6d, 0x2f, 0x69, 0x6e, 0x64, 0x65,
+    0x78, 0x2e, 0x70, 0x68, 0x70, 0x3f, 0x69, 0x64,
+    0x3d, 0x33, 0x38, 0x33, 0x0d, 0x0a, 0x23, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x23, 0x20, 0x54, 0x68, 0x69,
+    0x73, 0x20, 0x77, 0x6f, 0x72, 0x6b, 0x73, 0x20,
+    0x66, 0x6f, 0x72, 0x20, 0x74, 0x68, 0x65, 0x20,
+    0x53, 0x54, 0x52, 0x39, 0x2d, 0x63, 0x6f, 0x6d,
+    0x53, 0x74, 0x69, 0x63, 0x6b, 0x20, 0x72, 0x65,
+    0x76, 0x69, 0x73, 0x69, 0x6f, 0x6e, 0x73, 0x20,
+    0x53, 0x54, 0x52, 0x39, 0x31, 0x32, 0x43, 0x53,
+    0x2d, 0x41, 0x31, 0x20, 0x61, 0x6e, 0x64, 0x20,
+    0x53, 0x54, 0x52, 0x39, 0x31, 0x32, 0x43, 0x53,
+    0x2d, 0x41, 0x32, 0x2e, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x73, 0x6f, 0x75, 0x72, 0x63, 0x65, 0x20, 0x5b,
+    0x66, 0x69, 0x6e, 0x64, 0x20, 0x69, 0x6e, 0x74,
+    0x65, 0x72, 0x66, 0x61, 0x63, 0x65, 0x2f, 0x73,
+    0x74, 0x72, 0x39, 0x2d, 0x63, 0x6f, 0x6d, 0x73,
+    0x74, 0x69, 0x63, 0x6b, 0x2e, 0x63, 0x66, 0x67,
+    0x5d, 0x0d, 0x0a, 0x73, 0x6f, 0x75, 0x72, 0x63,
+    0x65, 0x20, 0x5b, 0x66, 0x69, 0x6e, 0x64, 0x20,
+    0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x2f, 0x73,
+    0x74, 0x72, 0x39, 0x63, 0x6f, 0x6d, 0x73, 0x74,
+    0x69, 0x63, 0x6b, 0x2e, 0x63, 0x66, 0x67, 0x5d,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x54, 0x68, 0x65, 0x20, 0x49, 0x41,
     0x52, 0x20, 0x73, 0x74, 0x72, 0x39, 0x31, 0x32,
     0x2d, 0x73, 0x6b, 0x20, 0x65, 0x76, 0x61, 0x6c,
@@ -45142,31 +45178,31 @@
     0x74, 0x65, 0x20, 0x30, 0x20, 0x75, 0x62, 0x6f,
     0x6f, 0x74, 0x2e, 0x62, 0x69, 0x6e, 0x20, 0x30,
     0x20, 0x6f, 0x6f, 0x62, 0x5f, 0x73, 0x6f, 0x66,
-    0x74, 0x65, 0x63, 0x63, 0x0d, 0x0a, 0x09, 0x72,
-    0x65, 0x73, 0x75, 0x6d, 0x65, 0x0d, 0x0a, 0x0d,
-    0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x70, 0x72,
-    0x6f, 0x63, 0x20, 0x73, 0x68, 0x65, 0x65, 0x76,
-    0x61, 0x70, 0x6c, 0x75, 0x67, 0x5f, 0x6c, 0x6f,
-    0x61, 0x64, 0x5f, 0x75, 0x62, 0x6f, 0x6f, 0x74,
-    0x20, 0x7b, 0x20, 0x7d, 0x20, 0x7b, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x09, 0x23, 0x20, 0x6c, 0x6f, 0x61,
-    0x64, 0x20, 0x75, 0x2d, 0x42, 0x6f, 0x6f, 0x74,
-    0x20, 0x69, 0x6e, 0x74, 0x6f, 0x20, 0x52, 0x41,
-    0x4d, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x65, 0x78,
-    0x65, 0x63, 0x75, 0x74, 0x65, 0x20, 0x69, 0x74,
-    0x0d, 0x0a, 0x09, 0x73, 0x68, 0x65, 0x65, 0x76,
-    0x61, 0x70, 0x6c, 0x75, 0x67, 0x5f, 0x69, 0x6e,
-    0x69, 0x74, 0x0d, 0x0a, 0x09, 0x6c, 0x6f, 0x61,
-    0x64, 0x5f, 0x69, 0x6d, 0x61, 0x67, 0x65, 0x20,
-    0x2f, 0x74, 0x6d, 0x70, 0x2f, 0x75, 0x62, 0x6f,
-    0x6f, 0x74, 0x2e, 0x65, 0x6c, 0x66, 0x0d, 0x0a,
-    0x09, 0x76, 0x65, 0x72, 0x69, 0x66, 0x79, 0x5f,
-    0x69, 0x6d, 0x61, 0x67, 0x65, 0x20, 0x75, 0x62,
-    0x6f, 0x6f, 0x74, 0x2e, 0x65, 0x6c, 0x66, 0x0d,
+    0x74, 0x65, 0x63, 0x63, 0x5f, 0x6b, 0x77, 0x0d,
     0x0a, 0x09, 0x72, 0x65, 0x73, 0x75, 0x6d, 0x65,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x36, 0x30, 0x30,
-    0x30, 0x30, 0x30, 0x0d, 0x0a, 0x0d, 0x0a, 0x7d,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x70, 0x72, 0x6f, 0x63, 0x20, 0x73, 0x68,
+    0x65, 0x65, 0x76, 0x61, 0x70, 0x6c, 0x75, 0x67,
+    0x5f, 0x6c, 0x6f, 0x61, 0x64, 0x5f, 0x75, 0x62,
+    0x6f, 0x6f, 0x74, 0x20, 0x7b, 0x20, 0x7d, 0x20,
+    0x7b, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x23, 0x20,
+    0x6c, 0x6f, 0x61, 0x64, 0x20, 0x75, 0x2d, 0x42,
+    0x6f, 0x6f, 0x74, 0x20, 0x69, 0x6e, 0x74, 0x6f,
+    0x20, 0x52, 0x41, 0x4d, 0x20, 0x61, 0x6e, 0x64,
+    0x20, 0x65, 0x78, 0x65, 0x63, 0x75, 0x74, 0x65,
+    0x20, 0x69, 0x74, 0x0d, 0x0a, 0x09, 0x73, 0x68,
+    0x65, 0x65, 0x76, 0x61, 0x70, 0x6c, 0x75, 0x67,
+    0x5f, 0x69, 0x6e, 0x69, 0x74, 0x0d, 0x0a, 0x09,
+    0x6c, 0x6f, 0x61, 0x64, 0x5f, 0x69, 0x6d, 0x61,
+    0x67, 0x65, 0x20, 0x75, 0x62, 0x6f, 0x6f, 0x74,
+    0x2e, 0x65, 0x6c, 0x66, 0x0d, 0x0a, 0x09, 0x76,
+    0x65, 0x72, 0x69, 0x66, 0x79, 0x5f, 0x69, 0x6d,
+    0x61, 0x67, 0x65, 0x20, 0x75, 0x62, 0x6f, 0x6f,
+    0x74, 0x2e, 0x65, 0x6c, 0x66, 0x0d, 0x0a, 0x09,
+    0x72, 0x65, 0x73, 0x75, 0x6d, 0x65, 0x20, 0x30,
+    0x78, 0x30, 0x30, 0x36, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x0d, 0x0a, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x54, 0x68, 0x69, 0x73, 0x20, 0x69,
@@ -50597,90 +50633,26 @@
     0x36, 0x30, 0x31, 0x30, 0x0d, 0x0a, 0x6a, 0x74,
     0x61, 0x67, 0x5f, 0x73, 0x70, 0x65, 0x65, 0x64,
     0x20, 0x31, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x0d, 0x0a, 0x23,
-    0x20, 0x49, 0x63, 0x65, 0x42, 0x65, 0x61, 0x72,
-    0x20, 0x43, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75,
-    0x72, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x0d, 0x0a,
-    0x23, 0x0d, 0x0a, 0x23, 0x20, 0x68, 0x74, 0x74,
-    0x70, 0x3a, 0x2f, 0x2f, 0x73, 0x65, 0x63, 0x74,
-    0x69, 0x6f, 0x6e, 0x35, 0x2e, 0x63, 0x68, 0x2f,
-    0x69, 0x63, 0x65, 0x62, 0x65, 0x61, 0x72, 0x0d,
-    0x0a, 0x23, 0x0d, 0x0a, 0x23, 0x20, 0x41, 0x75,
-    0x74, 0x68, 0x6f, 0x72, 0x3a, 0x20, 0x53, 0x74,
-    0x65, 0x6e, 0x2c, 0x20, 0x64, 0x65, 0x62, 0x69,
-    0x61, 0x6e, 0x40, 0x73, 0x61, 0x6e, 0x73, 0x79,
-    0x73, 0x2d, 0x65, 0x6c, 0x65, 0x63, 0x74, 0x72,
-    0x6f, 0x6e, 0x69, 0x63, 0x2e, 0x63, 0x6f, 0x6d,
-    0x0d, 0x0a, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23,
-    0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x23, 0x0d,
-    0x0a, 0x23, 0x0d, 0x0a, 0x23, 0x20, 0x41, 0x64,
-    0x64, 0x20, 0x66, 0x69, 0x6c, 0x65, 0x20, 0x2f,
-    0x65, 0x74, 0x63, 0x2f, 0x75, 0x64, 0x65, 0x76,
-    0x2f, 0x72, 0x75, 0x6c, 0x65, 0x73, 0x2e, 0x64,
-    0x2f, 0x34, 0x35, 0x2d, 0x69, 0x63, 0x65, 0x62,
-    0x65, 0x61, 0x72, 0x2e, 0x72, 0x75, 0x6c, 0x65,
-    0x73, 0x0d, 0x0a, 0x23, 0x0d, 0x0a, 0x23, 0x42,
-    0x55, 0x53, 0x21, 0x3d, 0x22, 0x75, 0x73, 0x62,
-    0x22, 0x2c, 0x20, 0x41, 0x43, 0x54, 0x49, 0x4f,
-    0x4e, 0x21, 0x3d, 0x22, 0x61, 0x64, 0x64, 0x22,
-    0x2c, 0x20, 0x53, 0x55, 0x42, 0x53, 0x59, 0x53,
-    0x54, 0x45, 0x4d, 0x21, 0x3d, 0x3d, 0x22, 0x75,
-    0x73, 0x62, 0x5f, 0x64, 0x65, 0x76, 0x69, 0x63,
-    0x65, 0x22, 0x2c, 0x20, 0x47, 0x4f, 0x54, 0x4f,
-    0x3d, 0x22, 0x6b, 0x63, 0x6f, 0x6e, 0x74, 0x72,
-    0x6f, 0x6c, 0x5f, 0x72, 0x75, 0x6c, 0x65, 0x73,
-    0x5f, 0x65, 0x6e, 0x64, 0x22, 0x0d, 0x0a, 0x23,
-    0x0d, 0x0a, 0x23, 0x53, 0x59, 0x53, 0x46, 0x53,
-    0x7b, 0x69, 0x64, 0x50, 0x72, 0x6f, 0x64, 0x75,
-    0x63, 0x74, 0x7d, 0x3d, 0x3d, 0x22, 0x63, 0x31,
-    0x34, 0x30, 0x22, 0x2c, 0x20, 0x53, 0x59, 0x53,
-    0x46, 0x53, 0x7b, 0x69, 0x64, 0x56, 0x65, 0x6e,
-    0x64, 0x6f, 0x72, 0x7d, 0x3d, 0x3d, 0x22, 0x30,
-    0x34, 0x30, 0x33, 0x22, 0x2c, 0x20, 0x4d, 0x4f,
-    0x44, 0x45, 0x3d, 0x22, 0x36, 0x36, 0x36, 0x22,
-    0x2c, 0x20, 0x47, 0x52, 0x4f, 0x55, 0x50, 0x3d,
-    0x22, 0x75, 0x73, 0x62, 0x22, 0x0d, 0x0a, 0x23,
-    0x53, 0x59, 0x53, 0x46, 0x53, 0x7b, 0x69, 0x64,
-    0x50, 0x72, 0x6f, 0x64, 0x75, 0x63, 0x74, 0x7d,
-    0x3d, 0x3d, 0x22, 0x63, 0x31, 0x34, 0x31, 0x22,
-    0x2c, 0x20, 0x53, 0x59, 0x53, 0x46, 0x53, 0x7b,
-    0x69, 0x64, 0x56, 0x65, 0x6e, 0x64, 0x6f, 0x72,
-    0x7d, 0x3d, 0x3d, 0x22, 0x30, 0x34, 0x30, 0x33,
-    0x22, 0x2c, 0x20, 0x4d, 0x4f, 0x44, 0x45, 0x3d,
-    0x22, 0x36, 0x36, 0x36, 0x22, 0x2c, 0x20, 0x47,
-    0x52, 0x4f, 0x55, 0x50, 0x3d, 0x22, 0x75, 0x73,
-    0x62, 0x22, 0x0d, 0x0a, 0x23, 0x0d, 0x0a, 0x23,
-    0x4c, 0x41, 0x42, 0x45, 0x4c, 0x3d, 0x22, 0x6b,
-    0x63, 0x6f, 0x6e, 0x74, 0x72, 0x6f, 0x6c, 0x5f,
-    0x72, 0x75, 0x6c, 0x65, 0x73, 0x5f, 0x65, 0x6e,
-    0x64, 0x22, 0x0d, 0x0a, 0x23, 0x0d, 0x0a, 0x0d,
-    0x0a, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x66, 0x61,
-    0x63, 0x65, 0x20, 0x66, 0x74, 0x32, 0x32, 0x33,
-    0x32, 0x0d, 0x0a, 0x23, 0x66, 0x74, 0x32, 0x32,
-    0x33, 0x32, 0x5f, 0x64, 0x65, 0x76, 0x69, 0x63,
-    0x65, 0x5f, 0x64, 0x65, 0x73, 0x63, 0x20, 0x22,
-    0x22, 0x0d, 0x0a, 0x66, 0x74, 0x32, 0x32, 0x33,
-    0x32, 0x5f, 0x6c, 0x61, 0x79, 0x6f, 0x75, 0x74,
-    0x20, 0x69, 0x63, 0x65, 0x62, 0x65, 0x61, 0x72,
-    0x0d, 0x0a, 0x66, 0x74, 0x32, 0x32, 0x33, 0x32,
-    0x5f, 0x76, 0x69, 0x64, 0x5f, 0x70, 0x69, 0x64,
-    0x20, 0x30, 0x78, 0x30, 0x34, 0x30, 0x33, 0x20,
-    0x30, 0x78, 0x63, 0x31, 0x34, 0x30, 0x0d, 0x0a,
-    0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
-    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x23, 0x0d, 0x0a, 0x23, 0x20, 0x53, 0x65, 0x63,
+    0x74, 0x69, 0x6f, 0x6e, 0x35, 0x20, 0x49, 0x43,
+    0x45, 0x42, 0x65, 0x61, 0x72, 0x0d, 0x0a, 0x23,
+    0x0d, 0x0a, 0x23, 0x20, 0x68, 0x74, 0x74, 0x70,
+    0x3a, 0x2f, 0x2f, 0x73, 0x65, 0x63, 0x74, 0x69,
+    0x6f, 0x6e, 0x35, 0x2e, 0x63, 0x68, 0x2f, 0x69,
+    0x63, 0x65, 0x62, 0x65, 0x61, 0x72, 0x0d, 0x0a,
+    0x23, 0x0d, 0x0a, 0x0d, 0x0a, 0x69, 0x6e, 0x74,
+    0x65, 0x72, 0x66, 0x61, 0x63, 0x65, 0x20, 0x66,
+    0x74, 0x32, 0x32, 0x33, 0x32, 0x0d, 0x0a, 0x23,
+    0x20, 0x66, 0x74, 0x32, 0x32, 0x33, 0x32, 0x5f,
+    0x64, 0x65, 0x76, 0x69, 0x63, 0x65, 0x5f, 0x64,
+    0x65, 0x73, 0x63, 0x20, 0x22, 0x22, 0x0d, 0x0a,
+    0x66, 0x74, 0x32, 0x32, 0x33, 0x32, 0x5f, 0x6c,
+    0x61, 0x79, 0x6f, 0x75, 0x74, 0x20, 0x69, 0x63,
+    0x65, 0x62, 0x65, 0x61, 0x72, 0x0d, 0x0a, 0x66,
+    0x74, 0x32, 0x32, 0x33, 0x32, 0x5f, 0x76, 0x69,
+    0x64, 0x5f, 0x70, 0x69, 0x64, 0x20, 0x30, 0x78,
+    0x30, 0x34, 0x30, 0x33, 0x20, 0x30, 0x78, 0x63,
+    0x31, 0x34, 0x30, 0x0d, 0x0a, 0x0d, 0x0a, 0x00,
     0x23, 0x0d, 0x0a, 0x23, 0x20, 0x53, 0x65, 0x67,
     0x67, 0x65, 0x72, 0x20, 0x4a, 0x2d, 0x4c, 0x69,
     0x6e, 0x6b, 0x0d, 0x0a, 0x23, 0x0d, 0x0a, 0x23,
@@ -51082,7 +51054,7 @@
     0x67, 0x20, 0x4a, 0x54, 0x41, 0x47, 0x4b, 0x65,
     0x79, 0x20, 0x46, 0x54, 0x32, 0x32, 0x33, 0x32,
     0x44, 0x20, 0x42, 0x22, 0x0d, 0x0a, 0x6a, 0x74,
-    0x61, 0x67, 0x5f, 0x6b, 0x68, 0x7a, 0x20, 0x33,
+    0x61, 0x67, 0x5f, 0x6b, 0x68, 0x7a, 0x20, 0x32,
     0x30, 0x30, 0x30, 0x0d, 0x0a, 0x0d, 0x0a, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x0d, 0x0a, 0x23, 0x20, 0x58, 0x76, 0x65,
@@ -61572,111 +61544,131 @@
     0x49, 0x44, 0x20, 0x24, 0x42, 0x53, 0x54, 0x41,
     0x50, 0x49, 0x44, 0x0d, 0x0a, 0x7d, 0x20, 0x65,
     0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d, 0x0a, 0x20,
-    0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x5f, 0x42,
-    0x53, 0x54, 0x41, 0x50, 0x49, 0x44, 0x20, 0x30,
-    0x78, 0x31, 0x34, 0x35, 0x37, 0x66, 0x30, 0x34,
-    0x31, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x6a, 0x74,
-    0x61, 0x67, 0x20, 0x6e, 0x65, 0x77, 0x74, 0x61,
-    0x70, 0x20, 0x24, 0x5f, 0x43, 0x48, 0x49, 0x50,
-    0x4e, 0x41, 0x4d, 0x45, 0x20, 0x62, 0x73, 0x20,
-    0x20, 0x20, 0x20, 0x2d, 0x69, 0x72, 0x6c, 0x65,
-    0x6e, 0x20, 0x35, 0x20, 0x2d, 0x69, 0x72, 0x63,
-    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x30,
-    0x78, 0x31, 0x20, 0x2d, 0x69, 0x72, 0x6d, 0x61,
-    0x73, 0x6b, 0x20, 0x30, 0x78, 0x31, 0x20, 0x2d,
-    0x65, 0x78, 0x70, 0x65, 0x63, 0x74, 0x65, 0x64,
-    0x2d, 0x69, 0x64, 0x20, 0x24, 0x5f, 0x42, 0x53,
-    0x54, 0x41, 0x50, 0x49, 0x44, 0x0d, 0x0a, 0x0d,
-    0x0a, 0x73, 0x65, 0x74, 0x20, 0x5f, 0x54, 0x41,
-    0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45,
-    0x20, 0x5b, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74,
-    0x20, 0x22, 0x25, 0x73, 0x2e, 0x63, 0x70, 0x75,
-    0x22, 0x20, 0x24, 0x5f, 0x43, 0x48, 0x49, 0x50,
-    0x4e, 0x41, 0x4d, 0x45, 0x5d, 0x0d, 0x0a, 0x74,
-    0x61, 0x72, 0x67, 0x65, 0x74, 0x20, 0x63, 0x72,
-    0x65, 0x61, 0x74, 0x65, 0x20, 0x24, 0x5f, 0x54,
+    0x20, 0x20, 0x23, 0x20, 0x46, 0x6f, 0x75, 0x6e,
+    0x64, 0x20, 0x6f, 0x6e, 0x20, 0x53, 0x54, 0x52,
+    0x39, 0x2d, 0x63, 0x6f, 0x6d, 0x53, 0x74, 0x69,
+    0x63, 0x6b, 0x2c, 0x20, 0x72, 0x65, 0x76, 0x69,
+    0x73, 0x69, 0x6f, 0x6e, 0x20, 0x53, 0x54, 0x52,
+    0x39, 0x31, 0x32, 0x43, 0x53, 0x2d, 0x41, 0x31,
+    0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74,
+    0x20, 0x5f, 0x42, 0x53, 0x54, 0x41, 0x50, 0x49,
+    0x44, 0x31, 0x20, 0x30, 0x78, 0x31, 0x34, 0x35,
+    0x37, 0x66, 0x30, 0x34, 0x31, 0x0d, 0x0a, 0x20,
+    0x20, 0x20, 0x23, 0x20, 0x46, 0x6f, 0x75, 0x6e,
+    0x64, 0x20, 0x6f, 0x6e, 0x20, 0x53, 0x54, 0x52,
+    0x39, 0x2d, 0x63, 0x6f, 0x6d, 0x53, 0x74, 0x69,
+    0x63, 0x6b, 0x2c, 0x20, 0x72, 0x65, 0x76, 0x69,
+    0x73, 0x69, 0x6f, 0x6e, 0x20, 0x53, 0x54, 0x52,
+    0x39, 0x31, 0x32, 0x43, 0x53, 0x2d, 0x41, 0x32,
+    0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74,
+    0x20, 0x5f, 0x42, 0x53, 0x54, 0x41, 0x50, 0x49,
+    0x44, 0x32, 0x20, 0x30, 0x78, 0x32, 0x34, 0x35,
+    0x37, 0x66, 0x30, 0x34, 0x31, 0x0d, 0x0a, 0x7d,
+    0x0d, 0x0a, 0x6a, 0x74, 0x61, 0x67, 0x20, 0x6e,
+    0x65, 0x77, 0x74, 0x61, 0x70, 0x20, 0x24, 0x5f,
+    0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45,
+    0x20, 0x62, 0x73, 0x20, 0x2d, 0x69, 0x72, 0x6c,
+    0x65, 0x6e, 0x20, 0x35, 0x20, 0x2d, 0x69, 0x72,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
+    0x30, 0x78, 0x31, 0x20, 0x2d, 0x69, 0x72, 0x6d,
+    0x61, 0x73, 0x6b, 0x20, 0x30, 0x78, 0x31, 0x20,
+    0x2d, 0x65, 0x78, 0x70, 0x65, 0x63, 0x74, 0x65,
+    0x64, 0x2d, 0x69, 0x64, 0x20, 0x24, 0x5f, 0x42,
+    0x53, 0x54, 0x41, 0x50, 0x49, 0x44, 0x31, 0x20,
+    0x2d, 0x65, 0x78, 0x70, 0x65, 0x63, 0x74, 0x65,
+    0x64, 0x2d, 0x69, 0x64, 0x20, 0x24, 0x5f, 0x42,
+    0x53, 0x54, 0x41, 0x50, 0x49, 0x44, 0x32, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x73, 0x65, 0x74, 0x20, 0x5f,
+    0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41,
+    0x4d, 0x45, 0x20, 0x5b, 0x66, 0x6f, 0x72, 0x6d,
+    0x61, 0x74, 0x20, 0x22, 0x25, 0x73, 0x2e, 0x63,
+    0x70, 0x75, 0x22, 0x20, 0x24, 0x5f, 0x43, 0x48,
+    0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45, 0x5d, 0x0d,
+    0x0a, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20,
+    0x63, 0x72, 0x65, 0x61, 0x74, 0x65, 0x20, 0x24,
+    0x5f, 0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e,
+    0x41, 0x4d, 0x45, 0x20, 0x61, 0x72, 0x6d, 0x39,
+    0x36, 0x36, 0x65, 0x20, 0x2d, 0x65, 0x6e, 0x64,
+    0x69, 0x61, 0x6e, 0x20, 0x24, 0x5f, 0x45, 0x4e,
+    0x44, 0x49, 0x41, 0x4e, 0x20, 0x2d, 0x63, 0x68,
+    0x61, 0x69, 0x6e, 0x2d, 0x70, 0x6f, 0x73, 0x69,
+    0x74, 0x69, 0x6f, 0x6e, 0x20, 0x24, 0x5f, 0x54,
     0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d,
-    0x45, 0x20, 0x61, 0x72, 0x6d, 0x39, 0x36, 0x36,
-    0x65, 0x20, 0x2d, 0x65, 0x6e, 0x64, 0x69, 0x61,
-    0x6e, 0x20, 0x24, 0x5f, 0x45, 0x4e, 0x44, 0x49,
-    0x41, 0x4e, 0x20, 0x2d, 0x63, 0x68, 0x61, 0x69,
-    0x6e, 0x2d, 0x70, 0x6f, 0x73, 0x69, 0x74, 0x69,
-    0x6f, 0x6e, 0x20, 0x24, 0x5f, 0x54, 0x41, 0x52,
-    0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20,
-    0x2d, 0x76, 0x61, 0x72, 0x69, 0x61, 0x6e, 0x74,
-    0x20, 0x61, 0x72, 0x6d, 0x39, 0x36, 0x36, 0x65,
-    0x0d, 0x0a, 0x0d, 0x0a, 0x24, 0x5f, 0x54, 0x41,
-    0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45,
-    0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x75,
-    0x72, 0x65, 0x20, 0x2d, 0x65, 0x76, 0x65, 0x6e,
-    0x74, 0x20, 0x72, 0x65, 0x73, 0x65, 0x74, 0x2d,
-    0x69, 0x6e, 0x69, 0x74, 0x20, 0x7b, 0x0d, 0x0a,
-    0x09, 0x23, 0x20, 0x57, 0x65, 0x20, 0x63, 0x61,
-    0x6e, 0x20, 0x69, 0x6e, 0x63, 0x72, 0x65, 0x61,
-    0x73, 0x65, 0x20, 0x73, 0x70, 0x65, 0x65, 0x64,
-    0x20, 0x6e, 0x6f, 0x77, 0x20, 0x74, 0x68, 0x61,
-    0x74, 0x20, 0x77, 0x65, 0x20, 0x6b, 0x6e, 0x6f,
-    0x77, 0x20, 0x74, 0x68, 0x65, 0x20, 0x74, 0x61,
-    0x72, 0x67, 0x65, 0x74, 0x20, 0x69, 0x73, 0x20,
-    0x68, 0x61, 0x6c, 0x74, 0x65, 0x64, 0x2e, 0x0d,
-    0x0a, 0x09, 0x23, 0x6a, 0x74, 0x61, 0x67, 0x5f,
-    0x72, 0x63, 0x6c, 0x6b, 0x20, 0x33, 0x30, 0x30,
-    0x30, 0x0d, 0x0a, 0x09, 0x0d, 0x0a, 0x09, 0x23,
-    0x20, 0x2d, 0x2d, 0x20, 0x45, 0x6e, 0x61, 0x62,
-    0x6c, 0x65, 0x20, 0x39, 0x36, 0x4b, 0x20, 0x52,
-    0x41, 0x4d, 0x0d, 0x0a, 0x09, 0x23, 0x20, 0x50,
-    0x46, 0x51, 0x42, 0x43, 0x20, 0x65, 0x6e, 0x61,
-    0x62, 0x6c, 0x65, 0x64, 0x20, 0x2f, 0x20, 0x44,
-    0x54, 0x43, 0x4d, 0x20, 0x26, 0x20, 0x41, 0x48,
-    0x42, 0x20, 0x77, 0x61, 0x69, 0x74, 0x2d, 0x73,
-    0x74, 0x61, 0x74, 0x65, 0x73, 0x20, 0x64, 0x69,
-    0x73, 0x61, 0x62, 0x6c, 0x65, 0x64, 0x0d, 0x0a,
-    0x09, 0x6d, 0x77, 0x77, 0x20, 0x30, 0x78, 0x35,
-    0x43, 0x30, 0x30, 0x32, 0x30, 0x33, 0x34, 0x20,
-    0x30, 0x78, 0x30, 0x31, 0x39, 0x31, 0x20, 0x0d,
-    0x0a, 0x0d, 0x0a, 0x09, 0x73, 0x74, 0x72, 0x39,
-    0x78, 0x20, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x5f,
-    0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x20, 0x30,
-    0x20, 0x34, 0x20, 0x32, 0x20, 0x30, 0x20, 0x30,
-    0x78, 0x38, 0x30, 0x30, 0x30, 0x30, 0x0d, 0x0a,
-    0x09, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x70,
-    0x72, 0x6f, 0x74, 0x65, 0x63, 0x74, 0x20, 0x30,
-    0x20, 0x30, 0x20, 0x37, 0x20, 0x6f, 0x66, 0x66,
-    0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x24,
-    0x5f, 0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e,
-    0x41, 0x4d, 0x45, 0x20, 0x63, 0x6f, 0x6e, 0x66,
-    0x69, 0x67, 0x75, 0x72, 0x65, 0x20, 0x2d, 0x77,
-    0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61,
-    0x2d, 0x76, 0x69, 0x72, 0x74, 0x20, 0x30, 0x20,
+    0x45, 0x20, 0x2d, 0x76, 0x61, 0x72, 0x69, 0x61,
+    0x6e, 0x74, 0x20, 0x61, 0x72, 0x6d, 0x39, 0x36,
+    0x36, 0x65, 0x0d, 0x0a, 0x0d, 0x0a, 0x24, 0x5f,
+    0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41,
+    0x4d, 0x45, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69,
+    0x67, 0x75, 0x72, 0x65, 0x20, 0x2d, 0x65, 0x76,
+    0x65, 0x6e, 0x74, 0x20, 0x72, 0x65, 0x73, 0x65,
+    0x74, 0x2d, 0x69, 0x6e, 0x69, 0x74, 0x20, 0x7b,
+    0x0d, 0x0a, 0x09, 0x23, 0x20, 0x57, 0x65, 0x20,
+    0x63, 0x61, 0x6e, 0x20, 0x69, 0x6e, 0x63, 0x72,
+    0x65, 0x61, 0x73, 0x65, 0x20, 0x73, 0x70, 0x65,
+    0x65, 0x64, 0x20, 0x6e, 0x6f, 0x77, 0x20, 0x74,
+    0x68, 0x61, 0x74, 0x20, 0x77, 0x65, 0x20, 0x6b,
+    0x6e, 0x6f, 0x77, 0x20, 0x74, 0x68, 0x65, 0x20,
+    0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20, 0x69,
+    0x73, 0x20, 0x68, 0x61, 0x6c, 0x74, 0x65, 0x64,
+    0x2e, 0x0d, 0x0a, 0x09, 0x23, 0x6a, 0x74, 0x61,
+    0x67, 0x5f, 0x72, 0x63, 0x6c, 0x6b, 0x20, 0x33,
+    0x30, 0x30, 0x30, 0x0d, 0x0a, 0x09, 0x0d, 0x0a,
+    0x09, 0x23, 0x20, 0x2d, 0x2d, 0x20, 0x45, 0x6e,
+    0x61, 0x62, 0x6c, 0x65, 0x20, 0x39, 0x36, 0x4b,
+    0x20, 0x52, 0x41, 0x4d, 0x0d, 0x0a, 0x09, 0x23,
+    0x20, 0x50, 0x46, 0x51, 0x42, 0x43, 0x20, 0x65,
+    0x6e, 0x61, 0x62, 0x6c, 0x65, 0x64, 0x20, 0x2f,
+    0x20, 0x44, 0x54, 0x43, 0x4d, 0x20, 0x26, 0x20,
+    0x41, 0x48, 0x42, 0x20, 0x77, 0x61, 0x69, 0x74,
+    0x2d, 0x73, 0x74, 0x61, 0x74, 0x65, 0x73, 0x20,
+    0x64, 0x69, 0x73, 0x61, 0x62, 0x6c, 0x65, 0x64,
+    0x0d, 0x0a, 0x09, 0x6d, 0x77, 0x77, 0x20, 0x30,
+    0x78, 0x35, 0x43, 0x30, 0x30, 0x32, 0x30, 0x33,
+    0x34, 0x20, 0x30, 0x78, 0x30, 0x31, 0x39, 0x31,
+    0x20, 0x0d, 0x0a, 0x0d, 0x0a, 0x09, 0x73, 0x74,
+    0x72, 0x39, 0x78, 0x20, 0x66, 0x6c, 0x61, 0x73,
+    0x68, 0x5f, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
+    0x20, 0x30, 0x20, 0x34, 0x20, 0x32, 0x20, 0x30,
+    0x20, 0x30, 0x78, 0x38, 0x30, 0x30, 0x30, 0x30,
+    0x0d, 0x0a, 0x09, 0x66, 0x6c, 0x61, 0x73, 0x68,
+    0x20, 0x70, 0x72, 0x6f, 0x74, 0x65, 0x63, 0x74,
+    0x20, 0x30, 0x20, 0x30, 0x20, 0x37, 0x20, 0x6f,
+    0x66, 0x66, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x24, 0x5f, 0x54, 0x41, 0x52, 0x47, 0x45,
+    0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20, 0x63, 0x6f,
+    0x6e, 0x66, 0x69, 0x67, 0x75, 0x72, 0x65, 0x20,
     0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72,
-    0x65, 0x61, 0x2d, 0x70, 0x68, 0x79, 0x73, 0x20,
-    0x30, 0x78, 0x35, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x30, 0x30, 0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b,
-    0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x73, 0x69,
-    0x7a, 0x65, 0x20, 0x31, 0x36, 0x33, 0x38, 0x34,
-    0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61,
-    0x72, 0x65, 0x61, 0x2d, 0x62, 0x61, 0x63, 0x6b,
-    0x75, 0x70, 0x20, 0x30, 0x0d, 0x0a, 0x0d, 0x0a,
-    0x23, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x62,
-    0x61, 0x6e, 0x6b, 0x20, 0x3c, 0x64, 0x72, 0x69,
-    0x76, 0x65, 0x72, 0x3e, 0x20, 0x3c, 0x62, 0x61,
-    0x73, 0x65, 0x3e, 0x20, 0x3c, 0x73, 0x69, 0x7a,
-    0x65, 0x3e, 0x20, 0x3c, 0x63, 0x68, 0x69, 0x70,
-    0x5f, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3e, 0x20,
-    0x3c, 0x62, 0x75, 0x73, 0x5f, 0x77, 0x69, 0x64,
-    0x74, 0x68, 0x3e, 0x0d, 0x0a, 0x66, 0x6c, 0x61,
+    0x65, 0x61, 0x2d, 0x76, 0x69, 0x72, 0x74, 0x20,
+    0x30, 0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d,
+    0x61, 0x72, 0x65, 0x61, 0x2d, 0x70, 0x68, 0x79,
+    0x73, 0x20, 0x30, 0x78, 0x35, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x30, 0x30, 0x20, 0x2d, 0x77, 0x6f,
+    0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d,
+    0x73, 0x69, 0x7a, 0x65, 0x20, 0x31, 0x36, 0x33,
+    0x38, 0x34, 0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b,
+    0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x62, 0x61,
+    0x63, 0x6b, 0x75, 0x70, 0x20, 0x30, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x23, 0x66, 0x6c, 0x61, 0x73, 0x68,
+    0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x3c, 0x64,
+    0x72, 0x69, 0x76, 0x65, 0x72, 0x3e, 0x20, 0x3c,
+    0x62, 0x61, 0x73, 0x65, 0x3e, 0x20, 0x3c, 0x73,
+    0x69, 0x7a, 0x65, 0x3e, 0x20, 0x3c, 0x63, 0x68,
+    0x69, 0x70, 0x5f, 0x77, 0x69, 0x64, 0x74, 0x68,
+    0x3e, 0x20, 0x3c, 0x62, 0x75, 0x73, 0x5f, 0x77,
+    0x69, 0x64, 0x74, 0x68, 0x3e, 0x0d, 0x0a, 0x66,
+    0x6c, 0x61, 0x73, 0x68, 0x20, 0x62, 0x61, 0x6e,
+    0x6b, 0x20, 0x73, 0x74, 0x72, 0x39, 0x78, 0x20,
+    0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
+    0x30, 0x30, 0x20, 0x30, 0x78, 0x30, 0x30, 0x30,
+    0x38, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30, 0x20,
+    0x30, 0x20, 0x30, 0x0d, 0x0a, 0x66, 0x6c, 0x61,
     0x73, 0x68, 0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20,
     0x73, 0x74, 0x72, 0x39, 0x78, 0x20, 0x30, 0x78,
-    0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
-    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x38, 0x30,
+    0x30, 0x30, 0x30, 0x38, 0x30, 0x30, 0x30, 0x30,
+    0x20, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x38,
     0x30, 0x30, 0x30, 0x20, 0x30, 0x20, 0x30, 0x20,
-    0x30, 0x0d, 0x0a, 0x66, 0x6c, 0x61, 0x73, 0x68,
-    0x20, 0x62, 0x61, 0x6e, 0x6b, 0x20, 0x73, 0x74,
-    0x72, 0x39, 0x78, 0x20, 0x30, 0x78, 0x30, 0x30,
-    0x30, 0x38, 0x30, 0x30, 0x30, 0x30, 0x20, 0x30,
-    0x78, 0x30, 0x30, 0x30, 0x30, 0x38, 0x30, 0x30,
-    0x30, 0x20, 0x30, 0x20, 0x30, 0x20, 0x30, 0x0d,
-    0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x30, 0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x54, 0x65, 0x73, 0x74, 0x20, 0x73,
     0x63, 0x72, 0x69, 0x70, 0x74, 0x20, 0x74, 0x6f,
     0x20, 0x63, 0x68, 0x65, 0x63, 0x6b, 0x20, 0x74,
@@ -61749,6 +61741,538 @@
     0x79, 0x6e, 0x74, 0x61, 0x78, 0x20, 0x65, 0x72,
     0x72, 0x6f, 0x72, 0x20, 0x68, 0x65, 0x72, 0x65,
     0x0d, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x23, 0x0d, 0x0a, 0x23, 0x20, 0x54, 0x65, 0x78,
+    0x61, 0x73, 0x20, 0x49, 0x6e, 0x73, 0x74, 0x72,
+    0x75, 0x6d, 0x65, 0x6e, 0x74, 0x73, 0x20, 0x44,
+    0x61, 0x56, 0x69, 0x6e, 0x63, 0x69, 0x20, 0x66,
+    0x61, 0x6d, 0x69, 0x6c, 0x79, 0x3a, 0x20, 0x20,
+    0x54, 0x4d, 0x53, 0x33, 0x32, 0x30, 0x44, 0x4d,
+    0x33, 0x35, 0x35, 0x0d, 0x0a, 0x23, 0x0d, 0x0a,
+    0x69, 0x66, 0x20, 0x7b, 0x20, 0x5b, 0x69, 0x6e,
+    0x66, 0x6f, 0x20, 0x65, 0x78, 0x69, 0x73, 0x74,
+    0x73, 0x20, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41,
+    0x4d, 0x45, 0x5d, 0x20, 0x7d, 0x20, 0x7b, 0x0d,
+    0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20,
+    0x20, 0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41,
+    0x4d, 0x45, 0x20, 0x24, 0x43, 0x48, 0x49, 0x50,
+    0x4e, 0x41, 0x4d, 0x45, 0x0d, 0x0a, 0x7d, 0x20,
+    0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d, 0x0a,
+    0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x20,
+    0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d,
+    0x45, 0x20, 0x64, 0x6d, 0x33, 0x35, 0x35, 0x0d,
+    0x0a, 0x7d, 0x0d, 0x0a, 0x69, 0x66, 0x20, 0x7b,
+    0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f, 0x20, 0x65,
+    0x78, 0x69, 0x73, 0x74, 0x73, 0x20, 0x45, 0x4e,
+    0x44, 0x49, 0x41, 0x4e, 0x5d, 0x20, 0x7d, 0x20,
+    0x7b, 0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65,
+    0x74, 0x20, 0x20, 0x5f, 0x45, 0x4e, 0x44, 0x49,
+    0x41, 0x4e, 0x20, 0x24, 0x45, 0x4e, 0x44, 0x49,
+    0x41, 0x4e, 0x0d, 0x0a, 0x7d, 0x20, 0x65, 0x6c,
+    0x73, 0x65, 0x20, 0x7b, 0x0d, 0x0a, 0x20, 0x20,
+    0x20, 0x73, 0x65, 0x74, 0x20, 0x20, 0x5f, 0x45,
+    0x4e, 0x44, 0x49, 0x41, 0x4e, 0x20, 0x6c, 0x69,
+    0x74, 0x74, 0x6c, 0x65, 0x0d, 0x0a, 0x7d, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x23, 0x0d, 0x0a, 0x23, 0x20,
+    0x46, 0x6f, 0x72, 0x20, 0x6e, 0x6f, 0x77, 0x2c,
+    0x20, 0x65, 0x78, 0x70, 0x65, 0x63, 0x74, 0x20,
+    0x45, 0x4d, 0x55, 0x30, 0x2f, 0x45, 0x4d, 0x55,
+    0x31, 0x20, 0x6a, 0x75, 0x6d, 0x70, 0x65, 0x72,
+    0x65, 0x64, 0x20, 0x4c, 0x4f, 0x57, 0x20, 0x28,
+    0x6e, 0x6f, 0x74, 0x20, 0x54, 0x49, 0x27, 0x73,
+    0x20, 0x64, 0x65, 0x66, 0x61, 0x75, 0x6c, 0x74,
+    0x29, 0x20, 0x73, 0x6f, 0x20, 0x41, 0x52, 0x4d,
+    0x20, 0x61, 0x6e, 0x64, 0x20, 0x45, 0x54, 0x42,
+    0x0d, 0x0a, 0x23, 0x20, 0x61, 0x72, 0x65, 0x20,
+    0x65, 0x6e, 0x61, 0x62, 0x6c, 0x65, 0x64, 0x20,
+    0x77, 0x69, 0x74, 0x68, 0x6f, 0x75, 0x74, 0x20,
+    0x6d, 0x61, 0x6b, 0x69, 0x6e, 0x67, 0x20, 0x49,
+    0x43, 0x45, 0x70, 0x69, 0x63, 0x6b, 0x20, 0x72,
+    0x6f, 0x75, 0x74, 0x65, 0x20, 0x41, 0x52, 0x4d,
+    0x20, 0x61, 0x6e, 0x64, 0x20, 0x45, 0x54, 0x42,
+    0x20, 0x69, 0x6e, 0x74, 0x6f, 0x20, 0x74, 0x68,
+    0x65, 0x20, 0x4a, 0x54, 0x41, 0x47, 0x20, 0x63,
+    0x68, 0x61, 0x69, 0x6e, 0x2e, 0x0d, 0x0a, 0x23,
+    0x0d, 0x0a, 0x23, 0x20, 0x41, 0x6c, 0x73, 0x6f,
+    0x20, 0x6e, 0x6f, 0x74, 0x65, 0x3a, 0x20, 0x20,
+    0x77, 0x68, 0x65, 0x6e, 0x20, 0x72, 0x75, 0x6e,
+    0x6e, 0x69, 0x6e, 0x67, 0x20, 0x77, 0x69, 0x74,
+    0x68, 0x6f, 0x75, 0x74, 0x20, 0x52, 0x54, 0x43,
+    0x4b, 0x20, 0x62, 0x65, 0x66, 0x6f, 0x72, 0x65,
+    0x20, 0x74, 0x68, 0x65, 0x20, 0x50, 0x4c, 0x4c,
+    0x73, 0x20, 0x61, 0x72, 0x65, 0x20, 0x73, 0x65,
+    0x74, 0x20, 0x75, 0x70, 0x2c, 0x20, 0x79, 0x6f,
+    0x75, 0x0d, 0x0a, 0x23, 0x20, 0x6d, 0x61, 0x79,
+    0x20, 0x6e, 0x65, 0x65, 0x64, 0x20, 0x74, 0x6f,
+    0x20, 0x73, 0x6c, 0x6f, 0x77, 0x20, 0x74, 0x68,
+    0x65, 0x20, 0x4a, 0x54, 0x41, 0x47, 0x20, 0x63,
+    0x6c, 0x6f, 0x63, 0x6b, 0x20, 0x64, 0x6f, 0x77,
+    0x6e, 0x20, 0x71, 0x75, 0x69, 0x74, 0x65, 0x20,
+    0x61, 0x20, 0x6c, 0x6f, 0x74, 0x20, 0x28, 0x75,
+    0x6e, 0x64, 0x65, 0x72, 0x20, 0x32, 0x20, 0x4d,
+    0x48, 0x7a, 0x29, 0x2e, 0x0d, 0x0a, 0x23, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x23, 0x20, 0x53, 0x75, 0x62,
+    0x73, 0x69, 0x64, 0x69, 0x61, 0x72, 0x79, 0x20,
+    0x54, 0x41, 0x50, 0x3a, 0x20, 0x41, 0x52, 0x4d,
+    0x20, 0x45, 0x54, 0x42, 0x31, 0x31, 0x2c, 0x20,
+    0x77, 0x69, 0x74, 0x68, 0x20, 0x73, 0x63, 0x61,
+    0x6e, 0x20, 0x63, 0x68, 0x61, 0x69, 0x6e, 0x20,
+    0x66, 0x6f, 0x72, 0x20, 0x34, 0x4b, 0x20, 0x6f,
+    0x66, 0x20, 0x45, 0x54, 0x4d, 0x20, 0x74, 0x72,
+    0x61, 0x63, 0x65, 0x20, 0x62, 0x75, 0x66, 0x66,
+    0x65, 0x72, 0x0d, 0x0a, 0x69, 0x66, 0x20, 0x7b,
+    0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f, 0x20, 0x65,
+    0x78, 0x69, 0x73, 0x74, 0x73, 0x20, 0x45, 0x54,
+    0x42, 0x5f, 0x54, 0x41, 0x50, 0x49, 0x44, 0x20,
+    0x5d, 0x20, 0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x20,
+    0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x5f, 0x45,
+    0x54, 0x42, 0x5f, 0x54, 0x41, 0x50, 0x49, 0x44,
+    0x20, 0x24, 0x45, 0x54, 0x42, 0x5f, 0x54, 0x41,
+    0x50, 0x49, 0x44, 0x0d, 0x0a, 0x7d, 0x20, 0x65,
+    0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d, 0x0a, 0x20,
+    0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x5f, 0x45,
+    0x54, 0x42, 0x5f, 0x54, 0x41, 0x50, 0x49, 0x44,
+    0x20, 0x30, 0x78, 0x32, 0x62, 0x39, 0x30, 0x30,
+    0x66, 0x30, 0x66, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a,
+    0x6a, 0x74, 0x61, 0x67, 0x20, 0x6e, 0x65, 0x77,
+    0x74, 0x61, 0x70, 0x20, 0x24, 0x5f, 0x43, 0x48,
+    0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45, 0x20, 0x65,
+    0x74, 0x62, 0x20, 0x2d, 0x69, 0x72, 0x6c, 0x65,
+    0x6e, 0x20, 0x34, 0x20, 0x2d, 0x69, 0x72, 0x63,
+    0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20, 0x30,
+    0x78, 0x31, 0x20, 0x2d, 0x69, 0x72, 0x6d, 0x61,
+    0x73, 0x6b, 0x20, 0x30, 0x78, 0x66, 0x20, 0x2d,
+    0x65, 0x78, 0x70, 0x65, 0x63, 0x74, 0x65, 0x64,
+    0x2d, 0x69, 0x64, 0x20, 0x24, 0x5f, 0x45, 0x54,
+    0x42, 0x5f, 0x54, 0x41, 0x50, 0x49, 0x44, 0x0d,
+    0x0a, 0x0d, 0x0a, 0x23, 0x20, 0x53, 0x75, 0x62,
+    0x73, 0x69, 0x64, 0x69, 0x61, 0x72, 0x79, 0x20,
+    0x54, 0x41, 0x50, 0x3a, 0x20, 0x41, 0x52, 0x4d,
+    0x39, 0x32, 0x36, 0x65, 0x6a, 0x73, 0x20, 0x77,
+    0x69, 0x74, 0x68, 0x20, 0x73, 0x63, 0x61, 0x6e,
+    0x20, 0x63, 0x68, 0x61, 0x69, 0x6e, 0x73, 0x20,
+    0x66, 0x6f, 0x72, 0x20, 0x41, 0x52, 0x4d, 0x20,
+    0x44, 0x65, 0x62, 0x75, 0x67, 0x2c, 0x20, 0x45,
+    0x6d, 0x62, 0x65, 0x64, 0x64, 0x65, 0x64, 0x49,
+    0x43, 0x45, 0x2d, 0x52, 0x54, 0x2c, 0x20, 0x45,
+    0x54, 0x4d, 0x2e, 0x0d, 0x0a, 0x69, 0x66, 0x20,
+    0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f, 0x20,
+    0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20, 0x43,
+    0x50, 0x55, 0x5f, 0x54, 0x41, 0x50, 0x49, 0x44,
+    0x20, 0x5d, 0x20, 0x7d, 0x20, 0x7b, 0x0d, 0x0a,
+    0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x5f,
+    0x43, 0x50, 0x55, 0x5f, 0x54, 0x41, 0x50, 0x49,
+    0x44, 0x20, 0x24, 0x43, 0x50, 0x55, 0x5f, 0x54,
+    0x41, 0x50, 0x49, 0x44, 0x0d, 0x0a, 0x7d, 0x20,
+    0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d, 0x0a,
+    0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x5f,
+    0x43, 0x50, 0x55, 0x5f, 0x54, 0x41, 0x50, 0x49,
+    0x44, 0x20, 0x30, 0x78, 0x30, 0x37, 0x39, 0x32,
+    0x36, 0x30, 0x30, 0x31, 0x0d, 0x0a, 0x7d, 0x0d,
+    0x0a, 0x6a, 0x74, 0x61, 0x67, 0x20, 0x6e, 0x65,
+    0x77, 0x74, 0x61, 0x70, 0x20, 0x24, 0x5f, 0x43,
+    0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45, 0x20,
+    0x61, 0x72, 0x6d, 0x20, 0x2d, 0x69, 0x72, 0x6c,
+    0x65, 0x6e, 0x20, 0x34, 0x20, 0x2d, 0x69, 0x72,
+    0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65, 0x20,
+    0x30, 0x78, 0x31, 0x20, 0x2d, 0x69, 0x72, 0x6d,
+    0x61, 0x73, 0x6b, 0x20, 0x30, 0x78, 0x66, 0x20,
+    0x2d, 0x65, 0x78, 0x70, 0x65, 0x63, 0x74, 0x65,
+    0x64, 0x2d, 0x69, 0x64, 0x20, 0x24, 0x5f, 0x43,
+    0x50, 0x55, 0x5f, 0x54, 0x41, 0x50, 0x49, 0x44,
+    0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x20, 0x50, 0x72,
+    0x69, 0x6d, 0x61, 0x72, 0x79, 0x20, 0x54, 0x41,
+    0x50, 0x3a, 0x20, 0x49, 0x43, 0x45, 0x70, 0x69,
+    0x63, 0x6b, 0x20, 0x28, 0x4a, 0x54, 0x41, 0x47,
+    0x20, 0x72, 0x6f, 0x75, 0x74, 0x65, 0x20, 0x63,
+    0x6f, 0x6e, 0x74, 0x72, 0x6f, 0x6c, 0x6c, 0x65,
+    0x72, 0x29, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x62,
+    0x6f, 0x75, 0x6e, 0x64, 0x61, 0x72, 0x79, 0x20,
+    0x73, 0x63, 0x61, 0x6e, 0x0d, 0x0a, 0x69, 0x66,
+    0x20, 0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f,
+    0x20, 0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20,
+    0x4a, 0x52, 0x43, 0x5f, 0x54, 0x41, 0x50, 0x49,
+    0x44, 0x20, 0x5d, 0x20, 0x7d, 0x20, 0x7b, 0x0d,
+    0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20,
+    0x5f, 0x4a, 0x52, 0x43, 0x5f, 0x54, 0x41, 0x50,
+    0x49, 0x44, 0x20, 0x24, 0x4a, 0x52, 0x43, 0x5f,
+    0x54, 0x41, 0x50, 0x49, 0x44, 0x0d, 0x0a, 0x7d,
+    0x20, 0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d,
+    0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20,
+    0x5f, 0x4a, 0x52, 0x43, 0x5f, 0x54, 0x41, 0x50,
+    0x49, 0x44, 0x20, 0x30, 0x78, 0x30, 0x62, 0x37,
+    0x33, 0x62, 0x30, 0x32, 0x66, 0x0d, 0x0a, 0x7d,
+    0x0d, 0x0a, 0x6a, 0x74, 0x61, 0x67, 0x20, 0x6e,
+    0x65, 0x77, 0x74, 0x61, 0x70, 0x20, 0x24, 0x5f,
+    0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45,
+    0x20, 0x6a, 0x72, 0x63, 0x20, 0x2d, 0x69, 0x72,
+    0x6c, 0x65, 0x6e, 0x20, 0x36, 0x20, 0x2d, 0x69,
+    0x72, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65,
+    0x20, 0x30, 0x78, 0x31, 0x20, 0x2d, 0x69, 0x72,
+    0x6d, 0x61, 0x73, 0x6b, 0x20, 0x30, 0x78, 0x33,
+    0x66, 0x20, 0x2d, 0x65, 0x78, 0x70, 0x65, 0x63,
+    0x74, 0x65, 0x64, 0x2d, 0x69, 0x64, 0x20, 0x24,
+    0x5f, 0x4a, 0x52, 0x43, 0x5f, 0x54, 0x41, 0x50,
+    0x49, 0x44, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x20,
+    0x47, 0x44, 0x42, 0x20, 0x74, 0x61, 0x72, 0x67,
+    0x65, 0x74, 0x3a, 0x20, 0x20, 0x74, 0x68, 0x65,
+    0x20, 0x41, 0x52, 0x4d, 0x2c, 0x20, 0x75, 0x73,
+    0x69, 0x6e, 0x67, 0x20, 0x53, 0x52, 0x41, 0x4d,
+    0x31, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x73, 0x63,
+    0x72, 0x61, 0x74, 0x63, 0x68, 0x2e, 0x20, 0x20,
+    0x53, 0x52, 0x41, 0x4d, 0x30, 0x20, 0x28, 0x61,
+    0x6c, 0x73, 0x6f, 0x20, 0x31, 0x36, 0x4b, 0x29,
+    0x0d, 0x0a, 0x23, 0x20, 0x61, 0x6e, 0x64, 0x20,
+    0x74, 0x68, 0x65, 0x20, 0x45, 0x54, 0x42, 0x20,
+    0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x20, 0x28,
+    0x34, 0x4b, 0x29, 0x20, 0x61, 0x72, 0x65, 0x20,
+    0x6f, 0x74, 0x68, 0x65, 0x72, 0x20, 0x6f, 0x70,
+    0x74, 0x69, 0x6f, 0x6e, 0x73, 0x2c, 0x20, 0x77,
+    0x68, 0x69, 0x6c, 0x65, 0x20, 0x74, 0x72, 0x61,
+    0x63, 0x65, 0x20, 0x69, 0x73, 0x20, 0x75, 0x6e,
+    0x75, 0x73, 0x65, 0x64, 0x2e, 0x0d, 0x0a, 0x73,
+    0x65, 0x74, 0x20, 0x5f, 0x54, 0x41, 0x52, 0x47,
+    0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20, 0x24,
+    0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d,
+    0x45, 0x2e, 0x61, 0x72, 0x6d, 0x0d, 0x0a, 0x0d,
+    0x0a, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x20,
+    0x63, 0x72, 0x65, 0x61, 0x74, 0x65, 0x20, 0x24,
+    0x5f, 0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e,
+    0x41, 0x4d, 0x45, 0x20, 0x61, 0x72, 0x6d, 0x39,
+    0x32, 0x36, 0x65, 0x6a, 0x73, 0x20, 0x2d, 0x65,
+    0x6e, 0x64, 0x69, 0x61, 0x6e, 0x20, 0x24, 0x5f,
+    0x45, 0x4e, 0x44, 0x49, 0x41, 0x4e, 0x20, 0x2d,
+    0x63, 0x68, 0x61, 0x69, 0x6e, 0x2d, 0x70, 0x6f,
+    0x73, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x24,
+    0x5f, 0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e,
+    0x41, 0x4d, 0x45, 0x0d, 0x0a, 0x24, 0x5f, 0x54,
+    0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d,
+    0x45, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
+    0x75, 0x72, 0x65, 0x20, 0x2d, 0x77, 0x6f, 0x72,
+    0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d, 0x76,
+    0x69, 0x72, 0x74, 0x20, 0x30, 0x20, 0x2d, 0x77,
+    0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61,
+    0x2d, 0x70, 0x68, 0x79, 0x73, 0x20, 0x30, 0x78,
+    0x30, 0x30, 0x30, 0x31, 0x34, 0x30, 0x30, 0x30,
+    0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61,
+    0x72, 0x65, 0x61, 0x2d, 0x73, 0x69, 0x7a, 0x65,
+    0x20, 0x30, 0x78, 0x34, 0x30, 0x30, 0x30, 0x20,
+    0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72,
+    0x65, 0x61, 0x2d, 0x62, 0x61, 0x63, 0x6b, 0x75,
+    0x70, 0x20, 0x30, 0x0d, 0x0a, 0x0d, 0x0a, 0x61,
+    0x72, 0x6d, 0x37, 0x5f, 0x39, 0x20, 0x64, 0x62,
+    0x67, 0x72, 0x71, 0x20, 0x65, 0x6e, 0x61, 0x62,
+    0x6c, 0x65, 0x0d, 0x0a, 0x61, 0x72, 0x6d, 0x37,
+    0x5f, 0x39, 0x20, 0x66, 0x61, 0x73, 0x74, 0x5f,
+    0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x5f, 0x61,
+    0x63, 0x63, 0x65, 0x73, 0x73, 0x20, 0x65, 0x6e,
+    0x61, 0x62, 0x6c, 0x65, 0x0d, 0x0a, 0x61, 0x72,
+    0x6d, 0x37, 0x5f, 0x39, 0x20, 0x64, 0x63, 0x63,
+    0x5f, 0x64, 0x6f, 0x77, 0x6e, 0x6c, 0x6f, 0x61,
+    0x64, 0x73, 0x20, 0x65, 0x6e, 0x61, 0x62, 0x6c,
+    0x65, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x20, 0x74,
+    0x72, 0x61, 0x63, 0x65, 0x20, 0x73, 0x65, 0x74,
+    0x75, 0x70, 0x0d, 0x0a, 0x23, 0x20, 0x46, 0x49,
+    0x58, 0x4d, 0x45, 0x20, 0x77, 0x65, 0x20, 0x6f,
+    0x75, 0x67, 0x68, 0x74, 0x20, 0x74, 0x6f, 0x20,
+    0x62, 0x65, 0x20, 0x61, 0x62, 0x6c, 0x65, 0x20,
+    0x74, 0x6f, 0x20, 0x73, 0x61, 0x79, 0x20, 0x22,
+    0x2e, 0x2e, 0x2e, 0x20, 0x63, 0x6f, 0x6e, 0x66,
+    0x69, 0x67, 0x20, 0x24, 0x5f, 0x54, 0x41, 0x52,
+    0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20,
+    0x2e, 0x2e, 0x2e, 0x22, 0x0d, 0x0a, 0x23, 0x20,
+    0x28, 0x6e, 0x6f, 0x74, 0x20, 0x22, 0x63, 0x6f,
+    0x6e, 0x66, 0x69, 0x67, 0x20, 0x30, 0x22, 0x29,
+    0x20, 0x66, 0x61, 0x63, 0x69, 0x6c, 0x69, 0x74,
+    0x61, 0x74, 0x69, 0x6e, 0x67, 0x20, 0x61, 0x64,
+    0x64, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x61, 0x6c,
+    0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74, 0x73,
+    0x20, 0x28, 0x65, 0x2e, 0x67, 0x2e, 0x20, 0x6f,
+    0x74, 0x68, 0x65, 0x72, 0x20, 0x63, 0x68, 0x69,
+    0x70, 0x73, 0x29, 0x0d, 0x0a, 0x65, 0x74, 0x6d,
+    0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67, 0x20,
+    0x30, 0x20, 0x31, 0x36, 0x20, 0x6e, 0x6f, 0x72,
+    0x6d, 0x61, 0x6c, 0x20, 0x66, 0x75, 0x6c, 0x6c,
+    0x20, 0x65, 0x74, 0x62, 0x0d, 0x0a, 0x65, 0x74,
+    0x62, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
+    0x20, 0x30, 0x20, 0x24, 0x5f, 0x43, 0x48, 0x49,
+    0x50, 0x4e, 0x41, 0x4d, 0x45, 0x2e, 0x65, 0x74,
+    0x62, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00, 0x00,
+    0x23, 0x0d, 0x0a, 0x23, 0x20, 0x54, 0x65, 0x78,
+    0x61, 0x73, 0x20, 0x49, 0x6e, 0x73, 0x74, 0x72,
+    0x75, 0x6d, 0x65, 0x6e, 0x74, 0x73, 0x20, 0x44,
+    0x61, 0x56, 0x69, 0x6e, 0x63, 0x69, 0x20, 0x66,
+    0x61, 0x6d, 0x69, 0x6c, 0x79, 0x3a, 0x20, 0x20,
+    0x54, 0x4d, 0x53, 0x33, 0x32, 0x30, 0x44, 0x4d,
+    0x36, 0x34, 0x34, 0x36, 0x0d, 0x0a, 0x23, 0x0d,
+    0x0a, 0x69, 0x66, 0x20, 0x7b, 0x20, 0x5b, 0x69,
+    0x6e, 0x66, 0x6f, 0x20, 0x65, 0x78, 0x69, 0x73,
+    0x74, 0x73, 0x20, 0x43, 0x48, 0x49, 0x50, 0x4e,
+    0x41, 0x4d, 0x45, 0x5d, 0x20, 0x7d, 0x20, 0x7b,
+    0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74,
+    0x20, 0x20, 0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e,
+    0x41, 0x4d, 0x45, 0x20, 0x24, 0x43, 0x48, 0x49,
+    0x50, 0x4e, 0x41, 0x4d, 0x45, 0x0d, 0x0a, 0x7d,
+    0x20, 0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d,
+    0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20,
+    0x20, 0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41,
+    0x4d, 0x45, 0x20, 0x64, 0x6d, 0x36, 0x34, 0x34,
+    0x36, 0x0d, 0x0a, 0x7d, 0x0d, 0x0a, 0x69, 0x66,
+    0x20, 0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f,
+    0x20, 0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20,
+    0x45, 0x4e, 0x44, 0x49, 0x41, 0x4e, 0x5d, 0x20,
+    0x7d, 0x20, 0x7b, 0x0d, 0x0a, 0x20, 0x20, 0x20,
+    0x73, 0x65, 0x74, 0x20, 0x20, 0x5f, 0x45, 0x4e,
+    0x44, 0x49, 0x41, 0x4e, 0x20, 0x24, 0x45, 0x4e,
+    0x44, 0x49, 0x41, 0x4e, 0x0d, 0x0a, 0x7d, 0x20,
+    0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d, 0x0a,
+    0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20, 0x20,
+    0x5f, 0x45, 0x4e, 0x44, 0x49, 0x41, 0x4e, 0x20,
+    0x6c, 0x69, 0x74, 0x74, 0x6c, 0x65, 0x0d, 0x0a,
+    0x7d, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x0d, 0x0a,
+    0x23, 0x20, 0x46, 0x6f, 0x72, 0x20, 0x6e, 0x6f,
+    0x77, 0x2c, 0x20, 0x65, 0x78, 0x70, 0x65, 0x63,
+    0x74, 0x20, 0x45, 0x4d, 0x55, 0x30, 0x2f, 0x45,
+    0x4d, 0x55, 0x31, 0x20, 0x6a, 0x75, 0x6d, 0x70,
+    0x65, 0x72, 0x65, 0x64, 0x20, 0x4c, 0x4f, 0x57,
+    0x20, 0x28, 0x6e, 0x6f, 0x74, 0x20, 0x54, 0x49,
+    0x27, 0x73, 0x20, 0x64, 0x65, 0x66, 0x61, 0x75,
+    0x6c, 0x74, 0x29, 0x20, 0x73, 0x6f, 0x20, 0x41,
+    0x52, 0x4d, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x45,
+    0x54, 0x42, 0x0d, 0x0a, 0x23, 0x20, 0x61, 0x72,
+    0x65, 0x20, 0x65, 0x6e, 0x61, 0x62, 0x6c, 0x65,
+    0x64, 0x20, 0x77, 0x69, 0x74, 0x68, 0x6f, 0x75,
+    0x74, 0x20, 0x6d, 0x61, 0x6b, 0x69, 0x6e, 0x67,
+    0x20, 0x49, 0x43, 0x45, 0x70, 0x69, 0x63, 0x6b,
+    0x20, 0x72, 0x6f, 0x75, 0x74, 0x65, 0x20, 0x41,
+    0x52, 0x4d, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x45,
+    0x54, 0x42, 0x20, 0x69, 0x6e, 0x74, 0x6f, 0x20,
+    0x74, 0x68, 0x65, 0x20, 0x4a, 0x54, 0x41, 0x47,
+    0x20, 0x63, 0x68, 0x61, 0x69, 0x6e, 0x2e, 0x0d,
+    0x0a, 0x23, 0x0d, 0x0a, 0x23, 0x20, 0x41, 0x6c,
+    0x73, 0x6f, 0x20, 0x6e, 0x6f, 0x74, 0x65, 0x3a,
+    0x20, 0x20, 0x77, 0x68, 0x65, 0x6e, 0x20, 0x72,
+    0x75, 0x6e, 0x6e, 0x69, 0x6e, 0x67, 0x20, 0x77,
+    0x69, 0x74, 0x68, 0x6f, 0x75, 0x74, 0x20, 0x52,
+    0x54, 0x43, 0x4b, 0x20, 0x62, 0x65, 0x66, 0x6f,
+    0x72, 0x65, 0x20, 0x74, 0x68, 0x65, 0x20, 0x50,
+    0x4c, 0x4c, 0x73, 0x20, 0x61, 0x72, 0x65, 0x20,
+    0x73, 0x65, 0x74, 0x20, 0x75, 0x70, 0x2c, 0x20,
+    0x79, 0x6f, 0x75, 0x0d, 0x0a, 0x23, 0x20, 0x6d,
+    0x61, 0x79, 0x20, 0x6e, 0x65, 0x65, 0x64, 0x20,
+    0x74, 0x6f, 0x20, 0x73, 0x6c, 0x6f, 0x77, 0x20,
+    0x74, 0x68, 0x65, 0x20, 0x4a, 0x54, 0x41, 0x47,
+    0x20, 0x63, 0x6c, 0x6f, 0x63, 0x6b, 0x20, 0x64,
+    0x6f, 0x77, 0x6e, 0x20, 0x71, 0x75, 0x69, 0x74,
+    0x65, 0x20, 0x61, 0x20, 0x6c, 0x6f, 0x74, 0x20,
+    0x28, 0x75, 0x6e, 0x64, 0x65, 0x72, 0x20, 0x32,
+    0x20, 0x4d, 0x48, 0x7a, 0x29, 0x2e, 0x0d, 0x0a,
+    0x23, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x20, 0x53,
+    0x75, 0x62, 0x73, 0x69, 0x64, 0x69, 0x61, 0x72,
+    0x79, 0x20, 0x54, 0x41, 0x50, 0x3a, 0x20, 0x41,
+    0x52, 0x4d, 0x20, 0x45, 0x54, 0x42, 0x31, 0x31,
+    0x2c, 0x20, 0x77, 0x69, 0x74, 0x68, 0x20, 0x73,
+    0x63, 0x61, 0x6e, 0x20, 0x63, 0x68, 0x61, 0x69,
+    0x6e, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x34, 0x4b,
+    0x20, 0x6f, 0x66, 0x20, 0x45, 0x54, 0x4d, 0x20,
+    0x74, 0x72, 0x61, 0x63, 0x65, 0x20, 0x62, 0x75,
+    0x66, 0x66, 0x65, 0x72, 0x0d, 0x0a, 0x69, 0x66,
+    0x20, 0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66, 0x6f,
+    0x20, 0x65, 0x78, 0x69, 0x73, 0x74, 0x73, 0x20,
+    0x45, 0x54, 0x42, 0x5f, 0x54, 0x41, 0x50, 0x49,
+    0x44, 0x20, 0x5d, 0x20, 0x7d, 0x20, 0x7b, 0x0d,
+    0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20,
+    0x5f, 0x45, 0x54, 0x42, 0x5f, 0x54, 0x41, 0x50,
+    0x49, 0x44, 0x20, 0x24, 0x45, 0x54, 0x42, 0x5f,
+    0x54, 0x41, 0x50, 0x49, 0x44, 0x0d, 0x0a, 0x7d,
+    0x20, 0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b, 0x0d,
+    0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74, 0x20,
+    0x5f, 0x45, 0x54, 0x42, 0x5f, 0x54, 0x41, 0x50,
+    0x49, 0x44, 0x20, 0x30, 0x78, 0x32, 0x62, 0x39,
+    0x30, 0x30, 0x66, 0x30, 0x66, 0x0d, 0x0a, 0x7d,
+    0x0d, 0x0a, 0x6a, 0x74, 0x61, 0x67, 0x20, 0x6e,
+    0x65, 0x77, 0x74, 0x61, 0x70, 0x20, 0x24, 0x5f,
+    0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45,
+    0x20, 0x65, 0x74, 0x62, 0x20, 0x2d, 0x69, 0x72,
+    0x6c, 0x65, 0x6e, 0x20, 0x34, 0x20, 0x2d, 0x69,
+    0x72, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72, 0x65,
+    0x20, 0x30, 0x78, 0x31, 0x20, 0x2d, 0x69, 0x72,
+    0x6d, 0x61, 0x73, 0x6b, 0x20, 0x30, 0x78, 0x66,
+    0x20, 0x2d, 0x65, 0x78, 0x70, 0x65, 0x63, 0x74,
+    0x65, 0x64, 0x2d, 0x69, 0x64, 0x20, 0x24, 0x5f,
+    0x45, 0x54, 0x42, 0x5f, 0x54, 0x41, 0x50, 0x49,
+    0x44, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x20, 0x53,
+    0x75, 0x62, 0x73, 0x69, 0x64, 0x69, 0x61, 0x72,
+    0x79, 0x20, 0x54, 0x41, 0x50, 0x3a, 0x20, 0x41,
+    0x52, 0x4d, 0x39, 0x32, 0x36, 0x65, 0x6a, 0x73,
+    0x20, 0x77, 0x69, 0x74, 0x68, 0x20, 0x73, 0x63,
+    0x61, 0x6e, 0x20, 0x63, 0x68, 0x61, 0x69, 0x6e,
+    0x73, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x41, 0x52,
+    0x4d, 0x20, 0x44, 0x65, 0x62, 0x75, 0x67, 0x2c,
+    0x20, 0x45, 0x6d, 0x62, 0x65, 0x64, 0x64, 0x65,
+    0x64, 0x49, 0x43, 0x45, 0x2d, 0x52, 0x54, 0x2c,
+    0x20, 0x45, 0x54, 0x4d, 0x2e, 0x0d, 0x0a, 0x69,
+    0x66, 0x20, 0x7b, 0x20, 0x5b, 0x69, 0x6e, 0x66,
+    0x6f, 0x20, 0x65, 0x78, 0x69, 0x73, 0x74, 0x73,
+    0x20, 0x43, 0x50, 0x55, 0x5f, 0x54, 0x41, 0x50,
+    0x49, 0x44, 0x20, 0x5d, 0x20, 0x7d, 0x20, 0x7b,
+    0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74,
+    0x20, 0x5f, 0x43, 0x50, 0x55, 0x5f, 0x54, 0x41,
+    0x50, 0x49, 0x44, 0x20, 0x24, 0x43, 0x50, 0x55,
+    0x5f, 0x54, 0x41, 0x50, 0x49, 0x44, 0x0d, 0x0a,
+    0x7d, 0x20, 0x65, 0x6c, 0x73, 0x65, 0x20, 0x7b,
+    0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65, 0x74,
+    0x20, 0x5f, 0x43, 0x50, 0x55, 0x5f, 0x54, 0x41,
+    0x50, 0x49, 0x44, 0x20, 0x30, 0x78, 0x30, 0x37,
+    0x39, 0x32, 0x36, 0x30, 0x30, 0x31, 0x0d, 0x0a,
+    0x7d, 0x0d, 0x0a, 0x6a, 0x74, 0x61, 0x67, 0x20,
+    0x6e, 0x65, 0x77, 0x74, 0x61, 0x70, 0x20, 0x24,
+    0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41, 0x4d,
+    0x45, 0x20, 0x61, 0x72, 0x6d, 0x20, 0x2d, 0x69,
+    0x72, 0x6c, 0x65, 0x6e, 0x20, 0x34, 0x20, 0x2d,
+    0x69, 0x72, 0x63, 0x61, 0x70, 0x74, 0x75, 0x72,
+    0x65, 0x20, 0x30, 0x78, 0x31, 0x20, 0x2d, 0x69,
+    0x72, 0x6d, 0x61, 0x73, 0x6b, 0x20, 0x30, 0x78,
+    0x66, 0x20, 0x2d, 0x65, 0x78, 0x70, 0x65, 0x63,
+    0x74, 0x65, 0x64, 0x2d, 0x69, 0x64, 0x20, 0x24,
+    0x5f, 0x43, 0x50, 0x55, 0x5f, 0x54, 0x41, 0x50,
+    0x49, 0x44, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x20,
+    0x53, 0x75, 0x62, 0x73, 0x69, 0x64, 0x69, 0x61,
+    0x72, 0x79, 0x20, 0x54, 0x41, 0x50, 0x3a, 0x20,
+    0x43, 0x36, 0x34, 0x78, 0x2b, 0x20, 0x44, 0x53,
+    0x50, 0x20, 0x2e, 0x2e, 0x2e, 0x20, 0x4e, 0x4f,
+    0x54, 0x20, 0x43, 0x55, 0x52, 0x52, 0x45, 0x4e,
+    0x54, 0x4c, 0x59, 0x20, 0x49, 0x4e, 0x43, 0x4c,
+    0x55, 0x44, 0x45, 0x44, 0x2c, 0x20, 0x6d, 0x75,
+    0x73, 0x74, 0x20, 0x61, 0x64, 0x64, 0x20, 0x76,
+    0x69, 0x61, 0x20, 0x49, 0x43, 0x45, 0x70, 0x69,
+    0x63, 0x6b, 0x2e, 0x0d, 0x0a, 0x23, 0x20, 0x44,
+    0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x61,
+    0x74, 0x69, 0x6f, 0x6e, 0x20, 0x66, 0x6f, 0x72,
+    0x20, 0x44, 0x53, 0x50, 0x20, 0x4a, 0x54, 0x41,
+    0x47, 0x20, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x66,
+    0x61, 0x63, 0x65, 0x73, 0x20, 0x65, 0x76, 0x69,
+    0x64, 0x65, 0x6e, 0x74, 0x6c, 0x79, 0x20, 0x6e,
+    0x65, 0x65, 0x64, 0x73, 0x20, 0x4e, 0x44, 0x41,
+    0x73, 0x2e, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x20,
+    0x50, 0x72, 0x69, 0x6d, 0x61, 0x72, 0x79, 0x20,
+    0x54, 0x41, 0x50, 0x3a, 0x20, 0x49, 0x43, 0x45,
+    0x70, 0x69, 0x63, 0x6b, 0x20, 0x28, 0x4a, 0x54,
+    0x41, 0x47, 0x20, 0x72, 0x6f, 0x75, 0x74, 0x65,
+    0x20, 0x63, 0x6f, 0x6e, 0x74, 0x72, 0x6f, 0x6c,
+    0x6c, 0x65, 0x72, 0x29, 0x20, 0x61, 0x6e, 0x64,
+    0x20, 0x62, 0x6f, 0x75, 0x6e, 0x64, 0x61, 0x72,
+    0x79, 0x20, 0x73, 0x63, 0x61, 0x6e, 0x0d, 0x0a,
+    0x69, 0x66, 0x20, 0x7b, 0x20, 0x5b, 0x69, 0x6e,
+    0x66, 0x6f, 0x20, 0x65, 0x78, 0x69, 0x73, 0x74,
+    0x73, 0x20, 0x4a, 0x52, 0x43, 0x5f, 0x54, 0x41,
+    0x50, 0x49, 0x44, 0x20, 0x5d, 0x20, 0x7d, 0x20,
+    0x7b, 0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65,
+    0x74, 0x20, 0x5f, 0x4a, 0x52, 0x43, 0x5f, 0x54,
+    0x41, 0x50, 0x49, 0x44, 0x20, 0x24, 0x4a, 0x52,
+    0x43, 0x5f, 0x54, 0x41, 0x50, 0x49, 0x44, 0x0d,
+    0x0a, 0x7d, 0x20, 0x65, 0x6c, 0x73, 0x65, 0x20,
+    0x7b, 0x0d, 0x0a, 0x20, 0x20, 0x20, 0x73, 0x65,
+    0x74, 0x20, 0x5f, 0x4a, 0x52, 0x43, 0x5f, 0x54,
+    0x41, 0x50, 0x49, 0x44, 0x20, 0x30, 0x78, 0x30,
+    0x62, 0x37, 0x30, 0x30, 0x30, 0x32, 0x66, 0x0d,
+    0x0a, 0x7d, 0x0d, 0x0a, 0x6a, 0x74, 0x61, 0x67,
+    0x20, 0x6e, 0x65, 0x77, 0x74, 0x61, 0x70, 0x20,
+    0x24, 0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41,
+    0x4d, 0x45, 0x20, 0x6a, 0x72, 0x63, 0x20, 0x2d,
+    0x69, 0x72, 0x6c, 0x65, 0x6e, 0x20, 0x36, 0x20,
+    0x2d, 0x69, 0x72, 0x63, 0x61, 0x70, 0x74, 0x75,
+    0x72, 0x65, 0x20, 0x30, 0x78, 0x31, 0x20, 0x2d,
+    0x69, 0x72, 0x6d, 0x61, 0x73, 0x6b, 0x20, 0x30,
+    0x78, 0x33, 0x66, 0x20, 0x2d, 0x65, 0x78, 0x70,
+    0x65, 0x63, 0x74, 0x65, 0x64, 0x2d, 0x69, 0x64,
+    0x20, 0x24, 0x5f, 0x4a, 0x52, 0x43, 0x5f, 0x54,
+    0x41, 0x50, 0x49, 0x44, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x23, 0x20, 0x47, 0x44, 0x42, 0x20, 0x74, 0x61,
+    0x72, 0x67, 0x65, 0x74, 0x3a, 0x20, 0x20, 0x74,
+    0x68, 0x65, 0x20, 0x41, 0x52, 0x4d, 0x2c, 0x20,
+    0x75, 0x73, 0x69, 0x6e, 0x67, 0x20, 0x53, 0x52,
+    0x41, 0x4d, 0x31, 0x20, 0x66, 0x6f, 0x72, 0x20,
+    0x73, 0x63, 0x72, 0x61, 0x74, 0x63, 0x68, 0x2e,
+    0x20, 0x20, 0x53, 0x52, 0x41, 0x4d, 0x30, 0x20,
+    0x28, 0x61, 0x6c, 0x73, 0x6f, 0x20, 0x38, 0x4b,
+    0x29, 0x0d, 0x0a, 0x23, 0x20, 0x61, 0x6e, 0x64,
+    0x20, 0x74, 0x68, 0x65, 0x20, 0x45, 0x54, 0x42,
+    0x20, 0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x20,
+    0x28, 0x34, 0x4b, 0x29, 0x20, 0x61, 0x72, 0x65,
+    0x20, 0x6f, 0x74, 0x68, 0x65, 0x72, 0x20, 0x6f,
+    0x70, 0x74, 0x69, 0x6f, 0x6e, 0x73, 0x2c, 0x20,
+    0x77, 0x68, 0x69, 0x6c, 0x65, 0x20, 0x74, 0x72,
+    0x61, 0x63, 0x65, 0x20, 0x69, 0x73, 0x20, 0x75,
+    0x6e, 0x75, 0x73, 0x65, 0x64, 0x2e, 0x0d, 0x0a,
+    0x73, 0x65, 0x74, 0x20, 0x5f, 0x54, 0x41, 0x52,
+    0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45, 0x20,
+    0x24, 0x5f, 0x43, 0x48, 0x49, 0x50, 0x4e, 0x41,
+    0x4d, 0x45, 0x2e, 0x61, 0x72, 0x6d, 0x0d, 0x0a,
+    0x0d, 0x0a, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74,
+    0x20, 0x63, 0x72, 0x65, 0x61, 0x74, 0x65, 0x20,
+    0x24, 0x5f, 0x54, 0x41, 0x52, 0x47, 0x45, 0x54,
+    0x4e, 0x41, 0x4d, 0x45, 0x20, 0x61, 0x72, 0x6d,
+    0x39, 0x32, 0x36, 0x65, 0x6a, 0x73, 0x20, 0x2d,
+    0x65, 0x6e, 0x64, 0x69, 0x61, 0x6e, 0x20, 0x24,
+    0x5f, 0x45, 0x4e, 0x44, 0x49, 0x41, 0x4e, 0x20,
+    0x2d, 0x63, 0x68, 0x61, 0x69, 0x6e, 0x2d, 0x70,
+    0x6f, 0x73, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x20,
+    0x24, 0x5f, 0x54, 0x41, 0x52, 0x47, 0x45, 0x54,
+    0x4e, 0x41, 0x4d, 0x45, 0x0d, 0x0a, 0x24, 0x5f,
+    0x54, 0x41, 0x52, 0x47, 0x45, 0x54, 0x4e, 0x41,
+    0x4d, 0x45, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69,
+    0x67, 0x75, 0x72, 0x65, 0x20, 0x2d, 0x77, 0x6f,
+    0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65, 0x61, 0x2d,
+    0x76, 0x69, 0x72, 0x74, 0x20, 0x30, 0x20, 0x2d,
+    0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61, 0x72, 0x65,
+    0x61, 0x2d, 0x70, 0x68, 0x79, 0x73, 0x20, 0x30,
+    0x78, 0x30, 0x30, 0x30, 0x30, 0x61, 0x30, 0x30,
+    0x30, 0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d,
+    0x61, 0x72, 0x65, 0x61, 0x2d, 0x73, 0x69, 0x7a,
+    0x65, 0x20, 0x30, 0x78, 0x32, 0x30, 0x30, 0x30,
+    0x20, 0x2d, 0x77, 0x6f, 0x72, 0x6b, 0x2d, 0x61,
+    0x72, 0x65, 0x61, 0x2d, 0x62, 0x61, 0x63, 0x6b,
+    0x75, 0x70, 0x20, 0x30, 0x0d, 0x0a, 0x0d, 0x0a,
+    0x61, 0x72, 0x6d, 0x37, 0x5f, 0x39, 0x20, 0x64,
+    0x62, 0x67, 0x72, 0x71, 0x20, 0x65, 0x6e, 0x61,
+    0x62, 0x6c, 0x65, 0x0d, 0x0a, 0x61, 0x72, 0x6d,
+    0x37, 0x5f, 0x39, 0x20, 0x66, 0x61, 0x73, 0x74,
+    0x5f, 0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x5f,
+    0x61, 0x63, 0x63, 0x65, 0x73, 0x73, 0x20, 0x65,
+    0x6e, 0x61, 0x62, 0x6c, 0x65, 0x0d, 0x0a, 0x61,
+    0x72, 0x6d, 0x37, 0x5f, 0x39, 0x20, 0x64, 0x63,
+    0x63, 0x5f, 0x64, 0x6f, 0x77, 0x6e, 0x6c, 0x6f,
+    0x61, 0x64, 0x73, 0x20, 0x65, 0x6e, 0x61, 0x62,
+    0x6c, 0x65, 0x0d, 0x0a, 0x0d, 0x0a, 0x23, 0x20,
+    0x74, 0x72, 0x61, 0x63, 0x65, 0x20, 0x73, 0x65,
+    0x74, 0x75, 0x70, 0x0d, 0x0a, 0x23, 0x20, 0x46,
+    0x49, 0x58, 0x4d, 0x45, 0x20, 0x77, 0x65, 0x20,
+    0x6f, 0x75, 0x67, 0x68, 0x74, 0x20, 0x74, 0x6f,
+    0x20, 0x62, 0x65, 0x20, 0x61, 0x62, 0x6c, 0x65,
+    0x20, 0x74, 0x6f, 0x20, 0x73, 0x61, 0x79, 0x20,
+    0x22, 0x2e, 0x2e, 0x2e, 0x20, 0x63, 0x6f, 0x6e,
+    0x66, 0x69, 0x67, 0x20, 0x24, 0x5f, 0x54, 0x41,
+    0x52, 0x47, 0x45, 0x54, 0x4e, 0x41, 0x4d, 0x45,
+    0x20, 0x2e, 0x2e, 0x2e, 0x22, 0x0d, 0x0a, 0x23,
+    0x20, 0x28, 0x6e, 0x6f, 0x74, 0x20, 0x22, 0x63,
+    0x6f, 0x6e, 0x66, 0x69, 0x67, 0x20, 0x30, 0x22,
+    0x29, 0x20, 0x66, 0x61, 0x63, 0x69, 0x6c, 0x69,
+    0x74, 0x61, 0x74, 0x69, 0x6e, 0x67, 0x20, 0x61,
+    0x64, 0x64, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x61,
+    0x6c, 0x20, 0x74, 0x61, 0x72, 0x67, 0x65, 0x74,
+    0x73, 0x20, 0x28, 0x65, 0x2e, 0x67, 0x2e, 0x20,
+    0x6f, 0x74, 0x68, 0x65, 0x72, 0x20, 0x63, 0x68,
+    0x69, 0x70, 0x73, 0x29, 0x0d, 0x0a, 0x65, 0x74,
+    0x6d, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69, 0x67,
+    0x20, 0x30, 0x20, 0x31, 0x36, 0x20, 0x6e, 0x6f,
+    0x72, 0x6d, 0x61, 0x6c, 0x20, 0x66, 0x75, 0x6c,
+    0x6c, 0x20, 0x65, 0x74, 0x62, 0x0d, 0x0a, 0x65,
+    0x74, 0x62, 0x20, 0x63, 0x6f, 0x6e, 0x66, 0x69,
+    0x67, 0x20, 0x30, 0x20, 0x24, 0x5f, 0x43, 0x48,
+    0x49, 0x50, 0x4e, 0x41, 0x4d, 0x45, 0x2e, 0x65,
+    0x74, 0x62, 0x0d, 0x0a, 0x0d, 0x0a, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x23, 0x20, 0x46, 0x49, 0x58, 0x4d, 0x45, 0x3a,
     0x20, 0x54, 0x48, 0x49, 0x53, 0x20, 0x49, 0x53,
     0x20, 0x41, 0x20, 0x2a, 0x42, 0x4f, 0x41, 0x52,

Modified: zy1000/trunk/snapshots/athttpd.zip
===================================================================
(Binary files differ)

Modified: zy1000/trunk/snapshots/discover.zip
===================================================================
(Binary files differ)

Modified: zy1000/trunk/snapshots/jimtcl.zip
===================================================================
(Binary files differ)



From zwelch at mail.berlios.de  Wed May 13 23:55:20 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 13 May 2009 23:55:20 +0200
Subject: [Openocd-svn] r1779 - trunk
Message-ID: <200905132155.n4DLtKhM015324@sheep.berlios.de>

Author: zwelch
Date: 2009-05-13 23:55:16 +0200 (Wed, 13 May 2009)
New Revision: 1779

Modified:
   trunk/bootstrap
Log:
Fix bootstrap script to support MacOS glibtoolize oddity.

Modified: trunk/bootstrap
===================================================================
--- trunk/bootstrap	2009-05-13 19:13:32 UTC (rev 1778)
+++ trunk/bootstrap	2009-05-13 21:55:16 UTC (rev 1779)
@@ -1,9 +1,25 @@
-aclocal \
-&& autoheader \
-&& libtoolize --automake \
-&& automake --foreign --add-missing --copy \
-&& autoconf
+#!/bin/sh -e
 
+if libtoolize --version >/dev/null 2>&1; then
+	libtoolize="libtoolize"
+elif libtoolize --version >/dev/null 2>&1; then
+	libtoolize="glibtoolize"
+else
+	echo "libtool is required" >&2
+	exit 1
+fi
+
+# bootstrap the autotools
+(
+set -x
+aclocal
+autoheader
+${libtoolize} --automake --copy
+autoconf
+autoheader
+automake --foreign --add-missing --copy
+)
+
 # AM_MAINTAINER_MODE requires SVN users provide --enable-maintainer-mode
 # otherwise the documentation will fail to build due to missing version.texi
 echo "Bootstrap complete; you can './configure --enable-maintainer-mode ....'"



From zwelch at mail.berlios.de  Thu May 14 01:37:33 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 14 May 2009 01:37:33 +0200
Subject: [Openocd-svn] r1780 - trunk
Message-ID: <200905132337.n4DNbXM8015703@sheep.berlios.de>

Author: zwelch
Date: 2009-05-14 01:37:29 +0200 (Thu, 14 May 2009)
New Revision: 1780

Modified:
   trunk/bootstrap
Log:
Fix bootstrap typo noticed by Edgar Grimberg <edgar.grimberg at zylin.com>.

Modified: trunk/bootstrap
===================================================================
--- trunk/bootstrap	2009-05-13 21:55:16 UTC (rev 1779)
+++ trunk/bootstrap	2009-05-13 23:37:29 UTC (rev 1780)
@@ -2,7 +2,7 @@
 
 if libtoolize --version >/dev/null 2>&1; then
 	libtoolize="libtoolize"
-elif libtoolize --version >/dev/null 2>&1; then
+elif glibtoolize --version >/dev/null 2>&1; then
 	libtoolize="glibtoolize"
 else
 	echo "libtool is required" >&2



From zwelch at mail.berlios.de  Thu May 14 01:38:42 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 14 May 2009 01:38:42 +0200
Subject: [Openocd-svn] r1781 - trunk
Message-ID: <200905132338.n4DNcgvP017371@sheep.berlios.de>

Author: zwelch
Date: 2009-05-14 01:38:38 +0200 (Thu, 14 May 2009)
New Revision: 1781

Modified:
   trunk/configure.in
Log:
Update configure script test for net/if.h to work on MacOS.

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-13 23:37:29 UTC (rev 1780)
+++ trunk/configure.in	2009-05-13 23:38:38 UTC (rev 1781)
@@ -18,7 +18,6 @@
 AC_CHECK_HEADERS(netdb.h)
 AC_CHECK_HEADERS(netinet/in.h)
 AC_CHECK_HEADERS(netinet/tcp.h)
-AC_CHECK_HEADERS(net/if.h)
 AC_CHECK_HEADERS(pthread.h)
 AC_CHECK_HEADERS(strings.h)
 AC_CHECK_HEADERS(sys/ioctl.h)
@@ -31,6 +30,21 @@
 AC_CHECK_HEADERS(sys/types.h)
 AC_CHECK_HEADERS(unistd.h)
 
+AC_CHECK_HEADERS([net/if.h], [], [], [dnl
+#include <stdio.h>
+#ifdef STDC_HEADERS
+# include <stdlib.h>
+# include <stddef.h>
+#else
+# ifdef HAVE_STDLIB_H
+#  include <stdlib.h>
+# endif
+#endif
+#ifdef HAVE_SYS_SOCKET_H
+# include <sys/socket.h>
+#endif
+])
+
 AC_HEADER_ASSERT
 AC_HEADER_STDBOOL
 AC_HEADER_TIME



From oharboe at mail.berlios.de  Thu May 14 10:44:10 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 14 May 2009 10:44:10 +0200
Subject: [Openocd-svn] r1782 - trunk/src/target
Message-ID: <200905140844.n4E8iACo010769@sheep.berlios.de>

Author: oharboe
Date: 2009-05-14 10:44:09 +0200 (Thu, 14 May 2009)
New Revision: 1782

Modified:
   trunk/src/target/target.c
Log:
propagate error in dump_image. If an error occurs during dump_image, a tcl exception is thrown.

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-13 23:38:38 UTC (rev 1781)
+++ trunk/src/target/target.c	2009-05-14 08:44:09 UTC (rev 1782)
@@ -2158,10 +2158,10 @@
 	if (retval==ERROR_OK)
 	{
 		command_print(cmd_ctx, "dumped %"PRIi64" byte in %s", fileio.size, duration_text);
+		free(duration_text);
 	}
-	free(duration_text);
 
-	return ERROR_OK;
+	return retval;
 }
 
 static int handle_verify_image_command_internal(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, int verify)



From oharboe at mail.berlios.de  Thu May 14 12:52:42 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 14 May 2009 12:52:42 +0200
Subject: [Openocd-svn] r1783 - trunk/src/target/test
Message-ID: <200905141052.n4EAqgpJ007342@sheep.berlios.de>

Author: oharboe
Date: 2009-05-14 12:52:41 +0200 (Thu, 14 May 2009)
New Revision: 1783

Added:
   trunk/src/target/test/selftest.cfg
Log:
selftest wip

Added: trunk/src/target/test/selftest.cfg
===================================================================
--- trunk/src/target/test/selftest.cfg	2009-05-14 08:44:09 UTC (rev 1782)
+++ trunk/src/target/test/selftest.cfg	2009-05-14 10:52:41 UTC (rev 1783)
@@ -0,0 +1,17 @@
+
+add_help_text selftest "run selftest using working ram <tmpfile> <address> <size>"
+
+proc selftest {tmpfile address size} {
+
+   for {set i 0} {$i < $size } {set i [expr $i+4]} {
+       mww [expr $address+$i] $i
+   }
+
+   for {set i 0} {$i < 10 } {set i [expr $i+1]} {
+    puts "Test iteration $i"
+    dump_image $tmpfile $address $size
+	verify_image $tmpfile $address bin
+	load_image $tmpfile $address bin
+   }
+
+}
\ No newline at end of file



From oharboe at mail.berlios.de  Thu May 14 20:45:20 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 14 May 2009 20:45:20 +0200
Subject: [Openocd-svn] r1784 - trunk/src/jtag
Message-ID: <200905141845.n4EIjKbj014947@sheep.berlios.de>

Author: oharboe
Date: 2009-05-14 20:45:19 +0200 (Thu, 14 May 2009)
New Revision: 1784

Modified:
   trunk/src/jtag/jtag.c
Log:
fix broken ir/drscan -endstate option. The statemachine now actually ends up in said state.

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-14 10:52:41 UTC (rev 1783)
+++ trunk/src/jtag/jtag.c	2009-05-14 18:45:19 UTC (rev 1784)
@@ -2875,7 +2875,7 @@
 	/*          "statename" */
 	/* at the end of the arguments. */
 	/* assume none. */
-	endstate = TAP_INVALID;
+	endstate = cmd_queue_end_state;
 	if( argc >= 4 ){
 		/* have at least one pair of numbers. */
 		/* is last pair the magic text? */
@@ -2918,19 +2918,17 @@
 		fields[i].in_value = NULL;
 	}
 
-	jtag_add_ir_scan(num_fields, fields, TAP_INVALID);
 	/* did we have an endstate? */
-	if (endstate != TAP_INVALID)
-		jtag_add_end_state(endstate);
+	jtag_add_ir_scan(num_fields, fields, endstate);
 
-	jtag_execute_queue();
+	int retval=jtag_execute_queue();
 
 	for (i = 0; i < num_fields; i++)
 		free(fields[i].out_value);
 
 	free (fields);
 
-	return ERROR_OK;
+	return retval;
 }
 
 static int Jim_Command_drscan(Jim_Interp *interp, int argc, Jim_Obj *const *args)
@@ -2959,7 +2957,7 @@
 	}
 
 	/* assume no endstate */
-	endstate = TAP_INVALID;
+	endstate = cmd_queue_end_state;
 	/* validate arguments as numbers */
 	e = JIM_OK;
 	for (i = 2; i < argc; i+=2)
@@ -3031,10 +3029,7 @@
 		field_count++;
 	}
 
-	jtag_add_dr_scan(num_fields, fields, TAP_INVALID);
-	/* did we get an end state? */
-	if (endstate != TAP_INVALID)
-		jtag_add_end_state(endstate);
+	jtag_add_dr_scan(num_fields, fields, endstate);
 
 	retval = jtag_execute_queue();
 	if (retval != ERROR_OK)



From oharboe at mail.berlios.de  Thu May 14 20:56:41 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 14 May 2009 20:56:41 +0200
Subject: [Openocd-svn] r1785 - trunk/src/target
Message-ID: <200905141856.n4EIufYd020332@sheep.berlios.de>

Author: oharboe
Date: 2009-05-14 20:56:41 +0200 (Thu, 14 May 2009)
New Revision: 1785

Modified:
   trunk/src/target/target.c
Log:
dump_image now works for addresses not divisible by 4

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-14 18:45:19 UTC (rev 1784)
+++ trunk/src/target/target.c	2009-05-14 18:56:41 UTC (rev 1785)
@@ -2133,7 +2133,7 @@
 		u32 size_written;
 		u32 this_run_size = (size > 560) ? 560 : size;
 
-		retval = target->type->read_memory(target, address, 4, this_run_size / 4, buffer);
+		retval = target_read_buffer(target, address, this_run_size, buffer);
 		if (retval != ERROR_OK)
 		{
 			break;



From oharboe at mail.berlios.de  Thu May 14 21:00:42 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 14 May 2009 21:00:42 +0200
Subject: [Openocd-svn] r1786 - trunk/src/target
Message-ID: <200905141900.n4EJ0gmS022802@sheep.berlios.de>

Author: oharboe
Date: 2009-05-14 21:00:35 +0200 (Thu, 14 May 2009)
New Revision: 1786

Modified:
   trunk/src/target/target.c
Log:
take #2: dump_image now works for addresses not divisible by 4 

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-14 18:56:41 UTC (rev 1785)
+++ trunk/src/target/target.c	2009-05-14 19:00:35 UTC (rev 1786)
@@ -2115,12 +2115,6 @@
 	address = strtoul(args[1], NULL, 0);
 	size = strtoul(args[2], NULL, 0);
 
-	if ((address & 3) || (size & 3))
-	{
-		command_print(cmd_ctx, "only 32-bit aligned address and size are supported");
-		return ERROR_OK;
-	}
-
 	if (fileio_open(&fileio, args[0], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK)
 	{
 		return ERROR_OK;



From oharboe at mail.berlios.de  Thu May 14 23:00:35 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Thu, 14 May 2009 23:00:35 +0200
Subject: [Openocd-svn] r1787 - trunk/src/flash
Message-ID: <200905142100.n4EL0ZE7006798@sheep.berlios.de>

Author: oharboe
Date: 2009-05-14 23:00:30 +0200 (Thu, 14 May 2009)
New Revision: 1787

Modified:
   trunk/src/flash/str9xpec.c
Log:
use TAP_INVALID enum instead of -1

Modified: trunk/src/flash/str9xpec.c
===================================================================
--- trunk/src/flash/str9xpec.c	2009-05-14 19:00:35 UTC (rev 1786)
+++ trunk/src/flash/str9xpec.c	2009-05-14 21:00:30 UTC (rev 1787)
@@ -572,7 +572,7 @@
 		
 		
 
-		jtag_add_dr_scan(1, &field, -1);
+		jtag_add_dr_scan(1, &field, TAP_INVALID);
 		jtag_execute_queue();
 
 	} while(!(status & ISC_STATUS_BUSY));
@@ -658,7 +658,7 @@
 	
 	
 
-	jtag_add_dr_scan(1, &field, -1);
+	jtag_add_dr_scan(1, &field, TAP_INVALID);
 
 	return ERROR_OK;
 }
@@ -765,7 +765,7 @@
 				
 				
 
-				jtag_add_dr_scan(1, &field, -1);
+				jtag_add_dr_scan(1, &field, TAP_INVALID);
 				jtag_execute_queue();
 
 				status = buf_get_u32(scanbuf, 0, 8);
@@ -825,7 +825,7 @@
 			
 			
 
-			jtag_add_dr_scan(1, &field, -1);
+			jtag_add_dr_scan(1, &field, TAP_INVALID);
 			jtag_execute_queue();
 
 			status = buf_get_u32(scanbuf, 0, 8);
@@ -1032,7 +1032,7 @@
 		
 		
 
-		jtag_add_dr_scan(1, &field, -1);
+		jtag_add_dr_scan(1, &field, TAP_INVALID);
 		jtag_execute_queue();
 
 	} while(!(status & ISC_STATUS_BUSY));



From zwelch at mail.berlios.de  Thu May 14 23:56:02 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 14 May 2009 23:56:02 +0200
Subject: [Openocd-svn] r1788 - trunk/src/target/board
Message-ID: <200905142156.n4ELu2pu012877@sheep.berlios.de>

Author: zwelch
Date: 2009-05-14 23:55:56 +0200 (Thu, 14 May 2009)
New Revision: 1788

Added:
   trunk/src/target/board/imx27lnst.cfg
Log:
Paul Thomas <pthomas8589 at gmail.com>: new board cfg for Linuxstamp-mx27

Added: trunk/src/target/board/imx27lnst.cfg
===================================================================
--- trunk/src/target/board/imx27lnst.cfg	2009-05-14 21:00:30 UTC (rev 1787)
+++ trunk/src/target/board/imx27lnst.cfg	2009-05-14 21:55:56 UTC (rev 1788)
@@ -0,0 +1,59 @@
+# The Linuxstamp-mx27 is board has a single IMX27 chip
+# For further info see http://opencircuits.com/Linuxstamp_mx27#OpenOCD
+source [find target/imx27.cfg]
+$_TARGETNAME configure -event gdb-attach { reset init }
+$_TARGETNAME configure -event reset-init { imx27lnst_init }
+
+proc imx27lnst_init { } {
+	# This setup puts RAM at 0xA0000000
+
+	# reset the board correctly
+	jtag_khz 500
+	reset run
+	reset halt
+
+	mww 0x10000000 0x20040304
+	mww 0x10020000 0x00000000
+	mww 0x10000004 0xDFFBFCFB
+	mww 0x10020004 0xFFFFFFFF
+
+	sleep 100
+
+	# ========================================
+	#  Configure DDR on CSD0 -- initial reset
+	# ========================================
+	mww 0xD8001010 0x00000008 
+
+	sleep 100
+
+	# ========================================
+	#  Configure DDR on CSD0 -- wait 5000 cycle 
+	# ========================================
+	mww 0x10027828 0x55555555 
+	mww 0x10027830 0x55555555 
+	mww 0x10027834 0x55555555 
+	mww 0x10027838 0x00005005 
+	mww 0x1002783C 0x15555555 
+
+	mww 0xD8001010 0x00000004 
+
+	mww 0xD8001004 0x00795729 
+
+	#mww 0xD8001000 0x92200000
+	mww 0xD8001000 0x91120000
+	mww 0xA0000F00 0x0
+
+	#mww 0xD8001000 0xA2200000 
+	mww 0xD8001000 0xA1120000
+	mww 0xA0000F00 0x0
+	mww 0xA0000F00 0x0
+
+	#mww 0xD8001000 0xB2200000 
+	mww 0xD8001000 0xB1120000
+	mwb 0xA0000033 0xFF
+	mwb 0xA1000000 0xAA
+
+	#mww 0xD8001000 0x82228085 
+	mww 0xD8001000 0x81128080
+
+}


Property changes on: trunk/src/target/board/imx27lnst.cfg
___________________________________________________________________
Name: svn:eol-style
   + native



From zwelch at mail.berlios.de  Fri May 15 00:16:25 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 15 May 2009 00:16:25 +0200
Subject: [Openocd-svn] r1789 - in trunk/doc/manual: . primer
Message-ID: <200905142216.n4EMGPGo015061@sheep.berlios.de>

Author: zwelch
Date: 2009-05-15 00:16:20 +0200 (Fri, 15 May 2009)
New Revision: 1789

Modified:
   trunk/doc/manual/jtag.txt
   trunk/doc/manual/main.txt
   trunk/doc/manual/primer/jtag.txt
Log:
Several minor fixes for the new doxygen manual.

Modified: trunk/doc/manual/jtag.txt
===================================================================
--- trunk/doc/manual/jtag.txt	2009-05-14 21:55:56 UTC (rev 1788)
+++ trunk/doc/manual/jtag.txt	2009-05-14 22:16:20 UTC (rev 1789)
@@ -1,7 +1,7 @@
 /** @page jtagdocs OpenOCD JTAG APIs
 
-This document contains @subpage jtagprimer, which introduces the
-IEEE JTAG interface.
+For new developers unfamiliar with the technology, @ref primerjtag provides
+a brief introduction to the IEEE JTAG interface.
 
 The OpenOCD JTAG library API covers several functional areas:
 

Modified: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-05-14 21:55:56 UTC (rev 1788)
+++ trunk/doc/manual/main.txt	2009-05-14 22:16:20 UTC (rev 1789)
@@ -7,9 +7,9 @@
  
  */
 
-/** @page primer OpenOCD Techincal Primers
+/** @page primer OpenOCD Technical Primers
 
-This pages lists Techincal Primers available for OpenOCD Developers.
+This pages lists Technical Primers available for OpenOCD Developers.
 They seek to provide information to pull novices up the learning curves
 associated with the fundamental technologies used by OpenOCD.
 

Modified: trunk/doc/manual/primer/jtag.txt
===================================================================
--- trunk/doc/manual/primer/jtag.txt	2009-05-14 21:55:56 UTC (rev 1788)
+++ trunk/doc/manual/primer/jtag.txt	2009-05-14 22:16:20 UTC (rev 1789)
@@ -30,10 +30,10 @@
 TMS which will select different shift registers.
 
 The first thing you need to do is reset the state machine, because when 
-you connect to a chip you dont know what state the jtag is in,you need 
+you connect to a chip you do not know what state the controller is in,you need 
 to clock TMS as 1, at least 7 times.  This will put you into "Test Logic 
 Reset" State.  Knowing this, you can, once reset, then track what each 
-transition on TMS will do, and hence know what state the jtag state 
+transition on TMS will do, and hence know what state the JTAG state 
 machine is in.
 
 There are 2 "types" of shift registers.  The Instruction shift register 
@@ -47,7 +47,7 @@
 
 For example, one of the data registers will be known as "bypass" this is 
 (usually) a single bit which has no function and is used to bypass the 
-chip.  Eg, assume we have 3 identical chips, wired up like the picture 
+chip.  Assume we have 3 identical chips, wired up like the picture 
 and each has a 3 bit instruction register, and there are 2 known 
 instructions (110 = bypass, 010 = some other function) if we want to use 
 "some other function", on the second chip in the line, and not change 
@@ -88,7 +88,8 @@
 
   0 1 0 1 0 1 1 1 1 0
 
-Again, we are clocking the lsbit first.  Then we would clock TMS:
+Again, we are clocking the least-significant bit first.  Then we would
+clock TMS:
 
   1 1 0
 



From zwelch at mail.berlios.de  Fri May 15 00:20:03 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 15 May 2009 00:20:03 +0200
Subject: [Openocd-svn] r1790 - trunk/src/helper
Message-ID: <200905142220.n4EMK322015609@sheep.berlios.de>

Author: zwelch
Date: 2009-05-15 00:20:00 +0200 (Fri, 15 May 2009)
New Revision: 1790

Modified:
   trunk/src/helper/command.h
Log:
Remove JIM_EMBEDDED symbol; not appropriate or necessary.

Modified: trunk/src/helper/command.h
===================================================================
--- trunk/src/helper/command.h	2009-05-14 22:16:20 UTC (rev 1789)
+++ trunk/src/helper/command.h	2009-05-14 22:20:00 UTC (rev 1790)
@@ -32,7 +32,6 @@
 /* Jim is provied by eCos */
 #include <cyg/jimtcl/jim.h>
 #else
-#define JIM_EMBEDDED
 #include "jim.h"
 #endif
 



From zwelch at mail.berlios.de  Fri May 15 02:49:34 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 15 May 2009 02:49:34 +0200
Subject: [Openocd-svn] r1791 - in trunk: . doc/manual
Message-ID: <200905150049.n4F0nYMH006591@sheep.berlios.de>

Author: zwelch
Date: 2009-05-15 02:49:30 +0200 (Fri, 15 May 2009)
New Revision: 1791

Modified:
   trunk/TODO
   trunk/doc/manual/main.txt
Log:
Add current draft of The List of Pending and Open Tasks.

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-05-14 22:20:00 UTC (rev 1790)
+++ trunk/TODO	2009-05-15 00:49:30 UTC (rev 1791)
@@ -1,2 +1,176 @@
-This document is not in use. See mailing list.
+/** @page thelist Pending and Open Tasks
 
+This page lists pending and open tasks being considered or worked upon
+by the OpenOCD community.
+
+
+Items with a current patch available should include a link to its
+posting on the openocd-developer mailing list archives.
+
+Some items may be in progress, usually indicated by the individual whose
+initials in parentheses following it.  A key for decoding these initials
+appears after The List.
+
+Most items are open for the taking, but please post to the mailing list
+before spending much time working on anything lists here.  The community
+may have evolved an idea since it was added here.
+
+Feel free to send patches to add or clarify items on this list, too.
+
+ at verbatim
+================================================================== 
+                             The List
+------------------------------------------------------------------
+ at endverbatim
+
+- JTAG/TAP changes:
+  - update all drivers to use tap_get_tms_path_len API.
+    - link to posted patch: @missing
+  - rework TAP state table (started but still needs work)
+    - link to posted patch: @missing
+  - use tap_set_state everywhere to allow logging TAP state transitions
+  - rename other tap_states to use standard JTAG names (suggested by ML)
+    - write script that automate production of the series of 16-17 patches
+    - produce and distribute current series against the current trunk
+    - distribute script so developers can use on WC through live commits
+    - make live commits after giving sufficient notice to others
+  - add TAP_UNKNOWN to augment TAP_INVALID? (suggested by ML/DH)
+  
+- JTAG Interfaces:
+  - autodetect devices present on the scan chain
+    - implement 'discover_taps' command
+  - FT2232 driver: (DH)
+    - integrate FTD2XX High-Speed Device Patch
+      - link to posted patch: @missing
+    - fix non-recoverability of cable connect/reconnect
+      - link to posted patch: @missing
+    - fix outstanding bugs
+  - J-Link driver: (ZW)
+    - fix outstanding bugs
+    - test with known targets (i.e. working with other interfaces)
+    - test compatibility between v6.0 (yellow) and older units (e.g. v5.2)
+  - TCP driver:
+    - add TCP/IP client and server for remote JTAG interface control
+  - Do others need some help?  Probably....
+
+- Other Interfaces
+  - SVF/XSVF:
+    - pending tasks??
+  - SPI/UART emulation:
+    - (ab)use bit-banging JTAG interfaces to emulate SPI/UART
+    - allow SPI to program flash, MCUs, etc.
+  - SWD
+
+- Target Support:
+  - ARM11 improvements (MB?)
+    - fix single stepping  (reported by ?H)
+    - implement missing functionality (grep FNC_INFO_NOTIMPLEMENTED ...)
+  - Cortex A8 support (ML)
+    - add target implementation (ML)
+    - what else remains to be done?
+  - MC1322x support (JW/DE?)
+    - integrate and test support from JW (and DE?)
+    - get working with a known good interface (i.e. not today's jlink)
+  - AT91SAM92xx:
+    - improvements for unknown-board-atmel-at91sam9260.cfg (RD)
+  - STR9x: (ZW)
+    - improvements to str912.cfg to be more general purpose
+  - AVR: (SQ)
+    - independently verify implementation
+    - incrementally improve working prototype in trunk. (SQ)
+    - work out how to debug this target
+    - AVR debugging protocol.
+  - FPGA:
+    - improve things (??)
+  - Coldfire (suggested by NC)
+    - can we draw from the BDM project?  @par
+      http://bdm.sourceforge.net/
+
+  - other targets?  (suggestions always welcome)
+
+- CFI:
+  - speed enhancements (posted Apr 22 by NC) (??)
+    - link to patch: @missing
+  - finish implementing bus width/chip width handling (suggested by NC)
+    - link to patch: @missing
+  - factor vendor-specific code into separate source files
+  - add new callback interface for vendor-specific code
+  - investigate/implement "thin wrapper" to use eCos CFI drivers (?H)
+
+- TCL
+  - Isolate all TCL command support: 
+    - Allow pure C CLI implementations using --disable-builtin-tcl
+    - Allow full TCL support? add --with-tcl=/path/to/installed/tcl
+    - Move TCL support in foo.* to foo_tcl.* (other ideas?)
+
+- Debugger Support
+  - Keil AGDI interface to OpenOCD (submitted by Dario Vecchio)
+
+- Architectural Upgrades
+  - Allow N:M:P mapping of servers, targets, and interfaces
+  - loadable module support for interface/target/flash drivers
+  - libopenocd support: @par
+      https://lists.berlios.de/pipermail/openocd-development/2009-May/006405.html
+
+- Test Suite:
+  - implement server unit tests
+  - implement JTAG core unit tests
+  - implement JTAG interface unit tests
+  - implement flash unit tests
+  - implement target unit tests
+
+- Test Feedback Tools: @par
+      https://lists.berlios.de/pipermail/openocd-development/2009-May/006358.html
+
+  - extend target test script to produce helpful pass/fail output
+  - provide results submission script
+
+
+- Generic Hardware Tester:
+  - implement VHDL to use for FPGA-based JTAG TAP testing device
+  - develop test suite that utilizes this testing device
+
+- Build Systems (Autotools, CMake, etc.)
+  - investigate fixes to permit the use of -Wshadow
+  - change bootstrap to call 'configure --enable-maintainer-mode <opts>'?
+
+- Miscellaneous:
+  - make JTAG and USB debug output a run-time configuration option
+  - review and clean up interface/target/flash APIs 
+  - factor code to eliminate duplicated functionality
+  - overhaul use of types to improve 32/64-bit portability
+
+- Berlios Admin:
+  - use patch tracker? @par
+    https://developer.berlios.de/patch/?group_id=4148
+  - use bug tracking?  we need something!
+
+ at verbatim
+==================================================================
+OpenOCD's Active Developers and Testers
+------------------------------------------------------------------
+
+** | Name            | Status | Targets          | Interfaces
+---+-----------------+--------+------------------+----------------
+NC | Nico Coesel     |   *    | AU1100           | *
+DE | Duane Ellis     |   *    | *                | *
+DH | Dick Hollenbeck |   ?    | *                | FT2232
+?H | ?yvind Harboe   |   *    | *                | ZY1000
+JK | Joern Keipf     |   *    | *                | FT2232H/FT4232HS?
+JW | Jeff Williams   |   ?    | MC1322x          | J-Link
+MA | Mariano Alvira  |   *    | MC1322x          | J-Link, FTDI
+MB | Michael Bruck   |   *    | ARM11            | *
+ML | Magnus Lundin   |   *    | *                | *
+RA | Rick Altherr    |   *    | *                | *
+RD | Rene Doss       |   *    | AT91SAM92xx      | *
+SQ | Simon Qian      |   *    | AVR              | *
+ZW | Zach Welch      |   *    | STR912           | J-Link
+
+Status Key:
+* - Active Contributor
+? - Missing In Action
+V - On Vacation
+
+ at endverbatim
+
+*/

Modified: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-05-14 22:20:00 UTC (rev 1790)
+++ trunk/doc/manual/main.txt	2009-05-15 00:49:30 UTC (rev 1791)
@@ -1,10 +1,15 @@
 /** @mainpage OpenOCD Reference Manual
 
-The @ref primer page provides introductory materials for new developers.
+ at ref oocd explains how the code has been organized into layers
+of APIs and gives an overview of how they fit together.  These pages
+attempt to give developers a high-level perspective of the various
+code modules provided by OpenOCD.
+ 
+ at ref primer provide introductory materials for new developers.
 
-The @ref oocd page explains how the code has been organized into layers
-of APIs and gives an overview of how they fit together.
- 
+The List of @ref thelist enumerates opportunities for improving or
+extending the OpenOCD platform.
+
  */
 
 /** @page primer OpenOCD Technical Primers
@@ -54,4 +59,7 @@
 Obviously, there are some nuances to the stack that are not shown by
 this linear list of layers.
 
+The List of @ref thelist enumerates opportunities for improving or
+extending the OpenOCD platform.
+
  */



From zwelch at mail.berlios.de  Fri May 15 04:22:30 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 15 May 2009 04:22:30 +0200
Subject: [Openocd-svn] r1792 - trunk
Message-ID: <200905150222.n4F2MUXC019141@sheep.berlios.de>

Author: zwelch
Date: 2009-05-15 04:22:27 +0200 (Fri, 15 May 2009)
New Revision: 1792

Modified:
   trunk/Doxyfile
Log:
Update Doxyfile to build The List into the doxygen manual.

Modified: trunk/Doxyfile
===================================================================
--- trunk/Doxyfile	2009-05-15 00:49:30 UTC (rev 1791)
+++ trunk/Doxyfile	2009-05-15 02:22:27 UTC (rev 1792)
@@ -565,6 +565,7 @@
 # with spaces.
 
 INPUT                  = doc/manual \
+                         TODO \
                          src \
                          config.h
 



From oharboe at mail.berlios.de  Fri May 15 11:03:52 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 15 May 2009 11:03:52 +0200
Subject: [Openocd-svn] r1793 - trunk/src/helper
Message-ID: <200905150903.n4F93qLi012789@sheep.berlios.de>

Author: oharboe
Date: 2009-05-15 11:03:52 +0200 (Fri, 15 May 2009)
New Revision: 1793

Modified:
   trunk/src/helper/command.h
Log:
revert to 1775. 1790 causes SEGFAULT w/Cygwin.

Modified: trunk/src/helper/command.h
===================================================================
--- trunk/src/helper/command.h	2009-05-15 02:22:27 UTC (rev 1792)
+++ trunk/src/helper/command.h	2009-05-15 09:03:52 UTC (rev 1793)
@@ -32,6 +32,7 @@
 /* Jim is provied by eCos */
 #include <cyg/jimtcl/jim.h>
 #else
+#define JIM_EMBEDDED
 #include "jim.h"
 #endif
 



From oharboe at mail.berlios.de  Fri May 15 22:35:56 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 15 May 2009 22:35:56 +0200
Subject: [Openocd-svn] r1794 - trunk/src/helper
Message-ID: <200905152035.n4FKZuDM027954@sheep.berlios.de>

Author: oharboe
Date: 2009-05-15 22:35:53 +0200 (Fri, 15 May 2009)
New Revision: 1794

Modified:
   trunk/src/helper/command.c
   trunk/src/helper/command.h
Log:
Less wrong handling of JIM_EMBEDDED, follow Jim Tcl doc's and only use JIM_EMBEDDED in a single .c file. Still broken w/-fno-common(i.e. Mac OS).

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2009-05-15 09:03:52 UTC (rev 1793)
+++ trunk/src/helper/command.c	2009-05-15 20:35:53 UTC (rev 1794)
@@ -30,6 +30,11 @@
 #include "config.h"
 #endif
 
+#if !BUILD_ECOSBOARD
+/* see Embedder-HOWTO.txt in Jim Tcl project hosted on BerliOS*/
+#define JIM_EMBEDDED
+#endif
+
 // @todo the inclusion of target.h here is a layering violation
 #include "target.h"
 #include "command.h"
@@ -675,7 +680,7 @@
 	context->output_handler = NULL;
 	context->output_handler_priv = NULL;
 
-#ifdef JIM_EMBEDDED
+#if !BUILD_ECOSBOARD
 	Jim_InitEmbedded();
 	/* Create an interpreter */
 	interp = Jim_CreateInterp();
@@ -721,7 +726,7 @@
 
 	add_default_dirs();
 
-#ifdef JIM_EMBEDDED
+#if !BUILD_ECOSBOARD
 	Jim_EventLoopOnLoad(interp);
 #endif
 	if (Jim_Eval_Named(interp, startup_tcl, "embedded:startup.tcl",1)==JIM_ERR)
@@ -800,7 +805,7 @@
 
 void process_jim_events(void)
 {
-#ifdef JIM_EMBEDDED
+#if !BUILD_ECOSBOARD
 	static int recursion = 0;
 
 	if (!recursion)

Modified: trunk/src/helper/command.h
===================================================================
--- trunk/src/helper/command.h	2009-05-15 09:03:52 UTC (rev 1793)
+++ trunk/src/helper/command.h	2009-05-15 20:35:53 UTC (rev 1794)
@@ -32,7 +32,6 @@
 /* Jim is provied by eCos */
 #include <cyg/jimtcl/jim.h>
 #else
-#define JIM_EMBEDDED
 #include "jim.h"
 #endif
 



From oharboe at mail.berlios.de  Fri May 15 23:10:39 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Fri, 15 May 2009 23:10:39 +0200
Subject: [Openocd-svn] r1795 - trunk/src/helper
Message-ID: <200905152110.n4FLAdmF001067@sheep.berlios.de>

Author: oharboe
Date: 2009-05-15 23:10:35 +0200 (Fri, 15 May 2009)
New Revision: 1795

Modified:
   trunk/src/helper/jim.h
Log:
fix -fno-common/Mac build problems. 

Modified: trunk/src/helper/jim.h
===================================================================
--- trunk/src/helper/jim.h	2009-05-15 20:35:53 UTC (rev 1794)
+++ trunk/src/helper/jim.h	2009-05-15 21:10:35 UTC (rev 1795)
@@ -632,7 +632,7 @@
 #define JIM_API( X )  X
 #else
 #ifndef __JIM_CORE__
-# if defined JIM_EXTENSION || defined JIM_EMBEDDED
+# if defined JIM_EMBEDDED
 #  define JIM_API(x) (*x)
 #  define JIM_STATIC
 # else



From zwelch at mail.berlios.de  Sat May 16 00:10:35 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 16 May 2009 00:10:35 +0200
Subject: [Openocd-svn] r1796 - trunk/src/helper
Message-ID: <200905152210.n4FMAZ08006140@sheep.berlios.de>

Author: zwelch
Date: 2009-05-16 00:10:32 +0200 (Sat, 16 May 2009)
New Revision: 1796

Modified:
   trunk/src/helper/jim.c
Log:
Initialize value of objPtr local variable; prevents warning w/ gcc-4.4.

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-15 21:10:35 UTC (rev 1795)
+++ trunk/src/helper/jim.c	2009-05-15 22:10:32 UTC (rev 1796)
@@ -5919,7 +5919,7 @@
 int Jim_DictKeysVector(Jim_Interp *interp, Jim_Obj *dictPtr,
         Jim_Obj *const *keyv, int keyc, Jim_Obj **objPtrPtr, int flags)
 {
-    Jim_Obj *objPtr;
+    Jim_Obj *objPtr = NULL;
     int i;
 
     if (keyc == 0) {



From zwelch at mail.berlios.de  Sat May 16 01:35:31 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 16 May 2009 01:35:31 +0200
Subject: [Openocd-svn] r1797 - trunk/src/helper
Message-ID: <200905152335.n4FNZV5H032331@sheep.berlios.de>

Author: zwelch
Date: 2009-05-16 01:35:27 +0200 (Sat, 16 May 2009)
New Revision: 1797

Modified:
   trunk/src/helper/jim.c
Log:
Initialize a more variables in jim.c to allow gcc-4.4 to build.
Fix provided by Benjamin Schmidt <DeMonk at gmx.net>.


Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-05-15 22:10:32 UTC (rev 1796)
+++ trunk/src/helper/jim.c	2009-05-15 23:35:27 UTC (rev 1797)
@@ -7642,8 +7642,8 @@
                 scanned += 1;
                 break;
             case 'd': case 'o': case 'x': case 'u': case 'i': {
-                jim_wide jwvalue;
-                long lvalue;
+                jim_wide jwvalue = 0;
+                long lvalue = 0;
                 char *endp;  /* Position where the number finished */
                 int base = descr->type == 'o' ? 8
                     : descr->type == 'x' ? 16



From oharboe at mail.berlios.de  Sat May 16 16:57:08 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 16 May 2009 16:57:08 +0200
Subject: [Openocd-svn] r1798 - in trunk/src/target: board interface target
Message-ID: <200905161457.n4GEv8Wg016510@sheep.berlios.de>

Author: oharboe
Date: 2009-05-16 16:57:02 +0200 (Sat, 16 May 2009)
New Revision: 1798

Added:
   trunk/src/target/board/crossbow_tech_imote2.cfg
   trunk/src/target/board/digi_connectcore_wi-9c.cfg
   trunk/src/target/board/hitex_stm32-performancestick.cfg
   trunk/src/target/board/hitex_str9-comstick.cfg
   trunk/src/target/board/linksys_nslu2.cfg
   trunk/src/target/board/pxa255_sst.cfg
   trunk/src/target/board/str910-eval.cfg
   trunk/src/target/board/zy1000.cfg
   trunk/src/target/interface/hitex_str9-comstick.cfg
Removed:
   trunk/src/target/board/hitex_str9_comstick.cfg
   trunk/src/target/interface/str9-comstick.cfg
   trunk/src/target/target/imote2.cfg
   trunk/src/target/target/nslu2.cfg
   trunk/src/target/target/pxa255_sst.cfg
   trunk/src/target/target/stm32stick.cfg
   trunk/src/target/target/str910-eval.cfg
   trunk/src/target/target/str9comstick.cfg
   trunk/src/target/target/wi-9c.cfg
   trunk/src/target/target/zy1000.cfg
Log:
Freddie Chopin <freddie_chopin at op.pl> move files about to where they belong

Added: trunk/src/target/board/crossbow_tech_imote2.cfg
===================================================================
--- trunk/src/target/board/crossbow_tech_imote2.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/board/crossbow_tech_imote2.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -0,0 +1,46 @@
+# Crossbow Technology iMote2
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME imote2
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+  # force an error till we get a good number
+   set _CPUTAPID 0xffffffff
+}
+
+# PXA271 and an Intel Strataflash of 32 Megabytes (p30)
+# 
+# Marvell/Intel PXA270 Script
+# set jtag_nsrst_delay to the delay introduced by your reset circuit
+# the rest of the needed delays are built into the openocd program
+jtag_nsrst_delay 800 
+# set the jtag_ntrst_delay to the delay introduced by a reset circuit
+# the rest of the needed delays are built into the openocd program
+jtag_ntrst_delay 0
+#use combined on interfaces or targets that can't set TRST/SRST separately
+reset_config trst_and_srst separate
+#jtag scan chain
+
+jtag newtap $_CHIPNAME cpu -irlen 7 -ircapture 0x1 -irmask 0x7f -expected-id $_CPUTAPID
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME xscale -endian $_ENDIAN -chain-position $_TARGETNAME -variant pxa27x
+$_TARGETNAME configure -work-area-virt 0x0x5c000000 -work-area-phys 0x0x5c000000 -work-area-size 0x10000 -work-area-backup 1
+# maps to PXA internal RAM. If you are using a PXA255
+# you must initialize SDRAM or leave this option off
+
+
+#flash bank <driver> <base> <size> <chip_width> <bus_width>
+# works for P30 flash
+flash bank cfi 0x00000000 0x2000000 2 2 0

Added: trunk/src/target/board/digi_connectcore_wi-9c.cfg
===================================================================
--- trunk/src/target/board/digi_connectcore_wi-9c.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/board/digi_connectcore_wi-9c.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -0,0 +1,127 @@
+######################################
+# Target: DIGI ConnectCore Wi-9C
+######################################
+
+reset_config trst_and_srst
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME ns9360
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+  # This config file was defaulting to big endian..
+   set  _ENDIAN big
+}
+
+
+# What's a good fallback frequency for this board if RCLK is
+# not available??
+jtag_rclk 1000
+
+
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+   set _CPUTAPID 0xFFFFFFFF
+}
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+jtag_nsrst_delay 200
+jtag_ntrst_delay 0
+
+
+######################
+# Target configuration
+######################
+
+target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm926ejs
+$_TARGETNAME configure -event reset-init {
+	mww 0x90600104 0x33313333
+	mww 0xA0700000 0x00000001  # Enable the memory controller.
+	mww 0xA0700024 0x00000006  # Set the refresh counter 6
+	mww 0xA0700028 0x00000001  # 
+	mww 0xA0700030 0x00000001  # Set the precharge period
+	mww 0xA0700034 0x00000004  # Active to precharge command period is 16 clock cycles
+	mww 0xA070003C 0x00000001  # tAPR
+	mww 0xA0700040 0x00000005  # tDAL
+	mww 0xA0700044 0x00000001  # tWR
+	mww 0xA0700048 0x00000006  # tRC 32 clock cycles  
+	mww 0xA070004C 0x00000006  # tRFC 32 clock cycles
+	mww 0xA0700054 0x00000001  # tRRD
+	mww 0xA0700058 0x00000001  # tMRD
+	mww 0xA0700100 0x00004280  # Dynamic Config 0 (cs4) 
+	mww 0xA0700120 0x00004280  # Dynamic Config 1 (cs5)
+	mww 0xA0700140 0x00004280  # Dynamic Config 2 (cs6)
+	mww 0xA0700160 0x00004280  # Dynamic Config 3 (cs7)
+	#
+	mww 0xA0700104 0x00000203  # CAS latency is 2 at 100 MHz
+	mww 0xA0700124 0x00000203  # CAS latency is 2 at 100 MHz
+	mww 0xA0700144 0x00000203  # CAS latency is 2 at 100 MHz
+	mww 0xA0700164 0x00000203  # CAS latency is 2 at 100 MHz
+	#
+	mww 0xA0700020 0x00000103  # issue SDRAM PALL command
+	#
+	mww 0xA0700024 0x00000001  # Set the refresh counter to be as small as possible
+	#
+	# Add some dummy writes to give the SDRAM time to settle, it needs two
+	# AHB clock cycles, here we poke in the debugger flag, this lets
+	# the software know that we are in the debugger
+	mww 0xA0900000 0x00000002
+	mww 0xA0900000 0x00000002
+	mww 0xA0900000 0x00000002
+	mww 0xA0900000 0x00000002
+	mww 0xA0900000 0x00000002
+	#
+	mdw 0xA0900000 
+	mdw 0xA0900000 
+	mdw 0xA0900000 
+	mdw 0xA0900000 
+	mdw 0xA0900000 
+	#
+	mww 0xA0700024 0x00000030 # Set the refresh counter to 30
+	mww 0xA0700020 0x00000083 # Issue SDRAM MODE command
+	#
+	# Next we perform a read of RAM.
+	# mw = move word.
+	mdw 0x00022000
+	# mw 0x00022000:P, r3  # 22000 for cas2 latency, 32000 for cas 3
+	#
+	mww 0xA0700020 0x00000003   # issue SDRAM NORMAL command
+	mww 0xA0700100 0x00084280   # Enable buffer access
+	mww 0xA0700120 0x00084280   # Enable buffer access
+	mww 0xA0700140 0x00084280   # Enable buffer access
+	mww 0xA0700160 0x00084280   # Enable buffer access
+
+	#Set byte lane state (static mem 1)"
+	mww 0xA0700220, 0x00000082
+	#Flash Start
+	mww 0xA09001F8, 0x50000000
+	#Flash Mask Reg
+	mww 0xA09001FC, 0xFF000001
+	mww 0xA0700028, 0x00000001
+
+	#  RAMAddr = 0x00020000
+	#  RAMSize = 0x00004000
+
+	# Set the processor mode
+	reg cpsr 0xd3
+}
+
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00000000 -work-area-size 0x1000 -work-area-backup 1
+
+#####################
+# Flash configuration
+#####################
+
+#M29DW323DB - not working
+#flash bank cfi <base> <size> <chip width> <bus width> <target#>
+flash bank cfi 0x50000000 0x0400000 2 2 0
+
+
+

Added: trunk/src/target/board/hitex_stm32-performancestick.cfg
===================================================================
--- trunk/src/target/board/hitex_stm32-performancestick.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/board/hitex_stm32-performancestick.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -0,0 +1,50 @@
+# Hitex stm32 performance stick
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME stm32_hitex
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+# set jtag speed
+jtag_khz 500
+
+jtag_nsrst_delay 100
+jtag_ntrst_delay 100
+
+#use combined on interfaces or targets that can't set TRST/SRST separately
+reset_config trst_and_srst
+
+#jtag scan chain
+# The CPU
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+  # See STM Document RM0008
+  # Section 26.6.3
+   set _CPUTAPID 0x3ba00477
+}
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+# The boundery scan register, leave the "expected-id" undefined.
+jtag newtap $_CHIPNAME bs  -irlen 5 -ircapture 0x1 -irmask 0x1 
+
+# configure str750 connected to jtag chain
+jtag newtap $_CHIPNAME unknown -irlen 4 -ircapture 0x1 -irmask 0x0f
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME cortex_m3 -endian $_ENDIAN -chain-position $_TARGETNAME
+
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x20000000 -work-area-size 16384 -work-area-backup 0
+
+#
+flash bank stm32x 0 0 0 0 0
+
+# For more information about the configuration files, take a look at:
+# openocd.texi

Added: trunk/src/target/board/hitex_str9-comstick.cfg
===================================================================
--- trunk/src/target/board/hitex_str9-comstick.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/board/hitex_str9-comstick.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -0,0 +1,72 @@
+# Hitex STR9-comStick
+# http://www.hitex.com/index.php?id=383
+# This works for the STR9-comStick revisions STR912CS-A1 and STR912CS-A2.
+
+source [find interface/hitex_str9-comstick.cfg]
+
+# set jtag speed
+jtag_khz 3000
+
+jtag_nsrst_delay 100
+jtag_ntrst_delay 100
+#use combined on interfaces or targets that can't set TRST/SRST separately
+reset_config trst_and_srst
+#jtag scan chain
+#format L IRC IRCM IDCODE (Length, IR Capture, IR Capture Mask, IDCODE)
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME str912
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+if { [info exists FLASHTAPID ] } {
+   set _FLASHTAPID $FLASHTAPID
+} else {
+   set _FLASHTAPID 0x04570041
+}
+jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 -expected-id $_FLASHTAPID
+
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+   set _CPUTAPID 0x25966041
+}
+jtag newtap $_CHIPNAME cpu   -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+if { [info exists BSTAPID ] } {
+   set _BSTAPID $BSTAPID
+} else {
+   # Found on STR9-comStick, revision STR912CS-A1
+   set _BSTAPID1 0x1457f041
+   # Found on STR9-comStick, revision STR912CS-A2
+   set _BSTAPID2 0x2457f041
+}
+jtag newtap $_CHIPNAME bs -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID1 -expected-id $_BSTAPID2
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME arm966e -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm966e
+
+$_TARGETNAME configure -event reset-init {
+	# We can increase speed now that we know the target is halted.
+	#jtag_rclk 3000
+	
+	# -- Enable 96K RAM
+	# PFQBC enabled / DTCM & AHB wait-states disabled
+	mww 0x5C002034 0x0191 
+
+	str9x flash_config 0 4 2 0 0x80000
+	flash protect 0 0 7 off
+}
+
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x50000000 -work-area-size 16384 -work-area-backup 0
+
+#flash bank <driver> <base> <size> <chip_width> <bus_width>
+flash bank str9x 0x00000000 0x00080000 0 0 0
+flash bank str9x 0x00080000 0x00008000 0 0 0

Deleted: trunk/src/target/board/hitex_str9_comstick.cfg
===================================================================
--- trunk/src/target/board/hitex_str9_comstick.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/board/hitex_str9_comstick.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,11 +0,0 @@
-#
-# Hitex STR9-comStick
-#
-# http://www.hitex.com/index.php?id=383
-#
-
-# This works for the STR9-comStick revisions STR912CS-A1 and STR912CS-A2.
-
-source [find interface/str9-comstick.cfg]
-source [find target/str9comstick.cfg]
-

Added: trunk/src/target/board/linksys_nslu2.cfg
===================================================================
--- trunk/src/target/board/linksys_nslu2.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/board/linksys_nslu2.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -0,0 +1,8 @@
+# This is for the LinkSys (CISCO) NSLU2 board
+# It is an Intel XSCALE IXP420 CPU.
+
+source [find target/ixp42x.cfg]
+# The _TARGETNAME is set by the above.
+
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00020000 -work-area-size 0x10000 -work-area-backup 0
+

Added: trunk/src/target/board/pxa255_sst.cfg
===================================================================
--- trunk/src/target/board/pxa255_sst.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/board/pxa255_sst.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -0,0 +1,15 @@
+# A PXA255 test board with SST 39LF400A flash
+#
+# At reset the memory map is as follows. Note that
+# the memory map changes later on as the application 
+# starts...
+#
+# RAM at 0x4000000
+# Flash at 0x00000000
+#
+source [find target/pxa255.cfg]
+# Target name is set by above
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x4000000 -work-area-size 0x4000 -work-area-backup 0
+# flash bank <driver> <base> <size> <chip_width> <bus_width> <targetNum> [options]
+flash bank cfi 0x00000000 0x80000 2 2 0 jedec_probe
+

Added: trunk/src/target/board/str910-eval.cfg
===================================================================
--- trunk/src/target/board/str910-eval.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/board/str910-eval.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -0,0 +1,61 @@
+# str910-eval eval board
+# 
+# Need reset scripts 
+reset_config trst_and_srst
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME str912
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+if { [info exists FLASHTAPID ] } {
+   set _FLASHTAPID $FLASHTAPID
+} else {
+   set _FLASHTAPID 0x04570041
+}
+jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 -expected-id $_FLASHTAPID
+
+
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+   set _CPUTAPID 0x25966041
+}
+jtag newtap $_CHIPNAME cpu   -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+if { [info exists BSTAPID ] } {
+   set _BSTAPID $BSTAPID
+} else {
+   set _BSTAPID 0x1457f041
+}
+jtag newtap $_CHIPNAME bs    -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME arm966e -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm966e
+$_TARGETNAME configure -work-area-phys 0x50000000 -work-area-virt 0x50000000 -work-area-size 16384 -work-area-backup 1
+
+$_TARGETNAME configure -event reset-init {
+	# We can increase speed now that we know the target is halted.
+	#jtag_rclk 3000
+	
+	# -- Enable 96K RAM
+	# PFQBC enabled / DTCM & AHB wait-states disabled
+	mww 0x5C002034 0x0191 
+
+	str9x flash_config 0 4 2 0 0x80000
+	flash protect 0 0 7 off
+}
+
+#flash bank str9x <base> <size> 0 0 <target#> <variant>
+flash bank str9x 0x00000000 0x00080000 0 0 0
+flash bank str9x 0x00080000 0x00008000 0 0 0
+
+# For more information about the configuration files, take a look at:
+# openocd.texi

Added: trunk/src/target/board/zy1000.cfg
===================================================================
--- trunk/src/target/board/zy1000.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/board/zy1000.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -0,0 +1,110 @@
+#Script for ZY1000
+
+#Atmel ties SRST & TRST together, at which point it makes
+#no sense to use TRST, but use TMS instead.
+#
+#The annoying thing with tying SRST & TRST together is that
+#there is no way to halt the CPU *before and during* the
+#SRST reset, which means that the CPU will run a number
+#of cycles before it can be halted(as much as milliseconds).
+reset_config srst_only srst_pulls_trst
+
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME zy1000
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+ 
+#jtag scan chain
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+   set _CPUTAPID 0x1f0f0f0f
+}
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm7tdmi-s_r4
+
+# at CPU CLK <32kHz this must be disabled
+arm7_9 fast_memory_access enable
+arm7_9 dcc_downloads enable
+
+flash bank ecosflash 0x01000000 0x200000 2 2 0 ecos/at91eb40a.elf
+$_TARGETNAME configure -event reset-init { 
+	# Set up chip selects & timings
+	mww 0xFFE00000 0x0100273D
+	mww 0xFFE00004 0x08002125
+	mww 0xFFEe0008 0x02002125
+	mww 0xFFE0000c 0x03002125
+	mww 0xFFE00010 0x40000000
+	mww 0xFFE00014 0x50000000
+	mww 0xFFE00018 0x60000000
+	mww 0xFFE0001c 0x70000000
+	mww 0xFFE00020 0x00000001
+	mww 0xFFE00024 0x00000000
+	
+	# remap  
+	mww 0xFFFFF124 0xFFFFFFFF  
+	mww 0xffff0010 0x100
+	mww 0xffff0034 0x100
+	
+	#disable 16x5x UART interrupts
+	mww 0x08020004 0
+}
+
+# required for usable performance. Used for lots of
+# other things than flash programming.
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00020000 -work-area-size 0x20000 -work-area-backup 0
+
+jtag_khz 16000
+
+
+proc production_info {} {
+	return "Serial number is official MAC number. Format XXXXXXXXXXXX"
+}
+
+# There is no return value from this procedure. If it is
+# successful it does not throw an exception
+#
+# Progress messages are output via puts 
+proc production {firmwarefile serialnumber} {
+	if {[string length $serialnumber]!=12} {
+		puts "Invalid serial number"
+		return
+	}
+
+	puts "Power cycling target"
+	power off
+	sleep 3000
+	power on
+	sleep 1000
+	reset init
+	flash write_image erase $firmwarefile 0x1000000 bin
+	verify_image $firmwarefile 0x1000000 bin
+
+	# Big endian... weee!!!!
+	puts "Setting MAC number to $serialnumber"	
+	flash fillw [expr 0x1030000-0x8] "0x[string range $serialnumber 2 3][string range $serialnumber 0 1]0000" 1
+	flash fillw [expr 0x1030000-0x4] "0x[string range $serialnumber 10 11][string range $serialnumber 8 9][string range $serialnumber 6 7][string range $serialnumber 4 5]" 1
+	puts "Production successful"
+} 
+
+
+proc production_test {} {
+	power on
+	sleep 1000
+	target_request debugmsgs enable
+	reset run
+	sleep 25000
+	target_request debugmsgs disable
+	return "See IP address above..."
+}

Added: trunk/src/target/interface/hitex_str9-comstick.cfg
===================================================================
--- trunk/src/target/interface/hitex_str9-comstick.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/interface/hitex_str9-comstick.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -0,0 +1,11 @@
+#
+# Hitex STR9-comStick
+#
+# http://www.hitex.com/index.php?id=383
+#
+
+interface ft2232
+ft2232_device_desc "STR9-comStick A"
+ft2232_layout comstick
+ft2232_vid_pid 0x0640 0x002c
+

Deleted: trunk/src/target/interface/str9-comstick.cfg
===================================================================
--- trunk/src/target/interface/str9-comstick.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/interface/str9-comstick.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,11 +0,0 @@
-#
-# Hitex STR9-comStick
-#
-# http://www.hitex.com/index.php?id=383
-#
-
-interface ft2232
-ft2232_device_desc "STR9-comStick A"
-ft2232_layout comstick
-ft2232_vid_pid 0x0640 0x002c
-

Deleted: trunk/src/target/target/imote2.cfg
===================================================================
--- trunk/src/target/target/imote2.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/target/imote2.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,46 +0,0 @@
-# iMote2
-#
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME imote2
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-  # force an error till we get a good number
-   set _CPUTAPID 0xffffffff
-}
-
-# PXA271 and an Intel Strataflash of 32 Megabytes (p30)
-# 
-# Marvell/Intel PXA270 Script
-# set jtag_nsrst_delay to the delay introduced by your reset circuit
-# the rest of the needed delays are built into the openocd program
-jtag_nsrst_delay 800 
-# set the jtag_ntrst_delay to the delay introduced by a reset circuit
-# the rest of the needed delays are built into the openocd program
-jtag_ntrst_delay 0
-#use combined on interfaces or targets that can't set TRST/SRST separately
-reset_config trst_and_srst separate
-#jtag scan chain
-
-jtag newtap $_CHIPNAME cpu -irlen 7 -ircapture 0x1 -irmask 0x7f -expected-id $_CPUTAPID
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME xscale -endian $_ENDIAN -chain-position $_TARGETNAME -variant pxa27x
-$_TARGETNAME configure -work-area-virt 0x0x5c000000 -work-area-phys 0x0x5c000000 -work-area-size 0x10000 -work-area-backup 1
-# maps to PXA internal RAM. If you are using a PXA255
-# you must initialize SDRAM or leave this option off
-
-
-#flash bank <driver> <base> <size> <chip_width> <bus_width>
-# works for P30 flash
-flash bank cfi 0x00000000 0x2000000 2 2 0

Deleted: trunk/src/target/target/nslu2.cfg
===================================================================
--- trunk/src/target/target/nslu2.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/target/nslu2.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,8 +0,0 @@
-# This is for the LinkSys (CISCO) NSLU2 board
-# It is an Intel XSCALE IXP420 CPU.
-
-source [find target/ixp42x.cfg]
-# The _TARGETNAME is set by the above.
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00020000 -work-area-size 0x10000 -work-area-backup 0
-

Deleted: trunk/src/target/target/pxa255_sst.cfg
===================================================================
--- trunk/src/target/target/pxa255_sst.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/target/pxa255_sst.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,15 +0,0 @@
-# A PXA255 test board with SST 39LF400A flash
-#
-# At reset the memory map is as follows. Note that
-# the memory map changes later on as the application 
-# starts...
-#
-# RAM at 0x4000000
-# Flash at 0x00000000
-#
-source [find target/pxa255.cfg]
-# Target name is set by above
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x4000000 -work-area-size 0x4000 -work-area-backup 0
-# flash bank <driver> <base> <size> <chip_width> <bus_width> <targetNum> [options]
-flash bank cfi 0x00000000 0x80000 2 2 0 jedec_probe
-

Deleted: trunk/src/target/target/stm32stick.cfg
===================================================================
--- trunk/src/target/target/stm32stick.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/target/stm32stick.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,50 +0,0 @@
-# Hitex stm32 performance stick
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME stm32_hitex
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
-# set jtag speed
-jtag_khz 500
-
-jtag_nsrst_delay 100
-jtag_ntrst_delay 100
-
-#use combined on interfaces or targets that can't set TRST/SRST separately
-reset_config trst_and_srst
-
-#jtag scan chain
-# The CPU
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-  # See STM Document RM0008
-  # Section 26.6.3
-   set _CPUTAPID 0x3ba00477
-}
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-# The boundery scan register, leave the "expected-id" undefined.
-jtag newtap $_CHIPNAME bs  -irlen 5 -ircapture 0x1 -irmask 0x1 
-
-# configure str750 connected to jtag chain
-jtag newtap $_CHIPNAME unknown -irlen 4 -ircapture 0x1 -irmask 0x0f
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME cortex_m3 -endian $_ENDIAN -chain-position $_TARGETNAME
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x20000000 -work-area-size 16384 -work-area-backup 0
-
-#
-flash bank stm32x 0 0 0 0 0
-
-# For more information about the configuration files, take a look at:
-# openocd.texi

Deleted: trunk/src/target/target/str910-eval.cfg
===================================================================
--- trunk/src/target/target/str910-eval.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/target/str910-eval.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,61 +0,0 @@
-# str910-eval eval board
-# 
-# Need reset scripts 
-reset_config trst_and_srst
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME str912
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
-if { [info exists FLASHTAPID ] } {
-   set _FLASHTAPID $FLASHTAPID
-} else {
-   set _FLASHTAPID 0x04570041
-}
-jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 -expected-id $_FLASHTAPID
-
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-   set _CPUTAPID 0x25966041
-}
-jtag newtap $_CHIPNAME cpu   -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-if { [info exists BSTAPID ] } {
-   set _BSTAPID $BSTAPID
-} else {
-   set _BSTAPID 0x1457f041
-}
-jtag newtap $_CHIPNAME bs    -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm966e -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm966e
-$_TARGETNAME configure -work-area-phys 0x50000000 -work-area-virt 0x50000000 -work-area-size 16384 -work-area-backup 1
-
-$_TARGETNAME configure -event reset-init {
-	# We can increase speed now that we know the target is halted.
-	#jtag_rclk 3000
-	
-	# -- Enable 96K RAM
-	# PFQBC enabled / DTCM & AHB wait-states disabled
-	mww 0x5C002034 0x0191 
-
-	str9x flash_config 0 4 2 0 0x80000
-	flash protect 0 0 7 off
-}
-
-#flash bank str9x <base> <size> 0 0 <target#> <variant>
-flash bank str9x 0x00000000 0x00080000 0 0 0
-flash bank str9x 0x00080000 0x00008000 0 0 0
-
-# For more information about the configuration files, take a look at:
-# openocd.texi

Deleted: trunk/src/target/target/str9comstick.cfg
===================================================================
--- trunk/src/target/target/str9comstick.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/target/str9comstick.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,68 +0,0 @@
-#Hitex STR9 Comstick
-
-# set jtag speed
-jtag_khz 3000
-
-jtag_nsrst_delay 100
-jtag_ntrst_delay 100
-#use combined on interfaces or targets that can't set TRST/SRST separately
-reset_config trst_and_srst
-#jtag scan chain
-#format L IRC IRCM IDCODE (Length, IR Capture, IR Capture Mask, IDCODE)
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME str912
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
-if { [info exists FLASHTAPID ] } {
-   set _FLASHTAPID $FLASHTAPID
-} else {
-   set _FLASHTAPID 0x04570041
-}
-jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 -expected-id $_FLASHTAPID
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-   set _CPUTAPID 0x25966041
-}
-jtag newtap $_CHIPNAME cpu   -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-if { [info exists BSTAPID ] } {
-   set _BSTAPID $BSTAPID
-} else {
-   # Found on STR9-comStick, revision STR912CS-A1
-   set _BSTAPID1 0x1457f041
-   # Found on STR9-comStick, revision STR912CS-A2
-   set _BSTAPID2 0x2457f041
-}
-jtag newtap $_CHIPNAME bs -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID1 -expected-id $_BSTAPID2
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm966e -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm966e
-
-$_TARGETNAME configure -event reset-init {
-	# We can increase speed now that we know the target is halted.
-	#jtag_rclk 3000
-	
-	# -- Enable 96K RAM
-	# PFQBC enabled / DTCM & AHB wait-states disabled
-	mww 0x5C002034 0x0191 
-
-	str9x flash_config 0 4 2 0 0x80000
-	flash protect 0 0 7 off
-}
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x50000000 -work-area-size 16384 -work-area-backup 0
-
-#flash bank <driver> <base> <size> <chip_width> <bus_width>
-flash bank str9x 0x00000000 0x00080000 0 0 0
-flash bank str9x 0x00080000 0x00008000 0 0 0

Deleted: trunk/src/target/target/wi-9c.cfg
===================================================================
--- trunk/src/target/target/wi-9c.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/target/wi-9c.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,128 +0,0 @@
-# FIXME: THIS IS A *BOARD* not a CHIP configuration.
-######################################
-# Target: DIGI ConnectCore Wi-9C
-######################################
-
-reset_config trst_and_srst
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME ns9360
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-  # This config file was defaulting to big endian..
-   set  _ENDIAN big
-}
-
-
-# What's a good fallback frequency for this board if RCLK is
-# not available??
-jtag_rclk 1000
-
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-   set _CPUTAPID 0xFFFFFFFF
-}
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-jtag_nsrst_delay 200
-jtag_ntrst_delay 0
-
-
-######################
-# Target configuration
-######################
-
-target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm926ejs
-$_TARGETNAME configure -event reset-init {
-	mww 0x90600104 0x33313333
-	mww 0xA0700000 0x00000001  # Enable the memory controller.
-	mww 0xA0700024 0x00000006  # Set the refresh counter 6
-	mww 0xA0700028 0x00000001  # 
-	mww 0xA0700030 0x00000001  # Set the precharge period
-	mww 0xA0700034 0x00000004  # Active to precharge command period is 16 clock cycles
-	mww 0xA070003C 0x00000001  # tAPR
-	mww 0xA0700040 0x00000005  # tDAL
-	mww 0xA0700044 0x00000001  # tWR
-	mww 0xA0700048 0x00000006  # tRC 32 clock cycles  
-	mww 0xA070004C 0x00000006  # tRFC 32 clock cycles
-	mww 0xA0700054 0x00000001  # tRRD
-	mww 0xA0700058 0x00000001  # tMRD
-	mww 0xA0700100 0x00004280  # Dynamic Config 0 (cs4) 
-	mww 0xA0700120 0x00004280  # Dynamic Config 1 (cs5)
-	mww 0xA0700140 0x00004280  # Dynamic Config 2 (cs6)
-	mww 0xA0700160 0x00004280  # Dynamic Config 3 (cs7)
-	#
-	mww 0xA0700104 0x00000203  # CAS latency is 2 at 100 MHz
-	mww 0xA0700124 0x00000203  # CAS latency is 2 at 100 MHz
-	mww 0xA0700144 0x00000203  # CAS latency is 2 at 100 MHz
-	mww 0xA0700164 0x00000203  # CAS latency is 2 at 100 MHz
-	#
-	mww 0xA0700020 0x00000103  # issue SDRAM PALL command
-	#
-	mww 0xA0700024 0x00000001  # Set the refresh counter to be as small as possible
-	#
-	# Add some dummy writes to give the SDRAM time to settle, it needs two
-	# AHB clock cycles, here we poke in the debugger flag, this lets
-	# the software know that we are in the debugger
-	mww 0xA0900000 0x00000002
-	mww 0xA0900000 0x00000002
-	mww 0xA0900000 0x00000002
-	mww 0xA0900000 0x00000002
-	mww 0xA0900000 0x00000002
-	#
-	mdw 0xA0900000 
-	mdw 0xA0900000 
-	mdw 0xA0900000 
-	mdw 0xA0900000 
-	mdw 0xA0900000 
-	#
-	mww 0xA0700024 0x00000030 # Set the refresh counter to 30
-	mww 0xA0700020 0x00000083 # Issue SDRAM MODE command
-	#
-	# Next we perform a read of RAM.
-	# mw = move word.
-	mdw 0x00022000
-	# mw 0x00022000:P, r3  # 22000 for cas2 latency, 32000 for cas 3
-	#
-	mww 0xA0700020 0x00000003   # issue SDRAM NORMAL command
-	mww 0xA0700100 0x00084280   # Enable buffer access
-	mww 0xA0700120 0x00084280   # Enable buffer access
-	mww 0xA0700140 0x00084280   # Enable buffer access
-	mww 0xA0700160 0x00084280   # Enable buffer access
-
-	#Set byte lane state (static mem 1)"
-	mww 0xA0700220, 0x00000082
-	#Flash Start
-	mww 0xA09001F8, 0x50000000
-	#Flash Mask Reg
-	mww 0xA09001FC, 0xFF000001
-	mww 0xA0700028, 0x00000001
-
-	#  RAMAddr = 0x00020000
-	#  RAMSize = 0x00004000
-
-	# Set the processor mode
-	reg cpsr 0xd3
-}
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00000000 -work-area-size 0x1000 -work-area-backup 1
-
-#####################
-# Flash configuration
-#####################
-
-#M29DW323DB - not working
-#flash bank cfi <base> <size> <chip width> <bus width> <target#>
-flash bank cfi 0x50000000 0x0400000 2 2 0
-
-
-

Deleted: trunk/src/target/target/zy1000.cfg
===================================================================
--- trunk/src/target/target/zy1000.cfg	2009-05-15 23:35:27 UTC (rev 1797)
+++ trunk/src/target/target/zy1000.cfg	2009-05-16 14:57:02 UTC (rev 1798)
@@ -1,110 +0,0 @@
-#Script for ZY1000
-
-#Atmel ties SRST & TRST together, at which point it makes
-#no sense to use TRST, but use TMS instead.
-#
-#The annoying thing with tying SRST & TRST together is that
-#there is no way to halt the CPU *before and during* the
-#SRST reset, which means that the CPU will run a number
-#of cycles before it can be halted(as much as milliseconds).
-reset_config srst_only srst_pulls_trst
-
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME zy1000
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
- 
-#jtag scan chain
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-   set _CPUTAPID 0x1f0f0f0f
-}
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm7tdmi-s_r4
-
-# at CPU CLK <32kHz this must be disabled
-arm7_9 fast_memory_access enable
-arm7_9 dcc_downloads enable
-
-flash bank ecosflash 0x01000000 0x200000 2 2 0 ecos/at91eb40a.elf
-$_TARGETNAME configure -event reset-init { 
-	# Set up chip selects & timings
-	mww 0xFFE00000 0x0100273D
-	mww 0xFFE00004 0x08002125
-	mww 0xFFEe0008 0x02002125
-	mww 0xFFE0000c 0x03002125
-	mww 0xFFE00010 0x40000000
-	mww 0xFFE00014 0x50000000
-	mww 0xFFE00018 0x60000000
-	mww 0xFFE0001c 0x70000000
-	mww 0xFFE00020 0x00000001
-	mww 0xFFE00024 0x00000000
-	
-	# remap  
-	mww 0xFFFFF124 0xFFFFFFFF  
-	mww 0xffff0010 0x100
-	mww 0xffff0034 0x100
-	
-	#disable 16x5x UART interrupts
-	mww 0x08020004 0
-}
-
-# required for usable performance. Used for lots of
-# other things than flash programming.
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00020000 -work-area-size 0x20000 -work-area-backup 0
-
-jtag_khz 16000
-
-
-proc production_info {} {
-	return "Serial number is official MAC number. Format XXXXXXXXXXXX"
-}
-
-# There is no return value from this procedure. If it is
-# successful it does not throw an exception
-#
-# Progress messages are output via puts 
-proc production {firmwarefile serialnumber} {
-	if {[string length $serialnumber]!=12} {
-		puts "Invalid serial number"
-		return
-	}
-
-	puts "Power cycling target"
-	power off
-	sleep 3000
-	power on
-	sleep 1000
-	reset init
-	flash write_image erase $firmwarefile 0x1000000 bin
-	verify_image $firmwarefile 0x1000000 bin
-
-	# Big endian... weee!!!!
-	puts "Setting MAC number to $serialnumber"	
-	flash fillw [expr 0x1030000-0x8] "0x[string range $serialnumber 2 3][string range $serialnumber 0 1]0000" 1
-	flash fillw [expr 0x1030000-0x4] "0x[string range $serialnumber 10 11][string range $serialnumber 8 9][string range $serialnumber 6 7][string range $serialnumber 4 5]" 1
-	puts "Production successful"
-} 
-
-
-proc production_test {} {
-	power on
-	sleep 1000
-	target_request debugmsgs enable
-	reset run
-	sleep 25000
-	target_request debugmsgs disable
-	return "See IP address above..."
-}



From oharboe at mail.berlios.de  Sat May 16 16:59:12 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 16 May 2009 16:59:12 +0200
Subject: [Openocd-svn] r1799 - trunk/src/flash
Message-ID: <200905161459.n4GExCx2016776@sheep.berlios.de>

Author: oharboe
Date: 2009-05-16 16:59:10 +0200 (Sat, 16 May 2009)
New Revision: 1799

Modified:
   trunk/src/flash/at91sam7.c
Log:
fix naming of at91sam7 driver

Modified: trunk/src/flash/at91sam7.c
===================================================================
--- trunk/src/flash/at91sam7.c	2009-05-16 14:57:02 UTC (rev 1798)
+++ trunk/src/flash/at91sam7.c	2009-05-16 14:59:10 UTC (rev 1799)
@@ -62,7 +62,7 @@
 
 flash_driver_t at91sam7_flash =
 {
-	.name = "at91sam7_new",
+	.name = "at91sam7",
 	.register_commands = at91sam7_register_commands,
 	.flash_bank_command = at91sam7_flash_bank_command,
 	.erase = at91sam7_erase,
@@ -104,7 +104,7 @@
 
 static int at91sam7_register_commands(struct command_context_s *cmd_ctx)
 {
-	command_t *at91sam7_cmd = register_command(cmd_ctx, NULL, "at91sam7_new", NULL, COMMAND_ANY, NULL);
+	command_t *at91sam7_cmd = register_command(cmd_ctx, NULL, "at91sam7", NULL, COMMAND_ANY, NULL);
 
 	register_command(cmd_ctx, at91sam7_cmd, "gpnvm", at91sam7_handle_gpnvm_command, COMMAND_EXEC,
 					"at91sam7 gpnvm <bit> set|clear, set or clear one gpnvm bit");



From oharboe at mail.berlios.de  Sat May 16 22:09:13 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 16 May 2009 22:09:13 +0200
Subject: [Openocd-svn] r1800 - in trunk/src/jtag: . rlink
Message-ID: <200905162009.n4GK9Dic018327@sheep.berlios.de>

Author: oharboe
Date: 2009-05-16 22:09:07 +0200 (Sat, 16 May 2009)
New Revision: 1800

Modified:
   trunk/src/jtag/amt_jtagaccel.c
   trunk/src/jtag/arm-jtag-ew.c
   trunk/src/jtag/bitbang.c
   trunk/src/jtag/ft2232.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/jlink.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/rlink/rlink.c
   trunk/src/jtag/usbprog.c
   trunk/src/jtag/vsllink.c
Log:
Michael Bruck <mbruck at digenius.de> change 'ir_scan' from 'int' to 'bool' to document its semantics

Modified: trunk/src/jtag/amt_jtagaccel.c
===================================================================
--- trunk/src/jtag/amt_jtagaccel.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/amt_jtagaccel.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -233,7 +233,7 @@
 		amt_jtagaccel_state_move();
 }
 
-static void amt_jtagaccel_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size)
+static void amt_jtagaccel_scan(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size)
 {
 	int bits_left = scan_size;
 	int bit_count = 0;

Modified: trunk/src/jtag/arm-jtag-ew.c
===================================================================
--- trunk/src/jtag/arm-jtag-ew.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/arm-jtag-ew.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -72,7 +72,7 @@
 static void armjtagew_state_move(void);
 static void armjtagew_path_move(int num_states, tap_state_t *path);
 static void armjtagew_runtest(int num_cycles);
-static void armjtagew_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
+static void armjtagew_scan(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
 static void armjtagew_reset(int trst, int srst);
 //static void armjtagew_simple_command(u8 command);
 static int armjtagew_get_status(void);
@@ -401,7 +401,7 @@
 	}
 }
 
-static void armjtagew_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
+static void armjtagew_scan(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
 {
 	tap_state_t saved_end_state;
 

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/bitbang.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -168,7 +168,7 @@
 
 
 
-static void bitbang_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size)
+static void bitbang_scan(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size)
 {
 	tap_state_t saved_end_state = tap_get_end_state();
 	int bit_cnt;

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/ft2232.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -573,7 +573,7 @@
 }
 
 
-void ft2232_add_scan(int ir_scan, enum scan_type type, u8* buffer, int scan_size)
+void ft2232_add_scan(bool ir_scan, enum scan_type type, u8* buffer, int scan_size)
 {
 	int num_bytes = (scan_size + 7) / 8;
 	int bits_left = scan_size;

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/gw16012.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -263,7 +263,7 @@
 		gw16012_state_move();
 }
 
-static void gw16012_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size)
+static void gw16012_scan(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size)
 {
 	int bits_left = scan_size;
 	int bit_count = 0;

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/jlink.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -83,7 +83,7 @@
 static void jlink_state_move(void);
 static void jlink_path_move(int num_states, tap_state_t *path);
 static void jlink_runtest(int num_cycles);
-static void jlink_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
+static void jlink_scan(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
 static void jlink_reset(int trst, int srst);
 static void jlink_simple_command(u8 command);
 static int jlink_get_status(void);
@@ -434,7 +434,7 @@
 	}
 }
 
-static void jlink_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
+static void jlink_scan(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
 {
 	tap_state_t saved_end_state;
 

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/jtag.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -592,7 +592,7 @@
 
 	/* allocate memory for ir scan command */
 	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = 1;
+	(*last_cmd)->cmd.scan->ir_scan = true;
 	x = jtag_NumEnabledTaps();
 	(*last_cmd)->cmd.scan->num_fields = x;	/* one field per device */
 	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc(x  * sizeof(scan_field_t));
@@ -672,7 +672,7 @@
 
 	/* allocate memory for ir scan command */
 	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = 1;
+	(*last_cmd)->cmd.scan->ir_scan = true;
 	(*last_cmd)->cmd.scan->num_fields = num_fields;
 	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc(num_fields * sizeof(scan_field_t));
 	(*last_cmd)->cmd.scan->end_state = state;
@@ -797,7 +797,7 @@
 
 	/* allocate memory for dr scan command */
 	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = 0;
+	(*last_cmd)->cmd.scan->ir_scan = false;
 	(*last_cmd)->cmd.scan->num_fields = num_fields + bypass_devices;
 	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc((num_fields + bypass_devices) * sizeof(scan_field_t));
 	(*last_cmd)->cmd.scan->end_state = state;
@@ -891,7 +891,7 @@
 
 	/* allocate memory for dr scan command */
 	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = 0;
+	(*last_cmd)->cmd.scan->ir_scan = false;
 	(*last_cmd)->cmd.scan->num_fields = num_fields + bypass_devices;
 	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc((num_fields + bypass_devices) * sizeof(scan_field_t));
 	(*last_cmd)->cmd.scan->end_state = end_state;
@@ -970,7 +970,7 @@
 
 	/* allocate memory for scan command */
 	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = 0;
+	(*last_cmd)->cmd.scan->ir_scan = false;
 	(*last_cmd)->cmd.scan->num_fields = num_fields;
 	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc(num_fields * sizeof(scan_field_t));
 	(*last_cmd)->cmd.scan->end_state = state;

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/jtag.h	2009-05-16 20:09:07 UTC (rev 1800)
@@ -287,7 +287,7 @@
 
 typedef struct scan_command_s
 {
-	int           ir_scan;      /* instruction/not data scan */
+	bool          ir_scan;      /* instruction/not data scan */
 	int           num_fields;   /* number of fields in *fields array */
 	scan_field_t* fields;       /* pointer to an array of data scan fields */
 	tap_state_t   end_state;    /* TAP state in which JTAG commands should finish */

Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/rlink/rlink.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -1094,7 +1094,7 @@
 	u8			*buffer,
 	int			scan_size
 ) {
-	int			ir_scan;
+	bool		ir_scan;
 	tap_state_t	saved_end_state;
 	int			byte_bits;
 	int			extra_bits;

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/usbprog.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -58,7 +58,7 @@
 static void usbprog_state_move(void);
 static void usbprog_path_move(pathmove_command_t *cmd);
 static void usbprog_runtest(int num_cycles);
-static void usbprog_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size);
+static void usbprog_scan(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size);
 
 jtag_interface_t usbprog_interface =
 {
@@ -336,7 +336,7 @@
 	*/
 }
 
-static void usbprog_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size)
+static void usbprog_scan(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size)
 {
 	tap_state_t saved_end_state = tap_get_end_state();
 

Modified: trunk/src/jtag/vsllink.c
===================================================================
--- trunk/src/jtag/vsllink.c	2009-05-16 14:59:10 UTC (rev 1799)
+++ trunk/src/jtag/vsllink.c	2009-05-16 20:09:07 UTC (rev 1800)
@@ -204,9 +204,9 @@
 static void vsllink_stableclocks_dma(int num_cycles, int tms);
 static void vsllink_stableclocks_normal(int num_cycles, int tms);
 static void (*vsllink_stableclocks)(int num_cycles, int tms);
-static void vsllink_scan_dma(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
-static void vsllink_scan_normal(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
-static void (*vsllink_scan)(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
+static void vsllink_scan_dma(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
+static void vsllink_scan_normal(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
+static void (*vsllink_scan)(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command);
 static void vsllink_reset(int trst, int srst);
 static void vsllink_simple_command(u8 command);
 static int vsllink_connect(void);
@@ -1189,7 +1189,7 @@
 	}
 }
 
-static void vsllink_scan_normal(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
+static void vsllink_scan_normal(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
 {
 	tap_state_t saved_end_state;
 	u8 bits_left, tms_tmp, tdi_len;
@@ -1305,7 +1305,7 @@
 	
 	tap_set_state(tap_get_end_state());
 }
-static void vsllink_scan_dma(int ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
+static void vsllink_scan_dma(bool ir_scan, enum scan_type type, u8 *buffer, int scan_size, scan_command_t *command)
 {
 	tap_state_t saved_end_state;
 	



From oharboe at mail.berlios.de  Sun May 17 15:00:37 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 17 May 2009 15:00:37 +0200
Subject: [Openocd-svn] r1801 - trunk/src/target
Message-ID: <200905171300.n4HD0bCC031707@sheep.berlios.de>

Author: oharboe
Date: 2009-05-17 15:00:36 +0200 (Sun, 17 May 2009)
New Revision: 1801

Modified:
   trunk/src/target/target.c
Log:
fix array2mem/mem2array when used as a "method" on a target.

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-16 20:09:07 UTC (rev 1800)
+++ trunk/src/target/target.c	2009-05-17 13:00:36 UTC (rev 1801)
@@ -1285,8 +1285,8 @@
 
 	/* script procedures */
 	register_command(cmd_ctx, NULL, "profile", handle_profile_command, COMMAND_EXEC, "profiling samples the CPU PC");
-	register_jim(cmd_ctx, "ocd_mem2array", jim_mem2array, "read memory and return as a TCL array for script processing");
-	register_jim(cmd_ctx, "ocd_array2mem", jim_array2mem, "convert a TCL array to memory locations and write the values");
+	register_jim(cmd_ctx, "ocd_mem2array", jim_mem2array, "read memory and return as a TCL array for script processing <ARRAYNAME> <WIDTH=32/16/8> <ADDRESS> <COUNT>");
+	register_jim(cmd_ctx, "ocd_array2mem", jim_array2mem, "convert a TCL array to memory locations and write the values  <ARRAYNAME> <WIDTH=32/16/8> <ADDRESS> <COUNT>");
 
 	register_command(cmd_ctx, NULL, "fast_load_image", handle_fast_load_image_command, COMMAND_ANY,
 			"same args as load_image, image stored in memory - mainly for profiling purposes");
@@ -2721,7 +2721,7 @@
 		return JIM_ERR;
 	}
 
-	return 	target_mem2array(interp, target, argc,argv);
+	return 	target_mem2array(interp, target, argc-1, argv+1);
 }
 
 static int target_mem2array(Jim_Interp *interp, target_t *target, int argc, Jim_Obj *const *argv)
@@ -2742,25 +2742,25 @@
 	 * argv[3] = memory address
 	 * argv[4] = count of times to read
 	 */
-	if (argc != 5) {
+	if (argc != 4) {
 		Jim_WrongNumArgs(interp, 1, argv, "varname width addr nelems");
 		return JIM_ERR;
 	}
-	varname = Jim_GetString(argv[1], &len);
+	varname = Jim_GetString(argv[0], &len);
 	/* given "foo" get space for worse case "foo(%d)" .. add 20 */
 
-	e = Jim_GetLong(interp, argv[2], &l);
+	e = Jim_GetLong(interp, argv[1], &l);
 	width = l;
 	if (e != JIM_OK) {
 		return e;
 	}
 
-	e = Jim_GetLong(interp, argv[3], &l);
+	e = Jim_GetLong(interp, argv[2], &l);
 	addr = l;
 	if (e != JIM_OK) {
 		return e;
 	}
-	e = Jim_GetLong(interp, argv[4], &l);
+	e = Jim_GetLong(interp, argv[3], &l);
 	len = l;
 	if (e != JIM_OK) {
 		return e;
@@ -2903,7 +2903,7 @@
 		return JIM_ERR;
 	}
 
-	return target_array2mem( interp,target, argc, argv );
+	return target_array2mem( interp,target, argc-1, argv+1 );
 }
 
 static int target_array2mem(Jim_Interp *interp, target_t *target, int argc, Jim_Obj *const *argv)
@@ -2924,25 +2924,25 @@
 	 * argv[3] = memory address
 	 * argv[4] = count to write
 	 */
-	if (argc != 5) {
+	if (argc != 4) {
 		Jim_WrongNumArgs(interp, 1, argv, "varname width addr nelems");
 		return JIM_ERR;
 	}
-	varname = Jim_GetString(argv[1], &len);
+	varname = Jim_GetString(argv[0], &len);
 	/* given "foo" get space for worse case "foo(%d)" .. add 20 */
 
-	e = Jim_GetLong(interp, argv[2], &l);
+	e = Jim_GetLong(interp, argv[1], &l);
 	width = l;
 	if (e != JIM_OK) {
 		return e;
 	}
 
-	e = Jim_GetLong(interp, argv[3], &l);
+	e = Jim_GetLong(interp, argv[2], &l);
 	addr = l;
 	if (e != JIM_OK) {
 		return e;
 	}
-	e = Jim_GetLong(interp, argv[4], &l);
+	e = Jim_GetLong(interp, argv[3], &l);
 	len = l;
 	if (e != JIM_OK) {
 		return e;



From kc8apf at mail.berlios.de  Mon May 18 06:37:36 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 06:37:36 +0200
Subject: [Openocd-svn] r1802 - trunk/src/flash
Message-ID: <200905180437.n4I4bajS020288@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 06:37:33 +0200 (Mon, 18 May 2009)
New Revision: 1802

Modified:
   trunk/src/flash/lpc3180_nand_controller.c
   trunk/src/flash/nand.c
   trunk/src/flash/nand.h
   trunk/src/flash/s3c2410_nand.c
   trunk/src/flash/s3c2412_nand.c
   trunk/src/flash/s3c2440_nand.c
   trunk/src/flash/s3c2443_nand.c
   trunk/src/flash/s3c24xx_nand.c
   trunk/src/flash/s3c24xx_nand.h
   trunk/src/flash/stellaris.h
   trunk/src/flash/stm32x.h
   trunk/src/flash/str7x.h
Log:
Whitespace cleanup from David Brownell <david-b at pacbell.net>

Modified: trunk/src/flash/lpc3180_nand_controller.c
===================================================================
--- trunk/src/flash/lpc3180_nand_controller.c	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/lpc3180_nand_controller.c	2009-05-18 04:37:33 UTC (rev 1802)
@@ -61,13 +61,13 @@
 static int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device)
 {
 	lpc3180_nand_controller_t *lpc3180_info;
-	
+
 	if (argc < 3)
 	{
 		LOG_WARNING("incomplete 'lpc3180' nand flash configuration");
 		return ERROR_FLASH_BANK_INVALID;
 	}
-	
+
 	lpc3180_info = malloc(sizeof(lpc3180_nand_controller_t));
 	device->controller_priv = lpc3180_info;
 
@@ -81,22 +81,22 @@
 	lpc3180_info->osc_freq = strtoul(args[2], NULL, 0);
 	if ((lpc3180_info->osc_freq < 1000) || (lpc3180_info->osc_freq > 20000))
 	{
-		LOG_WARNING("LPC3180 oscillator frequency should be between 1000 and 20000 kHz, was %i", lpc3180_info->osc_freq); 
+		LOG_WARNING("LPC3180 oscillator frequency should be between 1000 and 20000 kHz, was %i", lpc3180_info->osc_freq);
 	}
 	lpc3180_info->selected_controller = LPC3180_NO_CONTROLLER;
 	lpc3180_info->sw_write_protection = 0;
 	lpc3180_info->sw_wp_lower_bound = 0x0;
 	lpc3180_info->sw_wp_upper_bound = 0x0;
-		
+
 	return ERROR_OK;
 }
 
 static int lpc3180_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *lpc3180_cmd = register_command(cmd_ctx, NULL, "lpc3180", NULL, COMMAND_ANY, "commands specific to the LPC3180 NAND flash controllers");
-	
+
 	register_command(cmd_ctx, lpc3180_cmd, "select", handle_lpc3180_select_command, COMMAND_EXEC, "select <'mlc'|'slc'> controller (default is mlc)");
-	
+
 	return ERROR_OK;
 }
 
@@ -112,20 +112,20 @@
 
 	if (!lock)
 		LOG_WARNING("PLL is not locked");
-	
+
 	if (!bypass && direct)	/* direct mode */
 		return (m * fclkin) / n;
-	
+
 	if (bypass && !direct)	/* bypass mode */
 		return fclkin / (2 * p);
-	
+
 	if (bypass & direct)	/* direct bypass mode */
 		return fclkin;
-	
+
 	if (feedback)			/* integer mode */
 		return m * (fclkin / n);
 	else					/* non-integer mode */
-		return (m / (2 * p)) * (fclkin / n); 
+		return (m / (2 * p)) * (fclkin / n);
 }
 
 static float lpc3180_cycle_time(lpc3180_nand_controller_t *lpc3180_info)
@@ -136,20 +136,20 @@
 	int hclk;
 	int hclk_pll;
 	float cycle;
-	
+
 	/* calculate timings */
-	
-	/* determine current SYSCLK (13'MHz or main oscillator) */ 
+
+	/* determine current SYSCLK (13'MHz or main oscillator) */
 	target_read_u32(target, 0x40004050, &sysclk_ctrl);
-	
+
 	if ((sysclk_ctrl & 1) == 0)
 		sysclk = lpc3180_info->osc_freq;
 	else
 		sysclk = 13000;
-	
+
 	/* determine selected HCLK source */
 	target_read_u32(target, 0x40004044, &pwr_ctrl);
-	
+
 	if ((pwr_ctrl & (1 << 2)) == 0) /* DIRECT RUN mode */
 	{
 		hclk = sysclk;
@@ -160,21 +160,21 @@
 		hclk_pll = lpc3180_pll(sysclk, hclkpll_ctrl);
 
 		target_read_u32(target, 0x40004040, &hclkdiv_ctrl);
-		
+
 		if (pwr_ctrl & (1 << 10)) /* ARM_CLK and HCLK use PERIPH_CLK */
 		{
 			hclk = hclk_pll / (((hclkdiv_ctrl & 0x7c) >> 2) + 1);
 		}
 		else /* HCLK uses HCLK_PLL */
 		{
-			hclk = hclk_pll / (1 << (hclkdiv_ctrl & 0x3)); 
+			hclk = hclk_pll / (1 << (hclkdiv_ctrl & 0x3));
 		}
 	}
-	
+
 	LOG_DEBUG("LPC3180 HCLK currently clocked at %i kHz", hclk);
-	
+
 	cycle = (1.0 / hclk) * 1000000.0;
-	
+
 	return cycle;
 }
 
@@ -185,20 +185,20 @@
 	int bus_width = (device->bus_width) ? (device->bus_width) : 8;
 	int address_cycles = (device->address_cycles) ? (device->address_cycles) : 3;
 	int page_size = (device->page_size) ? (device->page_size) : 512;
-		
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	/* sanitize arguments */
 	if ((bus_width != 8) && (bus_width != 16))
 	{
 		LOG_ERROR("LPC3180 only supports 8 or 16 bit bus width, not %i", bus_width);
 		return ERROR_NAND_OPERATION_NOT_SUPPORTED;
 	}
-	
+
 	/* The LPC3180 only brings out 8 bit NAND data bus, but the controller
 	 * would support 16 bit, too, so we just warn about this for now
 	 */
@@ -206,44 +206,44 @@
 	{
 		LOG_WARNING("LPC3180 only supports 8 bit bus width");
 	}
-	
+
 	/* inform calling code about selected bus width */
 	device->bus_width = bus_width;
-	
+
 	if ((address_cycles != 3) && (address_cycles != 4))
 	{
 		LOG_ERROR("LPC3180 only supports 3 or 4 address cycles, not %i", address_cycles);
 		return ERROR_NAND_OPERATION_NOT_SUPPORTED;
 	}
-	
+
 	if ((page_size != 512) && (page_size != 2048))
 	{
 		LOG_ERROR("LPC3180 only supports 512 or 2048 byte pages, not %i", page_size);
 		return ERROR_NAND_OPERATION_NOT_SUPPORTED;
 	}
-	
+
 	/* select MLC controller if none is currently selected */
 	if (lpc3180_info->selected_controller == LPC3180_NO_CONTROLLER)
 	{
 		LOG_DEBUG("no LPC3180 NAND flash controller selected, using default 'mlc'");
 		lpc3180_info->selected_controller = LPC3180_MLC_CONTROLLER;
 	}
-	
+
 	if (lpc3180_info->selected_controller == LPC3180_MLC_CONTROLLER)
 	{
 		u32 mlc_icr_value = 0x0;
 		float cycle;
 		int twp, twh, trp, treh, trhz, trbwb, tcea;
-		
+
 		/* FLASHCLK_CTRL = 0x22 (enable clock for MLC flash controller) */
 		target_write_u32(target, 0x400040c8, 0x22);
-		
+
 		/* MLC_CEH = 0x0 (Force nCE assert) */
 		target_write_u32(target, 0x200b804c, 0x0);
-		
+
 		/* MLC_LOCK = 0xa25e (unlock protected registers) */
 		target_write_u32(target, 0x200b8044, 0xa25e);
-		
+
 		/* MLC_ICR = configuration */
 		if (lpc3180_info->sw_write_protection)
 			mlc_icr_value |= 0x8;
@@ -254,10 +254,10 @@
 		if (bus_width == 16)
 			mlc_icr_value |= 0x1;
 		target_write_u32(target, 0x200b8030, mlc_icr_value);
-		
+
 		/* calculate NAND controller timings */
 		cycle = lpc3180_cycle_time(lpc3180_info);
-		
+
 		twp = ((40 / cycle) + 1);
 		twh = ((20 / cycle) + 1);
 		trp = ((30 / cycle) + 1);
@@ -265,14 +265,14 @@
 		trhz = ((30 / cycle) + 1);
 		trbwb = ((100 / cycle) + 1);
 		tcea = ((45 / cycle) + 1);
-		
+
 		/* MLC_LOCK = 0xa25e (unlock protected registers) */
 		target_write_u32(target, 0x200b8044, 0xa25e);
-	
+
 		/* MLC_TIME_REG */
-		target_write_u32(target, 0x200b8034, (twp & 0xf) | ((twh & 0xf) << 4) | 
-			((trp & 0xf) << 8) | ((treh & 0xf) << 12) | ((trhz & 0x7) << 16) | 
-			((trbwb & 0x1f) << 19) | ((tcea & 0x3) << 24)); 
+		target_write_u32(target, 0x200b8034, (twp & 0xf) | ((twh & 0xf) << 4) |
+			((trp & 0xf) << 8) | ((treh & 0xf) << 12) | ((trhz & 0x7) << 16) |
+			((trbwb & 0x1f) << 19) | ((tcea & 0x3) << 24));
 
 		lpc3180_reset(device);
 	}
@@ -281,30 +281,30 @@
 		float cycle;
 		int r_setup, r_hold, r_width, r_rdy;
 		int w_setup, w_hold, w_width, w_rdy;
-		
+
 		/* FLASHCLK_CTRL = 0x05 (enable clock for SLC flash controller) */
 		target_write_u32(target, 0x400040c8, 0x05);
-		
+
 		/* SLC_CFG = 0x (Force nCE assert, ECC enabled, WIDTH = bus_width) */
 		target_write_u32(target, 0x20020014, 0x28 | (bus_width == 16) ? 1 : 0);
-		
+
 		/* calculate NAND controller timings */
 		cycle = lpc3180_cycle_time(lpc3180_info);
-		
+
 		r_setup = w_setup = 0;
 		r_hold = w_hold = 10 / cycle;
 		r_width = 30 / cycle;
 		w_width = 40 / cycle;
 		r_rdy = w_rdy = 100 / cycle;
-		
+
 		/* SLC_TAC: SLC timing arcs register */
 		target_write_u32(target, 0x2002002c, (r_setup & 0xf) | ((r_hold & 0xf) << 4) |
 			((r_width & 0xf) << 8) | ((r_rdy & 0xf) << 12) |  ((w_setup & 0xf) << 16) |
-			((w_hold & 0xf) << 20) | ((w_width & 0xf) << 24) | ((w_rdy & 0xf) << 28)); 
-		
+			((w_hold & 0xf) << 20) | ((w_width & 0xf) << 24) | ((w_rdy & 0xf) << 28));
+
 		lpc3180_reset(device);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -312,13 +312,13 @@
 {
 	lpc3180_nand_controller_t *lpc3180_info = device->controller_priv;
 	target_t *target = lpc3180_info->target;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	if (lpc3180_info->selected_controller == LPC3180_NO_CONTROLLER)
 	{
 		LOG_ERROR("BUG: no LPC3180 NAND flash controller selected");
@@ -339,14 +339,14 @@
 	{
 		/* SLC_CTRL = 0x6 (ECC_CLEAR, SW_RESET) */
 		target_write_u32(target, 0x20020010, 0x6);
-		
+
 		if (!lpc3180_controller_ready(device, 100))
 		{
 			LOG_ERROR("LPC3180 NAND controller timed out after reset");
 			return ERROR_NAND_OPERATION_TIMEOUT;
 		}
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -354,13 +354,13 @@
 {
 	lpc3180_nand_controller_t *lpc3180_info = device->controller_priv;
 	target_t *target = lpc3180_info->target;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	if (lpc3180_info->selected_controller == LPC3180_NO_CONTROLLER)
 	{
 		LOG_ERROR("BUG: no LPC3180 NAND flash controller selected");
@@ -375,8 +375,8 @@
 	{
 		/* SLC_CMD = command */
 		target_write_u32(target, 0x20020008, command);
-	}	
-	
+	}
+
 	return ERROR_OK;
 }
 
@@ -384,13 +384,13 @@
 {
 	lpc3180_nand_controller_t *lpc3180_info = device->controller_priv;
 	target_t *target = lpc3180_info->target;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	if (lpc3180_info->selected_controller == LPC3180_NO_CONTROLLER)
 	{
 		LOG_ERROR("BUG: no LPC3180 NAND flash controller selected");
@@ -406,7 +406,7 @@
 		/* SLC_ADDR = address */
 		target_write_u32(target, 0x20020004, address);
 	}
-		
+
 	return ERROR_OK;
 }
 
@@ -414,13 +414,13 @@
 {
 	lpc3180_nand_controller_t *lpc3180_info = device->controller_priv;
 	target_t *target = lpc3180_info->target;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	if (lpc3180_info->selected_controller == LPC3180_NO_CONTROLLER)
 	{
 		LOG_ERROR("BUG: no LPC3180 NAND flash controller selected");
@@ -436,7 +436,7 @@
 		/* SLC_DATA = data */
 		target_write_u32(target, 0x20020000, data);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -444,13 +444,13 @@
 {
 	lpc3180_nand_controller_t *lpc3180_info = device->controller_priv;
 	target_t *target = lpc3180_info->target;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	if (lpc3180_info->selected_controller == LPC3180_NO_CONTROLLER)
 	{
 		LOG_ERROR("BUG: no LPC3180 NAND flash controller selected");
@@ -481,7 +481,7 @@
 
 		/* data = SLC_DATA, must use 32-bit access */
 		target_read_u32(target, 0x20020000, &data32);
-		
+
 		if (device->bus_width == 8)
 		{
 			u8 *data8 = data;
@@ -497,8 +497,8 @@
 			LOG_ERROR("BUG: bus_width neither 8 nor 16 bit");
 			return ERROR_NAND_OPERATION_FAILED;
 		}
-	}	
-	
+	}
+
 	return ERROR_OK;
 }
 
@@ -508,13 +508,13 @@
 	target_t *target = lpc3180_info->target;
 	int retval;
 	u8 status;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	if (lpc3180_info->selected_controller == LPC3180_NO_CONTROLLER)
 	{
 		LOG_ERROR("BUG: no LPC3180 NAND flash controller selected");
@@ -525,30 +525,30 @@
 		u8 *page_buffer;
 		u8 *oob_buffer;
 		int quarter, num_quarters;
-		
+
 		if (!data && oob)
 		{
 			LOG_ERROR("LPC3180 MLC controller can't write OOB data only");
 			return ERROR_NAND_OPERATION_NOT_SUPPORTED;
 		}
-		
+
 		if (oob && (oob_size > 6))
 		{
 			LOG_ERROR("LPC3180 MLC controller can't write more than 6 bytes of OOB data");
 			return ERROR_NAND_OPERATION_NOT_SUPPORTED;
 		}
-		
+
 		if (data_size > (u32)device->page_size)
 		{
 			LOG_ERROR("data size exceeds page size");
 			return ERROR_NAND_OPERATION_NOT_SUPPORTED;
 		}
-		
+
 		/* MLC_CMD = sequential input */
 		target_write_u32(target, 0x200b8000, NAND_CMD_SEQIN);
 
 		page_buffer = malloc(512);
-		oob_buffer = malloc(6);		
+		oob_buffer = malloc(6);
 
 		if (device->page_size == 512)
 		{
@@ -558,7 +558,7 @@
 			/* MLC_ADDR = row */
 			target_write_u32(target, 0x200b8004, page & 0xff);
 			target_write_u32(target, 0x200b8004, (page >> 8) & 0xff);
-			
+
 			if (device->address_cycles == 4)
 				target_write_u32(target, 0x200b8004, (page >> 16) & 0xff);
 		}
@@ -572,17 +572,17 @@
 			target_write_u32(target, 0x200b8004, page & 0xff);
 			target_write_u32(target, 0x200b8004, (page >> 8) & 0xff);
 		}
-		
+
 		/* when using the MLC controller, we have to treat a large page device
 		 * as being made out of four quarters, each the size of a small page device
 		 */
 		num_quarters = (device->page_size == 2048) ? 4 : 1;
-		 
+
 		for (quarter = 0; quarter < num_quarters; quarter++)
 		{
 			int thisrun_data_size = (data_size > 512) ? 512 : data_size;
 			int thisrun_oob_size = (oob_size > 6) ? 6 : oob_size;
-			
+
 			memset(page_buffer, 0xff, 512);
 			if (data)
 			{
@@ -590,7 +590,7 @@
 				data_size -= thisrun_data_size;
 				data += thisrun_data_size;
 			}
-			
+
 			memset(oob_buffer, 0xff, (device->page_size == 512) ? 6 : 24);
 			if (oob)
 			{
@@ -598,38 +598,38 @@
 				oob_size -= thisrun_oob_size;
 				oob += thisrun_oob_size;
 			}
-			
+
 			/* write MLC_ECC_ENC_REG to start encode cycle */
 			target_write_u32(target, 0x200b8008, 0x0);
-			
+
 			target->type->write_memory(target, 0x200a8000, 4, 128, page_buffer + (quarter * 512));
 			target->type->write_memory(target, 0x200a8000, 1, 6, oob_buffer + (quarter * 6));
-			
+
 			/* write MLC_ECC_AUTO_ENC_REG to start auto encode */
 			target_write_u32(target, 0x200b8010, 0x0);
-			
+
 			if (!lpc3180_controller_ready(device, 1000))
 			{
 				LOG_ERROR("timeout while waiting for completion of auto encode cycle");
 				return ERROR_NAND_OPERATION_FAILED;
 			}
 		}
-		
+
 		/* MLC_CMD = auto program command */
 		target_write_u32(target, 0x200b8000, NAND_CMD_PAGEPROG);
-		
+
 		if ((retval = nand_read_status(device, &status)) != ERROR_OK)
 		{
 			LOG_ERROR("couldn't read status");
 			return ERROR_NAND_OPERATION_FAILED;
 		}
-			
+
 		if (status & NAND_STATUS_FAIL)
 		{
 			LOG_ERROR("write operation didn't pass, status: 0x%2.2x", status);
 			return ERROR_NAND_OPERATION_FAILED;
 		}
-	
+
 		free(page_buffer);
 		free(oob_buffer);
 	}
@@ -637,7 +637,7 @@
 	{
 		return nand_write_page_raw(device, page, data, data_size, oob, oob_size);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -645,13 +645,13 @@
 {
 	lpc3180_nand_controller_t *lpc3180_info = device->controller_priv;
 	target_t *target = lpc3180_info->target;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	if (lpc3180_info->selected_controller == LPC3180_NO_CONTROLLER)
 	{
 		LOG_ERROR("BUG: no LPC3180 NAND flash controller selected");
@@ -672,13 +672,13 @@
 			return ERROR_NAND_OPERATION_NOT_SUPPORTED;
 		}
 #endif
-		
+
 		if (data_size > (u32)device->page_size)
 		{
 			LOG_ERROR("data size exceeds page size");
 			return ERROR_NAND_OPERATION_NOT_SUPPORTED;
 		}
-		
+
 		if (device->page_size == 2048)
 		{
 			page_buffer = malloc(2048);
@@ -689,10 +689,10 @@
 			page_buffer = malloc(512);
 			oob_buffer = malloc(16);
 		}
-		
+
 		if (!data && oob)
 		{
-			/* MLC_CMD = Read OOB 
+			/* MLC_CMD = Read OOB
 			 * we can use the READOOB command on both small and large page devices,
 			 * as the controller translates the 0x50 command to a 0x0 with appropriate
 			 * positioning of the serial buffer read pointer
@@ -704,7 +704,7 @@
 			/* MLC_CMD = Read0 */
 			target_write_u32(target, 0x200b8000, NAND_CMD_READ0);
 		}
-		
+
 		if (device->page_size == 512)
 		{
 			/* small page device */
@@ -714,7 +714,7 @@
 			/* MLC_ADDR = row */
 			target_write_u32(target, 0x200b8004, page & 0xff);
 			target_write_u32(target, 0x200b8004, (page >> 8) & 0xff);
-			
+
 			if (device->address_cycles == 4)
 				target_write_u32(target, 0x200b8004, (page >> 16) & 0xff);
 		}
@@ -728,24 +728,24 @@
 			/* MLC_ADDR = row */
 			target_write_u32(target, 0x200b8004, page & 0xff);
 			target_write_u32(target, 0x200b8004, (page >> 8) & 0xff);
-			
+
 			/* MLC_CMD = Read Start */
 			target_write_u32(target, 0x200b8000, NAND_CMD_READSTART);
 		}
-		
+
 		while (page_bytes_done < (u32)device->page_size)
 		{
 			/* MLC_ECC_AUTO_DEC_REG = dummy */
 			target_write_u32(target, 0x200b8014, 0xaa55aa55);
-			
+
 			if (!lpc3180_controller_ready(device, 1000))
 			{
 				LOG_ERROR("timeout while waiting for completion of auto decode cycle");
 				return ERROR_NAND_OPERATION_FAILED;
 			}
-		
+
 			target_read_u32(target, 0x200b8048, &mlc_isr);
-			
+
 			if (mlc_isr & 0x8)
 			{
 				if (mlc_isr & 0x40)
@@ -753,15 +753,15 @@
 					LOG_ERROR("uncorrectable error detected: 0x%2.2x", mlc_isr);
 					return ERROR_NAND_OPERATION_FAILED;
 				}
-				
+
 				LOG_WARNING("%i symbol error detected and corrected", ((mlc_isr & 0x30) >> 4) + 1);
 			}
-			
+
 			if (data)
 			{
 				target->type->read_memory(target, 0x200a8000, 4, 128, page_buffer + page_bytes_done);
 			}
-			
+
 			if (oob)
 			{
 				target->type->read_memory(target, 0x200a8000, 4, 4, oob_buffer + oob_bytes_done);
@@ -770,13 +770,13 @@
 			page_bytes_done += 512;
 			oob_bytes_done += 16;
 		}
-		
+
 		if (data)
 			memcpy(data, page_buffer, data_size);
-		
+
 		if (oob)
 			memcpy(oob, oob_buffer, oob_size);
-		
+
 		free(page_buffer);
 		free(oob_buffer);
 	}
@@ -784,7 +784,7 @@
 	{
 		return nand_read_page_raw(device, page, data, data_size, oob, oob_size);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -793,20 +793,20 @@
 	lpc3180_nand_controller_t *lpc3180_info = device->controller_priv;
 	target_t *target = lpc3180_info->target;
 	u8 status = 0x0;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-			
+
 	do
 	{
 		if (lpc3180_info->selected_controller == LPC3180_MLC_CONTROLLER)
 		{
 			/* Read MLC_ISR, wait for controller to become ready */
 			target_read_u8(target, 0x200b8048, &status);
-			
+
 			if (status & 2)
 				return 1;
 		}
@@ -818,7 +818,7 @@
 
 		alive_sleep(1);
 	} while (timeout-- > 0);
-	
+
 	return 0;
 }
 
@@ -826,65 +826,65 @@
 {
 	lpc3180_nand_controller_t *lpc3180_info = device->controller_priv;
 	target_t *target = lpc3180_info->target;
-	
+
 	if (target->state != TARGET_HALTED)
 	{
 		LOG_ERROR("target must be halted to use LPC3180 NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-			
+
 	do
 	{
 		if (lpc3180_info->selected_controller == LPC3180_MLC_CONTROLLER)
-		{	
+		{
 			u8 status = 0x0;
-			
+
 			/* Read MLC_ISR, wait for NAND flash device to become ready */
 			target_read_u8(target, 0x200b8048, &status);
-			
+
 			if (status & 1)
 				return 1;
 		}
 		else if (lpc3180_info->selected_controller == LPC3180_SLC_CONTROLLER)
 		{
 			u32 status = 0x0;
-			
+
 			/* Read SLC_STAT and check READY bit */
 			target_read_u32(target, 0x20020018, &status);
-			
+
 			if (status & 1)
 				return 1;
 		}
-		
+
 		alive_sleep(1);
 	} while (timeout-- > 0);
-	
-	return 0;	
+
+	return 0;
 }
 
 static int handle_lpc3180_select_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *device = NULL;
 	lpc3180_nand_controller_t *lpc3180_info = NULL;
-	char *selected[] = 
+	char *selected[] =
 	{
 		"no", "mlc", "slc"
 	};
-	
+
 	if ((argc < 1) || (argc > 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	
+
 	device = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (!device)
 	{
 		command_print(cmd_ctx, "nand device '#%s' is out of bounds", args[0]);
 		return ERROR_OK;
 	}
-	
+
 	lpc3180_info = device->controller_priv;
-	
+
 	if (argc == 2)
 	{
 		if (strcmp(args[1], "mlc") == 0)
@@ -900,8 +900,8 @@
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
 	}
-	
+
 	command_print(cmd_ctx, "%s controller selected", selected[lpc3180_info->selected_controller]);
-	
+
 	return ERROR_OK;
 }

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/nand.c	2009-05-18 04:37:33 UTC (rev 1802)
@@ -216,17 +216,17 @@
 {
 	int i;
 	int retval;
-		
+
 	if (argc < 1)
 	{
 		LOG_WARNING("incomplete flash device nand configuration");
 		return ERROR_FLASH_BANK_INVALID;
 	}
-	
+
 	for (i = 0; nand_flash_controllers[i]; i++)
 	{
 		nand_device_t *p, *c;
-		
+
 		if (strcmp(args[0], nand_flash_controllers[i]->name) == 0)
 		{
 			/* register flash specific commands */
@@ -235,7 +235,7 @@
 				LOG_ERROR("couldn't register '%s' commands", args[0]);
 				return retval;
 			}
-	
+
 			c = malloc(sizeof(nand_device_t));
 
 			c->controller = nand_flash_controllers[i];
@@ -254,7 +254,7 @@
 				free(c);
 				return ERROR_OK;
 			}
-			
+
 			/* put NAND device in linked list */
 			if (nand_devices)
 			{
@@ -267,7 +267,7 @@
 			{
 				nand_devices = c;
 			}
-			
+
 			return ERROR_OK;
 		}
 	}
@@ -281,16 +281,16 @@
 	{
 		LOG_ERROR("%i: %s", i, nand_flash_controllers[i]->name);
 	}
-	
+
 	return ERROR_OK;
 }
 
 int nand_register_commands(struct command_context_s *cmd_ctx)
 {
 	nand_cmd = register_command(cmd_ctx, NULL, "nand", NULL, COMMAND_ANY, "NAND specific commands");
-	
+
 	register_command(cmd_ctx, nand_cmd, "device", handle_nand_device_command, COMMAND_CONFIG, NULL);
-	
+
 	return ERROR_OK;
 }
 
@@ -317,7 +317,7 @@
 		register_command(cmd_ctx, nand_cmd, "raw_access", handle_nand_raw_access_command, COMMAND_EXEC,
 						 "raw access to NAND flash device <num> ['enable'|'disable']");
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -333,7 +333,7 @@
 			return p;
 		}
 	}
-	
+
 	return NULL;
 }
 
@@ -342,17 +342,17 @@
 	u32 page = 0x0;
 	int i;
 	u8 oob[6];
-	
+
 	if ((first < 0) || (first >= device->num_blocks))
 		first = 0;
-	
+
 	if ((last >= device->num_blocks) || (last == -1))
 		last = device->num_blocks - 1;
-	
+
 	for (i = first; i < last; i++)
 	{
 		nand_read_page(device, page, NULL, 0, oob, 6);
-		
+
 		if (((device->device->options & NAND_BUSWIDTH_16) && ((oob[0] & oob[1]) != 0xff))
 			|| (((device->page_size == 512) && (oob[5] != 0xff)) ||
 				((device->page_size == 2048) && (oob[0] != 0xff))))
@@ -364,10 +364,10 @@
 		{
 			device->blocks[i].is_bad = 0;
 		}
-		
+
 		page += (device->erase_size / device->page_size);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -375,12 +375,12 @@
 {
 	if (!device->device)
 		return ERROR_NAND_DEVICE_NOT_PROBED;
-		
+
 	/* Send read status command */
 	device->controller->command(device, NAND_CMD_STATUS);
-	
+
 	alive_sleep(1);
-	
+
 	/* read status */
 	if (device->device->options & NAND_BUSWIDTH_16)
 	{
@@ -392,7 +392,7 @@
 	{
 		device->controller->read_data(device, status);
 	}
-			
+
 	return ERROR_OK;
 }
 
@@ -427,13 +427,13 @@
 	/* clear device data */
 	device->device = NULL;
 	device->manufacturer = NULL;
-	
+
 	/* clear device parameters */
 	device->bus_width = 0;
 	device->address_cycles = 0;
 	device->page_size = 0;
 	device->erase_size = 0;
-	
+
 	/* initialize controller (device parameters are zero, use controller default) */
 	if ((retval = device->controller->init(device) != ERROR_OK))
 	{
@@ -450,13 +450,13 @@
 				return ERROR_NAND_OPERATION_FAILED;
 		}
 	}
-	
+
 	device->controller->command(device, NAND_CMD_RESET);
 	device->controller->reset(device);
 
 	device->controller->command(device, NAND_CMD_READID);
 	device->controller->address(device, 0x0);
-	
+
 	if (device->bus_width == 8)
 	{
 		device->controller->read_data(device, &manufacturer_id);
@@ -470,7 +470,7 @@
 		device->controller->read_data(device, &data_buf);
 		device_id = data_buf & 0xff;
 	}
-		
+
 	for (i = 0; nand_flash_ids[i].name; i++)
 	{
 		if (nand_flash_ids[i].id == device_id)
@@ -479,7 +479,7 @@
 			break;
 		}
 	}
-	
+
 	for (i = 0; nand_manuf_ids[i].name; i++)
 	{
 		if (nand_manuf_ids[i].id == manufacturer_id)
@@ -488,25 +488,25 @@
 			break;
 		}
 	}
-	
+
 	if (!device->manufacturer)
 	{
 		device->manufacturer = &nand_manuf_ids[0];
 		device->manufacturer->id = manufacturer_id;
 	}
-	
+
 	if (!device->device)
 	{
 		LOG_ERROR("unknown NAND flash device found, manufacturer id: 0x%2.2x device id: 0x%2.2x",
 			manufacturer_id, device_id);
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	LOG_DEBUG("found %s (%s)", device->device->name, device->manufacturer->name);
-	
+
 	/* initialize device parameters */
-	
-	/* bus width */ 
+
+	/* bus width */
 	if (device->device->options & NAND_BUSWIDTH_16)
 		device->bus_width = 16;
 	else
@@ -536,7 +536,7 @@
 			id_buff[5] = data_buf >> 8;
 		}
 	}
-		
+
 	/* page size */
 	if (device->device->page_size == 0)
 	{
@@ -551,7 +551,7 @@
 	{
 		device->page_size = device->device->page_size;
 	}
-	
+
 	/* number of address cycles */
 	if (device->page_size <= 512)
 	{
@@ -579,7 +579,7 @@
 			device->address_cycles = 6;
 		}
 	}
-	
+
 	/* erase size */
 	if (device->device->erase_size == 0)
 	{
@@ -602,7 +602,7 @@
 	{
 		device->erase_size = device->device->erase_size;
 	}
-	
+
 	/* initialize controller, but leave parameters at the controllers default */
 	if ((retval = device->controller->init(device) != ERROR_OK))
 	{
@@ -620,10 +620,10 @@
 				return ERROR_NAND_OPERATION_FAILED;
 		}
 	}
-	
+
 	device->num_blocks = (device->device->chip_size * 1024) / (device->erase_size / 1024);
 	device->blocks = malloc(sizeof(nand_block_t) * device->num_blocks);
-	
+
 	for (i = 0; i < device->num_blocks; i++)
 	{
 		device->blocks[i].size = device->erase_size;
@@ -631,7 +631,7 @@
 		device->blocks[i].is_erased = -1;
 		device->blocks[i].is_bad = -1;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -641,13 +641,13 @@
 	u32 page;
 	u8 status;
 	int retval;
-	
+
 	if (!device->device)
 		return ERROR_NAND_DEVICE_NOT_PROBED;
-	
+
 	if ((first_block < 0) || (last_block > device->num_blocks))
 		return ERROR_INVALID_ARGUMENTS;
-	
+
 	/* make sure we know if a block is bad before erasing it */
 	for (i = first_block; i <= last_block; i++)
 	{
@@ -657,25 +657,25 @@
 			break;
 		}
 	}
-	
+
 	for (i = first_block; i <= last_block; i++)
 	{
 		/* Send erase setup command */
 		device->controller->command(device, NAND_CMD_ERASE1);
-		
+
 		page = i * (device->erase_size / device->page_size);
-		
+
 		/* Send page address */
 		if (device->page_size <= 512)
 		{
 			/* row */
 			device->controller->address(device, page & 0xff);
 			device->controller->address(device, (page >> 8) & 0xff);
-			
+
 			/* 3rd cycle only on devices with more than 32 MiB */
 			if (device->address_cycles >= 4)
 				device->controller->address(device, (page >> 16) & 0xff);
-	
+
 			/* 4th cycle only on devices with more than 8 GiB */
 			if (device->address_cycles >= 5)
 				device->controller->address(device, (page >> 24) & 0xff);
@@ -685,12 +685,12 @@
 			/* row */
 			device->controller->address(device, page & 0xff);
 			device->controller->address(device, (page >> 8) & 0xff);
-	
+
 			/* 3rd cycle only on devices with more than 128 MiB */
 			if (device->address_cycles >= 5)
 				device->controller->address(device, (page >> 16) & 0xff);
 		}
-		
+
 		/* Send erase confirm command */
 		device->controller->command(device, NAND_CMD_ERASE2);
 
@@ -701,13 +701,13 @@
 			LOG_ERROR("timeout waiting for NAND flash block erase to complete");
 			return ERROR_NAND_OPERATION_TIMEOUT;
 		}
-		
+
 		if ((retval = nand_read_status(device, &status)) != ERROR_OK)
 		{
 			LOG_ERROR("couldn't read status");
 			return ERROR_NAND_OPERATION_FAILED;
 		}
-		
+
 		if (status & 0x1)
 		{
 			LOG_ERROR("erase operation didn't pass, status: 0x%2.2x", status);
@@ -716,7 +716,7 @@
 
 		device->blocks[i].is_erased = 1;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -724,74 +724,74 @@
 static int nand_read_plain(struct nand_device_s *device, u32 address, u8 *data, u32 data_size)
 {
 	u8 *page;
-	
+
 	if (!device->device)
 		return ERROR_NAND_DEVICE_NOT_PROBED;
-		
+
 	if (address % device->page_size)
 	{
 		LOG_ERROR("reads need to be page aligned");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	page = malloc(device->page_size);
-	
+
 	while (data_size > 0 )
 	{
 		u32 thisrun_size = (data_size > device->page_size) ? device->page_size : data_size;
 		u32 page_address;
-		
-		
+
+
 		page_address = address / device->page_size;
-		
+
 		nand_read_page(device, page_address, page, device->page_size, NULL, 0);
 
 		memcpy(data, page, thisrun_size);
-		
+
 		address += thisrun_size;
 		data += thisrun_size;
 		data_size -= thisrun_size;
 	}
-	
+
 	free(page);
-	
+
 	return ERROR_OK;
 }
 
 static int nand_write_plain(struct nand_device_s *device, u32 address, u8 *data, u32 data_size)
 {
 	u8 *page;
-	
+
 	if (!device->device)
 		return ERROR_NAND_DEVICE_NOT_PROBED;
-		
+
 	if (address % device->page_size)
 	{
 		LOG_ERROR("writes need to be page aligned");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	page = malloc(device->page_size);
-	
+
 	while (data_size > 0 )
 	{
 		u32 thisrun_size = (data_size > device->page_size) ? device->page_size : data_size;
 		u32 page_address;
-		
+
 		memset(page, 0xff, device->page_size);
 		memcpy(page, data, thisrun_size);
-		
+
 		page_address = address / device->page_size;
-		
+
 		nand_write_page(device, page_address, page, device->page_size, NULL, 0);
-		
+
 		address += thisrun_size;
 		data += thisrun_size;
 		data_size -= thisrun_size;
 	}
-	
+
 	free(page);
-	
+
 	return ERROR_OK;
 }
 #endif
@@ -802,7 +802,7 @@
 
 	if (!device->device)
 		return ERROR_NAND_DEVICE_NOT_PROBED;
-		
+
 	block = page / (device->erase_size / device->page_size);
 	if (device->blocks[block].is_erased == 1)
 		device->blocks[block].is_erased = 0;
@@ -817,7 +817,7 @@
 {
 	if (!device->device)
 		return ERROR_NAND_DEVICE_NOT_PROBED;
-		
+
 	if (device->use_raw || device->controller->read_page == NULL)
 		return nand_read_page_raw(device, page, data, data_size, oob, oob_size);
 	else
@@ -827,7 +827,7 @@
 int nand_read_page_raw(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size)
 {
 	u32 i;
-	
+
 	if (!device->device)
 		return ERROR_NAND_DEVICE_NOT_PROBED;
 
@@ -838,14 +838,14 @@
 			device->controller->command(device, NAND_CMD_READ0);
 		else
 			device->controller->command(device, NAND_CMD_READOOB);
-		
+
 		/* column (always 0, we start at the beginning of a page/OOB area) */
 		device->controller->address(device, 0x0);
-		
+
 		/* row */
 		device->controller->address(device, page & 0xff);
 		device->controller->address(device, (page >> 8) & 0xff);
-		
+
 		/* 4th cycle only on devices with more than 32 MiB */
 		if (device->address_cycles >= 4)
 			device->controller->address(device, (page >> 16) & 0xff);
@@ -858,7 +858,7 @@
 	{
 		/* large page device */
 		device->controller->command(device, NAND_CMD_READ0);
-		
+
 		/* column (0 when we start at the beginning of a page,
 		 * or 2048 for the beginning of OOB area)
 		 */
@@ -867,7 +867,7 @@
 			device->controller->address(device, 0x0);
 		else
 			device->controller->address(device, 0x8);
-		
+
 		/* row */
 		device->controller->address(device, page & 0xff);
 		device->controller->address(device, (page >> 8) & 0xff);
@@ -879,14 +879,14 @@
 		/* large page devices need a start command */
 		device->controller->command(device, NAND_CMD_READSTART);
 	}
-	
+
 	if (device->controller->nand_ready) {
 		if (!device->controller->nand_ready(device, 100))
 			return ERROR_NAND_OPERATION_TIMEOUT;
 	} else {
 		alive_sleep(1);
 	}
-	
+
 	if (data)
 	{
 		if (device->controller->read_block_data != NULL)
@@ -910,7 +910,7 @@
 			}
 		}
 	}
-	
+
 	if (oob)
 	{
 		if (device->controller->read_block_data != NULL)
@@ -934,8 +934,8 @@
 			}
 		}
 	}
-	
-	return ERROR_OK;	
+
+	return ERROR_OK;
 }
 
 int nand_write_page_raw(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size)
@@ -943,21 +943,21 @@
 	u32 i;
 	int retval;
 	u8 status;
-	
+
 	if (!device->device)
 		return ERROR_NAND_DEVICE_NOT_PROBED;
 
 	device->controller->command(device, NAND_CMD_SEQIN);
-	
+
 	if (device->page_size <= 512)
 	{
 		/* column (always 0, we start at the beginning of a page/OOB area) */
 		device->controller->address(device, 0x0);
-		
+
 		/* row */
 		device->controller->address(device, page & 0xff);
 		device->controller->address(device, (page >> 8) & 0xff);
-		
+
 		/* 4th cycle only on devices with more than 32 MiB */
 		if (device->address_cycles >= 4)
 			device->controller->address(device, (page >> 16) & 0xff);
@@ -976,7 +976,7 @@
 			device->controller->address(device, 0x0);
 		else
 			device->controller->address(device, 0x8);
-		
+
 		/* row */
 		device->controller->address(device, page & 0xff);
 		device->controller->address(device, (page >> 8) & 0xff);
@@ -985,7 +985,7 @@
 		if (device->address_cycles >= 5)
 			device->controller->address(device, (page >> 16) & 0xff);
 	}
-	
+
 	if (data)
 	{
 		if (device->controller->write_block_data != NULL)
@@ -1010,7 +1010,7 @@
 			}
 		}
 	}
-	
+
 	if (oob)
 	{
 		if (device->controller->write_block_data != NULL)
@@ -1035,41 +1035,41 @@
 			}
 		}
 	}
-	
+
 	device->controller->command(device, NAND_CMD_PAGEPROG);
-	
+
 	retval = device->controller->nand_ready ?
 			device->controller->nand_ready(device, 100) :
 			nand_poll_ready(device, 100);
 	if (!retval)
 		return ERROR_NAND_OPERATION_TIMEOUT;
-	
+
 	if ((retval = nand_read_status(device, &status)) != ERROR_OK)
 	{
 		LOG_ERROR("couldn't read status");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-		
+
 	if (status & NAND_STATUS_FAIL)
 	{
 		LOG_ERROR("write operation didn't pass, status: 0x%2.2x", status);
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
-	return ERROR_OK;	
+
+	return ERROR_OK;
 }
 
 int handle_nand_list_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
 	int i = 0;
-	
+
 	if (!nand_devices)
 	{
 		command_print(cmd_ctx, "no NAND flash devices configured");
 		return ERROR_OK;
 	}
-	
+
 	for (p = nand_devices; p; p = p->next)
 	{
 		if (p->device)
@@ -1078,7 +1078,7 @@
 		else
 			command_print(cmd_ctx, "#%i: not probed");
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1089,13 +1089,13 @@
 	int j = 0;
 	int first = -1;
 	int last = -1;
-		
+
 	if ((argc < 1) || (argc > 3))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	}
-	
+
 	if (argc == 2)
 	{
 		first = last = strtoul(args[1], NULL, 0);
@@ -1105,7 +1105,7 @@
 		first = strtoul(args[1], NULL, 0);
 		last = strtoul(args[2], NULL, 0);
 	}
-		
+
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (p)
 	{
@@ -1113,24 +1113,24 @@
 		{
 			if (first >= p->num_blocks)
 				first = p->num_blocks - 1;
-			
+
 			if (last >= p->num_blocks)
 				last = p->num_blocks - 1;
-			
+
 			command_print(cmd_ctx, "#%i: %s (%s) pagesize: %i, buswidth: %i, erasesize: %i",
 				i++, p->device->name, p->manufacturer->name, p->page_size, p->bus_width, p->erase_size);
-			
+
 			for (j = first; j <= last; j++)
 			{
 				char *erase_state, *bad_state;
-				
+
 				if (p->blocks[j].is_erased == 0)
 					erase_state = "not erased";
 				else if (p->blocks[j].is_erased == 1)
 					erase_state = "erased";
 				else
 					erase_state = "erase state unknown";
-				
+
 				if (p->blocks[j].is_bad == 0)
 					bad_state = "";
 				else if (p->blocks[j].is_bad == 1)
@@ -1148,7 +1148,7 @@
 			command_print(cmd_ctx, "#%i: not probed");
 		}
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1156,12 +1156,12 @@
 {
 	nand_device_t *p;
 	int retval;
-		
+
 	if (argc != 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	
+
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (p)
 	{
@@ -1182,7 +1182,7 @@
 	{
 		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds", args[0]);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1190,19 +1190,19 @@
 {
 	nand_device_t *p;
 	int retval;
-		
+
 	if (argc != 3)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	}
-	
+
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (p)
 	{
 		int first = strtoul(args[1], NULL, 0);
 		int last = strtoul(args[2], NULL, 0);
-		
+
 		if ((retval = nand_erase(p, first, last)) == ERROR_OK)
 		{
 			command_print(cmd_ctx, "successfully erased blocks %i to %i on NAND flash device '%s'", first, last, p->device->name);
@@ -1220,7 +1220,7 @@
 	{
 		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds", args[0]);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1230,19 +1230,19 @@
 	int retval;
 	int first = -1;
 	int last = -1;
-		
+
 	if ((argc < 1) || (argc > 3) || (argc == 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	}
-	
+
 	if (argc == 3)
 	{
 		first = strtoul(args[1], NULL, 0);
 		last = strtoul(args[2], NULL, 0);
 	}
-	
+
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (p)
 	{
@@ -1263,20 +1263,20 @@
 	{
 		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds", args[0]);
 	}
-	
+
 	return ERROR_OK;
 }
 
 static int handle_nand_copy_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
-		
+
 	if (argc != 4)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	}
-	
+
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (p)
 	{
@@ -1286,7 +1286,7 @@
 	{
 		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds", args[0]);
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -1296,20 +1296,20 @@
 	u32 binary_size;
 	u32 buf_cnt;
 	enum oob_formats oob_format = NAND_OOB_NONE;
-	
+
 	fileio_t fileio;
-	
+
 	duration_t duration;
 	char *duration_text;
-	
+
 	nand_device_t *p;
-		
+
 	if (argc < 3)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	}
-	
+
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (p)
 	{
@@ -1318,9 +1318,9 @@
 		u8 *oob = NULL;
 		u32 oob_size = 0;
 		const int *eccpos = NULL;
-			
+
 		offset = strtoul(args[2], NULL, 0);
-		
+
 		if (argc > 3)
 		{
 			int i;
@@ -1341,16 +1341,16 @@
 				}
 			}
 		}
-		
+
 		duration_start_measure(&duration);
 
 		if (fileio_open(&fileio, args[1], FILEIO_READ, FILEIO_BINARY) != ERROR_OK)
 		{
 			return ERROR_OK;
 		}
-	
+
 		buf_cnt = binary_size = fileio.size;
-		
+
 		if (!(oob_format & NAND_OOB_ONLY))
 		{
 			page_size = p->page_size;
@@ -1368,7 +1368,7 @@
 			}
 			oob = malloc(oob_size);
 		}
-		
+
 		if (offset % p->page_size)
 		{
 			command_print(cmd_ctx, "only page size aligned offsets and sizes are supported");
@@ -1377,11 +1377,11 @@
 			free(page);
 			return ERROR_OK;
 		}
-		
+
 		while (buf_cnt > 0)
 		{
 			u32 size_read;
-			
+
 			if (NULL != page)
 			{
 				fileio_read(&fileio, page_size, page, &size_read);
@@ -1428,7 +1428,7 @@
 					memset(oob + size_read, 0xff, oob_size - size_read);
 				}
 			}
-			
+
 			if (nand_write_page(p, offset / p->page_size, page, page_size, oob, oob_size) != ERROR_OK)
 			{
 				command_print(cmd_ctx, "failed writing file %s to NAND flash %s at offset 0x%8.8x",
@@ -1458,19 +1458,19 @@
 	{
 		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds", args[0]);
 	}
-	
+
 	return ERROR_OK;
 }
 
 static int handle_nand_dump_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
-			
+
 	if (argc < 4)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	
+
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (p)
 	{
@@ -1480,7 +1480,7 @@
 			duration_t duration;
 			char *duration_text;
 			int retval;
-			
+
 			u8 *page = NULL;
 			u32 page_size = 0;
 			u8 *oob = NULL;
@@ -1489,7 +1489,7 @@
 			u32 size = strtoul(args[3], NULL, 0);
 			u32 bytes_done = 0;
 			enum oob_formats oob_format = NAND_OOB_NONE;
-			
+
 			if (argc > 4)
 			{
 				int i;
@@ -1500,16 +1500,16 @@
 					else if (!strcmp(args[i], "oob_only"))
 						oob_format |= NAND_OOB_RAW | NAND_OOB_ONLY;
 					else
-						command_print(cmd_ctx, "unknown option: '%s'", args[i]); 
+						command_print(cmd_ctx, "unknown option: '%s'", args[i]);
 				}
 			}
-			
+
 			if ((address % p->page_size) || (size % p->page_size))
 			{
 				command_print(cmd_ctx, "only page size aligned addresses and sizes are supported");
 				return ERROR_OK;
 			}
-		
+
 			if (!(oob_format & NAND_OOB_ONLY))
 			{
 				page_size = p->page_size;
@@ -1524,14 +1524,14 @@
 					oob_size = 64;
 				oob = malloc(oob_size);
 			}
-			
+
 			if (fileio_open(&fileio, args[1], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK)
 			{
 				return ERROR_OK;
 			}
-	
+
 			duration_start_measure(&duration);
-			
+
 			while (size > 0)
 			{
 				u32 size_written;
@@ -1539,27 +1539,27 @@
 				{
 					command_print(cmd_ctx, "reading NAND flash page failed");
 					free(page);
-					free(oob);								
+					free(oob);
 					fileio_close(&fileio);
 					return ERROR_OK;
 				}
-				
+
 				if (NULL != page)
 				{
 					fileio_write(&fileio, page_size, page, &size_written);
 					bytes_done += page_size;
 				}
-					
+
 				if (NULL != oob)
 				{
 					fileio_write(&fileio, oob_size, oob, &size_written);
 					bytes_done += oob_size;
 				}
-					
+
 				size -= p->page_size;
 				address += p->page_size;
 			}
-			
+
 			free(page);
 			page = NULL;
 			free(oob);
@@ -1580,19 +1580,19 @@
 	{
 		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds", args[0]);
 	}
-	
+
 	return ERROR_OK;
 }
 
 static int handle_nand_raw_access_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
-		
+
 	if ((argc < 1) || (argc > 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	
+
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (p)
 	{
@@ -1613,7 +1613,7 @@
 					return ERROR_COMMAND_SYNTAX_ERROR;
 				}
 			}
-	
+
 			command_print(cmd_ctx, "raw access is %s", (p->use_raw) ? "enabled" : "disabled");
 		}
 		else
@@ -1625,6 +1625,6 @@
 	{
 		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds", args[0]);
 	}
-	
+
 	return ERROR_OK;
 }

Modified: trunk/src/flash/nand.h
===================================================================
--- trunk/src/flash/nand.h	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/nand.h	2009-05-18 04:37:33 UTC (rev 1802)
@@ -99,7 +99,7 @@
 
 typedef struct nand_manufacturer_s
 {
-    int id;
+	int id;
 	char *name;
 } nand_manufacturer_t;
 
@@ -115,43 +115,43 @@
 
 /* Option constants for bizarre disfunctionality and real features
  */
-enum { 
+enum {
 	/* Chip can not auto increment pages */
 	NAND_NO_AUTOINCR = 0x00000001,
-	
+
 	/* Buswitdh is 16 bit */
 	NAND_BUSWIDTH_16 = 0x00000002,
-	
+
 	/* Device supports partial programming without padding */
 	NAND_NO_PADDING = 0x00000004,
-	
+
 	/* Chip has cache program function */
 	NAND_CACHEPRG = 0x00000008,
-	
+
 	/* Chip has copy back function */
 	NAND_COPYBACK = 0x00000010,
-	
+
 	/* AND Chip which has 4 banks and a confusing page / block
 	 * assignment. See Renesas datasheet for further information */
 	NAND_IS_AND = 0x00000020,
-	
+
 	/* Chip has a array of 4 pages which can be read without
 	 * additional ready /busy waits */
 	NAND_4PAGE_ARRAY = 0x00000040,
-	
+
 	/* Chip requires that BBT is periodically rewritten to prevent
 	 * bits from adjacent blocks from 'leaking' in altering data.
 	 * This happens with the Renesas AG-AND chips, possibly others.  */
 	BBT_AUTO_REFRESH = 0x00000080,
-	
+
 	/* Chip does not require ready check on read. True
 	 * for all large page devices, as they do not support
 	 * autoincrement.*/
 	NAND_NO_READRDY = 0x00000100,
-	
+
 	/* Options valid for Samsung large page devices */
 	NAND_SAMSUNG_LP_OPTIONS = (NAND_NO_PADDING | NAND_CACHEPRG | NAND_COPYBACK),
-	
+
 	/* Options for new chips with large page size. The pagesize and the
 	 * erasesize is determined from the extended id bytes
 	 */
@@ -175,7 +175,7 @@
 	NAND_CMD_READID = 0x90,
 	NAND_CMD_ERASE2 = 0xd0,
 	NAND_CMD_RESET = 0xff,
-	
+
 	/* Extended commands for large page devices */
 	NAND_CMD_READSTART = 0x30,
 	NAND_CMD_RNDOUTSTART = 0xE0,
@@ -198,7 +198,7 @@
 	NAND_OOB_NONE = 0x0,	/* no OOB data at all */
 	NAND_OOB_RAW = 0x1,		/* raw OOB data (16 bytes for 512b page sizes, 64 bytes for 2048b page sizes) */
 	NAND_OOB_ONLY = 0x2,	/* only OOB data */
-	NAND_OOB_SW_ECC = 0x10,	/* when writing, use SW ECC (as opposed to no ECC) */ 
+	NAND_OOB_SW_ECC = 0x10,	/* when writing, use SW ECC (as opposed to no ECC) */
 	NAND_OOB_HW_ECC = 0x20, /* when writing, use HW ECC (as opposed to no ECC) */
 	NAND_OOB_SW_ECC_KW = 0x40, /* when writing, use Marvell's Kirkwood bootrom format */
 	NAND_OOB_JFFS2 = 0x100,	/* when writing, use JFFS2 OOB layout */

Modified: trunk/src/flash/s3c2410_nand.c
===================================================================
--- trunk/src/flash/s3c2410_nand.c	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/s3c2410_nand.c	2009-05-18 04:37:33 UTC (rev 1802)
@@ -59,7 +59,7 @@
 				struct nand_device_s *device)
 {
 	s3c24xx_nand_controller_t *info;
-	
+
 	info = s3c24xx_nand_device_command(cmd_ctx, cmd, args, argc, device);
 	if (info == NULL) {
 		return ERROR_NAND_DEVICE_INVALID;
@@ -70,7 +70,7 @@
 	info->addr = S3C2410_NFADDR;
 	info->data = S3C2410_NFDATA;
 	info->nfstat = S3C2410_NFSTAT;
-		
+
 	return ERROR_OK;
 }
 
@@ -79,7 +79,7 @@
 	s3c24xx_nand_controller_t *s3c24xx_info = device->controller_priv;
 	target_t *target = s3c24xx_info->target;
 
-	target_write_u32(target, S3C2410_NFCONF, 
+	target_write_u32(target, S3C2410_NFCONF,
 			 S3C2410_NFCONF_EN | S3C2410_NFCONF_TACLS(3) |
 			 S3C2410_NFCONF_TWRPH0(5) | S3C2410_NFCONF_TWRPH1(3));
 
@@ -95,7 +95,7 @@
 		LOG_ERROR("target must be halted to use S3C24XX NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	target_write_u32(target, S3C2410_NFDATA, data);
 	return ERROR_OK;
 }
@@ -104,13 +104,13 @@
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device->controller_priv;
 	target_t *target = s3c24xx_info->target;
-	
+
 	if (target->state != TARGET_HALTED) {
 		LOG_ERROR("target must be halted to use S3C24XX NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
 
-	target_read_u8(target, S3C2410_NFDATA, data);	
+	target_read_u8(target, S3C2410_NFDATA, data);
 	return ERROR_OK;
 }
 
@@ -124,14 +124,14 @@
 		LOG_ERROR("target must be halted to use S3C24XX NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	do {
 		target_read_u8(target, S3C2410_NFSTAT, &status);
-		
+
 		if (status & S3C2410_NFSTAT_BUSY)
 			return 1;
 
-		alive_sleep(1);		
+		alive_sleep(1);
 	} while (timeout-- > 0);
 
 	return 0;

Modified: trunk/src/flash/s3c2412_nand.c
===================================================================
--- trunk/src/flash/s3c2412_nand.c	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/s3c2412_nand.c	2009-05-18 04:37:33 UTC (rev 1802)
@@ -69,7 +69,7 @@
 	info->addr = S3C2440_NFADDR;
 	info->data = S3C2440_NFDATA;
 	info->nfstat = S3C2412_NFSTAT;
-	
+
 	return ERROR_OK;
 }
 

Modified: trunk/src/flash/s3c2440_nand.c
===================================================================
--- trunk/src/flash/s3c2440_nand.c	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/s3c2440_nand.c	2009-05-18 04:37:33 UTC (rev 1802)
@@ -59,7 +59,7 @@
 				struct nand_device_s *device)
 {
 	s3c24xx_nand_controller_t *info;
-	
+
 	info = s3c24xx_nand_device_command(cmd_ctx, cmd, args, argc, device);
 	if (info == NULL) {
 		return ERROR_NAND_DEVICE_INVALID;
@@ -70,7 +70,7 @@
 	info->addr = S3C2440_NFADDR;
 	info->data = S3C2440_NFDATA;
 	info->nfstat = S3C2440_NFSTAT;
-		
+
 	return ERROR_OK;
 }
 
@@ -100,10 +100,10 @@
 		LOG_ERROR("target must be halted to use S3C24XX NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
-	do {		
+
+	do {
 		target_read_u8(target, s3c24xx_info->nfstat, &status);
-		
+
 		if (status & S3C2440_NFSTAT_READY)
 			return 1;
 
@@ -130,7 +130,7 @@
 		return ERROR_NAND_OPERATION_FAILED;
 	}
 
-	while (data_size >= 4) {	  
+	while (data_size >= 4) {
 		target_read_u32(target, nfdata, &tmp);
 
 		data[0] = tmp;
@@ -164,7 +164,7 @@
 		return ERROR_NAND_OPERATION_FAILED;
 	}
 
-	while (data_size >= 4) {	  
+	while (data_size >= 4) {
 		tmp = le_to_h_u32(data);
 		target_write_u32(target, nfdata, tmp);
 

Modified: trunk/src/flash/s3c2443_nand.c
===================================================================
--- trunk/src/flash/s3c2443_nand.c	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/s3c2443_nand.c	2009-05-18 04:37:33 UTC (rev 1802)
@@ -58,7 +58,7 @@
 				struct nand_device_s *device)
 {
 	s3c24xx_nand_controller_t *info;
-	
+
 	info = s3c24xx_nand_device_command(cmd_ctx, cmd, args, argc, device);
 	if (info == NULL) {
 		return ERROR_NAND_DEVICE_INVALID;
@@ -69,7 +69,7 @@
 	info->addr = S3C2440_NFADDR;
 	info->data = S3C2440_NFDATA;
 	info->nfstat = S3C2412_NFSTAT;
-	
+
 	return ERROR_OK;
 }
 

Modified: trunk/src/flash/s3c24xx_nand.c
===================================================================
--- trunk/src/flash/s3c24xx_nand.c	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/s3c24xx_nand.c	2009-05-18 04:37:33 UTC (rev 1802)
@@ -37,7 +37,7 @@
 			    struct nand_device_s *device)
 {
 	s3c24xx_nand_controller_t *s3c24xx_info;
-	
+
 	s3c24xx_info = malloc(sizeof(s3c24xx_nand_controller_t));
 	if (s3c24xx_info == NULL) {
 		LOG_ERROR("no memory for nand controller\n");
@@ -69,9 +69,9 @@
 		LOG_ERROR("target must be halted to use S3C24XX NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	target_write_u32(target, s3c24xx_info->cmd, 0xff);
-	
+
 	return ERROR_OK;
 }
 
@@ -79,7 +79,7 @@
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device->controller_priv;
 	target_t *target = s3c24xx_info->target;
-	
+
 	if (target->state != TARGET_HALTED) {
 		LOG_ERROR("target must be halted to use S3C24XX NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
@@ -94,12 +94,12 @@
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device->controller_priv;
 	target_t *target = s3c24xx_info->target;
-	
+
 	if (target->state != TARGET_HALTED) {
 		LOG_ERROR("target must be halted to use S3C24XX NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	target_write_u16(target, s3c24xx_info->addr, address);
 	return ERROR_OK;
 }
@@ -113,7 +113,7 @@
 		LOG_ERROR("target must be halted to use S3C24XX NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;
 	}
-	
+
 	target_write_u8(target, s3c24xx_info->data, data);
 	return ERROR_OK;
 }
@@ -122,7 +122,7 @@
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device->controller_priv;
 	target_t *target = s3c24xx_info->target;
-	
+
 	if (target->state != TARGET_HALTED) {
 		LOG_ERROR("target must be halted to use S3C24XX NAND flash controller");
 		return ERROR_NAND_OPERATION_FAILED;

Modified: trunk/src/flash/s3c24xx_nand.h
===================================================================
--- trunk/src/flash/s3c24xx_nand.h	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/s3c24xx_nand.h	2009-05-18 04:37:33 UTC (rev 1802)
@@ -30,12 +30,12 @@
 typedef struct s3c24xx_nand_controller_s
 {
 	struct target_s *target;
-	
+
 	/* register addresses */
 	u32		 cmd;
 	u32		 addr;
 	u32		 data;
-	u32		 nfstat; 
+	u32		 nfstat;
 } s3c24xx_nand_controller_t;
 
 /* Default to using the un-translated NAND register based address */

Modified: trunk/src/flash/stellaris.h
===================================================================
--- trunk/src/flash/stellaris.h	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/stellaris.h	2009-05-18 04:37:33 UTC (rev 1802)
@@ -47,7 +47,6 @@
 	u32 rcc;
 	u8  mck_valid;
 	u32 mck_freq;
-	
 } stellaris_flash_bank_t;
 
 /* STELLARIS control registers */
@@ -66,7 +65,7 @@
 
 #define FMPRE		0x130
 #define FMPPE		0x134
-#define USECRL 		0x140
+#define USECRL		0x140
 
 #define FLASH_CONTROL_BASE	0x400FD000
 #define FLASH_FMA	(FLASH_CONTROL_BASE|0x000)
@@ -87,7 +86,7 @@
 #define FMC_COMT	(1<<3)
 #define FMC_MERASE	(1<<2)
 #define FMC_ERASE	(1<<1)
-#define FMC_WRITE	(1<<0)	
+#define FMC_WRITE	(1<<0)
 
 /* STELLARIS constants */
 

Modified: trunk/src/flash/stm32x.h
===================================================================
--- trunk/src/flash/stm32x.h	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/stm32x.h	2009-05-18 04:37:33 UTC (rev 1802)
@@ -66,17 +66,17 @@
 
 #define FLASH_PG		(1<<0)
 #define FLASH_PER		(1<<1)
-#define FLASH_MER   	(1<<2)
+#define FLASH_MER		(1<<2)
 #define FLASH_OPTPG		(1<<4)
 #define FLASH_OPTER		(1<<5)
 #define FLASH_STRT		(1<<6)
 #define FLASH_LOCK		(1<<7)
 #define FLASH_OPTWRE	(1<<9)
 
-/* FLASH_SR regsiter bits */
+/* FLASH_SR register bits */
 
 #define FLASH_BSY		(1<<0)
-#define FLASH_PGERR   	(1<<2)
+#define FLASH_PGERR		(1<<2)
 #define FLASH_WRPRTERR	(1<<4)
 #define FLASH_EOP		(1<<5)
 

Modified: trunk/src/flash/str7x.h
===================================================================
--- trunk/src/flash/str7x.h	2009-05-17 13:00:36 UTC (rev 1801)
+++ trunk/src/flash/str7x.h	2009-05-18 04:37:33 UTC (rev 1802)
@@ -59,14 +59,14 @@
 #define FLASH_AR		0x00000010
 #define FLASH_ER		0x00000014
 #define FLASH_NVWPAR	0x0000DFB0
-#define FLASH_NVAPR0 	0x0000DFB8
-#define FLASH_NVAPR1 	0x0000DFBC
+#define FLASH_NVAPR0	0x0000DFB8
+#define FLASH_NVAPR1	0x0000DFBC
 
 /* FLASH_CR0 register bits */
 
 #define FLASH_WMS		0x80000000
 #define FLASH_SUSP		0x40000000
-#define FLASH_WPG   	0x20000000
+#define FLASH_WPG		0x20000000
 #define FLASH_DWPG		0x10000000
 #define FLASH_SER		0x08000000
 #define FLASH_SPR		0x01000000
@@ -76,7 +76,7 @@
 #define FLASH_BSYA1		0x00000004
 #define FLASH_BSYA0		0x00000002
 
-/* FLASH_CR1 regsiter bits */
+/* FLASH_CR1 register bits */
 
 #define FLASH_B1S		0x02000000
 #define FLASH_B0S		0x01000000



From kc8apf at mail.berlios.de  Mon May 18 06:40:14 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 06:40:14 +0200
Subject: [Openocd-svn] r1803 - trunk/doc
Message-ID: <200905180440.n4I4eE2X021797@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 06:40:11 +0200 (Mon, 18 May 2009)
New Revision: 1803

Modified:
   trunk/doc/openocd.texi
Log:
ETM/ETB documentation from David Brownell <david-b at pacbell.net>

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-18 04:37:33 UTC (rev 1802)
+++ trunk/doc/openocd.texi	2009-05-18 04:40:11 UTC (rev 1803)
@@ -1014,6 +1014,7 @@
 @item @b{cpu}
 @item @b{flash}
 @item @b{bs}
+ at item @b{etb}
 @item @b{jrc}
 @item @b{unknownN} - it happens :-(
 @end itemize
@@ -1048,6 +1049,27 @@
 
 If present, the MMU, the MPU and the CACHE should be disabled.
 
+Some ARM cores are equipped with trace support, which permits
+examination of the instruction and data bus activity.  Trace
+activity is controlled through an ``Embedded Trace Module'' (ETM)
+on one of the core's scan chains.  The ETM emits voluminous data
+through a ``trace port''.  The trace port is accessed in one
+of two ways.  When its signals are pinned out from the chip,
+boards may provide a special high speed debugging connector;
+software support for this is not configured by default, use
+the ``--enable-oocd_trace'' option.  Alternatively, trace data
+may be stored an on-chip SRAM which is packaged as an ``Embedded
+Trace Buffer'' (ETB).  An ETB has its own TAP, usually right after
+its associated ARM core.  OpenOCD supports the ETM, and your
+target configuration should set it up with the relevant trace
+port:  ``etb'' for chips which use that, else the board-specific
+option will be either ``oocd_trace'' or ``dummy''.
+
+ at example
+etm config $_TARGETNAME 16 normal full etb
+etb config $_TARGETNAME $_CHIPNAME.etb
+ at end example
+
 @subsection Internal Flash Configuration
 
 This applies @b{ONLY TO MICROCONTROLLERS} that have flash built in.
@@ -1640,6 +1662,7 @@
 @item @b{cpu} - the main CPU of the chip, alternatively @b{foo.arm} and @b{foo.dsp}
 @item @b{flash} - if the chip has a flash tap, example: str912.flash
 @item @b{bs} - for boundary scan if this is a seperate tap.
+ at item @b{etb} - for an embedded trace buffer (example: an ARM ETB11)
 @item @b{jrc} - for JTAG route controller (example: OMAP3530 found on Beagleboards)
 @item @b{unknownN} - where N is a number if you have no idea what the tap is for
 @item @b{Other names} - Freescale IMX31 has a SDMA (smart dma) with a JTAG tap, that tap should be called the ``sdma'' tap.



From kc8apf at mail.berlios.de  Mon May 18 06:44:36 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 06:44:36 +0200
Subject: [Openocd-svn] r1804 - in trunk: doc src/flash src/target
	src/target/target
Message-ID: <200905180444.n4I4iafQ025868@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 06:44:28 +0200 (Mon, 18 May 2009)
New Revision: 1804

Modified:
   trunk/doc/openocd.texi
   trunk/src/flash/ecos.c
   trunk/src/flash/flash.c
   trunk/src/flash/lpc3180_nand_controller.c
   trunk/src/flash/mflash.c
   trunk/src/flash/orion_nand.c
   trunk/src/flash/s3c24xx_nand.c
   trunk/src/target/etb.c
   trunk/src/target/etm.c
   trunk/src/target/etm_dummy.c
   trunk/src/target/image.c
   trunk/src/target/target.c
   trunk/src/target/target.h
   trunk/src/target/target/ti_dm355.cfg
   trunk/src/target/xscale.c
Log:
Consolidate target selection code into single get_target() that handles both names and numbers.  Provided by David Brownell <david-b at pacbell.net>

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/doc/openocd.texi	2009-05-18 04:44:28 UTC (rev 1804)
@@ -881,6 +881,8 @@
 At no time should the name ``target0'' (the default target name if
 none was specified) be used. The name ``target0'' is a hard coded name
 - the next target on the board will be some other number.
+In the same way, avoid using target numbers even when they are
+permitted; use the right target name(s) for your board.
 
 The user (or board file) should reasonably be able to:
 
@@ -1702,7 +1704,8 @@
 @item @b{Note: Deprecated} - Index Numbers
 @* Prior to 28/nov/2008, JTAG taps where numbered from 0..N this
 feature is still present, however its use is highly discouraged and
-should not be counted upon.
+should not be counted upon.  Update all of your scripts to use
+TAP names rather than numbers.
 @item @b{Multiple chips}
 @* If your board has multiple chips, you should be
 able to @b{source} two configuration files, in the proper order, and
@@ -2045,8 +2048,8 @@
 @itemize @bullet
 @item @b{NAME}
 @* Is the name of the debug target. By convention it should be the tap
-DOTTED.NAME, this name is also used to create the target object
-command.
+DOTTED.NAME.  This name is also used to create the target object
+command, and in other places the target needs to be identified.
 @item @b{TYPE}
 @* Specifies the target type, i.e.: ARM7TDMI, or Cortex-M3. Currently supported targets are:
 @comment START types
@@ -2254,7 +2257,7 @@
 
 @example
 @b{flash bank} <@var{driver}> <@var{base}> <@var{size}> <@var{chip_width}>
-<@var{bus_width}> <@var{target#}> [@var{driver_options ...}]
+<@var{bus_width}> <@var{target}> [@var{driver_options ...}]
 @end example
 @cindex flash bank
 @*Configures a flash bank at <@var{base}> of <@var{size}> bytes and <@var{chip_width}>
@@ -2274,8 +2277,9 @@
 on the flash chip.
 
 @b{flash bank cfi} <@var{base}> <@var{size}> <@var{chip_width}> <@var{bus_width}>
-<@var{target#}> [@var{jedec_probe}|@var{x16_as_x8}]
-@*CFI flashes require the number of the target they're connected to as an additional
+<@var{target}> [@var{jedec_probe}|@var{x16_as_x8}]
+@*CFI flashes require the name or number of the target they're connected to
+as an additional
 argument. The CFI driver makes use of a working area (specified for the target)
 to significantly speed up operation. 
 
@@ -2289,12 +2293,13 @@
 @subsubsection lpc2000 options
 @cindex lpc2000 options
 
- at b{flash bank lpc2000} <@var{base}> <@var{size}> 0 0 <@var{target#}> <@var{variant}>
+ at b{flash bank lpc2000} <@var{base}> <@var{size}> 0 0 <@var{target}> <@var{variant}>
 <@var{clock}> [@var{calc_checksum}]
 @*LPC flashes don't require the chip and bus width to be specified. Additional
 parameters are the <@var{variant}>, which may be @var{lpc2000_v1} (older LPC21xx and LPC22xx)
-or @var{lpc2000_v2} (LPC213x, LPC214x, LPC210[123], LPC23xx and LPC24xx), the number
-of the target this flash belongs to (first is 0), the frequency at which the core
+or @var{lpc2000_v2} (LPC213x, LPC214x, LPC210[123], LPC23xx and LPC24xx),
+the name or number of the target this flash belongs to (first is 0),
+the frequency at which the core
 is currently running (in kHz - must be an integral number), and the optional keyword
 @var{calc_checksum}, telling the driver to calculate a valid checksum for the exception
 vector table. 
@@ -2303,20 +2308,20 @@
 @subsubsection at91sam7 options
 @cindex at91sam7 options
 
- at b{flash bank at91sam7} 0 0 0 0 <@var{target#}>
-@*AT91SAM7 flashes only require the @var{target#}, all other values are looked up after
+ at b{flash bank at91sam7} 0 0 0 0 <@var{target}>
+@*AT91SAM7 flashes only require the @var{target}, all other values are looked up after
 reading the chip-id and type. 
 
 @subsubsection str7 options
 @cindex str7 options
 
- at b{flash bank str7x} <@var{base}> <@var{size}> 0 0 <@var{target#}> <@var{variant}>
+ at b{flash bank str7x} <@var{base}> <@var{size}> 0 0 <@var{target}> <@var{variant}>
 @*variant can be either STR71x, STR73x or STR75x. 
 
 @subsubsection str9 options
 @cindex str9 options
 
- at b{flash bank str9x} <@var{base}> <@var{size}> 0 0 <@var{target#}>
+ at b{flash bank str9x} <@var{base}> <@var{size}> 0 0 <@var{target}>
 @*The str9 needs the flash controller to be configured prior to Flash programming, e.g.
 @example
 str9x flash_config 0 4 2 0 0x80000
@@ -2325,7 +2330,7 @@
 
 @subsubsection str9 options (str9xpec driver)
 
- at b{flash bank str9xpec} <@var{base}> <@var{size}> 0 0 <@var{target#}>
+ at b{flash bank str9xpec} <@var{base}> <@var{size}> 0 0 <@var{target}>
 @*Before using the flash commands the turbo mode must be enabled using str9xpec
 @option{enable_turbo} <@var{num>.}
 
@@ -2335,25 +2340,25 @@
 @subsubsection Stellaris (LM3Sxxx) options
 @cindex Stellaris (LM3Sxxx) options
 
- at b{flash bank stellaris} <@var{base}> <@var{size}> 0 0 <@var{target#}>
-@*Stellaris flash plugin only require the @var{target#}. 
+ at b{flash bank stellaris} <@var{base}> <@var{size}> 0 0 <@var{target}>
+@*Stellaris flash plugin only require the @var{target}.
 
 @subsubsection stm32x options
 @cindex stm32x options
 
- at b{flash bank stm32x} <@var{base}> <@var{size}> 0 0 <@var{target#}>
-@*stm32x flash plugin only require the @var{target#}. 
+ at b{flash bank stm32x} <@var{base}> <@var{size}> 0 0 <@var{target}>
+@*stm32x flash plugin only require the @var{target}.
 
 @subsubsection aduc702x options
 @cindex aduc702x options
 
- at b{flash bank aduc702x} 0 0 0 0 <@var{target#}>
-@*The aduc702x flash plugin works with Analog Devices model numbers ADUC7019 through ADUC7028.  The setup command only requires the @var{target#} argument (all devices in this family have the same memory layout).
+ at b{flash bank aduc702x} 0 0 0 0 <@var{target}>
+@*The aduc702x flash plugin works with Analog Devices model numbers ADUC7019 through ADUC7028.  The setup command only requires the @var{target} argument (all devices in this family have the same memory layout).
 
 @subsection mFlash Configuration
 @cindex mFlash Configuration
 @b{mflash bank} <@var{soc}> <@var{base}> <@var{chip_width}> <@var{bus_width}>
-<@var{RST pin}> <@var{WP pin}> <@var{DPD pin}> <@var{target #}>
+<@var{RST pin}> <@var{WP pin}> <@var{DPD pin}> <@var{target}>
 @cindex mflash bank
 @*Configures a mflash for <@var{soc}> host bank at
 <@var{base}>. <@var{chip_width}> and <@var{bus_width}> are bytes

Modified: trunk/src/flash/ecos.c
===================================================================
--- trunk/src/flash/ecos.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/flash/ecos.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -164,10 +164,10 @@
 		bank->sectors[i].is_protected = 0;
 	}
 
-	info->target = get_target_by_num(strtoul(args[5], NULL, 0));
+	info->target = get_target(args[5]);
 	if (info->target == NULL)
 	{
-		LOG_ERROR("no target '%i' configured", (int)strtoul(args[5], NULL, 0));
+		LOG_ERROR("target '%s' not defined", args[5]);
 		return ERROR_FAIL;
 	}
 	return ERROR_OK;

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/flash/flash.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -261,9 +261,9 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	if ((target = get_target_by_num(strtoul(args[5], NULL, 0))) == NULL)
+	if ((target = get_target(args[5])) == NULL)
 	{
-		LOG_ERROR("target %lu not defined", strtoul(args[5], NULL, 0));
+		LOG_ERROR("target '%s' not defined", args[5]);
 		return ERROR_FAIL;
 	}
 

Modified: trunk/src/flash/lpc3180_nand_controller.c
===================================================================
--- trunk/src/flash/lpc3180_nand_controller.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/flash/lpc3180_nand_controller.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -71,10 +71,10 @@
 	lpc3180_info = malloc(sizeof(lpc3180_nand_controller_t));
 	device->controller_priv = lpc3180_info;
 
-	lpc3180_info->target = get_target_by_num(strtoul(args[1], NULL, 0));
+	lpc3180_info->target = get_target(args[1]);
 	if (!lpc3180_info->target)
 	{
-		LOG_ERROR("no target '%s' configured", args[1]);
+		LOG_ERROR("target '%s' not defined", args[1]);
 		return ERROR_NAND_DEVICE_INVALID;
 	}
 

Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/flash/mflash.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -795,9 +795,9 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	if ((target = get_target_by_num(strtoul(args[7], NULL, 0))) == NULL)
+	if ((target = get_target(args[7])) == NULL)
 	{
-		LOG_ERROR("target %lu not defined", strtoul(args[7], NULL, 0));
+		LOG_ERROR("target '%s' not defined", args[7]);
 		return ERROR_FAIL;
 	}
 

Modified: trunk/src/flash/orion_nand.c
===================================================================
--- trunk/src/flash/orion_nand.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/flash/orion_nand.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -210,9 +210,9 @@
 	}
 
 	device->controller_priv = hw;
-	hw->target = get_target_by_num(strtoul(args[1], NULL, 0));
+	hw->target = get_target(args[1]);
 	if (!hw->target) {
-		LOG_ERROR("no target '%s' configured", args[1]);
+		LOG_ERROR("target '%s' not defined", args[1]);
 		free(hw);
 		return ERROR_NAND_DEVICE_INVALID;
 	}

Modified: trunk/src/flash/s3c24xx_nand.c
===================================================================
--- trunk/src/flash/s3c24xx_nand.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/flash/s3c24xx_nand.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -46,12 +46,12 @@
 
 	device->controller_priv = s3c24xx_info;
 
-	s3c24xx_info->target = get_target_by_num(strtoul(args[1], NULL, 0));
+	s3c24xx_info->target = get_target(args[1]);
 	if (s3c24xx_info->target == NULL) {
-		LOG_ERROR("no target '%s' configured", args[1]);
+		LOG_ERROR("target '%s' not defined", args[1]);
 		return NULL;
 	}
-		
+
 	return s3c24xx_info;
 }
 

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/target/etb.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -372,11 +372,11 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	target = get_target_by_num(strtoul(args[0], NULL, 0));
+	target = get_target(args[0]);
 
 	if (!target)
 	{
-		LOG_ERROR("target number '%s' not defined", args[0]);
+		LOG_ERROR("target '%s' not defined", args[0]);
 		return ERROR_FAIL;
 	}
 

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/target/etm.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -1205,11 +1205,10 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	target = get_target_by_num(strtoul(args[0], NULL, 0));
-
+	target = get_target(args[0]);
 	if (!target)
 	{
-		LOG_ERROR("target number '%s' not defined", args[0]);
+		LOG_ERROR("target '%s' not defined", args[0]);
 		return ERROR_FAIL;
 	}
 

Modified: trunk/src/target/etm_dummy.c
===================================================================
--- trunk/src/target/etm_dummy.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/target/etm_dummy.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -31,11 +31,11 @@
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
 
-	target = get_target_by_num(strtoul(args[0], NULL, 0));
+	target = get_target(args[0]);
 
 	if (!target)
 	{
-		LOG_ERROR("target number '%s' not defined", args[0]);
+		LOG_ERROR("target '%s' not defined", args[0]);
 		return ERROR_FAIL;
 	}
 

Modified: trunk/src/target/image.c
===================================================================
--- trunk/src/target/image.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/target/image.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -711,10 +711,11 @@
 	}
 	else if (image->type == IMAGE_MEMORY)
 	{
-		target_t *target = get_target_by_num(strtoul(url, NULL, 0));
-		if (target==NULL)
+		target_t *target = get_target(url);
+
+		if (target == NULL)
 		{
-			LOG_ERROR("Target '%s' does not exist", url);
+			LOG_ERROR("target '%s' not defined", url);
 			return ERROR_FAIL;
 		}
 

Modified: trunk/src/target/target/ti_dm355.cfg
===================================================================
--- trunk/src/target/target/ti_dm355.cfg	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/target/target/ti_dm355.cfg	2009-05-18 04:44:28 UTC (rev 1804)
@@ -56,8 +56,5 @@
 arm7_9 dcc_downloads enable
 
 # trace setup
-# FIXME we ought to be able to say "... config $_TARGETNAME ..."
-# (not "config 0") facilitating additional targets (e.g. other chips)
-etm config 0 16 normal full etb
-etb config 0 $_CHIPNAME.etb
-
+etm config $_TARGETNAME 16 normal full etb
+etb config $_TARGETNAME $_CHIPNAME.etb

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/target/target.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -320,8 +320,36 @@
 	*buffer = value;
 }
 
+/* return a pointer to a configured target; id is name or number */
+target_t *get_target(const char *id)
+{
+	target_t *target;
+	char *endptr;
+	int num;
+
+	/* try as tcltarget name */
+	for (target = all_targets; target; target = target->next) {
+		if (target->cmd_name == NULL)
+			continue;
+		if (strcmp(id, target->cmd_name) == 0)
+			return target;
+	}
+
+	/* no match, try as number */
+	num = strtoul(id, &endptr, 0);
+	if (*endptr != 0)
+		return NULL;
+
+	for (target = all_targets; target; target = target->next) {
+		if (target->target_number == num)
+			return target;
+	}
+
+	return NULL;
+}
+
 /* returns a pointer to the n-th configured target */
-target_t* get_target_by_num(int num)
+static target_t *get_target_by_num(int num)
 {
 	target_t *target = all_targets;
 
@@ -1333,35 +1361,16 @@
 
 static int handle_targets_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
-	char *cp;
 	target_t *target = all_targets;
 
 	if (argc == 1)
 	{
-		/* try as tcltarget name */
-		for( target = all_targets ; target ; target = target->next ){
-		  if( target->cmd_name ){
-			if( 0 == strcmp( args[0], target->cmd_name ) ){
-				/* MATCH */
-				goto Match;
-			}
-		  }
-		}
-		/* no match, try as number */
-
-		int num = strtoul(args[0], &cp, 0 );
-		if( *cp != 0 ){
-			/* then it was not a number */
-			command_print( cmd_ctx, "Target: %s unknown, try one of:\n", args[0] );
+		target = get_target(args[0]);
+		if (target == NULL) {
+			command_print(cmd_ctx,"Target: %s is unknown, try one of:\n", args[0] );
 			goto DumpTargets;
 		}
 
-		target = get_target_by_num( num );
-		if( target == NULL ){
-			command_print(cmd_ctx,"Target: %s is unknown, try one of:\n", args[0] );
-			goto DumpTargets;
-		}
-	Match:
 		cmd_ctx->current_target = target->target_number;
 		return ERROR_OK;
 	}

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/target/target.h	2009-05-18 04:44:28 UTC (rev 1804)
@@ -371,7 +371,7 @@
 
 extern target_t* get_current_target(struct command_context_s *cmd_ctx);
 extern int get_num_by_target(target_t *query_target);
-extern target_t* get_target_by_num(int num);
+extern target_t *get_target(const char *id);
 
 extern int target_write_buffer(struct target_s *target, u32 address, u32 size, u8 *buffer);
 extern int target_read_buffer(struct target_s *target, u32 address, u32 size, u8 *buffer);

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-18 04:40:11 UTC (rev 1803)
+++ trunk/src/target/xscale.c	2009-05-18 04:44:28 UTC (rev 1804)
@@ -3147,9 +3147,9 @@
 		return ERROR_OK;
 	}
 
-	if ((target = get_target_by_num(strtoul(args[0], NULL, 0))) == NULL)
+	if ((target = get_target(args[0])) == NULL)
 	{
-		LOG_ERROR("no target '%s' configured", args[0]);
+		LOG_ERROR("target '%s' not defined", args[0]);
 		return ERROR_FAIL;
 	}
 
@@ -3187,9 +3187,10 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	if ((target = get_target_by_num(strtoul(args[0], NULL, 0))) == NULL)
+	target = get_target(args[0]);
+	if (target == NULL)
 	{
-		LOG_ERROR("no target '%s' configured", args[0]);
+		LOG_ERROR("target '%s' not defined", args[0]);
 		return ERROR_FAIL;
 	}
 



From kc8apf at mail.berlios.de  Mon May 18 06:45:43 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 06:45:43 +0200
Subject: [Openocd-svn] r1805 - trunk/src/target
Message-ID: <200905180445.n4I4jhLZ027163@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 06:45:42 +0200 (Mon, 18 May 2009)
New Revision: 1805

Modified:
   trunk/src/target/arm7_9_common.c
Log:
Fix logically inverted comment

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-18 04:44:28 UTC (rev 1804)
+++ trunk/src/target/arm7_9_common.c	2009-05-18 04:45:42 UTC (rev 1805)
@@ -2591,7 +2591,7 @@
 	register_command(cmd_ctx, arm7_9_cmd, "dbgrq", handle_arm7_9_dbgrq_command,
 		COMMAND_ANY, "use EmbeddedICE dbgrq instead of breakpoint for target halt requests <enable|disable>");
 	register_command(cmd_ctx, arm7_9_cmd, "fast_memory_access", handle_arm7_9_fast_memory_access_command,
-		 COMMAND_ANY, "use fast memory accesses instead of slower but potentially unsafe slow accesses <enable|disable>");
+		 COMMAND_ANY, "use fast memory accesses instead of slower but potentially safer accesses <enable|disable>");
 	register_command(cmd_ctx, arm7_9_cmd, "dcc_downloads", handle_arm7_9_dcc_downloads_command,
 		COMMAND_ANY, "use DCC downloads for larger memory writes <enable|disable>");
 



From kc8apf at mail.berlios.de  Mon May 18 06:47:07 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 06:47:07 +0200
Subject: [Openocd-svn] r1806 - trunk/doc
Message-ID: <200905180447.n4I4l7PB027683@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 06:47:06 +0200 (Mon, 18 May 2009)
New Revision: 1806

Modified:
   trunk/doc/openocd.texi
Log:
Relocate documentation on working area to better align with use of new syntax.  Provided by David Brownell <david-b at pacbell.net>

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-18 04:45:42 UTC (rev 1805)
+++ trunk/doc/openocd.texi	2009-05-18 04:47:06 UTC (rev 1806)
@@ -2082,13 +2082,23 @@
 @section Target Config/Cget Options
 These options can be specified when the target is created, or later
 via the configure option or to query the target via cget.
+
+You should specify a working area if you can; typically it uses some
+on-chip SRAM.  Such a working area can speed up many things, including bulk
+writes to target memory; flash operations like checking to see if memory needs
+to be erased; GDB memory checksumming; and may help perform otherwise
+unavailable operations (like some coprocessor operations on ARM7/9 systems).
 @itemize @bullet
 @item @b{-type} - returns the target type
 @item @b{-event NAME BODY} see Target events
- at item @b{-work-area-virt [ADDRESS]} specify/set the work area
- at item @b{-work-area-phys [ADDRESS]} specify/set the work area
+ at item @b{-work-area-virt [ADDRESS]} specify/set the work area base address
+which will be used when an MMU is active.
+ at item @b{-work-area-phys [ADDRESS]} specify/set the work area base address
+which will be used when an MMU is inactive.
 @item @b{-work-area-size [ADDRESS]} specify/set the work area
- at item @b{-work-area-backup [0|1]} does the work area get backed up
+ at item @b{-work-area-backup [0|1]} does the work area get backed up;
+by default, it doesn't.  When possible, use a working_area that doesn't
+need to be backed up, since performing a backup slows down operations.
 @item @b{-endian  [big|little]} 
 @item @b{-variant [NAME]} some chips have variants OpenOCD needs to know about
 @item @b{-chain-position DOTTED.NAME} the tap name this target refers to.
@@ -2144,15 +2154,6 @@
 @end example
 @* The target# is a the 0 based target numerical index.
 
-This command specifies a working area for the debugger to use. This
-may be used to speed-up downloads to target memory and flash
-operations, or to perform otherwise unavailable operations (some
-coprocessor operations on ARM7/9 systems, for example). The last
-parameter decides whether the memory should be preserved
-(<@var{backup}>) or can simply be overwritten (<@var{nobackup}>). If
-possible, use a working_area that doesn't need to be backed up, as
-performing a backup slows down operation.
-
 @node Flash Configuration
 @chapter Flash programming
 @cindex Flash Configuration
@@ -2810,7 +2811,7 @@
 @*Enable the use of the debug communications channel (DCC) to write larger (>128 byte)
 amounts of memory. DCC downloads offer a huge speed increase, but might be potentially
 unsafe, especially with targets running at very low speeds. This command was introduced
-with OpenOCD rev. 60. 
+with OpenOCD rev. 60, and requires a few bytes of working area.
 @end itemize
 
 @subsection ARM720T specific commands



From oharboe at mail.berlios.de  Mon May 18 09:02:15 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 18 May 2009 09:02:15 +0200
Subject: [Openocd-svn] r1807 - trunk/src/target
Message-ID: <200905180702.n4I72FI5022191@sheep.berlios.de>

Author: oharboe
Date: 2009-05-18 09:02:12 +0200 (Mon, 18 May 2009)
New Revision: 1807

Modified:
   trunk/src/target/arm11.c
   trunk/src/target/arm11.h
   trunk/src/target/arm11_dbgtap.c
Log:
Michael Bruck <mbruck at digenius.de> ARM11 cleanup stale dependencies with generic arm code; added comments and whitespace fixes

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-18 04:47:06 UTC (rev 1806)
+++ trunk/src/target/arm11.c	2009-05-18 07:02:12 UTC (rev 1807)
@@ -1,5 +1,6 @@
 /***************************************************************************
  *   Copyright (C) 2008 digenius technology GmbH.                          *
+ *   Michael Bruck                                                         *
  *                                                                         *
  *   Copyright (C) 2008 Oyvind Harboe oyvind.harboe at zylin.com              *
  *                                                                         *
@@ -336,7 +337,9 @@
 		if (*dscr & ARM11_DSCR_CORE_HALTED)
 		{
 			/** \todo TODO: this needs further scrutiny because
-			  * arm11_on_enter_debug_state() never gets properly called
+			  * arm11_on_enter_debug_state() never gets properly called.
+			  * As a result we don't read the actual register states from
+			  * the target.
 			  */
 
 			arm11->target->state	= TARGET_HALTED;
@@ -389,8 +392,8 @@
 		scan_field_t	chain5_fields[3];
 
 		arm11_setup_field(arm11, 32, NULL, &R(WDTR),	chain5_fields + 0);
-		arm11_setup_field(arm11,  1, NULL, NULL,	chain5_fields + 1);
-		arm11_setup_field(arm11,  1, NULL, NULL,	chain5_fields + 2);
+		arm11_setup_field(arm11,  1, NULL, NULL,		chain5_fields + 1);
+		arm11_setup_field(arm11,  1, NULL, NULL,		chain5_fields + 2);
 
 		arm11_add_dr_scan_vc(asizeof(chain5_fields), chain5_fields, TAP_DRPAUSE);
 	}
@@ -679,7 +682,7 @@
 			enum target_state old_state = target->state;
 
 			LOG_DEBUG("enter TARGET_HALTED");
-			target->state		= TARGET_HALTED;
+			target->state			= TARGET_HALTED;
 			target->debug_reason	= arm11_get_DSCR_debug_reason(dscr);
 			arm11_on_enter_debug_state(arm11);
 
@@ -692,7 +695,7 @@
 		if (target->state != TARGET_RUNNING && target->state != TARGET_DEBUG_RUNNING)
 		{
 			LOG_DEBUG("enter TARGET_RUNNING");
-			target->state		= TARGET_RUNNING;
+			target->state			= TARGET_RUNNING;
 			target->debug_reason	= DBG_REASON_NOTHALTED;
 		}
 	}
@@ -1369,7 +1372,6 @@
 			int timeout_ms, void *arch_info)
 {
 		arm11_common_t *arm11 = target->arch_info;
-	armv4_5_algorithm_t *arm11_algorithm_info = arch_info;
 //	enum armv4_5_state core_state = arm11->core_state;
 //	enum armv4_5_mode core_mode = arm11->core_mode;
 	u32 context[16];
@@ -1378,11 +1380,6 @@
 	int retval = ERROR_OK;
 		LOG_DEBUG("Running algorithm");
 
-	if (arm11_algorithm_info->common_magic != ARMV4_5_COMMON_MAGIC)
-	{
-		LOG_ERROR("current target isn't an ARMV4/5 target");
-		return ERROR_TARGET_INVALID;
-	}
 
 	if (target->state != TARGET_HALTED)
 	{
@@ -1441,6 +1438,12 @@
 		exit(-1);
 	}
 */
+
+
+/* arm11 at this point only supports ARM not THUMB mode
+   however if this test needs to be reactivated the current state can be read back
+   from CPSR */
+#if 0
 	if (arm11_algorithm_info->core_mode != ARMV4_5_MODE_ANY)
 	{
 		LOG_DEBUG("setting core_mode: 0x%2.2x", arm11_algorithm_info->core_mode);
@@ -1448,6 +1451,7 @@
 		arm11->reg_list[ARM11_RC_CPSR].dirty = 1;
 		arm11->reg_list[ARM11_RC_CPSR].valid = 1;
 	}
+#endif
 
 	if ((retval = breakpoint_add(target, exit_point, exit_breakpoint_size, BKPT_HARD)) != ERROR_OK)
 	{
@@ -1535,12 +1539,6 @@
 
 	arm11->target = target;
 
-	/* prepare JTAG information for the new target */
-	arm11->jtag_info.tap	= target->tap;
-	arm11->jtag_info.scann_size	= 5;
-
-	CHECK_RETVAL(arm_jtag_setup_connection(&arm11->jtag_info));
-
 	if (target->tap==NULL)
 		return ERROR_FAIL;
 
@@ -1956,7 +1954,7 @@
 
 		RC_FINAL_BOOL(	"error_fatal",			"Terminate program if transfer error was found (default: enabled)",
 						memwrite_error_fatal)
-	)
+	) /* memwrite */
 
 	RC_FINAL_BOOL(		"no_increment",			"Don't increment address on multi-read/-write (default: disabled)",
 						memrw_no_increment)
@@ -1972,7 +1970,7 @@
 
 	RC_FINAL(			"mcr",					"Write Coprocessor register",
 						arm11_handle_mcr)
-	)
+	) /* arm11 */
 
 	return ERROR_OK;
 }

Modified: trunk/src/target/arm11.h
===================================================================
--- trunk/src/target/arm11.h	2009-05-18 04:47:06 UTC (rev 1806)
+++ trunk/src/target/arm11.h	2009-05-18 07:02:12 UTC (rev 1807)
@@ -1,5 +1,6 @@
 /***************************************************************************
  *   Copyright (C) 2008 digenius technology GmbH.                          *
+ *   Michael Bruck                                                         *
  *                                                                         *
  *   Copyright (C) 2008 Georg Acher <acher at in.tum.de>                      *
  *                                                                         *
@@ -22,7 +23,9 @@
 #ifndef ARM11_H
 #define ARM11_H
 
-#include "embeddedice.h"
+#include "target.h"
+#include "register.h"
+#include "jtag.h"
 
 #define asizeof(x)	(sizeof(x) / sizeof((x)[0]))
 
@@ -78,8 +81,6 @@
 {
 	target_t *	target;		/**< Reference back to the owner */
 
-	arm_jtag_t	jtag_info;	/**< Handler to access assigned JTAG device */
-
 	/** \name Processor type detection */
 	/*@{*/
 

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2009-05-18 04:47:06 UTC (rev 1806)
+++ trunk/src/target/arm11_dbgtap.c	2009-05-18 07:02:12 UTC (rev 1807)
@@ -1,5 +1,6 @@
 /***************************************************************************
  *   Copyright (C) 2008 digenius technology GmbH.                          *
+ *   Michael Bruck                                                         *
  *                                                                         *
  *   Copyright (C) 2008 Oyvind Harboe oyvind.harboe at zylin.com              *
  *                                                                         *
@@ -81,7 +82,7 @@
  */
 void arm11_setup_field(arm11_common_t * arm11, int num_bits, void * out_data, void * in_data, scan_field_t * field)
 {
-	field->tap   			= arm11->jtag_info.tap;
+	field->tap   			= arm11->target->tap;
 	field->num_bits			= num_bits;
 	field->out_value		= out_data;
 	field->in_value			= in_data;
@@ -99,7 +100,7 @@
 void arm11_add_IR(arm11_common_t * arm11, u8 instr, tap_state_t state)
 {
 	jtag_tap_t *tap;
-	tap = arm11->jtag_info.tap;
+	tap = arm11->target->tap;
 
 	if (buf_get_u32(tap->cur_instr, 0, 5) == instr)
 	{
@@ -211,7 +212,8 @@
  * same as CP14 c1
  *
  * \param arm11		Target state variable.
- * \return			DSCR content
+ * \param value		DSCR content
+ * \return			Error status
  *
  * \remarks			This is a stand-alone function that executes the JTAG command queue.
  */



From ntfreak at mail.berlios.de  Mon May 18 09:04:59 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Mon, 18 May 2009 09:04:59 +0200
Subject: [Openocd-svn] r1808 - in trunk/src/target: board interface
Message-ID: <200905180704.n4I74xKm022363@sheep.berlios.de>

Author: ntfreak
Date: 2009-05-18 09:04:58 +0200 (Mon, 18 May 2009)
New Revision: 1808

Modified:
   trunk/src/target/board/crossbow_tech_imote2.cfg
   trunk/src/target/board/digi_connectcore_wi-9c.cfg
   trunk/src/target/board/hitex_stm32-performancestick.cfg
   trunk/src/target/board/hitex_str9-comstick.cfg
   trunk/src/target/board/linksys_nslu2.cfg
   trunk/src/target/board/pxa255_sst.cfg
   trunk/src/target/board/str910-eval.cfg
   trunk/src/target/board/zy1000.cfg
   trunk/src/target/interface/hitex_str9-comstick.cfg
Log:
- add missing svn props from svn 1798 commit

Modified: trunk/src/target/board/crossbow_tech_imote2.cfg
===================================================================
--- trunk/src/target/board/crossbow_tech_imote2.cfg	2009-05-18 07:02:12 UTC (rev 1807)
+++ trunk/src/target/board/crossbow_tech_imote2.cfg	2009-05-18 07:04:58 UTC (rev 1808)
@@ -1,46 +1,46 @@
-# Crossbow Technology iMote2
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME imote2
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-  # force an error till we get a good number
-   set _CPUTAPID 0xffffffff
-}
-
-# PXA271 and an Intel Strataflash of 32 Megabytes (p30)
-# 
-# Marvell/Intel PXA270 Script
-# set jtag_nsrst_delay to the delay introduced by your reset circuit
-# the rest of the needed delays are built into the openocd program
-jtag_nsrst_delay 800 
-# set the jtag_ntrst_delay to the delay introduced by a reset circuit
-# the rest of the needed delays are built into the openocd program
-jtag_ntrst_delay 0
-#use combined on interfaces or targets that can't set TRST/SRST separately
-reset_config trst_and_srst separate
-#jtag scan chain
-
-jtag newtap $_CHIPNAME cpu -irlen 7 -ircapture 0x1 -irmask 0x7f -expected-id $_CPUTAPID
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME xscale -endian $_ENDIAN -chain-position $_TARGETNAME -variant pxa27x
-$_TARGETNAME configure -work-area-virt 0x0x5c000000 -work-area-phys 0x0x5c000000 -work-area-size 0x10000 -work-area-backup 1
-# maps to PXA internal RAM. If you are using a PXA255
-# you must initialize SDRAM or leave this option off
-
-
-#flash bank <driver> <base> <size> <chip_width> <bus_width>
-# works for P30 flash
-flash bank cfi 0x00000000 0x2000000 2 2 0
+# Crossbow Technology iMote2
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME imote2
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+  # force an error till we get a good number
+   set _CPUTAPID 0xffffffff
+}
+
+# PXA271 and an Intel Strataflash of 32 Megabytes (p30)
+# 
+# Marvell/Intel PXA270 Script
+# set jtag_nsrst_delay to the delay introduced by your reset circuit
+# the rest of the needed delays are built into the openocd program
+jtag_nsrst_delay 800 
+# set the jtag_ntrst_delay to the delay introduced by a reset circuit
+# the rest of the needed delays are built into the openocd program
+jtag_ntrst_delay 0
+#use combined on interfaces or targets that can't set TRST/SRST separately
+reset_config trst_and_srst separate
+#jtag scan chain
+
+jtag newtap $_CHIPNAME cpu -irlen 7 -ircapture 0x1 -irmask 0x7f -expected-id $_CPUTAPID
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME xscale -endian $_ENDIAN -chain-position $_TARGETNAME -variant pxa27x
+$_TARGETNAME configure -work-area-virt 0x0x5c000000 -work-area-phys 0x0x5c000000 -work-area-size 0x10000 -work-area-backup 1
+# maps to PXA internal RAM. If you are using a PXA255
+# you must initialize SDRAM or leave this option off
+
+
+#flash bank <driver> <base> <size> <chip_width> <bus_width>
+# works for P30 flash
+flash bank cfi 0x00000000 0x2000000 2 2 0


Property changes on: trunk/src/target/board/crossbow_tech_imote2.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/board/digi_connectcore_wi-9c.cfg
===================================================================
--- trunk/src/target/board/digi_connectcore_wi-9c.cfg	2009-05-18 07:02:12 UTC (rev 1807)
+++ trunk/src/target/board/digi_connectcore_wi-9c.cfg	2009-05-18 07:04:58 UTC (rev 1808)
@@ -1,127 +1,127 @@
-######################################
-# Target: DIGI ConnectCore Wi-9C
-######################################
-
-reset_config trst_and_srst
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME ns9360
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-  # This config file was defaulting to big endian..
-   set  _ENDIAN big
-}
-
-
-# What's a good fallback frequency for this board if RCLK is
-# not available??
-jtag_rclk 1000
-
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-   set _CPUTAPID 0xFFFFFFFF
-}
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-jtag_nsrst_delay 200
-jtag_ntrst_delay 0
-
-
-######################
-# Target configuration
-######################
-
-target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm926ejs
-$_TARGETNAME configure -event reset-init {
-	mww 0x90600104 0x33313333
-	mww 0xA0700000 0x00000001  # Enable the memory controller.
-	mww 0xA0700024 0x00000006  # Set the refresh counter 6
-	mww 0xA0700028 0x00000001  # 
-	mww 0xA0700030 0x00000001  # Set the precharge period
-	mww 0xA0700034 0x00000004  # Active to precharge command period is 16 clock cycles
-	mww 0xA070003C 0x00000001  # tAPR
-	mww 0xA0700040 0x00000005  # tDAL
-	mww 0xA0700044 0x00000001  # tWR
-	mww 0xA0700048 0x00000006  # tRC 32 clock cycles  
-	mww 0xA070004C 0x00000006  # tRFC 32 clock cycles
-	mww 0xA0700054 0x00000001  # tRRD
-	mww 0xA0700058 0x00000001  # tMRD
-	mww 0xA0700100 0x00004280  # Dynamic Config 0 (cs4) 
-	mww 0xA0700120 0x00004280  # Dynamic Config 1 (cs5)
-	mww 0xA0700140 0x00004280  # Dynamic Config 2 (cs6)
-	mww 0xA0700160 0x00004280  # Dynamic Config 3 (cs7)
-	#
-	mww 0xA0700104 0x00000203  # CAS latency is 2 at 100 MHz
-	mww 0xA0700124 0x00000203  # CAS latency is 2 at 100 MHz
-	mww 0xA0700144 0x00000203  # CAS latency is 2 at 100 MHz
-	mww 0xA0700164 0x00000203  # CAS latency is 2 at 100 MHz
-	#
-	mww 0xA0700020 0x00000103  # issue SDRAM PALL command
-	#
-	mww 0xA0700024 0x00000001  # Set the refresh counter to be as small as possible
-	#
-	# Add some dummy writes to give the SDRAM time to settle, it needs two
-	# AHB clock cycles, here we poke in the debugger flag, this lets
-	# the software know that we are in the debugger
-	mww 0xA0900000 0x00000002
-	mww 0xA0900000 0x00000002
-	mww 0xA0900000 0x00000002
-	mww 0xA0900000 0x00000002
-	mww 0xA0900000 0x00000002
-	#
-	mdw 0xA0900000 
-	mdw 0xA0900000 
-	mdw 0xA0900000 
-	mdw 0xA0900000 
-	mdw 0xA0900000 
-	#
-	mww 0xA0700024 0x00000030 # Set the refresh counter to 30
-	mww 0xA0700020 0x00000083 # Issue SDRAM MODE command
-	#
-	# Next we perform a read of RAM.
-	# mw = move word.
-	mdw 0x00022000
-	# mw 0x00022000:P, r3  # 22000 for cas2 latency, 32000 for cas 3
-	#
-	mww 0xA0700020 0x00000003   # issue SDRAM NORMAL command
-	mww 0xA0700100 0x00084280   # Enable buffer access
-	mww 0xA0700120 0x00084280   # Enable buffer access
-	mww 0xA0700140 0x00084280   # Enable buffer access
-	mww 0xA0700160 0x00084280   # Enable buffer access
-
-	#Set byte lane state (static mem 1)"
-	mww 0xA0700220, 0x00000082
-	#Flash Start
-	mww 0xA09001F8, 0x50000000
-	#Flash Mask Reg
-	mww 0xA09001FC, 0xFF000001
-	mww 0xA0700028, 0x00000001
-
-	#  RAMAddr = 0x00020000
-	#  RAMSize = 0x00004000
-
-	# Set the processor mode
-	reg cpsr 0xd3
-}
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00000000 -work-area-size 0x1000 -work-area-backup 1
-
-#####################
-# Flash configuration
-#####################
-
-#M29DW323DB - not working
-#flash bank cfi <base> <size> <chip width> <bus width> <target#>
-flash bank cfi 0x50000000 0x0400000 2 2 0
-
-
-
+######################################
+# Target: DIGI ConnectCore Wi-9C
+######################################
+
+reset_config trst_and_srst
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME ns9360
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+  # This config file was defaulting to big endian..
+   set  _ENDIAN big
+}
+
+
+# What's a good fallback frequency for this board if RCLK is
+# not available??
+jtag_rclk 1000
+
+
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+   set _CPUTAPID 0xFFFFFFFF
+}
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+jtag_nsrst_delay 200
+jtag_ntrst_delay 0
+
+
+######################
+# Target configuration
+######################
+
+target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm926ejs
+$_TARGETNAME configure -event reset-init {
+	mww 0x90600104 0x33313333
+	mww 0xA0700000 0x00000001  # Enable the memory controller.
+	mww 0xA0700024 0x00000006  # Set the refresh counter 6
+	mww 0xA0700028 0x00000001  # 
+	mww 0xA0700030 0x00000001  # Set the precharge period
+	mww 0xA0700034 0x00000004  # Active to precharge command period is 16 clock cycles
+	mww 0xA070003C 0x00000001  # tAPR
+	mww 0xA0700040 0x00000005  # tDAL
+	mww 0xA0700044 0x00000001  # tWR
+	mww 0xA0700048 0x00000006  # tRC 32 clock cycles  
+	mww 0xA070004C 0x00000006  # tRFC 32 clock cycles
+	mww 0xA0700054 0x00000001  # tRRD
+	mww 0xA0700058 0x00000001  # tMRD
+	mww 0xA0700100 0x00004280  # Dynamic Config 0 (cs4) 
+	mww 0xA0700120 0x00004280  # Dynamic Config 1 (cs5)
+	mww 0xA0700140 0x00004280  # Dynamic Config 2 (cs6)
+	mww 0xA0700160 0x00004280  # Dynamic Config 3 (cs7)
+	#
+	mww 0xA0700104 0x00000203  # CAS latency is 2 at 100 MHz
+	mww 0xA0700124 0x00000203  # CAS latency is 2 at 100 MHz
+	mww 0xA0700144 0x00000203  # CAS latency is 2 at 100 MHz
+	mww 0xA0700164 0x00000203  # CAS latency is 2 at 100 MHz
+	#
+	mww 0xA0700020 0x00000103  # issue SDRAM PALL command
+	#
+	mww 0xA0700024 0x00000001  # Set the refresh counter to be as small as possible
+	#
+	# Add some dummy writes to give the SDRAM time to settle, it needs two
+	# AHB clock cycles, here we poke in the debugger flag, this lets
+	# the software know that we are in the debugger
+	mww 0xA0900000 0x00000002
+	mww 0xA0900000 0x00000002
+	mww 0xA0900000 0x00000002
+	mww 0xA0900000 0x00000002
+	mww 0xA0900000 0x00000002
+	#
+	mdw 0xA0900000 
+	mdw 0xA0900000 
+	mdw 0xA0900000 
+	mdw 0xA0900000 
+	mdw 0xA0900000 
+	#
+	mww 0xA0700024 0x00000030 # Set the refresh counter to 30
+	mww 0xA0700020 0x00000083 # Issue SDRAM MODE command
+	#
+	# Next we perform a read of RAM.
+	# mw = move word.
+	mdw 0x00022000
+	# mw 0x00022000:P, r3  # 22000 for cas2 latency, 32000 for cas 3
+	#
+	mww 0xA0700020 0x00000003   # issue SDRAM NORMAL command
+	mww 0xA0700100 0x00084280   # Enable buffer access
+	mww 0xA0700120 0x00084280   # Enable buffer access
+	mww 0xA0700140 0x00084280   # Enable buffer access
+	mww 0xA0700160 0x00084280   # Enable buffer access
+
+	#Set byte lane state (static mem 1)"
+	mww 0xA0700220, 0x00000082
+	#Flash Start
+	mww 0xA09001F8, 0x50000000
+	#Flash Mask Reg
+	mww 0xA09001FC, 0xFF000001
+	mww 0xA0700028, 0x00000001
+
+	#  RAMAddr = 0x00020000
+	#  RAMSize = 0x00004000
+
+	# Set the processor mode
+	reg cpsr 0xd3
+}
+
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00000000 -work-area-size 0x1000 -work-area-backup 1
+
+#####################
+# Flash configuration
+#####################
+
+#M29DW323DB - not working
+#flash bank cfi <base> <size> <chip width> <bus width> <target#>
+flash bank cfi 0x50000000 0x0400000 2 2 0
+
+
+


Property changes on: trunk/src/target/board/digi_connectcore_wi-9c.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/board/hitex_stm32-performancestick.cfg
===================================================================
--- trunk/src/target/board/hitex_stm32-performancestick.cfg	2009-05-18 07:02:12 UTC (rev 1807)
+++ trunk/src/target/board/hitex_stm32-performancestick.cfg	2009-05-18 07:04:58 UTC (rev 1808)
@@ -1,50 +1,50 @@
-# Hitex stm32 performance stick
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME stm32_hitex
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
-# set jtag speed
-jtag_khz 500
-
-jtag_nsrst_delay 100
-jtag_ntrst_delay 100
-
-#use combined on interfaces or targets that can't set TRST/SRST separately
-reset_config trst_and_srst
-
-#jtag scan chain
-# The CPU
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-  # See STM Document RM0008
-  # Section 26.6.3
-   set _CPUTAPID 0x3ba00477
-}
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-# The boundery scan register, leave the "expected-id" undefined.
-jtag newtap $_CHIPNAME bs  -irlen 5 -ircapture 0x1 -irmask 0x1 
-
-# configure str750 connected to jtag chain
-jtag newtap $_CHIPNAME unknown -irlen 4 -ircapture 0x1 -irmask 0x0f
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME cortex_m3 -endian $_ENDIAN -chain-position $_TARGETNAME
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x20000000 -work-area-size 16384 -work-area-backup 0
-
-#
-flash bank stm32x 0 0 0 0 0
-
-# For more information about the configuration files, take a look at:
-# openocd.texi
+# Hitex stm32 performance stick
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME stm32_hitex
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+# set jtag speed
+jtag_khz 500
+
+jtag_nsrst_delay 100
+jtag_ntrst_delay 100
+
+#use combined on interfaces or targets that can't set TRST/SRST separately
+reset_config trst_and_srst
+
+#jtag scan chain
+# The CPU
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+  # See STM Document RM0008
+  # Section 26.6.3
+   set _CPUTAPID 0x3ba00477
+}
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+# The boundery scan register, leave the "expected-id" undefined.
+jtag newtap $_CHIPNAME bs  -irlen 5 -ircapture 0x1 -irmask 0x1 
+
+# configure str750 connected to jtag chain
+jtag newtap $_CHIPNAME unknown -irlen 4 -ircapture 0x1 -irmask 0x0f
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME cortex_m3 -endian $_ENDIAN -chain-position $_TARGETNAME
+
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x20000000 -work-area-size 16384 -work-area-backup 0
+
+#
+flash bank stm32x 0 0 0 0 0
+
+# For more information about the configuration files, take a look at:
+# openocd.texi


Property changes on: trunk/src/target/board/hitex_stm32-performancestick.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/board/hitex_str9-comstick.cfg
===================================================================
--- trunk/src/target/board/hitex_str9-comstick.cfg	2009-05-18 07:02:12 UTC (rev 1807)
+++ trunk/src/target/board/hitex_str9-comstick.cfg	2009-05-18 07:04:58 UTC (rev 1808)
@@ -1,72 +1,72 @@
-# Hitex STR9-comStick
-# http://www.hitex.com/index.php?id=383
-# This works for the STR9-comStick revisions STR912CS-A1 and STR912CS-A2.
-
-source [find interface/hitex_str9-comstick.cfg]
-
-# set jtag speed
-jtag_khz 3000
-
-jtag_nsrst_delay 100
-jtag_ntrst_delay 100
-#use combined on interfaces or targets that can't set TRST/SRST separately
-reset_config trst_and_srst
-#jtag scan chain
-#format L IRC IRCM IDCODE (Length, IR Capture, IR Capture Mask, IDCODE)
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME str912
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
-if { [info exists FLASHTAPID ] } {
-   set _FLASHTAPID $FLASHTAPID
-} else {
-   set _FLASHTAPID 0x04570041
-}
-jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 -expected-id $_FLASHTAPID
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-   set _CPUTAPID 0x25966041
-}
-jtag newtap $_CHIPNAME cpu   -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-if { [info exists BSTAPID ] } {
-   set _BSTAPID $BSTAPID
-} else {
-   # Found on STR9-comStick, revision STR912CS-A1
-   set _BSTAPID1 0x1457f041
-   # Found on STR9-comStick, revision STR912CS-A2
-   set _BSTAPID2 0x2457f041
-}
-jtag newtap $_CHIPNAME bs -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID1 -expected-id $_BSTAPID2
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm966e -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm966e
-
-$_TARGETNAME configure -event reset-init {
-	# We can increase speed now that we know the target is halted.
-	#jtag_rclk 3000
-	
-	# -- Enable 96K RAM
-	# PFQBC enabled / DTCM & AHB wait-states disabled
-	mww 0x5C002034 0x0191 
-
-	str9x flash_config 0 4 2 0 0x80000
-	flash protect 0 0 7 off
-}
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x50000000 -work-area-size 16384 -work-area-backup 0
-
-#flash bank <driver> <base> <size> <chip_width> <bus_width>
-flash bank str9x 0x00000000 0x00080000 0 0 0
-flash bank str9x 0x00080000 0x00008000 0 0 0
+# Hitex STR9-comStick
+# http://www.hitex.com/index.php?id=383
+# This works for the STR9-comStick revisions STR912CS-A1 and STR912CS-A2.
+
+source [find interface/hitex_str9-comstick.cfg]
+
+# set jtag speed
+jtag_khz 3000
+
+jtag_nsrst_delay 100
+jtag_ntrst_delay 100
+#use combined on interfaces or targets that can't set TRST/SRST separately
+reset_config trst_and_srst
+#jtag scan chain
+#format L IRC IRCM IDCODE (Length, IR Capture, IR Capture Mask, IDCODE)
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME str912
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+if { [info exists FLASHTAPID ] } {
+   set _FLASHTAPID $FLASHTAPID
+} else {
+   set _FLASHTAPID 0x04570041
+}
+jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 -expected-id $_FLASHTAPID
+
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+   set _CPUTAPID 0x25966041
+}
+jtag newtap $_CHIPNAME cpu   -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+if { [info exists BSTAPID ] } {
+   set _BSTAPID $BSTAPID
+} else {
+   # Found on STR9-comStick, revision STR912CS-A1
+   set _BSTAPID1 0x1457f041
+   # Found on STR9-comStick, revision STR912CS-A2
+   set _BSTAPID2 0x2457f041
+}
+jtag newtap $_CHIPNAME bs -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID1 -expected-id $_BSTAPID2
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME arm966e -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm966e
+
+$_TARGETNAME configure -event reset-init {
+	# We can increase speed now that we know the target is halted.
+	#jtag_rclk 3000
+	
+	# -- Enable 96K RAM
+	# PFQBC enabled / DTCM & AHB wait-states disabled
+	mww 0x5C002034 0x0191 
+
+	str9x flash_config 0 4 2 0 0x80000
+	flash protect 0 0 7 off
+}
+
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x50000000 -work-area-size 16384 -work-area-backup 0
+
+#flash bank <driver> <base> <size> <chip_width> <bus_width>
+flash bank str9x 0x00000000 0x00080000 0 0 0
+flash bank str9x 0x00080000 0x00008000 0 0 0


Property changes on: trunk/src/target/board/hitex_str9-comstick.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/board/linksys_nslu2.cfg
===================================================================
--- trunk/src/target/board/linksys_nslu2.cfg	2009-05-18 07:02:12 UTC (rev 1807)
+++ trunk/src/target/board/linksys_nslu2.cfg	2009-05-18 07:04:58 UTC (rev 1808)
@@ -1,8 +1,8 @@
-# This is for the LinkSys (CISCO) NSLU2 board
-# It is an Intel XSCALE IXP420 CPU.
-
-source [find target/ixp42x.cfg]
-# The _TARGETNAME is set by the above.
-
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00020000 -work-area-size 0x10000 -work-area-backup 0
-
+# This is for the LinkSys (CISCO) NSLU2 board
+# It is an Intel XSCALE IXP420 CPU.
+
+source [find target/ixp42x.cfg]
+# The _TARGETNAME is set by the above.
+
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00020000 -work-area-size 0x10000 -work-area-backup 0
+


Property changes on: trunk/src/target/board/linksys_nslu2.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/board/pxa255_sst.cfg
===================================================================
--- trunk/src/target/board/pxa255_sst.cfg	2009-05-18 07:02:12 UTC (rev 1807)
+++ trunk/src/target/board/pxa255_sst.cfg	2009-05-18 07:04:58 UTC (rev 1808)
@@ -1,15 +1,15 @@
-# A PXA255 test board with SST 39LF400A flash
-#
-# At reset the memory map is as follows. Note that
-# the memory map changes later on as the application 
-# starts...
-#
-# RAM at 0x4000000
-# Flash at 0x00000000
-#
-source [find target/pxa255.cfg]
-# Target name is set by above
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x4000000 -work-area-size 0x4000 -work-area-backup 0
-# flash bank <driver> <base> <size> <chip_width> <bus_width> <targetNum> [options]
-flash bank cfi 0x00000000 0x80000 2 2 0 jedec_probe
-
+# A PXA255 test board with SST 39LF400A flash
+#
+# At reset the memory map is as follows. Note that
+# the memory map changes later on as the application 
+# starts...
+#
+# RAM at 0x4000000
+# Flash at 0x00000000
+#
+source [find target/pxa255.cfg]
+# Target name is set by above
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x4000000 -work-area-size 0x4000 -work-area-backup 0
+# flash bank <driver> <base> <size> <chip_width> <bus_width> <targetNum> [options]
+flash bank cfi 0x00000000 0x80000 2 2 0 jedec_probe
+


Property changes on: trunk/src/target/board/pxa255_sst.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/board/str910-eval.cfg
===================================================================
--- trunk/src/target/board/str910-eval.cfg	2009-05-18 07:02:12 UTC (rev 1807)
+++ trunk/src/target/board/str910-eval.cfg	2009-05-18 07:04:58 UTC (rev 1808)
@@ -1,61 +1,61 @@
-# str910-eval eval board
-# 
-# Need reset scripts 
-reset_config trst_and_srst
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME str912
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
-if { [info exists FLASHTAPID ] } {
-   set _FLASHTAPID $FLASHTAPID
-} else {
-   set _FLASHTAPID 0x04570041
-}
-jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 -expected-id $_FLASHTAPID
-
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-   set _CPUTAPID 0x25966041
-}
-jtag newtap $_CHIPNAME cpu   -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-if { [info exists BSTAPID ] } {
-   set _BSTAPID $BSTAPID
-} else {
-   set _BSTAPID 0x1457f041
-}
-jtag newtap $_CHIPNAME bs    -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm966e -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm966e
-$_TARGETNAME configure -work-area-phys 0x50000000 -work-area-virt 0x50000000 -work-area-size 16384 -work-area-backup 1
-
-$_TARGETNAME configure -event reset-init {
-	# We can increase speed now that we know the target is halted.
-	#jtag_rclk 3000
-	
-	# -- Enable 96K RAM
-	# PFQBC enabled / DTCM & AHB wait-states disabled
-	mww 0x5C002034 0x0191 
-
-	str9x flash_config 0 4 2 0 0x80000
-	flash protect 0 0 7 off
-}
-
-#flash bank str9x <base> <size> 0 0 <target#> <variant>
-flash bank str9x 0x00000000 0x00080000 0 0 0
-flash bank str9x 0x00080000 0x00008000 0 0 0
-
-# For more information about the configuration files, take a look at:
-# openocd.texi
+# str910-eval eval board
+# 
+# Need reset scripts 
+reset_config trst_and_srst
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME str912
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+if { [info exists FLASHTAPID ] } {
+   set _FLASHTAPID $FLASHTAPID
+} else {
+   set _FLASHTAPID 0x04570041
+}
+jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 -expected-id $_FLASHTAPID
+
+
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+   set _CPUTAPID 0x25966041
+}
+jtag newtap $_CHIPNAME cpu   -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+if { [info exists BSTAPID ] } {
+   set _BSTAPID $BSTAPID
+} else {
+   set _BSTAPID 0x1457f041
+}
+jtag newtap $_CHIPNAME bs    -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME arm966e -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm966e
+$_TARGETNAME configure -work-area-phys 0x50000000 -work-area-virt 0x50000000 -work-area-size 16384 -work-area-backup 1
+
+$_TARGETNAME configure -event reset-init {
+	# We can increase speed now that we know the target is halted.
+	#jtag_rclk 3000
+	
+	# -- Enable 96K RAM
+	# PFQBC enabled / DTCM & AHB wait-states disabled
+	mww 0x5C002034 0x0191 
+
+	str9x flash_config 0 4 2 0 0x80000
+	flash protect 0 0 7 off
+}
+
+#flash bank str9x <base> <size> 0 0 <target#> <variant>
+flash bank str9x 0x00000000 0x00080000 0 0 0
+flash bank str9x 0x00080000 0x00008000 0 0 0
+
+# For more information about the configuration files, take a look at:
+# openocd.texi


Property changes on: trunk/src/target/board/str910-eval.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/board/zy1000.cfg
===================================================================
--- trunk/src/target/board/zy1000.cfg	2009-05-18 07:02:12 UTC (rev 1807)
+++ trunk/src/target/board/zy1000.cfg	2009-05-18 07:04:58 UTC (rev 1808)
@@ -1,110 +1,110 @@
-#Script for ZY1000
-
-#Atmel ties SRST & TRST together, at which point it makes
-#no sense to use TRST, but use TMS instead.
-#
-#The annoying thing with tying SRST & TRST together is that
-#there is no way to halt the CPU *before and during* the
-#SRST reset, which means that the CPU will run a number
-#of cycles before it can be halted(as much as milliseconds).
-reset_config srst_only srst_pulls_trst
-
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME zy1000
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-   set  _ENDIAN little
-}
-
- 
-#jtag scan chain
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-   set _CPUTAPID 0x1f0f0f0f
-}
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
-
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm7tdmi-s_r4
-
-# at CPU CLK <32kHz this must be disabled
-arm7_9 fast_memory_access enable
-arm7_9 dcc_downloads enable
-
-flash bank ecosflash 0x01000000 0x200000 2 2 0 ecos/at91eb40a.elf
-$_TARGETNAME configure -event reset-init { 
-	# Set up chip selects & timings
-	mww 0xFFE00000 0x0100273D
-	mww 0xFFE00004 0x08002125
-	mww 0xFFEe0008 0x02002125
-	mww 0xFFE0000c 0x03002125
-	mww 0xFFE00010 0x40000000
-	mww 0xFFE00014 0x50000000
-	mww 0xFFE00018 0x60000000
-	mww 0xFFE0001c 0x70000000
-	mww 0xFFE00020 0x00000001
-	mww 0xFFE00024 0x00000000
-	
-	# remap  
-	mww 0xFFFFF124 0xFFFFFFFF  
-	mww 0xffff0010 0x100
-	mww 0xffff0034 0x100
-	
-	#disable 16x5x UART interrupts
-	mww 0x08020004 0
-}
-
-# required for usable performance. Used for lots of
-# other things than flash programming.
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00020000 -work-area-size 0x20000 -work-area-backup 0
-
-jtag_khz 16000
-
-
-proc production_info {} {
-	return "Serial number is official MAC number. Format XXXXXXXXXXXX"
-}
-
-# There is no return value from this procedure. If it is
-# successful it does not throw an exception
-#
-# Progress messages are output via puts 
-proc production {firmwarefile serialnumber} {
-	if {[string length $serialnumber]!=12} {
-		puts "Invalid serial number"
-		return
-	}
-
-	puts "Power cycling target"
-	power off
-	sleep 3000
-	power on
-	sleep 1000
-	reset init
-	flash write_image erase $firmwarefile 0x1000000 bin
-	verify_image $firmwarefile 0x1000000 bin
-
-	# Big endian... weee!!!!
-	puts "Setting MAC number to $serialnumber"	
-	flash fillw [expr 0x1030000-0x8] "0x[string range $serialnumber 2 3][string range $serialnumber 0 1]0000" 1
-	flash fillw [expr 0x1030000-0x4] "0x[string range $serialnumber 10 11][string range $serialnumber 8 9][string range $serialnumber 6 7][string range $serialnumber 4 5]" 1
-	puts "Production successful"
-} 
-
-
-proc production_test {} {
-	power on
-	sleep 1000
-	target_request debugmsgs enable
-	reset run
-	sleep 25000
-	target_request debugmsgs disable
-	return "See IP address above..."
-}
+#Script for ZY1000
+
+#Atmel ties SRST & TRST together, at which point it makes
+#no sense to use TRST, but use TMS instead.
+#
+#The annoying thing with tying SRST & TRST together is that
+#there is no way to halt the CPU *before and during* the
+#SRST reset, which means that the CPU will run a number
+#of cycles before it can be halted(as much as milliseconds).
+reset_config srst_only srst_pulls_trst
+
+
+if { [info exists CHIPNAME] } {	
+   set  _CHIPNAME $CHIPNAME    
+} else {	 
+   set  _CHIPNAME zy1000
+}
+
+if { [info exists ENDIAN] } {	
+   set  _ENDIAN $ENDIAN    
+} else {	 
+   set  _ENDIAN little
+}
+
+ 
+#jtag scan chain
+if { [info exists CPUTAPID ] } {
+   set _CPUTAPID $CPUTAPID
+} else {
+   set _CPUTAPID 0x1f0f0f0f
+}
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm7tdmi-s_r4
+
+# at CPU CLK <32kHz this must be disabled
+arm7_9 fast_memory_access enable
+arm7_9 dcc_downloads enable
+
+flash bank ecosflash 0x01000000 0x200000 2 2 0 ecos/at91eb40a.elf
+$_TARGETNAME configure -event reset-init { 
+	# Set up chip selects & timings
+	mww 0xFFE00000 0x0100273D
+	mww 0xFFE00004 0x08002125
+	mww 0xFFEe0008 0x02002125
+	mww 0xFFE0000c 0x03002125
+	mww 0xFFE00010 0x40000000
+	mww 0xFFE00014 0x50000000
+	mww 0xFFE00018 0x60000000
+	mww 0xFFE0001c 0x70000000
+	mww 0xFFE00020 0x00000001
+	mww 0xFFE00024 0x00000000
+	
+	# remap  
+	mww 0xFFFFF124 0xFFFFFFFF  
+	mww 0xffff0010 0x100
+	mww 0xffff0034 0x100
+	
+	#disable 16x5x UART interrupts
+	mww 0x08020004 0
+}
+
+# required for usable performance. Used for lots of
+# other things than flash programming.
+$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00020000 -work-area-size 0x20000 -work-area-backup 0
+
+jtag_khz 16000
+
+
+proc production_info {} {
+	return "Serial number is official MAC number. Format XXXXXXXXXXXX"
+}
+
+# There is no return value from this procedure. If it is
+# successful it does not throw an exception
+#
+# Progress messages are output via puts 
+proc production {firmwarefile serialnumber} {
+	if {[string length $serialnumber]!=12} {
+		puts "Invalid serial number"
+		return
+	}
+
+	puts "Power cycling target"
+	power off
+	sleep 3000
+	power on
+	sleep 1000
+	reset init
+	flash write_image erase $firmwarefile 0x1000000 bin
+	verify_image $firmwarefile 0x1000000 bin
+
+	# Big endian... weee!!!!
+	puts "Setting MAC number to $serialnumber"	
+	flash fillw [expr 0x1030000-0x8] "0x[string range $serialnumber 2 3][string range $serialnumber 0 1]0000" 1
+	flash fillw [expr 0x1030000-0x4] "0x[string range $serialnumber 10 11][string range $serialnumber 8 9][string range $serialnumber 6 7][string range $serialnumber 4 5]" 1
+	puts "Production successful"
+} 
+
+
+proc production_test {} {
+	power on
+	sleep 1000
+	target_request debugmsgs enable
+	reset run
+	sleep 25000
+	target_request debugmsgs disable
+	return "See IP address above..."
+}


Property changes on: trunk/src/target/board/zy1000.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/interface/hitex_str9-comstick.cfg
===================================================================
--- trunk/src/target/interface/hitex_str9-comstick.cfg	2009-05-18 07:02:12 UTC (rev 1807)
+++ trunk/src/target/interface/hitex_str9-comstick.cfg	2009-05-18 07:04:58 UTC (rev 1808)
@@ -1,11 +1,11 @@
-#
-# Hitex STR9-comStick
-#
-# http://www.hitex.com/index.php?id=383
-#
-
-interface ft2232
-ft2232_device_desc "STR9-comStick A"
-ft2232_layout comstick
-ft2232_vid_pid 0x0640 0x002c
-
+#
+# Hitex STR9-comStick
+#
+# http://www.hitex.com/index.php?id=383
+#
+
+interface ft2232
+ft2232_device_desc "STR9-comStick A"
+ft2232_layout comstick
+ft2232_vid_pid 0x0640 0x002c
+


Property changes on: trunk/src/target/interface/hitex_str9-comstick.cfg
___________________________________________________________________
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Mon May 18 09:10:54 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 18 May 2009 09:10:54 +0200
Subject: [Openocd-svn] r1809 - trunk/src/target
Message-ID: <200905180710.n4I7As0u024395@sheep.berlios.de>

Author: oharboe
Date: 2009-05-18 09:10:48 +0200 (Mon, 18 May 2009)
New Revision: 1809

Modified:
   trunk/src/target/arm7_9_common.c
Log:
Dean Glazeski <dnglaze at gmail.com> fixed bug in checking of clocked back data in arm7_9_execute_fast_sys_speed. Not reported. There is a chance that this bug hid a deeper problem since it only partially disabled the check(mask & value were equal).

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-18 07:04:58 UTC (rev 1808)
+++ trunk/src/target/arm7_9_common.c	2009-05-18 07:10:48 UTC (rev 1809)
@@ -50,6 +50,12 @@
 int handle_arm7_9_dcc_downloads_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 int handle_arm7_9_etm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
+/**
+ * Clear watchpoints for an ARM7/9 target.
+ *
+ * @param arm7_9 Pointer to the common struct for an ARM7/9 target
+ * @return JTAG error status after executing queue
+ */
 static int arm7_9_clear_watchpoints(arm7_9_common_t *arm7_9)
 {
 	embeddedice_write_reg(&arm7_9->eice_cache->reg_list[EICE_W0_CONTROL_VALUE], 0x0);
@@ -62,6 +68,13 @@
 	return jtag_execute_queue();
 }
 
+/**
+ * Assign a watchpoint to one of the two available hardware comparators in an
+ * ARM7 or ARM9 target.
+ *
+ * @param arm7_9 Pointer to the common struct for an ARM7/9 target
+ * @param breakpoint Pointer to the breakpoint to be used as a watchpoint
+ */
 static void arm7_9_assign_wp(arm7_9_common_t *arm7_9, breakpoint_t *breakpoint)
 {
 	if (!arm7_9->wp0_used)
@@ -82,7 +95,13 @@
 	}
 }
 
-/* set up embedded ice registers */
+/**
+ * Setup an ARM7/9 target's embedded ICE registers for software breakpoints.
+ *
+ * @param arm7_9 Pointer to common struct for ARM7/9 targets
+ * @return Error codes if there is a problem finding a watchpoint or the result
+ *         of executing the JTAG queue
+ */
 static int arm7_9_set_software_breakpoints(arm7_9_common_t *arm7_9)
 {
 	if (arm7_9->sw_breakpoints_added)
@@ -137,7 +156,12 @@
 	return jtag_execute_queue();
 }
 
-/* set things up after a reset / on startup */
+/**
+ * Setup the common pieces for an ARM7/9 target after reset or on startup.
+ *
+ * @param target Pointer to an ARM7/9 target to setup
+ * @return Result of clearing the watchpoints on the target
+ */
 int arm7_9_setup(target_t *target)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -146,6 +170,18 @@
 	return arm7_9_clear_watchpoints(arm7_9);
 }
 
+/**
+ * Retrieves the architecture information pointers for ARMv4/5 and ARM7/9
+ * targets.  A return of ERROR_OK signifies that the target is a valid target
+ * and that the pointers have been set properly.
+ *
+ * @param target Pointer to the target device to get the pointers from
+ * @param armv4_5_p Pointer to be filled in with the common struct for ARMV4/5
+ *                  targets
+ * @param arm7_9_p Pointer to be filled in with the common struct for ARM7/9
+ *                 targets
+ * @return ERROR_OK if successful
+ */
 int arm7_9_get_arch_pointers(target_t *target, armv4_5_common_t **armv4_5_p, arm7_9_common_t **arm7_9_p)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -167,8 +203,16 @@
 	return ERROR_OK;
 }
 
-/* we set up the breakpoint even if it is already set. Some action, e.g. reset
- * might have erased the values in embedded ice
+/**
+ * Set either a hardware or software breakpoint on an ARM7/9 target.  The
+ * breakpoint is set up even if it is already set.  Some actions, e.g. reset,
+ * might have erased the values in Embedded ICE.
+ *
+ * @param target Pointer to the target device to set the breakpoints on
+ * @param breakpoint Pointer to the breakpoint to be set
+ * @return For hardware breakpoints, this is the result of executing the JTAG
+ *         queue.  For software breakpoints, this will be the status of the
+ *         required memory reads and writes
  */
 int arm7_9_set_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
 {
@@ -280,6 +324,18 @@
 	return retval;
 }
 
+/**
+ * Unsets an existing breakpoint on an ARM7/9 target.  If it is a hardware
+ * breakpoint, the watchpoint used will be freed and the Embedded ICE registers
+ * will be updated.  Otherwise, the software breakpoint will be restored to its
+ * original instruction if it hasn't already been modified.
+ *
+ * @param target Pointer to ARM7/9 target to unset the breakpoint from
+ * @param breakpoint Pointer to breakpoint to be unset
+ * @return For hardware breakpoints, this is the result of executing the JTAG
+ *         queue.  For software breakpoints, this will be the status of the
+ *         required memory reads and writes
+ */
 int arm7_9_unset_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
 {
 	int retval = ERROR_OK;
@@ -347,6 +403,15 @@
 	return retval;
 }
 
+/**
+ * Add a breakpoint to an ARM7/9 target.  This makes sure that there are no
+ * dangling breakpoints and that the desired breakpoint can be added.
+ *
+ * @param target Pointer to the target ARM7/9 device to add a breakpoint to
+ * @param breakpoint Pointer to the breakpoint to be added
+ * @return An error status if there is a problem adding the breakpoint or the
+ *         result of setting the breakpoint
+ */
 int arm7_9_add_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -388,6 +453,16 @@
 	return arm7_9_set_breakpoint(target, breakpoint);
 }
 
+/**
+ * Removes a breakpoint from an ARM7/9 target.  This will make sure there are no
+ * dangling breakpoints and updates available watchpoints if it is a hardware
+ * breakpoint.
+ *
+ * @param target Pointer to the target to have a breakpoint removed
+ * @param breakpoint Pointer to the breakpoint to be removed
+ * @return Error status if there was a problem unsetting the breakpoint or the
+ *         watchpoints could not be cleared
+ */
 int arm7_9_remove_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
 {
 	int retval = ERROR_OK;
@@ -415,6 +490,16 @@
 	return ERROR_OK;
 }
 
+/**
+ * Sets a watchpoint for an ARM7/9 target in one of the watchpoint units.  It is
+ * considered a bug to call this function when there are no available watchpoint
+ * units.
+ *
+ * @param target Pointer to an ARM7/9 target to set a watchpoint on
+ * @param watchpoint Pointer to the watchpoint to be set
+ * @return Error status if watchpoint set fails or the result of executing the
+ *         JTAG queue
+ */
 int arm7_9_set_watchpoint(struct target_s *target, watchpoint_t *watchpoint)
 {
 	int retval = ERROR_OK;
@@ -479,6 +564,14 @@
 	return ERROR_OK;
 }
 
+/**
+ * Unset an existing watchpoint and clear the used watchpoint unit.
+ *
+ * @param target Pointer to the target to have the watchpoint removed
+ * @param watchpoint Pointer to the watchpoint to be removed
+ * @return Error status while trying to unset the watchpoint or the result of
+ *         executing the JTAG queue
+ */
 int arm7_9_unset_watchpoint(struct target_s *target, watchpoint_t *watchpoint)
 {
 	int retval = ERROR_OK;
@@ -520,6 +613,14 @@
 	return ERROR_OK;
 }
 
+/**
+ * Add a watchpoint to an ARM7/9 target.  If there are no watchpoint units
+ * available, an error response is returned.
+ *
+ * @param target Pointer to the ARM7/9 target to add a watchpoint to
+ * @param watchpoint Pointer to the watchpoint to be added
+ * @return Error status while trying to add the watchpoint
+ */
 int arm7_9_add_watchpoint(struct target_s *target, watchpoint_t *watchpoint)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -546,6 +647,14 @@
 	return ERROR_OK;
 }
 
+/**
+ * Remove a watchpoint from an ARM7/9 target.  The watchpoint will be unset and
+ * the used watchpoint unit will be reopened.
+ *
+ * @param target Pointer to the target to remove a watchpoint from
+ * @param watchpoint Pointer to the watchpoint to be removed
+ * @return Result of trying to unset the watchpoint
+ */
 int arm7_9_remove_watchpoint(struct target_s *target, watchpoint_t *watchpoint)
 {
 	int retval = ERROR_OK;
@@ -565,6 +674,15 @@
 	return ERROR_OK;
 }
 
+/**
+ * Restarts the target by sending a RESTART instruction and moving the JTAG
+ * state to IDLE.  This includes a timeout waiting for DBGACK and SYSCOMP to be
+ * asserted by the processor.
+ *
+ * @param target Pointer to target to issue commands to
+ * @return Error status if there is a timeout or a problem while executing the
+ *         JTAG queue
+ */
 int arm7_9_execute_sys_speed(struct target_s *target)
 {
 	int retval;
@@ -610,6 +728,14 @@
 	return ERROR_OK;
 }
 
+/**
+ * Restarts the target by sending a RESTART instruction and moving the JTAG
+ * state to IDLE.  This validates that DBGACK and SYSCOMP are set without
+ * waiting until they are.
+ *
+ * @param target Pointer to the target to issue commands to
+ * @return Always ERROR_OK
+ */
 int arm7_9_execute_fast_sys_speed(struct target_s *target)
 {
 	static int set=0;
@@ -642,7 +768,7 @@
 	}
 
 	/* read debug status register */
-	embeddedice_read_reg_w_check(dbg_stat, check_value, check_value);
+	embeddedice_read_reg_w_check(dbg_stat, check_value, check_mask);
 
 	return ERROR_OK;
 }



From oharboe at mail.berlios.de  Mon May 18 15:07:37 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 18 May 2009 15:07:37 +0200
Subject: [Openocd-svn] r1810 - trunk/src/helper
Message-ID: <200905181307.n4ID7bCQ004284@sheep.berlios.de>

Author: oharboe
Date: 2009-05-18 15:07:37 +0200 (Mon, 18 May 2009)
New Revision: 1810

Modified:
   trunk/src/helper/startup.tcl
Log:
less weird error messages for unknown commands. Check if command exists before trying it.

Modified: trunk/src/helper/startup.tcl
===================================================================
--- trunk/src/helper/startup.tcl	2009-05-18 07:10:48 UTC (rev 1809)
+++ trunk/src/helper/startup.tcl	2009-05-18 13:07:37 UTC (rev 1810)
@@ -88,9 +88,10 @@
 	# do the name mangling from "flash banks" to "flash_banks"
 	if {[llength $args]>=2} {
 		set cmd_name "[lindex $args 0]_[lindex $args 1]"
-		# Fix?? add a check here if this is a command?
-		# we'll strip away args until we fail anyway...
-		return [eval "$cmd_name [lrange $args 2 end]"]
+		if {[catch {info body $cmd_name}]==0} {
+		    # the command exists, try it...
+			return [eval "$cmd_name [lrange $args 2 end]"]
+		}
 	}
 	# This really is an unknown command.
 	return -code error "Unknown command: $args"



From oharboe at mail.berlios.de  Mon May 18 15:55:40 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 18 May 2009 15:55:40 +0200
Subject: [Openocd-svn] r1811 - trunk/src/helper
Message-ID: <200905181355.n4IDteIE010623@sheep.berlios.de>

Author: oharboe
Date: 2009-05-18 15:55:38 +0200 (Mon, 18 May 2009)
New Revision: 1811

Modified:
   trunk/src/helper/command.c
Log:
Remove unecessary(and poptentially harmful?) "" around arguments
passed in to "eval" in command.c


Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2009-05-18 13:07:37 UTC (rev 1810)
+++ trunk/src/helper/command.c	2009-05-18 13:55:38 UTC (rev 1811)
@@ -221,7 +221,7 @@
 	free((void *)full_name);
 
 	/* we now need to add an overrideable proc */
-	const char *override_name=alloc_printf("proc %s%s%s {args} {if {[catch {eval \"ocd_%s%s%s $args\"}]==0} {return \"\"} else { return -code error }", t1, t2, t3, t1, t2, t3);
+	const char *override_name=alloc_printf("proc %s%s%s {args} {if {[catch {eval ocd_%s%s%s $args}]==0} {return \"\"} else { return -code error }", t1, t2, t3, t1, t2, t3);
 	Jim_Eval_Named(interp, override_name, __THIS__FILE__, __LINE__ );
 	free((void *)override_name);
 



From kc8apf at mail.berlios.de  Mon May 18 19:06:37 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:06:37 +0200
Subject: [Openocd-svn] r1812 - trunk/src/jtag
Message-ID: <200905181706.n4IH6buR030828@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:06:36 +0200 (Mon, 18 May 2009)
New Revision: 1812

Modified:
   trunk/src/jtag/jtag.c
Log:
JTAG state table updates (short table still disabled).  Provided by Dick Hollenbeck <dick at softplc.com>

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 13:55:38 UTC (rev 1811)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:06:36 UTC (rev 1812)
@@ -853,6 +853,9 @@
 #endif
 		}
 	}
+
+	/* field_count represents the true number of fields setup*/
+	(*last_cmd)->cmd.scan->num_fields = field_count;
 	return ERROR_OK;
 }
 
@@ -1315,7 +1318,7 @@
 	int i;
 
 	bit_count = jtag_scan_size(cmd);
-	*buffer = malloc(CEIL(bit_count, 8));
+	*buffer = calloc(1,CEIL(bit_count, 8));
 
 	bit_count = 0;
 
@@ -3298,23 +3301,23 @@
 
 	/* to state: */
 	/*	RESET			IDLE				DRSHIFT			DRPAUSE			IRSHIFT	  		IRPAUSE */			/* from state: */
-	{	B8(1111111,7),	B8(0,1),			B8(00101,5), 	B8(01010,5),		B8(001101,6), 	B8(010110,6) },		/* RESET */
-	{	B8(1111111,7),	B8(0,1),			B8(001,3),		B8(0101,4),		B8(0011,4),  	B8(01011,5) },		/* IDLE */
+	{	B8(1111111,7),	B8(0000000,7),	B8(00101,5), 		B8(01010,5),	B8(001101,6), 	B8(010110,6) },		/* RESET */
+	{	B8(1111111,7),	B8(0000000,7),	B8(001,3),			B8(0101,4),		B8(0011,4),  	B8(01011,5) },		/* IDLE */
 	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(01,2),		B8(001111,6),	B8(0101111,7) },		/* DRSHIFT */
-	{	B8(1111111,7),	B8(011,3),		B8(01,2),   		B8(0,1),			B8(001111,6),	B8(0101111,7) },		/* DRPAUSE */
+	{	B8(1111111,7),	B8(011,3),		B8(01,2),   		B8(0,1),		B8(001111,6),	B8(0101111,7) },		/* DRPAUSE */
 	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(010111,6), 	B8(001111,6),	B8(01,2) },			/* IRSHIFT */
 	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(010111,6),	B8(01,2),		B8(0,1) } 			/* IRPAUSE */
 
 #else	/* this is the old table, converted from hex and with the bit_count set to 7 for each combo, like before */
 
 	/* to state: */
-	/*	RESET			IDLE				DRSHIFT			DRPAUSE			IRSHIFT	  		IRPAUSE */			/* from state: */
-	{	B8(1111111,7),	B8(0000000,7),	B8(0010111,7), 	B8(0001010,7),	B8(0011011,7), 	B8(0010110,7) },		/* RESET */
-	{	B8(1111111,7),	B8(0000000,7),	B8(0100101,7),	B8(0000101,7),	B8(0101011,7),	B8(0001011,7) },		/* IDLE */
-	{	B8(1111111,7),	B8(0110001,7),	B8(0000000,7),	B8(0000001,7),	B8(0001111,7),	B8(0101111,7) },		/* DRSHIFT */
-	{	B8(1111111,7),	B8(0110000,7),	B8(0100000,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },		/* DRPAUSE */
-	{	B8(1111111,7),	B8(0110001,7),	B8(0000111,7),	B8(0010111,7), 	B8(0000000,7),	B8(0000001,7) },		/* IRSHIFT */
-	{	B8(1111111,7),	B8(0110000,7),	B8(0011100,7),	B8(0010111,7),	B8(0100000,7),	B8(0101111,7) } 		/* IRPAUSE */
+	/*	RESET			IDLE			DRSHIFT			DRPAUSE			IRSHIFT			IRPAUSE 	*/		/* from state: */
+	{	B8(1111111,7),	B8(0000000,7),	B8(0010111,7),	B8(0001010,7),	B8(0011011,7),	B8(0010110,7) },	/* RESET */
+	{	B8(1111111,7),	B8(0000000,7),	B8(0100101,7),	B8(0000101,7),	B8(0101011,7),	B8(0001011,7) },	/* IDLE */
+	{	B8(1111111,7),	B8(0110001,7),	B8(0000000,7),	B8(0000001,7),	B8(0001111,7),	B8(0101111,7) },	/* DRSHIFT */
+	{	B8(1111111,7),	B8(0110000,7),	B8(0100000,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },	/* DRPAUSE */
+	{	B8(1111111,7),	B8(0110001,7),	B8(0000111,7),	B8(0010111,7),	B8(0000000,7),	B8(0000001,7) },	/* IRSHIFT */
+	{	B8(1111111,7),	B8(0110000,7),	B8(0011100,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },	/* IRPAUSE */
 
 #endif
 



From kc8apf at mail.berlios.de  Mon May 18 19:20:56 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:20:56 +0200
Subject: [Openocd-svn] r1813 - trunk
Message-ID: <200905181720.n4IHKu8X011198@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:20:51 +0200 (Mon, 18 May 2009)
New Revision: 1813

Modified:
   trunk/PATCHES
Log:
PATCHES updates from David Brownell <david-b at pacbell.net>

Modified: trunk/PATCHES
===================================================================
--- trunk/PATCHES	2009-05-18 17:06:36 UTC (rev 1812)
+++ trunk/PATCHES	2009-05-18 17:20:51 UTC (rev 1813)
@@ -2,6 +2,9 @@
 
 openocd-development at lists.berlios.de
 
+Note that you can't send patches to that list unless
+you're a member, despite what the list info page says.
+
 The patch should be against svn trunk using an SVN
 diff. 
 
@@ -9,6 +12,10 @@
 also write a short change log entry that maintainers
 can copy and paste into the commit message
 
+(However, don't expect the maintainers to actually
+include such entries in their commit messages if
+they're longer than a single $SUBJECT line.)
+
 Add yourself to the GPL copyright for non-trivial changes.
 
 To create a patch from the command line:



From kc8apf at mail.berlios.de  Mon May 18 19:24:02 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:24:02 +0200
Subject: [Openocd-svn] r1814 - trunk/src/jtag
Message-ID: <200905181724.n4IHO236013832@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:23:52 +0200 (Mon, 18 May 2009)
New Revision: 1814

Modified:
   trunk/src/jtag/ft2232.c
Log:
ftdi_set_interface correctness by Strontium <strntydog at gmail.com>

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-18 17:20:51 UTC (rev 1813)
+++ trunk/src/jtag/ft2232.c	2009-05-18 17:23:52 UTC (rev 1814)
@@ -1766,6 +1766,12 @@
 	if (ftdi_init(&ftdic) < 0)
 		return ERROR_JTAG_INIT_FAILED;
 
+	if (ftdi_set_interface(&ftdic, INTERFACE_A) < 0)
+	{
+		LOG_ERROR("unable to select FT2232 channel A: %s", ftdic.error_str);
+		return ERROR_JTAG_INIT_FAILED;
+	}
+
 	/* context, vendor id, product id */
 	if (ftdi_usb_open_desc(&ftdic, vid, pid, ft2232_device_desc,
 				ft2232_serial) < 0)
@@ -1779,12 +1785,6 @@
 		return ERROR_JTAG_INIT_FAILED;
 	}
 
-	if (ftdi_set_interface(&ftdic, INTERFACE_A) < 0)
-	{
-		LOG_ERROR("unable to select FT2232 channel A: %s", ftdic.error_str);
-		return ERROR_JTAG_INIT_FAILED;
-	}
-
 	if (ftdi_usb_reset(&ftdic) < 0)
 	{
 		LOG_ERROR("unable to reset ftdi device");



From kc8apf at mail.berlios.de  Mon May 18 19:27:01 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:27:01 +0200
Subject: [Openocd-svn] r1815 - trunk/src/jtag
Message-ID: <200905181727.n4IHR1De015931@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:27:00 +0200 (Mon, 18 May 2009)
New Revision: 1815

Modified:
   trunk/src/jtag/jtag.c
Log:
Add jtag_queue_command() by Michael Bruck <mbruck at digenius.de>

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:23:52 UTC (rev 1814)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:27:00 UTC (rev 1815)
@@ -439,6 +439,21 @@
 	return last_comand_pointer;
 }
 
+
+void jtag_queue_command(jtag_command_t * cmd)
+{
+	jtag_command_t **last_cmd;
+
+	last_cmd = jtag_get_last_command_p();
+
+	*last_cmd = cmd;
+
+	(*last_cmd)->next = NULL;
+
+	last_comand_pointer = &((*last_cmd)->next);
+}
+
+
 void* cmd_queue_alloc(size_t size)
 {
 	cmd_queue_page_t **p_page = &cmd_queue_pages;



From kc8apf at mail.berlios.de  Mon May 18 19:27:32 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:27:32 +0200
Subject: [Openocd-svn] r1816 - trunk/src/jtag
Message-ID: <200905181727.n4IHRW12016696@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:27:30 +0200 (Mon, 18 May 2009)
New Revision: 1816

Modified:
   trunk/src/jtag/jtag.c
Log:
Add jtag_queue_command() by Michael Bruck <mbruck at digenius.de> [2/8]

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:27:00 UTC (rev 1815)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:27:30 UTC (rev 1816)
@@ -590,28 +590,26 @@
 
 int MINIDRIVER(interface_jtag_add_ir_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
 {
-	jtag_command_t **last_cmd;
 	jtag_tap_t *tap;
 	int j;
 	int x;
 	int nth_tap;
 	int scan_size = 0;
 
-	last_cmd = jtag_get_last_command_p();
-
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	(*last_cmd)->next = NULL;
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->type = JTAG_SCAN;
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+	
+	jtag_queue_command(cmd);
+	
+	cmd->type = JTAG_SCAN;
 
 	/* allocate memory for ir scan command */
-	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = true;
+	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
+	cmd->cmd.scan->ir_scan = true;
 	x = jtag_NumEnabledTaps();
-	(*last_cmd)->cmd.scan->num_fields = x;	/* one field per device */
-	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc(x  * sizeof(scan_field_t));
-	(*last_cmd)->cmd.scan->end_state = state;
+	cmd->cmd.scan->num_fields = x;	/* one field per device */
+	cmd->cmd.scan->fields = cmd_queue_alloc(x  * sizeof(scan_field_t));
+	cmd->cmd.scan->end_state = state;
 
 	nth_tap = -1;
 	tap = NULL;
@@ -628,9 +626,9 @@
 		assert(nth_tap < x );
 
 		scan_size = tap->ir_length;
-		(*last_cmd)->cmd.scan->fields[nth_tap].tap = tap;
-		(*last_cmd)->cmd.scan->fields[nth_tap].num_bits = scan_size;
-		(*last_cmd)->cmd.scan->fields[nth_tap].in_value = NULL; /* do not collect input for tap's in bypass */
+		cmd->cmd.scan->fields[nth_tap].tap = tap;
+		cmd->cmd.scan->fields[nth_tap].num_bits = scan_size;
+		cmd->cmd.scan->fields[nth_tap].in_value = NULL; /* do not collect input for tap's in bypass */
 
 		/* search the list */
 		for (j = 0; j < num_fields; j++)
@@ -638,8 +636,8 @@
 			if (tap == fields[j].tap)
 			{
 				found = 1;
-				(*last_cmd)->cmd.scan->fields[nth_tap].in_value = fields[j].in_value;
-				(*last_cmd)->cmd.scan->fields[nth_tap].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+				cmd->cmd.scan->fields[nth_tap].in_value = fields[j].in_value;
+				cmd->cmd.scan->fields[nth_tap].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 
 				tap->bypass = 0;
 				break;
@@ -649,12 +647,12 @@
 		if (!found)
 		{
 			/* if a tap isn't listed, set it to BYPASS */
-			(*last_cmd)->cmd.scan->fields[nth_tap].out_value = buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+			cmd->cmd.scan->fields[nth_tap].out_value = buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 			tap->bypass = 1;
 		}
 
 		/* update device information */
-		buf_cpy((*last_cmd)->cmd.scan->fields[nth_tap].out_value, tap->cur_instr, scan_size);
+		buf_cpy(cmd->cmd.scan->fields[nth_tap].out_value, tap->cur_instr, scan_size);
 	}
 	assert(nth_tap == (x-1));
 



From kc8apf at mail.berlios.de  Mon May 18 19:27:48 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:27:48 +0200
Subject: [Openocd-svn] r1817 - trunk/src/jtag
Message-ID: <200905181727.n4IHRmfe016953@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:27:46 +0200 (Mon, 18 May 2009)
New Revision: 1817

Modified:
   trunk/src/jtag/jtag.c
Log:
Add jtag_queue_command() by Michael Bruck <mbruck at digenius.de> [3/8]

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:27:30 UTC (rev 1816)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:27:46 UTC (rev 1817)
@@ -672,32 +672,31 @@
 
 int MINIDRIVER(interface_jtag_add_plain_ir_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
 {
-	int i;
-	jtag_command_t **last_cmd;
+	/* allocate memory for a new list member */
 
-	last_cmd = jtag_get_last_command_p();
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+	
+	jtag_queue_command(cmd);
 
-	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	(*last_cmd)->next = NULL;
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->type = JTAG_SCAN;
+	cmd->type = JTAG_SCAN;
 
 	/* allocate memory for ir scan command */
-	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = true;
-	(*last_cmd)->cmd.scan->num_fields = num_fields;
-	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc(num_fields * sizeof(scan_field_t));
-	(*last_cmd)->cmd.scan->end_state = state;
+	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
+	cmd->cmd.scan->ir_scan = true;
+	cmd->cmd.scan->num_fields = num_fields;
+	cmd->cmd.scan->fields = cmd_queue_alloc(num_fields * sizeof(scan_field_t));
+	cmd->cmd.scan->end_state = state;
 
-	for( i = 0 ; i < num_fields ; i++ ){
+	for (int i = 0; i < num_fields; i++)
+	{
 		int num_bits = fields[i].num_bits;
 		int num_bytes = CEIL(fields[i].num_bits, 8);
-		(*last_cmd)->cmd.scan->fields[i].tap = fields[i].tap;
-		(*last_cmd)->cmd.scan->fields[i].num_bits = num_bits;
-		(*last_cmd)->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		(*last_cmd)->cmd.scan->fields[i].in_value = fields[i].in_value;
+		cmd->cmd.scan->fields[i].tap = fields[i].tap;
+		cmd->cmd.scan->fields[i].num_bits = num_bits;
+		cmd->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
+		cmd->cmd.scan->fields[i].in_value = fields[i].in_value;
 	}
+
 	return ERROR_OK;
 }
 



From kc8apf at mail.berlios.de  Mon May 18 19:28:07 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:28:07 +0200
Subject: [Openocd-svn] r1818 - trunk/src/jtag
Message-ID: <200905181728.n4IHS7wr017403@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:28:00 +0200 (Mon, 18 May 2009)
New Revision: 1818

Modified:
   trunk/src/jtag/jtag.c
Log:
Add jtag_queue_command() by Michael Bruck <mbruck at digenius.de> [4/8]

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:27:46 UTC (rev 1817)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:28:00 UTC (rev 1818)
@@ -785,7 +785,6 @@
 	int field_count = 0;
 	int scan_size;
 
-	jtag_command_t **last_cmd = jtag_get_last_command_p();
 	jtag_tap_t *tap;
 
 	/* count devices in bypass */
@@ -802,17 +801,19 @@
 	}
 
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->next = NULL;
-	(*last_cmd)->type = JTAG_SCAN;
+	
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+	
+	jtag_queue_command(cmd);
+	
+	cmd->type = JTAG_SCAN;
 
 	/* allocate memory for dr scan command */
-	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = false;
-	(*last_cmd)->cmd.scan->num_fields = num_fields + bypass_devices;
-	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc((num_fields + bypass_devices) * sizeof(scan_field_t));
-	(*last_cmd)->cmd.scan->end_state = state;
+	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
+	cmd->cmd.scan->ir_scan = false;
+	cmd->cmd.scan->num_fields = num_fields + bypass_devices;
+	cmd->cmd.scan->fields = cmd_queue_alloc((num_fields + bypass_devices) * sizeof(scan_field_t));
+	cmd->cmd.scan->end_state = state;
 
 	tap = NULL;
 	nth_tap = -1;
@@ -823,7 +824,7 @@
 			break;
 		}
 		int found = 0;
-		(*last_cmd)->cmd.scan->fields[field_count].tap = tap;
+		cmd->cmd.scan->fields[field_count].tap = tap;
 
 		for (j = 0; j < num_fields; j++)
 		{
@@ -831,9 +832,9 @@
 			{
 				found = 1;
 				scan_size = fields[j].num_bits;
-				(*last_cmd)->cmd.scan->fields[field_count].num_bits = scan_size;
-				(*last_cmd)->cmd.scan->fields[field_count].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				(*last_cmd)->cmd.scan->fields[field_count].in_value = fields[j].in_value;
+				cmd->cmd.scan->fields[field_count].num_bits = scan_size;
+				cmd->cmd.scan->fields[field_count].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+				cmd->cmd.scan->fields[field_count].in_value = fields[j].in_value;
 				field_count++;
 			}
 		}
@@ -848,9 +849,9 @@
 			}
 #endif
 			/* program the scan field to 1 bit length, and ignore it's value */
-			(*last_cmd)->cmd.scan->fields[field_count].num_bits = 1;
-			(*last_cmd)->cmd.scan->fields[field_count].out_value = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].in_value = NULL;
+			cmd->cmd.scan->fields[field_count].num_bits = 1;
+			cmd->cmd.scan->fields[field_count].out_value = NULL;
+			cmd->cmd.scan->fields[field_count].in_value = NULL;
 			field_count++;
 		}
 		else



From kc8apf at mail.berlios.de  Mon May 18 19:28:22 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:28:22 +0200
Subject: [Openocd-svn] r1819 - trunk/src/jtag
Message-ID: <200905181728.n4IHSMqV017777@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:28:21 +0200 (Mon, 18 May 2009)
New Revision: 1819

Modified:
   trunk/src/jtag/jtag.c
Log:
Add jtag_queue_command() by Michael Bruck <mbruck at digenius.de> [5/8]

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:28:00 UTC (rev 1818)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:28:21 UTC (rev 1819)
@@ -883,7 +883,6 @@
 	int scan_size;
 	int bypass_devices = 0;
 
-	jtag_command_t **last_cmd = jtag_get_last_command_p();
 	jtag_tap_t *tap;
 
 	/* count devices in bypass */
@@ -900,17 +899,18 @@
 	}
 
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->next = NULL;
-	(*last_cmd)->type = JTAG_SCAN;
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
 
+	jtag_queue_command(cmd);
+
+	cmd->type = JTAG_SCAN;
+
 	/* allocate memory for dr scan command */
-	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = false;
-	(*last_cmd)->cmd.scan->num_fields = num_fields + bypass_devices;
-	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc((num_fields + bypass_devices) * sizeof(scan_field_t));
-	(*last_cmd)->cmd.scan->end_state = end_state;
+	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
+	cmd->cmd.scan->ir_scan = false;
+	cmd->cmd.scan->num_fields = num_fields + bypass_devices;
+	cmd->cmd.scan->fields = cmd_queue_alloc((num_fields + bypass_devices) * sizeof(scan_field_t));
+	cmd->cmd.scan->end_state = end_state;
 
 	tap = NULL;
 	nth_tap = -1;
@@ -920,7 +920,7 @@
 			break;
 		}
 		nth_tap++;
-		(*last_cmd)->cmd.scan->fields[field_count].tap = tap;
+		cmd->cmd.scan->fields[field_count].tap = tap;
 
 		if (tap == target_tap)
 		{
@@ -938,9 +938,9 @@
 				u8 out_value[4];
 				scan_size = num_bits[j];
 				buf_set_u32(out_value, 0, scan_size, value[j]);
-				(*last_cmd)->cmd.scan->fields[field_count].num_bits = scan_size;
-				(*last_cmd)->cmd.scan->fields[field_count].out_value = buf_cpy(out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				(*last_cmd)->cmd.scan->fields[field_count].in_value = NULL;
+				cmd->cmd.scan->fields[field_count].num_bits = scan_size;
+				cmd->cmd.scan->fields[field_count].out_value = buf_cpy(out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+				cmd->cmd.scan->fields[field_count].in_value = NULL;
 				field_count++;
 			}
 		} else
@@ -954,9 +954,9 @@
 			}
 #endif
 			/* program the scan field to 1 bit length, and ignore it's value */
-			(*last_cmd)->cmd.scan->fields[field_count].num_bits = 1;
-			(*last_cmd)->cmd.scan->fields[field_count].out_value = NULL;
-			(*last_cmd)->cmd.scan->fields[field_count].in_value = NULL;
+			cmd->cmd.scan->fields[field_count].num_bits = 1;
+			cmd->cmd.scan->fields[field_count].out_value = NULL;
+			cmd->cmd.scan->fields[field_count].in_value = NULL;
 			field_count++;
 		}
 	}



From kc8apf at mail.berlios.de  Mon May 18 19:28:44 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:28:44 +0200
Subject: [Openocd-svn] r1820 - trunk/src/jtag
Message-ID: <200905181728.n4IHSiF7018138@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:28:42 +0200 (Mon, 18 May 2009)
New Revision: 1820

Modified:
   trunk/src/jtag/jtag.c
Log:
Add jtag_queue_command() by Michael Bruck <mbruck at digenius.de> [6/8]

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:28:21 UTC (rev 1819)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:28:42 UTC (rev 1820)
@@ -975,30 +975,28 @@
 
 int MINIDRIVER(interface_jtag_add_plain_dr_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
 {
-	int i;
-	jtag_command_t **last_cmd = jtag_get_last_command_p();
-
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->next = NULL;
-	(*last_cmd)->type = JTAG_SCAN;
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
 
+	jtag_queue_command(cmd);
+
+	cmd->type = JTAG_SCAN;
+
 	/* allocate memory for scan command */
-	(*last_cmd)->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	(*last_cmd)->cmd.scan->ir_scan = false;
-	(*last_cmd)->cmd.scan->num_fields = num_fields;
-	(*last_cmd)->cmd.scan->fields = cmd_queue_alloc(num_fields * sizeof(scan_field_t));
-	(*last_cmd)->cmd.scan->end_state = state;
+	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
+	cmd->cmd.scan->ir_scan = false;
+	cmd->cmd.scan->num_fields = num_fields;
+	cmd->cmd.scan->fields = cmd_queue_alloc(num_fields * sizeof(scan_field_t));
+	cmd->cmd.scan->end_state = state;
 
-	for (i = 0; i < num_fields; i++)
+	for (int i = 0; i < num_fields; i++)
 	{
 		int num_bits = fields[i].num_bits;
 		int num_bytes = CEIL(fields[i].num_bits, 8);
-		(*last_cmd)->cmd.scan->fields[i].tap = fields[i].tap;
-		(*last_cmd)->cmd.scan->fields[i].num_bits = num_bits;
-		(*last_cmd)->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		(*last_cmd)->cmd.scan->fields[i].in_value = fields[i].in_value;
+		cmd->cmd.scan->fields[i].tap = fields[i].tap;
+		cmd->cmd.scan->fields[i].num_bits = num_bits;
+		cmd->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
+		cmd->cmd.scan->fields[i].in_value = fields[i].in_value;
 	}
 
 	return ERROR_OK;



From kc8apf at mail.berlios.de  Mon May 18 19:29:01 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:29:01 +0200
Subject: [Openocd-svn] r1821 - trunk/src/jtag
Message-ID: <200905181729.n4IHT1ge018421@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:29:01 +0200 (Mon, 18 May 2009)
New Revision: 1821

Modified:
   trunk/src/jtag/jtag.c
Log:
Add jtag_queue_command() by Michael Bruck <mbruck at digenius.de> [7/8]

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:28:42 UTC (rev 1820)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:29:01 UTC (rev 1821)
@@ -1015,17 +1015,17 @@
 int MINIDRIVER(interface_jtag_add_tlr)(void)
 {
 	tap_state_t state = TAP_RESET;
-	jtag_command_t **last_cmd = jtag_get_last_command_p();
 
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->next = NULL;
-	(*last_cmd)->type = JTAG_STATEMOVE;
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
 
-	(*last_cmd)->cmd.statemove = cmd_queue_alloc(sizeof(statemove_command_t));
-	(*last_cmd)->cmd.statemove->end_state = state;
+	jtag_queue_command(cmd);
 
+	cmd->type = JTAG_STATEMOVE;
+
+	cmd->cmd.statemove = cmd_queue_alloc(sizeof(statemove_command_t));
+	cmd->cmd.statemove->end_state = state;
+
 	return ERROR_OK;
 }
 
@@ -1069,39 +1069,36 @@
 
 int MINIDRIVER(interface_jtag_add_pathmove)(int num_states, tap_state_t *path)
 {
-	jtag_command_t **last_cmd = jtag_get_last_command_p();
-	int i;
-
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->next = NULL;
-	(*last_cmd)->type = JTAG_PATHMOVE;
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
 
-	(*last_cmd)->cmd.pathmove = cmd_queue_alloc(sizeof(pathmove_command_t));
-	(*last_cmd)->cmd.pathmove->num_states = num_states;
-	(*last_cmd)->cmd.pathmove->path = cmd_queue_alloc(sizeof(tap_state_t) * num_states);
+	jtag_queue_command(cmd);
 
-	for (i = 0; i < num_states; i++)
-		(*last_cmd)->cmd.pathmove->path[i] = path[i];
+	cmd->type = JTAG_PATHMOVE;
 
+	cmd->cmd.pathmove = cmd_queue_alloc(sizeof(pathmove_command_t));
+	cmd->cmd.pathmove->num_states = num_states;
+	cmd->cmd.pathmove->path = cmd_queue_alloc(sizeof(tap_state_t) * num_states);
+
+	for (int i = 0; i < num_states; i++)
+		cmd->cmd.pathmove->path[i] = path[i];
+
 	return ERROR_OK;
 }
 
 int MINIDRIVER(interface_jtag_add_runtest)(int num_cycles, tap_state_t state)
 {
-	jtag_command_t **last_cmd = jtag_get_last_command_p();
-
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	(*last_cmd)->next = NULL;
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->type = JTAG_RUNTEST;
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
 
-	(*last_cmd)->cmd.runtest = cmd_queue_alloc(sizeof(runtest_command_t));
-	(*last_cmd)->cmd.runtest->num_cycles = num_cycles;
-	(*last_cmd)->cmd.runtest->end_state = state;
+	jtag_queue_command(cmd);
 
+	cmd->type = JTAG_RUNTEST;
+
+	cmd->cmd.runtest = cmd_queue_alloc(sizeof(runtest_command_t));
+	cmd->cmd.runtest->num_cycles = num_cycles;
+	cmd->cmd.runtest->end_state = state;
+
 	return ERROR_OK;
 }
 
@@ -1120,16 +1117,16 @@
 
 int MINIDRIVER(interface_jtag_add_clocks)( int num_cycles )
 {
-	jtag_command_t **last_cmd = jtag_get_last_command_p();
-
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	(*last_cmd)->next = NULL;
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->type = JTAG_STABLECLOCKS;
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
 
-	(*last_cmd)->cmd.stableclocks = cmd_queue_alloc(sizeof(stableclocks_command_t));
-	(*last_cmd)->cmd.stableclocks->num_cycles = num_cycles;
+	jtag_queue_command(cmd);
+
+	cmd->type = JTAG_STABLECLOCKS;
+
+	cmd->cmd.stableclocks = cmd_queue_alloc(sizeof(stableclocks_command_t));
+	cmd->cmd.stableclocks->num_cycles = num_cycles;
+
 	return ERROR_OK;
 }
 
@@ -1260,18 +1257,17 @@
 
 int MINIDRIVER(interface_jtag_add_reset)(int req_trst, int req_srst)
 {
-	jtag_command_t **last_cmd = jtag_get_last_command_p();
-
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	(*last_cmd)->next = NULL;
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->type = JTAG_RESET;
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
 
-	(*last_cmd)->cmd.reset = cmd_queue_alloc(sizeof(reset_command_t));
-	(*last_cmd)->cmd.reset->trst = req_trst;
-	(*last_cmd)->cmd.reset->srst = req_srst;
+	jtag_queue_command(cmd);
 
+	cmd->type = JTAG_RESET;
+
+	cmd->cmd.reset = cmd_queue_alloc(sizeof(reset_command_t));
+	cmd->cmd.reset->trst = req_trst;
+	cmd->cmd.reset->srst = req_srst;
+
 	return ERROR_OK;
 }
 
@@ -1286,17 +1282,16 @@
 
 int MINIDRIVER(interface_jtag_add_sleep)(u32 us)
 {
-	jtag_command_t **last_cmd = jtag_get_last_command_p();
-
 	/* allocate memory for a new list member */
-	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	(*last_cmd)->next = NULL;
-	last_comand_pointer = &((*last_cmd)->next);
-	(*last_cmd)->type = JTAG_SLEEP;
+	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
 
-	(*last_cmd)->cmd.sleep = cmd_queue_alloc(sizeof(sleep_command_t));
-	(*last_cmd)->cmd.sleep->us = us;
+	jtag_queue_command(cmd);
 
+	cmd->type = JTAG_SLEEP;
+
+	cmd->cmd.sleep = cmd_queue_alloc(sizeof(sleep_command_t));
+	cmd->cmd.sleep->us = us;
+
 	return ERROR_OK;
 }
 



From kc8apf at mail.berlios.de  Mon May 18 19:29:19 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:29:19 +0200
Subject: [Openocd-svn] r1822 - trunk/src/svf
Message-ID: <200905181729.n4IHTJbq018852@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:29:18 +0200 (Mon, 18 May 2009)
New Revision: 1822

Modified:
   trunk/src/svf/svf.c
Log:
Add jtag_queue_command() by Michael Bruck <mbruck at digenius.de> [8/8]

Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-18 17:29:01 UTC (rev 1821)
+++ trunk/src/svf/svf.c	2009-05-18 17:29:18 UTC (rev 1822)
@@ -695,9 +695,8 @@
 }
 
 // not good to use this
-extern jtag_command_t** jtag_get_last_command_p(void);
 extern void* cmd_queue_alloc(size_t size);
-extern jtag_command_t **last_comand_pointer;
+extern void jtag_queue_command(jtag_command_t * cmd);
 
 static int svf_run_command(struct command_context_s *cmd_ctx, char *cmd_str)
 {
@@ -707,9 +706,6 @@
 	// tmp variable
 	int i_tmp;
 
-	// not good to use this
-	jtag_command_t **last_cmd;
-
 	// for RUNTEST
 	int run_count;
 	float min_time, max_time;
@@ -1180,15 +1176,15 @@
 				// enter into run_state if necessary
 				if (last_state != svf_para.runtest_run_state)
 				{
-					last_cmd = jtag_get_last_command_p();
-					*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-					last_comand_pointer = &((*last_cmd)->next);
-					(*last_cmd)->next = NULL;
-					(*last_cmd)->type = JTAG_STATEMOVE;
-					(*last_cmd)->cmd.statemove = cmd_queue_alloc(sizeof(statemove_command_t));
-					(*last_cmd)->cmd.statemove->end_state = svf_para.runtest_run_state;
+					jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+					
+					jtag_queue_command(cmd);
+				
+					cmd->type = JTAG_STATEMOVE;
+					cmd->cmd.statemove = cmd_queue_alloc(sizeof(statemove_command_t));
+					cmd->cmd.statemove->end_state = svf_para.runtest_run_state;
 
-					cmd_queue_end_state = cmd_queue_cur_state = (*last_cmd)->cmd.statemove->end_state;
+					cmd_queue_end_state = cmd_queue_cur_state = cmd->cmd.statemove->end_state;
 				}
 
 				// call jtag_add_clocks
@@ -1197,15 +1193,14 @@
 				if (svf_para.runtest_end_state != svf_para.runtest_run_state)
 				{
 					// move to end_state
-					last_cmd = jtag_get_last_command_p();
-					*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-					last_comand_pointer = &((*last_cmd)->next);
-					(*last_cmd)->next = NULL;
-					(*last_cmd)->type = JTAG_STATEMOVE;
-					(*last_cmd)->cmd.statemove = cmd_queue_alloc(sizeof(statemove_command_t));
-					(*last_cmd)->cmd.statemove->end_state = svf_para.runtest_end_state;
+					jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+					
+					jtag_queue_command(cmd);
+					cmd->type = JTAG_STATEMOVE;
+					cmd->cmd.statemove = cmd_queue_alloc(sizeof(statemove_command_t));
+					cmd->cmd.statemove->end_state = svf_para.runtest_end_state;
 
-					cmd_queue_end_state = cmd_queue_cur_state = (*last_cmd)->cmd.statemove->end_state;
+					cmd_queue_end_state = cmd_queue_cur_state = cmd->cmd.statemove->end_state;
 				}
 				last_state = svf_para.runtest_end_state;
 #else
@@ -1294,15 +1289,15 @@
 			if (svf_tap_state_is_stable(state))
 			{
 				// TODO: move to state
-				last_cmd = jtag_get_last_command_p();
-				*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-				last_comand_pointer = &((*last_cmd)->next);
-				(*last_cmd)->next = NULL;
-				(*last_cmd)->type = JTAG_STATEMOVE;
-				(*last_cmd)->cmd.statemove = cmd_queue_alloc(sizeof(statemove_command_t));
-				(*last_cmd)->cmd.statemove->end_state = state;
+				jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+					
+				jtag_queue_command(cmd);
+				
+				cmd->type = JTAG_STATEMOVE;
+				cmd->cmd.statemove = cmd_queue_alloc(sizeof(statemove_command_t));
+				cmd->cmd.statemove->end_state = state;
 
-				cmd_queue_end_state = cmd_queue_cur_state = (*last_cmd)->cmd.statemove->end_state;
+				cmd_queue_end_state = cmd_queue_cur_state = cmd->cmd.statemove->end_state;
 				last_state = state;
 
 				LOG_DEBUG("\tmove to %s by state_move", svf_tap_state_name[state]);



From kc8apf at mail.berlios.de  Mon May 18 19:30:00 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:30:00 +0200
Subject: [Openocd-svn] r1823 - trunk/src/jtag
Message-ID: <200905181730.n4IHU05Q020003@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:29:59 +0200 (Mon, 18 May 2009)
New Revision: 1823

Modified:
   trunk/src/jtag/jtag.c
Log:
Change last_comand_pointer to last_command_pointer by Michael Bruck <mbruck at digenius.de>

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:29:18 UTC (rev 1822)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:29:59 UTC (rev 1823)
@@ -89,7 +89,7 @@
 
 
 jtag_command_t *jtag_command_queue = NULL;
-jtag_command_t **last_comand_pointer = &jtag_command_queue;
+jtag_command_t **last_command_pointer = &jtag_command_queue;
 static jtag_tap_t *jtag_all_taps = NULL;
 
 enum reset_types jtag_reset_config = RESET_NONE;
@@ -436,7 +436,7 @@
 
 	return &cmd->next;*/
 
-	return last_comand_pointer;
+	return last_command_pointer;
 }
 
 
@@ -450,7 +450,7 @@
 
 	(*last_cmd)->next = NULL;
 
-	last_comand_pointer = &((*last_cmd)->next);
+	last_command_pointer = &((*last_cmd)->next);
 }
 
 
@@ -1557,7 +1557,7 @@
 	jtag_callback_queue_tail = NULL;
 
 	jtag_command_queue = NULL;
-	last_comand_pointer = &jtag_command_queue;
+	last_command_pointer = &jtag_command_queue;
 
 	return retval;
 }



From kc8apf at mail.berlios.de  Mon May 18 19:40:43 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:40:43 +0200
Subject: [Openocd-svn] r1824 - trunk/src/jtag
Message-ID: <200905181740.n4IHehbU030379@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:40:42 +0200 (Mon, 18 May 2009)
New Revision: 1824

Modified:
   trunk/src/jtag/jtag.c
Log:
Fix fallout from r1818

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:29:59 UTC (rev 1823)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:40:42 UTC (rev 1824)
@@ -868,7 +868,7 @@
 	}
 
 	/* field_count represents the true number of fields setup*/
-	(*last_cmd)->cmd.scan->num_fields = field_count;
+	cmd->cmd.scan->num_fields = field_count;
 	return ERROR_OK;
 }
 



From kc8apf at mail.berlios.de  Mon May 18 19:41:28 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:41:28 +0200
Subject: [Openocd-svn] r1825 - trunk/src/jtag
Message-ID: <200905181741.n4IHfSxT030844@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:41:27 +0200 (Mon, 18 May 2009)
New Revision: 1825

Modified:
   trunk/src/jtag/ft2232.c
Log:
FT2232 support for non-7-cycle state moves by Dick Hollenbeck <dick at softplc.com>

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-18 17:40:42 UTC (rev 1824)
+++ trunk/src/jtag/ft2232.c	2009-05-18 17:41:27 UTC (rev 1825)
@@ -5,6 +5,9 @@
 *   Copyright (C) 2008 by Spencer Oliver                                  *
 *   spen at spen-soft.co.uk                                                  *
 *                                                                         *
+*   Copyright (C) 2009 by SoftPLC Corporation.  http://softplc.com        *
+*	Dick Hollenbeck <dick at softplc.com>                                    *
+*                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
@@ -26,6 +29,9 @@
  * found here:
  * http://www.ftdichip.com/Documents/AppNotes/AN2232C-01_MPSSE_Cmnd.pdf
  * Hereafter this is called the "MPSSE Spec".
+ *
+ * The datasheet for the ftdichip.com's FT2232D part is here:
+ * http://www.ftdichip.com/Documents/DataSheets/DS_FT2232D.pdf
  */
 
 
@@ -41,7 +47,14 @@
 #include <windows.h>
 #endif
 
+#include <assert.h>
 
+#if (BUILD_FT2232_FTD2XX==1 && BUILD_FT2232_LIBFTDI==1)
+#error "BUILD_FT2232_FTD2XX && BUILD_FT2232_LIBFTDI are mutually exclusive"
+#elif(BUILD_FT2232_FTD2XX!=1 && BUILD_FT2232_LIBFTDI!=1)
+#error "BUILD_FT2232_FTD2XX || BUILD_FT2232_LIBFTDI must be chosen"
+#endif
+
 /* FT2232 access library includes */
 #if BUILD_FT2232_FTD2XX == 1
 #include <ftd2xx.h>
@@ -49,6 +62,9 @@
 #include <ftdi.h>
 #endif
 
+/* max TCK for the high speed devices 30000 kHz */
+#define	FTDI_2232H_4232H_MAX_TCK	30000
+
 static int ft2232_execute_queue(void);
 
 static int ft2232_speed(int speed);
@@ -76,12 +92,14 @@
 static int ft2232_stableclocks(int num_cycles, jtag_command_t* cmd);
 
 
-static char *        ft2232_device_desc_A = NULL;
-static char*         ft2232_device_desc = NULL;
-static char*         ft2232_serial  = NULL;
-static char*         ft2232_layout  = NULL;
-static unsigned char ft2232_latency = 2;
+static char *       ft2232_device_desc_A = NULL;
+static char*        ft2232_device_desc = NULL;
+static char*        ft2232_serial  = NULL;
+static char*        ft2232_layout  = NULL;
+static u8	 		ft2232_latency = 2;
+static unsigned 		ft2232_max_tck = 6000;
 
+
 #define MAX_USB_IDS 8
 /* vid = pid = 0 marks the end of the list */
 static u16 ft2232_vid[MAX_USB_IDS + 1] = { 0x0403, 0 };
@@ -103,9 +121,9 @@
 static int  turtle_init(void);
 static int  comstick_init(void);
 static int  stm32stick_init(void);
-static int  axm0432_jtag_init(void);
-static int sheevaplug_init(void);
-static int icebear_jtag_init(void);
+static int	axm0432_jtag_init(void);
+static int 	sheevaplug_init(void);
+static int 	icebear_jtag_init(void);
 
 /* reset procedures for supported layouts */
 static void usbjtag_reset(int trst, int srst);
@@ -124,7 +142,7 @@
 static void flyswatter_jtag_blink(void);
 static void turtle_jtag_blink(void);
 
-ft2232_layout_t            ft2232_layouts[] =
+ft2232_layout_t  ft2232_layouts[] =
 {
 	{ "usbjtag",              usbjtag_init,              usbjtag_reset,      NULL                    },
 	{ "jtagkey",              jtagkey_init,              jtagkey_reset,      NULL                    },
@@ -152,7 +170,7 @@
 static u8                  high_direction = 0x0;
 
 #if BUILD_FT2232_FTD2XX == 1
-static FT_HANDLE           ftdih = NULL;
+static FT_HANDLE 	ftdih = NULL;
 #elif BUILD_FT2232_LIBFTDI == 1
 static struct ftdi_context ftdic;
 #endif
@@ -161,15 +179,143 @@
 static jtag_command_t* first_unsent;        /* next command that has to be sent */
 static int             require_send;
 
+
+/*	http://urjtag.wiki.sourceforge.net/Cable+FT2232 says:
+
+	"There is a significant difference between libftdi and libftd2xx. The latter
+	one allows to schedule up to 64*64 bytes of result data while libftdi fails
+	with more than 4*64. As a consequence, the FT2232 driver is forced to
+	perform around 16x more USB transactions for long command streams with TDO
+	capture when running with libftdi."
+
+	No idea how we get
+	#define FT2232_BUFFER_SIZE 131072
+	a comment would have been nice.
+*/
+
+#define FT2232_BUFFER_SIZE 131072
+
 static u8*             ft2232_buffer = NULL;
 static int             ft2232_buffer_size  = 0;
 static int             ft2232_read_pointer = 0;
 static int             ft2232_expect_read  = 0;
 
-#define FT2232_BUFFER_SIZE 131072
-#define BUFFER_ADD         ft2232_buffer[ft2232_buffer_size++]
-#define BUFFER_READ        ft2232_buffer[ft2232_read_pointer++]
+/**
+ * Function buffer_write
+ * writes a byte into the byte buffer, "ft2232_buffer", which must be sent later.
+ * @param val is the byte to send.
+ */
+static inline void buffer_write( u8 val )
+{
+	assert( ft2232_buffer );
+	assert( (unsigned) ft2232_buffer_size < (unsigned) FT2232_BUFFER_SIZE );
+	ft2232_buffer[ft2232_buffer_size++] = val;
+}
 
+/**
+ * Function buffer_read
+ * returns a byte from the byte buffer.
+ */
+static inline u8 buffer_read(void)
+{
+	assert( ft2232_buffer );
+	assert( ft2232_read_pointer < ft2232_buffer_size );
+	return ft2232_buffer[ft2232_read_pointer++];
+}
+
+
+/**
+ * Function clock_tms
+ * clocks out \a bit_count bits on the TMS line, starting with the least
+ * significant bit of tms_bits and progressing to more significant bits.
+ * Rigorous state transition logging is done here via tap_set_state().
+ *
+ * @param pmsse_cmd is one of the MPSSE TMS oriented commands such as 0x4b or 0x6b.  See
+ *   the MPSSE spec referenced above for their functionality. The MPSSE command
+ *   "Clock Data to TMS/CS Pin (no Read)" is often used for this, 0x4b.
+ *
+ * @param tms_bits holds the sequence of bits to send.
+ * @param tms_count tells how many bits in the sequence.
+ * @param tdi_bit is a single bit which is passed on to TDI before the first TCK cycle
+ *   and is held static for the duration of TMS clocking.  See the MPSSE spec referenced above.
+ */
+static void clock_tms( u8 mpsse_cmd, int tms_bits, int tms_count, bool tdi_bit )
+{
+	u8	tms_byte;
+	int	i;
+	int	tms_ndx;				/* bit index into tms_byte */
+
+	assert( tms_count > 0 );
+
+//	LOG_DEBUG("mpsse cmd=%02x, tms_bits=0x%08x, bit_count=%d", mpsse_cmd, tms_bits, tms_count );
+
+	for (tms_byte = tms_ndx = i = 0;   i < tms_count;   ++i, tms_bits>>=1)
+	{
+		bool bit = tms_bits & 1;
+
+		if(bit)
+			tms_byte |= (1<<tms_ndx);
+
+		/* always do state transitions in public view */
+		tap_set_state( tap_state_transition(tap_get_state(), bit) );
+
+		/* 	we wrote a bit to tms_byte just above, increment bit index.  if bit was zero
+			also increment.
+		*/
+		++tms_ndx;
+
+		if( tms_ndx==7  || i==tms_count-1 )
+		{
+			buffer_write( mpsse_cmd );
+			buffer_write( tms_ndx - 1 );
+
+			/* 	Bit 7 of the byte is passed on to TDI/DO before the first TCK/SK of
+				TMS/CS and is held static for the duration of TMS/CS clocking.
+			*/
+			buffer_write( tms_byte | (tdi_bit << 7) );
+		}
+	}
+}
+
+
+/**
+ * Function get_tms_buffer_requirements
+ * returns what clock_tms() will consume if called with
+ * same \a bit_count.
+ */
+static inline int get_tms_buffer_requirements( int bit_count )
+{
+	return ((bit_count + 6)/7) * 3;
+}
+
+
+/**
+ * Function move_to_state
+ * moves the TAP controller from the current state to a
+ * \a goal_state through a path given by tap_get_tms_path().  State transition
+ * logging is performed by delegation to clock_tms().
+ *
+ * @param goal_state is the destination state for the move.
+ */
+static void move_to_state( tap_state_t goal_state )
+{
+	tap_state_t 	start_state = tap_get_state();
+
+	/* 	goal_state is 1/2 of a tuple/pair of states which allow convenient
+		lookup of the required TMS pattern to move to this state from the
+		start state.
+	*/
+
+	/* do the 2 lookups */
+	int tms_bits  = tap_get_tms_path(start_state, goal_state);
+	int tms_count = tap_get_tms_path_len(start_state, goal_state);
+
+	DEBUG_JTAG_IO( "start=%s goal=%s", tap_state_name(start_state), tap_state_name(goal_state) );
+
+	clock_tms( 0x4b,  tms_bits, tms_count, 0 );
+}
+
+
 jtag_interface_t ft2232_interface =
 {
 	.name               = "ft2232",
@@ -186,7 +332,7 @@
 {
 #if BUILD_FT2232_FTD2XX == 1
 	FT_STATUS status;
-	DWORD     dw_bytes_written;
+	DWORD     	dw_bytes_written;
 	if ( ( status = FT_Write(ftdih, buf, size, &dw_bytes_written) ) != FT_OK )
 	{
 		*bytes_written = dw_bytes_written;
@@ -269,7 +415,7 @@
 	int retval;
 	u32 bytes_written;
 
-	buf[0] = 0x86;                  /* command "set divisor" */
+	buf[0] = 0x86;                  	/* command "set divisor" */
 	buf[1] = speed & 0xff;          /* valueL (0=6MHz, 1=3MHz, 2=2.0MHz, ...*/
 	buf[2] = (speed >> 8) & 0xff;   /* valueH */
 
@@ -290,7 +436,7 @@
 	 * AN2232C-01 Command Processor for
 	 * MPSSE and MCU Host Bus. Chapter 3.8 */
 
-	*khz = 6000 / (1 + speed);
+	*khz = ft2232_max_tck / (1 + speed);
 
 	return ERROR_OK;
 }
@@ -311,9 +457,9 @@
 	 * We will calc here with a multiplier
 	 * of 10 for better rounding later. */
 
-	/* Calc speed, (6000 / khz) - 1 */
+	/* Calc speed, (ft2232_max_tck / khz) - 1 */
 	/* Use 65000 for better rounding */
-	*jtag_speed = (60000 / khz) - 10;
+	*jtag_speed = ((ft2232_max_tck*10) / khz) - 10;
 
 	/* Add 0.9 for rounding */
 	*jtag_speed += 9;
@@ -359,7 +505,7 @@
 		tap_set_end_state(state);
 	else
 	{
-		LOG_ERROR("BUG: %i is not a valid end state", state);
+		LOG_ERROR("BUG: %s is not a stable end state", tap_state_name(state));
 		exit(-1);
 	}
 }
@@ -373,19 +519,19 @@
 
 	while (num_bytes-- > 1)
 	{
-		buffer[cur_byte] = BUFFER_READ;
-		cur_byte++;
+		buffer[cur_byte++] = buffer_read();
 		bits_left -= 8;
 	}
 
 	buffer[cur_byte] = 0x0;
 
+	/* There is one more partial byte left from the clock data in/out instructions */ 
 	if (bits_left > 1)
 	{
-		buffer[cur_byte] = BUFFER_READ >> 1;
+		buffer[cur_byte] = buffer_read() >> 1;
 	}
-
-	buffer[cur_byte] = ( buffer[cur_byte] | ( (BUFFER_READ & 0x02) << 6 ) ) >> (8 - bits_left);
+	/* This shift depends on the length of the clock data to tms instruction, insterted at end of the scan, now fixed to a two step transition in ft2232_add_scan */
+	buffer[cur_byte] = ( buffer[cur_byte] | ( ( (buffer_read()) << 1 ) & 0x80 )) >> (8 - bits_left);
 }
 
 
@@ -529,46 +675,44 @@
 }
 
 
-static void ft2232_add_pathmove(pathmove_command_t* cmd)
+/**
+ * Function ft2232_add_pathmove
+ * moves the TAP controller from the current state to a new state through the
+ * given path, where path is an array of tap_state_t's.
+ *
+ * @param path is an array of tap_stat_t which gives the states to traverse through
+ *   ending with the last state at path[num_states-1]
+ * @param num_states is the count of state steps to move through
+ */
+static void ft2232_add_pathmove( tap_state_t* path, int num_states )
 {
-	int num_states = cmd->num_states;
-	int state_count = 0;
+	int			tms_bits = 0;
+	int			state_ndx;
+	tap_state_t	walker = tap_get_state();
 
-	while (num_states)
+	assert( (unsigned) num_states <= 32u );		/* tms_bits only holds 32 bits */
+
+	/* this loop verifies that the path is legal and logs each state in the path */
+	for( state_ndx = 0; state_ndx < num_states;  ++state_ndx )
 	{
-		u8  tms_byte = 0;       /* zero this on each MPSSE batch */
+		tap_state_t	desired_next_state = path[state_ndx];
 
-		int bit_count = 0;
-
-		int num_states_batch = num_states > 7 ? 7 : num_states;
-
-		/* command "Clock Data to TMS/CS Pin (no Read)" */
-		BUFFER_ADD = 0x4b;
-
-		/* number of states remaining */
-		BUFFER_ADD = num_states_batch - 1;
-
-		while (num_states_batch--)
+		if (tap_state_transition(walker, false) == desired_next_state )
+			;	/* bit within tms_bits at index state_ndx is already zero */
+		else if (tap_state_transition(walker, true) == desired_next_state )
+			tms_bits |= (1<<state_ndx);
+		else
 		{
-			if (tap_state_transition(tap_get_state(), false) == cmd->path[state_count])
-				buf_set_u32(&tms_byte, bit_count++, 1, 0x0);
-			else if (tap_state_transition(tap_get_state(), true) == cmd->path[state_count])
-				buf_set_u32(&tms_byte, bit_count++, 1, 0x1);
-			else
-			{
-				LOG_ERROR( "BUG: %s -> %s isn't a valid TAP transition", tap_state_name(
-								 tap_get_state() ), tap_state_name(cmd->path[state_count]) );
-				exit(-1);
-			}
-
-			tap_set_state(cmd->path[state_count]);
-			state_count++;
-			num_states--;
+			LOG_ERROR( "BUG: %s -> %s isn't a valid TAP transition",
+					tap_state_name(walker), tap_state_name(desired_next_state) );
+			exit(-1);
 		}
 
-		BUFFER_ADD = tms_byte;
+		walker = desired_next_state;
 	}
-	
+
+	clock_tms( 0x4b,  tms_bits, num_states, 0 );
+
 	tap_set_end_state(tap_get_state());
 }
 
@@ -580,26 +724,19 @@
 	int cur_byte  = 0;
 	int last_bit;
 
-	if ( !( ( !ir_scan && (tap_get_state() == TAP_DRSHIFT) )
-	   || (    ir_scan && (tap_get_state() == TAP_IRSHIFT) ) ) )
+	if ( !ir_scan )
 	{
-		/* command "Clock Data to TMS/CS Pin (no Read)" */
-		BUFFER_ADD = 0x4b;
-
-		BUFFER_ADD = 0x6;       /* scan 7 bits */
-
-		/* TMS data bits */
-		if (ir_scan)
+		if (tap_get_state() != TAP_DRSHIFT)
 		{
-			BUFFER_ADD = tap_get_tms_path(tap_get_state(), TAP_IRSHIFT);
-			tap_set_state(TAP_IRSHIFT);
+			move_to_state( TAP_DRSHIFT );
 		}
-		else
+	}
+	else
+	{
+		if (tap_get_state() != TAP_IRSHIFT)
 		{
-			BUFFER_ADD = tap_get_tms_path(tap_get_state(), TAP_DRSHIFT);
-			tap_set_state(TAP_DRSHIFT);
+			move_to_state( TAP_IRSHIFT );
 		}
-		/* LOG_DEBUG("added TMS scan (no read)"); */
 	}
 
 	/* add command for complete bytes */
@@ -609,34 +746,34 @@
 		if (type == SCAN_IO)
 		{
 			/* Clock Data Bytes In and Out LSB First */
-			BUFFER_ADD = 0x39;
+			buffer_write( 0x39 );
 			/* LOG_DEBUG("added TDI bytes (io %i)", num_bytes); */
 		}
 		else if (type == SCAN_OUT)
 		{
 			/* Clock Data Bytes Out on -ve Clock Edge LSB First (no Read) */
-			BUFFER_ADD = 0x19;
+			buffer_write( 0x19 );
 			/* LOG_DEBUG("added TDI bytes (o)"); */
 		}
 		else if (type == SCAN_IN)
 		{
 			/* Clock Data Bytes In on +ve Clock Edge LSB First (no Write) */
-			BUFFER_ADD = 0x28;
+			buffer_write( 0x28 );
 			/* LOG_DEBUG("added TDI bytes (i %i)", num_bytes); */
 		}
 
 		thisrun_bytes = (num_bytes > 65537) ? 65536 : (num_bytes - 1);
 		num_bytes    -= thisrun_bytes;
-		BUFFER_ADD    = (thisrun_bytes - 1) & 0xff;
-		BUFFER_ADD    = ( (thisrun_bytes - 1) >> 8 ) & 0xff;
 
+		buffer_write( (u8) (thisrun_bytes - 1) );
+		buffer_write( (u8) ((thisrun_bytes - 1) >> 8) );
+
 		if (type != SCAN_IN)
 		{
 			/* add complete bytes */
 			while (thisrun_bytes-- > 0)
 			{
-				BUFFER_ADD = buffer[cur_byte];
-				cur_byte++;
+				buffer_write( buffer[cur_byte++] );
 				bits_left -= 8;
 			}
 		}
@@ -658,24 +795,25 @@
 		if (type == SCAN_IO)
 		{
 			/* Clock Data Bits In and Out LSB First */
-			BUFFER_ADD = 0x3b;
+			buffer_write( 0x3b );
 			/* LOG_DEBUG("added TDI bits (io) %i", bits_left - 1); */
 		}
 		else if (type == SCAN_OUT)
 		{
 			/* Clock Data Bits Out on -ve Clock Edge LSB First (no Read) */
-			BUFFER_ADD = 0x1b;
+			buffer_write( 0x1b );
 			/* LOG_DEBUG("added TDI bits (o)"); */
 		}
 		else if (type == SCAN_IN)
 		{
 			/* Clock Data Bits In on +ve Clock Edge LSB First (no Write) */
-			BUFFER_ADD = 0x2a;
+			buffer_write( 0x2a );
 			/* LOG_DEBUG("added TDI bits (i %i)", bits_left - 1); */
 		}
-		BUFFER_ADD = bits_left - 2;
+
+		buffer_write( bits_left - 2 );
 		if (type != SCAN_IN)
-			BUFFER_ADD = buffer[cur_byte];
+			buffer_write( buffer[cur_byte] );
 	}
 
 	if ( (  ir_scan && (tap_get_end_state() == TAP_IRSHIFT) )
@@ -684,44 +822,57 @@
 		if (type == SCAN_IO)
 		{
 			/* Clock Data Bits In and Out LSB First */
-			BUFFER_ADD = 0x3b;
+			buffer_write( 0x3b );
 			/* LOG_DEBUG("added TDI bits (io) %i", bits_left - 1); */
 		}
 		else if (type == SCAN_OUT)
 		{
 			/* Clock Data Bits Out on -ve Clock Edge LSB First (no Read) */
-			BUFFER_ADD = 0x1b;
+			buffer_write( 0x1b );
 			/* LOG_DEBUG("added TDI bits (o)"); */
 		}
 		else if (type == SCAN_IN)
 		{
 			/* Clock Data Bits In on +ve Clock Edge LSB First (no Write) */
-			BUFFER_ADD = 0x2a;
+			buffer_write( 0x2a );
 			/* LOG_DEBUG("added TDI bits (i %i)", bits_left - 1); */
 		}
-		BUFFER_ADD = 0x0;
-		BUFFER_ADD = last_bit;
+		buffer_write( 0x0 );
+		buffer_write( last_bit );
 	}
 	else
 	{
+		int tms_bits;
+		int tms_count;
+		u8	mpsse_cmd;
+
 		/* move from Shift-IR/DR to end state */
 		if (type != SCAN_OUT)
 		{
+			/* We always go to the PAUSE state in two step at the end of an IN or IO scan */
+			/* This must be coordinated with the bit shifts in ft2232_read_scan    */
+			tms_bits  = 0x01;
+			tms_count = 2;
 			/* Clock Data to TMS/CS Pin with Read */
-			BUFFER_ADD = 0x6b;
+			mpsse_cmd = 0x6b;
 			/* LOG_DEBUG("added TMS scan (read)"); */
 		}
 		else
 		{
+			tms_bits  = tap_get_tms_path( tap_get_state(), tap_get_end_state() );
+			tms_count = tap_get_tms_path_len( tap_get_state(), tap_get_end_state() );
 			/* Clock Data to TMS/CS Pin (no Read) */
-			BUFFER_ADD = 0x4b;
+			mpsse_cmd = 0x4b;
 			/* LOG_DEBUG("added TMS scan (no read)"); */
 		}
-		BUFFER_ADD = 0x6;   /* scan 7 bits */
 
-		BUFFER_ADD = tap_get_tms_path( tap_get_state(), tap_get_end_state() ) | (last_bit << 7);
-		tap_set_state( tap_get_end_state() );
+		clock_tms( mpsse_cmd, tms_bits, tms_count, last_bit );
 	}
+	
+	if (tap_get_state() != tap_get_end_state())
+	{
+		move_to_state( tap_get_end_state() );
+	}
 }
 
 
@@ -746,14 +897,7 @@
 
 	if (tap_get_state() != TAP_DRSHIFT)
 	{
-		/* command "Clock Data to TMS/CS Pin (no Read)" */
-		BUFFER_ADD = 0x4b;
-
-		BUFFER_ADD = 0x6;       /* scan 7 bits */
-
-		/* TMS data bits */
-		BUFFER_ADD = tap_get_tms_path(tap_get_state(), TAP_DRSHIFT);
-		tap_set_state(TAP_DRSHIFT);
+		move_to_state( TAP_DRSHIFT );
 	}
 
 	if ( ( retval = ft2232_write(ft2232_buffer, ft2232_buffer_size, &bytes_written) ) != ERROR_OK )
@@ -772,34 +916,34 @@
 		if (type == SCAN_IO)
 		{
 			/* Clock Data Bytes In and Out LSB First */
-			BUFFER_ADD = 0x39;
+			buffer_write( 0x39 );
 			/* LOG_DEBUG("added TDI bytes (io %i)", num_bytes); */
 		}
 		else if (type == SCAN_OUT)
 		{
 			/* Clock Data Bytes Out on -ve Clock Edge LSB First (no Read) */
-			BUFFER_ADD = 0x19;
+			buffer_write( 0x19 );
 			/* LOG_DEBUG("added TDI bytes (o)"); */
 		}
 		else if (type == SCAN_IN)
 		{
 			/* Clock Data Bytes In on +ve Clock Edge LSB First (no Write) */
-			BUFFER_ADD = 0x28;
+			buffer_write( 0x28 );
 			/* LOG_DEBUG("added TDI bytes (i %i)", num_bytes); */
 		}
 
 		thisrun_bytes = (num_bytes > 65537) ? 65536 : (num_bytes - 1);
 		thisrun_read  = thisrun_bytes;
 		num_bytes    -= thisrun_bytes;
-		BUFFER_ADD    = (thisrun_bytes - 1) & 0xff;
-		BUFFER_ADD    = ( (thisrun_bytes - 1) >> 8 ) & 0xff;
+		buffer_write( (u8) (thisrun_bytes - 1) );
+		buffer_write( (u8) ( (thisrun_bytes - 1) >> 8 ));
 
 		if (type != SCAN_IN)
 		{
 			/* add complete bytes */
 			while (thisrun_bytes-- > 0)
 			{
-				BUFFER_ADD = buffer[cur_byte];
+				buffer_write( buffer[cur_byte] );
 				cur_byte++;
 				bits_left -= 8;
 			}
@@ -843,24 +987,24 @@
 		if (type == SCAN_IO)
 		{
 			/* Clock Data Bits In and Out LSB First */
-			BUFFER_ADD = 0x3b;
+			buffer_write( 0x3b );
 			/* LOG_DEBUG("added TDI bits (io) %i", bits_left - 1); */
 		}
 		else if (type == SCAN_OUT)
 		{
 			/* Clock Data Bits Out on -ve Clock Edge LSB First (no Read) */
-			BUFFER_ADD = 0x1b;
+			buffer_write( 0x1b );
 			/* LOG_DEBUG("added TDI bits (o)"); */
 		}
 		else if (type == SCAN_IN)
 		{
 			/* Clock Data Bits In on +ve Clock Edge LSB First (no Write) */
-			BUFFER_ADD = 0x2a;
+			buffer_write( 0x2a );
 			/* LOG_DEBUG("added TDI bits (i %i)", bits_left - 1); */
 		}
-		BUFFER_ADD = bits_left - 2;
+		buffer_write( bits_left - 2 );
 		if (type != SCAN_IN)
-			BUFFER_ADD = buffer[cur_byte];
+			buffer_write( buffer[cur_byte] );
 
 		if (type != SCAN_OUT)
 			thisrun_read += 2;
@@ -871,42 +1015,45 @@
 		if (type == SCAN_IO)
 		{
 			/* Clock Data Bits In and Out LSB First */
-			BUFFER_ADD = 0x3b;
+			buffer_write( 0x3b );
 			/* LOG_DEBUG("added TDI bits (io) %i", bits_left - 1); */
 		}
 		else if (type == SCAN_OUT)
 		{
 			/* Clock Data Bits Out on -ve Clock Edge LSB First (no Read) */
-			BUFFER_ADD = 0x1b;
+			buffer_write( 0x1b );
 			/* LOG_DEBUG("added TDI bits (o)"); */
 		}
 		else if (type == SCAN_IN)
 		{
 			/* Clock Data Bits In on +ve Clock Edge LSB First (no Write) */
-			BUFFER_ADD = 0x2a;
+			buffer_write( 0x2a );
 			/* LOG_DEBUG("added TDI bits (i %i)", bits_left - 1); */
 		}
-		BUFFER_ADD = 0x0;
-		BUFFER_ADD = last_bit;
+		buffer_write( 0x0 );
+		buffer_write( last_bit );
 	}
 	else
 	{
+		int tms_bits  = tap_get_tms_path( tap_get_state(), tap_get_end_state() );
+		int tms_count = tap_get_tms_path_len( tap_get_state(), tap_get_end_state() );
+		u8	mpsse_cmd;
+
 		/* move from Shift-IR/DR to end state */
 		if (type != SCAN_OUT)
 		{
 			/* Clock Data to TMS/CS Pin with Read */
-			BUFFER_ADD = 0x6b;
+			mpsse_cmd = 0x6b;
 			/* LOG_DEBUG("added TMS scan (read)"); */
 		}
 		else
 		{
 			/* Clock Data to TMS/CS Pin (no Read) */
-			BUFFER_ADD = 0x4b;
+			mpsse_cmd = 0x4b;
 			/* LOG_DEBUG("added TMS scan (no read)"); */
 		}
-		BUFFER_ADD = 0x6;
-		BUFFER_ADD = tap_get_tms_path( tap_get_state(), tap_get_end_state() ) | (last_bit << 7);
-		tap_set_state( tap_get_end_state() );
+
+		clock_tms( mpsse_cmd, tms_bits, tms_count, last_bit );
 	}
 
 	if (type != SCAN_OUT)
@@ -941,12 +1088,13 @@
 	int num_bytes = (scan_size - 1) / 8;
 
 	if (tap_get_state() != TAP_DRSHIFT)
-		predicted_size += 3;
+		predicted_size += get_tms_buffer_requirements( tap_get_tms_path_len( tap_get_state(), TAP_DRSHIFT) );
 
 	if (type == SCAN_IN)    /* only from device to host */
 	{
 		/* complete bytes */
 		predicted_size += CEIL(num_bytes, 65536) * 3;
+
 		/* remaining bits - 1 (up to 7) */
 		predicted_size += ( (scan_size - 1) % 8 ) ? 2 : 0;
 	}
@@ -954,6 +1102,7 @@
 	{
 		/* complete bytes */
 		predicted_size += num_bytes + CEIL(num_bytes, 65536) * 3;
+
 		/* remaining bits -1 (up to 7) */
 		predicted_size += ( (scan_size - 1) % 8 ) ? 3 : 0;
 	}
@@ -1017,9 +1166,9 @@
 	}
 
 	/* command "set data bits low byte" */
-	BUFFER_ADD = 0x80;
-	BUFFER_ADD = low_output;
-	BUFFER_ADD = low_direction;
+	buffer_write( 0x80 );
+	buffer_write( low_output );
+	buffer_write( low_direction );
 }
 
 
@@ -1056,9 +1205,9 @@
 	}
 
 	/* command "set data bits high byte" */
-	BUFFER_ADD = 0x82;
-	BUFFER_ADD = high_output;
-	BUFFER_ADD = high_direction;
+	buffer_write( 0x82 );
+	buffer_write( high_output );
+	buffer_write( high_direction );
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output,
 			high_direction);
 }
@@ -1091,9 +1240,9 @@
 	}
 
 	/* command "set data bits high byte" */
-	BUFFER_ADD = 0x82;
-	BUFFER_ADD = high_output;
-	BUFFER_ADD = high_direction;
+	buffer_write( 0x82 );
+	buffer_write( high_output );
+	buffer_write( high_direction );
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output,
 			high_direction);
 }
@@ -1121,9 +1270,9 @@
 	}
 
 	/* command "set data bits low byte" */
-	BUFFER_ADD = 0x82;
-	BUFFER_ADD = high_output;
-	BUFFER_ADD = high_direction;
+	buffer_write( 0x82 );
+	buffer_write( high_output );
+	buffer_write( high_direction );
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output,
 			high_direction);
 }
@@ -1150,9 +1299,9 @@
 	}
 
 	/* command "set data bits low byte" */
-	BUFFER_ADD = 0x80;
-	BUFFER_ADD = low_output;
-	BUFFER_ADD = low_direction;
+	buffer_write( 0x80 );
+	buffer_write( low_output );
+	buffer_write( low_direction );
 	LOG_DEBUG("trst: %i, srst: %i, low_output: 0x%2.2x, low_direction: 0x%2.2x", trst, srst, low_output, low_direction);
 }
 
@@ -1171,9 +1320,9 @@
 	}
 
 	/* command "set data bits low byte" */
-	BUFFER_ADD = 0x80;
-	BUFFER_ADD = low_output;
-	BUFFER_ADD = low_direction;
+	buffer_write( 0x80 );
+	buffer_write( low_output );
+	buffer_write( low_direction );
 	LOG_DEBUG("srst: %i, low_output: 0x%2.2x, low_direction: 0x%2.2x", srst, low_output, low_direction);
 }
 
@@ -1199,9 +1348,9 @@
 	}
 
 	/* command "set data bits high byte" */
-	BUFFER_ADD = 0x82;
-	BUFFER_ADD = high_output;
-	BUFFER_ADD = high_direction;
+	buffer_write( 0x82 );
+	buffer_write( high_output );
+	buffer_write( high_direction );
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output,
 			high_direction);
 }
@@ -1228,14 +1377,14 @@
 	}
 
 	/* command "set data bits low byte" */
-	BUFFER_ADD = 0x80;
-	BUFFER_ADD = low_output;
-	BUFFER_ADD = low_direction;
+	buffer_write( 0x80 );
+	buffer_write( low_output );
+	buffer_write( low_direction );
 
 	/* command "set data bits high byte" */
-	BUFFER_ADD = 0x82;
-	BUFFER_ADD = high_output;
-	BUFFER_ADD = high_direction;
+	buffer_write( 0x82 );
+	buffer_write( high_output );
+	buffer_write( high_direction );
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output,
 			high_direction);
 }
@@ -1255,9 +1404,9 @@
 		high_output |= nSRSTnOE;
 
 	/* command "set data bits high byte" */
-	BUFFER_ADD = 0x82;
-	BUFFER_ADD = high_output;
-	BUFFER_ADD = high_direction;
+	buffer_write( 0x82 );
+	buffer_write( high_output );
+	buffer_write( high_direction );
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output, high_direction);
 }
 
@@ -1266,7 +1415,7 @@
 	int  retval;
 	retval = ERROR_OK;
 
-	DEBUG_JTAG_IO("end_state: %i", cmd->cmd.end_state->end_state);
+	DEBUG_JTAG_IO("execute_end_state: %s", tap_state_name(cmd->cmd.end_state->end_state) );
 
 	if (cmd->cmd.end_state->end_state != TAP_INVALID)
 		ft2232_end_state(cmd->cmd.end_state->end_state);
@@ -1282,9 +1431,10 @@
 	int predicted_size = 0;
 	retval = ERROR_OK;
 
-	DEBUG_JTAG_IO("runtest %i cycles, end in %i",
+	DEBUG_JTAG_IO("runtest %i cycles, end in %s",
 			cmd->cmd.runtest->num_cycles,
-			cmd->cmd.runtest->end_state);
+			tap_state_name(cmd->cmd.runtest->end_state));
+
 	/* only send the maximum buffer size that FT2232C can handle */
 	predicted_size = 0;
 	if (tap_get_state() != TAP_IDLE)
@@ -1303,27 +1453,24 @@
 	}
 	if (tap_get_state() != TAP_IDLE)
 	{
-		/* command "Clock Data to TMS/CS Pin (no Read)" */
-		BUFFER_ADD = 0x4b;
-		BUFFER_ADD = 0x6;    /* scan 7 bits */
-
-		/* TMS data bits */
-		BUFFER_ADD = tap_get_tms_path(tap_get_state(), TAP_IDLE);
-		tap_set_state(TAP_IDLE);
+		move_to_state( TAP_IDLE );
 		require_send = 1;
 	}
 	i = cmd->cmd.runtest->num_cycles;
 	while (i > 0)
 	{
+		/* there are no state transitions in this code, so omit state tracking */
+
 		/* command "Clock Data to TMS/CS Pin (no Read)" */
-		BUFFER_ADD = 0x4b;
+		buffer_write( 0x4b );
 
 		/* scan 7 bits */
-		BUFFER_ADD = (i > 7) ? 6 : (i - 1);
+		buffer_write( (i > 7) ? 6 : (i - 1) );
 
 		/* TMS data bits */
-		BUFFER_ADD = 0x0;
+		buffer_write( 0x0 );
 		tap_set_state(TAP_IDLE);
+
 		i -= (i > 7) ? 7 : i;
 		/* LOG_DEBUG("added TMS scan (no read)"); */
 	}
@@ -1333,15 +1480,9 @@
 
 	if ( tap_get_state() != tap_get_end_state() )
 	{
-		/* command "Clock Data to TMS/CS Pin (no Read)" */
-		BUFFER_ADD = 0x4b;
-		/* scan 7 bit */
-		BUFFER_ADD = 0x6;
-		/* TMS data bits */
-		BUFFER_ADD = tap_get_tms_path( tap_get_state(), tap_get_end_state() );
-		tap_set_state( tap_get_end_state() );
-		/* LOG_DEBUG("added TMS scan (no read)"); */
+		move_to_state( tap_get_end_state() );
 	}
+
 	require_send = 1;
 #ifdef _DEBUG_JTAG_IO_
 	LOG_DEBUG( "runtest: %i, end in %s", cmd->cmd.runtest->num_cycles, tap_state_name( tap_get_end_state() ) );
@@ -1350,11 +1491,11 @@
 	return retval;
 }
 
+
 static int ft2232_execute_statemove(jtag_command_t *cmd)
 {
-	int  retval;
-	int predicted_size = 0;
-	retval = ERROR_OK;
+	int 	predicted_size = 0;
+	int 	retval = ERROR_OK;
 
 	DEBUG_JTAG_IO("statemove end in %i", cmd->cmd.statemove->end_state);
 
@@ -1370,61 +1511,60 @@
 	if (cmd->cmd.statemove->end_state != TAP_INVALID)
 		ft2232_end_state(cmd->cmd.statemove->end_state);
 
-	/* command "Clock Data to TMS/CS Pin (no Read)" */
-	BUFFER_ADD = 0x4b;
+	/* move to end state */
+	if ( tap_get_state() != tap_get_end_state() )
+	{
+		move_to_state( tap_get_end_state() );
+		require_send = 1;
+	}
 
-	BUFFER_ADD = 0x6;       /* scan 7 bits */
-
-			/* TMS data bits */
-	BUFFER_ADD = tap_get_tms_path( tap_get_state(), tap_get_end_state() );
-	/* LOG_DEBUG("added TMS scan (no read)"); */
-	tap_set_state( tap_get_end_state() );
-	require_send = 1;
-#ifdef _DEBUG_JTAG_IO_
-	LOG_DEBUG( "statemove: %s", tap_state_name( tap_get_end_state() ) );
-#endif
-	
 	return retval;
 }
 
 static int ft2232_execute_pathmove(jtag_command_t *cmd)
 {
-	int  retval;
-	int predicted_size = 0;
-	retval = ERROR_OK;
+	int 	predicted_size = 0;
+	int	retval = ERROR_OK;
 
-	DEBUG_JTAG_IO("pathmove: %i states, end in %i",
-		cmd->cmd.pathmove->num_states,
-		cmd->cmd.pathmove->path[cmd->cmd.pathmove->num_states - 1]);
+	tap_state_t*	 path = cmd->cmd.pathmove->path;
+	int	num_states    = cmd->cmd.pathmove->num_states;
+
+	DEBUG_JTAG_IO("pathmove: %i states, current: %s  end: %s", num_states,
+			tap_state_name( tap_get_state() ),
+			tap_state_name( path[num_states-1] )
+			);
+
 	/* only send the maximum buffer size that FT2232C can handle */
-	predicted_size = 3 * CEIL(cmd->cmd.pathmove->num_states, 7);
+	predicted_size = 3 * CEIL(num_states, 7);
 	if (ft2232_buffer_size + predicted_size + 1 > FT2232_BUFFER_SIZE)
 	{
 		if (ft2232_send_and_recv(first_unsent, cmd) != ERROR_OK)
-		retval = ERROR_JTAG_QUEUE_FAILED;
+			retval = ERROR_JTAG_QUEUE_FAILED;
+
 		require_send = 0;
 		first_unsent = cmd;
 	}
-	ft2232_add_pathmove(cmd->cmd.pathmove);
+
+	ft2232_add_pathmove( path, num_states );
 	require_send = 1;
-#ifdef _DEBUG_JTAG_IO_
-	LOG_DEBUG( "pathmove: %i states, end in %s", cmd->cmd.pathmove->num_states,
-		tap_state_name(cmd->cmd.pathmove->path[cmd->cmd.pathmove->num_states - 1]) );
-#endif
+
 	return retval;
 }
 
+
 static int ft2232_execute_scan(jtag_command_t *cmd)
 {
-	int             retval;
 	u8*             buffer;
 	int             scan_size;                  /* size of IR or DR scan */
-	enum scan_type  type;
 	int             predicted_size = 0;
-	retval = ERROR_OK;
+	int				retval = ERROR_OK;
 
+	enum scan_type  type = jtag_scan_type(cmd->cmd.scan);
+
+	DEBUG_JTAG_IO( "%s type:%d", cmd->cmd.scan->ir_scan ? "IRSCAN" : "DRSCAN", type );
+
 	scan_size = jtag_build_buffer(cmd->cmd.scan, &buffer);
-	type = jtag_scan_type(cmd->cmd.scan);
+
 	predicted_size = ft2232_predict_scan_out(scan_size, type);
 	if ( (predicted_size + 1) > FT2232_BUFFER_SIZE )
 	{
@@ -1544,17 +1684,17 @@
 
 	switch (cmd->type)
 	{
-		case JTAG_END_STATE: retval = ft2232_execute_end_state(cmd); break;
-		case JTAG_RESET:	 retval = ft2232_execute_reset(cmd); break;
-		case JTAG_RUNTEST:   retval = ft2232_execute_runtest(cmd); break;
-		case JTAG_STATEMOVE: retval = ft2232_execute_statemove(cmd); break;
-		case JTAG_PATHMOVE:  retval = ft2232_execute_pathmove(cmd); break;
-		case JTAG_SCAN: 	 retval = ft2232_execute_scan(cmd); break;
-		case JTAG_SLEEP:	 retval = ft2232_execute_sleep(cmd); break;
-		case JTAG_STABLECLOCKS: retval = ft2232_execute_stableclocks(cmd); break;
-		default:
-			LOG_ERROR("BUG: unknown JTAG command type encountered");
-			exit(-1);	
+	case JTAG_END_STATE: 	retval = ft2232_execute_end_state(cmd); break;
+	case JTAG_RESET:	 		retval = ft2232_execute_reset(cmd); break;
+	case JTAG_RUNTEST:   	retval = ft2232_execute_runtest(cmd); break;
+	case JTAG_STATEMOVE: 	retval = ft2232_execute_statemove(cmd); break;
+	case JTAG_PATHMOVE:  	retval = ft2232_execute_pathmove(cmd); break;
+	case JTAG_SCAN: 	 		retval = ft2232_execute_scan(cmd); break;
+	case JTAG_SLEEP:	 		retval = ft2232_execute_sleep(cmd); break;
+	case JTAG_STABLECLOCKS: 	retval = ft2232_execute_stableclocks(cmd); break;
+	default:
+		LOG_ERROR("BUG: unknown JTAG command type encountered");
+		exit(-1);
 	}
 	return retval;
 }
@@ -1604,10 +1744,10 @@
 #if BUILD_FT2232_FTD2XX == 1
 static int ft2232_init_ftd2xx(u16 vid, u16 pid, int more, int* try_more)
 {
-	FT_STATUS status;
-	DWORD     openex_flags  = 0;
-	char*     openex_string = NULL;
-	u8        latency_timer;
+	FT_STATUS 	status;
+	DWORD     	openex_flags  = 0;
+	char*     	openex_string = NULL;
+	u8        	latency_timer;
 
 	LOG_DEBUG("'ft2232' interface using FTD2XX with '%s' layout (%4.4x:%4.4x)", ft2232_layout, vid, pid);
 
@@ -1785,6 +1925,7 @@
 		return ERROR_JTAG_INIT_FAILED;
 	}
 
+	/* There is already a reset in ftdi_usb_open_desc, this should be redundant */
 	if (ftdi_usb_reset(&ftdic) < 0)
 	{
 		LOG_ERROR("unable to reset ftdi device");
@@ -1835,6 +1976,15 @@
 	ft2232_layout_t* cur_layout = ft2232_layouts;
 	int i;
 
+	if (tap_get_tms_path_len(TAP_IRPAUSE,TAP_IRPAUSE)==7)
+	{ 
+		LOG_DEBUG("ft2232 interface using 7 step jtag state transitions");
+	}
+	else
+	{
+		LOG_DEBUG("ft2232 interface using shortest path jtag state transitions");
+	
+	}
 	if ( (ft2232_layout == NULL) || (ft2232_layout[0] == 0) )
 	{
 		ft2232_layout = "usbjtag";
@@ -2395,7 +2545,7 @@
 
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'sheevaplug' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'sheevaplug' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
 
@@ -2423,7 +2573,7 @@
 
 	if (((ft2232_write(buf, 3, &bytes_written)) != ERROR_OK) || (bytes_written != 3))
 	{
-		LOG_ERROR("couldn't initialize FT2232 with 'sheevaplug' layout"); 
+		LOG_ERROR("couldn't initialize FT2232 with 'sheevaplug' layout");
 		return ERROR_JTAG_INIT_FAILED;
 	}
 
@@ -2446,9 +2596,9 @@
 		high_output |= 0x08;
 	}
 
-	BUFFER_ADD = 0x82;
-	BUFFER_ADD = high_output;
-	BUFFER_ADD = high_direction;
+	buffer_write( 0x82 );
+	buffer_write( high_output );
+	buffer_write( high_direction );
 }
 
 
@@ -2459,9 +2609,9 @@
 	 */
 	high_output ^= 0x0c;
 
-	BUFFER_ADD = 0x82;
-	BUFFER_ADD = high_output;
-	BUFFER_ADD = high_direction;
+	buffer_write( 0x82 );
+	buffer_write( high_output );
+	buffer_write( high_direction );
 }
 
 
@@ -2479,9 +2629,9 @@
 		high_output = 0x08;
 	}
 
-	BUFFER_ADD = 0x82;
-	BUFFER_ADD = high_output;
-	BUFFER_ADD = high_direction;
+	buffer_write( 0x82 );
+	buffer_write( high_output );
+	buffer_write( high_direction );
 }
 
 
@@ -2639,14 +2789,16 @@
 			first_unsent = cmd;
 		}
 
+		/* there are no state transitions in this code, so omit state tracking */
+
 		/* command "Clock Data to TMS/CS Pin (no Read)" */
-		BUFFER_ADD = 0x4b;
+		buffer_write( 0x4b );
 
 		/* scan 7 bit */
-		BUFFER_ADD = bitcount_per_command - 1;
+		buffer_write( bitcount_per_command - 1 );
 
 		/* TMS data bits are either all zeros or ones to stay in the current stable state */
-		BUFFER_ADD = tms;
+		buffer_write( tms );
 
 		require_send = 1;
 
@@ -2656,6 +2808,7 @@
 	return retval;
 }
 
+
 /* ---------------------------------------------------------------------
  * Support for IceBear JTAG adapter from Section5:
  * 	http://section5.ch/icebear
@@ -2752,8 +2905,9 @@
 	}
 
 	/* command "set data bits low byte" */
-	BUFFER_ADD = 0x80;
-	BUFFER_ADD = low_output;
-	BUFFER_ADD = low_direction;
+	buffer_write( 0x80 );
+	buffer_write( low_output );
+	buffer_write( low_direction );
+
 	LOG_DEBUG("trst: %i, srst: %i, low_output: 0x%2.2x, low_direction: 0x%2.2x", trst, srst, low_output, low_direction);
 }



From kc8apf at mail.berlios.de  Mon May 18 19:42:37 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:42:37 +0200
Subject: [Openocd-svn] r1826 - trunk/src/jtag
Message-ID: <200905181742.n4IHgbG6032135@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:42:36 +0200 (Mon, 18 May 2009)
New Revision: 1826

Modified:
   trunk/src/jtag/jlink.c
Log:
JLink support for non-7-cycle state moves by Dick Hollenbeck <dick at softplc.com>

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-05-18 17:41:27 UTC (rev 1825)
+++ trunk/src/jtag/jlink.c	2009-05-18 17:42:36 UTC (rev 1826)
@@ -39,6 +39,11 @@
 #define JLINK_USB_TIMEOUT		1000
 
 // See Section 1.3.2 of the Segger JLink USB protocol manual
+/* 2048 is the max value we can use here */
+//#define JLINK_TAP_BUFFER_SIZE 2048
+#define JLINK_TAP_BUFFER_SIZE 256
+//#define JLINK_TAP_BUFFER_SIZE 384
+
 #define JLINK_IN_BUFFER_SIZE			2048
 #define JLINK_OUT_BUFFER_SIZE			2*2048+4
 #define JLINK_EMU_RESULT_BUFFER_SIZE	64
@@ -412,6 +417,8 @@
 
 	tap_state_t saved_end_state = tap_get_end_state();
 
+	jlink_tap_ensure_space(1,num_cycles + 16);
+
 	/* only do a state_move when we're not already in IDLE */
 	if (tap_get_state() != TAP_IDLE)
 	{
@@ -438,7 +445,7 @@
 {
 	tap_state_t saved_end_state;
 
-	jlink_tap_ensure_space(1, scan_size + 8);
+	jlink_tap_ensure_space(1, scan_size + 16);
 
 	saved_end_state = tap_get_end_state();
 
@@ -604,8 +611,6 @@
 /***************************************************************************/
 /* J-Link tap functions */
 
-/* 2048 is the max value we can use here */
-#define JLINK_TAP_BUFFER_SIZE 1024
 
 static unsigned tap_length=0;
 static u8 tms_buffer[JLINK_TAP_BUFFER_SIZE];
@@ -634,7 +639,7 @@
 static void jlink_tap_ensure_space(int scans, int bits)
 {
 	int available_scans = MAX_PENDING_SCAN_RESULTS - pending_scan_results_length;
-	int available_bits = JLINK_TAP_BUFFER_SIZE * 8 - tap_length - 64;
+	int available_bits = JLINK_TAP_BUFFER_SIZE * 8 - tap_length - 32;
 
 	if (scans > available_scans || bits > available_bits)
 	{
@@ -649,6 +654,7 @@
 	if (index >= JLINK_TAP_BUFFER_SIZE)
 	{
 		LOG_ERROR("jlink_tap_append_step: overflow");
+		*(u32 *)0xFFFFFFFF = 0;
 		exit(-1);
 	}
 



From kc8apf at mail.berlios.de  Mon May 18 19:43:27 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 18 May 2009 19:43:27 +0200
Subject: [Openocd-svn] r1827 - trunk/src/jtag
Message-ID: <200905181743.n4IHhRG6000416@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-18 19:43:26 +0200 (Mon, 18 May 2009)
New Revision: 1827

Modified:
   trunk/src/jtag/jtag.c
Log:
Enable non-7-cycle state table for FT2232 and JLink

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 17:42:36 UTC (rev 1826)
+++ trunk/src/jtag/jtag.c	2009-05-18 17:43:26 UTC (rev 1827)
@@ -3280,7 +3280,7 @@
 
 #define B8(bits,count)		{ ((u8)B8__(HEX__(bits))), (count) }
 
-#if 0 && ((BUILD_FT2232_FTD2XX==1) || (BUILD_FT2232_LIBFTDI==1) || (BUILD_JLINK==1))
+#if 1 && ((BUILD_FT2232_FTD2XX==1) || (BUILD_FT2232_LIBFTDI==1) || (BUILD_JLINK==1))
 	/* 	this is the table submitted by Jeff Williams on 3/30/2009 with this comment:
 
 		OK, I added Peter's version of the state table, and it works OK for



From zwelch at mail.berlios.de  Mon May 18 21:06:46 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 18 May 2009 21:06:46 +0200
Subject: [Openocd-svn] r1828 - trunk
Message-ID: <200905181906.n4IJ6k8x031294@sheep.berlios.de>

Author: zwelch
Date: 2009-05-18 21:06:43 +0200 (Mon, 18 May 2009)
New Revision: 1828

Modified:
   trunk/TODO
Log:
Update The List with recent progress; remove developer list from TODO.

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-05-18 17:43:26 UTC (rev 1827)
+++ trunk/TODO	2009-05-18 19:06:43 UTC (rev 1828)
@@ -25,25 +25,21 @@
 
 - JTAG/TAP changes:
   - update all drivers to use tap_get_tms_path_len API.
-    - link to posted patch: @missing
-  - rework TAP state table (started but still needs work)
-    - link to posted patch: @missing
   - use tap_set_state everywhere to allow logging TAP state transitions
   - rename other tap_states to use standard JTAG names (suggested by ML)
-    - write script that automate production of the series of 16-17 patches
-    - produce and distribute current series against the current trunk
-    - distribute script so developers can use on WC through live commits
-    - make live commits after giving sufficient notice to others
   - add TAP_UNKNOWN to augment TAP_INVALID? (suggested by ML/DH)
   
 - JTAG Interfaces:
   - autodetect devices present on the scan chain
     - implement 'discover_taps' command
   - FT2232 driver: (DH)
-    - integrate FTD2XX High-Speed Device Patch
-      - link to posted patch: @missing
-    - fix non-recoverability of cable connect/reconnect
-      - link to posted patch: @missing
+    - integrate FTD2XX High-Speed Device support
+      - PATCH: https://lists.berlios.de/pipermail/openocd-development/2009-April/005479.html
+    - massive set of changes (DH):
+      - fixes non-recoverability of cable connect/reconnect
+      - https://lists.berlios.de/pipermail/openocd-development/2009-May/006011.html
+    - further cleanup (DH):
+      - PATCH: https://lists.berlios.de/pipermail/openocd-development/2009-May/006112.html
     - fix outstanding bugs
   - J-Link driver: (ZW)
     - fix outstanding bugs
@@ -62,6 +58,8 @@
   - SWD
 
 - Target Support:
+  - general layer cleanup:
+    - https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
   - ARM11 improvements (MB?)
     - fix single stepping  (reported by ?H)
     - implement missing functionality (grep FNC_INFO_NOTIMPLEMENTED ...)
@@ -89,15 +87,14 @@
   - other targets?  (suggestions always welcome)
 
 - CFI:
-  - speed enhancements (posted Apr 22 by NC) (??)
-    - link to patch: @missing
   - finish implementing bus width/chip width handling (suggested by NC)
-    - link to patch: @missing
   - factor vendor-specific code into separate source files
   - add new callback interface for vendor-specific code
   - investigate/implement "thin wrapper" to use eCos CFI drivers (?H)
 
 - TCL
+  - mem2array bugs:
+    - Report: https://lists.berlios.de/pipermail/openocd-development/2009-May/006459.html
   - Isolate all TCL command support: 
     - Allow pure C CLI implementations using --disable-builtin-tcl
     - Allow full TCL support? add --with-tcl=/path/to/installed/tcl
@@ -145,32 +142,4 @@
     https://developer.berlios.de/patch/?group_id=4148
   - use bug tracking?  we need something!
 
- at verbatim
-==================================================================
-OpenOCD's Active Developers and Testers
-------------------------------------------------------------------
-
-** | Name            | Status | Targets          | Interfaces
----+-----------------+--------+------------------+----------------
-NC | Nico Coesel     |   *    | AU1100           | *
-DE | Duane Ellis     |   *    | *                | *
-DH | Dick Hollenbeck |   ?    | *                | FT2232
-?H | ?yvind Harboe   |   *    | *                | ZY1000
-JK | Joern Keipf     |   *    | *                | FT2232H/FT4232HS?
-JW | Jeff Williams   |   ?    | MC1322x          | J-Link
-MA | Mariano Alvira  |   *    | MC1322x          | J-Link, FTDI
-MB | Michael Bruck   |   *    | ARM11            | *
-ML | Magnus Lundin   |   *    | *                | *
-RA | Rick Altherr    |   *    | *                | *
-RD | Rene Doss       |   *    | AT91SAM92xx      | *
-SQ | Simon Qian      |   *    | AVR              | *
-ZW | Zach Welch      |   *    | STR912           | J-Link
-
-Status Key:
-* - Active Contributor
-? - Missing In Action
-V - On Vacation
-
- at endverbatim
-
 */



From oharboe at mail.berlios.de  Mon May 18 21:28:29 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 18 May 2009 21:28:29 +0200
Subject: [Openocd-svn] r1829 - trunk
Message-ID: <200905181928.n4IJSTSW001754@sheep.berlios.de>

Author: oharboe
Date: 2009-05-18 21:28:26 +0200 (Mon, 18 May 2009)
New Revision: 1829

Modified:
   trunk/TODO
Log:
updated w/jtag_add_end_state() note.

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-05-18 19:06:43 UTC (rev 1828)
+++ trunk/TODO	2009-05-18 19:28:26 UTC (rev 1829)
@@ -27,7 +27,12 @@
   - update all drivers to use tap_get_tms_path_len API.
   - use tap_set_state everywhere to allow logging TAP state transitions
   - rename other tap_states to use standard JTAG names (suggested by ML)
-  - add TAP_UNKNOWN to augment TAP_INVALID? (suggested by ML/DH)
+  - retire jtag_add_end_state() and replace w/global variable. This also
+  removes TAP_INVALID as an argument to jtag_add_xxxx(). The global variable
+  as argument to jtag_add_xxxx() should eventually be phased out, but
+  the global variable is useful in an interim phase where one needs to
+  be bug by bug compatible before each change can be tested. Suggested
+  by ?H. Michael Bruck also interested in this.
   
 - JTAG Interfaces:
   - autodetect devices present on the scan chain



From oharboe at mail.berlios.de  Mon May 18 21:33:05 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 18 May 2009 21:33:05 +0200
Subject: [Openocd-svn] r1830 - trunk
Message-ID: <200905181933.n4IJX5mN002393@sheep.berlios.de>

Author: oharboe
Date: 2009-05-18 21:33:00 +0200 (Mon, 18 May 2009)
New Revision: 1830

Modified:
   trunk/TODO
Log:
removed solved mem2array problem.

Added questions regarding ideas on making tcl-less builds of OpenOCD

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-05-18 19:28:26 UTC (rev 1829)
+++ trunk/TODO	2009-05-18 19:33:00 UTC (rev 1830)
@@ -98,10 +98,10 @@
   - investigate/implement "thin wrapper" to use eCos CFI drivers (?H)
 
 - TCL
-  - mem2array bugs:
-    - Report: https://lists.berlios.de/pipermail/openocd-development/2009-May/006459.html
   - Isolate all TCL command support: 
-    - Allow pure C CLI implementations using --disable-builtin-tcl
+    - Allow pure C CLI implementations using --disable-builtin-tcl. 
+    Ref? How could this be made to work given targets extensive need
+    for events, etc.? What about the target library?
     - Allow full TCL support? add --with-tcl=/path/to/installed/tcl
     - Move TCL support in foo.* to foo_tcl.* (other ideas?)
 



From oharboe at mail.berlios.de  Mon May 18 22:21:54 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 18 May 2009 22:21:54 +0200
Subject: [Openocd-svn] r1831 - trunk/src/jtag
Message-ID: <200905182021.n4IKLsID009397@sheep.berlios.de>

Author: oharboe
Date: 2009-05-18 22:21:53 +0200 (Mon, 18 May 2009)
New Revision: 1831

Modified:
   trunk/src/jtag/bitbang.c
Log:
use tap_get_tms_path_len() instead of fix # of 7.

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2009-05-18 19:33:00 UTC (rev 1830)
+++ trunk/src/jtag/bitbang.c	2009-05-18 20:21:53 UTC (rev 1831)
@@ -77,8 +77,9 @@
 {
 	int i=0, tms=0;
 	u8 tms_scan = tap_get_tms_path(tap_get_state(), tap_get_end_state());
-
-	for (i = skip; i < 7; i++)
+	int tms_count = tap_get_tms_path_len(tap_get_state(), tap_get_end_state());
+	
+	for (i = skip; i < tms_count; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		bitbang_interface->write(0, tms, 0);



From zwelch at mail.berlios.de  Mon May 18 22:23:00 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 18 May 2009 22:23:00 +0200
Subject: [Openocd-svn] r1832 - trunk
Message-ID: <200905182023.n4IKN0HG009528@sheep.berlios.de>

Author: zwelch
Date: 2009-05-18 22:22:55 +0200 (Mon, 18 May 2009)
New Revision: 1832

Modified:
   trunk/BUGS
   trunk/Doxyfile
Log:
Update BUGS file, adapting its content for the doxygen manual.

Modified: trunk/BUGS
===================================================================
--- trunk/BUGS	2009-05-18 20:21:53 UTC (rev 1831)
+++ trunk/BUGS	2009-05-18 20:22:55 UTC (rev 1832)
@@ -1,34 +1,46 @@
-Please report bugs by posting a message to 
+/** @page bugs Bug Reporting
 
-openocd-development at lists.berlios.de.
+Please report bugs by subscribing to the OpenOCD mailing list and
+posting a message with your report:
 
+	openocd-development at lists.berlios.de
+
 To minimize work for OpenOCD developers, you can include
 all the information below.  If you feel that some of the
 items below are unnecessary for a clear bug report, you
 leave them out.
 
-
 - Target PCB/board description
 - Config scripts
 - OpenOCD command line
 - List of commands issued or GDB operations performed
 - Expected result
 - Actual result
-- debug_level 3 logs
-- If this is a regression, include logs for working and broken
-version
-- If this is a regression, please find out the precise version
-that caused the regression. This can be done via a binary
-search. E.g. if version 550 worked and 600 failed, then try
-575, etc.
+- Logs using @c debug_level 3 (e.g. add '-d 3' to the command line)
+- If this is a regression, include logs for working and broken version
+- If this is a regression, please find out the precise version that
+  caused the regression.  This can be done via a binary search; For
+  example: if testing version 550 works but 600 fail, then try 575, etc.
 
-- If OpenOCD is crashing, you can use GDB to get a trace:
-
-gdb --args openocd ....
+- If OpenOCD is crashing, you can use GDB to get a trace:@par
+ at code
+% gdb --args openocd ....
 (gdb) run
 (gdb) bt
 => here a stack trace is dumped.
+ at endcode
 
-attach files directly to the posting. The mailing list knows to 
-transform attachments to links so you will not be bloating anyones
-mail box. Keep attachments to <100kBytes.
\ No newline at end of file
+- To run or debug the in-tree executable (not recommended), you must
+  use libtool to set up the correct shared library paths:
+ at code
+  libtool gdb --args openocd ....
+ at endcode
+or the more pedantic (and forward-compatible):
+ at code
+  libtool --mode=execute gdb --args openocd ....
+ at endcode
+- Attach files directly to the posting.  The mailing list knows to
+transform attachments to links so you will not be bloating anyones mail
+box.  Please keep attachments to less than 100KB.
+
+ */

Modified: trunk/Doxyfile
===================================================================
--- trunk/Doxyfile	2009-05-18 20:21:53 UTC (rev 1831)
+++ trunk/Doxyfile	2009-05-18 20:22:55 UTC (rev 1832)
@@ -566,6 +566,7 @@
 
 INPUT                  = doc/manual \
                          TODO \
+                         BUGS \
                          src \
                          config.h
 



From oharboe at mail.berlios.de  Mon May 18 22:25:23 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 18 May 2009 22:25:23 +0200
Subject: [Openocd-svn] r1833 - in trunk/src/jtag: . rlink
Message-ID: <200905182025.n4IKPN7x009833@sheep.berlios.de>

Author: oharboe
Date: 2009-05-18 22:25:19 +0200 (Mon, 18 May 2009)
New Revision: 1833

Modified:
   trunk/src/jtag/arm-jtag-ew.c
   trunk/src/jtag/bitq.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/rlink/rlink.c
   trunk/src/jtag/usbprog.c
   trunk/src/jtag/zy1000.c
Log:
use tap_get_tms_path_len() instead of fix # of 7. Not tested if this builds, but at least we're looking at a build error instead of a runtime error.

Modified: trunk/src/jtag/arm-jtag-ew.c
===================================================================
--- trunk/src/jtag/arm-jtag-ew.c	2009-05-18 20:22:55 UTC (rev 1832)
+++ trunk/src/jtag/arm-jtag-ew.c	2009-05-18 20:25:19 UTC (rev 1833)
@@ -333,8 +333,9 @@
 	int i;
 	int tms = 0;
 	u8 tms_scan = tap_get_tms_path(tap_get_state(), tap_get_end_state());
+	int tms_count = tap_get_tms_path_len(tap_get_state(), tap_get_end_state());
 
-	for (i = 0; i < 7; i++)
+	for (i = 0; i < tms_count; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		armjtagew_tap_append_step(tms, 0);

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2009-05-18 20:22:55 UTC (rev 1832)
+++ trunk/src/jtag/bitq.c	2009-05-18 20:25:19 UTC (rev 1833)
@@ -161,8 +161,9 @@
 	}
 
 	tms_scan = tap_get_tms_path(tap_get_state(), new_state);
+	int tms_count = tap_get_tms_path_len(tap_get_state(), tap_get_end_state());
 
-	for (i = 0; i<7; i++)
+	for (i = 0; i<tms_count; i++)
 	{
 		bitq_io(tms_scan & 1, 0, 0);
 		tms_scan >>= 1;

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2009-05-18 20:22:55 UTC (rev 1832)
+++ trunk/src/jtag/gw16012.c	2009-05-18 20:25:19 UTC (rev 1833)
@@ -197,10 +197,11 @@
 {
 	int i=0, tms=0;
 	u8 tms_scan = tap_get_tms_path(tap_get_state(), tap_get_end_state());
+	int tms_count = tap_get_tms_path_len(tap_get_state(), tap_get_end_state());
 
 	gw16012_control(0x0); /* single-bit mode */
 
-	for (i = 0; i < 7; i++)
+	for (i = 0; i < tms_count; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		gw16012_data(tms << 1); /* output next TMS bit */

Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2009-05-18 20:22:55 UTC (rev 1832)
+++ trunk/src/jtag/rlink/rlink.c	2009-05-18 20:25:19 UTC (rev 1833)
@@ -916,8 +916,9 @@
 
 	int i=0, tms=0;
 	u8 tms_scan = tap_get_tms_path(tap_get_state(), tap_get_end_state());
+	int tms_count = tap_get_tms_path_len(tap_get_state(), tap_get_end_state());
 
-	for (i = 0; i < 7; i++)
+	for (i = 0; i < tms_count; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		tap_state_queue_append(tms);

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2009-05-18 20:22:55 UTC (rev 1832)
+++ trunk/src/jtag/usbprog.c	2009-05-18 20:25:19 UTC (rev 1833)
@@ -247,9 +247,10 @@
 {
 	int i = 0, tms = 0;
 	u8 tms_scan = tap_get_tms_path(tap_get_state(), tap_get_end_state());
+	int tms_count = tap_get_tms_path_len(tap_get_state(), tap_get_end_state());
 
 	usbprog_jtag_write_tms(usbprog_jtag_handle, (char)tms_scan);
-	for (i = 0; i < 7; i++)
+	for (i = 0; i < tms_count; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 	}

Modified: trunk/src/jtag/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000.c	2009-05-18 20:22:55 UTC (rev 1832)
+++ trunk/src/jtag/zy1000.c	2009-05-18 20:25:19 UTC (rev 1833)
@@ -686,8 +686,9 @@
 	/* test manual drive code on any target */
 	int tms;
 	u8 tms_scan = tap_get_tms_path(t, state);
+	int tms_count = tap_get_tms_path_len(tap_get_state(), tap_get_end_state());
 
-	for (i = 0; i < 7; i++)
+	for (i = 0; i < tms_count; i++)
 	{
 		tms = (tms_scan >> i) & 1;
 		waitIdle();



From oharboe at mail.berlios.de  Tue May 19 08:59:24 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 19 May 2009 08:59:24 +0200
Subject: [Openocd-svn] r1834 - trunk/src/jtag
Message-ID: <200905190659.n4J6xOGO028956@sheep.berlios.de>

Author: oharboe
Date: 2009-05-19 08:59:20 +0200 (Tue, 19 May 2009)
New Revision: 1834

Modified:
   trunk/src/jtag/jtag.c
Log:
added tms_sequence command to allow switching between old/new tms sequence

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-18 20:25:19 UTC (rev 1833)
+++ trunk/src/jtag/jtag.c	2009-05-19 06:59:20 UTC (rev 1834)
@@ -261,6 +261,7 @@
 
 static int handle_verify_ircapture_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int handle_verify_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_tms_sequence_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 jtag_tap_t *jtag_AllTaps(void)
 {
@@ -2310,6 +2311,8 @@
 		COMMAND_ANY, "verify value captured during Capture-IR <enable|disable>");
 	register_command(cmd_ctx, NULL, "verify_jtag", handle_verify_jtag_command,
 		COMMAND_ANY, "verify value capture <enable|disable>");
+	register_command(cmd_ctx, NULL, "tms_sequence", handle_tms_sequence_command,
+		COMMAND_ANY, "choose short(default) or long tms_sequence <short|long>");
 	return ERROR_OK;
 }
 
@@ -3129,6 +3132,7 @@
 	return ERROR_OK;
 }
 
+
 int jtag_power_dropout(int *dropout)
 {
 	return jtag->power_dropout(dropout);
@@ -3248,19 +3252,12 @@
  *
  * DRSHIFT->DRSHIFT and IRSHIFT->IRSHIFT have to be caught in interface specific code
  */
-static struct
+struct tms_sequences
 {
 	u8	bits;
 	u8	bit_count;
 
-} tms_seqs[6][6] =		/*  [from_state_ndx][to_state_ndx] */
-{
-	/* value clocked to TMS to move from one of six stable states to another.
-	 * N.B. OOCD clocks TMS from LSB first, so read these right-to-left.
-	 * N.B. These values are tightly bound to the table in tap_get_tms_path_len().
-	 * N.B. Reset only needs to be 0b11111, but in JLink an even byte of 1's is more stable.
-	 * 		These extra ones cause no TAP state problem, because we go into reset and stay in reset.
-	 */
+};
 
 /*
  * These macros allow us to specify TMS state transitions by bits rather than hex bytes.
@@ -3280,7 +3277,31 @@
 
 #define B8(bits,count)		{ ((u8)B8__(HEX__(bits))), (count) }
 
-#if 1 && ((BUILD_FT2232_FTD2XX==1) || (BUILD_FT2232_LIBFTDI==1) || (BUILD_JLINK==1))
+static const struct tms_sequences old_tms_seqs[6][6] =		/*  [from_state_ndx][to_state_ndx] */
+{
+	/* value clocked to TMS to move from one of six stable states to another.
+	 * N.B. OOCD clocks TMS from LSB first, so read these right-to-left.
+	 * N.B. These values are tightly bound to the table in tap_get_tms_path_len().
+	 * N.B. Reset only needs to be 0b11111, but in JLink an even byte of 1's is more stable.
+	 * 		These extra ones cause no TAP state problem, because we go into reset and stay in reset.
+	 */
+
+
+
+	/* to state: */
+	/*	RESET			IDLE			DRSHIFT			DRPAUSE			IRSHIFT			IRPAUSE 	*/		/* from state: */
+	{	B8(1111111,7),	B8(0000000,7),	B8(0010111,7),	B8(0001010,7),	B8(0011011,7),	B8(0010110,7) },	/* RESET */
+	{	B8(1111111,7),	B8(0000000,7),	B8(0100101,7),	B8(0000101,7),	B8(0101011,7),	B8(0001011,7) },	/* IDLE */
+	{	B8(1111111,7),	B8(0110001,7),	B8(0000000,7),	B8(0000001,7),	B8(0001111,7),	B8(0101111,7) },	/* DRSHIFT */
+	{	B8(1111111,7),	B8(0110000,7),	B8(0100000,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },	/* DRPAUSE */
+	{	B8(1111111,7),	B8(0110001,7),	B8(0000111,7),	B8(0010111,7),	B8(0000000,7),	B8(0000001,7) },	/* IRSHIFT */
+	{	B8(1111111,7),	B8(0110000,7),	B8(0011100,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },	/* IRPAUSE */
+};
+
+
+
+static const struct tms_sequences short_tms_seqs[6][6] =		/*  [from_state_ndx][to_state_ndx] */
+{
 	/* 	this is the table submitted by Jeff Williams on 3/30/2009 with this comment:
 
 		OK, I added Peter's version of the state table, and it works OK for
@@ -3314,40 +3335,21 @@
 	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(010111,6), 	B8(001111,6),	B8(01,2) },			/* IRSHIFT */
 	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(010111,6),	B8(01,2),		B8(0,1) } 			/* IRPAUSE */
 
-#else	/* this is the old table, converted from hex and with the bit_count set to 7 for each combo, like before */
+};
 
-	/* to state: */
-	/*	RESET			IDLE			DRSHIFT			DRPAUSE			IRSHIFT			IRPAUSE 	*/		/* from state: */
-	{	B8(1111111,7),	B8(0000000,7),	B8(0010111,7),	B8(0001010,7),	B8(0011011,7),	B8(0010110,7) },	/* RESET */
-	{	B8(1111111,7),	B8(0000000,7),	B8(0100101,7),	B8(0000101,7),	B8(0101011,7),	B8(0001011,7) },	/* IDLE */
-	{	B8(1111111,7),	B8(0110001,7),	B8(0000000,7),	B8(0000001,7),	B8(0001111,7),	B8(0101111,7) },	/* DRSHIFT */
-	{	B8(1111111,7),	B8(0110000,7),	B8(0100000,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },	/* DRPAUSE */
-	{	B8(1111111,7),	B8(0110001,7),	B8(0000111,7),	B8(0010111,7),	B8(0000000,7),	B8(0000001,7) },	/* IRSHIFT */
-	{	B8(1111111,7),	B8(0110000,7),	B8(0011100,7),	B8(0010111,7),	B8(0011110,7),	B8(0101111,7) },	/* IRPAUSE */
+typedef const struct tms_sequences tms_table[6][6];
 
-#endif
+static tms_table *tms_seqs=&short_tms_seqs;
 
-#if 0 /* keeping old hex stuff for awhile, for reference */
-	/* RESET  			IDLE  			DRSHIFT  		DRPAUSE  		IRSHIFT  		IRPAUSE */
-	{  0x7f, 			0x00,    		0x17,    		0x0a,    		0x1b,    		0x16 },	/* RESET */
-	{  0x7f, 			0x00,    		0x25,    		0x05,    		0x2b,    		0x0b },	/* IDLE */
-	{  0x7f, 			0x31,    		0x00,    		0x01,    		0x0f,    		0x2f },	/* DRSHIFT  */
-	{  0x7f, 			0x30,    		0x20,    		0x17,    		0x1e,    		0x2f },	/* DRPAUSE  */
-	{  0x7f, 			0x31,    		0x07,    		0x17,    		0x00,    		0x01 },	/* IRSHIFT  */
-	{  0x7f, 			0x30,    		0x1c,    		0x17,    		0x20,    		0x2f }	/* IRPAUSE  */
-#endif
-};
-
-
 int tap_get_tms_path( tap_state_t from, tap_state_t to )
 {
-	return tms_seqs[tap_move_ndx(from)][tap_move_ndx(to)].bits;
+	return (*tms_seqs)[tap_move_ndx(from)][tap_move_ndx(to)].bits;
 }
 
 
 int tap_get_tms_path_len( tap_state_t from, tap_state_t to )
 {
-	return tms_seqs[tap_move_ndx(from)][tap_move_ndx(to)].bit_count;
+	return (*tms_seqs)[tap_move_ndx(from)][tap_move_ndx(to)].bit_count;
 }
 
 
@@ -3607,5 +3609,29 @@
 }
 #endif
 
+static int handle_tms_sequence_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc == 1)
+	{
+		if (strcmp(args[0], "short") == 0)
+		{
+			tms_seqs=&short_tms_seqs;
+		}
+		else if (strcmp(args[0], "long") == 0)
+		{
+			tms_seqs=&old_tms_seqs;
+		} else
+		{
+			return ERROR_COMMAND_SYNTAX_ERROR;
+		}
+	} else if (argc != 0)
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
 
+	command_print(cmd_ctx, "tms sequence is  %s", (tms_seqs==&short_tms_seqs) ? "short": "long");
+
+	return ERROR_OK;
+}
+
 /*-----</Cable Helper API>--------------------------------------*/



From oharboe at mail.berlios.de  Tue May 19 12:04:41 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 19 May 2009 12:04:41 +0200
Subject: [Openocd-svn] r1835 - trunk/src/flash
Message-ID: <200905191004.n4JA4fwh006624@sheep.berlios.de>

Author: oharboe
Date: 2009-05-19 12:04:41 +0200 (Tue, 19 May 2009)
New Revision: 1835

Modified:
   trunk/src/flash/nand.c
   trunk/src/flash/nand.h
Log:
David Brownell <david-b at pacbell.net>  NAND: update ids, "nand list" bugfix

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2009-05-19 06:59:20 UTC (rev 1834)
+++ trunk/src/flash/nand.c	2009-05-19 10:04:41 UTC (rev 1835)
@@ -86,6 +86,7 @@
  */
 static nand_info_t nand_flash_ids[] =
 {
+	/* start "museum" IDs */
 	{"NAND 1MiB 5V 8-bit",		0x6e, 256, 1, 0x1000, 0},
 	{"NAND 2MiB 5V 8-bit",		0x64, 256, 2, 0x1000, 0},
 	{"NAND 4MiB 5V 8-bit",		0x6b, 512, 4, 0x2000, 0},
@@ -101,6 +102,7 @@
 	{"NAND 8MiB 3,3V 8-bit",	0xe6, 512, 8, 0x2000, 0},
 	{"NAND 8MiB 1,8V 16-bit",	0x49, 512, 8, 0x2000, NAND_BUSWIDTH_16},
 	{"NAND 8MiB 3,3V 16-bit",	0x59, 512, 8, 0x2000, NAND_BUSWIDTH_16},
+	/* end "museum" IDs */
 
 	{"NAND 16MiB 1,8V 8-bit",	0x33, 512, 16, 0x4000, 0},
 	{"NAND 16MiB 3,3V 8-bit",	0x73, 512, 16, 0x4000, 0},
@@ -172,6 +174,7 @@
 	{NAND_MFR_RENESAS, "Renesas"},
 	{NAND_MFR_STMICRO, "ST Micro"},
 	{NAND_MFR_HYNIX, "Hynix"},
+	{NAND_MFR_MICRON, "Micron"},
 	{0x0, NULL},
 };
 
@@ -1062,7 +1065,7 @@
 int handle_nand_list_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
-	int i = 0;
+	int i;
 
 	if (!nand_devices)
 	{
@@ -1070,13 +1073,13 @@
 		return ERROR_OK;
 	}
 
-	for (p = nand_devices; p; p = p->next)
+	for (p = nand_devices, i = 0; p; p = p->next, i++)
 	{
 		if (p->device)
 			command_print(cmd_ctx, "#%i: %s (%s) pagesize: %i, buswidth: %i, erasesize: %i",
-				i++, p->device->name, p->manufacturer->name, p->page_size, p->bus_width, p->erase_size);
+				i, p->device->name, p->manufacturer->name, p->page_size, p->bus_width, p->erase_size);
 		else
-			command_print(cmd_ctx, "#%i: not probed");
+			command_print(cmd_ctx, "#%i: not probed", i);
 	}
 
 	return ERROR_OK;

Modified: trunk/src/flash/nand.h
===================================================================
--- trunk/src/flash/nand.h	2009-05-19 06:59:20 UTC (rev 1834)
+++ trunk/src/flash/nand.h	2009-05-19 10:04:41 UTC (rev 1835)
@@ -95,6 +95,7 @@
 	NAND_MFR_RENESAS = 0x07,
 	NAND_MFR_STMICRO = 0x20,
 	NAND_MFR_HYNIX = 0xad,
+	NAND_MFR_MICRON = 0x2c,
 };
 
 typedef struct nand_manufacturer_s



From oharboe at mail.berlios.de  Tue May 19 13:53:06 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 19 May 2009 13:53:06 +0200
Subject: [Openocd-svn] r1836 - trunk/src/target/target
Message-ID: <200905191153.n4JBr6KP021330@sheep.berlios.de>

Author: oharboe
Date: 2009-05-19 13:53:05 +0200 (Tue, 19 May 2009)
New Revision: 1836

Modified:
   trunk/src/target/target/pxa270.cfg
Log:
Wookey <wookey at wookware.org> update syntax

Modified: trunk/src/target/target/pxa270.cfg
===================================================================
--- trunk/src/target/target/pxa270.cfg	2009-05-19 10:04:41 UTC (rev 1835)
+++ trunk/src/target/target/pxa270.cfg	2009-05-19 11:53:05 UTC (rev 1836)
@@ -12,6 +12,9 @@
    set  _ENDIAN little
 }
 
+#IDs for pxa270. Choose one. Are there others?#
+#set CPUTAPID 0x79265013
+#set CPUTAPID 0x49265013
 if { [info exists CPUTAPID ] } {
    set _CPUTAPID $CPUTAPID
 } else {
@@ -26,11 +29,7 @@
 # set the jtag_ntrst_delay to the delay introduced by a reset circuit
 # the rest of the needed delays are built into the openocd program
 jtag_ntrst_delay 0
-#use combined on interfaces or targets that can't set TRST/SRST separately
-reset_config trst_and_srst separate
-#jtag scan chain
 
-
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
 jtag newtap $_CHIPNAME cpu -irlen 7 -ircapture 0x1 -irmask 0x7f -expected-id $_CPUTAPID
 
@@ -38,7 +37,3 @@
 # maps to PXA internal RAM. If you are using a PXA255
 # you must initialize SDRAM or leave this option off
 $_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x5c000000 -work-area-size 0x10000 -work-area-backup 0
-
-#flash bank <driver> <base> <size> <chip_width> <bus_width>
-# works for P30 flash
-flash bank cfi 0x00000000 0x1000000 2 4 0



From oharboe at mail.berlios.de  Tue May 19 16:36:06 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 19 May 2009 16:36:06 +0200
Subject: [Openocd-svn] r1837 - trunk/src/helper
Message-ID: <200905191436.n4JEa69i003736@sheep.berlios.de>

Author: oharboe
Date: 2009-05-19 16:36:04 +0200 (Tue, 19 May 2009)
New Revision: 1837

Modified:
   trunk/src/helper/ioutil.c
Log:
fix warnings

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-19 11:53:05 UTC (rev 1836)
+++ trunk/src/helper/ioutil.c	2009-05-19 14:36:04 UTC (rev 1837)
@@ -218,6 +218,7 @@
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
+	int retval=ERROR_FAIL;
 	FILE *config_file = NULL;
 	config_file = fopen(args[0], "a");
 	if (config_file != NULL)
@@ -227,17 +228,22 @@
 
 		for (i = 1; i < argc; i++)
 		{
-			fwrite(args[i], strlen(args[i]), 1, config_file);
+			if (fwrite(args[i], strlen(args[i]), 1, config_file)!=strlen(args[i]))
+				break;
 			if (i != argc - 1)
 			{
-				fwrite(" ", 1, 1, config_file);
+				if (fwrite(" ", 1, 1, config_file)!=1)
+					break;
 			}
 		}
-		fwrite("\n", 1, 1, config_file);
+		if ((i==argc)&&(fwrite("\n", 1, 1, config_file)==1))
+		{
+			retval=ERROR_OK;
+		}
 		fclose(config_file);
 	}
 
-	return ERROR_OK;
+	return retval;
 }
 
 



From mifi at mail.berlios.de  Tue May 19 19:57:59 2009
From: mifi at mail.berlios.de (mifi at mail.berlios.de)
Date: Tue, 19 May 2009 19:57:59 +0200
Subject: [Openocd-svn] r1838 - trunk/src/target/target
Message-ID: <200905191757.n4JHvxXm000156@sheep.berlios.de>

Author: mifi
Date: 2009-05-19 19:57:44 +0200 (Tue, 19 May 2009)
New Revision: 1838

Modified:
   trunk/src/target/target/lpc2294.cfg
Log:
Added jtag_nsrst_delay 200 and jtag_ntrst_delay 200 to the LPC2294 target.


Modified: trunk/src/target/target/lpc2294.cfg
===================================================================
--- trunk/src/target/target/lpc2294.cfg	2009-05-19 14:36:04 UTC (rev 1837)
+++ trunk/src/target/target/lpc2294.cfg	2009-05-19 17:57:44 UTC (rev 1838)
@@ -17,6 +17,9 @@
    set _CPUTAPID 0xffffffff
 }
 
+jtag_nsrst_delay 200
+jtag_ntrst_delay 200
+
 #use combined on interfaces or targets that can't set TRST/SRST separately
 reset_config trst_and_srst srst_pulls_trst
 



From zwelch at mail.berlios.de  Tue May 19 20:30:05 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 19 May 2009 20:30:05 +0200
Subject: [Openocd-svn] r1839 - trunk/doc
Message-ID: <200905191830.n4JIU5wa005797@sheep.berlios.de>

Author: zwelch
Date: 2009-05-19 20:30:01 +0200 (Tue, 19 May 2009)
New Revision: 1839

Modified:
   trunk/doc/openocd.texi
Log:
Wookey <wookey at wookware.org>: add user documentation for echo command.

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-19 17:57:44 UTC (rev 1838)
+++ trunk/doc/openocd.texi	2009-05-19 18:30:01 UTC (rev 1839)
@@ -2588,6 +2588,10 @@
 openocd -c "fast enable" -c "interface dummy" -f target/str710.cfg
 @end example
 
+ at subsection echo <@var{message}>
+ at cindex echo
+@*Output message to stdio. e.g. echo "Programming - please wait"
+
 @subsection log_output <@var{file}>
 @cindex log_output
 @*Redirect logging to <file> (default: stderr) 



From kc8apf at mail.berlios.de  Wed May 20 06:47:23 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:47:23 +0200
Subject: [Openocd-svn] r1840 - trunk/src/jtag
Message-ID: <200905200447.n4K4lNhD013368@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:47:20 +0200 (Wed, 20 May 2009)
New Revision: 1840

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - rename input parameters 'num_fields' and 'fields' to 'in_num_fields' and 'in_fields' in all jtag.c interface functions



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-19 18:30:01 UTC (rev 1839)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:47:20 UTC (rev 1840)
@@ -37,8 +37,8 @@
 
 int jtag_flush_queue_count; /* count # of flushes for profiling / debugging purposes */
 
-static void jtag_add_scan_check(void (*jtag_add_scan)(int num_fields, scan_field_t *fields, tap_state_t state),
-		int num_fields, scan_field_t *fields, tap_state_t state);
+static void jtag_add_scan_check(void (*jtag_add_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state),
+		int in_num_fields, scan_field_t *in_fields, tap_state_t state);
 
 /* note that this is not marked as static as it must be available from outside jtag.c for those
    that implement the jtag_xxx() minidriver layer
@@ -554,45 +554,44 @@
 	cmd_queue_cur_state = cmd_queue_end_state;
 }
 
-void jtag_add_ir_scan_noverify(int num_fields, scan_field_t *fields, tap_state_t state)
+void jtag_add_ir_scan_noverify(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
 	jtag_prelude(state);
 
-	retval=interface_jtag_add_ir_scan(num_fields, fields, cmd_queue_end_state);
+	retval=interface_jtag_add_ir_scan(in_num_fields, in_fields, cmd_queue_end_state);
 	if (retval!=ERROR_OK)
 		jtag_error=retval;
 
 }
 
 
-void jtag_add_ir_scan(int num_fields, scan_field_t *fields, tap_state_t state)
+void jtag_add_ir_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	if (jtag_verify&&jtag_verify_capture_ir)
 	{
 		/* 8 x 32 bit id's is enough for all invoations */
-		int j;
-		for (j = 0; j < num_fields; j++)
+
+		for (int j = 0; j < in_num_fields; j++)
 		{
-			fields[j].check_value=NULL;
-			fields[j].check_mask=NULL;
+			in_fields[j].check_value=NULL;
+			in_fields[j].check_mask=NULL;
 			/* if we are to run a verification of the ir scan, we need to get the input back.
 			 * We may have to allocate space if the caller didn't ask for the input back.
 			 */
-			fields[j].check_value=fields[j].tap->expected;
-			fields[j].check_mask=fields[j].tap->expected_mask;
+			in_fields[j].check_value=in_fields[j].tap->expected;
+			in_fields[j].check_mask=in_fields[j].tap->expected_mask;
 		}
-		jtag_add_scan_check(jtag_add_ir_scan_noverify, num_fields, fields, state);
+		jtag_add_scan_check(jtag_add_ir_scan_noverify, in_num_fields, in_fields, state);
 	} else
 	{
-		jtag_add_ir_scan_noverify(num_fields, fields, state);
+		jtag_add_ir_scan_noverify(in_num_fields, in_fields, state);
 	}
 }
 
-int MINIDRIVER(interface_jtag_add_ir_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
+int MINIDRIVER(interface_jtag_add_ir_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	jtag_tap_t *tap;
-	int j;
 	int x;
 	int nth_tap;
 	int scan_size = 0;
@@ -632,13 +631,13 @@
 		cmd->cmd.scan->fields[nth_tap].in_value = NULL; /* do not collect input for tap's in bypass */
 
 		/* search the list */
-		for (j = 0; j < num_fields; j++)
+		for (int j = 0; j < in_num_fields; j++)
 		{
-			if (tap == fields[j].tap)
+			if (tap == in_fields[j].tap)
 			{
 				found = 1;
-				cmd->cmd.scan->fields[nth_tap].in_value = fields[j].in_value;
-				cmd->cmd.scan->fields[nth_tap].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+				cmd->cmd.scan->fields[nth_tap].in_value = in_fields[j].in_value;
+				cmd->cmd.scan->fields[nth_tap].out_value = buf_cpy(in_fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 
 				tap->bypass = 0;
 				break;
@@ -660,18 +659,18 @@
 	return ERROR_OK;
 }
 
-void jtag_add_plain_ir_scan(int num_fields, scan_field_t *fields, tap_state_t state)
+void jtag_add_plain_ir_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
 
 	jtag_prelude(state);
 
-	retval=interface_jtag_add_plain_ir_scan(num_fields, fields, cmd_queue_end_state);
+	retval=interface_jtag_add_plain_ir_scan(in_num_fields, in_fields, cmd_queue_end_state);
 	if (retval!=ERROR_OK)
 		jtag_error=retval;
 }
 
-int MINIDRIVER(interface_jtag_add_plain_ir_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
+int MINIDRIVER(interface_jtag_add_plain_ir_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	/* allocate memory for a new list member */
 
@@ -684,30 +683,30 @@
 	/* allocate memory for ir scan command */
 	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
 	cmd->cmd.scan->ir_scan = true;
-	cmd->cmd.scan->num_fields = num_fields;
-	cmd->cmd.scan->fields = cmd_queue_alloc(num_fields * sizeof(scan_field_t));
+	cmd->cmd.scan->num_fields = in_num_fields;
+	cmd->cmd.scan->fields = cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
 	cmd->cmd.scan->end_state = state;
 
-	for (int i = 0; i < num_fields; i++)
+	for (int i = 0; i < in_num_fields; i++)
 	{
-		int num_bits = fields[i].num_bits;
-		int num_bytes = CEIL(fields[i].num_bits, 8);
-		cmd->cmd.scan->fields[i].tap = fields[i].tap;
+		int num_bits = in_fields[i].num_bits;
+		int num_bytes = CEIL(in_fields[i].num_bits, 8);
+		cmd->cmd.scan->fields[i].tap = in_fields[i].tap;
 		cmd->cmd.scan->fields[i].num_bits = num_bits;
-		cmd->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		cmd->cmd.scan->fields[i].in_value = fields[i].in_value;
+		cmd->cmd.scan->fields[i].out_value = buf_cpy(in_fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
+		cmd->cmd.scan->fields[i].in_value = in_fields[i].in_value;
 	}
 
 	return ERROR_OK;
 }
 
-void jtag_add_dr_scan(int num_fields, scan_field_t *fields, tap_state_t state)
+void jtag_add_dr_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
 
 	jtag_prelude(state);
 
-	retval=interface_jtag_add_dr_scan(num_fields, fields, cmd_queue_end_state);
+	retval=interface_jtag_add_dr_scan(in_num_fields, in_fields, cmd_queue_end_state);
 	if (retval!=ERROR_OK)
 		jtag_error=retval;
 }
@@ -720,65 +719,68 @@
 	return jtag_check_value_inner(in, (u8 *)data1, (u8 *)data2, (int)data3);
 }
 
-static void jtag_add_scan_check(void (*jtag_add_scan)(int num_fields, scan_field_t *fields, tap_state_t state),
-		int num_fields, scan_field_t *fields, tap_state_t state)
+static void jtag_add_scan_check(void (*jtag_add_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state),
+		int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
-	for (int i=0; i<num_fields; i++)
+	for (int i = 0; i < in_num_fields; i++)
 	{
-		fields[i].allocated=0;
-		fields[i].modified=0;
-		if ((fields[i].check_value!=NULL)&&(fields[i].in_value==NULL))
+		in_fields[i].allocated = 0;
+		in_fields[i].modified = 0;
+		if ((in_fields[i].check_value != NULL) && (in_fields[i].in_value == NULL))
 		{
-			fields[i].modified=1;
+			in_fields[i].modified = 1;
 			/* we need storage space... */
 #ifdef HAVE_JTAG_MINIDRIVER_H
-			if (fields[i].num_bits<=32)
+			if (in_fields[i].num_bits <= 32)
 			{
 				/* This is enough space and we're executing this synchronously */
-				fields[i].in_value=fields[i].intmp;
+				in_fields[i].in_value = in_fields[i].intmp;
 			} else
 			{
-				fields[i].in_value=(u8 *)malloc(CEIL(fields[i].num_bits, 8));
-				fields[i].allocated=1;
+				in_fields[i].in_value = (u8 *)malloc(CEIL(in_fields[i].num_bits, 8));
+				in_fields[i].allocated = 1;
 			}
 #else
-			fields[i].in_value=(u8 *)cmd_queue_alloc(CEIL(fields[i].num_bits, 8));
+			in_fields[i].in_value = (u8 *)cmd_queue_alloc(CEIL(in_fields[i].num_bits, 8));
 #endif
 		}
 	}
 
-	jtag_add_scan(num_fields, fields, state);
+	jtag_add_scan(in_num_fields, in_fields, state);
 
-	for (int i=0; i<num_fields; i++)
+	for (int i = 0; i < in_num_fields; i++)
 	{
-		if ((fields[i].check_value!=NULL)&&(fields[i].in_value!=NULL))
+		if ((in_fields[i].check_value != NULL) && (in_fields[i].in_value != NULL))
 		{
 			/* this is synchronous for a minidriver */
-			jtag_add_callback4(jtag_check_value_mask_callback, fields[i].in_value, (jtag_callback_data_t)fields[i].check_value, (jtag_callback_data_t)fields[i].check_mask, (jtag_callback_data_t)fields[i].num_bits);
+			jtag_add_callback4(jtag_check_value_mask_callback, in_fields[i].in_value,
+				(jtag_callback_data_t)in_fields[i].check_value,
+				(jtag_callback_data_t)in_fields[i].check_mask,
+				(jtag_callback_data_t)in_fields[i].num_bits);
 		}
-		if (fields[i].allocated)
+		if (in_fields[i].allocated)
 		{
-			free(fields[i].in_value);
+			free(in_fields[i].in_value);
 		}
-		if (fields[i].modified)
+		if (in_fields[i].modified)
 		{
-			fields[i].in_value=NULL;
+			in_fields[i].in_value = NULL;
 		}
 	}
 }
 
-void jtag_add_dr_scan_check(int num_fields, scan_field_t *fields, tap_state_t state)
+void jtag_add_dr_scan_check(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	if (jtag_verify)
 	{
-		jtag_add_scan_check(jtag_add_dr_scan, num_fields, fields, state);
+		jtag_add_scan_check(jtag_add_dr_scan, in_num_fields, in_fields, state);
 	} else
 	{
-		jtag_add_dr_scan(num_fields, fields, state);
+		jtag_add_dr_scan(in_num_fields, in_fields, state);
 	}
 }
 
-int MINIDRIVER(interface_jtag_add_dr_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
+int MINIDRIVER(interface_jtag_add_dr_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	int j;
 	int nth_tap;
@@ -812,8 +814,8 @@
 	/* allocate memory for dr scan command */
 	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
 	cmd->cmd.scan->ir_scan = false;
-	cmd->cmd.scan->num_fields = num_fields + bypass_devices;
-	cmd->cmd.scan->fields = cmd_queue_alloc((num_fields + bypass_devices) * sizeof(scan_field_t));
+	cmd->cmd.scan->num_fields = in_num_fields + bypass_devices;
+	cmd->cmd.scan->fields = cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
 	cmd->cmd.scan->end_state = state;
 
 	tap = NULL;
@@ -827,15 +829,15 @@
 		int found = 0;
 		cmd->cmd.scan->fields[field_count].tap = tap;
 
-		for (j = 0; j < num_fields; j++)
+		for (j = 0; j < in_num_fields; j++)
 		{
-			if (tap == fields[j].tap)
+			if (tap == in_fields[j].tap)
 			{
 				found = 1;
-				scan_size = fields[j].num_bits;
+				scan_size = in_fields[j].num_bits;
 				cmd->cmd.scan->fields[field_count].num_bits = scan_size;
-				cmd->cmd.scan->fields[field_count].out_value = buf_cpy(fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				cmd->cmd.scan->fields[field_count].in_value = fields[j].in_value;
+				cmd->cmd.scan->fields[field_count].out_value = buf_cpy(in_fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+				cmd->cmd.scan->fields[field_count].in_value = in_fields[j].in_value;
 				field_count++;
 			}
 		}
@@ -874,7 +876,7 @@
 }
 
 void MINIDRIVER(interface_jtag_add_dr_out)(jtag_tap_t *target_tap,
-		int num_fields,
+		int in_num_fields,
 		const int *num_bits,
 		const u32 *value,
 		tap_state_t end_state)
@@ -909,8 +911,8 @@
 	/* allocate memory for dr scan command */
 	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
 	cmd->cmd.scan->ir_scan = false;
-	cmd->cmd.scan->num_fields = num_fields + bypass_devices;
-	cmd->cmd.scan->fields = cmd_queue_alloc((num_fields + bypass_devices) * sizeof(scan_field_t));
+	cmd->cmd.scan->num_fields = in_num_fields + bypass_devices;
+	cmd->cmd.scan->fields = cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
 	cmd->cmd.scan->end_state = end_state;
 
 	tap = NULL;
@@ -934,7 +936,7 @@
 				exit(-1);
 			}
 #endif
-			for (j = 0; j < num_fields; j++)
+			for (j = 0; j < in_num_fields; j++)
 			{
 				u8 out_value[4];
 				scan_size = num_bits[j];
@@ -963,18 +965,18 @@
 	}
 }
 
-void jtag_add_plain_dr_scan(int num_fields, scan_field_t *fields, tap_state_t state)
+void jtag_add_plain_dr_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
 
 	jtag_prelude(state);
 
-	retval=interface_jtag_add_plain_dr_scan(num_fields, fields, cmd_queue_end_state);
+	retval=interface_jtag_add_plain_dr_scan(in_num_fields, in_fields, cmd_queue_end_state);
 	if (retval!=ERROR_OK)
 		jtag_error=retval;
 }
 
-int MINIDRIVER(interface_jtag_add_plain_dr_scan)(int num_fields, scan_field_t *fields, tap_state_t state)
+int MINIDRIVER(interface_jtag_add_plain_dr_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	/* allocate memory for a new list member */
 	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
@@ -986,18 +988,18 @@
 	/* allocate memory for scan command */
 	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
 	cmd->cmd.scan->ir_scan = false;
-	cmd->cmd.scan->num_fields = num_fields;
-	cmd->cmd.scan->fields = cmd_queue_alloc(num_fields * sizeof(scan_field_t));
+	cmd->cmd.scan->num_fields = in_num_fields;
+	cmd->cmd.scan->fields = cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
 	cmd->cmd.scan->end_state = state;
 
-	for (int i = 0; i < num_fields; i++)
+	for (int i = 0; i < in_num_fields; i++)
 	{
-		int num_bits = fields[i].num_bits;
-		int num_bytes = CEIL(fields[i].num_bits, 8);
-		cmd->cmd.scan->fields[i].tap = fields[i].tap;
+		int num_bits = in_fields[i].num_bits;
+		int num_bytes = CEIL(in_fields[i].num_bits, 8);
+		cmd->cmd.scan->fields[i].tap = in_fields[i].tap;
 		cmd->cmd.scan->fields[i].num_bits = num_bits;
-		cmd->cmd.scan->fields[i].out_value = buf_cpy(fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		cmd->cmd.scan->fields[i].in_value = fields[i].in_value;
+		cmd->cmd.scan->fields[i].out_value = buf_cpy(in_fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
+		cmd->cmd.scan->fields[i].in_value = in_fields[i].in_value;
 	}
 
 	return ERROR_OK;



From kc8apf at mail.berlios.de  Wed May 20 06:48:21 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:48:21 +0200
Subject: [Openocd-svn] r1841 - trunk/src/jtag
Message-ID: <200905200448.n4K4mLhX014328@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:48:11 +0200 (Wed, 20 May 2009)
New Revision: 1841

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - rename local variable x to num_taps in interface_jtag_add_ir_scan



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 04:47:20 UTC (rev 1840)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:48:11 UTC (rev 1841)
@@ -592,10 +592,11 @@
 int MINIDRIVER(interface_jtag_add_ir_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	jtag_tap_t *tap;
-	int x;
 	int nth_tap;
 	int scan_size = 0;
 
+	int num_taps = jtag_NumEnabledTaps();
+
 	/* allocate memory for a new list member */
 	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
 	
@@ -606,9 +607,8 @@
 	/* allocate memory for ir scan command */
 	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
 	cmd->cmd.scan->ir_scan = true;
-	x = jtag_NumEnabledTaps();
-	cmd->cmd.scan->num_fields = x;	/* one field per device */
-	cmd->cmd.scan->fields = cmd_queue_alloc(x  * sizeof(scan_field_t));
+	cmd->cmd.scan->num_fields = num_taps;	/* one field per device */
+	cmd->cmd.scan->fields = cmd_queue_alloc(num_taps  * sizeof(scan_field_t));
 	cmd->cmd.scan->end_state = state;
 
 	nth_tap = -1;
@@ -623,7 +623,7 @@
 		}
 		nth_tap++;
 
-		assert(nth_tap < x );
+		assert(nth_tap < num_taps);
 
 		scan_size = tap->ir_length;
 		cmd->cmd.scan->fields[nth_tap].tap = tap;
@@ -654,8 +654,9 @@
 		/* update device information */
 		buf_cpy(cmd->cmd.scan->fields[nth_tap].out_value, tap->cur_instr, scan_size);
 	}
-	assert(nth_tap == (x-1));
 
+	assert(nth_tap == (num_taps - 1));
+
 	return ERROR_OK;
 }
 



From kc8apf at mail.berlios.de  Wed May 20 06:50:17 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:50:17 +0200
Subject: [Openocd-svn] r1842 - trunk/src/jtag
Message-ID: <200905200450.n4K4oHTO015281@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:49:53 +0200 (Wed, 20 May 2009)
New Revision: 1842

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - simplify code in interface_jtag_add_ir_scan() by adding a local variable 'scan' to hold the scan_command_t




Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 04:48:11 UTC (rev 1841)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:49:53 UTC (rev 1842)
@@ -589,6 +589,13 @@
 	}
 }
 
+/**
+ * Generate a list of scan fields with one entry for each TAP.
+ *
+ * If the input field list contains an instruction value for a TAP then that is used
+ * otherwise the TAP is set to bypass.
+ *
+ */
 int MINIDRIVER(interface_jtag_add_ir_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	jtag_tap_t *tap;
@@ -597,20 +604,19 @@
 
 	int num_taps = jtag_NumEnabledTaps();
 
-	/* allocate memory for a new list member */
-	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	
+	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
+
 	jtag_queue_command(cmd);
-	
-	cmd->type = JTAG_SCAN;
 
-	/* allocate memory for ir scan command */
-	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	cmd->cmd.scan->ir_scan = true;
-	cmd->cmd.scan->num_fields = num_taps;	/* one field per device */
-	cmd->cmd.scan->fields = cmd_queue_alloc(num_taps  * sizeof(scan_field_t));
-	cmd->cmd.scan->end_state = state;
+	cmd->type				= JTAG_SCAN;
+	cmd->cmd.scan			= scan;
 
+	scan->ir_scan			= true;
+	scan->num_fields		= num_taps;	/* one field per device */
+	scan->fields			= cmd_queue_alloc(num_taps  * sizeof(scan_field_t));
+	scan->end_state			= state;
+
 	nth_tap = -1;
 	tap = NULL;
 	for(;;){
@@ -625,10 +631,10 @@
 
 		assert(nth_tap < num_taps);
 
-		scan_size = tap->ir_length;
-		cmd->cmd.scan->fields[nth_tap].tap = tap;
-		cmd->cmd.scan->fields[nth_tap].num_bits = scan_size;
-		cmd->cmd.scan->fields[nth_tap].in_value = NULL; /* do not collect input for tap's in bypass */
+		scan_size						= tap->ir_length;
+		scan->fields[nth_tap].tap		= tap;
+		scan->fields[nth_tap].num_bits	= scan_size;
+		scan->fields[nth_tap].in_value	= NULL; /* do not collect input for tap's in bypass */
 
 		/* search the list */
 		for (int j = 0; j < in_num_fields; j++)
@@ -636,8 +642,8 @@
 			if (tap == in_fields[j].tap)
 			{
 				found = 1;
-				cmd->cmd.scan->fields[nth_tap].in_value = in_fields[j].in_value;
-				cmd->cmd.scan->fields[nth_tap].out_value = buf_cpy(in_fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+				scan->fields[nth_tap].in_value	= in_fields[j].in_value;
+				scan->fields[nth_tap].out_value	= buf_cpy(in_fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 
 				tap->bypass = 0;
 				break;
@@ -647,12 +653,12 @@
 		if (!found)
 		{
 			/* if a tap isn't listed, set it to BYPASS */
-			cmd->cmd.scan->fields[nth_tap].out_value = buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+			scan->fields[nth_tap].out_value = buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 			tap->bypass = 1;
 		}
 
 		/* update device information */
-		buf_cpy(cmd->cmd.scan->fields[nth_tap].out_value, tap->cur_instr, scan_size);
+		buf_cpy(scan->fields[nth_tap].out_value, tap->cur_instr, scan_size);
 	}
 
 	assert(nth_tap == (num_taps - 1));



From kc8apf at mail.berlios.de  Wed May 20 06:51:10 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:51:10 +0200
Subject: [Openocd-svn] r1843 - trunk/src/jtag
Message-ID: <200905200451.n4K4pAIF015979@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:51:08 +0200 (Wed, 20 May 2009)
New Revision: 1843

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - move scan_size in interface_jtag_add_ir_scan() into the scope of the inner loop and change it to unsigned



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 04:49:53 UTC (rev 1842)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:51:08 UTC (rev 1843)
@@ -600,7 +600,6 @@
 {
 	jtag_tap_t *tap;
 	int nth_tap;
-	int scan_size = 0;
 
 	int num_taps = jtag_NumEnabledTaps();
 
@@ -631,7 +630,7 @@
 
 		assert(nth_tap < num_taps);
 
-		scan_size						= tap->ir_length;
+		size_t scan_size				= tap->ir_length;
 		scan->fields[nth_tap].tap		= tap;
 		scan->fields[nth_tap].num_bits	= scan_size;
 		scan->fields[nth_tap].in_value	= NULL; /* do not collect input for tap's in bypass */



From kc8apf at mail.berlios.de  Wed May 20 06:51:56 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:51:56 +0200
Subject: [Openocd-svn] r1844 - trunk/src/jtag
Message-ID: <200905200451.n4K4puZi016645@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:51:46 +0200 (Wed, 20 May 2009)
New Revision: 1844

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - simplify code in interface_jtag_add_plain_ir_scan() by adding a local variable 'scan' to hold the scan_command_t



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 04:51:08 UTC (rev 1843)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:51:46 UTC (rev 1844)
@@ -678,29 +678,28 @@
 
 int MINIDRIVER(interface_jtag_add_plain_ir_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
-	/* allocate memory for a new list member */
 
-	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
 	
 	jtag_queue_command(cmd);
 
-	cmd->type = JTAG_SCAN;
+	cmd->type				= JTAG_SCAN;
+	cmd->cmd.scan			= scan;
 
-	/* allocate memory for ir scan command */
-	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	cmd->cmd.scan->ir_scan = true;
-	cmd->cmd.scan->num_fields = in_num_fields;
-	cmd->cmd.scan->fields = cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
-	cmd->cmd.scan->end_state = state;
+	scan->ir_scan			= true;
+	scan->num_fields		= in_num_fields;
+	scan->fields			= cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
+	scan->end_state			= state;
 
 	for (int i = 0; i < in_num_fields; i++)
 	{
 		int num_bits = in_fields[i].num_bits;
 		int num_bytes = CEIL(in_fields[i].num_bits, 8);
-		cmd->cmd.scan->fields[i].tap = in_fields[i].tap;
-		cmd->cmd.scan->fields[i].num_bits = num_bits;
-		cmd->cmd.scan->fields[i].out_value = buf_cpy(in_fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		cmd->cmd.scan->fields[i].in_value = in_fields[i].in_value;
+		scan->fields[i].tap = in_fields[i].tap;
+		scan->fields[i].num_bits = num_bits;
+		scan->fields[i].out_value = buf_cpy(in_fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
+		scan->fields[i].in_value = in_fields[i].in_value;
 	}
 
 	return ERROR_OK;



From kc8apf at mail.berlios.de  Wed May 20 06:52:28 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:52:28 +0200
Subject: [Openocd-svn] r1845 - trunk/src/jtag
Message-ID: <200905200452.n4K4qS6D017488@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:52:26 +0200 (Wed, 20 May 2009)
New Revision: 1845

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - simplify code in interface_jtag_add_dr_scan() by adding a local variable 'scan' to hold the scan_command_t



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 04:51:46 UTC (rev 1844)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:52:26 UTC (rev 1845)
@@ -808,20 +808,18 @@
 		}
 	}
 
-	/* allocate memory for a new list member */
+	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
 	
-	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
-	
 	jtag_queue_command(cmd);
 	
-	cmd->type = JTAG_SCAN;
+	cmd->type				= JTAG_SCAN;
+	cmd->cmd.scan			= scan;
 
-	/* allocate memory for dr scan command */
-	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	cmd->cmd.scan->ir_scan = false;
-	cmd->cmd.scan->num_fields = in_num_fields + bypass_devices;
-	cmd->cmd.scan->fields = cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
-	cmd->cmd.scan->end_state = state;
+	scan->ir_scan			= false;
+	scan->num_fields		= in_num_fields + bypass_devices;
+	scan->fields			= cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
+	scan->end_state			= state;
 
 	tap = NULL;
 	nth_tap = -1;
@@ -832,7 +830,7 @@
 			break;
 		}
 		int found = 0;
-		cmd->cmd.scan->fields[field_count].tap = tap;
+		scan->fields[field_count].tap = tap;
 
 		for (j = 0; j < in_num_fields; j++)
 		{
@@ -840,9 +838,9 @@
 			{
 				found = 1;
 				scan_size = in_fields[j].num_bits;
-				cmd->cmd.scan->fields[field_count].num_bits = scan_size;
-				cmd->cmd.scan->fields[field_count].out_value = buf_cpy(in_fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				cmd->cmd.scan->fields[field_count].in_value = in_fields[j].in_value;
+				scan->fields[field_count].num_bits	= scan_size;
+				scan->fields[field_count].out_value	= buf_cpy(in_fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+				scan->fields[field_count].in_value	= in_fields[j].in_value;
 				field_count++;
 			}
 		}
@@ -857,9 +855,9 @@
 			}
 #endif
 			/* program the scan field to 1 bit length, and ignore it's value */
-			cmd->cmd.scan->fields[field_count].num_bits = 1;
-			cmd->cmd.scan->fields[field_count].out_value = NULL;
-			cmd->cmd.scan->fields[field_count].in_value = NULL;
+			scan->fields[field_count].num_bits		= 1;
+			scan->fields[field_count].out_value		= NULL;
+			scan->fields[field_count].in_value		= NULL;
 			field_count++;
 		}
 		else
@@ -876,7 +874,7 @@
 	}
 
 	/* field_count represents the true number of fields setup*/
-	cmd->cmd.scan->num_fields = field_count;
+	scan->num_fields = field_count;
 	return ERROR_OK;
 }
 



From kc8apf at mail.berlios.de  Wed May 20 06:53:02 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:53:02 +0200
Subject: [Openocd-svn] r1846 - trunk/src/jtag
Message-ID: <200905200453.n4K4r26L018023@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:53:00 +0200 (Wed, 20 May 2009)
New Revision: 1846

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - move scan_size in interface_jtag_add_dr_scan() into the scope of the inner loop and change it to unsigned



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 04:52:26 UTC (rev 1845)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:53:00 UTC (rev 1846)
@@ -791,7 +791,6 @@
 	int nth_tap;
 	int bypass_devices = 0;
 	int field_count = 0;
-	int scan_size;
 
 	jtag_tap_t *tap;
 
@@ -837,7 +836,7 @@
 			if (tap == in_fields[j].tap)
 			{
 				found = 1;
-				scan_size = in_fields[j].num_bits;
+				size_t scan_size = in_fields[j].num_bits;
 				scan->fields[field_count].num_bits	= scan_size;
 				scan->fields[field_count].out_value	= buf_cpy(in_fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 				scan->fields[field_count].in_value	= in_fields[j].in_value;



From kc8apf at mail.berlios.de  Wed May 20 06:53:35 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:53:35 +0200
Subject: [Openocd-svn] r1847 - trunk/src/jtag
Message-ID: <200905200453.n4K4rZEa018463@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:53:34 +0200 (Wed, 20 May 2009)
New Revision: 1847

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - simplify code in interface_jtag_add_dr_out() by adding a local variable 'scan' to hold the scan_command_t



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 04:53:00 UTC (rev 1846)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:53:34 UTC (rev 1847)
@@ -903,19 +903,18 @@
 		}
 	}
 
-	/* allocate memory for a new list member */
-	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
 
 	jtag_queue_command(cmd);
 
-	cmd->type = JTAG_SCAN;
+	cmd->type				= JTAG_SCAN;
+	cmd->cmd.scan			= scan;
 
-	/* allocate memory for dr scan command */
-	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	cmd->cmd.scan->ir_scan = false;
-	cmd->cmd.scan->num_fields = in_num_fields + bypass_devices;
-	cmd->cmd.scan->fields = cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
-	cmd->cmd.scan->end_state = end_state;
+	scan->ir_scan			= false;
+	scan->num_fields		= in_num_fields + bypass_devices;
+	scan->fields			= cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
+	scan->end_state			= end_state;
 
 	tap = NULL;
 	nth_tap = -1;
@@ -925,7 +924,7 @@
 			break;
 		}
 		nth_tap++;
-		cmd->cmd.scan->fields[field_count].tap = tap;
+		scan->fields[field_count].tap = tap;
 
 		if (tap == target_tap)
 		{
@@ -943,9 +942,9 @@
 				u8 out_value[4];
 				scan_size = num_bits[j];
 				buf_set_u32(out_value, 0, scan_size, value[j]);
-				cmd->cmd.scan->fields[field_count].num_bits = scan_size;
-				cmd->cmd.scan->fields[field_count].out_value = buf_cpy(out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				cmd->cmd.scan->fields[field_count].in_value = NULL;
+				scan->fields[field_count].num_bits		= scan_size;
+				scan->fields[field_count].out_value		= buf_cpy(out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+				scan->fields[field_count].in_value		= NULL;
 				field_count++;
 			}
 		} else
@@ -959,9 +958,9 @@
 			}
 #endif
 			/* program the scan field to 1 bit length, and ignore it's value */
-			cmd->cmd.scan->fields[field_count].num_bits = 1;
-			cmd->cmd.scan->fields[field_count].out_value = NULL;
-			cmd->cmd.scan->fields[field_count].in_value = NULL;
+			scan->fields[field_count].num_bits			= 1;
+			scan->fields[field_count].out_value			= NULL;
+			scan->fields[field_count].in_value			= NULL;
 			field_count++;
 		}
 	}



From kc8apf at mail.berlios.de  Wed May 20 06:54:17 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:54:17 +0200
Subject: [Openocd-svn] r1848 - trunk/src/jtag
Message-ID: <200905200454.n4K4sHg6019082@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:54:15 +0200 (Wed, 20 May 2009)
New Revision: 1848

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - move scan_size in interface_jtag_add_dr_out() into the scope of the inner loop and change it to unsigned
    - move loop variable j into for scope



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 04:53:34 UTC (rev 1847)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:54:15 UTC (rev 1848)
@@ -885,7 +885,6 @@
 {
 	int nth_tap;
 	int field_count = 0;
-	int scan_size;
 	int bypass_devices = 0;
 
 	jtag_tap_t *tap;
@@ -928,7 +927,6 @@
 
 		if (tap == target_tap)
 		{
-			int j;
 #ifdef _DEBUG_JTAG_IO_
 			/* if a device is listed, the BYPASS register must not be selected */
 			if (tap->bypass)
@@ -937,10 +935,10 @@
 				exit(-1);
 			}
 #endif
-			for (j = 0; j < in_num_fields; j++)
+			for (int j = 0; j < in_num_fields; j++)
 			{
 				u8 out_value[4];
-				scan_size = num_bits[j];
+				size_t scan_size = num_bits[j];
 				buf_set_u32(out_value, 0, scan_size, value[j]);
 				scan->fields[field_count].num_bits		= scan_size;
 				scan->fields[field_count].out_value		= buf_cpy(out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);



From kc8apf at mail.berlios.de  Wed May 20 06:55:07 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 06:55:07 +0200
Subject: [Openocd-svn] r1849 - trunk/src/jtag
Message-ID: <200905200455.n4K4t7jl019768@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 06:55:01 +0200 (Wed, 20 May 2009)
New Revision: 1849

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - simplify code in interface_jtag_add_plain_dr_scan() by adding a local variable 'scan' to hold the scan_command_t



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 04:54:15 UTC (rev 1848)
+++ trunk/src/jtag/jtag.c	2009-05-20 04:55:01 UTC (rev 1849)
@@ -977,28 +977,27 @@
 
 int MINIDRIVER(interface_jtag_add_plain_dr_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
-	/* allocate memory for a new list member */
-	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
 
 	jtag_queue_command(cmd);
 
-	cmd->type = JTAG_SCAN;
+	cmd->type				= JTAG_SCAN;
+	cmd->cmd.scan			= scan;
 
-	/* allocate memory for scan command */
-	cmd->cmd.scan = cmd_queue_alloc(sizeof(scan_command_t));
-	cmd->cmd.scan->ir_scan = false;
-	cmd->cmd.scan->num_fields = in_num_fields;
-	cmd->cmd.scan->fields = cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
-	cmd->cmd.scan->end_state = state;
+	scan->ir_scan			= false;
+	scan->num_fields		= in_num_fields;
+	scan->fields			= cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
+	scan->end_state			= state;
 
 	for (int i = 0; i < in_num_fields; i++)
 	{
 		int num_bits = in_fields[i].num_bits;
 		int num_bytes = CEIL(in_fields[i].num_bits, 8);
-		cmd->cmd.scan->fields[i].tap = in_fields[i].tap;
-		cmd->cmd.scan->fields[i].num_bits = num_bits;
-		cmd->cmd.scan->fields[i].out_value = buf_cpy(in_fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		cmd->cmd.scan->fields[i].in_value = in_fields[i].in_value;
+		scan->fields[i].tap = in_fields[i].tap;
+		scan->fields[i].num_bits = num_bits;
+		scan->fields[i].out_value = buf_cpy(in_fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
+		scan->fields[i].in_value = in_fields[i].in_value;
 	}
 
 	return ERROR_OK;



From kc8apf at mail.berlios.de  Wed May 20 07:07:37 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 20 May 2009 07:07:37 +0200
Subject: [Openocd-svn] r1850 - trunk/src/target
Message-ID: <200905200507.n4K57biD028631@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-20 07:07:34 +0200 (Wed, 20 May 2009)
New Revision: 1850

Modified:
   trunk/src/target/mips32.c
   trunk/src/target/mips32.h
   trunk/src/target/mips_ejtag.c
   trunk/src/target/mips_ejtag.h
   trunk/src/target/mips_m4k.c
Log:
Author: Spencer Oliver <spen at spen-soft.co.uk>
- Bring the mips step/resume interrupt handling inline with the
rest of openocd.


Modified: trunk/src/target/mips32.c
===================================================================
--- trunk/src/target/mips32.c	2009-05-20 04:55:01 UTC (rev 1849)
+++ trunk/src/target/mips32.c	2009-05-20 05:07:34 UTC (rev 1850)
@@ -420,3 +420,41 @@
 	
 	return ERROR_OK;
 }
+
+int mips32_enable_interrupts(struct target_s *target, int enable)
+{
+	int retval;
+	int update = 0;
+	u32 dcr;
+	
+	/* read debug control register */
+	if ((retval = target_read_u32(target, EJTAG_DCR, &dcr)) != ERROR_OK)
+		return retval;
+	
+	if (enable)
+	{
+		if (!(dcr & (1<<4)))
+		{
+			/* enable interrupts */
+			dcr |= (1<<4);
+			update = 1;
+		}
+	}
+	else
+	{
+		if (dcr & (1<<4))
+		{
+			/* disable interrupts */
+			dcr &= ~(1<<4);
+			update = 1;
+		}
+	}
+	
+	if (update)
+	{
+		if ((retval = target_write_u32(target, EJTAG_DCR, dcr)) != ERROR_OK)
+			return retval;
+	}
+	
+	return ERROR_OK;
+}

Modified: trunk/src/target/mips32.h
===================================================================
--- trunk/src/target/mips32.h	2009-05-20 04:55:01 UTC (rev 1849)
+++ trunk/src/target/mips32.h	2009-05-20 05:07:34 UTC (rev 1850)
@@ -131,6 +131,7 @@
 extern reg_cache_t *mips32_build_reg_cache(target_t *target);
 extern int mips32_run_algorithm(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_params, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info);
 extern int mips32_configure_break_unit(struct target_s *target);
+extern int mips32_enable_interrupts(struct target_s *target, int enable);
 extern int mips32_examine(struct target_s *target);
 
 extern int mips32_register_commands(struct command_context_s *cmd_ctx);

Modified: trunk/src/target/mips_ejtag.c
===================================================================
--- trunk/src/target/mips_ejtag.c	2009-05-20 04:55:01 UTC (rev 1849)
+++ trunk/src/target/mips_ejtag.c	2009-05-20 05:07:34 UTC (rev 1850)
@@ -216,13 +216,11 @@
 	return ERROR_OK;
 }
 
-int mips_ejtag_exit_debug(mips_ejtag_t *ejtag_info, int enable_interrupts)
+int mips_ejtag_exit_debug(mips_ejtag_t *ejtag_info)
 {
 	u32 inst;
 	inst = MIPS32_DRET;
-
-	/* TODO : enable/disable interrrupts */
-
+	
 	/* execute our dret instruction */
 	mips32_pracc_exec(ejtag_info, 1, &inst, 0, NULL, 0, NULL, 0);
 

Modified: trunk/src/target/mips_ejtag.h
===================================================================
--- trunk/src/target/mips_ejtag.h	2009-05-20 04:55:01 UTC (rev 1849)
+++ trunk/src/target/mips_ejtag.h	2009-05-20 05:07:34 UTC (rev 1850)
@@ -108,7 +108,7 @@
 
 extern int mips_ejtag_set_instr(mips_ejtag_t *ejtag_info, int new_instr, void *delete_me_and_submit_patch);
 extern int mips_ejtag_enter_debug(mips_ejtag_t *ejtag_info);
-extern int mips_ejtag_exit_debug(mips_ejtag_t *ejtag_info, int enable_interrupts);
+extern int mips_ejtag_exit_debug(mips_ejtag_t *ejtag_info);
 extern int mips_ejtag_get_impcode(mips_ejtag_t *ejtag_info, u32 *impcode, in_handler_t handler);
 extern int mips_ejtag_get_idcode(mips_ejtag_t *ejtag_info, u32 *idcode, in_handler_t handler);
 extern int mips_ejtag_drscan_32(mips_ejtag_t *ejtag_info, u32 *data);

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2009-05-20 04:55:01 UTC (rev 1849)
+++ trunk/src/target/mips_m4k.c	2009-05-20 05:07:34 UTC (rev 1850)
@@ -344,8 +344,11 @@
 	/* configure single step mode */
 	mips_ejtag_config_step(ejtag_info, 1);
 
+	/* disable interrupts while stepping */
+	mips32_enable_interrupts(target, 0);
+	
 	/* exit debug mode */
-	mips_ejtag_exit_debug(ejtag_info, 1);
+	mips_ejtag_exit_debug(ejtag_info);
 
 	mips_m4k_debug_entry(target);
 
@@ -397,8 +400,11 @@
 		}
 	}
 
-	/* exit debug mode - enable interrupts if required */
-	mips_ejtag_exit_debug(ejtag_info, !debug_execution);
+	/* enable interrupts if we are running */
+	mips32_enable_interrupts(target, !debug_execution);
+	
+	/* exit debug mode */
+	mips_ejtag_exit_debug(ejtag_info);
 	target->debug_reason = DBG_REASON_NOTHALTED;
 
 	/* registers are now invalid */
@@ -452,8 +458,11 @@
 
 	target_call_event_callbacks(target, TARGET_EVENT_RESUMED);
 
+	/* disable interrupts while stepping */
+	mips32_enable_interrupts(target, 0);
+		
 	/* exit debug mode */
-	mips_ejtag_exit_debug(ejtag_info, 1);
+	mips_ejtag_exit_debug(ejtag_info);
 
 	/* registers are now invalid */
 	mips32_invalidate_core_regs(target);



From oharboe at mail.berlios.de  Wed May 20 08:18:42 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 20 May 2009 08:18:42 +0200
Subject: [Openocd-svn] r1851 - trunk/src/jtag
Message-ID: <200905200618.n4K6IgbY024483@sheep.berlios.de>

Author: oharboe
Date: 2009-05-20 08:18:40 +0200 (Wed, 20 May 2009)
New Revision: 1851

Modified:
   trunk/src/jtag/jtag.c
Log:
Spencer Oliver <spen at spen-soft.co.uk> use 7 tms out of reset

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 05:07:34 UTC (rev 1850)
+++ trunk/src/jtag/jtag.c	2009-05-20 06:18:40 UTC (rev 1851)
@@ -3328,10 +3328,10 @@
 
 	/* to state: */
 	/*	RESET			IDLE				DRSHIFT			DRPAUSE			IRSHIFT	  		IRPAUSE */			/* from state: */
-	{	B8(1111111,7),	B8(0000000,7),	B8(00101,5), 		B8(01010,5),	B8(001101,6), 	B8(010110,6) },		/* RESET */
+	{	B8(1111111,7),	B8(0000000,7),	B8(0010111,7),		B8(0001010,7),	B8(0011011,7),	B8(0010110,7) },	/* RESET */
 	{	B8(1111111,7),	B8(0000000,7),	B8(001,3),			B8(0101,4),		B8(0011,4),  	B8(01011,5) },		/* IDLE */
-	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(01,2),		B8(001111,6),	B8(0101111,7) },		/* DRSHIFT */
-	{	B8(1111111,7),	B8(011,3),		B8(01,2),   		B8(0,1),		B8(001111,6),	B8(0101111,7) },		/* DRPAUSE */
+	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(01,2),		B8(001111,6),	B8(0101111,7) },	/* DRSHIFT */
+	{	B8(1111111,7),	B8(011,3),		B8(01,2),   		B8(0,1),		B8(001111,6),	B8(0101111,7) },	/* DRPAUSE */
 	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(010111,6), 	B8(001111,6),	B8(01,2) },			/* IRSHIFT */
 	{	B8(1111111,7),	B8(011,3),		B8(00111,5),		B8(010111,6),	B8(01,2),		B8(0,1) } 			/* IRPAUSE */
 



From zwelch at mail.berlios.de  Wed May 20 10:16:56 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 20 May 2009 10:16:56 +0200
Subject: [Openocd-svn] r1852 - in trunk: doc/manual src
Message-ID: <200905200816.n4K8GulY016928@sheep.berlios.de>

Author: zwelch
Date: 2009-05-20 10:16:50 +0200 (Wed, 20 May 2009)
New Revision: 1852

Added:
   trunk/doc/manual/scripting.txt
Removed:
   trunk/src/scripting.txt
Log:
Move scripting overview from source tree to doxygen manual.

Copied: trunk/doc/manual/scripting.txt (from rev 1851, trunk/src/scripting.txt)
===================================================================
--- trunk/src/scripting.txt	2009-05-20 06:18:40 UTC (rev 1851)
+++ trunk/doc/manual/scripting.txt	2009-05-20 08:16:50 UTC (rev 1852)
@@ -0,0 +1,80 @@
+/** @page scripting OpenOCD Scripting Overview
+
+ at section What scripting will not do
+
+The scripting support is intended for developers of OpenOCD.
+It is not the intention that normal OpenOCD users will
+use tcl scripting extensively, write lots of clever scripts,
+or contribute back to OpenOCD. 
+
+Target scripts can contain new procedures that end users may
+tinker to their needs without really understanding tcl.
+
+Since end users are not expected to mess with the scripting
+language, the choice of language is not terribly important
+to those same end users.
+
+Jim Tcl was chosen as it was easy to integrate, works
+great in an embedded environment and ?yvind Harboe
+had experience with it.
+
+ at section Uses of scripting
+
+Default implementation of procedures in tcl/procedures.tcl.
+
+- Polymorphic commands for target scripts.
+  - there will be added some commands in Tcl that the target
+    scripts can replace.
+  - produce <productionfile> <serialnumber>. Default implementation
+    is to ignore serial number and write a raw binary file
+    to beginning of first flash. Target script can dictate
+    file format and structure of serialnumber. Tcl allows
+    an argument to consist of e.g. a list so the structure of
+    the serial number is not limited to a single string.
+  - reset handling. Precise control of how srst, trst & 
+    tms is handled.
+- replace some parts of the current command line handler.
+  This is only to simplify the implementation of OpenOCD
+  and will have no externally visible consequences.
+  Tcl has an advantage in that it's syntax is backwards
+  compatible with the current OpenOCD syntax.
+- external scripting. Low level tcl functions will be defined
+  that return machine readable output. These low level tcl
+  functions constitute the tcl api. flash_banks is such
+  a low level tcl proc. "flash banks" is an example of
+  a command that has human readable output. The human 
+  readable output is expected to change inbetween versions
+  of OpenOCD. The output from flash_banks may not be
+  in the preferred form for the client. The client then
+  has two choices a) parse the output from flash_banks
+  or b) write a small piece of tcl to output the
+  flash_banks output to a more suitable form. The latter may
+  be simpler.
+  
+  
+ at section External scripting
+
+The embedded Jim Tcl interpreter in OpenOCD is very limited
+compared to any full scale PC hosted scripting language.
+
+The goal is to keep the internal Jim Tcl interpreter as
+small as possible and allow any advanced scripting,
+especially scripting that interacts with the host,
+run on the host and talk to OpenOCD via the TCP/IP
+scripting connection.
+
+Another problem with Jim Tcl is that there is no debugger
+for it.
+
+With a bit of trickery it should be possible to run Jim
+Tcl scripts under a Tcl interpreter on a PC. The advantage
+would be that the Jim Tcl scripts could be debugged using
+a standard PC Tcl debugger.
+
+The rough idea is to write an unknown proc that sends
+unknown commands to OpenOCD.
+
+Basically a PC version of startup.tcl. Patches most
+gratefully accepted! :-)
+
+ */

Deleted: trunk/src/scripting.txt
===================================================================
--- trunk/src/scripting.txt	2009-05-20 06:18:40 UTC (rev 1851)
+++ trunk/src/scripting.txt	2009-05-20 08:16:50 UTC (rev 1852)
@@ -1,80 +0,0 @@
-Plan for hosted scripting support in OpenOCD
-============================================
-
-What scripting will not do
-==========================
-It is not the intention that normal OpenOCD users will
-use tcl scripting extensively, write lots of clever scripts,
-or contribute back to OpenOCD. 
-
-The scripting support is intended for developers of OpenOCD.
-
-Target scripts can contain new procedures that end users may
-tinker to their needs without really understanding tcl.
-
-Since end users are not expected to mess with the scripting
-language, the choice of language is not terribly important
-to those same end users.
-
-Jim Tcl was chosen as it was easy to integrate, works
-great in an embedded environment and ?yvind Harboe
-had experience with it.
-
-Uses of scripting
-=================
-Default implementation of procedures in tcl/procedures.tcl.
-
-- Polymorphic commands for target scripts.
-  - there will be added some commands in Tcl that the target
-    scripts can replace.
-  - produce <productionfile> <serialnumber>. Default implementation
-    is to ignore serial number and write a raw binary file
-    to beginning of first flash. Target script can dictate
-    file format and structure of serialnumber. Tcl allows
-    an argument to consist of e.g. a list so the structure of
-    the serial number is not limited to a single string.
-  - reset handling. Precise control of how srst, trst & 
-    tms is handled.
-- replace some parts of the current command line handler.
-  This is only to simplify the implementation of OpenOCD
-  and will have no externally visible consequences.
-  Tcl has an advantage in that it's syntax is backwards
-  compatible with the current OpenOCD syntax.
-- external scripting. Low level tcl functions will be defined
-  that return machine readable output. These low level tcl
-  functions constitute the tcl api. flash_banks is such
-  a low level tcl proc. "flash banks" is an example of
-  a command that has human readable output. The human 
-  readable output is expected to change inbetween versions
-  of OpenOCD. The output from flash_banks may not be
-  in the preferred form for the client. The client then
-  has two choices a) parse the output from flash_banks
-  or b) write a small piece of tcl to output the
-  flash_banks output to a more suitable form. The latter may
-  be simpler.
-  
-  
-External scripting
-==================
-The embedded Jim Tcl interpreter in OpenOCD is very limited
-compared to any full scale PC hosted scripting language.
-
-The goal is to keep the internal Jim Tcl interpreter as
-small as possible and allow any advanced scripting,
-especially scripting that interacts with the host,
-run on the host and talk to OpenOCD via the TCP/IP
-scripting connection.
-
-Another problem with Jim Tcl is that there is no debugger
-for it.
-
-With a bit of trickery it should be possible to run Jim
-Tcl scripts under a Tcl interpreter on a PC. The advantage
-would be that the Jim Tcl scripts could be debugged using
-a standard PC Tcl debugger.
-
-The rough idea is to write an unknown proc that sends
-unknown commands to OpenOCD.
-
-Basically a PC version of startup.tcl. Patches most
-gratefully accepted! :-)



From zwelch at mail.berlios.de  Wed May 20 10:43:26 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 20 May 2009 10:43:26 +0200
Subject: [Openocd-svn] r1853 - in trunk: doc/manual doc/manual/target src
Message-ID: <200905200843.n4K8hQld029411@sheep.berlios.de>

Author: zwelch
Date: 2009-05-20 10:43:18 +0200 (Wed, 20 May 2009)
New Revision: 1853

Added:
   trunk/doc/manual/target/
   trunk/doc/manual/target/notarm.txt
Removed:
   trunk/src/non-arm-targets.txt
Modified:
   trunk/doc/manual/target.txt
Log:
Move non-arm target overview from source tree to doxygen manual.

Copied: trunk/doc/manual/target/notarm.txt (from rev 1851, trunk/src/non-arm-targets.txt)
===================================================================
--- trunk/src/non-arm-targets.txt	2009-05-20 06:18:40 UTC (rev 1851)
+++ trunk/doc/manual/target/notarm.txt	2009-05-20 08:43:18 UTC (rev 1853)
@@ -0,0 +1,71 @@
+/** @page targetnotarm OpenOCD Non-ARM Targets
+
+This page describes outstanding issues w.r.t. non-ARM targets.
+
+ at section targetnotarmflash Flash drivers
+
+The flash drivers contain ARM32 code that is used
+to execute code on the target.
+
+This needs to be handled in some CPU independent
+manner.
+
+The ocl and ecos flash drivers compile the flash
+driver code to run on the target on the developer
+machine.
+
+The ocl and ecos flash drivers should be unified
+and instructions should be written on how to
+compile the target flash drivers. Perhaps
+using automake?
+
+
+eCos has CFI driver that could probably be compiled
+for all targets. The trick is to figure out a
+way to make the compiled flash drivers work
+on all target memory maps + sort out all the
+little details
+
+ at section targetnotarm32v64 32 vs. 64 bit
+
+Currently OpenOCD only supports 32 bit targets.
+
+Adding 64 bit support would be nice but there
+hasn't been any call for it in the openocd development
+mailing list
+
+ at section targetnotarmsupport Target Support
+
+target.h is relatively CPU agnostic and
+the intention is to move in the direction of less 
+instruction set specific.
+
+Non-CPU targets are also supported, but there isn't
+a lot of activity on it in the mailing list currently.
+An example is FPGA programming support via JTAG,
+but also flash chips can be programmed directly
+using JTAG.
+
+ at section targetnotarmphy non-JTAG physical layer
+
+JTAG is not the only physical protocol used to talk to
+CPUs.
+
+OpenOCD does not today have targets that use non-JTAG.
+
+The actual physical layer is a relatively modest part
+of the total OpenOCD system.
+
+ 
+ at section targetnotarmppc PowerPC
+
+there exists open source implementations of powerpc
+target manipulation, but there hasn't been a lot
+of activity in the mailing list.
+
+ at section targetnotarmmips MIPS
+
+Currently OpenOCD has a MIPS target defined. This is the
+first non-ARM example of a CPU target
+
+ */

Modified: trunk/doc/manual/target.txt
===================================================================
--- trunk/doc/manual/target.txt	2009-05-20 08:16:50 UTC (rev 1852)
+++ trunk/doc/manual/target.txt	2009-05-20 08:43:18 UTC (rev 1853)
@@ -23,12 +23,6 @@
 
  */
 
-/** @page targetnotarm OpenOCD Non-ARM Targets
-
-This section needs to describe OpenOCD's non-ARM target support.
-
- */
-
 /** @page targetregister OpenOCD Target Register API
 
 This section needs to describe OpenOCD's Target Register API, as

Deleted: trunk/src/non-arm-targets.txt
===================================================================
--- trunk/src/non-arm-targets.txt	2009-05-20 08:16:50 UTC (rev 1852)
+++ trunk/src/non-arm-targets.txt	2009-05-20 08:43:18 UTC (rev 1853)
@@ -1,76 +0,0 @@
-Some outstanding issues w.r.t. non-ARM32 targets
-================================================
-This file describes outstanding issues w.r.t.
-non-ARM32 targets.
-
-Ideas & patches welcome!
-
-
-
-
-Flash drivers
--------------
-The flash drivers contain ARM32 code that is used
-to execute code on the target.
-
-This needs to be handled in some CPU independent
-manner.
-
-The ocl and ecos flash drivers compile the flash
-driver code to run on the target on the developer
-machine.
-
-The ocl and ecos flash drivers should be unified
-and instructions should be written on how to
-compile the target flash drivers. Perhaps
-using automake?
-
-
-
-eCos has CFI driver that could probably be compiled
-for all targets. The trick is to figure out a
-way to make the compiled flash drivers work
-on all target memory maps + sort out all the
-little details
-
-32 vs. 64 bit
--------------
-Currently OpenOCD only supports 32 bit targets.
-
-Adding 64 bit support would be nice but there
-hasn't been any call for it in the openocd development
-mailing list
-
-target support
---------------
-target.h is relatively CPU agnostic and
-the intention is to move in the direction of less 
-instruction set specific.
-
-Non-CPU targets are also supported, but there isn't
-a lot of activity on it in the mailing list currently.
-An example is FPGA programming support via JTAG,
-but also flash chips can be programmed directly
-using JTAG.
-
-non-JTAG physical layer
------------------------
-JTAG is not the only physical protocol used to talk to
-CPUs.
-
-OpenOCD does not today have targets that use non-JTAG.
-
-The actual physical layer is a relatively modest part
-of the total OpenOCD system.
-
- 
-PowerPC
--------
-there exists open source implementations of powerpc
-target manipulation, but there hasn't been a lot
-of activity in the mailing list.
-
-MIPS
-----
-Currently OpenOCD has a MIPS target defined. This is the
-first non-ARM example of a CPU target
\ No newline at end of file



From zwelch at mail.berlios.de  Wed May 20 10:44:41 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 20 May 2009 10:44:41 +0200
Subject: [Openocd-svn] r1854 - trunk/doc
Message-ID: <200905200844.n4K8ifwR029712@sheep.berlios.de>

Author: zwelch
Date: 2009-05-20 10:44:37 +0200 (Wed, 20 May 2009)
New Revision: 1854

Modified:
   trunk/doc/Makefile.am
Log:
Fix doc/Makefile.am dist-hook to include all sections of manual.

Modified: trunk/doc/Makefile.am
===================================================================
--- trunk/doc/Makefile.am	2009-05-20 08:43:18 UTC (rev 1853)
+++ trunk/doc/Makefile.am	2009-05-20 08:44:37 UTC (rev 1854)
@@ -6,5 +6,9 @@
 dist-hook:
 	mkdir $(distdir)/manual
 	cp -p $(srcdir)/manual/*.txt $(distdir)/manual
+	for i in $$(cd $(srcdir)/manual/ && ls -d */); do \
+		mkdir $(distdir)/manual/$$i; \
+		cp -p $(srcdir)/manual/$$i/* $(distdir)/manual/$$i/; \
+	done
 
 MAINTAINERCLEANFILES = Makefile.in mdate-sh texinfo.tex



From zwelch at mail.berlios.de  Wed May 20 10:48:25 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 20 May 2009 10:48:25 +0200
Subject: [Openocd-svn] r1855 - in trunk: doc/manual/primer src/tcl
Message-ID: <200905200848.n4K8mP1W030951@sheep.berlios.de>

Author: zwelch
Date: 2009-05-20 10:48:19 +0200 (Wed, 20 May 2009)
New Revision: 1855

Added:
   trunk/doc/manual/primer/tcl.txt
Removed:
   trunk/src/tcl/README_ABOUT_TCL.txt
Log:
Move TCL overview from source tree to doxygen manual.

Copied: trunk/doc/manual/primer/tcl.txt (from rev 1851, trunk/src/tcl/README_ABOUT_TCL.txt)
===================================================================
--- trunk/src/tcl/README_ABOUT_TCL.txt	2009-05-20 06:18:40 UTC (rev 1851)
+++ trunk/doc/manual/primer/tcl.txt	2009-05-20 08:48:19 UTC (rev 1855)
@@ -0,0 +1,438 @@
+/** @page primertcl OpenOCD TCL Primer
+
+ at verbatim
+
+****************************************
+****************************************
+
+This is a short introduction to 'un-scare' you about the language
+known as TCL. It is structured as a guided tour through the files
+written by me [Duane Ellis] - in early July 2008 for OpenOCD.
+
+Which uses the "JIM" embedded Tcl clone-ish language.
+
+Thing described here are *totally* TCL generic... not Jim specific.
+
+The goal of this document is to encourage you to add your own set of
+chips to the TCL package - and most importantly you should know where
+you should put them - so they end up in an organized way.
+
+--Duane Ellis.
+	duane at duaneellis.com
+
+****************************************
+****************************************
+
+Adding "chip" support - Duane Ellis July 5 - 2008.
+
+The concept is this:
+  In your "openocd.cfg" file add something like this:
+
+     source [find tcl/chip/VENDOR/FAMILY/NAME.tcl]
+
+  For example...
+     source [find tcl/chip/atmel/at91/at91sam7x256.tcl]
+
+  You'll notice that it makes use of:
+
+       tcl/cpu/arm/<NAME>.tcl.
+
+  Yes, that is where you should put "core" specific things.
+  Be careful and learn the difference:
+
+  THE "CORE" - is not the entire chip!
+
+Definition:
+   That "file" listed above is called a "CHIP FILE".
+
+   It may be standalone, or may need to "source" other "helper" files.
+
+   The reference [7/5/2008] is the at91sam7x256.tcl file.
+
+****************************************
+****************************************
+=== TCL TOUR ===
+Open:  at91sam7x256.tcl
+=== TCL TOUR ===
+
+A walk through --- For those who are new to TCL.
+
+Examine the file: at91sam7x256.tcl
+
+It starts with:
+	source [find path/filename.tcl]
+
+In TCL - this is very important.
+
+	Rule #1 Everything is a string.
+	Rule #2 If you think other wise See #1.
+Reminds you of:
+	Rule #1: The wife is correct.
+	Rule #2: If you think otherwise, See #1
+
+Any text contained inside of [square-brackets]
+is just like `back-ticks` in BASH.
+
+Hence, the [find FILENAME] executes the command find with a single
+parameter the filename.
+
+========================================
+
+Next you see a series of:
+
+set  NAME    VALUE
+
+It is mostly "obvious" what is going on.
+
+Exception: The arrays.
+
+  You would *THINK* Tcl supports arrays.
+  In fact, multi-dim arrays. That is false.
+
+  For the index for"FLASH(0,CHIPSELECT)" is actually the string
+  "0,CHIPSELECT".  This is problematic. In the normal world, you think
+  of array indexes as integers.
+
+  For example these are different:
+
+       set foo(0x0c)  123
+       set foo(12)    444
+
+  Why? Because 0x0c {lowercase} is a string.
+  Don't forget UPPER CASE.
+
+  You must be careful - always... always...  use simple decimal
+  numbers. When in doubt use 'expr' the evaluator. These are all the
+  same.
+
+       set x 0x0c
+       set foo([expr $x])  "twelve"
+
+       set x 12
+       set foo([expr $x])  "twelve"
+
+       set x "2 * 6"
+       set foo([expr $x])  "twelve"
+       
+**************************************************
+***************************************************
+=== TCL TOUR ===
+Open the file: "bitsbytes.tcl"
+
+There is some tricky things going on.
+===============
+
+First, there is a "for" loop - at level 0
+{level 0 means: out side of a proc/function}
+
+This means it is evaluated when the file is parsed.
+
+== SIDEBAR: About The FOR command ==
+In TCL, "FOR" is a funny thing, it is not what you think it is.
+
+Syntactically - FOR is a just a command, it is not language
+construct like for(;;) in C... 
+
+The "for" command takes 4 parameters.
+   (1) The "initial command" to execute.
+   (2) the test "expression"
+   (3) the "next command"
+   (4) the "body command" of the FOR loop.
+
+Notice I used the words "command" and "expression" above.
+
+The FOR command:
+1)  executes the "initial command"
+2)  evaluates the expression if 0 it stops.
+3)  executes the "body command"
+4)  executes the "next command"
+5)  Goto Step 2.
+
+As show, each of these items are in {curly-braces}.  This means they
+are passed as they are - KEY-POINT: un evaluated to the FOR
+command. Think of it like escaping the backticks in Bash so that the
+"under-lying" command can evaluate the contents. In this case, the FOR
+COMMAND.
+
+== END: SIDEBAR: About The FOR command ==
+
+You'll see two lines:
+
+LINE1:
+       set vn [format "BIT%d" $x]
+
+Format is like "sprintf". Because of the [brackets], it becomes what
+you think.  But here's how:
+
+First - the line is parsed - for {braces}.  In this case, there are
+none.  The, the parser looks for [brackets] and finds them.  The,
+parser then evaluates the contents of the [brackets], and replaces
+them. It is alot this bash statement.
+
+       EXPORT vn=`date`
+
+LINE 2 & 3
+       set $vn [expr (1024 * $x)]
+       global $vn
+
+In line 1, we dynamically created a variable name.  Here, we are
+assigning it a value. Lastly Line 3 we force the variable to be
+global, not "local" the the "for command body"
+
+===============
+The PROCS
+
+proc create_mask { MSB LSB } {
+     ... body ....
+}
+
+Like "for" - PROC is really just a command that takes 3 parameters.
+The (1) NAME of the function, a (2) LIST of parameters, and a (3) BODY
+
+Again, this is at "level 0" so it is a global function.  (Yes, TCL
+supports local functions, you put them inside of a function}
+
+You'll see in some cases, I nest [brackets] alot and in others I'm
+lazy or wanted it to be more clear... it is a matter of choice.
+===============
+
+
+**************************************************
+***************************************************
+=== TCL TOUR ===
+Open the file: "memory.tcl"
+===============
+
+Here is where I setup some 'memory definitions' that various targets can use.
+
+For example - there is an "unknown" memory region.
+
+All memory regions must have 2 things:
+
+ (1)  N_<name>
+ (2)  NAME( array )
+      And the array must have some specific names:
+          ( <idx>, THING )
+	    Where: THING is one of: 
+		   CHIPSELECT
+		   BASE
+		   LEN
+		   HUMAN
+		   TYPE
+		   RWX - the access ability.
+		   WIDTH - the accessible width.
+
+        ie: Some regions of memory are not 'word' 
+	accessible.
+
+The function "address_info" - given an address should
+tell you about the address.
+
+     [as of this writing: 7/5/2008 I have done
+     only a little bit with this -Duane]
+
+===
+MAJOR FUNCTION:
+==
+
+proc memread32 { ADDR } 
+proc memread16 { ADDR } 
+proc memread8 { ADDR } 
+
+All read memory - and return the contents.
+
+[ FIXME: 7/5/2008 - I need to create "memwrite" functions]
+		 
+**************************************************
+***************************************************
+=== TCL TOUR ===
+Open the file: "mmr_helpers.tcl"
+===============
+
+This file is used to display and work with "memory mapped registers"
+
+For example - 'show_mmr32_reg' is given the NAME of the register to
+display. The assumption is - the NAME is a global variable holding the
+address of that MMR.
+
+The code does some tricks. The [set [set NAME]] is the TCL way
+of doing double variable interpolation - like makefiles...
+
+In a makefile or shell script you may have seen this:
+
+     FOO_linux = "Penguins rule"
+     FOO_winXP = "Broken Glass"
+     FOO_mac   = "I like cat names"
+     
+     # Pick one
+     BUILD  = linux
+     #BUILD = winXP
+     #BUILD = mac
+     FOO = ${FOO_${BUILD}}
+				
+The "double [set] square bracket" thing is the TCL way, nothing more.
+
+----
+
+The IF statement - and "CATCH" .
+
+Notice this IF COMMAND - (not statement) is like this:
+[7/5/2008 it is this way]
+
+       if ![catch { command } msg ] {
+	  ...something...
+       } else {
+          error [format string...]
+       }
+
+The "IF" command expects either 2 params, or 4 params.
+
+ === Sidebar: About "commands" ===
+  
+     Take a look at the internals of "jim.c"
+     Look for the function: Jim_IfCoreCommand()
+     And all those other "CoreCommands"
+
+     You'll notice - they all have "argc" and "argv"
+
+     Yea, the entire thing is done that way.
+     
+     IF is a command. SO is "FOR" and "WHILE" and "DO" and the
+     others. That is why I keep using the phase it is a "command"
+     
+ === END: Sidebar: About "commands" ===
+
+Parameter 1 to the IF command is expected to be an expression.
+
+As such, I do not need to wrap it in {braces}.
+
+In this case, the "expression" is the result of the "CATCH" command.
+
+CATCH - is an error catcher.
+
+You give CATCH 1 or 2 parameters.
+    The first 1st parameter is the "code to execute"
+    The 2nd (optional) is where to put the error message.
+    
+    CATCH returns 0 on success, 1 for failure.
+    The "![catch command]" is self explaintory.
+
+
+The 3rd parameter to IF must be exactly "else" or "elseif" [I lied
+above, the IF command can take many parameters they just have to
+be joined by exactly the words "else" or "elseif".
+
+The 4th parameter contains:
+    
+    "error [format STRING....]"
+
+This lets me modify the previous lower level error by tacking more
+text onto the end of it. In this case, i want to add the MMR register
+name to make my error message look better.
+
+---------
+Back to something inside show_mmr32_reg{}.
+
+You'll see something 'set fn show_${NAME}_helper' Here I am
+constructing a 'function name' Then - I look it up to see if it
+exists.  {the function: "proc_exists" does this}
+
+And - if it does - I call the function.
+
+In "C" it is alot like using: 'sprintf()' to construct a function name
+string, then using "dlopen()" and "dlsym()" to look it up - and get a
+function pointer - and calling the function pointer.
+
+In this case - I execute a dynamic command. You can do some cool
+tricks with interpretors. 
+
+----------
+
+Function:   show_mmr32_bits()
+
+In this case, we use the special TCL command "upvar" which tcl's way
+of passing things by reference. In this case, we want to reach up into
+the callers lexical scope and find the array named "NAMES"
+
+The rest of the function is pretty straight forward.
+
+First - we figure out the longest name.
+Then print 4 rows of 8bits - with names.
+
+
+**************************************************
+***************************************************
+=== TCL TOUR ===
+Open the file: "chips/atmel/at91/usarts.tcl"
+===============
+
+First - about the AT91SAM series - all of the usarts
+are basically identical...
+
+Second - there can be many of them.
+
+In this case - I do some more TCL tricks to dynamically
+create functions out of thin air.
+
+Some assumptions:
+
+The "CHIP" file has defined some variables in a proper form.
+
+ie:   AT91C_BASE_US0 - for usart0, 
+      AT91C_BASE_US1 - for usart1
+      ... And so on ...
+
+Near the end of the file - look for a large "foreach" loop that
+looks like this:
+
+      foreach WHO { US0 US1 US2 US3 US4 .... } {
+
+      }
+
+In this case, I'm trying to figure out what USARTs exist.
+
+Step 1 - is to determine if the NAME has been defined.
+ie: Does AT91C_BASE_USx - where X is some number exist?
+
+The "info exists VARNAME" tells you if the variable exists.  Then -
+inside the IF statement... There is another loop. This loop is the
+name of various "sub-registers" within the USART.
+
+Some more trick are played with the [set VAR] backtick evaluation stuff.
+And we create two variables
+
+We calculate and create the global variable name for every subregister in the USART.
+And - declare that variable as GLOBAL so the world can find it.
+
+Then - we dynamically create a function - based on the register name.
+
+Look carefully at how that is done. You'll notice the FUNCTION BODY is
+a string - not something in {braces}. Why? This is because we need TCL
+to evaluate the contents of that string "*NOW*" - when $vn exists not
+later, when the function "show_FOO" is invoked.
+
+Lastly - we build a "str" of commands - and create a single function -
+with the generated list of commands for the entire USART.
+
+With that little bit of code - I now have a bunch of functions like:
+
+   show_US0, show_US1, show_US2, .... etc ...
+   
+   And show_US0_MR, show_US0_IMR ... etc...
+  
+And - I have this for every USART... without having to create tons of
+boiler plate yucky code.
+
+****************************************
+****************************************
+END of the Tcl Intro and Walk Through
+****************************************
+****************************************
+
+FUTURE PLANS
+
+       Some "GPIO" functions...
+
+ at endverbatim
+
+ */

Deleted: trunk/src/tcl/README_ABOUT_TCL.txt
===================================================================
--- trunk/src/tcl/README_ABOUT_TCL.txt	2009-05-20 08:44:37 UTC (rev 1854)
+++ trunk/src/tcl/README_ABOUT_TCL.txt	2009-05-20 08:48:19 UTC (rev 1855)
@@ -1,430 +0,0 @@
-****************************************
-****************************************
-
-This is a short introduction to 'un-scare' you about the language
-known as TCL. It is structured as a guided tour through the files
-written by me [Duane Ellis] - in early July 2008 for OpenOCD.
-
-Which uses the "JIM" embedded Tcl clone-ish language.
-
-Thing described here are *totally* TCL generic... not Jim specific.
-
-The goal of this document is to encourage you to add your own set of
-chips to the TCL package - and most importantly you should know where
-you should put them - so they end up in an organized way.
-
---Duane Ellis.
-	duane at duaneellis.com
-
-****************************************
-****************************************
-
-Adding "chip" support - Duane Ellis July 5 - 2008.
-
-The concept is this:
-  In your "openocd.cfg" file add something like this:
-
-     source [find tcl/chip/VENDOR/FAMILY/NAME.tcl]
-
-  For example...
-     source [find tcl/chip/atmel/at91/at91sam7x256.tcl]
-
-  You'll notice that it makes use of:
-
-       tcl/cpu/arm/<NAME>.tcl.
-
-  Yes, that is where you should put "core" specific things.
-  Be careful and learn the difference:
-
-  THE "CORE" - is not the entire chip!
-
-Definition:
-   That "file" listed above is called a "CHIP FILE".
-
-   It may be standalone, or may need to "source" other "helper" files.
-
-   The reference [7/5/2008] is the at91sam7x256.tcl file.
-
-****************************************
-****************************************
-=== TCL TOUR ===
-Open:  at91sam7x256.tcl
-=== TCL TOUR ===
-
-A walk through --- For those who are new to TCL.
-
-Examine the file: at91sam7x256.tcl
-
-It starts with:
-	source [find path/filename.tcl]
-
-In TCL - this is very important.
-
-	Rule #1 Everything is a string.
-	Rule #2 If you think other wise See #1.
-Reminds you of:
-	Rule #1: The wife is correct.
-	Rule #2: If you think otherwise, See #1
-
-Any text contained inside of [square-brackets]
-is just like `back-ticks` in BASH.
-
-Hence, the [find FILENAME] executes the command find with a single
-parameter the filename.
-
-========================================
-
-Next you see a series of:
-
-set  NAME    VALUE
-
-It is mostly "obvious" what is going on.
-
-Exception: The arrays.
-
-  You would *THINK* Tcl supports arrays.
-  In fact, multi-dim arrays. That is false.
-
-  For the index for"FLASH(0,CHIPSELECT)" is actually the string
-  "0,CHIPSELECT".  This is problematic. In the normal world, you think
-  of array indexes as integers.
-
-  For example these are different:
-
-       set foo(0x0c)  123
-       set foo(12)    444
-
-  Why? Because 0x0c {lowercase} is a string.
-  Don't forget UPPER CASE.
-
-  You must be careful - always... always...  use simple decimal
-  numbers. When in doubt use 'expr' the evaluator. These are all the
-  same.
-
-       set x 0x0c
-       set foo([expr $x])  "twelve"
-
-       set x 12
-       set foo([expr $x])  "twelve"
-
-       set x "2 * 6"
-       set foo([expr $x])  "twelve"
-       
-**************************************************
-***************************************************
-=== TCL TOUR ===
-Open the file: "bitsbytes.tcl"
-
-There is some tricky things going on.
-===============
-
-First, there is a "for" loop - at level 0
-{level 0 means: out side of a proc/function}
-
-This means it is evaluated when the file is parsed.
-
-== SIDEBAR: About The FOR command ==
-In TCL, "FOR" is a funny thing, it is not what you think it is.
-
-Syntactically - FOR is a just a command, it is not language
-construct like for(;;) in C... 
-
-The "for" command takes 4 parameters.
-   (1) The "initial command" to execute.
-   (2) the test "expression"
-   (3) the "next command"
-   (4) the "body command" of the FOR loop.
-
-Notice I used the words "command" and "expression" above.
-
-The FOR command:
-1)  executes the "initial command"
-2)  evaluates the expression if 0 it stops.
-3)  executes the "body command"
-4)  executes the "next command"
-5)  Goto Step 2.
-
-As show, each of these items are in {curly-braces}.  This means they
-are passed as they are - KEY-POINT: un evaluated to the FOR
-command. Think of it like escaping the backticks in Bash so that the
-"under-lying" command can evaluate the contents. In this case, the FOR
-COMMAND.
-
-== END: SIDEBAR: About The FOR command ==
-
-You'll see two lines:
-
-LINE1:
-       set vn [format "BIT%d" $x]
-
-Format is like "sprintf". Because of the [brackets], it becomes what
-you think.  But here's how:
-
-First - the line is parsed - for {braces}.  In this case, there are
-none.  The, the parser looks for [brackets] and finds them.  The,
-parser then evaluates the contents of the [brackets], and replaces
-them. It is alot this bash statement.
-
-       EXPORT vn=`date`
-
-LINE 2 & 3
-       set $vn [expr (1024 * $x)]
-       global $vn
-
-In line 1, we dynamically created a variable name.  Here, we are
-assigning it a value. Lastly Line 3 we force the variable to be
-global, not "local" the the "for command body"
-
-===============
-The PROCS
-
-proc create_mask { MSB LSB } {
-     ... body ....
-}
-
-Like "for" - PROC is really just a command that takes 3 parameters.
-The (1) NAME of the function, a (2) LIST of parameters, and a (3) BODY
-
-Again, this is at "level 0" so it is a global function.  (Yes, TCL
-supports local functions, you put them inside of a function}
-
-You'll see in some cases, I nest [brackets] alot and in others I'm
-lazy or wanted it to be more clear... it is a matter of choice.
-===============
-
-
-**************************************************
-***************************************************
-=== TCL TOUR ===
-Open the file: "memory.tcl"
-===============
-
-Here is where I setup some 'memory definitions' that various targets can use.
-
-For example - there is an "unknown" memory region.
-
-All memory regions must have 2 things:
-
- (1)  N_<name>
- (2)  NAME( array )
-      And the array must have some specific names:
-          ( <idx>, THING )
-	    Where: THING is one of: 
-		   CHIPSELECT
-		   BASE
-		   LEN
-		   HUMAN
-		   TYPE
-		   RWX - the access ability.
-		   WIDTH - the accessible width.
-
-        ie: Some regions of memory are not 'word' 
-	accessible.
-
-The function "address_info" - given an address should
-tell you about the address.
-
-     [as of this writing: 7/5/2008 I have done
-     only a little bit with this -Duane]
-
-===
-MAJOR FUNCTION:
-==
-
-proc memread32 { ADDR } 
-proc memread16 { ADDR } 
-proc memread8 { ADDR } 
-
-All read memory - and return the contents.
-
-[ FIXME: 7/5/2008 - I need to create "memwrite" functions]
-		 
-**************************************************
-***************************************************
-=== TCL TOUR ===
-Open the file: "mmr_helpers.tcl"
-===============
-
-This file is used to display and work with "memory mapped registers"
-
-For example - 'show_mmr32_reg' is given the NAME of the register to
-display. The assumption is - the NAME is a global variable holding the
-address of that MMR.
-
-The code does some tricks. The [set [set NAME]] is the TCL way
-of doing double variable interpolation - like makefiles...
-
-In a makefile or shell script you may have seen this:
-
-     FOO_linux = "Penguins rule"
-     FOO_winXP = "Broken Glass"
-     FOO_mac   = "I like cat names"
-     
-     # Pick one
-     BUILD  = linux
-     #BUILD = winXP
-     #BUILD = mac
-     FOO = ${FOO_${BUILD}}
-				
-The "double [set] square bracket" thing is the TCL way, nothing more.
-
-----
-
-The IF statement - and "CATCH" .
-
-Notice this IF COMMAND - (not statement) is like this:
-[7/5/2008 it is this way]
-
-       if ![catch { command } msg ] {
-	  ...something...
-       } else {
-          error [format string...]
-       }
-
-The "IF" command expects either 2 params, or 4 params.
-
- === Sidebar: About "commands" ===
-  
-     Take a look at the internals of "jim.c"
-     Look for the function: Jim_IfCoreCommand()
-     And all those other "CoreCommands"
-
-     You'll notice - they all have "argc" and "argv"
-
-     Yea, the entire thing is done that way.
-     
-     IF is a command. SO is "FOR" and "WHILE" and "DO" and the
-     others. That is why I keep using the phase it is a "command"
-     
- === END: Sidebar: About "commands" ===
-
-Parameter 1 to the IF command is expected to be an expression.
-
-As such, I do not need to wrap it in {braces}.
-
-In this case, the "expression" is the result of the "CATCH" command.
-
-CATCH - is an error catcher.
-
-You give CATCH 1 or 2 parameters.
-    The first 1st parameter is the "code to execute"
-    The 2nd (optional) is where to put the error message.
-    
-    CATCH returns 0 on success, 1 for failure.
-    The "![catch command]" is self explaintory.
-
-
-The 3rd parameter to IF must be exactly "else" or "elseif" [I lied
-above, the IF command can take many parameters they just have to
-be joined by exactly the words "else" or "elseif".
-
-The 4th parameter contains:
-    
-    "error [format STRING....]"
-
-This lets me modify the previous lower level error by tacking more
-text onto the end of it. In this case, i want to add the MMR register
-name to make my error message look better.
-
----------
-Back to something inside show_mmr32_reg{}.
-
-You'll see something 'set fn show_${NAME}_helper' Here I am
-constructing a 'function name' Then - I look it up to see if it
-exists.  {the function: "proc_exists" does this}
-
-And - if it does - I call the function.
-
-In "C" it is alot like using: 'sprintf()' to construct a function name
-string, then using "dlopen()" and "dlsym()" to look it up - and get a
-function pointer - and calling the function pointer.
-
-In this case - I execute a dynamic command. You can do some cool
-tricks with interpretors. 
-
-----------
-
-Function:   show_mmr32_bits()
-
-In this case, we use the special TCL command "upvar" which tcl's way
-of passing things by reference. In this case, we want to reach up into
-the callers lexical scope and find the array named "NAMES"
-
-The rest of the function is pretty straight forward.
-
-First - we figure out the longest name.
-Then print 4 rows of 8bits - with names.
-
-
-**************************************************
-***************************************************
-=== TCL TOUR ===
-Open the file: "chips/atmel/at91/usarts.tcl"
-===============
-
-First - about the AT91SAM series - all of the usarts
-are basically identical...
-
-Second - there can be many of them.
-
-In this case - I do some more TCL tricks to dynamically
-create functions out of thin air.
-
-Some assumptions:
-
-The "CHIP" file has defined some variables in a proper form.
-
-ie:   AT91C_BASE_US0 - for usart0, 
-      AT91C_BASE_US1 - for usart1
-      ... And so on ...
-
-Near the end of the file - look for a large "foreach" loop that
-looks like this:
-
-      foreach WHO { US0 US1 US2 US3 US4 .... } {
-
-      }
-
-In this case, I'm trying to figure out what USARTs exist.
-
-Step 1 - is to determine if the NAME has been defined.
-ie: Does AT91C_BASE_USx - where X is some number exist?
-
-The "info exists VARNAME" tells you if the variable exists.  Then -
-inside the IF statement... There is another loop. This loop is the
-name of various "sub-registers" within the USART.
-
-Some more trick are played with the [set VAR] backtick evaluation stuff.
-And we create two variables
-
-We calculate and create the global variable name for every subregister in the USART.
-And - declare that variable as GLOBAL so the world can find it.
-
-Then - we dynamically create a function - based on the register name.
-
-Look carefully at how that is done. You'll notice the FUNCTION BODY is
-a string - not something in {braces}. Why? This is because we need TCL
-to evaluate the contents of that string "*NOW*" - when $vn exists not
-later, when the function "show_FOO" is invoked.
-
-Lastly - we build a "str" of commands - and create a single function -
-with the generated list of commands for the entire USART.
-
-With that little bit of code - I now have a bunch of functions like:
-
-   show_US0, show_US1, show_US2, .... etc ...
-   
-   And show_US0_MR, show_US0_IMR ... etc...
-  
-And - I have this for every USART... without having to create tons of
-boiler plate yucky code.
-
-****************************************
-****************************************
-END of the Tcl Intro and Walk Through
-****************************************
-****************************************
-
-FUTURE PLANS
-
-       Some "GPIO" functions...



From zwelch at mail.berlios.de  Wed May 20 10:58:12 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 20 May 2009 10:58:12 +0200
Subject: [Openocd-svn] r1856 - trunk/doc/manual
Message-ID: <200905200858.n4K8wCWb005455@sheep.berlios.de>

Author: zwelch
Date: 2009-05-20 10:58:09 +0200 (Wed, 20 May 2009)
New Revision: 1856

Modified:
   trunk/doc/manual/main.txt
Log:
Add new TCL Primer under the main Technical Primer page.

Modified: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-05-20 08:48:19 UTC (rev 1855)
+++ trunk/doc/manual/main.txt	2009-05-20 08:58:09 UTC (rev 1856)
@@ -18,6 +18,7 @@
 They seek to provide information to pull novices up the learning curves
 associated with the fundamental technologies used by OpenOCD.
 
+- @subpage primertcl
 - @subpage primerjtag
 
 Contributions or suggestions for new Technical Primers are welcome.



From zwelch at mail.berlios.de  Wed May 20 11:01:05 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 20 May 2009 11:01:05 +0200
Subject: [Openocd-svn] r1857 - trunk/doc/manual
Message-ID: <200905200901.n4K915JV005716@sheep.berlios.de>

Author: zwelch
Date: 2009-05-20 11:01:01 +0200 (Wed, 20 May 2009)
New Revision: 1857

Modified:
   trunk/doc/manual/server.txt
Log:
Add initial OpenOCD server documentation (Duane Ellis and myself).

Modified: trunk/doc/manual/server.txt
===================================================================
--- trunk/doc/manual/server.txt	2009-05-20 08:58:09 UTC (rev 1856)
+++ trunk/doc/manual/server.txt	2009-05-20 09:01:01 UTC (rev 1857)
@@ -7,8 +7,294 @@
   - @subpage servertelnet
   - @subpage serverhttp
 
-This section needs to be expanded.
+ at section serverdocsoverview Overview
 
+What follows is a development history, and describes some of the intent
+of why certain features exist within OpenOCD along with the reasoning
+behind them.
+
+This roadmap section was written May 2009 - about 9 to 12 months
+after some of this work had started, it attempts to document some of
+the reasons why certain features exist within OpenOCD at that time.
+
+ at section serverdocsbg Background
+
+In early 2008, Oyvind Harboe and Duane Ellis had talked about how to
+create a reasonable GUI for OpenOCD - something that is non-invasive,
+simple to use and maintain, and does not tie OpenOCD to many other
+packages.  It would be wrong to "spider web" requirements into other
+external external packages.  That makes it difficult for developers to
+write new code and creates a support nightmare.
+
+In many ways, people had talked about the need for some type of
+high-level interface to OpenOCD, because they only had two choices:
+- the ability to script: via an external program the actions of OpenOCD.
+- the ablity to write a complex internal commands: native 'commands'
+  inside of OpenOCD was complicated.
+
+Fundamentally, the basic problem with both of those would be solved 
+with a script language:
+
+-# <b>Internal</b>: simple, small, and self-contained.
+-# <b>Cross Language</b>: script friendly front-end
+-# <b>Cross Host</b>: GUI Host interface
+-# <b>Cross Debugger</b>: GUI-like interface
+  
+What follows hopefully shows how the plans to solve these problems
+materialized and help to explain the grand roadmap plan.
+
+ at subsection serverdocsjim Why JimTCL? The Internal Script Language
+
+At the time, the existing "command context schema" was proving itself
+insufficient.  However, the problem was also considered from another
+direction: should OpenOCD be first class and the script second class?
+Which one rules?
+
+In the end, OpenOCD won, the conclusion was that simpler will be better.
+Let the script language be "good enough"; it would not need numerous
+features.  Imagine debugging an embedded Perl module while debugging
+OpenOCD. Yuck.  OpenOCD already has a complex enough build system, why
+make it worse?
+
+The goal was to add a simple language that would be moderately easy to
+work with and be self-contained.  JimTCL is a single C and single H
+file, allowing OpenOCD to avoid the spider web of dependent packages.
+
+ at section serverdocstcl TCL Server Port
+
+The TCL Server port was added in mid-2008.  With embedded TCL, we can
+write scripts internally to help things, or we can write "C" code  that
+interfaces well with TCL. 
+
+From there, the developers wanted to create an external front-end that
+would be @a very usable and that that @a any language could utilize,
+allowing simple front-ends to be (a) cross-platform (b) languag
+agnostic, and (c) easy to develop and use.
+
+Simple ASCII protocols are easy.  For example, HTTP, FTP (control), and
+SMTP are all text-based.  All of these examples are widely and
+well-known, and they do not require high-speed or high-volume.  They
+also support a high degree of interoperability with multiple systems.
+They are not human-centric protocols; more correctly, they are rigid,
+terse, simple ASCII protocols that are emensely parsable by a script.
+
+Thus, the TCL server -- a 'machine' type socket interface -- was added
+with the hope was it would output simple "name-value" pair type
+data.  At the time, simple name/value pairs seemed reasonably easier to
+do at the time, though Maybe it should output JSON; 
+
+See here:
+
+   http://www.mail-archive.com/openocd-development%40lists.berlios.de/msg00248.html
+
+The hope was that one could write a script in what ever language you want
+and do things with it!
+
+ at section serverdocsgui GUI Like Interfaces
+
+A lot has been said about various "widigit-foo-gui-library is so
+wonderful".  Please refer back to the domino and spider web problem of
+dependencies.  Sure, you may well know the WhatEver-GUI library, but
+most others will not (including the next contributer to OpenOCD).
+How do we solve that problem?
+
+For example, Cygwin can be painful, Cygwin GUI packages want X11
+to be present, crossing the barrier between MinGW and Cygwin is
+painful, let alone getting the GUI front end to work on MacOS, and
+Linux, yuck yuck yuck. Painful. very very painful.  
+
+What works easier and is less work is what is already present in every
+platform?  The answer: A web browser.  In other words, OpenOCD could
+serve out embedded web pages via "localhost" to your browser. 
+
+Long before OpenOCD had a TCL command line, Zylin AS built their ZY1000
+devince with a built-in HTTP server.  Later, they were willing to both
+contribute and integrate most of that work into the main tree.
+
+ at subsection serverdocsother Other Options Concidered
+
+What if a web browser is not acceptable ie: You want to write your own
+front gadget in Eclipse, or KDevelop, or PerlTK, Ruby, or what ever
+the latest and greatest Script De Jour is.
+
+- Option 1: Can we transport this extra data through the GDB server
+protocol? In other words, can we extend the GDB server protocol?
+No, Eclipse wants to talk to GDB directly and control the GDB port.
+
+- Option 2: SWIG front end (libopenocd): Would that work?
+
+That's painful - unless you design your api to be very simplistic -
+every language has it's own set of wack-ness, parameter marshaling is
+painful.
+
+What about "callbacks" and structures, and other mess. Imagine
+debugging that system.  When JimTCL was introduced Spencer Oliver had
+quite a few well-put concerns (Summer 2008) about the idea of "TCL"
+taking over OpenOCD.  His concern is and was: how do you debug
+something written in 2 different languages?  A "SWIG" front-end is
+unlikely to help that situation.
+
+ at subsection serverdoccombined Combined: Socket & WebServer Benifits
+
+Seriously think about this question: What script language (or compiled
+language) today cannot talk directly to a socket? Every thing in the
+OpenOCD world can work a socket interface. Any host side tool can talk
+to Localhost or remote host, however one might want to make it work.
+
+A socket interface is very simple. One could write a Java application
+and serve it out via the embedded web server, could it - or something
+like it talk to the built in TCL server? Yes, absolutely! We are on to
+something here.
+
+ at subsection serverdocplatforms Platform Permuntations
+
+Look at some permutations where OpenOCD can run; these "just work" if
+the Socket Approach is used.
+
+
+- Linux/Cygwin/MinGw/MacOSx/FreeBSD development Host Locally
+- OpenOCD with some dongle on that host
+
+
+- Linux/Cygwin/MingW/MacOS/FreeBSD development host
+- DONGLE:  tcpip based ARM-Linux perhaps at91rm9200 or ep93xx.c, running openocd.
+
+
+- Windows cygwin/X desktop environment.
+- Linux development host (via remote X11)
+- Dongle:  "eb93xx.c" based linux board
+
+
+ at subsection serverdocfuture Development Scale Out
+
+During 2008, Duane Ellis created some TCL scripts to display peripheral
+register contents. For example, look at the sam7 TCL scripts, and the
+stm32 TCL scripts.  The hope was others would create more. 
+
+
+A good example of this is display/view the peripheral registers on
+your embedded target.  Lots of commercial embedded debug tools have
+this, some can show the TIMER registers, the interrupt controller.
+
+What if the chip companies behind STM32, or PIC32, AT91SAM chips -
+wanted to write something that makes working with their chip better,
+easier, faster, etc.
+
+ at a Question: How can we (the OpenOCD group) make that really fancy
+stuff across multiple different host platforms?
+
+Remember: OpenOCD runs on:
+-# Linux via USB,
+-# ARM Linux - bit-banging GPIO pins
+-# MacOSX
+-# FreeBSD
+-# Cygwin
+-# MinGW32
+-# Ecos
+
+How can we get that to work?
+
+ at subsection serverdocdebug What about Debugger Plugins?
+
+Really GDB is nice, it works, but it is not a good embedded debug tool.
+OpenOCD cannot work in a GUI when one cannot get to its command line.
+Some GDB front-end developers have pedantic designs that refuse any and
+all access to the GDB command line (e.g.  http://www.kdbg.org/todo.php).
+
+The TELNET interface to OpenOCD works, but the intent of that interface
+is <b>human interaction</b>. It must remain available, developers depend
+upon it, sometimes that is the only scheme available.
+
+As a small group of developers, supporting all the platforms and
+targets in the debugger will be difficult, as there are enough problem
+with the plethora of Dongles, Chips, and different target boards.
+Yes, the TCL interface might be suitable, but it has not received much
+love or attention.  Perhaps it will after you read and understand this.
+
+One reason might be, this adds one more host side requirement to make
+use of the feature.  In other words, one could write a Python/TK
+front-end, but it is only useable if you have Python/TK installed.
+Maybe this can be done via Ecllipse, but not all developers use Ecplise.
+Many devlopers use Emacs (possibly with GUD mode) or vim and will not 
+accept such an interface.  The next developer reading this might be
+using Insight (GDB-TK) - and somebody else - DDD..
+
+There is no common host-side GDB front-end method.
+
+ at section serverdocschallenge Front-End Scaling
+
+Maybe we are wrong - ie: OpenOCD + some TK tool
+
+Remember: OpenOCD is often (maybe 99.9%) of the time used with
+GDB-REMOTE.  There is always some front-end package - be it command-line
+GDB under DDD, Eclipse, KDevelop, Emacs, or some other package
+(e.g. IAR tools can talk to GDB servers).  How can the OpenOCD
+developers make that fancy target display GUI visible under 5 to 10
+different host-side GDB..
+
+Sure - a <em>man on a mission</em> can make that work.  The GUI might be
+libopenocd + Perl/TK, or maybe an Eclipse Plug-in.
+That is a development support nightmare for reasons described
+above. We have enough support problems as it is with targets, dongles,
+etc.
+
+ at section serverdocshttpbg HTTP Server Background
+
+OpenOCD includes an HTTP server because most development environments
+are likely contain a web browser.  The web browser can talk to OpenOCD's
+HTTP server and provide a high-level interfaces to the program.
+Altogether, it provides a universally accessible GUI for OpenOCD.
+
+ at section serverdocshtml Simple HTML Pages
+
+There is (or could be) a simple "Jim TCL" function to read a memory
+location. If that can be tied into a TCL script that can modify the
+HTTP text, then we have a simple script-based web server with a JTAG
+engine under the hood.
+
+Imagine a web page - served from a small board with two buttons:
+"LED_ON" and "LED_OFF", each click - turns the LED on or OFF, a very
+simplistic idea.  Little boards with web servers are great examples of
+this: Ethernut is a good example and Contiki (not a board, an embedded
+OS) is another example.
+
+One could create a simple: <b>Click here to display memory</b> or maybe
+<b>click here to display the UART REGISTER BLOCK</b>; click again and see
+each register explained in exquisit detail.
+
+For an STM32, one could create a simple HTML page, with simple
+substitution text that the simple web server use to substitute the
+HTML text JIMTCL_PEEK32( 0x12345678 ) with the value read from
+memory. We end up with an HTML page that could list the contents of
+every peripheral register on the target platform.
+
+That also is transportable, regardless of the OpenOCD host
+platform: Linux/X86, Linux/ARM, FreeBSD, Cygwin, MingW, or MacOSX.
+You could even port OpenOCD to an Google Android and use it as a
+bit-bang dongle JTAG serving web pages.
+
+ at subsection serverdocshtmladv Advanced HTML Pages
+
+Java or JavaScript could be used to talk back to the TCL port.  One
+could write a Java, AJAX, FLASH, or some other developer friendly
+toolbox and get a real cross-platform GUI interface. Sure, the interface
+is not native - but it is 100% cross-platform!
+
+OpenOCD current uses simple HTML pages; others might be an Adobe FLASH
+expert, or a Java Expert.  These possibilities could allow the pages
+remain cross-platform but still provide a rich user-interface
+experience.
+
+Don't forget it can also be very simple, exactly what one developer
+can contribute, a set of very simple web pages.
+
+ at subsection serverdocshtmlstatus HTTP/HTML Status
+
+As of May 2009, much of the HTML pages were contributed by Zylin AS,
+hence they continue to retain some resemblance to the ZY1000 interface.
+
+Patches would be welcome to move these parts of the system forward.
+
  */
 
 /** @page servergdb OpenOCD GDB Server API



From zwelch at mail.berlios.de  Wed May 20 22:52:19 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 20 May 2009 22:52:19 +0200
Subject: [Openocd-svn] r1858 - in trunk: . tools
Message-ID: <200905202052.n4KKqJZt026965@sheep.berlios.de>

Author: zwelch
Date: 2009-05-20 22:52:14 +0200 (Wed, 20 May 2009)
New Revision: 1858

Added:
   trunk/tools/logger.pl
Modified:
   trunk/Makefile.am
Log:
Add 'docs' and 'doxygen' targets to top-level Makefile.

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-05-20 09:01:01 UTC (rev 1857)
+++ trunk/Makefile.am	2009-05-20 20:52:14 UTC (rev 1858)
@@ -13,6 +13,14 @@
 
 EXTRA_DIST = Doxyfile
 
+docs: pdf html doxygen
+
+doxygen::
+	doxygen Doxyfile 2>&1 | perl tools/logger.pl > doxygen.log
+
+doxygen-clean:
+	rm -f -r doxygen doxygen.log
+
 MAINTAINERCLEANFILES = \
 	configure \
 	Makefile.in \

Added: trunk/tools/logger.pl
===================================================================
--- trunk/tools/logger.pl	2009-05-20 09:01:01 UTC (rev 1857)
+++ trunk/tools/logger.pl	2009-05-20 20:52:14 UTC (rev 1858)
@@ -0,0 +1,34 @@
+#!/usr/bin/perl
+# logger.pl: masks long meaningless output with pretty lines of dots
+#  Details: 1) reads lines from STDIN and echos them on STDOUT,
+#           2) print a '.' to STDERR every $N lines.
+#           3) print a newline after a sequence of $C dots
+
+use strict;
+use warnings;
+
+# make sure all output gets displayed immediately
+$| = 1;
+
+# TODO: add -n and -c options w/ zero checks)
+# line and column limits
+my $N = 10;
+my $C = 72;
+
+# current line and column counters
+my $n = 0;
+my $c = 0;
+
+# read all lines from STDIN
+while (<STDIN>)
+{
+	# echo line to output
+	print STDOUT $_;
+	# only display progress every Nth step
+	next unless ++$n % $N;
+	print STDERR ".";
+	# wrap at column C to provide fixed-width rows of dots
+	print STDERR "\n" unless ++$c % $C;
+}
+
+print STDERR "\n"


Property changes on: trunk/tools/logger.pl
___________________________________________________________________
Name: svn:eol-style
   + native



From kc8apf at mail.berlios.de  Thu May 21 06:37:33 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:37:33 +0200
Subject: [Openocd-svn] r1859 - trunk/src/jtag
Message-ID: <200905210437.n4L4bXWs029252@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:37:31 +0200 (Thu, 21 May 2009)
New Revision: 1859

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - add doxygen comments to scan commands in jtag.c
    - move jtag_add_dr_scan next to interface_jtag_add_dr_scan to keep these function pairs together




Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-20 20:52:14 UTC (rev 1858)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:37:31 UTC (rev 1859)
@@ -566,6 +566,15 @@
 }
 
 
+/**
+ * Generate an IR SCAN with a list of scan fields with one entry for each enabled TAP.
+ *
+ * If the input field list contains an instruction value for a TAP then that is used
+ * otherwise the TAP is set to bypass.
+ *
+ * TAPs for which no fields are passed are marked as bypassed for subsequent DR SCANs.
+ *
+ */
 void jtag_add_ir_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	if (jtag_verify&&jtag_verify_capture_ir)
@@ -590,11 +599,8 @@
 }
 
 /**
- * Generate a list of scan fields with one entry for each TAP.
+ * see jtag_add_ir_scan()
  *
- * If the input field list contains an instruction value for a TAP then that is used
- * otherwise the TAP is set to bypass.
- *
  */
 int MINIDRIVER(interface_jtag_add_ir_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
@@ -665,6 +671,12 @@
 	return ERROR_OK;
 }
 
+/**
+ * Duplicate the scan fields passed into the function into an IR SCAN command
+ *
+ * This function assumes that the caller handles extra fields for bypassed TAPs
+ *
+ */
 void jtag_add_plain_ir_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
@@ -676,6 +688,11 @@
 		jtag_error=retval;
 }
 
+
+/**
+ * see jtag_add_plain_ir_scan()
+ *
+ */
 int MINIDRIVER(interface_jtag_add_plain_ir_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 
@@ -705,18 +722,8 @@
 	return ERROR_OK;
 }
 
-void jtag_add_dr_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
-{
-	int retval;
 
-	jtag_prelude(state);
 
-	retval=interface_jtag_add_dr_scan(in_num_fields, in_fields, cmd_queue_end_state);
-	if (retval!=ERROR_OK)
-		jtag_error=retval;
-}
-
-
 int jtag_check_value_inner(u8 *captured, u8 *in_check_value, u8 *in_check_mask, int num_bits);
 
 static int jtag_check_value_mask_callback(u8 *in, jtag_callback_data_t data1, jtag_callback_data_t data2, jtag_callback_data_t data3)
@@ -785,6 +792,32 @@
 	}
 }
 
+
+/**
+ * Generate a DR SCAN using the fields passed to the function
+ *
+ * For not bypassed TAPs the function checks in_fields and uses fields specified there.
+ * For bypassed TAPs the function generates a dummy 1bit field.
+ *
+ * The bypass status of TAPs is set by jtag_add_ir_scan().
+ *
+ */
+void jtag_add_dr_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
+{
+	int retval;
+
+	jtag_prelude(state);
+
+	retval=interface_jtag_add_dr_scan(in_num_fields, in_fields, cmd_queue_end_state);
+	if (retval!=ERROR_OK)
+		jtag_error=retval;
+}
+
+
+/**
+ * see jtag_add_dr_scan()
+ *
+ */
 int MINIDRIVER(interface_jtag_add_dr_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	int j;
@@ -877,6 +910,22 @@
 	return ERROR_OK;
 }
 
+
+
+/**
+ * Generate a DR SCAN using the array of output values passed to the function
+ *
+ * This function assumes that the parameter target_tap specifies the one TAP
+ * that is not bypassed. All other TAPs must be bypassed and the function will
+ * generate a dummy 1bit field for them.
+ *
+ * For the target_tap a sequence of output-only fields will be generated where
+ * each field has the size num_bits and the field's values are taken from
+ * the array value.
+ *
+ * The bypass status of TAPs is set by jtag_add_ir_scan().
+ *
+ */
 void MINIDRIVER(interface_jtag_add_dr_out)(jtag_tap_t *target_tap,
 		int in_num_fields,
 		const int *num_bits,
@@ -964,6 +1013,13 @@
 	}
 }
 
+
+/**
+ * Duplicate the scan fields passed into the function into a DR SCAN command
+ *
+ * This function assumes that the caller handles extra fields for bypassed TAPs
+ *
+ */
 void jtag_add_plain_dr_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
@@ -975,6 +1031,11 @@
 		jtag_error=retval;
 }
 
+
+/**
+ * see jtag_add_plain_dr_scan()
+ *
+ */
 int MINIDRIVER(interface_jtag_add_plain_dr_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
@@ -1003,6 +1064,7 @@
 	return ERROR_OK;
 }
 
+
 void jtag_add_tlr(void)
 {
 	jtag_prelude(TAP_RESET);



From kc8apf at mail.berlios.de  Thu May 21 06:39:43 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:39:43 +0200
Subject: [Openocd-svn] r1860 - trunk/src/jtag
Message-ID: <200905210439.n4L4dhp5030102@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:39:41 +0200 (Thu, 21 May 2009)
New Revision: 1860

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - add 'const' qualifier to function parameters in jtag.c that are not to be modified or freed by the function



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 04:37:31 UTC (rev 1859)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:39:41 UTC (rev 1860)
@@ -37,7 +37,7 @@
 
 int jtag_flush_queue_count; /* count # of flushes for profiling / debugging purposes */
 
-static void jtag_add_scan_check(void (*jtag_add_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state),
+static void jtag_add_scan_check(void (*jtag_add_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state),
 		int in_num_fields, scan_field_t *in_fields, tap_state_t state);
 
 /* note that this is not marked as static as it must be available from outside jtag.c for those
@@ -554,7 +554,7 @@
 	cmd_queue_cur_state = cmd_queue_end_state;
 }
 
-void jtag_add_ir_scan_noverify(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
+void jtag_add_ir_scan_noverify(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
 	jtag_prelude(state);
@@ -602,7 +602,7 @@
  * see jtag_add_ir_scan()
  *
  */
-int MINIDRIVER(interface_jtag_add_ir_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
+int MINIDRIVER(interface_jtag_add_ir_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 	jtag_tap_t *tap;
 	int nth_tap;
@@ -677,7 +677,7 @@
  * This function assumes that the caller handles extra fields for bypassed TAPs
  *
  */
-void jtag_add_plain_ir_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
+void jtag_add_plain_ir_scan(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
 
@@ -693,7 +693,7 @@
  * see jtag_add_plain_ir_scan()
  *
  */
-int MINIDRIVER(interface_jtag_add_plain_ir_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
+int MINIDRIVER(interface_jtag_add_plain_ir_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 
 	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
@@ -731,7 +731,7 @@
 	return jtag_check_value_inner(in, (u8 *)data1, (u8 *)data2, (int)data3);
 }
 
-static void jtag_add_scan_check(void (*jtag_add_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state),
+static void jtag_add_scan_check(void (*jtag_add_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state),
 		int in_num_fields, scan_field_t *in_fields, tap_state_t state)
 {
 	for (int i = 0; i < in_num_fields; i++)
@@ -802,7 +802,7 @@
  * The bypass status of TAPs is set by jtag_add_ir_scan().
  *
  */
-void jtag_add_dr_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
+void jtag_add_dr_scan(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
 
@@ -818,7 +818,7 @@
  * see jtag_add_dr_scan()
  *
  */
-int MINIDRIVER(interface_jtag_add_dr_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
+int MINIDRIVER(interface_jtag_add_dr_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 	int j;
 	int nth_tap;
@@ -1020,7 +1020,7 @@
  * This function assumes that the caller handles extra fields for bypassed TAPs
  *
  */
-void jtag_add_plain_dr_scan(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
+void jtag_add_plain_dr_scan(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 	int retval;
 
@@ -1036,7 +1036,7 @@
  * see jtag_add_plain_dr_scan()
  *
  */
-int MINIDRIVER(interface_jtag_add_plain_dr_scan)(int in_num_fields, scan_field_t *in_fields, tap_state_t state)
+int MINIDRIVER(interface_jtag_add_plain_dr_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
 	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
@@ -1092,7 +1092,7 @@
 	return ERROR_OK;
 }
 
-void jtag_add_pathmove(int num_states, tap_state_t *path)
+void jtag_add_pathmove(int num_states, const tap_state_t *path)
 {
 	tap_state_t cur_state = cmd_queue_cur_state;
 	int i;
@@ -1130,7 +1130,7 @@
 		jtag_error=retval;
 }
 
-int MINIDRIVER(interface_jtag_add_pathmove)(int num_states, tap_state_t *path)
+int MINIDRIVER(interface_jtag_add_pathmove)(int num_states, const tap_state_t *path)
 {
 	/* allocate memory for a new list member */
 	jtag_command_t * cmd = cmd_queue_alloc(sizeof(jtag_command_t));
@@ -1367,7 +1367,7 @@
 	return;
 }
 
-int jtag_scan_size(scan_command_t *cmd)
+int jtag_scan_size(const scan_command_t *cmd)
 {
 	int bit_count = 0;
 	int i;
@@ -1381,7 +1381,7 @@
 	return bit_count;
 }
 
-int jtag_build_buffer(scan_command_t *cmd, u8 **buffer)
+int jtag_build_buffer(const scan_command_t *cmd, u8 **buffer)
 {
 	int bit_count = 0;
 	int i;
@@ -1425,7 +1425,7 @@
 	return bit_count;
 }
 
-int jtag_read_buffer(u8 *buffer, scan_command_t *cmd)
+int jtag_read_buffer(u8 *buffer, const scan_command_t *cmd)
 {
 	int i;
 	int bit_count = 0;
@@ -1463,7 +1463,7 @@
 	return retval;
 }
 
-static const char *jtag_tap_name(jtag_tap_t *tap)
+static const char *jtag_tap_name(const jtag_tap_t *tap)
 {
 	return (tap == NULL) ? "(unknown)" : tap->dotted_name;
 }
@@ -1535,7 +1535,7 @@
 
 
 
-enum scan_type jtag_scan_type(scan_command_t *cmd)
+enum scan_type jtag_scan_type(const scan_command_t *cmd)
 {
 	int i;
 	int type = 0;

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-21 04:37:31 UTC (rev 1859)
+++ trunk/src/jtag/jtag.h	2009-05-21 04:39:41 UTC (rev 1860)
@@ -561,9 +561,9 @@
  */
 extern void jtag_add_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
 /* same as jtag_add_ir_scan except no verify is performed */
-extern void jtag_add_ir_scan_noverify(int num_fields, scan_field_t *fields, tap_state_t state);
-extern int  interface_jtag_add_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
-extern void jtag_add_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
+extern void jtag_add_ir_scan_noverify(int num_fields, const scan_field_t *fields, tap_state_t state);
+extern int  interface_jtag_add_ir_scan(int num_fields, const scan_field_t* fields, tap_state_t endstate);
+extern void jtag_add_dr_scan(int num_fields, const scan_field_t* fields, tap_state_t endstate);
 
 /* set in_value to point to 32 bits of memory to scan into. This function
  * is a way to handle the case of synchronous and asynchronous
@@ -587,11 +587,11 @@
 
 /* This version of jtag_add_dr_scan() uses the check_value/mask fields */
 extern void jtag_add_dr_scan_check(int num_fields, scan_field_t* fields, tap_state_t endstate);
-extern int  interface_jtag_add_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
-extern void jtag_add_plain_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
-extern int  interface_jtag_add_plain_ir_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
-extern void jtag_add_plain_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
-extern int  interface_jtag_add_plain_dr_scan(int num_fields, scan_field_t* fields, tap_state_t endstate);
+extern int  interface_jtag_add_dr_scan(int num_fields, const scan_field_t* fields, tap_state_t endstate);
+extern void jtag_add_plain_ir_scan(int num_fields, const scan_field_t* fields, tap_state_t endstate);
+extern int  interface_jtag_add_plain_ir_scan(int num_fields, const scan_field_t* fields, tap_state_t endstate);
+extern void jtag_add_plain_dr_scan(int num_fields, const scan_field_t* fields, tap_state_t endstate);
+extern int  interface_jtag_add_plain_dr_scan(int num_fields, const scan_field_t* fields, tap_state_t endstate);
 
 
 /* Simplest/typical callback - do some conversion on the data clocked in.
@@ -705,8 +705,8 @@
  * a partial implementation of pathmove would have little practical
  * application.
  */
-extern void jtag_add_pathmove(int num_states, tap_state_t* path);
-extern int  interface_jtag_add_pathmove(int num_states, tap_state_t* path);
+extern void jtag_add_pathmove(int num_states, const tap_state_t* path);
+extern int  interface_jtag_add_pathmove(int num_states, const tap_state_t* path);
 
 /* go to TAP_IDLE, if we're not already there and cycle
  * precisely num_cycles in the TAP_IDLE after which move
@@ -824,10 +824,10 @@
 /* execute jtag queue and check value and use mask if mask is != NULL. invokes
  * jtag_set_error() with any error. */
 extern void jtag_check_value_mask(scan_field_t *field, u8 *value, u8 *mask);
-extern enum scan_type jtag_scan_type(scan_command_t* cmd);
-extern int            jtag_scan_size(scan_command_t* cmd);
-extern int            jtag_read_buffer(u8* buffer, scan_command_t* cmd);
-extern int            jtag_build_buffer(scan_command_t* cmd, u8** buffer);
+extern enum scan_type jtag_scan_type(const scan_command_t* cmd);
+extern int            jtag_scan_size(const scan_command_t* cmd);
+extern int            jtag_read_buffer(u8* buffer, const scan_command_t* cmd);
+extern int            jtag_build_buffer(const scan_command_t* cmd, u8** buffer);
 
 extern void           jtag_sleep(u32 us);
 extern int            jtag_call_event_callbacks(enum jtag_event event);



From kc8apf at mail.berlios.de  Thu May 21 06:42:06 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:42:06 +0200
Subject: [Openocd-svn] r1861 - trunk/src/jtag
Message-ID: <200905210442.n4L4g6e6031142@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:41:50 +0200 (Thu, 21 May 2009)
New Revision: 1861

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - jtag.c: consolidate all memory allocations in scan functions in one block, add out_fields pointer to set stage for further changes



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 04:39:41 UTC (rev 1860)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:41:50 UTC (rev 1861)
@@ -609,8 +609,9 @@
 
 	int num_taps = jtag_NumEnabledTaps();
 
-	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
-	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
+	jtag_command_t * cmd		= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan		= cmd_queue_alloc(sizeof(scan_command_t));
+	scan_field_t * out_fields	= cmd_queue_alloc(num_taps  * sizeof(scan_field_t));
 
 	jtag_queue_command(cmd);
 
@@ -619,7 +620,7 @@
 
 	scan->ir_scan			= true;
 	scan->num_fields		= num_taps;	/* one field per device */
-	scan->fields			= cmd_queue_alloc(num_taps  * sizeof(scan_field_t));
+	scan->fields			= out_fields;
 	scan->end_state			= state;
 
 	nth_tap = -1;
@@ -696,8 +697,9 @@
 int MINIDRIVER(interface_jtag_add_plain_ir_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 
-	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
-	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
+	jtag_command_t * cmd		= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan		= cmd_queue_alloc(sizeof(scan_command_t));
+	scan_field_t * out_fields	= cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
 	
 	jtag_queue_command(cmd);
 
@@ -706,7 +708,7 @@
 
 	scan->ir_scan			= true;
 	scan->num_fields		= in_num_fields;
-	scan->fields			= cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
+	scan->fields			= out_fields;
 	scan->end_state			= state;
 
 	for (int i = 0; i < in_num_fields; i++)
@@ -840,8 +842,9 @@
 		}
 	}
 
-	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
-	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
+	jtag_command_t * cmd		= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan		= cmd_queue_alloc(sizeof(scan_command_t));
+	scan_field_t * out_fields	= cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
 	
 	jtag_queue_command(cmd);
 	
@@ -850,7 +853,7 @@
 
 	scan->ir_scan			= false;
 	scan->num_fields		= in_num_fields + bypass_devices;
-	scan->fields			= cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
+	scan->fields			= out_fields;
 	scan->end_state			= state;
 
 	tap = NULL;
@@ -951,8 +954,9 @@
 		}
 	}
 
-	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
-	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
+	jtag_command_t * cmd		= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan		= cmd_queue_alloc(sizeof(scan_command_t));
+	scan_field_t * out_fields	= cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
 
 	jtag_queue_command(cmd);
 
@@ -961,7 +965,7 @@
 
 	scan->ir_scan			= false;
 	scan->num_fields		= in_num_fields + bypass_devices;
-	scan->fields			= cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
+	scan->fields			= out_fields;
 	scan->end_state			= end_state;
 
 	tap = NULL;
@@ -1038,8 +1042,9 @@
  */
 int MINIDRIVER(interface_jtag_add_plain_dr_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
-	jtag_command_t * cmd	= cmd_queue_alloc(sizeof(jtag_command_t));
-	scan_command_t * scan	= cmd_queue_alloc(sizeof(scan_command_t));
+	jtag_command_t * cmd		= cmd_queue_alloc(sizeof(jtag_command_t));
+	scan_command_t * scan		= cmd_queue_alloc(sizeof(scan_command_t));
+	scan_field_t * out_fields	= cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
 
 	jtag_queue_command(cmd);
 
@@ -1048,7 +1053,7 @@
 
 	scan->ir_scan			= false;
 	scan->num_fields		= in_num_fields;
-	scan->fields			= cmd_queue_alloc(in_num_fields * sizeof(scan_field_t));
+	scan->fields			= out_fields;
 	scan->end_state			= state;
 
 	for (int i = 0; i < in_num_fields; i++)



From kc8apf at mail.berlios.de  Thu May 21 06:43:13 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:43:13 +0200
Subject: [Openocd-svn] r1862 - trunk/src/jtag
Message-ID: <200905210443.n4L4hD4b031529@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:43:01 +0200 (Thu, 21 May 2009)
New Revision: 1862

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - jtag.c: Use single 'for' statement to iterate over list of TAPs in scan functions



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 04:41:50 UTC (rev 1861)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:43:01 UTC (rev 1862)
@@ -604,7 +604,6 @@
  */
 int MINIDRIVER(interface_jtag_add_ir_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
-	jtag_tap_t *tap;
 	int nth_tap;
 
 	int num_taps = jtag_NumEnabledTaps();
@@ -624,15 +623,11 @@
 	scan->end_state			= state;
 
 	nth_tap = -1;
-	tap = NULL;
-	for(;;){
+
+	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
+	{
 		int found = 0;
 
-		/* do this here so it is not forgotten */
-		tap = jtag_NextEnabledTap(tap);
-		if( tap == NULL ){
-			break;
-		}
 		nth_tap++;
 
 		assert(nth_tap < num_taps);
@@ -824,22 +819,16 @@
 {
 	int j;
 	int nth_tap;
-	int bypass_devices = 0;
 	int field_count = 0;
 
-	jtag_tap_t *tap;
-
 	/* count devices in bypass */
-	tap = NULL;
-	bypass_devices = 0;
-	for(;;){
-		tap = jtag_NextEnabledTap(tap);
-		if( tap == NULL ){
-			break;
-		}
-		if( tap->bypass ){
+
+	size_t bypass_devices = 0;
+
+	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
+	{
+		if (tap->bypass)
 			bypass_devices++;
-		}
 	}
 
 	jtag_command_t * cmd		= cmd_queue_alloc(sizeof(jtag_command_t));
@@ -856,14 +845,12 @@
 	scan->fields			= out_fields;
 	scan->end_state			= state;
 
-	tap = NULL;
 	nth_tap = -1;
-	for(;;){
+
+	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
+	{
 		nth_tap++;
-		tap = jtag_NextEnabledTap(tap);
-		if( tap == NULL ){
-			break;
-		}
+
 		int found = 0;
 		scan->fields[field_count].tap = tap;
 
@@ -937,23 +924,18 @@
 {
 	int nth_tap;
 	int field_count = 0;
-	int bypass_devices = 0;
 
-	jtag_tap_t *tap;
-
 	/* count devices in bypass */
-	tap = NULL;
-	bypass_devices = 0;
-	for(;;){
-		tap = jtag_NextEnabledTap(tap);
-		if( tap == NULL ){
-			break;
-		}
-		if( tap->bypass ){
+
+	size_t bypass_devices = 0;
+
+	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
+	{
+		if (tap->bypass)
 			bypass_devices++;
-		}
 	}
 
+
 	jtag_command_t * cmd		= cmd_queue_alloc(sizeof(jtag_command_t));
 	scan_command_t * scan		= cmd_queue_alloc(sizeof(scan_command_t));
 	scan_field_t * out_fields	= cmd_queue_alloc((in_num_fields + bypass_devices) * sizeof(scan_field_t));
@@ -968,13 +950,10 @@
 	scan->fields			= out_fields;
 	scan->end_state			= end_state;
 
-	tap = NULL;
 	nth_tap = -1;
-	for(;;){
-		tap = jtag_NextEnabledTap(tap);
-		if( tap == NULL ){
-			break;
-		}
+
+	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
+	{
 		nth_tap++;
 		scan->fields[field_count].tap = tap;
 



From kc8apf at mail.berlios.de  Thu May 21 06:43:55 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:43:55 +0200
Subject: [Openocd-svn] r1863 - trunk/src/jtag
Message-ID: <200905210443.n4L4htbP032048@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:43:48 +0200 (Thu, 21 May 2009)
New Revision: 1863

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - jtag.c: remove unused variable 'nth_tap' from DR scan functions



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 04:43:01 UTC (rev 1862)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:43:48 UTC (rev 1863)
@@ -818,7 +818,6 @@
 int MINIDRIVER(interface_jtag_add_dr_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
 	int j;
-	int nth_tap;
 	int field_count = 0;
 
 	/* count devices in bypass */
@@ -845,12 +844,8 @@
 	scan->fields			= out_fields;
 	scan->end_state			= state;
 
-	nth_tap = -1;
-
 	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
 	{
-		nth_tap++;
-
 		int found = 0;
 		scan->fields[field_count].tap = tap;
 
@@ -922,7 +917,6 @@
 		const u32 *value,
 		tap_state_t end_state)
 {
-	int nth_tap;
 	int field_count = 0;
 
 	/* count devices in bypass */
@@ -950,11 +944,8 @@
 	scan->fields			= out_fields;
 	scan->end_state			= end_state;
 
-	nth_tap = -1;
-
 	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
 	{
-		nth_tap++;
 		scan->fields[field_count].tap = tap;
 
 		if (tap == target_tap)



From kc8apf at mail.berlios.de  Thu May 21 06:45:58 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:45:58 +0200
Subject: [Openocd-svn] r1864 - trunk/src/jtag
Message-ID: <200905210445.n4L4jwF0002116@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:45:57 +0200 (Thu, 21 May 2009)
New Revision: 1864

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    - jtag.c: consolidate output scan field initialization in scan functions
    - jtag.c: add cmd_queue_scan_field_clone() to handle 1:1 field copies
    - jtag.c: fix bug where only the first output field in a dr scan has its tap field set



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 04:43:48 UTC (rev 1863)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:45:57 UTC (rev 1864)
@@ -531,6 +531,20 @@
 	cmd_queue_pages = NULL;
 }
 
+/**
+ * Copy a scan_field_t for insertion into the queue.
+ *
+ * This allocates a new copy of out_value using cmd_queue_alloc.
+ */
+static void cmd_queue_scan_field_clone(scan_field_t * dst, const scan_field_t * src)
+{
+	dst->tap		= src->tap;
+	dst->num_bits	= src->num_bits;
+	dst->out_value	= buf_cpy(src->out_value, cmd_queue_alloc(CEIL(src->num_bits, 8)), src->num_bits);
+	dst->in_value	= src->in_value;
+}
+
+
 static void jtag_prelude1(void)
 {
 	if (jtag_trst == 1)
@@ -633,9 +647,6 @@
 		assert(nth_tap < num_taps);
 
 		size_t scan_size				= tap->ir_length;
-		scan->fields[nth_tap].tap		= tap;
-		scan->fields[nth_tap].num_bits	= scan_size;
-		scan->fields[nth_tap].in_value	= NULL; /* do not collect input for tap's in bypass */
 
 		/* search the list */
 		for (int j = 0; j < in_num_fields; j++)
@@ -643,10 +654,11 @@
 			if (tap == in_fields[j].tap)
 			{
 				found = 1;
-				scan->fields[nth_tap].in_value	= in_fields[j].in_value;
-				scan->fields[nth_tap].out_value	= buf_cpy(in_fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 
 				tap->bypass = 0;
+
+				cmd_queue_scan_field_clone(scan->fields + nth_tap, in_fields + j);
+
 				break;
 			}
 		}
@@ -654,8 +666,12 @@
 		if (!found)
 		{
 			/* if a tap isn't listed, set it to BYPASS */
+			tap->bypass = 1;
+
+			scan->fields[nth_tap].tap		= tap;
+			scan->fields[nth_tap].num_bits	= scan_size;
 			scan->fields[nth_tap].out_value = buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-			tap->bypass = 1;
+			scan->fields[nth_tap].in_value	= NULL; /* do not collect input for tap's in bypass */
 		}
 
 		/* update device information */
@@ -707,14 +723,7 @@
 	scan->end_state			= state;
 
 	for (int i = 0; i < in_num_fields; i++)
-	{
-		int num_bits = in_fields[i].num_bits;
-		int num_bytes = CEIL(in_fields[i].num_bits, 8);
-		scan->fields[i].tap = in_fields[i].tap;
-		scan->fields[i].num_bits = num_bits;
-		scan->fields[i].out_value = buf_cpy(in_fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		scan->fields[i].in_value = in_fields[i].in_value;
-	}
+		cmd_queue_scan_field_clone(out_fields + i, in_fields + i);
 
 	return ERROR_OK;
 }
@@ -847,17 +856,15 @@
 	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
 	{
 		int found = 0;
-		scan->fields[field_count].tap = tap;
 
 		for (j = 0; j < in_num_fields; j++)
 		{
 			if (tap == in_fields[j].tap)
 			{
 				found = 1;
-				size_t scan_size = in_fields[j].num_bits;
-				scan->fields[field_count].num_bits	= scan_size;
-				scan->fields[field_count].out_value	= buf_cpy(in_fields[j].out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				scan->fields[field_count].in_value	= in_fields[j].in_value;
+				
+				cmd_queue_scan_field_clone(scan->fields + field_count, in_fields + j);
+
 				field_count++;
 			}
 		}
@@ -872,6 +879,7 @@
 			}
 #endif
 			/* program the scan field to 1 bit length, and ignore it's value */
+			scan->fields[field_count].tap			= tap;
 			scan->fields[field_count].num_bits		= 1;
 			scan->fields[field_count].out_value		= NULL;
 			scan->fields[field_count].in_value		= NULL;
@@ -1027,14 +1035,7 @@
 	scan->end_state			= state;
 
 	for (int i = 0; i < in_num_fields; i++)
-	{
-		int num_bits = in_fields[i].num_bits;
-		int num_bytes = CEIL(in_fields[i].num_bits, 8);
-		scan->fields[i].tap = in_fields[i].tap;
-		scan->fields[i].num_bits = num_bits;
-		scan->fields[i].out_value = buf_cpy(in_fields[i].out_value, cmd_queue_alloc(num_bytes), num_bits);
-		scan->fields[i].in_value = in_fields[i].in_value;
-	}
+		cmd_queue_scan_field_clone(out_fields + i, in_fields + i);
 
 	return ERROR_OK;
 }



From kc8apf at mail.berlios.de  Thu May 21 06:48:16 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:48:16 +0200
Subject: [Openocd-svn] r1865 - trunk/src/jtag
Message-ID: <200905210448.n4L4mGu6004232@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:48:15 +0200 (Thu, 21 May 2009)
New Revision: 1865

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    -jtag.c, interface_jtag_add_ir_scan():
        - use pointer 'field' instead of scan->fields[nth_tap]
        - add assertion to ensure that input data has correct size for TAP's IR



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 04:45:57 UTC (rev 1864)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:48:15 UTC (rev 1865)
@@ -618,10 +618,8 @@
  */
 int MINIDRIVER(interface_jtag_add_ir_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
-	int nth_tap;
+	size_t num_taps = jtag_NumEnabledTaps();
 
-	int num_taps = jtag_NumEnabledTaps();
-
 	jtag_command_t * cmd		= cmd_queue_alloc(sizeof(jtag_command_t));
 	scan_command_t * scan		= cmd_queue_alloc(sizeof(scan_command_t));
 	scan_field_t * out_fields	= cmd_queue_alloc(num_taps  * sizeof(scan_field_t));
@@ -636,16 +634,15 @@
 	scan->fields			= out_fields;
 	scan->end_state			= state;
 
-	nth_tap = -1;
 
+	scan_field_t * field = out_fields;	/* keep track where we insert data */
+
+	/* loop over all enabled TAPs */
+
 	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
 	{
 		int found = 0;
 
-		nth_tap++;
-
-		assert(nth_tap < num_taps);
-
 		size_t scan_size				= tap->ir_length;
 
 		/* search the list */
@@ -656,8 +653,10 @@
 				found = 1;
 
 				tap->bypass = 0;
+				
+				assert(in_fields[j].num_bits == tap->ir_length); /* input fields must have the same length as the TAP's IR */
 
-				cmd_queue_scan_field_clone(scan->fields + nth_tap, in_fields + j);
+				cmd_queue_scan_field_clone(field, in_fields + j);
 
 				break;
 			}
@@ -665,20 +664,22 @@
 
 		if (!found)
 		{
-			/* if a tap isn't listed, set it to BYPASS */
+			/* if a TAP isn't listed in input fields, set it to BYPASS */
 			tap->bypass = 1;
 
-			scan->fields[nth_tap].tap		= tap;
-			scan->fields[nth_tap].num_bits	= scan_size;
-			scan->fields[nth_tap].out_value = buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-			scan->fields[nth_tap].in_value	= NULL; /* do not collect input for tap's in bypass */
+			field->tap			= tap;
+			field->num_bits		= scan_size;
+			field->out_value	= buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+			field->in_value		= NULL; /* do not collect input for tap's in bypass */
 		}
 
 		/* update device information */
-		buf_cpy(scan->fields[nth_tap].out_value, tap->cur_instr, scan_size);
+		buf_cpy(field->out_value, tap->cur_instr, scan_size);
+
+		field++;
 	}
 
-	assert(nth_tap == (num_taps - 1));
+	assert(field == out_fields + num_taps); /* paranoia: jtag_NumEnabledTaps() and jtag_NextEnabledTap() not in sync */
 
 	return ERROR_OK;
 }



From kc8apf at mail.berlios.de  Thu May 21 06:50:01 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:50:01 +0200
Subject: [Openocd-svn] r1866 - trunk/src/jtag
Message-ID: <200905210450.n4L4o1gl005497@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:50:00 +0200 (Thu, 21 May 2009)
New Revision: 1866

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    -jtag.c, interface_jtag_add_dr_scan():
            - use pointer 'field' instead of scan->fields[field_count]
            - restructure the main loop to clearly separate the two cases: TAP is not bypassed / TAP is bypassed
            - add an assert that each non-bypassed TAP receives at least one field
            - add an assert that checks that no superfluous input fields were passed



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 04:48:15 UTC (rev 1865)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:50:00 UTC (rev 1866)
@@ -827,9 +827,6 @@
  */
 int MINIDRIVER(interface_jtag_add_dr_scan)(int in_num_fields, const scan_field_t *in_fields, tap_state_t state)
 {
-	int j;
-	int field_count = 0;
-
 	/* count devices in bypass */
 
 	size_t bypass_devices = 0;
@@ -854,53 +851,46 @@
 	scan->fields			= out_fields;
 	scan->end_state			= state;
 
+
+	scan_field_t * field = out_fields;	/* keep track where we insert data */
+
+	/* loop over all enabled TAPs */
+
 	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
 	{
-		int found = 0;
+		/* if TAP is not bypassed insert matching input fields */
 
-		for (j = 0; j < in_num_fields; j++)
+		if (!tap->bypass)
 		{
-			if (tap == in_fields[j].tap)
+			scan_field_t * start_field = field;	/* keep initial position for assert() */
+
+			for (int j = 0; j < in_num_fields; j++)
 			{
-				found = 1;
-				
-				cmd_queue_scan_field_clone(scan->fields + field_count, in_fields + j);
+				if (tap != in_fields[j].tap)
+					continue;
 
-				field_count++;
+				cmd_queue_scan_field_clone(field, in_fields + j);
+
+				field++;
 			}
+
+			assert(field > start_field);	/* must have at least one input field per not bypassed TAP */
 		}
-		if (!found)
-		{
-#ifdef _DEBUG_JTAG_IO_
-			/* if a device isn't listed, the BYPASS register should be selected */
-			if (! tap->bypass)
-			{
-				LOG_ERROR("BUG: no scan data for a device not in BYPASS");
-				exit(-1);
-			}
-#endif
-			/* program the scan field to 1 bit length, and ignore it's value */
-			scan->fields[field_count].tap			= tap;
-			scan->fields[field_count].num_bits		= 1;
-			scan->fields[field_count].out_value		= NULL;
-			scan->fields[field_count].in_value		= NULL;
-			field_count++;
-		}
+		
+		/* if a TAP is bypassed, generated a dummy bit*/
 		else
 		{
-#ifdef _DEBUG_JTAG_IO_
-			/* if a device is listed, the BYPASS register must not be selected */
-			if (tap->bypass)
-			{
-				LOG_ERROR("BUG: scan data for a device in BYPASS");
-				exit(-1);
-			}
-#endif
+			field->tap			= tap;
+			field->num_bits		= 1;
+			field->out_value	= NULL;
+			field->in_value		= NULL;
+
+			field++;
 		}
 	}
 
-	/* field_count represents the true number of fields setup*/
-	scan->num_fields = field_count;
+	assert(field == out_fields + scan->num_fields); /* no superfluous input fields permitted */
+
 	return ERROR_OK;
 }
 



From kc8apf at mail.berlios.de  Thu May 21 06:53:08 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:53:08 +0200
Subject: [Openocd-svn] r1867 - trunk/src/jtag
Message-ID: <200905210453.n4L4r8dl006516@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:53:07 +0200 (Thu, 21 May 2009)
New Revision: 1867

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
   -jtag.c, interface_jtag_add_dr_out():
        - use pointer 'field' instead of scan->fields[field_count]
        - restructure the main loop to clearly separate the two cases: TAP is not bypassed / TAP is bypassed
          (this is to keep the function similar to interface_jtag_add_dr_scan())
        - fix bug where only the first output field has its tap field set
        - add asserts to verify that target_tap points to the one not bypassed TAP



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 04:50:00 UTC (rev 1866)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:53:07 UTC (rev 1867)
@@ -916,8 +916,6 @@
 		const u32 *value,
 		tap_state_t end_state)
 {
-	int field_count = 0;
-
 	/* count devices in bypass */
 
 	size_t bypass_devices = 0;
@@ -943,47 +941,52 @@
 	scan->fields			= out_fields;
 	scan->end_state			= end_state;
 
+
+	bool target_tap_match	= false;
+
+	scan_field_t * field = out_fields;	/* keep track where we insert data */
+
+	/* loop over all enabled TAPs */
+
 	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
 	{
-		scan->fields[field_count].tap = tap;
+		/* if TAP is not bypassed insert matching input fields */
 
-		if (tap == target_tap)
+		if (!tap->bypass)
 		{
-#ifdef _DEBUG_JTAG_IO_
-			/* if a device is listed, the BYPASS register must not be selected */
-			if (tap->bypass)
-			{
-				LOG_ERROR("BUG: scan data for a device in BYPASS");
-				exit(-1);
-			}
-#endif
+			assert(tap == target_tap); /* target_tap must match the one not bypassed TAP */
+
+			target_tap_match = true;
+
 			for (int j = 0; j < in_num_fields; j++)
 			{
 				u8 out_value[4];
 				size_t scan_size = num_bits[j];
 				buf_set_u32(out_value, 0, scan_size, value[j]);
-				scan->fields[field_count].num_bits		= scan_size;
-				scan->fields[field_count].out_value		= buf_cpy(out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
-				scan->fields[field_count].in_value		= NULL;
-				field_count++;
+
+				field->tap			= tap;
+				field->num_bits		= scan_size;
+				field->out_value	= buf_cpy(out_value, cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+				field->in_value		= NULL;
+
+				field++;
 			}
-		} else
+		}
+
+		/* if a TAP is bypassed, generated a dummy bit*/
+		else
 		{
-#ifdef _DEBUG_JTAG_IO_
-			/* if a device isn't listed, the BYPASS register should be selected */
-			if (! tap->bypass)
-			{
-				LOG_ERROR("BUG: no scan data for a device not in BYPASS");
-				exit(-1);
-			}
-#endif
-			/* program the scan field to 1 bit length, and ignore it's value */
-			scan->fields[field_count].num_bits			= 1;
-			scan->fields[field_count].out_value			= NULL;
-			scan->fields[field_count].in_value			= NULL;
-			field_count++;
+
+			field->tap				= tap;
+			field->num_bits			= 1;
+			field->out_value		= NULL;
+			field->in_value			= NULL;
+
+			field++;
 		}
 	}
+
+	assert(target_tap_match);	/* target_tap should be enabled and not bypassed */
 }
 
 



From kc8apf at mail.berlios.de  Thu May 21 06:54:39 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 06:54:39 +0200
Subject: [Openocd-svn] r1868 - trunk/src/jtag
Message-ID: <200905210454.n4L4sdoS007613@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 06:54:38 +0200 (Thu, 21 May 2009)
New Revision: 1868

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    -jtag.c, interface_jtag_add_ir_scan() [1/2]:
    	- remove temporary scan_size and use tap->ir_length instead
    	- slight loop restructuring to reduce indentation level




Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 04:53:07 UTC (rev 1867)
+++ trunk/src/jtag/jtag.c	2009-05-21 04:54:38 UTC (rev 1868)
@@ -643,23 +643,20 @@
 	{
 		int found = 0;
 
-		size_t scan_size				= tap->ir_length;
-
-		/* search the list */
 		for (int j = 0; j < in_num_fields; j++)
 		{
-			if (tap == in_fields[j].tap)
-			{
-				found = 1;
+			if (tap != in_fields[j].tap)
+				continue;
 
-				tap->bypass = 0;
-				
-				assert(in_fields[j].num_bits == tap->ir_length); /* input fields must have the same length as the TAP's IR */
+			found = 1;
 
-				cmd_queue_scan_field_clone(field, in_fields + j);
+			tap->bypass = 0;
 
-				break;
-			}
+			assert(in_fields[j].num_bits == tap->ir_length); /* input fields must have the same length as the TAP's IR */
+
+			cmd_queue_scan_field_clone(field, in_fields + j);
+
+			break;
 		}
 
 		if (!found)
@@ -668,13 +665,13 @@
 			tap->bypass = 1;
 
 			field->tap			= tap;
-			field->num_bits		= scan_size;
-			field->out_value	= buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
+			field->num_bits		= tap->ir_length;
+			field->out_value	= buf_set_ones(cmd_queue_alloc(CEIL(tap->ir_length, 8)), tap->ir_length);
 			field->in_value		= NULL; /* do not collect input for tap's in bypass */
 		}
 
 		/* update device information */
-		buf_cpy(field->out_value, tap->cur_instr, scan_size);
+		buf_cpy(field->out_value, tap->cur_instr, tap->ir_length);
 
 		field++;
 	}



From kc8apf at mail.berlios.de  Thu May 21 07:07:18 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 07:07:18 +0200
Subject: [Openocd-svn] r1869 - trunk/src/jtag
Message-ID: <200905210507.n4L57I5h017624@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 07:07:06 +0200 (Thu, 21 May 2009)
New Revision: 1869

Modified:
   trunk/src/jtag/ft2232.c
Log:
Author: Holger Schurig <hs4233 at mail.mn-solutions.de>
	-Prevent freezing of target when doing a 'shutdown'.


Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-21 04:54:38 UTC (rev 1868)
+++ trunk/src/jtag/ft2232.c	2009-05-21 05:07:06 UTC (rev 1869)
@@ -2642,8 +2642,6 @@
 
 	status = FT_Close(ftdih);
 #elif BUILD_FT2232_LIBFTDI == 1
-	ftdi_disable_bitbang(&ftdic);
-
 	ftdi_usb_close(&ftdic);
 
 	ftdi_deinit(&ftdic);



From kc8apf at mail.berlios.de  Thu May 21 07:12:38 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 07:12:38 +0200
Subject: [Openocd-svn] r1870 - trunk/src/target
Message-ID: <200905210512.n4L5Ccpe022055@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 07:12:32 +0200 (Thu, 21 May 2009)
New Revision: 1870

Modified:
   trunk/src/target/target.c
Log:
Author: ?\195?\152yvind Harboe <oyvind.harboe at zylin.com>
	- Allow target_read/write_buffer of size 0


Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-21 05:07:06 UTC (rev 1869)
+++ trunk/src/target/target.c	2009-05-21 05:12:32 UTC (rev 1870)
@@ -985,6 +985,10 @@
 		return ERROR_FAIL;
 	}
 
+	if (size == 0) {
+		return ERROR_OK;
+	}
+
 	if ((address + size - 1) < address)
 	{
 		/* GDB can request this when e.g. PC is 0xfffffffc*/
@@ -1060,6 +1064,10 @@
 		return ERROR_FAIL;
 	}
 
+	if (size == 0) {
+		return ERROR_OK;
+	}
+
 	if ((address + size - 1) < address)
 	{
 		/* GDB can request this when e.g. PC is 0xfffffffc*/



From kc8apf at mail.berlios.de  Thu May 21 07:33:38 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 07:33:38 +0200
Subject: [Openocd-svn] r1871 - trunk/src/jtag/rlink
Message-ID: <200905210533.n4L5Xc35006582@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 07:33:36 +0200 (Thu, 21 May 2009)
New Revision: 1871

Modified:
   trunk/src/jtag/rlink/rlink.c
Log:
Author: Thomas Kindler <mail at t-kindler.de>
	- Increase DTC status retry count to avoid problems with STM Primer


Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2009-05-21 05:12:32 UTC (rev 1870)
+++ trunk/src/jtag/rlink/rlink.c	2009-05-21 05:33:36 UTC (rev 1871)
@@ -517,7 +517,7 @@
 
 
 	/* Wait for DTC to finish running command buffer */
-	for(i = 5;;) {
+	for(i = 10;;) {
 		usb_err = ep1_generic_commandl(
 			pHDev, 4,
 



From kc8apf at mail.berlios.de  Thu May 21 07:46:31 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 07:46:31 +0200
Subject: [Openocd-svn] r1872 - trunk
Message-ID: <200905210546.n4L5kVrx017681@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 07:46:29 +0200 (Thu, 21 May 2009)
New Revision: 1872

Modified:
   trunk/PATCHES
Log:
Author: David Brownell <david-b at pacbell.net>
	- Update PATCHES to better describe the policies in place


Modified: trunk/PATCHES
===================================================================
--- trunk/PATCHES	2009-05-21 05:33:36 UTC (rev 1871)
+++ trunk/PATCHES	2009-05-21 05:46:29 UTC (rev 1872)
@@ -1,35 +1,45 @@
 Please mail patches to:
 
-openocd-development at lists.berlios.de
+	openocd-development at lists.berlios.de
 
 Note that you can't send patches to that list unless
 you're a member, despite what the list info page says.
 
 The patch should be against svn trunk using an SVN
-diff. 
+diff. If you use git-svn, a git diff or patch is OK
+too; likewise a quilt patch, if you use quilt.
 
+It should be a "good patch": focus it on a single
+issue, and make it be easily reviewable. Don't make
+it so large that it's hard to review; split large
+patches into smaller ones. (That can also help
+track down bugs later on.) All patches should
+be "clean", which includes preserving the existing
+coding style and updating documentation as needed.j
+
 Attach the patch to the email as a .txt file and
 also write a short change log entry that maintainers
 can copy and paste into the commit message
 
-(However, don't expect the maintainers to actually
-include such entries in their commit messages if
-they're longer than a single $SUBJECT line.)
+Say if it's a bugfix (describe the bug) or a new
+feature. Don't expect patches to merge immediately
+for the next release. Be ready to rework patches
+in response to feedback.
 
 Add yourself to the GPL copyright for non-trivial changes.
 
 To create a patch from the command line:
  
-svn diff >mypatch.txt
+	svn diff >mypatch.txt
 
-http://svnbook.red-bean.com/en/1.0/re09.html
+See:
 
+	http://svnbook.red-bean.com/en/1.0/re09.html
+
 NB! remember to use "svn add" on new files first!
 
-http://svnbook.red-bean.com/en/1.0/re01.html
+	http://svnbook.red-bean.com/en/1.0/re01.html
 
-
-
 If you have a decent SVN GUI, then that should be
 able to create and apply patches as well...
- 
\ No newline at end of file
+ 



From zwelch at mail.berlios.de  Thu May 21 11:29:09 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 21 May 2009 11:29:09 +0200
Subject: [Openocd-svn] r1873 - in trunk/src: flash helper pld svf target
Message-ID: <200905210929.n4L9T9je027986@sheep.berlios.de>

Author: zwelch
Date: 2009-05-21 11:28:57 +0200 (Thu, 21 May 2009)
New Revision: 1873

Modified:
   trunk/src/flash/flash.c
   trunk/src/flash/nand.c
   trunk/src/helper/command.h
   trunk/src/pld/pld.c
   trunk/src/svf/svf.c
   trunk/src/target/armv4_5.c
   trunk/src/target/armv4_5_mmu.c
   trunk/src/target/etm.c
   trunk/src/target/target.c
   trunk/src/target/trace.c
Log:
David Brownell <david-b at pacbell.net>:  This patch adds annotations to
the key command_*() helper functions, fixng the bugs that turned up.

Several of these bugs were from misuse of PRIi64; that's for 64-bit
integers, NOT for "long long" or "u64" (which work best with %lld).


Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/flash/flash.c	2009-05-21 09:28:57 UTC (rev 1873)
@@ -432,7 +432,7 @@
 		int j;
 		if ((retval = p->driver->erase_check(p)) == ERROR_OK)
 		{
-			command_print(cmd_ctx, "successfully checked erase state", p->driver->name, p->base);
+			command_print(cmd_ctx, "successfully checked erase state");
 		}
 		else
 		{
@@ -567,7 +567,8 @@
 				return retval;
 			}
 
-			command_print(cmd_ctx, "erased sectors %i through %i on flash bank %i in %s", first, last, strtoul(args[0], 0, 0), duration_text);
+			command_print(cmd_ctx, "erased sectors %i through %i on flash bank %li in %s",
+				first, last, strtoul(args[0], 0, 0), duration_text);
 			free(duration_text);
 		}
 	}
@@ -606,7 +607,9 @@
 		retval = flash_driver_protect(p, set, first, last);
 		if (retval == ERROR_OK)
 		{
-			command_print(cmd_ctx, "%s protection for sectors %i through %i on flash bank %i", (set) ? "set" : "cleared", first, last, strtoul(args[0], 0, 0));
+			command_print(cmd_ctx, "%s protection for sectors %i through %i on flash bank %li",
+				(set) ? "set" : "cleared", first,
+				last, strtoul(args[0], 0, 0));
 		}
 	}
 	else
@@ -873,7 +876,7 @@
 	}
 	if (retval==ERROR_OK)
 	{
-	command_print(cmd_ctx, "wrote  %"PRIi64" byte from file %s to flash bank %i at offset 0x%8.8x in %s (%f kb/s)",
+	command_print(cmd_ctx, "wrote  %lld byte from file %s to flash bank %li at offset 0x%8.8x in %s (%f kb/s)",
 		fileio.size, args[1], strtoul(args[0], NULL, 0), offset, duration_text,
 		(float)fileio.size / 1024.0 / ((float)duration.duration.tv_sec + ((float)duration.duration.tv_usec / 1000000.0)));
 	}

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/flash/nand.c	2009-05-21 09:28:57 UTC (rev 1873)
@@ -1148,7 +1148,7 @@
 		}
 		else
 		{
-			command_print(cmd_ctx, "#%i: not probed");
+			command_print(cmd_ctx, "#%s: not probed", args[0]);
 		}
 	}
 
@@ -1251,7 +1251,7 @@
 	{
 		if ((retval = nand_build_bbt(p, first, last)) == ERROR_OK)
 		{
-			command_print(cmd_ctx, "checked NAND flash device for bad blocks, use \"nand info\" command to list blocks", p->device->name);
+			command_print(cmd_ctx, "checked NAND flash device for bad blocks, use \"nand info\" command to list blocks");
 		}
 		else if (retval == ERROR_NAND_OPERATION_FAILED)
 		{
@@ -1570,13 +1570,13 @@
 			fileio_close(&fileio);
 
 			duration_stop_measure(&duration, &duration_text);
-			command_print(cmd_ctx, "dumped %"PRIi64" byte in %s", fileio.size, duration_text);
+			command_print(cmd_ctx, "dumped %lld byte in %s", fileio.size, duration_text);
 			free(duration_text);
 			duration_text = NULL;
 		}
 		else
 		{
-			command_print(cmd_ctx, "#%i: not probed");
+			command_print(cmd_ctx, "#%s: not probed", args[0]);
 		}
 	}
 	else
@@ -1621,7 +1621,7 @@
 		}
 		else
 		{
-			command_print(cmd_ctx, "#%i: not probed");
+			command_print(cmd_ctx, "#%s: not probed", args[0]);
 		}
 	}
 	else

Modified: trunk/src/helper/command.h
===================================================================
--- trunk/src/helper/command.h	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/helper/command.h	2009-05-21 09:28:57 UTC (rev 1873)
@@ -83,10 +83,14 @@
 extern int command_context_mode(command_context_t *context, enum command_mode mode);
 extern command_context_t* command_init(void);
 extern int command_done(command_context_t *context);
-extern void command_print(command_context_t *context, char *format, ...);
-extern void command_print_sameline(command_context_t *context, char *format, ...);
+
+extern void command_print(command_context_t *context, char *format, ...)
+		__attribute__ ((format (printf, 2, 3)));
+extern void command_print_sameline(command_context_t *context, char *format, ...)
+		__attribute__ ((format (printf, 2, 3)));
 extern int command_run_line(command_context_t *context, char *line);
-extern int command_run_linef(command_context_t *context, char *format, ...);
+extern int command_run_linef(command_context_t *context, char *format, ...)
+		__attribute__ ((format (printf, 2, 3)));
 extern void command_output_text(command_context_t *context, const char *data);
 
 extern void process_jim_events(void);

Modified: trunk/src/pld/pld.c
===================================================================
--- trunk/src/pld/pld.c	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/pld/pld.c	2009-05-21 09:28:57 UTC (rev 1873)
@@ -178,7 +178,7 @@
 	
 	if ((retval = p->driver->load(p, args[1])) != ERROR_OK)
 	{
-		command_print(cmd_ctx, "failed loading file %s to pld device %i",
+		command_print(cmd_ctx, "failed loading file %s to pld device %lu",
 			args[1], strtoul(args[0], NULL, 0));
 		switch (retval)
 		{
@@ -188,9 +188,10 @@
 	{
 		gettimeofday(&end, NULL);	
 		timeval_subtract(&duration, &end, &start);
-		
-		command_print(cmd_ctx, "loaded file %s to pld device %i in %is %ius", 
-			args[1], strtoul(args[0], NULL, 0), duration.tv_sec, duration.tv_usec);
+
+		command_print(cmd_ctx, "loaded file %s to pld device %lu in %lis %lius",
+			args[1], strtoul(args[0], NULL, 0),
+			duration.tv_sec, duration.tv_usec);
 	}
 	
 	return ERROR_OK;

Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/svf/svf.c	2009-05-21 09:28:57 UTC (rev 1873)
@@ -330,7 +330,7 @@
 	}
 
 	// print time
-	command_print(cmd_ctx, "%d ms used", timeval_ms() - time_ago);
+	command_print(cmd_ctx, "%lld ms used", timeval_ms() - time_ago);
 
 free_all:
 

Modified: trunk/src/target/armv4_5.c
===================================================================
--- trunk/src/target/armv4_5.c	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/target/armv4_5.c	2009-05-21 09:28:57 UTC (rev 1873)
@@ -342,7 +342,7 @@
 			output_len += snprintf(output + output_len, 128 - output_len, "%8s: %8.8x ", ARMV4_5_CORE_REG_MODENUM(armv4_5->core_cache, mode, num).name,
 				buf_get_u32(ARMV4_5_CORE_REG_MODENUM(armv4_5->core_cache, mode, num).value, 0, 32));
 		}
-		command_print(cmd_ctx, output);
+		command_print(cmd_ctx, "%s", output);
 	}
 	command_print(cmd_ctx, "    cpsr: %8.8x spsr_fiq: %8.8x spsr_irq: %8.8x spsr_svc: %8.8x spsr_abt: %8.8x spsr_und: %8.8x",
 			  buf_get_u32(armv4_5->core_cache->reg_list[ARMV4_5_CPSR].value, 0, 32),

Modified: trunk/src/target/armv4_5_mmu.c
===================================================================
--- trunk/src/target/armv4_5_mmu.c	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/target/armv4_5_mmu.c	2009-05-21 09:28:57 UTC (rev 1873)
@@ -299,7 +299,7 @@
 
 		if ((i % 8 == 7) || (i == count - 1))
 		{
-			command_print(cmd_ctx, output);
+			command_print(cmd_ctx, "%s", output);
 			output_len = 0;
 		}
 	}

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/target/etm.c	2009-05-21 09:28:57 UTC (rev 1873)
@@ -1674,7 +1674,7 @@
 
 		if ((new_value < 2) || (new_value > 100))
 		{
-			command_print(cmd_ctx, "valid settings are 2% to 100%");
+			command_print(cmd_ctx, "valid settings are 2%% to 100%%");
 		}
 		else
 		{

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/target/target.c	2009-05-21 09:28:57 UTC (rev 1873)
@@ -1910,7 +1910,7 @@
 
 			if ((i%line_modulo == line_modulo-1) || (i == count - 1))
 			{
-				command_print(cmd_ctx, output);
+				command_print(cmd_ctx, "%s", output);
 				output_len = 0;
 			}
 		}
@@ -2168,7 +2168,8 @@
 
 	if (retval==ERROR_OK)
 	{
-		command_print(cmd_ctx, "dumped %"PRIi64" byte in %s", fileio.size, duration_text);
+		command_print(cmd_ctx, "dumped %lld byte in %s",
+				fileio.size, duration_text);
 		free(duration_text);
 	}
 
@@ -2369,7 +2370,8 @@
 		}
 		else
 		{
-			command_print(cmd_ctx, "breakpoint added at address 0x%8.8x", strtoul(args[0], NULL, 0));
+			command_print(cmd_ctx, "breakpoint added at address 0x%8.8lx",
+					strtoul(args[0], NULL, 0));
 		}
 	}
 	else

Modified: trunk/src/target/trace.c
===================================================================
--- trunk/src/target/trace.c	2009-05-21 05:46:29 UTC (rev 1872)
+++ trunk/src/target/trace.c	2009-05-21 09:28:57 UTC (rev 1873)
@@ -60,7 +60,7 @@
 		
 		for (i = 0; i < trace->num_trace_points; i++)
 		{
-			command_print(cmd_ctx, "trace point 0x%8.8x (%"PRIi64" times hit)",
+			command_print(cmd_ctx, "trace point 0x%8.8x (%lld times hit)",
 					trace->trace_points[i].address,
 					trace->trace_points[i].hit_counter);
 		}



From zwelch at mail.berlios.de  Thu May 21 11:49:24 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 21 May 2009 11:49:24 +0200
Subject: [Openocd-svn] r1874 - trunk/src/helper
Message-ID: <200905210949.n4L9nOBV029910@sheep.berlios.de>

Author: zwelch
Date: 2009-05-21 11:49:19 +0200 (Thu, 21 May 2009)
New Revision: 1874

Modified:
   trunk/src/helper/ioutil.c
Log:
Additional format warning fixes in ioutil, required by r1873 changes.

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-21 09:28:57 UTC (rev 1873)
+++ trunk/src/helper/ioutil.c	2009-05-21 09:49:19 UTC (rev 1874)
@@ -155,7 +155,7 @@
 	int retval = loadFile(args[0], &data, &len);
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, "%s", data);
+		command_print(cmd_ctx, "%s", (char *)data);
 		free(data);
 	}
 	else
@@ -501,7 +501,7 @@
 	unsigned long addr = strtoul(args[0], NULL, 0);
 	volatile unsigned *address = (volatile unsigned *)addr;
 	unsigned value = *address;
-	command_print(cmd_ctx, "0x%x : 0x%x", address, value);
+	command_print(cmd_ctx, "0x%x : 0x%x", (intptr_t)address, value);
 	return ERROR_OK;
 }
 



From oharboe at mail.berlios.de  Thu May 21 18:15:47 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Thu, 21 May 2009 18:15:47 +0200
Subject: [Openocd-svn] r1875 - in trunk/src/target: board target
Message-ID: <200905211615.n4LGFlN3025452@sheep.berlios.de>

Author: oharboe
Date: 2009-05-21 18:15:41 +0200 (Thu, 21 May 2009)
New Revision: 1875

Modified:
   trunk/src/target/board/ti_beagleboard.cfg
   trunk/src/target/target/omap3530.cfg
Log:
Dirk Behme <dirk.behme at googlemail.com> Minor updates for OMAP3 scripts

Modified: trunk/src/target/board/ti_beagleboard.cfg
===================================================================
--- trunk/src/target/board/ti_beagleboard.cfg	2009-05-21 09:49:19 UTC (rev 1874)
+++ trunk/src/target/board/ti_beagleboard.cfg	2009-05-21 16:15:41 UTC (rev 1875)
@@ -9,3 +9,6 @@
 
 endstate RUN/IDLE
 
+init
+
+omap3_dbginit

Modified: trunk/src/target/target/omap3530.cfg
===================================================================
--- trunk/src/target/target/omap3530.cfg	2009-05-21 09:49:19 UTC (rev 1874)
+++ trunk/src/target/target/omap3530.cfg	2009-05-21 16:15:41 UTC (rev 1875)
@@ -27,6 +27,8 @@
 jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0 -expected-id $_CPUTAPID -disable
 jtag newtap $_CHIPNAME jrc -irlen 6 -ircapture 0x1 -irmask 0xf -expected-id 0x0b7ae02f
 
+target create omap3.cpu cortex_m3 -endian little -chain-position omap3.cpu
+
 jtag configure $_CHIPNAME.cpu -event tap-enable {
 	puts "Enabling Cortex-A8 @ OMAP3"
 	irscan omap3.jrc 7 -endstate IRPAUSE
@@ -38,3 +40,18 @@
 	puts "Cortex-A8 @ OMAP3 enabled"
 }
 
+proc omap3_dbginit { } {
+     version
+     jtag tapenable omap3.cpu
+     targets
+     # sleep 1000
+     # dap apsel 1
+     # sleep 1000
+     # dap apsel 1
+     # dap info 1
+     omap3.cpu mww 0x54011FB0 0xC5ACCE55 4
+     omap3.cpu mdw 0x54011314
+     omap3.cpu mdw 0x54011314
+     # omap3.cpu mdw 0x54011080
+     omap3.cpu mww 0x5401d030 0x00002000 4
+}



From kc8apf at mail.berlios.de  Thu May 21 19:20:07 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Thu, 21 May 2009 19:20:07 +0200
Subject: [Openocd-svn] r1876 - trunk/src/jtag
Message-ID: <200905211720.n4LHK7Ln009829@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-21 19:20:05 +0200 (Thu, 21 May 2009)
New Revision: 1876

Modified:
   trunk/src/jtag/jtag.c
Log:
Author: Michael Bruck <mbruck at digenius.de>
    -jtag.c, interface_jtag_add_ir_scan() [2/2] (version without goto):
    	- change 'found' to bool
    	- add comments on loops



Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-21 16:15:41 UTC (rev 1875)
+++ trunk/src/jtag/jtag.c	2009-05-21 17:20:05 UTC (rev 1876)
@@ -641,15 +641,19 @@
 
 	for (jtag_tap_t * tap = jtag_NextEnabledTap(NULL); tap != NULL; tap = jtag_NextEnabledTap(tap))
 	{
-		int found = 0;
+		/* search the input field list for fields for the current TAP */
 
+		bool found = false;
+
 		for (int j = 0; j < in_num_fields; j++)
 		{
 			if (tap != in_fields[j].tap)
 				continue;
 
-			found = 1;
+			/* if TAP is listed in input fields, copy the value */
 
+			found = true;
+
 			tap->bypass = 0;
 
 			assert(in_fields[j].num_bits == tap->ir_length); /* input fields must have the same length as the TAP's IR */
@@ -662,6 +666,7 @@
 		if (!found)
 		{
 			/* if a TAP isn't listed in input fields, set it to BYPASS */
+
 			tap->bypass = 1;
 
 			field->tap			= tap;



From oharboe at mail.berlios.de  Thu May 21 19:42:23 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Thu, 21 May 2009 19:42:23 +0200
Subject: [Openocd-svn] r1877 - trunk/src/helper
Message-ID: <200905211742.n4LHgNRI011616@sheep.berlios.de>

Author: oharboe
Date: 2009-05-21 19:42:19 +0200 (Thu, 21 May 2009)
New Revision: 1877

Modified:
   trunk/src/helper/ioutil.c
Log:
fix warning. Use %p for pointers

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-21 17:20:05 UTC (rev 1876)
+++ trunk/src/helper/ioutil.c	2009-05-21 17:42:19 UTC (rev 1877)
@@ -501,7 +501,7 @@
 	unsigned long addr = strtoul(args[0], NULL, 0);
 	volatile unsigned *address = (volatile unsigned *)addr;
 	unsigned value = *address;
-	command_print(cmd_ctx, "0x%x : 0x%x", (intptr_t)address, value);
+	command_print(cmd_ctx, "0x%p : 0x%x", address, (int)value);
 	return ERROR_OK;
 }
 



From oharboe at mail.berlios.de  Thu May 21 19:44:06 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Thu, 21 May 2009 19:44:06 +0200
Subject: [Openocd-svn] r1878 - trunk/src/helper
Message-ID: <200905211744.n4LHi6dO011761@sheep.berlios.de>

Author: oharboe
Date: 2009-05-21 19:44:04 +0200 (Thu, 21 May 2009)
New Revision: 1878

Modified:
   trunk/src/helper/ioutil.c
Log:
delete unused code

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-05-21 17:42:19 UTC (rev 1877)
+++ trunk/src/helper/ioutil.c	2009-05-21 17:44:04 UTC (rev 1878)
@@ -492,32 +492,6 @@
 	return JIM_OK;
 }
 
-int handle_peek_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc != 1)
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-	unsigned long addr = strtoul(args[0], NULL, 0);
-	volatile unsigned *address = (volatile unsigned *)addr;
-	unsigned value = *address;
-	command_print(cmd_ctx, "0x%p : 0x%x", address, (int)value);
-	return ERROR_OK;
-}
-
-int handle_poke_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc != 2)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-	unsigned long addr = strtoul(args[0], NULL, 0);
-	volatile int *address = (volatile int *)addr;
-	int value=strtoul(args[1], NULL, 0);
-	*address=value;
-	return ERROR_OK;
-}
-
 static int
 zylinjtag_Jim_Command_peek(Jim_Interp *interp,
                                    int argc,



From zwelch at mail.berlios.de  Fri May 22 04:25:31 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 22 May 2009 04:25:31 +0200
Subject: [Openocd-svn] r1879 - trunk/doc
Message-ID: <200905220225.n4M2PVX4003248@sheep.berlios.de>

Author: zwelch
Date: 2009-05-22 04:25:18 +0200 (Fri, 22 May 2009)
New Revision: 1879

Modified:
   trunk/doc/openocd.texi
Log:
Submitted by David Brownell <david-b at pacbell.net>:

Add a "NAND Commands" section to to the TEXI docs, covering the basic
commands except for those previously discussed as being due for removal
("nand copy") or switching to use byte offsets not block numbers.

This uses the "@deffn..." syntax for defining commands, as somewhat
suggested by the TEXI documentation, and adds a new "Command Index".
We might prefer to merge those indexes for the near term, but I think
the "@deffn" approch is probably worth switching to.

Updates a few other bits to clarify that "flash" doesn't just mean NOR.  
And to fix one niggling falsity:  the "reset-init" event *is* used, and
in fact it's quite important.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-21 17:44:04 UTC (rev 1878)
+++ trunk/doc/openocd.texi	2009-05-22 02:25:18 UTC (rev 1879)
@@ -65,6 +65,7 @@
 * Tap Creation::                     Tap Creation
 * Target Configuration::             Target Configuration
 * Flash Configuration::              Flash Configuration
+* NAND Flash Commands::              NAND Flash Commands
 * General Commands::                 General Commands
 * JTAG Commands::                    JTAG Commands
 * Sample Scripts::                   Sample Target Scripts
@@ -80,7 +81,8 @@
 @comment case issue with ``Index.html'' and ``index.html''
 @comment Occurs when creating ``--html --no-split'' output
 @comment This fix is based on: http://sourceware.org/ml/binutils/2006-05/msg00215.html
-* OpenOCD Index::                    Main Index
+* OpenOCD Concept Index::            Concept Index
+* OpenOCD Command Index::            Command Index
 @end menu
 
 @node About
@@ -104,10 +106,10 @@
 debugged via the GDB protocol.
 
 @b{Flash Programing:} Flash writing is supported for external CFI
-compatible flashes (Intel and AMD/Spansion command set) and several
+compatible NOR flashes (Intel and AMD/Spansion command set) and several
 internal flashes (LPC2000, AT91SAM7, STR7x, STR9x, LM3, and
-STM32x). Preliminary support for using the LPC3180's NAND flash
-controller is included.
+STM32x). Preliminary support for various NAND flash controllers
+(LPC3180, Orion, S3C24xx, more) controller is included.
 
 @node Developers
 @chapter Developers
@@ -812,7 +814,7 @@
 In summary the board files should contain (if present)
 
 @enumerate
- at item External flash configuration (i.e.: the flash on CS0)
+ at item External flash configuration (i.e.: NOR flash on CS0, two NANDs on CS2)
 @item SDRAM configuration (size, speed, etc.
 @item Board specific IO configuration (i.e.: GPIO pins might disable a 2nd flash)
 @item Multiple TARGET source statements
@@ -1077,8 +1079,8 @@
 This applies @b{ONLY TO MICROCONTROLLERS} that have flash built in.
 
 @b{Never ever} in the ``target configuration file'' define any type of
-flash that is external to the chip. (For example the BOOT flash on
-Chip Select 0). The BOOT flash information goes in a board file - not
+flash that is external to the chip. (For example a BOOT flash on
+Chip Select 0.) Such flash information goes in a board file - not
 the TARGET (chip) file.
 
 Examples:
@@ -1148,7 +1150,7 @@
 openocd.cfg file to force OpenOCD to ``initialize'' and make the
 targets ready. For example: If your openocd.cfg file needs to
 read/write memory on your target - the init command must occur before
-the memory read/write commands.
+the memory read/write commands.  This includes @command{nand probe}.
 
 @section TCP/IP Ports
 @itemize @bullet
@@ -1585,7 +1587,8 @@
 Tap Uses:
 @itemize @bullet
 @item @b{Debug Target} A tap can be used by a GDB debug target
- at item @b{Flash Programing} Some chips program the flash via JTAG
+ at item @b{Flash Programing} Some chips program the flash directly via JTAG,
+instead of indirectly by making a CPU do it.
 @item @b{Boundry Scan} Some chips support boundary scan.
 @end itemize
 
@@ -2003,7 +2006,10 @@
 @item @b{reset-halt-pre}
 @* Currently not used
 @item @b{reset-init}
-@* Currently not used
+@* Used by @b{reset init} command for board-specific initialization.
+This is where you would configure PLLs and clocking, set up DRAM so
+you can download programs that don't fit in on-chip SRAM, set up pin
+multiplexing, and so on.
 @item @b{reset-start}
 @* Currently not used
 @item @b{reset-wait-pos}
@@ -2158,6 +2164,16 @@
 @chapter Flash programming
 @cindex Flash Configuration
 
+OpenOCD has different commands for NOR and NAND flash;
+the ``flash'' command works with NOR flash, while
+the ``nand'' command works with NAND flash.
+This partially reflects different hardware technologies:
+NOR flash usually supports direct CPU instruction and data bus access,
+while data from a NAND flash must be copied to memory before it can be
+used.  (SPI flash must also be copied to memory before use.)
+However, the documentation also uses ``flash'' as a generic term;
+for example, ``Put flash configuration in board-specific files''.
+
 @b{Note:} As of 28/nov/2008 OpenOCD does not know how to program a SPI
 flash that a micro may boot from. Perhaps you, the reader, would like to
 contribute support for this.
@@ -2525,6 +2541,286 @@
 @*mass erase flash memory. 
 @end itemize
 
+ at node NAND Flash Commands
+ at chapter NAND Flash Commands
+ at cindex NAND
+
+Compared to NOR or SPI flash, NAND devices are inexpensive
+and high density.  Today's NAND chips, and multi-chip modules,
+commonly hold multiple GigaBytes of data.
+
+NAND chips consist of a number of ``erase blocks'' of a given
+size (such as 128 KBytes), each of which is divided into a
+number of pages (of perhaps 512 or 2048 bytes each).  Each
+page of a NAND flash has an ``out of band'' (OOB) area to hold
+Error Correcting Code (ECC) and other metadata, usually 16 bytes
+of OOB for every 512 bytes of page data.
+
+One key characteristic of NAND flash is that its error rate
+is higher than that of NOR flash.  In normal operation, that
+ECC is used to correct and detect errors.  However, NAND
+blocks can also wear out and become unusable; those blocks
+are then marked "bad".  NAND chips are even shipped from the
+manufacturer with a few bad blocks.  The highest density chips
+use a technology (MLC) that wears out more quickly, so ECC
+support is increasingly important as a way to detect blocks
+that have begun to fail, and help to preserve data integrity
+with techniques such as wear leveling.
+
+Software is used to manage the ECC.  Some controllers don't
+support ECC directly; in those cases, software ECC is used.
+Other controllers speed up the ECC calculations with hardware.
+Single-bit error correction hardware is routine.  Controllers
+geared for newer MLC chips may correct 4 or more errors for
+every 512 bytes of data.
+
+You will need to make sure that any data you write using
+OpenOCD includes the apppropriate kind of ECC.  For example,
+that may mean passing the @code{oob_softecc} flag when
+writing NAND data, or ensuring that the correct hardware
+ECC mode is used.
+
+The basic steps for using NAND devices include:
+ at enumerate
+ at item Declare via the command @command{nand device}
+@* Do this in a board-specific configuration file,
+passing parameters as needed by the controller.
+ at item Configure each device using @command{nand probe}.
+@* Do this only after the associated target is set up,
+such as in its reset-init script or in procures defined
+to access that device.
+ at item Operate on the flash via @command{nand subcommand}
+@* Often commands to manipulate the flash are typed by a human, or run
+via a script in some automated way.  Common task include writing a
+boot loader, operating system, or other data needed to initialize or
+de-brick a board.
+ at end enumerate
+
+ at section NAND Configuration Commands
+ at cindex NAND configuration
+
+NAND chips must be declared in configuration scripts,
+plus some additional configuration that's done after
+OpenOCD has initialized.
+
+ at deffn {Config Command} {nand device} controller target [configparams...]
+Declares a NAND device, which can be read and written to
+after it has been configured through @command{nand probe}.
+In OpenOCD, devices are single chips; this is unlike some
+operating systems, which may manage multiple chips as if
+they were a single (larger) device.
+In some cases, configuring a device will activate extra
+commands; see the controller-specific documentation.
+
+ at b{NOTE:} This command is not available after OpenOCD
+initialization has completed.  Use it in board specific
+configuration files, not interactively.
+
+ at itemize @bullet
+ at item @var{controller} ... identifies a the controller driver
+associated with the NAND device being declared.
+ at xref{NAND Driver List}.
+ at item @var{target} ... names the target used when issuing
+commands to the NAND controller.
+ at comment Actually, it's currently a controller-specific parameter...
+ at item @var{configparams} ... controllers may support, or require,
+additional parameters.  See the controller-specific documentation
+for more information.
+ at end itemize
+ at end deffn
+
+ at deffn Command {nand list}
+Prints a one-line summary of each device declared
+using @command{nand device}, numbered from zero.
+Note that un-probed devices show no details.
+ at end deffn
+
+ at deffn Command {nand probe} num
+Probes the specified device to determine key characteristics
+like its page and block sizes, and how many blocks it has.
+The @var{num} parameter is the value shown by @command{nand list}.
+You must (successfully) probe a device before you can use
+it with most other NAND commands.
+ at end deffn
+
+ at section Erasing, Reading, Writing to NAND Flash
+
+ at deffn Command {nand dump} num filename offset length [oob_option]
+ at cindex NAND reading
+Reads binary data from the NAND device and writes it to the file,
+starting at the specified offset.
+The @var{num} parameter is the value shown by @command{nand list}.
+
+Use a complete path name for @var{filename}, so you don't depend
+on the directory used to start the OpenOCD server.
+
+The @var{offset} and @var{length} must be exact multiples of the
+device's page size.  They describe a data region; the OOB data
+associated with each such page may also be accessed.
+
+ at b{NOTE:} At the time this text was written, no error correction
+was done on the data that's read, unless raw access was disabled
+and the underlying NAND controller driver had a @code{read_page}
+method which handled that error correction.
+
+By default, only page data is saved to the specified file.
+Use an @var{oob_option} parameter to save OOB data:
+ at itemize @bullet
+ at item no oob_* parameter
+@*Output file holds only page data; OOB is discarded.
+ at item @code{oob_raw}
+@*Output file interleaves page data and OOB data;
+the file will be longer than "length" by the size of the
+spare areas associated with each data page.
+Note that this kind of "raw" access is different from
+what's implied by @command{nand raw_access}, which just
+controls whether a hardware-aware access method is used.
+ at item @code{oob_only}
+@*Output file has only raw OOB data, and will
+be smaller than "length" since it will contain only the
+spare areas associated with each data page.
+ at end itemize
+ at end deffn
+
+ at deffn Command {nand erase} num ...
+ at cindex NAND erasing
+ at b{NOTE:} Syntax is in flux.
+ at end deffn
+
+ at deffn Command {nand write} num filename offset [option...]
+ at cindex NAND writing
+Writes binary data from the file into the specified NAND device,
+starting at the specified offset.  Those pages should already
+have been erased; you can't change zero bits to one bits.
+The @var{num} parameter is the value shown by @command{nand list}.
+
+Use a complete path name for @var{filename}, so you don't depend
+on the directory used to start the OpenOCD server.
+
+The @var{offset} must be an exact multiple of the device's page size.
+All data in the file will be written, assuming it doesn't run
+past the end of the device.
+Only full pages are written, and any extra space in the last
+page will be filled with 0xff bytes.  (That includes OOB data,
+if that's being written.)
+
+ at b{NOTE:} At the time this text was written, bad blocks are
+ignored.  That is, this routine will not skip bad blocks,
+but will instead try to write them.  This can cause problems.
+
+Provide at most one @var{option} parameter.  With some
+NAND drivers, the meanings of these parameters may change
+if @command{nand raw_access} was used to disable hardware ECC.
+ at itemize @bullet
+ at item no oob_* parameter
+@*File has only page data, which is written.
+If raw acccess is in use, the OOB area will not be written.
+Otherwise, if the underlying NAND controller driver has
+a @code{write_page} routine, that routine may write the OOB
+with hardware-computed ECC data.
+ at item @code{oob_only}
+@*File has only raw OOB data, which is written to the OOB area.
+Each page's data area stays untouched.  @i{This can be a dangerous
+option}, since it can invalidate the ECC data.
+You may need to force raw access to use this mode.
+ at item @code{oob_raw}
+@*File interleaves data and OOB data, both of which are written
+If raw access is enabled, the data is written first, then the
+un-altered OOB.
+Otherwise, if the underlying NAND controller driver has
+a @code{write_page} routine, that routine may modify the OOB
+before it's written, to include hardware-computed ECC data.
+ at item @code{oob_softecc}
+@*File has only page data, which is written.
+The OOB area is filled with 0xff, except for a standard 1-bit
+software ECC code stored in conventional locations.
+You might need to force raw access to use this mode, to prevent
+the underlying driver from applying hardware ECC.
+ at item @code{oob_softecc_kw}
+@*File has only page data, which is written.
+The OOB area is filled with 0xff, except for a 4-bit software ECC
+specific to the boot ROM in Marvell Kirkwood SoCs.
+You might need to force raw access to use this mode, to prevent
+the underlying driver from applying hardware ECC.
+ at end itemize
+ at end deffn
+
+ at section Other NAND commands
+ at cindex NAND other commands
+
+ at deffn Command {nand check_bad} num ...
+ at b{NOTE:} Syntax is in flux.
+ at end deffn
+
+ at deffn Command {nand info} num
+The @var{num} parameter is the value shown by @command{nand list}.
+This prints the one-line summary from "nand list", plus for
+devices which have been probed this also prints any known
+status for each block.
+ at end deffn
+
+ at deffn Command {nand raw_access} num <enable|disable>
+Sets or clears an flag affecting how page I/O is done.
+The @var{num} parameter is the value shown by @command{nand list}.
+
+This flag is cleared (disabled) by default, but changing that
+value won't affect all NAND devices.  The key factor is whether
+the underlying driver provides @code{read_page} or @code{write_page}
+methods.  If it doesn't provide those methods, the setting of
+this flag is irrelevant; all access is effectively ``raw''.
+
+When those methods exist, they are normally used when reading
+data (@command{nand dump} or reading bad block markers) or
+writing it (@command{nand write}).  However, enabling
+raw access (setting the flag) prevents use of those methods,
+bypassing hardware ECC logic.
+ at i{This can be a dangerous option}, since writing blocks
+with the wrong ECC data can cause them to be marked as bad.
+ at end deffn
+
+ at section NAND Drivers; Driver-specific Options and Commands
+ at anchor{NAND Driver List}
+As noted above, the @command{nand device} command allows
+driver-specific options and behaviors.
+Some controllers also activate controller-specific commands.
+
+ at deffn {NAND Driver} lpc3180
+These controllers require an extra @command{nand device}
+parameter:  the clock rate used by the controller.
+ at deffn Command {nand lpc3180 select} num [mlc|slc]
+Configures use of the MLC or SLC controller mode.
+MLC implies use of hardware ECC.
+The @var{num} parameter is the value shown by @command{nand list}.
+ at end deffn
+
+At this writing, this driver includes @code{write_page}
+and @code{read_page} methods.  Using @command{nand raw_access}
+to disable those methods will prevent use of hardware ECC
+in the MLC controller mode, but won't change SLC behavior.
+ at end deffn
+ at comment current lpc3180 code won't issue 5-byte address cycles
+
+ at deffn {NAND Driver} orion
+These controllers require an extra @command{nand device}
+parameter:  the address of the controller.
+ at example
+nand device orion 0xd8000000
+ at end example
+These controllers don't define any specialized commands.
+At this writing, their drivers don't include @code{write_page}
+or @code{read_page} methods, so @command{nand raw_access} won't
+change any behavior.
+ at end deffn
+
+ at deffn {NAND Driver} {s3c2410, s3c2412, s3c2440, s3c2443}
+These S3C24xx family controllers don't have any special
+ at command{nand device} options, and don't define any
+specialized commands.
+At this writing, their drivers don't include @code{write_page}
+or @code{read_page} methods, so @command{nand raw_access} won't
+change any behavior.
+ at end deffn
+
 @node General Commands
 @chapter General Commands
 @cindex commands
@@ -3530,6 +3826,11 @@
 
 You can use the ``scan_chain'' command to verify and display the tap order.
 
+Also, some commands can't execute until after @command{init} has been
+processed.  Such commands include @command{nand probe} and everything
+else that needs to write to controller registers, perhaps for setting
+up DRAM and loading it with code.
+
 @item @b{JTAG Tap Order} JTAG tap order - command order
 
 Many newer devices have multiple JTAG taps. For example: ST
@@ -3956,13 +4257,17 @@
 
 @include fdl.texi
 
- at node OpenOCD Index
+ at node OpenOCD Concept Index
 @comment DO NOT use the plain word ``Index'', reason: CYGWIN filename
 @comment case issue with ``Index.html'' and ``index.html''
 @comment Occurs when creating ``--html --no-split'' output
 @comment This fix is based on: http://sourceware.org/ml/binutils/2006-05/msg00215.html
- at unnumbered OpenOCD Index
+ at unnumbered OpenOCD Concept Index
 
 @printindex cp
 
+ at node OpenOCD Command Index
+ at unnumbered OpenOCD Command Index
+ at printindex fn
+
 @bye



From zwelch at mail.berlios.de  Fri May 22 04:27:34 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 22 May 2009 04:27:34 +0200
Subject: [Openocd-svn] r1880 - trunk/src/target
Message-ID: <200905220227.n4M2RY2K003371@sheep.berlios.de>

Author: zwelch
Date: 2009-05-22 04:27:30 +0200 (Fri, 22 May 2009)
New Revision: 1880

Modified:
   trunk/src/target/arm7_9_common.c
   trunk/src/target/arm7_9_common.h
Log:
Submitted by Dean Glazeski <dnglaze at gmail.com>:

Add doxygen comments in arm7_9_common source and header files.


Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-22 02:25:18 UTC (rev 1879)
+++ trunk/src/target/arm7_9_common.c	2009-05-22 02:27:30 UTC (rev 1880)
@@ -773,6 +773,14 @@
 	return ERROR_OK;
 }
 
+/**
+ * Get some data from the ARM7/9 target.
+ *
+ * @param target Pointer to the ARM7/9 target to read data from
+ * @param size The number of 32bit words to be read
+ * @param buffer Pointer to the buffer that will hold the data
+ * @return The result of receiving data from the Embedded ICE unit
+ */
 int arm7_9_target_request_data(target_t *target, u32 size, u8 *buffer)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -786,6 +794,7 @@
 
 	retval = embeddedice_receive(jtag_info, data, size);
 
+	/* return the 32-bit ints in the 8-bit array */
 	for (i = 0; i < size; i++)
 	{
 		h_u32_to_le(buffer + (i * 4), data[i]);
@@ -796,6 +805,15 @@
 	return retval;
 }
 
+/**
+ * Handles requests to an ARM7/9 target.  If debug messaging is enabled, the
+ * target is running and the DCC control register has the W bit high, this will
+ * execute the request on the target.
+ *
+ * @param priv Void pointer expected to be a target_t pointer
+ * @return ERROR_OK unless there are issues with the JTAG queue or when reading
+ *                  from the Embedded ICE unit
+ */
 int arm7_9_handle_target_request(void *priv)
 {
 	int retval = ERROR_OK;
@@ -838,6 +856,26 @@
 	return ERROR_OK;
 }
 
+/**
+ * Polls an ARM7/9 target for its current status.  If DBGACK is set, the target
+ * is manipulated to the right halted state based on its current state.  This is
+ * what happens:
+ *
+ * <table>
+ * 		<tr><th>State</th><th>Action</th></tr>
+ * 		<tr><td>TARGET_RUNNING | TARGET_RESET</td><td>Enters debug mode.  If TARGET_RESET, pc may be checked</td></tr>
+ * 		<tr><td>TARGET_UNKNOWN</td><td>Warning is logged</td></tr>
+ * 		<tr><td>TARGET_DEBUG_RUNNING</td><td>Enters debug mode</td></tr>
+ * 		<tr><td>TARGET_HALTED</td><td>Nothing</td></tr>
+ * </table>
+ *
+ * If the target does not end up in the halted state, a warning is produced.  If
+ * DBGACK is cleared, then the target is expected to either be running or
+ * running in debug.
+ *
+ * @param target Pointer to the ARM7/9 target to poll
+ * @return ERROR_OK or an error status if a command fails
+ */
 int arm7_9_poll(target_t *target)
 {
 	int retval;
@@ -907,7 +945,7 @@
 		}
 		if (target->state != TARGET_HALTED)
 		{
-			LOG_WARNING("DBGACK set, but the target did not end up in the halted stated %d", target->state);
+			LOG_WARNING("DBGACK set, but the target did not end up in the halted state %d", target->state);
 		}
 	}
 	else
@@ -919,14 +957,17 @@
 	return ERROR_OK;
 }
 
-/*
-  Some -S targets (ARM966E-S in the STR912 isn't affected, ARM926EJ-S
-  in the LPC3180 and AT91SAM9260 is affected) completely stop the JTAG clock
-  while the core is held in reset(SRST). It isn't possible to program the halt
-  condition once reset was asserted, hence a hook that allows the target to set
-  up its reset-halt condition prior to asserting reset.
-*/
-
+/**
+ * Asserts the reset (SRST) on an ARM7/9 target.  Some -S targets (ARM966E-S in
+ * the STR912 isn't affected, ARM926EJ-S in the LPC3180 and AT91SAM9260 is
+ * affected) completely stop the JTAG clock while the core is held in reset
+ * (SRST).  It isn't possible to program the halt condition once reset is
+ * asserted, hence a hook that allows the target to set up its reset-halt
+ * condition is setup prior to asserting reset.
+ *
+ * @param target Pointer to an ARM7/9 target to assert reset on
+ * @return ERROR_FAIL if the JTAG device does not have SRST, otherwise ERROR_OK
+ */
 int arm7_9_assert_reset(target_t *target)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -965,7 +1006,7 @@
 		}
 	}
 
-	/* here we should issue a srst only, but we may have to assert trst as well */
+	/* here we should issue an SRST only, but we may have to assert TRST as well */
 	if (jtag_reset_config & RESET_SRST_PULLS_TRST)
 	{
 		jtag_add_reset(1, 1);
@@ -988,6 +1029,15 @@
 	return ERROR_OK;
 }
 
+/**
+ * Deassert the reset (SRST) signal on an ARM7/9 target.  If SRST pulls TRST
+ * and the target is being reset into a halt, a warning will be triggered
+ * because it is not possible to reset into a halted mode in this case.  The
+ * target is halted using the target's functions.
+ *
+ * @param target Pointer to the target to have the reset deasserted
+ * @return ERROR_OK or an error from polling or halting the target
+ */
 int arm7_9_deassert_reset(target_t *target)
 {
 	int retval=ERROR_OK;
@@ -1018,6 +1068,15 @@
 	return retval;
 }
 
+/**
+ * Clears the halt condition for an ARM7/9 target.  If it isn't coming out of
+ * reset and if DBGRQ is used, it is progammed to be deasserted.  If the reset
+ * vector catch was used, it is restored.  Otherwise, the control value is
+ * restored and the watchpoint unit is restored if it was in use.
+ *
+ * @param target Pointer to the ARM7/9 target to have halt cleared
+ * @return Always ERROR_OK
+ */
 int arm7_9_clear_halt(target_t *target)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -1066,6 +1125,16 @@
 	return ERROR_OK;
 }
 
+/**
+ * Issue a software reset and halt to an ARM7/9 target.  The target is halted
+ * and then there is a wait until the processor shows the halt.  This wait can
+ * timeout and results in an error being returned.  The software reset involves
+ * clearing the halt, updating the debug control register, changing to ARM mode,
+ * reset of the program counter, and reset of all of the registers.
+ *
+ * @param target Pointer to the ARM7/9 target to be reset and halted by software
+ * @return Error status if any of the commands fail, otherwise ERROR_OK
+ */
 int arm7_9_soft_reset_halt(struct target_s *target)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -1163,6 +1232,15 @@
 	return ERROR_OK;
 }
 
+/**
+ * Halt an ARM7/9 target.  This is accomplished by either asserting the DBGRQ
+ * line or by programming a watchpoint to trigger on any address.  It is
+ * considered a bug to call this function while the target is in the
+ * TARGET_RESET state.
+ *
+ * @param target Pointer to the ARM7/9 target to be halted
+ * @return Always ERROR_OK
+ */
 int arm7_9_halt(target_t *target)
 {
 	if (target->state==TARGET_RESET)
@@ -1215,6 +1293,17 @@
 	return ERROR_OK;
 }
 
+/**
+ * Handle an ARM7/9 target's entry into debug mode.  The halt is cleared on the
+ * ARM.  The JTAG queue is then executed and the reason for debug entry is
+ * examined.  Once done, the target is verified to be halted and the processor
+ * is forced into ARM mode.  The core registers are saved for the current core
+ * mode and the program counter (register 15) is updated as needed.  The core
+ * registers and CPSR and SPSR are saved for restoration later.
+ *
+ * @param target Pointer to target that is entering debug mode
+ * @return Error code if anything fails, otherwise ERROR_OK
+ */
 int arm7_9_debug_entry(target_t *target)
 {
 	int i;
@@ -1376,6 +1465,15 @@
 	return ERROR_OK;
 }
 
+/**
+ * Validate the full context for an ARM7/9 target in all processor modes.  If
+ * there are any invalid registers for the target, they will all be read.  This
+ * includes the PSR.
+ *
+ * @param target Pointer to the ARM7/9 target to capture the full context from
+ * @return Error if the target is not halted, has an invalid core mode, or if
+ *         the JTAG queue fails to execute
+ */
 int arm7_9_full_context(target_t *target)
 {
 	int i;
@@ -1457,6 +1555,18 @@
 	return ERROR_OK;
 }
 
+/**
+ * Restore the processor context on an ARM7/9 target.  The full processor
+ * context is analyzed to see if any of the registers are dirty on this end, but
+ * have a valid new value.  If this is the case, the processor is changed to the
+ * appropriate mode and the new register values are written out to the
+ * processor.  If there happens to be a dirty register with an invalid value, an
+ * error will be logged.
+ *
+ * @param target Pointer to the ARM7/9 target to have its context restored
+ * @return Error status if the target is not halted or the core mode in the
+ *         armv4_5 struct is invalid.
+ */
 int arm7_9_restore_context(target_t *target)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -1599,6 +1709,14 @@
 	return ERROR_OK;
 }
 
+/**
+ * Restart the core of an ARM7/9 target.  A RESTART command is sent to the
+ * instruction register and the JTAG state is set to TAP_IDLE causing a core
+ * restart.
+ *
+ * @param target Pointer to the ARM7/9 target to be restarted
+ * @return Result of executing the JTAG queue
+ */
 int arm7_9_restart_core(struct target_s *target)
 {
 	armv4_5_common_t *armv4_5 = target->arch_info;
@@ -1617,6 +1735,12 @@
 	return jtag_execute_queue();
 }
 
+/**
+ * Enable the watchpoints on an ARM7/9 target.  The target's watchpoints are
+ * iterated through and are set on the target if they aren't already set.
+ *
+ * @param target Pointer to the ARM7/9 target to enable watchpoints on
+ */
 void arm7_9_enable_watchpoints(struct target_s *target)
 {
 	watchpoint_t *watchpoint = target->watchpoints;
@@ -1629,6 +1753,12 @@
 	}
 }
 
+/**
+ * Enable the breakpoints on an ARM7/9 target.  The target's breakpoints are
+ * iterated through and are set on the target.
+ *
+ * @param target Pointer to the ARM7/9 target to enable breakpoints on
+ */
 void arm7_9_enable_breakpoints(struct target_s *target)
 {
 	breakpoint_t *breakpoint = target->breakpoints;

Modified: trunk/src/target/arm7_9_common.h
===================================================================
--- trunk/src/target/arm7_9_common.h	2009-05-22 02:25:18 UTC (rev 1879)
+++ trunk/src/target/arm7_9_common.h	2009-05-22 02:27:30 UTC (rev 1880)
@@ -32,52 +32,55 @@
 #include "breakpoints.h"
 #include "etm.h"
 
-#define	ARM7_9_COMMON_MAGIC 0x0a790a79
+#define	ARM7_9_COMMON_MAGIC 0x0a790a79 /**< */
 
+/**
+ * Structure for items that are common between both ARM7 and ARM9 targets.
+ */
 typedef struct arm7_9_common_s
 {
 	u32 common_magic;
 
-	arm_jtag_t jtag_info;
-	reg_cache_t *eice_cache;
+	arm_jtag_t jtag_info; /**< JTAG information for target */
+	reg_cache_t *eice_cache; /**< Embedded ICE register cache */
 
-	u32 arm_bkpt;
-	u16 thumb_bkpt;
-	int sw_breakpoints_added;
-	int breakpoint_count;
-	int wp_available;
-	int wp_available_max;
-	int wp0_used;
-	int wp1_used;
-	int wp1_used_default;
+	u32 arm_bkpt; /**< ARM breakpoint instruction */
+	u16 thumb_bkpt; /**< Thumb breakpoint instruction */
+	int sw_breakpoints_added; /**< Specifies which watchpoint software breakpoints are setup on */
+	int breakpoint_count; /**< Current number of set breakpoints */
+	int wp_available; /**< Current number of available watchpoint units */
+	int wp_available_max; /**< Maximum number of available watchpoint units */
+	int wp0_used; /**< Specifies if and how watchpoint unit 0 is used */
+	int wp1_used; /**< Specifies if and how watchpoint unit 1 is used */
+	int wp1_used_default; /**< Specifies if and how watchpoint unit 1 is used by default */
 	int force_hw_bkpts;
-	int dbgreq_adjust_pc;
-	int use_dbgrq;
-	int need_bypass_before_restart;
+	int dbgreq_adjust_pc; /**< Amount of PC adjustment caused by a DBGREQ */
+	int use_dbgrq; /**< Specifies if DBGRQ should be used to halt the target */
+	int need_bypass_before_restart; /**< Specifies if there should be a bypass before a JTAG restart */
 
 	etm_context_t *etm_ctx;
 
 	int has_single_step;
 	int has_monitor_mode;
-	int has_vector_catch;
+	int has_vector_catch; /**< Specifies if the target has a reset vector catch */
 
-	int debug_entry_from_reset;
+	int debug_entry_from_reset; /**< Specifies if debug entry was from a reset */
 
 	struct working_area_s *dcc_working_area;
 
 	int fast_memory_access;
 	int dcc_downloads;
 
-	int (*examine_debug_reason)(target_t *target);
+	int (*examine_debug_reason)(target_t *target); /**< Function for determining why debug state was entered */
 
-	void (*change_to_arm)(target_t *target, u32 *r0, u32 *pc);
+	void (*change_to_arm)(target_t *target, u32 *r0, u32 *pc); /**< Function for changing from Thumb to ARM mode */
 
-	void (*read_core_regs)(target_t *target, u32 mask, u32 *core_regs[16]);
+	void (*read_core_regs)(target_t *target, u32 mask, u32 *core_regs[16]); /**< Function for reading the core registers */
 	void (*read_core_regs_target_buffer)(target_t *target, u32 mask, void *buffer, int size);
-	void (*read_xpsr)(target_t *target, u32 *xpsr, int spsr);
+	void (*read_xpsr)(target_t *target, u32 *xpsr, int spsr); /**< Function for reading CPSR or SPSR */
 
-	void (*write_xpsr)(target_t *target, u32 xpsr, int spsr);
-	void (*write_xpsr_im8)(target_t *target, u8 xpsr_im, int rot, int spsr);
+	void (*write_xpsr)(target_t *target, u32 xpsr, int spsr); /**< Function for writing to CPSR or SPSR */
+	void (*write_xpsr_im8)(target_t *target, u8 xpsr_im, int rot, int spsr); /**< Function for writing an immediate value to CPSR or SPSR */
 	void (*write_core_regs)(target_t *target, u32 mask, u32 core_regs[16]);
 
 	void (*load_word_regs)(target_t *target, u32 mask);
@@ -88,20 +91,20 @@
 	void (*store_hword_reg)(target_t *target, int num);
 	void (*store_byte_reg)(target_t *target, int num);
 
-	void (*write_pc)(target_t *target, u32 pc);
+	void (*write_pc)(target_t *target, u32 pc); /**< Function for writing to the program counter */
 	void (*branch_resume)(target_t *target);
 	void (*branch_resume_thumb)(target_t *target);
 
 	void (*enable_single_step)(target_t *target, u32 next_pc);
 	void (*disable_single_step)(target_t *target);
 
-	void (*set_special_dbgrq)(target_t *target);
+	void (*set_special_dbgrq)(target_t *target); /**< Function for setting DBGRQ if the normal way won't work */
 
-	void (*pre_debug_entry)(target_t *target);
-	void (*post_debug_entry)(target_t *target);
+	void (*pre_debug_entry)(target_t *target); /**< Callback function called before entering debug mode */
+	void (*post_debug_entry)(target_t *target); /**< Callback function called after entering debug mode */
 
-	void (*pre_restore_context)(target_t *target);
-	void (*post_restore_context)(target_t *target);
+	void (*pre_restore_context)(target_t *target); /**< Callback function called before restoring the processor context */
+	void (*post_restore_context)(target_t *target); /**< Callback function called after restoring the processor context */
 
 	armv4_5_common_t armv4_5_common;
 	void *arch_info;



From zwelch at mail.berlios.de  Fri May 22 04:32:41 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 22 May 2009 04:32:41 +0200
Subject: [Openocd-svn] r1881 - in trunk/src/target: board target
Message-ID: <200905220232.n4M2WfXk003701@sheep.berlios.de>

Author: zwelch
Date: 2009-05-22 04:32:31 +0200 (Fri, 22 May 2009)
New Revision: 1881

Added:
   trunk/src/target/board/dm355evm.cfg
   trunk/src/target/target/davinci.cfg
Modified:
   trunk/src/target/target/ti_dm355.cfg
Log:
Submitted by David Brownell <david-b at pacbell.net>:

Improve support for the DM355 EVM board, and eventually other boards based
on DaVinci chips:

 - Provide generic "davinci.cfg" to hold utilities that can be reused by
   different chips in this family.  Start with PINMUX, PSC, and PLL setup.

 - DM355 chip support updates:  provide a dictionary with chip-specific
   symbols, load those utilities.

 - Create a new dm355evm board file, with a reset-init event handler
   which uses those utilities to set up PLLs and clocks, configure the
   pins, and improve the JTAG speed limit.

Also a minor tweak:  provide a virtual address for the work area, matching
what the very latest kernels do.  It's probably unwise to use OpenOCD while
the MMU is active though.

The DRAM isn't yet accessible, but NAND access is mostly ready.


Added: trunk/src/target/board/dm355evm.cfg
===================================================================
--- trunk/src/target/board/dm355evm.cfg	2009-05-22 02:27:30 UTC (rev 1880)
+++ trunk/src/target/board/dm355evm.cfg	2009-05-22 02:32:31 UTC (rev 1881)
@@ -0,0 +1,111 @@
+#
+# DM355 EVM board
+#   http://focus.ti.com/docs/toolsw/folders/print/tmdsevm355.html
+#   http://c6000.spectrumdigital.com/evmdm355/
+
+source [find target/ti_dm355.cfg]
+
+reset_config trst_and_srst separate
+
+# NOTE:  disable or replace this call to dm355evm_init if you're
+# debugging new UBL code from SRAM.
+$_TARGETNAME configure -event reset-init { dm355evm_init }
+
+#
+# This post-reset init is called when the MMU isn't active, all IRQs
+# are disabled, etc.  It should do most of what a UBL does, except for
+# loading code (like U-Boot) into DRAM and running it.
+#
+proc dm355evm_init {} {
+	global dm355
+
+	puts "Initialize DM355 EVM board"
+
+	# CLKIN	= 24 MHz ... can't talk quickly to ARM yet
+	jtag_khz 1500
+
+	########################
+	# PLL1		= 432 MHz (/8, x144)
+	# ...SYSCLK1	= 216 MHz (/2)  ... ARM, MJCP
+	# ...SYSCLK2	= 108 MHz (/4)  ... Peripherals
+	# ...SYSCLK3	= 27  MHz (/16) ... VPBE, DAC
+	# ...SYSCLK4	= 108 MHz (/4)  ... VPSS
+	#	pll1.{prediv,div1,div2} are fixed
+	#	pll1.postdiv set in MISC (for *this* speed grade)
+
+	set addr [dict get $dm355 pllc1]
+	set pll_divs [dict create]
+	dict set pll_divs div3 16
+	dict set pll_divs div4 8
+	pll_setup $addr 144 $pll_divs
+
+	# ARM is now running at 216 MHz, so JTAG can go faster
+	jtag_khz 20000
+
+	########################
+	# PLL2		= 342 MHz (/8, x114)
+	# ....SYSCLK1	= 342 MHz (/1)  ... DDR PHY at 171 MHz, 2x clock
+	#	pll2.{postdiv,div1} are fixed
+
+	set addr [dict get $dm355 pllc2]
+	set pll_divs [dict create]
+	dict set pll_divs prediv 8
+	pll_setup $addr 114 $pll_divs
+
+	########################
+	# PINMUX
+
+	# All Video Inputs
+	davinci_pinmux $dm355 0 0x00007f55
+	# All Video Outputs
+	davinci_pinmux $dm355 1 0x00145555
+	# EMIFA (NOTE: more could be set up for use as GPIOs)
+	davinci_pinmux $dm355 2 0x00000c08
+	# SPI0, SPI1, UART1, I2C, SD0, SD1, McBSP0, CLKOUTs
+	davinci_pinmux $dm355 3 0x1bff55ff
+	# MMC/SD0 instead of MS; SPI0
+	davinci_pinmux $dm355 4 0x00000000
+
+	########################
+	# PSC setup (minimal)
+
+	# DDR EMIF/13, AEMIF/14, UART0/19
+	psc_enable 13
+	psc_enable 14
+	psc_enable 19
+	psc_go
+
+	########################
+	# DDR2 EMIF
+
+	# FIXME setup
+
+	########################
+	# ASYNC EMIF
+
+	set addr [dict get $dm355 a_emif]
+
+	# slow/pessimistic timings
+	set nand_timings 0x40400204
+	# fast (25% faster page reads)
+	#set nand_timings 0x0400008c
+
+	# AWCCR
+	mww [expr $addr + 0x04] 0xff
+	# CS0 == socketed NAND (default MT29F16G08FAA, 2GByte)
+	mww [expr $addr + 0x10] $nand_timings
+	# CS1 == dm9000 Ethernet
+	mww [expr $addr + 0x14] 0x00a00505
+	# NANDFCR -- only CS0 has NAND
+	mww [expr $addr + 0x60] 0x01
+
+	########################
+	# UART0
+
+	# FIXME setup
+}
+
+# FIXME
+#  - declare the NAND flash; use the 4-bit ECC
+#  - support writing UBL with its header (new layout only with new ROMs)
+#  - support writing ABL/U-Boot with its header (both layouts)


Property changes on: trunk/src/target/board/dm355evm.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/target/target/davinci.cfg
===================================================================
--- trunk/src/target/target/davinci.cfg	2009-05-22 02:27:30 UTC (rev 1880)
+++ trunk/src/target/target/davinci.cfg	2009-05-22 02:32:31 UTC (rev 1881)
@@ -0,0 +1,170 @@
+#
+# Utility code for DaVinci-family chips
+#
+
+# davinci_pinmux:  assigns PINMUX$reg <== $value
+proc davinci_pinmux {soc reg value} {
+	mww [expr [dict get $soc sysbase] + 4 * $reg] $value
+}
+
+# mrw: "memory read word", returns value of $reg
+proc mrw {reg} {
+	set value ""
+	ocd_mem2array value 32 $reg 1
+	return $value(0)
+}
+
+# mmw: "memory modify word", updates value of $reg
+#	$reg <== ((value & ~$clearbits) | $setbits)
+proc mmw {reg setbits clearbits} {
+	set old [mrw $reg]
+	set new [expr ($old & ~$clearbits) | $setbits]
+	mww $reg $new
+}
+
+#
+# pll_setup: initialize PLL
+#  - pll_addr ... physical addr of controller
+#  - mult ... pll multiplier
+#  - config ... dict mapping { prediv, postdiv, div[1-9] } to dividers
+#
+# For PLLs that don't have a given register (e.g. plldiv8), or where a
+# given divider is non-programmable, caller provides *NO* config mapping.
+#
+# REVISIT there are minor differences between the PLL controllers.
+# Handle those; maybe check the ID register.  This version behaves
+# for at least the dm355.  On dm6446 and dm357 the PLLRST polarity
+# is different.  On dm365 there are more changes.
+#
+proc pll_setup {pll_addr mult config} {
+	set pll_ctrl_addr [expr $pll_addr + 0x100]
+	set pll_ctrl [mrw $pll_ctrl_addr]
+
+	# 1 - clear CLKMODE (bit 8) iff using on-chip oscillator
+	# NOTE:  this assumes we should clear that bit
+	set pll_ctrl [expr $pll_ctrl & ~0x0100]
+	mww $pll_ctrl_addr $pll_ctrl
+
+	# 2 - clear PLLENSRC (bit 5)
+	set pll_ctrl [expr $pll_ctrl & ~0x0020]
+	mww $pll_ctrl_addr $pll_ctrl
+
+	# 3 - clear PLLEN (bit 0) ... enter bypass mode
+	set pll_ctrl [expr $pll_ctrl & ~0x0001]
+	mww $pll_ctrl_addr $pll_ctrl
+
+	# 4 - wait at least 4 refclk cycles
+	sleep 1
+
+	# 5 - set PLLRST (bit 3)
+	set pll_ctrl [expr $pll_ctrl | 0x0008]
+	mww $pll_ctrl_addr $pll_ctrl
+
+	# 6 - set PLLDIS (bit 4)
+	set pll_ctrl [expr $pll_ctrl | 0x0010]
+	mww $pll_ctrl_addr $pll_ctrl
+
+	# 7 - clear PLLPWRDN (bit 1)
+	set pll_ctrl [expr $pll_ctrl & ~0x0002]
+	mww $pll_ctrl_addr $pll_ctrl
+
+	# 8 - clear PLLDIS (bit 4)
+	set pll_ctrl [expr $pll_ctrl & ~0x0010]
+	mww $pll_ctrl_addr $pll_ctrl
+
+	# 9 - optional:  write prediv, postdiv, and pllm
+	# NOTE:  for dm355 PLL1, postdiv is controlled via MISC register
+	mww [expr $pll_addr + 0x0110] [expr ($mult - 1) & 0xff]
+	if { [dict exists $config prediv] } {
+		set div [dict get $config prediv]
+		set div [expr 0x8000 | ($div - 1)]
+		mww [expr $pll_addr + 0x0114] $div
+	}
+	if { [dict exists $config postdiv] } {
+		set div [dict get $config postdiv]
+		set div [expr 0x8000 | ($div - 1)]
+		mww [expr $pll_addr + 0x0128] $div
+	}
+
+	# 10 - optional:  set plldiv1, plldiv2, ...
+	# NOTE:  this assumes some registers have their just-reset values:
+	#	- PLLSTAT.GOSTAT is clear when we enter
+	#	- ALNCTL has everything set
+	set go 0
+	if { [dict exists $config div1] } {
+		set div [dict get $config div1]
+		set div [expr 0x8000 | ($div - 1)]
+		mww [expr $pll_addr + 0x0118] $div
+		set go 1
+	}
+	if { [dict exists $config div2] } {
+		1et div [dict get $config div2]
+		set div [expr 0x8000 | ($div - 1)]
+		mww [expr $pll_addr + 0x011c] $div
+		set go 1
+	}
+	if { [dict exists $config div3] } {
+		set div [dict get $config div3]
+		set div [expr 0x8000 | ($div - 1)]
+		mww [expr $pll_addr + 0x011c] $div
+		set go 1
+	}
+	if { [dict exists $config div4] } {
+		set div [dict get $config div4]
+		set div [expr 0x8000 | ($div - 1)]
+		mww [expr $pll_addr + 0x0160] $div
+		set go 1
+	}
+	if { [dict exists $config div5] } {
+		set div [dict get $config div5]
+		set div [expr 0x8000 | ($div - 1)]
+		mww [expr $pll_addr + 0x0164] $div
+		set go 1
+	}
+	if {$go != 0} {
+		# write pllcmd.GO; poll pllstat.GO
+		mww [expr $pll_addr + 0x0138] 0x01
+		set pllstat [expr $pll_addr + 0x013c]
+		while {[expr [mrw $pllstat] & 0x01] != 0} { sleep 1 }
+	}
+
+	# 11 - wait at least 5 usec for reset to finish
+	# (assume covered by overheads including JTAG messaging)
+
+	# 12 - clear PLLRST (bit 3)
+	set pll_ctrl [expr $pll_ctrl & ~0x0008]
+	mww $pll_ctrl_addr $pll_ctrl
+
+	# 13 - wait at least 8000 refclk cycles for PLL to lock
+	# if we assume 24 MHz (slowest osc), that's 1/3 msec
+	sleep 3
+
+	# 14 - set PLLEN (bit 0) ... leave bypass mode
+	set pll_ctrl [expr $pll_ctrl | 0x0001]
+	mww $pll_ctrl_addr $pll_ctrl
+}
+
+# NOTE:  dm6446 requires EMURSTIE set in MDCTL before certain
+# modules can be enabled.
+
+# prepare a non-DSP module to be enabled; finish with psc_go
+proc psc_enable {module} {
+	set psc_addr 0x01c41000
+	# write MDCTL
+	mmw [expr $psc_addr + 0x0a00 + (4 * $module)] 0x03 0x1f
+}
+
+# execute non-DSP PSC transition(s) set up by psc_enable
+proc psc_go {} {
+	set psc_addr 0x01c41000
+	set ptstat_addr [expr $psc_addr + 0x0128]
+
+	# just in case PTSTAT.go isn't clear
+	while { [expr [mrw $ptstat_addr] & 0x01] != 0 } { sleep 1 }
+
+	# write PTCMD.go ... ignoring any DSP power domain
+	mww [expr $psc_addr + 0x0120] 1
+
+	# wait for PTSTAT.go to clear (again ignoring DSP power domain)
+	while { [expr [mrw $ptstat_addr] & 0x01] != 0 } { sleep 1 }
+}


Property changes on: trunk/src/target/target/davinci.cfg
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/target/ti_dm355.cfg
===================================================================
--- trunk/src/target/target/ti_dm355.cfg	2009-05-22 02:27:30 UTC (rev 1880)
+++ trunk/src/target/target/ti_dm355.cfg	2009-05-22 02:32:31 UTC (rev 1881)
@@ -44,13 +44,45 @@
 }
 jtag newtap $_CHIPNAME jrc -irlen 6 -ircapture 0x1 -irmask 0x3f -expected-id $_JRC_TAPID
 
+################
+
+# various symbol definitions, to avoid hard-wiring addresses
+# and enable some sharing of DaVinci-family utility code
+global dm355
+set dm355 [ dict create ]
+
+# Physical addresses for controllers and memory
+# (Some of these are valid for many DaVinci family chips)
+dict set dm355 sram0		0x00010000
+dict set dm355 sram1		0x00014000
+dict set dm355 sysbase		0x01c40000
+dict set dm355 pllc1		0x01c40800
+dict set dm355 pllc2		0x01c40c00
+dict set dm355 psc		0x01c41000
+dict set dm355 gpio		0x01c67000
+dict set dm355 a_emif		0x01e10000
+dict set dm355 a_emif_cs0	0x02000000
+dict set dm355 a_emif_cs1	0x04000000
+dict set dm355 ddr_emif		0x20000000
+dict set dm355 ddr		0x80000000
+
+source [find target/davinci.cfg]
+
+################
 # GDB target:  the ARM, using SRAM1 for scratch.  SRAM0 (also 16K)
 # and the ETB memory (4K) are other options, while trace is unused.
 set _TARGETNAME $_CHIPNAME.arm
 
 target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00014000 -work-area-size 0x4000 -work-area-backup 0
 
+# NOTE that work-area-virt presumes a Linux 2.6.30-rc2+ kernel,
+# and that the work area is used only with a kernel mmu context ...
+$_TARGETNAME configure \
+	-work-area-virt [expr 0xfffe0000 + 0x4000] \
+	-work-area-phys [dict get $dm355 sram1] \
+	-work-area-size 0x4000 \
+	-work-area-backup 0
+
 arm7_9 dbgrq enable
 arm7_9 fast_memory_access enable
 arm7_9 dcc_downloads enable



From kc8apf at mail.berlios.de  Fri May 22 19:42:04 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Fri, 22 May 2009 19:42:04 +0200
Subject: [Openocd-svn] r1882 - in trunk/src: pld xsvf
Message-ID: <200905221742.n4MHg4EQ017881@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-22 19:41:54 +0200 (Fri, 22 May 2009)
New Revision: 1882

Modified:
   trunk/src/pld/pld.c
   trunk/src/xsvf/xsvf.c
Log:
Author: Rick Altherr <kc8apf at kc8apf.net>
	- printf conversion fixes for variably-sized types


Modified: trunk/src/pld/pld.c
===================================================================
--- trunk/src/pld/pld.c	2009-05-22 02:32:31 UTC (rev 1881)
+++ trunk/src/pld/pld.c	2009-05-22 17:41:54 UTC (rev 1882)
@@ -189,9 +189,9 @@
 		gettimeofday(&end, NULL);	
 		timeval_subtract(&duration, &end, &start);
 
-		command_print(cmd_ctx, "loaded file %s to pld device %lu in %lis %lius",
+		command_print(cmd_ctx, "loaded file %s to pld device %lu in %jis %jius",
 			args[1], strtoul(args[0], NULL, 0),
-			duration.tv_sec, duration.tv_usec);
+			(intmax_t)duration.tv_sec, (intmax_t)duration.tv_usec);
 	}
 	
 	return ERROR_OK;

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-22 02:32:31 UTC (rev 1881)
+++ trunk/src/xsvf/xsvf.c	2009-05-22 17:41:54 UTC (rev 1882)
@@ -1021,7 +1021,7 @@
 	if (unsupported)
 	{
 		command_print(cmd_ctx,
-			 "unsupported xsvf command: 0x%02X in xsvf file at offset %ld, aborting",
+			 "unsupported xsvf command: 0x%02X in xsvf file at offset %jd, aborting",
 					  uc,  lseek(xsvf_fd, 0, SEEK_CUR)-1 );
 		return ERROR_FAIL;
 	}



From kc8apf at mail.berlios.de  Fri May 22 19:44:04 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Fri, 22 May 2009 19:44:04 +0200
Subject: [Openocd-svn] r1883 - trunk/src/flash
Message-ID: <200905221744.n4MHi4tN029149@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-22 19:44:04 +0200 (Fri, 22 May 2009)
New Revision: 1883

Modified:
   trunk/src/flash/nand.c
Log:
Author: David Brownell <david-b at pacbell.net>

Remove un-implemented and dubious "nand copy" command.

Doing this efficiently would mean doing the copying on
the target CPU, instead of back and forth through JTAG.
If anyone ever needs this functionality, that's what
they should implement.

Also, update on-line "help" for "nand dump" to display
its two optional flags; and for "nand write" to display
a recently added flag.



Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2009-05-22 17:41:54 UTC (rev 1882)
+++ trunk/src/flash/nand.c	2009-05-22 17:44:04 UTC (rev 1883)
@@ -35,7 +35,6 @@
 static int handle_nand_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int handle_nand_check_bad_blocks_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int handle_nand_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_nand_copy_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int handle_nand_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int handle_nand_dump_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int handle_nand_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
@@ -311,12 +310,11 @@
 						 "check NAND flash device <num> for bad blocks [<first> <last>]");
 		register_command(cmd_ctx, nand_cmd, "erase", handle_nand_erase_command, COMMAND_EXEC,
 						 "erase blocks on NAND flash device <num> <first> <last>");
-		register_command(cmd_ctx, nand_cmd, "copy", handle_nand_copy_command, COMMAND_EXEC,
-						 "copy from NAND flash device <num> <offset> <length> <ram-address>");
 		register_command(cmd_ctx, nand_cmd, "dump", handle_nand_dump_command, COMMAND_EXEC,
-						 "dump from NAND flash device <num> <filename> <offset> <size> [options]");
+						 "dump from NAND flash device <num> <filename> "
+						 "<offset> <size> [oob_raw|oob_only]");
 		register_command(cmd_ctx, nand_cmd, "write", handle_nand_write_command, COMMAND_EXEC,
-						 "write to NAND flash device <num> <filename> <offset> [oob_raw|oob_only|oob_softecc]");
+						 "write to NAND flash device <num> <filename> <offset> [oob_raw|oob_only|oob_softecc|oob_softecc_kw]");
 		register_command(cmd_ctx, nand_cmd, "raw_access", handle_nand_raw_access_command, COMMAND_EXEC,
 						 "raw access to NAND flash device <num> ['enable'|'disable']");
 	}
@@ -1270,29 +1268,6 @@
 	return ERROR_OK;
 }
 
-static int handle_nand_copy_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	nand_device_t *p;
-
-	if (argc != 4)
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-
-	}
-
-	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
-	if (p)
-	{
-
-	}
-	else
-	{
-		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds", args[0]);
-	}
-
-	return ERROR_OK;
-}
-
 static int handle_nand_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	u32 offset;



From kc8apf at mail.berlios.de  Fri May 22 19:47:07 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Fri, 22 May 2009 19:47:07 +0200
Subject: [Openocd-svn] r1884 - trunk/src/flash
Message-ID: <200905221747.n4MHl7xk031889@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-22 19:47:07 +0200 (Fri, 22 May 2009)
New Revision: 1884

Modified:
   trunk/src/flash/cfi.c
Log:
Author: Ra?\195?\186l S?\195?\161nchez Siles <rsanchezs at infoglobal.es>
	- Consistently use flash_address


Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-05-22 17:44:04 UTC (rev 1883)
+++ trunk/src/flash/cfi.c	2009-05-22 17:47:07 UTC (rev 1884)
@@ -2129,11 +2129,11 @@
 	if (bank->chip_width == 1)
 	{
 		u8 manufacturer, device_id;
-		if((retval = target_read_u8(target, bank->base + 0x0, &manufacturer)) != ERROR_OK)
+		if((retval = target_read_u8(target, flash_address(bank, 0, 0x00), &manufacturer)) != ERROR_OK)
 		{
 			return retval;
 		}
-		if((retval = target_read_u8(target, bank->base + 0x1, &device_id)) != ERROR_OK)
+		if((retval = target_read_u8(target, flash_address(bank, 0, 0x01), &device_id)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -2142,11 +2142,11 @@
 	}
 	else if (bank->chip_width == 2)
 	{
-		if((retval = target_read_u16(target, bank->base + 0x0, &cfi_info->manufacturer)) != ERROR_OK)
+		if((retval = target_read_u16(target, flash_address(bank, 0, 0x00), &cfi_info->manufacturer)) != ERROR_OK)
 		{
 			return retval;
 		}
-		if((retval = target_read_u16(target, bank->base + 0x2, &cfi_info->device_id)) != ERROR_OK)
+		if((retval = target_read_u16(target, flash_address(bank, 0, 0x02), &cfi_info->device_id)) != ERROR_OK)
 		{
 			return retval;
 		}



From kc8apf at mail.berlios.de  Fri May 22 19:48:27 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Fri, 22 May 2009 19:48:27 +0200
Subject: [Openocd-svn] r1885 - trunk/src/flash
Message-ID: <200905221748.n4MHmRtn032178@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-22 19:48:26 +0200 (Fri, 22 May 2009)
New Revision: 1885

Modified:
   trunk/src/flash/cfi.c
Log:
Author: Ra?\195?\186l S?\195?\161nchez Siles <rsanchezs at infoglobal.es>
	- Fix calculation of flash_address for x16 devices used as x8


Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-05-22 17:47:07 UTC (rev 1884)
+++ trunk/src/flash/cfi.c	2009-05-22 17:48:26 UTC (rev 1885)
@@ -112,9 +112,11 @@
 /* inline u32 flash_address(flash_bank_t *bank, int sector, u32 offset) */
 static __inline__ u32 flash_address(flash_bank_t *bank, int sector, u32 offset)
 {
+	cfi_flash_bank_t *cfi_info = bank->driver_priv;
+
 	/* while the sector list isn't built, only accesses to sector 0 work */
 	if (sector == 0)
-		return bank->base + offset * bank->bus_width;
+		return bank->base + (offset * bank->bus_width << cfi_info->x16_as_x8 );
 	else
 	{
 		if (!bank->sectors)
@@ -122,7 +124,7 @@
 			LOG_ERROR("BUG: sector list not yet built");
 			exit(-1);
 		}
-		return bank->base + bank->sectors[sector].offset + offset * bank->bus_width;
+		return bank->base + bank->sectors[sector].offset + (offset * bank->bus_width << cfi_info->x16_as_x8 );
 	}
 
 }



From kc8apf at mail.berlios.de  Fri May 22 19:49:29 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Fri, 22 May 2009 19:49:29 +0200
Subject: [Openocd-svn] r1886 - trunk/src/flash
Message-ID: <200905221749.n4MHnTFY032308@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-22 19:49:28 +0200 (Fri, 22 May 2009)
New Revision: 1886

Modified:
   trunk/src/flash/cfi.c
Log:
Author: Ra?\195?\186l S?\195?\161nchez Siles <rsanchezs at infoglobal.es>
	- Fix multi-byte reads on x16 devices used as x8


Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-05-22 17:48:26 UTC (rev 1885)
+++ trunk/src/flash/cfi.c	2009-05-22 17:49:28 UTC (rev 1886)
@@ -204,9 +204,18 @@
 static u16 cfi_query_u16(flash_bank_t *bank, int sector, u32 offset)
 {
 	target_t *target = bank->target;
+	cfi_flash_bank_t *cfi_info = bank->driver_priv;
 	u8 data[CFI_MAX_BUS_WIDTH * 2];
 
-	target->type->read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 2, data);
+	if(cfi_info->x16_as_x8)
+	{
+		u8 i;
+		for(i=0;i<2;i++)
+			target->type->read_memory(target, flash_address(bank, sector, offset+i), bank->bus_width, 1,
+				&data[i*bank->bus_width] );
+	}
+	else
+		target->type->read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 2, data);
 
 	if (bank->target->endianness == TARGET_LITTLE_ENDIAN)
 		return data[0] | data[bank->bus_width] << 8;
@@ -217,9 +226,18 @@
 static u32 cfi_query_u32(flash_bank_t *bank, int sector, u32 offset)
 {
 	target_t *target = bank->target;
+	cfi_flash_bank_t *cfi_info = bank->driver_priv;
 	u8 data[CFI_MAX_BUS_WIDTH * 4];
 
-	target->type->read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 4, data);
+	if(cfi_info->x16_as_x8)
+	{
+		u8 i;
+		for(i=0;i<4;i++)
+			target->type->read_memory(target, flash_address(bank, sector, offset+i), bank->bus_width, 1,
+				&data[i*bank->bus_width] );
+	}
+	else
+		target->type->read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 4, data);
 
 	if (bank->target->endianness == TARGET_LITTLE_ENDIAN)
 		return data[0] | data[bank->bus_width] << 8 | data[bank->bus_width * 2] << 16 | data[bank->bus_width * 3] << 24;



From zwelch at mail.berlios.de  Sat May 23 02:51:18 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 23 May 2009 02:51:18 +0200
Subject: [Openocd-svn] r1887 - trunk
Message-ID: <200905230051.n4N0pIeF028598@sheep.berlios.de>

Author: zwelch
Date: 2009-05-23 02:51:13 +0200 (Sat, 23 May 2009)
New Revision: 1887

Modified:
   trunk/Doxyfile
Log:
Change doxygen configuration to show code comments in documentation.

Modified: trunk/Doxyfile
===================================================================
--- trunk/Doxyfile	2009-05-22 17:49:28 UTC (rev 1886)
+++ trunk/Doxyfile	2009-05-23 00:51:13 UTC (rev 1887)
@@ -697,7 +697,7 @@
 # doxygen to hide any special comment blocks from generated source code
 # fragments. Normal C and C++ comments will always remain visible.
 
-STRIP_CODE_COMMENTS    = YES
+STRIP_CODE_COMMENTS    = NO
 
 # If the REFERENCED_BY_RELATION tag is set to YES 
 # then for each documented function all documented



From zwelch at mail.berlios.de  Sat May 23 03:25:42 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 23 May 2009 03:25:42 +0200
Subject: [Openocd-svn] r1888 - trunk/src/xsvf
Message-ID: <200905230125.n4N1PgX7004292@sheep.berlios.de>

Author: zwelch
Date: 2009-05-23 03:25:39 +0200 (Sat, 23 May 2009)
New Revision: 1888

Modified:
   trunk/src/xsvf/xsvf.c
Log:
More printf fixes stemming from format string change in r1882.

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-05-23 00:51:13 UTC (rev 1887)
+++ trunk/src/xsvf/xsvf.c	2009-05-23 01:25:39 UTC (rev 1888)
@@ -1020,9 +1020,10 @@
 
 	if (unsupported)
 	{
+		off_t offset = lseek(xsvf_fd, 0, SEEK_CUR) - 1;
 		command_print(cmd_ctx,
-			 "unsupported xsvf command: 0x%02X in xsvf file at offset %jd, aborting",
-					  uc,  lseek(xsvf_fd, 0, SEEK_CUR)-1 );
+				"unsupported xsvf command (0x%02X) at offset %jd, aborting",
+				uc, (intmax_t)offset);
 		return ERROR_FAIL;
 	}
 



From zwelch at mail.berlios.de  Sat May 23 05:42:18 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 23 May 2009 05:42:18 +0200
Subject: [Openocd-svn] r1889 - trunk/src/jtag
Message-ID: <200905230342.n4N3gIBF022020@sheep.berlios.de>

Author: zwelch
Date: 2009-05-23 05:42:13 +0200 (Sat, 23 May 2009)
New Revision: 1889

Modified:
   trunk/src/jtag/jlink.c
Log:
Submitted by Magnus Lundin <lundin at mlu.mine.nu>:

Updates to the J-Link interface driver to support more device versions:
- Add capability detection:
  - if capable, detect protocol version; otherwise, assume v2 protocol.
  - if capable, detect buffer size; otherwise, assume minimal.
- Disable command result queries for devices using v2 protocol.
- Defined and use JTAG2 command with v2 protocol; JTAG3 is v3 protocol.
- Add TCL command to allow explicit setting of J-Link protocol version.

With approval, I revised the patch to make the following changes:
- add static keywords to new jlink-specific variables
- factor calculation of major_version to be more readable
- remove braces around simple one-line statements in if/else clauses
- remove (rather than #if 0) duplicate reset code; it is in SVN
- use &function to be clearer when passing function pointers
- add symbols for EMU_CMD_GET_CAPS bits; do not hard-code constants!
- almost renamed jlink_handle_jlink_hw_jtag_command  (seriously?!?!)
  - rewrote that function using a switch statement.
  - made version request processing easier to understand and modify
- improve alternate endpoint detection:
  - make code easier to read by using temporary variables
  - eliminate extra level of indentation and redundant logging
- use ternary conditional to select JTAG2 or JTAG3 command
- reverse version test in jlink_usb_message to reduce indentation
  - this had the biggest effect in cleaning up this patch
- use C99's ability to declare new/changed variables with less scope
- add spaces around binary operators in new/changed code
- revert other superfluous whitespace/comment style changes


Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-05-23 01:25:39 UTC (rev 1888)
+++ trunk/src/jtag/jlink.c	2009-05-23 03:42:13 UTC (rev 1889)
@@ -36,6 +36,10 @@
 #define JLINK_WRITE_ENDPOINT	0x02
 #define JLINK_READ_ENDPOINT		0x81
 
+static unsigned int jlink_write_ep = JLINK_WRITE_ENDPOINT;
+static unsigned int jlink_read_ep = JLINK_READ_ENDPOINT;
+static unsigned int jlink_hw_jtag_version = 2;
+
 #define JLINK_USB_TIMEOUT		1000
 
 // See Section 1.3.2 of the Segger JLink USB protocol manual
@@ -60,6 +64,7 @@
 #define EMU_CMD_HW_CLOCK			0xc8
 #define EMU_CMD_HW_TMS0 			0xc9
 #define EMU_CMD_HW_TMS1 			0xca
+#define EMU_CMD_HW_JTAG2    		0xce
 #define EMU_CMD_HW_JTAG3    		0xcf
 #define EMU_CMD_GET_MAX_MEM_BLOCK	0xd4
 #define EMU_CMD_HW_RESET0   		0xdc
@@ -67,7 +72,12 @@
 #define EMU_CMD_HW_TRST0    		0xde
 #define EMU_CMD_HW_TRST1    		0xdf
 #define EMU_CMD_GET_CAPS    		0xe8
+#define EMU_CMD_GET_HW_VERSION  	0xf0
 
+/* bits return from EMU_CMD_GET_CAPS */
+#define EMU_CAP_GET_HW_VERSION 		1
+#define EMU_CAP_GET_MAX_BLOCK_SIZE	11
+
 /* max speed 12MHz v5.0 jlink */
 #define JLINK_MAX_SPEED 12000
 
@@ -82,6 +92,7 @@
 
 /* CLI command handler functions */
 static int jlink_handle_jlink_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int jlink_handle_jlink_hw_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 /* Queue command functions */
 static void jlink_end_state(tap_state_t state);
@@ -208,12 +219,6 @@
 			cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 
 	jlink_tap_execute();
-
-	if ( (cmd->cmd.reset->trst == 1) || ( cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST) ) )
-	{
-		tap_set_state(TAP_RESET);
-	}
-
 	jlink_reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 	jlink_tap_execute();
 }
@@ -301,8 +306,13 @@
 
 static int jlink_register_commands(struct command_context_s *cmd_ctx)
 {
-	register_command(cmd_ctx, NULL, "jlink_info", jlink_handle_jlink_info_command, COMMAND_EXEC,
+
+	register_command(cmd_ctx, NULL, "jlink_info", 
+		&jlink_handle_jlink_info_command, COMMAND_EXEC,
 		"query jlink info");
+	register_command(cmd_ctx, NULL, "jlink_hw_jtag",
+		&jlink_handle_jlink_hw_jtag_command, COMMAND_EXEC,
+		"set/get jlink hw jtag command version [2|3]");
 	return ERROR_OK;
 }
 
@@ -318,6 +328,7 @@
 		return ERROR_JTAG_INIT_FAILED;
 	}
 
+	jlink_hw_jtag_version = 2;
 	check_cnt = 0;
 	while (check_cnt < 3)
 	{
@@ -556,6 +567,12 @@
 	}
 
 	len = buf_get_u32(usb_in_buffer, 0, 16);
+	if (len > JLINK_IN_BUFFER_SIZE)
+	{
+		LOG_ERROR("J-Link command EMU_CMD_VERSION impossible return length 0x%0x", len);
+		len = JLINK_IN_BUFFER_SIZE;
+	}
+	
 	result = jlink_usb_read(jlink_jtag_handle, len);
 	if (result != len)
 	{
@@ -579,21 +596,42 @@
 	jlink_caps = buf_get_u32(usb_in_buffer, 0, 32);
 	LOG_INFO("JLink caps 0x%x", jlink_caps);
 
+	if (jlink_caps & (1 << EMU_CAP_GET_HW_VERSION))
+	{
+		/* query hardware version */
+		jlink_simple_command(EMU_CMD_GET_HW_VERSION);
 
-	/* query hardware maximum memory block */
-	jlink_simple_command(EMU_CMD_GET_MAX_MEM_BLOCK);
+		result = jlink_usb_read(jlink_jtag_handle, 4);
+		if (4 != result)
+		{
+			LOG_ERROR("J-Link command EMU_CMD_GET_HW_VERSION failed (%d)\n", result);
+			return ERROR_JTAG_DEVICE_ERROR;
+		}
 
-	result = jlink_usb_read(jlink_jtag_handle, 4);
-	if (4 != result)
-	{
-		LOG_ERROR("J-Link command EMU_CMD_GET_MAX_MEM_BLOCK failed (%d)\n", result);
-		return ERROR_JTAG_DEVICE_ERROR;
+		u32 jlink_hw_version = buf_get_u32(usb_in_buffer, 0, 32);
+		u32 major_revision = (jlink_hw_version / 10000) % 100;
+		if (major_revision >= 5)
+			jlink_hw_jtag_version = 3;
+
+		LOG_INFO("JLink hw version %i", jlink_hw_version);
 	}
 
-	jlink_max_size = buf_get_u32(usb_in_buffer, 0, 32);
-	LOG_INFO("JLink max mem block %i", jlink_max_size);
+	if (jlink_caps & (1 << EMU_CAP_GET_MAX_BLOCK_SIZE))
+	{
+		/* query hardware maximum memory block */
+		jlink_simple_command(EMU_CMD_GET_MAX_MEM_BLOCK);
 
+		result = jlink_usb_read(jlink_jtag_handle, 4);
+		if (4 != result)
+		{
+			LOG_ERROR("J-Link command EMU_CMD_GET_MAX_MEM_BLOCK failed (%d)\n", result);
+			return ERROR_JTAG_DEVICE_ERROR;
+		}
 
+		jlink_max_size = buf_get_u32(usb_in_buffer, 0, 32);
+		LOG_INFO("JLink max mem block %i", jlink_max_size);
+	}
+
 	return ERROR_OK;
 }
 
@@ -608,6 +646,30 @@
 	return ERROR_OK;
 }
 
+static int jlink_handle_jlink_hw_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	switch (argc) {
+	case 0:
+		command_print(cmd_ctx, "jlink hw jtag  %i", jlink_hw_jtag_version);
+		break;
+	case 1: {
+		int request_version = atoi(args[0]);
+		switch (request_version) {
+		case 2: case 3:
+			jlink_hw_jtag_version = request_version;
+			break;
+		default:
+			return ERROR_COMMAND_SYNTAX_ERROR;
+		}
+		break;
+	}
+	default:
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+
+	return ERROR_OK;
+}
+
 /***************************************************************************/
 /* J-Link tap functions */
 
@@ -721,7 +783,8 @@
 	// number of full bytes (plus one if some would be left over)
 	byte_length = TAP_SCAN_BYTES(tap_length);
 
-	usb_out_buffer[0] = EMU_CMD_HW_JTAG3;
+	bool use_jtag3 = jlink_hw_jtag_version >= 3;
+	usb_out_buffer[0] = use_jtag3 ? EMU_CMD_HW_JTAG3 : EMU_CMD_HW_JTAG2;
 	usb_out_buffer[1] = 0;
 	usb_out_buffer[2] = (tap_length >> 0) & 0xff;
 	usb_out_buffer[3] = (tap_length >> 8) & 0xff;
@@ -814,6 +877,19 @@
 				 */
 				usb_set_altinterface(result->usb_handle, 0);
 #endif
+				struct usb_interface *iface = dev->config->interface;
+				struct usb_interface_descriptor *desc = iface->altsetting;
+				for (int i = 0; i < desc->bNumEndpoints; i++)
+				{
+					u8 epnum = desc->endpoint[i].bEndpointAddress;
+					bool is_input = epnum & 0x80;
+					LOG_DEBUG("usb ep %s %02x", is_input ? "in" : "out", epnum);
+					if (is_input)
+						jlink_read_ep = epnum;
+					else
+						jlink_write_ep = epnum;
+				}
+
 				return result;
 			}
 		}
@@ -833,7 +909,6 @@
 static int jlink_usb_message(jlink_jtag_t *jlink_jtag, int out_length, int in_length)
 {
 	int result;
-	int result2;
 
 	result = jlink_usb_write(jlink_jtag, out_length);
 	if (result != out_length)
@@ -851,6 +926,10 @@
 		return ERROR_JTAG_DEVICE_ERROR;
 	}
 
+	if (jlink_hw_jtag_version < 3)
+		return result;
+
+	int result2 = ERROR_OK;
 	if (result == in_length)
 	{
 		/* Must read the result from the EMU too */
@@ -937,7 +1016,7 @@
 		return -1;
 	}
 
-	result = usb_bulk_write_ex(jlink_jtag->usb_handle, JLINK_WRITE_ENDPOINT,
+	result = usb_bulk_write_ex(jlink_jtag->usb_handle, jlink_write_ep,
 		(char *)usb_out_buffer, out_length, JLINK_USB_TIMEOUT);
 
 	DEBUG_JTAG_IO("jlink_usb_write, out_length = %d, result = %d", out_length, result);
@@ -951,7 +1030,7 @@
 /* Read data from USB into in_buffer. */
 static int jlink_usb_read(jlink_jtag_t *jlink_jtag, int expected_size)
 {
-	int result = usb_bulk_read_ex(jlink_jtag->usb_handle, JLINK_READ_ENDPOINT,
+	int result = usb_bulk_read_ex(jlink_jtag->usb_handle, jlink_read_ep,
 		(char *)usb_in_buffer, expected_size, JLINK_USB_TIMEOUT);
 
 	DEBUG_JTAG_IO("jlink_usb_read, result = %d", result);
@@ -965,7 +1044,7 @@
 /* Read the result from the previous EMU cmd into result_buffer. */
 static int jlink_usb_read_emu_result(jlink_jtag_t *jlink_jtag)
 {
-	int result = usb_bulk_read_ex(jlink_jtag->usb_handle, JLINK_READ_ENDPOINT,
+	int result = usb_bulk_read_ex(jlink_jtag->usb_handle, jlink_read_ep,
 		(char *)usb_emu_result_buffer, 1 /* JLINK_EMU_RESULT_BUFFER_SIZE */,
 		JLINK_USB_TIMEOUT);
 



From mifi at mail.berlios.de  Sat May 23 20:26:19 2009
From: mifi at mail.berlios.de (mifi at mail.berlios.de)
Date: Sat, 23 May 2009 20:26:19 +0200
Subject: [Openocd-svn] r1890 - trunk/src/target/target
Message-ID: <200905231826.n4NIQJGK019314@sheep.berlios.de>

Author: mifi
Date: 2009-05-23 20:26:06 +0200 (Sat, 23 May 2009)
New Revision: 1890

Modified:
   trunk/src/target/target/sam7se512.cfg
   trunk/src/target/target/sam7x256.cfg
Log:
Change the setting for the sam7se512 and sam7x256 
flash driver because of the new at91sam7 version.

Modified: trunk/src/target/target/sam7se512.cfg
===================================================================
--- trunk/src/target/target/sam7se512.cfg	2009-05-23 03:42:13 UTC (rev 1889)
+++ trunk/src/target/target/sam7se512.cfg	2009-05-23 18:26:06 UTC (rev 1890)
@@ -34,5 +34,6 @@
 
 $_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00200000 -work-area-size 0x4000 -work-area-backup 0
 
-flash bank at91sam7 0 0 0 0 0
+#flash bank <driver> <base_addr> <size> <chip_width> <bus_width> <target_number> [<target_name> <banks> <sectors_per_bank> <pages_per_sector> <page_size> <num_nvmbits> <ext_freq_khz>]
+flash bank at91sam7 0 0 0 0 0 0 0 0 0 0 0 0 18432
 

Modified: trunk/src/target/target/sam7x256.cfg
===================================================================
--- trunk/src/target/target/sam7x256.cfg	2009-05-23 03:42:13 UTC (rev 1889)
+++ trunk/src/target/target/sam7x256.cfg	2009-05-23 18:26:06 UTC (rev 1890)
@@ -45,8 +45,8 @@
 
 $_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x00200000 -work-area-size 0x4000 -work-area-backup 0
 
-#flash bank <driver> <base> <size> <chip_width> <bus_width>
-flash bank at91sam7 0 0 0 0 0
+#flash bank <driver> <base_addr> <size> <chip_width> <bus_width> <target_number> [<target_name> <banks> <sectors_per_bank> <pages_per_sector> <page_size> <num_nvmbits> <ext_freq_khz>]
+flash bank at91sam7 0 0 0 0 0 0 0 0 0 0 0 0 18432
 
 # For more information about the configuration files, take a look at:
 # openocd.texi



From zwelch at mail.berlios.de  Sat May 23 22:29:58 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 23 May 2009 22:29:58 +0200
Subject: [Openocd-svn] r1891 - trunk
Message-ID: <200905232029.n4NKTwWM029544@sheep.berlios.de>

Author: zwelch
Date: 2009-05-23 22:29:53 +0200 (Sat, 23 May 2009)
New Revision: 1891

Modified:
   trunk/Makefile.am
Log:
Fix make docs rule to work with out-of-tree builds.

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-05-23 18:26:06 UTC (rev 1890)
+++ trunk/Makefile.am	2009-05-23 20:29:53 UTC (rev 1891)
@@ -16,7 +16,7 @@
 docs: pdf html doxygen
 
 doxygen::
-	doxygen Doxyfile 2>&1 | perl tools/logger.pl > doxygen.log
+	(cd $(srcdir) && doxygen Doxyfile 2>&1 | perl tools/logger.pl ) > doxygen.log
 
 doxygen-clean:
 	rm -f -r doxygen doxygen.log



From zwelch at mail.berlios.de  Sat May 23 22:50:10 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 23 May 2009 22:50:10 +0200
Subject: [Openocd-svn] r1892 - trunk/src/jtag
Message-ID: <200905232050.n4NKoAmg031753@sheep.berlios.de>

Author: zwelch
Date: 2009-05-23 22:50:06 +0200 (Sat, 23 May 2009)
New Revision: 1892

Modified:
   trunk/src/jtag/jtag.c
Log:
Submitted by Magnus Lundin <lundin at mlu.mine.nu>:
- Add jtag_execute_queue in jtag_add_reset after interface_jtag_add_reset.
- Use tap_set_state to demark TAP_RESET, instead of cmd_queue_cur_state
  - cmd_queue_cur_state needs to be retired.


Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-23 20:29:53 UTC (rev 1891)
+++ trunk/src/jtag/jtag.c	2009-05-23 20:50:06 UTC (rev 1892)
@@ -1253,6 +1253,7 @@
 		jtag_error=retval;
 		return;
 	}
+	jtag_execute_queue();
 
 	if (jtag_srst)
 	{
@@ -1280,7 +1281,7 @@
 		 * and inform possible listeners about this
 		 */
 		LOG_DEBUG("TRST line asserted");
-		cmd_queue_cur_state = TAP_RESET;
+		tap_set_state(TAP_RESET);
 		jtag_call_event_callbacks(JTAG_TRST_ASSERTED);
 	}
 	else



From zwelch at mail.berlios.de  Sat May 23 22:52:21 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 23 May 2009 22:52:21 +0200
Subject: [Openocd-svn] r1893 - trunk/src/jtag
Message-ID: <200905232052.n4NKqLAZ032052@sheep.berlios.de>

Author: zwelch
Date: 2009-05-23 22:52:18 +0200 (Sat, 23 May 2009)
New Revision: 1893

Modified:
   trunk/src/jtag/ft2232.c
Log:
Submitted by Magnus Lundin <lundin at mlu.mine.nu>:
- Remove FTDI driver tap_set_state call; performed by jtag_add_reset.


Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-23 20:50:06 UTC (rev 1892)
+++ trunk/src/jtag/ft2232.c	2009-05-23 20:52:18 UTC (rev 1893)
@@ -1629,10 +1629,6 @@
 		first_unsent = cmd;
 	}
 
-	if ( (cmd->cmd.reset->trst == 1) || ( cmd->cmd.reset->srst && (jtag_reset_config & RESET_SRST_PULLS_TRST) ) )
-	{
-		tap_set_state(TAP_RESET);
-	}
 	layout->reset(cmd->cmd.reset->trst, cmd->cmd.reset->srst);
 	require_send = 1;
 



From zwelch at mail.berlios.de  Sun May 24 00:05:09 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 00:05:09 +0200
Subject: [Openocd-svn] r1894 - trunk
Message-ID: <200905232205.n4NM59XG008005@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 00:05:05 +0200 (Sun, 24 May 2009)
New Revision: 1894

Modified:
   trunk/Doxyfile
   trunk/PATCHES
Log:
Include the PATCHES file in Doxygen developer manual.

Modified: trunk/Doxyfile
===================================================================
--- trunk/Doxyfile	2009-05-23 20:52:18 UTC (rev 1893)
+++ trunk/Doxyfile	2009-05-23 22:05:05 UTC (rev 1894)
@@ -567,6 +567,7 @@
 INPUT                  = doc/manual \
                          TODO \
                          BUGS \
+                         PATCHES \
                          src \
                          config.h
 

Modified: trunk/PATCHES
===================================================================
--- trunk/PATCHES	2009-05-23 20:52:18 UTC (rev 1893)
+++ trunk/PATCHES	2009-05-23 22:05:05 UTC (rev 1894)
@@ -1,3 +1,5 @@
+/** @page patchguide OpenOCD Patch Policies
+
 Please mail patches to:
 
 	openocd-development at lists.berlios.de
@@ -43,3 +45,4 @@
 If you have a decent SVN GUI, then that should be
 able to create and apply patches as well...
  
+ */



From zwelch at mail.berlios.de  Sun May 24 00:37:23 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 00:37:23 +0200
Subject: [Openocd-svn] r1895 - trunk/doc
Message-ID: <200905232237.n4NMbNsr016614@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 00:37:19 +0200 (Sun, 24 May 2009)
New Revision: 1895

Modified:
   trunk/doc/openocd.texi
Log:
Update user guide documentation:
- Remove style guide from user guide; moved to doxygen manual.
- Replace with improved introduction for developers and packagers.
- Move introductory paragraph about the project under the About page.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-23 22:05:05 UTC (rev 1894)
+++ trunk/doc/openocd.texi	2009-05-23 22:37:19 UTC (rev 1895)
@@ -89,6 +89,14 @@
 @unnumbered About
 @cindex about
 
+OpenOCD was created by Dominic Rath as part of a diploma thesis written at the
+University of Applied Sciences Augsburg (@uref{http://www.fh-augsburg.de}).
+Since that time, the project has grown into an active open-source project,
+supported by a diverse community of software and hardware developers from
+around the world.
+
+ at section What is OpenOCD?
+
 The Open On-Chip Debugger (OpenOCD) aims to provide debugging,
 in-system programming and boundary-scan testing for embedded target
 devices.
@@ -98,7 +106,7 @@
 
 @b{Dongles:} OpenOCD currently supports many types of hardware dongles: USB
 based, parallel port based, and other standalone boxes that run
-OpenOCD internally. See the section titled: @xref{JTAG Hardware Dongles}.
+OpenOCD internally. @xref{JTAG Hardware Dongles}.
 
 @b{GDB Debug:} It allows ARM7 (ARM7TDMI and ARM720t), ARM9 (ARM920T,
 ARM922T, ARM926EJ--S, ARM966E--S), XScale (PXA25x, IXP42x) and
@@ -111,58 +119,64 @@
 STM32x). Preliminary support for various NAND flash controllers
 (LPC3180, Orion, S3C24xx, more) controller is included.
 
+ at section OpenOCD Web Site
+
+The OpenOCD web site provides the latest public news from the community:
+
+ at uref{http://openocd.berlios.de/web/}
+
+
 @node Developers
- at chapter Developers
+ at chapter OpenOCD Developer Resources
 @cindex developers
 
-OpenOCD was created by Dominic Rath as part of a diploma thesis written at the
-University of Applied Sciences Augsburg (@uref{http://www.fh-augsburg.de}).
-Others interested in improving the state of free and open debug and testing technology
-are welcome to participate.
+If you are interested in improving the state of OpenOCD's debugging and
+testing support, new contributions will be welcome.  Motivated developers
+can produce new target, flash or interface drivers, improve the
+documentation, as well as more conventional bug fixes and enhancements.
 
-Other developers have contributed support for additional targets and flashes as well
-as numerous bugfixes and enhancements. See the AUTHORS file for regular contributors. 
+The resources in this chapter are available for developers wishing to explore
+or expand the OpenOCD source code.
 
-The main OpenOCD web site is available at @uref{http://openocd.berlios.de/web/}.
+ at section OpenOCD Subversion Repository
 
- at section Coding Style
- at cindex Coding Style
+The ``Building From Source'' section (@xref{Building}) provides
+instructions to retrieve and and build the latest version of the OpenOCD
+source code.
 
-The following rules try to describe formatting and naming conventions that should be
-followed to make the whole OpenOCD code look more consistent. The ultimate goal of
-coding style should be readability, and these rules may be ignored for a particular
-(small) piece of code if that makes it more readable.
+Developers that want to contribute patches to the OpenOCD system are
+ at b{strongly} encouraged to base their work off of the most recent trunk
+revision.  Patches created against older versions may require additional
+work from their submitter in order to be updated for newer releases.
 
- at subsection Formatting rules:
- at itemize @bullet
- at item remove any trailing white space
- at item use TAB characters for indentation, not spaces
- at item displayed TAB width is 4 characters
- at item make sure NOT to use DOS '\r\n' line feeds
- at item do not add more than 2 empty lines to source files
- at item do not add trailing empty lines to source files
- at item do not use C++ style comments (//)
- at item lines may be reasonably wide - there's no anachronistic 80 characters limit
- at end itemize
+ at section Doxygen Developer Manual
 
- at subsection Naming rules:
- at itemize @bullet
- at item identifiers use lower-case letters only
- at item identifiers consisting of multiple words use underline characters between consecutive words
- at item macros use upper-case letters only
- at item structure names shall be appended with '_s'
- at item typedefs shall be appended with '_t'
- at end itemize
+During the development of the 0.2.0 release, the OpenOCD project began
+providing a Doxygen reference manual.  This document contains more
+technical information about the software internals, development
+processes, and similar documentation:
 
- at subsection Function calls:
- at itemize @bullet
- at item function calls have no space between the functions name and the parameter
-list: my_func(param1, param2, ...)
- at end itemize
+ at uref{http://openocd.berlios.de/doc/doxygen/index.html}
 
+This document is a work-in-progress, but contributions would be welcome
+to fill in the gaps.  All of the source files are provided in-tree,
+listed in the Doxyfile configuration in the top of the repository trunk.
+
+ at section OpenOCD Developer Mailing List
+
+The OpenOCD Developer Mailing List provides the primary means of
+communication between developers:
+
+	@uref{https://lists.berlios.de/mailman/listinfo/openocd-development}
+
+All drivers developers are enouraged to also subscribe to the list of
+SVN commits to keep pace with the ongoing changes:
+
+	@uref{https://lists.berlios.de/mailman/listinfo/openocd-svn}
+
 @node Building
- at chapter Building
- at cindex building OpenOCD
+ at chapter Building OpenOCD
+ at cindex building
 
 @section Pre-Built Tools
 If you are interested in getting actual work done rather than building
@@ -181,10 +195,16 @@
 @item @b{Build packages} i.e.: RPM files, or DEB files for a Linux Distro
 @end enumerate
 
-As a @b{PACKAGER} - you are at the top of the food chain. You solve
-problems for downstream users. What you fix or solve - solves hundreds
-if not thousands of user questions. If something does not work for you
-please let us know. That said, would also like you to follow a few
+As a @b{PACKAGER}, you will experience first reports of most issues.
+When you fix those problems for your users, your solution may help
+prevent hundreds (if not thousands) of other questions from other users.
+
+If something does not work for you, please work to inform the OpenOCD
+developers know how to improve the system or documentation to avoid
+future problems, and follow-up to help us ensure the issue will be fully
+resolved in our future releases.
+
+That said, the OpenOCD developers would also like you to follow a few
 suggestions:
 
 @enumerate



From zwelch at mail.berlios.de  Sun May 24 00:39:09 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 00:39:09 +0200
Subject: [Openocd-svn] r1896 - trunk/doc/manual
Message-ID: <200905232239.n4NMd9Gg017372@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 00:39:03 +0200 (Sun, 24 May 2009)
New Revision: 1896

Added:
   trunk/doc/manual/style.txt
Log:
Add extended doxygen-based style guide draft; requires more work.

Added: trunk/doc/manual/style.txt
===================================================================
--- trunk/doc/manual/style.txt	2009-05-23 22:37:19 UTC (rev 1895)
+++ trunk/doc/manual/style.txt	2009-05-23 22:39:03 UTC (rev 1896)
@@ -0,0 +1,93 @@
+/** @page styleguide OpenOCD Coding C Style Guide
+
+The following rules describe a formatting, naming, and other conventions
+that should be followed when writing or changing the OpenOCD C code.
+Many of the general rules should apply to OpenOCD's Jim/TCL code as well.
+
+The goals of this guide are:
+- to produce code that appears clean, consistent, and readable,
+- to allow developers to create patches that conform to a standard,
+- to eliminate these issues as points of future contention.
+consistent.
+
+Some of these rules may be ignored in the spirit of these stated goals;
+however, such exceptions should be fairly rare.
+
+ at section styleformat Formatting Rules
+
+- remove any trailing white space at the end of lines.
+- use TAB characters for indentation; do NOT use spaces.
+- displayed TAB width is 4 characters.
+- use Unix line endings ('\\n'); do NOT use DOS endings ('\\r\\n')
+- limit adjacent empty lines to at most two (2).
+- remove any trailing empty lines at the end of source files
+- do not "comment out" code from the tree; instead, one should either:
+  -# remove it entirely (Subversion can retrieve the old version), or
+  -# use an @c #if/#endif block.
+
+Finally, try to avoid lines of code that are longer than than 72-80 columns:
+
+- long lines frequently indicate other style problems:
+  - insufficient use of static functions, macros, or temporary variables
+  - poor flow-control structure; "inverted" logical tests
+- a few lines may be wider than this limit (typically format strings), but:
+  - all C compilers will concatenate series of string constants.
+  - all long string constants should be split across multiple lines.
+
+ at section stylenames Naming Rules
+
+- most identifiers must use lower-case letters (and digits) only.
+  - macros must use upper-case letters (and digits) only.
+  - OpenOCD identifiers should NEVER use @c MixedCaps.
+- structure names must end with the '_s' suffix.
+- typedef names must end with the '_t' suffix.
+- use underline characters between consecutive words in identifiers
+  (e.g. @c more_than_one_word).
+
+ at section stylec99 C99 Rules
+
+- inline functions
+- @c // comments -- in new code, prefer these for single-line comments
+- trailing comma allowed in enum declarations
+- designated initializers (@{ .field = value @})
+- variables declarations may be mixed with code
+- new block scopes for selection and iteration statements
+
+ at section stylefunc Functions
+
+- static inline functions should be prefered over macros:
+ at code
+/** do NOT define macro-like functions like this... */
+#define CUBE(x) ((x) * (x) * (x))
+/** instead, define the same expression using a C99 inline function */
+static inline int cube(int x) { return x * x * x; }
+ at endcode
+- Functions should be declared static unless required by other modules
+  - define static functions before first usage to avoid forward declarations.
+- Functions should have no space between its name and its parameter list:
+ at code
+int f(int x1, int x2)
+{
+	...
+	int y = f(x1, x2 - x1);
+	...
+}
+ at endcode
+
+ at section styledoxygen Doxygen Rules
+
+- use @c /// to for one-line documentation
+- for multiple lines, use a "block" style with one space
+ at verbatim
+/**
+ * @brief Short description.
+ * Full description here.
+ * @param foo Describe foo.
+ */
+ at endverbatim
+- if the total line length will be less than 72 columns, then
+  - The @c /**< form can be used on the same line.
+  - This style should be used sparingly; the best use is for fields:
+    - @code int field /**< field description */ @endcode
+
+ */


Property changes on: trunk/doc/manual/style.txt
___________________________________________________________________
Name: svn:eol-style
   + native



From zwelch at mail.berlios.de  Sun May 24 00:52:53 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 00:52:53 +0200
Subject: [Openocd-svn] r1897 - trunk/doc/manual
Message-ID: <200905232252.n4NMqrFj029441@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 00:52:47 +0200 (Sun, 24 May 2009)
New Revision: 1897

Modified:
   trunk/doc/manual/main.txt
Log:
Update main page of doxygen developer documentation:
- Rewrite copy to give a better introduction and overview.
- Add subpages: The List, Style Guide, Patch Policies, and Bug Reporting.


Modified: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-05-23 22:39:03 UTC (rev 1896)
+++ trunk/doc/manual/main.txt	2009-05-23 22:52:47 UTC (rev 1897)
@@ -1,15 +1,32 @@
 /** @mainpage OpenOCD Reference Manual
 
- at ref oocd explains how the code has been organized into layers
-of APIs and gives an overview of how they fit together.  These pages
-attempt to give developers a high-level perspective of the various
-code modules provided by OpenOCD.
- 
- at ref primer provide introductory materials for new developers.
+Welcome to the OpenOCD Reference Manual -- the developer's resource for
+learning about the internal architecture of the OpenOCD project.
 
-The List of @ref thelist enumerates opportunities for improving or
-extending the OpenOCD platform.
+In addition, this document contains the tactical and strategic plans
+and processes that have been devleoped by and for the community.
 
+Developers that want to contribute to OpenOCD should read the following
+sections before starting work:
+
+- The List of @subpage thelist enumerates opportunities for improving or
+extending the OpenOCD platform.  If your ideas are on The List, you might
+check the mailing list archives to find the status of your feature (or bug).
+- The @subpage styleguide provides rules that developers should
+  follow when writing new code for OpenOCD.
+- The @subpage patchguide provides policies that developers should
+  follow when submitting patches to the project.
+- The @subpage bugs page contains the content of the BUGS file, which
+  provides instructions for submitting bug reports to the maintainers.
+
+ at ref primer provide introductory materials for new developers on various
+specific topics.
+
+Finally, the @ref oocd pages explain how the code has been organized
+into layers of APIs, providing an overview of how they fit together.
+These pages attempt to give developers a high-level perspective of the
+various code modules provided by OpenOCD.
+
  */
 
 /** @page primer OpenOCD Technical Primers



From zwelch at mail.berlios.de  Sun May 24 00:53:46 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 00:53:46 +0200
Subject: [Openocd-svn] r1898 - trunk/doc/manual
Message-ID: <200905232253.n4NMrk6x030644@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 00:53:39 +0200 (Sun, 24 May 2009)
New Revision: 1898

Modified:
   trunk/doc/manual/scripting.txt
Log:
Add section identifiers to developer scripting introduction.

Modified: trunk/doc/manual/scripting.txt
===================================================================
--- trunk/doc/manual/scripting.txt	2009-05-23 22:52:47 UTC (rev 1897)
+++ trunk/doc/manual/scripting.txt	2009-05-23 22:53:39 UTC (rev 1898)
@@ -1,6 +1,6 @@
 /** @page scripting OpenOCD Scripting Overview
 
- at section What scripting will not do
+ at section scriptingisnt What scripting will not do
 
 The scripting support is intended for developers of OpenOCD.
 It is not the intention that normal OpenOCD users will
@@ -18,7 +18,7 @@
 great in an embedded environment and ?yvind Harboe
 had experience with it.
 
- at section Uses of scripting
+ at section scriptinguses Uses of scripting
 
 Default implementation of procedures in tcl/procedures.tcl.
 
@@ -52,7 +52,7 @@
   be simpler.
   
   
- at section External scripting
+ at section scriptingexternal External scripting
 
 The embedded Jim Tcl interpreter in OpenOCD is very limited
 compared to any full scale PC hosted scripting language.



From zwelch at mail.berlios.de  Sun May 24 02:16:11 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 02:16:11 +0200
Subject: [Openocd-svn] r1899 - trunk/src/target/target
Message-ID: <200905240016.n4O0GBfZ000058@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 02:16:04 +0200 (Sun, 24 May 2009)
New Revision: 1899

Modified:
   trunk/src/target/target/lpc2103.cfg
   trunk/src/target/target/lpc2124.cfg
   trunk/src/target/target/lpc2129.cfg
Log:
Freddie Chopin <freddie_chopin at op.pl>:
- add reset delay settings for LPC2103, LPC2124, and LPC2129.


Modified: trunk/src/target/target/lpc2103.cfg
===================================================================
--- trunk/src/target/target/lpc2103.cfg	2009-05-23 22:53:39 UTC (rev 1898)
+++ trunk/src/target/target/lpc2103.cfg	2009-05-24 00:16:04 UTC (rev 1899)
@@ -21,6 +21,10 @@
 # LPC2000 -> SRST causes TRST
 reset_config trst_and_srst srst_pulls_trst
 
+# reset delays
+jtag_nsrst_delay 100
+jtag_ntrst_delay 100
+
 jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]

Modified: trunk/src/target/target/lpc2124.cfg
===================================================================
--- trunk/src/target/target/lpc2124.cfg	2009-05-23 22:53:39 UTC (rev 1898)
+++ trunk/src/target/target/lpc2124.cfg	2009-05-24 00:16:04 UTC (rev 1899)
@@ -22,7 +22,11 @@
 
 #use combined on interfaces or targets that can't set TRST/SRST separately
 reset_config trst_and_srst srst_pulls_trst
-jtag_nsrst_delay 10
+
+# reset delays
+jtag_nsrst_delay 100
+jtag_ntrst_delay 100
+
 jtag_khz 1000
 
 #jtag scan chain

Modified: trunk/src/target/target/lpc2129.cfg
===================================================================
--- trunk/src/target/target/lpc2129.cfg	2009-05-23 22:53:39 UTC (rev 1898)
+++ trunk/src/target/target/lpc2129.cfg	2009-05-24 00:16:04 UTC (rev 1899)
@@ -23,6 +23,11 @@
 
 #use combined on interfaces or targets that can't set TRST/SRST separately
 reset_config trst_and_srst srst_pulls_trst
+
+# reset delays
+jtag_nsrst_delay 100
+jtag_ntrst_delay 100
+
 #jtag scan chain
 jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
 



From zwelch at mail.berlios.de  Sun May 24 02:47:53 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 02:47:53 +0200
Subject: [Openocd-svn] r1900 - trunk/src/svf
Message-ID: <200905240047.n4O0lr4E003892@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 02:47:49 +0200 (Sun, 24 May 2009)
New Revision: 1900

Modified:
   trunk/src/svf/svf.c
Log:
SimonQian <simonqian at SimonQian.com>:
Changes svf_check_tdo function (checks tdo output matches desired values):
- call buf_cmp_mask function to do comparison instead of using a loop.
- fixes a bug when data length is equal to sizeof(int).


Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-24 00:16:04 UTC (rev 1899)
+++ trunk/src/svf/svf.c	2009-05-24 00:47:49 UTC (rev 1900)
@@ -628,32 +628,35 @@
 
 static int svf_check_tdo(void)
 {
-	int i, j, byte_len, index;
+	int i, len, index;
 
 	for (i = 0; i < svf_check_tdo_para_index; i++)
 	{
-		if (svf_check_tdo_para[i].enabled)
+		index = svf_check_tdo_para[i].buffer_offset;
+		len = svf_check_tdo_para[i].bit_len;
+		if ((svf_check_tdo_para[i].enabled) 
+			&& buf_cmp_mask(&svf_tdi_buffer[index], &svf_tdo_buffer[index], &svf_mask_buffer[index], len))
 		{
-			byte_len = (svf_check_tdo_para[i].bit_len + 7) >> 3;
-			index = svf_check_tdo_para[i].buffer_offset;
-			for (j = 0; j < byte_len; j++)
+			unsigned bitmask;
+			unsigned received, expected, tapmask;
+			if (svf_check_tdo_para[i].bit_len >= 32)
 			{
-				if ((svf_tdi_buffer[index + j] & svf_mask_buffer[index + j]) != svf_tdo_buffer[index + j])
-				{
-					unsigned bitmask = (1 << svf_check_tdo_para[i].bit_len) - 1;
-					unsigned received, expected, tapmask;
-					memcpy(&received, svf_tdi_buffer + index, sizeof(unsigned));
-					memcpy(&expected, svf_tdo_buffer + index, sizeof(unsigned));
-					memcpy(&tapmask, svf_mask_buffer + index, sizeof(unsigned));
-					LOG_ERROR("tdo check error at line %d, "
-						"read = 0x%X, want = 0x%X, mask = 0x%X",
-								svf_check_tdo_para[i].line_num,
-								received & bitmask,
-								expected & bitmask,
-								tapmask & bitmask);
-					return ERROR_FAIL;
-				}
+				bitmask = 0xFFFFFFFF;
 			}
+			else
+			{
+				bitmask = (1 << svf_check_tdo_para[i].bit_len) - 1;
+			}
+			memcpy(&received, svf_tdi_buffer + index, sizeof(unsigned));
+			memcpy(&expected, svf_tdo_buffer + index, sizeof(unsigned));
+			memcpy(&tapmask, svf_mask_buffer + index, sizeof(unsigned));
+			LOG_ERROR("tdo check error at line %d", 
+					  svf_check_tdo_para[i].line_num);
+			LOG_ERROR("read = 0x%X, want = 0x%X, mask = 0x%X", 
+					  received & bitmask, 
+					  expected & bitmask, 
+					  tapmask & bitmask);
+			return ERROR_FAIL;
 		}
 	}
 	svf_check_tdo_para_index = 0;



From zwelch at mail.berlios.de  Sun May 24 03:08:23 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 03:08:23 +0200
Subject: [Openocd-svn] r1901 - trunk
Message-ID: <200905240108.n4O18NHP006062@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 03:08:16 +0200 (Sun, 24 May 2009)
New Revision: 1901

Added:
   trunk/Doxyfile.in
Removed:
   trunk/Doxyfile
Modified:
   trunk/Makefile.am
Log:
Properly fix doxygen out-of-tree build process:
- move Doxyfile to Doxyfile.in: type 'make Doxyfile' to recreate it
- create Doxyfile from Doxyfile.in with make rule:
  - use sed substitution of $(srcdir) to location directories
- delete all doxygen created files with 'make distclean'
- include all required files (including logger.pl) in distribution


Deleted: trunk/Doxyfile
===================================================================
--- trunk/Doxyfile	2009-05-24 00:47:49 UTC (rev 1900)
+++ trunk/Doxyfile	2009-05-24 01:08:16 UTC (rev 1901)
@@ -1,1517 +0,0 @@
-# Doxyfile 1.5.8
-
-# This file describes the settings to be used by the documentation system
-# doxygen (www.doxygen.org) for a project
-#
-# All text after a hash (#) is considered a comment and will be ignored
-# The format is:
-#       TAG = value [value, ...]
-# For lists items can also be appended using:
-#       TAG += value [value, ...]
-# Values that contain spaces should be placed between quotes (" ")
-
-#---------------------------------------------------------------------------
-# Project related configuration options
-#---------------------------------------------------------------------------
-
-# This tag specifies the encoding used for all characters in the config file
-# that follow. The default is UTF-8 which is also the encoding used for all
-# text before the first occurrence of this tag. Doxygen uses libiconv (or the
-# iconv built into libc) for the transcoding. See
-# http://www.gnu.org/software/libiconv for the list of possible encodings.
-
-DOXYFILE_ENCODING      = UTF-8
-
-# The PROJECT_NAME tag is a single word (or a sequence of words surrounded
-# by quotes) that should identify the project.
-
-PROJECT_NAME           = OpenOCD
-
-# The PROJECT_NUMBER tag can be used to enter a project or revision number.
-# This could be handy for archiving the generated documentation or
-# if some version control system is used.
-
-PROJECT_NUMBER         =
-
-# The OUTPUT_DIRECTORY tag is used to specify the (relative or absolute)
-# base path where the generated documentation will be put.
-# If a relative path is entered, it will be relative to the location
-# where doxygen was started. If left blank the current directory will be used.
-
-OUTPUT_DIRECTORY       =
-
-# If the CREATE_SUBDIRS tag is set to YES, then doxygen will create
-# 4096 sub-directories (in 2 levels) under the output directory of each output
-# format and will distribute the generated files over these directories.
-# Enabling this option can be useful when feeding doxygen a huge amount of
-# source files, where putting all generated files in the same directory would
-# otherwise cause performance problems for the file system.
-
-CREATE_SUBDIRS         = NO
-
-# The OUTPUT_LANGUAGE tag is used to specify the language in which all
-# documentation generated by doxygen is written. Doxygen will use this
-# information to generate all constant output in the proper language.
-# The default language is English, other supported languages are:
-# Afrikaans, Arabic, Brazilian, Catalan, Chinese, Chinese-Traditional,
-# Croatian, Czech, Danish, Dutch, Farsi, Finnish, French, German, Greek,
-# Hungarian, Italian, Japanese, Japanese-en (Japanese with English messages),
-# Korean, Korean-en, Lithuanian, Norwegian, Macedonian, Persian, Polish,
-# Portuguese, Romanian, Russian, Serbian, Serbian-Cyrilic, Slovak, Slovene, 
-# Spanish, Swedish, and Ukrainian.
-
-OUTPUT_LANGUAGE        = English
-
-# If the BRIEF_MEMBER_DESC tag is set to YES (the default) Doxygen will
-# include brief member descriptions after the members that are listed in
-# the file and class documentation (similar to JavaDoc).
-# Set to NO to disable this.
-
-BRIEF_MEMBER_DESC      = YES
-
-# If the REPEAT_BRIEF tag is set to YES (the default) Doxygen will prepend
-# the brief description of a member or function before the detailed description.
-# Note: if both HIDE_UNDOC_MEMBERS and BRIEF_MEMBER_DESC are set to NO, the
-# brief descriptions will be completely suppressed.
-
-REPEAT_BRIEF           = YES
-
-# This tag implements a quasi-intelligent brief description abbreviator
-# that is used to form the text in various listings. Each string
-# in this list, if found as the leading text of the brief description, will be
-# stripped from the text and the result after processing the whole list, is
-# used as the annotated text. Otherwise, the brief description is used as-is.
-# If left blank, the following values are used ("$name" is automatically
-# replaced with the name of the entity): "The $name class" "The $name widget"
-# "The $name file" "is" "provides" "specifies" "contains"
-# "represents" "a" "an" "the"
-
-ABBREVIATE_BRIEF       =
-
-# If the ALWAYS_DETAILED_SEC and REPEAT_BRIEF tags are both set to YES then
-# Doxygen will generate a detailed section even if there is only a brief
-# description.
-
-ALWAYS_DETAILED_SEC    = NO
-
-# If the INLINE_INHERITED_MEMB tag is set to YES, doxygen will show all
-# inherited members of a class in the documentation of that class as if those
-# members were ordinary class members. Constructors, destructors and assignment
-# operators of the base classes will not be shown.
-
-INLINE_INHERITED_MEMB  = YES
-
-# If the FULL_PATH_NAMES tag is set to YES then Doxygen will prepend the full
-# path before files name in the file list and in the header files. If set
-# to NO the shortest path that makes the file name unique will be used.
-
-FULL_PATH_NAMES        = NO
-
-# If the FULL_PATH_NAMES tag is set to YES then the STRIP_FROM_PATH tag
-# can be used to strip a user-defined part of the path. Stripping is
-# only done if one of the specified strings matches the left-hand part of
-# the path. The tag can be used to show relative paths in the file list.
-# If left blank the directory from which doxygen is run is used as the
-# path to strip.
-
-STRIP_FROM_PATH        =
-
-# The STRIP_FROM_INC_PATH tag can be used to strip a user-defined part of
-# the path mentioned in the documentation of a class, which tells
-# the reader which header file to include in order to use a class.
-# If left blank only the name of the header file containing the class
-# definition is used. Otherwise one should specify the include paths that
-# are normally passed to the compiler using the -I flag.
-
-STRIP_FROM_INC_PATH    =
-
-# If the SHORT_NAMES tag is set to YES, doxygen will generate much shorter
-# (but less readable) file names. This can be useful is your file systems
-# doesn't support long names like on DOS, Mac, or CD-ROM.
-
-SHORT_NAMES            = NO
-
-# If the JAVADOC_AUTOBRIEF tag is set to YES then Doxygen
-# will interpret the first line (until the first dot) of a JavaDoc-style
-# comment as the brief description. If set to NO, the JavaDoc
-# comments will behave just like regular Qt-style comments
-# (thus requiring an explicit @brief command for a brief description.)
-
-JAVADOC_AUTOBRIEF      = YES
-
-# If the QT_AUTOBRIEF tag is set to YES then Doxygen will
-# interpret the first line (until the first dot) of a Qt-style
-# comment as the brief description. If set to NO, the comments
-# will behave just like regular Qt-style comments (thus requiring
-# an explicit \brief command for a brief description.)
-
-QT_AUTOBRIEF           = NO
-
-# The MULTILINE_CPP_IS_BRIEF tag can be set to YES to make Doxygen
-# treat a multi-line C++ special comment block (i.e. a block of //! or ///
-# comments) as a brief description. This used to be the default behaviour.
-# The new default is to treat a multi-line C++ comment block as a detailed
-# description. Set this tag to YES if you prefer the old behaviour instead.
-
-MULTILINE_CPP_IS_BRIEF = NO
-
-# If the INHERIT_DOCS tag is set to YES (the default) then an undocumented
-# member inherits the documentation from any documented member that it
-# re-implements.
-
-INHERIT_DOCS           = YES
-
-# If the SEPARATE_MEMBER_PAGES tag is set to YES, then doxygen will produce
-# a new page for each member. If set to NO, the documentation of a member will
-# be part of the file/class/namespace that contains it.
-
-SEPARATE_MEMBER_PAGES  = NO
-
-# The TAB_SIZE tag can be used to set the number of spaces in a tab.
-# Doxygen uses this value to replace tabs by spaces in code fragments.
-
-TAB_SIZE               = 4
-
-# This tag can be used to specify a number of aliases that acts
-# as commands in the documentation. An alias has the form "name=value".
-# For example adding "sideeffect=\par Side Effects:\n" will allow you to
-# put the command \sideeffect (or @sideeffect) in the documentation, which
-# will result in a user-defined paragraph with heading "Side Effects:".
-# You can put \n's in the value part of an alias to insert newlines.
-
-ALIASES                =
-
-# Set the OPTIMIZE_OUTPUT_FOR_C tag to YES if your project consists of C
-# sources only. Doxygen will then generate output that is more tailored for C.
-# For instance, some of the names that are used will be different. The list
-# of all members will be omitted, etc.
-
-OPTIMIZE_OUTPUT_FOR_C  = YES
-
-# Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java
-# sources only. Doxygen will then generate output that is more tailored for
-# Java. For instance, namespaces will be presented as packages, qualified
-# scopes will look different, etc.
-
-OPTIMIZE_OUTPUT_JAVA   = NO
-
-# Set the OPTIMIZE_FOR_FORTRAN tag to YES if your project consists of Fortran
-# sources only. Doxygen will then generate output that is more tailored for
-# Fortran.
-
-OPTIMIZE_FOR_FORTRAN   = NO
-
-# Set the OPTIMIZE_OUTPUT_VHDL tag to YES if your project consists of VHDL
-# sources. Doxygen will then generate output that is tailored for
-# VHDL.
-
-OPTIMIZE_OUTPUT_VHDL   = NO
-
-# Doxygen selects the parser to use depending on the extension of the files it parses. 
-# With this tag you can assign which parser to use for a given extension. 
-# Doxygen has a built-in mapping, but you can override or extend it using this tag. 
-# The format is ext=language, where ext is a file extension, and language is one of 
-# the parsers supported by doxygen: IDL, Java, Javascript, C#, C, C++, D, PHP, 
-# Objective-C, Python, Fortran, VHDL, C, C++. For instance to make doxygen treat 
-# .inc files as Fortran files (default is PHP), and .f files as C (default is Fortran), 
-# use: inc=Fortran f=C
-
-EXTENSION_MAPPING      = 
-
-# If you use STL classes (i.e. std::string, std::vector, etc.) but do not want
-# to include (a tag file for) the STL sources as input, then you should
-# set this tag to YES in order to let doxygen match functions declarations and
-# definitions whose arguments contain STL classes (e.g. func(std::string); v.s.
-# func(std::string) {}). This also make the inheritance and collaboration
-# diagrams that involve STL classes more complete and accurate.
-
-BUILTIN_STL_SUPPORT    = NO
-
-# If you use Microsoft's C++/CLI language, you should set this option to YES to
-# enable parsing support.
-
-CPP_CLI_SUPPORT        = NO
-
-# Set the SIP_SUPPORT tag to YES if your project consists of sip sources only.
-# Doxygen will parse them like normal C++ but will assume all classes use public
-# instead of private inheritance when no explicit protection keyword is present.
-
-SIP_SUPPORT            = NO
-
-# For Microsoft's IDL there are propget and propput attributes to indicate getter 
-# and setter methods for a property. Setting this option to YES (the default) 
-# will make doxygen to replace the get and set methods by a property in the 
-# documentation. This will only work if the methods are indeed getting or 
-# setting a simple type. If this is not the case, or you want to show the 
-# methods anyway, you should set this option to NO.
-
-IDL_PROPERTY_SUPPORT   = NO
-
-# If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC
-# tag is set to YES, then doxygen will reuse the documentation of the first
-# member in the group (if any) for the other members of the group. By default
-# all members of a group must be documented explicitly.
-
-DISTRIBUTE_GROUP_DOC   = NO
-
-# Set the SUBGROUPING tag to YES (the default) to allow class member groups of
-# the same type (for instance a group of public functions) to be put as a
-# subgroup of that type (e.g. under the Public Functions section). Set it to
-# NO to prevent subgrouping. Alternatively, this can be done per class using
-# the \nosubgrouping command.
-
-SUBGROUPING            = YES
-
-# When TYPEDEF_HIDES_STRUCT is enabled, a typedef of a struct, union, or enum
-# is documented as struct, union, or enum with the name of the typedef. So
-# typedef struct TypeS {} TypeT, will appear in the documentation as a struct
-# with name TypeT. When disabled the typedef will appear as a member of a file,
-# namespace, or class. And the struct will be named TypeS. This can typically
-# be useful for C code in case the coding convention dictates that all compound
-# types are typedef'ed and only the typedef is referenced, never the tag name.
-
-TYPEDEF_HIDES_STRUCT   = NO
-
-# The SYMBOL_CACHE_SIZE determines the size of the internal cache use to 
-# determine which symbols to keep in memory and which to flush to disk. 
-# When the cache is full, less often used symbols will be written to disk. 
-# For small to medium size projects (<1000 input files) the default value is 
-# probably good enough. For larger projects a too small cache size can cause 
-# doxygen to be busy swapping symbols to and from disk most of the time 
-# causing a significant performance penality. 
-# If the system has enough physical memory increasing the cache will improve the 
-# performance by keeping more symbols in memory. Note that the value works on 
-# a logarithmic scale so increasing the size by one will rougly double the 
-# memory usage. The cache size is given by this formula: 
-# 2^(16+SYMBOL_CACHE_SIZE). The valid range is 0..9, the default is 0, 
-# corresponding to a cache size of 2^16 = 65536 symbols
-
-SYMBOL_CACHE_SIZE      = 0
-
-#---------------------------------------------------------------------------
-# Build related configuration options
-#---------------------------------------------------------------------------
-
-# If the EXTRACT_ALL tag is set to YES doxygen will assume all entities in
-# documentation are documented, even if no documentation was available.
-# Private class members and static file members will be hidden unless
-# the EXTRACT_PRIVATE and EXTRACT_STATIC tags are set to YES
-
-EXTRACT_ALL            = YES
-
-# If the EXTRACT_PRIVATE tag is set to YES all private members of a class
-# will be included in the documentation.
-
-EXTRACT_PRIVATE        = NO
-
-# If the EXTRACT_STATIC tag is set to YES all static members of a file
-# will be included in the documentation.
-
-EXTRACT_STATIC         = YES
-
-# If the EXTRACT_LOCAL_CLASSES tag is set to YES classes (and structs)
-# defined locally in source files will be included in the documentation.
-# If set to NO only classes defined in header files are included.
-
-EXTRACT_LOCAL_CLASSES  = YES
-
-# This flag is only useful for Objective-C code. When set to YES local
-# methods, which are defined in the implementation section but not in
-# the interface are included in the documentation.
-# If set to NO (the default) only methods in the interface are included.
-
-EXTRACT_LOCAL_METHODS  = NO
-
-# If this flag is set to YES, the members of anonymous namespaces will be
-# extracted and appear in the documentation as a namespace called
-# 'anonymous_namespace{file}', where file will be replaced with the base
-# name of the file that contains the anonymous namespace. By default
-# anonymous namespace are hidden.
-
-EXTRACT_ANON_NSPACES   = NO
-
-# If the HIDE_UNDOC_MEMBERS tag is set to YES, Doxygen will hide all
-# undocumented members of documented classes, files or namespaces.
-# If set to NO (the default) these members will be included in the
-# various overviews, but no documentation section is generated.
-# This option has no effect if EXTRACT_ALL is enabled.
-
-HIDE_UNDOC_MEMBERS     = NO
-
-# If the HIDE_UNDOC_CLASSES tag is set to YES, Doxygen will hide all
-# undocumented classes that are normally visible in the class hierarchy.
-# If set to NO (the default) these classes will be included in the various
-# overviews. This option has no effect if EXTRACT_ALL is enabled.
-
-HIDE_UNDOC_CLASSES     = NO
-
-# If the HIDE_FRIEND_COMPOUNDS tag is set to YES, Doxygen will hide all
-# friend (class|struct|union) declarations.
-# If set to NO (the default) these declarations will be included in the
-# documentation.
-
-HIDE_FRIEND_COMPOUNDS  = NO
-
-# If the HIDE_IN_BODY_DOCS tag is set to YES, Doxygen will hide any
-# documentation blocks found inside the body of a function.
-# If set to NO (the default) these blocks will be appended to the
-# function's detailed documentation block.
-
-HIDE_IN_BODY_DOCS      = NO
-
-# The INTERNAL_DOCS tag determines if documentation
-# that is typed after a \internal command is included. If the tag is set
-# to NO (the default) then the documentation will be excluded.
-# Set it to YES to include the internal documentation.
-
-INTERNAL_DOCS          = NO
-
-# If the CASE_SENSE_NAMES tag is set to NO then Doxygen will only generate
-# file names in lower-case letters. If set to YES upper-case letters are also
-# allowed. This is useful if you have classes or files whose names only differ
-# in case and if your file system supports case sensitive file names. Windows
-# and Mac users are advised to set this option to NO.
-
-CASE_SENSE_NAMES       = YES
-
-# If the HIDE_SCOPE_NAMES tag is set to NO (the default) then Doxygen
-# will show members with their full class and namespace scopes in the
-# documentation. If set to YES the scope will be hidden.
-
-HIDE_SCOPE_NAMES       = NO
-
-# If the SHOW_INCLUDE_FILES tag is set to YES (the default) then Doxygen
-# will put a list of the files that are included by a file in the documentation
-# of that file.
-
-SHOW_INCLUDE_FILES     = YES
-
-# If the INLINE_INFO tag is set to YES (the default) then a tag [inline]
-# is inserted in the documentation for inline members.
-
-INLINE_INFO            = YES
-
-# If the SORT_MEMBER_DOCS tag is set to YES (the default) then doxygen
-# will sort the (detailed) documentation of file and class members
-# alphabetically by member name. If set to NO the members will appear in
-# declaration order.
-
-SORT_MEMBER_DOCS       = YES
-
-# If the SORT_BRIEF_DOCS tag is set to YES then doxygen will sort the
-# brief documentation of file, namespace and class members alphabetically
-# by member name. If set to NO (the default) the members will appear in
-# declaration order.
-
-SORT_BRIEF_DOCS        = NO
-
-# If the SORT_GROUP_NAMES tag is set to YES then doxygen will sort the
-# hierarchy of group names into alphabetical order. If set to NO (the default)
-# the group names will appear in their defined order.
-
-SORT_GROUP_NAMES       = NO
-
-# If the SORT_BY_SCOPE_NAME tag is set to YES, the class list will be
-# sorted by fully-qualified names, including namespaces. If set to
-# NO (the default), the class list will be sorted only by class name,
-# not including the namespace part.
-# Note: This option is not very useful if HIDE_SCOPE_NAMES is set to YES.
-# Note: This option applies only to the class list, not to the
-# alphabetical list.
-
-SORT_BY_SCOPE_NAME     = NO
-
-# The GENERATE_TODOLIST tag can be used to enable (YES) or
-# disable (NO) the todo list. This list is created by putting \todo
-# commands in the documentation.
-
-GENERATE_TODOLIST      = YES
-
-# The GENERATE_TESTLIST tag can be used to enable (YES) or
-# disable (NO) the test list. This list is created by putting \test
-# commands in the documentation.
-
-GENERATE_TESTLIST      = YES
-
-# The GENERATE_BUGLIST tag can be used to enable (YES) or
-# disable (NO) the bug list. This list is created by putting \bug
-# commands in the documentation.
-
-GENERATE_BUGLIST       = YES
-
-# The GENERATE_DEPRECATEDLIST tag can be used to enable (YES) or
-# disable (NO) the deprecated list. This list is created by putting
-# \deprecated commands in the documentation.
-
-GENERATE_DEPRECATEDLIST= YES
-
-# The ENABLED_SECTIONS tag can be used to enable conditional
-# documentation sections, marked by \if sectionname ... \endif.
-
-ENABLED_SECTIONS       =
-
-# The MAX_INITIALIZER_LINES tag determines the maximum number of lines
-# the initial value of a variable or define consists of for it to appear in
-# the documentation. If the initializer consists of more lines than specified
-# here it will be hidden. Use a value of 0 to hide initializers completely.
-# The appearance of the initializer of individual variables and defines in the
-# documentation can be controlled using \showinitializer or \hideinitializer
-# command in the documentation regardless of this setting.
-
-MAX_INITIALIZER_LINES  = 30
-
-# Set the SHOW_USED_FILES tag to NO to disable the list of files generated
-# at the bottom of the documentation of classes and structs. If set to YES the
-# list will mention the files that were used to generate the documentation.
-
-SHOW_USED_FILES        = YES
-
-# If the sources in your project are distributed over multiple directories
-# then setting the SHOW_DIRECTORIES tag to YES will show the directory hierarchy
-# in the documentation. The default is NO.
-
-SHOW_DIRECTORIES       = YES
-
-# Set the SHOW_FILES tag to NO to disable the generation of the Files page. 
-# This will remove the Files entry from the Quick Index and from the 
-# Folder Tree View (if specified). The default is YES.
-
-SHOW_FILES             = YES
-
-# Set the SHOW_NAMESPACES tag to NO to disable the generation of the 
-# Namespaces page. 
-# This will remove the Namespaces entry from the Quick Index 
-# and from the Folder Tree View (if specified). The default is YES.
-
-SHOW_NAMESPACES        = YES
-
-# The FILE_VERSION_FILTER tag can be used to specify a program or script that
-# doxygen should invoke to get the current version for each file (typically from
-# the version control system). Doxygen will invoke the program by executing (via
-# popen()) the command <command> <input-file>, where <command> is the value of
-# the FILE_VERSION_FILTER tag, and <input-file> is the name of an input file
-# provided by doxygen. Whatever the program writes to standard output
-# is used as the file version. See the manual for examples.
-
-FILE_VERSION_FILTER    =
-
-# The LAYOUT_FILE tag can be used to specify a layout file which will be parsed by 
-# doxygen. The layout file controls the global structure of the generated output files 
-# in an output format independent way. The create the layout file that represents 
-# doxygen's defaults, run doxygen with the -l option. You can optionally specify a 
-# file name after the option, if omitted DoxygenLayout.xml will be used as the name 
-# of the layout file.
-
-LAYOUT_FILE            = 
-
-#---------------------------------------------------------------------------
-# configuration options related to warning and progress messages
-#---------------------------------------------------------------------------
-
-# The QUIET tag can be used to turn on/off the messages that are generated
-# by doxygen. Possible values are YES and NO. If left blank NO is used.
-
-QUIET                  = NO
-
-# The WARNINGS tag can be used to turn on/off the warning messages that are
-# generated by doxygen. Possible values are YES and NO. If left blank
-# NO is used.
-
-WARNINGS               = YES
-
-# If WARN_IF_UNDOCUMENTED is set to YES, then doxygen will generate warnings
-# for undocumented members. If EXTRACT_ALL is set to YES then this flag will
-# automatically be disabled.
-
-WARN_IF_UNDOCUMENTED   = YES
-
-# If WARN_IF_DOC_ERROR is set to YES, doxygen will generate warnings for
-# potential errors in the documentation, such as not documenting some
-# parameters in a documented function, or documenting parameters that
-# don't exist or using markup commands wrongly.
-
-WARN_IF_DOC_ERROR      = YES
-
-# This WARN_NO_PARAMDOC option can be abled to get warnings for
-# functions that are documented, but have no documentation for their parameters
-# or return value. If set to NO (the default) doxygen will only warn about
-# wrong or incomplete parameter documentation, but not about the absence of
-# documentation.
-
-WARN_NO_PARAMDOC       = NO
-
-# The WARN_FORMAT tag determines the format of the warning messages that
-# doxygen can produce. The string should contain the $file, $line, and $text
-# tags, which will be replaced by the file and line number from which the
-# warning originated and the warning text. Optionally the format may contain
-# $version, which will be replaced by the version of the file (if it could
-# be obtained via FILE_VERSION_FILTER)
-
-WARN_FORMAT            = "$file:$line: $text   "
-
-# The WARN_LOGFILE tag can be used to specify a file to which warning
-# and error messages should be written. If left blank the output is written
-# to stderr.
-
-WARN_LOGFILE           =
-
-#---------------------------------------------------------------------------
-# configuration options related to the input files
-#---------------------------------------------------------------------------
-
-# The INPUT tag can be used to specify the files and/or directories that contain
-# documented source files. You may enter file names like "myfile.cpp" or
-# directories like "/usr/src/myproject". Separate the files or directories
-# with spaces.
-
-INPUT                  = doc/manual \
-                         TODO \
-                         BUGS \
-                         PATCHES \
-                         src \
-                         config.h
-
-# This tag can be used to specify the character encoding of the source files
-# that doxygen parses. Internally doxygen uses the UTF-8 encoding, which is
-# also the default input encoding. Doxygen uses libiconv (or the iconv built
-# into libc) for the transcoding. See http://www.gnu.org/software/libiconv for
-# the list of possible encodings.
-
-INPUT_ENCODING         = UTF-8
-
-# If the value of the INPUT tag contains directories, you can use the
-# FILE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp
-# and *.h) to filter out the source-files in the directories. If left
-# blank the following patterns are tested:
-# *.c *.cc *.cxx *.cpp *.c++ *.java *.ii *.ixx *.ipp *.i++ *.inl *.h *.hh *.hxx
-# *.hpp *.h++ *.idl *.odl *.cs *.php *.php3 *.inc *.m *.mm *.py *.f90
-
-FILE_PATTERNS          = *.h \
-                         *.c \
-			 *.txt
-
-# The RECURSIVE tag can be used to turn specify whether or not subdirectories
-# should be searched for input files as well. Possible values are YES and NO.
-# If left blank NO is used.
-
-RECURSIVE              = YES
-
-# The EXCLUDE tag can be used to specify files and/or directories that should
-# excluded from the INPUT source files. This way you can easily exclude a
-# subdirectory from a directory tree whose root is specified with the INPUT tag.
-
-EXCLUDE                =
-
-# The EXCLUDE_SYMLINKS tag can be used select whether or not files or
-# directories that are symbolic links (a Unix filesystem feature) are excluded
-# from the input.
-
-EXCLUDE_SYMLINKS       = NO
-
-# If the value of the INPUT tag contains directories, you can use the
-# EXCLUDE_PATTERNS tag to specify one or more wildcard patterns to exclude
-# certain files from those directories. Note that the wildcards are matched
-# against the file with absolute path, so to exclude all test directories
-# for example use the pattern */test/*
-
-EXCLUDE_PATTERNS       =
-
-# The EXCLUDE_SYMBOLS tag can be used to specify one or more symbol names
-# (namespaces, classes, functions, etc.) that should be excluded from the
-# output. The symbol name can be a fully qualified name, a word, or if the
-# wildcard * is used, a substring. Examples: ANamespace, AClass,
-# AClass::ANamespace, ANamespace::*Test
-
-EXCLUDE_SYMBOLS        =
-
-# The EXAMPLE_PATH tag can be used to specify one or more files or
-# directories that contain example code fragments that are included (see
-# the \include command).
-
-EXAMPLE_PATH           =
-
-# If the value of the EXAMPLE_PATH tag contains directories, you can use the
-# EXAMPLE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp
-# and *.h) to filter out the source-files in the directories. If left
-# blank all files are included.
-
-EXAMPLE_PATTERNS       =
-
-# If the EXAMPLE_RECURSIVE tag is set to YES then subdirectories will be
-# searched for input files to be used with the \include or \dontinclude
-# commands irrespective of the value of the RECURSIVE tag.
-# Possible values are YES and NO. If left blank NO is used.
-
-EXAMPLE_RECURSIVE      = NO
-
-# The IMAGE_PATH tag can be used to specify one or more files or
-# directories that contain image that are included in the documentation (see
-# the \image command).
-
-IMAGE_PATH             =
-
-# The INPUT_FILTER tag can be used to specify a program that doxygen should
-# invoke to filter for each input file. Doxygen will invoke the filter program
-# by executing (via popen()) the command <filter> <input-file>, where <filter>
-# is the value of the INPUT_FILTER tag, and <input-file> is the name of an
-# input file. Doxygen will then use the output that the filter program writes
-# to standard output. 
-# If FILTER_PATTERNS is specified, this tag will be 
-# ignored.
-
-INPUT_FILTER           =
-
-# The FILTER_PATTERNS tag can be used to specify filters on a per file pattern
-# basis. 
-# Doxygen will compare the file name with each pattern and apply the 
-# filter if there is a match. 
-# The filters are a list of the form: 
-# pattern=filter (like *.cpp=my_cpp_filter). See INPUT_FILTER for further
-# info on how filters are used. If FILTER_PATTERNS is empty, INPUT_FILTER
-# is applied to all files.
-
-FILTER_PATTERNS        =
-
-# If the FILTER_SOURCE_FILES tag is set to YES, the input filter (if set using
-# INPUT_FILTER) will be used to filter the input files when producing source
-# files to browse (i.e. when SOURCE_BROWSER is set to YES).
-
-FILTER_SOURCE_FILES    = NO
-
-#---------------------------------------------------------------------------
-# configuration options related to source browsing
-#---------------------------------------------------------------------------
-
-# If the SOURCE_BROWSER tag is set to YES then a list of source files will
-# be generated. Documented entities will be cross-referenced with these sources.
-# Note: To get rid of all source code in the generated output, make sure also
-# VERBATIM_HEADERS is set to NO.
-
-SOURCE_BROWSER         = YES
-
-# Setting the INLINE_SOURCES tag to YES will include the body
-# of functions and classes directly in the documentation.
-
-INLINE_SOURCES         = YES
-
-# Setting the STRIP_CODE_COMMENTS tag to YES (the default) will instruct
-# doxygen to hide any special comment blocks from generated source code
-# fragments. Normal C and C++ comments will always remain visible.
-
-STRIP_CODE_COMMENTS    = NO
-
-# If the REFERENCED_BY_RELATION tag is set to YES 
-# then for each documented function all documented
-# functions referencing it will be listed.
-
-REFERENCED_BY_RELATION = YES
-
-# If the REFERENCES_RELATION tag is set to YES 
-# then for each documented function all documented entities
-# called/used by that function will be listed.
-
-REFERENCES_RELATION    = YES
-
-# If the REFERENCES_LINK_SOURCE tag is set to YES (the default)
-# and SOURCE_BROWSER tag is set to YES, then the hyperlinks from
-# functions in REFERENCES_RELATION and REFERENCED_BY_RELATION lists will
-# link to the source code. 
-# Otherwise they will link to the documentation.
-
-REFERENCES_LINK_SOURCE = YES
-
-# If the USE_HTAGS tag is set to YES then the references to source code
-# will point to the HTML generated by the htags(1) tool instead of doxygen
-# built-in source browser. The htags tool is part of GNU's global source
-# tagging system (see http://www.gnu.org/software/global/global.html). You
-# will need version 4.8.6 or higher.
-
-USE_HTAGS              = NO
-
-# If the VERBATIM_HEADERS tag is set to YES (the default) then Doxygen
-# will generate a verbatim copy of the header file for each class for
-# which an include is specified. Set to NO to disable this.
-
-VERBATIM_HEADERS       = YES
-
-#---------------------------------------------------------------------------
-# configuration options related to the alphabetical class index
-#---------------------------------------------------------------------------
-
-# If the ALPHABETICAL_INDEX tag is set to YES, an alphabetical index
-# of all compounds will be generated. Enable this if the project
-# contains a lot of classes, structs, unions or interfaces.
-
-ALPHABETICAL_INDEX     = YES
-
-# If the alphabetical index is enabled (see ALPHABETICAL_INDEX) then
-# the COLS_IN_ALPHA_INDEX tag can be used to specify the number of columns
-# in which this list will be split (can be a number in the range [1..20])
-
-COLS_IN_ALPHA_INDEX    = 5
-
-# In case all classes in a project start with a common prefix, all
-# classes will be put under the same header in the alphabetical index.
-# The IGNORE_PREFIX tag can be used to specify one or more prefixes that
-# should be ignored while generating the index headers.
-
-IGNORE_PREFIX          =
-
-#---------------------------------------------------------------------------
-# configuration options related to the HTML output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_HTML tag is set to YES (the default) Doxygen will
-# generate HTML output.
-
-GENERATE_HTML          = YES
-
-# The HTML_OUTPUT tag is used to specify where the HTML docs will be put.
-# If a relative path is entered the value of OUTPUT_DIRECTORY will be
-# put in front of it. If left blank `html' will be used as the default path.
-
-HTML_OUTPUT            = doxygen
-
-# The HTML_FILE_EXTENSION tag can be used to specify the file extension for
-# each generated HTML page (for example: .htm,.php,.asp). If it is left blank
-# doxygen will generate files with .html extension.
-
-HTML_FILE_EXTENSION    = .html
-
-# The HTML_HEADER tag can be used to specify a personal HTML header for
-# each generated HTML page. If it is left blank doxygen will generate a
-# standard header.
-
-HTML_HEADER            =
-
-# The HTML_FOOTER tag can be used to specify a personal HTML footer for
-# each generated HTML page. If it is left blank doxygen will generate a
-# standard footer.
-
-HTML_FOOTER            =
-
-# The HTML_STYLESHEET tag can be used to specify a user-defined cascading
-# style sheet that is used by each HTML page. It can be used to
-# fine-tune the look of the HTML output. If the tag is left blank doxygen
-# will generate a default style sheet. Note that doxygen will try to copy
-# the style sheet file to the HTML output directory, so don't put your own
-# stylesheet in the HTML output directory as well, or it will be erased!
-
-HTML_STYLESHEET        =
-
-# If the HTML_ALIGN_MEMBERS tag is set to YES, the members of classes,
-# files or namespaces will be aligned in HTML using tables. If set to
-# NO a bullet list will be used.
-
-HTML_ALIGN_MEMBERS     = YES
-
-# If the HTML_DYNAMIC_SECTIONS tag is set to YES then the generated HTML 
-# documentation will contain sections that can be hidden and shown after the 
-# page has loaded. For this to work a browser that supports 
-# JavaScript and DHTML is required (for instance Mozilla 1.0+, Firefox 
-# Netscape 6.0+, Internet explorer 5.0+, Konqueror, or Safari).
-
-HTML_DYNAMIC_SECTIONS  = NO
-
-# If the GENERATE_DOCSET tag is set to YES, additional index files
-# will be generated that can be used as input for Apple's Xcode 3
-# integrated development environment, introduced with OSX 10.5 (Leopard).
-# To create a documentation set, doxygen will generate a Makefile in the
-# HTML output directory. Running make will produce the docset in that
-# directory and running "make install" will install the docset in
-# ~/Library/Developer/Shared/Documentation/DocSets so that Xcode will find
-# it at startup.
-# See http://developer.apple.com/tools/creatingdocsetswithdoxygen.html for more information.
-
-GENERATE_DOCSET        = NO
-
-# When GENERATE_DOCSET tag is set to YES, this tag determines the name of the
-# feed. A documentation feed provides an umbrella under which multiple
-# documentation sets from a single provider (such as a company or product suite)
-# can be grouped.
-
-DOCSET_FEEDNAME        = "Doxygen generated docs"
-
-# When GENERATE_DOCSET tag is set to YES, this tag specifies a string that
-# should uniquely identify the documentation set bundle. This should be a
-# reverse domain-name style string, e.g. com.mycompany.MyDocSet. Doxygen
-# will append .docset to the name.
-
-DOCSET_BUNDLE_ID       = org.doxygen.Project
-
-# If the GENERATE_HTMLHELP tag is set to YES, additional index files 
-# will be generated that can be used as input for tools like the 
-# Microsoft HTML help workshop to generate a compiled HTML help file (.chm) 
-# of the generated HTML documentation.
-
-GENERATE_HTMLHELP      = NO
-
-# If the GENERATE_HTMLHELP tag is set to YES, the CHM_FILE tag can
-# be used to specify the file name of the resulting .chm file. You
-# can add a path in front of the file if the result should not be
-# written to the html output directory.
-
-CHM_FILE               =
-
-# If the GENERATE_HTMLHELP tag is set to YES, the HHC_LOCATION tag can
-# be used to specify the location (absolute path including file name) of
-# the HTML help compiler (hhc.exe). If non-empty doxygen will try to run
-# the HTML help compiler on the generated index.hhp.
-
-HHC_LOCATION           =
-
-# If the GENERATE_HTMLHELP tag is set to YES, the GENERATE_CHI flag
-# controls if a separate .chi index file is generated (YES) or that
-# it should be included in the master .chm file (NO).
-
-GENERATE_CHI           = NO
-
-# If the GENERATE_HTMLHELP tag is set to YES, the CHM_INDEX_ENCODING 
-# is used to encode HtmlHelp index (hhk), content (hhc) and project file 
-# content.
-
-CHM_INDEX_ENCODING     = 
-
-# If the GENERATE_HTMLHELP tag is set to YES, the BINARY_TOC flag
-# controls whether a binary table of contents is generated (YES) or a
-# normal table of contents (NO) in the .chm file.
-
-BINARY_TOC             = NO
-
-# The TOC_EXPAND flag can be set to YES to add extra items for group members
-# to the contents of the HTML help documentation and to the tree view.
-
-TOC_EXPAND             = NO
-
-# If the GENERATE_QHP tag is set to YES and both QHP_NAMESPACE and QHP_VIRTUAL_FOLDER 
-# are set, an additional index file will be generated that can be used as input for 
-# Qt's qhelpgenerator to generate a Qt Compressed Help (.qch) of the generated 
-# HTML documentation.
-
-GENERATE_QHP           = NO
-
-# If the QHG_LOCATION tag is specified, the QCH_FILE tag can 
-# be used to specify the file name of the resulting .qch file. 
-# The path specified is relative to the HTML output folder.
-
-QCH_FILE               = 
-
-# The QHP_NAMESPACE tag specifies the namespace to use when generating 
-# Qt Help Project output. For more information please see 
-# http://doc.trolltech.com/qthelpproject.html#namespace
-
-QHP_NAMESPACE          = 
-
-# The QHP_VIRTUAL_FOLDER tag specifies the namespace to use when generating 
-# Qt Help Project output. For more information please see 
-# http://doc.trolltech.com/qthelpproject.html#virtual-folders
-
-QHP_VIRTUAL_FOLDER     = doc
-
-# If QHP_CUST_FILTER_NAME is set, it specifies the name of a custom filter to add. 
-# For more information please see 
-# http://doc.trolltech.com/qthelpproject.html#custom-filters
-
-QHP_CUST_FILTER_NAME   = 
-
-# The QHP_CUST_FILT_ATTRS tag specifies the list of the attributes of the custom filter to add.For more information please see 
-# <a href="http://doc.trolltech.com/qthelpproject.html#custom-filters">Qt Help Project / Custom Filters</a>.
-
-QHP_CUST_FILTER_ATTRS  = 
-
-# The QHP_SECT_FILTER_ATTRS tag specifies the list of the attributes this project's 
-# filter section matches. 
-# <a href="http://doc.trolltech.com/qthelpproject.html#filter-attributes">Qt Help Project / Filter Attributes</a>.
-
-QHP_SECT_FILTER_ATTRS  = 
-
-# If the GENERATE_QHP tag is set to YES, the QHG_LOCATION tag can 
-# be used to specify the location of Qt's qhelpgenerator. 
-# If non-empty doxygen will try to run qhelpgenerator on the generated 
-# .qhp file.
-
-QHG_LOCATION           = 
-
-# The DISABLE_INDEX tag can be used to turn on/off the condensed index at
-# top of each HTML page. The value NO (the default) enables the index and
-# the value YES disables it.
-
-DISABLE_INDEX          = NO
-
-# This tag can be used to set the number of enum values (range [1..20])
-# that doxygen will group on one line in the generated HTML documentation.
-
-ENUM_VALUES_PER_LINE   = 4
-
-# The GENERATE_TREEVIEW tag is used to specify whether a tree-like index 
-# structure should be generated to display hierarchical information. 
-# If the tag value is set to FRAME, a side panel will be generated 
-# containing a tree-like index structure (just like the one that 
-# is generated for HTML Help). For this to work a browser that supports
-# JavaScript, DHTML, CSS and frames is required (for instance Mozilla 1.0+,
-# Netscape 6.0+, Internet explorer 5.0+, or Konqueror). Windows users are
-# probably better off using the HTML help feature. Other possible values 
-# for this tag are: HIERARCHIES, which will generate the Groups, Directories, 
-# and Class Hierarchy pages using a tree view instead of an ordered list; 
-# ALL, which combines the behavior of FRAME and HIERARCHIES; and NONE, which 
-# disables this behavior completely. For backwards compatibility with previous 
-# releases of Doxygen, the values YES and NO are equivalent to FRAME and NONE 
-# respectively.
-
-GENERATE_TREEVIEW      = YES
-
-# If the treeview is enabled (see GENERATE_TREEVIEW) then this tag can be
-# used to set the initial width (in pixels) of the frame in which the tree
-# is shown.
-
-TREEVIEW_WIDTH         = 250
-
-# Use this tag to change the font size of Latex formulas included 
-# as images in the HTML documentation. The default is 10. Note that 
-# when you change the font size after a successful doxygen run you need 
-# to manually remove any form_*.png images from the HTML output directory 
-# to force them to be regenerated.
-
-FORMULA_FONTSIZE       = 10
-
-#---------------------------------------------------------------------------
-# configuration options related to the LaTeX output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_LATEX tag is set to YES (the default) Doxygen will
-# generate Latex output.
-
-GENERATE_LATEX         = NO
-
-# The LATEX_OUTPUT tag is used to specify where the LaTeX docs will be put.
-# If a relative path is entered the value of OUTPUT_DIRECTORY will be
-# put in front of it. If left blank `latex' will be used as the default path.
-
-LATEX_OUTPUT           = latex
-
-# The LATEX_CMD_NAME tag can be used to specify the LaTeX command name to be
-# invoked. If left blank `latex' will be used as the default command name.
-
-LATEX_CMD_NAME         = latex
-
-# The MAKEINDEX_CMD_NAME tag can be used to specify the command name to
-# generate index for LaTeX. If left blank `makeindex' will be used as the
-# default command name.
-
-MAKEINDEX_CMD_NAME     = makeindex
-
-# If the COMPACT_LATEX tag is set to YES Doxygen generates more compact
-# LaTeX documents. This may be useful for small projects and may help to
-# save some trees in general.
-
-COMPACT_LATEX          = NO
-
-# The PAPER_TYPE tag can be used to set the paper type that is used
-# by the printer. Possible values are: a4, a4wide, letter, legal and
-# executive. If left blank a4wide will be used.
-
-PAPER_TYPE             = a4wide
-
-# The EXTRA_PACKAGES tag can be to specify one or more names of LaTeX
-# packages that should be included in the LaTeX output.
-
-EXTRA_PACKAGES         =
-
-# The LATEX_HEADER tag can be used to specify a personal LaTeX header for
-# the generated latex document. The header should contain everything until
-# the first chapter. If it is left blank doxygen will generate a
-# standard header. Notice: only use this tag if you know what you are doing!
-
-LATEX_HEADER           =
-
-# If the PDF_HYPERLINKS tag is set to YES, the LaTeX that is generated
-# is prepared for conversion to pdf (using ps2pdf). The pdf file will
-# contain links (just like the HTML output) instead of page references
-# This makes the output suitable for online browsing using a pdf viewer.
-
-PDF_HYPERLINKS         = NO
-
-# If the USE_PDFLATEX tag is set to YES, pdflatex will be used instead of
-# plain latex in the generated Makefile. Set this option to YES to get a
-# higher quality PDF documentation.
-
-USE_PDFLATEX           = NO
-
-# If the LATEX_BATCHMODE tag is set to YES, doxygen will add the \\batchmode.
-# command to the generated LaTeX files. This will instruct LaTeX to keep
-# running if errors occur, instead of asking the user for help.
-# This option is also used when generating formulas in HTML.
-
-LATEX_BATCHMODE        = NO
-
-# If LATEX_HIDE_INDICES is set to YES then doxygen will not
-# include the index chapters (such as File Index, Compound Index, etc.)
-# in the output.
-
-LATEX_HIDE_INDICES     = NO
-
-#---------------------------------------------------------------------------
-# configuration options related to the RTF output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_RTF tag is set to YES Doxygen will generate RTF output
-# The RTF output is optimized for Word 97 and may not look very pretty with
-# other RTF readers or editors.
-
-GENERATE_RTF           = NO
-
-# The RTF_OUTPUT tag is used to specify where the RTF docs will be put.
-# If a relative path is entered the value of OUTPUT_DIRECTORY will be
-# put in front of it. If left blank `rtf' will be used as the default path.
-
-RTF_OUTPUT             = rtf
-
-# If the COMPACT_RTF tag is set to YES Doxygen generates more compact
-# RTF documents. This may be useful for small projects and may help to
-# save some trees in general.
-
-COMPACT_RTF            = NO
-
-# If the RTF_HYPERLINKS tag is set to YES, the RTF that is generated
-# will contain hyperlink fields. The RTF file will
-# contain links (just like the HTML output) instead of page references.
-# This makes the output suitable for online browsing using WORD or other
-# programs which support those fields.
-# Note: wordpad (write) and others do not support links.
-
-RTF_HYPERLINKS         = NO
-
-# Load stylesheet definitions from file. Syntax is similar to doxygen's
-# config file, i.e. a series of assignments. You only have to provide
-# replacements, missing definitions are set to their default value.
-
-RTF_STYLESHEET_FILE    =
-
-# Set optional variables used in the generation of an rtf document.
-# Syntax is similar to doxygen's config file.
-
-RTF_EXTENSIONS_FILE    =
-
-#---------------------------------------------------------------------------
-# configuration options related to the man page output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_MAN tag is set to YES (the default) Doxygen will
-# generate man pages
-
-GENERATE_MAN           = NO
-
-# The MAN_OUTPUT tag is used to specify where the man pages will be put.
-# If a relative path is entered the value of OUTPUT_DIRECTORY will be
-# put in front of it. If left blank `man' will be used as the default path.
-
-MAN_OUTPUT             = man
-
-# The MAN_EXTENSION tag determines the extension that is added to
-# the generated man pages (default is the subroutine's section .3)
-
-MAN_EXTENSION          = .3
-
-# If the MAN_LINKS tag is set to YES and Doxygen generates man output,
-# then it will generate one additional man file for each entity
-# documented in the real man page(s). These additional files
-# only source the real man page, but without them the man command
-# would be unable to find the correct page. The default is NO.
-
-MAN_LINKS              = NO
-
-#---------------------------------------------------------------------------
-# configuration options related to the XML output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_XML tag is set to YES Doxygen will
-# generate an XML file that captures the structure of
-# the code including all documentation.
-
-GENERATE_XML           = NO
-
-# The XML_OUTPUT tag is used to specify where the XML pages will be put.
-# If a relative path is entered the value of OUTPUT_DIRECTORY will be
-# put in front of it. If left blank `xml' will be used as the default path.
-
-XML_OUTPUT             = xml
-
-# The XML_SCHEMA tag can be used to specify an XML schema,
-# which can be used by a validating XML parser to check the
-# syntax of the XML files.
-
-XML_SCHEMA             =
-
-# The XML_DTD tag can be used to specify an XML DTD,
-# which can be used by a validating XML parser to check the
-# syntax of the XML files.
-
-XML_DTD                =
-
-# If the XML_PROGRAMLISTING tag is set to YES Doxygen will
-# dump the program listings (including syntax highlighting
-# and cross-referencing information) to the XML output. Note that
-# enabling this will significantly increase the size of the XML output.
-
-XML_PROGRAMLISTING     = YES
-
-#---------------------------------------------------------------------------
-# configuration options for the AutoGen Definitions output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_AUTOGEN_DEF tag is set to YES Doxygen will
-# generate an AutoGen Definitions (see autogen.sf.net) file
-# that captures the structure of the code including all
-# documentation. Note that this feature is still experimental
-# and incomplete at the moment.
-
-GENERATE_AUTOGEN_DEF   = NO
-
-#---------------------------------------------------------------------------
-# configuration options related to the Perl module output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_PERLMOD tag is set to YES Doxygen will
-# generate a Perl module file that captures the structure of
-# the code including all documentation. Note that this
-# feature is still experimental and incomplete at the
-# moment.
-
-GENERATE_PERLMOD       = NO
-
-# If the PERLMOD_LATEX tag is set to YES Doxygen will generate
-# the necessary Makefile rules, Perl scripts and LaTeX code to be able
-# to generate PDF and DVI output from the Perl module output.
-
-PERLMOD_LATEX          = NO
-
-# If the PERLMOD_PRETTY tag is set to YES the Perl module output will be
-# nicely formatted so it can be parsed by a human reader. 
-# This is useful 
-# if you want to understand what is going on. 
-# On the other hand, if this 
-# tag is set to NO the size of the Perl module output will be much smaller
-# and Perl will parse it just the same.
-
-PERLMOD_PRETTY         = YES
-
-# The names of the make variables in the generated doxyrules.make file
-# are prefixed with the string contained in PERLMOD_MAKEVAR_PREFIX.
-# This is useful so different doxyrules.make files included by the same
-# Makefile don't overwrite each other's variables.
-
-PERLMOD_MAKEVAR_PREFIX =
-
-#---------------------------------------------------------------------------
-# Configuration options related to the preprocessor
-#---------------------------------------------------------------------------
-
-# If the ENABLE_PREPROCESSING tag is set to YES (the default) Doxygen will
-# evaluate all C-preprocessor directives found in the sources and include
-# files.
-
-ENABLE_PREPROCESSING   = YES
-
-# If the MACRO_EXPANSION tag is set to YES Doxygen will expand all macro
-# names in the source code. If set to NO (the default) only conditional
-# compilation will be performed. Macro expansion can be done in a controlled
-# way by setting EXPAND_ONLY_PREDEF to YES.
-
-MACRO_EXPANSION        = NO
-
-# If the EXPAND_ONLY_PREDEF and MACRO_EXPANSION tags are both set to YES
-# then the macro expansion is limited to the macros specified with the
-# PREDEFINED and EXPAND_AS_DEFINED tags.
-
-EXPAND_ONLY_PREDEF     = NO
-
-# If the SEARCH_INCLUDES tag is set to YES (the default) the includes files
-# in the INCLUDE_PATH (see below) will be search if a #include is found.
-
-SEARCH_INCLUDES        = YES
-
-# The INCLUDE_PATH tag can be used to specify one or more directories that
-# contain include files that are not input files but should be processed by
-# the preprocessor.
-
-INCLUDE_PATH           =
-
-# You can use the INCLUDE_FILE_PATTERNS tag to specify one or more wildcard
-# patterns (like *.h and *.hpp) to filter out the header-files in the
-# directories. If left blank, the patterns specified with FILE_PATTERNS will
-# be used.
-
-INCLUDE_FILE_PATTERNS  = *.h
-
-# The PREDEFINED tag can be used to specify one or more macro names that
-# are defined before the preprocessor is started (similar to the -D option of
-# gcc). The argument of the tag is a list of macros of the form: name
-# or name=definition (no spaces). If the definition and the = are
-# omitted =1 is assumed. To prevent a macro definition from being
-# undefined via #undef or recursively expanded use the := operator
-# instead of the = operator.
-
-PREDEFINED             = HAVE_CONFIG_H
-
-# If the MACRO_EXPANSION and EXPAND_ONLY_PREDEF tags are set to YES then
-# this tag can be used to specify a list of macro names that should be expanded.
-# The macro definition that is found in the sources will be used.
-# Use the PREDEFINED tag if you want to use a different macro definition.
-
-EXPAND_AS_DEFINED      =
-
-# If the SKIP_FUNCTION_MACROS tag is set to YES (the default) then
-# doxygen's preprocessor will remove all function-like macros that are alone
-# on a line, have an all uppercase name, and do not end with a semicolon. Such
-# function macros are typically used for boiler-plate code, and will confuse
-# the parser if not removed.
-
-SKIP_FUNCTION_MACROS   = YES
-
-#---------------------------------------------------------------------------
-# Configuration::additions related to external references
-#---------------------------------------------------------------------------
-
-# The TAGFILES option can be used to specify one or more tagfiles.
-# Optionally an initial location of the external documentation
-# can be added for each tagfile. The format of a tag file without
-# this location is as follows:
-#  
-#   TAGFILES = file1 file2 ...
-# Adding location for the tag files is done as follows:
-#  
-#   TAGFILES = file1=loc1 "file2 = loc2" ...
-# where "loc1" and "loc2" can be relative or absolute paths or
-# URLs. If a location is present for each tag, the installdox tool
-# does not have to be run to correct the links.
-# Note that each tag file must have a unique name
-# (where the name does NOT include the path)
-# If a tag file is not located in the directory in which doxygen
-# is run, you must also specify the path to the tagfile here.
-
-TAGFILES               =
-
-# When a file name is specified after GENERATE_TAGFILE, doxygen will create
-# a tag file that is based on the input files it reads.
-
-GENERATE_TAGFILE       =
-
-# If the ALLEXTERNALS tag is set to YES all external classes will be listed
-# in the class index. If set to NO only the inherited external classes
-# will be listed.
-
-ALLEXTERNALS           = NO
-
-# If the EXTERNAL_GROUPS tag is set to YES all external groups will be listed
-# in the modules index. If set to NO, only the current project's groups will
-# be listed.
-
-EXTERNAL_GROUPS        = YES
-
-# The PERL_PATH should be the absolute path and name of the perl script
-# interpreter (i.e. the result of `which perl').
-
-PERL_PATH              = /usr/bin/perl
-
-#---------------------------------------------------------------------------
-# Configuration options related to the dot tool
-#---------------------------------------------------------------------------
-
-# If the CLASS_DIAGRAMS tag is set to YES (the default) Doxygen will
-# generate a inheritance diagram (in HTML, RTF and LaTeX) for classes with base
-# or super classes. Setting the tag to NO turns the diagrams off. Note that
-# this option is superseded by the HAVE_DOT option below. This is only a
-# fallback. It is recommended to install and use dot, since it yields more
-# powerful graphs.
-
-CLASS_DIAGRAMS         = YES
-
-# You can define message sequence charts within doxygen comments using the \msc
-# command. Doxygen will then run the mscgen tool (see
-# http://www.mcternan.me.uk/mscgen/) to produce the chart and insert it in the
-# documentation. The MSCGEN_PATH tag allows you to specify the directory where
-# the mscgen tool resides. If left empty the tool is assumed to be found in the
-# default search path.
-
-MSCGEN_PATH            =
-
-# If set to YES, the inheritance and collaboration graphs will hide
-# inheritance and usage relations if the target is undocumented
-# or is not a class.
-
-HIDE_UNDOC_RELATIONS   = YES
-
-# If you set the HAVE_DOT tag to YES then doxygen will assume the dot tool is
-# available from the path. This tool is part of Graphviz, a graph visualization
-# toolkit from AT&T and Lucent Bell Labs. The other options in this section
-# have no effect if this option is set to NO (the default)
-
-HAVE_DOT               = YES
-
-# By default doxygen will write a font called FreeSans.ttf to the output 
-# directory and reference it in all dot files that doxygen generates. This 
-# font does not include all possible unicode characters however, so when you need 
-# these (or just want a differently looking font) you can specify the font name 
-# using DOT_FONTNAME. You need need to make sure dot is able to find the font, 
-# which can be done by putting it in a standard location or by setting the 
-# DOTFONTPATH environment variable or by setting DOT_FONTPATH to the directory 
-# containing the font.
-
-DOT_FONTNAME           = FreeSans
-
-# The DOT_FONTSIZE tag can be used to set the size of the font of dot graphs. 
-# The default size is 10pt.
-
-DOT_FONTSIZE           = 10
-
-# By default doxygen will tell dot to use the output directory to look for the 
-# FreeSans.ttf font (which doxygen will put there itself). If you specify a 
-# different font using DOT_FONTNAME you can set the path where dot 
-# can find it using this tag.
-
-DOT_FONTPATH           = 
-
-# If the CLASS_GRAPH and HAVE_DOT tags are set to YES then doxygen
-# will generate a graph for each documented class showing the direct and
-# indirect inheritance relations. Setting this tag to YES will force the
-# the CLASS_DIAGRAMS tag to NO.
-
-CLASS_GRAPH            = YES
-
-# If the COLLABORATION_GRAPH and HAVE_DOT tags are set to YES then doxygen
-# will generate a graph for each documented class showing the direct and
-# indirect implementation dependencies (inheritance, containment, and
-# class references variables) of the class with other documented classes.
-
-COLLABORATION_GRAPH    = YES
-
-# If the GROUP_GRAPHS and HAVE_DOT tags are set to YES then doxygen
-# will generate a graph for groups, showing the direct groups dependencies
-
-GROUP_GRAPHS           = YES
-
-# If the UML_LOOK tag is set to YES doxygen will generate inheritance and
-# collaboration diagrams in a style similar to the OMG's Unified Modeling
-# Language.
-
-UML_LOOK               = NO
-
-# If set to YES, the inheritance and collaboration graphs will show the
-# relations between templates and their instances.
-
-TEMPLATE_RELATIONS     = YES
-
-# If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDE_GRAPH, and HAVE_DOT
-# tags are set to YES then doxygen will generate a graph for each documented
-# file showing the direct and indirect include dependencies of the file with
-# other documented files.
-
-INCLUDE_GRAPH          = YES
-
-# If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDED_BY_GRAPH, and
-# HAVE_DOT tags are set to YES then doxygen will generate a graph for each
-# documented header file showing the documented files that directly or
-# indirectly include this file.
-
-INCLUDED_BY_GRAPH      = YES
-
-# If the CALL_GRAPH and HAVE_DOT options are set to YES then
-# doxygen will generate a call dependency graph for every global function
-# or class method. Note that enabling this option will significantly increase
-# the time of a run. So in most cases it will be better to enable call graphs
-# for selected functions only using the \callgraph command.
-
-CALL_GRAPH             = NO
-
-# If the CALLER_GRAPH and HAVE_DOT tags are set to YES then
-# doxygen will generate a caller dependency graph for every global function
-# or class method. Note that enabling this option will significantly increase
-# the time of a run. So in most cases it will be better to enable caller
-# graphs for selected functions only using the \callergraph command.
-
-CALLER_GRAPH           = NO
-
-# If the GRAPHICAL_HIERARCHY and HAVE_DOT tags are set to YES then doxygen
-# will graphical hierarchy of all classes instead of a textual one.
-
-GRAPHICAL_HIERARCHY    = YES
-
-# If the DIRECTORY_GRAPH, SHOW_DIRECTORIES and HAVE_DOT tags are set to YES
-# then doxygen will show the dependencies a directory has on other directories
-# in a graphical way. The dependency relations are determined by the #include
-# relations between the files in the directories.
-
-DIRECTORY_GRAPH        = YES
-
-# The DOT_IMAGE_FORMAT tag can be used to set the image format of the images
-# generated by dot. Possible values are png, jpg, or gif
-# If left blank png will be used.
-
-DOT_IMAGE_FORMAT       = png
-
-# The tag DOT_PATH can be used to specify the path where the dot tool can be
-# found. If left blank, it is assumed the dot tool can be found in the path.
-
-DOT_PATH               =
-
-# The DOTFILE_DIRS tag can be used to specify one or more directories that
-# contain dot files that are included in the documentation (see the
-# \dotfile command).
-
-DOTFILE_DIRS           =
-
-# The DOT_GRAPH_MAX_NODES tag can be used to set the maximum number of 
-# nodes that will be shown in the graph. If the number of nodes in a graph
-# becomes larger than this value, doxygen will truncate the graph, which is
-# visualized by representing a node as a red box. Note that doxygen if the
-# number of direct children of the root node in a graph is already larger than
-# DOT_GRAPH_MAX_NODES then the graph will not be shown at all. Also note
-# that the size of a graph can be further restricted by MAX_DOT_GRAPH_DEPTH.
-
-DOT_GRAPH_MAX_NODES    = 50
-
-# The MAX_DOT_GRAPH_DEPTH tag can be used to set the maximum depth of the
-# graphs generated by dot. A depth value of 3 means that only nodes reachable
-# from the root by following a path via at most 3 edges will be shown. Nodes
-# that lay further from the root node will be omitted. Note that setting this
-# option to 1 or 2 may greatly reduce the computation time needed for large
-# code bases. Also note that the size of a graph can be further restricted by
-# DOT_GRAPH_MAX_NODES. Using a depth of 0 means no depth restriction.
-
-MAX_DOT_GRAPH_DEPTH    = 0
-
-# Set the DOT_TRANSPARENT tag to YES to generate images with a transparent
-# background. This is disabled by default, because dot on Windows does not 
-# seem to support this out of the box. Warning: Depending on the platform used, 
-# enabling this option may lead to badly anti-aliased labels on the edges of 
-# a graph (i.e. they become hard to read).
-
-DOT_TRANSPARENT        = NO
-
-# Set the DOT_MULTI_TARGETS tag to YES allow dot to generate multiple output
-# files in one run (i.e. multiple -o and -T options on the command line). This
-# makes dot run faster, but since only newer versions of dot (>1.8.10)
-# support this, this feature is disabled by default.
-
-DOT_MULTI_TARGETS      = NO
-
-# If the GENERATE_LEGEND tag is set to YES (the default) Doxygen will
-# generate a legend page explaining the meaning of the various boxes and
-# arrows in the dot generated graphs.
-
-GENERATE_LEGEND        = YES
-
-# If the DOT_CLEANUP tag is set to YES (the default) Doxygen will
-# remove the intermediate dot files that are used to generate
-# the various graphs.
-
-DOT_CLEANUP            = YES
-
-#---------------------------------------------------------------------------
-# Options related to the search engine
-#---------------------------------------------------------------------------
-
-# The SEARCHENGINE tag specifies whether or not a search engine should be
-# used. If set to NO the values of all tags below this one will be ignored.
-
-SEARCHENGINE           = NO

Copied: trunk/Doxyfile.in (from rev 1894, trunk/Doxyfile)
===================================================================
--- trunk/Doxyfile	2009-05-23 22:05:05 UTC (rev 1894)
+++ trunk/Doxyfile.in	2009-05-24 01:08:16 UTC (rev 1901)
@@ -0,0 +1,1517 @@
+# Doxyfile 1.5.8
+
+# This file describes the settings to be used by the documentation system
+# doxygen (www.doxygen.org) for a project
+#
+# All text after a hash (#) is considered a comment and will be ignored
+# The format is:
+#       TAG = value [value, ...]
+# For lists items can also be appended using:
+#       TAG += value [value, ...]
+# Values that contain spaces should be placed between quotes (" ")
+
+#---------------------------------------------------------------------------
+# Project related configuration options
+#---------------------------------------------------------------------------
+
+# This tag specifies the encoding used for all characters in the config file
+# that follow. The default is UTF-8 which is also the encoding used for all
+# text before the first occurrence of this tag. Doxygen uses libiconv (or the
+# iconv built into libc) for the transcoding. See
+# http://www.gnu.org/software/libiconv for the list of possible encodings.
+
+DOXYFILE_ENCODING      = UTF-8
+
+# The PROJECT_NAME tag is a single word (or a sequence of words surrounded
+# by quotes) that should identify the project.
+
+PROJECT_NAME           = OpenOCD
+
+# The PROJECT_NUMBER tag can be used to enter a project or revision number.
+# This could be handy for archiving the generated documentation or
+# if some version control system is used.
+
+PROJECT_NUMBER         =
+
+# The OUTPUT_DIRECTORY tag is used to specify the (relative or absolute)
+# base path where the generated documentation will be put.
+# If a relative path is entered, it will be relative to the location
+# where doxygen was started. If left blank the current directory will be used.
+
+OUTPUT_DIRECTORY       =
+
+# If the CREATE_SUBDIRS tag is set to YES, then doxygen will create
+# 4096 sub-directories (in 2 levels) under the output directory of each output
+# format and will distribute the generated files over these directories.
+# Enabling this option can be useful when feeding doxygen a huge amount of
+# source files, where putting all generated files in the same directory would
+# otherwise cause performance problems for the file system.
+
+CREATE_SUBDIRS         = NO
+
+# The OUTPUT_LANGUAGE tag is used to specify the language in which all
+# documentation generated by doxygen is written. Doxygen will use this
+# information to generate all constant output in the proper language.
+# The default language is English, other supported languages are:
+# Afrikaans, Arabic, Brazilian, Catalan, Chinese, Chinese-Traditional,
+# Croatian, Czech, Danish, Dutch, Farsi, Finnish, French, German, Greek,
+# Hungarian, Italian, Japanese, Japanese-en (Japanese with English messages),
+# Korean, Korean-en, Lithuanian, Norwegian, Macedonian, Persian, Polish,
+# Portuguese, Romanian, Russian, Serbian, Serbian-Cyrilic, Slovak, Slovene, 
+# Spanish, Swedish, and Ukrainian.
+
+OUTPUT_LANGUAGE        = English
+
+# If the BRIEF_MEMBER_DESC tag is set to YES (the default) Doxygen will
+# include brief member descriptions after the members that are listed in
+# the file and class documentation (similar to JavaDoc).
+# Set to NO to disable this.
+
+BRIEF_MEMBER_DESC      = YES
+
+# If the REPEAT_BRIEF tag is set to YES (the default) Doxygen will prepend
+# the brief description of a member or function before the detailed description.
+# Note: if both HIDE_UNDOC_MEMBERS and BRIEF_MEMBER_DESC are set to NO, the
+# brief descriptions will be completely suppressed.
+
+REPEAT_BRIEF           = YES
+
+# This tag implements a quasi-intelligent brief description abbreviator
+# that is used to form the text in various listings. Each string
+# in this list, if found as the leading text of the brief description, will be
+# stripped from the text and the result after processing the whole list, is
+# used as the annotated text. Otherwise, the brief description is used as-is.
+# If left blank, the following values are used ("$name" is automatically
+# replaced with the name of the entity): "The $name class" "The $name widget"
+# "The $name file" "is" "provides" "specifies" "contains"
+# "represents" "a" "an" "the"
+
+ABBREVIATE_BRIEF       =
+
+# If the ALWAYS_DETAILED_SEC and REPEAT_BRIEF tags are both set to YES then
+# Doxygen will generate a detailed section even if there is only a brief
+# description.
+
+ALWAYS_DETAILED_SEC    = NO
+
+# If the INLINE_INHERITED_MEMB tag is set to YES, doxygen will show all
+# inherited members of a class in the documentation of that class as if those
+# members were ordinary class members. Constructors, destructors and assignment
+# operators of the base classes will not be shown.
+
+INLINE_INHERITED_MEMB  = YES
+
+# If the FULL_PATH_NAMES tag is set to YES then Doxygen will prepend the full
+# path before files name in the file list and in the header files. If set
+# to NO the shortest path that makes the file name unique will be used.
+
+FULL_PATH_NAMES        = NO
+
+# If the FULL_PATH_NAMES tag is set to YES then the STRIP_FROM_PATH tag
+# can be used to strip a user-defined part of the path. Stripping is
+# only done if one of the specified strings matches the left-hand part of
+# the path. The tag can be used to show relative paths in the file list.
+# If left blank the directory from which doxygen is run is used as the
+# path to strip.
+
+STRIP_FROM_PATH        =
+
+# The STRIP_FROM_INC_PATH tag can be used to strip a user-defined part of
+# the path mentioned in the documentation of a class, which tells
+# the reader which header file to include in order to use a class.
+# If left blank only the name of the header file containing the class
+# definition is used. Otherwise one should specify the include paths that
+# are normally passed to the compiler using the -I flag.
+
+STRIP_FROM_INC_PATH    =
+
+# If the SHORT_NAMES tag is set to YES, doxygen will generate much shorter
+# (but less readable) file names. This can be useful is your file systems
+# doesn't support long names like on DOS, Mac, or CD-ROM.
+
+SHORT_NAMES            = NO
+
+# If the JAVADOC_AUTOBRIEF tag is set to YES then Doxygen
+# will interpret the first line (until the first dot) of a JavaDoc-style
+# comment as the brief description. If set to NO, the JavaDoc
+# comments will behave just like regular Qt-style comments
+# (thus requiring an explicit @brief command for a brief description.)
+
+JAVADOC_AUTOBRIEF      = YES
+
+# If the QT_AUTOBRIEF tag is set to YES then Doxygen will
+# interpret the first line (until the first dot) of a Qt-style
+# comment as the brief description. If set to NO, the comments
+# will behave just like regular Qt-style comments (thus requiring
+# an explicit \brief command for a brief description.)
+
+QT_AUTOBRIEF           = NO
+
+# The MULTILINE_CPP_IS_BRIEF tag can be set to YES to make Doxygen
+# treat a multi-line C++ special comment block (i.e. a block of //! or ///
+# comments) as a brief description. This used to be the default behaviour.
+# The new default is to treat a multi-line C++ comment block as a detailed
+# description. Set this tag to YES if you prefer the old behaviour instead.
+
+MULTILINE_CPP_IS_BRIEF = NO
+
+# If the INHERIT_DOCS tag is set to YES (the default) then an undocumented
+# member inherits the documentation from any documented member that it
+# re-implements.
+
+INHERIT_DOCS           = YES
+
+# If the SEPARATE_MEMBER_PAGES tag is set to YES, then doxygen will produce
+# a new page for each member. If set to NO, the documentation of a member will
+# be part of the file/class/namespace that contains it.
+
+SEPARATE_MEMBER_PAGES  = NO
+
+# The TAB_SIZE tag can be used to set the number of spaces in a tab.
+# Doxygen uses this value to replace tabs by spaces in code fragments.
+
+TAB_SIZE               = 4
+
+# This tag can be used to specify a number of aliases that acts
+# as commands in the documentation. An alias has the form "name=value".
+# For example adding "sideeffect=\par Side Effects:\n" will allow you to
+# put the command \sideeffect (or @sideeffect) in the documentation, which
+# will result in a user-defined paragraph with heading "Side Effects:".
+# You can put \n's in the value part of an alias to insert newlines.
+
+ALIASES                =
+
+# Set the OPTIMIZE_OUTPUT_FOR_C tag to YES if your project consists of C
+# sources only. Doxygen will then generate output that is more tailored for C.
+# For instance, some of the names that are used will be different. The list
+# of all members will be omitted, etc.
+
+OPTIMIZE_OUTPUT_FOR_C  = YES
+
+# Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java
+# sources only. Doxygen will then generate output that is more tailored for
+# Java. For instance, namespaces will be presented as packages, qualified
+# scopes will look different, etc.
+
+OPTIMIZE_OUTPUT_JAVA   = NO
+
+# Set the OPTIMIZE_FOR_FORTRAN tag to YES if your project consists of Fortran
+# sources only. Doxygen will then generate output that is more tailored for
+# Fortran.
+
+OPTIMIZE_FOR_FORTRAN   = NO
+
+# Set the OPTIMIZE_OUTPUT_VHDL tag to YES if your project consists of VHDL
+# sources. Doxygen will then generate output that is tailored for
+# VHDL.
+
+OPTIMIZE_OUTPUT_VHDL   = NO
+
+# Doxygen selects the parser to use depending on the extension of the files it parses. 
+# With this tag you can assign which parser to use for a given extension. 
+# Doxygen has a built-in mapping, but you can override or extend it using this tag. 
+# The format is ext=language, where ext is a file extension, and language is one of 
+# the parsers supported by doxygen: IDL, Java, Javascript, C#, C, C++, D, PHP, 
+# Objective-C, Python, Fortran, VHDL, C, C++. For instance to make doxygen treat 
+# .inc files as Fortran files (default is PHP), and .f files as C (default is Fortran), 
+# use: inc=Fortran f=C
+
+EXTENSION_MAPPING      = 
+
+# If you use STL classes (i.e. std::string, std::vector, etc.) but do not want
+# to include (a tag file for) the STL sources as input, then you should
+# set this tag to YES in order to let doxygen match functions declarations and
+# definitions whose arguments contain STL classes (e.g. func(std::string); v.s.
+# func(std::string) {}). This also make the inheritance and collaboration
+# diagrams that involve STL classes more complete and accurate.
+
+BUILTIN_STL_SUPPORT    = NO
+
+# If you use Microsoft's C++/CLI language, you should set this option to YES to
+# enable parsing support.
+
+CPP_CLI_SUPPORT        = NO
+
+# Set the SIP_SUPPORT tag to YES if your project consists of sip sources only.
+# Doxygen will parse them like normal C++ but will assume all classes use public
+# instead of private inheritance when no explicit protection keyword is present.
+
+SIP_SUPPORT            = NO
+
+# For Microsoft's IDL there are propget and propput attributes to indicate getter 
+# and setter methods for a property. Setting this option to YES (the default) 
+# will make doxygen to replace the get and set methods by a property in the 
+# documentation. This will only work if the methods are indeed getting or 
+# setting a simple type. If this is not the case, or you want to show the 
+# methods anyway, you should set this option to NO.
+
+IDL_PROPERTY_SUPPORT   = NO
+
+# If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC
+# tag is set to YES, then doxygen will reuse the documentation of the first
+# member in the group (if any) for the other members of the group. By default
+# all members of a group must be documented explicitly.
+
+DISTRIBUTE_GROUP_DOC   = NO
+
+# Set the SUBGROUPING tag to YES (the default) to allow class member groups of
+# the same type (for instance a group of public functions) to be put as a
+# subgroup of that type (e.g. under the Public Functions section). Set it to
+# NO to prevent subgrouping. Alternatively, this can be done per class using
+# the \nosubgrouping command.
+
+SUBGROUPING            = YES
+
+# When TYPEDEF_HIDES_STRUCT is enabled, a typedef of a struct, union, or enum
+# is documented as struct, union, or enum with the name of the typedef. So
+# typedef struct TypeS {} TypeT, will appear in the documentation as a struct
+# with name TypeT. When disabled the typedef will appear as a member of a file,
+# namespace, or class. And the struct will be named TypeS. This can typically
+# be useful for C code in case the coding convention dictates that all compound
+# types are typedef'ed and only the typedef is referenced, never the tag name.
+
+TYPEDEF_HIDES_STRUCT   = NO
+
+# The SYMBOL_CACHE_SIZE determines the size of the internal cache use to 
+# determine which symbols to keep in memory and which to flush to disk. 
+# When the cache is full, less often used symbols will be written to disk. 
+# For small to medium size projects (<1000 input files) the default value is 
+# probably good enough. For larger projects a too small cache size can cause 
+# doxygen to be busy swapping symbols to and from disk most of the time 
+# causing a significant performance penality. 
+# If the system has enough physical memory increasing the cache will improve the 
+# performance by keeping more symbols in memory. Note that the value works on 
+# a logarithmic scale so increasing the size by one will rougly double the 
+# memory usage. The cache size is given by this formula: 
+# 2^(16+SYMBOL_CACHE_SIZE). The valid range is 0..9, the default is 0, 
+# corresponding to a cache size of 2^16 = 65536 symbols
+
+SYMBOL_CACHE_SIZE      = 0
+
+#---------------------------------------------------------------------------
+# Build related configuration options
+#---------------------------------------------------------------------------
+
+# If the EXTRACT_ALL tag is set to YES doxygen will assume all entities in
+# documentation are documented, even if no documentation was available.
+# Private class members and static file members will be hidden unless
+# the EXTRACT_PRIVATE and EXTRACT_STATIC tags are set to YES
+
+EXTRACT_ALL            = YES
+
+# If the EXTRACT_PRIVATE tag is set to YES all private members of a class
+# will be included in the documentation.
+
+EXTRACT_PRIVATE        = NO
+
+# If the EXTRACT_STATIC tag is set to YES all static members of a file
+# will be included in the documentation.
+
+EXTRACT_STATIC         = YES
+
+# If the EXTRACT_LOCAL_CLASSES tag is set to YES classes (and structs)
+# defined locally in source files will be included in the documentation.
+# If set to NO only classes defined in header files are included.
+
+EXTRACT_LOCAL_CLASSES  = YES
+
+# This flag is only useful for Objective-C code. When set to YES local
+# methods, which are defined in the implementation section but not in
+# the interface are included in the documentation.
+# If set to NO (the default) only methods in the interface are included.
+
+EXTRACT_LOCAL_METHODS  = NO
+
+# If this flag is set to YES, the members of anonymous namespaces will be
+# extracted and appear in the documentation as a namespace called
+# 'anonymous_namespace{file}', where file will be replaced with the base
+# name of the file that contains the anonymous namespace. By default
+# anonymous namespace are hidden.
+
+EXTRACT_ANON_NSPACES   = NO
+
+# If the HIDE_UNDOC_MEMBERS tag is set to YES, Doxygen will hide all
+# undocumented members of documented classes, files or namespaces.
+# If set to NO (the default) these members will be included in the
+# various overviews, but no documentation section is generated.
+# This option has no effect if EXTRACT_ALL is enabled.
+
+HIDE_UNDOC_MEMBERS     = NO
+
+# If the HIDE_UNDOC_CLASSES tag is set to YES, Doxygen will hide all
+# undocumented classes that are normally visible in the class hierarchy.
+# If set to NO (the default) these classes will be included in the various
+# overviews. This option has no effect if EXTRACT_ALL is enabled.
+
+HIDE_UNDOC_CLASSES     = NO
+
+# If the HIDE_FRIEND_COMPOUNDS tag is set to YES, Doxygen will hide all
+# friend (class|struct|union) declarations.
+# If set to NO (the default) these declarations will be included in the
+# documentation.
+
+HIDE_FRIEND_COMPOUNDS  = NO
+
+# If the HIDE_IN_BODY_DOCS tag is set to YES, Doxygen will hide any
+# documentation blocks found inside the body of a function.
+# If set to NO (the default) these blocks will be appended to the
+# function's detailed documentation block.
+
+HIDE_IN_BODY_DOCS      = NO
+
+# The INTERNAL_DOCS tag determines if documentation
+# that is typed after a \internal command is included. If the tag is set
+# to NO (the default) then the documentation will be excluded.
+# Set it to YES to include the internal documentation.
+
+INTERNAL_DOCS          = NO
+
+# If the CASE_SENSE_NAMES tag is set to NO then Doxygen will only generate
+# file names in lower-case letters. If set to YES upper-case letters are also
+# allowed. This is useful if you have classes or files whose names only differ
+# in case and if your file system supports case sensitive file names. Windows
+# and Mac users are advised to set this option to NO.
+
+CASE_SENSE_NAMES       = YES
+
+# If the HIDE_SCOPE_NAMES tag is set to NO (the default) then Doxygen
+# will show members with their full class and namespace scopes in the
+# documentation. If set to YES the scope will be hidden.
+
+HIDE_SCOPE_NAMES       = NO
+
+# If the SHOW_INCLUDE_FILES tag is set to YES (the default) then Doxygen
+# will put a list of the files that are included by a file in the documentation
+# of that file.
+
+SHOW_INCLUDE_FILES     = YES
+
+# If the INLINE_INFO tag is set to YES (the default) then a tag [inline]
+# is inserted in the documentation for inline members.
+
+INLINE_INFO            = YES
+
+# If the SORT_MEMBER_DOCS tag is set to YES (the default) then doxygen
+# will sort the (detailed) documentation of file and class members
+# alphabetically by member name. If set to NO the members will appear in
+# declaration order.
+
+SORT_MEMBER_DOCS       = YES
+
+# If the SORT_BRIEF_DOCS tag is set to YES then doxygen will sort the
+# brief documentation of file, namespace and class members alphabetically
+# by member name. If set to NO (the default) the members will appear in
+# declaration order.
+
+SORT_BRIEF_DOCS        = NO
+
+# If the SORT_GROUP_NAMES tag is set to YES then doxygen will sort the
+# hierarchy of group names into alphabetical order. If set to NO (the default)
+# the group names will appear in their defined order.
+
+SORT_GROUP_NAMES       = NO
+
+# If the SORT_BY_SCOPE_NAME tag is set to YES, the class list will be
+# sorted by fully-qualified names, including namespaces. If set to
+# NO (the default), the class list will be sorted only by class name,
+# not including the namespace part.
+# Note: This option is not very useful if HIDE_SCOPE_NAMES is set to YES.
+# Note: This option applies only to the class list, not to the
+# alphabetical list.
+
+SORT_BY_SCOPE_NAME     = NO
+
+# The GENERATE_TODOLIST tag can be used to enable (YES) or
+# disable (NO) the todo list. This list is created by putting \todo
+# commands in the documentation.
+
+GENERATE_TODOLIST      = YES
+
+# The GENERATE_TESTLIST tag can be used to enable (YES) or
+# disable (NO) the test list. This list is created by putting \test
+# commands in the documentation.
+
+GENERATE_TESTLIST      = YES
+
+# The GENERATE_BUGLIST tag can be used to enable (YES) or
+# disable (NO) the bug list. This list is created by putting \bug
+# commands in the documentation.
+
+GENERATE_BUGLIST       = YES
+
+# The GENERATE_DEPRECATEDLIST tag can be used to enable (YES) or
+# disable (NO) the deprecated list. This list is created by putting
+# \deprecated commands in the documentation.
+
+GENERATE_DEPRECATEDLIST= YES
+
+# The ENABLED_SECTIONS tag can be used to enable conditional
+# documentation sections, marked by \if sectionname ... \endif.
+
+ENABLED_SECTIONS       =
+
+# The MAX_INITIALIZER_LINES tag determines the maximum number of lines
+# the initial value of a variable or define consists of for it to appear in
+# the documentation. If the initializer consists of more lines than specified
+# here it will be hidden. Use a value of 0 to hide initializers completely.
+# The appearance of the initializer of individual variables and defines in the
+# documentation can be controlled using \showinitializer or \hideinitializer
+# command in the documentation regardless of this setting.
+
+MAX_INITIALIZER_LINES  = 30
+
+# Set the SHOW_USED_FILES tag to NO to disable the list of files generated
+# at the bottom of the documentation of classes and structs. If set to YES the
+# list will mention the files that were used to generate the documentation.
+
+SHOW_USED_FILES        = YES
+
+# If the sources in your project are distributed over multiple directories
+# then setting the SHOW_DIRECTORIES tag to YES will show the directory hierarchy
+# in the documentation. The default is NO.
+
+SHOW_DIRECTORIES       = YES
+
+# Set the SHOW_FILES tag to NO to disable the generation of the Files page. 
+# This will remove the Files entry from the Quick Index and from the 
+# Folder Tree View (if specified). The default is YES.
+
+SHOW_FILES             = YES
+
+# Set the SHOW_NAMESPACES tag to NO to disable the generation of the 
+# Namespaces page. 
+# This will remove the Namespaces entry from the Quick Index 
+# and from the Folder Tree View (if specified). The default is YES.
+
+SHOW_NAMESPACES        = YES
+
+# The FILE_VERSION_FILTER tag can be used to specify a program or script that
+# doxygen should invoke to get the current version for each file (typically from
+# the version control system). Doxygen will invoke the program by executing (via
+# popen()) the command <command> <input-file>, where <command> is the value of
+# the FILE_VERSION_FILTER tag, and <input-file> is the name of an input file
+# provided by doxygen. Whatever the program writes to standard output
+# is used as the file version. See the manual for examples.
+
+FILE_VERSION_FILTER    =
+
+# The LAYOUT_FILE tag can be used to specify a layout file which will be parsed by 
+# doxygen. The layout file controls the global structure of the generated output files 
+# in an output format independent way. The create the layout file that represents 
+# doxygen's defaults, run doxygen with the -l option. You can optionally specify a 
+# file name after the option, if omitted DoxygenLayout.xml will be used as the name 
+# of the layout file.
+
+LAYOUT_FILE            = 
+
+#---------------------------------------------------------------------------
+# configuration options related to warning and progress messages
+#---------------------------------------------------------------------------
+
+# The QUIET tag can be used to turn on/off the messages that are generated
+# by doxygen. Possible values are YES and NO. If left blank NO is used.
+
+QUIET                  = NO
+
+# The WARNINGS tag can be used to turn on/off the warning messages that are
+# generated by doxygen. Possible values are YES and NO. If left blank
+# NO is used.
+
+WARNINGS               = YES
+
+# If WARN_IF_UNDOCUMENTED is set to YES, then doxygen will generate warnings
+# for undocumented members. If EXTRACT_ALL is set to YES then this flag will
+# automatically be disabled.
+
+WARN_IF_UNDOCUMENTED   = YES
+
+# If WARN_IF_DOC_ERROR is set to YES, doxygen will generate warnings for
+# potential errors in the documentation, such as not documenting some
+# parameters in a documented function, or documenting parameters that
+# don't exist or using markup commands wrongly.
+
+WARN_IF_DOC_ERROR      = YES
+
+# This WARN_NO_PARAMDOC option can be abled to get warnings for
+# functions that are documented, but have no documentation for their parameters
+# or return value. If set to NO (the default) doxygen will only warn about
+# wrong or incomplete parameter documentation, but not about the absence of
+# documentation.
+
+WARN_NO_PARAMDOC       = NO
+
+# The WARN_FORMAT tag determines the format of the warning messages that
+# doxygen can produce. The string should contain the $file, $line, and $text
+# tags, which will be replaced by the file and line number from which the
+# warning originated and the warning text. Optionally the format may contain
+# $version, which will be replaced by the version of the file (if it could
+# be obtained via FILE_VERSION_FILTER)
+
+WARN_FORMAT            = "$file:$line: $text   "
+
+# The WARN_LOGFILE tag can be used to specify a file to which warning
+# and error messages should be written. If left blank the output is written
+# to stderr.
+
+WARN_LOGFILE           =
+
+#---------------------------------------------------------------------------
+# configuration options related to the input files
+#---------------------------------------------------------------------------
+
+# The INPUT tag can be used to specify the files and/or directories that contain
+# documented source files. You may enter file names like "myfile.cpp" or
+# directories like "/usr/src/myproject". Separate the files or directories
+# with spaces.
+
+INPUT                  = @srcdir@/doc/manual \
+                         @srcdir@/TODO \
+                         @srcdir@/BUGS \
+                         @srcdir@/PATCHES \
+                         @srcdir@/src \
+                         @srcdir@/config.h
+
+# This tag can be used to specify the character encoding of the source files
+# that doxygen parses. Internally doxygen uses the UTF-8 encoding, which is
+# also the default input encoding. Doxygen uses libiconv (or the iconv built
+# into libc) for the transcoding. See http://www.gnu.org/software/libiconv for
+# the list of possible encodings.
+
+INPUT_ENCODING         = UTF-8
+
+# If the value of the INPUT tag contains directories, you can use the
+# FILE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp
+# and *.h) to filter out the source-files in the directories. If left
+# blank the following patterns are tested:
+# *.c *.cc *.cxx *.cpp *.c++ *.java *.ii *.ixx *.ipp *.i++ *.inl *.h *.hh *.hxx
+# *.hpp *.h++ *.idl *.odl *.cs *.php *.php3 *.inc *.m *.mm *.py *.f90
+
+FILE_PATTERNS          = *.h \
+                         *.c \
+			 *.txt
+
+# The RECURSIVE tag can be used to turn specify whether or not subdirectories
+# should be searched for input files as well. Possible values are YES and NO.
+# If left blank NO is used.
+
+RECURSIVE              = YES
+
+# The EXCLUDE tag can be used to specify files and/or directories that should
+# excluded from the INPUT source files. This way you can easily exclude a
+# subdirectory from a directory tree whose root is specified with the INPUT tag.
+
+EXCLUDE                =
+
+# The EXCLUDE_SYMLINKS tag can be used select whether or not files or
+# directories that are symbolic links (a Unix filesystem feature) are excluded
+# from the input.
+
+EXCLUDE_SYMLINKS       = NO
+
+# If the value of the INPUT tag contains directories, you can use the
+# EXCLUDE_PATTERNS tag to specify one or more wildcard patterns to exclude
+# certain files from those directories. Note that the wildcards are matched
+# against the file with absolute path, so to exclude all test directories
+# for example use the pattern */test/*
+
+EXCLUDE_PATTERNS       =
+
+# The EXCLUDE_SYMBOLS tag can be used to specify one or more symbol names
+# (namespaces, classes, functions, etc.) that should be excluded from the
+# output. The symbol name can be a fully qualified name, a word, or if the
+# wildcard * is used, a substring. Examples: ANamespace, AClass,
+# AClass::ANamespace, ANamespace::*Test
+
+EXCLUDE_SYMBOLS        =
+
+# The EXAMPLE_PATH tag can be used to specify one or more files or
+# directories that contain example code fragments that are included (see
+# the \include command).
+
+EXAMPLE_PATH           =
+
+# If the value of the EXAMPLE_PATH tag contains directories, you can use the
+# EXAMPLE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp
+# and *.h) to filter out the source-files in the directories. If left
+# blank all files are included.
+
+EXAMPLE_PATTERNS       =
+
+# If the EXAMPLE_RECURSIVE tag is set to YES then subdirectories will be
+# searched for input files to be used with the \include or \dontinclude
+# commands irrespective of the value of the RECURSIVE tag.
+# Possible values are YES and NO. If left blank NO is used.
+
+EXAMPLE_RECURSIVE      = NO
+
+# The IMAGE_PATH tag can be used to specify one or more files or
+# directories that contain image that are included in the documentation (see
+# the \image command).
+
+IMAGE_PATH             =
+
+# The INPUT_FILTER tag can be used to specify a program that doxygen should
+# invoke to filter for each input file. Doxygen will invoke the filter program
+# by executing (via popen()) the command <filter> <input-file>, where <filter>
+# is the value of the INPUT_FILTER tag, and <input-file> is the name of an
+# input file. Doxygen will then use the output that the filter program writes
+# to standard output. 
+# If FILTER_PATTERNS is specified, this tag will be 
+# ignored.
+
+INPUT_FILTER           =
+
+# The FILTER_PATTERNS tag can be used to specify filters on a per file pattern
+# basis. 
+# Doxygen will compare the file name with each pattern and apply the 
+# filter if there is a match. 
+# The filters are a list of the form: 
+# pattern=filter (like *.cpp=my_cpp_filter). See INPUT_FILTER for further
+# info on how filters are used. If FILTER_PATTERNS is empty, INPUT_FILTER
+# is applied to all files.
+
+FILTER_PATTERNS        =
+
+# If the FILTER_SOURCE_FILES tag is set to YES, the input filter (if set using
+# INPUT_FILTER) will be used to filter the input files when producing source
+# files to browse (i.e. when SOURCE_BROWSER is set to YES).
+
+FILTER_SOURCE_FILES    = NO
+
+#---------------------------------------------------------------------------
+# configuration options related to source browsing
+#---------------------------------------------------------------------------
+
+# If the SOURCE_BROWSER tag is set to YES then a list of source files will
+# be generated. Documented entities will be cross-referenced with these sources.
+# Note: To get rid of all source code in the generated output, make sure also
+# VERBATIM_HEADERS is set to NO.
+
+SOURCE_BROWSER         = YES
+
+# Setting the INLINE_SOURCES tag to YES will include the body
+# of functions and classes directly in the documentation.
+
+INLINE_SOURCES         = YES
+
+# Setting the STRIP_CODE_COMMENTS tag to YES (the default) will instruct
+# doxygen to hide any special comment blocks from generated source code
+# fragments. Normal C and C++ comments will always remain visible.
+
+STRIP_CODE_COMMENTS    = NO
+
+# If the REFERENCED_BY_RELATION tag is set to YES 
+# then for each documented function all documented
+# functions referencing it will be listed.
+
+REFERENCED_BY_RELATION = YES
+
+# If the REFERENCES_RELATION tag is set to YES 
+# then for each documented function all documented entities
+# called/used by that function will be listed.
+
+REFERENCES_RELATION    = YES
+
+# If the REFERENCES_LINK_SOURCE tag is set to YES (the default)
+# and SOURCE_BROWSER tag is set to YES, then the hyperlinks from
+# functions in REFERENCES_RELATION and REFERENCED_BY_RELATION lists will
+# link to the source code. 
+# Otherwise they will link to the documentation.
+
+REFERENCES_LINK_SOURCE = YES
+
+# If the USE_HTAGS tag is set to YES then the references to source code
+# will point to the HTML generated by the htags(1) tool instead of doxygen
+# built-in source browser. The htags tool is part of GNU's global source
+# tagging system (see http://www.gnu.org/software/global/global.html). You
+# will need version 4.8.6 or higher.
+
+USE_HTAGS              = NO
+
+# If the VERBATIM_HEADERS tag is set to YES (the default) then Doxygen
+# will generate a verbatim copy of the header file for each class for
+# which an include is specified. Set to NO to disable this.
+
+VERBATIM_HEADERS       = YES
+
+#---------------------------------------------------------------------------
+# configuration options related to the alphabetical class index
+#---------------------------------------------------------------------------
+
+# If the ALPHABETICAL_INDEX tag is set to YES, an alphabetical index
+# of all compounds will be generated. Enable this if the project
+# contains a lot of classes, structs, unions or interfaces.
+
+ALPHABETICAL_INDEX     = YES
+
+# If the alphabetical index is enabled (see ALPHABETICAL_INDEX) then
+# the COLS_IN_ALPHA_INDEX tag can be used to specify the number of columns
+# in which this list will be split (can be a number in the range [1..20])
+
+COLS_IN_ALPHA_INDEX    = 5
+
+# In case all classes in a project start with a common prefix, all
+# classes will be put under the same header in the alphabetical index.
+# The IGNORE_PREFIX tag can be used to specify one or more prefixes that
+# should be ignored while generating the index headers.
+
+IGNORE_PREFIX          =
+
+#---------------------------------------------------------------------------
+# configuration options related to the HTML output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_HTML tag is set to YES (the default) Doxygen will
+# generate HTML output.
+
+GENERATE_HTML          = YES
+
+# The HTML_OUTPUT tag is used to specify where the HTML docs will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `html' will be used as the default path.
+
+HTML_OUTPUT            = doxygen
+
+# The HTML_FILE_EXTENSION tag can be used to specify the file extension for
+# each generated HTML page (for example: .htm,.php,.asp). If it is left blank
+# doxygen will generate files with .html extension.
+
+HTML_FILE_EXTENSION    = .html
+
+# The HTML_HEADER tag can be used to specify a personal HTML header for
+# each generated HTML page. If it is left blank doxygen will generate a
+# standard header.
+
+HTML_HEADER            =
+
+# The HTML_FOOTER tag can be used to specify a personal HTML footer for
+# each generated HTML page. If it is left blank doxygen will generate a
+# standard footer.
+
+HTML_FOOTER            =
+
+# The HTML_STYLESHEET tag can be used to specify a user-defined cascading
+# style sheet that is used by each HTML page. It can be used to
+# fine-tune the look of the HTML output. If the tag is left blank doxygen
+# will generate a default style sheet. Note that doxygen will try to copy
+# the style sheet file to the HTML output directory, so don't put your own
+# stylesheet in the HTML output directory as well, or it will be erased!
+
+HTML_STYLESHEET        =
+
+# If the HTML_ALIGN_MEMBERS tag is set to YES, the members of classes,
+# files or namespaces will be aligned in HTML using tables. If set to
+# NO a bullet list will be used.
+
+HTML_ALIGN_MEMBERS     = YES
+
+# If the HTML_DYNAMIC_SECTIONS tag is set to YES then the generated HTML 
+# documentation will contain sections that can be hidden and shown after the 
+# page has loaded. For this to work a browser that supports 
+# JavaScript and DHTML is required (for instance Mozilla 1.0+, Firefox 
+# Netscape 6.0+, Internet explorer 5.0+, Konqueror, or Safari).
+
+HTML_DYNAMIC_SECTIONS  = NO
+
+# If the GENERATE_DOCSET tag is set to YES, additional index files
+# will be generated that can be used as input for Apple's Xcode 3
+# integrated development environment, introduced with OSX 10.5 (Leopard).
+# To create a documentation set, doxygen will generate a Makefile in the
+# HTML output directory. Running make will produce the docset in that
+# directory and running "make install" will install the docset in
+# ~/Library/Developer/Shared/Documentation/DocSets so that Xcode will find
+# it at startup.
+# See http://developer.apple.com/tools/creatingdocsetswithdoxygen.html for more information.
+
+GENERATE_DOCSET        = NO
+
+# When GENERATE_DOCSET tag is set to YES, this tag determines the name of the
+# feed. A documentation feed provides an umbrella under which multiple
+# documentation sets from a single provider (such as a company or product suite)
+# can be grouped.
+
+DOCSET_FEEDNAME        = "Doxygen generated docs"
+
+# When GENERATE_DOCSET tag is set to YES, this tag specifies a string that
+# should uniquely identify the documentation set bundle. This should be a
+# reverse domain-name style string, e.g. com.mycompany.MyDocSet. Doxygen
+# will append .docset to the name.
+
+DOCSET_BUNDLE_ID       = org.doxygen.Project
+
+# If the GENERATE_HTMLHELP tag is set to YES, additional index files 
+# will be generated that can be used as input for tools like the 
+# Microsoft HTML help workshop to generate a compiled HTML help file (.chm) 
+# of the generated HTML documentation.
+
+GENERATE_HTMLHELP      = NO
+
+# If the GENERATE_HTMLHELP tag is set to YES, the CHM_FILE tag can
+# be used to specify the file name of the resulting .chm file. You
+# can add a path in front of the file if the result should not be
+# written to the html output directory.
+
+CHM_FILE               =
+
+# If the GENERATE_HTMLHELP tag is set to YES, the HHC_LOCATION tag can
+# be used to specify the location (absolute path including file name) of
+# the HTML help compiler (hhc.exe). If non-empty doxygen will try to run
+# the HTML help compiler on the generated index.hhp.
+
+HHC_LOCATION           =
+
+# If the GENERATE_HTMLHELP tag is set to YES, the GENERATE_CHI flag
+# controls if a separate .chi index file is generated (YES) or that
+# it should be included in the master .chm file (NO).
+
+GENERATE_CHI           = NO
+
+# If the GENERATE_HTMLHELP tag is set to YES, the CHM_INDEX_ENCODING 
+# is used to encode HtmlHelp index (hhk), content (hhc) and project file 
+# content.
+
+CHM_INDEX_ENCODING     = 
+
+# If the GENERATE_HTMLHELP tag is set to YES, the BINARY_TOC flag
+# controls whether a binary table of contents is generated (YES) or a
+# normal table of contents (NO) in the .chm file.
+
+BINARY_TOC             = NO
+
+# The TOC_EXPAND flag can be set to YES to add extra items for group members
+# to the contents of the HTML help documentation and to the tree view.
+
+TOC_EXPAND             = NO
+
+# If the GENERATE_QHP tag is set to YES and both QHP_NAMESPACE and QHP_VIRTUAL_FOLDER 
+# are set, an additional index file will be generated that can be used as input for 
+# Qt's qhelpgenerator to generate a Qt Compressed Help (.qch) of the generated 
+# HTML documentation.
+
+GENERATE_QHP           = NO
+
+# If the QHG_LOCATION tag is specified, the QCH_FILE tag can 
+# be used to specify the file name of the resulting .qch file. 
+# The path specified is relative to the HTML output folder.
+
+QCH_FILE               = 
+
+# The QHP_NAMESPACE tag specifies the namespace to use when generating 
+# Qt Help Project output. For more information please see 
+# http://doc.trolltech.com/qthelpproject.html#namespace
+
+QHP_NAMESPACE          = 
+
+# The QHP_VIRTUAL_FOLDER tag specifies the namespace to use when generating 
+# Qt Help Project output. For more information please see 
+# http://doc.trolltech.com/qthelpproject.html#virtual-folders
+
+QHP_VIRTUAL_FOLDER     = doc
+
+# If QHP_CUST_FILTER_NAME is set, it specifies the name of a custom filter to add. 
+# For more information please see 
+# http://doc.trolltech.com/qthelpproject.html#custom-filters
+
+QHP_CUST_FILTER_NAME   = 
+
+# The QHP_CUST_FILT_ATTRS tag specifies the list of the attributes of the custom filter to add.For more information please see 
+# <a href="http://doc.trolltech.com/qthelpproject.html#custom-filters">Qt Help Project / Custom Filters</a>.
+
+QHP_CUST_FILTER_ATTRS  = 
+
+# The QHP_SECT_FILTER_ATTRS tag specifies the list of the attributes this project's 
+# filter section matches. 
+# <a href="http://doc.trolltech.com/qthelpproject.html#filter-attributes">Qt Help Project / Filter Attributes</a>.
+
+QHP_SECT_FILTER_ATTRS  = 
+
+# If the GENERATE_QHP tag is set to YES, the QHG_LOCATION tag can 
+# be used to specify the location of Qt's qhelpgenerator. 
+# If non-empty doxygen will try to run qhelpgenerator on the generated 
+# .qhp file.
+
+QHG_LOCATION           = 
+
+# The DISABLE_INDEX tag can be used to turn on/off the condensed index at
+# top of each HTML page. The value NO (the default) enables the index and
+# the value YES disables it.
+
+DISABLE_INDEX          = NO
+
+# This tag can be used to set the number of enum values (range [1..20])
+# that doxygen will group on one line in the generated HTML documentation.
+
+ENUM_VALUES_PER_LINE   = 4
+
+# The GENERATE_TREEVIEW tag is used to specify whether a tree-like index 
+# structure should be generated to display hierarchical information. 
+# If the tag value is set to FRAME, a side panel will be generated 
+# containing a tree-like index structure (just like the one that 
+# is generated for HTML Help). For this to work a browser that supports
+# JavaScript, DHTML, CSS and frames is required (for instance Mozilla 1.0+,
+# Netscape 6.0+, Internet explorer 5.0+, or Konqueror). Windows users are
+# probably better off using the HTML help feature. Other possible values 
+# for this tag are: HIERARCHIES, which will generate the Groups, Directories, 
+# and Class Hierarchy pages using a tree view instead of an ordered list; 
+# ALL, which combines the behavior of FRAME and HIERARCHIES; and NONE, which 
+# disables this behavior completely. For backwards compatibility with previous 
+# releases of Doxygen, the values YES and NO are equivalent to FRAME and NONE 
+# respectively.
+
+GENERATE_TREEVIEW      = YES
+
+# If the treeview is enabled (see GENERATE_TREEVIEW) then this tag can be
+# used to set the initial width (in pixels) of the frame in which the tree
+# is shown.
+
+TREEVIEW_WIDTH         = 250
+
+# Use this tag to change the font size of Latex formulas included 
+# as images in the HTML documentation. The default is 10. Note that 
+# when you change the font size after a successful doxygen run you need 
+# to manually remove any form_*.png images from the HTML output directory 
+# to force them to be regenerated.
+
+FORMULA_FONTSIZE       = 10
+
+#---------------------------------------------------------------------------
+# configuration options related to the LaTeX output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_LATEX tag is set to YES (the default) Doxygen will
+# generate Latex output.
+
+GENERATE_LATEX         = NO
+
+# The LATEX_OUTPUT tag is used to specify where the LaTeX docs will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `latex' will be used as the default path.
+
+LATEX_OUTPUT           = latex
+
+# The LATEX_CMD_NAME tag can be used to specify the LaTeX command name to be
+# invoked. If left blank `latex' will be used as the default command name.
+
+LATEX_CMD_NAME         = latex
+
+# The MAKEINDEX_CMD_NAME tag can be used to specify the command name to
+# generate index for LaTeX. If left blank `makeindex' will be used as the
+# default command name.
+
+MAKEINDEX_CMD_NAME     = makeindex
+
+# If the COMPACT_LATEX tag is set to YES Doxygen generates more compact
+# LaTeX documents. This may be useful for small projects and may help to
+# save some trees in general.
+
+COMPACT_LATEX          = NO
+
+# The PAPER_TYPE tag can be used to set the paper type that is used
+# by the printer. Possible values are: a4, a4wide, letter, legal and
+# executive. If left blank a4wide will be used.
+
+PAPER_TYPE             = a4wide
+
+# The EXTRA_PACKAGES tag can be to specify one or more names of LaTeX
+# packages that should be included in the LaTeX output.
+
+EXTRA_PACKAGES         =
+
+# The LATEX_HEADER tag can be used to specify a personal LaTeX header for
+# the generated latex document. The header should contain everything until
+# the first chapter. If it is left blank doxygen will generate a
+# standard header. Notice: only use this tag if you know what you are doing!
+
+LATEX_HEADER           =
+
+# If the PDF_HYPERLINKS tag is set to YES, the LaTeX that is generated
+# is prepared for conversion to pdf (using ps2pdf). The pdf file will
+# contain links (just like the HTML output) instead of page references
+# This makes the output suitable for online browsing using a pdf viewer.
+
+PDF_HYPERLINKS         = NO
+
+# If the USE_PDFLATEX tag is set to YES, pdflatex will be used instead of
+# plain latex in the generated Makefile. Set this option to YES to get a
+# higher quality PDF documentation.
+
+USE_PDFLATEX           = NO
+
+# If the LATEX_BATCHMODE tag is set to YES, doxygen will add the \\batchmode.
+# command to the generated LaTeX files. This will instruct LaTeX to keep
+# running if errors occur, instead of asking the user for help.
+# This option is also used when generating formulas in HTML.
+
+LATEX_BATCHMODE        = NO
+
+# If LATEX_HIDE_INDICES is set to YES then doxygen will not
+# include the index chapters (such as File Index, Compound Index, etc.)
+# in the output.
+
+LATEX_HIDE_INDICES     = NO
+
+#---------------------------------------------------------------------------
+# configuration options related to the RTF output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_RTF tag is set to YES Doxygen will generate RTF output
+# The RTF output is optimized for Word 97 and may not look very pretty with
+# other RTF readers or editors.
+
+GENERATE_RTF           = NO
+
+# The RTF_OUTPUT tag is used to specify where the RTF docs will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `rtf' will be used as the default path.
+
+RTF_OUTPUT             = rtf
+
+# If the COMPACT_RTF tag is set to YES Doxygen generates more compact
+# RTF documents. This may be useful for small projects and may help to
+# save some trees in general.
+
+COMPACT_RTF            = NO
+
+# If the RTF_HYPERLINKS tag is set to YES, the RTF that is generated
+# will contain hyperlink fields. The RTF file will
+# contain links (just like the HTML output) instead of page references.
+# This makes the output suitable for online browsing using WORD or other
+# programs which support those fields.
+# Note: wordpad (write) and others do not support links.
+
+RTF_HYPERLINKS         = NO
+
+# Load stylesheet definitions from file. Syntax is similar to doxygen's
+# config file, i.e. a series of assignments. You only have to provide
+# replacements, missing definitions are set to their default value.
+
+RTF_STYLESHEET_FILE    =
+
+# Set optional variables used in the generation of an rtf document.
+# Syntax is similar to doxygen's config file.
+
+RTF_EXTENSIONS_FILE    =
+
+#---------------------------------------------------------------------------
+# configuration options related to the man page output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_MAN tag is set to YES (the default) Doxygen will
+# generate man pages
+
+GENERATE_MAN           = NO
+
+# The MAN_OUTPUT tag is used to specify where the man pages will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `man' will be used as the default path.
+
+MAN_OUTPUT             = man
+
+# The MAN_EXTENSION tag determines the extension that is added to
+# the generated man pages (default is the subroutine's section .3)
+
+MAN_EXTENSION          = .3
+
+# If the MAN_LINKS tag is set to YES and Doxygen generates man output,
+# then it will generate one additional man file for each entity
+# documented in the real man page(s). These additional files
+# only source the real man page, but without them the man command
+# would be unable to find the correct page. The default is NO.
+
+MAN_LINKS              = NO
+
+#---------------------------------------------------------------------------
+# configuration options related to the XML output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_XML tag is set to YES Doxygen will
+# generate an XML file that captures the structure of
+# the code including all documentation.
+
+GENERATE_XML           = NO
+
+# The XML_OUTPUT tag is used to specify where the XML pages will be put.
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be
+# put in front of it. If left blank `xml' will be used as the default path.
+
+XML_OUTPUT             = xml
+
+# The XML_SCHEMA tag can be used to specify an XML schema,
+# which can be used by a validating XML parser to check the
+# syntax of the XML files.
+
+XML_SCHEMA             =
+
+# The XML_DTD tag can be used to specify an XML DTD,
+# which can be used by a validating XML parser to check the
+# syntax of the XML files.
+
+XML_DTD                =
+
+# If the XML_PROGRAMLISTING tag is set to YES Doxygen will
+# dump the program listings (including syntax highlighting
+# and cross-referencing information) to the XML output. Note that
+# enabling this will significantly increase the size of the XML output.
+
+XML_PROGRAMLISTING     = YES
+
+#---------------------------------------------------------------------------
+# configuration options for the AutoGen Definitions output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_AUTOGEN_DEF tag is set to YES Doxygen will
+# generate an AutoGen Definitions (see autogen.sf.net) file
+# that captures the structure of the code including all
+# documentation. Note that this feature is still experimental
+# and incomplete at the moment.
+
+GENERATE_AUTOGEN_DEF   = NO
+
+#---------------------------------------------------------------------------
+# configuration options related to the Perl module output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_PERLMOD tag is set to YES Doxygen will
+# generate a Perl module file that captures the structure of
+# the code including all documentation. Note that this
+# feature is still experimental and incomplete at the
+# moment.
+
+GENERATE_PERLMOD       = NO
+
+# If the PERLMOD_LATEX tag is set to YES Doxygen will generate
+# the necessary Makefile rules, Perl scripts and LaTeX code to be able
+# to generate PDF and DVI output from the Perl module output.
+
+PERLMOD_LATEX          = NO
+
+# If the PERLMOD_PRETTY tag is set to YES the Perl module output will be
+# nicely formatted so it can be parsed by a human reader. 
+# This is useful 
+# if you want to understand what is going on. 
+# On the other hand, if this 
+# tag is set to NO the size of the Perl module output will be much smaller
+# and Perl will parse it just the same.
+
+PERLMOD_PRETTY         = YES
+
+# The names of the make variables in the generated doxyrules.make file
+# are prefixed with the string contained in PERLMOD_MAKEVAR_PREFIX.
+# This is useful so different doxyrules.make files included by the same
+# Makefile don't overwrite each other's variables.
+
+PERLMOD_MAKEVAR_PREFIX =
+
+#---------------------------------------------------------------------------
+# Configuration options related to the preprocessor
+#---------------------------------------------------------------------------
+
+# If the ENABLE_PREPROCESSING tag is set to YES (the default) Doxygen will
+# evaluate all C-preprocessor directives found in the sources and include
+# files.
+
+ENABLE_PREPROCESSING   = YES
+
+# If the MACRO_EXPANSION tag is set to YES Doxygen will expand all macro
+# names in the source code. If set to NO (the default) only conditional
+# compilation will be performed. Macro expansion can be done in a controlled
+# way by setting EXPAND_ONLY_PREDEF to YES.
+
+MACRO_EXPANSION        = NO
+
+# If the EXPAND_ONLY_PREDEF and MACRO_EXPANSION tags are both set to YES
+# then the macro expansion is limited to the macros specified with the
+# PREDEFINED and EXPAND_AS_DEFINED tags.
+
+EXPAND_ONLY_PREDEF     = NO
+
+# If the SEARCH_INCLUDES tag is set to YES (the default) the includes files
+# in the INCLUDE_PATH (see below) will be search if a #include is found.
+
+SEARCH_INCLUDES        = YES
+
+# The INCLUDE_PATH tag can be used to specify one or more directories that
+# contain include files that are not input files but should be processed by
+# the preprocessor.
+
+INCLUDE_PATH           =
+
+# You can use the INCLUDE_FILE_PATTERNS tag to specify one or more wildcard
+# patterns (like *.h and *.hpp) to filter out the header-files in the
+# directories. If left blank, the patterns specified with FILE_PATTERNS will
+# be used.
+
+INCLUDE_FILE_PATTERNS  = *.h
+
+# The PREDEFINED tag can be used to specify one or more macro names that
+# are defined before the preprocessor is started (similar to the -D option of
+# gcc). The argument of the tag is a list of macros of the form: name
+# or name=definition (no spaces). If the definition and the = are
+# omitted =1 is assumed. To prevent a macro definition from being
+# undefined via #undef or recursively expanded use the := operator
+# instead of the = operator.
+
+PREDEFINED             = HAVE_CONFIG_H
+
+# If the MACRO_EXPANSION and EXPAND_ONLY_PREDEF tags are set to YES then
+# this tag can be used to specify a list of macro names that should be expanded.
+# The macro definition that is found in the sources will be used.
+# Use the PREDEFINED tag if you want to use a different macro definition.
+
+EXPAND_AS_DEFINED      =
+
+# If the SKIP_FUNCTION_MACROS tag is set to YES (the default) then
+# doxygen's preprocessor will remove all function-like macros that are alone
+# on a line, have an all uppercase name, and do not end with a semicolon. Such
+# function macros are typically used for boiler-plate code, and will confuse
+# the parser if not removed.
+
+SKIP_FUNCTION_MACROS   = YES
+
+#---------------------------------------------------------------------------
+# Configuration::additions related to external references
+#---------------------------------------------------------------------------
+
+# The TAGFILES option can be used to specify one or more tagfiles.
+# Optionally an initial location of the external documentation
+# can be added for each tagfile. The format of a tag file without
+# this location is as follows:
+#  
+#   TAGFILES = file1 file2 ...
+# Adding location for the tag files is done as follows:
+#  
+#   TAGFILES = file1=loc1 "file2 = loc2" ...
+# where "loc1" and "loc2" can be relative or absolute paths or
+# URLs. If a location is present for each tag, the installdox tool
+# does not have to be run to correct the links.
+# Note that each tag file must have a unique name
+# (where the name does NOT include the path)
+# If a tag file is not located in the directory in which doxygen
+# is run, you must also specify the path to the tagfile here.
+
+TAGFILES               =
+
+# When a file name is specified after GENERATE_TAGFILE, doxygen will create
+# a tag file that is based on the input files it reads.
+
+GENERATE_TAGFILE       =
+
+# If the ALLEXTERNALS tag is set to YES all external classes will be listed
+# in the class index. If set to NO only the inherited external classes
+# will be listed.
+
+ALLEXTERNALS           = NO
+
+# If the EXTERNAL_GROUPS tag is set to YES all external groups will be listed
+# in the modules index. If set to NO, only the current project's groups will
+# be listed.
+
+EXTERNAL_GROUPS        = YES
+
+# The PERL_PATH should be the absolute path and name of the perl script
+# interpreter (i.e. the result of `which perl').
+
+PERL_PATH              = /usr/bin/perl
+
+#---------------------------------------------------------------------------
+# Configuration options related to the dot tool
+#---------------------------------------------------------------------------
+
+# If the CLASS_DIAGRAMS tag is set to YES (the default) Doxygen will
+# generate a inheritance diagram (in HTML, RTF and LaTeX) for classes with base
+# or super classes. Setting the tag to NO turns the diagrams off. Note that
+# this option is superseded by the HAVE_DOT option below. This is only a
+# fallback. It is recommended to install and use dot, since it yields more
+# powerful graphs.
+
+CLASS_DIAGRAMS         = YES
+
+# You can define message sequence charts within doxygen comments using the \msc
+# command. Doxygen will then run the mscgen tool (see
+# http://www.mcternan.me.uk/mscgen/) to produce the chart and insert it in the
+# documentation. The MSCGEN_PATH tag allows you to specify the directory where
+# the mscgen tool resides. If left empty the tool is assumed to be found in the
+# default search path.
+
+MSCGEN_PATH            =
+
+# If set to YES, the inheritance and collaboration graphs will hide
+# inheritance and usage relations if the target is undocumented
+# or is not a class.
+
+HIDE_UNDOC_RELATIONS   = YES
+
+# If you set the HAVE_DOT tag to YES then doxygen will assume the dot tool is
+# available from the path. This tool is part of Graphviz, a graph visualization
+# toolkit from AT&T and Lucent Bell Labs. The other options in this section
+# have no effect if this option is set to NO (the default)
+
+HAVE_DOT               = YES
+
+# By default doxygen will write a font called FreeSans.ttf to the output 
+# directory and reference it in all dot files that doxygen generates. This 
+# font does not include all possible unicode characters however, so when you need 
+# these (or just want a differently looking font) you can specify the font name 
+# using DOT_FONTNAME. You need need to make sure dot is able to find the font, 
+# which can be done by putting it in a standard location or by setting the 
+# DOTFONTPATH environment variable or by setting DOT_FONTPATH to the directory 
+# containing the font.
+
+DOT_FONTNAME           = FreeSans
+
+# The DOT_FONTSIZE tag can be used to set the size of the font of dot graphs. 
+# The default size is 10pt.
+
+DOT_FONTSIZE           = 10
+
+# By default doxygen will tell dot to use the output directory to look for the 
+# FreeSans.ttf font (which doxygen will put there itself). If you specify a 
+# different font using DOT_FONTNAME you can set the path where dot 
+# can find it using this tag.
+
+DOT_FONTPATH           = 
+
+# If the CLASS_GRAPH and HAVE_DOT tags are set to YES then doxygen
+# will generate a graph for each documented class showing the direct and
+# indirect inheritance relations. Setting this tag to YES will force the
+# the CLASS_DIAGRAMS tag to NO.
+
+CLASS_GRAPH            = YES
+
+# If the COLLABORATION_GRAPH and HAVE_DOT tags are set to YES then doxygen
+# will generate a graph for each documented class showing the direct and
+# indirect implementation dependencies (inheritance, containment, and
+# class references variables) of the class with other documented classes.
+
+COLLABORATION_GRAPH    = YES
+
+# If the GROUP_GRAPHS and HAVE_DOT tags are set to YES then doxygen
+# will generate a graph for groups, showing the direct groups dependencies
+
+GROUP_GRAPHS           = YES
+
+# If the UML_LOOK tag is set to YES doxygen will generate inheritance and
+# collaboration diagrams in a style similar to the OMG's Unified Modeling
+# Language.
+
+UML_LOOK               = NO
+
+# If set to YES, the inheritance and collaboration graphs will show the
+# relations between templates and their instances.
+
+TEMPLATE_RELATIONS     = YES
+
+# If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDE_GRAPH, and HAVE_DOT
+# tags are set to YES then doxygen will generate a graph for each documented
+# file showing the direct and indirect include dependencies of the file with
+# other documented files.
+
+INCLUDE_GRAPH          = YES
+
+# If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDED_BY_GRAPH, and
+# HAVE_DOT tags are set to YES then doxygen will generate a graph for each
+# documented header file showing the documented files that directly or
+# indirectly include this file.
+
+INCLUDED_BY_GRAPH      = YES
+
+# If the CALL_GRAPH and HAVE_DOT options are set to YES then
+# doxygen will generate a call dependency graph for every global function
+# or class method. Note that enabling this option will significantly increase
+# the time of a run. So in most cases it will be better to enable call graphs
+# for selected functions only using the \callgraph command.
+
+CALL_GRAPH             = NO
+
+# If the CALLER_GRAPH and HAVE_DOT tags are set to YES then
+# doxygen will generate a caller dependency graph for every global function
+# or class method. Note that enabling this option will significantly increase
+# the time of a run. So in most cases it will be better to enable caller
+# graphs for selected functions only using the \callergraph command.
+
+CALLER_GRAPH           = NO
+
+# If the GRAPHICAL_HIERARCHY and HAVE_DOT tags are set to YES then doxygen
+# will graphical hierarchy of all classes instead of a textual one.
+
+GRAPHICAL_HIERARCHY    = YES
+
+# If the DIRECTORY_GRAPH, SHOW_DIRECTORIES and HAVE_DOT tags are set to YES
+# then doxygen will show the dependencies a directory has on other directories
+# in a graphical way. The dependency relations are determined by the #include
+# relations between the files in the directories.
+
+DIRECTORY_GRAPH        = YES
+
+# The DOT_IMAGE_FORMAT tag can be used to set the image format of the images
+# generated by dot. Possible values are png, jpg, or gif
+# If left blank png will be used.
+
+DOT_IMAGE_FORMAT       = png
+
+# The tag DOT_PATH can be used to specify the path where the dot tool can be
+# found. If left blank, it is assumed the dot tool can be found in the path.
+
+DOT_PATH               =
+
+# The DOTFILE_DIRS tag can be used to specify one or more directories that
+# contain dot files that are included in the documentation (see the
+# \dotfile command).
+
+DOTFILE_DIRS           =
+
+# The DOT_GRAPH_MAX_NODES tag can be used to set the maximum number of 
+# nodes that will be shown in the graph. If the number of nodes in a graph
+# becomes larger than this value, doxygen will truncate the graph, which is
+# visualized by representing a node as a red box. Note that doxygen if the
+# number of direct children of the root node in a graph is already larger than
+# DOT_GRAPH_MAX_NODES then the graph will not be shown at all. Also note
+# that the size of a graph can be further restricted by MAX_DOT_GRAPH_DEPTH.
+
+DOT_GRAPH_MAX_NODES    = 50
+
+# The MAX_DOT_GRAPH_DEPTH tag can be used to set the maximum depth of the
+# graphs generated by dot. A depth value of 3 means that only nodes reachable
+# from the root by following a path via at most 3 edges will be shown. Nodes
+# that lay further from the root node will be omitted. Note that setting this
+# option to 1 or 2 may greatly reduce the computation time needed for large
+# code bases. Also note that the size of a graph can be further restricted by
+# DOT_GRAPH_MAX_NODES. Using a depth of 0 means no depth restriction.
+
+MAX_DOT_GRAPH_DEPTH    = 0
+
+# Set the DOT_TRANSPARENT tag to YES to generate images with a transparent
+# background. This is disabled by default, because dot on Windows does not 
+# seem to support this out of the box. Warning: Depending on the platform used, 
+# enabling this option may lead to badly anti-aliased labels on the edges of 
+# a graph (i.e. they become hard to read).
+
+DOT_TRANSPARENT        = NO
+
+# Set the DOT_MULTI_TARGETS tag to YES allow dot to generate multiple output
+# files in one run (i.e. multiple -o and -T options on the command line). This
+# makes dot run faster, but since only newer versions of dot (>1.8.10)
+# support this, this feature is disabled by default.
+
+DOT_MULTI_TARGETS      = NO
+
+# If the GENERATE_LEGEND tag is set to YES (the default) Doxygen will
+# generate a legend page explaining the meaning of the various boxes and
+# arrows in the dot generated graphs.
+
+GENERATE_LEGEND        = YES
+
+# If the DOT_CLEANUP tag is set to YES (the default) Doxygen will
+# remove the intermediate dot files that are used to generate
+# the various graphs.
+
+DOT_CLEANUP            = YES
+
+#---------------------------------------------------------------------------
+# Options related to the search engine
+#---------------------------------------------------------------------------
+
+# The SEARCHENGINE tag specifies whether or not a search engine should be
+# used. If set to NO the values of all tags below this one will be ignored.
+
+SEARCHENGINE           = NO

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-05-24 00:47:49 UTC (rev 1900)
+++ trunk/Makefile.am	2009-05-24 01:08:16 UTC (rev 1901)
@@ -11,16 +11,24 @@
 
 SUBDIRS = src doc
 
-EXTRA_DIST = Doxyfile
+EXTRA_DIST = \
+	Doxyfile.in \
+	tools/logger.pl
 
 docs: pdf html doxygen
 
+Doxyfile: $(srcdir)/Doxyfile.in
+	sed -e 's, at srcdir\@,$(srcdir),' $< > $@
+
 doxygen::
-	(cd $(srcdir) && doxygen Doxyfile 2>&1 | perl tools/logger.pl ) > doxygen.log
+	$(MAKE) Doxyfile
+	doxygen Doxyfile 2>&1 | perl $(srcdir)/tools/logger.pl > doxygen.log
 
-doxygen-clean:
-	rm -f -r doxygen doxygen.log
+distclean-local:
+	rm -rf Doxyfile doxygen
 
+DISTCLEANFILES = doxygen.log
+
 MAINTAINERCLEANFILES = \
 	configure \
 	Makefile.in \



From zwelch at mail.berlios.de  Sun May 24 03:33:58 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 03:33:58 +0200
Subject: [Openocd-svn] r1902 - trunk/doc
Message-ID: <200905240133.n4O1XwIH008117@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 03:33:54 +0200 (Sun, 24 May 2009)
New Revision: 1902

Modified:
   trunk/doc/openocd.texi
Log:
Fix two problems with openocd.texi:
- Fix minor issues with xrefs not liking parentheses around them.
- Change 'Building' section to 'Building OpenOCD'.  It reads better.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-24 01:08:16 UTC (rev 1901)
+++ trunk/doc/openocd.texi	2009-05-24 01:33:54 UTC (rev 1902)
@@ -53,7 +53,7 @@
 @menu
 * About::                            About OpenOCD
 * Developers::                       OpenOCD Developers
-* Building::                         Building OpenOCD
+* Building OpenOCD::                 Building OpenOCD From SVN
 * JTAG Hardware Dongles::            JTAG Hardware Dongles
 * Running::                          Running OpenOCD
 * Simple Configuration Files::       Simple Configuration Files
@@ -140,9 +140,9 @@
 
 @section OpenOCD Subversion Repository
 
-The ``Building From Source'' section (@xref{Building}) provides
-instructions to retrieve and and build the latest version of the OpenOCD
-source code.
+The ``Building From Source'' section provides instructions to retrieve
+and and build the latest version of the OpenOCD source code.
+ at xref{Building OpenOCD}.
 
 Developers that want to contribute patches to the OpenOCD system are
 @b{strongly} encouraged to base their work off of the most recent trunk
@@ -174,7 +174,7 @@
 
 	@uref{https://lists.berlios.de/mailman/listinfo/openocd-svn}
 
- at node Building
+ at node Building OpenOCD
 @chapter Building OpenOCD
 @cindex building
 



From zwelch at mail.berlios.de  Sun May 24 03:38:27 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 03:38:27 +0200
Subject: [Openocd-svn] r1903 - in trunk: doc src/flash src/target/board
Message-ID: <200905240138.n4O1cRBH008365@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 03:38:19 +0200 (Sun, 24 May 2009)
New Revision: 1903

Added:
   trunk/src/flash/davinci_nand.c
Modified:
   trunk/doc/openocd.texi
   trunk/src/flash/Makefile.am
   trunk/src/flash/nand.c
   trunk/src/target/board/dm355evm.cfg
Log:
David Brownell <david-b at pacbell.net>:

NAND support for DaVinci-family drivers, with HW ECC support.
Declare the NAND chip on the DM355 EVM board.

Currently tested on DM355 for Linux interop using the standard
large page (2KB) chip in the EVM socket; "hwecc1" and "hwecc4"
work fine.  (Using hwecc4 relies on patches that haven't quite
made it through the Linux-MTD bottlenecks yet.)

Not yet tested:  1-bit on small-page (although it's hard to see
how that could fail); 4-bit on small page (picky layout issues);
the "hwecc_infix" mode (primarily for older boot ROMs; testing
there is blocked on having new bootloader code).


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-24 01:33:54 UTC (rev 1902)
+++ trunk/doc/openocd.texi	2009-05-24 01:38:19 UTC (rev 1903)
@@ -2804,6 +2804,23 @@
 driver-specific options and behaviors.
 Some controllers also activate controller-specific commands.
 
+ at deffn {NAND Driver} davinci
+This driver handles the NAND controllers found on DaVinci family
+chips from Texas Instruments.
+It takes three extra parameters:
+address of the NAND chip;
+hardware ECC mode to use (hwecc1, hwecc4, hwecc4_infix);
+address of the AEMIF controller on this processor.
+ at example
+nand device davinci dm355.arm 0x02000000 hwecc4 0x01e10000
+ at end example
+All DaVinci processors support the single-bit ECC hardware,
+and newer ones also support the four-bit ECC hardware.
+The @code{write_page} and @code{read_page} methods are used
+to implement those ECC modes, unless they are disabled using
+the @command{nand raw_access} command.
+ at end deffn
+
 @deffn {NAND Driver} lpc3180
 These controllers require an extra @command{nand device}
 parameter:  the clock rate used by the controller.

Modified: trunk/src/flash/Makefile.am
===================================================================
--- trunk/src/flash/Makefile.am	2009-05-24 01:33:54 UTC (rev 1902)
+++ trunk/src/flash/Makefile.am	2009-05-24 01:38:19 UTC (rev 1903)
@@ -6,7 +6,7 @@
 METASOURCES = AUTO
 noinst_LTLIBRARIES = libflash.la
 libflash_la_SOURCES = \
-	flash.c lpc2000.c cfi.c non_cfi.c at91sam7.c \
+	flash.c lpc2000.c cfi.c non_cfi.c at91sam7.c davinci_nand.c \
 	str7x.c str9x.c aduc702x.c nand.c nand_ecc.c nand_ecc_kw.c \
 	lpc3180_nand_controller.c stellaris.c str9xpec.c stm32x.c tms470.c \
 	ecos.c orion_nand.c s3c24xx_nand.c s3c2410_nand.c s3c2412_nand.c \

Added: trunk/src/flash/davinci_nand.c
===================================================================
--- trunk/src/flash/davinci_nand.c	2009-05-24 01:33:54 UTC (rev 1902)
+++ trunk/src/flash/davinci_nand.c	2009-05-24 01:38:19 UTC (rev 1903)
@@ -0,0 +1,744 @@
+/***************************************************************************
+ *   Copyright (C) 2009 by David Brownell                                  *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+/*
+ * DaVinci family NAND controller support for OpenOCD.
+ *
+ * This driver uses hardware ECC (1-bit or 4-bit) unless
+ * the chip is accessed in "raw" mode.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "nand.h"
+
+
+enum ecc {
+	HWECC1,		/* all controllers support 1-bit ECC */
+	HWECC4,		/* newer chips also have 4-bit ECC hardware */
+	HWECC4_INFIX,	/* avoid this layout, except maybe for boot code */
+};
+
+struct davinci_nand {
+	target_t	*target;
+
+	u8		chipsel;	/* chipselect 0..3 == CS2..CS5 */
+	u8		eccmode;
+
+	/* Async EMIF controller base */
+	u32		aemif;
+
+	/* NAND chip addresses */
+	u32		data;		/* without CLE or ALE */
+	u32		cmd;		/* with CLE */
+	u32		addr;		/* with ALE */
+
+	/* page i/o for the relevant flavor of hardware ECC */
+	int (*read_page)(struct nand_device_s *nand, u32 page,
+			u8 *data, u32 data_size, u8 *oob, u32 oob_size);
+	int (*write_page)(struct nand_device_s *nand, u32 page,
+			u8 *data, u32 data_size, u8 *oob, u32 oob_size);
+};
+
+#define NANDFCR		0x60		/* flash control register */
+#define NANDFSR		0x64		/* flash status register */
+#define NANDFECC	0x70		/* 1-bit ECC data, CS0, 1st of 4 */
+#define NAND4BITECCLOAD	0xbc		/* 4-bit ECC, load saved values */
+#define NAND4BITECC	0xc0		/* 4-bit ECC data, 1st of 4 */
+#define NANDERRADDR	0xd0		/* 4-bit ECC err addr, 1st of 2 */
+#define NANDERRVAL	0xd8		/* 4-bit ECC err value, 1st of 2 */
+
+static int halted(target_t *target, const char *label)
+{
+	if (target->state == TARGET_HALTED)
+		return true;
+
+	LOG_ERROR("Target must be halted to use NAND controller (%s)", label);
+	return false;
+}
+
+static int davinci_register_commands(struct command_context_s *cmd_ctx)
+{
+	return ERROR_OK;
+}
+
+static int davinci_init(struct nand_device_s *nand)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+	u32 nandfcr;
+
+	if (!halted(target, "init"))
+		return ERROR_NAND_OPERATION_FAILED;
+
+	/* We require something else to have configured AEMIF to talk
+	 * to NAND chip in this range (including timings and width).
+	 */
+	target_read_u32(target, info->aemif + NANDFCR, &nandfcr);
+	if (!(nandfcr & (1 << info->chipsel))) {
+		LOG_ERROR("chip address %08x not NAND-enabled?", info->data);
+		return ERROR_NAND_OPERATION_FAILED;
+	}
+
+	/* REVISIT verify:  AxCR must be in 8-bit mode, since that's all we
+	 * tested.  16 bit support should work too; but not with 4-bit ECC.
+	 */
+
+	return ERROR_OK;
+}
+
+static int davinci_reset(struct nand_device_s *nand)
+{
+	return ERROR_OK;
+}
+
+static int davinci_nand_ready(struct nand_device_s *nand, int timeout)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+	u32 nandfsr;
+
+	/* NOTE: return code is zero/error, else success; not ERROR_* */
+
+	if (!halted(target, "ready"))
+		return 0;
+
+	do {
+		target_read_u32(target, info->aemif + NANDFSR, &nandfsr);
+
+		if (nandfsr & 0x01)
+			return 1;
+
+		alive_sleep(1);
+	} while (timeout-- > 0);
+
+	return 0;
+}
+
+static int davinci_command(struct nand_device_s *nand, u8 command)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+
+	if (!halted(target, "command"))
+		return ERROR_NAND_OPERATION_FAILED;
+
+	target_write_u8(target, info->cmd, command);
+	return ERROR_OK;
+}
+
+static int davinci_address(struct nand_device_s *nand, u8 address)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+
+	if (!halted(target, "address"))
+		return ERROR_NAND_OPERATION_FAILED;
+
+	target_write_u8(target, info->addr, address);
+	return ERROR_OK;
+}
+
+static int davinci_write_data(struct nand_device_s *nand, u16 data)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+
+	if (!halted(target, "write_data"))
+		return ERROR_NAND_OPERATION_FAILED;
+
+	target_write_u8(target, info->data, data);
+	return ERROR_OK;
+}
+
+static int davinci_read_data(struct nand_device_s *nand, void *data)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+
+	if (!halted(target, "read_data"))
+		return ERROR_NAND_OPERATION_FAILED;
+
+	target_read_u8(target, info->data, data);
+	return ERROR_OK;
+}
+
+/* REVISIT a bit of native code should let block I/O be MUCH faster */
+
+static int davinci_read_block_data(struct nand_device_s *nand,
+		u8 *data, int data_size)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+	u32 nfdata = info->data;
+	u32 tmp;
+
+	if (!halted(target, "read_block"))
+		return ERROR_NAND_OPERATION_FAILED;
+
+	while (data_size >= 4) {
+		target_read_u32(target, nfdata, &tmp);
+
+		data[0] = tmp;
+		data[1] = tmp >> 8;
+		data[2] = tmp >> 16;
+		data[3] = tmp >> 24;
+
+		data_size -= 4;
+		data += 4;
+	}
+
+	while (data_size > 0) {
+		target_read_u8(target, nfdata, data);
+
+		data_size -= 1;
+		data += 1;
+	}
+
+	return ERROR_OK;
+}
+
+static int davinci_write_block_data(struct nand_device_s *nand,
+		u8 *data, int data_size)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+	u32 nfdata = info->data;
+	u32 tmp;
+
+	if (!halted(target, "write_block"))
+		return ERROR_NAND_OPERATION_FAILED;
+
+	while (data_size >= 4) {
+		tmp = le_to_h_u32(data);
+		target_write_u32(target, nfdata, tmp);
+
+		data_size -= 4;
+		data += 4;
+	}
+
+	while (data_size > 0) {
+		target_write_u8(target, nfdata, *data);
+
+		data_size -= 1;
+		data += 1;
+	}
+
+	return ERROR_OK;
+}
+
+static int davinci_write_page(struct nand_device_s *nand, u32 page,
+		u8 *data, u32 data_size, u8 *oob, u32 oob_size)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	u8 *ooballoc = NULL;
+	int status;
+
+	if (!nand->device)
+		return ERROR_NAND_DEVICE_NOT_PROBED;
+	if (!halted(info->target, "write_page"))
+		return ERROR_NAND_OPERATION_FAILED;
+
+	/* Always write both data and OOB ... we are not "raw" I/O! */
+	if (!data)
+		return ERROR_NAND_OPERATION_FAILED;
+
+	/* If we're not given OOB, write 0xff where we don't write ECC codes. */
+	switch (nand->page_size) {
+	case 512:
+		oob_size = 16;
+		break;
+	case 2048:
+		oob_size = 64;
+		break;
+	case 4096:
+		oob_size = 128;
+		break;
+	default:
+		return ERROR_NAND_OPERATION_FAILED;
+	}
+	if (!oob) {
+		ooballoc = malloc(oob_size);
+		if (ooballoc)
+			return ERROR_NAND_OPERATION_FAILED;
+		oob = ooballoc;
+		memset(oob, 0x0ff, oob_size);
+	}
+
+	status = info->write_page(nand, page, data, data_size, oob, oob_size);
+	free(ooballoc);
+	return status;
+}
+
+static int davinci_read_page(struct nand_device_s *nand, u32 page,
+		u8 *data, u32 data_size, u8 *oob, u32 oob_size)
+{
+	struct davinci_nand *info = nand->controller_priv;
+
+	if (!nand->device)
+		return ERROR_NAND_DEVICE_NOT_PROBED;
+	if (!halted(info->target, "read_page"))
+		return ERROR_NAND_OPERATION_FAILED;
+
+	return info->read_page(nand, page, data, data_size, oob, oob_size);
+}
+
+static void davinci_write_pagecmd(struct nand_device_s *nand, u8 cmd, u32 page)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+	int page3 = nand->address_cycles - (nand->page_size == 512);
+
+	/* write command ({page,otp}x{read,program} */
+	target_write_u8(target, info->cmd, cmd);
+
+	/* column address (beginning-of-page) */
+	target_write_u8(target, info->addr, 0);
+	if (nand->page_size > 512)
+		target_write_u8(target, info->addr, 0);
+
+	/* page address */
+	target_write_u8(target, info->addr, page);
+	target_write_u8(target, info->addr, page >> 8);
+	if (page3)
+		target_write_u8(target, info->addr, page >> 16);
+	if (page3 == 2)
+		target_write_u8(target, info->addr, page >> 24);
+}
+
+static int davinci_writepage_tail(struct nand_device_s *nand,
+		u8 *oob, u32 oob_size)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+	u8 status;
+
+	if (oob_size)
+		davinci_write_block_data(nand, oob, oob_size);
+
+	/* non-cachemode page program */
+	target_write_u8(target, info->cmd, NAND_CMD_PAGEPROG);
+
+	if (!davinci_nand_ready(nand, 100))
+		return ERROR_NAND_OPERATION_TIMEOUT;
+
+	if (nand_read_status(nand, &status) != ERROR_OK) {
+		LOG_ERROR("couldn't read status");
+		return ERROR_NAND_OPERATION_FAILED;
+	}
+
+	if (status & NAND_STATUS_FAIL) {
+		LOG_ERROR("write operation failed, status: 0x%02x", status);
+		return ERROR_NAND_OPERATION_FAILED;
+	}
+
+	return ERROR_OK;
+}
+
+/*
+ * All DaVinci family chips support 1-bit ECC on a per-chipselect basis.
+ */
+static int davinci_write_page_ecc1(struct nand_device_s *nand, u32 page,
+		u8 *data, u32 data_size, u8 *oob, u32 oob_size)
+{
+	unsigned oob_offset;
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+	const u32 fcr_addr = info->aemif + NANDFCR;
+	const u32 ecc1_addr = info->aemif + NANDFECC + info->chipsel;
+	u32 fcr, ecc1;
+
+	/* Write contiguous ECC bytes starting at specified offset.
+	 * NOTE: Linux reserves twice as many bytes as we need; and
+	 * for 16-bit OOB, those extra bytes are discontiguous.
+	 */
+	switch (nand->page_size) {
+	case 512:
+		oob_offset = 0;
+		break;
+	case 2048:
+		oob_offset = 40;
+		break;
+	default:
+		oob_offset = 80;
+		break;
+	}
+
+	davinci_write_pagecmd(nand, NAND_CMD_SEQIN, page);
+
+	/* scrub any old ECC state */
+	target_read_u32(target, ecc1_addr, &ecc1);
+
+	target_read_u32(target, fcr_addr, &fcr);
+	fcr |= 1 << (8 + info->chipsel);
+
+	do {
+		/* set "start csX 1bit ecc" bit */
+		target_write_u32(target, fcr_addr, fcr);
+
+		/* write 512 bytes */
+		davinci_write_block_data(nand, data, 512);
+		data += 512;
+		data_size -= 512;
+
+		/* read the ecc, pack to 3 bytes, and invert so the ecc
+		 * in an erased block is correct
+		 */
+		target_read_u32(target, ecc1_addr, &ecc1);
+		ecc1 = (ecc1 & 0x0fff) | ((ecc1 & 0x0fff0000) >> 4);
+		ecc1 = ~ecc1;
+
+		/* save correct ECC code into oob data */
+		oob[oob_offset++] = (u8)(ecc1);
+		oob[oob_offset++] = (u8)(ecc1 >> 8);
+		oob[oob_offset++] = (u8)(ecc1 >> 16);
+
+	} while (data_size);
+
+	/* write OOB into spare area */
+	return davinci_writepage_tail(nand, oob, oob_size);
+}
+
+/*
+ * Preferred "new style" ECC layout for use with 4-bit ECC.  This somewhat
+ * slows down large page reads done with error correction (since the OOB
+ * is read first, so its ECC data can be used incrementally), but the
+ * manufacturer bad block markers are safe.  Contrast:  old "infix" style.
+ */
+static int davinci_write_page_ecc4(struct nand_device_s *nand, u32 page,
+		u8 *data, u32 data_size, u8 *oob, u32 oob_size)
+{
+	static const u8 ecc512[] = {
+		0, 1, 2, 3, 4, /* 5== mfr badblock */
+		6, 7, /* 8..12 for BBT or JFFS2 */ 13, 14, 15,
+	};
+	static const u8 ecc2048[] = {
+		24, 25, 26, 27, 28, 29, 30, 31, 32, 33,
+		34, 35, 36, 37, 38, 39, 40, 41, 42, 43,
+		44, 45, 46, 47, 48, 49, 50, 51, 52, 53,
+		54, 55, 56, 57, 58, 59, 60, 61, 62, 63,
+	};
+	static const u8 ecc4096[] = {
+		 48,  49,  50,  51,  52,  53,  54,  55,  56,  57,
+		 58,  59,  60,  61,  62,  63,  64,  65,  66,  67,
+		 68,  69,  70,  71,  72,  73,  74,  75,  76,  77,
+		 78,  79,  80,  81,  82,  83,  84,  85,  86,  87,
+		 88,  89,  90,  91,  92,  93,  94,  95,  96,  97,
+		 98,  99, 100, 101, 102, 103, 104, 105, 106, 107,
+		108, 109, 110, 111, 112, 113, 114, 115, 116, 117,
+		118, 119, 120, 121, 122, 123, 124, 125, 126, 127,
+	};
+
+	struct davinci_nand *info = nand->controller_priv;
+	const u8 *l;
+	target_t *target = info->target;
+	const u32 fcr_addr = info->aemif + NANDFCR;
+	const u32 ecc4_addr = info->aemif + NAND4BITECC;
+	u32 fcr, ecc4;
+
+	/* Use the same ECC layout Linux uses.  For small page chips
+	 * it's a bit cramped.
+	 *
+	 * NOTE:  at this writing, 4KB pages have issues in Linux
+	 * because they need more than 64 bytes of ECC data, which
+	 * the standard ECC logic can't handle.
+	 */
+	switch (nand->page_size) {
+	case 512:
+		l = ecc512;
+		break;
+	case 2048:
+		l = ecc2048;
+		break;
+	default:
+		l = ecc4096;
+		break;
+	}
+
+	davinci_write_pagecmd(nand, NAND_CMD_SEQIN, page);
+
+	/* scrub any old ECC state */
+	target_read_u32(target, info->aemif + NANDERRVAL, &ecc4);
+
+	target_read_u32(target, fcr_addr, &fcr);
+	fcr &= ~(0x03 << 4);
+	fcr |= (1 << 12) | (info->chipsel << 4);
+
+	do {
+		u32 raw_ecc[4], *p;
+		int i;
+
+		/* start 4bit ecc on csX */
+		target_write_u32(target, fcr_addr, fcr);
+
+		/* write 512 bytes */
+		davinci_write_block_data(nand, data, 512);
+		data += 512;
+		data_size -= 512;
+
+		/* read the ecc, then save it into 10 bytes in the oob */
+		for (i = 0; i < 4; i++) {
+			target_read_u32(target, ecc4_addr + 4 * i, &raw_ecc[i]);
+			raw_ecc[i] &= 0x03ff03ff;
+		}
+		for (i = 0, p = raw_ecc; i < 2; i++, p += 2) {
+			oob[*l++] =   p[0]        & 0xff;
+			oob[*l++] = ((p[0] >>  8) & 0x03) | ((p[0] >> 14) & 0xfc);
+			oob[*l++] = ((p[0] >> 22) & 0x0f) | ((p[1] <<  4) & 0xf0);
+			oob[*l++] = ((p[1] >>  4) & 0x3f) | ((p[1] >> 10) & 0xc0);
+			oob[*l++] =  (p[1] >> 18) & 0xff;
+		}
+
+	} while (data_size);
+
+	/* write OOB into spare area */
+	return davinci_writepage_tail(nand, oob, oob_size);
+}
+
+/*
+ * "Infix" OOB ... like Linux ECC_HW_SYNDROME.  Avoided because it trashes
+ * manufacturer bad block markers, except on small page chips.  Once you
+ * write to a page using this scheme, you need specialized code to update
+ * it (code which ignores now-invalid bad block markers).
+ *
+ * This is needed *only* to support older firmware.  Older ROM Boot Loaders
+ * need it to read their second stage loader (UBL) into SRAM, but from then
+ * on the whole system can use the cleaner non-infix layouts.  Systems with
+ * older second stage loaders (ABL/U-Boot, etc) or other system software
+ * (MVL 4.x/5.x kernels, filesystems, etc) may need it more generally.
+ */
+static int davinci_write_page_ecc4infix(struct nand_device_s *nand, u32 page,
+		u8 *data, u32 data_size, u8 *oob, u32 oob_size)
+{
+	struct davinci_nand *info = nand->controller_priv;
+	target_t *target = info->target;
+	const u32 fcr_addr = info->aemif + NANDFCR;
+	const u32 ecc4_addr = info->aemif + NAND4BITECC;
+	u32 fcr, ecc4;
+
+	davinci_write_pagecmd(nand, NAND_CMD_SEQIN, page);
+
+	/* scrub any old ECC state */
+	target_read_u32(target, info->aemif + NANDERRVAL, &ecc4);
+
+	target_read_u32(target, fcr_addr, &fcr);
+	fcr &= ~(0x03 << 4);
+	fcr |= (1 << 12) | (info->chipsel << 4);
+
+	do {
+		u32 raw_ecc[4], *p;
+		u8 *l;
+		int i;
+
+		/* start 4bit ecc on csX */
+		target_write_u32(target, fcr_addr, fcr);
+
+		/* write 512 bytes */
+		davinci_write_block_data(nand, data, 512);
+		data += 512;
+		data_size -= 512;
+
+		/* read the ecc */
+		for (i = 0; i < 4; i++) {
+			target_read_u32(target, ecc4_addr + 4 * i, &raw_ecc[i]);
+			raw_ecc[i] &= 0x03ff03ff;
+		}
+
+		/* skip 6 bytes of prepad, then pack 10 packed ecc bytes */
+		for (i = 0, l = oob + 6, p = raw_ecc; i < 2; i++, p += 2) {
+			*l++ =   p[0]        & 0xff;
+			*l++ = ((p[0] >>  8) & 0x03) | ((p[0] >> 14) & 0xfc);
+			*l++ = ((p[0] >> 22) & 0x0f) | ((p[1] <<  4) & 0xf0);
+			*l++ = ((p[1] >>  4) & 0x3f) | ((p[1] >> 10) & 0xc0);
+			*l++ =  (p[1] >> 18) & 0xff;
+		}
+
+		/* write this "out-of-band" data -- infix */
+		davinci_write_block_data(nand, oob, 16);
+		oob += 16;
+		oob_size -= 16;
+
+	} while (data_size);
+
+	/* the last data and OOB writes included the spare area */
+	return davinci_writepage_tail(nand, NULL, 0);
+}
+
+static int davinci_read_page_ecc4infix(struct nand_device_s *nand, u32 page,
+		u8 *data, u32 data_size, u8 *oob, u32 oob_size)
+{
+	davinci_write_pagecmd(nand, NAND_CMD_READ0, page);
+
+	/* large page devices need a start command */
+	if (nand->page_size > 512)
+		davinci_command(nand, NAND_CMD_READSTART);
+
+	if (!davinci_nand_ready(nand, 100))
+		return ERROR_NAND_OPERATION_TIMEOUT;
+
+	/* NOTE:  not bothering to compute and use ECC data for now */
+
+	do {
+		/* write 512 bytes */
+		davinci_read_block_data(nand, data, 512);
+		data += 512;
+		data_size -= 512;
+
+		/* read this "out-of-band" data -- infix */
+		davinci_read_block_data(nand, oob, 16);
+		oob += 16;
+		oob_size -= 16;
+	} while (data_size);
+
+	return ERROR_OK;
+}
+
+static int davinci_nand_device_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **argv, int argc,
+		struct nand_device_s *nand)
+{
+	struct davinci_nand *info;
+	target_t *target;
+	unsigned long chip, aemif;
+	enum ecc eccmode;
+	int chipsel;
+	char *ep;
+
+	/* arguments:
+	 *  - "davinci"
+	 *  - target
+	 *  - nand chip address
+	 *  - ecc mode
+	 *  - aemif address
+	 * Plus someday, optionally, ALE and CLE masks.
+	 */
+	if (argc < 5) {
+		LOG_ERROR("parameters: %s target "
+				"chip_addr hwecc_mode aemif_addr",
+				argv[0]);
+		goto fail;
+	}
+
+	target = get_target(argv[1]);
+	if (!target) {
+		LOG_ERROR("invalid target %s", argv[1]);
+		goto fail;
+	}
+
+	chip = strtoul(argv[2], &ep, 0);
+	if (*ep || chip == 0 || chip == ULONG_MAX) {
+		LOG_ERROR("Invalid NAND chip address %s", argv[2]);
+		goto fail;
+	}
+
+	if (strcmp(argv[3], "hwecc1") == 0)
+		eccmode = HWECC1;
+	else if (strcmp(argv[3], "hwecc4") == 0)
+		eccmode = HWECC4;
+	else if (strcmp(argv[3], "hwecc4_infix") == 0)
+		eccmode = HWECC4_INFIX;
+	else {
+		LOG_ERROR("Invalid ecc mode %s", argv[3]);
+		goto fail;
+	}
+
+	aemif = strtoul(argv[4], &ep, 0);
+	if (*ep || chip == 0 || chip == ULONG_MAX) {
+		LOG_ERROR("Invalid AEMIF controller address %s", argv[4]);
+		goto fail;
+	}
+
+	/* REVISIT what we'd *like* to do is look up valid ranges using
+	 * target-specific declarations, and not even need to pass the
+	 * AEMIF controller address.
+	 */
+	if (aemif == 0x01e00000			/* dm6446, dm357 */
+			|| aemif == 0x01e10000	/* dm335, dm355 */
+			|| aemif == 0x01d10000	/* dm365 */
+			) {
+		if (chip < 0x0200000 || chip >= 0x0a000000) {
+			LOG_ERROR("NAND address %08lx out of range?", chip);
+			goto fail;
+		}
+		chipsel = (chip - 0x02000000) >> 21;
+	} else {
+		LOG_ERROR("unrecognized AEMIF controller address %08lx", aemif);
+		goto fail;
+	}
+
+	info = calloc(1, sizeof *info);
+	if (info == NULL)
+		goto fail;
+
+	info->target = target;
+	info->eccmode = eccmode;
+	info->chipsel = chipsel;
+	info->aemif = aemif;
+	info->data = chip;
+	info->cmd = chip | 0x10;
+	info->addr = chip | 0x08;
+
+	nand->controller_priv = info;
+
+	/* NOTE:  for now we don't do any error correction on read.
+	 * Nothing else in OpenOCD currently corrects read errors,
+	 * and in any case it's *writing* that we care most about.
+	 */
+	info->read_page = nand_read_page_raw;
+
+	switch (eccmode) {
+	case HWECC1:
+		/* ECC_HW, 1-bit corrections, 3 bytes ECC per 512 data bytes */
+		info->write_page = davinci_write_page_ecc1;
+		break;
+	case HWECC4:
+		/* ECC_HW, 4-bit corrections, 10 bytes ECC per 512 data bytes */
+		info->write_page = davinci_write_page_ecc4;
+		break;
+	case HWECC4_INFIX:
+		/* Same 4-bit ECC HW, with problematic page/ecc layout */
+		info->read_page = davinci_read_page_ecc4infix;
+		info->write_page = davinci_write_page_ecc4infix;
+		break;
+	}
+
+	return ERROR_OK;
+
+fail:
+	return ERROR_NAND_OPERATION_FAILED;
+}
+
+nand_flash_controller_t davinci_nand_controller = {
+	.name			= "davinci",
+	.nand_device_command	= davinci_nand_device_command,
+	.register_commands	= davinci_register_commands,
+	.init			= davinci_init,
+	.reset			= davinci_reset,
+	.command		= davinci_command,
+	.address		= davinci_address,
+	.write_data		= davinci_write_data,
+	.read_data		= davinci_read_data,
+	.write_page		= davinci_write_page,
+	.read_page		= davinci_read_page,
+	.write_block_data	= davinci_write_block_data,
+	.read_block_data	= davinci_read_block_data,
+	.nand_ready		= davinci_nand_ready,
+};


Property changes on: trunk/src/flash/davinci_nand.c
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2009-05-24 01:33:54 UTC (rev 1902)
+++ trunk/src/flash/nand.c	2009-05-24 01:38:19 UTC (rev 1903)
@@ -48,6 +48,7 @@
 
 /* NAND flash controller
  */
+extern nand_flash_controller_t davinci_nand_controller;
 extern nand_flash_controller_t lpc3180_nand_controller;
 extern nand_flash_controller_t orion_nand_controller;
 extern nand_flash_controller_t s3c2410_nand_controller;
@@ -59,6 +60,7 @@
 
 static nand_flash_controller_t *nand_flash_controllers[] =
 {
+	&davinci_nand_controller,
 	&lpc3180_nand_controller,
 	&orion_nand_controller,
 	&s3c2410_nand_controller,

Modified: trunk/src/target/board/dm355evm.cfg
===================================================================
--- trunk/src/target/board/dm355evm.cfg	2009-05-24 01:33:54 UTC (rev 1902)
+++ trunk/src/target/board/dm355evm.cfg	2009-05-24 01:38:19 UTC (rev 1903)
@@ -105,7 +105,15 @@
 	# FIXME setup
 }
 
+# NAND -- socket has two chipselects, MT29F16G08FAA puts 1GByte on each one.
+#
+# NOTE:  "hwecc4" here presumes that if you're using the standard 2GB NAND
+# you either (a) have 'new' DM355 chips, with boot ROMs that don't need to
+# use "hwecc4_infix" for the UBL; or else (b) aren't updating anything that
+# needs infix layout ... like an old UBL, old U-Boot, old MVL kernel, etc.
+nand device davinci 0 0x02000000 hwecc4 0x01e10000
+nand device davinci 0 0x02004000 hwecc4 0x01e10000
+
 # FIXME
-#  - declare the NAND flash; use the 4-bit ECC
 #  - support writing UBL with its header (new layout only with new ROMs)
-#  - support writing ABL/U-Boot with its header (both layouts)
+#  - support writing ABL/U-Boot with its header (new layout)



From zwelch at mail.berlios.de  Sun May 24 03:57:17 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 03:57:17 +0200
Subject: [Openocd-svn] r1904 - in trunk: doc src/flash src/target/board
Message-ID: <200905240157.n4O1vH8I009333@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 03:57:13 +0200 (Sun, 24 May 2009)
New Revision: 1904

Modified:
   trunk/doc/openocd.texi
   trunk/src/flash/nand.c
   trunk/src/target/board/sheevaplug.cfg
Log:
David Brownell <david-b at pacbell.net>:

Update two oddball NAND commands to work with {offset, length}
instead of block numbers, matching the other commands as well
as usage in U-Boot and the Linux-MTD utilities.

Document them accordingly.  Update the single in-tree use of
those commands (sheevaplug).

ALSO:

 (a) Document the current 2 GByte/chip ceiling for NAND chipsize.
     (32 bit offset/length values can't represent 4 GBytes.)  Maybe
     after the upcoming release, the code can switch to 64-bits.

 (b) The "nand check_bad_blocks" should report "bad" blocks.  They
     are not "invalid" blocks; they're "bad" ones.

 (c) Tweak the "nand info" command to handle the "no arguments"
     case sanely (show everything, instead of showing garbage) and
     not listing the blocksize in hex kbytes (duh).


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-24 01:38:19 UTC (rev 1903)
+++ trunk/doc/openocd.texi	2009-05-24 01:57:13 UTC (rev 1904)
@@ -2616,6 +2616,15 @@
 de-brick a board.
 @end enumerate
 
+ at b{NOTE:} At the time this text was written, the largest NAND
+flash fully supported by OpenOCD is 2 GiBytes (16 GiBits).
+This is because the variables used to hold offsets and lengths
+are only 32 bits wide.
+(Larger chips may work in some cases, unless an offset or length
+is larger than 0xffffffff, the largest 32-bit unsigned integer.)
+Some larger devices will work, since they are actually multi-chip
+modules with two smaller chips and individual chipselect lines.
+
 @section NAND Configuration Commands
 @cindex NAND configuration
 
@@ -2702,9 +2711,19 @@
 @end itemize
 @end deffn
 
- at deffn Command {nand erase} num ...
+ at deffn Command {nand erase} num offset length
 @cindex NAND erasing
- at b{NOTE:} Syntax is in flux.
+Erases blocks on the specified NAND device, starting at the
+specified @var{offset} and continuing for @var{length} bytes.
+Both of those values must be exact multiples of the device's
+block size, and the region they specify must fit entirely in the chip.
+The @var{num} parameter is the value shown by @command{nand list}.
+
+ at b{NOTE:} This command will try to erase bad blocks, when told
+to do so, which will probably invalidate the manufacturer's bad
+block marker.
+For the remainder of the current server session, @command{nand info}
+will still report that the block ``is'' bad.
 @end deffn
 
 @deffn Command {nand write} num filename offset [option...]
@@ -2768,8 +2787,18 @@
 @section Other NAND commands
 @cindex NAND other commands
 
- at deffn Command {nand check_bad} num ...
- at b{NOTE:} Syntax is in flux.
+ at deffn Command {nand check_bad_blocks} [offset length]
+Checks for manufacturer bad block markers on the specified NAND
+device.  If no parameters are provided, checks the whole
+device; otherwise, starts at the specified @var{offset} and
+continues for @var{length} bytes.
+Both of those values must be exact multiples of the device's
+block size, and the region they specify must fit entirely in the chip.
+The @var{num} parameter is the value shown by @command{nand list}.
+
+ at b{NOTE:} Before using this command you should force raw access
+with @command{nand raw_access enable} to ensure that the underlying
+driver will not try to apply hardware ECC.
 @end deffn
 
 @deffn Command {nand info} num

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2009-05-24 01:38:19 UTC (rev 1903)
+++ trunk/src/flash/nand.c	2009-05-24 01:57:13 UTC (rev 1904)
@@ -309,12 +309,12 @@
 		register_command(cmd_ctx, nand_cmd, "probe", handle_nand_probe_command, COMMAND_EXEC,
 						 "identify NAND flash device <num>");
 		register_command(cmd_ctx, nand_cmd, "check_bad_blocks", handle_nand_check_bad_blocks_command, COMMAND_EXEC,
-						 "check NAND flash device <num> for bad blocks [<first> <last>]");
+						 "check NAND flash device <num> for bad blocks [<offset> <length>]");
 		register_command(cmd_ctx, nand_cmd, "erase", handle_nand_erase_command, COMMAND_EXEC,
-						 "erase blocks on NAND flash device <num> <first> <last>");
+						 "erase blocks on NAND flash device <num> <offset> <length>");
 		register_command(cmd_ctx, nand_cmd, "dump", handle_nand_dump_command, COMMAND_EXEC,
 						 "dump from NAND flash device <num> <filename> "
-						 "<offset> <size> [oob_raw|oob_only]");
+						 "<offset> <length> [oob_raw|oob_only]");
 		register_command(cmd_ctx, nand_cmd, "write", handle_nand_write_command, COMMAND_EXEC,
 						 "write to NAND flash device <num> <filename> <offset> [oob_raw|oob_only|oob_softecc|oob_softecc_kw]");
 		register_command(cmd_ctx, nand_cmd, "raw_access", handle_nand_raw_access_command, COMMAND_EXEC,
@@ -360,7 +360,7 @@
 			|| (((device->page_size == 512) && (oob[5] != 0xff)) ||
 				((device->page_size == 2048) && (oob[0] != 0xff))))
 		{
-			LOG_WARNING("invalid block: %i", i);
+			LOG_WARNING("bad block: %i", i);
 			device->blocks[i].is_bad = 1;
 		}
 		else
@@ -1093,20 +1093,20 @@
 	int first = -1;
 	int last = -1;
 
-	if ((argc < 1) || (argc > 3))
-	{
+	switch (argc) {
+	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
-
-	}
-
-	if (argc == 2)
-	{
+	case 1:
+		first = 0;
+		last = INT32_MAX;
+		break;
+	case 2:
 		first = last = strtoul(args[1], NULL, 0);
-	}
-	else if (argc == 3)
-	{
+		break;
+	case 3:
 		first = strtoul(args[1], NULL, 0);
 		last = strtoul(args[2], NULL, 0);
+		break;
 	}
 
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
@@ -1141,7 +1141,7 @@
 				else
 					bad_state = " (block condition unknown)";
 
-				command_print(cmd_ctx, "\t#%i: 0x%8.8x (0x%xkB) %s%s",
+				command_print(cmd_ctx, "\t#%i: 0x%8.8x (%dkB) %s%s",
 							j, p->blocks[j].offset, p->blocks[j].size / 1024,
 							erase_state, bad_state);
 			}
@@ -1203,13 +1203,32 @@
 	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
 	if (p)
 	{
-		int first = strtoul(args[1], NULL, 0);
-		int last = strtoul(args[2], NULL, 0);
+		char *cp;
+		unsigned long offset;
+		unsigned long length;
 
-		if ((retval = nand_erase(p, first, last)) == ERROR_OK)
+		offset = strtoul(args[1], &cp, 0);
+		if (*cp || offset == ULONG_MAX || offset % p->erase_size)
 		{
-			command_print(cmd_ctx, "successfully erased blocks %i to %i on NAND flash device '%s'", first, last, p->device->name);
+			return ERROR_INVALID_ARGUMENTS;
 		}
+		offset /= p->erase_size;
+
+		length = strtoul(args[2], &cp, 0);
+		if (*cp || length == ULONG_MAX || length % p->erase_size)
+		{
+			return ERROR_INVALID_ARGUMENTS;
+		}
+		length -= 1;
+		length /= p->erase_size;
+
+		retval = nand_erase(p, offset, offset + length);
+		if (retval == ERROR_OK)
+		{
+			command_print(cmd_ctx, "successfully erased blocks "
+					"%lu to %lu on NAND flash device '%s'",
+					offset, offset + length, p->device->name);
+		}
 		else if (retval == ERROR_NAND_OPERATION_FAILED)
 		{
 			command_print(cmd_ctx, "erase failed");
@@ -1240,31 +1259,53 @@
 
 	}
 
+	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
+	if (!p) {
+		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds",
+				args[0]);
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
 	if (argc == 3)
 	{
-		first = strtoul(args[1], NULL, 0);
-		last = strtoul(args[2], NULL, 0);
-	}
+		char *cp;
+		unsigned long offset;
+		unsigned long length;
 
-	p = get_nand_device_by_num(strtoul(args[0], NULL, 0));
-	if (p)
-	{
-		if ((retval = nand_build_bbt(p, first, last)) == ERROR_OK)
+		offset = strtoul(args[1], &cp, 0);
+		if (*cp || offset == ULONG_MAX || offset % p->erase_size)
 		{
-			command_print(cmd_ctx, "checked NAND flash device for bad blocks, use \"nand info\" command to list blocks");
+			return ERROR_INVALID_ARGUMENTS;
 		}
-		else if (retval == ERROR_NAND_OPERATION_FAILED)
+		offset /= p->erase_size;
+
+		length = strtoul(args[2], &cp, 0);
+		if (*cp || length == ULONG_MAX || length % p->erase_size)
 		{
-			command_print(cmd_ctx, "error when checking for bad blocks on NAND flash device");
+			return ERROR_INVALID_ARGUMENTS;
 		}
-		else
-		{
-			command_print(cmd_ctx, "unknown error when checking for bad blocks on NAND flash device");
-		}
+		length -= 1;
+		length /= p->erase_size;
+
+		first = offset;
+		last = offset + length;
 	}
+
+	retval = nand_build_bbt(p, first, last);
+	if (retval == ERROR_OK)
+	{
+		command_print(cmd_ctx, "checked NAND flash device for bad blocks, "
+				"use \"nand info\" command to list blocks");
+	}
+	else if (retval == ERROR_NAND_OPERATION_FAILED)
+	{
+		command_print(cmd_ctx, "error when checking for bad blocks on "
+				"NAND flash device");
+	}
 	else
 	{
-		command_print(cmd_ctx, "NAND flash device '#%s' is out of bounds", args[0]);
+		command_print(cmd_ctx, "unknown error when checking for bad "
+				"blocks on NAND flash device");
 	}
 
 	return ERROR_OK;

Modified: trunk/src/target/board/sheevaplug.cfg
===================================================================
--- trunk/src/target/board/sheevaplug.cfg	2009-05-24 01:38:19 UTC (rev 1903)
+++ trunk/src/target/board/sheevaplug.cfg	2009-05-24 01:57:13 UTC (rev 1904)
@@ -98,7 +98,7 @@
 	# reflash the u-Boot binary and reboot into it
 	sheevaplug_init
 	nand probe 0
-	nand erase 0 0 4
+	nand erase 0 0x0 0xa0000
 	nand write 0 uboot.bin 0 oob_softecc_kw
 	resume
 



From zwelch at mail.berlios.de  Sun May 24 04:08:20 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 04:08:20 +0200
Subject: [Openocd-svn] r1905 - trunk/src/target/board
Message-ID: <200905240208.n4O28KYi009919@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 04:08:17 +0200 (Sun, 24 May 2009)
New Revision: 1905

Modified:
   trunk/src/target/board/sheevaplug.cfg
Log:
Nicolas Pitre <nico at cam.org>: Update sheevaplug interface script:

When the CPU is in the WFI state, the JTAG interface simply doesn't 
respond at all and initial tap examination simply fails.  Let's simply
do it again when we come around to assert nSRST.


Modified: trunk/src/target/board/sheevaplug.cfg
===================================================================
--- trunk/src/target/board/sheevaplug.cfg	2009-05-24 01:57:13 UTC (rev 1904)
+++ trunk/src/target/board/sheevaplug.cfg	2009-05-24 02:08:17 UTC (rev 1905)
@@ -17,7 +17,13 @@
 
 	# We need to assert DBGRQ while holding nSRST down.
 	# However DBGACK will be set only when nSRST is released.
+	# Furthermore, the JTAG interface doesn't respond at all when
+	# the CPU is in the WFI (wait for interrupts) state, so it is
+	# possible that initial tap examination failed.  So let's
+	# re-examine the target again here when nSRST is asserted which
+	# should then succeed.
 	jtag_reset 0 1
+	feroceon.cpu arp_examine
 	halt 0
 	jtag_reset 0 0
 	wait_halt



From mifi at mail.berlios.de  Sun May 24 13:24:28 2009
From: mifi at mail.berlios.de (mifi at mail.berlios.de)
Date: Sun, 24 May 2009 13:24:28 +0200
Subject: [Openocd-svn] r1906 - trunk/src/target/target
Message-ID: <200905241124.n4OBOSsC026774@sheep.berlios.de>

Author: mifi
Date: 2009-05-24 13:24:14 +0200 (Sun, 24 May 2009)
New Revision: 1906

Modified:
   trunk/src/target/target/lpc2148.cfg
Log:
Added the options calc_checksum to the flash driver.
This was forgotten here. All other LPC targets use
this option.

Modified: trunk/src/target/target/lpc2148.cfg
===================================================================
--- trunk/src/target/target/lpc2148.cfg	2009-05-24 02:08:17 UTC (rev 1905)
+++ trunk/src/target/target/lpc2148.cfg	2009-05-24 11:24:14 UTC (rev 1906)
@@ -53,4 +53,4 @@
 }
 
 # flash bank lpc2000 <base> <size> 0 0 <target#> <variant> <clock> [calc_checksum]
-flash bank lpc2000 0x0 0x7d000 0 0 0 lpc2000_v2 14765
+flash bank lpc2000 0x0 0x7d000 0 0 0 lpc2000_v2 14765 calc_checksum



From zwelch at mail.berlios.de  Sun May 24 22:56:17 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 22:56:17 +0200
Subject: [Openocd-svn] r1907 - trunk/src/flash
Message-ID: <200905242056.n4OKuHi2009829@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 22:56:13 +0200 (Sun, 24 May 2009)
New Revision: 1907

Modified:
   trunk/src/flash/davinci_nand.c
Log:
David Brownell <david-b at pacbell.net>: minor davinci_nand bugfix

Fix a bug that joined us at the last minute, when an efficient
alloca() call got swapped out for a more portable malloc().

Also log one error, to give a clue in case it appears "in the wild".


Modified: trunk/src/flash/davinci_nand.c
===================================================================
--- trunk/src/flash/davinci_nand.c	2009-05-24 11:24:14 UTC (rev 1906)
+++ trunk/src/flash/davinci_nand.c	2009-05-24 20:56:13 UTC (rev 1907)
@@ -258,8 +258,10 @@
 		return ERROR_NAND_OPERATION_FAILED;
 
 	/* Always write both data and OOB ... we are not "raw" I/O! */
-	if (!data)
+	if (!data) {
+		LOG_ERROR("Missing NAND data; try 'nand raw_access enable'\n");
 		return ERROR_NAND_OPERATION_FAILED;
+	}
 
 	/* If we're not given OOB, write 0xff where we don't write ECC codes. */
 	switch (nand->page_size) {
@@ -277,7 +279,7 @@
 	}
 	if (!oob) {
 		ooballoc = malloc(oob_size);
-		if (ooballoc)
+		if (!ooballoc)
 			return ERROR_NAND_OPERATION_FAILED;
 		oob = ooballoc;
 		memset(oob, 0x0ff, oob_size);



From zwelch at mail.berlios.de  Sun May 24 22:57:57 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 22:57:57 +0200
Subject: [Openocd-svn] r1908 - trunk/src/helper
Message-ID: <200905242057.n4OKvvfp009897@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 22:57:53 +0200 (Sun, 24 May 2009)
New Revision: 1908

Modified:
   trunk/src/helper/command.c
Log:
David Brownell <david-b at pacbell.net>:

The "Illegal mode for command" diagnostic is deeply useless.
Say "Command '%s' only runs during configuration stage" instead,
letting users know what the real issue is.


Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2009-05-24 20:56:13 UTC (rev 1907)
+++ trunk/src/helper/command.c	2009-05-24 20:57:53 UTC (rev 1908)
@@ -392,7 +392,7 @@
 	if (!((context->mode == COMMAND_CONFIG) || (c->mode == COMMAND_ANY) || (c->mode == context->mode) ))
 	{
 		/* Config commands can not run after the config stage */
-		LOG_ERROR("Illegal mode for command");
+		LOG_ERROR("Command '%s' only runs during configuration stage", c->name);
 		return ERROR_FAIL;
 	}
 



From zwelch at mail.berlios.de  Sun May 24 23:08:48 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 23:08:48 +0200
Subject: [Openocd-svn] r1909 - in trunk: doc src/server
Message-ID: <200905242108.n4OL8mlm011008@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 23:08:42 +0200 (Sun, 24 May 2009)
New Revision: 1909

Modified:
   trunk/doc/openocd.texi
   trunk/src/server/gdb_server.c
   trunk/src/server/tcl_server.c
   trunk/src/server/telnet_server.c
Log:
David Brownell <david-b at pacbell.net>:

Make startup for the various server ports be quiet, unless
debugging is active:  don't emit needless scarey messages.
Update the relevant documentation and its references:

 - For these port commands ... cover the default values;
   convert to @deffn syntax; include their use outside of
   the configuration stage; and alphabetize.

Similar updates to the rest of that small chapter:

 - Highlight that there even *IS* a configuration stage, after
   which some command functionality is no longer available.

 - For GDB commands ... convert to @deffn syntax; alphabetize;
   include a missing command (!); add missing helptext (!) for
   one non-missing command; update relevant cross-references
   and index entries.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-24 20:57:53 UTC (rev 1908)
+++ trunk/doc/openocd.texi	2009-05-24 21:08:42 UTC (rev 1909)
@@ -686,10 +686,6 @@
 @example
 source [find interface/signalyzer.cfg]
 
-# Change the default telnet port...
-telnet_port 4444
-# GDB connects here
-gdb_port 3333
 # GDB can also flash my flash!
 gdb_memory_map enable
 gdb_flash_program enable
@@ -1150,11 +1146,26 @@
 
 @node Daemon Configuration
 @chapter Daemon Configuration
+ at cindex initialization
 The commands here are commonly found in the openocd.cfg file and are
 used to specify what TCP/IP ports are used, and how GDB should be
 supported.
- at section init
- at cindex init
+
+ at section Configuration Stage
+ at cindex configuration stage
+ at cindex configuration command
+
+When the OpenOCD server process starts up, it enters a
+ at emph{configuration stage} which is the only time that
+certain commands, @emph{configuration commands}, may be issued.
+Those configuration commands include declaration of TAPs
+and other basic setup.
+The server must leave the configuration stage before it
+may access or activate TAPs.
+After it leaves this stage, configuration commands may no
+longer be issued.
+
+ at deffn {Config Command} init
 This command terminates the configuration stage and
 enters the normal command mode. This can be useful to add commands to
 the startup scripts and commands such as resetting the target,
@@ -1169,64 +1180,92 @@
 @b{NOTE:} This command normally occurs at or near the end of your
 openocd.cfg file to force OpenOCD to ``initialize'' and make the
 targets ready. For example: If your openocd.cfg file needs to
-read/write memory on your target - the init command must occur before
+read/write memory on your target, @command{init} must occur before
 the memory read/write commands.  This includes @command{nand probe}.
+ at end deffn
 
 @section TCP/IP Ports
- at itemize @bullet
- at item @b{telnet_port} <@var{number}>
- at cindex telnet_port
-@*Intended for a human. Port on which to listen for incoming telnet connections.
+ at cindex TCP port
+ at cindex server
+ at cindex port
+The OpenOCD server accepts remote commands in several syntaxes.
+Each syntax uses a different TCP/IP port, which you may specify
+only during configuration (before those ports are opened).
 
- at item @b{tcl_port} <@var{number}>
- at cindex tcl_port
-@*Intended as a machine interface. Port on which to listen for
-incoming Tcl syntax. This port is intended as a simplified RPC
-connection that can be used by clients to issue commands and get the
+ at deffn {Command} gdb_port (number)
+ at cindex GDB server
+Specify or query the first port used for incoming GDB connections.
+The GDB port for the
+first target will be gdb_port, the second target will listen on gdb_port + 1, and so on.
+When not specified during the configuration stage,
+the port @var{number} defaults to 3333.
+ at end deffn
+
+ at deffn {Command} tcl_port (number)
+Specify or query the port used for a simplified RPC
+connection that can be used by clients to issue TCL commands and get the
 output from the Tcl engine.
+Intended as a machine interface.
+When not specified during the configuration stage,
+the port @var{number} defaults to 6666.
+ at end deffn
 
- at item @b{gdb_port} <@var{number}>
- at cindex gdb_port
-@*First port on which to listen for incoming GDB connections. The GDB port for the
-first target will be gdb_port, the second target will listen on gdb_port + 1, and so on. 
- at end itemize
+ at deffn {Command} telnet_port (number)
+Specify or query the
+port on which to listen for incoming telnet connections.
+This port is intended for interaction with one human through TCL commands.
+When not specified during the configuration stage,
+the port @var{number} defaults to 4444.
+ at end deffn
 
- at section GDB Items
- at itemize @bullet
- at item @b{gdb_breakpoint_override} <@var{hard|soft|disable}>
- at cindex gdb_breakpoint_override
+ at section GDB Configuration
+ at anchor{GDB Configuration}
+ at cindex GDB
+ at cindex GDB configuration
+You can reconfigure some GDB behaviors if needed.
+The ones listed here are static and global.
+ at xref{Target Create}, about declaring individual targets.
+ at xref{Target Events}, about configuring target-specific event handling.
+
+ at deffn {Command} gdb_breakpoint_override <hard|soft|disable>
 @anchor{gdb_breakpoint_override}
-@*Force breakpoint type for gdb 'break' commands.
-The raison d'etre for this option is to support GDB GUI's without 
-a hard/soft breakpoint concept where the default OpenOCD and
-GDB behaviour is not sufficient. Note that GDB will use hardware
+Force breakpoint type for gdb @command{break} commands.
+The raison d'etre for this option is to support GDB GUI's which don't
+distinguish hard versus soft breakpoints, if the default OpenOCD and
+GDB behaviour is not sufficient.  GDB normally uses hardware
 breakpoints if the memory map has been set up for flash regions.
 
 This option replaces older arm7_9 target commands that addressed
 the same issue.
+ at end deffn
 
- at item @b{gdb_detach} <@var{resume|reset|halt|nothing}>
- at cindex gdb_detach
-@*Configures what OpenOCD will do when GDB detaches from the daemon.
-Default behaviour is <@var{resume}>
+ at deffn {Config command} gdb_detach <resume|reset|halt|nothing>
+Configures what OpenOCD will do when GDB detaches from the daemon.
+Default behaviour is @var{resume}.
+ at end deffn
 
- at item @b{gdb_memory_map} <@var{enable|disable}>
- at cindex gdb_memory_map
-@*Set to <@var{enable}> to cause OpenOCD to send the memory configuration to GDB when
+ at deffn {Config command} gdb_flash_program <enable|disable>
+ at anchor{gdb_flash_program}
+Set to @var{enable} to cause OpenOCD to program the flash memory when a
+vFlash packet is received.
+The default behaviour is @var{enable}.
+ at end deffn
+
+ at deffn {Config command} gdb_memory_map <enable|disable>
+Set to @var{enable} to cause OpenOCD to send the memory configuration to GDB when
 requested. GDB will then know when to set hardware breakpoints, and program flash
-using the GDB load command. @option{gdb_flash_program enable} must also be enabled 
+using the GDB load command. @command{gdb_flash_program enable} must also be enabled
 for flash programming to work.
-Default behaviour is <@var{enable}>
+Default behaviour is @var{enable}.
 @xref{gdb_flash_program}.
+ at end deffn
 
- at item @b{gdb_flash_program} <@var{enable|disable}>
- at cindex gdb_flash_program
- at anchor{gdb_flash_program}
-@*Set to <@var{enable}> to cause OpenOCD to program the flash memory when a
-vFlash packet is received.
-Default behaviour is <@var{enable}>
- at comment END GDB Items
- at end itemize
+ at deffn {Config command} gdb_report_data_abort <enable|disable>
+Specifies whether data aborts cause an error to be reported
+by GDB memory read packets.
+The default behaviour is @var{disable};
+use @var{enable} see these errors reported.
+ at end deffn
 
 @node Interface - Dongle Configuration
 @chapter Interface - Dongle Configuration
@@ -1806,6 +1845,7 @@
 @page
 @node Target Configuration
 @chapter Target Configuration
+ at cindex GDB target
 
 This chapter discusses how to create a GDB debug target.  Before
 creating a ``target'' a JTAG tap DOTTED.NAME must exist first.
@@ -1945,6 +1985,8 @@
 @end itemize
 
 @section Target Events
+ at cindex events
+ at anchor{Target Events}
 At various times, certain things can happen, or you want them to happen.
 
 Examples:
@@ -2062,7 +2104,8 @@
 @end example
 @end itemize
 
- at section target create
+ at section Target Create
+ at anchor{Target Create}
 @cindex target
 @cindex target creation
 
@@ -2208,8 +2251,8 @@
 flash on your board.
 @item GDB Flashing
 @* Flashing via GDB requires the flash be configured via ``flash
-bank'', and the GDB flash features be enabled. See the daemon
-configuration section for more details.
+bank'', and the GDB flash features be enabled.
+ at xref{GDB Configuration}.
 @end enumerate
 
 @section Flash commands
@@ -2903,8 +2946,8 @@
 or via one of several TCP/IP Ports.
 
 @item @b{From the human}
-@* A human should interact with the telnet interface (default port: 4444,
-or via GDB, default port 3333)
+@* A human should interact with the telnet interface (default port: 4444)
+or via GDB (default port 3333).
 
 To issue commands from within a GDB session, use the @option{monitor}
 command, e.g. use @option{monitor poll} to issue the @option{poll}
@@ -3444,7 +3487,7 @@
 
 @node GDB and OpenOCD
 @chapter GDB and OpenOCD
- at cindex GDB and OpenOCD
+ at cindex GDB
 OpenOCD complies with the remote gdbserver protocol, and as such can be used
 to debug remote targets.
 
@@ -3505,7 +3548,7 @@
 
 Informing GDB of the memory map of the target will enable GDB to protect any
 flash areas of the target and use hardware breakpoints by default. This means
-that the OpenOCD option @option{gdb_breakpoint_override} is not required when
+that the OpenOCD option @command{gdb_breakpoint_override} is not required when
 using a memory map. @xref{gdb_breakpoint_override}.
 
 To view the configured memory map in GDB, use the GDB command @option{info mem}
@@ -3517,7 +3560,7 @@
 set mem inaccessible-by-default off
 @end example
 
-If @option{gdb_flash_program enable} is also used, GDB will be able to
+If @command{gdb_flash_program enable} is also used, GDB will be able to
 program any flash memory using the vFlash interface.
 
 GDB will look at the target memory map when a load command is given, if any
@@ -3627,12 +3670,12 @@
 @*use @option{arm7_9 fast_memory_access} command with same args. @xref{arm7_9 fast_memory_access}.
 @item @b{arm7_9 force_hw_bkpts}
 @cindex arm7_9 force_hw_bkpts
-@*Use @option{gdb_breakpoint_override} instead. Note that GDB will use hardware breakpoints
+@*Use @command{gdb_breakpoint_override} instead. Note that GDB will use hardware breakpoints
 for flash if the GDB memory map has been set up(default when flash is declared in
 target configuration). @xref{gdb_breakpoint_override}.
 @item @b{arm7_9 sw_bkpts}
 @cindex arm7_9 sw_bkpts
-@*On by default. See also @option{gdb_breakpoint_override}. @xref{gdb_breakpoint_override}.
+@*On by default. @xref{gdb_breakpoint_override}.
 @item @b{daemon_startup}
 @cindex daemon_startup
 @*this config option has been removed, simply adding @option{init} and @option{reset halt} to

Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2009-05-24 20:57:53 UTC (rev 1908)
+++ trunk/src/server/gdb_server.c	2009-05-24 21:08:42 UTC (rev 1909)
@@ -2188,7 +2188,7 @@
 
 	if (gdb_port == 0 && server_use_pipes == 0)
 	{
-		LOG_WARNING("no gdb port specified, using default port 3333");
+		LOG_DEBUG("no gdb port specified, using default port 3333");
 		gdb_port = 3333;
 	}
 
@@ -2369,17 +2369,15 @@
 	register_command(command_context, NULL, "gdb_port", handle_gdb_port_command,
 			COMMAND_ANY, "daemon configuration command gdb_port");
 	register_command(command_context, NULL, "gdb_detach", handle_gdb_detach_command,
-			COMMAND_CONFIG, "");
+			COMMAND_CONFIG, "resume/reset/halt/nothing - "
+			"specify behavior when GDB detaches from the target");
 	register_command(command_context, NULL, "gdb_memory_map", handle_gdb_memory_map_command,
 			COMMAND_CONFIG, "enable or disable memory map");
 	register_command(command_context, NULL, "gdb_flash_program", handle_gdb_flash_program_command,
 			COMMAND_CONFIG, "enable or disable flash program");
 	register_command(command_context, NULL, "gdb_report_data_abort", handle_gdb_report_data_abort_command,
-			COMMAND_CONFIG, "enable or disable report data");
+			COMMAND_CONFIG, "enable or disable reporting data aborts");
 	register_command(command_context, NULL, "gdb_breakpoint_override", handle_gdb_breakpoint_override_command,
-			COMMAND_EXEC, "hard/soft/disable - force breakpoint type for gdb 'break' commands."
-			"The raison d'etre for this option is to support GDB GUI's without "
-			"a hard/soft breakpoint concept where the default OpenOCD behaviour "
-			"is not sufficient");
+			COMMAND_EXEC, "hard/soft/disable - force breakpoint type for gdb 'break' commands.");
 	return ERROR_OK;
 }

Modified: trunk/src/server/tcl_server.c
===================================================================
--- trunk/src/server/tcl_server.c	2009-05-24 20:57:53 UTC (rev 1908)
+++ trunk/src/server/tcl_server.c	2009-05-24 21:08:42 UTC (rev 1909)
@@ -165,7 +165,7 @@
 
 	if (tcl_port == 0)
 	{
-		LOG_WARNING("no tcl port specified, using default port 6666");
+		LOG_DEBUG("no tcl port specified, using default port 6666");
 		tcl_port = 6666;
 	}
 

Modified: trunk/src/server/telnet_server.c
===================================================================
--- trunk/src/server/telnet_server.c	2009-05-24 20:57:53 UTC (rev 1908)
+++ trunk/src/server/telnet_server.c	2009-05-24 21:08:42 UTC (rev 1909)
@@ -596,7 +596,7 @@
 
 	if (telnet_port == 0)
 	{
-		LOG_WARNING("no telnet port specified, using default port 4444");
+		LOG_DEBUG("no telnet port specified, using default port 4444");
 		telnet_port = 4444;
 	}
 



From zwelch at mail.berlios.de  Sun May 24 23:13:34 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 24 May 2009 23:13:34 +0200
Subject: [Openocd-svn] r1910 - in trunk: doc src/jtag
Message-ID: <200905242113.n4OLDYYf011374@sheep.berlios.de>

Author: zwelch
Date: 2009-05-24 23:13:29 +0200 (Sun, 24 May 2009)
New Revision: 1910

Modified:
   trunk/doc/openocd.texi
   trunk/src/jtag/ft2232.c
   trunk/src/jtag/jtag.c
Log:
David Brownell <david-b at pacbell.net>:

Doc (mostly) update for jtag_khz:
 - switch to @deffn syntax
 - add entry for "jtag_rclk"
 - move deprecated "jtag_speed" into collection of deprecated calls

And for ft2232, don't be the only adapter to *log* an error if RTCK
is requested; it's already reported properly, like any other nonfatal
command parameter.  "jtag_rclk" just works as expected, without any
scarey messages.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-24 21:08:42 UTC (rev 1909)
+++ trunk/doc/openocd.texi	2009-05-24 21:13:29 UTC (rev 1910)
@@ -1493,54 +1493,59 @@
 Currently, there are no options available for the ep93xx interface.
 
 @section JTAG Speed
- at itemize @bullet
- at item @b{jtag_khz} <@var{reset speed kHz}>
- at cindex jtag_khz
+ at anchor{JTAG Speed}
+JTAG clock setup is part of system setup.
+It @emph{does not belong with interface setup} since any interface
+only knows a few of the constraints for the JTAG clock speed.
+Sometimes the JTAG speed is
+changed during the target initialization process: (1) slow at
+reset, (2) program the CPU clocks, (3) run fast.
+Both the "slow" and "fast" clock rates are functions of the
+oscillators used, the chip, the board design, and sometimes
+power management software that may be active.
 
-It is debatable if this command belongs here - or in a board
-configuration file. In fact, in some situations the JTAG speed is
-changed during the target initialisation process (i.e.: (1) slow at
-reset, (2) program the CPU clocks, (3) run fast)
+The speed used during reset can be adjusted using pre_reset
+and post_reset event handlers.
+ at xref{Target Events}.
 
-Speed 0 (khz) selects RTCK method. A non-zero speed is in KHZ. Hence: 3000 is 3mhz. 
+If your system supports adaptive clocking (RTCK), configuring
+JTAG to use that is probably the most robust approach.
+However, it introduces delays to synchronize clocks; so it
+may not be the fastest solution.
 
-Not all interfaces support ``rtck''. If the interface device can not
-support the rate asked for, or can not translate from kHz to
-jtag_speed, then an error is returned.
+ at b{NOTE:} Script writers should consider using @command{jtag_rclk}
+instead of @command{jtag_khz}.
 
-Make sure the JTAG clock is no more than @math{1/6th  CPU-Clock}. This is
-especially true for synthesized cores (-S). Also see RTCK.
+ at deffn {Command} jtag_khz max_speed_kHz
+A non-zero speed is in KHZ. Hence: 3000 is 3mhz.
+JTAG interfaces usually support a limited number of
+speeds.  The speed actually used won't be faster
+than the speed specified.
 
- at b{NOTE: Script writers} If the target chip requires/uses RTCK -
-please use the command: 'jtag_rclk FREQ'. This Tcl proc (in
-startup.tcl) attempts to enable RTCK, if that fails it falls back to
-the specified frequency.
+As a rule of thumb, if you specify a clock rate make
+sure the JTAG clock is no more than @math{1/6th CPU-Clock}.
+This is especially true for synthesized cores (ARMxxx-S).
 
+Speed 0 (khz) selects RTCK method.
+ at xref{FAQ RTCK}.
+If your system uses RTCK, you won't need to change the
+JTAG clocking after setup.
+Not all interfaces, boards, or targets support ``rtck''.
+If the interface device can not
+support it, an error is returned when you try to use RTCK.
+ at end deffn
+
+ at defun jtag_rclk fallback_speed_kHz
+ at cindex RTCK
+This Tcl proc (defined in startup.tcl) attempts to enable RTCK/RCLK.
+If that fails (maybe the interface, board, or target doesn't
+support it), falls back to the specified frequency.
 @example
-    # Fall back to 3mhz if RCLK is not supported
-    jtag_rclk 3000
+# Fall back to 3mhz if RTCK is not supported
+jtag_rclk 3000
 @end example
+ at end defun
 
- at item @b{DEPRECATED} @b{jtag_speed} - please use jtag_khz above.
- at cindex jtag_speed
-@*Limit the maximum speed of the JTAG interface. Usually, a value of zero means maximum
-speed. The actual effect of this option depends on the JTAG interface used. 
-
-The speed used during reset can be adjusted using setting jtag_speed during
-pre_reset and post_reset events.
- at itemize @minus
-
- at item wiggler: maximum speed / @var{number}
- at item ft2232: 6MHz / (@var{number}+1)
- at item amt jtagaccel: 8 / 2**@var{number}
- at item jlink: maximum speed in kHz (0-12000), 0 will use RTCK
- at item rlink: 24MHz / @var{number}, but only for certain values of @var{number}
- at comment end speed list.
- at end itemize
-
- at comment END command list
- at end itemize
-
 @node Reset Configuration
 @chapter Reset Configuration
 @cindex Reset Configuration
@@ -3696,6 +3701,20 @@
 @item @b{flash auto_erase}
 @cindex flash auto_erase
 @*use @option{flash write_image} command passing @option{erase} as the first parameter. @xref{flash write_image}.
+
+ at item @b{jtag_speed} value
+@*@xref{JTAG Speed}.
+Usually, a value of zero means maximum
+speed. The actual effect of this option depends on the JTAG interface used.
+ at itemize @minus
+ at item wiggler: maximum speed / @var{number}
+ at item ft2232: 6MHz / (@var{number}+1)
+ at item amt jtagaccel: 8 / 2**@var{number}
+ at item jlink: maximum speed in kHz (0-12000), 0 will use RTCK
+ at item rlink: 24MHz / @var{number}, but only for certain values of @var{number}
+ at comment end speed list.
+ at end itemize
+
 @item @b{load_binary}
 @cindex load_binary
 @*use @option{load_image} command with same args. @xref{load_image}.
@@ -3724,6 +3743,7 @@
 @cindex faq
 @enumerate
 @item @b{RTCK, also known as: Adaptive Clocking - What is it?}
+ at anchor{FAQ RTCK}
 @cindex RTCK
 @cindex adaptive clocking
 @*

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-24 21:08:42 UTC (rev 1909)
+++ trunk/src/jtag/ft2232.c	2009-05-24 21:13:29 UTC (rev 1910)
@@ -446,7 +446,7 @@
 {
 	if (khz==0)
 	{
-		LOG_ERROR("RCLK not supported");
+		LOG_DEBUG("RTCK not supported");
 		return ERROR_FAIL;
 	}
 

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-24 21:08:42 UTC (rev 1909)
+++ trunk/src/jtag/jtag.c	2009-05-24 21:13:29 UTC (rev 1910)
@@ -2315,9 +2315,10 @@
 	register_command(cmd_ctx, NULL, "interface", handle_interface_command,
 		COMMAND_CONFIG, "try to configure interface");
 	register_command(cmd_ctx, NULL, "jtag_speed", handle_jtag_speed_command,
-		COMMAND_ANY, "set jtag speed (if supported)");
+		COMMAND_ANY, "(DEPRECATED) set jtag speed (if supported)");
 	register_command(cmd_ctx, NULL, "jtag_khz", handle_jtag_khz_command,
-		COMMAND_ANY, "same as jtag_speed, except it takes maximum khz as arguments. 0 KHz = RTCK.");
+		COMMAND_ANY, "set maximum jtag speed (if supported); "
+		"parameter is maximum khz, or 0 for adaptive clocking (RTCK).");
 	register_command(cmd_ctx, NULL, "jtag_device", handle_jtag_device_command,
 		COMMAND_CONFIG, "jtag_device <ir_length> <ir_expected> <ir_mask>");
 	register_command(cmd_ctx, NULL, "reset_config", handle_reset_config_command,



From kc8apf at mail.berlios.de  Mon May 25 17:51:31 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 25 May 2009 17:51:31 +0200
Subject: [Openocd-svn] r1911 - trunk/src/flash
Message-ID: <200905251551.n4PFpVmJ008514@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-25 17:51:30 +0200 (Mon, 25 May 2009)
New Revision: 1911

Modified:
   trunk/src/flash/cfi.c
Log:
Author: Ra?\195?\186l S?\195?\161nchez Siles <rsanchezs at infoglobal.es>
- cfi flash_address coding style fix


Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-05-24 21:13:29 UTC (rev 1910)
+++ trunk/src/flash/cfi.c	2009-05-25 15:51:30 UTC (rev 1911)
@@ -114,9 +114,11 @@
 {
 	cfi_flash_bank_t *cfi_info = bank->driver_priv;
 
+	if(cfi_info->x16_as_x8) offset*=2;
+
 	/* while the sector list isn't built, only accesses to sector 0 work */
 	if (sector == 0)
-		return bank->base + (offset * bank->bus_width << cfi_info->x16_as_x8 );
+		return bank->base + offset * bank->bus_width;
 	else
 	{
 		if (!bank->sectors)
@@ -124,7 +126,7 @@
 			LOG_ERROR("BUG: sector list not yet built");
 			exit(-1);
 		}
-		return bank->base + bank->sectors[sector].offset + (offset * bank->bus_width << cfi_info->x16_as_x8 );
+		return bank->base + bank->sectors[sector].offset + offset * bank->bus_width;
 	}
 
 }



From kc8apf at mail.berlios.de  Mon May 25 17:56:15 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Mon, 25 May 2009 17:56:15 +0200
Subject: [Openocd-svn] r1912 - trunk/src/svf
Message-ID: <200905251556.n4PFuFSU008844@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-25 17:56:15 +0200 (Mon, 25 May 2009)
New Revision: 1912

Modified:
   trunk/src/svf/svf.c
Log:
Author: Simon Qian <simonqian at SimonQian.com>
	- add tap_state_svf_name since tap_state_name doesn't use SVF standard names


Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-25 15:51:30 UTC (rev 1911)
+++ trunk/src/svf/svf.c	2009-05-25 15:56:15 UTC (rev 1912)
@@ -218,6 +218,34 @@
 	}
 }
 
+static const char* tap_state_svf_name(tap_state_t state)
+{
+	const char* ret;
+
+	switch( state )
+	{
+	case TAP_RESET:		ret = "RESET";		break;
+	case TAP_IDLE:		ret = "IDLE";		break;
+	case TAP_DRSELECT:	ret = "DRSELECT";	break;
+	case TAP_DRCAPTURE: ret = "DRCAPTURE";	break;
+	case TAP_DRSHIFT:	ret = "DRSHIFT";	break;
+	case TAP_DREXIT1:	ret = "DREXIT1";	break;
+	case TAP_DRPAUSE:	ret = "DRPAUSE";	break;
+	case TAP_DREXIT2:	ret = "DREXIT2";	break;
+	case TAP_DRUPDATE:	ret = "DRUPDATE";	break;
+	case TAP_IRSELECT:	ret = "IRSELECT";	break;
+	case TAP_IRCAPTURE: ret = "IRCAPTURE";	break;
+	case TAP_IRSHIFT:	ret = "IRSHIFT";	break;
+	case TAP_IREXIT1:	ret = "IREXIT1";	break;
+	case TAP_IRPAUSE:	ret = "IRPAUSE";	break;
+	case TAP_IREXIT2:	ret = "IREXIT2";	break;
+	case TAP_IRUPDATE:	ret = "IRUPDATE";	break;
+	default:			ret = "???";		break;
+	}
+
+	return ret;
+}
+
 static int handle_svf_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 #define SVF_NUM_OF_OPTIONS			1
@@ -305,7 +333,7 @@
 	memcpy(&svf_para, &svf_para_init, sizeof(svf_para));
 	for (i = 0; i < (int)dimof(svf_tap_state_name); i++)
 	{
-		svf_tap_state_name[i] = (char *)tap_state_name(i);
+		svf_tap_state_name[i] = (char *)tap_state_svf_name(i);
 	}
 	// TAP_RESET
 	jtag_add_tlr();



From zwelch at mail.berlios.de  Tue May 26 02:23:27 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 26 May 2009 02:23:27 +0200
Subject: [Openocd-svn] r1913 - trunk/doc
Message-ID: <200905260023.n4Q0NRmf017085@sheep.berlios.de>

Author: zwelch
Date: 2009-05-26 02:23:23 +0200 (Tue, 26 May 2009)
New Revision: 1913

Modified:
   trunk/doc/openocd.texi
Log:
David Brownell <david-b at pacbell.net>:

Update the "Reset Configuration" information in the User's guide:

 - Convert to @deffn syntax
 - Move tutorial text from command descriptions into new sections
 - Describe several different types of JTAG-visible reset
 - Expand descriptions of configuration tweaks for SRST and TRST 
 - Link to the "reset" command, and vice versa
 - Bugfix the "reset_config" description (it didn't match the code)

Plus, be more proscriptive:  do it in board config files, except for
the oddball cases where that won't work. (Current target.cfg files
seem to have much goofage there; several seem board-specific.)


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-25 15:56:15 UTC (rev 1912)
+++ trunk/doc/openocd.texi	2009-05-26 00:23:23 UTC (rev 1913)
@@ -1551,67 +1551,133 @@
 @cindex Reset Configuration
 
 Every system configuration may require a different reset
-configuration. This can also be quite confusing. Please see the
-various board files for example.
+configuration. This can also be quite confusing.
+Please see the various board files for examples.
 
- at section jtag_nsrst_delay <@var{ms}>
- at cindex jtag_nsrst_delay
-@*How long (in milliseconds) OpenOCD should wait after deasserting
-nSRST before starting new JTAG operations.
+ at b{Note} to maintainers and integrators:
+Reset configuration touches several things at once.
+Normally the board configuration file
+should define it and assume that the JTAG adapter supports
+everything that's wired up to the board's JTAG connector.
+However, the target configuration file could also make note
+of something the silicon vendor has done inside the chip,
+which will be true for most (or all) boards using that chip.
+And when the JTAG adapter doesn't support everything, the
+system configuration file will need to override parts of
+the reset configuration provided by other files.
 
- at section jtag_ntrst_delay <@var{ms}>
- at cindex jtag_ntrst_delay
-@*Same @b{jtag_nsrst_delay}, but for nTRST  
+ at section Types of Reset
 
-The jtag_n[st]rst_delay options are useful if reset circuitry (like a
-big resistor/capacitor, reset supervisor, or on-chip features). This
-keeps the signal asserted for some time after the external reset got
-deasserted.
+There are many kinds of reset possible through JTAG, but
+they may not all work with a given board and adapter.
+That's part of why reset configuration can be error prone.
 
- at section reset_config
+ at itemize @bullet
+ at item
+ at emph{System Reset} ... the @emph{SRST} hardware signal
+resets all chips connected to the JTAG adapter, such as processors,
+power management chips, and I/O controllers.  Normally resets triggered
+with this signal behave exactly like pressing a RESET button.
+ at item
+ at emph{JTAG TAP Reset} ... the @emph{TRST} hardware signal resets
+just the TAP controllers connected to the JTAG adapter.
+Such resets should not be visible to the rest of the system; resetting a
+device's the TAP controller just puts that controller into a known state.
+ at item
+ at emph{Emulation Reset} ... many devices can be reset through JTAG
+commands.  These resets are often distinguishable from system
+resets, either explicitly (a "reset reason" register says so)
+or implicitly (not all parts of the chip get reset).
+ at item
+ at emph{Other Resets} ... system-on-chip devices often support
+several other types of reset.
+You may need to arrange that a watchdog timer stops
+while debugging, preventing a watchdog reset.
+There may be individual module resets.
+ at end itemize
 
- at b{Note:} To maintainers and integrators: Where exactly the
-``reset configuration'' goes is a good question. It touches several
-things at once. In the end, if you have a board file - the board file
-should define it and assume 100% that the DONGLE supports
-anything. However, that does not mean the target should not also make
-not of something the silicon vendor has done inside the
-chip. @i{Grr.... nothing is every pretty.}
+In the best case, OpenOCD can hold SRST, then reset
+the TAPs via TRST and send commands through JTAG to halt the
+CPU at the reset vector before the 1st instruction is executed.
+Then when it finally releases the SRST signal, the system is
+halted under debugger control before any code has executed.
+This is the behavior required to support the @command{reset halt}
+and @command{reset init} commands; after @command{reset init} a
+board-specific script might do things like setting up DRAM.
+(@xref{Reset Command}.)
 
-@* @b{Problems:} 
- at enumerate
- at item Every JTAG Dongle is slightly different, some dongles implement reset differently.
- at item Every board is also slightly different; some boards tie TRST and SRST together.
- at item Every chip is slightly different; some chips internally tie the two signals together.
- at item Some may not implement all of the signals the same way.
- at item Some signals might be push-pull, others open-drain/collector.
- at end enumerate
- at b{Best Case:} OpenOCD can hold the SRST (push-button-reset), then
-reset the TAP via TRST and send commands through the JTAG tap to halt
-the CPU at the reset vector before the 1st instruction is executed,
-and finally release the SRST signal.
-@*Depending on your board vendor, chip vendor, etc., these
-signals may have slightly different names. 
+ at section SRST and TRST Signal Issues
 
-OpenOCD defines these signals in these terms:
+Because SRST and TRST are hardware signals, they can have a
+variety of system-specific constraints.  Some of the most
+common issues are:
+
 @itemize @bullet
- at item @b{TRST} - is Tap Reset - and should reset only the TAP.
- at item @b{SRST} - is System Reset - typically equal to a reset push button.
+
+ at item @emph{Signal not available} ... Some boards don't wire
+SRST or TRST to the JTAG connector.  Some JTAG adapters don't
+support such signals even if they are wired up.
+Use the @command{reset_config} @var{signals} options to say
+when one of those signals is not connected.
+When SRST is not available, your code might not be able to rely
+on controllers having been fully reset during code startup.
+
+ at item @emph{Signals shorted} ... Sometimes a chip, board, or
+adapter will connect SRST to TRST, instead of keeping them separate.
+Use the @command{reset_config} @var{combination} options to say
+when those signals aren't properly independent.
+
+ at item @emph{Timing} ... Reset circuitry like a resistor/capacitor
+delay circuit, reset supervisor, or on-chip features can extend
+the effect of a JTAG adapter's reset for some time after the adapter
+stops issuing the reset.  For example, there may be chip or board
+requirements that all reset pulses last for at least a
+certain amount of time; and reset buttons commonly have
+hardware debouncing.
+Use the @command{jtag_nsrst_delay} and @command{jtag_ntrst_delay}
+commands to say when extra delays are needed.
+
+ at item @emph{Drive type} ... Reset lines often have a pullup
+resistor, letting the JTAG interface treat them as open-drain
+signals.  But that's not a requirement, so the adapter may need
+to use push/pull output drivers.
+Also, with weak pullups it may be advisable to drive
+signals to both levels (push/pull) to minimize rise times.
+Use the @command{reset_config} @var{trst_type} and
+ at var{srst_type} parameters to say how to drive reset signals.
 @end itemize
 
-The Command:
+There can also be other issues.
+Some devices don't fully conform to the JTAG specifications.
+Others have chip-specific extensions like extra steps needed
+during TAP reset, or a requirement to use the normally-optional TRST
+signal.
+Trivial system-specific differences are common, such as
+SRST and TRST using slightly different names.
 
- at itemize @bullet
- at item @b{reset_config} <@var{signals}> [@var{combination}] [@var{trst_type}] [@var{srst_type}]
- at cindex reset_config
-@* The @t{reset_config} command tells OpenOCD the reset configuration
-of your combination of Dongle, Board, and Chips.
-If the JTAG interface provides SRST, but the target doesn't connect
-that signal properly, then OpenOCD can't use it. <@var{signals}> can
+ at section Commands for Handling Resets
+
+ at deffn {Command} jtag_nsrst_delay milliseconds
+How long (in milliseconds) OpenOCD should wait after deasserting
+nSRST (active-low system reset) before starting new JTAG operations.
+When a board has a reset button connected to SRST line it will
+probably have hardware debouncing, implying you should use this.
+ at end deffn
+
+ at deffn {Command} jtag_ntrst_delay milliseconds
+How long (in milliseconds) OpenOCD should wait after deasserting
+nTRST (active-low JTAG TAP reset) before starting new JTAG operations.
+ at end deffn
+
+ at deffn {Command} reset_config signals [combination [trst_type [srst_type]]]
+This command tells OpenOCD the reset configuration
+of your combination of JTAG interface, board, and target.
+If the JTAG interface provides SRST, but the board doesn't connect
+that signal properly, then OpenOCD can't use it. @var{signals} can
 be @option{none}, @option{trst_only}, @option{srst_only} or
 @option{trst_and_srst}.
 
-[@var{combination}] is an optional value specifying broken reset
+The @var{combination} is an optional value specifying broken reset
 signal implementations.  @option{srst_pulls_trst} states that the
 test logic is reset together with the reset of the system (e.g. Philips
 LPC2000, "broken" board layout), @option{trst_pulls_srst} says that
@@ -1621,19 +1687,16 @@
 @option{trst_pulls_srst}.  The default behaviour if no option given is
 @option{separate}.
 
-The [@var{trst_type}] and [@var{srst_type}] parameters allow the
+The optional @var{trst_type} and @var{srst_type} parameters allow the
 driver type of the reset lines to be specified. Possible values are
 @option{trst_push_pull} (default) and @option{trst_open_drain} for the
 test reset signal, and @option{srst_open_drain} (default) and
 @option{srst_push_pull} for the system reset. These values only affect
 JTAG interfaces with support for different drivers, like the Amontec
 JTAGkey and JTAGAccelerator.
+ at end deffn
 
- at comment - end command
- at end itemize
 
-
-
 @node Tap Creation
 @chapter Tap Creation
 @cindex tap creation
@@ -3053,11 +3116,14 @@
 @cindex step
 @*Single-step the target at its current code position, or at an optional address. 
 
+ at anchor{Reset Command}
 @subsection reset [@option{run}|@option{halt}|@option{init}]
 @cindex reset
-@*Perform a hard-reset. The optional parameter specifies what should happen after the reset.
-
-With no arguments a "reset run" is executed
+@*Perform a hard-reset. The optional parameter specifies what should
+happen after the reset.
+If there is no parameter, a @command{reset run} is executed.
+The other options will not work on all systems.
+ at xref{Reset Configuration}.
 @itemize @minus
 @item @b{run}
 @cindex reset run



From zwelch at mail.berlios.de  Tue May 26 03:22:27 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 26 May 2009 03:22:27 +0200
Subject: [Openocd-svn] r1914 - trunk/src/svf
Message-ID: <200905260122.n4Q1MRw1025825@sheep.berlios.de>

Author: zwelch
Date: 2009-05-26 03:22:23 +0200 (Tue, 26 May 2009)
New Revision: 1914

Modified:
   trunk/src/svf/svf.c
Log:
SimonQian <simonqian at SimonQian.com>:

Add svf_get_mask_u32 to generate a mask according to bitlen.
Fix this bug in other functions except for svf_check_tdo.


Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-26 00:23:23 UTC (rev 1913)
+++ trunk/src/svf/svf.c	2009-05-26 01:22:23 UTC (rev 1914)
@@ -218,6 +218,26 @@
 	}
 }
 
+unsigned svf_get_mask_u32(int bitlen)
+{
+	u32 bitmask;
+
+	if (bitlen < 0)
+	{
+		bitmask = 0;
+	}
+	else if (bitlen >= 32)
+	{
+		bitmask = 0xFFFFFFFF;
+	}
+	else
+	{
+		bitmask = (1 << bitlen) - 1;
+	}
+
+	return bitmask;
+}
+
 static const char* tap_state_svf_name(tap_state_t state)
 {
 	const char* ret;
@@ -667,14 +687,8 @@
 		{
 			unsigned bitmask;
 			unsigned received, expected, tapmask;
-			if (svf_check_tdo_para[i].bit_len >= 32)
-			{
-				bitmask = 0xFFFFFFFF;
-			}
-			else
-			{
-				bitmask = (1 << svf_check_tdo_para[i].bit_len) - 1;
-			}
+			bitmask = svf_get_mask_u32(svf_check_tdo_para[i].bit_len);
+
 			memcpy(&received, svf_tdi_buffer + index, sizeof(unsigned));
 			memcpy(&expected, svf_tdo_buffer + index, sizeof(unsigned));
 			memcpy(&tapmask, svf_mask_buffer + index, sizeof(unsigned));
@@ -890,7 +904,7 @@
 				LOG_ERROR("fail to parse hex value");
 				return ERROR_FAIL;
 			}
-			LOG_DEBUG("\t%s = 0x%X", argus[i], (**(int**)pbuffer_tmp) & ((1 << (xxr_para_tmp->len)) - 1));
+			LOG_DEBUG("\t%s = 0x%X", argus[i], (**(int**)pbuffer_tmp) & svf_get_mask_u32(xxr_para_tmp->len));
 		}
 		// If a command changes the length of the last scan of the same type and the MASK parameter is absent,
 		// the mask pattern used is all cares
@@ -1403,7 +1417,7 @@
 				int read_value;
 				memcpy(&read_value, svf_tdi_buffer, sizeof(int));
 				// in debug mode, data is from index 0
-				int read_mask = (1 << (svf_check_tdo_para[0].bit_len)) - 1;
+				int read_mask = svf_get_mask_u32(svf_check_tdo_para[0].bit_len);
 				LOG_DEBUG("\tTDO read = 0x%X", read_value & read_mask);
 			}
 		}



From zwelch at mail.berlios.de  Tue May 26 03:27:59 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 26 May 2009 03:27:59 +0200
Subject: [Openocd-svn] r1915 - trunk/src/svf
Message-ID: <200905260127.n4Q1Rx07026519@sheep.berlios.de>

Author: zwelch
Date: 2009-05-26 03:27:56 +0200 (Tue, 26 May 2009)
New Revision: 1915

Modified:
   trunk/src/svf/svf.c
Log:
SimonQian <simonqian at SimonQian.com>, reported by R.Doss:

This patch fixes a segfault when TDO was not received in XXR command:
- allocate space for the value and mask anyway
- clear the mask to zero to effectively skip the output comparison step


Modified: trunk/src/svf/svf.c
===================================================================
--- trunk/src/svf/svf.c	2009-05-26 01:22:23 UTC (rev 1914)
+++ trunk/src/svf/svf.c	2009-05-26 01:27:56 UTC (rev 1915)
@@ -918,6 +918,27 @@
 			}
 			buf_set_ones(xxr_para_tmp->mask, xxr_para_tmp->len);
 		}
+		// If TDO is absent, no comparison is needed, set the mask to 0
+		if (!(xxr_para_tmp->data_mask & XXR_TDO))
+		{
+			if (NULL == xxr_para_tmp->tdo)
+			{
+				if (ERROR_OK != svf_adjust_array_length(&xxr_para_tmp->tdo, i_tmp, xxr_para_tmp->len))
+				{
+					LOG_ERROR("fail to adjust length of array");
+					return ERROR_FAIL;
+				}
+			}
+			if (NULL == xxr_para_tmp->mask)
+			{
+				if (ERROR_OK != svf_adjust_array_length(&xxr_para_tmp->mask, i_tmp, xxr_para_tmp->len))
+				{
+					LOG_ERROR("fail to adjust length of array");
+					return ERROR_FAIL;
+				}
+			}
+			memset(xxr_para_tmp->mask, 0, (xxr_para_tmp->len + 7) >> 3);
+		}
 		// do scan if necessary
 		if (SDR == command)
 		{



From zwelch at mail.berlios.de  Wed May 27 01:58:06 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 01:58:06 +0200
Subject: [Openocd-svn] r1916 - trunk
Message-ID: <200905262358.n4QNw6HX022889@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 01:58:01 +0200 (Wed, 27 May 2009)
New Revision: 1916

Modified:
   trunk/BUGS
   trunk/PATCHES
   trunk/TODO
Log:
Update Doxygen markup in PATCHES, BUGS, and TODO:
- In the File List, these files are listed and link to empty pages.
- This patch adds @file blocks to reference the pages each file contains.
- Remove redundant "OpenOCD" from PATCHES title; it clutters the tree view.


Modified: trunk/BUGS
===================================================================
--- trunk/BUGS	2009-05-26 01:27:56 UTC (rev 1915)
+++ trunk/BUGS	2009-05-26 23:58:01 UTC (rev 1916)
@@ -44,3 +44,6 @@
 box.  Please keep attachments to less than 100KB.
 
  */
+/** @file
+This file contains the @ref bugs page.
+*/

Modified: trunk/PATCHES
===================================================================
--- trunk/PATCHES	2009-05-26 01:27:56 UTC (rev 1915)
+++ trunk/PATCHES	2009-05-26 23:58:01 UTC (rev 1916)
@@ -1,4 +1,4 @@
-/** @page patchguide OpenOCD Patch Policies
+/** @page patchguide Patch Policies
 
 Please mail patches to:
 
@@ -46,3 +46,6 @@
 able to create and apply patches as well...
  
  */
+/** @file
+This file contains the @ref patchguide page.
+*/

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-05-26 01:27:56 UTC (rev 1915)
+++ trunk/TODO	2009-05-26 23:58:01 UTC (rev 1916)
@@ -148,3 +148,6 @@
   - use bug tracking?  we need something!
 
 */
+/** @file
+This file contains the @ref thelist page.
+*/



From zwelch at mail.berlios.de  Wed May 27 04:01:21 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 04:01:21 +0200
Subject: [Openocd-svn] r1917 - trunk
Message-ID: <200905270201.n4R21Lvl003740@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 04:01:15 +0200 (Wed, 27 May 2009)
New Revision: 1917

Modified:
   trunk/Makefile.am
Log:
Add warning to generated Doxyfile to edit Doxyfile.in.

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-05-26 23:58:01 UTC (rev 1916)
+++ trunk/Makefile.am	2009-05-27 02:01:15 UTC (rev 1917)
@@ -18,7 +18,12 @@
 docs: pdf html doxygen
 
 Doxyfile: $(srcdir)/Doxyfile.in
-	sed -e 's, at srcdir\@,$(srcdir),' $< > $@
+	@echo "Creating $@ from $<..."
+	@( \
+	  echo "### @@@ -= DO NOT EDIT THIS FILE =- @@@ ###" && \
+	  echo "### @@@ Make changes to Doxyfile.in @@@ ###" && \
+	  sed -e 's, at srcdir\@,$(srcdir),' $< \
+	) > $@
 
 doxygen::
 	$(MAKE) Doxyfile



From zwelch at mail.berlios.de  Wed May 27 08:44:56 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 08:44:56 +0200
Subject: [Openocd-svn] r1918 - in trunk: . src src/target src/tcl
Message-ID: <200905270644.n4R6iuUv032385@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 08:44:43 +0200 (Wed, 27 May 2009)
New Revision: 1918

Added:
   trunk/src/tcl/board/
   trunk/src/tcl/interface/
   trunk/src/tcl/target/
   trunk/src/tcl/test/
Removed:
   trunk/src/target/board/
   trunk/src/target/interface/
   trunk/src/target/target/
   trunk/src/target/test/
Modified:
   trunk/Makefile.am
   trunk/configure.in
   trunk/src/Makefile.am
   trunk/src/target/Makefile.am
Log:
Move TCL script files -- Step 1 of 2:
- Move src/target/{interface,target,board,test}/ into src/tcl/
- Remove existing rules in src/Makefile.am and src/target/Makefile.am.
- Add Makefile.am handling of *.cfg and *.tcl files in top Makefile.am:
  - Add dist-hook to include such files under src/tcl in the distribution.
  - Add install-data-hook to install contents of '$(top_srcdir)/src/tcl/'.
  - Add uninstall-hook to remove the installed script files.
- Change paths to (un)install script files in '$(pkgdatadir)/scripts'.


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-05-27 02:01:15 UTC (rev 1917)
+++ trunk/Makefile.am	2009-05-27 06:44:43 UTC (rev 1918)
@@ -29,6 +29,29 @@
 	$(MAKE) Doxyfile
 	doxygen Doxyfile 2>&1 | perl $(srcdir)/tools/logger.pl > doxygen.log
 
+TCL_PATH = src/tcl
+# command to find paths of script files, relative to TCL_PATH
+TCL_FILES := find $(srcdir)/$(TCL_PATH) -name '*.cfg' -o -name '*.tcl' | \
+		sed -e 's,^$(srcdir)/$(TCL_PATH),,'
+
+dist-hook:
+	for i in $$($(TCL_FILES)); do \
+		j="$(distdir)/$(TCL_PATH)/$$i" && \
+		mkdir -p "$$(dirname $$j)" && \
+		$(INSTALL_DATA) $(srcdir)/$(TCL_PATH)/$$i $$j; \
+	done
+
+install-data-hook:
+	for i in $$($(TCL_FILES)); do \
+		j="$(DESTDIR)$(pkgdatadir)/scripts/$$i" && \
+		mkdir -p "$$(dirname $$j)" && \
+		$(INSTALL_DATA) $(srcdir)/$(TCL_PATH)/$$i $$j; \
+	done
+
+uninstall-hook:
+	rm -rf $(DESTDIR)$(pkgdatadir)/scripts
+
+
 distclean-local:
 	rm -rf Doxyfile doxygen
 

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-05-27 02:01:15 UTC (rev 1917)
+++ trunk/configure.in	2009-05-27 06:44:43 UTC (rev 1918)
@@ -834,6 +834,7 @@
 AM_PROG_CC_C_O
 AC_PROG_RANLIB
 AC_PROG_LIBTOOL
+AC_PROG_INSTALL
 
 dnl configure checks required for Jim files (these are obsolete w/ C99)
 AC_C_CONST

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-05-27 02:01:15 UTC (rev 1917)
+++ trunk/src/Makefile.am	2009-05-27 06:44:43 UTC (rev 1918)
@@ -92,24 +92,4 @@
 libopenocd_la_LIBADD += -lmicrohttpd
 endif
 
-nobase_dist_pkglib_DATA = \
-	tcl/bitsbytes.tcl			\
-	tcl/chip/atmel/at91/aic.tcl		\
-	tcl/chip/atmel/at91/at91sam7x128.tcl	\
-	tcl/chip/atmel/at91/at91sam7x256.tcl	\
-	tcl/chip/atmel/at91/pmc.tcl		\
-	tcl/chip/atmel/at91/rtt.tcl		\
-	tcl/chip/atmel/at91/usarts.tcl		\
-	tcl/chip/st/stm32/stm32.tcl		\
-	tcl/chip/st/stm32/stm32_rcc.tcl		\
-	tcl/chip/st/stm32/stm32_regs.tcl	\
-	tcl/cpu/arm/arm7tdmi.tcl		\
-	tcl/cpu/arm/arm920.tcl			\
-	tcl/cpu/arm/arm946.tcl			\
-	tcl/cpu/arm/arm966.tcl			\
-	tcl/cpu/arm/cortex_m3.tcl               \
-	tcl/memory.tcl				\
-	tcl/mmr_helpers.tcl			\
-	tcl/readable.tcl
-
 MAINTAINERCLEANFILES = Makefile.in

Modified: trunk/src/target/Makefile.am
===================================================================
--- trunk/src/target/Makefile.am	2009-05-27 02:01:15 UTC (rev 1917)
+++ trunk/src/target/Makefile.am	2009-05-27 06:44:43 UTC (rev 1918)
@@ -26,14 +26,5 @@
 nobase_dist_pkglib_DATA =
 nobase_dist_pkglib_DATA += xscale/debug_handler.bin 
 nobase_dist_pkglib_DATA += ecos/at91eb40a.elf
-# Various chip targets
-nobase_dist_pkglib_DATA += $(wildcard $(srcdir)/target/*.cfg)
-# Various jtag interfaces
-nobase_dist_pkglib_DATA += $(wildcard $(srcdir)/interface/*.cfg)
-# Various preconfigured boards
-nobase_dist_pkglib_DATA += $(wildcard $(srcdir)/board/*.cfg)
 
-# test files
-nobase_dist_pkglib_DATA += $(wildcard $(srcdir)/test/*.cfg)
-
 MAINTAINERCLEANFILES = Makefile.in

Copied: trunk/src/tcl/board (from rev 1917, trunk/src/target/board)

Copied: trunk/src/tcl/interface (from rev 1917, trunk/src/target/interface)

Copied: trunk/src/tcl/target (from rev 1917, trunk/src/target/target)

Copied: trunk/src/tcl/test (from rev 1917, trunk/src/target/test)



From zwelch at mail.berlios.de  Wed May 27 08:49:30 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 08:49:30 +0200
Subject: [Openocd-svn] r1919 - in trunk: . src
Message-ID: <200905270649.n4R6nU6A003014@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 08:49:24 +0200 (Wed, 27 May 2009)
New Revision: 1919

Added:
   trunk/tcl/
Removed:
   trunk/src/tcl/
Modified:
   trunk/Makefile.am
Log:
Move TCL script files -- Step 2 of 2:
- Move src/tcl to tcl/.
- Update top Makefile.am to use new path name.


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-05-27 06:44:43 UTC (rev 1918)
+++ trunk/Makefile.am	2009-05-27 06:49:24 UTC (rev 1919)
@@ -29,7 +29,7 @@
 	$(MAKE) Doxyfile
 	doxygen Doxyfile 2>&1 | perl $(srcdir)/tools/logger.pl > doxygen.log
 
-TCL_PATH = src/tcl
+TCL_PATH = tcl
 # command to find paths of script files, relative to TCL_PATH
 TCL_FILES := find $(srcdir)/$(TCL_PATH) -name '*.cfg' -o -name '*.tcl' | \
 		sed -e 's,^$(srcdir)/$(TCL_PATH),,'

Copied: trunk/tcl (from rev 1918, trunk/src/tcl)



From zwelch at mail.berlios.de  Wed May 27 09:50:05 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 09:50:05 +0200
Subject: [Openocd-svn] r1920 - in trunk/src: . helper server
Message-ID: <200905270750.n4R7o5Hq017432@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 09:49:58 +0200 (Wed, 27 May 2009)
New Revision: 1920

Modified:
   trunk/src/Makefile.am
   trunk/src/helper/Makefile.am
   trunk/src/helper/options.c
   trunk/src/server/Makefile.am
   trunk/src/server/httpd.c
Log:
Update build system to find moved scripts -- Step 3 of 2:
- Update references from using PKGLIBDIR to PKGDATADIR.
- Update built-in script search paths to reflect new install location:
  - $(pkgdatadir)       =>   $(pktdatadir)/site
  - $(pkglibdir)        =>   $(pktdatadir)/scripts
- Update installed location of httpd files:
  - $(pkglibdir)/httpd   =>   $(pkgdatadir)/httpd


Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-05-27 06:49:24 UTC (rev 1919)
+++ trunk/src/Makefile.am	2009-05-27 07:49:58 UTC (rev 1920)
@@ -26,10 +26,7 @@
 	-I$(top_srcdir)/src/flash \
 	-I$(top_srcdir)/src/pld
 
-# pass path to prefix path
-libopenocd_la_CPPFLAGS = \
- -DPKGLIBDIR=\"$(pkglibdir)\" \
- -DPKGBLDDATE=\"`date +%F-%R`\"
+libopenocd_la_CPPFLAGS = -DPKGBLDDATE=\"`date +%F-%R`\"
 
 if RELEASE
 libopenocd_la_CPPFLAGS += -DRELSTR=\"Release\" -DPKGBLDREV=\"\"

Modified: trunk/src/helper/Makefile.am
===================================================================
--- trunk/src/helper/Makefile.am	2009-05-27 06:49:24 UTC (rev 1919)
+++ trunk/src/helper/Makefile.am	2009-05-27 07:49:58 UTC (rev 1920)
@@ -1,8 +1,7 @@
 AM_CPPFLAGS = \
 	-I$(top_srcdir)/src/server \
 	-I$(top_srcdir)/src/target \
-	-DPKGDATADIR=\"$(pkgdatadir)\" \
-	-DPKGLIBDIR=\"$(pkglibdir)\"
+	-DPKGDATADIR=\"$(pkgdatadir)\"
 
 METASOURCES = AUTO
 noinst_LTLIBRARIES = libhelper.la

Modified: trunk/src/helper/options.c
===================================================================
--- trunk/src/helper/options.c	2009-05-27 06:49:24 UTC (rev 1919)
+++ trunk/src/helper/options.c	2009-05-27 07:49:58 UTC (rev 1920)
@@ -97,10 +97,14 @@
 		add_script_search_dir(strExePath);
 	}
 #else
-	/* Add dir for openocd supplied scripts last so that user can over
-	   ride those scripts if desired. */
-	add_script_search_dir(PKGDATADIR);
-	add_script_search_dir(PKGLIBDIR);
+	/*
+	 * The directory containing OpenOCD-supplied scripts should be
+	 * listed last in the built-in search order, so the user can
+	 * override these scripts with site-specific customizations.
+	 */
+	/// @todo Implement @c add_script_search_dir("${HOME}/.openocd").
+	add_script_search_dir(PKGDATADIR "/site");
+	add_script_search_dir(PKGDATADIR "/scripts");
 #endif
 	return ERROR_OK;
 }

Modified: trunk/src/server/Makefile.am
===================================================================
--- trunk/src/server/Makefile.am	2009-05-27 06:49:24 UTC (rev 1919)
+++ trunk/src/server/Makefile.am	2009-05-27 07:49:58 UTC (rev 1920)
@@ -3,7 +3,7 @@
 	-I$(top_srcdir)/src/target \
 	-I$(top_srcdir)/src/flash \
 	-I$(top_srcdir)/src/jtag  \
-	-DPKGLIBDIR=\"$(pkglibdir)\"
+	-DPKGDATADIR=\"$(pkgdatadir)\"
 
 METASOURCES = AUTO
 noinst_LTLIBRARIES = libserver.la
@@ -25,7 +25,12 @@
 libserver_la_SOURCES += tcl_server.c
 
 if HTTPD
-nobase_dist_pkglib_DATA = $(wildcard $(srcdir)/httpd/*.tcl $(srcdir)/httpd/*.css $(srcdir)/httpd/menu_cuts/*.png)
+nobase_dist_pkgdata_DATA = \
+	$(wildcard \
+		$(srcdir)/httpd/*.tcl \
+		$(srcdir)/httpd/*.css \
+		$(srcdir)/httpd/menu_cuts/*.png \
+	)
 endif
 
 EXTRA_DIST = \

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2009-05-27 06:49:24 UTC (rev 1919)
+++ trunk/src/server/httpd.c	2009-05-27 07:49:58 UTC (rev 1920)
@@ -393,7 +393,7 @@
 	 * being subverted to evil purposes
 	 */
 
-	const char *httpd_dir=PKGLIBDIR "/httpd";
+	const char *httpd_dir = PKGDATADIR "/httpd";
 
 	if (*url=='/')
 	{



From zwelch at mail.berlios.de  Wed May 27 12:27:35 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 12:27:35 +0200
Subject: [Openocd-svn] r1921 - trunk/doc/manual/primer
Message-ID: <200905271027.n4RARZqk010326@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 12:27:32 +0200 (Wed, 27 May 2009)
New Revision: 1921

Added:
   trunk/doc/manual/primer/autotools.txt
Log:
Add draft of Autotools Primer to The Manual.

Added: trunk/doc/manual/primer/autotools.txt
===================================================================
--- trunk/doc/manual/primer/autotools.txt	2009-05-27 07:49:58 UTC (rev 1920)
+++ trunk/doc/manual/primer/autotools.txt	2009-05-27 10:27:32 UTC (rev 1921)
@@ -0,0 +1,167 @@
+/** @page primerautotools OpenOCD Autotools Primer
+
+This page provides an overview to OpenOCD's use of the GNU autotool suite:
+- @ref primerautoconf
+- @ref primerautomake
+- @ref primerlibtool
+
+Most developers do not need to concern themselves with these tools, as
+the @ref primerbootstrap script runs these tools in the required sequence.
+
+ at section primerbootstrap Autotools Bootstrap
+
+The @c bootstrap script should be used by developers to run the
+autotools in the correct sequence.
+
+When run after a fresh checkout, this script generates the build files
+required to compile the project, producing the project configure script.
+After running @c configure, the @ref primermaintainermode settings will
+handle most situations that require running these tools again.  In some
+cases, a fresh bootstrap may be still required.
+
+ at subsection primerbootstrapcures Problems Solved By Bootstrap
+
+For example, the build system can fail in unexpected ways after running
+<code>svn update</code>.  Here, the <code>make maintainer-clean</code>
+should be used to remove all of the files generated by the @c bootstrap
+script and subsequent build processes.
+
+In this particular case, one may also need to remove stray files by hand
+after running this command to ensure everything is rebuilt properly.
+This step should be necessary only if the @c maintainer-clean was run
+ at b after altering the build system files with Subversion. If it is run
+ at b before any updates, the build system should never leave artifacts
+in the tree.
+
+Without such precautions, changes can be introduced that leave the tree
+timestamps in an inconsistent state, producing strange compile errors
+that are resolve after such diligence.
+
+ at subsection primermaintainerclean Autotools Cleaning
+
+Normally, all files generated by the bootstrap script, configure
+process, and build system should be removed after running <code>make
+maintainer-clean</code>.  Automatically generated files that remain
+after this should be listed in @c MAINTAINERCLEANFILES,
+ at c DISTCLEANFILES, or @c CLEANFILES, depending on which stage of the
+build process they are produced.
+
+ at section primerautoconf Autoconf Configuration Script
+
+The @c autoconf program generates the @c configure script from
+ at c configure.in, using serious Perl voodoo.  The resulting script is
+included in the project distribution packages and run by users to
+configure the build process for their system.
+
+ at subsection primermaintainermode Maintainer Mode
+
+After a fresh checkout, @c bootstrap, and a simple @c configure, you may
+experience errors when running @c make that some files cannot be found
+(e.g. @c version.texi), and a second @c make will "mysteriously" solve
+the problems.  The isssue is well-known and expected, if unfortunate.
+
+The OpenOCD project requires that all developers building from  the
+Subversion repository use the @c --enable-maintainer-mode option when
+running the @c configure script.  This option ensures that certain files
+are created during the build process that would normally be packaged in
+the distribution tarball.  The @c bootstrap script will remind you of
+this requirement when it runs.
+
+In addition to solving these problems, this option enables Makefile
+rules (provided by automake) that allow the normal @c make process to
+rebuild the autotools outputs, included the automake-generated Makefiles
+themselves.  This avoids the heavy-handed approach of running the
+ at c bootstrap script after changing one of these files.
+
+ at section primerautomake Automake Makefiles
+
+The @c automake program generates @c Makefile.in files (from @c
+Makefile.am files).  These files are later processed by the configure
+script produced by @c autoconf.
+
+ at subsection primerautomakenewfiles Creating Makefile.am Files
+
+This section shows how to add a @c Makefile.am in a new directory (or
+one that lacks one).
+-# The new directory must be listed in the @c SUBDIRS variable in the
+parent directory's Makefile.am:
+ at code
+$ echo 'SUBDIRS += directory' >>../Makefile.am
+ at endcode
+-# Create an bare-bones Makefile.am file in directory that needs it:
+ at code
+$ echo "MAINTAINERCLEANFILES = Makefile.in" >Makefile.am
+ at endcode
+-# The @c configure.in script must be updated, so it generates the required
+Makefile when the @a configure script is run by the user:
+ at verbatim
+AC_OUTPUT([
+		...
+		path/to/new/Makefile
+	])
+ at endverbatim
+
+Note: these instructions are @b not meant to be used literally, rather
+they are shown for demonstration purposes.
+
+The default MAINTAINERCLEANFILES rule ensures that the
+automake-generated @c Makefile.in file will be removed when developers
+run <code>make maintainer-clean</code>.  Additional rules may be added
+after this; however, the project should bootstrap and tear down cleanly
+after taking these minimal steps, with the new directory being visited
+during the @c make sequence.
+
+ at subsection primerautomaketweaks Updating Makefile.am Files
+
+Adding, removing, and renaming files from the project tree usually
+requires updating the autotools inputs. This section will help describe
+how to do this as questions arise.
+
+ at section primerlibtool Libtool and Libraries
+
+The @c libtool program provides the means of generating libraries in a
+portable and painless manner (relatively speaking).
+
+This section will contain an answer to "what does libtool give OpenOCD?"
+and "what do developers need to consider in new code?"
+
+ at section primerautotoolsmation Autotools Automation
+
+This section outlines three ways the autotools provides automation to
+assist with testing and distribution:
+- @ref primerautocheck -- automatic unit and smoke tests
+- @ref primerautodistcheck -- automatic distribution and packaging tests
+
+ at subsection primerautocheck make check
+
+The <code>make check</code> command will run the OpenOCD test suite,
+once it has been integrated as such.  This section will contain
+information about how to extend the testing build system components to
+implement new checks.
+
+ at subsection primerautodistcheck make distcheck
+
+The <code>make distcheck</code> command produces an archive of the
+project deliverables (using <code>make dist</code>) and verifies its
+integrity for distribution by attemptng to use the package in the same
+manner as a user.  
+
+These checks includes the following steps:
+-# Unpack the project archive into its expected directory.
+-# Configure and build the project in a temporary out-of-tree directory.
+-# Run <code>make check</code> to ensure the distributed code passes all tests.
+-# Run <code>make install</code> into a temporary installation directory.
+-# Check that <code>make uninstall</code> removes all files that were installed.
+-# Check that <code>make distclean</code> removes all files created
+during all other steps (except the first).
+
+If all of these steps complete successfully, the @c make process will
+output a friendly message indicating the archive is ready to be
+distributed.
+
+ */
+/** @file
+
+This file contains the @ref primerautotools page.
+
+ */


Property changes on: trunk/doc/manual/primer/autotools.txt
___________________________________________________________________
Name: svn:eol-style
   + native



From zwelch at mail.berlios.de  Wed May 27 12:35:32 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 12:35:32 +0200
Subject: [Openocd-svn] r1922 - trunk/doc/manual/primer
Message-ID: <200905271035.n4RAZWB1016444@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 12:35:20 +0200 (Wed, 27 May 2009)
New Revision: 1922

Added:
   trunk/doc/manual/primer/docs.txt
Log:
Add Documentation Primer to The Manual.

Added: trunk/doc/manual/primer/docs.txt
===================================================================
--- trunk/doc/manual/primer/docs.txt	2009-05-27 10:27:32 UTC (rev 1921)
+++ trunk/doc/manual/primer/docs.txt	2009-05-27 10:35:20 UTC (rev 1922)
@@ -0,0 +1,122 @@
+/** @page primerdocs OpenOCD Documentation Primers
+
+This page provides an introduction to OpenOCD's documentation processes.
+
+OpenOCD presently produces several kinds of documentation:
+- The Guide:
+  - Focuses on using the OpenOCD software.
+  - Details the installation, usage, and customization.
+  - Provides descriptions of public Jim/TCL script commands.
+  - Written using GNU texinfo.
+  - Created with 'make pdf' or 'make html'.
+  - See @subpage primertexinfo and @ref styletexinfo.
+- The References: (as proposed)
+  - Focuses on using specific hardware with OpenOCD.
+  - Details the supported interfaces, chips, boards, and targets.
+  - Provides overview, usage, reference, and FAQ for each device.
+  - Written using LaTeX language with custom macros.
+  - Created with 'make references'.
+  - See @subpage primerlatex and @ref stylelatex.
+- The Manual:
+  - Focuses on developing the OpenOCD software.
+  - Details the architecutre, driver interfaces, and processes.
+  - Provides "full" coverage of C source code (work-in-progress).
+  - Written using Doxygen C language conventions (i.e. in comments).
+  - Created with 'make doxygen'.
+  - See @subpage primerdoxygen and @ref styledoxygen.
+
+The following sections provide more information for anyone that wants to
+contribute new or updated documentation to the OpenOCD project.
+
+ */
+/** @page primertexinfo Texinfo Primer
+
+The OpenOCD User Guide presently exists entirely within the
+doc/openocd.texi document.  That file contains documentation with
+mark-up suitable for being parsed by the GNU Texinfo utilities
+(http://www.gnu.org/software/texinfo/).
+
+This section needs to be expanded to provide an overview to new
+developers.
+
+OpenOCD style guidelines for Texinfo documentation can be found on the
+ at ref styletexinfo page.
+
+ */
+/** @page primerlatex LaTeX Primer
+
+The OpenOCD project provides a number of reference guides using the
+LaTeX typesetting language.
+
+- OpenOCD Quick Reference Sheets
+- OpenOCD Hardware Reference Guides
+
+These documents have not yet been produced, so this Primer serves as
+a placeholder to describe how they are created and can be extended.
+The same holds true for the @ref stylelatex page.
+
+ */
+/** @page primerdoxygen Doxygen Primer
+
+Doxygen-style comments are used to provide documentation in-line with
+the OpenOCD source code.  These comments are used to document functions,
+variables, structs, enums, fields, and everything else that might need
+to be documented for developers.  Additional files containing comments
+that supplement the code comments in order to provide complete developer
+documentation.
+
+Even if you already know Doxygen, please read this Primer to learn
+how OpenOCD developers already use Doxygen features in the project tree.
+For more information about OpenOCD's required style for using Doxygen,
+see the @ref styledoxygen page and look at existing documentation in the
+ at c doc/manual tree.
+
+ at section primerdoxytext Doxygen Input Files
+
+Doxygen has been configured parse all of the C source code files (*.c
+and *.h) in @c src/ in order to produce a complete reference of all
+OpenOCD project symbols.  In addition to the source code files, other
+files will also be scanned for comment blocks; some are referenced
+explicitly by the @c INPUT variable in the Doxygen configuration file.
+
+By default, the Doxygen configuration enables a "full" set of features,
+including generation of dependency graphs (using the GraphViz package).
+These features may be disabled by editing the @c Doxyfile.in file at the
+top of the project tree; the configuration file includes comments that
+provide detailed documentation for each option.
+
+To support out-of-tree building of the documentation, the @c Doxyfile.in
+ at c INPUT values will have all instances of the string @c "@srcdir@"
+replaced with the current value of the make variable
+<code>$(srcdir)</code>.  The Makefile uses a rule to convert 
+ at c Doxyfile.in into the @c Doxyfile used by <code>make doxygen</code>.
+
+ at section primerdoxyoocd OpenOCD Input Files
+
+OpenOCD uses the @c INPUT mechanism to include additional documentation to
+provide The Manual for OpenOCD Developers.  These extra files contain
+high-level information intended to supplement the relatively low-level
+documentation that gets extracted from the source code comments.
+
+OpenOCD's Doxygen configuration file will search for all @c .txt files
+that can be found under the @c doc/manual directory in the project tree.
+New files containing valid Doxygen markup that are placed in or under
+that directory will be detected and included in The Manual automatically.
+
+ at section primerdoxyman Doxygen Reference Manual 
+
+The full documentation for Doxygen can be referenced on-line at the project
+home page: http://www.doxygen.org/index.html.  In HTML versions of this
+document, an image with a link to this site appears in the page footer.
+
+*/
+/** @file
+
+This file contains the Doxygen source code for the @ref primerdocs.
+The @ref primerdocs page also contains the following sections:
+
+- @ref primertexinfo
+- @ref primerlatex
+- @ref primerdoxygen
+
+ */


Property changes on: trunk/doc/manual/primer/docs.txt
___________________________________________________________________
Name: svn:eol-style
   + native



From zwelch at mail.berlios.de  Wed May 27 12:40:58 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 12:40:58 +0200
Subject: [Openocd-svn] r1923 - trunk/doc/manual
Message-ID: <200905271040.n4RAewG8021798@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 12:40:52 +0200 (Wed, 27 May 2009)
New Revision: 1923

Modified:
   trunk/doc/manual/main.txt
Log:
Link new Primer pages into the main list of Primers.

Modified: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-05-27 10:35:20 UTC (rev 1922)
+++ trunk/doc/manual/main.txt	2009-05-27 10:40:52 UTC (rev 1923)
@@ -35,6 +35,8 @@
 They seek to provide information to pull novices up the learning curves
 associated with the fundamental technologies used by OpenOCD.
 
+- @subpage primerdocs
+- @subpage primerautotools
 - @subpage primertcl
 - @subpage primerjtag
 



From zwelch at mail.berlios.de  Wed May 27 12:44:08 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 12:44:08 +0200
Subject: [Openocd-svn] r1924 - trunk/doc/manual
Message-ID: <200905271044.n4RAi8dx024184@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 12:44:03 +0200 (Wed, 27 May 2009)
New Revision: 1924

Modified:
   trunk/doc/manual/style.txt
Log:
Add new Style Guides for languages used (and to be used) by project.

Modified: trunk/doc/manual/style.txt
===================================================================
--- trunk/doc/manual/style.txt	2009-05-27 10:40:52 UTC (rev 1923)
+++ trunk/doc/manual/style.txt	2009-05-27 10:44:03 UTC (rev 1924)
@@ -1,20 +1,47 @@
-/** @page styleguide OpenOCD Coding C Style Guide
+/** @page styleguide Style Guides
 
-The following rules describe a formatting, naming, and other conventions
-that should be followed when writing or changing the OpenOCD C code.
-Many of the general rules should apply to OpenOCD's Jim/TCL code as well.
-
-The goals of this guide are:
-- to produce code that appears clean, consistent, and readable,
-- to allow developers to create patches that conform to a standard,
+The goals for each of these guides are:
+- to produce correct code that appears clean, consistent, and readable,
+- to allow developers to create patches that conform to a standard, and
 - to eliminate these issues as points of future contention.
-consistent.
 
 Some of these rules may be ignored in the spirit of these stated goals;
 however, such exceptions should be fairly rare.
 
- at section styleformat Formatting Rules
+The following style guides describe a formatting, naming, and other
+conventions that should be followed when writing or changing the OpenOCD
+code:
 
+- @subpage styletcl
+- @subpage stylec
+- @subpage styleperl
+- @subpage styleautotools
+
+In addition, the following style guides provide information for
+providing documentation, either as part of the C code or stand-alone.
+
+- @subpage styledoxygen
+- @subpage styletexinfo
+- @subpage stylelatex
+
+Feedback would be welcome to improve the OpenOCD guidelines.
+
+ */
+/** @page styletcl TCL Style Guide
+
+OpenOCD needs to expand its Jim/TCL Style Guide.
+
+Many of the guidelines listed on the @ref stylec page should apply to
+OpenOCD's Jim/TCL code as well.
+
+ */
+/** @page stylec C Style Guide
+
+This page contains guidelines for writing new C source code for the
+OpenOCD project.
+
+ at section styleformat Formatting Guide
+
 - remove any trailing white space at the end of lines.
 - use TAB characters for indentation; do NOT use spaces.
 - displayed TAB width is 4 characters.
@@ -23,7 +50,7 @@
 - remove any trailing empty lines at the end of source files
 - do not "comment out" code from the tree; instead, one should either:
   -# remove it entirely (Subversion can retrieve the old version), or
-  -# use an @c #if/#endif block.
+  -# use an @c \#if/\#endif block.
 
 Finally, try to avoid lines of code that are longer than than 72-80 columns:
 
@@ -74,20 +101,186 @@
 }
 @endcode
 
- at section styledoxygen Doxygen Rules
+ */
+/** @page styledoxygen Doxygen Style Guide
 
-- use @c /// to for one-line documentation
-- for multiple lines, use a "block" style with one space
+The following sections provide guidelines for OpenOCD developers
+who wish to write Doxygen comments in the code or this manual.
+For an introduction to Doxygen documentation,
+see the @ref primerdoxygen.
+
+ at section styledoxyblocks Doxygen Block Selection
+
+Several different types of Doxygen comments can be used; often,
+one style will be the most appropriate for a specific context.
+The following guidelines provide developers with heuristics for
+selecting an appropriate form and writing consistent documentation
+comments.
+
+-# use @c /// to for one-line documentation of instances.
+-# for documentation requiring multiple lines, use a "block" style:
 @verbatim
 /**
- * @brief Short description.
- * Full description here.
- * @param foo Describe foo.
+ * @brief First sentence is short description.  Remaining text becomes
+ * the full description block, where "empty" lines start new paragraphs.
+ *
+ * One can make text appear in @a italics, @b bold, @c monospace, or
+ * in blocks such as the one in which this example appears in the Style
+ * Guide.  See the Doxygen Manual for the full list of commands.
+ *
+ * @param foo For a function, describe the parameters (e.g. @a foo). 
+ * @returns The value(s) returned, or possible error conditions.
  */
 @endverbatim
-- if the total line length will be less than 72 columns, then
+  -# The block should start on the line following the opening @c /**.
+  -# The end of the block, \f$*/\f$, should also be on its own line.
+  -# Every line in the block should have a @c '*' in-line with its start:
+    - A leading space is required to align the @c '*' with the @c /** line.
+    - A single "empty" line should separate the function documentation
+      from the block of parameter and return value descriptions.
+    - Except to separate paragraphs of documentation, other extra
+      "empty" lines should be removed from the block.
+  -# Only single spaces should be used; do @b not add mid-line indentation.
+-# If the total line length will be less than 72-80 columns, then
   - The @c /**< form can be used on the same line.
   - This style should be used sparingly; the best use is for fields:
-    - @code int field /**< field description */ @endcode
+    @code int field; /**< field description */ @endcode
 
+ at section styledoxyall Doxygen Style Guide
+
+The following guidelines apply to all Doxygen comment blocks:
+
+-# Use the @c '\@cmd' form for all doxygen commands (do @b not use @c '\\cmd').
+-# Use symbol names such that Doxygen automatically creates links:
+  -# @c function_name() can be used to reference functions
+    (e.g. flash_set_dirty()).
+  -# @c struct_name::member_name should be used to reference structure
+    fields in the documentation (e.g. @c flash_driver_s::name).
+  -# URLS get converted to markup automatically, without any extra effort.
+  -# new pages can be linked into the heirarchy by using the @c \@subpage
+    command somewhere the page(s) under which they should be linked:
+  -# use @c \@ref in other contexts to create links to pages and sections.
+-# Use good Doxygen mark-up:
+  -# '\@a' (italics) should be used to reference parameters (e.g. <i>foo</i>).
+  -# '\@b' (bold) should be used to emphasizing <b>single</b> words.
+  -# '\@c' (monospace) should be used with <code>file names</code> and
+  <code>code symbols</code>, so they appear visually distinct from
+  surrounding text.
+  -# To mark-up multiple words, the HTML alternatives must be used.
+-# Two spaces should be used when nesting lists; do @b not use '\\t' in lists.
+-# Code examples provided in documentation must conform to the Style Guide.
+
+ at section styledoxytext Doxygen Text Inputs
+
+In addition to the guidelines in the preceding sections, the following
+additional style guidelines should be considered when writing
+documentation as part of standalone text files:
+
+-# Text files must contain Doxygen at least one comment block:
+  -# Documentation should begin in the first column (except for nested lists).
+  -# Do NOT use the @c '*' convention that must be used in the source code.
+-# Each file should contain at least one @c \@page block.
+  -# Each new page should be listed as a \@subpage in the \@page block
+  of the page that should serve as its parent.
+  -# Large pages should be structure in parts using meaningful \@section
+  and \@subsection commands.
+-# Include a @c \@file block at the end of each Doxygen @c .txt file to
+  document its contents:
+  - Doxygen creates such pages for files automatically, but no content
+    will appear on them for those that only contain manual pages.
+  - The \@file block should provide useful meta-documentation to assist
+    techincal writers; typically, a list of the pages that it contains.
+  - For example, the @ref styleguide exists in @c doc/manual/style.txt,
+    which contains a reference back to itself.
+-# The \@file and \@page commands should begin on the same line as
+   the start of the Doxygen comment:
+ at verbatim
+/** @page pagename Page Title
+
+Documentation for the page.
+
  */
+/** @file
+
+This file contains the @page page.
+
+ */
+ at endverbatim
+
+For an example, the Doxygen source for this Style Guide can be found in
+ at c doc/manual/style.txt, alongside other parts of The Manual.  
+
+ */
+/** @page styletexinfo Texinfo Style Guide
+
+This page needs to provide style guidelines for Texinfo, the mark-up
+language used by The Guide for OpenOCD Users.
+
+ */
+/** @page stylelatex LaTeX Style Guide
+
+This page needs to provide style guidelines for using LaTeX, the
+typesetting language used by The References for OpenOCD Hardware.
+Likewise, the @ref primerlatex for using this guide needs to be completed.
+
+ */
+/** @page styleperl Perl Style Guide
+
+This page provides some style guidelines for using Perl, a scripting
+language used by several small tools in the tree:
+
+-# Ensure all Perl scripts use the proper suffix (@c .pl for scripts, and 
+   @c .pm for modules)
+-# Pass files as script parameters or piped as input:
+  - Do NOT code paths to files in the tree, as this breaks out-of-tree builds.
+  - If you must, then you must also use an automake rule to create the script.
+-# use @c '#!/usr/bin/perl' as the first line of Perl scripts.
+-# always <code>use strict</code> and <code>use warnings</code>
+-# invoke scripts indirectly in Makefiles or other scripts:
+ at code
+perl script.pl
+ at endcode
+
+Maintainers must also be sure to follow additional guidelines:
+-# Ensure that Perl scripts are committed as executables:
+  - Use "<code>chmod +x script.pl</code>"
+    @a before using "<code>svn add script.pl</code>", or
+  - Use "<code>svn ps svn:executable '*' script.pl</code>"
+    @a after using "<code>svn add script.pl</code>".
+
+ */
+/** @page styleautotools Autotools Style Guide
+
+This page contains style guidelines for the OpenOCD autotools scripts.
+
+The following guidelines apply to the @c configure.in file:
+- Better guidelines need to be developed, but until then...
+- Use good judgement.
+
+The following guidelines apply to @c Makefile.am files:
+-# When assigning variables with long lists of items:
+  -# Separate the values on each line to make the files "patch friendly":
+ at code
+VAR = \
+	value1 \
+	value2 \
+	...
+	value9 \
+	value10
+ at endcode
+ */
+/** @file
+
+This file contains the @ref styleguide pages.  The @ref styleguide pages
+include the following Style Guides for their respective code and
+documentation languages:
+
+- @ref styletcl
+- @ref stylec
+- @ref styledoxygen
+- @ref styletexinfo
+- @ref stylelatex
+- @ref styleperl
+- @ref styleautotools
+
+ */



From ntfreak at mail.berlios.de  Wed May 27 13:58:20 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Wed, 27 May 2009 13:58:20 +0200
Subject: [Openocd-svn] r1925 - in trunk: doc src/jtag tcl/interface
Message-ID: <200905271158.n4RBwKPP000062@sheep.berlios.de>

Author: ntfreak
Date: 2009-05-27 13:58:19 +0200 (Wed, 27 May 2009)
New Revision: 1925

Added:
   trunk/tcl/interface/cortino.cfg
Modified:
   trunk/doc/openocd.texi
   trunk/src/jtag/ft2232.c
Log:
- add support for cortino jtag interface

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-27 10:44:03 UTC (rev 1924)
+++ trunk/doc/openocd.texi	2009-05-27 11:58:19 UTC (rev 1925)
@@ -496,6 +496,8 @@
 @* Link @url{http://www.hitex.com/stm32-stick}
 @item @b{axm0432_jtag}
 @* Axiom AXM-0432 Link @url{http://www.axman.com}
+ at item @b{cortino}
+@* Link @url{http://www.hitex.com/index.php?id=cortino}
 @end itemize
 
 @section USB JLINK based
@@ -1471,6 +1473,8 @@
 OOCDLink
 @item @b{axm0432_jtag}
 Axiom AXM-0432
+ at item @b{cortino}
+Hitex Cortino JTAG interface
 @end itemize
 
 @item @b{ft2232_vid_pid} <@var{vid}> <@var{pid}>

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-27 10:44:03 UTC (rev 1924)
+++ trunk/src/jtag/ft2232.c	2009-05-27 11:58:19 UTC (rev 1925)
@@ -124,6 +124,7 @@
 static int	axm0432_jtag_init(void);
 static int 	sheevaplug_init(void);
 static int 	icebear_jtag_init(void);
+static int 	cortino_jtag_init(void);
 
 /* reset procedures for supported layouts */
 static void usbjtag_reset(int trst, int srst);
@@ -156,8 +157,9 @@
 	{ "comstick",             comstick_init,             comstick_reset,     NULL                    },
 	{ "stm32stick",           stm32stick_init,           stm32stick_reset,   NULL                    },
 	{ "axm0432_jtag",         axm0432_jtag_init,         axm0432_jtag_reset, NULL                    },
-	{"sheevaplug",            sheevaplug_init,           sheevaplug_reset,   NULL                    },
+	{ "sheevaplug",           sheevaplug_init,           sheevaplug_reset,   NULL                    },
 	{ "icebear",              icebear_jtag_init,         icebear_jtag_reset, NULL                    },
+	{ "cortino",              cortino_jtag_init,         comstick_reset, NULL                        },
 	{ NULL,                   NULL,                      NULL,               NULL                    },
 };
 
@@ -2576,6 +2578,49 @@
 	return ERROR_OK;
 }
 
+static int 	cortino_jtag_init(void)
+{
+	u8  buf[3];
+	u32 bytes_written;
+
+	low_output    = 0x08;
+	low_direction = 0x1b;
+
+	/* initialize low byte for jtag */
+	buf[0] = 0x80;          /* command "set data bits low byte" */
+	buf[1] = low_output;    /* value (TMS=1,TCK=0, TDI=0, nOE=0) */
+	buf[2] = low_direction; /* dir (output=1), TCK/TDI/TMS=out, TDO=in, nOE=out */
+	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
+
+	if ( ( ( ft2232_write(buf, 3, &bytes_written) ) != ERROR_OK ) || (bytes_written != 3) )
+	{
+		LOG_ERROR("couldn't initialize FT2232 with 'cortino' layout");
+		return ERROR_JTAG_INIT_FAILED;
+	}
+
+	nTRST    = 0x01;
+	nTRSTnOE = 0x00;    /* no output enable for nTRST */
+	nSRST    = 0x02;
+	nSRSTnOE = 0x00;    /* no output enable for nSRST */
+
+	high_output    = 0x03;
+	high_direction = 0x03;
+
+	/* initialize high port */
+	buf[0] = 0x82; /* command "set data bits high byte" */
+	buf[1] = high_output;
+	buf[2] = high_direction;
+	LOG_DEBUG("%2.2x %2.2x %2.2x", buf[0], buf[1], buf[2]);
+
+	if ( ( ( ft2232_write(buf, 3, &bytes_written) ) != ERROR_OK ) || (bytes_written != 3) )
+	{
+		LOG_ERROR("couldn't initialize FT2232 with 'stm32stick' layout");
+		return ERROR_JTAG_INIT_FAILED;
+	}
+
+	return ERROR_OK;
+}
+
 static void olimex_jtag_blink(void)
 {
 	/* Olimex ARM-USB-OCD has a LED connected to ACBUS3

Added: trunk/tcl/interface/cortino.cfg
===================================================================
--- trunk/tcl/interface/cortino.cfg	2009-05-27 10:44:03 UTC (rev 1924)
+++ trunk/tcl/interface/cortino.cfg	2009-05-27 11:58:19 UTC (rev 1925)
@@ -0,0 +1,11 @@
+#
+# Hitex Cortino
+#
+# http://www.hitex.com/index.php?id=cortino
+#
+
+interface ft2232
+ft2232_device_desc "Cortino"
+ft2232_layout cortino
+ft2232_vid_pid 0x0640 0x0032
+


Property changes on: trunk/tcl/interface/cortino.cfg
___________________________________________________________________
Name: svn:eol-style
   + native



From zwelch at mail.berlios.de  Wed May 27 14:06:54 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 14:06:54 +0200
Subject: [Openocd-svn] r1926 - trunk/src/jtag
Message-ID: <200905271206.n4RC6snv000851@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 14:06:51 +0200 (Wed, 27 May 2009)
New Revision: 1926

Modified:
   trunk/src/jtag/vsllink.c
Log:
SimonQian <simonqian at SimonQian.com>:
This patch allows the vsllink to support very large scan sizes in DMA mode.


Modified: trunk/src/jtag/vsllink.c
===================================================================
--- trunk/src/jtag/vsllink.c	2009-05-27 11:58:19 UTC (rev 1925)
+++ trunk/src/jtag/vsllink.c	2009-05-27 12:06:51 UTC (rev 1926)
@@ -710,10 +710,10 @@
 		&VSLLINK_TAP_MOVE_INSERT_INSIGNIFICANT[tap_move_ndx(tap_get_state())][tap_move_ndx(tap_get_end_state())];
 	u8 tms_scan = VSLLINK_TAP_MOVE(tap_get_state(), tap_get_end_state());
 	
-	vsllink_tap_ensure_space(0, 8);
-	
 	if (tap_get_state() == TAP_RESET)
 	{
+		vsllink_tap_ensure_space(0, 8);
+		
 		for (i = 0; i < 8; i++)
 		{
 			vsllink_tap_append_step(1, 0);
@@ -1318,7 +1318,6 @@
 	vsllink_end_state(saved_end_state);
 	
 	/* Scan */
-	vsllink_tap_ensure_space(1, (scan_size + 7) & ~0x00000007);
 	vsllink_tap_append_scan_dma(scan_size, buffer, command);
 	
 	tap_set_state(ir_scan ? TAP_IRPAUSE : TAP_DRPAUSE);
@@ -1581,20 +1580,37 @@
 }
 static void vsllink_tap_append_scan_dma(int length, u8 *buffer, scan_command_t *command)
 {
-	pending_scan_result_t *pending_scan_result = &pending_scan_results_buffer[pending_scan_results_length];
-	int i;
+	pending_scan_result_t *pending_scan_result;
+	int len_tmp, len_all, i;
 	
-	pending_scan_result->offset = tap_length;
-	pending_scan_result->length = length;
-	pending_scan_result->command = command;
-	pending_scan_result->buffer = buffer;
-	
-	for (i = 0; i < length; i++)
+	len_all = 0;
+	while (len_all < length)
 	{
-		vsllink_tap_append_step((i < length-1 ? 0 : 1), (buffer[i/8] >> (i%8)) & 1);
+		if ((length - len_all) > tap_buffer_size * 8)
+		{
+			len_tmp = tap_buffer_size * 8;
+		}
+		else
+		{
+			len_tmp = length - len_all;
+		}
+		
+		vsllink_tap_ensure_space(1, (len_tmp + 7) & ~7);
+		
+		pending_scan_result = &pending_scan_results_buffer[pending_scan_results_length];
+		pending_scan_result->offset = tap_length;
+		pending_scan_result->length = len_tmp;
+		pending_scan_result->command = command;
+		pending_scan_result->buffer = buffer + len_all / 8;
+		
+		for (i = 0; i < len_tmp; i++)
+		{
+			vsllink_tap_append_step(((len_all+i) < length-1 ? 0 : 1), (buffer[(len_all+i)/8] >> ((len_all+i)%8)) & 1);
+		}
+		
+		pending_scan_results_length++;
+		len_all += len_tmp;
 	}
-	
-	pending_scan_results_length++;
 }
 
 /* Pad and send a tap sequence to the device, and receive the answer.



From zwelch at mail.berlios.de  Wed May 27 14:16:13 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 14:16:13 +0200
Subject: [Openocd-svn] r1927 - trunk/src/flash
Message-ID: <200905271216.n4RCGDTR001616@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 14:16:07 +0200 (Wed, 27 May 2009)
New Revision: 1927

Modified:
   trunk/src/flash/mflash.c
Log:
unsik Kim <donari75 at gmail.com>:
Change prefix of mflash driver routines to mg_.


Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-27 12:06:51 UTC (rev 1926)
+++ trunk/src/flash/mflash.c	2009-05-27 12:16:07 UTC (rev 1927)
@@ -191,12 +191,12 @@
 	return ret;
 }
 
-static int mflash_rst(u8 level)
+static int mg_hdrst(u8 level)
 {
 	return mflash_bank->gpio_drv->set_gpio_output_val(mflash_bank->rst_pin, level);
 }
 
-static int mflash_init_gpio (void)
+static int mg_init_gpio (void)
 {
 	mflash_gpio_drv_t *gpio_drv = mflash_bank->gpio_drv;
 
@@ -370,16 +370,16 @@
 {
 	mflash_bank->proved = 0;
 
-	mflash_init_gpio();
+	mg_init_gpio();
 
 	LOG_INFO("reset mflash");
 
-	mflash_rst(0);
+	mg_hdrst(0);
 
 	if (mg_dsk_wait(mg_io_wait_bsy, MG_OEM_DISK_WAIT_TIME_LONG) != ERROR_OK)
 		return ERROR_FAIL;
 
-	mflash_rst(1);
+	mg_hdrst(1);
 
 	if (mg_dsk_wait(mg_io_wait_not_bsy, MG_OEM_DISK_WAIT_TIME_LONG) != ERROR_OK)
 		return ERROR_FAIL;
@@ -402,7 +402,7 @@
 	return ERROR_OK;
 }
 
-static int mflash_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int mg_probe_cmd(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	int ret;
 
@@ -672,7 +672,7 @@
 	return ERROR_OK;
 }
 
-static int mflash_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int mg_write_cmd(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	u32 address, buf_cnt;
 	u8 *buffer;
@@ -724,7 +724,7 @@
 	return ERROR_OK;
 }
 
-static int mflash_dump_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int mg_dump_cmd(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	u32 address, size_written, size;
 	u8 *buffer;
@@ -774,17 +774,17 @@
 int mflash_init_drivers(struct command_context_s *cmd_ctx)
 {
 	if (mflash_bank) {
-		register_command(cmd_ctx, mflash_cmd, "probe", mflash_probe_command, COMMAND_EXEC, NULL);
-		register_command(cmd_ctx, mflash_cmd, "write", mflash_write_command, COMMAND_EXEC,
+		register_command(cmd_ctx, mflash_cmd, "probe", mg_probe_cmd, COMMAND_EXEC, NULL);
+		register_command(cmd_ctx, mflash_cmd, "write", mg_write_cmd, COMMAND_EXEC,
 				"mflash write <num> <file> <address>");
-		register_command(cmd_ctx, mflash_cmd, "dump", mflash_dump_command, COMMAND_EXEC,
+		register_command(cmd_ctx, mflash_cmd, "dump", mg_dump_cmd, COMMAND_EXEC,
 						"mflash dump <num> <file> <address> <size>");
 	}
 
 	return ERROR_OK;
 }
 
-static int mflash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int mg_bank_cmd(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	target_t *target;
 	char *str;
@@ -834,7 +834,7 @@
 int mflash_register_commands(struct command_context_s *cmd_ctx)
 {
 	mflash_cmd = register_command(cmd_ctx, NULL, "mflash", NULL, COMMAND_ANY, NULL);
-	register_command(cmd_ctx, mflash_cmd, "bank", mflash_bank_command, COMMAND_CONFIG,
+	register_command(cmd_ctx, mflash_cmd, "bank", mg_bank_cmd, COMMAND_CONFIG,
 			"mflash bank <soc> <base> <chip_width> <bus_width> <RST pin> <WP pin> <DPD pin> <target #>");
 	return ERROR_OK;
 }



From zwelch at mail.berlios.de  Wed May 27 14:20:18 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 14:20:18 +0200
Subject: [Openocd-svn] r1928 - in trunk: doc src/flash
Message-ID: <200905271220.n4RCKIe7001785@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 14:20:13 +0200 (Wed, 27 May 2009)
New Revision: 1928

Modified:
   trunk/doc/openocd.texi
   trunk/src/flash/mflash.c
   trunk/src/flash/mflash.h
Log:
unsik Kim <donari75 at gmail.com>:
Remove unused mflash bank command options.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-27 12:16:07 UTC (rev 1927)
+++ trunk/doc/openocd.texi	2009-05-27 12:20:13 UTC (rev 1928)
@@ -2509,22 +2509,19 @@
 
 @subsection mFlash Configuration
 @cindex mFlash Configuration
- at b{mflash bank} <@var{soc}> <@var{base}> <@var{chip_width}> <@var{bus_width}>
-<@var{RST pin}> <@var{WP pin}> <@var{DPD pin}> <@var{target}>
+ at b{mflash bank} <@var{soc}> <@var{base}> <@var{RST pin}> <@var{target}>
 @cindex mflash bank
 @*Configures a mflash for <@var{soc}> host bank at
-<@var{base}>. <@var{chip_width}> and <@var{bus_width}> are bytes
-order. Pin number format is dependent on host GPIO calling convention.
-If WP or DPD pin was not used, write -1. Currently, mflash bank
-support s3c2440 and pxa270.
+<@var{base}>. Pin number format is dependent on host GPIO calling convention.
+Currently, mflash bank support s3c2440 and pxa270.
 
-(ex. of s3c2440) mflash <@var{RST pin}> is GPIO B1, <@var{WP pin}> and <@var{DPD pin}> are not used.
+(ex. of s3c2440) mflash <@var{RST pin}> is GPIO B1.
 @example
-mflash bank s3c2440 0x10000000 2 2 1b -1 -1 0
+mflash bank s3c2440 0x10000000 1b 0
 @end example
-(ex. of pxa270) mflash <@var{RST pin}> is GPIO 43, <@var{DPD pin}> is not used and <@var{DPD pin}> is GPIO 51.
+(ex. of pxa270) mflash <@var{RST pin}> is GPIO 43.
 @example
-mflash bank pxa270 0x08000000 2 2 43 -1 51 0  
+mflash bank pxa270 0x08000000 43 0  
 @end example
 
 @section Microcontroller specific Flash Commands

Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-27 12:16:07 UTC (rev 1927)
+++ trunk/src/flash/mflash.c	2009-05-27 12:20:13 UTC (rev 1928)
@@ -203,16 +203,6 @@
 	gpio_drv->set_gpio_to_output(mflash_bank->rst_pin);
 	gpio_drv->set_gpio_output_val(mflash_bank->rst_pin, 1);
 
-	if (mflash_bank->wp_pin.num != -1) {
-		gpio_drv->set_gpio_to_output(mflash_bank->wp_pin);
-		gpio_drv->set_gpio_output_val(mflash_bank->wp_pin, 1);
-	}
-
-	if (mflash_bank->dpd_pin.num != -1) {
-		gpio_drv->set_gpio_to_output(mflash_bank->dpd_pin);
-		gpio_drv->set_gpio_output_val(mflash_bank->dpd_pin, 1);
-	}
-
 	return ERROR_OK;
 }
 
@@ -790,30 +780,22 @@
 	char *str;
 	int i;
 
-	if (argc < 8)
+	if (argc < 4)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	if ((target = get_target(args[7])) == NULL)
+	if ((target = get_target(args[3])) == NULL)
 	{
-		LOG_ERROR("target '%s' not defined", args[7]);
+		LOG_ERROR("target '%s' not defined", args[3]);
 		return ERROR_FAIL;
 	}
 
 	mflash_bank = calloc(sizeof(mflash_bank_t), 1);
 	mflash_bank->base = strtoul(args[1], NULL, 0);
-	mflash_bank->chip_width = strtoul(args[2], NULL, 0);
-	mflash_bank->bus_width = strtoul(args[3], NULL, 0);
-	mflash_bank->rst_pin.num = strtoul(args[4], &str, 0);
+	mflash_bank->rst_pin.num = strtoul(args[2], &str, 0);
 	if (*str)
 		mflash_bank->rst_pin.port[0] = (u16)tolower(str[0]);
-	mflash_bank->wp_pin.num = strtol(args[5], &str, 0);
-	if (*str)
-		mflash_bank->wp_pin.port[0] = (u16)tolower(str[0]);
-	mflash_bank->dpd_pin.num = strtol(args[6], &str, 0);
-	if (*str)
-		mflash_bank->dpd_pin.port[0] = (u16)tolower(str[0]);
 
 	mflash_bank->target = target;
 
@@ -835,6 +817,6 @@
 {
 	mflash_cmd = register_command(cmd_ctx, NULL, "mflash", NULL, COMMAND_ANY, NULL);
 	register_command(cmd_ctx, mflash_cmd, "bank", mg_bank_cmd, COMMAND_CONFIG,
-			"mflash bank <soc> <base> <chip_width> <bus_width> <RST pin> <WP pin> <DPD pin> <target #>");
+			"mflash bank <soc> <base> <RST pin> <target #>");
 	return ERROR_OK;
 }

Modified: trunk/src/flash/mflash.h
===================================================================
--- trunk/src/flash/mflash.h	2009-05-27 12:16:07 UTC (rev 1927)
+++ trunk/src/flash/mflash.h	2009-05-27 12:20:13 UTC (rev 1928)
@@ -125,12 +125,8 @@
 typedef struct mflash_bank_s
 {
 	u32 base;
-	u32 chip_width;
-	u32 bus_width;
 
 	mflash_gpio_num_t rst_pin;
-	mflash_gpio_num_t wp_pin;
-	mflash_gpio_num_t dpd_pin;
 
 	mflash_gpio_drv_t *gpio_drv;
 	target_t *target;



From zwelch at mail.berlios.de  Wed May 27 14:21:31 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 14:21:31 +0200
Subject: [Openocd-svn] r1929 - trunk/src/flash
Message-ID: <200905271221.n4RCLVIZ001839@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 14:21:28 +0200 (Wed, 27 May 2009)
New Revision: 1929

Modified:
   trunk/src/flash/mflash.c
   trunk/src/flash/mflash.h
Log:
unsik Kim <donari75 at gmail.com>:
Remove unused mflash driver 'prove' field.


Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-27 12:20:13 UTC (rev 1928)
+++ trunk/src/flash/mflash.c	2009-05-27 12:21:28 UTC (rev 1929)
@@ -358,8 +358,6 @@
 
 static int mg_mflash_probe(void)
 {
-	mflash_bank->proved = 0;
-
 	mg_init_gpio();
 
 	LOG_INFO("reset mflash");
@@ -387,8 +385,6 @@
 	if (mg_dsk_drv_info() != ERROR_OK)
 		return ERROR_FAIL;
 
-	mflash_bank->proved = 1;
-
 	return ERROR_OK;
 }
 
@@ -678,10 +674,6 @@
 
 	address = strtoul(args[2], NULL, 0);
 
-	if (! mflash_bank->proved ) {
-		mg_mflash_probe();
-	}
-
 	if (fileio_open(&fileio, args[1], FILEIO_READ, FILEIO_BINARY) != ERROR_OK) {
 		return ERROR_FAIL;
 	}
@@ -730,10 +722,6 @@
 	address = strtoul(args[2], NULL, 0);
 	size = strtoul(args[3], NULL, 0);
 
-	if (! mflash_bank->proved ) {
-			mg_mflash_probe();
-	}
-
 	if (fileio_open(&fileio, args[1], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK) {
 		return ERROR_FAIL;
 	}

Modified: trunk/src/flash/mflash.h
===================================================================
--- trunk/src/flash/mflash.h	2009-05-27 12:20:13 UTC (rev 1928)
+++ trunk/src/flash/mflash.h	2009-05-27 12:21:28 UTC (rev 1929)
@@ -131,8 +131,6 @@
 	mflash_gpio_drv_t *gpio_drv;
 	target_t *target;
 	mg_drv_info_t *drv_info;
-
-	u8 proved;
 } mflash_bank_t;
 
 extern int mflash_register_commands(struct command_context_s *cmd_ctx);



From zwelch at mail.berlios.de  Wed May 27 14:30:47 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 14:30:47 +0200
Subject: [Openocd-svn] r1930 - in trunk: doc src/flash
Message-ID: <200905271230.n4RCUl1e003688@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 14:30:42 +0200 (Wed, 27 May 2009)
New Revision: 1930

Modified:
   trunk/doc/openocd.texi
   trunk/src/flash/mflash.c
   trunk/src/flash/mflash.h
Log:
unsik Kim <donari75 at gmail.com>:
Add mflash configuration code, updating relevant documentation.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-27 12:21:28 UTC (rev 1929)
+++ trunk/doc/openocd.texi	2009-05-27 12:30:42 UTC (rev 1930)
@@ -2393,15 +2393,29 @@
 @itemize @bullet
 @item @b{mflash probe} 
 @cindex mflash probe
-Probe mflash.
+@*Probe mflash.
 @item @b{mflash write} <@var{num}> <@var{file}> <@var{offset}>
 @cindex mflash write
-Write the binary <@var{file}> to mflash bank <@var{num}>, starting at
+@*Write the binary <@var{file}> to mflash bank <@var{num}>, starting at
 <@var{offset}> bytes from the beginning of the bank.
 @item @b{mflash dump} <@var{num}> <@var{file}> <@var{offset}> <@var{size}>
 @cindex mflash dump
-Dump <size> bytes, starting at <@var{offset}> bytes from the beginning of the <@var{num}> bank 
+@*Dump <size> bytes, starting at <@var{offset}> bytes from the beginning of the <@var{num}> bank 
 to a <@var{file}>.
+ at item @b{mflash config pll} <@var{frequency}>
+ at cindex mflash config pll
+@*Configure mflash pll. <@var{frequency}> is input frequency of mflash. The order is Hz.
+Issuing this command will erase mflash's whole internal nand and write new pll. 
+After this command, mflash needs power-on-reset for normal operation.
+If pll was newly configured, storage and boot(optional) info also need to be update.
+ at item @b{mflash config boot}
+ at cindex mflash config boot
+@*Configure bootable option. If bootable option is set, mflash offer the first 8 sectors
+(4kB) for boot.
+ at item @b{mflash config storage}
+ at cindex mflash config storage
+@*Configure storage information. For the normal storage operation, this information must be
+written. 
 @end itemize
 
 @section flash bank command

Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-27 12:21:28 UTC (rev 1929)
+++ trunk/src/flash/mflash.c	2009-05-27 12:30:42 UTC (rev 1930)
@@ -356,12 +356,10 @@
 	return ERROR_OK;
 }
 
-static int mg_mflash_probe(void)
+static int mg_mflash_rst(void)
 {
 	mg_init_gpio();
 
-	LOG_INFO("reset mflash");
-
 	mg_hdrst(0);
 
 	if (mg_dsk_wait(mg_io_wait_bsy, MG_OEM_DISK_WAIT_TIME_LONG) != ERROR_OK)
@@ -382,6 +380,16 @@
 	if (mg_dsk_wait(mg_io_wait_not_bsy, MG_OEM_DISK_WAIT_TIME_LONG) != ERROR_OK)
 		return ERROR_FAIL;
 
+	LOG_INFO("mflash: reset ok");
+
+	return ERROR_OK;
+}
+
+static int mg_mflash_probe(void)
+{
+	if (mg_mflash_rst() != ERROR_OK)
+		return ERROR_FAIL;
+
 	if (mg_dsk_drv_info() != ERROR_OK)
 		return ERROR_FAIL;
 
@@ -465,7 +473,8 @@
 	return ERROR_OK;
 }
 
-static int mg_mflash_do_write_sects(void *buff, u32 sect_num, u32 sect_cnt)
+static int mg_mflash_do_write_sects(void *buff, u32 sect_num, u32 sect_cnt,
+		mg_io_type_cmd cmd)
 {
 	u32 i, address;
 	int ret;
@@ -473,10 +482,8 @@
 	u8 *buff_ptr = buff;
 	duration_t duration;
 
-	if ( mg_dsk_io_cmd(sect_num, sect_cnt, mg_io_cmd_write) != ERROR_OK ) {
-		LOG_ERROR("mg_io_cmd_write fail");
+	if ( mg_dsk_io_cmd(sect_num, sect_cnt, cmd) != ERROR_OK )
 		return ERROR_FAIL;
-	}
 
 	address = mflash_bank->base + MG_BUFFER_OFFSET;
 
@@ -506,7 +513,10 @@
 		}
 	}
 
-	ret = mg_dsk_wait(mg_io_wait_rdy, MG_OEM_DISK_WAIT_TIME_NORMAL);
+	if (cmd == mg_io_cmd_write)
+		ret = mg_dsk_wait(mg_io_wait_rdy, MG_OEM_DISK_WAIT_TIME_NORMAL);
+	else
+		ret = mg_dsk_wait(mg_io_wait_rdy, MG_OEM_DISK_WAIT_TIME_LONG);
 
 	return ret;
 }
@@ -522,7 +532,7 @@
 	for (i = 0; i < quotient; i++) {
 		LOG_DEBUG("sect num : %u buff : %0lx", sect_num, 
 			(unsigned long)buff_ptr);
-		mg_mflash_do_write_sects(buff_ptr, sect_num, 256);
+		mg_mflash_do_write_sects(buff_ptr, sect_num, 256, mg_io_cmd_write);
 		sect_num += 256;
 		buff_ptr += 256 * MG_MFLASH_SECTOR_SIZE;
 	}
@@ -530,7 +540,7 @@
 	if (residue) {
 		LOG_DEBUG("sect num : %u buff : %0lx", sect_num, 
 			(unsigned long)buff_ptr);
-		mg_mflash_do_write_sects(buff_ptr, sect_num, residue);
+		mg_mflash_do_write_sects(buff_ptr, sect_num, residue, mg_io_cmd_write);
 	}
 
 	return ERROR_OK;
@@ -749,6 +759,433 @@
 	return ERROR_OK;
 }
 
+
+static int mg_set_feature(mg_feature_id feature, mg_feature_val config)
+{
+	target_t *target = mflash_bank->target;
+	u32 mg_task_reg = mflash_bank->base + MG_REG_OFFSET;
+
+	if (mg_dsk_wait(mg_io_wait_rdy_noerr, MG_OEM_DISK_WAIT_TIME_NORMAL)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	target_write_u8(target, mg_task_reg + MG_REG_FEATURE, feature);
+	target_write_u8(target, mg_task_reg + MG_REG_SECT_CNT, config);
+	target_write_u8(target, mg_task_reg + MG_REG_COMMAND,
+			mg_io_cmd_set_feature);
+
+	return ERROR_OK;
+}
+
+static int mg_is_valid_pll(double XIN, int N, double CLK_OUT, int NO)
+{
+	double v1 = XIN / N;
+	double v2 = CLK_OUT * NO;
+
+	if (v1 <1000000 || v1 > 15000000 || v2 < 100000000 || v2 > 500000000)
+		return ERROR_FAIL;
+
+	return ERROR_OK;
+}
+
+static int mg_pll_get_M(unsigned short feedback_div)
+{
+	int i, M;
+
+	for (i = 1, M=0; i < 512; i <<= 1, feedback_div >>= 1)
+		M += (feedback_div & 1) * i;
+
+	return M + 2;
+}
+
+static int mg_pll_get_N(unsigned char input_div)
+{
+	int i, N;
+
+	for (i = 1, N = 0; i < 32; i <<= 1, input_div >>= 1)
+		N += (input_div & 1) * i;
+
+	return N + 2;
+}
+
+static int mg_pll_get_NO(unsigned char  output_div)
+{
+	int i, NO;
+
+	for (i = 0, NO = 1; i < 2; ++i, output_div >>= 1)
+		if(output_div & 1)
+			NO = NO << 1;
+
+	return NO;
+}
+
+static double mg_do_calc_pll(double XIN, mg_pll_t * p_pll_val, int is_approximate)
+{
+	unsigned short i;
+	unsigned char  j, k;
+	int            M, N, NO;
+	double CLK_OUT;
+	double DIV = 1;
+	double ROUND = 0;
+
+	if (is_approximate) {
+		DIV   = 1000000;
+		ROUND = 500000;
+	}
+
+	for (i = 0; i < MG_PLL_MAX_FEEDBACKDIV_VAL ; ++i) {
+		M  = mg_pll_get_M(i);
+
+		for (j = 0; j < MG_PLL_MAX_INPUTDIV_VAL ; ++j) {
+			N  = mg_pll_get_N(j);
+
+			for (k = 0; k < MG_PLL_MAX_OUTPUTDIV_VAL ; ++k) {
+				NO = mg_pll_get_NO(k);
+
+				CLK_OUT = XIN * ((double)M / N) / NO;
+
+				if ((int)((CLK_OUT+ROUND) / DIV)
+						== (int)(MG_PLL_CLK_OUT / DIV))	{
+					if (mg_is_valid_pll(XIN, N, CLK_OUT, NO) == ERROR_OK)
+					{
+						p_pll_val->lock_cyc = (int)(XIN * MG_PLL_STD_LOCKCYCLE / MG_PLL_STD_INPUTCLK);
+						p_pll_val->feedback_div = i;
+						p_pll_val->input_div = j;
+						p_pll_val->output_div = k;
+
+						return CLK_OUT;
+					}
+				}
+			}
+		}
+	}
+
+	return 0;
+}
+
+static double mg_calc_pll(double XIN, mg_pll_t *p_pll_val)
+{
+	double CLK_OUT;
+
+	CLK_OUT = mg_do_calc_pll(XIN, p_pll_val, 0);
+
+	if (!CLK_OUT)
+		return mg_do_calc_pll(XIN, p_pll_val, 1);
+	else
+		return CLK_OUT;
+}
+
+static int mg_verify_interface(void)
+{
+	u16 buff[MG_MFLASH_SECTOR_SIZE >> 1];
+	u16 i, j;
+	u32 address = mflash_bank->base + MG_BUFFER_OFFSET;
+	target_t *target = mflash_bank->target;
+
+	for (j = 0; j < 10; j++) {
+		for (i = 0; i < MG_MFLASH_SECTOR_SIZE >> 1; i++)
+			buff[i] = i;
+
+		target->type->write_memory(target, address, 2,
+				MG_MFLASH_SECTOR_SIZE / 2, (u8 *)buff);
+
+		memset(buff, 0xff, MG_MFLASH_SECTOR_SIZE);
+
+		target->type->read_memory(target, address, 2,
+				MG_MFLASH_SECTOR_SIZE / 2, (u8 *)buff);
+
+		for (i = 0; i < MG_MFLASH_SECTOR_SIZE >> 1; i++) {
+			if (buff[i] != i) {
+				LOG_ERROR("mflash: verify interface fail");
+				return ERROR_FAIL;
+			}
+		}
+	}
+
+	LOG_INFO("mflash: verify interface ok");
+	return ERROR_OK;
+}
+
+static const char g_strSEG_SerialNum[20] = {
+	'G','m','n','i','-','e','e','S','g','a','e','l',
+	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
+};
+
+static const char g_strSEG_FWRev[8] = {
+	'F','X','L','T','2','v','0','.'
+};
+
+static const char g_strSEG_ModelNum[40] = {
+	'F','X','A','L','H','S','2',0x20,'0','0','s','7',
+	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
+	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
+	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
+};
+
+static void mg_gen_ataid(mg_io_type_drv_info *pSegIdDrvInfo)
+{
+	/* b15 is ATA device(0)	, b7 is Removable Media Device */
+	pSegIdDrvInfo->general_configuration		= 0x045A;
+	/* 128MB :   Cylinder=> 977 , Heads=> 8 ,  Sectors=> 32
+	 * 256MB :   Cylinder=> 980 , Heads=> 16 , Sectors=> 32
+	 * 384MB :   Cylinder=> 745 , Heads=> 16 , Sectors=> 63
+	 */
+	pSegIdDrvInfo->number_of_cylinders		= 0x02E9;
+	pSegIdDrvInfo->reserved1			= 0x0;
+	pSegIdDrvInfo->number_of_heads			= 0x10;
+	pSegIdDrvInfo->unformatted_bytes_per_track	= 0x0;
+	pSegIdDrvInfo->unformatted_bytes_per_sector	= 0x0;
+	pSegIdDrvInfo->sectors_per_track		= 0x3F;
+	pSegIdDrvInfo->vendor_unique1[0]		= 0x000B;
+	pSegIdDrvInfo->vendor_unique1[1]		= 0x7570;
+	pSegIdDrvInfo->vendor_unique1[2]		= 0x8888;
+
+	memcpy(pSegIdDrvInfo->serial_number, (void *)g_strSEG_SerialNum,20);
+	/* 0x2 : dual buffer */
+	pSegIdDrvInfo->buffer_type			= 0x2;
+	/* buffer size : 2KB */
+	pSegIdDrvInfo->buffer_sector_size		= 0x800;
+	pSegIdDrvInfo->number_of_ecc_bytes		= 0;
+
+	memcpy(pSegIdDrvInfo->firmware_revision, (void *)g_strSEG_FWRev,8);
+
+	memcpy(pSegIdDrvInfo->model_number, (void *)g_strSEG_ModelNum,40);
+
+	pSegIdDrvInfo->maximum_block_transfer		= 0x4;
+	pSegIdDrvInfo->vendor_unique2   		= 0x0;
+	pSegIdDrvInfo->dword_io				= 0x00;
+	/* b11 : IORDY support(PIO Mode 4), b10 : Disable/Enbale IORDY
+	 * b9  : LBA support, b8 : DMA mode support
+	 */
+	pSegIdDrvInfo->capabilities			= 0x1 << 9;
+
+	pSegIdDrvInfo->reserved2			= 0x4000;
+	pSegIdDrvInfo->vendor_unique3			= 0x00;
+	/* PIOMode-2 support */
+	pSegIdDrvInfo->pio_cycle_timing_mode		= 0x02;
+	pSegIdDrvInfo->vendor_unique4			= 0x00;
+	/* MultiWord-2 support */
+	pSegIdDrvInfo->dma_cycle_timing_mode		= 0x00;
+	/* b1 : word64~70 is valid
+	 * b0 : word54~58 are valid and reflect the current numofcyls,heads,sectors
+	 * b2 : If device supports Ultra DMA , set to one to vaildate word88
+	 */
+	pSegIdDrvInfo->translation_fields_valid		= (0x1 << 1) | (0x1 << 0);
+	pSegIdDrvInfo->number_of_current_cylinders	= 0x02E9;
+	pSegIdDrvInfo->number_of_current_heads		= 0x10;
+	pSegIdDrvInfo->current_sectors_per_track	= 0x3F;
+	pSegIdDrvInfo->current_sector_capacity_lo	= 0x7570;
+	pSegIdDrvInfo->current_sector_capacity_hi	= 0x000B;
+
+	pSegIdDrvInfo->multi_sector_count			= 0x04;
+	/* b8 : Multiple secotr setting valid , b[7:0] num of secotrs per block */
+	pSegIdDrvInfo->multi_sector_setting_valid		= 0x01;
+	pSegIdDrvInfo->total_user_addressable_sectors_lo	= 0x7570;
+	pSegIdDrvInfo->total_user_addressable_sectors_hi	= 0x000B;
+	pSegIdDrvInfo->single_dma_modes_supported		= 0x00;
+	pSegIdDrvInfo->single_dma_transfer_active		= 0x00;
+	/* b2 :Multi-word DMA mode 2, b1 : Multi-word DMA mode 1 */
+	pSegIdDrvInfo->multi_dma_modes_supported		= (0x1 << 0);
+	/* b2 :Multi-word DMA mode 2, b1 : Multi-word DMA mode 1 */
+	pSegIdDrvInfo->multi_dma_transfer_active		= (0x1 << 0);
+	/* b0 : PIO Mode-3 support, b1 : PIO Mode-4 support */
+	pSegIdDrvInfo->adv_pio_mode				= 0x00;
+	/* 480(0x1E0)nsec for Multi-word DMA mode0
+	 * 150(0x96) nsec for Multi-word DMA mode1
+	 * 120(0x78) nsec for Multi-word DMA mode2
+	 */
+	pSegIdDrvInfo->min_dma_cyc			= 0x1E0;
+	pSegIdDrvInfo->recommend_dma_cyc		= 0x1E0;
+	pSegIdDrvInfo->min_pio_cyc_no_iordy		= 0x1E0;
+	pSegIdDrvInfo->min_pio_cyc_with_iordy		= 0x1E0;
+	memset((void *)pSegIdDrvInfo->reserved3, 0x00, 22);
+	/* b7 : ATA/ATAPI-7 ,b6 : ATA/ATAPI-6 ,b5 : ATA/ATAPI-5,b4 : ATA/ATAPI-4 */
+	pSegIdDrvInfo->major_ver_num			= 0x7E;
+	/* 0x1C : ATA/ATAPI-6 T13 1532D revision1 */
+	pSegIdDrvInfo->minor_ver_num			= 0x19;
+	/* NOP/READ BUFFER/WRITE BUFFER/Power management feature set support */
+	pSegIdDrvInfo->feature_cmd_set_suprt0		= 0x7068;
+	/* Features/command set is valid/Advanced Pwr management/CFA feature set
+	 * not support
+	 */
+	pSegIdDrvInfo->feature_cmd_set_suprt1		= 0x400C;
+	pSegIdDrvInfo->feature_cmd_set_suprt2		= 0x4000;
+	/* READ/WRITE BUFFER/PWR Management enable */
+	pSegIdDrvInfo->feature_cmd_set_en0		= 0x7000;
+	/* CFA feature is disabled / Advancde power management disable */
+	pSegIdDrvInfo->feature_cmd_set_en1		= 0x0;
+	pSegIdDrvInfo->feature_cmd_set_en2		= 0x4000;
+	pSegIdDrvInfo->reserved4			= 0x0;
+	/* 0x1 * 2minutes */
+	pSegIdDrvInfo->req_time_for_security_er_done	= 0x19;
+	pSegIdDrvInfo->req_time_for_enhan_security_er_done	= 0x19;
+	/* Advanced power management level 1 */
+	pSegIdDrvInfo->adv_pwr_mgm_lvl_val			= 0x0;
+	pSegIdDrvInfo->reserved5			= 0x0;
+	memset((void *)pSegIdDrvInfo->reserved6, 0x00, 68);
+	/* Security mode feature is disabled */
+	pSegIdDrvInfo->security_stas			= 0x0;
+	memset((void *)pSegIdDrvInfo->vendor_uniq_bytes, 0x00, 62);
+	/* CFA power mode 1 support in maximum 200mA */
+	pSegIdDrvInfo->cfa_pwr_mode			= 0x0100;
+	memset((void *)pSegIdDrvInfo->reserved7, 0x00, 190);
+}
+
+static int mg_storage_config(void)
+{
+	u8 buff[512];
+
+	if (mg_set_feature(mg_feature_id_transmode, mg_feature_val_trans_vcmd)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	mg_gen_ataid((mg_io_type_drv_info *)buff);
+
+	if (mg_mflash_do_write_sects(buff, 0, 1, mg_vcmd_update_stgdrvinfo)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	if (mg_set_feature(mg_feature_id_transmode, mg_feature_val_trans_default)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	LOG_INFO("mflash: storage config ok");
+	return ERROR_OK;
+}
+
+static int mg_boot_config(void)
+{
+	u8 buff[512];
+
+	if (mg_set_feature(mg_feature_id_transmode, mg_feature_val_trans_vcmd)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	memset(buff, 0xff, 512);
+
+	buff[0] = mg_op_mode_snd;		/* operation mode */
+	buff[1] = MG_UNLOCK_OTP_AREA;
+	buff[2] = 4;				/* boot size */
+	*((u32 *)(buff + 4)) = 0;		/* XIP size */
+
+	if (mg_mflash_do_write_sects(buff, 0, 1, mg_vcmd_update_xipinfo)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	if (mg_set_feature(mg_feature_id_transmode, mg_feature_val_trans_default)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	LOG_INFO("mflash: boot config ok");
+	return ERROR_OK;
+}
+
+static int mg_set_pll(mg_pll_t *pll)
+{
+	u8 buff[512];
+
+	memset(buff, 0xff, 512);
+	*((u32 *)&buff[0]) = pll->lock_cyc;	/* PLL Lock cycle */
+	*((u16 *)&buff[4]) = pll->feedback_div;	/* PLL Feedback 9bit Divider */
+	buff[6] = pll->input_div;		/* PLL Input 5bit Divider */
+	buff[7] = pll->output_div;		/* PLL Output Divider */
+
+	if (mg_set_feature(mg_feature_id_transmode, mg_feature_val_trans_vcmd)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	if (mg_mflash_do_write_sects(buff, 0, 1, mg_vcmd_wr_pll)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	if (mg_set_feature(mg_feature_id_transmode, mg_feature_val_trans_default)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	LOG_INFO("mflash: set pll ok");
+	return ERROR_OK;
+}
+
+static int mg_erase_nand(void)
+{
+	if (mg_set_feature(mg_feature_id_transmode, mg_feature_val_trans_vcmd)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	if (mg_mflash_do_write_sects(NULL, 0, 0, mg_vcmd_purge_nand)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	if (mg_set_feature(mg_feature_id_transmode, mg_feature_val_trans_default)
+			!= ERROR_OK)
+		return ERROR_FAIL;
+
+	LOG_INFO("mflash: erase nand ok");
+	return ERROR_OK;
+}
+
+int mg_config_cmd(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
+{
+	double fin, fout;
+	mg_pll_t pll;
+
+	if (mg_verify_interface() != ERROR_OK)
+		return ERROR_FAIL;
+
+	if (mg_mflash_rst() != ERROR_OK)
+		return ERROR_FAIL;
+
+	switch (argc) {
+		case 2:
+			if (!strcmp(args[1], "boot")) {
+				if (mg_boot_config() != ERROR_OK)
+					return ERROR_FAIL;
+
+				return ERROR_OK;
+			} else if (!strcmp(args[1], "storage")) {
+				if (mg_storage_config() != ERROR_OK)
+					return ERROR_FAIL;
+
+				return ERROR_OK;
+			} else
+				return ERROR_COMMAND_NOTFOUND;
+			break;
+		case 3:
+			if (!strcmp(args[1], "pll")) {
+				fin = strtoul(args[2], NULL, 0);
+
+				if (fin > MG_PLL_CLK_OUT)
+					return ERROR_FAIL;
+
+				fout = mg_calc_pll(fin, &pll);
+
+				if (!fout)
+					return ERROR_FAIL;
+
+				LOG_INFO("mflash: Fout=%u Hz, feedback=%u," 
+						"indiv=%u, outdiv=%u, lock=%u",
+						(u32)fout, pll.feedback_div,
+						pll.input_div, pll.output_div,
+						pll.lock_cyc);
+
+				if (mg_erase_nand() != ERROR_OK)
+					return ERROR_FAIL;
+
+				if (mg_set_pll(&pll) != ERROR_OK)
+					return ERROR_FAIL;
+
+				return ERROR_OK;
+			} else
+				return ERROR_COMMAND_NOTFOUND;
+			break;
+		default:
+			return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+
+	return ERROR_OK;
+}
+
 int mflash_init_drivers(struct command_context_s *cmd_ctx)
 {
 	if (mflash_bank) {
@@ -757,6 +1194,8 @@
 				"mflash write <num> <file> <address>");
 		register_command(cmd_ctx, mflash_cmd, "dump", mg_dump_cmd, COMMAND_EXEC,
 						"mflash dump <num> <file> <address> <size>");
+		register_command(cmd_ctx, mflash_cmd, "config", mg_config_cmd,
+				COMMAND_EXEC, "mflash config <num> <stage>");
 	}
 
 	return ERROR_OK;

Modified: trunk/src/flash/mflash.h
===================================================================
--- trunk/src/flash/mflash.h	2009-05-27 12:21:28 UTC (rev 1929)
+++ trunk/src/flash/mflash.h	2009-05-27 12:30:42 UTC (rev 1930)
@@ -48,7 +48,7 @@
 	mg_io_uint16 unformatted_bytes_per_track;		/* 04 */
 	mg_io_uint16 unformatted_bytes_per_sector;		/* 05 */
 	mg_io_uint16 sectors_per_track;					/* 06 */
-	mg_io_uint8  vendor_unique1[6];					/* 07/08/09 */
+	mg_io_uint16  vendor_unique1[3];				/* 07/08/09 */
 
 	mg_io_uint8  serial_number[20];					/* 10~19 */
 
@@ -117,6 +117,14 @@
 
 } mg_io_type_drv_info;
 
+typedef struct _mg_pll_t
+{
+	unsigned int   lock_cyc;
+	unsigned short feedback_div;	/* 9bit divider */
+	unsigned char  input_div;	/* 5bit divider */
+	unsigned char  output_div;	/* 2bit divider */
+} mg_pll_t;
+
 typedef struct mg_drv_info_s {
 	mg_io_type_drv_info drv_id;
 	u32 tot_sects;
@@ -158,6 +166,16 @@
 #define MG_OEM_DISK_WAIT_TIME_NORMAL	3000	/* msec */
 #define MG_OEM_DISK_WAIT_TIME_SHORT		1000	/* msec */
 
+#define MG_PLL_CLK_OUT 66000000.0 /* 66Mhz */
+#define MG_PLL_MAX_FEEDBACKDIV_VAL 512
+#define MG_PLL_MAX_INPUTDIV_VAL 32
+#define MG_PLL_MAX_OUTPUTDIV_VAL 4
+
+#define MG_PLL_STD_INPUTCLK 12000000.0 /* 12Mhz */
+#define MG_PLL_STD_LOCKCYCLE 10000
+
+#define MG_UNLOCK_OTP_AREA 0xFF
+
 typedef enum _mg_io_type_wait{
 
 	mg_io_wait_bsy       = 1,
@@ -238,4 +256,37 @@
 
 } mg_io_type_cmd;
 
+typedef enum _mg_feature_id
+{
+	mg_feature_id_transmode = 0x3
+} mg_feature_id;
+
+typedef enum _mg_feature_val
+{
+	mg_feature_val_trans_default = 0x0,
+	mg_feature_val_trans_vcmd = 0x3,
+	mg_feature_val_trand_vcmds = 0x2
+} mg_feature_val;
+
+typedef enum _mg_vcmd
+{
+	mg_vcmd_update_xipinfo = 0xFA, /* FWPATCH commmand through IOM I/O */
+	mg_vcmd_verify_fwpatch = 0xFB, /* FWPATCH commmand through IOM I/O */
+	mg_vcmd_update_stgdrvinfo = 0xFC, /* IOM identificatin info program command */
+	mg_vcmd_prep_fwpatch = 0xFD, /* FWPATCH commmand through IOM I/O */
+	mg_vcmd_exe_fwpatch = 0xFE, /* FWPATCH commmand through IOM I/O */
+	mg_vcmd_wr_pll = 0x8B,
+	mg_vcmd_purge_nand = 0x8C, /* Only for  Seagle */
+	mg_vcmd_lock_otp = 0x8D,
+	mg_vcmd_rd_otp = 0x8E,
+	mg_vcmd_wr_otp = 0x8F
+} mg_vcmd;
+
+typedef enum _mg_opmode
+{
+	mg_op_mode_xip = 1, /* TRUE XIP */
+	mg_op_mode_snd = 2, /* BOOT+Storage */
+	mg_op_mode_stg = 0  /* Only Storage */
+} mg_opmode;
+
 #endif



From zwelch at mail.berlios.de  Wed May 27 14:34:06 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 14:34:06 +0200
Subject: [Openocd-svn] r1931 - trunk/src/flash
Message-ID: <200905271234.n4RCY6ni004699@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 14:34:02 +0200 (Wed, 27 May 2009)
New Revision: 1931

Modified:
   trunk/src/flash/mflash.c
   trunk/src/flash/mflash.h
Log:
unsik Kim <donari75 at gmail.com>:
Add large bank write/dump support in mflash driver.


Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-27 12:30:42 UTC (rev 1930)
+++ trunk/src/flash/mflash.c	2009-05-27 12:34:02 UTC (rev 1931)
@@ -670,13 +670,11 @@
 
 static int mg_write_cmd(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
-	u32 address, buf_cnt;
+	u32 address, buf_cnt, cnt, res, i;
 	u8 *buffer;
-	/* TODO : multi-bank support, large file support */
 	fileio_t fileio;
 	duration_t duration;
 	char *duration_text;
-	int ret;
 
 	if (argc != 3) {
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -688,18 +686,32 @@
 		return ERROR_FAIL;
 	}
 
-	buffer = malloc(fileio.size);
-
-	if (fileio_read(&fileio, fileio.size, buffer, &buf_cnt) != ERROR_OK)
-	{
-		free(buffer);
+	buffer = malloc(MG_FILEIO_CHUNK);
+	if (!buffer) {
 		fileio_close(&fileio);
 		return ERROR_FAIL;
 	}
 
+	cnt = fileio.size / MG_FILEIO_CHUNK;
+	res = fileio.size % MG_FILEIO_CHUNK;
+
 	duration_start_measure(&duration);
 
-	ret = mg_mflash_write(address, buffer, (u32)fileio.size);
+	for (i = 0; i < cnt; i++) {
+		if (fileio_read(&fileio, MG_FILEIO_CHUNK, buffer, &buf_cnt) !=
+				ERROR_OK)
+			goto mg_write_cmd_err;
+		if (mg_mflash_write(address, buffer, MG_FILEIO_CHUNK) != ERROR_OK)
+			goto mg_write_cmd_err;
+		address += MG_FILEIO_CHUNK;
+	}
+ 
+	if (res) {
+		if (fileio_read(&fileio, res, buffer, &buf_cnt) != ERROR_OK)
+			goto mg_write_cmd_err;			
+		if (mg_mflash_write(address, buffer, res) != ERROR_OK)
+			goto mg_write_cmd_err;
+	}
 
 	duration_stop_measure(&duration, &duration_text);
 
@@ -708,19 +720,24 @@
 		(float)fileio.size / 1024.0 / ((float)duration.duration.tv_sec + ((float)duration.duration.tv_usec / 1000000.0)));
 
 	free(duration_text);
+	free(buffer);
+	fileio_close(&fileio);
 
+	return ERROR_OK;
+
+mg_write_cmd_err:
+	duration_stop_measure(&duration, &duration_text);
+	free(duration_text);
+ 	free(buffer);
 	fileio_close(&fileio);
 
-	free(buffer);
-
-	return ERROR_OK;
+	return ERROR_FAIL;
 }
 
 static int mg_dump_cmd(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
-	u32 address, size_written, size;
+	u32 address, size_written, size, cnt, res, i;
 	u8 *buffer;
-	/* TODO : multi-bank support */
 	fileio_t fileio;
 	duration_t duration;
 	char *duration_text;
@@ -735,31 +752,55 @@
 	if (fileio_open(&fileio, args[1], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK) {
 		return ERROR_FAIL;
 	}
+ 
+	buffer = malloc(MG_FILEIO_CHUNK);
+	if (!buffer) {
+		fileio_close(&fileio);
+		return ERROR_FAIL;
+	}
 
-	buffer = malloc(size);
-
+	cnt = size / MG_FILEIO_CHUNK;
+	res = size % MG_FILEIO_CHUNK;
+ 
 	duration_start_measure(&duration);
 
-	mg_mflash_read(address, buffer, size);
+	for (i = 0; i < cnt; i++) {
+		if (mg_mflash_read(address, buffer, MG_FILEIO_CHUNK) != ERROR_OK)
+			goto mg_dump_cmd_err;
+		if (fileio_write(&fileio, MG_FILEIO_CHUNK, buffer, &size_written)
+				!= ERROR_OK)
+			goto mg_dump_cmd_err;
+		address += MG_FILEIO_CHUNK;
+	}
+ 
+	if (res) {
+		if (mg_mflash_read(address, buffer, res) != ERROR_OK)
+			goto mg_dump_cmd_err;
+		if (fileio_write(&fileio, res, buffer, &size_written) != ERROR_OK)
+			goto mg_dump_cmd_err;
+	}
 
 	duration_stop_measure(&duration, &duration_text);
 
-	fileio_write(&fileio, size, buffer, &size_written);
-
 	command_print(cmd_ctx, "dump image (address 0x%8.8x size %u) to file %s in %s (%f kB/s)",
 				address, size, args[1], duration_text,
 				(float)size / 1024.0 / ((float)duration.duration.tv_sec + ((float)duration.duration.tv_usec / 1000000.0)));
 
 	free(duration_text);
-
+	free(buffer);
 	fileio_close(&fileio);
 
-	free(buffer);
+	return ERROR_OK;
 
-	return ERROR_OK;
+mg_dump_cmd_err:
+	duration_stop_measure(&duration, &duration_text);
+	free(duration_text);
+ 	free(buffer);
+	fileio_close(&fileio);
+ 
+	return ERROR_FAIL;	
 }
 
-
 static int mg_set_feature(mg_feature_id feature, mg_feature_val config)
 {
 	target_t *target = mflash_bank->target;

Modified: trunk/src/flash/mflash.h
===================================================================
--- trunk/src/flash/mflash.h	2009-05-27 12:30:42 UTC (rev 1930)
+++ trunk/src/flash/mflash.h	2009-05-27 12:34:02 UTC (rev 1931)
@@ -176,6 +176,8 @@
 
 #define MG_UNLOCK_OTP_AREA 0xFF
 
+#define MG_FILEIO_CHUNK 1048576
+
 typedef enum _mg_io_type_wait{
 
 	mg_io_wait_bsy       = 1,



From zwelch at mail.berlios.de  Wed May 27 17:15:16 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 27 May 2009 17:15:16 +0200
Subject: [Openocd-svn] r1932 - in trunk/doc/manual: . primer
Message-ID: <200905271515.n4RFFGsG027806@sheep.berlios.de>

Author: zwelch
Date: 2009-05-27 17:15:06 +0200 (Wed, 27 May 2009)
New Revision: 1932

Modified:
   trunk/doc/manual/main.txt
   trunk/doc/manual/primer/tcl.txt
   trunk/doc/manual/scripting.txt
   trunk/doc/manual/style.txt
Log:
Numerous minor updates and fixes for The Manual:
- Link Scripting Overview into the TCL Primer; both need more work.
- Remove redundant OpenOCD from Scripting Overview subpage title.
- Fix incorrect tag in Doxygen style guide example.
- Fix minor typo in first introductory paragraph of main page.


Modified: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-05-27 12:34:02 UTC (rev 1931)
+++ trunk/doc/manual/main.txt	2009-05-27 15:15:06 UTC (rev 1932)
@@ -4,7 +4,7 @@
 learning about the internal architecture of the OpenOCD project.
 
 In addition, this document contains the tactical and strategic plans
-and processes that have been devleoped by and for the community.
+and processes that have been developed by and for the OpenOCD community.
 
 Developers that want to contribute to OpenOCD should read the following
 sections before starting work:

Modified: trunk/doc/manual/primer/tcl.txt
===================================================================
--- trunk/doc/manual/primer/tcl.txt	2009-05-27 12:34:02 UTC (rev 1931)
+++ trunk/doc/manual/primer/tcl.txt	2009-05-27 15:15:06 UTC (rev 1932)
@@ -1,5 +1,7 @@
 /** @page primertcl OpenOCD TCL Primer
 
+The @subpage scripting page provides additional TCL Primer material.
+
 @verbatim
 
 ****************************************

Modified: trunk/doc/manual/scripting.txt
===================================================================
--- trunk/doc/manual/scripting.txt	2009-05-27 12:34:02 UTC (rev 1931)
+++ trunk/doc/manual/scripting.txt	2009-05-27 15:15:06 UTC (rev 1932)
@@ -1,4 +1,4 @@
-/** @page scripting OpenOCD Scripting Overview
+/** @page scripting Scripting Overview
 
 @section scriptingisnt What scripting will not do
 

Modified: trunk/doc/manual/style.txt
===================================================================
--- trunk/doc/manual/style.txt	2009-05-27 12:34:02 UTC (rev 1931)
+++ trunk/doc/manual/style.txt	2009-05-27 15:15:06 UTC (rev 1932)
@@ -202,7 +202,7 @@
  */
 /** @file
 
-This file contains the @page page.
+This file contains the @ref pagename page.
 
  */
 @endverbatim



From kc8apf at mail.berlios.de  Wed May 27 22:30:18 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 27 May 2009 22:30:18 +0200
Subject: [Openocd-svn] r1933 - in trunk/src: helper server
Message-ID: <200905272030.n4RKUIYQ013532@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-27 22:30:17 +0200 (Wed, 27 May 2009)
New Revision: 1933

Modified:
   trunk/src/helper/log.c
   trunk/src/server/gdb_server.c
Log:
Author: Nicolas Pitre <nico at cam.org>
	- Silence errors about keep_alive() not being called frequently enough unless
	a gdb session is active or debugging is enabled


Modified: trunk/src/helper/log.c
===================================================================
--- trunk/src/helper/log.c	2009-05-27 15:15:06 UTC (rev 1932)
+++ trunk/src/helper/log.c	2009-05-27 20:30:17 UTC (rev 1933)
@@ -385,7 +385,19 @@
 	current_time=timeval_ms();
 	if (current_time-last_time>1000)
 	{
-		LOG_WARNING("keep_alive() was not invoked in the 1000ms timelimit. GDB alive packet not sent! (%lld). Workaround: increase \"set remotetimeout\" in GDB", current_time-last_time);
+		extern int gdb_actual_connections;
+
+		if (gdb_actual_connections)
+			LOG_WARNING("keep_alive() was not invoked in the "
+				"1000ms timelimit. GDB alive packet not "
+				"sent! (%lld). Workaround: increase "
+				"\"set remotetimeout\" in GDB",
+				current_time-last_time);
+		else
+			LOG_DEBUG("keep_alive() was not invoked in the "
+				"1000ms timelimit (%lld). This may cause "
+				"trouble with GDB connections.",
+				current_time-last_time);
 	}
 	if (current_time-last_time>500)
 	{

Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2009-05-27 15:15:06 UTC (rev 1932)
+++ trunk/src/server/gdb_server.c	2009-05-27 20:30:17 UTC (rev 1933)
@@ -61,6 +61,10 @@
 /* target behaviour on gdb detach */
 enum gdb_detach_mode detach_mode = GDB_DETACH_RESUME;
 
+/* number of gdb connections, mainly to supress gdb related debugging spam
+ * in helper/log.c when no gdb connections are actually active */
+int gdb_actual_connections;
+
 /* set if we are sending a memory map to gdb
  * via qXfer:memory-map:read packet */
 /* enabled by default*/
@@ -797,6 +801,9 @@
 	if (initial_ack != '+')
 		gdb_putback_char(connection, initial_ack);
 	target_call_event_callbacks(gdb_service->target, TARGET_EVENT_GDB_ATTACH );
+
+	gdb_actual_connections++;
+
 	return ERROR_OK;
 }
 
@@ -805,6 +812,8 @@
 	gdb_service_t *gdb_service = connection->service->priv;
 	gdb_connection_t *gdb_connection = connection->priv;
 
+	gdb_actual_connections--;
+
 	/* see if an image built with vFlash commands is left */
 	if (gdb_connection->vflash_image)
 	{



From kc8apf at mail.berlios.de  Wed May 27 23:03:54 2009
From: kc8apf at mail.berlios.de (kc8apf at BerliOS)
Date: Wed, 27 May 2009 23:03:54 +0200
Subject: [Openocd-svn] r1934 - trunk/src/target
Message-ID: <200905272103.n4RL3sZp018183@sheep.berlios.de>

Author: kc8apf
Date: 2009-05-27 23:03:51 +0200 (Wed, 27 May 2009)
New Revision: 1934

Modified:
   trunk/src/target/embeddedice.c
Log:
Author: Nicolas Pitre <nico at cam.org>
	- cut out the "unknown EmbeddedICE version" message with Feroceon


Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-27 20:30:17 UTC (rev 1933)
+++ trunk/src/target/embeddedice.c	2009-05-27 21:03:51 UTC (rev 1934)
@@ -179,6 +179,13 @@
 			arm7_9->has_monitor_mode = 1;
 			break;
 		default:
+			/*
+			 * The Feroceon implementation has the version number
+			 * in some unusual bits.  Let feroceon.c validate it
+			 * and do the appropriate setup itself.
+			 */
+			if (strcmp(target->type->name, "feroceon") == 0)
+				break;
 			LOG_ERROR("unknown EmbeddedICE version (comms ctrl: 0x%8.8x)", buf_get_u32(reg_list[EICE_COMMS_CTRL].value, 0, 32));
 	}
 



From zwelch at mail.berlios.de  Thu May 28 01:54:19 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 28 May 2009 01:54:19 +0200
Subject: [Openocd-svn] r1935 - trunk/src/flash
Message-ID: <200905272354.n4RNsJuH017726@sheep.berlios.de>

Author: zwelch
Date: 2009-05-28 01:54:16 +0200 (Thu, 28 May 2009)
New Revision: 1935

Modified:
   trunk/src/flash/mflash.c
Log:
Fix potentialyl unaligned memory accesses in mflash driver.

Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-27 21:03:51 UTC (rev 1934)
+++ trunk/src/flash/mflash.c	2009-05-27 23:54:16 UTC (rev 1935)
@@ -1126,8 +1126,9 @@
 	u8 buff[512];
 
 	memset(buff, 0xff, 512);
-	*((u32 *)&buff[0]) = pll->lock_cyc;	/* PLL Lock cycle */
-	*((u16 *)&buff[4]) = pll->feedback_div;	/* PLL Feedback 9bit Divider */
+	/* PLL Lock cycle and Feedback 9bit Divider */
+	memcpy(buff, &pll->lock_cyc, sizeof(u32));
+	memcpy(buff + 4, &pll->feedback_div, sizeof(u16));
 	buff[6] = pll->input_div;		/* PLL Input 5bit Divider */
 	buff[7] = pll->output_div;		/* PLL Output Divider */
 



From zwelch at mail.berlios.de  Thu May 28 02:47:38 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 28 May 2009 02:47:38 +0200
Subject: [Openocd-svn] r1936 - trunk/doc
Message-ID: <200905280047.n4S0lcP4026303@sheep.berlios.de>

Author: zwelch
Date: 2009-05-28 02:47:30 +0200 (Thu, 28 May 2009)
New Revision: 1936

Modified:
   trunk/doc/openocd.texi
Log:
David Brownell <david-b at pacbell.net>:

Fix a bunch of PDF generation bugs in the texi:

 * The "overfull" warnings are basically complaints about lines
   that are too long, so they ran off the right margin of the
   PDF documentation and turn into a "black blot".

 * The "underfull" warnings are basically complaints about lines
   that look ugly when they get filled, because the tokens are
   so long that the line-break algorithm can't do anything good.

In a few cases the simplest fix seemed to be to use more appropriate
texi commands.

In other cases the fix was a content bugfix:  "ocd_" not "openocd_";
and many of those "target variants" actually aren't recognized.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-27 23:54:16 UTC (rev 1935)
+++ trunk/doc/openocd.texi	2009-05-28 00:47:30 UTC (rev 1936)
@@ -261,7 +261,7 @@
 @item @b{ftdi2232} libftdi (@uref{http://www.intra2net.com/opensource/ftdi/})
 @item @b{ftd2xx} libftd2xx (@uref{http://www.ftdichip.com/Drivers/D2XX.htm})
 @item When using the Amontec JTAGkey, you have to get the drivers from the Amontec
-homepage (@uref{http://www.amontec.com}), as the JTAGkey uses a non-standard VID/PID. 
+homepage (@uref{http://www.amontec.com}). The JTAGkey uses a non-standard VID/PID.
 @end itemize
 
 libftdi is supported under Windows. Do not use versions earlier than 0.14.
@@ -320,9 +320,11 @@
 @item
 @option{--enable-ft2232_libftdi} - An open source (free) alternative to FTDICHIP.COM ftd2xx solution (Linux, MacOS, Cygwin).
 @item
- at option{--with-ftd2xx-win32-zipdir=PATH} - If using FTDICHIP.COM ft2232c, point at the directory where the Win32 FTDICHIP.COM 'CDM' driver zip file was unpacked.
+ at option{--with-ftd2xx-win32-zipdir=PATH} - If using FTDICHIP.COM ft2232c driver,
+give the directory where the Win32 FTDICHIP.COM 'CDM' driver zip file was unpacked.
 @item
- at option{--with-ftd2xx-linux-tardir=PATH} - Linux only. Equivalent of @option{--with-ftd2xx-win32-zipdir}, where you unpacked the TAR.GZ file.
+ at option{--with-ftd2xx-linux-tardir=PATH} - If using FTDICHIP.COM ft2232c driver
+on Linux, give the directory where the Linux driver's TAR.GZ file was unpacked.
 @item
 @option{--with-ftd2xx-lib=shared|static} - Linux only. Default: static. Specifies how the FTDICHIP.COM libftd2xx driver should be linked. Note: 'static' only works in conjunction with @option{--with-ftd2xx-linux-tardir}. The 'shared' value is supported (12/26/2008), however you must manually install the required header files and shared libraries in an appropriate place. This uses ``libusb'' internally.
 @item
@@ -369,43 +371,54 @@
 
 Below is an example build process:
 
-1) Check out the latest version of ``openocd'' from SVN.
+ at enumerate
+ at item Check out the latest version of ``openocd'' from SVN.
 
-2) Download & unpack either the Windows or Linux FTD2xx drivers
-    (@uref{http://www.ftdichip.com/Drivers/D2XX.htm}).
+ at item If you are using the FTDICHIP.COM driver, download
+and unpack the Windows or Linux FTD2xx drivers
+(@uref{http://www.ftdichip.com/Drivers/D2XX.htm}).
+If you are using the libftdi driver, install that package
+(e.g. @command{apt-get install libftdi} on systems with APT).
 
 @example
-   /home/duane/ftd2xx.win32    => the Cygwin/Win32 ZIP file contents.
-   /home/duane/libftd2xx0.4.16 => the Linux TAR.GZ file contents.
+/home/duane/ftd2xx.win32    => the Cygwin/Win32 ZIP file contents
+/home/duane/libftd2xx0.4.16 => the Linux TAR.GZ file contents
 @end example
 
-3) Configure with these options:
+ at item Configure with options resembling the following.
 
+ at enumerate a
+ at item Cygwin FTDICHIP solution:
 @example
-Cygwin FTDICHIP solution:
-   ./configure --prefix=/home/duane/mytools \
-               --enable-ft2232_ftd2xx \
-               --with-ftd2xx-win32-zipdir=/home/duane/ftd2xx.win32
+./configure --prefix=/home/duane/mytools \
+        --enable-ft2232_ftd2xx \
+        --with-ftd2xx-win32-zipdir=/home/duane/ftd2xx.win32
+ at end example
 
-Linux FTDICHIP solution:
-   ./configure --prefix=/home/duane/mytools \
-               --enable-ft2232_ftd2xx \
-               --with-ft2xx-linux-tardir=/home/duane/libftd2xx0.4.16
+ at item Linux FTDICHIP solution:
+ at example
+./configure --prefix=/home/duane/mytools \
+        --enable-ft2232_ftd2xx \
+        --with-ft2xx-linux-tardir=/home/duane/libftd2xx0.4.16
+ at end example
 
-Cygwin/Linux LIBFTDI solution:
-    Assumes: 
-    1a) For Windows: The Windows port of LIBUSB is in place.
-    1b) For Linux: libusb has been built/installed and is in place.
+ at item Cygwin/Linux LIBFTDI solution ... assuming that
+ at itemize
+ at item For Windows -- that the Windows port of LIBUSB is in place.
+ at item For Linux -- that libusb has been built/installed and is in place.
+ at item That libftdi has been built and installed (relies on libusb).
+ at end itemize
 
-    2) And libftdi has been built and installed
-    Note: libftdi - relies upon libusb.
+Then configure the libftdi solution like this:
 
-    ./configure --prefix=/home/duane/mytools \
-                --enable-ft2232_libftdi
-       
+ at example
+./configure --prefix=/home/duane/mytools \
+        --enable-ft2232_libftdi
 @end example
+ at end enumerate
 
-4) Then just type ``make'', and perhaps ``make install''.
+ at item Then just type ``make'', and perhaps ``make install''.
+ at end enumerate
 
 
 @section Miscellaneous Configure Options
@@ -467,10 +480,11 @@
 
 There are many USB JTAG dongles on the market, many of them are based
 on a chip from ``Future Technology Devices International'' (FTDI)
-known as the FTDI FT2232.
+known as the FTDI FT2232; this is a USB full speed (12 Mbps) chip.
+See: @url{http://www.ftdichip.com} for more information.
+In summer 2009, USB high speed (480 Mbps) versions of these FTDI
+chips are starting to become available in JTAG adapters.
 
-See: @url{http://www.ftdichip.com} or @url{http://www.ftdichip.com/Products/FT2232H.htm}
-
 As of 28/Nov/2008, the following are supported:
 
 @itemize @bullet
@@ -489,7 +503,9 @@
 @item @b{flyswatter}
 @* See: @url{http://www.tincantools.com}
 @item @b{turtelizer2}
-@* See: @url{http://www.ethernut.de}, or @url{http://www.ethernut.de/en/hardware/turtelizer/index.html}
+@* See:
+ at uref{http://www.ethernut.de/en/hardware/turtelizer/index.html, Turtelizer 2}, or
+ at url{http://www.ethernut.de}
 @item @b{comstick}
 @* Link: @url{http://www.hitex.com/index.php?id=383}
 @item @b{stm32stick}
@@ -563,7 +579,8 @@
 @* Link: @url{http://www.gateworks.com/products/avila_accessories/gw16042.php}
 
 @item @b{Wiggler2}
-@* Link: @url{http://www.ccac.rwth-aachen.de/~michaels/index.php/hardware/armjtag}
+@*@uref{http://www.ccac.rwth-aachen.de/@/~michaels/@/index.php/hardware/@/armjtag,
+Improved parallel-port wiggler-style JTAG adapter}
 
 @item @b{Wiggler_ntrst_inverted}
 @* Yet another variation - See the source code, src/jtag/parport.c
@@ -581,12 +598,13 @@
 @* Unknown.
 
 @item @b{Lattice}
-@* ispDownload from Lattice Semiconductor @url{http://www.latticesemi.com/lit/docs/devtools/dlcable.pdf}
+@* ispDownload from Lattice Semiconductor
+ at url{http://www.latticesemi.com/lit/docs/@/devtools/dlcable.pdf}
 
 @item @b{flashlink}
-@* From ST Microsystems, link:
- at url{http://www.st.com/stonline/products/literature/um/7889.pdf}
-Title: FlashLINK JTAG programing cable for PSD and uPSD
+@* From ST Microsystems;
+ at uref{http://www.st.com/stonline/@/products/literature/um/7889.pdf,
+FlashLINK JTAG programing cable for PSD and uPSD}
 
 @end itemize
 
@@ -717,7 +735,7 @@
 OpenOCD will read each filename in sequence, for example:
 
 @example
-        openocd -f file1.cfg -f file2.cfg -f file2.cfg
+openocd -f file1.cfg -f file2.cfg -f file2.cfg
 @end example
 
 You can also intermix various commands with the ``-c'' command line
@@ -806,11 +824,6 @@
 today, that said, perhaps some interfaces have only been used by the
 sole developer who created it.
 
- at b{FIXME/NOTE:} We need to add support for a variable like Tcl variable
-tcl_platform(platform), it should be called jim_platform (because it
-is jim, not real tcl) and it should contain 1 of 3 words: ``linux'',
-``cygwin'' or ``mingw''
-
 Interface files should be found in @t{$(INSTALLDIR)/lib/openocd/interface}
 
 @section Board Config Files
@@ -881,8 +894,10 @@
 problems in OpenOCD configurations.
 
 @example
-Info:   JTAG tap: sam7x256.cpu tap/device found: 0x3f0f0f0f (Manufacturer: 0x787, Part: 0xf0f0, Version: 0x3)
-Error:  ERROR: Tap: sam7x256.cpu - Expected id: 0x12345678, Got: 0x3f0f0f0f
+Info:   JTAG tap: sam7x256.cpu tap/device found: 0x3f0f0f0f
+                (Manufacturer: 0x787, Part: 0xf0f0, Version: 0x3)
+Error:  ERROR: Tap: sam7x256.cpu - Expected id: 0x12345678,
+                Got: 0x3f0f0f0f
 Error:  ERROR: expected: mfg: 0x33c, part: 0x2345, ver: 0x1
 Error:  ERROR:      got: mfg: 0x787, part: 0xf0f0, ver: 0x3
 @end example
@@ -989,7 +1004,8 @@
 @example
 # for an ARM7TDMI.
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf \
+        -expected-id $_CPUTAPID
 @end example
 
 @b{COMPLEX example:}
@@ -1007,14 +1023,16 @@
 @} else @{
    set _FLASHTAPID 0x25966041
 @}
-jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 -expected-id $_FLASHTAPID
+jtag newtap $_CHIPNAME flash -irlen 8 -ircapture 0x1 -irmask 0x1 \
+        -expected-id $_FLASHTAPID
 
 if @{ [info exists CPUTAPID ] @} @{
    set _CPUTAPID $CPUTAPID
 @} else @{
    set _CPUTAPID 0x25966041
 @}
-jtag newtap $_CHIPNAME cpu   -irlen 4 -ircapture 0xf -irmask 0xe -expected-id $_CPUTAPID
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0xf -irmask 0xe \
+        -expected-id $_CPUTAPID
 
 
 if @{ [info exists BSTAPID ] @} @{
@@ -1022,7 +1040,8 @@
 @} else @{
    set _BSTAPID 0x1457f041
 @}
-jtag newtap $_CHIPNAME bs    -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID
+jtag newtap $_CHIPNAME bs -irlen 5 -ircapture 0x1 -irmask 0x1 \
+        -expected-id $_BSTAPID
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
 @end example
@@ -1145,7 +1164,6 @@
 @* See: @xref{Tcl Crash Course}.
 @end itemize
 
-
 @node Daemon Configuration
 @chapter Daemon Configuration
 @cindex initialization
@@ -2087,7 +2105,10 @@
        reset halt
    @}
    mychip.cpu configure -event gdb-attach my_attach_proc 
-   mychip.cpu configure -event gdb-attach @{ puts "Reset..." ; reset halt @}
+   mychip.cpu configure -event gdb-attach @{
+	   puts "Reset..."
+	   reset halt
+   @}
 @end example
 
 @section Current Events
@@ -2256,27 +2277,16 @@
 
 @section Target Variants
 @itemize @bullet
- at item @b{arm7tdmi}
-@* Unknown (please write me)
- at item @b{arm720t}
-@* Unknown (please write me) (similar to arm7tdmi)
- at item @b{arm9tdmi}
-@* Variants: @option{arm920t}, @option{arm922t} and @option{arm940t}
-This enables the hardware single-stepping support found on these
-cores.
- at item @b{arm920t}
-@* None.
- at item @b{arm966e}
-@* None (this is also used as the ARM946)
 @item @b{cortex_m3}
-@* use variant <@var{-variant lm3s}> when debugging Luminary lm3s targets. This will cause
-OpenOCD to use a software reset rather than asserting SRST to avoid a issue with clearing
-the debug registers. This is fixed in Fury Rev B, DustDevil Rev B, Tempest, these revisions will
+@* Use variant @option{lm3s} when debugging older Stellaris LM3S targets.
+This will cause OpenOCD to use a software reset rather than asserting
+SRST, to avoid a issue with clearing the debug registers.
+This is fixed in Fury Rev B, DustDevil Rev B, Tempest; these revisions will
 be detected and the normal reset behaviour used.
 @item @b{xscale}
-@* Supported variants are @option{ixp42x}, @option{ixp45x}, @option{ixp46x}, at option{pxa250}, @option{pxa255}, @option{pxa26x}.
- at item @b{arm11}
-@* Supported variants are @option{arm1136}, @option{arm1156}, @option{arm1176}
+@*Supported variants are
+ at option{ixp42x}, @option{ixp45x}, @option{ixp46x},
+ at option{pxa250}, @option{pxa255}, @option{pxa26x}.
 @item @b{mips_m4k}
 @* Use variant @option{ejtag_srst} when debugging targets that do not
 provide a functional SRST line on the EJTAG connector.  This causes
@@ -3536,8 +3546,13 @@
 
 The way this works on the ZY1000 is to prefix a filename by
 "/tftp/ip/" and append the TFTP path on the TFTP
-server (tftpd). E.g. "load_image /tftp/10.0.0.96/c:\temp\abc.elf" will
-load c:\temp\abc.elf from the developer pc (10.0.0.96) into memory as
+server (tftpd). For example,
+
+ at example
+load_image /tftp/10.0.0.96/c:\temp\abc.elf
+ at end example
+
+will load c:\temp\abc.elf from the developer pc (10.0.0.96) into memory as
 if the file was hosted on the embedded host.
 
 In order to achieve decent performance, you must choose a TFTP server
@@ -3567,7 +3582,8 @@
 To start OpenOCD with a target script for the AT91R40008 CPU and reset
 the CPU upon startup of the OpenOCD daemon.
 @example
-openocd -f interface/parport.cfg -f target/at91r40008.cfg -c init -c reset 
+openocd -f interface/parport.cfg -f target/at91r40008.cfg \
+        -c "init" -c "reset"
 @end example
 
 
@@ -3585,7 +3601,8 @@
 errors, which has since been fixed: look up 1836 in
 @url{http://sourceware.org/cgi-bin/gnatsweb.pl?database=gdb}
 
-@*OpenOCD can communicate with GDB in two ways:
+OpenOCD can communicate with GDB in two ways:
+
 @enumerate
 @item
 A socket (TCP/IP) connection is typically started as follows:
@@ -3603,7 +3620,7 @@
 session.
 @end enumerate
 
-@*To see a list of available OpenOCD commands type @option{monitor help} on the
+To list the available OpenOCD commands type @command{monitor help} on the
 GDB command line.
 
 OpenOCD supports the gdb @option{qSupported} packet, this enables information
@@ -3707,8 +3724,9 @@
 
 By low-level, the intent is a human would not directly use these commands.
 
-Low-level commands are (should be) prefixed with "openocd_", e.g. openocd_flash_banks
-is the low level API upon which "flash banks" is implemented.
+Low-level commands are (should be) prefixed with "ocd_", e.g.
+ at command{ocd_flash_banks}
+is the low level API upon which @command{flash banks} is implemented.
 
 @itemize @bullet
 @item @b{ocd_mem2array} <@var{varname}> <@var{width}> <@var{addr}> <@var{nelems}>
@@ -3745,6 +3763,13 @@
 
 Note: 'winxx' was choosen because today (March-2009) no distinction is made between Win32 and Win64.
 
+ at quotation Note
+We should add support for a variable like Tcl variable
+ at code{tcl_platform(platform)}, it should be called
+ at code{jim_platform} (because it
+is jim, not real tcl).
+ at end quotation
+
 @node Upgrading
 @chapter Deprecated/Removed Commands
 @cindex Deprecated/Removed Commands
@@ -3753,7 +3778,8 @@
 @itemize @bullet
 @item @b{arm7_9 fast_writes}
 @cindex arm7_9 fast_writes
-@*use @option{arm7_9 fast_memory_access} command with same args. @xref{arm7_9 fast_memory_access}.
+@*Use @command{arm7_9 fast_memory_access} instead.
+ at xref{arm7_9 fast_memory_access}.
 @item @b{arm7_9 force_hw_bkpts}
 @cindex arm7_9 force_hw_bkpts
 @*Use @command{gdb_breakpoint_override} instead. Note that GDB will use hardware breakpoints
@@ -4451,7 +4477,8 @@
 is set to 10kHz for reset and 8MHz for post reset.
 
 @example
-openocd -f interface/parport.cfg -f target/str710.cfg -c "init" -c "reset"
+openocd -f interface/parport.cfg -f target/str710.cfg \
+        -c "init" -c "reset"
 @end example
 
 To list the target scripts available:



From zwelch at mail.berlios.de  Thu May 28 03:11:14 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 28 May 2009 03:11:14 +0200
Subject: [Openocd-svn] r1937 - trunk/doc
Message-ID: <200905280111.n4S1BE9p028543@sheep.berlios.de>

Author: zwelch
Date: 2009-05-28 03:11:10 +0200 (Thu, 28 May 2009)
New Revision: 1937

Modified:
   trunk/doc/openocd.texi
Log:
David Brownell <david-b at pacbell.net>:

Start updating the NOR flash coverage to use @deffn syntax, so the
commands have more consistent presentation and formatting.  This
reorganizes information and updates its presentation, except where
the information didn't really match the code.

This patch updates most of the driver specific support, creating one
new (and alphabetized!) section just for driver-specific data, where
previously that data was split over up to three sections.  Of note:

 - The at91sam7 docs were a bit out of date with respect to the code.

 - The "str9xpec" stuff still deserves some work.  For now, it sits
   in its own subsection; pretty messy.

 - Likewise the "mflash" stuff.  That's a parallel infrastructure,
   and is now in a section of its own.

 - The "mass_erase" commands for the Cortex M3 chips got turned into
   footnotes.  IMO, they should vanish sometime; they're superfluous.

 - There are still a bunch of undocumented NOR drivers.  Examples:
   avr(8), tms470, pic32mx, more.

Plus there are a handful of minor tweaks to the NAND docs (to help make
the NOR and NAND presentations be parallel); the "Command Index" has
been renamed as the "Command and Driver Index"; reference TI instead
of Luminary Micro in several places.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-28 00:47:30 UTC (rev 1936)
+++ trunk/doc/openocd.texi	2009-05-28 01:11:10 UTC (rev 1937)
@@ -82,7 +82,7 @@
 @comment Occurs when creating ``--html --no-split'' output
 @comment This fix is based on: http://sourceware.org/ml/binutils/2006-05/msg00215.html
 * OpenOCD Concept Index::            Concept Index
-* OpenOCD Command Index::            Command Index
+* Command and Driver Index::         Command and Driver Index
 @end menu
 
 @node About
@@ -110,7 +110,7 @@
 
 @b{GDB Debug:} It allows ARM7 (ARM7TDMI and ARM720t), ARM9 (ARM920T,
 ARM922T, ARM926EJ--S, ARM966E--S), XScale (PXA25x, IXP42x) and
-Cortex-M3 (Luminary Stellaris LM3 and ST STM32) based cores to be
+Cortex-M3 (Stellaris LM3 and ST STM32) based cores to be
 debugged via the GDB protocol.
 
 @b{Flash Programing:} Flash writing is supported for external CFI
@@ -497,7 +497,7 @@
 @item @b{signalyzer}
 @* See: @url{http://www.signalyzer.com}
 @item @b{evb_lm3s811}
-@* See: @url{http://www.luminarymicro.com} - The Luminary Micro Stellaris LM3S811 eval board has an FTD2232C chip built in.
+@* See: @url{http://www.luminarymicro.com} - The Stellaris LM3S811 eval board has an FTD2232C chip built in.
 @item @b{olimex-jtag}
 @* See: @url{http://www.olimex.com}
 @item @b{flyswatter}
@@ -2398,204 +2398,265 @@
 @*Enable (@var{on}) or disable (@var{off}) protection of flash sectors <@var{first}> to
 <@var{last}> of @option{flash bank} <@var{num}>.
 
- at subsection mFlash commands
- at cindex mFlash commands
+ at section flash bank command
+The @command{flash bank} command is used to configure one or more flash
+chips (or @emph{banks} in OpenOCD terms).
+Most CPUs have the ablity to ``boot'' from the first flash bank.
+
+ at quotation Note
+This command is not available after OpenOCD initialization has completed.
+Use it in board specific configuration files, not interactively.
+ at end quotation
+
+ at deffn {Config Command} {flash bank} driver base size chip_width bus_width target [driver_options]
+Configures a flash bank which provides persistent storage
+for addresses from @math{base} to @math{base + size - 1}.
+These banks will often be visible to GDB through the target's memory map.
+In some cases, configuring a flash bank will activate extra commands;
+see the driver-specific documentation.
+
 @itemize @bullet
- at item @b{mflash probe} 
- at cindex mflash probe
-@*Probe mflash.
- at item @b{mflash write} <@var{num}> <@var{file}> <@var{offset}>
- at cindex mflash write
-@*Write the binary <@var{file}> to mflash bank <@var{num}>, starting at
-<@var{offset}> bytes from the beginning of the bank.
- at item @b{mflash dump} <@var{num}> <@var{file}> <@var{offset}> <@var{size}>
- at cindex mflash dump
-@*Dump <size> bytes, starting at <@var{offset}> bytes from the beginning of the <@var{num}> bank 
-to a <@var{file}>.
- at item @b{mflash config pll} <@var{frequency}>
- at cindex mflash config pll
-@*Configure mflash pll. <@var{frequency}> is input frequency of mflash. The order is Hz.
-Issuing this command will erase mflash's whole internal nand and write new pll. 
-After this command, mflash needs power-on-reset for normal operation.
-If pll was newly configured, storage and boot(optional) info also need to be update.
- at item @b{mflash config boot}
- at cindex mflash config boot
-@*Configure bootable option. If bootable option is set, mflash offer the first 8 sectors
-(4kB) for boot.
- at item @b{mflash config storage}
- at cindex mflash config storage
-@*Configure storage information. For the normal storage operation, this information must be
-written. 
+ at item @var{driver} ... identifies the controller driver
+associated with the flash bank being declared.
+This is usually @code{cfi} for external flash, or else
+the name of a microcontroller with embedded flash memory.
+ at xref{Flash Driver List}.
+ at item @var{base} ... Base address of the flash chip.
+ at item @var{size} ... Size of the chip, in bytes.
+For some drivers, this value is detected from the hardware.
+ at item @var{chip_width} ... Width of the flash chip, in bytes;
+ignored for most microcontroller drivers.
+ at item @var{bus_width} ... Width of the data bus used to access the
+chip, in bytes; ignored for most microcontroller drivers.
+ at item @var{target} ... Names the target used to issue
+commands to the flash controller.
+ at comment Actually, it's currently a controller-specific parameter...
+ at item @var{driver_options} ... drivers may support, or require,
+additional parameters.  See the driver-specific documentation
+for more information.
 @end itemize
+ at end deffn
 
- at section flash bank command
-The @b{flash bank} command is used to configure one or more flash chips (or banks in OpenOCD terms)
+ at section Flash Drivers, Options, and Commands
+ at anchor{Flash Driver List}
+As noted above, the @command{flash bank} command requires a driver name,
+and allows driver-specific options and behaviors.
+Some drivers also activate driver-specific commands.
 
- at example
- at b{flash bank} <@var{driver}> <@var{base}> <@var{size}> <@var{chip_width}>
-<@var{bus_width}> <@var{target}> [@var{driver_options ...}]
- at end example
- at cindex flash bank
-@*Configures a flash bank at <@var{base}> of <@var{size}> bytes and <@var{chip_width}>
-and <@var{bus_width}> bytes using the selected flash <driver>.
+ at subsection External Flash
 
- at subsection External Flash - cfi options
- at cindex cfi options
-CFI flashes are external flash chips - often they are connected to a
-specific chip select on the CPU. By default, at hard reset, most
-CPUs have the ablity to ``boot'' from some flash chip - typically
-attached to the CPU's CS0 pin.
-
-For other chip selects: OpenOCD does not know how to configure, or
-access a specific chip select. Instead you, the human, might need to 
-configure additional chip selects via other commands (like: mww) , or
+ at deffn {Flash Driver} cfi
+ at cindex Common Flash Interface
+ at cindex CFI
+The ``Common Flash Interface'' (CFI) is the main standard for
+external NOR flash chips, each of which connects to a
+specific external chip select on the CPU.
+Frequently the first such chip is used to boot the system.
+Your board's @code{reset-init} handler might need to
+configure additional chip selects using other commands (like: @command{mww} to
+configure a bus and its timings) , or
 perhaps configure a GPIO pin that controls the ``write protect'' pin
 on the flash chip.
+The CFI driver can use a target-specific working area to significantly
+speed up operation.
 
- at b{flash bank cfi} <@var{base}> <@var{size}> <@var{chip_width}> <@var{bus_width}>
-<@var{target}> [@var{jedec_probe}|@var{x16_as_x8}]
-@*CFI flashes require the name or number of the target they're connected to
-as an additional
-argument. The CFI driver makes use of a working area (specified for the target)
-to significantly speed up operation. 
+The CFI driver can accept the following optional parameters, in any order:
 
- at var{chip_width} and @var{bus_width} are specified in bytes.
+ at itemize
+ at item @var{jedec_probe} ... is used to detect certain non-CFI flash ROMs,
+like AM29LV010 and similar types.
+ at item @var{x16_as_x8} ...
+ at end itemize
 
-The @var{jedec_probe} option is used to detect certain non-CFI flash ROMs, like AM29LV010 and similar types.
+To configure two adjacent banks of 16 MBytes each, both sixteen bits (two bytes)
+wide on a sixteen bit bus:
 
- at var{x16_as_x8} ???
+ at example
+flash bank cfi 0x00000000 0x01000000 2 2 $_TARGETNAME
+flash bank cfi 0x01000000 0x01000000 2 2 $_TARGETNAME
+ at end example
+ at end deffn
 
 @subsection Internal Flash (Microcontrollers)
- at subsubsection lpc2000 options
- at cindex lpc2000 options
 
- at b{flash bank lpc2000} <@var{base}> <@var{size}> 0 0 <@var{target}> <@var{variant}>
-<@var{clock}> [@var{calc_checksum}]
-@*LPC flashes don't require the chip and bus width to be specified. Additional
-parameters are the <@var{variant}>, which may be @var{lpc2000_v1} (older LPC21xx and LPC22xx)
-or @var{lpc2000_v2} (LPC213x, LPC214x, LPC210[123], LPC23xx and LPC24xx),
-the name or number of the target this flash belongs to (first is 0),
-the frequency at which the core
-is currently running (in kHz - must be an integral number), and the optional keyword
- at var{calc_checksum}, telling the driver to calculate a valid checksum for the exception
-vector table. 
+ at deffn {Flash Driver} aduc702x
+The ADUC702x analog microcontrollers from ST Micro
+include internal flash and use ARM7TDMI cores.
+The aduc702x flash driver works with models ADUC7019 through ADUC7028.
+The setup command only requires the @var{target} argument
+since all devices in this family have the same memory layout.
 
+ at example
+flash bank aduc702x 0 0 0 0 $_TARGETNAME
+ at end example
+ at end deffn
 
- at subsubsection at91sam7 options
- at cindex at91sam7 options
+ at deffn {Flash Driver} at91sam7
+All members of the AT91SAM7 microcontroller family from Atmel
+include internal flash and use ARM7TDMI cores.
+The driver automatically recognizes a number of these chips using
+the chip identification register, and autoconfigures itself.
 
- at b{flash bank at91sam7} 0 0 0 0 <@var{target}>
-@*AT91SAM7 flashes only require the @var{target}, all other values are looked up after
-reading the chip-id and type. 
+ at example
+flash bank at91sam7 0 0 0 0 $_TARGETNAME
+ at end example
 
- at subsubsection str7 options
- at cindex str7 options
+For chips which are not recognized by the controller driver, you must
+provide additional parameters in the following order:
 
- at b{flash bank str7x} <@var{base}> <@var{size}> 0 0 <@var{target}> <@var{variant}>
-@*variant can be either STR71x, STR73x or STR75x. 
+ at itemize
+ at item @var{chip_model} ... label used with @command{flash info}
+ at item @var{banks}
+ at item @var{sectors_per_bank}
+ at item @var{pages_per_sector}
+ at item @var{pages_size}
+ at item @var{num_nvm_bits}
+ at item @var{freq_khz} ... required if an external clock is provided,
+optional (but recommended) when the oscillator frequency is known
+ at end itemize
 
- at subsubsection str9 options
- at cindex str9 options
+It is recommended that you provide zeroes for all of those values
+except the clock frequency, so that everything except that frequency
+will be autoconfigured.
+Knowing the frequency helps ensure correct timings for flash access.
 
- at b{flash bank str9x} <@var{base}> <@var{size}> 0 0 <@var{target}>
-@*The str9 needs the flash controller to be configured prior to Flash programming, e.g.
+The flash controller handles erases automatically on a page (128/256 byte)
+basis, so explicit erase commands are not necessary for flash programming.
+However, there is an ``EraseAll`` command that can erase an entire flash
+plane (of up to 256KB), and it will be used automatically when you issue
+ at command{flash erase_sector} or @command{flash erase_address} commands.
+
+ at deffn Command {at91sam7 gpnvm} bitnum (set|clear)
+Set or clear a ``General Purpose Non-Volatle Memory'' (GPNVM)
+bit for the processor.   Each processor has a number of such bits,
+used for controlling features such as brownout detection (so they
+are not truly general purpose).
+ at quotation Note
+This assumes that the first flash bank (number 0) is associated with
+the appropriate at91sam7 target.
+ at end quotation
+ at end deffn
+ at end deffn
+
+ at deffn {Flash Driver} lpc2000
+Most members of the LPC2000 microcontroller family from NXP
+include internal flash and use ARM7TDMI cores.
+The @var{lpc2000} driver defines two mandatory and one optional parameters,
+which must appear in the following order:
+
+ at itemize
+ at item @var{variant} ... required, may be
+ at var{lpc2000_v1} (older LPC21xx and LPC22xx)
+or @var{lpc2000_v2} (LPC213x, LPC214x, LPC210[123], LPC23xx and LPC24xx)
+ at item @var{clock_kHz} ... the frequency, in kiloHertz,
+at which the core is running
+ at item @var{calc_checksum} ... optional (but you probably want to provide this!),
+telling the driver to calculate a valid checksum for the exception vector table.
+ at end itemize
+
+LPC flashes don't require the chip and bus width to be specified.
+
 @example
-str9x flash_config 0 4 2 0 0x80000
+flash bank lpc2000 0x0 0x7d000 0 0 $_TARGETNAME \
+      lpc2000_v2 14765 calc_checksum
 @end example
-This will setup the BBSR, NBBSR, BBADR and NBBADR registers respectively. 
+ at end deffn
 
- at subsubsection str9 options (str9xpec driver)
+ at deffn {Flash Driver} stellaris
+All members of the Stellaris LM3Sxxx microcontroller family from
+Texas Instruments
+include internal flash and use ARM Cortex M3 cores.
+The driver automatically recognizes a number of these chips using
+the chip identification register, and autoconfigures itself.
+ at footnote{Currently there is a @command{stellaris mass_erase} command.
+That seems pointless since the same effect can be had using the
+standard @command{flash erase_address} command.}
 
- at b{flash bank str9xpec} <@var{base}> <@var{size}> 0 0 <@var{target}>
-@*Before using the flash commands the turbo mode must be enabled using str9xpec
- at option{enable_turbo} <@var{num>.}
+ at example
+flash bank stellaris 0 0 0 0 $_TARGETNAME
+ at end example
+ at end deffn
 
-Only use this driver for locking/unlocking the device or configuring the option bytes.
-Use the standard str9 driver for programming. @xref{STR9 specific commands}.
+ at deffn {Flash Driver} stm32x
+All members of the STM32 microcontroller family from ST Microelectronics
+include internal flash and use ARM Cortex M3 cores.
+The driver automatically recognizes a number of these chips using
+the chip identification register, and autoconfigures itself.
 
- at subsubsection Stellaris (LM3Sxxx) options
- at cindex Stellaris (LM3Sxxx) options
+ at example
+flash bank stm32x 0 0 0 0 $_TARGETNAME
+ at end example
 
- at b{flash bank stellaris} <@var{base}> <@var{size}> 0 0 <@var{target}>
-@*Stellaris flash plugin only require the @var{target}.
+Some stm32x-specific commands
+ at footnote{Currently there is a @command{stm32x mass_erase} command.
+That seems pointless since the same effect can be had using the
+standard @command{flash erase_address} command.}
+are defined:
 
- at subsubsection stm32x options
- at cindex stm32x options
+ at deffn Command {stm32x lock} num
+Locks the entire stm32 device.
+The @var{num} parameter is a value shown by @command{flash banks}.
+ at end deffn
 
- at b{flash bank stm32x} <@var{base}> <@var{size}> 0 0 <@var{target}>
-@*stm32x flash plugin only require the @var{target}.
+ at deffn Command {stm32x unlock} num
+Unlocks the entire stm32 device.
+The @var{num} parameter is a value shown by @command{flash banks}.
+ at end deffn
 
- at subsubsection aduc702x options
- at cindex aduc702x options
+ at deffn Command {stm32x options_read} num
+Read and display the stm32 option bytes written by
+the @command{stm32x options_write} command.
+The @var{num} parameter is a value shown by @command{flash banks}.
+ at end deffn
 
- at b{flash bank aduc702x} 0 0 0 0 <@var{target}>
-@*The aduc702x flash plugin works with Analog Devices model numbers ADUC7019 through ADUC7028.  The setup command only requires the @var{target} argument (all devices in this family have the same memory layout).
+ at deffn Command {stm32x options_write} num (SWWDG|HWWDG) (RSTSTNDBY|NORSTSTNDBY) (RSTSTOP|NORSTSTOP)
+Writes the stm32 option byte with the specified values.
+The @var{num} parameter is a value shown by @command{flash banks}.
+ at end deffn
+ at end deffn
 
- at subsection mFlash Configuration
- at cindex mFlash Configuration
- at b{mflash bank} <@var{soc}> <@var{base}> <@var{RST pin}> <@var{target}>
- at cindex mflash bank
-@*Configures a mflash for <@var{soc}> host bank at
-<@var{base}>. Pin number format is dependent on host GPIO calling convention.
-Currently, mflash bank support s3c2440 and pxa270.
+ at deffn {Flash Driver} str7x
+All members of the STR7 microcontroller family from ST Microelectronics
+include internal flash and use ARM7TDMI cores.
+The @var{str7x} driver defines one mandatory parameter, @var{variant},
+which is either @code{STR71x}, @code{STR73x} or @code{STR75x}.
 
-(ex. of s3c2440) mflash <@var{RST pin}> is GPIO B1.
 @example
-mflash bank s3c2440 0x10000000 1b 0
+flash bank str7x 0x40000000 0x00040000 0 0 $_TARGETNAME STR71x
 @end example
-(ex. of pxa270) mflash <@var{RST pin}> is GPIO 43.
+ at end deffn
+
+ at deffn {Flash Driver} str9x
+Most members of the STR9 microcontroller family from ST Microelectronics
+include internal flash and use ARM966E cores.
+The str9 needs the flash controller to be configured using
+the @command{str9x flash_config} command prior to Flash programming.
+
 @example
-mflash bank pxa270 0x08000000 43 0  
+flash bank str9x 0x40000000 0x00040000 0 0 $_TARGETNAME
+str9x flash_config 0 4 2 0 0x80000
 @end example
 
- at section Microcontroller specific Flash Commands
+ at deffn Command {str9x flash_config} num bbsr nbbsr bbadr nbbadr
+Configures the str9 flash controller.
+The @var{num} parameter is a value shown by @command{flash banks}.
 
- at subsection AT91SAM7 specific commands
- at cindex AT91SAM7 specific commands
-The flash configuration is deduced from the chip identification register. The flash
-controller handles erases automatically on a page (128/265 byte) basis, so erase is
-not necessary for flash programming. AT91SAM7 processors with less than 512K flash
-only have a single flash bank embedded on chip. AT91SAM7xx512 have two flash planes
-that can be erased separatly. Only an EraseAll command is supported by the controller
-for each flash plane and this is called with
 @itemize @bullet
- at item @b{flash erase} <@var{num}> @var{first_plane} @var{last_plane}
-@*bulk erase flash planes first_plane to last_plane. 
- at item @b{at91sam7 gpnvm} <@var{num}> <@var{bit}> <@option{set}|@option{clear}>
- at cindex at91sam7 gpnvm
-@*set or clear a gpnvm bit for the processor 
+ at item @var{bbsr} - Boot Bank Size register
+ at item @var{nbbsr} - Non Boot Bank Size register
+ at item @var{bbadr} - Boot Bank Start Address register
+ at item @var{nbbadr} - Boot Bank Start Address register
 @end itemize
+ at end deffn
 
- at subsection STR9 specific commands
- at cindex STR9 specific commands
- at anchor{STR9 specific commands}
-These are flash specific commands when using the str9xpec driver.
- at itemize @bullet
- at item @b{str9xpec enable_turbo} <@var{num}>
- at cindex str9xpec enable_turbo
-@*enable turbo mode, will simply remove the str9 from the chain and talk
-directly to the embedded flash controller. 
- at item @b{str9xpec disable_turbo} <@var{num}>
- at cindex str9xpec disable_turbo
-@*restore the str9 into JTAG chain. 
- at item @b{str9xpec lock} <@var{num}>
- at cindex str9xpec lock
-@*lock str9 device. The str9 will only respond to an unlock command that will
-erase the device. 
- at item @b{str9xpec unlock} <@var{num}>
- at cindex str9xpec unlock
-@*unlock str9 device. 
- at item @b{str9xpec options_read} <@var{num}>
- at cindex str9xpec options_read
-@*read str9 option bytes. 
- at item @b{str9xpec options_write} <@var{num}>
- at cindex str9xpec options_write
-@*write str9 option bytes. 
- at end itemize
+ at end deffn
 
-Note: Before using the str9xpec driver here is some background info to help
-you better understand how the drivers works. OpenOCD has two flash drivers for
-the str9.
+ at subsection str9xpec driver
+ at cindex str9xpec
+
+Here is some background info to help
+you better understand how this driver works. OpenOCD has two flash drivers for
+the str9:
 @enumerate
 @item
 Standard driver @option{str9x} programmed via the str9 core. Normally used for
@@ -2630,25 +2691,45 @@
 has been locked. Halting the core is not required for the @option{str9xpec} driver
 as mentioned above, just issue the commands above manually or from a telnet prompt.
 
- at subsection STR9 configuration
- at cindex STR9 configuration
+ at subsubsection str9xpec driver options
+
+ at b{flash bank str9xpec} <@var{base}> <@var{size}> 0 0 <@var{target}>
+@*Before using the flash commands the turbo mode must be enabled using str9xpec
+ at option{enable_turbo} <@var{num>.}
+
+Only use this driver for locking/unlocking the device or configuring the option bytes.
+Use the standard str9 driver for programming.
+
+ at subsubsection str9xpec specific commands
+ at cindex str9xpec specific commands
+These are flash specific commands when using the str9xpec driver.
+
 @itemize @bullet
- at item @b{str9x flash_config} <@var{bank}> <@var{BBSR}> <@var{NBBSR}>
-<@var{BBADR}> <@var{NBBADR}>
- at cindex str9x flash_config
-@*Configure str9 flash controller.
- at example
-e.g. str9x flash_config 0 4 2 0 0x80000
-This will setup
-BBSR - Boot Bank Size register
-NBBSR - Non Boot Bank Size register
-BBADR - Boot Bank Start Address register
-NBBADR - Boot Bank Start Address register
- at end example
+ at item @b{str9xpec enable_turbo} <@var{num}>
+ at cindex str9xpec enable_turbo
+@*enable turbo mode, will simply remove the str9 from the chain and talk
+directly to the embedded flash controller.
+ at item @b{str9xpec disable_turbo} <@var{num}>
+ at cindex str9xpec disable_turbo
+@*restore the str9 into JTAG chain.
+ at item @b{str9xpec lock} <@var{num}>
+ at cindex str9xpec lock
+@*lock str9 device. The str9 will only respond to an unlock command that will
+erase the device.
+ at item @b{str9xpec unlock} <@var{num}>
+ at cindex str9xpec unlock
+@*unlock str9 device.
+ at item @b{str9xpec options_read} <@var{num}>
+ at cindex str9xpec options_read
+@*read str9 option bytes.
+ at item @b{str9xpec options_write} <@var{num}>
+ at cindex str9xpec options_write
+@*write str9 option bytes.
 @end itemize
 
- at subsection STR9 option byte configuration
+ at subsubsection STR9 option byte configuration
 @cindex STR9 option byte configuration
+
 @itemize @bullet
 @item @b{str9xpec options_cmap} <@var{num}> <@option{bank0}|@option{bank1}>
 @cindex str9xpec options_cmap
@@ -2664,37 +2745,57 @@
 @*configure str9 lvd reset warning source. 
 @end itemize
 
- at subsection STM32x specific commands
- at cindex STM32x specific commands
- 
-These are flash specific commands when using the stm32x driver.
- at itemize @bullet
- at item @b{stm32x lock} <@var{num}>
- at cindex stm32x lock
-@*lock stm32 device. 
- at item @b{stm32x unlock} <@var{num}>
- at cindex stm32x unlock
-@*unlock stm32 device. 
- at item @b{stm32x options_read} <@var{num}>
- at cindex stm32x options_read
-@*read stm32 option bytes. 
- at item @b{stm32x options_write} <@var{num}> <@option{SWWDG}|@option{HWWDG}>
-<@option{RSTSTNDBY}|@option{NORSTSTNDBY}> <@option{RSTSTOP}|@option{NORSTSTOP}>
- at cindex stm32x options_write
-@*write stm32 option bytes. 
- at item @b{stm32x mass_erase} <@var{num}>
- at cindex stm32x mass_erase
-@*mass erase flash memory. 
- at end itemize
+ at section mFlash
 
- at subsection Stellaris specific commands
- at cindex Stellaris specific commands
- 
-These are flash specific commands when using the Stellaris driver.
+ at subsection mFlash Configuration
+ at cindex mFlash Configuration
+ at b{mflash bank} <@var{soc}> <@var{base}> <@var{RST pin}> <@var{target}>
+ at cindex mflash bank
+@*Configures a mflash for <@var{soc}> host bank at
+<@var{base}>. Pin number format is dependent on host GPIO calling convention.
+Currently, mflash bank support s3c2440 and pxa270.
+
+(ex. of s3c2440) mflash <@var{RST pin}> is GPIO B1.
+
+ at example
+mflash bank s3c2440 0x10000000 1b 0
+ at end example
+
+(ex. of pxa270) mflash <@var{RST pin}> is GPIO 43.
+
+ at example
+mflash bank pxa270 0x08000000 43 0
+ at end example
+
+ at subsection mFlash commands
+ at cindex mFlash commands
+
 @itemize @bullet
- at item @b{stellaris mass_erase} <@var{num}>
- at cindex stellaris mass_erase
-@*mass erase flash memory. 
+ at item @b{mflash probe}
+ at cindex mflash probe
+@*Probe mflash.
+ at item @b{mflash write} <@var{num}> <@var{file}> <@var{offset}>
+ at cindex mflash write
+@*Write the binary <@var{file}> to mflash bank <@var{num}>, starting at
+<@var{offset}> bytes from the beginning of the bank.
+ at item @b{mflash dump} <@var{num}> <@var{file}> <@var{offset}> <@var{size}>
+ at cindex mflash dump
+@*Dump <size> bytes, starting at <@var{offset}> bytes from the beginning of the <@var{num}> bank
+to a <@var{file}>.
+ at item @b{mflash config pll} <@var{frequency}>
+ at cindex mflash config pll
+@*Configure mflash pll. <@var{frequency}> is input frequency of mflash. The order is Hz.
+Issuing this command will erase mflash's whole internal nand and write new pll.
+After this command, mflash needs power-on-reset for normal operation.
+If pll was newly configured, storage and boot(optional) info also need to be update.
+ at item @b{mflash config boot}
+ at cindex mflash config boot
+@*Configure bootable option. If bootable option is set, mflash offer the first 8 sectors
+(4kB) for boot.
+ at item @b{mflash config storage}
+ at cindex mflash config storage
+@*Configure storage information. For the normal storage operation, this information must be
+written.
 @end itemize
 
 @node NAND Flash Commands
@@ -2782,7 +2883,7 @@
 configuration files, not interactively.
 
 @itemize @bullet
- at item @var{controller} ... identifies a the controller driver
+ at item @var{controller} ... identifies the controller driver
 associated with the NAND device being declared.
 @xref{NAND Driver List}.
 @item @var{target} ... names the target used when issuing
@@ -2849,6 +2950,7 @@
 
 @deffn Command {nand erase} num offset length
 @cindex NAND erasing
+ at cindex NAND programming
 Erases blocks on the specified NAND device, starting at the
 specified @var{offset} and continuing for @var{length} bytes.
 Both of those values must be exact multiples of the device's
@@ -2864,6 +2966,7 @@
 
 @deffn Command {nand write} num filename offset [option...]
 @cindex NAND writing
+ at cindex NAND programming
 Writes binary data from the file into the specified NAND device,
 starting at the specified offset.  Those pages should already
 have been erased; you can't change zero bits to one bits.
@@ -2963,7 +3066,7 @@
 with the wrong ECC data can cause them to be marked as bad.
 @end deffn
 
- at section NAND Drivers; Driver-specific Options and Commands
+ at section NAND Drivers, Options, and Commands
 @anchor{NAND Driver List}
 As noted above, the @command{nand device} command allows
 driver-specific options and behaviors.
@@ -2989,7 +3092,7 @@
 @deffn {NAND Driver} lpc3180
 These controllers require an extra @command{nand device}
 parameter:  the clock rate used by the controller.
- at deffn Command {nand lpc3180 select} num [mlc|slc]
+ at deffn Command {lpc3180 select} num [mlc|slc]
 Configures use of the MLC or SLC controller mode.
 MLC implies use of hardware ECC.
 The @var{num} parameter is the value shown by @command{nand list}.
@@ -3014,7 +3117,10 @@
 change any behavior.
 @end deffn
 
- at deffn {NAND Driver} {s3c2410, s3c2412, s3c2440, s3c2443}
+ at deffn {NAND Driver} s3c2410
+ at deffnx {NAND Driver} s3c2412
+ at deffnx {NAND Driver} s3c2440
+ at deffnx {NAND Driver} s3c2443
 These S3C24xx family controllers don't have any special
 @command{nand device} options, and don't define any
 specialized commands.
@@ -3273,7 +3379,6 @@
 @cindex Target Specific Commands
 
 
- at page
 @section Architecture Specific Commands
 @cindex Architecture Specific Commands
 
@@ -4503,8 +4608,8 @@
 
 @printindex cp
 
- at node OpenOCD Command Index
- at unnumbered OpenOCD Command Index
+ at node Command and Driver Index
+ at unnumbered Command and Driver Index
 @printindex fn
 
 @bye



From zwelch at mail.berlios.de  Thu May 28 03:18:51 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 28 May 2009 03:18:51 +0200
Subject: [Openocd-svn] r1938 - trunk/doc
Message-ID: <200905280118.n4S1IpWr029657@sheep.berlios.de>

Author: zwelch
Date: 2009-05-28 03:18:47 +0200 (Thu, 28 May 2009)
New Revision: 1938

Modified:
   trunk/doc/openocd.texi
Log:
David Brownell <david-b at pacbell.net>:

Continue updating the NOR flash coverage to use @deffn syntax, so the
commands have more consistent presentation and formatting.  This
reorganizes information and updates its presentation, except where
the information didn't really match the code.

This patch updates the main commands, and finishes making the section
structure parallel the NAND presentation.  Of note:

 - The "flash fill[whb] addr value length" commands are now documented.

 - The "flash bank" command is now presented much earlier

 - Explicit mention is made that NOR flash should be read using just
   standard memory access commands, like "mdw" and "dump_image".



Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-28 01:11:10 UTC (rev 1937)
+++ trunk/doc/openocd.texi	2009-05-28 01:18:47 UTC (rev 1938)
@@ -64,7 +64,7 @@
 * Reset Configuration::              Reset Configuration
 * Tap Creation::                     Tap Creation
 * Target Configuration::             Target Configuration
-* Flash Configuration::              Flash Configuration
+* Flash Commands::                   Flash Commands
 * NAND Flash Commands::              NAND Flash Commands
 * General Commands::                 General Commands
 * JTAG Commands::                    JTAG Commands
@@ -2305,9 +2305,8 @@
 @end example
 @* The target# is a the 0 based target numerical index.
 
- at node Flash Configuration
- at chapter Flash programming
- at cindex Flash Configuration
+ at node Flash Commands
+ at chapter Flash Commands
 
 OpenOCD has different commands for NOR and NAND flash;
 the ``flash'' command works with NOR flash, while
@@ -2319,95 +2318,36 @@
 However, the documentation also uses ``flash'' as a generic term;
 for example, ``Put flash configuration in board-specific files''.
 
- at b{Note:} As of 28/nov/2008 OpenOCD does not know how to program a SPI
+ at quotation Note
+As of 28-nov-2008 OpenOCD does not know how to program a SPI
 flash that a micro may boot from. Perhaps you, the reader, would like to
 contribute support for this.
+ at end quotation
 
 Flash Steps:
 @enumerate
- at item Configure via the command @b{flash bank} 
-@* Normally this is done in a configuration file.
- at item Operate on the flash via @b{flash SOMECOMMAND}
+ at item Configure via the command @command{flash bank}
+@* Do this in a board-specific configuration file,
+passing parameters as needed by the driver.
+ at item Operate on the flash via @command{flash subcommand}
 @* Often commands to manipulate the flash are typed by a human, or run
-via a script in some automated way. For example: To program the boot
-flash on your board.
+via a script in some automated way.  Common tasks include writing a
+boot loader, operating system, or other data.
 @item GDB Flashing
 @* Flashing via GDB requires the flash be configured via ``flash
 bank'', and the GDB flash features be enabled.
 @xref{GDB Configuration}.
 @end enumerate
 
- at section Flash commands
- at cindex Flash commands
- at subsection flash banks
- at b{flash banks}
- at cindex flash banks
-@*List configured flash banks 
-@*@b{NOTE:} the singular form: 'flash bank' is used to configure the flash banks.
- at subsection flash info
- at b{flash info} <@var{num}>
- at cindex flash info
-@*Print info about flash bank <@option{num}> 
- at subsection flash probe
- at b{flash probe} <@var{num}>
- at cindex flash probe
-@*Identify the flash, or validate the parameters of the configured flash. Operation
-depends on the flash type. 
- at subsection flash erase_check
- at b{flash erase_check} <@var{num}>
- at cindex flash erase_check
-@*Check erase state of sectors in flash bank <@var{num}>. This is the only operation that
-updates the erase state information displayed by @option{flash info}. That means you have
-to issue an @option{erase_check} command after erasing or programming the device to get
-updated information. 
- at subsection flash protect_check
- at b{flash protect_check} <@var{num}>
- at cindex flash protect_check
-@*Check protection state of sectors in flash bank <num>. 
- at option{flash erase_sector} using the same syntax. 
- at subsection flash erase_sector
- at b{flash erase_sector} <@var{num}> <@var{first}> <@var{last}>
- at cindex flash erase_sector
- at anchor{flash erase_sector}
-@*Erase sectors at bank <@var{num}>, starting at sector <@var{first}> up to and including
-<@var{last}>. Sector numbering starts at 0. Depending on the flash type, erasing may
-require the protection to be disabled first (e.g. Intel Advanced Bootblock flash using
-the CFI driver).
- at subsection flash erase_address
- at b{flash erase_address} <@var{address}> <@var{length}>
- at cindex flash erase_address
-@*Erase sectors starting at <@var{address}> for <@var{length}> bytes
- at subsection flash write_bank
- at b{flash write_bank} <@var{num}> <@var{file}> <@var{offset}>
- at cindex flash write_bank
- at anchor{flash write_bank}
-@*Write the binary <@var{file}> to flash bank <@var{num}>, starting at
-<@option{offset}> bytes from the beginning of the bank.
- at subsection flash write_image
- at b{flash write_image} [@var{erase}] <@var{file}> [@var{offset}] [@var{type}]
- at cindex flash write_image
- at anchor{flash write_image}
-@*Write the image <@var{file}> to the current target's flash bank(s). A relocation
-[@var{offset}] can be specified and the file [@var{type}] can be specified
-explicitly as @option{bin} (binary), @option{ihex} (Intel hex), @option{elf}
-(ELF file) or @option{s19} (Motorola s19). Flash memory will be erased prior to programming
-if the @option{erase} parameter is given.
- at subsection flash protect
- at b{flash protect} <@var{num}> <@var{first}> <@var{last}> <@option{on}|@option{off}>
- at cindex flash protect
-@*Enable (@var{on}) or disable (@var{off}) protection of flash sectors <@var{first}> to
-<@var{last}> of @option{flash bank} <@var{num}>.
+Many CPUs have the ablity to ``boot'' from the first flash bank.
+This means that misprograming that bank can ``brick'' a system,
+so that it can't boot.
+JTAG tools, like OpenOCD, are often then used to ``de-brick'' the
+board by (re)installing working boot firmware.
 
- at section flash bank command
-The @command{flash bank} command is used to configure one or more flash
-chips (or @emph{banks} in OpenOCD terms).
-Most CPUs have the ablity to ``boot'' from the first flash bank.
+ at section Flash Configuration Commands
+ at cindex flash configuration
 
- at quotation Note
-This command is not available after OpenOCD initialization has completed.
-Use it in board specific configuration files, not interactively.
- at end quotation
-
 @deffn {Config Command} {flash bank} driver base size chip_width bus_width target [driver_options]
 Configures a flash bank which provides persistent storage
 for addresses from @math{base} to @math{base + size - 1}.
@@ -2435,8 +2375,154 @@
 additional parameters.  See the driver-specific documentation
 for more information.
 @end itemize
+ at quotation Note
+This command is not available after OpenOCD initialization has completed.
+Use it in board specific configuration files, not interactively.
+ at end quotation
 @end deffn
 
+ at comment the REAL name for this command is "ocd_flash_banks"
+ at comment less confusing would be:  "flash list" (like "nand list")
+ at deffn Command {flash banks}
+Prints a one-line summary of each device declared
+using @command{flash bank}, numbered from zero.
+Note that this is the @emph{plural} form;
+the @emph{singular} form is a very different command.
+ at end deffn
+
+ at deffn Command {flash probe} num
+Identify the flash, or validate the parameters of the configured flash. Operation
+depends on the flash type.
+The @var{num} parameter is a value shown by @command{flash banks}.
+Most flash commands will implicitly @emph{autoprobe} the bank;
+flash drivers can distinguish between probing and autoprobing,
+but most don't bother.
+ at end deffn
+
+ at section Erasing, Reading, Writing to Flash
+ at cindex flash erasing
+ at cindex flash reading
+ at cindex flash writing
+ at cindex flash programming
+
+One feature distinguishing NOR flash from NAND or serial flash technologies
+is that for read access, it acts exactly like any other addressible memory.
+This means you can use normal memory read commands like @command{mdw} or
+ at command{dump_image} with it, with no special @command{flash} subcommands.
+ at xref{Memory access}.
+ at xref{Image access}.
+
+Write access works differently.  Flash memory normally needs to be erased
+before it's written.  Erasing a sector turns all of its bits to ones, and
+writing can turn ones into zeroes.  This is why there are special commands
+for interactive erasing and writing, and why GDB needs to know which parts
+of the address space hold NOR flash memory.
+
+ at quotation Note
+Most of these erase and write commands leverage the fact that NOR flash
+chips consume target address space.  They implicitly refer to the current
+JTAG target, and map from an address in that target's address space
+back to a flash bank.
+ at comment In May 2009, those mappings may fail if any bank associated
+ at comment with that target doesn't succesfuly autoprobe ... bug worth fixing?
+A few commands use abstract addressing based on bank and sector numbers,
+and don't depend on searching the current target and its address space.
+Avoid confusing the two command models.
+ at end quotation
+
+Some flash chips implement software protection against accidental writes,
+since such buggy writes could in some cases ``brick'' a system.
+For such systems, erasing and writing may require sector protection to be
+disabled first.
+Examples include CFI flash such as ``Intel Advanced Bootblock flash'',
+and AT91SAM7 on-chip flash.
+ at xref{flash protect}.
+
+ at anchor{flash erase_sector}
+ at deffn Command {flash erase_sector} num first last
+Erase sectors in bank @var{num}, starting at sector @var{first} up to and including
+ at var{last}. Sector numbering starts at 0.
+The @var{num} parameter is a value shown by @command{flash banks}.
+ at end deffn
+
+ at deffn Command {flash erase_address} address length
+Erase sectors starting at @var{address} for @var{length} bytes.
+The flash bank to use is inferred from the @var{address}, and
+the specified length must stay within that bank.
+As a special case, when @var{length} is zero and @var{address} is
+the start of the bank, the whole flash is erased.
+ at end deffn
+
+ at deffn Command {flash fillw} address word length
+ at deffnx Command {flash fillh} address halfword length
+ at deffnx Command {flash fillb} address byte length
+Fills flash memory with the specified @var{word} (32 bits),
+ at var{halfword} (16 bits), or @var{byte} (8-bit) pattern,
+starting at @var{address} and continuing
+for @var{length} units (word/halfword/byte).
+No erasure is done before writing; when needed, that must be done
+before issuing this command.
+Writes are done in blocks of up to 1024 bytes, and each write is
+verified by reading back the data and comparing it to what was written.
+The flash bank to use is inferred from the @var{address} of
+each block, and the specified length must stay within that bank.
+ at end deffn
+ at comment no current checks for errors if fill blocks touch multiple banks!
+
+ at anchor{flash write_bank}
+ at deffn Command {flash write_bank} num filename offset
+Write the binary @file{filename} to flash bank @var{num},
+starting at @var{offset} bytes from the beginning of the bank.
+The @var{num} parameter is a value shown by @command{flash banks}.
+ at end deffn
+
+ at anchor{flash write_image}
+ at deffn Command {flash write_image} [erase] filename [offset] [type]
+Write the image @file{filename} to the current target's flash bank(s).
+A relocation @var{offset} may be specified, in which case it is added
+to the base address for each section in the image.
+The file [@var{type}] can be specified
+explicitly as @option{bin} (binary), @option{ihex} (Intel hex), @option{elf}
+(ELF file) or @option{s19} (Motorola s19).
+The relevant flash sectors will be erased prior to programming
+if the @option{erase} parameter is given.
+The flash bank to use is inferred from the @var{address} of
+each image segment.
+ at end deffn
+
+ at section Other Flash commands
+ at cindex flash protection
+
+ at deffn Command {flash erase_check} num
+Check erase state of sectors in flash bank @var{num},
+and display that status.
+The @var{num} parameter is a value shown by @command{flash banks}.
+This is the only operation that
+updates the erase state information displayed by @option{flash info}. That means you have
+to issue an @command{flash erase_check} command after erasing or programming the device
+to get updated information.
+(Code execution may have invalidated any state records kept by OpenOCD.)
+ at end deffn
+
+ at deffn Command {flash info} num
+Print info about flash bank @var{num}
+The @var{num} parameter is a value shown by @command{flash banks}.
+The information includes per-sector protect status.
+ at end deffn
+
+ at anchor{flash protect}
+ at deffn Command {flash protect} num first last (on|off)
+Enable (@var{on}) or disable (@var{off}) protection of flash sectors
+ at var{first} to @var{last} of flash bank @var{num}.
+The @var{num} parameter is a value shown by @command{flash banks}.
+ at end deffn
+
+ at deffn Command {flash protect_check} num
+Check protection state of sectors in flash bank @var{num}.
+The @var{num} parameter is a value shown by @command{flash banks}.
+ at comment @option{flash erase_sector} using the same syntax.
+ at end deffn
+
 @section Flash Drivers, Options, and Commands
 @anchor{Flash Driver List}
 As noted above, the @command{flash bank} command requires a driver name,
@@ -3279,6 +3365,7 @@
 
 
 @section Memory access commands
+ at anchor{Memory access}
 @subsection meminfo
 display available RAM memory.
 @subsection Memory peek/poke type commands
@@ -3314,6 +3401,7 @@
 @end itemize
 
 @section Image loading commands
+ at anchor{Image access}
 @subsection load_image
 @b{load_image} <@var{file}> <@var{address}> [@option{bin}|@option{ihex}|@option{elf}]
 @cindex load_image



From zwelch at mail.berlios.de  Fri May 29 01:13:37 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 29 May 2009 01:13:37 +0200
Subject: [Openocd-svn] r1939 - trunk/doc
Message-ID: <200905282313.n4SNDbh0002604@sheep.berlios.de>

Author: zwelch
Date: 2009-05-29 01:13:32 +0200 (Fri, 29 May 2009)
New Revision: 1939

Modified:
   trunk/doc/openocd.texi
Log:
David Brownell <david-b at pacbell.net>:

Start converting the architecture-specific commands to @deffn format,
reviewing against the code.

  * armv4_5 disassemble ... now documented; although Jazelle code
    is not handled

  * It's "armv4_5 core_state" not "core_mode"; although Jazelle state
    is not handled

  * arm7/9 "debug" commands ... now with other arm7_9 commands, no
    longer in a separate section

  * arm926ejs cp15 ... previous description was broken, it matched
    the code for arm920t instead

  * Have separate subsections for ARMv4/ARMv5, ARMv6, and ARMv7; the
    latter are new
    
  * Move core-specific descriptions into sub-subsections under those
    architectures; XScale and ARM11 descriptions are new

The new XScale and ARM11 command descriptions surely need elaboration
and review.  ARM CP15 operation descriptions in general seem to be
confused and incomplete.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-28 01:18:47 UTC (rev 1938)
+++ trunk/doc/openocd.texi	2009-05-28 23:13:32 UTC (rev 1939)
@@ -2482,8 +2482,9 @@
 A relocation @var{offset} may be specified, in which case it is added
 to the base address for each section in the image.
 The file [@var{type}] can be specified
-explicitly as @option{bin} (binary), @option{ihex} (Intel hex), @option{elf}
-(ELF file) or @option{s19} (Motorola s19).
+explicitly as @option{bin} (binary), @option{ihex} (Intel hex),
+ at option{elf} (ELF file), @option{s19} (Motorola s19).
+ at option{mem}, or @option{builder}.
 The relevant flash sectors will be erased prior to programming
 if the @option{erase} parameter is given.
 The flash bank to use is inferred from the @var{address} of
@@ -3463,189 +3464,404 @@
 
 @end itemize
 
- at section Target Specific Commands
- at cindex Target Specific Commands
+ at section Architecture and Core Specific Commands
+ at cindex Architecture Specific Commands
+ at cindex Core Specific Commands
 
+Most CPUs have specialized JTAG operations to support debugging.
+OpenOCD packages most such operations in its standard command framework.
+Some of those operations don't fit well in that framework, so they are
+exposed here using architecture or implementation specific commands.
 
- at section Architecture Specific Commands
- at cindex Architecture Specific Commands
+ at subsection ARMv4 and ARMv5 Architecture
+ at cindex ARMv4 specific commands
+ at cindex ARMv5 specific commands
 
- at subsection ARMV4/5 specific commands
- at cindex ARMV4/5 specific commands
+These commands are specific to ARM architecture v4 and v5,
+including all ARM7 or ARM9 systems and Intel XScale.
+They are available in addition to other core-specific
+commands that may be available.
 
-These commands are specific to ARM architecture v4 and v5, like all ARM7/9 systems
-or Intel XScale (XScale isn't supported yet).
- at itemize @bullet
- at item @b{armv4_5 reg}
- at cindex armv4_5 reg
-@*Display a list of all banked core registers, fetching the current value from every
+ at deffn Command {armv4_5 core_state} [arm|thumb]
+Displays the core_state, optionally changing it to process
+either @option{arm} or @option{thumb} instructions.
+The target may later be resumed in the currently set core_state.
+(Processors may also support the Jazelle state, but
+that is not currently supported in OpenOCD.)
+ at end deffn
+
+ at deffn Command {armv4_5 disassemble} address count [thumb]
+ at cindex disassemble
+Disassembles @var{count} instructions starting at @var{address}.
+If @option{thumb} is specified, Thumb (16-bit) instructions are used;
+else ARM (32-bit) instructions are used.
+(Processors may also support the Jazelle state, but
+those instructions are not currently understood by OpenOCD.)
+ at end deffn
+
+ at deffn Command {armv4_5 reg}
+Display a list of all banked core registers, fetching the current value from every
 core mode if necessary. OpenOCD versions before rev. 60 didn't fetch the current
 register value. 
- at item @b{armv4_5 core_mode} [@var{arm}|@var{thumb}]
- at cindex armv4_5 core_mode
-@*Displays the core_mode, optionally changing it to either ARM or Thumb mode.
-The target is resumed in the currently set @option{core_mode}. 
- at end itemize
+ at end deffn
 
- at subsection ARM7/9 specific commands
- at cindex ARM7/9 specific commands
+ at subsubsection ARM7 and ARM9 specific commands
+ at cindex ARM7 specific commands
+ at cindex ARM9 specific commands
 
-These commands are specific to ARM7 and ARM9 targets, like ARM7TDMI, ARM720t,
-ARM920T or ARM926EJ-S.
- at itemize @bullet
- at item @b{arm7_9 dbgrq} <@var{enable}|@var{disable}>
- at cindex arm7_9 dbgrq
-@*Enable use of the DBGRQ bit to force entry into debug mode. This should be
+These commands are specific to ARM7 and ARM9 cores, like ARM7TDMI, ARM720T,
+ARM9TDMI, ARM920T or ARM926EJ-S.
+They are available in addition to the ARMv4/5 commands,
+and any other core-specific commands that may be available.
+
+ at deffn Command {arm7_9 dbgrq} (enable|disable)
+Control use of the EmbeddedIce DBGRQ signal to force entry into debug mode,
+instead of breakpoints.  This should be
 safe for all but ARM7TDMI--S cores (like Philips LPC). 
- at item @b{arm7_9 fast_memory_access} <@var{enable}|@var{disable}>
- at cindex arm7_9 fast_memory_access
+ at end deffn
+
+ at deffn Command {arm7_9 dcc_downloads} (enable|disable)
+ at cindex DCC
+Control the use of the debug communications channel (DCC) to write larger (>128 byte)
+amounts of memory. DCC downloads offer a huge speed increase, but might be
+unsafe, especially with targets running at very low speeds. This command was introduced
+with OpenOCD rev. 60, and requires a few bytes of working area.
+ at end deffn
+
 @anchor{arm7_9 fast_memory_access}
-@*Allow OpenOCD to read and write memory without checking completion of
+ at deffn Command {arm7_9 fast_memory_access} (enable|disable)
+Enable or disable memory writes and reads that don't check completion of
 the operation. This provides a huge speed increase, especially with USB JTAG
 cables (FT2232), but might be unsafe if used with targets running at very low
 speeds, like the 32kHz startup clock of an AT91RM9200. 
- at item @b{arm7_9 dcc_downloads} <@var{enable}|@var{disable}>
- at cindex arm7_9 dcc_downloads
-@*Enable the use of the debug communications channel (DCC) to write larger (>128 byte)
-amounts of memory. DCC downloads offer a huge speed increase, but might be potentially
-unsafe, especially with targets running at very low speeds. This command was introduced
-with OpenOCD rev. 60, and requires a few bytes of working area.
- at end itemize
+ at end deffn
 
- at subsection ARM720T specific commands
+ at deffn {Debug Command} {arm7_9 write_core_reg} num mode word
+ at emph{This is intended for use while debugging OpenOCD; you probably
+shouldn't use it.}
+
+Writes a 32-bit @var{word} to register @var{num} (from 0 to 16)
+as used in the specified @var{mode}
+(where e.g. mode 16 is "user" and mode 19 is "supervisor";
+the M4..M0 bits of the PSR).
+Registers 0..15 are the normal CPU registers such as r0(0), r1(1) ... pc(15).
+Register 16 is the mode-specific SPSR,
+unless the specified mode is 0xffffffff (32-bit all-ones)
+in which case register 16 is the CPSR.
+The write goes directly to the CPU, bypassing the register cache.
+ at end deffn
+
+ at deffn {Debug Command} {arm7_9 write_xpsr} word (0|1)
+ at emph{This is intended for use while debugging OpenOCD; you probably
+shouldn't use it.}
+
+If the second parameter is zero, writes @var{word} to the
+Current Program Status register (CPSR).
+Else writes @var{word} to the current mode's Saved PSR (SPSR).
+In both cases, this bypasses the register cache.
+ at end deffn
+
+ at deffn {Debug Command} {arm7_9 write_xpsr_im8} byte rotate (0|1)
+ at emph{This is intended for use while debugging OpenOCD; you probably
+shouldn't use it.}
+
+Writes eight bits to the CPSR or SPSR,
+first rotating them by @math{2*rotate} bits,
+and bypassing the register cache.
+This has lower JTAG overhead than writing the entire CPSR or SPSR
+with @command{arm7_9 write_xpsr}.
+ at end deffn
+
+ at subsubsection ARM720T specific commands
 @cindex ARM720T specific commands
 
- at itemize @bullet
- at item @b{arm720t cp15} <@var{num}> [@var{value}]
- at cindex arm720t cp15
-@*display/modify cp15 register <@option{num}> [@option{value}].
- at item @b{arm720t md<bhw>_phys} <@var{addr}> [@var{count}]
- at cindex arm720t md<bhw>_phys
-@*Display memory at physical address addr. 
- at item @b{arm720t mw<bhw>_phys} <@var{addr}> <@var{value}>
- at cindex arm720t mw<bhw>_phys
-@*Write memory at physical address addr.
- at item @b{arm720t virt2phys} <@var{va}>
- at cindex arm720t virt2phys
-@*Translate a virtual address to a physical address. 
- at end itemize
+These commands are available to ARM720T based CPUs,
+which are implementations of the ARMv4T architecture
+based on the ARM7TDMI-S integer core.
+They are available in addition to the ARMv4/5 and ARM7/ARM9 commands.
 
- at subsection ARM9TDMI specific commands
+ at deffn Command {arm720t cp15} regnum [value]
+Display cp15 register @var{regnum};
+else if a @var{value} is provided, that value is written to that register.
+ at end deffn
+
+ at deffn Command {arm720t mdw_phys} addr [count]
+ at deffnx Command {arm720t mdh_phys} addr [count]
+ at deffnx Command {arm720t mdb_phys} addr [count]
+Display contents of physical address @var{addr}, as
+32-bit words (@command{mdw_phys}), 16-bit halfwords (@command{mdh_phys}),
+or 8-bit bytes (@command{mdb_phys}).
+If @var{count} is specified, displays that many units.
+ at end deffn
+
+ at deffn Command {arm720t mww_phys} addr word
+ at deffnx Command {arm720t mwh_phys} addr halfword
+ at deffnx Command {arm720t mwb_phys} addr byte
+Writes the specified @var{word} (32 bits),
+ at var{halfword} (16 bits), or @var{byte} (8-bit) pattern,
+at the specified physical address @var{addr}.
+ at end deffn
+
+ at deffn Command {arm720t virt2phys} va
+Translate a virtual address @var{va} to a physical address
+and display the result.
+ at end deffn
+
+ at subsubsection ARM9TDMI specific commands
 @cindex ARM9TDMI specific commands
 
- at itemize @bullet
- at item @b{arm9tdmi vector_catch} <@var{all}|@var{none}>
- at cindex arm9tdmi vector_catch
-@*Catch arm9 interrupt vectors, can be @option{all} @option{none} or any of the following:
+Many ARM9-family CPUs are built around ARM9TDMI integer cores,
+or processors resembling ARM9TDMI, and can use these commands.
+Such cores include the ARM920T, ARM926EJ-S, and ARM966.
+
+ at deffn Command {arm9tdmi vector_catch} (all|none|list)
+Catch arm9 interrupt vectors, can be @option{all}, @option{none},
+or a list with one or more of the following:
 @option{reset} @option{undef} @option{swi} @option{pabt} @option{dabt} @option{reserved}
 @option{irq} @option{fiq}.
+ at end deffn
 
-Can also be used on other ARM9 based cores such as ARM966, ARM920T and ARM926EJ-S.
- at end itemize
+ at subsubsection ARM920T specific commands
+ at cindex ARM920T specific commands
 
- at subsection ARM966E specific commands
- at cindex ARM966E specific commands
+These commands are available to ARM920T based CPUs,
+which are implementations of the ARMv4T architecture
+built using the ARM9TDMI integer core.
+They are available in addition to the ARMv4/5, ARM7/ARM9,
+and ARM9TDMI commands.
 
- at itemize @bullet
- at item @b{arm966e cp15} <@var{num}> [@var{value}]
- at cindex arm966e cp15
-@*display/modify cp15 register <@option{num}> [@option{value}].
- at end itemize
+ at deffn Command {arm920t cache_info}
+Print information about the caches found. This allows to see whether your target
+is an ARM920T (2x16kByte cache) or ARM922T (2x8kByte cache).
+ at end deffn
 
- at subsection ARM920T specific commands
- at cindex ARM920T specific commands
+ at deffn Command {arm920t cp15} regnum [value]
+Display cp15 register @var{regnum};
+else if a @var{value} is provided, that value is written to that register.
+ at end deffn
 
- at itemize @bullet
- at item @b{arm920t cp15} <@var{num}> [@var{value}]
- at cindex arm920t cp15
-@*display/modify cp15 register <@option{num}> [@option{value}].
- at item @b{arm920t cp15i} <@var{num}> [@var{value}] [@var{address}]
- at cindex arm920t cp15i
-@*display/modify cp15 (interpreted access) <@option{opcode}> [@option{value}] [@option{address}]
- at item @b{arm920t cache_info}
- at cindex arm920t cache_info
-@*Print information about the caches found. This allows to see whether your target
-is an ARM920T (2x16kByte cache) or ARM922T (2x8kByte cache). 
- at item @b{arm920t md<bhw>_phys} <@var{addr}> [@var{count}]
- at cindex arm920t md<bhw>_phys
-@*Display memory at physical address addr. 
- at item @b{arm920t mw<bhw>_phys} <@var{addr}> <@var{value}>
- at cindex arm920t mw<bhw>_phys
-@*Write memory at physical address addr. 
- at item @b{arm920t read_cache} <@var{filename}>
- at cindex arm920t read_cache
-@*Dump the content of ICache and DCache to a file. 
- at item @b{arm920t read_mmu} <@var{filename}>
- at cindex arm920t read_mmu
-@*Dump the content of the ITLB and DTLB to a file. 
- at item @b{arm920t virt2phys} <@var{va}>
- at cindex arm920t virt2phys
-@*Translate a virtual address to a physical address. 
- at end itemize
+ at deffn Command {arm920t cp15i} opcode [value [address]]
+Interpreted access using cp15 @var{opcode}.
+If no @var{value} is provided, the result is displayed.
+Else if that value is written using the specified @var{address},
+or using zero if no other address is not provided.
+ at end deffn
 
- at subsection ARM926EJ-S specific commands
+ at deffn Command {arm920t mdw_phys} addr [count]
+ at deffnx Command {arm920t mdh_phys} addr [count]
+ at deffnx Command {arm920t mdb_phys} addr [count]
+Display contents of physical address @var{addr}, as
+32-bit words (@command{mdw_phys}), 16-bit halfwords (@command{mdh_phys}),
+or 8-bit bytes (@command{mdb_phys}).
+If @var{count} is specified, displays that many units.
+ at end deffn
+
+ at deffn Command {arm920t mww_phys} addr word
+ at deffnx Command {arm920t mwh_phys} addr halfword
+ at deffnx Command {arm920t mwb_phys} addr byte
+Writes the specified @var{word} (32 bits),
+ at var{halfword} (16 bits), or @var{byte} (8-bit) pattern,
+at the specified physical address @var{addr}.
+ at end deffn
+
+ at deffn Command {arm920t read_cache} filename
+Dump the content of ICache and DCache to a file named @file{filename}.
+ at end deffn
+
+ at deffn Command {arm920t read_mmu} filename
+Dump the content of the ITLB and DTLB to a file named @file{filename}.
+ at end deffn
+
+ at deffn Command {arm920t virt2phys} @var{va}
+Translate a virtual address @var{va} to a physical address
+and display the result.
+ at end deffn
+
+ at subsubsection ARM926EJ-S specific commands
 @cindex ARM926EJ-S specific commands
 
- at itemize @bullet
- at item @b{arm926ejs cp15} <@var{num}> [@var{value}]
- at cindex arm926ejs cp15
-@*display/modify cp15 register <@option{num}> [@option{value}].
- at item @b{arm926ejs cache_info}
- at cindex arm926ejs cache_info
-@*Print information about the caches found.
- at item @b{arm926ejs md<bhw>_phys} <@var{addr}> [@var{count}]
- at cindex arm926ejs md<bhw>_phys
-@*Display memory at physical address addr. 
- at item @b{arm926ejs mw<bhw>_phys} <@var{addr}> <@var{value}>
- at cindex arm926ejs mw<bhw>_phys
-@*Write memory at physical address addr. 
- at item @b{arm926ejs virt2phys} <@var{va}>
- at cindex arm926ejs virt2phys
-@*Translate a virtual address to a physical address. 
- at end itemize
+These commands are available to ARM926EJ-S based CPUs,
+which are implementations of the ARMv5TEJ architecture
+based on the ARM9EJ-S integer core.
+They are available in addition to the ARMv4/5, ARM7/ARM9,
+and ARM9TDMI commands.
 
- at subsection CORTEX_M3 specific commands
- at cindex CORTEX_M3 specific commands
+ at deffn Command {arm926ejs cache_info}
+Print information about the caches found.
+ at end deffn
 
- at itemize @bullet
- at item @b{cortex_m3 maskisr} <@var{on}|@var{off}>
- at cindex cortex_m3 maskisr
-@*Enable masking (disabling) interrupts during target step/resume.
- at end itemize
+ at deffn Command {arm926ejs cp15} opcode1 opcode2 CRn CRm regnum [value]
+Accesses cp15 register @var{regnum} using
+ at var{opcode1}, @var{opcode2}, @var{CRn}, and @var{CRm}.
+If a @var{value} is provided, that value is written to that register.
+Else that register is read and displayed.
+ at end deffn
 
- at page
- at section Debug commands
- at cindex Debug commands
-The following commands give direct access to the core, and are most likely
-only useful while debugging OpenOCD.
- at itemize @bullet
- at item @b{arm7_9 write_xpsr} <@var{32-bit value}> <@option{0=cpsr}, @option{1=spsr}>
- at cindex arm7_9 write_xpsr
-@*Immediately write either the current program status register (CPSR) or the saved
-program status register (SPSR), without changing the register cache (as displayed
-by the @option{reg} and @option{armv4_5 reg} commands). 
- at item @b{arm7_9 write_xpsr_im8} <@var{8-bit value}> <@var{rotate 4-bit}>
-<@var{0=cpsr}, at var{1=spsr}>
- at cindex arm7_9 write_xpsr_im8
-@*Write the 8-bit value rotated right by 2*rotate bits, using an immediate write
-operation (similar to @option{write_xpsr}). 
- at item @b{arm7_9 write_core_reg} <@var{num}> <@var{mode}> <@var{value}>
- at cindex arm7_9 write_core_reg
-@*Write a core register, without changing the register cache (as displayed by the
- at option{reg} and @option{armv4_5 reg} commands). The <@var{mode}> argument takes the
-encoding of the [M4:M0] bits of the PSR. 
- at end itemize
+ at deffn Command {arm926ejs mdw_phys} addr [count]
+ at deffnx Command {arm926ejs mdh_phys} addr [count]
+ at deffnx Command {arm926ejs mdb_phys} addr [count]
+Display contents of physical address @var{addr}, as
+32-bit words (@command{mdw_phys}), 16-bit halfwords (@command{mdh_phys}),
+or 8-bit bytes (@command{mdb_phys}).
+If @var{count} is specified, displays that many units.
+ at end deffn
 
- at section Target Requests
- at cindex Target Requests
-OpenOCD can handle certain target requests, currently debugmsg are only supported for arm7_9 and cortex_m3.
+ at deffn Command {arm926ejs mww_phys} addr word
+ at deffnx Command {arm926ejs mwh_phys} addr halfword
+ at deffnx Command {arm926ejs mwb_phys} addr byte
+Writes the specified @var{word} (32 bits),
+ at var{halfword} (16 bits), or @var{byte} (8-bit) pattern,
+at the specified physical address @var{addr}.
+ at end deffn
+
+ at deffn Command {arm926ejs virt2phys} @var{va}
+Translate a virtual address @var{va} to a physical address
+and display the result.
+ at end deffn
+
+ at subsubsection ARM966E specific commands
+ at cindex ARM966E specific commands
+
+These commands are available to ARM966 based CPUs,
+which are implementations of the ARMv5TE architecture.
+They are available in addition to the ARMv4/5, ARM7/ARM9,
+and ARM9TDMI commands.
+
+ at deffn Command {arm966e cp15} regnum [value]
+Display cp15 register @var{regnum};
+else if a @var{value} is provided, that value is written to that register.
+ at end deffn
+
+ at subsubsection XScale specific commands
+ at cindex XScale specific commands
+
+These commands are available to XScale based CPUs,
+which are implementations of the ARMv5TE architecture.
+
+ at deffn Command {xscale analyze_trace}
+Displays the contents of the trace buffer.
+ at end deffn
+
+ at deffn Command {xscale cache_clean_address} address
+Changes the address used when cleaning the data cache.
+ at end deffn
+
+ at deffn Command {xscale cache_info}
+Displays information about the CPU caches.
+ at end deffn
+
+ at deffn Command {xscale cp15} regnum [value]
+Display cp15 register @var{regnum};
+else if a @var{value} is provided, that value is written to that register.
+ at end deffn
+
+ at deffn Command {xscale debug_handler} target address
+Changes the address used for the specified target's debug handler.
+ at end deffn
+
+ at deffn Command {xscale dcache} (enable|disable)
+Enables or disable the CPU's data cache.
+ at end deffn
+
+ at deffn Command {xscale dump_trace} filename
+Dumps the raw contents of the trace buffer to @file{filename}.
+ at end deffn
+
+ at deffn Command {xscale icache} (enable|disable)
+Enables or disable the CPU's instruction cache.
+ at end deffn
+
+ at deffn Command {xscale mmu} (enable|disable)
+Enables or disable the CPU's memory management unit.
+ at end deffn
+
+ at deffn Command {xscale trace_buffer} (enable|disable) [fill [n] | wrap]
+Enables or disables the trace buffer,
+and controls how it is emptied.
+ at end deffn
+
+ at deffn Command {xscale trace_image} filename [offset [type]]
+Opens a trace image from @file{filename}, optionally rebasing
+its segment addresses by @var{offset}.
+The image @var{type} may be one of
+ at option{bin} (binary), @option{ihex} (Intel hex),
+ at option{elf} (ELF file), @option{s19} (Motorola s19),
+ at option{mem}, or @option{builder}.
+ at end deffn
+
+ at deffn Command {xscale vector_catch} mask
+Provide a bitmask showing the vectors to catch.
+ at end deffn
+
+ at subsection ARMv6 Architecture
+
+ at subsubsection ARM11 specific commands
+ at cindex ARM11 specific commands
+
+ at deffn Command {arm11 mcr} p1 p2 p3 p4 p5
+Read coprocessor register
+ at end deffn
+
+ at deffn Command {arm11 memwrite burst} [value]
+Displays the value of the memwrite burst-enable flag,
+which is enabled by default.
+If @var{value} is defined, first assigns that.
+ at end deffn
+
+ at deffn Command {arm11 memwrite error_fatal} [value]
+Displays the value of the memwrite error_fatal flag,
+which is enabled by default.
+If @var{value} is defined, first assigns that.
+ at end deffn
+
+ at deffn Command {arm11 mrc} p1 p2 p3 p4 p5 value
+Write coprocessor register
+ at end deffn
+
+ at deffn Command {arm11 no_increment}  [value]
+Displays the value of the flag controlling whether
+some read or write operations increment the pointer
+(the default behavior) or not (acting like a FIFO).
+If @var{value} is defined, first assigns that.
+ at end deffn
+
+ at deffn Command {arm11 step_irq_enable}  [value]
+Displays the value of the flag controlling whether
+IRQs are enabled during single stepping;
+they is disabled by default.
+If @var{value} is defined, first assigns that.
+ at end deffn
+
+ at subsection ARMv7 Architecture
+
+ at subsubsection Cortex-M3 specific commands
+ at cindex Cortex-M3 specific commands
+
+ at deffn Command {cortex_m3 maskisr} (on|off)
+Control masking (disabling) interrupts during target step/resume.
+ at end deffn
+
+ at section Target DCC Requests
+ at cindex Linux-ARM DCC support
+ at cindex libdcc
+ at cindex DCC
+OpenOCD can handle certain target requests; currently debugmsgs
+ at command{target_request debugmsgs}
+are only supported for arm7_9 and cortex_m3.
+
 See libdcc in the contrib dir for more details.
- at itemize @bullet
- at item @b{target_request debugmsgs} <@var{enable}|@var{disable}|@var{charmsg}>
- at cindex target_request debugmsgs
-@*Enable/disable target debugmsgs requests. debugmsgs enable messages to be sent to the debugger while the target is running. @var{charmsg} receives messages if Linux kernel ``Kernel low-level debugging via EmbeddedICE DCC channel'' option is enabled.
- at end itemize
+Linux-ARM kernels have a ``Kernel low-level debugging
+via EmbeddedICE DCC channel'' option (CONFIG_DEBUG_ICEDCC,
+depends on CONFIG_DEBUG_LL) which uses this mechanism to
+deliver messages before a serial console can be activated.
 
+ at deffn Command {target_request debugmsgs} [enable|disable|charmsg]
+Displays current handling of target DCC message requests.
+These messages may be sent to the debugger while the target is running.
+The optional @option{enable} and @option{charmsg} parameters are
+equivalent; both enable the messages, @option{disable} disables them.
+ at end deffn
+
 @node JTAG Commands
 @chapter JTAG Commands
 @cindex JTAG Commands



From zwelch at mail.berlios.de  Fri May 29 01:47:44 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 29 May 2009 01:47:44 +0200
Subject: [Openocd-svn] r1940 - trunk
Message-ID: <200905282347.n4SNlijW011625@sheep.berlios.de>

Author: zwelch
Date: 2009-05-29 01:47:37 +0200 (Fri, 29 May 2009)
New Revision: 1940

Modified:
   trunk/bootstrap
Log:
Remove redundant call to autoheader in bootstrap script.

Modified: trunk/bootstrap
===================================================================
--- trunk/bootstrap	2009-05-28 23:13:32 UTC (rev 1939)
+++ trunk/bootstrap	2009-05-28 23:47:37 UTC (rev 1940)
@@ -1,4 +1,5 @@
 #!/bin/sh -e
+# Run the autotools bootstrap sequence to create the configure script
 
 if libtoolize --version >/dev/null 2>&1; then
 	libtoolize="libtoolize"
@@ -13,7 +14,6 @@
 (
 set -x
 aclocal
-autoheader
 ${libtoolize} --automake --copy
 autoconf
 autoheader



From zwelch at mail.berlios.de  Fri May 29 03:33:08 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 29 May 2009 03:33:08 +0200
Subject: [Openocd-svn] r1941 - trunk/doc
Message-ID: <200905290133.n4T1X8jb026395@sheep.berlios.de>

Author: zwelch
Date: 2009-05-29 03:33:04 +0200 (Fri, 29 May 2009)
New Revision: 1941

Modified:
   trunk/doc/openocd.texi
Log:
David Brownell <david-b at pacbell.net>:

Provide basic documentation for some of the other flash drivers.

 avr ... looks incomplete, may work with one AVR8 microcontroller
 ecosflash ... can't find docs
 lpc288x ... an NXP part, driver seems lpc2888-specific
 ocl ... some arm7/arm9 thing, can't find docs
 pic32mx ... looks incomplete, for PIC32MX (MIPS 4K) devices
 tms470 ... for TI TMS470 parts

Still seems to be mostly arm7tdmi... several of these have no
users in the current tree.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-28 23:47:37 UTC (rev 1940)
+++ trunk/doc/openocd.texi	2009-05-29 01:33:04 UTC (rev 1941)
@@ -2625,6 +2625,19 @@
 @end deffn
 @end deffn
 
+ at deffn {Flash Driver} avr
+The AVR 8-bit microcontrollers from Atmel integrate flash memory.
+ at emph{The current implementation is incomplete.}
+ at comment - defines mass_erase ... pointless given flash_erase_address
+ at end deffn
+
+ at deffn {Flash Driver} ecosflash
+ at emph{No idea what this is...}
+The @var{ecosflash} driver defines one mandatory parameter,
+the name of a modules of target code which is downloaded
+and executed.
+ at end deffn
+
 @deffn {Flash Driver} lpc2000
 Most members of the LPC2000 microcontroller family from NXP
 include internal flash and use ARM7TDMI cores.
@@ -2649,6 +2662,46 @@
 @end example
 @end deffn
 
+ at deffn {Flash Driver} lpc288x
+The LPC2888 microcontroller from NXP needs slightly different flash
+support from its lpc2000 siblings.
+The @var{lpc288x} driver defines one mandatory parameter,
+the programming clock rate in Hz.
+LPC flashes don't require the chip and bus width to be specified.
+
+ at example
+flash bank lpc288x 0 0 0 0 $_TARGETNAME 12000000
+ at end example
+ at end deffn
+
+ at deffn {Flash Driver} ocl
+ at emph{No idea what this is, other than using some arm7/arm9 core.}
+
+ at example
+flash bank ocl 0 0 0 0 $_TARGETNAME
+ at end example
+ at end deffn
+
+ at deffn {Flash Driver} pic32mx
+The PIC32MX microcontrollers are based on the MIPS 4K cores,
+and integrate flash memory.
+ at emph{The current implementation is incomplete.}
+
+ at example
+flash bank pix32mx 0 0 0 0 $_TARGETNAME
+ at end example
+
+ at comment numerous *disabled* commands are defined:
+ at comment - chip_erase ... pointless given flash_erase_address
+ at comment - lock, unlock ... pointless given protect on/off (yes?)
+ at comment - pgm_word ... shouldn't bank be deduced from address??
+Some pic32mx-specific commands are defined:
+ at deffn Command {pic32mx pgm_word} address value bank
+Programs the specified 32-bit @var{value} at the given @var{address}
+in the specified chip @var{bank}.
+ at end deffn
+ at end deffn
+
 @deffn {Flash Driver} stellaris
 All members of the Stellaris LM3Sxxx microcontroller family from
 Texas Instruments
@@ -2738,6 +2791,27 @@
 
 @end deffn
 
+ at deffn {Flash Driver} tms470
+Most members of the TMS470 microcontroller family from Texas Instruments
+include internal flash and use ARM7TDMI cores.
+This driver doesn't require the chip and bus width to be specified.
+
+Some tms470-specific commands are defined:
+
+ at deffn Command {tms470 flash_keyset} key0 key1 key2 key3
+Saves programming keys in a register, to enable flash erase and write commands.
+ at end deffn
+
+ at deffn Command {tms470 osc_mhz} clock_mhz
+Reports the clock speed, which is used to calculate timings.
+ at end deffn
+
+ at deffn Command {tms470 plldis} (0|1)
+Disables (@var{1}) or enables (@var{0}) use of the PLL to speed up
+the flash clock.
+ at end deffn
+ at end deffn
+
 @subsection str9xpec driver
 @cindex str9xpec
 



From zwelch at mail.berlios.de  Fri May 29 06:00:55 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 29 May 2009 06:00:55 +0200
Subject: [Openocd-svn] r1942 - trunk/src/flash
Message-ID: <200905290400.n4T40tmX010972@sheep.berlios.de>

Author: zwelch
Date: 2009-05-29 06:00:51 +0200 (Fri, 29 May 2009)
New Revision: 1942

Modified:
   trunk/src/flash/flash.h
Log:
Add documentation to flash.h:
- provides low-level information about each flash API interface,
- gives driver authors some documentation about the driver interface,
- updated extensively from the original patch provided by Duane Ellis.


Modified: trunk/src/flash/flash.h
===================================================================
--- trunk/src/flash/flash.h	2009-05-29 01:33:04 UTC (rev 1941)
+++ trunk/src/flash/flash.h	2009-05-29 04:00:51 UTC (rev 1942)
@@ -33,65 +33,298 @@
 
 #define FLASH_MAX_ERROR_STR	(128)
 
+/**
+ * Describes the geometry and status of a single flash sector
+ * within a flash bank.  A single bank typically consists of multiple
+ * sectors, each of which can be erased and protected independently.
+ */
 typedef struct flash_sector_s
 {
+	/// Bus offset from start of the flash chip (in bytes).
 	u32 offset;
+	/// Number of bytes in this flash sector.
 	u32 size;
+	/**
+	 * Indication of erasure status: 0=not erased, 1=erased,
+	 * other=unknown.  Set by @c flash_driver_s::erase_check.
+	 */
 	int is_erased;
+	/**
+	 * Indication of protection status: 0=unprotected/unlocked,
+	 * 1=protected/locked, other=unknown.  Set by
+	 * @c flash_driver_s::protect_check.
+	 */
 	int is_protected;
 } flash_sector_t;
 
 struct flash_bank_s;
 
+/**
+ * @brief Provides the implementation-independent structure that defines
+ * all of the callbacks required by OpenOCD flash drivers.
+ *
+ * Driver authors must implement the routines defined here, providing an
+ * instance with the fields filled out.  After that, the instance must
+ * be registered in flash.c, so it can be used by the driver lookup system.
+ *
+ * Specifically, the user can issue the command: @par
+ * @code
+ * flash bank DRIVERNAME ...parameters...
+ * @endcode
+ *
+ * OpenOCD will search for the driver with a @c flash_driver_s::name
+ * that matches @c DRIVERNAME.
+ *
+ * The flash subsystem calls some of the other drivers routines a using
+ * corresponding static <code>flash_driver_<i>callback</i>()</code>
+ * routine in flash.c.
+ */
 typedef struct flash_driver_s
 {
+	/** 
+	 * Gives a human-readable name of this flash driver,
+	 * This field is used to select and initialize the driver.
+	 */
 	char *name;
+
+	/** 
+	 * Registers driver-specific commands.  When called (during the
+	 * "flash bank" command), the driver may register addition
+	 * commands to support new flash chip functions.
+	 *
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */
 	int (*register_commands)(struct command_context_s *cmd_ctx);
+
+	/** 
+	 * Finish the "flash bank" command for @a bank.  The
+	 * @a bank parameter will have been filled in by the core flash
+	 * layer when this routine is called, and the driver can store
+	 * additional information in its flash_bank_t::driver_priv field.
+	 * 
+	 * @param cmd_ctx - the command context
+	 * @param cmd     - the command, in this case 'flash'
+	 * @param args    - parameters, see below
+	 * @param argc    - number of parameters on command line
+	 * @param bank    - new filled in flash bank.
+	 *
+	 * The args are: @par
+	 * @code
+	 * args[0] = bank
+	 * args[1] = drivername {name above}
+	 * args[2] = baseaddress 
+	 * args[3] = lengthbytes
+	 * args[4] = chip_width_in bytes
+	 * args[5] = bus_width_bytes
+	 * args[6] = driver-specific parameters
+	 * @endcode
+	 *
+	 * For example, args[4] = 16 bit flash, args[5] = 32bit bus.
+	 *
+	 * If extra arguments are provided (@a argc > 6), they will
+	 * start in @a args[6].  These can be used to implement
+	 * driver-specific extensions.
+	 *
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */
 	int (*flash_bank_command)(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
 
-	/* use flash_driver_erase() wrapper to invoke */
+	/** 
+	 * Bank/sector erase routine (target-specific).  When
+	 * called, the flash driver should erase the specified sectors
+	 * using whatever means are at its disposal.
+	 *
+	 * @param bank The bank of flash to be erased.
+	 * @param first The number of the first sector to erase, typically 0.
+	 * @param last The number of the last sector to erase, typically N-1.
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */
 	int (*erase)(struct flash_bank_s *bank, int first, int last);
 
-	/* use flash_driver_protect() wrapper to invoke */
+	/** 
+	 * Bank/sector protection routine (target-specific).
+	 * When called, the driver should disable 'flash write' bits (or
+	 * enable 'erase protection' bits) for the given @a bank and @a
+	 * sectors.
+	 *
+	 * @param bank The bank to protect or unprotect.
+	 * @param set If non-zero, enable protection; if 0, disable it.
+	 * @param first The first sector to (un)protect, typicaly 0.
+	 * @param last The last sector to (un)project, typically N-1.
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */
 	int (*protect)(struct flash_bank_s *bank, int set, int first, int last);
 
-	/* use the flash_driver_write() wrapper to invoke. */
+	/** 
+	 * Program data into the flash.  Note CPU address will be
+	 * "bank->base + offset", while the physical address is
+	 * dependent upon current target MMU mappings.
+	 *
+	 * @param bank The bank to program
+	 * @param buffer The data bytes to write.
+	 * @param offset The offset into the chip to program.
+	 * @param count The number of bytes to write.
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */
 	int (*write)(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
 
+	/** 
+	 * Probe to determine what kind of flash is present.
+	 * This is invoked by the "probe" script command.
+	 *
+	 * @param bank The bank to probe
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */
 	int (*probe)(struct flash_bank_s *bank);
+	
+	/** 
+	 * Check the erasure status of a flash bank.
+	 * When called, the driver routine must perform the required
+	 * checks and then set the @c flash_sector_s::is_erased field
+	 * for each of the flash banks's sectors.
+	 *
+	 * @param bank The bank to check
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */
 	int (*erase_check)(struct flash_bank_s *bank);
+
+	/**
+	 * Determine if the specific bank is "protected" or not.
+	 * When called, the driver routine must must perform the
+	 * required protection check(s) and then set the @c
+	 * flash_sector_s::is_protected field for each of the flash
+	 * bank's sectors.
+	 *
+	 * @param bank - the bank to check
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */
 	int (*protect_check)(struct flash_bank_s *bank);
+
+	/**
+	 * Display human-readable information about the flash
+	 * bank into the given buffer.  Drivers must be careful to avoid
+	 * overflowing the buffer.
+	 *
+	 * @param bank - the bank to get info about
+	 * @param char - where to put the text for the human to read
+	 * @param buf_size - the size of the human buffer.
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */ 
 	int (*info)(struct flash_bank_s *bank, char *buf, int buf_size);
+
+	/**
+	 * A more gentle flavor of filash_driver_s::probe, performing
+	 * setup with less noise.  Generally, driver routines should test
+	 * to seee if the bank has already been probed; if it has, the
+	 * driver probably should not perform its probe a second time.
+	 *
+	 * This callback is often called from the inside of other
+	 * routines (e.g. GDB flash downloads) to autoprobe the flash as
+	 * it is programing the flash.
+	 *
+	 * @param bank - the bank to probe
+	 * @returns ERROR_OK if successful; otherwise, an error code.
+	 */
 	int (*auto_probe)(struct flash_bank_s *bank);
 } flash_driver_t;
 
+/** 
+ * Provides details of a flash bank, available either on-chip or through
+ * a major interface.
+ *
+ * This structure will be passed as a parameter to the callbacks in the
+ * flash_driver_s structure, some of which may modify the contents of
+ * this structure of the area of flash that it defines.  Driver writers
+ * may use the @c driver_priv member to store additional data on a
+ * per-bank basis, if required.
+ */
 typedef struct flash_bank_s
 {
-	struct target_s *target;
-	flash_driver_t *driver;
-	void *driver_priv;
-	int bank_number;
-	u32 base;
-	u32 size;
-	int chip_width;
-	int bus_width;
+	struct target_s *target; /**< Target to which this bank belongs. */
+
+	flash_driver_t *driver; /**< Driver for this bank. */
+	void *driver_priv; /**< Private driver storage pointer */
+
+	int bank_number; /**< The 'bank' (or chip number) of this instance. */
+	u32 base; /**< The base address of this bank */
+	u32 size; /**< The size of this chip bank, in bytes */
+
+	int chip_width; /**< Width of the chip in bytes (1,2,4 bytes) */
+	int bus_width; /**< Maximum bus width, in bytes (1,2,4 bytes) */
+
+	/**
+	 * The number of sectors on this chip.  This value will
+	 * be set intially to 0, and the flash driver must set this to
+	 * some non-zero value during "probe()" or "auto_probe()".
+	 */
 	int num_sectors;
+	/// Array of sectors, allocated and initilized by the flash driver
 	flash_sector_t *sectors;
-	struct flash_bank_s *next;
+
+	struct flash_bank_s *next; /**< The next flash bank on this chip */
 } flash_bank_t;
 
+/// Registers the 'flash' subsystem commands
 extern int flash_register_commands(struct command_context_s *cmd_ctx);
+/// Initializes the 'flash' subsystem drivers
 extern int flash_init_drivers(struct command_context_s *cmd_ctx);
 
+/**
+ * Erases @a length bytes in the @a target flash, starting at @a addr.
+ * @returns ERROR_OK if successful; otherwise, an error code.
+ */
 extern int flash_erase_address_range(struct target_s *target, u32 addr, u32 length);
+/**
+ * Writes @a image into the @a target flash.  The @a written parameter
+ * will contain the 
+ * @param target The target with the flash to be programmed.
+ * @param image The image that will be programmed to flash.
+ * @param written On return, contains the number of bytes written.
+ * @param erase If non-zero, indicates the flash driver should first
+ * erase the corresponding banks or sectors before programming.
+ * @returns ERROR_OK if successful; otherwise, an error code.
+ */
 extern int flash_write(struct target_s *target, struct image_s *image, u32 *written, int erase);
+/**
+ * Forces targets to re-examine their erase/protection state.
+ * This routine must be called when the system may modify the status.
+ */
 extern void flash_set_dirty(void);
+/// @returns The number of flash banks currently defined.
 extern int flash_get_bank_count(void);
+/**
+ * Provides default erased-bank check handling. Checks to see if
+ * the flash driver knows they are erased; if things look uncertain,
+ * this routine will call default_flash_mem_blank_check() to confirm.
+ * @returns ERROR_OK if successful; otherwise, an error code.
+ */
 extern int default_flash_blank_check(struct flash_bank_s *bank);
+/**
+ * Provides a default blank flash memory check.  Ensures the contents
+ * of the given bank have truly been erased.
+ * @param bank The flash bank.
+ * @returns ERROR_OK if successful; otherwise, an error code.
+ */
 extern int default_flash_mem_blank_check(struct flash_bank_s *bank);
 
+/**
+ * Returns a flash bank by the specified flash_bank_s bank_number, @a num.
+ * @param num The flash bank number.
+ * @returns A flash_bank_t for flash bank @a num, or NULL
+ */
 extern flash_bank_t *get_flash_bank_by_num(int num);
+/**
+ * Returns the flash bank like get_flash_bank_by_num(), without probing.
+ * @param num The flash bank number.
+ * @returns A flash_bank_t for flash bank @a num, or NULL.
+ */
 extern flash_bank_t *get_flash_bank_by_num_noprobe(int num);
+/**
+ * Returns the flash bank located at a specified address.
+ * @param target The target, presumed to contain one or more banks.
+ * @param addr An address that is within the range of the bank.
+ * @returns The flash_bank_t located at @a addr, or NULL.
+ */
 extern flash_bank_t *get_flash_bank_by_addr(struct target_s *target, u32 addr);
 
 #define ERROR_FLASH_BANK_INVALID			(-900)



From zwelch at mail.berlios.de  Fri May 29 07:50:09 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Fri, 29 May 2009 07:50:09 +0200
Subject: [Openocd-svn] r1943 - trunk/src/jtag
Message-ID: <200905290550.n4T5o90G020055@sheep.berlios.de>

Author: zwelch
Date: 2009-05-29 07:50:01 +0200 (Fri, 29 May 2009)
New Revision: 1943

Modified:
   trunk/src/jtag/jtag.h
Log:
Remove error_handler_t type definition; it was unused in the tree.

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-29 04:00:51 UTC (rev 1942)
+++ trunk/src/jtag/jtag.h	2009-05-29 05:50:01 UTC (rev 1943)
@@ -258,8 +258,6 @@
 extern tap_state_t cmd_queue_end_state;         /* finish DR scans in dr_end_state */
 extern tap_state_t cmd_queue_cur_state;         /* current TAP state */
 
-typedef void* error_handler_t;  /* Later on we can delete error_handler_t, but keep it for now to make patches more readable */
-
 struct scan_field_s;
 typedef int (*in_handler_t)(u8* in_value, void* priv, struct scan_field_s* field);
 



From zwelch at mail.berlios.de  Sat May 30 03:32:24 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 30 May 2009 03:32:24 +0200
Subject: [Openocd-svn] r1944 - in trunk: doc src/jtag
Message-ID: <200905300132.n4U1WOea006387@sheep.berlios.de>

Author: zwelch
Date: 2009-05-30 03:32:19 +0200 (Sat, 30 May 2009)
New Revision: 1944

Modified:
   trunk/doc/openocd.texi
   trunk/src/jtag/jtag.c
Log:
David Brownell <david-b at pacbell.net>:

Make it so the magic "reset_config" keywords can be provided in any
order.  This eliminates needless error paths, and makes it easier
to define things at the right level (adapter, board, target).
It also includes two other behavioral changes:

  (1)	When "handle_reset_config" sees a parameter error, it
  	exits without changing anything.   This is best viewed
	as a bugfix.  (Old behavior:  restore defaults, even if
	they weren't previously active.)

  (2)	Only the behaviors that were explicitly specified get
  	changed.  (Old behavior:  everything else gets reset to
	the "default".)  So for example you can now specify SRST
	drive requirements without saying anything about the
	three unrelated topics you previously had to specify.

That second one might cause confusion for any configs that end
up calling "reset_config" twice, so it will deserve to be called
out in the release notes.  (There were no such configurations in
the current OpenOCD source tree.)

Update docs accordingly.  Note that at least some versions of
the texi-to-html tools can't handle "@xref{with spaces}", but
those work properly in PDF and in the info files.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-29 05:50:01 UTC (rev 1943)
+++ trunk/doc/openocd.texi	2009-05-30 01:32:19 UTC (rev 1944)
@@ -1574,9 +1574,13 @@
 
 Every system configuration may require a different reset
 configuration. This can also be quite confusing.
+Resets also interact with @var{reset-init} event handlers,
+which do things like setting up clocks and DRAM, and
+JTAG clock rates.  (@xref{JTAG Speed}.)
 Please see the various board files for examples.
 
- at b{Note} to maintainers and integrators:
+ at quotation Note
+To maintainers and integrators:
 Reset configuration touches several things at once.
 Normally the board configuration file
 should define it and assume that the JTAG adapter supports
@@ -1587,6 +1591,7 @@
 And when the JTAG adapter doesn't support everything, the
 system configuration file will need to override parts of
 the reset configuration provided by other files.
+ at end quotation
 
 @section Types of Reset
 
@@ -1671,12 +1676,19 @@
 
 There can also be other issues.
 Some devices don't fully conform to the JTAG specifications.
-Others have chip-specific extensions like extra steps needed
-during TAP reset, or a requirement to use the normally-optional TRST
-signal.
 Trivial system-specific differences are common, such as
 SRST and TRST using slightly different names.
+There are also vendors who distribute key JTAG documentation for
+their chips only to developers who have signed a Non-Disclosure
+Agreement (NDA).
 
+Sometimes there are chip-specific extensions like a requirement to use
+the normally-optional TRST signal (precluding use of JTAG adapters which
+don't pass TRST through), or needing extra steps to complete a TAP reset.
+
+In short, SRST and especially TRST handling may be very finicky,
+needing to cope with both architecture and board specific constraints.
+
 @section Commands for Handling Resets
 
 @deffn {Command} jtag_nsrst_delay milliseconds
@@ -1691,31 +1703,58 @@
 nTRST (active-low JTAG TAP reset) before starting new JTAG operations.
 @end deffn
 
- at deffn {Command} reset_config signals [combination [trst_type [srst_type]]]
+ at deffn {Command} reset_config mode_flag ...
 This command tells OpenOCD the reset configuration
 of your combination of JTAG interface, board, and target.
-If the JTAG interface provides SRST, but the board doesn't connect
-that signal properly, then OpenOCD can't use it. @var{signals} can
-be @option{none}, @option{trst_only}, @option{srst_only} or
- at option{trst_and_srst}.
 
+The @var{mode_flag} options can be specified in any order, but only one
+of each type -- @var{signals}, @var{combination}, @var{trst_type},
+and @var{srst_type} -- may be specified at a time.
+If you don't provide a new value for a given type, its previous
+value (perhaps the default) is unchanged.
+For example, this means that you don't need to say anything at all about
+TRST just to declare that if the JTAG adapter should want to drive SRST,
+it must explicitly be driven high (@option{srst_push_pull}).
+
+ at var{signals} can specify which of the reset signals are connected.
+For example, If the JTAG interface provides SRST, but the board doesn't
+connect that signal properly, then OpenOCD can't use it.
+Possible values are @option{none} (the default), @option{trst_only},
+ at option{srst_only} and @option{trst_and_srst}.
+
+ at quotation Tip
+If your board provides SRST or TRST through the JTAG connector,
+you must declare that or else those signals will not be used.
+ at end quotation
+
 The @var{combination} is an optional value specifying broken reset
-signal implementations.  @option{srst_pulls_trst} states that the
+signal implementations.
+The default behaviour if no option given is @option{separate},
+indicating everything behaves normally.
+ at option{srst_pulls_trst} states that the
 test logic is reset together with the reset of the system (e.g. Philips
 LPC2000, "broken" board layout), @option{trst_pulls_srst} says that
 the system is reset together with the test logic (only hypothetical, I
 haven't seen hardware with such a bug, and can be worked around).
 @option{combined} implies both @option{srst_pulls_trst} and
- at option{trst_pulls_srst}.  The default behaviour if no option given is
- at option{separate}.
+ at option{trst_pulls_srst}.
 
 The optional @var{trst_type} and @var{srst_type} parameters allow the
-driver type of the reset lines to be specified. Possible values are
- at option{trst_push_pull} (default) and @option{trst_open_drain} for the
-test reset signal, and @option{srst_open_drain} (default) and
- at option{srst_push_pull} for the system reset. These values only affect
-JTAG interfaces with support for different drivers, like the Amontec
-JTAGkey and JTAGAccelerator.
+driver mode of each reset line to be specified.  These values only affect
+JTAG interfaces with support for different driver modes, like the Amontec
+JTAGkey and JTAGAccelerator.  Also, they are necessarily ignored if the
+relevant signal (TRST or SRST) is not connected.
+
+Possible @var{trst_type} driver modes for the test reset signal (TRST)
+are @option{trst_push_pull} (default) and @option{trst_open_drain}.
+Most boards connect this signal to a pulldown, so the JTAG TAPs
+never leave reset unless they are hooked up to a JTAG adapter.
+
+Possible @var{srst_type} driver modes for the system reset signal (SRST)
+are the default @option{srst_open_drain}, and @option{srst_push_pull}.
+Most boards connect this signal to a pullup, and allow the
+signal to be pulled low by various events including system
+powerup and pressing a reset button.
 @end deffn
 
 

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-29 05:50:01 UTC (rev 1943)
+++ trunk/src/jtag/jtag.c	2009-05-30 01:32:19 UTC (rev 1944)
@@ -2651,77 +2651,111 @@
 
 static int handle_reset_config_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
+	int new_cfg = 0;
+	int mask = 0;
+
 	if (argc < 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	if (argc >= 1)
-	{
-		if (strcmp(args[0], "none") == 0)
-			jtag_reset_config = RESET_NONE;
-		else if (strcmp(args[0], "trst_only") == 0)
-			jtag_reset_config = RESET_HAS_TRST;
-		else if (strcmp(args[0], "srst_only") == 0)
-			jtag_reset_config = RESET_HAS_SRST;
-		else if (strcmp(args[0], "trst_and_srst") == 0)
-			jtag_reset_config = RESET_TRST_AND_SRST;
+	/* Original versions cared about the order of these tokens:
+	 *   reset_config signals [combination [trst_type [srst_type]]]
+	 * They also clobbered the previous configuration even on error.
+	 *
+	 * Here we don't care about the order, and only change values
+	 * which have been explicitly specified.
+	 */
+	for (; argc; argc--, args++) {
+		int tmp = 0;
+		int m;
+
+		/* signals */
+		m = RESET_HAS_TRST | RESET_HAS_SRST;
+		if (strcmp(*args, "none") == 0)
+			tmp = RESET_NONE;
+		else if (strcmp(*args, "trst_only") == 0)
+			tmp = RESET_HAS_TRST;
+		else if (strcmp(*args, "srst_only") == 0)
+			tmp = RESET_HAS_SRST;
+		else if (strcmp(*args, "trst_and_srst") == 0)
+			tmp = RESET_HAS_TRST | RESET_HAS_SRST;
 		else
-		{
-			LOG_ERROR("(1) invalid reset_config argument (%s), defaulting to none", args[0]);
-			jtag_reset_config = RESET_NONE;
+			m = 0;
+		if (mask & m) {
+			LOG_ERROR("extra reset_config %s spec (%s)",
+					"signal", *args);
 			return ERROR_INVALID_ARGUMENTS;
 		}
-	}
+		if (m)
+			goto next;
 
-	if (argc >= 2)
-	{
-		if (strcmp(args[1], "separate") == 0)
-		{
-			/* seperate reset lines - default */
-		} else
-		{
-			if (strcmp(args[1], "srst_pulls_trst") == 0)
-				jtag_reset_config |= RESET_SRST_PULLS_TRST;
-			else if (strcmp(args[1], "trst_pulls_srst") == 0)
-				jtag_reset_config |= RESET_TRST_PULLS_SRST;
-			else if (strcmp(args[1], "combined") == 0)
-				jtag_reset_config |= RESET_SRST_PULLS_TRST | RESET_TRST_PULLS_SRST;
-			else
-			{
-				LOG_ERROR("(2) invalid reset_config argument (%s), defaulting to none", args[1]);
-				jtag_reset_config = RESET_NONE;
-				return ERROR_INVALID_ARGUMENTS;
-			}
+		/* combination (options for broken wiring) */
+		m = RESET_SRST_PULLS_TRST | RESET_TRST_PULLS_SRST;
+		if (strcmp(*args, "separate") == 0)
+			/* separate reset lines - default */;
+		else if (strcmp(*args, "srst_pulls_trst") == 0)
+			tmp |= RESET_SRST_PULLS_TRST;
+		else if (strcmp(*args, "trst_pulls_srst") == 0)
+			tmp |= RESET_TRST_PULLS_SRST;
+		else if (strcmp(*args, "combined") == 0)
+			tmp |= RESET_SRST_PULLS_TRST | RESET_TRST_PULLS_SRST;
+		else
+			m = 0;
+		if (mask & m) {
+			LOG_ERROR("extra reset_config %s spec (%s)",
+					"combination", *args);
+			return ERROR_INVALID_ARGUMENTS;
 		}
-	}
+		if (m)
+			goto next;
 
-	if (argc >= 3)
-	{
-		if (strcmp(args[2], "trst_open_drain") == 0)
-			jtag_reset_config |= RESET_TRST_OPEN_DRAIN;
-		else if (strcmp(args[2], "trst_push_pull") == 0)
-			jtag_reset_config &= ~RESET_TRST_OPEN_DRAIN;
+		/* trst_type (NOP without HAS_TRST) */
+		m = RESET_TRST_OPEN_DRAIN;
+		if (strcmp(*args, "trst_open_drain") == 0)
+			tmp |= RESET_TRST_OPEN_DRAIN;
+		else if (strcmp(*args, "trst_push_pull") == 0)
+			/* push/pull from adapter - default */;
 		else
-		{
-			LOG_ERROR("(3) invalid reset_config argument (%s) defaulting to none", args[2] );
-			jtag_reset_config = RESET_NONE;
+			m = 0;
+		if (mask & m) {
+			LOG_ERROR("extra reset_config %s spec (%s)",
+					"trst_type", *args);
 			return ERROR_INVALID_ARGUMENTS;
 		}
-	}
+		if (m)
+			goto next;
 
-	if (argc >= 4)
-	{
-		if (strcmp(args[3], "srst_push_pull") == 0)
-			jtag_reset_config |= RESET_SRST_PUSH_PULL;
-		else if (strcmp(args[3], "srst_open_drain") == 0)
-			jtag_reset_config &= ~RESET_SRST_PUSH_PULL;
+		/* srst_type (NOP without HAS_SRST) */
+		m |= RESET_SRST_PUSH_PULL;
+		if (strcmp(*args, "srst_push_pull") == 0)
+			tmp |= RESET_SRST_PUSH_PULL;
+		else if (strcmp(*args, "srst_open_drain") == 0)
+			/* open drain from adapter - default */;
 		else
-		{
-			LOG_ERROR("(4) invalid reset_config argument (%s), defaulting to none", args[3]);
-			jtag_reset_config = RESET_NONE;
+			m = 0;
+		if (mask & m) {
+			LOG_ERROR("extra reset_config %s spec (%s)",
+					"srst_type", *args);
 			return ERROR_INVALID_ARGUMENTS;
 		}
+		if (m)
+			goto next;
+
+		/* caller provided nonsense; fail */
+		LOG_ERROR("unknown reset_config flag (%s)", *args);
+		return ERROR_INVALID_ARGUMENTS;
+
+next:
+		/* Remember the bits which were specified (mask)
+		 * and their new values (new_cfg).
+		 */
+		mask |= m;
+		new_cfg |= tmp;
 	}
 
+	/* clear previous values of those bits, save new values */
+	jtag_reset_config &= ~mask;
+	jtag_reset_config |= new_cfg;
+
 	return ERROR_OK;
 }
 



From zwelch at mail.berlios.de  Sat May 30 03:43:26 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 30 May 2009 03:43:26 +0200
Subject: [Openocd-svn] r1945 - in trunk: doc src/target
Message-ID: <200905300143.n4U1hQN5006877@sheep.berlios.de>

Author: zwelch
Date: 2009-05-30 03:43:21 +0200 (Sat, 30 May 2009)
New Revision: 1945

Modified:
   trunk/doc/openocd.texi
   trunk/src/target/etm.c
   trunk/src/target/oocd_trace.c
Log:
David Brownell <david-b at pacbell.net>:

Provide basic documentation on the ARM ETM and ETB trace commands.

Fix minor goofs in registration of the ETM commands; and whitespace
issues in the proof-of-concept oocd_trace code.  (Plus include a
ref to Dominic's email saying that it's just proof-of-concept code.)

Note that I'm still not sure whether the ETM support works.  But
documenting how it's expected to work should help sort out which
behaviors are bugs, which will help get bugs patched.

ZW: whitespace changes were split out of this patch but will follow.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-30 01:32:19 UTC (rev 1944)
+++ trunk/doc/openocd.texi	2009-05-30 01:43:21 UTC (rev 1945)
@@ -1094,17 +1094,11 @@
 examination of the instruction and data bus activity.  Trace
 activity is controlled through an ``Embedded Trace Module'' (ETM)
 on one of the core's scan chains.  The ETM emits voluminous data
-through a ``trace port''.  The trace port is accessed in one
-of two ways.  When its signals are pinned out from the chip,
-boards may provide a special high speed debugging connector;
-software support for this is not configured by default, use
-the ``--enable-oocd_trace'' option.  Alternatively, trace data
-may be stored an on-chip SRAM which is packaged as an ``Embedded
-Trace Buffer'' (ETB).  An ETB has its own TAP, usually right after
-its associated ARM core.  OpenOCD supports the ETM, and your
-target configuration should set it up with the relevant trace
-port:  ``etb'' for chips which use that, else the board-specific
-option will be either ``oocd_trace'' or ``dummy''.
+through a ``trace port''.  (@xref{ARM Tracing}.)
+If you are using an external trace port,
+configure it in your board config file.
+If you are using an on-chip ``Embedded Trace Buffer'' (ETB),
+configure it in your target config file.
 
 @example
 etm config $_TARGETNAME 16 normal full etb
@@ -3586,6 +3580,181 @@
 Some of those operations don't fit well in that framework, so they are
 exposed here using architecture or implementation specific commands.
 
+ at anchor{ARM Tracing}
+ at subsection ARM Tracing
+ at cindex ETM
+ at cindex ETB
+
+CPUs based on ARM cores may include standard tracing interfaces,
+based on an ``Embedded Trace Module'' (ETM) which sends voluminous
+address and data bus trace records to a ``Trace Port''.
+
+ at itemize
+ at item
+Development-oriented boards will sometimes provide a high speed
+trace connector for collecting that data, when the particular CPU
+supports such an interface.
+(The standard connector is a 38-pin Mictor, with both JTAG
+and trace port support.)
+Those trace connectors are supported by higher end JTAG adapters
+and some logic analyzer modules; frequently those modules can
+buffer several megabytes of trace data.
+Configuring an ETM coupled to such an external trace port belongs
+in the board-specific configuration file.
+ at item
+If the CPU doesn't provide an external interface, it probably
+has an ``Embedded Trace Buffer'' (ETB) on the chip, which is a
+dedicated SRAM.  4KBytes is one common ETB size.
+Configuring an ETM coupled only to an ETB belongs in the CPU-specific
+(target) configuration file, since it works the same on all boards.
+ at end itemize
+
+ETM support in OpenOCD doesn't seem to be widely used yet.
+
+ at quotation Issues
+ETM support may be buggy, and at least some @command{etm config}
+parameters should be detected by asking the ETM for them.
+It seems like a GDB hookup should be possible,
+as well as triggering trace on specific events
+(perhaps @emph{handling IRQ 23} or @emph{calls foo()}).
+There should be GUI tools to manipulate saved trace data and help
+analyse it in conjunction with the source code.
+It's unclear how much of a common interface is shared
+with the current XScale trace support, or should be
+shared with eventual Nexus-style trace module support.
+ at end quotation
+
+ at subsubsection ETM Configuration
+ETM setup is coupled with the trace port driver configuration.
+
+ at deffn {Config Command} {etm config} target width mode clocking driver
+Declares the ETM associated with @var{target}, and associates it
+with a given trace port @var{driver}.  @xref{Trace Port Drivers}.
+
+Several of the parameters must reflect the trace port configuration.
+The @var{width} must be either 4, 8, or 16.
+The @var{mode} must be @option{normal}, @option{multiplexted},
+or @option{demultiplexted}.
+The @var{clocking} must be @option{half} or @option{full}.
+
+ at quotation Note
+You can see the ETM registers using the @command{reg} command, although
+not all of those possible registers are present in every ETM.
+ at end quotation
+ at end deffn
+
+ at deffn Command {etm info}
+Displays information about the current target's ETM.
+ at end deffn
+
+ at deffn Command {etm status}
+Displays status of the current target's ETM:
+is the ETM idle, or is it collecting data?
+Did trace data overflow?
+Was it triggered?
+ at end deffn
+
+ at deffn Command {etm tracemode} [type context_id_bits cycle_accurate branch_output]
+Displays what data that ETM will collect.
+If arguments are provided, first configures that data.
+When the configuration changes, tracing is stopped
+and any buffered trace data is invalidated.
+
+ at itemize
+ at item @var{type} ... one of
+ at option{none} (save nothing),
+ at option{data} (save data),
+ at option{address} (save addresses),
+ at option{all} (save data and addresses)
+ at item @var{context_id_bits} ... 0, 8, 16, or 32
+ at item @var{cycle_accurate} ...  @option{enable} or @option{disable}
+ at item @var{branch_output} ...  @option{enable} or @option{disable}
+ at end itemize
+ at end deffn
+
+ at deffn Command {etm trigger_percent} percent
+ at emph{Buggy and effectively a NOP ... @var{percent} from 2..100}
+ at end deffn
+
+ at subsubsection ETM Trace Operation
+
+After setting up the ETM, you can use it to collect data.
+That data can be exported to files for later analysis.
+It can also be parsed with OpenOCD, for basic sanity checking.
+
+ at deffn Command {etm analyze}
+Reads trace data into memory, if it wasn't already present.
+Decodes and prints the data that was collected.
+ at end deffn
+
+ at deffn Command {etm dump} filename
+Stores the captured trace data in @file{filename}.
+ at end deffn
+
+ at deffn Command {etm image} filename [base_address] [type]
+Opens an image file.
+ at end deffn
+
+ at deffn Command {etm load} filename
+Loads captured trace data from @file{filename}.
+ at end deffn
+
+ at deffn Command {etm start}
+Starts trace data collection.
+ at end deffn
+
+ at deffn Command {etm stop}
+Stops trace data collection.
+ at end deffn
+
+ at anchor{Trace Port Drivers}
+ at subsubsection Trace Port Drivers
+
+To use an ETM trace port it must be associated with a driver.
+
+ at deffn {Trace Port Driver} etb
+Use the @option{etb} driver if you are configuring an ETM
+to use on-chip ETB memory.
+ at deffn {Config Command} {etb config} target etb_tap
+Associates the ETM for @var{target} with the ETB at @var{etb_tap}.
+You can see the ETB registers using the @command{reg} command.
+ at end deffn
+ at end deffn
+
+ at deffn {Trace Port Driver} etm_dummy
+Use the @option{etm_dummy} driver if you are configuring an ETM that's
+not connected to anything (on-chip ETB or off-chip trace connector).
+ at emph{This driver lets OpenOCD talk to the ETM, but it does not expose
+any trace data collection.}
+ at deffn {Config Command} {etm_dummy config} target
+Associates the ETM for @var{target} with a dummy driver.
+ at end deffn
+ at end deffn
+
+ at deffn {Trace Port Driver} oocd_trace
+This driver isn't available unless OpenOCD was explicitly configured
+with the @option{--enable-oocd_trace} option.  You probably don't want
+to configure it unless you've built the appropriate prototype hardware;
+it's @emph{proof-of-concept} software.
+
+Use the @option{oocd_trace} driver if you are configuring an ETM that's
+connected to an off-chip trace connector.
+
+ at deffn {Config Command} {oocd_trace config} target tty
+Associates the ETM for @var{target} with a trace driver which
+collects data through the serial port @var{tty}.
+ at end deffn
+
+ at deffn Command {oocd_trace resync}
+Re-synchronizes with the capture clock.
+ at end deffn
+
+ at deffn Command {oocd_trace status}
+Reports whether the capture clock is locked or not.
+ at end deffn
+ at end deffn
+
+
 @subsection ARMv4 and ARMv5 Architecture
 @cindex ARMv4 specific commands
 @cindex ARMv5 specific commands

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-05-30 01:32:19 UTC (rev 1944)
+++ trunk/src/target/etm.c	2009-05-30 01:43:21 UTC (rev 1945)
@@ -1815,7 +1815,8 @@
 {
 	etm_cmd = register_command(cmd_ctx, NULL, "etm", NULL, COMMAND_ANY, "Embedded Trace Macrocell");
 
-	register_command(cmd_ctx, etm_cmd, "config", handle_etm_config_command, COMMAND_CONFIG, "etm config <target> <port_width> <port_mode> <clocking> <capture_driver>");
+	register_command(cmd_ctx, etm_cmd, "config", handle_etm_config_command,
+		COMMAND_CONFIG, "etm config <target> <port_width> <port_mode> <clocking> <capture_driver>");
 
 	return ERROR_OK;
 }
@@ -1823,12 +1824,13 @@
 int etm_register_user_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, etm_cmd, "tracemode", handle_etm_tracemode_command,
-		COMMAND_EXEC, "configure trace mode <none|data|address|all> <context id bits> <cycle accurate> <branch output");
+		COMMAND_EXEC, "configure trace mode <none|data|address|all> "
+			"<context_id_bits> <cycle_accurate> <branch_output>");
 
 	register_command(cmd_ctx, etm_cmd, "info", handle_etm_info_command,
 		COMMAND_EXEC, "display info about the current target's ETM");
 
-	register_command(cmd_ctx, etm_cmd, "trigger_percent <percent>", handle_etm_trigger_percent_command,
+	register_command(cmd_ctx, etm_cmd, "trigger_percent", handle_etm_trigger_percent_command,
 		COMMAND_EXEC, "amount (<percent>) of trace buffer to be filled after the trigger occured");
 	register_command(cmd_ctx, etm_cmd, "status", handle_etm_status_command,
 		COMMAND_EXEC, "display current target's ETM status");

Modified: trunk/src/target/oocd_trace.c
===================================================================
--- trunk/src/target/oocd_trace.c	2009-05-30 01:32:19 UTC (rev 1944)
+++ trunk/src/target/oocd_trace.c	2009-05-30 01:43:21 UTC (rev 1945)
@@ -24,7 +24,12 @@
 #include "oocd_trace.h"
 #include "arm7_9_common.h"
 
+/*
+ * This is "proof of concept" code, for prototype hardware:
+ * https://lists.berlios.de/pipermail/openocd-development/2007-September/000336.html
+ */
 
+
 static int oocd_trace_register_commands(struct command_context_s *cmd_ctx);
 
 static int oocd_trace_read_reg(oocd_trace_t *oocd_trace, int reg, u32 *value)



From zwelch at mail.berlios.de  Sat May 30 03:44:25 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 30 May 2009 03:44:25 +0200
Subject: [Openocd-svn] r1946 - trunk/src/target
Message-ID: <200905300144.n4U1iP6U006930@sheep.berlios.de>

Author: zwelch
Date: 2009-05-30 03:44:22 +0200 (Sat, 30 May 2009)
New Revision: 1946

Modified:
   trunk/src/target/oocd_trace.c
Log:
Remove trailing whitespace from oocd_trace source file.

Modified: trunk/src/target/oocd_trace.c
===================================================================
--- trunk/src/target/oocd_trace.c	2009-05-30 01:43:21 UTC (rev 1945)
+++ trunk/src/target/oocd_trace.c	2009-05-30 01:44:22 UTC (rev 1946)
@@ -48,7 +48,7 @@
 	}
 
 	LOG_DEBUG("reg #%i: 0x%8.8x\n", reg, *value);
-	
+
 	return ERROR_OK;
 }
 
@@ -92,7 +92,7 @@
 		else
 			bytes_to_read -= bytes_read;
 	}
-	
+
 	return ERROR_OK;
 }
 
@@ -101,7 +101,7 @@
 	u8 trash[256];
 	oocd_trace_t *oocd_trace = etm_ctx->capture_driver_priv;
 	size_t bytes_read;
-	
+
 	oocd_trace->tty_fd = open(oocd_trace->tty, O_RDWR | O_NOCTTY | O_NONBLOCK);
 
 	if(oocd_trace->tty_fd < 0)
@@ -114,32 +114,32 @@
 	tcflush(oocd_trace->tty_fd, TCOFLUSH);
 	tcflush(oocd_trace->tty_fd, TCIFLUSH);
 	fcntl(oocd_trace->tty_fd, F_SETFL, fcntl(oocd_trace->tty_fd, F_GETFL) & ~O_NONBLOCK);
-	
+
 	tcgetattr(oocd_trace->tty_fd, &oocd_trace->oldtio); /* save current port settings */
-	
+
 	bzero(&oocd_trace->newtio, sizeof(oocd_trace->newtio));
 	oocd_trace->newtio.c_cflag = CS8 | CLOCAL | CREAD | B2500000;
-	
+
 	oocd_trace->newtio.c_iflag = IGNPAR | IGNBRK | IXON | IXOFF;
 	oocd_trace->newtio.c_oflag = 0;
-	
+
 	/* set input mode (non-canonical, no echo,...) */
 	oocd_trace->newtio.c_lflag = 0;
-	
+
 	cfmakeraw(&oocd_trace->newtio);
 	oocd_trace->newtio.c_cc[VTIME] = 1;   /* inter-character timer used */
 	oocd_trace->newtio.c_cc[VMIN] = 0;   /* blocking read until 0 chars received */
-	
+
 	tcflush(oocd_trace->tty_fd, TCIFLUSH);
 	tcsetattr(oocd_trace->tty_fd, TCSANOW, &oocd_trace->newtio);
-	
+
 	/* occasionally one bogus character is left in the input buffer
 	 * read up any leftover characters to ensure communication is in sync */
 	while ((bytes_read = read(oocd_trace->tty_fd, trash, sizeof(trash))) > 0)
 	{
 		LOG_DEBUG("%zi bytes read\n", bytes_read);
 	};
-	
+
 	return ERROR_OK;
 }
 
@@ -147,9 +147,9 @@
 {
 	oocd_trace_t *oocd_trace = etm_ctx->capture_driver_priv;
 	u32 status;
-	
+
 	oocd_trace_read_reg(oocd_trace, OOCD_TRACE_STATUS, &status);
-	
+
 	/* if tracing is currently idle, return this information */
 	if (etm_ctx->capture_status == TRACE_IDLE)
 	{
@@ -160,18 +160,18 @@
 		/* check Full bit to identify an overflow */
 		if (status & 0x4)
 			etm_ctx->capture_status |= TRACE_OVERFLOWED;
-		
+
 		/* check Triggered bit to identify trigger condition */
 		if (status & 0x2)
 			etm_ctx->capture_status |= TRACE_TRIGGERED;
-		
+
 		if (status & 0x1)
 		{
 			etm_ctx->capture_status &= ~TRACE_RUNNING;
 			etm_ctx->capture_status |= TRACE_COMPLETED;
 		}
 	}
-	
+
 	return etm_ctx->capture_status;
 }
 
@@ -196,7 +196,7 @@
 	else
 		num_frames = address;
 
-	/* read data into temporary array for unpacking 
+	/* read data into temporary array for unpacking
 	 * one frame from OpenOCD+trace corresponds to 16 trace cycles
 	 */
 	trace_data = malloc(sizeof(u8) * num_frames * 16);
@@ -209,13 +209,13 @@
 
 	etm_ctx->trace_depth = num_frames * 16;
 	etm_ctx->trace_data = malloc(sizeof(etmv1_trace_data_t) * etm_ctx->trace_depth);
-	
+
 	for (i = 0; i < num_frames * 16; i++)
 	{
 		etm_ctx->trace_data[i].pipestat = (trace_data[i] & 0x7);
 		etm_ctx->trace_data[i].packet = (trace_data[i] & 0x78) >> 3;
 		etm_ctx->trace_data[i].flags = 0;
-		
+
 		if ((trace_data[i] & 0x80) >> 7)
 		{
 			etm_ctx->trace_data[i].flags |= ETMV1_TRACESYNC_CYCLE;
@@ -227,7 +227,7 @@
 			etm_ctx->trace_data[i].flags |= ETMV1_TRIGGER_CYCLE;
 		}
 	}
-	
+
 	free(trace_data);
 
 	return ERROR_OK;
@@ -238,19 +238,19 @@
 	oocd_trace_t *oocd_trace = etm_ctx->capture_driver_priv;
 	u32 control = 0x1;	/* 0x1: enabled */
 	u32 trigger_count;
-	
+
 	if (((etm_ctx->portmode & ETM_PORT_MODE_MASK) != ETM_PORT_NORMAL)
 		|| ((etm_ctx->portmode & ETM_PORT_WIDTH_MASK) != ETM_PORT_4BIT))
 	{
 		LOG_DEBUG("OpenOCD+trace only supports normal 4-bit ETM mode");
 		return ERROR_ETM_PORTMODE_NOT_SUPPORTED;
 	}
-	
+
 	if ((etm_ctx->portmode & ETM_PORT_CLOCK_MASK) == ETM_PORT_HALF_CLOCK)
 	{
 		control |= 0x2;	/* half rate clock, capture at twice the clock rate */
 	}
-	
+
 	/* OpenOCD+trace holds up to 16 million samples,
 	 * but trigger counts is set in multiples of 16 */
 	trigger_count = (1048576 * etm_ctx->trigger_percent) / 100;
@@ -259,22 +259,22 @@
 	oocd_trace_write_reg(oocd_trace, OOCD_TRACE_ADDRESS, 0x0);
 	oocd_trace_write_reg(oocd_trace, OOCD_TRACE_TRIGGER_COUNTER, trigger_count);
 	oocd_trace_write_reg(oocd_trace, OOCD_TRACE_CONTROL, control);
-	
+
 	/* we're starting a new trace, initialize capture status */
 	etm_ctx->capture_status = TRACE_RUNNING;
-	
-	return ERROR_OK; 
+
+	return ERROR_OK;
 }
 
 static int oocd_trace_stop_capture(etm_context_t *etm_ctx)
 {
 	oocd_trace_t *oocd_trace = etm_ctx->capture_driver_priv;
 
-	/* trace stopped, just clear running flag, but preserve others */ 
+	/* trace stopped, just clear running flag, but preserve others */
 	etm_ctx->capture_status &= ~TRACE_RUNNING;
-	
+
 	oocd_trace_write_reg(oocd_trace, OOCD_TRACE_CONTROL, 0x0);
-	
+
 	return ERROR_OK;
 }
 
@@ -294,28 +294,28 @@
 	target_t *target;
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
-	
+
 	if (argc != 2)
 	{
 		LOG_ERROR("incomplete 'oocd_trace config <target> <tty>' command");
 		exit(-1);
 	}
-	
+
 	target = get_current_target(cmd_ctx);
-	
+
 	if (arm7_9_get_arch_pointers(target, &armv4_5, &arm7_9) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM7/ARM9 target");
 		return ERROR_OK;
 	}
-	
+
 	if (arm7_9->etm_ctx)
 	{
 		oocd_trace_t *oocd_trace = malloc(sizeof(oocd_trace_t));
-		
+
 		arm7_9->etm_ctx->capture_driver_priv = oocd_trace;
 		oocd_trace->etm_ctx = arm7_9->etm_ctx;
-		
+
 		/* copy name of TTY device used to communicate with OpenOCD+trace */
 		oocd_trace->tty = strndup(args[1], 256);
 	}
@@ -334,36 +334,36 @@
 	arm7_9_common_t *arm7_9;
 	oocd_trace_t *oocd_trace;
 	u32 status;
-	
+
 	target = get_current_target(cmd_ctx);
-	
+
 	if (arm7_9_get_arch_pointers(target, &armv4_5, &arm7_9) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM7/ARM9 target");
 		return ERROR_OK;
 	}
-	
+
 	if (!arm7_9->etm_ctx)
 	{
 		command_print(cmd_ctx, "current target doesn't have an ETM configured");
 		return ERROR_OK;
 	}
-	
+
 	if (strcmp(arm7_9->etm_ctx->capture_driver->name, "oocd_trace") != 0)
 	{
 		command_print(cmd_ctx, "current target's ETM capture driver isn't 'oocd_trace'");
 		return ERROR_OK;
 	}
-	
+
 	oocd_trace = (oocd_trace_t*)arm7_9->etm_ctx->capture_driver_priv;
-	
+
 	oocd_trace_read_reg(oocd_trace, OOCD_TRACE_STATUS, &status);
-	
+
 	if (status & 0x8)
 		command_print(cmd_ctx, "trace clock locked");
 	else
 		command_print(cmd_ctx, "no trace clock");
-		
+
 	return ERROR_OK;
 }
 
@@ -375,33 +375,33 @@
 	oocd_trace_t *oocd_trace;
 	size_t bytes_written;
 	u8 cmd_array[1];
-	
+
 	target = get_current_target(cmd_ctx);
-	
+
 	if (arm7_9_get_arch_pointers(target, &armv4_5, &arm7_9) != ERROR_OK)
 	{
 		command_print(cmd_ctx, "current target isn't an ARM7/ARM9 target");
 		return ERROR_OK;
 	}
-	
+
 	if (!arm7_9->etm_ctx)
 	{
 		command_print(cmd_ctx, "current target doesn't have an ETM configured");
 		return ERROR_OK;
 	}
-	
+
 	if (strcmp(arm7_9->etm_ctx->capture_driver->name, "oocd_trace") != 0)
 	{
 		command_print(cmd_ctx, "current target's ETM capture driver isn't 'oocd_trace'");
 		return ERROR_OK;
 	}
-	
+
 	oocd_trace = (oocd_trace_t*)arm7_9->etm_ctx->capture_driver_priv;
-	
+
 	cmd_array[0] = 0xf0;
 
 	bytes_written = write(oocd_trace->tty_fd, cmd_array, 1);
-	
+
 	command_print(cmd_ctx, "requesting traceclock resync");
 	LOG_DEBUG("resyncing traceclk pll");
 
@@ -411,9 +411,9 @@
 int oocd_trace_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *oocd_trace_cmd;
-	
+
 	oocd_trace_cmd = register_command(cmd_ctx, NULL, "oocd_trace", NULL, COMMAND_ANY, "OpenOCD+trace");
-	
+
 	register_command(cmd_ctx, oocd_trace_cmd, "config", handle_oocd_trace_config_command, COMMAND_CONFIG, NULL);
 
 	register_command(cmd_ctx, oocd_trace_cmd, "status", handle_oocd_trace_status_command, COMMAND_EXEC, "display OpenOCD+trace status");



From oharboe at mail.berlios.de  Sat May 30 09:53:45 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 30 May 2009 09:53:45 +0200
Subject: [Openocd-svn] r1947 - trunk/doc
Message-ID: <200905300753.n4U7rjX8028399@sheep.berlios.de>

Author: oharboe
Date: 2009-05-30 09:53:40 +0200 (Sat, 30 May 2009)
New Revision: 1947

Modified:
   trunk/doc/openocd.texi
Log:
more reset_config texts

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-30 01:44:22 UTC (rev 1946)
+++ trunk/doc/openocd.texi	2009-05-30 07:53:40 UTC (rev 1947)
@@ -1699,8 +1699,21 @@
 
 @deffn {Command} reset_config mode_flag ...
 This command tells OpenOCD the reset configuration
-of your combination of JTAG interface, board, and target.
+of your combination of JTAG board and target in target
+configuration scripts.
 
+If you have an interface that does not support SRST and
+TRST(unlikely), then you may be able to work around that
+problem by using a reset_config command to override any
+settings in the target configuration script.
+
+SRST and TRST has a fairly well understood definition and
+behaviour in the JTAG specification, but vendors take
+liberties to achieve various more or less clearly understood
+goals. Sometimes documentation is available, other times it
+is not. OpenOCD has the reset_config command to allow OpenOCD
+to deal with the various common cases.
+
 The @var{mode_flag} options can be specified in any order, but only one
 of each type -- @var{signals}, @var{combination}, @var{trst_type},
 and @var{srst_type} -- may be specified at a time.



From oharboe at mail.berlios.de  Sat May 30 09:56:22 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 30 May 2009 09:56:22 +0200
Subject: [Openocd-svn] r1948 - trunk/doc
Message-ID: <200905300756.n4U7uMGV028545@sheep.berlios.de>

Author: oharboe
Date: 2009-05-30 09:56:14 +0200 (Sat, 30 May 2009)
New Revision: 1948

Modified:
   trunk/doc/openocd.texi
Log:
added some comments on meminfo command

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-05-30 07:53:40 UTC (rev 1947)
+++ trunk/doc/openocd.texi	2009-05-30 07:56:14 UTC (rev 1948)
@@ -3488,7 +3488,9 @@
 @section Memory access commands
 @anchor{Memory access}
 @subsection meminfo
-display available RAM memory.
+display available RAM memory on OpenOCD host. Used in OpenOCD regression testing scripts. Mainly
+useful on embedded targets, PC type hosts have complimentary tools like Valgrind to address
+resource tracking problems.
 @subsection Memory peek/poke type commands
 These commands allow accesses of a specific size to the memory
 system. Often these are used to configure the current target in some



From oharboe at mail.berlios.de  Sat May 30 13:37:25 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 30 May 2009 13:37:25 +0200
Subject: [Openocd-svn] r1949 - in trunk/src/jtag: . rlink
Message-ID: <200905301137.n4UBbPbB029971@sheep.berlios.de>

Author: oharboe
Date: 2009-05-30 13:37:21 +0200 (Sat, 30 May 2009)
New Revision: 1949

Modified:
   trunk/src/jtag/amt_jtagaccel.c
   trunk/src/jtag/arm-jtag-ew.c
   trunk/src/jtag/bitbang.c
   trunk/src/jtag/bitq.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/jlink.c
   trunk/src/jtag/rlink/rlink.c
   trunk/src/jtag/usbprog.c
   trunk/src/jtag/vsllink.c
Log:
remove unused JTAG_END_STATE

Modified: trunk/src/jtag/amt_jtagaccel.c
===================================================================
--- trunk/src/jtag/amt_jtagaccel.c	2009-05-30 07:56:14 UTC (rev 1948)
+++ trunk/src/jtag/amt_jtagaccel.c	2009-05-30 11:37:21 UTC (rev 1949)
@@ -332,13 +332,6 @@
 	{
 		switch (cmd->type)
 		{
-			case JTAG_END_STATE:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG("end_state: %i", cmd->cmd.end_state->end_state);
-#endif
-				if (cmd->cmd.end_state->end_state != TAP_INVALID)
-					amt_jtagaccel_end_state(cmd->cmd.end_state->end_state);
-				break;
 			case JTAG_RESET:
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);

Modified: trunk/src/jtag/arm-jtag-ew.c
===================================================================
--- trunk/src/jtag/arm-jtag-ew.c	2009-05-30 07:56:14 UTC (rev 1948)
+++ trunk/src/jtag/arm-jtag-ew.c	2009-05-30 11:37:21 UTC (rev 1949)
@@ -133,15 +133,6 @@
 	{
 		switch (cmd->type)
 		{
-			case JTAG_END_STATE:
-				DEBUG_JTAG_IO("end_state: %i", cmd->cmd.end_state->end_state);
-
-				if (cmd->cmd.end_state->end_state != TAP_INVALID)
-				{
-					armjtagew_end_state(cmd->cmd.end_state->end_state);
-				}
-				break;
-
 			case JTAG_RUNTEST:
 				DEBUG_JTAG_IO( "runtest %i cycles, end in %i", cmd->cmd.runtest->num_cycles, \
 					cmd->cmd.runtest->end_state);

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2009-05-30 07:56:14 UTC (rev 1948)
+++ trunk/src/jtag/bitbang.c	2009-05-30 11:37:21 UTC (rev 1949)
@@ -253,13 +253,6 @@
 	{
 		switch (cmd->type)
 		{
-			case JTAG_END_STATE:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG("end_state: %s", tap_state_name(cmd->cmd.end_state->end_state) );
-#endif
-				if (cmd->cmd.end_state->end_state != TAP_INVALID)
-					bitbang_end_state(cmd->cmd.end_state->end_state);
-				break;
 			case JTAG_RESET:
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2009-05-30 07:56:14 UTC (rev 1948)
+++ trunk/src/jtag/bitq.c	2009-05-30 11:37:21 UTC (rev 1949)
@@ -296,13 +296,6 @@
 	{
 		switch (cmd->type)
 		{
-		case JTAG_END_STATE:
-#ifdef _DEBUG_JTAG_IO_
-			LOG_DEBUG("end_state: %i", cmd->cmd.end_state->end_state);
-#endif
-			bitq_end_state(cmd->cmd.end_state->end_state);
-			break;
-
 		case JTAG_RESET:
 #ifdef _DEBUG_JTAG_IO_
 			LOG_DEBUG("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2009-05-30 07:56:14 UTC (rev 1948)
+++ trunk/src/jtag/gw16012.c	2009-05-30 11:37:21 UTC (rev 1949)
@@ -354,13 +354,6 @@
 	{
 		switch (cmd->type)
 		{
-			case JTAG_END_STATE:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG("end_state: %i", cmd->cmd.end_state->end_state);
-#endif
-				if (cmd->cmd.end_state->end_state != TAP_INVALID)
-					gw16012_end_state(cmd->cmd.end_state->end_state);
-				break;
 			case JTAG_RESET:
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-05-30 07:56:14 UTC (rev 1948)
+++ trunk/src/jtag/jlink.c	2009-05-30 11:37:21 UTC (rev 1949)
@@ -234,7 +234,6 @@
 {
 	switch (cmd->type)
 	{
-	case JTAG_END_STATE: jlink_execute_end_state(cmd); break;
 	case JTAG_RUNTEST:   jlink_execute_runtest(cmd); break;
 	case JTAG_STATEMOVE: jlink_execute_statemove(cmd); break;
 	case JTAG_PATHMOVE:  jlink_execute_pathmove(cmd); break;

Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2009-05-30 07:56:14 UTC (rev 1948)
+++ trunk/src/jtag/rlink/rlink.c	2009-05-30 11:37:21 UTC (rev 1949)
@@ -1399,7 +1399,6 @@
 	{
 		switch (cmd->type)
 		{
-			case JTAG_END_STATE:
 			case JTAG_RUNTEST:
 			case JTAG_STATEMOVE:
 			case JTAG_PATHMOVE:
@@ -1415,13 +1414,6 @@
 
 		switch (cmd->type)
 		{
-			case JTAG_END_STATE:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG("end_state: %i", cmd->cmd.end_state->end_state);
-#endif
-				if (cmd->cmd.end_state->end_state != -1)
-					rlink_end_state(cmd->cmd.end_state->end_state);
-				break;
 			case JTAG_RESET:
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2009-05-30 07:56:14 UTC (rev 1948)
+++ trunk/src/jtag/usbprog.c	2009-05-30 11:37:21 UTC (rev 1949)
@@ -135,13 +135,6 @@
 	{
 		switch (cmd->type)
 		{
-			case JTAG_END_STATE:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG("end_state: %i", cmd->cmd.end_state->end_state);
-#endif
-				if (cmd->cmd.end_state->end_state != TAP_INVALID)
-					usbprog_end_state(cmd->cmd.end_state->end_state);
-				break;
 			case JTAG_RESET:
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG("reset trst: %i srst %i", cmd->cmd.reset->trst, cmd->cmd.reset->srst);

Modified: trunk/src/jtag/vsllink.c
===================================================================
--- trunk/src/jtag/vsllink.c	2009-05-30 07:56:14 UTC (rev 1948)
+++ trunk/src/jtag/vsllink.c	2009-05-30 11:37:21 UTC (rev 1949)
@@ -296,15 +296,6 @@
 	{
 		switch (cmd->type)
 		{
-			case JTAG_END_STATE:
-				DEBUG_JTAG_IO("end_state: %s", tap_state_name(cmd->cmd.end_state->end_state));
-			
-				if (cmd->cmd.end_state->end_state != TAP_INVALID)
-				{
-					vsllink_end_state(cmd->cmd.end_state->end_state);
-				}
-				break;
-				
 			case JTAG_RUNTEST:
 				DEBUG_JTAG_IO( "runtest %i cycles, end in %s", cmd->cmd.runtest->num_cycles, \
 					tap_state_name(cmd->cmd.runtest->end_state));



From oharboe at mail.berlios.de  Sat May 30 13:55:15 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sat, 30 May 2009 13:55:15 +0200
Subject: [Openocd-svn] r1950 - trunk/src/jtag
Message-ID: <200905301155.n4UBtFF4010226@sheep.berlios.de>

Author: oharboe
Date: 2009-05-30 13:55:14 +0200 (Sat, 30 May 2009)
New Revision: 1950

Modified:
   trunk/src/jtag/ft2232.c
   trunk/src/jtag/jtag.h
Log:
remove unused JTAG_END_STATE part 2

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-05-30 11:37:21 UTC (rev 1949)
+++ trunk/src/jtag/ft2232.c	2009-05-30 11:55:14 UTC (rev 1950)
@@ -512,7 +512,6 @@
 	}
 }
 
-
 static void ft2232_read_scan(enum scan_type type, u8* buffer, int scan_size)
 {
 	int num_bytes = (scan_size + 7) / 8;
@@ -1412,20 +1411,6 @@
 	LOG_DEBUG("trst: %i, srst: %i, high_output: 0x%2.2x, high_direction: 0x%2.2x", trst, srst, high_output, high_direction);
 }
 
-static int ft2232_execute_end_state(jtag_command_t *cmd)
-{
-	int  retval;
-	retval = ERROR_OK;
-
-	DEBUG_JTAG_IO("execute_end_state: %s", tap_state_name(cmd->cmd.end_state->end_state) );
-
-	if (cmd->cmd.end_state->end_state != TAP_INVALID)
-		ft2232_end_state(cmd->cmd.end_state->end_state);
-
-	return retval;
-}
-
-
 static int ft2232_execute_runtest(jtag_command_t *cmd)
 {
 	int  retval;
@@ -1682,7 +1667,6 @@
 
 	switch (cmd->type)
 	{
-	case JTAG_END_STATE: 	retval = ft2232_execute_end_state(cmd); break;
 	case JTAG_RESET:	 		retval = ft2232_execute_reset(cmd); break;
 	case JTAG_RUNTEST:   	retval = ft2232_execute_runtest(cmd); break;
 	case JTAG_STATEMOVE: 	retval = ft2232_execute_statemove(cmd); break;

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-30 11:37:21 UTC (rev 1949)
+++ trunk/src/jtag/jtag.h	2009-05-30 11:55:14 UTC (rev 1950)
@@ -348,7 +348,6 @@
 	JTAG_STATEMOVE    = 2,
 	JTAG_RUNTEST      = 3,
 	JTAG_RESET        = 4,
-	JTAG_END_STATE    = 5,
 	JTAG_PATHMOVE     = 6,
 	JTAG_SLEEP        = 7,
 	JTAG_STABLECLOCKS = 8



From zwelch at mail.berlios.de  Sat May 30 23:53:14 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 30 May 2009 23:53:14 +0200
Subject: [Openocd-svn] r1951 - trunk/src/jtag
Message-ID: <200905302153.n4ULrEdA002200@sheep.berlios.de>

Author: zwelch
Date: 2009-05-30 23:53:10 +0200 (Sat, 30 May 2009)
New Revision: 1951

Modified:
   trunk/src/jtag/jlink.c
Log:
Remove unused jlink_execute_end_state (unreferenced after r1949).

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-05-30 11:55:14 UTC (rev 1950)
+++ trunk/src/jtag/jlink.c	2009-05-30 21:53:10 UTC (rev 1951)
@@ -150,14 +150,6 @@
 	.quit = jlink_quit
 };
 
-static void jlink_execute_end_state(jtag_command_t *cmd)
-{
-	DEBUG_JTAG_IO("end_state: %i", cmd->cmd.end_state->end_state);
-
-	if (cmd->cmd.end_state->end_state != TAP_INVALID)
-		jlink_end_state(cmd->cmd.end_state->end_state);
-}
-
 static void jlink_execute_runtest(jtag_command_t *cmd)
 {
 	DEBUG_JTAG_IO("runtest %i cycles, end in %i",



From zwelch at mail.berlios.de  Sun May 31 00:23:18 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 00:23:18 +0200
Subject: [Openocd-svn] r1952 - in trunk/src: . jtag
Message-ID: <200905302223.n4UMNI1H005043@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 00:23:12 +0200 (Sun, 31 May 2009)
New Revision: 1952

Modified:
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/openocd.c
Log:
Encapsulate the global "jtag" jtag_interface pointer:
- Add jtag_interface_quit, factored from exit_handler() in openocd.c.
- Remove its extern declaration.
- Add static keyword to its definition.


Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-05-30 21:53:10 UTC (rev 1951)
+++ trunk/src/jtag/jtag.c	2009-05-30 22:23:12 UTC (rev 1952)
@@ -227,7 +227,7 @@
 	NULL,
 };
 
-jtag_interface_t *jtag = NULL;
+static jtag_interface_t *jtag = NULL;
 
 /* configuration */
 static jtag_interface_t *jtag_interface = NULL;
@@ -2407,6 +2407,20 @@
 	return ERROR_OK;
 }
 
+int jtag_interface_quit(void)
+{
+	if (!jtag || !jtag->quit)
+		return ERROR_OK;
+
+	// close the JTAG interface
+	int result = jtag->quit();
+	if (ERROR_OK != result)
+		LOG_ERROR("failed: %d", result);
+
+	return ERROR_OK;
+}
+
+
 int jtag_init_reset(struct command_context_s *cmd_ctx)
 {
 	int retval;

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-05-30 21:53:10 UTC (rev 1951)
+++ trunk/src/jtag/jtag.h	2009-05-30 22:23:12 UTC (rev 1952)
@@ -512,8 +512,6 @@
 
 extern jtag_event_callback_t* jtag_event_callbacks;
 
-extern jtag_interface_t*      jtag; /* global pointer to configured JTAG interface */
-
 extern int jtag_speed;
 extern int jtag_speed_post_reset;
 
@@ -535,6 +533,9 @@
  */
 extern int  jtag_interface_init(struct command_context_s* cmd_ctx);
 
+/// Shutdown the JTAG interface upon program exit.
+extern int  jtag_interface_quit(void);
+
 /* initialize JTAG chain using only a RESET reset. If init fails,
  * try reset + init.
  */

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-05-30 21:53:10 UTC (rev 1951)
+++ trunk/src/openocd.c	2009-05-30 22:23:12 UTC (rev 1952)
@@ -79,9 +79,7 @@
 
 static void exit_handler(void)
 {
-	/* close JTAG interface */
-	if (jtag && jtag->quit)
-		jtag->quit();
+	jtag_interface_quit();
 }
 
 static int log_target_callback_event_handler(struct target_s *target, enum target_event event, void *priv)



From zwelch at mail.berlios.de  Sun May 31 01:57:35 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 01:57:35 +0200
Subject: [Openocd-svn] r1953 - trunk/src/target
Message-ID: <200905302357.n4UNvZEV018799@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 01:57:30 +0200 (Sun, 31 May 2009)
New Revision: 1953

Modified:
   trunk/src/target/target.c
Log:
Eliminate duplicated code in the handle_mw_command memory write loop.
- wordsize will always be 1, 2, or 4 due to preceeding switch statement.
- move call to keep_alive after successful writes, not upon failures


Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-30 22:23:12 UTC (rev 1952)
+++ trunk/src/target/target.c	2009-05-30 23:57:30 UTC (rev 1953)
@@ -1958,27 +1958,11 @@
 	}
 	for (i=0; i<count; i++)
 	{
-		int retval;
-		switch (wordsize)
-		{
-			case 4:
-				retval = target->type->write_memory(target, address + i*wordsize, 4, 1, value_buf);
-				break;
-			case 2:
-				retval = target->type->write_memory(target, address + i*wordsize, 2, 1, value_buf);
-				break;
-			case 1:
-				retval = target->type->write_memory(target, address + i*wordsize, 1, 1, value_buf);
-			break;
-			default:
-			return ERROR_OK;
-		}
-		keep_alive();
-
-		if (retval!=ERROR_OK)
-		{
+		int retval = target->type->write_memory(target,
+				address + i * wordsize, wordsize, 1, value_buf);
+		if (ERROR_OK != retval)
 			return retval;
-		}
+		keep_alive();
 	}
 
 	return ERROR_OK;



From zwelch at mail.berlios.de  Sun May 31 02:49:06 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 02:49:06 +0200
Subject: [Openocd-svn] r1954 - trunk/doc/manual/primer
Message-ID: <200905310049.n4V0n6ot030187@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 02:49:03 +0200 (Sun, 31 May 2009)
New Revision: 1954

Modified:
   trunk/doc/manual/primer/jtag.txt
Log:
Add new JTAG boundary scan primer, with links to BSDL information.

Modified: trunk/doc/manual/primer/jtag.txt
===================================================================
--- trunk/doc/manual/primer/jtag.txt	2009-05-30 23:57:30 UTC (rev 1953)
+++ trunk/doc/manual/primer/jtag.txt	2009-05-31 00:49:03 UTC (rev 1954)
@@ -11,12 +11,10 @@
 Think of JTAG as I2C for testing.  It doesn't define what it can do, 
 just a logical interface that allows a uniform channel for communication.
 
-See:
-
+See @par
 	http://en.wikipedia.org/wiki/Joint_Test_Action_Group
 
-and
-
+and @par
 	http://www.inaccessnetworks.com/projects/ianjtag/jtag-intro/jtag-state-machine-large.png
 
 The first page (among other things) shows a logical representation 
@@ -107,4 +105,64 @@
 registers do, so you can actually do something useful.  That's where it
 gets interesting.  But in and of itself, JTAG is actually very simple.
 
+A separate primer contains information about @subpage primerjtagbs for
+developers that want to extend OpenOCD for such purposes.
+
  */
+/** @page primerjtagbs JTAG Boundary Scan Primer
+
+The following page provides an introduction on JTAG that focuses on its
+boundary scan capabilities: @par
+http://www.engr.udayton.edu/faculty/jloomis/ece446/notes/jtag/jtag1.html
+
+OpenOCD does not presently have clear means of using JTAG for boundary
+scan testing purposes; however, some developers have explored the
+possibilities.  The page contains information that may be useful to
+those wishing to implement boundary scan capabilities in OpenOCD.
+
+ at section primerbsdl The BSDL Language
+
+For more information on the Boundary Scan Description Language (BSDL),
+the following page provides a good introduction: @par
+http://www.radio-electronics.com/info/t_and_m/boundaryscan/bsdl.php
+
+ at section primerbsdlvendors Vendor BSDL Files
+
+NXP LPC: @par
+http://www.standardics.nxp.com/support/models/lpc2000/
+
+Freescale PowerPC: @par
+http://www.freescale.com/webapp/sps/site/overview.jsp?code=DRPPCBSDLFLS
+
+Freescale i.MX1 (too old): @par
+http://www.freescale.com/webapp/sps/site/prod_summary.jsp?code=i.MX1&nodeId=0162468rH311432973ZrDR&fpsp=1&tab=Design_Tools_Tab
+
+Renesas R32C/117: @par
+http://sg.renesas.com/fmwk.jsp?cnt=r32c116_7_8_root.jsp&fp=/products/mpumcu/m16c_family/r32c100_series/r32c116_7_8_group/
+- The device page does not come with BSDL file; you have to register to
+  download them. @par
+  http://www.corelis.com/support/BSDL.htm
+
+TI links theirs right off the generic page for each chip;
+this may be the case for other vendors as well.  For example:
+
+- DaVinci DM355 -- http://www.ti.com/litv/zip/sprm262b
+- DaVinci DM6446
+  - 2.1 silicon -- http://www.ti.com/litv/zip/sprm325a
+  - older silicon -- http://www.ti.com/litv/zip/sprm203
+- OMAP 3530
+  - CBB package -- http://www.ti.com/litv/zip/sprm315b
+    - 515 ball s-PGBA, POP, 0.4mm pitch
+  - CUS package -- http://www.ti.com/litv/zip/sprm314a
+    - 515 ball s-PGBA, POP, 0.5mm pitch
+  - CBC package -- http://www.ti.com/litv/zip/sprm346
+    - 423 ball s-PGBA, 0.65mm pitch
+
+Many other files are available in the "Semiconductor Manufacturer's BSDL
+files" section of the following site: @par
+http://www.freelabs.com/~whitis/electronics/jtag/
+
+ */
+/** @file
+This file contains the @ref primerjtag and @ref bsdl page.
+ */



From zwelch at mail.berlios.de  Sun May 31 03:07:47 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 03:07:47 +0200
Subject: [Openocd-svn] r1955 - trunk/src/jtag
Message-ID: <200905310107.n4V17k5q032307@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 03:07:43 +0200 (Sun, 31 May 2009)
New Revision: 1955

Modified:
   trunk/src/jtag/jlink.c
Log:
Peter Denison <openwrt at marshadder.org>:

The debugging code in jlink_tap_execute() called when _DEBUG_USB_COMMS_ is 
defined was using the entire cached scan length to print the results 
buffers, and not the correct length of each individual buffer.


Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-05-31 00:49:03 UTC (rev 1954)
+++ trunk/src/jtag/jlink.c	2009-05-31 01:07:43 UTC (rev 1955)
@@ -809,7 +809,7 @@
 		DEBUG_JTAG_IO("pending scan result, length = %d", length);
 
 #ifdef _DEBUG_USB_COMMS_
-		jlink_debug_buffer(buffer, byte_length);
+		jlink_debug_buffer(buffer, TAP_SCAN_BYTES(length));
 #endif
 
 		if (jtag_read_buffer(buffer, command) != ERROR_OK)



From zwelch at mail.berlios.de  Sun May 31 04:18:31 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 04:18:31 +0200
Subject: [Openocd-svn] r1956 - trunk/src/target
Message-ID: <200905310218.n4V2IVqv011477@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 04:18:26 +0200 (Sun, 31 May 2009)
New Revision: 1956

Modified:
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Make target_buffer_get_uXX interfaces work with constant buffers.

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 01:07:43 UTC (rev 1955)
+++ trunk/src/target/target.c	2009-05-31 02:18:26 UTC (rev 1956)
@@ -273,7 +273,7 @@
 static int target_continous_poll = 1;
 
 /* read a u32 from a buffer in target memory endianness */
-u32 target_buffer_get_u32(target_t *target, u8 *buffer)
+u32 target_buffer_get_u32(target_t *target, const u8 *buffer)
 {
 	if (target->endianness == TARGET_LITTLE_ENDIAN)
 		return le_to_h_u32(buffer);
@@ -282,7 +282,7 @@
 }
 
 /* read a u16 from a buffer in target memory endianness */
-u16 target_buffer_get_u16(target_t *target, u8 *buffer)
+u16 target_buffer_get_u16(target_t *target, const u8 *buffer)
 {
 	if (target->endianness == TARGET_LITTLE_ENDIAN)
 		return le_to_h_u16(buffer);
@@ -291,7 +291,7 @@
 }
 
 /* read a u8 from a buffer in target memory endianness */
-u8 target_buffer_get_u8(target_t *target, u8 *buffer)
+u8 target_buffer_get_u8(target_t *target, const u8 *buffer)
 {
 	return *buffer & 0x0ff;
 }

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 01:07:43 UTC (rev 1955)
+++ trunk/src/target/target.h	2009-05-31 02:18:26 UTC (rev 1956)
@@ -401,9 +401,9 @@
 extern target_event_callback_t *target_event_callbacks;
 extern target_timer_callback_t *target_timer_callbacks;
 
-extern u32 target_buffer_get_u32(target_t *target, u8 *buffer);
-extern u16 target_buffer_get_u16(target_t *target, u8 *buffer);
-extern u8  target_buffer_get_u8 (target_t *target, u8 *buffer);
+extern u32 target_buffer_get_u32(target_t *target, const u8 *buffer);
+extern u16 target_buffer_get_u16(target_t *target, const u8 *buffer);
+extern u8  target_buffer_get_u8 (target_t *target, const u8 *buffer);
 extern void target_buffer_set_u32(target_t *target, u8 *buffer, u32 value);
 extern void target_buffer_set_u16(target_t *target, u8 *buffer, u16 value);
 extern void target_buffer_set_u8 (target_t *target, u8 *buffer, u8  value);



From zwelch at mail.berlios.de  Sun May 31 06:58:56 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 06:58:56 +0200
Subject: [Openocd-svn] r1957 - trunk/src/target
Message-ID: <200905310458.n4V4wuk1032230@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 06:58:51 +0200 (Sun, 31 May 2009)
New Revision: 1957

Modified:
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Make nvp_target_event static; remove its external declaration.

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 02:18:26 UTC (rev 1956)
+++ trunk/src/target/target.c	2009-05-31 04:58:51 UTC (rev 1957)
@@ -150,7 +150,7 @@
 	}
 }
 
-const Jim_Nvp nvp_target_event[] = {
+static const Jim_Nvp nvp_target_event[] = {
 	{ .value = TARGET_EVENT_OLD_gdb_program_config , .name = "old-gdb_program_config" },
 	{ .value = TARGET_EVENT_OLD_pre_resume         , .name = "old-pre_resume" },
 

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 02:18:26 UTC (rev 1956)
+++ trunk/src/target/target.h	2009-05-31 04:58:51 UTC (rev 1957)
@@ -318,8 +318,6 @@
 	TARGET_EVENT_GDB_FLASH_WRITE_END,
 };
 
-extern const Jim_Nvp nvp_target_event[];
-
 struct target_event_action_s {
 	enum target_event event;
 	Jim_Obj *body;



From zwelch at mail.berlios.de  Sun May 31 08:00:32 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 08:00:32 +0200
Subject: [Openocd-svn] r1958 - trunk/src/target
Message-ID: <200905310600.n4V60WVU031719@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 08:00:28 +0200 (Sun, 31 May 2009)
New Revision: 1958

Modified:
   trunk/src/target/target.c
Log:
Simplify the handle_md_command routine in target.c:
 - fix buffer overrun in mdw; final '\0' would overflow the output buffer.
 - return ERROR_COMMAND_SYNTAX_ERROR instead of ERROR_OK if:
   - less than one argument is provided
   - the command is called with a name other than mdb, mdh, or mdw.
 - factor all command output into new handle_md_output function


Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 04:58:51 UTC (rev 1957)
+++ trunk/src/target/target.c	2009-05-31 06:00:28 UTC (rev 1958)
@@ -1844,77 +1844,80 @@
 	return ERROR_OK;
 }
 
-static int handle_md_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static void handle_md_output(struct command_context_s *cmd_ctx,
+		struct target_s *target, u32 address, unsigned size,
+		unsigned count, const u8 *buffer)
 {
-	const int line_bytecnt = 32;
-	int count = 1;
-	int size = 4;
-	u32 address = 0;
-	int line_modulo;
-	int i;
+	const unsigned line_bytecnt = 32;
+	unsigned line_modulo = line_bytecnt / size;
 
-	char output[128];
-	int output_len;
+	char output[line_bytecnt * 4 + 1];
+	unsigned output_len = 0;
 
-	int retval;
+	const char *value_fmt;
+	switch (size) {
+	case 4: value_fmt = "%8.8x"; break;
+	case 2: value_fmt = "%4.2x"; break;
+	case 1: value_fmt = "%2.2x"; break;
+	default:
+		LOG_ERROR("invalid memory read size: %u", size);
+		exit(-1);
+	}
 
-	u8 *buffer;
-	target_t *target = get_current_target(cmd_ctx);
+	for (unsigned i = 0; i < count; i++)
+	{
+		if (i % line_modulo == 0)
+		{
+			output_len += snprintf(output + output_len,
+					sizeof(output) - output_len,
+					"0x%8.8x: ", address + (i*size));
+		}
 
-	if (argc < 1)
-		return ERROR_OK;
+		u32 value;
+		const u8 *value_ptr = buffer + i * size;
+		switch (size) {
+		case 4: value = target_buffer_get_u32(target, value_ptr); break;
+		case 2: value = target_buffer_get_u16(target, value_ptr); break;
+		case 1: value = *value_ptr;
+		}
+		output_len += snprintf(output + output_len,
+				sizeof(output) - output_len,
+				value_fmt, value);
 
-	if (argc == 2)
-		count = strtoul(args[1], NULL, 0);
+		if ((i % line_modulo == line_modulo - 1) || (i == count - 1))
+		{
+			command_print(cmd_ctx, "%s", output);
+			output_len = 0;
+		}
+	}
+}
 
-	address = strtoul(args[0], NULL, 0);
+static int handle_md_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc < 1)
+		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	switch (cmd[2])
-	{
-		case 'w':
-			size = 4; line_modulo = line_bytecnt / 4;
-			break;
-		case 'h':
-			size = 2; line_modulo = line_bytecnt / 2;
-			break;
-		case 'b':
-			size = 1; line_modulo = line_bytecnt / 1;
-			break;
-		default:
-			return ERROR_OK;
+	unsigned size = 0;
+	switch (cmd[2]) {
+	case 'w': size = 4; break;
+	case 'h': size = 2; break;
+	case 'b': size = 1; break;
+	default: return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	buffer = calloc(count, size);
-	retval  = target->type->read_memory(target, address, size, count, buffer);
-	if (retval == ERROR_OK)
-	{
-		output_len = 0;
+	u32 address = strtoul(args[0], NULL, 0);
 
-		for (i = 0; i < count; i++)
-		{
-			if (i%line_modulo == 0)
-				output_len += snprintf(output + output_len, 128 - output_len, "0x%8.8x: ", address + (i*size));
+	unsigned count = 1;
+	if (argc == 2)
+		count = strtoul(args[1], NULL, 0);
 
-			switch (size)
-			{
-				case 4:
-					output_len += snprintf(output + output_len, 128 - output_len, "%8.8x ", target_buffer_get_u32(target, &buffer[i*4]));
-					break;
-				case 2:
-					output_len += snprintf(output + output_len, 128 - output_len, "%4.4x ", target_buffer_get_u16(target, &buffer[i*2]));
-					break;
-				case 1:
-					output_len += snprintf(output + output_len, 128 - output_len, "%2.2x ", buffer[i*1]);
-					break;
-			}
+	u8 *buffer = calloc(count, size);
 
-			if ((i%line_modulo == line_modulo-1) || (i == count - 1))
-			{
-				command_print(cmd_ctx, "%s", output);
-				output_len = 0;
-			}
-		}
-	}
+	target_t *target = get_current_target(cmd_ctx);
+	int retval = target->type->read_memory(target,
+				address, size, count, buffer);
+	if (ERROR_OK == retval)
+		handle_md_output(cmd_ctx, target, address, size, count, buffer);
 
 	free(buffer);
 



From zwelch at mail.berlios.de  Sun May 31 11:37:50 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 11:37:50 +0200
Subject: [Openocd-svn] r1959 - in trunk/src: flash target
Message-ID: <200905310937.n4V9bo09014164@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 11:37:35 +0200 (Sun, 31 May 2009)
New Revision: 1959

Modified:
   trunk/src/flash/at91sam7.c
   trunk/src/flash/cfi.c
   trunk/src/flash/flash.c
   trunk/src/flash/lpc3180_nand_controller.c
   trunk/src/flash/mflash.c
   trunk/src/target/arm7_9_common.c
   trunk/src/target/cortex_m3.c
   trunk/src/target/mips_m4k.c
   trunk/src/target/target.c
   trunk/src/target/target.h
   trunk/src/target/xscale.c
Log:
Add target_read_memory wrapper:
- replaces all calls to target->type->read_memory.
- add documentation in target_s to warn not to invoke callback directly.


Modified: trunk/src/flash/at91sam7.c
===================================================================
--- trunk/src/flash/at91sam7.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/flash/at91sam7.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -665,7 +665,7 @@
 	for (nSector=0; nSector<bank->num_sectors; nSector++)
 	{
 		bank->sectors[nSector].is_erased = 1;
-		retval = target->type->read_memory(target, bank->base+bank->sectors[nSector].offset, 4,
+		retval = target_read_memory(target, bank->base+bank->sectors[nSector].offset, 4,
 			bank->sectors[nSector].size/4, buffer);
 		if (retval != ERROR_OK)
 			return retval;

Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/flash/cfi.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -166,7 +166,7 @@
 	target_t *target = bank->target;
 	u8 data[CFI_MAX_BUS_WIDTH];
 
-	target->type->read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 1, data);
+	target_read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 1, data);
 
 	if (bank->target->endianness == TARGET_LITTLE_ENDIAN)
 		return data[0];
@@ -184,7 +184,7 @@
 	u8 data[CFI_MAX_BUS_WIDTH];
 	int i;
 
-	target->type->read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 1, data);
+	target_read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 1, data);
 
 	if (bank->target->endianness == TARGET_LITTLE_ENDIAN)
 	{
@@ -213,11 +213,11 @@
 	{
 		u8 i;
 		for(i=0;i<2;i++)
-			target->type->read_memory(target, flash_address(bank, sector, offset+i), bank->bus_width, 1,
+			target_read_memory(target, flash_address(bank, sector, offset+i), bank->bus_width, 1,
 				&data[i*bank->bus_width] );
 	}
 	else
-		target->type->read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 2, data);
+		target_read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 2, data);
 
 	if (bank->target->endianness == TARGET_LITTLE_ENDIAN)
 		return data[0] | data[bank->bus_width] << 8;
@@ -235,11 +235,11 @@
 	{
 		u8 i;
 		for(i=0;i<4;i++)
-			target->type->read_memory(target, flash_address(bank, sector, offset+i), bank->bus_width, 1,
+			target_read_memory(target, flash_address(bank, sector, offset+i), bank->bus_width, 1,
 				&data[i*bank->bus_width] );
 	}
 	else
-		target->type->read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 4, data);
+		target_read_memory(target, flash_address(bank, sector, offset), bank->bus_width, 4, data);
 
 	if (bank->target->endianness == TARGET_LITTLE_ENDIAN)
 		return data[0] | data[bank->bus_width] << 8 | data[bank->bus_width * 2] << 16 | data[bank->bus_width * 3] << 24;
@@ -1889,7 +1889,7 @@
 		for (i = 0; i < align; ++i, ++copy_p)
 		{
 			u8 byte;
-			if((retval = target->type->read_memory(target, copy_p, 1, 1, &byte)) != ERROR_OK)
+			if((retval = target_read_memory(target, copy_p, 1, 1, &byte)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -1908,7 +1908,7 @@
 		for (; (count == 0) && (i < bank->bus_width); ++i, ++copy_p)
 		{
 			u8 byte;
-			if((retval = target->type->read_memory(target, copy_p, 1, 1, &byte)) != ERROR_OK)
+			if((retval = target_read_memory(target, copy_p, 1, 1, &byte)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -2039,7 +2039,7 @@
 		for (; i < bank->bus_width; ++i, ++copy_p)
 		{
 			u8 byte;
-			if((retval = target->type->read_memory(target, copy_p, 1, 1, &byte)) != ERROR_OK)
+			if((retval = target_read_memory(target, copy_p, 1, 1, &byte)) != ERROR_OK)
 			{
 				return retval;
 			}

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/flash/flash.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -1157,7 +1157,7 @@
 				chunk = (j - bank->sectors[i].size);
 			}
 
-			retval = target->type->read_memory(target, bank->base + bank->sectors[i].offset + j, 4, chunk/4, buffer);
+			retval = target_read_memory(target, bank->base + bank->sectors[i].offset + j, 4, chunk/4, buffer);
 			if (retval != ERROR_OK)
 				return retval;
 

Modified: trunk/src/flash/lpc3180_nand_controller.c
===================================================================
--- trunk/src/flash/lpc3180_nand_controller.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/flash/lpc3180_nand_controller.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -759,12 +759,12 @@
 
 			if (data)
 			{
-				target->type->read_memory(target, 0x200a8000, 4, 128, page_buffer + page_bytes_done);
+				target_read_memory(target, 0x200a8000, 4, 128, page_buffer + page_bytes_done);
 			}
 
 			if (oob)
 			{
-				target->type->read_memory(target, 0x200a8000, 4, 4, oob_buffer + oob_bytes_done);
+				target_read_memory(target, 0x200a8000, 4, 4, oob_buffer + oob_bytes_done);
 			}
 
 			page_bytes_done += 512;

Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/flash/mflash.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -345,7 +345,7 @@
 	if (! mflash_bank->drv_info)
 		mflash_bank->drv_info = malloc(sizeof(mg_drv_info_t));
 
-	target->type->read_memory(target, mg_buff, 2, sizeof(mg_io_type_drv_info) >> 1,
+	target_read_memory(target, mg_buff, 2, sizeof(mg_io_type_drv_info) >> 1,
 			(u8 *)&mflash_bank->drv_info->drv_id);
 
 	mflash_bank->drv_info->tot_sects = (u32)(mflash_bank->drv_info->drv_id.total_user_addressable_sectors_hi << 16)
@@ -428,7 +428,7 @@
 	for (i = 0; i < sect_cnt; i++) {
 		mg_dsk_wait(mg_io_wait_drq, MG_OEM_DISK_WAIT_TIME_NORMAL);
 
-		target->type->read_memory(target, address, 2, MG_MFLASH_SECTOR_SIZE / 2, buff_ptr);
+		target_read_memory(target, address, 2, MG_MFLASH_SECTOR_SIZE / 2, buff_ptr);
 		buff_ptr += MG_MFLASH_SECTOR_SIZE;
 
 		target_write_u8(target, mflash_bank->base + MG_REG_OFFSET + MG_REG_COMMAND, mg_io_cmd_confirm_read);
@@ -932,7 +932,7 @@
 
 		memset(buff, 0xff, MG_MFLASH_SECTOR_SIZE);
 
-		target->type->read_memory(target, address, 2,
+		target_read_memory(target, address, 2,
 				MG_MFLASH_SECTOR_SIZE / 2, (u8 *)buff);
 
 		for (i = 0; i < MG_MFLASH_SECTOR_SIZE >> 1; i++) {

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/target/arm7_9_common.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -274,7 +274,7 @@
 		{
 			u32 verify = 0xffffffff;
 			/* keep the original instruction in target endianness */
-			if ((retval = target->type->read_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if ((retval = target_read_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -298,7 +298,7 @@
 		{
 			u16 verify = 0xffff;
 			/* keep the original instruction in target endianness */
-			if ((retval = target->type->read_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if ((retval = target_read_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -373,7 +373,7 @@
 		{
 			u32 current_instr;
 			/* check that user program as not modified breakpoint instruction */
-			if ((retval = target->type->read_memory(target, breakpoint->address, 4, 1, (u8*)&current_instr)) != ERROR_OK)
+			if ((retval = target_read_memory(target, breakpoint->address, 4, 1, (u8*)&current_instr)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -387,7 +387,7 @@
 		{
 			u16 current_instr;
 			/* check that user program as not modified breakpoint instruction */
-			if ((retval = target->type->read_memory(target, breakpoint->address, 2, 1, (u8*)&current_instr)) != ERROR_OK)
+			if ((retval = target_read_memory(target, breakpoint->address, 2, 1, (u8*)&current_instr)) != ERROR_OK)
 			{
 				return retval;
 			}

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/target/cortex_m3.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -930,7 +930,7 @@
 	{
 		u8 code[4];
 		buf_set_u32(code, 0, 32, ARMV7M_T_BKPT(0x11));
-		if((retval = target->type->read_memory(target, breakpoint->address & 0xFFFFFFFE, breakpoint->length, 1, breakpoint->orig_instr)) != ERROR_OK)
+		if((retval = target_read_memory(target, breakpoint->address & 0xFFFFFFFE, breakpoint->length, 1, breakpoint->orig_instr)) != ERROR_OK)
 		{
 			return retval;
 		}

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/target/mips_m4k.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -529,7 +529,7 @@
 		{
 			u32 verify = 0xffffffff;
 			
-			if((retval = target->type->read_memory(target, breakpoint->address, breakpoint->length, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if((retval = target_read_memory(target, breakpoint->address, breakpoint->length, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -552,7 +552,7 @@
 		{
 			u16 verify = 0xffff;
 			
-			if((retval = target->type->read_memory(target, breakpoint->address, breakpoint->length, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if((retval = target_read_memory(target, breakpoint->address, breakpoint->length, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -611,7 +611,7 @@
 			u32 current_instr;
 			
 			/* check that user program has not modified breakpoint instruction */
-			if ((retval = target->type->read_memory(target, breakpoint->address, 4, 1, (u8*)&current_instr)) != ERROR_OK)
+			if ((retval = target_read_memory(target, breakpoint->address, 4, 1, (u8*)&current_instr)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -628,7 +628,7 @@
 			u16 current_instr;
 			
 			/* check that user program has not modified breakpoint instruction */
-			if ((retval = target->type->read_memory(target, breakpoint->address, 2, 1, (u8*)&current_instr)) != ERROR_OK)
+			if ((retval = target_read_memory(target, breakpoint->address, 2, 1, (u8*)&current_instr)) != ERROR_OK)
 			{
 				return retval;
 			}

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/target/target.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -525,6 +525,12 @@
 	return target->type->run_algorithm_imp(target, num_mem_params, mem_params, num_reg_params, reg_param, entry_point, exit_point, timeout_ms, arch_info);
 }
 
+int target_read_memory(struct target_s *target,
+		u32 address, u32 size, u32 count, u8 *buffer)
+{
+	return target->type->read_memory(target, address, size, count, buffer);
+}
+
 int target_init(struct command_context_s *cmd_ctx)
 {
 	target_t *target = all_targets;
@@ -858,7 +864,7 @@
 		{
 			int retval;
 			new_wa->backup = malloc(new_wa->size);
-			if((retval = target->type->read_memory(target, new_wa->address, 4, new_wa->size / 4, new_wa->backup)) != ERROR_OK)
+			if((retval = target_read_memory(target, new_wa->address, 4, new_wa->size / 4, new_wa->backup)) != ERROR_OK)
 			{
 				free(new_wa->backup);
 				free(new_wa);
@@ -1077,7 +1083,7 @@
 
 	if (((address % 2) == 0) && (size == 2))
 	{
-		return target->type->read_memory(target, address, 2, 1, buffer);
+		return target_read_memory(target, address, 2, 1, buffer);
 	}
 
 	/* handle unaligned head bytes */
@@ -1088,7 +1094,7 @@
 		if (unaligned > size)
 			unaligned = size;
 
-		if ((retval = target->type->read_memory(target, address, 1, unaligned, buffer)) != ERROR_OK)
+		if ((retval = target_read_memory(target, address, 1, unaligned, buffer)) != ERROR_OK)
 			return retval;
 
 		buffer += unaligned;
@@ -1101,7 +1107,7 @@
 	{
 		int aligned = size - (size % 4);
 
-		if ((retval = target->type->read_memory(target, address, 4, aligned / 4, buffer)) != ERROR_OK)
+		if ((retval = target_read_memory(target, address, 4, aligned / 4, buffer)) != ERROR_OK)
 			return retval;
 
 		buffer += aligned;
@@ -1112,7 +1118,7 @@
 	/* handle tail writes of less than 4 bytes */
 	if (size > 0)
 	{
-		if ((retval = target->type->read_memory(target, address, 1, size, buffer)) != ERROR_OK)
+		if ((retval = target_read_memory(target, address, 1, size, buffer)) != ERROR_OK)
 			return retval;
 	}
 
@@ -1190,7 +1196,7 @@
 		return ERROR_FAIL;
 	}
 
-	int retval = target->type->read_memory(target, address, 4, 1, value_buf);
+	int retval = target_read_memory(target, address, 4, 1, value_buf);
 
 	if (retval == ERROR_OK)
 	{
@@ -1215,7 +1221,7 @@
 		return ERROR_FAIL;
 	}
 
-	int retval = target->type->read_memory(target, address, 2, 1, value_buf);
+	int retval = target_read_memory(target, address, 2, 1, value_buf);
 
 	if (retval == ERROR_OK)
 	{
@@ -1233,7 +1239,7 @@
 
 int target_read_u8(struct target_s *target, u32 address, u8 *value)
 {
-	int retval = target->type->read_memory(target, address, 1, 1, value);
+	int retval = target_read_memory(target, address, 1, 1, value);
 	if (!target->type->examined)
 	{
 		LOG_ERROR("Target not examined yet");
@@ -1914,7 +1920,7 @@
 	u8 *buffer = calloc(count, size);
 
 	target_t *target = get_current_target(cmd_ctx);
-	int retval = target->type->read_memory(target,
+	int retval = target_read_memory(target,
 				address, size, count, buffer);
 	if (ERROR_OK == retval)
 		handle_md_output(cmd_ctx, target, address, size, count, buffer);
@@ -2256,7 +2262,7 @@
 					size *= 4;
 					count /= 4;
 				}
-				retval = target->type->read_memory(target, image.sections[i].base_address, size, count, data);
+				retval = target_read_memory(target, image.sections[i].base_address, size, count, data);
 				if (retval == ERROR_OK)
 				{
 					u32 t;
@@ -2829,7 +2835,7 @@
 			count = (sizeof(buffer)/width);
 		}
 
-		retval = target->type->read_memory( target, addr, width, count, buffer );
+		retval = target_read_memory( target, addr, width, count, buffer );
 		if (retval != ERROR_OK) {
 			/* BOO !*/
 			LOG_ERROR("mem2array: Read @ 0x%08x, w=%d, cnt=%d, failed", addr, width, count);
@@ -3575,7 +3581,7 @@
 			if( y > 16 ){
 				y = 16;
 			}
-			e = target->type->read_memory( target, a, b, y / b, target_buf );
+			e = target_read_memory( target, a, b, y / b, target_buf );
 			if( e != ERROR_OK ){
 				Jim_SetResult_sprintf( interp, "error reading target @ 0x%08lx", (int)(a) );
 				return JIM_ERR;

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/target/target.h	2009-05-31 09:37:35 UTC (rev 1959)
@@ -161,6 +161,10 @@
 	* count: number of items of <size>
 	*/
 	int (*read_memory_imp)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
+	/**
+	 * Target memory read callback.  Do @b not call this function
+	 * directly, use target_read_memory() instead.
+	 */
 	int (*read_memory)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
 	int (*write_memory_imp)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
 	int (*write_memory)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
@@ -371,6 +375,15 @@
 extern int get_num_by_target(target_t *query_target);
 extern target_t *get_target(const char *id);
 
+/**
+ * Read @count items of @a size bytes from the memory of @a target at
+ * the @a address given.
+ *
+ * This routine is a wrapper for target->type->read_memory.
+ */
+extern int target_read_memory(struct target_s *target,
+		u32 address, u32 size, u32 count, u8 *buffer);
+
 extern int target_write_buffer(struct target_s *target, u32 address, u32 size, u8 *buffer);
 extern int target_read_buffer(struct target_s *target, u32 address, u32 size, u8 *buffer);
 extern int target_checksum_memory(struct target_s *target, u32 address, u32 size, u32* crc);

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-31 06:00:28 UTC (rev 1958)
+++ trunk/src/target/xscale.c	2009-05-31 09:37:35 UTC (rev 1959)
@@ -2187,7 +2187,7 @@
 		if (breakpoint->length == 4)
 		{
 			/* keep the original instruction in target endianness */
-			if((retval = target->type->read_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if((retval = target_read_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -2200,7 +2200,7 @@
 		else
 		{
 			/* keep the original instruction in target endianness */
-			if((retval = target->type->read_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if((retval = target_read_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}



From zwelch at mail.berlios.de  Sun May 31 11:38:13 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 11:38:13 +0200
Subject: [Openocd-svn] r1960 - in trunk/src: flash target
Message-ID: <200905310938.n4V9cDOu014190@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 11:37:57 +0200 (Sun, 31 May 2009)
New Revision: 1960

Modified:
   trunk/src/flash/at91sam7.c
   trunk/src/flash/cfi.c
   trunk/src/flash/lpc2000.c
   trunk/src/flash/lpc288x.c
   trunk/src/flash/lpc3180_nand_controller.c
   trunk/src/flash/mflash.c
   trunk/src/flash/orion_nand.c
   trunk/src/flash/str7x.c
   trunk/src/flash/str9x.c
   trunk/src/target/arm7_9_common.c
   trunk/src/target/cortex_m3.c
   trunk/src/target/feroceon.c
   trunk/src/target/mips_m4k.c
   trunk/src/target/target.c
   trunk/src/target/target.h
   trunk/src/target/xscale.c
Log:
Add target_write_memory wrapper:
- replaces all calls to target->type->write_memory.
- add documentation in target_s to warn not to invoke callback directly.


Modified: trunk/src/flash/at91sam7.c
===================================================================
--- trunk/src/flash/at91sam7.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/flash/at91sam7.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -1027,7 +1027,7 @@
 		/* Write one block to the PageWriteBuffer */
 		buffer_pos = (pagen-first_page)*dst_min_alignment;
 		wcount = CEIL(count,4);
-		if((retval = target->type->write_memory(target, bank->base+pagen*dst_min_alignment, 4, wcount, buffer+buffer_pos)) != ERROR_OK)
+		if((retval = target_write_memory(target, bank->base+pagen*dst_min_alignment, 4, wcount, buffer+buffer_pos)) != ERROR_OK)
 		{
 			return retval;
 		}

Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/flash/cfi.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -260,7 +260,7 @@
 	}
 
 	cfi_command(bank, 0x50, command);
-	target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
+	target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
 }
 
 u8 cfi_intel_wait_status_busy(flash_bank_t *bank, int timeout)
@@ -356,12 +356,12 @@
 	if ((pri_ext->pri[0] != 'P') || (pri_ext->pri[1] != 'R') || (pri_ext->pri[2] != 'I'))
 	{
 		cfi_command(bank, 0xf0, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
 		cfi_command(bank, 0xff, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -419,7 +419,7 @@
 	if ((pri_ext->pri[0] != 'P') || (pri_ext->pri[1] != 'R') || (pri_ext->pri[2] != 'I'))
 	{
 		cfi_command(bank, 0xf0, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -492,7 +492,7 @@
 	if ((atmel_pri_ext.pri[0] != 'P') || (atmel_pri_ext.pri[1] != 'R') || (atmel_pri_ext.pri[2] != 'I'))
 	{
 		cfi_command(bank, 0xf0, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -688,13 +688,13 @@
 	for (i = first; i <= last; i++)
 	{
 		cfi_command(bank, 0x20, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
 
 		cfi_command(bank, 0xd0, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -704,7 +704,7 @@
 		else
 		{
 			cfi_command(bank, 0xff, command);
-			if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+			if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -715,7 +715,7 @@
 	}
 
 	cfi_command(bank, 0xff, command);
-	return target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
+	return target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
 
 }
 
@@ -731,37 +731,37 @@
 	for (i = first; i <= last; i++)
 	{
 		cfi_command(bank, 0xaa, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
 
 		cfi_command(bank, 0x55, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
 
 		cfi_command(bank, 0x80, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
 
 		cfi_command(bank, 0xaa, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
 
 		cfi_command(bank, 0x55, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
 
 		cfi_command(bank, 0x30, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -771,7 +771,7 @@
 		else
 		{
 			cfi_command(bank, 0xf0, command);
-			if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+			if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -782,7 +782,7 @@
 	}
 
 	cfi_command(bank, 0xf0, command);
-	return target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
+	return target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
 }
 
 static int cfi_erase(struct flash_bank_s *bank, int first, int last)
@@ -842,7 +842,7 @@
 	{
 		cfi_command(bank, 0x60, command);
 		LOG_DEBUG("address: 0x%4.4x, command: 0x%4.4x", flash_address(bank, i, 0x0), target_buffer_get_u32(target, command));
-		if((retval = target->type->write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -850,7 +850,7 @@
 		{
 			cfi_command(bank, 0x01, command);
 			LOG_DEBUG("address: 0x%4.4x, command: 0x%4.4x", flash_address(bank, i, 0x0), target_buffer_get_u32(target, command));
-			if((retval = target->type->write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+			if((retval = target_write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -860,7 +860,7 @@
 		{
 			cfi_command(bank, 0xd0, command);
 			LOG_DEBUG("address: 0x%4.4x, command: 0x%4.4x", flash_address(bank, i, 0x0), target_buffer_get_u32(target, command));
-			if((retval = target->type->write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+			if((retval = target_write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -878,7 +878,7 @@
 			u8 block_status;
 			/* read block lock bit, to verify status */
 			cfi_command(bank, 0x90, command);
-			if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x55), bank->bus_width, 1, command)) != ERROR_OK)
+			if((retval = target_write_memory(target, flash_address(bank, 0, 0x55), bank->bus_width, 1, command)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -888,7 +888,7 @@
 			{
 				LOG_ERROR("couldn't change block lock status (set = %i, block_status = 0x%2.2x)", set, block_status);
 				cfi_command(bank, 0x70, command);
-				if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x55), bank->bus_width, 1, command)) != ERROR_OK)
+				if((retval = target_write_memory(target, flash_address(bank, 0, 0x55), bank->bus_width, 1, command)) != ERROR_OK)
 				{
 					return retval;
 				}
@@ -917,13 +917,13 @@
 				cfi_intel_clear_status_register(bank);
 
 				cfi_command(bank, 0x60, command);
-				if((retval = target->type->write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+				if((retval = target_write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 				{
 					return retval;
 				}
 
 				cfi_command(bank, 0x01, command);
-				if((retval = target->type->write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+				if((retval = target_write_memory(target, flash_address(bank, i, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 				{
 					return retval;
 				}
@@ -934,7 +934,7 @@
 	}
 
 	cfi_command(bank, 0xff, command);
-	return target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
+	return target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
 }
 
 static int cfi_protect(struct flash_bank_s *bank, int set, int first, int last)
@@ -1554,12 +1554,12 @@
 
 	cfi_intel_clear_status_register(bank);
 	cfi_command(bank, 0x40, command);
-	if((retval = target->type->write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
-	if((retval = target->type->write_memory(target, address, bank->bus_width, 1, word)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, 1, word)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -1567,7 +1567,7 @@
 	if (cfi_intel_wait_status_busy(bank, 1000 * (1 << cfi_info->word_write_timeout_max)) != 0x80)
 	{
 		cfi_command(bank, 0xff, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -1622,14 +1622,14 @@
 
 	/* Initiate buffer operation _*/
 	cfi_command(bank, 0xE8, command);
-	if((retval = target->type->write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 	if (cfi_intel_wait_status_busy(bank, 1000 * (1 << cfi_info->buf_write_timeout_max)) != 0x80)
 	{
 		cfi_command(bank, 0xff, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -1640,26 +1640,26 @@
 
 	/* Write buffer wordcount-1 and data words */
 	cfi_command(bank, bufferwsize-1, command);
-	if((retval = target->type->write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
-	if((retval = target->type->write_memory(target, address, bank->bus_width, bufferwsize, word)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, bufferwsize, word)) != ERROR_OK)
 	{
 		return retval;
 	}
 
 	/* Commit write operation */
 	cfi_command(bank, 0xd0, command);
-	if((retval = target->type->write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 	if (cfi_intel_wait_status_busy(bank, 1000 * (1 << cfi_info->buf_write_timeout_max)) != 0x80)
 	{
 		cfi_command(bank, 0xff, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -1680,24 +1680,24 @@
 	u8 command[8];
 
 	cfi_command(bank, 0xaa, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
 	cfi_command(bank, 0x55, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
 	cfi_command(bank, 0xa0, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
-	if((retval = target->type->write_memory(target, address, bank->bus_width, 1, word)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, 1, word)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -1705,7 +1705,7 @@
 	if (cfi_spansion_wait_status_busy(bank, 1000 * (1 << cfi_info->word_write_timeout_max)) != ERROR_OK)
 	{
 		cfi_command(bank, 0xf0, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -1757,39 +1757,39 @@
 
 	// Unlock
 	cfi_command(bank, 0xaa, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
 	cfi_command(bank, 0x55, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
 	// Buffer load command
 	cfi_command(bank, 0x25, command);
-	if((retval = target->type->write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
 	/* Write buffer wordcount-1 and data words */
 	cfi_command(bank, bufferwsize-1, command);
-	if((retval = target->type->write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
-	if((retval = target->type->write_memory(target, address, bank->bus_width, bufferwsize, word)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, bufferwsize, word)) != ERROR_OK)
 	{
 		return retval;
 	}
 
 	/* Commit write operation */
 	cfi_command(bank, 0x29, command);
-	if((retval = target->type->write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, address, bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -1797,7 +1797,7 @@
 	if (cfi_spansion_wait_status_busy(bank, 1000 * (1 << cfi_info->word_write_timeout_max)) != ERROR_OK)
 	{
 		cfi_command(bank, 0xf0, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -2012,12 +2012,12 @@
 
 	/* return to read array mode, so we can read from flash again for padding */
 	cfi_command(bank, 0xf0, current_word);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, current_word)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, current_word)) != ERROR_OK)
 	{
 		return retval;
 	}
 	cfi_command(bank, 0xff, current_word);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, current_word)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, current_word)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -2052,12 +2052,12 @@
 
 	/* return to read array mode */
 	cfi_command(bank, 0xf0, current_word);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, current_word)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, current_word)) != ERROR_OK)
 	{
 		return retval;
 	}
 	cfi_command(bank, 0xff, current_word);
-	return target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, current_word);
+	return target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, current_word);
 }
 
 static void cfi_fixup_atmel_reversed_erase_regions(flash_bank_t *bank, void *param)
@@ -2133,17 +2133,17 @@
 
 	/* switch to read identifier codes mode ("AUTOSELECT") */
 	cfi_command(bank, 0xaa, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 	cfi_command(bank, 0x55, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, unlock2), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, unlock2), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 	cfi_command(bank, 0x90, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -2177,12 +2177,12 @@
 	LOG_INFO("Flash Manufacturer/Device: 0x%04x 0x%04x", cfi_info->manufacturer, cfi_info->device_id);
 	/* switch back to read array mode */
 	cfi_command(bank, 0xf0, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x00), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, 0x00), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 	cfi_command(bank, 0xff, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x00), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, 0x00), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -2203,7 +2203,7 @@
 		 * SST flashes clearly violate this, and we will consider them incompatbile for now
 		 */
 		cfi_command(bank, 0x98, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x55), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x55), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -2217,12 +2217,12 @@
 		if ((cfi_info->qry[0] != 'Q') || (cfi_info->qry[1] != 'R') || (cfi_info->qry[2] != 'Y'))
 		{
 			cfi_command(bank, 0xf0, command);
-			if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+			if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 			{
 				return retval;
 			}
 			cfi_command(bank, 0xff, command);
-			if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+			if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 			{
 				return retval;
 			}
@@ -2307,12 +2307,12 @@
 		 * we use both reset commands, as some Intel flashes fail to recognize the 0xF0 command
 		 */
 		cfi_command(bank, 0xf0, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
 		cfi_command(bank, 0xff, command);
-		if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
+		if((retval = target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -2410,7 +2410,7 @@
 		return ERROR_FLASH_OPERATION_FAILED;
 
 	cfi_command(bank, 0x90, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, 0x55), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, 0x55), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -2426,7 +2426,7 @@
 	}
 
 	cfi_command(bank, 0xff, command);
-	return target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
+	return target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
 }
 
 static int cfi_spansion_protect_check(struct flash_bank_s *bank)
@@ -2439,19 +2439,19 @@
 	int i;
 
 	cfi_command(bank, 0xaa, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
 	cfi_command(bank, 0x55, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock2), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
 
 	cfi_command(bank, 0x90, command);
-	if((retval = target->type->write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
+	if((retval = target_write_memory(target, flash_address(bank, 0, pri_ext->_unlock1), bank->bus_width, 1, command)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -2467,7 +2467,7 @@
 	}
 
 	cfi_command(bank, 0xf0, command);
-	return target->type->write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
+	return target_write_memory(target, flash_address(bank, 0, 0x0), bank->bus_width, 1, command);
 }
 
 static int cfi_protect_check(struct flash_bank_s *bank)

Modified: trunk/src/flash/lpc2000.c
===================================================================
--- trunk/src/flash/lpc2000.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/flash/lpc2000.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -258,7 +258,7 @@
 		/* write IAP code to working area */
 		target_buffer_set_u32(target, jump_gate, ARMV4_5_BX(12));
 		target_buffer_set_u32(target, jump_gate + 4, ARMV4_5_B(0xfffffe, 0));
-		if((retval = target->type->write_memory(target, lpc2000_info->iap_working_area->address, 4, 2, jump_gate)) != ERROR_OK)
+		if((retval = target_write_memory(target, lpc2000_info->iap_working_area->address, 4, 2, jump_gate)) != ERROR_OK)
 		{
 			return retval;
 		}

Modified: trunk/src/flash/lpc288x.c
===================================================================
--- trunk/src/flash/lpc288x.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/flash/lpc288x.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -406,7 +406,7 @@
 			 * it seems not to be a LOT slower....
 			 * bulk_write_memory() is no quicker :(*/
 #if 1
-			if (target->type->write_memory(target, offset + dest_offset, 4, 128, page_buffer) != ERROR_OK)
+			if (target_write_memory(target, offset + dest_offset, 4, 128, page_buffer) != ERROR_OK)
 			{
 				LOG_ERROR("Write failed s %x p %x", sector, page);
 				return ERROR_FLASH_OPERATION_FAILED;

Modified: trunk/src/flash/lpc3180_nand_controller.c
===================================================================
--- trunk/src/flash/lpc3180_nand_controller.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/flash/lpc3180_nand_controller.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -602,8 +602,8 @@
 			/* write MLC_ECC_ENC_REG to start encode cycle */
 			target_write_u32(target, 0x200b8008, 0x0);
 
-			target->type->write_memory(target, 0x200a8000, 4, 128, page_buffer + (quarter * 512));
-			target->type->write_memory(target, 0x200a8000, 1, 6, oob_buffer + (quarter * 6));
+			target_write_memory(target, 0x200a8000, 4, 128, page_buffer + (quarter * 512));
+			target_write_memory(target, 0x200a8000, 1, 6, oob_buffer + (quarter * 6));
 
 			/* write MLC_ECC_AUTO_ENC_REG to start auto encode */
 			target_write_u32(target, 0x200b8010, 0x0);

Modified: trunk/src/flash/mflash.c
===================================================================
--- trunk/src/flash/mflash.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/flash/mflash.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -494,7 +494,7 @@
 		if (ret != ERROR_OK)
 			LOG_ERROR("mg_io_wait_drq time out");
 
-		ret = target->type->write_memory(target, address, 2, MG_MFLASH_SECTOR_SIZE / 2, buff_ptr);
+		ret = target_write_memory(target, address, 2, MG_MFLASH_SECTOR_SIZE / 2, buff_ptr);
 		if (ret != ERROR_OK)
 			LOG_ERROR("mem write error");
 		buff_ptr += MG_MFLASH_SECTOR_SIZE;
@@ -927,7 +927,7 @@
 		for (i = 0; i < MG_MFLASH_SECTOR_SIZE >> 1; i++)
 			buff[i] = i;
 
-		target->type->write_memory(target, address, 2,
+		target_write_memory(target, address, 2,
 				MG_MFLASH_SECTOR_SIZE / 2, (u8 *)buff);
 
 		memset(buff, 0xff, MG_MFLASH_SECTOR_SIZE);

Modified: trunk/src/flash/orion_nand.c
===================================================================
--- trunk/src/flash/orion_nand.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/flash/orion_nand.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -131,7 +131,7 @@
 			target_buffer_set_u32(target, code_buf + i*4, code[i]);
 
 		/* write code to working area */
-                retval = target->type->write_memory(target,
+                retval = target_write_memory(target,
 					hw->copy_area->address,
 					4, code_size/4, code_buf);
 		if (retval != ERROR_OK)
@@ -143,7 +143,7 @@
 	retval = target->type->bulk_write_memory(target, target_buf,
 						 size/4, data);
 	if (retval == ERROR_OK && size & 3) {
-		retval = target->type->write_memory(target,
+		retval = target_write_memory(target,
 					target_buf + (size & ~3),
 					1, size & 3, data + (size & ~3));
 	}

Modified: trunk/src/flash/str7x.c
===================================================================
--- trunk/src/flash/str7x.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/flash/str7x.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -546,11 +546,11 @@
 		target_write_u32(target, str7x_get_flash_adr(bank, FLASH_AR), address);
 		
 		/* data word 1 */
-		target->type->write_memory(target, str7x_get_flash_adr(bank, FLASH_DR0), 4, 1, buffer + bytes_written);
+		target_write_memory(target, str7x_get_flash_adr(bank, FLASH_DR0), 4, 1, buffer + bytes_written);
 		bytes_written += 4;
 		
 		/* data word 2 */
-		target->type->write_memory(target, str7x_get_flash_adr(bank, FLASH_DR1), 4, 1, buffer + bytes_written);
+		target_write_memory(target, str7x_get_flash_adr(bank, FLASH_DR1), 4, 1, buffer + bytes_written);
 		bytes_written += 4;
 		
 		/* start programming cycle */
@@ -593,11 +593,11 @@
 		target_write_u32(target, str7x_get_flash_adr(bank, FLASH_AR), address);
 		
 		/* data word 1 */
-		target->type->write_memory(target, str7x_get_flash_adr(bank, FLASH_DR0), 4, 1, last_dword);
+		target_write_memory(target, str7x_get_flash_adr(bank, FLASH_DR0), 4, 1, last_dword);
 		bytes_written += 4;
 		
 		/* data word 2 */
-		target->type->write_memory(target, str7x_get_flash_adr(bank, FLASH_DR1), 4, 1, last_dword + 4);
+		target_write_memory(target, str7x_get_flash_adr(bank, FLASH_DR1), 4, 1, last_dword + 4);
 		bytes_written += 4;
 		
 		/* start programming cycle */

Modified: trunk/src/flash/str9x.c
===================================================================
--- trunk/src/flash/str9x.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/flash/str9x.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -569,7 +569,7 @@
 		
 		/* write data command */
 		target_write_u16(target, bank_adr, 0x40);
-		target->type->write_memory(target, address, 2, 1, buffer + bytes_written);
+		target_write_memory(target, address, 2, 1, buffer + bytes_written);
 		
 		/* get status command */
 		target_write_u16(target, bank_adr, 0x70);
@@ -618,7 +618,7 @@
 		
 		/* write data comamnd */
 		target_write_u16(target, bank_adr, 0x40);
-		target->type->write_memory(target, address, 2, 1, last_halfword);
+		target_write_memory(target, address, 2, 1, last_halfword);
 		
 		/* query status command */
 		target_write_u16(target, bank_adr, 0x70);

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/target/arm7_9_common.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -378,7 +378,7 @@
 				return retval;
 			}
 			if (current_instr==arm7_9->arm_bkpt)
-				if ((retval = target->type->write_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
+				if ((retval = target_write_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
 				{
 					return retval;
 				}
@@ -392,7 +392,7 @@
 				return retval;
 			}
 			if (current_instr==arm7_9->thumb_bkpt)
-				if ((retval = target->type->write_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
+				if ((retval = target_write_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
 				{
 					return retval;
 				}
@@ -2628,7 +2628,7 @@
 	int i;
 
 	if (!arm7_9->dcc_downloads)
-		return target->type->write_memory(target, address, 4, count, buffer);
+		return target_write_memory(target, address, 4, count, buffer);
 
 	/* regrab previously allocated working_area, or allocate a new one */
 	if (!arm7_9->dcc_working_area)
@@ -2639,7 +2639,7 @@
 		if (target_alloc_working_area(target, 24, &arm7_9->dcc_working_area) != ERROR_OK)
 		{
 			LOG_INFO("no working area available, falling back to memory writes");
-			return target->type->write_memory(target, address, 4, count, buffer);
+			return target_write_memory(target, address, 4, count, buffer);
 		}
 
 		/* copy target instructions to target endianness */
@@ -2649,7 +2649,7 @@
 		}
 
 		/* write DCC code to working area */
-		if ((retval = target->type->write_memory(target, arm7_9->dcc_working_area->address, 4, 6, dcc_code_buf)) != ERROR_OK)
+		if ((retval = target_write_memory(target, arm7_9->dcc_working_area->address, 4, 6, dcc_code_buf)) != ERROR_OK)
 		{
 			return retval;
 		}

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/target/cortex_m3.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -934,7 +934,7 @@
 		{
 			return retval;
 		}
-		if((retval = target->type->write_memory(target, breakpoint->address & 0xFFFFFFFE, breakpoint->length, 1, code)) != ERROR_OK)
+		if((retval = target_write_memory(target, breakpoint->address & 0xFFFFFFFE, breakpoint->length, 1, code)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -975,14 +975,14 @@
 		/* restore original instruction (kept in target endianness) */
 		if (breakpoint->length == 4)
 		{
-			if((retval = target->type->write_memory(target, breakpoint->address & 0xFFFFFFFE, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if((retval = target_write_memory(target, breakpoint->address & 0xFFFFFFFE, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}
 		}
 		else
 		{
-			if((retval = target->type->write_memory(target, breakpoint->address & 0xFFFFFFFE, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if((retval = target_write_memory(target, breakpoint->address & 0xFFFFFFFE, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/target/feroceon.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -546,7 +546,7 @@
 	u32 dcc_size = sizeof(dcc_code);
 
 	if (!arm7_9->dcc_downloads)
-		return target->type->write_memory(target, address, 4, count, buffer);
+		return target_write_memory(target, address, 4, count, buffer);
 
 	/* regrab previously allocated working_area, or allocate a new one */
 	if (!arm7_9->dcc_working_area)
@@ -557,7 +557,7 @@
 		if (target_alloc_working_area(target, dcc_size, &arm7_9->dcc_working_area) != ERROR_OK)
 		{
 			LOG_INFO("no working area available, falling back to memory writes");
-			return target->type->write_memory(target, address, 4, count, buffer);
+			return target_write_memory(target, address, 4, count, buffer);
 		}
 
 		/* copy target instructions to target endianness */
@@ -565,7 +565,7 @@
 			target_buffer_set_u32(target, dcc_code_buf + i*4, dcc_code[i]);
 
 		/* write DCC code to working area */
-		if((retval = target->type->write_memory(target, arm7_9->dcc_working_area->address, 4, dcc_size/4, dcc_code_buf)) != ERROR_OK)
+		if((retval = target_write_memory(target, arm7_9->dcc_working_area->address, 4, dcc_size/4, dcc_code_buf)) != ERROR_OK)
 		{
 			return retval;
 		}

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/target/mips_m4k.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -617,7 +617,7 @@
 			}
 			if (current_instr == MIPS32_SDBBP)
 			{
-				if((retval = target->type->write_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
+				if((retval = target_write_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
 				{
 					return retval;
 				}
@@ -635,7 +635,7 @@
 			
 			if (current_instr == MIPS16_SDBBP)
 			{
-				if((retval = target->type->write_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
+				if((retval = target_write_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
 				{
 					return retval;
 				}

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/target/target.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -531,6 +531,13 @@
 	return target->type->read_memory(target, address, size, count, buffer);
 }
 
+int target_write_memory(struct target_s *target,
+		u32 address, u32 size, u32 count, u8 *buffer)
+{
+	return target->type->write_memory(target, address, size, count, buffer);
+}
+
+
 int target_init(struct command_context_s *cmd_ctx)
 {
 	target_t *target = all_targets;
@@ -898,7 +905,7 @@
 	if (restore&&target->backup_working_area)
 	{
 		int retval;
-		if((retval = target->type->write_memory(target, area->address, 4, area->size / 4, area->backup)) != ERROR_OK)
+		if((retval = target_write_memory(target, area->address, 4, area->size / 4, area->backup)) != ERROR_OK)
 			return retval;
 	}
 
@@ -1004,7 +1011,7 @@
 
 	if (((address % 2) == 0) && (size == 2))
 	{
-		return target->type->write_memory(target, address, 2, 1, buffer);
+		return target_write_memory(target, address, 2, 1, buffer);
 	}
 
 	/* handle unaligned head bytes */
@@ -1015,7 +1022,7 @@
 		if (unaligned > size)
 			unaligned = size;
 
-		if ((retval = target->type->write_memory(target, address, 1, unaligned, buffer)) != ERROR_OK)
+		if ((retval = target_write_memory(target, address, 1, unaligned, buffer)) != ERROR_OK)
 			return retval;
 
 		buffer += unaligned;
@@ -1036,7 +1043,7 @@
 		}
 		else
 		{
-			if ((retval = target->type->write_memory(target, address, 4, aligned / 4, buffer)) != ERROR_OK)
+			if ((retval = target_write_memory(target, address, 4, aligned / 4, buffer)) != ERROR_OK)
 				return retval;
 		}
 
@@ -1048,7 +1055,7 @@
 	/* handle tail writes of less than 4 bytes */
 	if (size > 0)
 	{
-		if ((retval = target->type->write_memory(target, address, 1, size, buffer)) != ERROR_OK)
+		if ((retval = target_write_memory(target, address, 1, size, buffer)) != ERROR_OK)
 			return retval;
 	}
 
@@ -1272,7 +1279,7 @@
 	LOG_DEBUG("address: 0x%8.8x, value: 0x%8.8x", address, value);
 
 	target_buffer_set_u32(target, value_buf, value);
-	if ((retval = target->type->write_memory(target, address, 4, 1, value_buf)) != ERROR_OK)
+	if ((retval = target_write_memory(target, address, 4, 1, value_buf)) != ERROR_OK)
 	{
 		LOG_DEBUG("failed: %i", retval);
 	}
@@ -1293,7 +1300,7 @@
 	LOG_DEBUG("address: 0x%8.8x, value: 0x%8.8x", address, value);
 
 	target_buffer_set_u16(target, value_buf, value);
-	if ((retval = target->type->write_memory(target, address, 2, 1, value_buf)) != ERROR_OK)
+	if ((retval = target_write_memory(target, address, 2, 1, value_buf)) != ERROR_OK)
 	{
 		LOG_DEBUG("failed: %i", retval);
 	}
@@ -1312,7 +1319,7 @@
 
 	LOG_DEBUG("address: 0x%8.8x, value: 0x%2.2x", address, value);
 
-	if ((retval = target->type->write_memory(target, address, 1, 1, &value)) != ERROR_OK)
+	if ((retval = target_write_memory(target, address, 1, 1, &value)) != ERROR_OK)
 	{
 		LOG_DEBUG("failed: %i", retval);
 	}
@@ -1967,7 +1974,7 @@
 	}
 	for (i=0; i<count; i++)
 	{
-		int retval = target->type->write_memory(target,
+		int retval = target_write_memory(target,
 				address + i * wordsize, wordsize, 1, value_buf);
 		if (ERROR_OK != retval)
 			return retval;
@@ -3034,7 +3041,7 @@
 		}
 		len -= count;
 
-		retval = target->type->write_memory(target, addr, width, count, buffer);
+		retval = target_write_memory(target, addr, width, count, buffer);
 		if (retval != ERROR_OK) {
 			/* BOO !*/
 			LOG_ERROR("array2mem: Write @ 0x%08x, w=%d, cnt=%d, failed", addr, width, count);
@@ -3525,7 +3532,7 @@
 			break;
 		}
 		for( x = 0 ; x < c ; x++ ){
-			e = target->type->write_memory( target, a, b, 1, target_buf );
+			e = target_write_memory( target, a, b, 1, target_buf );
 			if( e != ERROR_OK ){
 				Jim_SetResult_sprintf( interp, "Error writing @ 0x%08x: %d\n", (int)(a), e );
 				return JIM_ERR;

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/target/target.h	2009-05-31 09:37:57 UTC (rev 1960)
@@ -167,6 +167,10 @@
 	 */
 	int (*read_memory)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
 	int (*write_memory_imp)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
+	/**
+	 * Target memory write callback.  Do @b not call this function
+	 * directly, use target_write_memory() instead.
+	 */
 	int (*write_memory)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
 
 	/* write target memory in multiples of 4 byte, optimized for writing large quantities of data */
@@ -383,6 +387,14 @@
  */
 extern int target_read_memory(struct target_s *target,
 		u32 address, u32 size, u32 count, u8 *buffer);
+/**
+ * Write @count items of @a size bytes to the memory of @a target at
+ * the @a address given.
+ *
+ * This routine is wrapper for target->type->write_memory.
+ */
+extern int target_write_memory(struct target_s *target,
+		u32 address, u32 size, u32 count, u8 *buffer);
 
 extern int target_write_buffer(struct target_s *target, u32 address, u32 size, u8 *buffer);
 extern int target_read_buffer(struct target_s *target, u32 address, u32 size, u8 *buffer);

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-31 09:37:35 UTC (rev 1959)
+++ trunk/src/target/xscale.c	2009-05-31 09:37:57 UTC (rev 1960)
@@ -2284,14 +2284,14 @@
 		/* restore original instruction (kept in target endianness) */
 		if (breakpoint->length == 4)
 		{
-			if((retval = target->type->write_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if((retval = target_write_memory(target, breakpoint->address, 4, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}
 		}
 		else
 		{
-			if((retval = target->type->write_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
+			if((retval = target_write_memory(target, breakpoint->address, 2, 1, breakpoint->orig_instr)) != ERROR_OK)
 			{
 				return retval;
 			}



From zwelch at mail.berlios.de  Sun May 31 11:38:33 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 11:38:33 +0200
Subject: [Openocd-svn] r1961 - in trunk/src: flash target
Message-ID: <200905310938.n4V9cX6t014239@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 11:38:20 +0200 (Sun, 31 May 2009)
New Revision: 1961

Modified:
   trunk/src/flash/aduc702x.c
   trunk/src/flash/cfi.c
   trunk/src/flash/ecos.c
   trunk/src/flash/lpc2000.c
   trunk/src/flash/orion_nand.c
   trunk/src/flash/pic32mx.c
   trunk/src/flash/stellaris.c
   trunk/src/flash/stm32x.c
   trunk/src/flash/str7x.c
   trunk/src/flash/str9x.c
   trunk/src/target/arm7_9_common.c
   trunk/src/target/armv7m.c
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Add target_run_algorithm wrapper:
- replaces all calls to target->type->run_algorithm.
- add documentation in target_s to warn not to invoke callback directly.


Modified: trunk/src/flash/aduc702x.c
===================================================================
--- trunk/src/flash/aduc702x.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/aduc702x.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -288,7 +288,7 @@
 		buf_set_u32(reg_params[2].value, 0, 32, address);
 		buf_set_u32(reg_params[4].value, 0, 32, 0xFFFFF800);
 
-		if ((retval = target->type->run_algorithm(target, 0, NULL, 5, 
+		if ((retval = target_run_algorithm(target, 0, NULL, 5, 
                         reg_params, aduc702x_info->write_algorithm->address, 
                         aduc702x_info->write_algorithm->address + sizeof(aduc702x_flash_write_code) - 4, 
                         10000, &armv4_5_info)) != ERROR_OK)

Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/cfi.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -1227,7 +1227,7 @@
 		LOG_INFO("Write 0x%04x bytes to flash at 0x%08x", thisrun_count, address );
 
 		/* Execute algorithm, assume breakpoint for last instruction */
-		retval = target->type->run_algorithm(target, 0, NULL, 7, reg_params,
+		retval = target_run_algorithm(target, 0, NULL, 7, reg_params,
 			cfi_info->write_algorithm->address,
 			cfi_info->write_algorithm->address + target_code_size - sizeof(u32),
 			10000, /* 10s should be enough for max. 32k of data */
@@ -1510,7 +1510,7 @@
 		buf_set_u32(reg_params[8].value, 0, 32, flash_address(bank, 0, pri_ext->_unlock2));
 		buf_set_u32(reg_params[9].value, 0, 32, 0x55555555);
 
-		retval = target->type->run_algorithm(target, 0, NULL, 10, reg_params,
+		retval = target_run_algorithm(target, 0, NULL, 10, reg_params,
 						     cfi_info->write_algorithm->address,
 						     cfi_info->write_algorithm->address + ((24 * 4) - 4),
 						     10000, &armv4_5_info);

Modified: trunk/src/flash/ecos.c
===================================================================
--- trunk/src/flash/ecos.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/ecos.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -245,7 +245,7 @@
 	buf_set_u32(reg_params[2].value, 0, 32, r2);
 
 	int retval;
-	if ((retval = target->type->run_algorithm(target, 0, NULL, 3, reg_params,
+	if ((retval = target_run_algorithm(target, 0, NULL, 3, reg_params,
 			codeStart,
 			codeStop, timeout,
 			&armv4_5_info)) != ERROR_OK)

Modified: trunk/src/flash/lpc2000.c
===================================================================
--- trunk/src/flash/lpc2000.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/lpc2000.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -298,7 +298,7 @@
 	init_reg_param(&reg_params[4], "lr_svc", 32, PARAM_OUT);
 	buf_set_u32(reg_params[4].value, 0, 32, lpc2000_info->iap_working_area->address + 0x4);
 
-	target->type->run_algorithm(target, 2, mem_params, 5, reg_params, lpc2000_info->iap_working_area->address, lpc2000_info->iap_working_area->address + 0x4, 10000, &armv4_5_info);
+	target_run_algorithm(target, 2, mem_params, 5, reg_params, lpc2000_info->iap_working_area->address, lpc2000_info->iap_working_area->address + 0x4, 10000, &armv4_5_info);
 
 	status_code = buf_get_u32(mem_params[1].value, 0, 32);
 	result_table[0] = target_buffer_get_u32(target, mem_params[1].value);

Modified: trunk/src/flash/orion_nand.c
===================================================================
--- trunk/src/flash/orion_nand.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/orion_nand.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -162,7 +162,7 @@
 	buf_set_u32(reg_params[1].value, 0, 32, target_buf);
 	buf_set_u32(reg_params[2].value, 0, 32, size);
 
-	retval = target->type->run_algorithm(target, 0, NULL, 3, reg_params,
+	retval = target_run_algorithm(target, 0, NULL, 3, reg_params,
 					hw->copy_area->address,
 					hw->copy_area->address + code_size - 4,
 					1000, &algo);

Modified: trunk/src/flash/pic32mx.c
===================================================================
--- trunk/src/flash/pic32mx.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/pic32mx.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -419,7 +419,7 @@
 		buf_set_u32(reg_params[1].value, 0, 32, address);
 		buf_set_u32(reg_params[2].value, 0, 32, buffer_size/4);
 
-		if ((retval = target->type->run_algorithm(target, 0, NULL, 4, reg_params, pic32mx_info->write_algorithm->address, \
+		if ((retval = target_run_algorithm(target, 0, NULL, 4, reg_params, pic32mx_info->write_algorithm->address, \
 				pic32mx_info->write_algorithm->address + (sizeof(pic32mx_flash_write_code) - 10), 10000, &armv7m_info)) != ERROR_OK)
 		{
 			LOG_ERROR("error executing pic32mx flash write algorithm");

Modified: trunk/src/flash/stellaris.c
===================================================================
--- trunk/src/flash/stellaris.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/stellaris.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -779,7 +779,7 @@
 		buf_set_u32(reg_params[2].value, 0, 32, 4*thisrun_count);
 		LOG_INFO("Algorithm flash write %i words to 0x%x, %i remaining", thisrun_count, address, wcount);
 		LOG_DEBUG("Algorithm flash write %i words to 0x%x, %i remaining", thisrun_count, address, wcount);
-		if ((retval = target->type->run_algorithm(target, 0, NULL, 3, reg_params, write_algorithm->address, write_algorithm->address + sizeof(stellaris_write_code)-10, 10000, &armv7m_info)) != ERROR_OK)
+		if ((retval = target_run_algorithm(target, 0, NULL, 3, reg_params, write_algorithm->address, write_algorithm->address + sizeof(stellaris_write_code)-10, 10000, &armv7m_info)) != ERROR_OK)
 		{
 			LOG_ERROR("error executing stellaris flash write algorithm");
 			retval = ERROR_FLASH_OPERATION_FAILED;

Modified: trunk/src/flash/stm32x.c
===================================================================
--- trunk/src/flash/stm32x.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/stm32x.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -554,7 +554,7 @@
 		buf_set_u32(reg_params[1].value, 0, 32, address);
 		buf_set_u32(reg_params[2].value, 0, 32, thisrun_count);
 		
-		if ((retval = target->type->run_algorithm(target, 0, NULL, 4, reg_params, stm32x_info->write_algorithm->address, \
+		if ((retval = target_run_algorithm(target, 0, NULL, 4, reg_params, stm32x_info->write_algorithm->address, \
 				stm32x_info->write_algorithm->address + (sizeof(stm32x_flash_write_code) - 10), 10000, &armv7m_info)) != ERROR_OK)
 		{
 			LOG_ERROR("error executing stm32x flash write algorithm");

Modified: trunk/src/flash/str7x.c
===================================================================
--- trunk/src/flash/str7x.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/str7x.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -429,7 +429,7 @@
 		buf_set_u32(reg_params[3].value, 0, 32, thisrun_count);
 		buf_set_u32(reg_params[5].value, 0, 32, str7x_info->busy_bits);
 	
-		if ((retval = target->type->run_algorithm(target, 0, NULL, 6, reg_params, str7x_info->write_algorithm->address, str7x_info->write_algorithm->address + (19 * 4), 10000, &armv4_5_info)) != ERROR_OK)
+		if ((retval = target_run_algorithm(target, 0, NULL, 6, reg_params, str7x_info->write_algorithm->address, str7x_info->write_algorithm->address + (19 * 4), 10000, &armv4_5_info)) != ERROR_OK)
 		{
 			LOG_ERROR("error executing str7x flash write algorithm");
 			retval = ERROR_FLASH_OPERATION_FAILED;

Modified: trunk/src/flash/str9x.c
===================================================================
--- trunk/src/flash/str9x.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/flash/str9x.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -463,7 +463,7 @@
 		buf_set_u32(reg_params[1].value, 0, 32, address);
 		buf_set_u32(reg_params[2].value, 0, 32, thisrun_count);
 
-		if ((retval = target->type->run_algorithm(target, 0, NULL, 4, reg_params, str9x_info->write_algorithm->address, str9x_info->write_algorithm->address + (18 * 4), 10000, &armv4_5_info)) != ERROR_OK)
+		if ((retval = target_run_algorithm(target, 0, NULL, 4, reg_params, str9x_info->write_algorithm->address, str9x_info->write_algorithm->address + (18 * 4), 10000, &armv4_5_info)) != ERROR_OK)
 		{
 			LOG_ERROR("error executing str9x flash write algorithm");
 			retval = ERROR_FLASH_OPERATION_FAILED;

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/target/arm7_9_common.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -2747,7 +2747,7 @@
 	buf_set_u32(reg_params[0].value, 0, 32, address);
 	buf_set_u32(reg_params[1].value, 0, 32, count);
 
-	if ((retval = target->type->run_algorithm(target, 0, NULL, 2, reg_params,
+	if ((retval = target_run_algorithm(target, 0, NULL, 2, reg_params,
 		crc_algorithm->address, crc_algorithm->address + (sizeof(arm7_9_crc_code) - 8), 20000, &armv4_5_info)) != ERROR_OK)
 	{
 		LOG_ERROR("error executing arm7_9 crc algorithm");
@@ -2812,7 +2812,7 @@
 	init_reg_param(&reg_params[2], "r2", 32, PARAM_IN_OUT);
 	buf_set_u32(reg_params[2].value, 0, 32, 0xff);
 
-	if ((retval = target->type->run_algorithm(target, 0, NULL, 3, reg_params,
+	if ((retval = target_run_algorithm(target, 0, NULL, 3, reg_params,
 			erase_check_algorithm->address, erase_check_algorithm->address + (sizeof(erase_check_code) - 4), 10000, &armv4_5_info)) != ERROR_OK)
 	{
 		destroy_reg_param(&reg_params[0]);

Modified: trunk/src/target/armv7m.c
===================================================================
--- trunk/src/target/armv7m.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/target/armv7m.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -613,7 +613,7 @@
 	buf_set_u32(reg_params[0].value, 0, 32, address);
 	buf_set_u32(reg_params[1].value, 0, 32, count);
 
-	if ((retval = target->type->run_algorithm(target, 0, NULL, 2, reg_params,
+	if ((retval = target_run_algorithm(target, 0, NULL, 2, reg_params,
 		crc_algorithm->address, crc_algorithm->address + (sizeof(cortex_m3_crc_code)-6), 20000, &armv7m_info)) != ERROR_OK)
 	{
 		LOG_ERROR("error executing cortex_m3 crc algorithm");
@@ -674,7 +674,7 @@
 	init_reg_param(&reg_params[2], "r2", 32, PARAM_IN_OUT);
 	buf_set_u32(reg_params[2].value, 0, 32, 0xff);
 
-	if ((retval = target->type->run_algorithm(target, 0, NULL, 3, reg_params,
+	if ((retval = target_run_algorithm(target, 0, NULL, 3, reg_params,
 			erase_check_algorithm->address, erase_check_algorithm->address + (sizeof(erase_check_code)-2), 10000, &armv7m_info)) != ERROR_OK)
 	{
 		destroy_reg_param(&reg_params[0]);

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/target/target.c	2009-05-31 09:38:20 UTC (rev 1961)
@@ -537,7 +537,18 @@
 	return target->type->write_memory(target, address, size, count, buffer);
 }
 
+int target_run_algorithm(struct target_s *target,
+		int num_mem_params, mem_param_t *mem_params,
+		int num_reg_params, reg_param_t *reg_param,
+		u32 entry_point, u32 exit_point,
+		int timeout_ms, void *arch_info)
+{
+	return target->type->run_algorithm(target,
+			num_mem_params, mem_params, num_reg_params, reg_param,
+			entry_point, exit_point, timeout_ms, arch_info);
+}
 
+
 int target_init(struct command_context_s *cmd_ctx)
 {
 	target_t *target = all_targets;

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 09:37:57 UTC (rev 1960)
+++ trunk/src/target/target.h	2009-05-31 09:38:20 UTC (rev 1961)
@@ -204,6 +204,10 @@
 
 	/* target algorithm support */
 	int (*run_algorithm_imp)(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_param, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info);
+	/**
+	 * Target algorithm support.  Do @b not call this method directly,
+	 * use target_run_algorithm() instead.
+	 */
 	int (*run_algorithm)(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_param, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info);
 
 	int (*register_commands)(struct command_context_s *cmd_ctx);
@@ -380,6 +384,17 @@
 extern target_t *get_target(const char *id);
 
 /**
+ * Run an algorithm on the @a target given.
+ *
+ * This routine is a wrapper for target->type->run_algorithm.
+ */
+extern int target_run_algorithm(struct target_s *target,
+		int num_mem_params, mem_param_t *mem_params,
+		int num_reg_params, reg_param_t *reg_param,
+		u32 entry_point, u32 exit_point,
+		int timeout_ms, void *arch_info);
+
+/**
  * Read @count items of @a size bytes from the memory of @a target at
  * the @a address given.
  *



From zwelch at mail.berlios.de  Sun May 31 11:38:53 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 11:38:53 +0200
Subject: [Openocd-svn] r1962 - trunk/src/target
Message-ID: <200905310938.n4V9cr1j014260@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 11:38:43 +0200 (Sun, 31 May 2009)
New Revision: 1962

Modified:
   trunk/src/target/arm11.c
   trunk/src/target/arm7_9_common.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/cortex_a8.c
   trunk/src/target/cortex_m3.c
   trunk/src/target/mips32.c
   trunk/src/target/mips_m4k.c
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Add wrappers for target->type->examined:
- replace all checks of target->type->examined with target_was_examined().
- replace all setting of target->type->examined with target_set_examined().
- replace clearing of target->type->examined with target_reset_examined().
- add documentation in target_s to warn not to access field directly.


Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/arm11.c	2009-05-31 09:38:43 UTC (rev 1962)
@@ -1631,7 +1631,7 @@
 
 	arm11_check_init(arm11, NULL);
 
-	target->type->examined = 1;
+	target_set_examined(target);
 
 	return ERROR_OK;
 }

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/arm7_9_common.c	2009-05-31 09:38:43 UTC (rev 1962)
@@ -818,7 +818,7 @@
 {
 	int retval = ERROR_OK;
 	target_t *target = priv;
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 		return ERROR_OK;
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/arm7tdmi.c	2009-05-31 09:38:43 UTC (rev 1962)
@@ -718,7 +718,7 @@
 	int retval;
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		/* get pointers to arch-specific information */
 		reg_cache_t **cache_p = register_get_last_cache_p(&target->reg_cache);
@@ -735,7 +735,7 @@
 			(*cache_p)->next = etm_build_reg_cache(target, jtag_info, arm7_9->etm_ctx);
 			arm7_9->etm_ctx->reg_cache = (*cache_p)->next;
 		}
-		target->type->examined = 1;
+		target_set_examined(target);
 	}
 	if ((retval=embeddedice_setup(target))!=ERROR_OK)
 		return retval;

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/arm9tdmi.c	2009-05-31 09:38:43 UTC (rev 1962)
@@ -810,7 +810,7 @@
 	int retval;
 	armv4_5_common_t *armv4_5 = target->arch_info;
 	arm7_9_common_t *arm7_9 = armv4_5->arch_info;
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		reg_cache_t **cache_p = register_get_last_cache_p(&target->reg_cache);
 		reg_cache_t *t;
@@ -827,7 +827,7 @@
 			(*cache_p)->next = etm_build_reg_cache(target, jtag_info, arm7_9->etm_ctx);
 			arm7_9->etm_ctx->reg_cache = (*cache_p)->next;
 		}
-		target->type->examined = 1;
+		target_set_examined(target);
 	}
 	if ((retval=embeddedice_setup(target))!=ERROR_OK)
 		return retval;

Modified: trunk/src/target/cortex_a8.c
===================================================================
--- trunk/src/target/cortex_a8.c	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/cortex_a8.c	2009-05-31 09:38:43 UTC (rev 1962)
@@ -168,7 +168,7 @@
 int cortex_a8_handle_target_request(void *priv)
 {
 	target_t *target = priv;
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 		return ERROR_OK;
 	armv7m_common_t *armv7m = target->arch_info;
 	swjdp_common_t *swjdp = &armv7m->swjdp_info;

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/cortex_m3.c	2009-05-31 09:38:43 UTC (rev 1962)
@@ -1429,9 +1429,9 @@
 	if ((retval = ahbap_debugport_init(swjdp)) != ERROR_OK)
 		return retval;
 	
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
-		target->type->examined = 1;
+		target_set_examined(target);
 		
 		/* Read from Device Identification Registers */
 		if ((retval = target_read_u32(target, CPUID, &cpuid)) != ERROR_OK)
@@ -1526,7 +1526,7 @@
 int cortex_m3_handle_target_request(void *priv)
 {
 	target_t *target = priv;
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 		return ERROR_OK;
 	armv7m_common_t *armv7m = target->arch_info;
 	swjdp_common_t *swjdp = &armv7m->swjdp_info;

Modified: trunk/src/target/mips32.c
===================================================================
--- trunk/src/target/mips32.c	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/mips32.c	2009-05-31 09:38:43 UTC (rev 1962)
@@ -346,9 +346,9 @@
 {
 	mips32_common_t *mips32 = target->arch_info;
 	
-	if (!target->type->examined)
+	if (target_was_examined(target))
 	{
-		target->type->examined = 1;
+		target_set_examined(target);
 	
 		/* we will configure later */
 		mips32->bp_scanned = 0;

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/mips_m4k.c	2009-05-31 09:38:43 UTC (rev 1962)
@@ -854,7 +854,7 @@
 	mips_ejtag_t *ejtag_info = &mips32->ejtag_info;
 	u32 idcode = 0;
 
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		mips_ejtag_get_idcode(ejtag_info, &idcode, NULL);
 		ejtag_info->idcode = idcode;

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/target.c	2009-05-31 09:38:43 UTC (rev 1962)
@@ -384,7 +384,7 @@
 int target_poll(struct target_s *target)
 {
 	/* We can't poll until after examine */
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		/* Fail silently lest we pollute the log */
 		return ERROR_FAIL;
@@ -395,7 +395,7 @@
 int target_halt(struct target_s *target)
 {
 	/* We can't poll until after examine */
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -408,7 +408,7 @@
 	int retval;
 
 	/* We can't poll until after examine */
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -463,7 +463,7 @@
 
 static int default_examine(struct target_s *target)
 {
-	target->type->examined = 1;
+	target_set_examined(target);
 	return ERROR_OK;
 }
 
@@ -487,7 +487,7 @@
 
 static int target_write_memory_imp(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
 {
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -497,7 +497,7 @@
 
 static int target_read_memory_imp(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
 {
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -507,7 +507,7 @@
 
 static int target_soft_reset_halt_imp(struct target_s *target)
 {
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -517,7 +517,7 @@
 
 static int target_run_algorithm_imp(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_param, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info)
 {
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -548,7 +548,23 @@
 			entry_point, exit_point, timeout_ms, arch_info);
 }
 
+/// @returns @c true if the target has been examined.
+bool target_was_examined(struct target_s *target)
+{
+	return target->type->examined;
+}
+/// Sets the @c examined flag for the given target.
+void target_set_examined(struct target_s *target)
+{
+	target->type->examined = true;
+}
+// Reset the @c examined flag for the given target.
+void target_reset_examined(struct target_s *target)
+{
+	target->type->examined = false;
+}
 
+
 int target_init(struct command_context_s *cmd_ctx)
 {
 	target_t *target = all_targets;
@@ -556,7 +572,7 @@
 
 	while (target)
 	{
-		target->type->examined = 0;
+		target_reset_examined(target);
 		if (target->type->examine == NULL)
 		{
 			target->type->examine = default_examine;
@@ -1003,7 +1019,7 @@
 	int retval;
 	LOG_DEBUG("writing buffer of %i byte at 0x%8.8x", size, address);
 
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -1082,7 +1098,7 @@
 	int retval;
 	LOG_DEBUG("reading buffer of %i byte at 0x%8.8x", size, address);
 
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -1149,7 +1165,7 @@
 	int retval;
 	u32 i;
 	u32 checksum = 0;
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -1191,7 +1207,7 @@
 int target_blank_check_memory(struct target_s *target, u32 address, u32 size, u32* blank)
 {
 	int retval;
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -1208,7 +1224,7 @@
 int target_read_u32(struct target_s *target, u32 address, u32 *value)
 {
 	u8 value_buf[4];
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -1233,7 +1249,7 @@
 int target_read_u16(struct target_s *target, u32 address, u16 *value)
 {
 	u8 value_buf[2];
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -1258,7 +1274,7 @@
 int target_read_u8(struct target_s *target, u32 address, u8 *value)
 {
 	int retval = target_read_memory(target, address, 1, 1, value);
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -1281,7 +1297,7 @@
 {
 	int retval;
 	u8 value_buf[4];
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -1302,7 +1318,7 @@
 {
 	int retval;
 	u8 value_buf[2];
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -1322,7 +1338,7 @@
 int target_write_u8(struct target_s *target, u32 address, u8 value)
 {
 	int retval;
-	if (!target->type->examined)
+	if (!target_was_examined(target))
 	{
 		LOG_ERROR("Target not examined yet");
 		return ERROR_FAIL;
@@ -3682,7 +3698,7 @@
 			Jim_WrongNumArgs( goi.interp, 2, argv, "[no parameters]");
 			return JIM_ERR;
 		}
-		if( !(target->type->examined) ){
+		if( !(target_was_examined(target)) ){
 			e = ERROR_TARGET_NOT_EXAMINED;
 		} else {
 			e = target->type->poll( target );

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 09:38:20 UTC (rev 1961)
+++ trunk/src/target/target.h	2009-05-31 09:38:43 UTC (rev 1962)
@@ -109,6 +109,12 @@
 {
 	char *name;
 
+	/**
+	 * Indicates whether this target has been examined.
+	 *
+	 * Do @b not access this field directly, use target_was_examined()
+	 * target_set_examined(), and target_reset_examined().
+	 */
 	int examined;
 
 	/* poll current target status */
@@ -383,6 +389,13 @@
 extern int get_num_by_target(target_t *query_target);
 extern target_t *get_target(const char *id);
 
+/// @returns @c true if the target has been examined.
+extern bool target_was_examined(struct target_s *target);
+/// Sets the @c examined flag for the given target.
+extern void target_set_examined(struct target_s *target);
+/// Reset the @c examined flag for the given target.
+extern void target_reset_examined(struct target_s *target);
+
 /**
  * Run an algorithm on the @a target given.
  *



From zwelch at mail.berlios.de  Sun May 31 11:39:09 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 11:39:09 +0200
Subject: [Openocd-svn] r1963 - in trunk/src: flash target
Message-ID: <200905310939.n4V9d9TC014280@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 11:39:04 +0200 (Sun, 31 May 2009)
New Revision: 1963

Modified:
   trunk/src/flash/orion_nand.c
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Add target_bulk_write_memory wrapper:
- replaces all calls to target->type->bulk_write_memory.
- add documentation in target_s to warn not to invoke callback directly.


Modified: trunk/src/flash/orion_nand.c
===================================================================
--- trunk/src/flash/orion_nand.c	2009-05-31 09:38:43 UTC (rev 1962)
+++ trunk/src/flash/orion_nand.c	2009-05-31 09:39:04 UTC (rev 1963)
@@ -140,8 +140,7 @@
 
 	/* copy data to target's memory */
 	target_buf = hw->copy_area->address + code_size;
-	retval = target->type->bulk_write_memory(target, target_buf,
-						 size/4, data);
+	retval = target_bulk_write_memory(target, target_buf, size/4, data);
 	if (retval == ERROR_OK && size & 3) {
 		retval = target_write_memory(target,
 					target_buf + (size & ~3),

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 09:38:43 UTC (rev 1962)
+++ trunk/src/target/target.c	2009-05-31 09:39:04 UTC (rev 1963)
@@ -536,7 +536,13 @@
 {
 	return target->type->write_memory(target, address, size, count, buffer);
 }
+int target_bulk_write_memory(struct target_s *target,
+		u32 address, u32 count, u8 *buffer)
+{
+	return target->type->bulk_write_memory(target, address, count, buffer);
+}
 
+
 int target_run_algorithm(struct target_s *target,
 		int num_mem_params, mem_param_t *mem_params,
 		int num_reg_params, reg_param_t *reg_param,

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 09:38:43 UTC (rev 1962)
+++ trunk/src/target/target.h	2009-05-31 09:39:04 UTC (rev 1963)
@@ -179,7 +179,11 @@
 	 */
 	int (*write_memory)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
 
-	/* write target memory in multiples of 4 byte, optimized for writing large quantities of data */
+	/**
+	 * Write target memory in multiples of 4 bytes, optimized for
+	 * writing large quantities of data.  Do @b not call this
+	 * function directly, use target_bulk_write_memory() instead.
+	 */
 	int (*bulk_write_memory)(struct target_s *target, u32 address, u32 count, u8 *buffer);
 
 	int (*checksum_memory)(struct target_s *target, u32 address, u32 count, u32* checksum);
@@ -424,6 +428,16 @@
 extern int target_write_memory(struct target_s *target,
 		u32 address, u32 size, u32 count, u8 *buffer);
 
+/**
+ * Write @count items of 4 bytes to the memory of @a target at
+ * the @a address given.  Because it operates only on whole words,
+ * this should be faster than target_write_memory().
+ *
+ * This routine is wrapper for target->type->bulk_write_memory.
+ */
+extern int target_bulk_write_memory(struct target_s *target,
+		u32 address, u32 count, u8 *buffer);
+
 extern int target_write_buffer(struct target_s *target, u32 address, u32 size, u8 *buffer);
 extern int target_read_buffer(struct target_s *target, u32 address, u32 size, u8 *buffer);
 extern int target_checksum_memory(struct target_s *target, u32 address, u32 size, u32* crc);



From zwelch at mail.berlios.de  Sun May 31 13:31:05 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 13:31:05 +0200
Subject: [Openocd-svn] r1964 - in trunk/src: server target
Message-ID: <200905311131.n4VBV5b3011878@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 13:30:59 +0200 (Sun, 31 May 2009)
New Revision: 1964

Modified:
   trunk/src/server/gdb_server.c
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Add target_get_gdb_reg_list wrapper:
- replaces all calls to target->type->get_gdb_reg_list.
- add documentation in target_s to warn not to invoke callback directly.


Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2009-05-31 09:39:04 UTC (rev 1963)
+++ trunk/src/server/gdb_server.c	2009-05-31 11:30:59 UTC (rev 1964)
@@ -947,7 +947,7 @@
 	LOG_DEBUG("-");
 #endif
 
-	if ((retval = target->type->get_gdb_reg_list(target, &reg_list, &reg_list_size)) != ERROR_OK)
+	if ((retval = target_get_gdb_reg_list(target, &reg_list, &reg_list_size)) != ERROR_OK)
 	{
 		return gdb_error(connection, retval);
 	}
@@ -1005,7 +1005,7 @@
 		return ERROR_SERVER_REMOTE_CLOSED;
 	}
 
-	if ((retval = target->type->get_gdb_reg_list(target, &reg_list, &reg_list_size)) != ERROR_OK)
+	if ((retval = target_get_gdb_reg_list(target, &reg_list, &reg_list_size)) != ERROR_OK)
 	{
 		return gdb_error(connection, retval);
 	}
@@ -1057,7 +1057,7 @@
 	LOG_DEBUG("-");
 #endif
 
-	if ((retval = target->type->get_gdb_reg_list(target, &reg_list, &reg_list_size)) != ERROR_OK)
+	if ((retval = target_get_gdb_reg_list(target, &reg_list, &reg_list_size)) != ERROR_OK)
 	{
 		return gdb_error(connection, retval);
 	}
@@ -1092,7 +1092,7 @@
 
 	LOG_DEBUG("-");
 
-	if ((retval = target->type->get_gdb_reg_list(target, &reg_list, &reg_list_size)) != ERROR_OK)
+	if ((retval = target_get_gdb_reg_list(target, &reg_list, &reg_list_size)) != ERROR_OK)
 	{
 		return gdb_error(connection, retval);
 	}

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 09:39:04 UTC (rev 1963)
+++ trunk/src/target/target.c	2009-05-31 11:30:59 UTC (rev 1964)
@@ -543,6 +543,12 @@
 }
 
 
+int target_get_gdb_reg_list(struct target_s *target,
+		struct reg_s **reg_list[], int *reg_list_size)
+{
+	return target->type->get_gdb_reg_list(target, reg_list, reg_list_size);
+}
+
 int target_run_algorithm(struct target_s *target,
 		int num_mem_params, mem_param_t *mem_params,
 		int num_reg_params, reg_param_t *reg_param,

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 09:39:04 UTC (rev 1963)
+++ trunk/src/target/target.h	2009-05-31 11:30:59 UTC (rev 1964)
@@ -151,7 +151,9 @@
 	int (*soft_reset_halt_imp)(struct target_s *target);
 	int (*soft_reset_halt)(struct target_s *target);
 
-	/* target register access for gdb.
+	/**
+	 * Target register access for GDB.  Do @b not call this function
+	 * directly, use target_get_gdb_reg_list() instead.
 	 *
 	 * Danger! this function will succeed even if the target is running
 	 * and return a register list with dummy values.
@@ -401,6 +403,14 @@
 extern void target_reset_examined(struct target_s *target);
 
 /**
+ * Obtain the registers for GDB.
+ *
+ * This routine is a wrapper for target->type->get_gdb_reg_list.
+ */
+extern int target_get_gdb_reg_list(struct target_s *target,
+		struct reg_s **reg_list[], int *reg_list_size);
+
+/**
  * Run an algorithm on the @a target given.
  *
  * This routine is a wrapper for target->type->run_algorithm.



From zwelch at mail.berlios.de  Sun May 31 13:31:18 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 13:31:18 +0200
Subject: [Openocd-svn] r1965 - in trunk/src: server target
Message-ID: <200905311131.n4VBVIge012186@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 13:31:11 +0200 (Sun, 31 May 2009)
New Revision: 1965

Modified:
   trunk/src/server/gdb_server.c
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Add target_step wrapper:
- replaces all calls to target->type->step.


Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2009-05-31 11:30:59 UTC (rev 1964)
+++ trunk/src/server/gdb_server.c	2009-05-31 11:31:11 UTC (rev 1965)
@@ -1366,7 +1366,8 @@
 	else if (packet[0] == 's')
 	{
 		LOG_DEBUG("step");
-		retval=target->type->step(target, current, address, 0); /* step at current or address, don't handle breakpoints */
+		/* step at current or address, don't handle breakpoints */
+		retval = target_step(target, current, address, 0);
 	}
 	return retval;
 }

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 11:30:59 UTC (rev 1964)
+++ trunk/src/target/target.c	2009-05-31 11:31:11 UTC (rev 1965)
@@ -548,7 +548,13 @@
 {
 	return target->type->get_gdb_reg_list(target, reg_list, reg_list_size);
 }
+int target_step(struct target_s *target,
+		int current, u32 address, int handle_breakpoints)
+{
+	return target->type->step(target, current, address, handle_breakpoints);
+}
 
+
 int target_run_algorithm(struct target_s *target,
 		int num_mem_params, mem_param_t *mem_params,
 		int num_reg_params, reg_param_t *reg_param,

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 11:30:59 UTC (rev 1964)
+++ trunk/src/target/target.h	2009-05-31 11:31:11 UTC (rev 1965)
@@ -411,6 +411,13 @@
 		struct reg_s **reg_list[], int *reg_list_size);
 
 /**
+ * Step the target.
+ *
+ * This routine is a wrapper for target->type->step.
+ */
+int target_step(struct target_s *target,
+		int current, u32 address, int handle_breakpoints);
+/**
  * Run an algorithm on the @a target given.
  *
  * This routine is a wrapper for target->type->run_algorithm.



From zwelch at mail.berlios.de  Sun May 31 13:31:36 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 13:31:36 +0200
Subject: [Openocd-svn] r1966 - in trunk/src: server target
Message-ID: <200905311131.n4VBVZhV012667@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 13:31:27 +0200 (Sun, 31 May 2009)
New Revision: 1966

Modified:
   trunk/src/server/gdb_server.c
   trunk/src/target/arm11.c
   trunk/src/target/embeddedice.c
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Add target_get_name wrapper:
- replaces all accesses to target->type->name.
- add documentation in target_s to warn not to access field directly.


Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2009-05-31 11:31:11 UTC (rev 1965)
+++ trunk/src/server/gdb_server.c	2009-05-31 11:31:27 UTC (rev 1966)
@@ -2211,7 +2211,8 @@
 
 		add_service("gdb", CONNECTION_PIPE, 0, 1, gdb_new_connection, gdb_input, gdb_connection_closed, gdb_service);
 
-		LOG_DEBUG("gdb service for target %s using pipes", target->type->name);
+		LOG_DEBUG("gdb service for target %s using pipes",
+				target_get_name(target));
 	}
 	else
 	{
@@ -2222,7 +2223,9 @@
 
 			add_service("gdb", CONNECTION_TCP, gdb_port + target->target_number, 1, gdb_new_connection, gdb_input, gdb_connection_closed, gdb_service);
 
-			LOG_DEBUG("gdb service for target %s at port %i", target->type->name, gdb_port + target->target_number);
+			LOG_DEBUG("gdb service for target %s at port %i",
+					target_get_name(target),
+					gdb_port + target->target_number);
 			target = target->next;
 		}
 	}

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-31 11:31:11 UTC (rev 1965)
+++ trunk/src/target/arm11.c	2009-05-31 11:31:27 UTC (rev 1966)
@@ -1847,7 +1847,7 @@
 			continue;
 
 		/* if (t->type == arm11_target) */
-		if (0 == strcmp(t->type->name, "arm11"))
+		if (0 == strcmp(target_get_name(t), "arm11"))
 			return t->arch_info;
 	}
 

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-05-31 11:31:11 UTC (rev 1965)
+++ trunk/src/target/embeddedice.c	2009-05-31 11:31:27 UTC (rev 1966)
@@ -184,7 +184,7 @@
 			 * in some unusual bits.  Let feroceon.c validate it
 			 * and do the appropriate setup itself.
 			 */
-			if (strcmp(target->type->name, "feroceon") == 0)
+			if (strcmp(target_get_name(target), "feroceon") == 0)
 				break;
 			LOG_ERROR("unknown EmbeddedICE version (comms ctrl: 0x%8.8x)", buf_get_u32(reg_list[EICE_COMMS_CTRL].value, 0, 32));
 	}

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 11:31:11 UTC (rev 1965)
+++ trunk/src/target/target.c	2009-05-31 11:31:27 UTC (rev 1966)
@@ -484,6 +484,10 @@
 	}
 	return retval;
 }
+const char *target_get_name(struct target_s *target)
+{
+	return target->type->name;
+}
 
 static int target_write_memory_imp(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
 {
@@ -598,7 +602,7 @@
 
 		if ((retval = target->type->init_target(cmd_ctx, target)) != ERROR_OK)
 		{
-			LOG_ERROR("target '%s' init failed", target->type->name);
+			LOG_ERROR("target '%s' init failed", target_get_name(target));
 			return retval;
 		}
 
@@ -1451,7 +1455,7 @@
 		command_print(cmd_ctx, "%2d: %-10s %-10s %-10s %10d %14s %s",
 					  target->target_number,
 					  target->cmd_name,
-					  target->type->name,
+					  target_get_name(target),
 					  Jim_Nvp_value2name_simple( nvp_target_endian, target->endianness )->name,
 					  target->tap->abs_chain_position,
 					  target->tap->dotted_name,
@@ -3131,7 +3135,7 @@
 			LOG_DEBUG( "target: (%d) %s (%s) event: %d (%s) action: %s\n",
 					   target->target_number,
 					   target->cmd_name,
-					   target->type->name,
+					   target_get_name(target),
 					   e,
 					   Jim_Nvp_value2name_simple( nvp_target_event, e )->name,
 					   Jim_GetString( teap->body, NULL ) );
@@ -3220,7 +3224,7 @@
 					return JIM_ERR;
 				}
 			}
-			Jim_SetResultString( goi->interp, target->type->name, -1 );
+			Jim_SetResultString( goi->interp, target_get_name(target), -1 );
 			/* loop for more */
 			break;
 		case TCFG_EVENT:

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 11:31:11 UTC (rev 1965)
+++ trunk/src/target/target.h	2009-05-31 11:31:27 UTC (rev 1966)
@@ -107,6 +107,10 @@
 
 typedef struct target_type_s
 {
+	/**
+	 * Name of the target.  Do @b not access this field directly, use
+	 * target_get_name() instead.
+	 */
 	char *name;
 
 	/**
@@ -395,6 +399,13 @@
 extern int get_num_by_target(target_t *query_target);
 extern target_t *get_target(const char *id);
 
+/**
+ * Get the target name.
+ *
+ * This routine is a wrapper for the target->type->name field.
+ */
+extern const char *target_get_name(struct target_s *target);
+
 /// @returns @c true if the target has been examined.
 extern bool target_was_examined(struct target_s *target);
 /// Sets the @c examined flag for the given target.



From zwelch at mail.berlios.de  Sun May 31 13:32:01 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 13:32:01 +0200
Subject: [Openocd-svn] r1967 - trunk/src/target
Message-ID: <200905311132.n4VBW14E012976@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 13:31:52 +0200 (Sun, 31 May 2009)
New Revision: 1967

Modified:
   trunk/src/target/breakpoints.c
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Add target breakpoint and watchpoint wrapper:
- replaces all calls to target->type->{add,remove}_{break,watch}point.


Modified: trunk/src/target/breakpoints.c
===================================================================
--- trunk/src/target/breakpoints.c	2009-05-31 11:31:27 UTC (rev 1966)
+++ trunk/src/target/breakpoints.c	2009-05-31 11:31:52 UTC (rev 1967)
@@ -61,7 +61,7 @@
 	(*breakpoint_p)->orig_instr = malloc(length);
 	(*breakpoint_p)->next = NULL;
 	
-	if ((retval = target->type->add_breakpoint(target, *breakpoint_p)) != ERROR_OK)
+	if ((retval = target_add_breakpoint(target, *breakpoint_p)) != ERROR_OK)
 	{
 		switch (retval)
 		{
@@ -108,7 +108,7 @@
 	if (breakpoint==NULL)
 		return;
 	
-	target->type->remove_breakpoint(target, breakpoint);
+	target_remove_breakpoint(target, breakpoint);
 	
 	(*breakpoint_p) = breakpoint->next;
 	free(breakpoint->orig_instr);
@@ -184,7 +184,7 @@
 	(*watchpoint_p)->set = 0;
 	(*watchpoint_p)->next = NULL;
 		
-	if ((retval = target->type->add_watchpoint(target, *watchpoint_p)) != ERROR_OK)
+	if ((retval = target_add_watchpoint(target, *watchpoint_p)) != ERROR_OK)
 	{
 		switch (retval)
 		{
@@ -229,7 +229,7 @@
 	
 	if (watchpoint==NULL)
 		return;
-	target->type->remove_watchpoint(target, watchpoint);
+	target_remove_watchpoint(target, watchpoint);
 	(*watchpoint_p) = watchpoint->next;
 	free(watchpoint);
 }

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 11:31:27 UTC (rev 1966)
+++ trunk/src/target/target.c	2009-05-31 11:31:52 UTC (rev 1967)
@@ -546,7 +546,28 @@
 	return target->type->bulk_write_memory(target, address, count, buffer);
 }
 
+int target_add_breakpoint(struct target_s *target,
+		struct breakpoint_s *breakpoint)
+{
+	return target->type->add_breakpoint(target, breakpoint);
+}
+int target_remove_breakpoint(struct target_s *target,
+		struct breakpoint_s *breakpoint)
+{
+	return target->type->remove_breakpoint(target, breakpoint);
+}
 
+int target_add_watchpoint(struct target_s *target,
+		struct watchpoint_s *watchpoint)
+{
+	return target->type->add_watchpoint(target, watchpoint);
+}
+int target_remove_watchpoint(struct target_s *target,
+		struct watchpoint_s *watchpoint)
+{
+	return target->type->remove_watchpoint(target, watchpoint);
+}
+
 int target_get_gdb_reg_list(struct target_s *target,
 		struct reg_s **reg_list[], int *reg_list_size)
 {

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 11:31:27 UTC (rev 1966)
+++ trunk/src/target/target.h	2009-05-31 11:31:52 UTC (rev 1967)
@@ -413,7 +413,37 @@
 /// Reset the @c examined flag for the given target.
 extern void target_reset_examined(struct target_s *target);
 
+
 /**
+ * Add the @a breakpoint for @a target.
+ *
+ * This routine is a wrapper for target->type->add_breakpoint.
+ */
+extern int target_add_breakpoint(struct target_s *target,
+		struct breakpoint_s *breakpoint);
+/**
+ * Remove the @a breakpoint for @a target.
+ *
+ * This routine is a wrapper for target->type->remove_breakpoint.
+ */
+extern int target_remove_breakpoint(struct target_s *target,
+		struct breakpoint_s *breakpoint);
+/**
+ * Add the @a watchpoint for @a target.
+ *
+ * This routine is a wrapper for target->type->add_watchpoint.
+ */
+extern int target_add_watchpoint(struct target_s *target,
+		struct watchpoint_s *watchpoint);
+/**
+ * Remove the @a watchpoint for @a target.
+ *
+ * This routine is a wrapper for target->type->remove_watchpoint.
+ */
+extern int target_remove_watchpoint(struct target_s *target,
+		struct watchpoint_s *watchpoint);
+
+/**
  * Obtain the registers for GDB.
  *
  * This routine is a wrapper for target->type->get_gdb_reg_list.



From zwelch at mail.berlios.de  Sun May 31 13:32:21 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 13:32:21 +0200
Subject: [Openocd-svn] r1968 - trunk/src/target
Message-ID: <200905311132.n4VBWLGW013129@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 13:32:10 +0200 (Sun, 31 May 2009)
New Revision: 1968

Modified:
   trunk/src/target/arm7_9_common.c
   trunk/src/target/target.c
   trunk/src/target/target.h
Log:
Add target_examine_one wrapper:
- replaces all calls to target->type->examine.


Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-05-31 11:31:52 UTC (rev 1967)
+++ trunk/src/target/arm7_9_common.c	2009-05-31 11:32:10 UTC (rev 1968)
@@ -1051,7 +1051,7 @@
 	{
 		LOG_WARNING("srst pulls trst - can not reset into halted mode. Issuing halt after reset.");
 		/* set up embedded ice registers again */
-		if ((retval=target->type->examine(target))!=ERROR_OK)
+		if ((retval = target_examine_one(target)) != ERROR_OK)
 			return retval;
 
 		if ((retval=target_poll(target))!=ERROR_OK)

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 11:31:52 UTC (rev 1967)
+++ trunk/src/target/target.c	2009-05-31 11:32:10 UTC (rev 1968)
@@ -467,6 +467,11 @@
 	return ERROR_OK;
 }
 
+int target_examine_one(struct target_s *target)
+{
+	return target->type->examine(target);
+}
+
 /* Targets that correctly implement init+examine, i.e.
  * no communication with target during init:
  *
@@ -478,7 +483,7 @@
 	target_t *target = all_targets;
 	while (target)
 	{
-		if ((retval = target->type->examine(target))!=ERROR_OK)
+		if ((retval = target_examine_one(target)) != ERROR_OK)
 			return retval;
 		target = target->next;
 	}

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 11:31:52 UTC (rev 1967)
+++ trunk/src/target/target.h	2009-05-31 11:32:10 UTC (rev 1968)
@@ -406,6 +406,12 @@
  */
 extern const char *target_get_name(struct target_s *target);
 
+/**
+ * Examine the specified @a target.
+ *
+ * This routine is a wrapper for target->type->examine.
+ */
+extern int target_examine_one(struct target_s *target);
 /// @returns @c true if the target has been examined.
 extern bool target_was_examined(struct target_s *target);
 /// Sets the @c examined flag for the given target.



From zwelch at mail.berlios.de  Sun May 31 13:32:44 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 13:32:44 +0200
Subject: [Openocd-svn] r1969 - trunk/src/target
Message-ID: <200905311132.n4VBWicW014046@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 13:32:28 +0200 (Sun, 31 May 2009)
New Revision: 1969

Modified:
   trunk/src/target/arm11.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/avrt.c
   trunk/src/target/cortex_a8.c
   trunk/src/target/cortex_m3.c
   trunk/src/target/feroceon.c
   trunk/src/target/mips_m4k.c
   trunk/src/target/target.c
   trunk/src/target/target.h
   trunk/src/target/target_request.c
   trunk/src/target/xscale.c
Log:
First step in hiding target_type_s from public interface:
- Add DEFINE_TARGET_TYPE_S symbol in files that need it defined.
- Forward declare 'struct target_type_s' only, unless that symbol is defined.


Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm11.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -26,6 +26,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "arm11.h"
 
 

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm720t.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -21,6 +21,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "arm720t.h"
 #include "time_support.h"
 

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm7tdmi.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -27,6 +27,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "arm7tdmi.h"
 
 

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm920t.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -21,6 +21,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "arm920t.h"
 #include "time_support.h"
 

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm926ejs.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -21,6 +21,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "arm926ejs.h"
 #include "time_support.h"
 

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm966e.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -24,6 +24,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "arm966e.h"
 
 

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm9tdmi.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -27,6 +27,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "arm9tdmi.h"
 
 

Modified: trunk/src/target/avrt.c
===================================================================
--- trunk/src/target/avrt.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/avrt.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -21,6 +21,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "avrt.h"
 #include "target.h"
 

Modified: trunk/src/target/cortex_a8.c
===================================================================
--- trunk/src/target/cortex_a8.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/cortex_a8.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -33,6 +33,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "cortex_a8.h"
 #include "target_request.h"
 

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/cortex_m3.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -31,6 +31,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "cortex_m3.h"
 #include "target_request.h"
 

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/feroceon.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -49,6 +49,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "arm926ejs.h"
 
 

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/mips_m4k.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -23,6 +23,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "mips32.h"
 #include "mips_m4k.h"
 #include "mips32_dmaacc.h"

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/target.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -33,6 +33,8 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
+
 #include "target.h"
 #include "target_request.h"
 #include "time_support.h"

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/target.h	2009-05-31 11:32:28 UTC (rev 1969)
@@ -105,7 +105,8 @@
 	struct working_area_s *next;
 } working_area_t;
 
-typedef struct target_type_s
+#ifdef DEFINE_TARGET_TYPE_S
+struct target_type_s
 {
 	/**
 	 * Name of the target.  Do @b not access this field directly, use
@@ -258,7 +259,11 @@
 	int (*virt2phys)(struct target_s *target, u32 address, u32 *physical);
 	int (*mmu)(struct target_s *target, int *enabled);
 
-} target_type_t;
+};
+#else
+struct target_type_s;
+#endif // DEFINE_TARGET_TYPE_S
+typedef struct target_type_s target_type_t;
 
 /* forward decloration */
 typedef struct target_event_action_s target_event_action_t;

Modified: trunk/src/target/target_request.c
===================================================================
--- trunk/src/target/target_request.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/target_request.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -27,6 +27,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "target_request.h"
 #include "binarybuffer.h"
 #include "trace.h"

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/xscale.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -24,6 +24,7 @@
 #include "config.h"
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include "xscale.h"
 #include "arm7_9_common.h"
 #include "arm_simulator.h"



From zwelch at mail.berlios.de  Sun May 31 14:11:04 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 14:11:04 +0200
Subject: [Openocd-svn] r1970 - in trunk/src: flash helper jtag target
Message-ID: <200905311211.n4VCB4re001653@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 14:10:57 +0200 (Sun, 31 May 2009)
New Revision: 1970

Modified:
   trunk/src/flash/Makefile.am
   trunk/src/helper/Makefile.am
   trunk/src/jtag/Makefile.am
   trunk/src/target/Makefile.am
Log:
Whitespace-only updates to automake input files:
- use continuations to break long lines of variable assignments
- makes these variables more patch-friendly and conform to style guide


Modified: trunk/src/flash/Makefile.am
===================================================================
--- trunk/src/flash/Makefile.am	2009-05-31 11:32:28 UTC (rev 1969)
+++ trunk/src/flash/Makefile.am	2009-05-31 12:10:57 UTC (rev 1970)
@@ -6,14 +6,56 @@
 METASOURCES = AUTO
 noinst_LTLIBRARIES = libflash.la
 libflash_la_SOURCES = \
-	flash.c lpc2000.c cfi.c non_cfi.c at91sam7.c davinci_nand.c \
-	str7x.c str9x.c aduc702x.c nand.c nand_ecc.c nand_ecc_kw.c \
-	lpc3180_nand_controller.c stellaris.c str9xpec.c stm32x.c tms470.c \
-	ecos.c orion_nand.c s3c24xx_nand.c s3c2410_nand.c s3c2412_nand.c \
-	s3c2440_nand.c s3c2443_nand.c lpc288x.c ocl.c mflash.c pic32mx.c avrf.c
+	flash.c \
+	lpc2000.c \
+	cfi.c \
+	non_cfi.c \
+	at91sam7.c \
+	davinci_nand.c \
+	str7x.c \
+	str9x.c \
+	aduc702x.c \
+	nand.c \
+	nand_ecc.c \
+	nand_ecc_kw.c \
+	lpc3180_nand_controller.c \
+	stellaris.c \
+	str9xpec.c \
+	stm32x.c \
+	tms470.c \
+	ecos.c \
+	orion_nand.c \
+	s3c24xx_nand.c \
+	s3c2410_nand.c \
+	s3c2412_nand.c \
+	s3c2440_nand.c \
+	s3c2443_nand.c \
+	lpc288x.c \
+	ocl.c \
+	mflash.c \
+	pic32mx.c \
+	avrf.c
+
 noinst_HEADERS = \
-	flash.h lpc2000.h cfi.h non_cfi.h at91sam7.h str7x.h \
-	str9x.h nand.h lpc3180_nand_controller.h stellaris.h str9xpec.h \
-	stm32x.h tms470.h s3c24xx_nand.h s3c24xx_regs_nand.h lpc288x.h \
-	mflash.h ocl.h pic32mx.h avrf.h
+	flash.h \
+	lpc2000.h \
+	cfi.h \
+	non_cfi.h \
+	at91sam7.h \
+	str7x.h \
+	str9x.h \
+	nand.h \
+	lpc3180_nand_controller.h \
+	stellaris.h \
+	str9xpec.h \
+	stm32x.h \
+	tms470.h \
+	s3c24xx_nand.h \
+	s3c24xx_regs_nand.h \
+	lpc288x.h \
+	mflash.h \
+	ocl.h \
+	pic32mx.h \
+	avrf.h
+
 MAINTAINERCLEANFILES = Makefile.in

Modified: trunk/src/helper/Makefile.am
===================================================================
--- trunk/src/helper/Makefile.am	2009-05-31 11:32:28 UTC (rev 1969)
+++ trunk/src/helper/Makefile.am	2009-05-31 12:10:57 UTC (rev 1970)
@@ -15,9 +15,15 @@
 
 
 libhelper_la_SOURCES = \
-	binarybuffer.c $(CONFIGFILES) configuration.c \
-	log.c command.c time_support.c \
-	replacements.c fileio.c startup_tcl.c
+	binarybuffer.c \
+	$(CONFIGFILES) \
+	configuration.c \
+	log.c \
+	command.c \
+	time_support.c \
+	replacements.c \
+	fileio.c \
+	startup_tcl.c
 
 if IOUTIL
 libhelper_la_SOURCES += ioutil.c
@@ -29,9 +35,20 @@
 libhelper_la_CFLAGS += -Wno-sign-compare
 endif
 
-noinst_HEADERS = binarybuffer.h configuration.h types.h log.h command.h \
-	time_support.h replacements.h fileio.h jim.h jim-eventloop.h \
-	system.h startup.tcl bin2char.c
+noinst_HEADERS = \
+	binarybuffer.h \
+	configuration.h \
+	types.h \
+	log.h \
+	command.h \
+	time_support.h \
+	replacements.h \
+	fileio.h \
+	jim.h \
+	jim-eventloop.h \
+	system.h \
+	startup.tcl \
+	bin2char.c
 
 bin2char$(EXEEXT_FOR_BUILD): bin2char.c
 	${CC_FOR_BUILD} ${CFLAGS_FOR_BUILD} $(srcdir)/bin2char.c -o $@

Modified: trunk/src/jtag/Makefile.am
===================================================================
--- trunk/src/jtag/Makefile.am	2009-05-31 11:32:28 UTC (rev 1969)
+++ trunk/src/jtag/Makefile.am	2009-05-31 12:10:57 UTC (rev 1970)
@@ -110,12 +110,30 @@
 endif
 
 libjtag_la_SOURCES = jtag.c \
-	$(BITBANGFILES) $(PARPORTFILES) $(DUMMYFILES) \
-	$(FT2232FILES) $(AMTJTAGACCELFILES) $(EP93XXFILES) \
-	$(AT91RM9200FILES) $(GW16012FILES) $(BITQFILES) \
-	$(PRESTOFILES) $(USBPROGFILES) $(ECOSBOARDFILES) \
-	$(JLINKFILES) $(RLINKFILES) $(VSLLINKFILES) $(ARMJTAGEWFILES)
+	$(BITBANGFILES) \
+	$(PARPORTFILES) \
+	$(DUMMYFILES) \
+	$(FT2232FILES) \
+	$(AMTJTAGACCELFILES) \
+	$(EP93XXFILES) \
+	$(AT91RM9200FILES) \
+	$(GW16012FILES) \
+	$(BITQFILES) \
+	$(PRESTOFILES) \
+	$(USBPROGFILES) \
+	$(ECOSBOARDFILES) \
+	$(JLINKFILES) \
+	$(RLINKFILES) \
+	$(VSLLINKFILES) \
+	$(ARMJTAGEWFILES)
 
-noinst_HEADERS = bitbang.h jtag.h bitq.h rlink/dtc_cmd.h rlink/ep1_cmd.h rlink/rlink.h rlink/st7.h
+noinst_HEADERS = \
+	bitbang.h \
+	jtag.h \
+	bitq.h \
+	rlink/dtc_cmd.h \
+	rlink/ep1_cmd.h \
+	rlink/rlink.h \
+	rlink/st7.h
 
 MAINTAINERCLEANFILES = Makefile.in

Modified: trunk/src/target/Makefile.am
===================================================================
--- trunk/src/target/Makefile.am	2009-05-31 11:32:28 UTC (rev 1969)
+++ trunk/src/target/Makefile.am	2009-05-31 12:10:57 UTC (rev 1970)
@@ -12,17 +12,87 @@
 
 METASOURCES = AUTO
 noinst_LTLIBRARIES = libtarget.la
-libtarget_la_SOURCES = target.c register.c breakpoints.c \
-	armv4_5.c embeddedice.c etm.c arm7tdmi.c arm9tdmi.c \
-	arm_jtag.c arm7_9_common.c algorithm.c arm920t.c arm720t.c armv4_5_mmu.c armv4_5_cache.c arm_disassembler.c \
-	arm966e.c arm926ejs.c feroceon.c etb.c xscale.c arm_simulator.c image.c armv7m.c cortex_m3.c cortex_a8.c arm_adi_v5.c \
-	etm_dummy.c $(OOCD_TRACE_FILES) target_request.c trace.c arm11.c arm11_dbgtap.c mips32.c mips_m4k.c \
-	mips32_pracc.c mips32_dmaacc.c mips_ejtag.c avrt.c
-noinst_HEADERS = target.h trace.h register.h armv4_5.h embeddedice.h etm.h arm7tdmi.h arm9tdmi.h \
-	arm_jtag.h arm7_9_common.h arm920t.h arm720t.h armv4_5_mmu.h armv4_5_cache.h breakpoints.h algorithm.h \
-	arm_disassembler.h arm966e.h arm926ejs.h etb.h xscale.h arm_simulator.h image.h armv7m.h cortex_m3.h cortex_a8.h arm_adi_v5.h \
-	etm_dummy.h oocd_trace.h target_request.h trace.h arm11.h mips32.h mips_m4k.h mips_ejtag.h mips32_pracc.h mips32_dmaacc.h avrt.h
+libtarget_la_SOURCES = \
+	target.c \
+	register.c \
+	breakpoints.c \
+	armv4_5.c \
+	embeddedice.c \
+	etm.c \
+	arm7tdmi.c \
+	arm9tdmi.c \
+	arm_jtag.c \
+	arm7_9_common.c \
+	algorithm.c \
+	arm920t.c \
+	arm720t.c \
+	armv4_5_mmu.c \
+	armv4_5_cache.c \
+	arm_disassembler.c \
+	arm966e.c \
+	arm926ejs.c \
+	feroceon.c \
+	etb.c \
+	xscale.c \
+	arm_simulator.c \
+	image.c \
+	armv7m.c \
+	cortex_m3.c \
+	cortex_a8.c \
+	arm_adi_v5.c \
+	etm_dummy.c \
+	$(OOCD_TRACE_FILES) \
+	target_request.c \
+	trace.c \
+	arm11.c \
+	arm11_dbgtap.c \
+	mips32.c \
+	mips_m4k.c \
+	mips32_pracc.c \
+	mips32_dmaacc.c \
+	mips_ejtag.c \
+	avrt.c
 
+noinst_HEADERS = \
+	target.h \
+	trace.h \
+	register.h \
+	armv4_5.h \
+	embeddedice.h \
+	etm.h \
+	arm7tdmi.h \
+	arm9tdmi.h \
+	arm_jtag.h \
+	arm7_9_common.h \
+	arm920t.h \
+	arm720t.h \
+	armv4_5_mmu.h \
+	armv4_5_cache.h \
+	breakpoints.h \
+	algorithm.h \
+	arm_disassembler.h \
+	arm966e.h \
+	arm926ejs.h \
+	etb.h \
+	xscale.h \
+	arm_simulator.h \
+	image.h \
+	armv7m.h \
+	cortex_m3.h \
+	cortex_a8.h \
+	arm_adi_v5.h \
+	etm_dummy.h \
+	oocd_trace.h \
+	target_request.h \
+	trace.h \
+	arm11.h \
+	mips32.h \
+	mips_m4k.h \
+	mips_ejtag.h \
+	mips32_pracc.h \
+	mips32_dmaacc.h \
+	avrt.h
+
 nobase_dist_pkglib_DATA =
 nobase_dist_pkglib_DATA += xscale/debug_handler.bin 
 nobase_dist_pkglib_DATA += ecos/at91eb40a.elf



From zwelch at mail.berlios.de  Sun May 31 14:38:44 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sun, 31 May 2009 14:38:44 +0200
Subject: [Openocd-svn] r1971 - trunk/src/target
Message-ID: <200905311238.n4VCci9O005036@sheep.berlios.de>

Author: zwelch
Date: 2009-05-31 14:38:28 +0200 (Sun, 31 May 2009)
New Revision: 1971

Added:
   trunk/src/target/target_type.h
Modified:
   trunk/src/target/Makefile.am
   trunk/src/target/arm11.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/avrt.c
   trunk/src/target/cortex_a8.c
   trunk/src/target/cortex_m3.c
   trunk/src/target/feroceon.c
   trunk/src/target/mips_m4k.c
   trunk/src/target/target.c
   trunk/src/target/target.h
   trunk/src/target/target_request.c
   trunk/src/target/xscale.c
Log:
Final step in isolating target_type_s structure:
- Move definition of 'struct target_type_s' into new 'target_type.h' file.
- Forward delclaration remains in target.h, with comment pointing to new file.
- Replaces #define with #include in source files.


Modified: trunk/src/target/Makefile.am
===================================================================
--- trunk/src/target/Makefile.am	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/Makefile.am	2009-05-31 12:38:28 UTC (rev 1971)
@@ -55,6 +55,7 @@
 
 noinst_HEADERS = \
 	target.h \
+	target_type.h \
 	trace.h \
 	register.h \
 	armv4_5.h \

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/arm11.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -26,8 +26,8 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "arm11.h"
+#include "target_type.h"
 
 
 #if 0

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/arm720t.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -21,9 +21,9 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "arm720t.h"
 #include "time_support.h"
+#include "target_type.h"
 
 
 #if 0

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/arm7tdmi.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -27,8 +27,8 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "arm7tdmi.h"
+#include "target_type.h"
 
 
 #if 0

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/arm920t.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -21,9 +21,9 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "arm920t.h"
 #include "time_support.h"
+#include "target_type.h"
 
 
 #if 0

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/arm926ejs.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -21,9 +21,9 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "arm926ejs.h"
 #include "time_support.h"
+#include "target_type.h"
 
 
 #if 0

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/arm966e.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -24,8 +24,8 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "arm966e.h"
+#include "target_type.h"
 
 
 #if 0

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/arm9tdmi.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -27,8 +27,8 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "arm9tdmi.h"
+#include "target_type.h"
 
 
 #if 0

Modified: trunk/src/target/avrt.c
===================================================================
--- trunk/src/target/avrt.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/avrt.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -21,9 +21,9 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "avrt.h"
 #include "target.h"
+#include "target_type.h"
 
 
 #define AVR_JTAG_INS_LEN	4

Modified: trunk/src/target/cortex_a8.c
===================================================================
--- trunk/src/target/cortex_a8.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/cortex_a8.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -33,9 +33,9 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "cortex_a8.h"
 #include "target_request.h"
+#include "target_type.h"
 
 
 /* cli handling */

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/cortex_m3.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -31,9 +31,9 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "cortex_m3.h"
 #include "target_request.h"
+#include "target_type.h"
 
 
 /* cli handling */

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/feroceon.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -49,8 +49,8 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "arm926ejs.h"
+#include "target_type.h"
 
 
 int feroceon_examine(struct target_s *target);

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/mips_m4k.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -23,10 +23,10 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "mips32.h"
 #include "mips_m4k.h"
 #include "mips32_dmaacc.h"
+#include "target_type.h"
 
 
 /* cli handling */

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/target.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -33,9 +33,8 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
-
 #include "target.h"
+#include "target_type.h"
 #include "target_request.h"
 #include "time_support.h"
 #include "register.h"

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/target.h	2009-05-31 12:38:28 UTC (rev 1971)
@@ -105,164 +105,8 @@
 	struct working_area_s *next;
 } working_area_t;
 
-#ifdef DEFINE_TARGET_TYPE_S
-struct target_type_s
-{
-	/**
-	 * Name of the target.  Do @b not access this field directly, use
-	 * target_get_name() instead.
-	 */
-	char *name;
-
-	/**
-	 * Indicates whether this target has been examined.
-	 *
-	 * Do @b not access this field directly, use target_was_examined()
-	 * target_set_examined(), and target_reset_examined().
-	 */
-	int examined;
-
-	/* poll current target status */
-	int (*poll)(struct target_s *target);
-	/* Invoked only from target_arch_state().
-	 * Issue USER() w/architecture specific status.  */
-	int (*arch_state)(struct target_s *target);
-
-	/* target request support */
-	int (*target_request_data)(struct target_s *target, u32 size, u8 *buffer);
-
-	/* halt will log a warning, but return ERROR_OK if the target is already halted. */
-	int (*halt)(struct target_s *target);
-	int (*resume)(struct target_s *target, int current, u32 address, int handle_breakpoints, int debug_execution);
-	int (*step)(struct target_s *target, int current, u32 address, int handle_breakpoints);
-
-	/* target reset control. assert reset can be invoked when OpenOCD and
-	 * the target is out of sync.
-	 *
-	 * A typical example is that the target was power cycled while OpenOCD
-	 * thought the target was halted or running.
-	 *
-	 * assert_reset() can therefore make no assumptions whatsoever about the
-	 * state of the target
-	 *
-	 * Before assert_reset() for the target is invoked, a TRST/tms and
-	 * chain validation is executed. TRST should not be asserted
-	 * during target assert unless there is no way around it due to
-	 * the way reset's are configured.
-	 *
-	 */
-	int (*assert_reset)(struct target_s *target);
-	int (*deassert_reset)(struct target_s *target);
-	int (*soft_reset_halt_imp)(struct target_s *target);
-	int (*soft_reset_halt)(struct target_s *target);
-
-	/**
-	 * Target register access for GDB.  Do @b not call this function
-	 * directly, use target_get_gdb_reg_list() instead.
-	 *
-	 * Danger! this function will succeed even if the target is running
-	 * and return a register list with dummy values.
-	 *
-	 * The reason is that GDB connection will fail without a valid register
-	 * list, however it is after GDB is connected that monitor commands can
-	 * be run to properly initialize the target
-	 */
-	int (*get_gdb_reg_list)(struct target_s *target, struct reg_s **reg_list[], int *reg_list_size);
-
-	/* target memory access
-	* size: 1 = byte (8bit), 2 = half-word (16bit), 4 = word (32bit)
-	* count: number of items of <size>
-	*/
-	int (*read_memory_imp)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
-	/**
-	 * Target memory read callback.  Do @b not call this function
-	 * directly, use target_read_memory() instead.
-	 */
-	int (*read_memory)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
-	int (*write_memory_imp)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
-	/**
-	 * Target memory write callback.  Do @b not call this function
-	 * directly, use target_write_memory() instead.
-	 */
-	int (*write_memory)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
-
-	/**
-	 * Write target memory in multiples of 4 bytes, optimized for
-	 * writing large quantities of data.  Do @b not call this
-	 * function directly, use target_bulk_write_memory() instead.
-	 */
-	int (*bulk_write_memory)(struct target_s *target, u32 address, u32 count, u8 *buffer);
-
-	int (*checksum_memory)(struct target_s *target, u32 address, u32 count, u32* checksum);
-	int (*blank_check_memory)(struct target_s *target, u32 address, u32 count, u32* blank);
-
-	/*
-	 * target break-/watchpoint control
-	 * rw: 0 = write, 1 = read, 2 = access
-	 *
-	 * Target must be halted while this is invoked as this
-	 * will actually set up breakpoints on target.
-	 *
-	 * The breakpoint hardware will be set up upon adding the first breakpoint.
-	 *
-	 * Upon GDB connection all breakpoints/watchpoints are cleared.
-	 */
-	int (*add_breakpoint)(struct target_s *target, breakpoint_t *breakpoint);
-
-	/* remove breakpoint. hw will only be updated if the target is currently halted.
-	 * However, this method can be invoked on unresponsive targets.
-	 */
-	int (*remove_breakpoint)(struct target_s *target, breakpoint_t *breakpoint);
-	int (*add_watchpoint)(struct target_s *target, watchpoint_t *watchpoint);
-	/* remove watchpoint. hw will only be updated if the target is currently halted.
-	 * However, this method can be invoked on unresponsive targets.
-	 */
-	int (*remove_watchpoint)(struct target_s *target, watchpoint_t *watchpoint);
-
-	/* target algorithm support */
-	int (*run_algorithm_imp)(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_param, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info);
-	/**
-	 * Target algorithm support.  Do @b not call this method directly,
-	 * use target_run_algorithm() instead.
-	 */
-	int (*run_algorithm)(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_param, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info);
-
-	int (*register_commands)(struct command_context_s *cmd_ctx);
-
-	/* called when target is created */
-	int (*target_create)( struct target_s *target, Jim_Interp *interp );
-
-	/* called for various config parameters */
-	/* returns JIM_CONTINUE - if option not understood */
-	/* otherwise: JIM_OK, or JIM_ERR, */
-	int (*target_jim_configure)( struct target_s *target, Jim_GetOptInfo *goi );
-
-	/* target commands specifically handled by the target */
-	/* returns JIM_OK, or JIM_ERR, or JIM_CONTINUE - if option not understood */
-	int (*target_jim_commands)( struct target_s *target, Jim_GetOptInfo *goi );
-
-	/* invoked after JTAG chain has been examined & validated. During
-	 * this stage the target is examined and any additional setup is
-	 * performed.
-	 *
-	 * invoked every time after the jtag chain has been validated/examined
-	 */
-	int (*examine)(struct target_s *target);
-	/* Set up structures for target.
-	 *
-	 * It is illegal to talk to the target at this stage as this fn is invoked
-	 * before the JTAG chain has been examined/verified
-	 * */
-	int (*init_target)(struct command_context_s *cmd_ctx, struct target_s *target);
-	int (*quit)(void);
-
-	int (*virt2phys)(struct target_s *target, u32 address, u32 *physical);
-	int (*mmu)(struct target_s *target, int *enabled);
-
-};
-#else
+// target_type.h contains the full definitionof struct target_type_s
 struct target_type_s;
-#endif // DEFINE_TARGET_TYPE_S
 typedef struct target_type_s target_type_t;
 
 /* forward decloration */

Modified: trunk/src/target/target_request.c
===================================================================
--- trunk/src/target/target_request.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/target_request.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -27,8 +27,8 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "target_request.h"
+#include "target_type.h"
 #include "binarybuffer.h"
 #include "trace.h"
 #include "log.h"

Added: trunk/src/target/target_type.h
===================================================================
--- trunk/src/target/target_type.h	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/target_type.h	2009-05-31 12:38:28 UTC (rev 1971)
@@ -0,0 +1,163 @@
+#ifndef TARGET_TYPE_H
+#define TARGET_TYPE_H
+
+#include "types.h"
+
+struct target_s;
+
+struct target_type_s
+{
+	/**
+	 * Name of the target.  Do @b not access this field directly, use
+	 * target_get_name() instead.
+	 */
+	char *name;
+
+	/**
+	 * Indicates whether this target has been examined.
+	 *
+	 * Do @b not access this field directly, use target_was_examined()
+	 * target_set_examined(), and target_reset_examined().
+	 */
+	int examined;
+
+	/* poll current target status */
+	int (*poll)(struct target_s *target);
+	/* Invoked only from target_arch_state().
+	 * Issue USER() w/architecture specific status.  */
+	int (*arch_state)(struct target_s *target);
+
+	/* target request support */
+	int (*target_request_data)(struct target_s *target, u32 size, u8 *buffer);
+
+	/* halt will log a warning, but return ERROR_OK if the target is already halted. */
+	int (*halt)(struct target_s *target);
+	int (*resume)(struct target_s *target, int current, u32 address, int handle_breakpoints, int debug_execution);
+	int (*step)(struct target_s *target, int current, u32 address, int handle_breakpoints);
+
+	/* target reset control. assert reset can be invoked when OpenOCD and
+	 * the target is out of sync.
+	 *
+	 * A typical example is that the target was power cycled while OpenOCD
+	 * thought the target was halted or running.
+	 *
+	 * assert_reset() can therefore make no assumptions whatsoever about the
+	 * state of the target
+	 *
+	 * Before assert_reset() for the target is invoked, a TRST/tms and
+	 * chain validation is executed. TRST should not be asserted
+	 * during target assert unless there is no way around it due to
+	 * the way reset's are configured.
+	 *
+	 */
+	int (*assert_reset)(struct target_s *target);
+	int (*deassert_reset)(struct target_s *target);
+	int (*soft_reset_halt_imp)(struct target_s *target);
+	int (*soft_reset_halt)(struct target_s *target);
+
+	/**
+	 * Target register access for GDB.  Do @b not call this function
+	 * directly, use target_get_gdb_reg_list() instead.
+	 *
+	 * Danger! this function will succeed even if the target is running
+	 * and return a register list with dummy values.
+	 *
+	 * The reason is that GDB connection will fail without a valid register
+	 * list, however it is after GDB is connected that monitor commands can
+	 * be run to properly initialize the target
+	 */
+	int (*get_gdb_reg_list)(struct target_s *target, struct reg_s **reg_list[], int *reg_list_size);
+
+	/* target memory access
+	* size: 1 = byte (8bit), 2 = half-word (16bit), 4 = word (32bit)
+	* count: number of items of <size>
+	*/
+	int (*read_memory_imp)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
+	/**
+	 * Target memory read callback.  Do @b not call this function
+	 * directly, use target_read_memory() instead.
+	 */
+	int (*read_memory)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
+	int (*write_memory_imp)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
+	/**
+	 * Target memory write callback.  Do @b not call this function
+	 * directly, use target_write_memory() instead.
+	 */
+	int (*write_memory)(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer);
+
+	/**
+	 * Write target memory in multiples of 4 bytes, optimized for
+	 * writing large quantities of data.  Do @b not call this
+	 * function directly, use target_bulk_write_memory() instead.
+	 */
+	int (*bulk_write_memory)(struct target_s *target, u32 address, u32 count, u8 *buffer);
+
+	int (*checksum_memory)(struct target_s *target, u32 address, u32 count, u32* checksum);
+	int (*blank_check_memory)(struct target_s *target, u32 address, u32 count, u32* blank);
+
+	/*
+	 * target break-/watchpoint control
+	 * rw: 0 = write, 1 = read, 2 = access
+	 *
+	 * Target must be halted while this is invoked as this
+	 * will actually set up breakpoints on target.
+	 *
+	 * The breakpoint hardware will be set up upon adding the first breakpoint.
+	 *
+	 * Upon GDB connection all breakpoints/watchpoints are cleared.
+	 */
+	int (*add_breakpoint)(struct target_s *target, breakpoint_t *breakpoint);
+
+	/* remove breakpoint. hw will only be updated if the target is currently halted.
+	 * However, this method can be invoked on unresponsive targets.
+	 */
+	int (*remove_breakpoint)(struct target_s *target, breakpoint_t *breakpoint);
+	int (*add_watchpoint)(struct target_s *target, watchpoint_t *watchpoint);
+	/* remove watchpoint. hw will only be updated if the target is currently halted.
+	 * However, this method can be invoked on unresponsive targets.
+	 */
+	int (*remove_watchpoint)(struct target_s *target, watchpoint_t *watchpoint);
+
+	/* target algorithm support */
+	int (*run_algorithm_imp)(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_param, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info);
+	/**
+	 * Target algorithm support.  Do @b not call this method directly,
+	 * use target_run_algorithm() instead.
+	 */
+	int (*run_algorithm)(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_param, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info);
+
+	int (*register_commands)(struct command_context_s *cmd_ctx);
+
+	/* called when target is created */
+	int (*target_create)( struct target_s *target, Jim_Interp *interp );
+
+	/* called for various config parameters */
+	/* returns JIM_CONTINUE - if option not understood */
+	/* otherwise: JIM_OK, or JIM_ERR, */
+	int (*target_jim_configure)( struct target_s *target, Jim_GetOptInfo *goi );
+
+	/* target commands specifically handled by the target */
+	/* returns JIM_OK, or JIM_ERR, or JIM_CONTINUE - if option not understood */
+	int (*target_jim_commands)( struct target_s *target, Jim_GetOptInfo *goi );
+
+	/* invoked after JTAG chain has been examined & validated. During
+	 * this stage the target is examined and any additional setup is
+	 * performed.
+	 *
+	 * invoked every time after the jtag chain has been validated/examined
+	 */
+	int (*examine)(struct target_s *target);
+	/* Set up structures for target.
+	 *
+	 * It is illegal to talk to the target at this stage as this fn is invoked
+	 * before the JTAG chain has been examined/verified
+	 * */
+	int (*init_target)(struct command_context_s *cmd_ctx, struct target_s *target);
+	int (*quit)(void);
+
+	int (*virt2phys)(struct target_s *target, u32 address, u32 *physical);
+	int (*mmu)(struct target_s *target, int *enabled);
+
+};
+
+#endif // TARGET_TYPE_H


Property changes on: trunk/src/target/target_type.h
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-31 12:10:57 UTC (rev 1970)
+++ trunk/src/target/xscale.c	2009-05-31 12:38:28 UTC (rev 1971)
@@ -24,8 +24,8 @@
 #include "config.h"
 #endif
 
-#define DEFINE_TARGET_TYPE_S
 #include "xscale.h"
+#include "target_type.h"
 #include "arm7_9_common.h"
 #include "arm_simulator.h"
 #include "arm_disassembler.h"



