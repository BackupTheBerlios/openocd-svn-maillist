<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-svn] r1462 - in trunk/src: flash helper jtag target
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-April/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-svn%5D%20r1462%20-%20in%20trunk/src%3A%20flash%20helper%20jtag%20target&In-Reply-To=%3C200904181008.n3IA8i8p007210%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000245.html">
   <LINK REL="Next"  HREF="000247.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-svn] r1462 - in trunk/src: flash helper jtag target</H1>
    <B>mifi at mail.berlios.de</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-svn%5D%20r1462%20-%20in%20trunk/src%3A%20flash%20helper%20jtag%20target&In-Reply-To=%3C200904181008.n3IA8i8p007210%40sheep.berlios.de%3E"
       TITLE="[Openocd-svn] r1462 - in trunk/src: flash helper jtag target">mifi at mail.berlios.de
       </A><BR>
    <I>Sat Apr 18 12:08:44 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000245.html">[Openocd-svn] r1461 - trunk/src/target/target
</A></li>
        <LI>Next message: <A HREF="000247.html">[Openocd-svn] r1463 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#246">[ date ]</a>
              <a href="thread.html#246">[ thread ]</a>
              <a href="subject.html#246">[ subject ]</a>
              <a href="author.html#246">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mifi
Date: 2009-04-18 12:08:13 +0200 (Sat, 18 Apr 2009)
New Revision: 1462

Modified:
   trunk/src/flash/aduc702x.c
   trunk/src/flash/at91sam7.c
   trunk/src/flash/at91sam7_old.c
   trunk/src/flash/cfi.c
   trunk/src/flash/ecos.c
   trunk/src/flash/flash.c
   trunk/src/flash/lpc2000.c
   trunk/src/flash/lpc288x.c
   trunk/src/flash/lpc3180_nand_controller.c
   trunk/src/flash/nand.c
   trunk/src/flash/ocl.c
   trunk/src/flash/orion_nand.c
   trunk/src/flash/pic32mx.c
   trunk/src/flash/s3c2410_nand.c
   trunk/src/flash/s3c2412_nand.c
   trunk/src/flash/s3c2440_nand.c
   trunk/src/flash/s3c2443_nand.c
   trunk/src/flash/stellaris.c
   trunk/src/flash/stm32x.c
   trunk/src/flash/str7x.c
   trunk/src/flash/str9x.c
   trunk/src/flash/str9xpec.c
   trunk/src/flash/tms470.c
   trunk/src/helper/tclapi.c
   trunk/src/jtag/amt_jtagaccel.c
   trunk/src/jtag/arm-jtag-ew.c
   trunk/src/jtag/bitbang.c
   trunk/src/jtag/bitq.c
   trunk/src/jtag/ft2232.c
   trunk/src/jtag/gw16012.c
   trunk/src/jtag/jlink.c
   trunk/src/jtag/jtag.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/usbprog.c
   trunk/src/jtag/vsllink.c
   trunk/src/target/arm11.c
   trunk/src/target/arm11_dbgtap.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/arm_jtag.c
   trunk/src/target/cortex_swjdp.c
   trunk/src/target/embeddedice.c
   trunk/src/target/embeddedice.h
   trunk/src/target/etb.c
   trunk/src/target/etm.c
   trunk/src/target/feroceon.c
   trunk/src/target/mips_ejtag.c
   trunk/src/target/xscale.c
Log:
The following patches was applied:

- openocd-flash-static-keyword-v3.patch
- openocd-lpc2000-fix-erase-obo.patch
- openocd-jlink-fix-sign-ptr-warn.patch
- openocd-wextra-etm.patch
- openocd-wextra-jtag.patch
- openocd-add-new-tap-symbols-v6.patch

Many thanks to  Zach Welch &lt;zw(at)superlucidity.net&gt;

Modified: trunk/src/flash/aduc702x.c
===================================================================
--- trunk/src/flash/aduc702x.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/aduc702x.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -36,19 +36,19 @@
 #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
 
-int aduc702x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int aduc702x_register_commands(struct command_context_s *cmd_ctx);
-int aduc702x_erase(struct flash_bank_s *bank, int first, int last);
-int aduc702x_protect(struct flash_bank_s *bank, int set, int first, int last);
-int aduc702x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int aduc702x_write_single(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int aduc702x_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int aduc702x_probe(struct flash_bank_s *bank);
-int aduc702x_info(struct flash_bank_s *bank, char *buf, int buf_size);
-int aduc702x_protect_check(struct flash_bank_s *bank);
-int aduc702x_build_sector_list(struct flash_bank_s *bank);
-int aduc702x_check_flash_completion(target_t* target, unsigned int timeout_ms);
-int aduc702x_set_write_enable(target_t *target, int enable);
+static int aduc702x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int aduc702x_register_commands(struct command_context_s *cmd_ctx);
+static int aduc702x_erase(struct flash_bank_s *bank, int first, int last);
+static int aduc702x_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int aduc702x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int aduc702x_write_single(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int aduc702x_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int aduc702x_probe(struct flash_bank_s *bank);
+static int aduc702x_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int aduc702x_protect_check(struct flash_bank_s *bank);
+static int aduc702x_build_sector_list(struct flash_bank_s *bank);
+static int aduc702x_check_flash_completion(target_t* target, unsigned int timeout_ms);
+static int aduc702x_set_write_enable(target_t *target, int enable);
 
 #define ADUC702x_FLASH				0xfffff800
 #define ADUC702x_FLASH_FEESTA		(0*4)
@@ -91,14 +91,14 @@
 	.info = aduc702x_info
 };
 
-int aduc702x_register_commands(struct command_context_s *cmd_ctx)
+static int aduc702x_register_commands(struct command_context_s *cmd_ctx)
 {
 	return ERROR_OK;
 }
 
 /* flash bank aduc702x 0 0 0 0 &lt;target#&gt;
  * The ADC7019-28 devices all have the same flash layout */
-int aduc702x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int aduc702x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	aduc702x_flash_bank_t *nbank;
 
@@ -113,7 +113,7 @@
         return ERROR_OK;
 }
 
-int aduc702x_build_sector_list(struct flash_bank_s *bank)
+static int aduc702x_build_sector_list(struct flash_bank_s *bank)
 {
 	//aduc7026_flash_bank_t *aduc7026_info = bank-&gt;driver_priv;
 	
@@ -135,13 +135,13 @@
 	return ERROR_OK;
 }
 
-int aduc702x_protect_check(struct flash_bank_s *bank)
+static int aduc702x_protect_check(struct flash_bank_s *bank)
 {
 	printf(&quot;aduc702x_protect_check not implemented yet.\n&quot;);
 	return ERROR_OK;
 }
 
-int aduc702x_erase(struct flash_bank_s *bank, int first, int last)
+static int aduc702x_erase(struct flash_bank_s *bank, int first, int last)
 {
         //int res;
 	int x;
@@ -194,13 +194,13 @@
 	return ERROR_OK;
 }
 
-int aduc702x_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int aduc702x_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	printf(&quot;aduc702x_protect not implemented yet.\n&quot;);
 	return ERROR_FLASH_OPERATION_FAILED;
 }
 
-int aduc702x_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int aduc702x_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	aduc702x_flash_bank_t *aduc702x_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -329,7 +329,7 @@
 
 /* All-JTAG, single-access method.  Very slow.  Used only if there is no 
  * working area available. */
-int aduc702x_write_single(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int aduc702x_write_single(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	int x;
         u8 b;
@@ -399,12 +399,12 @@
         return ERROR_OK;
 }
 
-int aduc702x_probe(struct flash_bank_s *bank)
+static int aduc702x_probe(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
-int aduc702x_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int aduc702x_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	snprintf(buf, buf_size, &quot;aduc702x flash driver info&quot; );
 	return ERROR_OK;
@@ -412,7 +412,7 @@
 
 /* sets FEEMOD bit 3
  * enable = 1 enables writes &amp; erases, 0 disables them */
-int aduc702x_set_write_enable(target_t *target, int enable)
+static int aduc702x_set_write_enable(target_t *target, int enable)
 {
         // don't bother to preserve int enable bit here
         target_write_u16(target, ADUC702x_FLASH + ADUC702x_FLASH_FEEMOD, enable ? 8 : 0);
@@ -425,7 +425,7 @@
  *
  * this function sleeps 1ms between checks (after the first one),
  * so in some cases may slow things down without a usleep after the first read */
-int aduc702x_check_flash_completion(target_t* target, unsigned int timeout_ms)
+static int aduc702x_check_flash_completion(target_t* target, unsigned int timeout_ms)
 {
         u8 v = 4;
 

Modified: trunk/src/flash/at91sam7.c
===================================================================
--- trunk/src/flash/at91sam7.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/at91sam7.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -53,22 +53,22 @@
 #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
 
-int at91sam7_register_commands(struct command_context_s *cmd_ctx);
-int at91sam7_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int at91sam7_erase(struct flash_bank_s *bank, int first, int last);
-int at91sam7_protect(struct flash_bank_s *bank, int set, int first, int last);
-int at91sam7_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int at91sam7_probe(struct flash_bank_s *bank);
-int at91sam7_auto_probe(struct flash_bank_s *bank);
-int at91sam7_erase_check(struct flash_bank_s *bank);
-int at91sam7_protect_check(struct flash_bank_s *bank);
-int at91sam7_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int at91sam7_register_commands(struct command_context_s *cmd_ctx);
+static int at91sam7_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int at91sam7_erase(struct flash_bank_s *bank, int first, int last);
+static int at91sam7_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int at91sam7_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int at91sam7_probe(struct flash_bank_s *bank);
+//static int at91sam7_auto_probe(struct flash_bank_s *bank);
+static int at91sam7_erase_check(struct flash_bank_s *bank);
+static int at91sam7_protect_check(struct flash_bank_s *bank);
+static int at91sam7_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
-u32 at91sam7_get_flash_status(target_t *target, int bank_number);
-void at91sam7_set_flash_mode(flash_bank_t *bank, int mode);
-u32 at91sam7_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout);
-int at91sam7_flash_command(struct flash_bank_s *bank, u8 cmd, u16 pagen); 
-int at91sam7_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static u32 at91sam7_get_flash_status(target_t *target, int bank_number);
+static void at91sam7_set_flash_mode(flash_bank_t *bank, int mode);
+static u32 at91sam7_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout);
+static int at91sam7_flash_command(struct flash_bank_s *bank, u8 cmd, u16 pagen); 
+static int at91sam7_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 flash_driver_t at91sam7_flash =
 {
@@ -85,13 +85,14 @@
 	.info = at91sam7_info
 };
 
-u32 MC_FMR[4] = { 0xFFFFFF60, 0xFFFFFF70, 0xFFFFFF80, 0xFFFFFF90 };
-u32 MC_FCR[4] = { 0xFFFFFF64, 0xFFFFFF74, 0xFFFFFF84, 0xFFFFFF94 };
-u32 MC_FSR[4] = { 0xFFFFFF68, 0xFFFFFF78, 0xFFFFFF88, 0xFFFFFF98 };
+static u32 MC_FMR[4] = { 0xFFFFFF60, 0xFFFFFF70, 0xFFFFFF80, 0xFFFFFF90 };
+static u32 MC_FCR[4] = { 0xFFFFFF64, 0xFFFFFF74, 0xFFFFFF84, 0xFFFFFF94 };
+static u32 MC_FSR[4] = { 0xFFFFFF68, 0xFFFFFF78, 0xFFFFFF88, 0xFFFFFF98 };
 
-char * EPROC[8]= {&quot;Unknown&quot;,&quot;ARM946-E&quot;,&quot;ARM7TDMI&quot;,&quot;Unknown&quot;,&quot;ARM920T&quot;,&quot;ARM926EJ-S&quot;,&quot;Unknown&quot;,&quot;Unknown&quot;};
+static char * EPROC[8]= {&quot;Unknown&quot;,&quot;ARM946-E&quot;,&quot;ARM7TDMI&quot;,&quot;Unknown&quot;,&quot;ARM920T&quot;,&quot;ARM926EJ-S&quot;,&quot;Unknown&quot;,&quot;Unknown&quot;};
 
-long SRAMSIZ[16] = {
+#if 0
+static long SRAMSIZ[16] = {
 	-1,
 	0x0400,		/*  1K */
 	0x0800,		/*  2K */ 
@@ -109,8 +110,9 @@
 	0x18000,	/*  96K */
 	0x80000,	/* 512K */
 };
+#endif
 
-int at91sam7_register_commands(struct command_context_s *cmd_ctx)
+static int at91sam7_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *at91sam7_cmd = register_command(cmd_ctx, NULL, &quot;at91sam7_new&quot;, NULL, COMMAND_ANY, NULL);
 
@@ -119,7 +121,7 @@
 	return ERROR_OK;
 }
 
-u32 at91sam7_get_flash_status(target_t *target, int bank_number)
+static u32 at91sam7_get_flash_status(target_t *target, int bank_number)
 {
 	u32 fsr;
 	target_read_u32(target, MC_FSR[bank_number], &amp;fsr);
@@ -128,7 +130,7 @@
 }
 
 /* Read clock configuration and set at91sam7_info-&gt;mck_freq */
-void at91sam7_read_clock_info(flash_bank_t *bank)
+static void at91sam7_read_clock_info(flash_bank_t *bank)
 {
 	at91sam7_flash_bank_t *at91sam7_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -207,7 +209,7 @@
 }
 
 /* Setup the timimg registers for nvbits or normal flash */
-void at91sam7_set_flash_mode(flash_bank_t *bank, int mode)
+static void at91sam7_set_flash_mode(flash_bank_t *bank, int mode)
 {
 	u32 fmr, fmcn = 0, fws = 0;
 	at91sam7_flash_bank_t *at91sam7_info = bank-&gt;driver_priv;
@@ -255,7 +257,7 @@
 	at91sam7_info-&gt;flashmode = mode;
 }
 
-u32 at91sam7_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout)
+static u32 at91sam7_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout)
 {
 	u32 status;
 
@@ -282,7 +284,7 @@
 }
 
 /* Send one command to the AT91SAM flash controller */
-int at91sam7_flash_command(struct flash_bank_s *bank, u8 cmd, u16 pagen)
+static int at91sam7_flash_command(struct flash_bank_s *bank, u8 cmd, u16 pagen)
 {
 	u32 fcr;
 	at91sam7_flash_bank_t *at91sam7_info = bank-&gt;driver_priv;
@@ -311,7 +313,7 @@
 }
 
 /* Read device id register, main clock frequency register and fill in driver info structure */
-int at91sam7_read_part_info(struct flash_bank_s *bank)
+static int at91sam7_read_part_info(struct flash_bank_s *bank)
 {
 	flash_bank_t *t_bank = bank;
 	at91sam7_flash_bank_t *at91sam7_info;
@@ -626,7 +628,7 @@
 	return ERROR_OK;
 }
 
-int at91sam7_erase_check(struct flash_bank_s *bank)
+static int at91sam7_erase_check(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	u16 retval;
@@ -692,7 +694,7 @@
 	return ERROR_OK;
 }
 
-int at91sam7_protect_check(struct flash_bank_s *bank)
+static int at91sam7_protect_check(struct flash_bank_s *bank)
 {
 	u8 lock_pos, gpnvm_pos;
 	u32 status;
@@ -752,7 +754,7 @@
 #  flash bank at91sam7 0x00100000 0 0 4 0 0 AT91SAM7XC256 1 16 64 256 3 0                       ==== NOT RECOMENDED !!! ====
 #  flash bank at91sam7 0 0 0 0 0                        (old style, full auto-detection)        ==== NOT RECOMENDED !!! ====
 ****************************************************************************************************************************************************************************************/
-int at91sam7_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int at91sam7_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	flash_bank_t *t_bank = bank;
 	at91sam7_flash_bank_t *at91sam7_info;
@@ -864,7 +866,7 @@
 	return ERROR_OK;
 }
 
-int at91sam7_erase(struct flash_bank_s *bank, int first, int last)
+static int at91sam7_erase(struct flash_bank_s *bank, int first, int last)
 {
 	at91sam7_flash_bank_t *at91sam7_info = bank-&gt;driver_priv;
 	int sec;
@@ -932,7 +934,7 @@
 	return ERROR_OK;
 }
 
-int at91sam7_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int at91sam7_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	u32 cmd;
 	u32 sector, pagen;
@@ -981,7 +983,7 @@
 	return ERROR_OK;
 }
 
-int at91sam7_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int at91sam7_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	int retval;
 	at91sam7_flash_bank_t *at91sam7_info = bank-&gt;driver_priv;
@@ -1050,7 +1052,7 @@
 	return ERROR_OK;
 }
 
-int at91sam7_probe(struct flash_bank_s *bank)
+static int at91sam7_probe(struct flash_bank_s *bank)
 {
 	/* we can't probe on an at91sam7
 	 * if this is an at91sam7, it has the configured flash */
@@ -1069,7 +1071,7 @@
 	return ERROR_OK;
 }
 
-int at91sam7_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int at91sam7_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	int printed;
 	at91sam7_flash_bank_t *at91sam7_info = bank-&gt;driver_priv;
@@ -1130,7 +1132,7 @@
 *   The maximum number of write/erase cycles for Non volatile Memory bits is 100. this includes
 *   Lock Bits (LOCKx), General Purpose NVM bits (GPNVMx) and the Security Bit.
 */
-int at91sam7_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int at91sam7_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	int bit;

Modified: trunk/src/flash/at91sam7_old.c
===================================================================
--- trunk/src/flash/at91sam7_old.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/at91sam7_old.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -51,22 +51,22 @@
 #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
 
-int at91sam7_old_register_commands(struct command_context_s *cmd_ctx);
-int at91sam7_old_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int at91sam7_old_erase(struct flash_bank_s *bank, int first, int last);
-int at91sam7_old_protect(struct flash_bank_s *bank, int set, int first, int last);
-int at91sam7_old_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int at91sam7_old_probe(struct flash_bank_s *bank);
-int at91sam7_old_auto_probe(struct flash_bank_s *bank);
-int at91sam7_old_erase_check(struct flash_bank_s *bank);
-int at91sam7_old_protect_check(struct flash_bank_s *bank);
-int at91sam7_old_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int at91sam7_old_register_commands(struct command_context_s *cmd_ctx);
+static int at91sam7_old_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int at91sam7_old_erase(struct flash_bank_s *bank, int first, int last);
+static int at91sam7_old_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int at91sam7_old_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int at91sam7_old_probe(struct flash_bank_s *bank);
+//static int at91sam7_old_auto_probe(struct flash_bank_s *bank);
+static int at91sam7_old_erase_check(struct flash_bank_s *bank);
+static int at91sam7_old_protect_check(struct flash_bank_s *bank);
+static int at91sam7_old_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
-u32 at91sam7_old_get_flash_status(flash_bank_t *bank, u8 flashplane);
-void at91sam7_old_set_flash_mode(flash_bank_t *bank, u8 flashplane, int mode);
-u32 at91sam7_old_wait_status_busy(flash_bank_t *bank, u8 flashplane, u32 waitbits, int timeout);
-int at91sam7_old_flash_command(struct flash_bank_s *bank, u8 flashplane, u8 cmd, u16 pagen); 
-int at91sam7_old_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static u32 at91sam7_old_get_flash_status(flash_bank_t *bank, u8 flashplane);
+static void at91sam7_old_set_flash_mode(flash_bank_t *bank, u8 flashplane, int mode);
+static u32 at91sam7_old_wait_status_busy(flash_bank_t *bank, u8 flashplane, u32 waitbits, int timeout);
+static int at91sam7_old_flash_command(struct flash_bank_s *bank, u8 flashplane, u8 cmd, u16 pagen); 
+static int at91sam7_old_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 flash_driver_t at91sam7_old_flash =
 {
@@ -83,12 +83,12 @@
 	.info = at91sam7_old_info
 };
 
-u32 MC_FMR_old[4] =	{ 0xFFFFFF60, 0xFFFFFF70, 0xFFFFFF80, 0xFFFFFF90 };
-u32 MC_FCR_old[4] =	{ 0xFFFFFF64, 0xFFFFFF74, 0xFFFFFF84, 0xFFFFFF94 };
-u32 MC_FSR_old[4] =	{ 0xFFFFFF68, 0xFFFFFF78, 0xFFFFFF88, 0xFFFFFF98 };
+static u32 MC_FMR_old[4] =	{ 0xFFFFFF60, 0xFFFFFF70, 0xFFFFFF80, 0xFFFFFF90 };
+static u32 MC_FCR_old[4] =	{ 0xFFFFFF64, 0xFFFFFF74, 0xFFFFFF84, 0xFFFFFF94 };
+static u32 MC_FSR_old[4] =	{ 0xFFFFFF68, 0xFFFFFF78, 0xFFFFFF88, 0xFFFFFF98 };
 
-char * EPROC_old[8]= {&quot;Unknown&quot;,&quot;ARM946-E&quot;,&quot;ARM7TDMI&quot;,&quot;Unknown&quot;,&quot;ARM920T&quot;,&quot;ARM926EJ-S&quot;,&quot;Unknown&quot;,&quot;Unknown&quot;};
-long NVPSIZ_old[16] = {
+static char * EPROC_old[8]= {&quot;Unknown&quot;,&quot;ARM946-E&quot;,&quot;ARM7TDMI&quot;,&quot;Unknown&quot;,&quot;ARM920T&quot;,&quot;ARM926EJ-S&quot;,&quot;Unknown&quot;,&quot;Unknown&quot;};
+static long NVPSIZ_old[16] = {
    0,
    0x2000, /*  8K */
    0x4000, /* 16K */ 
@@ -107,7 +107,8 @@
    -1
 };
 
-long SRAMSIZ_old[16] = {
+#if 0
+static long SRAMSIZ_old[16] = {
    -1,
    0x0400, /*  1K */
    0x0800, /*  2K */ 
@@ -125,8 +126,9 @@
    0x18000, /* 96K */
    0x80000, /* 512K */
 };
+#endif
 
-int at91sam7_old_register_commands(struct command_context_s *cmd_ctx)
+static int at91sam7_old_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *at91sam7_old_cmd = register_command(cmd_ctx, NULL, &quot;at91sam7&quot;, NULL, COMMAND_ANY, NULL);
 	register_command(cmd_ctx, at91sam7_old_cmd, &quot;gpnvm&quot;, at91sam7_old_handle_gpnvm_command, COMMAND_EXEC,
@@ -135,7 +137,7 @@
 	return ERROR_OK;
 }
 
-u32 at91sam7_old_get_flash_status(flash_bank_t *bank, u8 flashplane)
+static u32 at91sam7_old_get_flash_status(flash_bank_t *bank, u8 flashplane)
 {
 	target_t *target = bank-&gt;target;
 	u32 fsr;
@@ -146,7 +148,7 @@
 }
 
 /* Read clock configuration and set at91sam7_old_info-&gt;usec_clocks*/
-void at91sam7_old_read_clock_info(flash_bank_t *bank)
+static void at91sam7_old_read_clock_info(flash_bank_t *bank)
 {
 	at91sam7_old_flash_bank_t *at91sam7_old_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -210,7 +212,7 @@
 }
 
 /* Setup the timimg registers for nvbits or normal flash */
-void at91sam7_old_set_flash_mode(flash_bank_t *bank, u8 flashplane, int mode)
+static void at91sam7_old_set_flash_mode(flash_bank_t *bank, u8 flashplane, int mode)
 {
 	u32 fmr, fmcn = 0, fws = 0;
 	at91sam7_old_flash_bank_t *at91sam7_old_info = bank-&gt;driver_priv;
@@ -251,7 +253,7 @@
 	at91sam7_old_info-&gt;flashmode[flashplane] = mode;		
 }
 
-u32 at91sam7_old_wait_status_busy(flash_bank_t *bank, u8 flashplane, u32 waitbits, int timeout)
+static u32 at91sam7_old_wait_status_busy(flash_bank_t *bank, u8 flashplane, u32 waitbits, int timeout)
 {
 	u32 status;
 	
@@ -279,7 +281,7 @@
 
 
 /* Send one command to the AT91SAM flash controller */
-int at91sam7_old_flash_command(struct flash_bank_s *bank, u8 flashplane, u8 cmd, u16 pagen) 
+static int at91sam7_old_flash_command(struct flash_bank_s *bank, u8 flashplane, u8 cmd, u16 pagen) 
 {
 	u32 fcr;
 	at91sam7_old_flash_bank_t *at91sam7_old_info = bank-&gt;driver_priv;
@@ -307,7 +309,7 @@
 }
 
 /* Read device id register, main clock frequency register and fill in driver info structure */
-int at91sam7_old_read_part_info(struct flash_bank_s *bank)
+static int at91sam7_old_read_part_info(struct flash_bank_s *bank)
 {
 	at91sam7_old_flash_bank_t *at91sam7_old_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -574,7 +576,7 @@
 	return ERROR_OK;
 }
 
-int at91sam7_old_protect_check(struct flash_bank_s *bank)
+static int at91sam7_old_protect_check(struct flash_bank_s *bank)
 {
 	u32 status;
 	int flashplane;
@@ -625,7 +627,7 @@
 	return ERROR_OK;
 }
 
-int at91sam7_old_erase(struct flash_bank_s *bank, int first, int last)
+static int at91sam7_old_erase(struct flash_bank_s *bank, int first, int last)
 {
 	at91sam7_old_flash_bank_t *at91sam7_old_info = bank-&gt;driver_priv;
 	u8 flashplane;
@@ -716,7 +718,7 @@
 }
 
 
-int at91sam7_old_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int at91sam7_old_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	at91sam7_old_flash_bank_t *at91sam7_old_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -784,7 +786,7 @@
 }
 
 
-int at91sam7_old_probe(struct flash_bank_s *bank)
+static int at91sam7_old_probe(struct flash_bank_s *bank)
 {
 	/* we can't probe on an at91sam7_old
 	 * if this is an at91sam7_old, it has the configured flash
@@ -811,7 +813,7 @@
 }
 
 
-int at91sam7_old_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int at91sam7_old_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	int printed, flashplane;
 	at91sam7_old_flash_bank_t *at91sam7_old_info = bank-&gt;driver_priv;
@@ -871,7 +873,7 @@
 * 	The maximum number of write/erase cycles for Non Volatile Memory bits is 100. This includes
 *	Lock Bits (LOCKx), General Purpose NVM bits (GPNVMx) and the Security Bit.
 */
-int at91sam7_old_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int at91sam7_old_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	int bit;

Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/cfi.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -38,17 +38,17 @@
 #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
 
-int cfi_register_commands(struct command_context_s *cmd_ctx);
-int cfi_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int cfi_erase(struct flash_bank_s *bank, int first, int last);
-int cfi_protect(struct flash_bank_s *bank, int set, int first, int last);
-int cfi_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int cfi_probe(struct flash_bank_s *bank);
-int cfi_auto_probe(struct flash_bank_s *bank);
-int cfi_protect_check(struct flash_bank_s *bank);
-int cfi_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int cfi_register_commands(struct command_context_s *cmd_ctx);
+static int cfi_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int cfi_erase(struct flash_bank_s *bank, int first, int last);
+static int cfi_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int cfi_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int cfi_probe(struct flash_bank_s *bank);
+static int cfi_auto_probe(struct flash_bank_s *bank);
+static int cfi_protect_check(struct flash_bank_s *bank);
+static int cfi_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
-int cfi_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+//static int cfi_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 #define CFI_MAX_BUS_WIDTH	4
 #define CFI_MAX_CHIP_WIDTH	4
@@ -71,19 +71,19 @@
 	.info = cfi_info
 };
 
-cfi_unlock_addresses_t cfi_unlock_addresses[] =
+static cfi_unlock_addresses_t cfi_unlock_addresses[] =
 {
 	[CFI_UNLOCK_555_2AA] = { .unlock1 = 0x555, .unlock2 = 0x2aa },
 	[CFI_UNLOCK_5555_2AAA] = { .unlock1 = 0x5555, .unlock2 = 0x2aaa },
 };
 
 /* CFI fixups foward declarations */
-void cfi_fixup_0002_erase_regions(flash_bank_t *flash, void *param);
-void cfi_fixup_0002_unlock_addresses(flash_bank_t *flash, void *param);
-void cfi_fixup_atmel_reversed_erase_regions(flash_bank_t *flash, void *param);
+static void cfi_fixup_0002_erase_regions(flash_bank_t *flash, void *param);
+static void cfi_fixup_0002_unlock_addresses(flash_bank_t *flash, void *param);
+static void cfi_fixup_atmel_reversed_erase_regions(flash_bank_t *flash, void *param);
 
 /* fixup after identifying JEDEC manufactuer and ID */
-cfi_fixup_t cfi_jedec_fixups[] = {
+static cfi_fixup_t cfi_jedec_fixups[] = {
 	{CFI_MFR_SST, 0x00D4, cfi_fixup_non_cfi, NULL},
 	{CFI_MFR_SST, 0x00D5, cfi_fixup_non_cfi, NULL},
 	{CFI_MFR_SST, 0x00D6, cfi_fixup_non_cfi, NULL},
@@ -101,7 +101,7 @@
 };
 
 /* fixup after reading cmdset 0002 primary query table */
-cfi_fixup_t cfi_0002_fixups[] = {
+static cfi_fixup_t cfi_0002_fixups[] = {
 	{CFI_MFR_SST, 0x00D4, cfi_fixup_0002_unlock_addresses, &amp;cfi_unlock_addresses[CFI_UNLOCK_5555_2AAA]},
 	{CFI_MFR_SST, 0x00D5, cfi_fixup_0002_unlock_addresses, &amp;cfi_unlock_addresses[CFI_UNLOCK_5555_2AAA]},
 	{CFI_MFR_SST, 0x00D6, cfi_fixup_0002_unlock_addresses, &amp;cfi_unlock_addresses[CFI_UNLOCK_5555_2AAA]},
@@ -117,11 +117,11 @@
 };
 
 /* fixup after reading cmdset 0001 primary query table */
-cfi_fixup_t cfi_0001_fixups[] = {
+static cfi_fixup_t cfi_0001_fixups[] = {
 	{0, 0, NULL, NULL}
 };
 
-void cfi_fixup(flash_bank_t *bank, cfi_fixup_t *fixups)
+static void cfi_fixup(flash_bank_t *bank, cfi_fixup_t *fixups)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 	cfi_fixup_t *f;
@@ -154,7 +154,7 @@
 
 }
 
-void cfi_command(flash_bank_t *bank, u8 cmd, u8 *cmd_buf)
+static void cfi_command(flash_bank_t *bank, u8 cmd, u8 *cmd_buf)
 {
 	int i;
 
@@ -184,7 +184,7 @@
  * flash banks are expected to be made of similar chips
  * the query result should be the same for all
  */
-u8 cfi_query_u8(flash_bank_t *bank, int sector, u32 offset)
+static u8 cfi_query_u8(flash_bank_t *bank, int sector, u32 offset)
 {
 	target_t *target = bank-&gt;target;
 	u8 data[CFI_MAX_BUS_WIDTH];
@@ -201,7 +201,7 @@
  * in case of a bank made of multiple chips,
  * the individual values are ORed
  */
-u8 cfi_get_u8(flash_bank_t *bank, int sector, u32 offset)
+static u8 cfi_get_u8(flash_bank_t *bank, int sector, u32 offset)
 {
 	target_t *target = bank-&gt;target;
 	u8 data[CFI_MAX_BUS_WIDTH];
@@ -226,7 +226,7 @@
 	}
 }
 
-u16 cfi_query_u16(flash_bank_t *bank, int sector, u32 offset)
+static u16 cfi_query_u16(flash_bank_t *bank, int sector, u32 offset)
 {
 	target_t *target = bank-&gt;target;
 	u8 data[CFI_MAX_BUS_WIDTH * 2];
@@ -239,7 +239,7 @@
 		return data[bank-&gt;bus_width - 1] | data[(2 * bank-&gt;bus_width) - 1] &lt;&lt; 8;
 }
 
-u32 cfi_query_u32(flash_bank_t *bank, int sector, u32 offset)
+static u32 cfi_query_u32(flash_bank_t *bank, int sector, u32 offset)
 {
 	target_t *target = bank-&gt;target;
 	u8 data[CFI_MAX_BUS_WIDTH * 4];
@@ -253,7 +253,7 @@
 				data[(3 * bank-&gt;bus_width) - 1] &lt;&lt; 16 | data[(4 * bank-&gt;bus_width) - 1] &lt;&lt; 24;
 }
 
-void cfi_intel_clear_status_register(flash_bank_t *bank)
+static void cfi_intel_clear_status_register(flash_bank_t *bank)
 {
 	target_t *target = bank-&gt;target;
 	u8 command[8];
@@ -343,7 +343,7 @@
 	return(ERROR_FLASH_BUSY);
 }
 
-int cfi_read_intel_pri_ext(flash_bank_t *bank)
+static int cfi_read_intel_pri_ext(flash_bank_t *bank)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -406,7 +406,7 @@
 	return ERROR_OK;
 }
 
-int cfi_read_spansion_pri_ext(flash_bank_t *bank)
+static int cfi_read_spansion_pri_ext(flash_bank_t *bank)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -471,7 +471,7 @@
 	return ERROR_OK;
 }
 
-int cfi_read_atmel_pri_ext(flash_bank_t *bank)
+static int cfi_read_atmel_pri_ext(flash_bank_t *bank)
 {
 	int retval;
 	cfi_atmel_pri_ext_t atmel_pri_ext;
@@ -538,7 +538,7 @@
 	return ERROR_OK;
 }
 
-int cfi_read_0002_pri_ext(flash_bank_t *bank)
+static int cfi_read_0002_pri_ext(flash_bank_t *bank)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 
@@ -552,7 +552,7 @@
 	}
 }
 
-int cfi_spansion_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int cfi_spansion_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	int printed;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -587,7 +587,7 @@
 	return ERROR_OK;
 }
 
-int cfi_intel_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int cfi_intel_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	int printed;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -616,7 +616,7 @@
 	return ERROR_OK;
 }
 
-int cfi_register_commands(struct command_context_s *cmd_ctx)
+static int cfi_register_commands(struct command_context_s *cmd_ctx)
 {
 	/*command_t *cfi_cmd = */
 	register_command(cmd_ctx, NULL, &quot;cfi&quot;, NULL, COMMAND_ANY, &quot;flash bank cfi &lt;base&gt; &lt;size&gt; &lt;chip_width&gt; &lt;bus_width&gt; &lt;targetNum&gt; [jedec_probe/x16_as_x8]&quot;);
@@ -629,7 +629,7 @@
 
 /* flash_bank cfi &lt;base&gt; &lt;size&gt; &lt;chip_width&gt; &lt;bus_width&gt; &lt;target#&gt; [options]
  */
-int cfi_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int cfi_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	cfi_flash_bank_t *cfi_info;
 	int i;
@@ -677,7 +677,7 @@
 	return ERROR_OK;
 }
 
-int cfi_intel_erase(struct flash_bank_s *bank, int first, int last)
+static int cfi_intel_erase(struct flash_bank_s *bank, int first, int last)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -721,7 +721,7 @@
 
 }
 
-int cfi_spansion_erase(struct flash_bank_s *bank, int first, int last)
+static int cfi_spansion_erase(struct flash_bank_s *bank, int first, int last)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -787,7 +787,7 @@
 	return target-&gt;type-&gt;write_memory(target, flash_address(bank, 0, 0x0), bank-&gt;bus_width, 1, command);
 }
 
-int cfi_erase(struct flash_bank_s *bank, int first, int last)
+static int cfi_erase(struct flash_bank_s *bank, int first, int last)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 
@@ -822,7 +822,7 @@
 	return ERROR_OK;
 }
 
-int cfi_intel_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int cfi_intel_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -939,7 +939,7 @@
 	return target-&gt;type-&gt;write_memory(target, flash_address(bank, 0, 0x0), bank-&gt;bus_width, 1, command);
 }
 
-int cfi_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int cfi_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 
@@ -1018,7 +1018,7 @@
 	}
 }
 
-u32 cfi_command_val(flash_bank_t *bank, u8 cmd)
+static u32 cfi_command_val(flash_bank_t *bank, u8 cmd)
 {
 	target_t *target = bank-&gt;target;
 
@@ -1041,7 +1041,7 @@
 	}
 }
 
-int cfi_intel_write_block(struct flash_bank_s *bank, u8 *buffer, u32 address, u32 count)
+static int cfi_intel_write_block(struct flash_bank_s *bank, u8 *buffer, u32 address, u32 count)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -1285,7 +1285,7 @@
 	return retval;
 }
 
-int cfi_spansion_write_block(struct flash_bank_s *bank, u8 *buffer, u32 address, u32 count)
+static int cfi_spansion_write_block(struct flash_bank_s *bank, u8 *buffer, u32 address, u32 count)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 	cfi_spansion_pri_ext_t *pri_ext = cfi_info-&gt;pri_ext;
@@ -1547,7 +1547,7 @@
 	return exit_code;
 }
 
-int cfi_intel_write_word(struct flash_bank_s *bank, u8 *word, u32 address)
+static int cfi_intel_write_word(struct flash_bank_s *bank, u8 *word, u32 address)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -1581,7 +1581,7 @@
 	return ERROR_OK;
 }
 
-int cfi_intel_write_words(struct flash_bank_s *bank, u8 *word, u32 wordcount, u32 address)
+static int cfi_intel_write_words(struct flash_bank_s *bank, u8 *word, u32 wordcount, u32 address)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -1673,7 +1673,7 @@
 	return ERROR_OK;
 }
 
-int cfi_spansion_write_word(struct flash_bank_s *bank, u8 *word, u32 address)
+static int cfi_spansion_write_word(struct flash_bank_s *bank, u8 *word, u32 address)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -1719,7 +1719,7 @@
 	return ERROR_OK;
 }
 
-int cfi_spansion_write_words(struct flash_bank_s *bank, u8 *word, u32 wordcount, u32 address)
+static int cfi_spansion_write_words(struct flash_bank_s *bank, u8 *word, u32 wordcount, u32 address)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -1811,7 +1811,7 @@
 	return ERROR_OK;
 }
 
-int cfi_write_word(struct flash_bank_s *bank, u8 *word, u32 address)
+static int cfi_write_word(struct flash_bank_s *bank, u8 *word, u32 address)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 
@@ -1832,7 +1832,7 @@
 	return ERROR_FLASH_OPERATION_FAILED;
 }
 
-int cfi_write_words(struct flash_bank_s *bank, u8 *word, u32 wordcount, u32 address)
+static int cfi_write_words(struct flash_bank_s *bank, u8 *word, u32 wordcount, u32 address)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 
@@ -2062,7 +2062,7 @@
 	return target-&gt;type-&gt;write_memory(target, flash_address(bank, 0, 0x0), bank-&gt;bus_width, 1, current_word);
 }
 
-void cfi_fixup_atmel_reversed_erase_regions(flash_bank_t *bank, void *param)
+static void cfi_fixup_atmel_reversed_erase_regions(flash_bank_t *bank, void *param)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 	cfi_spansion_pri_ext_t *pri_ext = cfi_info-&gt;pri_ext;
@@ -2070,7 +2070,7 @@
 	pri_ext-&gt;_reversed_geometry = 1;
 }
 
-void cfi_fixup_0002_erase_regions(flash_bank_t *bank, void *param)
+static void cfi_fixup_0002_erase_regions(flash_bank_t *bank, void *param)
 {
 	int i;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -2092,7 +2092,7 @@
 	}
 }
 
-void cfi_fixup_0002_unlock_addresses(flash_bank_t *bank, void *param)
+static void cfi_fixup_0002_unlock_addresses(flash_bank_t *bank, void *param)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 	cfi_spansion_pri_ext_t *pri_ext = cfi_info-&gt;pri_ext;
@@ -2102,7 +2102,7 @@
 	pri_ext-&gt;_unlock2 = unlock_addresses-&gt;unlock2;
 }
 
-int cfi_probe(struct flash_bank_s *bank)
+static int cfi_probe(struct flash_bank_s *bank)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -2379,7 +2379,7 @@
 	return ERROR_OK;
 }
 
-int cfi_auto_probe(struct flash_bank_s *bank)
+static int cfi_auto_probe(struct flash_bank_s *bank)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 	if (cfi_info-&gt;probed)
@@ -2388,7 +2388,7 @@
 }
 
 
-int cfi_intel_protect_check(struct flash_bank_s *bank)
+static int cfi_intel_protect_check(struct flash_bank_s *bank)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -2421,7 +2421,7 @@
 	return target-&gt;type-&gt;write_memory(target, flash_address(bank, 0, 0x0), bank-&gt;bus_width, 1, command);
 }
 
-int cfi_spansion_protect_check(struct flash_bank_s *bank)
+static int cfi_spansion_protect_check(struct flash_bank_s *bank)
 {
 	int retval;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
@@ -2462,7 +2462,7 @@
 	return target-&gt;type-&gt;write_memory(target, flash_address(bank, 0, 0x0), bank-&gt;bus_width, 1, command);
 }
 
-int cfi_protect_check(struct flash_bank_s *bank)
+static int cfi_protect_check(struct flash_bank_s *bank)
 {
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;
 
@@ -2492,7 +2492,7 @@
 	return ERROR_OK;
 }
 
-int cfi_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int cfi_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	int printed;
 	cfi_flash_bank_t *cfi_info = bank-&gt;driver_priv;

Modified: trunk/src/flash/ecos.c
===================================================================
--- trunk/src/flash/ecos.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/ecos.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -36,19 +36,21 @@
 #include &quot;../target/embeddedice.h&quot;
 #include &quot;types.h&quot;
 
-int ecosflash_register_commands(struct command_context_s *cmd_ctx);
-int ecosflash_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int ecosflash_erase(struct flash_bank_s *bank, int first, int last);
-int ecosflash_protect(struct flash_bank_s *bank, int set, int first, int last);
-int ecosflash_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int ecosflash_probe(struct flash_bank_s *bank);
-int ecosflash_protect_check(struct flash_bank_s *bank);
-int ecosflash_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int ecosflash_register_commands(struct command_context_s *cmd_ctx);
+static int ecosflash_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int ecosflash_erase(struct flash_bank_s *bank, int first, int last);
+static int ecosflash_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int ecosflash_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int ecosflash_probe(struct flash_bank_s *bank);
+static int ecosflash_protect_check(struct flash_bank_s *bank);
+static int ecosflash_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
-u32 ecosflash_get_flash_status(flash_bank_t *bank);
-void ecosflash_set_flash_mode(flash_bank_t *bank,int mode);
-u32 ecosflash_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout);
-int ecosflash_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+#if 0
+static u32 ecosflash_get_flash_status(flash_bank_t *bank);
+static void ecosflash_set_flash_mode(flash_bank_t *bank,int mode);
+static u32 ecosflash_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout);
+static int ecosflash_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+#endif
 
 flash_driver_t ecosflash_flash =
 {
@@ -136,7 +138,7 @@
 
 /* flash bank ecosflash &lt;base&gt; &lt;size&gt; &lt;chip_width&gt; &lt;bus_width&gt; &lt;target#&gt; &lt;driverPath&gt;
  */
-int ecosflash_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int ecosflash_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	ecosflash_flash_bank_t *info;
 
@@ -181,7 +183,7 @@
 	return ERROR_OK;
 }
 
-int loadDriver(ecosflash_flash_bank_t *info)
+static int loadDriver(ecosflash_flash_bank_t *info)
 {
 	u32 buf_cnt;
 	u32 image_size;
@@ -230,7 +232,7 @@
 static int const OFFSET_GET_WORKAREA=0x18;
 static int const OFFSET_GET_WORKAREA_SIZE=0x4;
 
-int runCode(ecosflash_flash_bank_t *info,
+static int runCode(ecosflash_flash_bank_t *info,
 		u32 codeStart, u32 codeStop, u32 r0, u32 r1, u32 r2,
 		u32 *result,
 		/* timeout in ms */
@@ -271,7 +273,7 @@
 	return ERROR_OK;
 }
 
-int eCosBoard_erase(ecosflash_flash_bank_t *info, u32 address, u32 len)
+static int eCosBoard_erase(ecosflash_flash_bank_t *info, u32 address, u32 len)
 {
 	int retval;
 	int timeout = (len / 20480 + 1) * 1000; /*asume 20 KB/s*/
@@ -302,7 +304,7 @@
 	return ERROR_OK;
 }
 
-int eCosBoard_flash(ecosflash_flash_bank_t *info, void *data, u32 address, u32 len)
+static int eCosBoard_flash(ecosflash_flash_bank_t *info, void *data, u32 address, u32 len)
 {
 	target_t *target=info-&gt;target;
 	const int chunk=8192;
@@ -361,12 +363,12 @@
 	return ERROR_OK;
 }
 
-int ecosflash_probe(struct flash_bank_s *bank)
+static int ecosflash_probe(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
-int ecosflash_register_commands(struct command_context_s *cmd_ctx)
+static int ecosflash_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, &quot;ecosflash&quot;, NULL, COMMAND_ANY, NULL);
 
@@ -396,7 +398,8 @@
 }
 #endif
 
-u32 ecosflash_address(struct flash_bank_s *bank, u32 address)
+#if 0
+static u32 ecosflash_address(struct flash_bank_s *bank, u32 address)
 {
 	u32 retval = 0;
 	switch(bank-&gt;bus_width)
@@ -411,54 +414,57 @@
 
 	return retval + bank-&gt;base;
 }
+#endif
 
-int ecosflash_erase(struct flash_bank_s *bank, int first, int last)
+static int ecosflash_erase(struct flash_bank_s *bank, int first, int last)
 {
 	struct flash_bank_s *c=bank;
 	ecosflash_flash_bank_t *info = bank-&gt;driver_priv;
 	return eCosBoard_erase(info, c-&gt;base+first*sectorSize, sectorSize*(last-first+1));
 }
 
-int ecosflash_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int ecosflash_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	return ERROR_OK;
 }
 
-int ecosflash_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int ecosflash_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	ecosflash_flash_bank_t *info = bank-&gt;driver_priv;
 	struct flash_bank_s *c=bank;
 	return eCosBoard_flash(info, buffer, c-&gt;base+offset, count);
 }
 
-int ecosflash_protect_check(struct flash_bank_s *bank)
+static int ecosflash_protect_check(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
-int ecosflash_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int ecosflash_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	ecosflash_flash_bank_t *info = bank-&gt;driver_priv;
 	snprintf(buf, buf_size, &quot;eCos flash driver: %s&quot;, info-&gt;driverPath);
 	return ERROR_OK;
 }
 
-u32 ecosflash_get_flash_status(flash_bank_t *bank)
+#if 0
+static u32 ecosflash_get_flash_status(flash_bank_t *bank)
 {
 	return ERROR_OK;
 }
 
-void ecosflash_set_flash_mode(flash_bank_t *bank,int mode)
+static void ecosflash_set_flash_mode(flash_bank_t *bank,int mode)
 {
 
 }
 
-u32 ecosflash_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout)
+static u32 ecosflash_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout)
 {
 	return ERROR_OK;
 }
 
-int ecosflash_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int ecosflash_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	return ERROR_OK;
 }
+#endif

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/flash.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -48,19 +48,17 @@
 #include &lt;inttypes.h&gt;
 
 /* command handlers */
-int handle_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_erase_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_erase_address_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_protect_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_write_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_write_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_fill_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_flash_protect_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-flash_bank_t *get_flash_bank_by_addr(target_t *target, u32 addr);
+static int handle_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_erase_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_erase_address_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_protect_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_write_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_write_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_fill_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_flash_protect_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 /* flash drivers
  */
@@ -265,7 +263,7 @@
 	return p;
 }
 
-int handle_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	int retval;
 	int i;
@@ -345,7 +343,7 @@
 	return ERROR_OK;
 }
 
-int handle_flash_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *p;
 	int i = 0;
@@ -396,7 +394,7 @@
 	return ERROR_OK;
 }
 
-int handle_flash_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *p;
 	int retval;
@@ -432,7 +430,7 @@
 	return ERROR_OK;
 }
 
-int handle_flash_erase_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_erase_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *p;
 	int retval;
@@ -476,7 +474,7 @@
 	return ERROR_OK;
 }
 
-int handle_flash_erase_address_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_erase_address_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *p;
 	int retval;
@@ -524,7 +522,7 @@
 	return retval;
 }
 
-int handle_flash_protect_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_protect_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *p;
 	int retval;
@@ -558,7 +556,7 @@
 	return ERROR_OK;
 }
 
-int handle_flash_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	if (argc &gt; 2)
 	{
@@ -595,7 +593,7 @@
 	return ERROR_OK;
 }
 
-int handle_flash_protect_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_protect_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	if (argc &gt; 3)
 	{
@@ -634,7 +632,7 @@
 	return ERROR_OK;
 }
 
-int handle_flash_write_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_write_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);
 
@@ -719,7 +717,7 @@
 	return retval;
 }
 
-int handle_flash_fill_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_fill_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	int err = ERROR_OK, retval;
 	u32 address;
@@ -819,7 +817,7 @@
 	return ERROR_OK;
 }
 
-int handle_flash_write_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_flash_write_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	u32 offset;
 	u8 *buffer;

Modified: trunk/src/flash/lpc2000.c
===================================================================
--- trunk/src/flash/lpc2000.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/lpc2000.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -51,17 +51,17 @@
  * - 2378
  */
 
-int lpc2000_register_commands(struct command_context_s *cmd_ctx);
-int lpc2000_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int lpc2000_erase(struct flash_bank_s *bank, int first, int last);
-int lpc2000_protect(struct flash_bank_s *bank, int set, int first, int last);
-int lpc2000_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int lpc2000_probe(struct flash_bank_s *bank);
-int lpc2000_erase_check(struct flash_bank_s *bank);
-int lpc2000_protect_check(struct flash_bank_s *bank);
-int lpc2000_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int lpc2000_register_commands(struct command_context_s *cmd_ctx);
+static int lpc2000_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int lpc2000_erase(struct flash_bank_s *bank, int first, int last);
+static int lpc2000_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int lpc2000_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int lpc2000_probe(struct flash_bank_s *bank);
+static int lpc2000_erase_check(struct flash_bank_s *bank);
+static int lpc2000_protect_check(struct flash_bank_s *bank);
+static int lpc2000_info(struct flash_bank_s *bank, char *buf, int buf_size);
 	
-int lpc2000_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int lpc2000_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 flash_driver_t lpc2000_flash =
 {
@@ -78,7 +78,7 @@
 	.info = lpc2000_info
 };
 
-int lpc2000_register_commands(struct command_context_s *cmd_ctx)
+static int lpc2000_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *lpc2000_cmd = register_command(cmd_ctx, NULL, &quot;lpc2000&quot;, NULL, COMMAND_ANY, NULL);
 	
@@ -88,7 +88,7 @@
 	return ERROR_OK;
 }
 
-int lpc2000_build_sector_list(struct flash_bank_s *bank)
+static int lpc2000_build_sector_list(struct flash_bank_s *bank)
 {
 	lpc2000_flash_bank_t *lpc2000_info = bank-&gt;driver_priv;
 	
@@ -239,7 +239,7 @@
  * 0x20 to 0x2b: command result table
  * 0x2c to 0xac: stack (only 128b needed)
  */
-int lpc2000_iap_call(flash_bank_t *bank, int code, u32 param_table[5], u32 result_table[2])
+static int lpc2000_iap_call(flash_bank_t *bank, int code, u32 param_table[5], u32 result_table[2])
 {
 	int retval;
 	lpc2000_flash_bank_t *lpc2000_info = bank-&gt;driver_priv;
@@ -322,14 +322,14 @@
 	return status_code;
 }
 
-int lpc2000_iap_blank_check(struct flash_bank_s *bank, int first, int last)
+static int lpc2000_iap_blank_check(struct flash_bank_s *bank, int first, int last)
 {
 	u32 param_table[5];
 	u32 result_table[2];
 	int status_code;
 	int i;
 	
-	if ((first &lt; 0) || (last &gt; bank-&gt;num_sectors))
+	if ((first &lt; 0) || (last &gt;= bank-&gt;num_sectors))
 		return ERROR_FLASH_SECTOR_INVALID;
 	
 	for (i = first; i &lt;= last; i++)
@@ -365,7 +365,7 @@
 
 /* flash bank lpc2000 &lt;base&gt; &lt;size&gt; 0 0 &lt;target#&gt; &lt;lpc_variant&gt; &lt;cclk&gt; [calc_checksum]
  */
-int lpc2000_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int lpc2000_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	lpc2000_flash_bank_t *lpc2000_info;
 	
@@ -413,7 +413,7 @@
 	return ERROR_OK;
 }
 
-int lpc2000_erase(struct flash_bank_s *bank, int first, int last)
+static int lpc2000_erase(struct flash_bank_s *bank, int first, int last)
 {
 	lpc2000_flash_bank_t *lpc2000_info = bank-&gt;driver_priv;
 	u32 param_table[5];
@@ -465,13 +465,13 @@
 	return ERROR_OK;
 }
 
-int lpc2000_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int lpc2000_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	/* can't protect/unprotect on the lpc2000 */
 	return ERROR_OK;
 }
 
-int lpc2000_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int lpc2000_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	lpc2000_flash_bank_t *lpc2000_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -635,7 +635,7 @@
 	return retval;
 }
 
-int lpc2000_probe(struct flash_bank_s *bank)
+static int lpc2000_probe(struct flash_bank_s *bank)
 {
 	/* we can't probe on an lpc2000 
 	 * if this is an lpc2xxx, it has the configured flash
@@ -643,7 +643,7 @@
 	return ERROR_OK;
 }
 
-int lpc2000_erase_check(struct flash_bank_s *bank)
+static int lpc2000_erase_check(struct flash_bank_s *bank)
 {
 	if (bank-&gt;target-&gt;state != TARGET_HALTED)
 	{
@@ -654,13 +654,13 @@
 	return lpc2000_iap_blank_check(bank, 0, bank-&gt;num_sectors - 1);
 }
 
-int lpc2000_protect_check(struct flash_bank_s *bank)
+static int lpc2000_protect_check(struct flash_bank_s *bank)
 {
 	/* sectors are always protected	*/
 	return ERROR_OK;
 }
 
-int lpc2000_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int lpc2000_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	lpc2000_flash_bank_t *lpc2000_info = bank-&gt;driver_priv;
 
@@ -669,7 +669,7 @@
 	return ERROR_OK;
 }
 
-int lpc2000_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int lpc2000_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	u32 param_table[5];

Modified: trunk/src/flash/lpc288x.c
===================================================================
--- trunk/src/flash/lpc288x.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/lpc288x.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -94,22 +94,19 @@
 /* F_CLK_TIME */
 #define FCT_CLK_DIV_MASK    0x0FFF
 
-int lpc288x_register_commands(struct command_context_s *cmd_ctx);
-int lpc288x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int lpc288x_erase(struct flash_bank_s *bank, int first, int last);
-int lpc288x_protect(struct flash_bank_s *bank, int set, int first, int last);
-int lpc288x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int lpc288x_probe(struct flash_bank_s *bank);
-int lpc288x_auto_probe(struct flash_bank_s *bank);
-int lpc288x_erase_check(struct flash_bank_s *bank);
-int lpc288x_protect_check(struct flash_bank_s *bank);
-int lpc288x_info(struct flash_bank_s *bank, char *buf, int buf_size);
-void lpc288x_set_flash_mode(flash_bank_t *bank, u8 flashplane, int mode);
-u32 lpc288x_wait_status_busy(flash_bank_t *bank, int timeout);
-void lpc288x_load_timer(int erase, struct target_s *target);
-void lpc288x_set_flash_clk(struct flash_bank_s *bank);
-u32 lpc288x_system_ready(struct flash_bank_s *bank);
-int lpc288x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int lpc288x_register_commands(struct command_context_s *cmd_ctx);
+static int lpc288x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int lpc288x_erase(struct flash_bank_s *bank, int first, int last);
+static int lpc288x_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int lpc288x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int lpc288x_probe(struct flash_bank_s *bank);
+static int lpc288x_erase_check(struct flash_bank_s *bank);
+static int lpc288x_protect_check(struct flash_bank_s *bank);
+static int lpc288x_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static u32 lpc288x_wait_status_busy(flash_bank_t *bank, int timeout);
+static void lpc288x_load_timer(int erase, struct target_s *target);
+static void lpc288x_set_flash_clk(struct flash_bank_s *bank);
+static u32 lpc288x_system_ready(struct flash_bank_s *bank);
 
 flash_driver_t lpc288x_flash =
 {
@@ -126,12 +123,12 @@
 	.info = lpc288x_info
 };
 
-int lpc288x_register_commands(struct command_context_s *cmd_ctx)
+static int lpc288x_register_commands(struct command_context_s *cmd_ctx)
 {
 	return ERROR_OK;
 }
 
-u32 lpc288x_wait_status_busy(flash_bank_t *bank, int timeout)
+static u32 lpc288x_wait_status_busy(flash_bank_t *bank, int timeout)
 {
 	u32 status;
 	target_t *target = bank-&gt;target;
@@ -151,7 +148,7 @@
 }
 
 /* Read device id register and fill in driver info structure */
-int lpc288x_read_part_info(struct flash_bank_s *bank)
+static int lpc288x_read_part_info(struct flash_bank_s *bank)
 {
 	lpc288x_flash_bank_t *lpc288x_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -201,13 +198,13 @@
 	return ERROR_OK;
 }
 
-int lpc288x_protect_check(struct flash_bank_s *bank)
+static int lpc288x_protect_check(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
 /* flash_bank LPC288x 0 0 0 0 &lt;target#&gt; &lt;cclk&gt; */
-int lpc288x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int lpc288x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	lpc288x_flash_bank_t *lpc288x_info;
 	
@@ -232,7 +229,7 @@
  * AHB = 12 MHz ?
  * 12000000/66000 = 182
  * CLK_DIV = 60 ? */
-void lpc288x_set_flash_clk(struct flash_bank_s *bank)
+static void lpc288x_set_flash_clk(struct flash_bank_s *bank)
 {
 	u32 clk_time;
 	lpc288x_flash_bank_t *lpc288x_info = bank-&gt;driver_priv;
@@ -247,7 +244,7 @@
  * LOAD_TIMER_WRITE		FPT_TIME	= ((1,000,000 / AHB tcyc (in ns)) - 2) / 512
  * 									= 23 (75) (AN10548 72 - is this wrong?)
  * TODO: Sort out timing calcs ;) */
-void lpc288x_load_timer(int erase, struct target_s *target)
+static void lpc288x_load_timer(int erase, struct target_s *target)
 {
 	if (erase == LOAD_TIMER_ERASE)
 	{
@@ -259,7 +256,7 @@
 	}
 }
 
-u32 lpc288x_system_ready(struct flash_bank_s *bank)
+static u32 lpc288x_system_ready(struct flash_bank_s *bank)
 {
 	lpc288x_flash_bank_t *lpc288x_info = bank-&gt;driver_priv;
 	if (lpc288x_info-&gt;cidr == 0)
@@ -275,7 +272,7 @@
 	return ERROR_OK;
 }
 
-int lpc288x_erase_check(struct flash_bank_s *bank)
+static int lpc288x_erase_check(struct flash_bank_s *bank)
 {
 	u32 status = lpc288x_system_ready(bank);	/* probed? halted? */
 	if (status != ERROR_OK)
@@ -287,7 +284,7 @@
 	return ERROR_OK;
 }
 
-int lpc288x_erase(struct flash_bank_s *bank, int first, int last)
+static int lpc288x_erase(struct flash_bank_s *bank, int first, int last)
 {
 	u32 status;
 	int sector;
@@ -328,7 +325,7 @@
 	return ERROR_OK;
 }
 
-int lpc288x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int lpc288x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	u8 page_buffer[FLASH_PAGE_SIZE];
 	u32 i, status, source_offset,dest_offset;
@@ -443,7 +440,7 @@
 	return ERROR_OK;
 }
 
-int lpc288x_probe(struct flash_bank_s *bank)
+static int lpc288x_probe(struct flash_bank_s *bank)
 {
 	/* we only deal with LPC2888 so flash config is fixed */
 	lpc288x_flash_bank_t *lpc288x_info = bank-&gt;driver_priv;
@@ -466,13 +463,13 @@
 	return ERROR_OK;
 }
 
-int lpc288x_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int lpc288x_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	snprintf(buf, buf_size, &quot;lpc288x flash driver&quot;);
 	return ERROR_OK;
 }
 
-int lpc288x_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int lpc288x_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	int lockregion, status;
 	u32 value;

Modified: trunk/src/flash/lpc3180_nand_controller.c
===================================================================
--- trunk/src/flash/lpc3180_nand_controller.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/lpc3180_nand_controller.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -32,20 +32,20 @@
 #include &quot;nand.h&quot;
 #include &quot;target.h&quot;
 
-int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-int lpc3180_register_commands(struct command_context_s *cmd_ctx);
-int lpc3180_init(struct nand_device_s *device);
-int lpc3180_reset(struct nand_device_s *device);
-int lpc3180_command(struct nand_device_s *device, u8 command);
-int lpc3180_address(struct nand_device_s *device, u8 address);
-int lpc3180_write_data(struct nand_device_s *device, u16 data);
-int lpc3180_read_data(struct nand_device_s *device, void *data);
-int lpc3180_write_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
-int lpc3180_read_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
-int lpc3180_controller_ready(struct nand_device_s *device, int timeout);
-int lpc3180_nand_ready(struct nand_device_s *device, int timeout);
+static int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
+static int lpc3180_register_commands(struct command_context_s *cmd_ctx);
+static int lpc3180_init(struct nand_device_s *device);
+static int lpc3180_reset(struct nand_device_s *device);
+static int lpc3180_command(struct nand_device_s *device, u8 command);
+static int lpc3180_address(struct nand_device_s *device, u8 address);
+static int lpc3180_write_data(struct nand_device_s *device, u16 data);
+static int lpc3180_read_data(struct nand_device_s *device, void *data);
+static int lpc3180_write_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
+static int lpc3180_read_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
+static int lpc3180_controller_ready(struct nand_device_s *device, int timeout);
+static int lpc3180_nand_ready(struct nand_device_s *device, int timeout);
 
-int handle_lpc3180_select_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_lpc3180_select_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 nand_flash_controller_t lpc3180_nand_controller =
 {
@@ -66,7 +66,7 @@
 
 /* nand device lpc3180 &lt;target#&gt; &lt;oscillator_frequency&gt;
  */
-int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device)
+static int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device)
 {
 	lpc3180_nand_controller_t *lpc3180_info;
 	
@@ -99,7 +99,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_register_commands(struct command_context_s *cmd_ctx)
+static int lpc3180_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *lpc3180_cmd = register_command(cmd_ctx, NULL, &quot;lpc3180&quot;, NULL, COMMAND_ANY, &quot;commands specific to the LPC3180 NAND flash controllers&quot;);
 	
@@ -108,7 +108,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_pll(int fclkin, u32 pll_ctrl)
+static int lpc3180_pll(int fclkin, u32 pll_ctrl)
 {
 	int bypass = (pll_ctrl &amp; 0x8000) &gt;&gt; 15;
 	int direct = (pll_ctrl &amp; 0x4000) &gt;&gt; 14;
@@ -136,7 +136,7 @@
 		return (m / (2 * p)) * (fclkin / n); 
 }
 
-float lpc3180_cycle_time(lpc3180_nand_controller_t *lpc3180_info)
+static float lpc3180_cycle_time(lpc3180_nand_controller_t *lpc3180_info)
 {
 	target_t *target = lpc3180_info-&gt;target;
 	u32 sysclk_ctrl, pwr_ctrl, hclkdiv_ctrl, hclkpll_ctrl;
@@ -186,7 +186,7 @@
 	return cycle;
 }
 
-int lpc3180_init(struct nand_device_s *device)
+static int lpc3180_init(struct nand_device_s *device)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -316,7 +316,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_reset(struct nand_device_s *device)
+static int lpc3180_reset(struct nand_device_s *device)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -358,7 +358,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_command(struct nand_device_s *device, u8 command)
+static int lpc3180_command(struct nand_device_s *device, u8 command)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -388,7 +388,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_address(struct nand_device_s *device, u8 address)
+static int lpc3180_address(struct nand_device_s *device, u8 address)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -418,7 +418,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_write_data(struct nand_device_s *device, u16 data)
+static int lpc3180_write_data(struct nand_device_s *device, u16 data)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -448,7 +448,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_read_data(struct nand_device_s *device, void *data)
+static int lpc3180_read_data(struct nand_device_s *device, void *data)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -510,7 +510,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_write_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size)
+static int lpc3180_write_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -649,7 +649,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_read_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size)
+static int lpc3180_read_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -796,7 +796,7 @@
 	return ERROR_OK;
 }
 
-int lpc3180_controller_ready(struct nand_device_s *device, int timeout)
+static int lpc3180_controller_ready(struct nand_device_s *device, int timeout)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -830,7 +830,7 @@
 	return 0;
 }
 
-int lpc3180_nand_ready(struct nand_device_s *device, int timeout)
+static int lpc3180_nand_ready(struct nand_device_s *device, int timeout)
 {
 	lpc3180_nand_controller_t *lpc3180_info = device-&gt;controller_priv;
 	target_t *target = lpc3180_info-&gt;target;
@@ -870,7 +870,7 @@
 	return 0;	
 }
 
-int handle_lpc3180_select_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_lpc3180_select_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *device = NULL;
 	lpc3180_nand_controller_t *lpc3180_info = NULL;

Modified: trunk/src/flash/nand.c
===================================================================
--- trunk/src/flash/nand.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/nand.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -39,24 +39,21 @@
 #include &quot;fileio.h&quot;
 #include &quot;image.h&quot;
 
-int nand_register_commands(struct command_context_s *cmd_ctx);
-int handle_nand_list_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_nand_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_nand_check_bad_blocks_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_nand_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_nand_copy_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_nand_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_nand_dump_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int handle_nand_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_nand_list_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_nand_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_nand_check_bad_blocks_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_nand_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_nand_copy_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_nand_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_nand_dump_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_nand_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
-int handle_nand_raw_access_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int handle_nand_raw_access_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
-int nand_read_page_raw(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
-int nand_read_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
-int nand_read_plain(struct nand_device_s *device, u32 address, u8 *data, u32 data_size);
+static int nand_read_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
+//static int nand_read_plain(struct nand_device_s *device, u32 address, u8 *data, u32 data_size);
 
-int nand_write_page_raw(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
-int nand_write_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
+static int nand_write_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size);
 
 /* NAND flash controller
  */
@@ -69,7 +66,7 @@
 
 /* extern nand_flash_controller_t boundary_scan_nand_controller; */
 
-nand_flash_controller_t *nand_flash_controllers[] =
+static nand_flash_controller_t *nand_flash_controllers[] =
 {
 	&amp;lpc3180_nand_controller,
 	&amp;orion_nand_controller,
@@ -82,7 +79,7 @@
 };
 
 /* configured NAND devices and NAND Flash command handler */
-nand_device_t *nand_devices = NULL;
+static nand_device_t *nand_devices = NULL;
 static command_t *nand_cmd;
 
 /*	Chip ID list
@@ -95,7 +92,7 @@
  *	256	256 Byte page size
  *	512	512 Byte page size
  */
-nand_info_t nand_flash_ids[] =
+static nand_info_t nand_flash_ids[] =
 {
 	{&quot;NAND 1MiB 5V 8-bit&quot;,		0x6e, 256, 1, 0x1000, 0},
 	{&quot;NAND 2MiB 5V 8-bit&quot;,		0x64, 256, 2, 0x1000, 0},
@@ -173,7 +170,7 @@
 
 /* Manufacturer ID list
  */
-nand_manufacturer_t nand_manuf_ids[] =
+static nand_manufacturer_t nand_manuf_ids[] =
 {
 	{0x0, &quot;unknown&quot;},
 	{NAND_MFR_TOSHIBA, &quot;Toshiba&quot;},
@@ -190,7 +187,8 @@
  * Define default oob placement schemes for large and small page devices
  */
 
-nand_ecclayout_t nand_oob_8 = {
+#if 0
+static nand_ecclayout_t nand_oob_8 = {
 	.eccbytes = 3,
 	.eccpos = {0, 1, 2},
 	.oobfree = {
@@ -199,8 +197,9 @@
 		{.offset = 6,
 		 .length = 2}}
 };
+#endif
 
-nand_ecclayout_t nand_oob_16 = {
+static nand_ecclayout_t nand_oob_16 = {
 	.eccbytes = 6,
 	.eccpos = {0, 1, 2, 3, 6, 7},
 	.oobfree = {
@@ -208,7 +207,7 @@
 		 . length = 8}}
 };
 
-nand_ecclayout_t nand_oob_64 = {
+static nand_ecclayout_t nand_oob_64 = {
 	.eccbytes = 24,
 	.eccpos = {
 		   40, 41, 42, 43, 44, 45, 46, 47,
@@ -221,7 +220,7 @@
 
 /* nand device &lt;nand_controller&gt; [controller options]
  */
-int handle_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	int i;
 	int retval;
@@ -346,7 +345,7 @@
 	return NULL;
 }
 
-int nand_build_bbt(struct nand_device_s *device, int first, int last)
+static int nand_build_bbt(struct nand_device_s *device, int first, int last)
 {
 	u32 page = 0x0;
 	int i;
@@ -405,7 +404,7 @@
 	return ERROR_OK;
 }
 
-int nand_poll_ready(struct nand_device_s *device, int timeout)
+static int nand_poll_ready(struct nand_device_s *device, int timeout)
 {
 	u8 status;
 
@@ -729,7 +728,8 @@
 	return ERROR_OK;
 }
 
-int nand_read_plain(struct nand_device_s *device, u32 address, u8 *data, u32 data_size)
+#if 0
+static int nand_read_plain(struct nand_device_s *device, u32 address, u8 *data, u32 data_size)
 {
 	u8 *page;
 	
@@ -766,7 +766,7 @@
 	return ERROR_OK;
 }
 
-int nand_write_plain(struct nand_device_s *device, u32 address, u8 *data, u32 data_size)
+static int nand_write_plain(struct nand_device_s *device, u32 address, u8 *data, u32 data_size)
 {
 	u8 *page;
 	
@@ -802,6 +802,7 @@
 	
 	return ERROR_OK;
 }
+#endif
 
 int nand_write_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size)
 {
@@ -820,7 +821,7 @@
 		return device-&gt;controller-&gt;write_page(device, page, data, data_size, oob, oob_size);
 }
 
-int nand_read_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size)
+static int nand_read_page(struct nand_device_s *device, u32 page, u8 *data, u32 data_size, u8 *oob, u32 oob_size)
 {
 	if (!device-&gt;device)
 		return ERROR_NAND_DEVICE_NOT_PROBED;
@@ -1089,7 +1090,7 @@
 	return ERROR_OK;
 }
 
-int handle_nand_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_nand_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
 	int i = 0;
@@ -1159,7 +1160,7 @@
 	return ERROR_OK;
 }
 
-int handle_nand_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_nand_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
 	int retval;
@@ -1193,7 +1194,7 @@
 	return ERROR_OK;
 }
 
-int handle_nand_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_nand_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
 	int retval;
@@ -1274,7 +1275,7 @@
 	return ERROR_OK;
 }
 
-int handle_nand_copy_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_nand_copy_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
 		
@@ -1297,7 +1298,7 @@
 	return ERROR_OK;
 }
 
-int handle_nand_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_nand_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	u32 offset;
 	u32 binary_size;
@@ -1452,7 +1453,7 @@
 	return ERROR_OK;
 }
 
-int handle_nand_dump_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_nand_dump_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
 			
@@ -1574,7 +1575,7 @@
 	return ERROR_OK;
 }
 
-int handle_nand_raw_access_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_nand_raw_access_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	nand_device_t *p;
 		

Modified: trunk/src/flash/ocl.c
===================================================================
--- trunk/src/flash/ocl.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/ocl.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -37,16 +37,16 @@
 #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
 
-int ocl_register_commands(struct command_context_s *cmd_ctx);
-int ocl_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int ocl_erase(struct flash_bank_s *bank, int first, int last);
-int ocl_protect(struct flash_bank_s *bank, int set, int first, int last);
-int ocl_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int ocl_probe(struct flash_bank_s *bank);
-int ocl_erase_check(struct flash_bank_s *bank);
-int ocl_protect_check(struct flash_bank_s *bank);
-int ocl_info(struct flash_bank_s *bank, char *buf, int buf_size);
-int ocl_auto_probe(struct flash_bank_s *bank);
+static int ocl_register_commands(struct command_context_s *cmd_ctx);
+static int ocl_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int ocl_erase(struct flash_bank_s *bank, int first, int last);
+static int ocl_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int ocl_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int ocl_probe(struct flash_bank_s *bank);
+static int ocl_erase_check(struct flash_bank_s *bank);
+static int ocl_protect_check(struct flash_bank_s *bank);
+static int ocl_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int ocl_auto_probe(struct flash_bank_s *bank);
 
 flash_driver_t ocl_flash =
 {
@@ -70,23 +70,23 @@
 	int bufalign;
 } ocl_priv_t;
 
-int ocl_register_commands(struct command_context_s *cmd_ctx)
+static int ocl_register_commands(struct command_context_s *cmd_ctx)
 {
 	return ERROR_OK;
 }
 
-int ocl_erase_check(struct flash_bank_s *bank)
+static int ocl_erase_check(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
-int ocl_protect_check(struct flash_bank_s *bank)
+static int ocl_protect_check(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
 /* flash_bank ocl 0 0 0 0 &lt;target#&gt; */
-int ocl_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int ocl_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	int retval;
 	armv4_5_common_t *armv4_5;
@@ -110,7 +110,7 @@
 	return ERROR_OK;
 }
 
-int ocl_erase(struct flash_bank_s *bank, int first, int last)
+static int ocl_erase(struct flash_bank_s *bank, int first, int last)
 {
 	ocl_priv_t *ocl = bank-&gt;driver_priv;
 	int retval;
@@ -165,12 +165,12 @@
 	return ERROR_OK;
 }
 
-int ocl_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int ocl_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	return ERROR_OK;
 }
 
-int ocl_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int ocl_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	ocl_priv_t *ocl = bank-&gt;driver_priv;
 	int retval;
@@ -277,7 +277,7 @@
 	return ERROR_OK;
 }
 
-int ocl_probe(struct flash_bank_s *bank)
+static int ocl_probe(struct flash_bank_s *bank)
 {
 	ocl_priv_t *ocl = bank-&gt;driver_priv;
 	int retval;
@@ -375,12 +375,12 @@
 	return ERROR_OK;
 }
 
-int ocl_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int ocl_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	return ERROR_OK;
 }
 
-int ocl_auto_probe(struct flash_bank_s *bank)
+static int ocl_auto_probe(struct flash_bank_s *bank)
 {
 	ocl_priv_t *ocl = bank-&gt;driver_priv;
 

Modified: trunk/src/flash/orion_nand.c
===================================================================
--- trunk/src/flash/orion_nand.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/orion_nand.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -55,7 +55,7 @@
 		} \
 	} while (0)
 
-int orion_nand_command(struct nand_device_s *device, u8 command)
+static int orion_nand_command(struct nand_device_s *device, u8 command)
 {
 	orion_nand_controller_t *hw = device-&gt;controller_priv;
 	target_t *target = hw-&gt;target;
@@ -65,7 +65,7 @@
 	return ERROR_OK;
 }
 
-int orion_nand_address(struct nand_device_s *device, u8 address)
+static int orion_nand_address(struct nand_device_s *device, u8 address)
 {
 	orion_nand_controller_t *hw = device-&gt;controller_priv;
 	target_t *target = hw-&gt;target;
@@ -75,7 +75,7 @@
 	return ERROR_OK;
 }
 
-int orion_nand_read(struct nand_device_s *device, void *data)
+static int orion_nand_read(struct nand_device_s *device, void *data)
 {
 	orion_nand_controller_t *hw = device-&gt;controller_priv;
 	target_t *target = hw-&gt;target;
@@ -85,7 +85,7 @@
 	return ERROR_OK;
 }
 
-int orion_nand_write(struct nand_device_s *device, u16 data)
+static int orion_nand_write(struct nand_device_s *device, u16 data)
 {
 	orion_nand_controller_t *hw = device-&gt;controller_priv;
 	target_t *target = hw-&gt;target;
@@ -95,14 +95,14 @@
 	return ERROR_OK;
 }
 
-int orion_nand_slow_block_write(struct nand_device_s *device, u8 *data, int size)
+static int orion_nand_slow_block_write(struct nand_device_s *device, u8 *data, int size)
 {
 	while (size--)
 		orion_nand_write(device, *data++);
 	return ERROR_OK;
 }
 
-int orion_nand_fast_block_write(struct nand_device_s *device, u8 *data, int size)
+static int orion_nand_fast_block_write(struct nand_device_s *device, u8 *data, int size)
 {
 	orion_nand_controller_t *hw = device-&gt;controller_priv;
 	target_t *target = hw-&gt;target;
@@ -181,17 +181,17 @@
 	return retval;
 }
 
-int orion_nand_reset(struct nand_device_s *device)
+static int orion_nand_reset(struct nand_device_s *device)
 {
 	return orion_nand_command(device, NAND_CMD_RESET);
 }
 
-int orion_nand_controller_ready(struct nand_device_s *device, int timeout)
+static int orion_nand_controller_ready(struct nand_device_s *device, int timeout)
 {
 	return 1;
 }
 
-int orion_nand_register_commands(struct command_context_s *cmd_ctx)
+static int orion_nand_register_commands(struct command_context_s *cmd_ctx)
 {
 	return ERROR_OK;
 }
@@ -234,7 +234,7 @@
 	return ERROR_OK;
 }
 
-int orion_nand_init(struct nand_device_s *device)
+static int orion_nand_init(struct nand_device_s *device)
 {
 	return ERROR_OK;
 }

Modified: trunk/src/flash/pic32mx.c
===================================================================
--- trunk/src/flash/pic32mx.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/pic32mx.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -66,26 +66,26 @@
 	{ 0x00, NULL, 0 }
 };
 
-int pic32mx_register_commands(struct command_context_s *cmd_ctx);
-int pic32mx_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int pic32mx_erase(struct flash_bank_s *bank, int first, int last);
-int pic32mx_protect(struct flash_bank_s *bank, int set, int first, int last);
-int pic32mx_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int pic32mx_write_row(struct flash_bank_s *bank, u32 address, u32 srcaddr);
-int pic32mx_write_word(struct flash_bank_s *bank, u32 address, u32 word);
-int pic32mx_probe(struct flash_bank_s *bank);
-int pic32mx_auto_probe(struct flash_bank_s *bank);
-int pic32mx_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int pic32mx_protect_check(struct flash_bank_s *bank);
-int pic32mx_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int pic32mx_register_commands(struct command_context_s *cmd_ctx);
+static int pic32mx_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int pic32mx_erase(struct flash_bank_s *bank, int first, int last);
+static int pic32mx_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int pic32mx_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int pic32mx_write_row(struct flash_bank_s *bank, u32 address, u32 srcaddr);
+static int pic32mx_write_word(struct flash_bank_s *bank, u32 address, u32 word);
+static int pic32mx_probe(struct flash_bank_s *bank);
+static int pic32mx_auto_probe(struct flash_bank_s *bank);
+//static int pic32mx_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int pic32mx_protect_check(struct flash_bank_s *bank);
+static int pic32mx_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
 #if 0
 int pic32mx_handle_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 int pic32mx_handle_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 #endif
-int pic32mx_handle_chip_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int pic32mx_handle_pgm_word_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int pic32mx_chip_erase(struct flash_bank_s *bank);
+static int pic32mx_handle_chip_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int pic32mx_handle_pgm_word_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+//static int pic32mx_chip_erase(struct flash_bank_s *bank);
 
 flash_driver_t pic32mx_flash =
 {
@@ -102,7 +102,7 @@
 	.info = pic32mx_info
 };
 
-int pic32mx_register_commands(struct command_context_s *cmd_ctx)
+static int pic32mx_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *pic32mx_cmd = register_command(cmd_ctx, NULL, &quot;pic32mx&quot;, NULL, COMMAND_ANY, &quot;pic32mx flash specific commands&quot;);
 
@@ -121,7 +121,7 @@
 
 /* flash bank pic32mx &lt;base&gt; &lt;size&gt; 0 0 &lt;target#&gt;
  */
-int pic32mx_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int pic32mx_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	pic32mx_flash_bank_t *pic32mx_info;
 
@@ -140,7 +140,7 @@
 	return ERROR_OK;
 }
 
-u32 pic32mx_get_flash_status(flash_bank_t *bank)
+static u32 pic32mx_get_flash_status(flash_bank_t *bank)
 {
 	target_t *target = bank-&gt;target;
 	u32 status;
@@ -150,7 +150,7 @@
 	return status;
 }
 
-u32 pic32mx_wait_status_busy(flash_bank_t *bank, int timeout)
+static u32 pic32mx_wait_status_busy(flash_bank_t *bank, int timeout)
 {
 	u32 status;
 
@@ -166,7 +166,7 @@
 	return status;
 }
 
-int pic32mx_nvm_exec(struct flash_bank_s *bank, u32 op, u32 timeout)
+static int pic32mx_nvm_exec(struct flash_bank_s *bank, u32 op, u32 timeout)
 {
 	target_t *target = bank-&gt;target;
 	u32 status;
@@ -188,7 +188,7 @@
 	return status;
 }
 
-int pic32mx_protect_check(struct flash_bank_s *bank)
+static int pic32mx_protect_check(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 
@@ -222,7 +222,7 @@
 	return ERROR_OK;
 }
 
-int pic32mx_erase(struct flash_bank_s *bank, int first, int last)
+static int pic32mx_erase(struct flash_bank_s *bank, int first, int last)
 {
 	target_t *target = bank-&gt;target;
 	int i;
@@ -264,7 +264,7 @@
 	return ERROR_OK;
 }
 
-int pic32mx_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int pic32mx_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	pic32mx_flash_bank_t *pic32mx_info = NULL;
 	target_t *target = bank-&gt;target;
@@ -357,7 +357,7 @@
 #endif
 }
 
-int pic32mx_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int pic32mx_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	target_t *target = bank-&gt;target;
 	u32 buffer_size = 512;
@@ -485,7 +485,7 @@
 	return retval;
 }
 
-int pic32mx_write_word(struct flash_bank_s *bank, u32 address, u32 word)
+static int pic32mx_write_word(struct flash_bank_s *bank, u32 address, u32 word)
 {
 	target_t *target = bank-&gt;target;
 
@@ -501,7 +501,7 @@
 /*
  * Write a 128 word (512 byte) row to flash address from RAM srcaddr.
  */
-int pic32mx_write_row(struct flash_bank_s *bank, u32 address, u32 srcaddr)
+static int pic32mx_write_row(struct flash_bank_s *bank, u32 address, u32 srcaddr)
 {
 	target_t *target = bank-&gt;target;
 
@@ -519,7 +519,7 @@
 	return pic32mx_nvm_exec(bank, NVMCON_OP_ROW_PROG, 100);
 }
 
-int pic32mx_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int pic32mx_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	u32 words_remaining = (count / 4);
 	u32 bytes_remaining = (count &amp; 0x00000003);
@@ -604,7 +604,7 @@
 	return ERROR_OK;
 }
 
-int pic32mx_probe(struct flash_bank_s *bank)
+static int pic32mx_probe(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	pic32mx_flash_bank_t *pic32mx_info = bank-&gt;driver_priv;
@@ -683,7 +683,7 @@
 	return ERROR_OK;
 }
 
-int pic32mx_auto_probe(struct flash_bank_s *bank)
+static int pic32mx_auto_probe(struct flash_bank_s *bank)
 {
 	pic32mx_flash_bank_t *pic32mx_info = bank-&gt;driver_priv;
 	if (pic32mx_info-&gt;probed)
@@ -691,12 +691,14 @@
 	return pic32mx_probe(bank);
 }
 
-int pic32mx_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+#if 0
+static int pic32mx_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	return ERROR_OK;
 }
+#endif
 
-int pic32mx_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int pic32mx_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	target_t *target = bank-&gt;target;
 	mips32_common_t *mips32 = target-&gt;arch_info;
@@ -823,7 +825,8 @@
 }
 #endif
 
-int pic32mx_chip_erase(struct flash_bank_s *bank)
+#if 0
+static int pic32mx_chip_erase(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 #if 0
@@ -866,8 +869,9 @@
 
 	return ERROR_OK;
 }
+#endif
 
-int pic32mx_handle_chip_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int pic32mx_handle_chip_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 #if 0
 	flash_bank_t *bank;
@@ -905,7 +909,7 @@
 	return ERROR_OK;
 }
 
-int pic32mx_handle_pgm_word_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int pic32mx_handle_pgm_word_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	u32 address, value;

Modified: trunk/src/flash/s3c2410_nand.c
===================================================================
--- trunk/src/flash/s3c2410_nand.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/s3c2410_nand.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -38,11 +38,11 @@
 #include &quot;s3c24xx_nand.h&quot;
 #include &quot;target.h&quot;
 
-int s3c2410_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-int s3c2410_init(struct nand_device_s *device);
-int s3c2410_read_data(struct nand_device_s *device, void *data);
-int s3c2410_write_data(struct nand_device_s *device, u16 data);
-int s3c2410_nand_ready(struct nand_device_s *device, int timeout);
+static int s3c2410_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
+static int s3c2410_init(struct nand_device_s *device);
+static int s3c2410_read_data(struct nand_device_s *device, void *data);
+static int s3c2410_write_data(struct nand_device_s *device, u16 data);
+static int s3c2410_nand_ready(struct nand_device_s *device, int timeout);
 
 nand_flash_controller_t s3c2410_nand_controller =
 {
@@ -61,7 +61,7 @@
 	.nand_ready		= s3c2410_nand_ready,
 };
 
-int s3c2410_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
+static int s3c2410_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
 				char **args, int argc,
 				struct nand_device_s *device)
 {
@@ -81,7 +81,7 @@
 	return ERROR_OK;
 }
 
-int s3c2410_init(struct nand_device_s *device)
+static int s3c2410_init(struct nand_device_s *device)
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device-&gt;controller_priv;
 	target_t *target = s3c24xx_info-&gt;target;
@@ -93,7 +93,7 @@
 	return ERROR_OK;
 }
 
-int s3c2410_write_data(struct nand_device_s *device, u16 data)
+static int s3c2410_write_data(struct nand_device_s *device, u16 data)
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device-&gt;controller_priv;
 	target_t *target = s3c24xx_info-&gt;target;
@@ -107,7 +107,7 @@
 	return ERROR_OK;
 }
 
-int s3c2410_read_data(struct nand_device_s *device, void *data)
+static int s3c2410_read_data(struct nand_device_s *device, void *data)
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device-&gt;controller_priv;
 	target_t *target = s3c24xx_info-&gt;target;
@@ -121,7 +121,7 @@
 	return ERROR_OK;
 }
 
-int s3c2410_nand_ready(struct nand_device_s *device, int timeout)
+static int s3c2410_nand_ready(struct nand_device_s *device, int timeout)
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device-&gt;controller_priv;
 	target_t *target = s3c24xx_info-&gt;target;

Modified: trunk/src/flash/s3c2412_nand.c
===================================================================
--- trunk/src/flash/s3c2412_nand.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/s3c2412_nand.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -38,8 +38,8 @@
 #include &quot;s3c24xx_nand.h&quot;
 #include &quot;target.h&quot;
 
-int s3c2412_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-int s3c2412_init(struct nand_device_s *device);
+static int s3c2412_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
+static int s3c2412_init(struct nand_device_s *device);
 
 nand_flash_controller_t s3c2412_nand_controller =
 {
@@ -60,7 +60,7 @@
 	.nand_ready		= s3c2440_nand_ready,
 };
 
-int s3c2412_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
+static int s3c2412_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
 				char **args, int argc,
 				struct nand_device_s *device)
 {
@@ -80,7 +80,7 @@
 	return ERROR_OK;
 }
 
-int s3c2412_init(struct nand_device_s *device)
+static int s3c2412_init(struct nand_device_s *device)
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device-&gt;controller_priv;
 	target_t *target = s3c24xx_info-&gt;target;

Modified: trunk/src/flash/s3c2440_nand.c
===================================================================
--- trunk/src/flash/s3c2440_nand.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/s3c2440_nand.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -38,9 +38,9 @@
 #include &quot;s3c24xx_nand.h&quot;
 #include &quot;target.h&quot;
 
-int s3c2440_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-int s3c2440_init(struct nand_device_s *device);
-int s3c2440_nand_ready(struct nand_device_s *device, int timeout);
+static int s3c2440_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
+static int s3c2440_init(struct nand_device_s *device);
+//static int s3c2440_nand_ready(struct nand_device_s *device, int timeout);
 
 nand_flash_controller_t s3c2440_nand_controller =
 {
@@ -61,7 +61,7 @@
 	.nand_ready		= s3c2440_nand_ready,
 };
 
-int s3c2440_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
+static int s3c2440_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
 				char **args, int argc,
 				struct nand_device_s *device)
 {
@@ -81,7 +81,7 @@
 	return ERROR_OK;
 }
 
-int s3c2440_init(struct nand_device_s *device)
+static int s3c2440_init(struct nand_device_s *device)
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device-&gt;controller_priv;
 	target_t *target = s3c24xx_info-&gt;target;

Modified: trunk/src/flash/s3c2443_nand.c
===================================================================
--- trunk/src/flash/s3c2443_nand.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/s3c2443_nand.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -38,9 +38,8 @@
 #include &quot;s3c24xx_nand.h&quot;
 #include &quot;target.h&quot;
 
-int s3c2443_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-int s3c2443_init(struct nand_device_s *device);
-int s3c2443_nand_ready(struct nand_device_s *device, int timeout);
+static int s3c2443_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
+static int s3c2443_init(struct nand_device_s *device);
 
 nand_flash_controller_t s3c2443_nand_controller =
 {
@@ -61,7 +60,7 @@
 	.nand_ready		= s3c2440_nand_ready,
 };
 
-int s3c2443_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
+static int s3c2443_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
 				char **args, int argc,
 				struct nand_device_s *device)
 {
@@ -81,7 +80,7 @@
 	return ERROR_OK;
 }
 
-int s3c2443_init(struct nand_device_s *device)
+static int s3c2443_init(struct nand_device_s *device)
 {
 	s3c24xx_nand_controller_t *s3c24xx_info = device-&gt;controller_priv;
 	target_t *target = s3c24xx_info-&gt;target;

Modified: trunk/src/flash/stellaris.c
===================================================================
--- trunk/src/flash/stellaris.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/stellaris.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -44,24 +44,24 @@
 #include &lt;unistd.h&gt;
 
 #define DID0_VER(did0) ((did0&gt;&gt;28)&amp;0x07)
-int stellaris_register_commands(struct command_context_s *cmd_ctx);
-int stellaris_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int stellaris_erase(struct flash_bank_s *bank, int first, int last);
-int stellaris_protect(struct flash_bank_s *bank, int set, int first, int last);
-int stellaris_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int stellaris_auto_probe(struct flash_bank_s *bank);
-int stellaris_probe(struct flash_bank_s *bank);
-int stellaris_protect_check(struct flash_bank_s *bank);
-int stellaris_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int stellaris_register_commands(struct command_context_s *cmd_ctx);
+static int stellaris_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int stellaris_erase(struct flash_bank_s *bank, int first, int last);
+static int stellaris_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int stellaris_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int stellaris_auto_probe(struct flash_bank_s *bank);
+static int stellaris_probe(struct flash_bank_s *bank);
+static int stellaris_protect_check(struct flash_bank_s *bank);
+static int stellaris_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
-int stellaris_read_part_info(struct flash_bank_s *bank);
-u32 stellaris_get_flash_status(flash_bank_t *bank);
-void stellaris_set_flash_mode(flash_bank_t *bank,int mode);
-u32 stellaris_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout);
+static int stellaris_read_part_info(struct flash_bank_s *bank);
+static u32 stellaris_get_flash_status(flash_bank_t *bank);
+static void stellaris_set_flash_mode(flash_bank_t *bank,int mode);
+//static u32 stellaris_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout);
 
-int stellaris_read_part_info(struct flash_bank_s *bank);
-int stellaris_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int stellaris_mass_erase(struct flash_bank_s *bank);
+static int stellaris_read_part_info(struct flash_bank_s *bank);
+static int stellaris_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int stellaris_mass_erase(struct flash_bank_s *bank);
 
 flash_driver_t stellaris_flash =
 {
@@ -78,7 +78,7 @@
 	.info = stellaris_info
 };
 
-struct {
+static struct {
 	u32 partno;
 	char *partname;
 }	StellarisParts[] =
@@ -234,7 +234,7 @@
 	{0,&quot;Unknown part&quot;}
 };
 
-char * StellarisClassname[5] =
+static char * StellarisClassname[5] =
 {
 	&quot;Sandstorm&quot;,
 	&quot;Fury&quot;,
@@ -249,7 +249,7 @@
 
 /* flash_bank stellaris &lt;base&gt; &lt;size&gt; 0 0 &lt;target#&gt;
  */
-int stellaris_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int stellaris_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	stellaris_flash_bank_t *stellaris_info;
 	
@@ -272,7 +272,7 @@
 	return ERROR_OK;
 }
 
-int stellaris_register_commands(struct command_context_s *cmd_ctx)
+static int stellaris_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *stm32x_cmd = register_command(cmd_ctx, NULL, &quot;stellaris&quot;, NULL, COMMAND_ANY, &quot;stellaris flash specific commands&quot;);
 	
@@ -280,7 +280,7 @@
 	return ERROR_OK;
 }
 
-int stellaris_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int stellaris_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	int printed, device_class;
 	stellaris_flash_bank_t *stellaris_info = bank-&gt;driver_priv;
@@ -331,7 +331,7 @@
 *	chip identification and status                                         *
 ***************************************************************************/
 
-u32 stellaris_get_flash_status(flash_bank_t *bank)
+static u32 stellaris_get_flash_status(flash_bank_t *bank)
 {
 	target_t *target = bank-&gt;target;
 	u32 fmc;
@@ -343,7 +343,7 @@
 
 /** Read clock configuration and set stellaris_info-&gt;usec_clocks*/
  
-void stellaris_read_clock_info(flash_bank_t *bank)
+static void stellaris_read_clock_info(flash_bank_t *bank)
 {
 	stellaris_flash_bank_t *stellaris_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -395,7 +395,7 @@
 }
 
 /* Setup the timimg registers */
-void stellaris_set_flash_mode(flash_bank_t *bank,int mode)
+static void stellaris_set_flash_mode(flash_bank_t *bank,int mode)
 {
 	stellaris_flash_bank_t *stellaris_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -405,7 +405,8 @@
 	target_write_u32(target, SCB_BASE|USECRL, usecrl);
 }
 
-u32 stellaris_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout)
+#if 0
+static u32 stellaris_wait_status_busy(flash_bank_t *bank, u32 waitbits, int timeout)
 {
 	u32 status;
 	
@@ -422,7 +423,7 @@
 }
 
 /* Send one command to the flash controller */
-int stellaris_flash_command(struct flash_bank_s *bank,u8 cmd,u16 pagen) 
+static int stellaris_flash_command(struct flash_bank_s *bank,u8 cmd,u16 pagen) 
 {
 	u32 fmc;
 	target_t *target = bank-&gt;target;
@@ -438,9 +439,10 @@
 
 	return ERROR_OK;
 }
+#endif
 
 /* Read device id register, main clock frequency register and fill in driver info structure */
-int stellaris_read_part_info(struct flash_bank_s *bank)
+static int stellaris_read_part_info(struct flash_bank_s *bank)
 {
 	stellaris_flash_bank_t *stellaris_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -515,7 +517,7 @@
 *	flash operations                                                       *
 ***************************************************************************/
 
-int stellaris_protect_check(struct flash_bank_s *bank)
+static int stellaris_protect_check(struct flash_bank_s *bank)
 {
 	u32 status;
 	
@@ -544,7 +546,7 @@
 	return ERROR_OK;
 }
 
-int stellaris_erase(struct flash_bank_s *bank, int first, int last)
+static int stellaris_erase(struct flash_bank_s *bank, int first, int last)
 {
 	int banknr;
 	u32 flash_fmc, flash_cris;
@@ -614,7 +616,7 @@
 	return ERROR_OK;
 }
 
-int stellaris_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int stellaris_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	u32 fmppe, flash_fmc, flash_cris;
 	int lockregion;
@@ -690,7 +692,7 @@
 	return ERROR_OK;
 }
 
-u8 stellaris_write_code[] = 
+static u8 stellaris_write_code[] = 
 {
 /* 
 	Call with :	
@@ -730,7 +732,7 @@
 	0x01,0x00,0x42,0xA4 	/* .word	0xA4420001 */
 };
 
-int stellaris_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 wcount)
+static int stellaris_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 wcount)
 {
 	target_t *target = bank-&gt;target;
 	u32 buffer_size = 8192;
@@ -810,7 +812,7 @@
 	return retval;
 }
 
-int stellaris_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int stellaris_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	stellaris_flash_bank_t *stellaris_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -945,7 +947,7 @@
 	return ERROR_OK;
 }
 
-int stellaris_probe(struct flash_bank_s *bank)
+static int stellaris_probe(struct flash_bank_s *bank)
 {
 	/* we can't probe on an stellaris
 	 * if this is an stellaris, it has the configured flash
@@ -961,7 +963,7 @@
 	return stellaris_read_part_info(bank);
 }
 
-int stellaris_auto_probe(struct flash_bank_s *bank)
+static int stellaris_auto_probe(struct flash_bank_s *bank)
 {
 	stellaris_flash_bank_t *stellaris_info = bank-&gt;driver_priv;
 	if (stellaris_info-&gt;did1)
@@ -969,7 +971,7 @@
 	return stellaris_probe(bank);
 }
 
-int stellaris_mass_erase(struct flash_bank_s *bank)
+static int stellaris_mass_erase(struct flash_bank_s *bank)
 {
 	target_t *target = NULL;
 	stellaris_flash_bank_t *stellaris_info = NULL;
@@ -1029,7 +1031,7 @@
 	return ERROR_OK;
 }
 
-int stellaris_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int stellaris_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	int i;

Modified: trunk/src/flash/stm32x.c
===================================================================
--- trunk/src/flash/stm32x.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/stm32x.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -37,23 +37,23 @@
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 
-int stm32x_register_commands(struct command_context_s *cmd_ctx);
-int stm32x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int stm32x_erase(struct flash_bank_s *bank, int first, int last);
-int stm32x_protect(struct flash_bank_s *bank, int set, int first, int last);
-int stm32x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int stm32x_probe(struct flash_bank_s *bank);
-int stm32x_auto_probe(struct flash_bank_s *bank);
-int stm32x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int stm32x_protect_check(struct flash_bank_s *bank);
-int stm32x_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int stm32x_register_commands(struct command_context_s *cmd_ctx);
+static int stm32x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int stm32x_erase(struct flash_bank_s *bank, int first, int last);
+static int stm32x_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int stm32x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int stm32x_probe(struct flash_bank_s *bank);
+static int stm32x_auto_probe(struct flash_bank_s *bank);
+//static int stm32x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int stm32x_protect_check(struct flash_bank_s *bank);
+static int stm32x_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
-int stm32x_handle_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int stm32x_handle_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int stm32x_handle_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int stm32x_handle_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int stm32x_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int stm32x_mass_erase(struct flash_bank_s *bank);
+static int stm32x_handle_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int stm32x_handle_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int stm32x_handle_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int stm32x_handle_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int stm32x_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int stm32x_mass_erase(struct flash_bank_s *bank);
 
 flash_driver_t stm32x_flash =
 {
@@ -70,7 +70,7 @@
 	.info = stm32x_info
 };
 
-int stm32x_register_commands(struct command_context_s *cmd_ctx)
+static int stm32x_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *stm32x_cmd = register_command(cmd_ctx, NULL, &quot;stm32x&quot;, NULL, COMMAND_ANY, &quot;stm32x flash specific commands&quot;);
 	
@@ -89,7 +89,7 @@
 
 /* flash bank stm32x &lt;base&gt; &lt;size&gt; 0 0 &lt;target#&gt;
  */
-int stm32x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int stm32x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	stm32x_flash_bank_t *stm32x_info;
 	
@@ -108,7 +108,7 @@
 	return ERROR_OK;
 }
 
-u32 stm32x_get_flash_status(flash_bank_t *bank)
+static u32 stm32x_get_flash_status(flash_bank_t *bank)
 {
 	target_t *target = bank-&gt;target;
 	u32 status;
@@ -118,7 +118,7 @@
 	return status;
 }
 
-u32 stm32x_wait_status_busy(flash_bank_t *bank, int timeout)
+static u32 stm32x_wait_status_busy(flash_bank_t *bank, int timeout)
 {
 	u32 status;
 	
@@ -132,7 +132,7 @@
 	return status;
 }
 
-int stm32x_read_options(struct flash_bank_s *bank)
+static int stm32x_read_options(struct flash_bank_s *bank)
 {
 	u32 optiondata;
 	stm32x_flash_bank_t *stm32x_info = NULL;
@@ -160,7 +160,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_erase_options(struct flash_bank_s *bank)
+static int stm32x_erase_options(struct flash_bank_s *bank)
 {
 	stm32x_flash_bank_t *stm32x_info = NULL;
 	target_t *target = bank-&gt;target;
@@ -197,7 +197,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_write_options(struct flash_bank_s *bank)
+static int stm32x_write_options(struct flash_bank_s *bank)
 {
 	stm32x_flash_bank_t *stm32x_info = NULL;
 	target_t *target = bank-&gt;target;
@@ -281,7 +281,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_protect_check(struct flash_bank_s *bank)
+static int stm32x_protect_check(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	stm32x_flash_bank_t *stm32x_info = bank-&gt;driver_priv;
@@ -352,7 +352,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_erase(struct flash_bank_s *bank, int first, int last)
+static int stm32x_erase(struct flash_bank_s *bank, int first, int last)
 {
 	target_t *target = bank-&gt;target;
 	int i;
@@ -393,7 +393,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int stm32x_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	stm32x_flash_bank_t *stm32x_info = NULL;
 	target_t *target = bank-&gt;target;
@@ -480,7 +480,7 @@
 	return stm32x_write_options(bank);
 }
 
-int stm32x_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int stm32x_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	stm32x_flash_bank_t *stm32x_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -595,7 +595,7 @@
 	return retval;
 }
 
-int stm32x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int stm32x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	target_t *target = bank-&gt;target;
 	u32 words_remaining = (count / 2);
@@ -704,7 +704,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_probe(struct flash_bank_s *bank)
+static int stm32x_probe(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	stm32x_flash_bank_t *stm32x_info = bank-&gt;driver_priv;
@@ -821,7 +821,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_auto_probe(struct flash_bank_s *bank)
+static int stm32x_auto_probe(struct flash_bank_s *bank)
 {
 	stm32x_flash_bank_t *stm32x_info = bank-&gt;driver_priv;
 	if (stm32x_info-&gt;probed)
@@ -829,12 +829,14 @@
 	return stm32x_probe(bank);
 }
 
-int stm32x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+#if 0
+static int stm32x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	return ERROR_OK;
 }
+#endif
 
-int stm32x_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int stm32x_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	target_t *target = bank-&gt;target;
 	u32 device_id;
@@ -936,7 +938,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_handle_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int stm32x_handle_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	target_t *target = NULL;
@@ -985,7 +987,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_handle_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int stm32x_handle_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	target_t *target = NULL;
@@ -1031,7 +1033,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_handle_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int stm32x_handle_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	u32 optionbyte;
@@ -1090,7 +1092,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_handle_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int stm32x_handle_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	target_t *target = NULL;
@@ -1166,7 +1168,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_mass_erase(struct flash_bank_s *bank)
+static int stm32x_mass_erase(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	u32 status;
@@ -1204,7 +1206,7 @@
 	return ERROR_OK;
 }
 
-int stm32x_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int stm32x_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	int i;

Modified: trunk/src/flash/str7x.c
===================================================================
--- trunk/src/flash/str7x.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/str7x.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -54,17 +54,17 @@
 	{0x00002000, 0x02000, 0x20000}
 };
 
-int str7x_register_commands(struct command_context_s *cmd_ctx);
-int str7x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int str7x_erase(struct flash_bank_s *bank, int first, int last);
-int str7x_protect(struct flash_bank_s *bank, int set, int first, int last);
-int str7x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int str7x_probe(struct flash_bank_s *bank);
-int str7x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str7x_protect_check(struct flash_bank_s *bank);
-int str7x_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int str7x_register_commands(struct command_context_s *cmd_ctx);
+static int str7x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int str7x_erase(struct flash_bank_s *bank, int first, int last);
+static int str7x_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int str7x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int str7x_probe(struct flash_bank_s *bank);
+//static int str7x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str7x_protect_check(struct flash_bank_s *bank);
+static int str7x_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
-int str7x_handle_disable_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str7x_handle_disable_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 flash_driver_t str7x_flash =
 {
@@ -81,7 +81,7 @@
 	.info = str7x_info
 };
 
-int str7x_register_commands(struct command_context_s *cmd_ctx)
+static int str7x_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *str7x_cmd = register_command(cmd_ctx, NULL, &quot;str7x&quot;, NULL, COMMAND_ANY, NULL);
 	
@@ -91,13 +91,13 @@
 	return ERROR_OK;
 }
 
-int str7x_get_flash_adr(struct flash_bank_s *bank, u32 reg)
+static int str7x_get_flash_adr(struct flash_bank_s *bank, u32 reg)
 {
 	str7x_flash_bank_t *str7x_info = bank-&gt;driver_priv;
 	return (str7x_info-&gt;register_base | reg);
 }
 
-int str7x_build_block_list(struct flash_bank_s *bank)
+static int str7x_build_block_list(struct flash_bank_s *bank)
 {
 	str7x_flash_bank_t *str7x_info = bank-&gt;driver_priv;
 
@@ -155,7 +155,7 @@
 
 /* flash bank str7x &lt;base&gt; &lt;size&gt; 0 0 &lt;target#&gt; &lt;str71_variant&gt;
  */
-int str7x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int str7x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	str7x_flash_bank_t *str7x_info;
 	
@@ -200,7 +200,7 @@
 	return ERROR_OK;
 }
 
-u32 str7x_status(struct flash_bank_s *bank)
+static u32 str7x_status(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	u32 retval;
@@ -210,7 +210,7 @@
 	return retval;
 }
 
-u32 str7x_result(struct flash_bank_s *bank)
+static u32 str7x_result(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	u32 retval;
@@ -220,7 +220,7 @@
 	return retval;
 }
 
-int str7x_protect_check(struct flash_bank_s *bank)
+static int str7x_protect_check(struct flash_bank_s *bank)
 {
 	str7x_flash_bank_t *str7x_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -247,7 +247,7 @@
 	return ERROR_OK;
 }
 
-int str7x_erase(struct flash_bank_s *bank, int first, int last)
+static int str7x_erase(struct flash_bank_s *bank, int first, int last)
 {
 	str7x_flash_bank_t *str7x_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -300,7 +300,7 @@
 	return ERROR_OK;
 }
 
-int str7x_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int str7x_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	str7x_flash_bank_t *str7x_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -354,7 +354,7 @@
 	return ERROR_OK;
 }
 
-int str7x_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int str7x_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	str7x_flash_bank_t *str7x_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -469,7 +469,7 @@
 	return retval;
 }
 
-int str7x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int str7x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	target_t *target = bank-&gt;target;
 	str7x_flash_bank_t *str7x_info = bank-&gt;driver_priv;
@@ -629,23 +629,25 @@
 	return ERROR_OK;
 }
 
-int str7x_probe(struct flash_bank_s *bank)
+static int str7x_probe(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
-int str7x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+#if 0
+static int str7x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	return ERROR_OK;
 }
+#endif
 
-int str7x_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int str7x_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	snprintf(buf, buf_size, &quot;str7x flash driver info&quot; );
 	return ERROR_OK;
 }
 
-int str7x_handle_disable_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str7x_handle_disable_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	target_t *target = NULL;

Modified: trunk/src/flash/str9x.c
===================================================================
--- trunk/src/flash/str9x.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/str9x.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -44,17 +44,17 @@
 
 static u32 bank1start = 0x00080000;
 
-int str9x_register_commands(struct command_context_s *cmd_ctx);
-int str9x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int str9x_erase(struct flash_bank_s *bank, int first, int last);
-int str9x_protect(struct flash_bank_s *bank, int set, int first, int last);
-int str9x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int str9x_probe(struct flash_bank_s *bank);
-int str9x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9x_protect_check(struct flash_bank_s *bank);
-int str9x_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int str9x_register_commands(struct command_context_s *cmd_ctx);
+static int str9x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int str9x_erase(struct flash_bank_s *bank, int first, int last);
+static int str9x_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int str9x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int str9x_probe(struct flash_bank_s *bank);
+//static int str9x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9x_protect_check(struct flash_bank_s *bank);
+static int str9x_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
-int str9x_handle_flash_config_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9x_handle_flash_config_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 flash_driver_t str9x_flash =
 {
@@ -71,7 +71,7 @@
 	.info = str9x_info
 };
 
-int str9x_register_commands(struct command_context_s *cmd_ctx)
+static int str9x_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *str9x_cmd = register_command(cmd_ctx, NULL, &quot;str9x&quot;, NULL, COMMAND_ANY, NULL);
 	
@@ -81,7 +81,7 @@
 	return ERROR_OK;
 }
 
-int str9x_build_block_list(struct flash_bank_s *bank)
+static int str9x_build_block_list(struct flash_bank_s *bank)
 {
 	str9x_flash_bank_t *str9x_info = bank-&gt;driver_priv;
 	
@@ -164,7 +164,8 @@
 
 /* flash bank str9x &lt;base&gt; &lt;size&gt; 0 0 &lt;target#&gt;
  */
-int str9x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int str9x_flash_bank_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	str9x_flash_bank_t *str9x_info;
 	
@@ -184,7 +185,7 @@
 	return ERROR_OK;
 }
 
-int str9x_protect_check(struct flash_bank_s *bank)
+static int str9x_protect_check(struct flash_bank_s *bank)
 {
 	int retval;
 	str9x_flash_bank_t *str9x_info = bank-&gt;driver_priv;
@@ -259,7 +260,7 @@
 	return ERROR_OK;
 }
 
-int str9x_erase(struct flash_bank_s *bank, int first, int last)
+static int str9x_erase(struct flash_bank_s *bank, int first, int last)
 {
 	target_t *target = bank-&gt;target;
 	int i;
@@ -351,7 +352,8 @@
 	return ERROR_OK;
 }
 
-int str9x_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int str9x_protect(struct flash_bank_s *bank,
+		int set, int first, int last)
 {
 	target_t *target = bank-&gt;target;
 	int i;
@@ -389,7 +391,8 @@
 	return ERROR_OK;
 }
 
-int str9x_write_block(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int str9x_write_block(struct flash_bank_s *bank,
+		u8 *buffer, u32 offset, u32 count)
 {
 	str9x_flash_bank_t *str9x_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -497,7 +500,8 @@
 	return retval;
 }
 
-int str9x_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int str9x_write(struct flash_bank_s *bank,
+		u8 *buffer, u32 offset, u32 count)
 {
 	target_t *target = bank-&gt;target;
 	u32 words_remaining = (count / 2);
@@ -654,23 +658,27 @@
 	return ERROR_OK;
 }
 
-int str9x_probe(struct flash_bank_s *bank)
+static int str9x_probe(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
-int str9x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+#if 0
+static int str9x_handle_part_id_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **args, int argc)
 {
 	return ERROR_OK;
 }
+#endif
 
-int str9x_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int str9x_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	snprintf(buf, buf_size, &quot;str9x flash driver info&quot; );
 	return ERROR_OK;
 }
 
-int str9x_handle_flash_config_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9x_handle_flash_config_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **args, int argc)
 {
 	str9x_flash_bank_t *str9x_info;
 	flash_bank_t *bank;

Modified: trunk/src/flash/str9xpec.c
===================================================================
--- trunk/src/flash/str9xpec.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/str9xpec.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -40,31 +40,31 @@
 #include &lt;unistd.h&gt;
 #include &lt;getopt.h&gt;
 
-int str9xpec_register_commands(struct command_context_s *cmd_ctx);
-int str9xpec_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int str9xpec_erase(struct flash_bank_s *bank, int first, int last);
-int str9xpec_protect(struct flash_bank_s *bank, int set, int first, int last);
-int str9xpec_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
-int str9xpec_probe(struct flash_bank_s *bank);
-int str9xpec_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_protect_check(struct flash_bank_s *bank);
-int str9xpec_erase_check(struct flash_bank_s *bank);
-int str9xpec_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int str9xpec_register_commands(struct command_context_s *cmd_ctx);
+static int str9xpec_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int str9xpec_erase(struct flash_bank_s *bank, int first, int last);
+static int str9xpec_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int str9xpec_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count);
+static int str9xpec_probe(struct flash_bank_s *bank);
+static int str9xpec_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_protect_check(struct flash_bank_s *bank);
+static int str9xpec_erase_check(struct flash_bank_s *bank);
+static int str9xpec_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
-int str9xpec_erase_area(struct flash_bank_s *bank, int first, int last);
-int str9xpec_set_address(struct flash_bank_s *bank, u8 sector);
-int str9xpec_write_options(struct flash_bank_s *bank);
+static int str9xpec_erase_area(struct flash_bank_s *bank, int first, int last);
+static int str9xpec_set_address(struct flash_bank_s *bank, u8 sector);
+static int str9xpec_write_options(struct flash_bank_s *bank);
 
-int str9xpec_handle_flash_options_cmap_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_handle_flash_options_lvdthd_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_handle_flash_options_lvdsel_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_handle_flash_options_lvdwarn_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_handle_flash_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_handle_flash_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_handle_flash_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_handle_flash_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_handle_flash_enable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int str9xpec_handle_flash_disable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_options_cmap_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_options_lvdthd_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_options_lvdsel_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_options_lvdwarn_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_enable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+static int str9xpec_handle_flash_disable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 flash_driver_t str9xpec_flash =
 {
@@ -81,7 +81,7 @@
 	.info = str9xpec_info
 };
 
-int str9xpec_register_commands(struct command_context_s *cmd_ctx)
+static int str9xpec_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *str9xpec_cmd = register_command(cmd_ctx, NULL, &quot;str9xpec&quot;, NULL, COMMAND_ANY, &quot;str9xpec flash specific commands&quot;);
 
@@ -140,7 +140,7 @@
 	return ERROR_OK;
 }
 
-u8 str9xpec_isc_status(jtag_tap_t *tap)
+static u8 str9xpec_isc_status(jtag_tap_t *tap)
 {
 	scan_field_t field;
 	u8 status;
@@ -169,7 +169,7 @@
 	return status;
 }
 
-int str9xpec_isc_enable(struct flash_bank_s *bank)
+static int str9xpec_isc_enable(struct flash_bank_s *bank)
 {
 	u8 status;
 	jtag_tap_t *tap;
@@ -196,7 +196,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_isc_disable(struct flash_bank_s *bank)
+static int str9xpec_isc_disable(struct flash_bank_s *bank)
 {
 	u8 status;
 	jtag_tap_t *tap;
@@ -225,7 +225,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_read_config(struct flash_bank_s *bank)
+static int str9xpec_read_config(struct flash_bank_s *bank)
 {
 	scan_field_t field;
 	u8 status;
@@ -258,7 +258,7 @@
 	return status;
 }
 
-int str9xpec_build_block_list(struct flash_bank_s *bank)
+static int str9xpec_build_block_list(struct flash_bank_s *bank)
 {
 	str9xpec_flash_controller_t *str9xpec_info = bank-&gt;driver_priv;
 
@@ -327,7 +327,7 @@
 
 /* flash bank str9x &lt;base&gt; &lt;size&gt; 0 0 &lt;target#&gt;
  */
-int str9xpec_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int str9xpec_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	str9xpec_flash_controller_t *str9xpec_info;
 	armv4_5_common_t *armv4_5 = NULL;
@@ -361,7 +361,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_blank_check(struct flash_bank_s *bank, int first, int last)
+static int str9xpec_blank_check(struct flash_bank_s *bank, int first, int last)
 {
 	scan_field_t field;
 	u8 status;
@@ -438,7 +438,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_protect_check(struct flash_bank_s *bank)
+static int str9xpec_protect_check(struct flash_bank_s *bank)
 {
 	u8 status;
 	int i;
@@ -460,7 +460,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_erase_area(struct flash_bank_s *bank, int first, int last)
+static int str9xpec_erase_area(struct flash_bank_s *bank, int first, int last)
 {
 	scan_field_t field;
 	u8 status;
@@ -535,7 +535,7 @@
 	return status;
 }
 
-int str9xpec_erase(struct flash_bank_s *bank, int first, int last)
+static int str9xpec_erase(struct flash_bank_s *bank, int first, int last)
 {
 	int status;
 
@@ -547,7 +547,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_lock_device(struct flash_bank_s *bank)
+static int str9xpec_lock_device(struct flash_bank_s *bank)
 {
 	scan_field_t field;
 	u8 status;
@@ -594,7 +594,7 @@
 	return status;
 }
 
-int str9xpec_unlock_device(struct flash_bank_s *bank)
+static int str9xpec_unlock_device(struct flash_bank_s *bank)
 {
 	u8 status;
 
@@ -603,7 +603,7 @@
 	return status;
 }
 
-int str9xpec_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int str9xpec_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	u8 status;
 	int i;
@@ -649,7 +649,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_set_address(struct flash_bank_s *bank, u8 sector)
+static int str9xpec_set_address(struct flash_bank_s *bank, u8 sector)
 {
 	jtag_tap_t *tap;
 	scan_field_t field;
@@ -675,7 +675,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
+static int str9xpec_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	str9xpec_flash_controller_t *str9xpec_info = bank-&gt;driver_priv;
 	u32 dwords_remaining = (count / 8);
@@ -858,12 +858,12 @@
 	return ERROR_OK;
 }
 
-int str9xpec_probe(struct flash_bank_s *bank)
+static int str9xpec_probe(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
-int str9xpec_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	scan_field_t field;
@@ -913,18 +913,18 @@
 	return ERROR_OK;
 }
 
-int str9xpec_erase_check(struct flash_bank_s *bank)
+static int str9xpec_erase_check(struct flash_bank_s *bank)
 {
 	return str9xpec_blank_check(bank, 0, bank-&gt;num_sectors - 1);
 }
 
-int str9xpec_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int str9xpec_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	snprintf(buf, buf_size, &quot;str9xpec flash driver info&quot; );
 	return ERROR_OK;
 }
 
-int str9xpec_handle_flash_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_flash_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	u8 status;
@@ -983,7 +983,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_write_options(struct flash_bank_s *bank)
+static int str9xpec_write_options(struct flash_bank_s *bank)
 {
 	scan_field_t field;
 	u8 status;
@@ -1054,7 +1054,7 @@
 	return status;
 }
 
-int str9xpec_handle_flash_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_flash_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	u8 status;
@@ -1080,7 +1080,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_handle_flash_options_cmap_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_flash_options_cmap_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	str9xpec_flash_controller_t *str9xpec_info = NULL;
@@ -1112,7 +1112,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_handle_flash_options_lvdthd_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_flash_options_lvdthd_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	str9xpec_flash_controller_t *str9xpec_info = NULL;
@@ -1176,7 +1176,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_handle_flash_options_lvdwarn_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_flash_options_lvdwarn_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	str9xpec_flash_controller_t *str9xpec_info = NULL;
@@ -1208,7 +1208,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_handle_flash_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_flash_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	u8 status;
 	flash_bank_t *bank;
@@ -1234,7 +1234,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_handle_flash_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_flash_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	u8 status;
 	flash_bank_t *bank;
@@ -1260,7 +1260,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_handle_flash_enable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_flash_enable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	int retval;
 	flash_bank_t *bank;
@@ -1313,7 +1313,7 @@
 	return ERROR_OK;
 }
 
-int str9xpec_handle_flash_disable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int str9xpec_handle_flash_disable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	flash_bank_t *bank;
 	jtag_tap_t *tap;

Modified: trunk/src/flash/tms470.c
===================================================================
--- trunk/src/flash/tms470.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/flash/tms470.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -26,16 +26,16 @@
 #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
 
-int tms470_register_commands(struct command_context_s *cmd_ctx);
-int tms470_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-int tms470_erase(struct flash_bank_s *bank, int first, int last);
-int tms470_protect(struct flash_bank_s *bank, int set, int first, int last);
-int tms470_write(struct flash_bank_s *bank, u8 * buffer, u32 offset, u32 count);
-int tms470_probe(struct flash_bank_s *bank);
-int tms470_auto_probe(struct flash_bank_s *bank);
-int tms470_erase_check(struct flash_bank_s *bank);
-int tms470_protect_check(struct flash_bank_s *bank);
-int tms470_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int tms470_register_commands(struct command_context_s *cmd_ctx);
+static int tms470_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
+static int tms470_erase(struct flash_bank_s *bank, int first, int last);
+static int tms470_protect(struct flash_bank_s *bank, int set, int first, int last);
+static int tms470_write(struct flash_bank_s *bank, u8 * buffer, u32 offset, u32 count);
+static int tms470_probe(struct flash_bank_s *bank);
+static int tms470_auto_probe(struct flash_bank_s *bank);
+static int tms470_erase_check(struct flash_bank_s *bank);
+static int tms470_protect_check(struct flash_bank_s *bank);
+static int tms470_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
 flash_driver_t tms470_flash = {
 	.name = &quot;tms470&quot;,
@@ -133,7 +133,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_read_part_info(struct flash_bank_s *bank)
+static int tms470_read_part_info(struct flash_bank_s *bank)
 {
 	tms470_flash_bank_t *tms470_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -309,10 +309,10 @@
 
 /* ---------------------------------------------------------------------- */
 
-u32 keysSet = 0;
-u32 flashKeys[4];
+static u32 keysSet = 0;
+static u32 flashKeys[4];
 
-int tms470_handle_flash_keyset_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int tms470_handle_flash_keyset_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	if (argc &gt; 4)
 	{
@@ -355,27 +355,27 @@
 	return ERROR_OK;
 }
 
-const u32 FLASH_KEYS_ALL_ONES[] = { 0xFFFFFFFF, 0xFFFFFFFF,
+static const u32 FLASH_KEYS_ALL_ONES[] = { 0xFFFFFFFF, 0xFFFFFFFF,
 	0xFFFFFFFF, 0xFFFFFFFF,
 };
 
-const u32 FLASH_KEYS_ALL_ZEROS[] = { 0x00000000, 0x00000000,
+static const u32 FLASH_KEYS_ALL_ZEROS[] = { 0x00000000, 0x00000000,
 	0x00000000, 0x00000000,
 };
 
-const u32 FLASH_KEYS_MIX1[] = { 0xf0fff0ff, 0xf0fff0ff,
+static const u32 FLASH_KEYS_MIX1[] = { 0xf0fff0ff, 0xf0fff0ff,
 	0xf0fff0ff, 0xf0fff0ff
 };
 
-const u32 FLASH_KEYS_MIX2[] = { 0x0000ffff, 0x0000ffff,
+static const u32 FLASH_KEYS_MIX2[] = { 0x0000ffff, 0x0000ffff,
 	0x0000ffff, 0x0000ffff
 };
 
 /* ---------------------------------------------------------------------- */
 
-int oscMHz = 12;
+static int oscMHz = 12;
 
-int tms470_handle_osc_megahertz_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int tms470_handle_osc_megahertz_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	if (argc &gt; 1)
 	{
@@ -402,9 +402,9 @@
 
 /* ---------------------------------------------------------------------- */
 
-int plldis = 0;
+static int plldis = 0;
 
-int tms470_handle_plldis_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int tms470_handle_plldis_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	if (argc &gt; 1)
 	{
@@ -424,7 +424,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_check_flash_unlocked(target_t * target)
+static int tms470_check_flash_unlocked(target_t * target)
 {
 	u32 fmbbusy;
 
@@ -435,7 +435,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_try_flash_keys(target_t * target, const u32 * key_set)
+static int tms470_try_flash_keys(target_t * target, const u32 * key_set)
 {
 	u32 glbctrl, fmmstat;
 	int retval = ERROR_FLASH_OPERATION_FAILED;
@@ -513,7 +513,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_unlock_flash(struct flash_bank_s *bank)
+static int tms470_unlock_flash(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	const u32 *p_key_sets[5];
@@ -552,7 +552,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_flash_initialize_internal_state_machine(struct flash_bank_s *bank)
+static int tms470_flash_initialize_internal_state_machine(struct flash_bank_s *bank)
 {
 	u32 fmmac2, fmmac1, fmmaxep, k, delay, glbctrl, sysclk;
 	target_t *target = bank-&gt;target;
@@ -744,7 +744,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_erase_sector(struct flash_bank_s *bank, int sector)
+static int tms470_erase_sector(struct flash_bank_s *bank, int sector)
 {
 	u32 glbctrl, orig_fmregopt, fmbsea, fmbseb, fmmstat;
 	target_t *target = bank-&gt;target;
@@ -839,7 +839,7 @@
               Implementation of Flash Driver Interfaces
    ---------------------------------------------------------------------- */
 
-int tms470_register_commands(struct command_context_s *cmd_ctx)
+static int tms470_register_commands(struct command_context_s *cmd_ctx)
 {
 	command_t *tms470_cmd = register_command(cmd_ctx, NULL, &quot;tms470&quot;, NULL, COMMAND_ANY, &quot;applies to TI tms470 family&quot;);
 
@@ -852,7 +852,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_erase(struct flash_bank_s *bank, int first, int last)
+static int tms470_erase(struct flash_bank_s *bank, int first, int last)
 {
 	tms470_flash_bank_t *tms470_info = bank-&gt;driver_priv;
 	int sector, result = ERROR_OK;
@@ -899,7 +899,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_protect(struct flash_bank_s *bank, int set, int first, int last)
+static int tms470_protect(struct flash_bank_s *bank, int set, int first, int last)
 {
 	tms470_flash_bank_t *tms470_info = bank-&gt;driver_priv;
 	target_t *target = bank-&gt;target;
@@ -951,7 +951,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_write(struct flash_bank_s *bank, u8 * buffer, u32 offset, u32 count)
+static int tms470_write(struct flash_bank_s *bank, u8 * buffer, u32 offset, u32 count)
 {
 	target_t *target = bank-&gt;target;
 	u32 glbctrl, fmbac2, orig_fmregopt, fmbsea, fmbseb, fmmaxpp, fmmstat;
@@ -1048,7 +1048,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_probe(struct flash_bank_s *bank)
+static int tms470_probe(struct flash_bank_s *bank)
 {
 	if (bank-&gt;target-&gt;state != TARGET_HALTED)
 	{
@@ -1059,7 +1059,7 @@
 	return tms470_read_part_info(bank);
 }
 
-int tms470_auto_probe(struct flash_bank_s *bank)
+static int tms470_auto_probe(struct flash_bank_s *bank)
 {
 	tms470_flash_bank_t *tms470_info = bank-&gt;driver_priv;
 
@@ -1070,7 +1070,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_erase_check(struct flash_bank_s *bank)
+static int tms470_erase_check(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	tms470_flash_bank_t *tms470_info = bank-&gt;driver_priv;
@@ -1161,7 +1161,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_protect_check(struct flash_bank_s *bank)
+static int tms470_protect_check(struct flash_bank_s *bank)
 {
 	target_t *target = bank-&gt;target;
 	tms470_flash_bank_t *tms470_info = bank-&gt;driver_priv;
@@ -1209,7 +1209,7 @@
 
 /* ---------------------------------------------------------------------- */
 
-int tms470_info(struct flash_bank_s *bank, char *buf, int buf_size)
+static int tms470_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	int used = 0;
 	tms470_flash_bank_t *tms470_info = bank-&gt;driver_priv;
@@ -1243,7 +1243,7 @@
  * [options...]
  */
 
-int tms470_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
+static int tms470_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	bank-&gt;driver_priv = malloc(sizeof(tms470_flash_bank_t));
 

Modified: trunk/src/helper/tclapi.c
===================================================================
--- trunk/src/helper/tclapi.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/helper/tclapi.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -455,7 +455,7 @@
 		fields[field_count++].in_handler_priv = NULL;
 	}
 
-	jtag_add_dr_scan(num_fields, fields, -1);
+	jtag_add_dr_scan(num_fields, fields, TAP_INVALID);
 	retval = jtag_execute_queue();
 	if (retval != ERROR_OK)
 	{

Modified: trunk/src/jtag/amt_jtagaccel.c
===================================================================
--- trunk/src/jtag/amt_jtagaccel.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/amt_jtagaccel.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -346,7 +346,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;end_state: %i&quot;, cmd-&gt;cmd.end_state-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
+				if (cmd-&gt;cmd.end_state-&gt;end_state != TAP_INVALID)
 					amt_jtagaccel_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
 				break;
 			case JTAG_RESET:
@@ -363,7 +363,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;runtest %i cycles, end in %i&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, cmd-&gt;cmd.runtest-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
+				if (cmd-&gt;cmd.runtest-&gt;end_state != TAP_INVALID)
 					amt_jtagaccel_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
 				amt_jtagaccel_runtest(cmd-&gt;cmd.runtest-&gt;num_cycles);
 				break;
@@ -371,7 +371,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;statemove end in %i&quot;, cmd-&gt;cmd.statemove-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
+				if (cmd-&gt;cmd.statemove-&gt;end_state != TAP_INVALID)
 					amt_jtagaccel_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
 				amt_jtagaccel_state_move();
 				break;
@@ -379,7 +379,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;scan end in %i&quot;, cmd-&gt;cmd.scan-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
+				if (cmd-&gt;cmd.scan-&gt;end_state != TAP_INVALID)
 					amt_jtagaccel_end_state(cmd-&gt;cmd.scan-&gt;end_state);
 				scan_size = jtag_build_buffer(cmd-&gt;cmd.scan, &amp;buffer);
 				type = jtag_scan_type(cmd-&gt;cmd.scan);

Modified: trunk/src/jtag/arm-jtag-ew.c
===================================================================
--- trunk/src/jtag/arm-jtag-ew.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/arm-jtag-ew.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -156,7 +156,7 @@
 			case JTAG_END_STATE:
 				DEBUG_JTAG_IO(&quot;end_state: %i&quot;, cmd-&gt;cmd.end_state-&gt;end_state);
 
-				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
+				if (cmd-&gt;cmd.end_state-&gt;end_state != TAP_INVALID)
 				{
 					armjtagew_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
 				}
@@ -166,7 +166,7 @@
 				DEBUG_JTAG_IO( &quot;runtest %i cycles, end in %i&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, \
 					cmd-&gt;cmd.runtest-&gt;end_state);
 
-				if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
+				if (cmd-&gt;cmd.runtest-&gt;end_state != TAP_INVALID)
 				{
 					armjtagew_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
 				}
@@ -176,7 +176,7 @@
 			case JTAG_STATEMOVE:
 				DEBUG_JTAG_IO(&quot;statemove end in %i&quot;, cmd-&gt;cmd.statemove-&gt;end_state);
 
-				if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
+				if (cmd-&gt;cmd.statemove-&gt;end_state != TAP_INVALID)
 				{
 					armjtagew_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
 				}
@@ -194,7 +194,7 @@
 			case JTAG_SCAN:
 				DEBUG_JTAG_IO(&quot;scan end in %i&quot;, cmd-&gt;cmd.scan-&gt;end_state);
 
-				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
+				if (cmd-&gt;cmd.scan-&gt;end_state != TAP_INVALID)
 				{
 					armjtagew_end_state(cmd-&gt;cmd.scan-&gt;end_state);
 				}

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/bitbang.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -278,7 +278,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;end_state: %s&quot;, tap_state_name(cmd-&gt;cmd.end_state-&gt;end_state) );
 #endif
-				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
+				if (cmd-&gt;cmd.end_state-&gt;end_state != TAP_INVALID)
 					bitbang_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
 				break;
 			case JTAG_RESET:
@@ -295,7 +295,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;runtest %i cycles, end in %s&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, tap_state_name(cmd-&gt;cmd.runtest-&gt;end_state) );
 #endif
-				if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
+				if (cmd-&gt;cmd.runtest-&gt;end_state != TAP_INVALID)
 					bitbang_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
 				bitbang_runtest(cmd-&gt;cmd.runtest-&gt;num_cycles);
 				break;
@@ -311,7 +311,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;statemove end in %s&quot;, tap_state_name(cmd-&gt;cmd.statemove-&gt;end_state));
 #endif
-				if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
+				if (cmd-&gt;cmd.statemove-&gt;end_state != TAP_INVALID)
 					bitbang_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
 				bitbang_state_move();
 				break;
@@ -326,7 +326,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;%s scan end in %s&quot;,  (cmd-&gt;cmd.scan-&gt;ir_scan) ? &quot;IR&quot; : &quot;DR&quot;, tap_state_name(cmd-&gt;cmd.scan-&gt;end_state) );
 #endif
-				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
+				if (cmd-&gt;cmd.scan-&gt;end_state != TAP_INVALID)
 					bitbang_end_state(cmd-&gt;cmd.scan-&gt;end_state);
 				scan_size = jtag_build_buffer(cmd-&gt;cmd.scan, &amp;buffer);
 				type = jtag_scan_type(cmd-&gt;cmd.scan);

Modified: trunk/src/jtag/bitq.c
===================================================================
--- trunk/src/jtag/bitq.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/bitq.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -153,7 +153,7 @@
 
 void bitq_end_state(tap_state_t state)
 {
-	if (state==-1)
+	if (state==TAP_INVALID)
 		return;
 
 	if (!tap_is_state_stable(state))

Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/ft2232.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -1308,7 +1308,7 @@
 		switch (cmd-&gt;type)
 		{
 		case JTAG_END_STATE:
-			if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
+			if (cmd-&gt;cmd.end_state-&gt;end_state != TAP_INVALID)
 				ft2232_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
 			break;
 
@@ -1341,9 +1341,9 @@
 			if (tap_get_state() != TAP_IDLE)
 				predicted_size += 3;
 			predicted_size += 3 * CEIL(cmd-&gt;cmd.runtest-&gt;num_cycles, 7);
-			if ( (cmd-&gt;cmd.runtest-&gt;end_state != -1) &amp;&amp; (cmd-&gt;cmd.runtest-&gt;end_state != TAP_IDLE) )
+			if ( (cmd-&gt;cmd.runtest-&gt;end_state != TAP_INVALID) &amp;&amp; (cmd-&gt;cmd.runtest-&gt;end_state != TAP_IDLE) )
 				predicted_size += 3;
-			if ( (cmd-&gt;cmd.runtest-&gt;end_state == -1) &amp;&amp; (tap_get_end_state() != TAP_IDLE) )
+			if ( (cmd-&gt;cmd.runtest-&gt;end_state == TAP_INVALID) &amp;&amp; (tap_get_end_state() != TAP_IDLE) )
 				predicted_size += 3;
 			if (ft2232_buffer_size + predicted_size + 1 &gt; FT2232_BUFFER_SIZE)
 			{
@@ -1379,7 +1379,7 @@
 				/* LOG_DEBUG(&quot;added TMS scan (no read)&quot;); */
 			}
 
-			if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
+			if (cmd-&gt;cmd.runtest-&gt;end_state != TAP_INVALID)
 				ft2232_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
 
 			if ( tap_get_state() != tap_get_end_state() )
@@ -1409,7 +1409,7 @@
 				require_send = 0;
 				first_unsent = cmd;
 			}
-			if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
+			if (cmd-&gt;cmd.statemove-&gt;end_state != TAP_INVALID)
 				ft2232_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
 
 			/* command &quot;Clock Data to TMS/CS Pin (no Read)&quot; */
@@ -1458,7 +1458,7 @@
 						retval = ERROR_JTAG_QUEUE_FAILED;
 
 				/* current command */
-				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
+				if (cmd-&gt;cmd.scan-&gt;end_state != TAP_INVALID)
 					ft2232_end_state(cmd-&gt;cmd.scan-&gt;end_state);
 				ft2232_large_scan(cmd-&gt;cmd.scan, type, buffer, scan_size);
 				require_send = 0;
@@ -1479,7 +1479,7 @@
 			}
 			ft2232_expect_read += ft2232_predict_scan_in(scan_size, type);
 			/* LOG_DEBUG(&quot;new read size: %i&quot;, ft2232_expect_read); */
-			if (cmd-&gt;cmd.scan-&gt;end_state != -1)
+			if (cmd-&gt;cmd.scan-&gt;end_state != TAP_INVALID)
 				ft2232_end_state(cmd-&gt;cmd.scan-&gt;end_state);
 			ft2232_add_scan(cmd-&gt;cmd.scan-&gt;ir_scan, type, buffer, scan_size);
 			require_send = 1;

Modified: trunk/src/jtag/gw16012.c
===================================================================
--- trunk/src/jtag/gw16012.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/gw16012.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -369,7 +369,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;end_state: %i&quot;, cmd-&gt;cmd.end_state-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
+				if (cmd-&gt;cmd.end_state-&gt;end_state != TAP_INVALID)
 					gw16012_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
 				break;
 			case JTAG_RESET:
@@ -386,7 +386,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;runtest %i cycles, end in %i&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, cmd-&gt;cmd.runtest-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
+				if (cmd-&gt;cmd.runtest-&gt;end_state != TAP_INVALID)
 					gw16012_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
 				gw16012_runtest(cmd-&gt;cmd.runtest-&gt;num_cycles);
 				break;
@@ -394,7 +394,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;statemove end in %i&quot;, cmd-&gt;cmd.statemove-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
+				if (cmd-&gt;cmd.statemove-&gt;end_state != TAP_INVALID)
 					gw16012_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
 				gw16012_state_move();
 				break;
@@ -405,7 +405,7 @@
 				gw16012_path_move(cmd-&gt;cmd.pathmove);
 				break;
 			case JTAG_SCAN:
-				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
+				if (cmd-&gt;cmd.scan-&gt;end_state != TAP_INVALID)
 					gw16012_end_state(cmd-&gt;cmd.scan-&gt;end_state);
 				scan_size = jtag_build_buffer(cmd-&gt;cmd.scan, &amp;buffer);
 				type = jtag_scan_type(cmd-&gt;cmd.scan);

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/jlink.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -154,7 +154,7 @@
 			case JTAG_END_STATE:
 				DEBUG_JTAG_IO(&quot;end_state: %i&quot;, cmd-&gt;cmd.end_state-&gt;end_state);
 
-				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
+				if (cmd-&gt;cmd.end_state-&gt;end_state != TAP_INVALID)
 				{
 					jlink_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
 				}
@@ -164,7 +164,7 @@
 				DEBUG_JTAG_IO( &quot;runtest %i cycles, end in %i&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, \
 					cmd-&gt;cmd.runtest-&gt;end_state);
 
-				if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
+				if (cmd-&gt;cmd.runtest-&gt;end_state != TAP_INVALID)
 				{
 					jlink_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
 				}
@@ -174,7 +174,7 @@
 			case JTAG_STATEMOVE:
 				DEBUG_JTAG_IO(&quot;statemove end in %i&quot;, cmd-&gt;cmd.statemove-&gt;end_state);
 
-				if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
+				if (cmd-&gt;cmd.statemove-&gt;end_state != TAP_INVALID)
 				{
 					jlink_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
 				}
@@ -192,7 +192,7 @@
 			case JTAG_SCAN:
 				DEBUG_JTAG_IO(&quot;scan end in %i&quot;, cmd-&gt;cmd.scan-&gt;end_state);
 
-				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
+				if (cmd-&gt;cmd.scan-&gt;end_state != TAP_INVALID)
 				{
 					jlink_end_state(cmd-&gt;cmd.scan-&gt;end_state);
 				}
@@ -525,7 +525,7 @@
 		if (result == len)
 		{
 			usb_in_buffer[result] = 0;
-			LOG_INFO(usb_in_buffer);
+			LOG_INFO((char *)usb_in_buffer);
 			return ERROR_OK;
 		}
 	}
@@ -858,8 +858,8 @@
 		return -1;
 	}
 
-	result = usb_bulk_write(jlink_jtag-&gt;usb_handle, JLINK_WRITE_ENDPOINT, \
-		usb_out_buffer, out_length, JLINK_USB_TIMEOUT);
+	result = usb_bulk_write(jlink_jtag-&gt;usb_handle, JLINK_WRITE_ENDPOINT,
+		(char *)usb_out_buffer, out_length, JLINK_USB_TIMEOUT);
 
 	DEBUG_JTAG_IO(&quot;jlink_usb_write, out_length = %d, result = %d&quot;, out_length, result);
 
@@ -872,8 +872,8 @@
 /* Read data from USB into in_buffer. */
 int jlink_usb_read(jlink_jtag_t *jlink_jtag)
 {
-	int result = usb_bulk_read(jlink_jtag-&gt;usb_handle, JLINK_READ_ENDPOINT, \
-		usb_in_buffer, JLINK_IN_BUFFER_SIZE, JLINK_USB_TIMEOUT);
+	int result = usb_bulk_read(jlink_jtag-&gt;usb_handle, JLINK_READ_ENDPOINT,
+		(char *)usb_in_buffer, JLINK_IN_BUFFER_SIZE, JLINK_USB_TIMEOUT);
 
 	DEBUG_JTAG_IO(&quot;jlink_usb_read, result = %d&quot;, result);
 
@@ -886,8 +886,9 @@
 /* Read the result from the previous EMU cmd into result_buffer. */
 int jlink_usb_read_emu_result(jlink_jtag_t *jlink_jtag)
 {
-	int result = usb_bulk_read(jlink_jtag-&gt;usb_handle, JLINK_READ_ENDPOINT, \
-		usb_emu_result_buffer, JLINK_EMU_RESULT_BUFFER_SIZE, JLINK_USB_TIMEOUT);
+	int result = usb_bulk_read(jlink_jtag-&gt;usb_handle, JLINK_READ_ENDPOINT,
+		(char *)usb_emu_result_buffer, JLINK_EMU_RESULT_BUFFER_SIZE,
+		JLINK_USB_TIMEOUT);
 
 	DEBUG_JTAG_IO(&quot;jlink_usb_read_result, result = %d&quot;, result);
 

Modified: trunk/src/jtag/jtag.c
===================================================================
--- trunk/src/jtag/jtag.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/jtag.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -510,7 +510,7 @@
 {
 	jtag_prelude1();
 
-	if (state != -1)
+	if (state != TAP_INVALID)
 		jtag_add_end_state(state);
 
 	cmd_queue_cur_state = cmd_queue_end_state;
@@ -2717,7 +2717,7 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	jtag_add_runtest(strtol(args[0], NULL, 0), -1);
+	jtag_add_runtest(strtol(args[0], NULL, 0), TAP_INVALID);
 	jtag_execute_queue();
 
 	return ERROR_OK;
@@ -2740,7 +2740,7 @@
 	/*          &quot;statename&quot; */
 	/* at the end of the arguments. */
 	/* assume none. */
-	endstate = -1;
+	endstate = TAP_INVALID;
 	if( argc &gt;= 4 ){
 		/* have at least one pair of numbers. */
 		/* is last pair the magic text? */
@@ -2748,13 +2748,13 @@
 			const char *cpA;
 			const char *cpS;
 			cpA = args[ argc-1 ];
-			for( endstate = 0 ; endstate &lt; 16 ; endstate++ ){
+			for( endstate = 0 ; endstate &lt; TAP_NUM_STATES ; endstate++ ){
 				cpS = tap_state_name( endstate );
 				if( 0 == strcmp( cpA, cpS ) ){
 					break;
 				}
 			}
-			if( endstate &gt;= 16 ){
+			if( endstate &gt;= TAP_NUM_STATES ){
 				return ERROR_COMMAND_SYNTAX_ERROR;
 			} else {
 				/* found - remove the last 2 args */
@@ -2784,11 +2784,11 @@
 		fields[i].in_handler_priv = NULL;
 	}
 
-	jtag_add_ir_scan(argc / 2, fields, -1);
+	jtag_add_ir_scan(argc / 2, fields, TAP_INVALID);
 	/* did we have an endstate? */
-	if( endstate &gt;= 0 ){
+	if (endstate != TAP_INVALID)
 		jtag_add_end_state(endstate);
-	}
+
 	jtag_execute_queue();
 
 	for (i = 0; i &lt; argc / 2; i++)
@@ -2825,7 +2825,7 @@
 	}
 
 	/* assume no endstate */
-	endstate = -1;
+	endstate = TAP_INVALID;
 	/* validate arguments as numbers */
 	e = JIM_OK;
 	for (i = 2; i &lt; argc; i+=2)
@@ -2901,11 +2901,11 @@
 		fields[field_count++].in_handler_priv = NULL;
 	}
 
-	jtag_add_dr_scan(num_fields, fields, -1);
+	jtag_add_dr_scan(num_fields, fields, TAP_INVALID);
 	/* did we get an end state? */
-	if( endstate &gt;= 0 ){
-		jtag_add_end_state( (tap_state_t)endstate );
-	}
+	if (endstate != TAP_INVALID)
+		jtag_add_end_state(endstate);
+
 	retval = jtag_execute_queue();
 	if (retval != ERROR_OK)
 	{
@@ -3089,7 +3089,7 @@
 	 *
 	 * DRSHIFT-&gt;DRSHIFT and IRSHIFT-&gt;IRSHIFT have to be caught in interface specific code
 	 */
-	const static u8 tms_seqs[6][6] =
+	static const u8 tms_seqs[6][6] =
 	{
 		/* value clocked to TMS to move from one of six stable states to another */
 
@@ -3273,14 +3273,14 @@
 {
 	int x;
 
-	for( x = 0 ; x &lt; 16 ; x++ ){
+	for( x = 0 ; x &lt; TAP_NUM_STATES ; x++ ){
 		/* be nice to the human */
 		if( 0 == strcasecmp( name, tap_state_name(x) ) ){
 			return x;
 		}
 	}
 	/* not found */
-	return -1;
+	return TAP_INVALID;
 }
 
 /*-----&lt;/Cable Helper API&gt;--------------------------------------*/

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/jtag.h	2009-04-18 10:08:13 UTC (rev 1462)
@@ -46,7 +46,9 @@
 	TAP_DRSELECT = 1, TAP_DRCAPTURE = 2, TAP_DRSHIFT = 3, TAP_DREXIT1 = 4,
 	TAP_DRPAUSE  = 5, TAP_DREXIT2 = 6, TAP_DRUPDATE = 7,
 	TAP_IRSELECT = 9, TAP_IRCAPTURE = 10, TAP_IRSHIFT = 11, TAP_IREXIT1 = 12,
-	TAP_IRPAUSE  = 13, TAP_IREXIT2 = 14, TAP_IRUPDATE = 15
+	TAP_IRPAUSE  = 13, TAP_IREXIT2 = 14, TAP_IRUPDATE = 15,
+
+	TAP_NUM_STATES = 16, TAP_INVALID = -1,
 };
 
 typedef enum tap_state tap_state_t;
@@ -643,7 +645,7 @@
 
 /* jtag_add_dr_out() is a faster version of jtag_add_dr_scan()
  *
- * Current or end_state can not be TAP_RESET. end_state can be -1
+ * Current or end_state can not be TAP_RESET. end_state can be TAP_INVALID
  *
  * num_bits[i] is the number of bits to clock out from value[i] LSB first.
  *
@@ -666,7 +668,7 @@
 static __inline__ void jtag_add_dr_out(jtag_tap_t* tap, int num_fields, const int* num_bits, const u32* value,
 		tap_state_t end_state)
 {
-	if (end_state != -1)
+	if (end_state != TAP_INVALID)
 		cmd_queue_end_state = end_state;
 	cmd_queue_cur_state = cmd_queue_end_state;
 	interface_jtag_add_dr_out(tap, num_fields, num_bits, value, cmd_queue_end_state);

Modified: trunk/src/jtag/usbprog.c
===================================================================
--- trunk/src/jtag/usbprog.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/usbprog.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -142,7 +142,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;end_state: %i&quot;, cmd-&gt;cmd.end_state-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
+				if (cmd-&gt;cmd.end_state-&gt;end_state != TAP_INVALID)
 					usbprog_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
 				break;
 			case JTAG_RESET:
@@ -159,7 +159,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;runtest %i cycles, end in %i&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, cmd-&gt;cmd.runtest-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
+				if (cmd-&gt;cmd.runtest-&gt;end_state != TAP_INVALID)
 					usbprog_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
 				usbprog_runtest(cmd-&gt;cmd.runtest-&gt;num_cycles);
 				break;
@@ -167,7 +167,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;statemove end in %i&quot;, cmd-&gt;cmd.statemove-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
+				if (cmd-&gt;cmd.statemove-&gt;end_state != TAP_INVALID)
 					usbprog_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
 				usbprog_state_move();
 				break;
@@ -182,7 +182,7 @@
 #ifdef _DEBUG_JTAG_IO_
 				LOG_DEBUG(&quot;scan end in %i&quot;, cmd-&gt;cmd.scan-&gt;end_state);
 #endif
-				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
+				if (cmd-&gt;cmd.scan-&gt;end_state != TAP_INVALID)
 					usbprog_end_state(cmd-&gt;cmd.scan-&gt;end_state);
 				scan_size = jtag_build_buffer(cmd-&gt;cmd.scan, &amp;buffer);
 				type = jtag_scan_type(cmd-&gt;cmd.scan);

Modified: trunk/src/jtag/vsllink.c
===================================================================
--- trunk/src/jtag/vsllink.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/jtag/vsllink.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -269,7 +269,7 @@
 			case JTAG_END_STATE:
 				DEBUG_JTAG_IO(&quot;end_state: %s&quot;, tap_state_name(cmd-&gt;cmd.end_state-&gt;end_state));
 
-				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
+				if (cmd-&gt;cmd.end_state-&gt;end_state != TAP_INVALID)
 				{
 					vsllink_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
 				}
@@ -279,7 +279,7 @@
 				DEBUG_JTAG_IO( &quot;runtest %i cycles, end in %s&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, \
 					tap_state_name(cmd-&gt;cmd.runtest-&gt;end_state));
 
-				if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
+				if (cmd-&gt;cmd.runtest-&gt;end_state != TAP_INVALID)
 				{
 					vsllink_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
 				}
@@ -289,7 +289,7 @@
 			case JTAG_STATEMOVE:
 				DEBUG_JTAG_IO(&quot;statemove end in %s&quot;, tap_state_name(cmd-&gt;cmd.statemove-&gt;end_state));
 
-				if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
+				if (cmd-&gt;cmd.statemove-&gt;end_state != TAP_INVALID)
 				{
 					vsllink_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
 				}
@@ -305,7 +305,7 @@
 				break;
 
 			case JTAG_SCAN:
-				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
+				if (cmd-&gt;cmd.scan-&gt;end_state != TAP_INVALID)
 				{
 					vsllink_end_state(cmd-&gt;cmd.scan-&gt;end_state);
 				}

Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/arm11.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -383,9 +383,9 @@
 
 	if (R(DSCR) &amp; ARM11_DSCR_WDTR_FULL)
 	{
-	arm11_add_debug_SCAN_N(arm11, 0x05, -1);
+	arm11_add_debug_SCAN_N(arm11, 0x05, TAP_INVALID);
 
-	arm11_add_IR(arm11, ARM11_INTEST, -1);
+	arm11_add_IR(arm11, ARM11_INTEST, TAP_INVALID);
 
 	scan_field_t	chain5_fields[3];
 
@@ -614,9 +614,9 @@
 
 	if (R(DSCR) &amp; ARM11_DSCR_RDTR_FULL || arm11-&gt;reg_list[ARM11_RC_RDTR].dirty)
 	{
-	arm11_add_debug_SCAN_N(arm11, 0x05, -1);
+	arm11_add_debug_SCAN_N(arm11, 0x05, TAP_INVALID);
 
-	arm11_add_IR(arm11, ARM11_EXTEST, -1);
+	arm11_add_IR(arm11, ARM11_EXTEST, TAP_INVALID);
 
 	scan_field_t	chain5_fields[3];
 
@@ -1565,7 +1565,7 @@
 
 	/* check IDCODE */
 
-	arm11_add_IR(arm11, ARM11_IDCODE, -1);
+	arm11_add_IR(arm11, ARM11_IDCODE, TAP_INVALID);
 
 	scan_field_t		idcode_field;
 
@@ -1575,9 +1575,9 @@
 
 	/* check DIDR */
 
-	arm11_add_debug_SCAN_N(arm11, 0x00, -1);
+	arm11_add_debug_SCAN_N(arm11, 0x00, TAP_INVALID);
 
-	arm11_add_IR(arm11, ARM11_INTEST, -1);
+	arm11_add_IR(arm11, ARM11_INTEST, TAP_INVALID);
 
 	scan_field_t		chain0_fields[2];
 

Modified: trunk/src/target/arm11_dbgtap.c
===================================================================
--- trunk/src/target/arm11_dbgtap.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/arm11_dbgtap.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -95,7 +95,7 @@
  *
  * \param arm11 Target state variable.
  * \param instr An ARM11 DBGTAP instruction. Use enum #arm11_instructions.
- * \param state Pass the final TAP state or -1 for the default value (Pause-IR).
+ * \param state Pass the final TAP state or TAP_INVALID for the default value (Pause-IR).
  *
  * \remarks This adds to the JTAG command queue but does \em not execute it.
  */
@@ -120,7 +120,7 @@
 
     arm11_setup_field(arm11, 5, &amp;instr, NULL, &amp;field);
 
-    arm11_add_ir_scan_vc(1, &amp;field, state == -1 ? TAP_IRPAUSE : state);
+    arm11_add_ir_scan_vc(1, &amp;field, state == TAP_INVALID ? TAP_IRPAUSE : state);
 }
 
 /** Verify shifted out data from Scan Chain Register (SCREG)
@@ -152,7 +152,7 @@
  *
  * \param arm11	    Target state variable.
  * \param chain	    Scan chain that will be selected.
- * \param state	    Pass the final TAP state or -1 for the default
+ * \param state	    Pass the final TAP state or TAP_INVALID for the default
  *		    value (Pause-DR).
  *
  * The chain takes effect when Update-DR is passed (usually when subsequently
@@ -171,7 +171,7 @@
 {
     JTAG_DEBUG(&quot;SCREG &lt;= 0x%02x&quot;, chain);
 
-    arm11_add_IR(arm11, ARM11_SCAN_N, -1);
+    arm11_add_IR(arm11, ARM11_SCAN_N, TAP_INVALID);
 
     scan_field_t		field;
 
@@ -179,7 +179,7 @@
 
     field.in_handler = arm11_in_handler_SCAN_N;
 
-    arm11_add_dr_scan_vc(1, &amp;field, state == -1 ? TAP_DRPAUSE : state);
+    arm11_add_dr_scan_vc(1, &amp;field, state == TAP_INVALID ? TAP_DRPAUSE : state);
 }
 
 /** Write an instruction into the ITR register
@@ -188,7 +188,7 @@
  * \param inst	An ARM11 processor instruction/opcode.
  * \param flag	Optional parameter to retrieve the InstCompl flag
  *		(this will be written when the JTAG chain is executed).
- * \param state	Pass the final TAP state or -1 for the default
+ * \param state	Pass the final TAP state or TAP_INVALID for the default
  *		value (Run-Test/Idle).
  *
  * \remarks By default this ends with Run-Test/Idle state
@@ -208,7 +208,7 @@
     arm11_setup_field(arm11, 32,    &amp;inst,	NULL, itr + 0);
     arm11_setup_field(arm11, 1,	    NULL,	flag, itr + 1);
 
-    arm11_add_dr_scan_vc(asizeof(itr), itr, state == -1 ? TAP_IDLE : state);
+    arm11_add_dr_scan_vc(asizeof(itr), itr, state == TAP_INVALID ? TAP_IDLE : state);
 }
 
 /** Read the Debug Status and Control Register (DSCR)
@@ -222,9 +222,9 @@
  */
 u32 arm11_read_DSCR(arm11_common_t * arm11)
 {
-    arm11_add_debug_SCAN_N(arm11, 0x01, -1);
+    arm11_add_debug_SCAN_N(arm11, 0x01, TAP_INVALID);
 
-    arm11_add_IR(arm11, ARM11_INTEST, -1);
+    arm11_add_IR(arm11, ARM11_INTEST, TAP_INVALID);
 
     u32			dscr;
     scan_field_t	chain1_field;
@@ -254,9 +254,9 @@
  */
 void arm11_write_DSCR(arm11_common_t * arm11, u32 dscr)
 {
-    arm11_add_debug_SCAN_N(arm11, 0x01, -1);
+    arm11_add_debug_SCAN_N(arm11, 0x01, TAP_INVALID);
 
-    arm11_add_IR(arm11, ARM11_EXTEST, -1);
+    arm11_add_IR(arm11, ARM11_EXTEST, TAP_INVALID);
 
     scan_field_t		    chain1_field;
 
@@ -331,7 +331,7 @@
  */
 void arm11_run_instr_data_prepare(arm11_common_t * arm11)
 {
-    arm11_add_debug_SCAN_N(arm11, 0x05, -1);
+    arm11_add_debug_SCAN_N(arm11, 0x05, TAP_INVALID);
 }
 
 /** Cleanup after ITR/DTR operations
@@ -350,7 +350,7 @@
  */
 void arm11_run_instr_data_finish(arm11_common_t * arm11)
 {
-    arm11_add_debug_SCAN_N(arm11, 0x00, -1);
+    arm11_add_debug_SCAN_N(arm11, 0x00, TAP_INVALID);
 }
 
 
@@ -365,7 +365,7 @@
  */
 void arm11_run_instr_no_data(arm11_common_t * arm11, u32 * opcode, size_t count)
 {
-    arm11_add_IR(arm11, ARM11_ITRSEL, -1);
+    arm11_add_IR(arm11, ARM11_ITRSEL, TAP_INVALID);
 
     while (count--)
     {
@@ -414,11 +414,11 @@
  */
 void arm11_run_instr_data_to_core(arm11_common_t * arm11, u32 opcode, u32 * data, size_t count)
 {
-    arm11_add_IR(arm11, ARM11_ITRSEL, -1);
+    arm11_add_IR(arm11, ARM11_ITRSEL, TAP_INVALID);
 
     arm11_add_debug_INST(arm11, opcode, NULL, TAP_DRPAUSE);
 
-    arm11_add_IR(arm11, ARM11_EXTEST, -1);
+    arm11_add_IR(arm11, ARM11_EXTEST, TAP_INVALID);
 
     scan_field_t	chain5_fields[3];
 
@@ -446,7 +446,7 @@
 	data++;
     }
 
-    arm11_add_IR(arm11, ARM11_INTEST, -1);
+    arm11_add_IR(arm11, ARM11_INTEST, TAP_INVALID);
 
     do
     {
@@ -495,11 +495,11 @@
  */
 void arm11_run_instr_data_to_core_noack(arm11_common_t * arm11, u32 opcode, u32 * data, size_t count)
 {
-    arm11_add_IR(arm11, ARM11_ITRSEL, -1);
+    arm11_add_IR(arm11, ARM11_ITRSEL, TAP_INVALID);
 
     arm11_add_debug_INST(arm11, opcode, NULL, TAP_DRPAUSE);
 
-    arm11_add_IR(arm11, ARM11_EXTEST, -1);
+    arm11_add_IR(arm11, ARM11_EXTEST, TAP_INVALID);
 
     scan_field_t	chain5_fields[3];
 
@@ -527,7 +527,7 @@
 	}
     }
 
-    arm11_add_IR(arm11, ARM11_INTEST, -1);
+    arm11_add_IR(arm11, ARM11_INTEST, TAP_INVALID);
 
     chain5_fields[0].out_value	= 0;
     chain5_fields[1].in_value   = ReadyPos++;
@@ -584,11 +584,11 @@
  */
 void arm11_run_instr_data_from_core(arm11_common_t * arm11, u32 opcode, u32 * data, size_t count)
 {
-    arm11_add_IR(arm11, ARM11_ITRSEL, -1);
+    arm11_add_IR(arm11, ARM11_ITRSEL, TAP_INVALID);
 
     arm11_add_debug_INST(arm11, opcode, NULL, TAP_IDLE);
 
-    arm11_add_IR(arm11, ARM11_INTEST, -1);
+    arm11_add_IR(arm11, ARM11_INTEST, TAP_INVALID);
 
     scan_field_t	chain5_fields[3];
 
@@ -666,9 +666,9 @@
  */
 void arm11_sc7_run(arm11_common_t * arm11, arm11_sc7_action_t * actions, size_t count)
 {
-    arm11_add_debug_SCAN_N(arm11, 0x07, -1);
+    arm11_add_debug_SCAN_N(arm11, 0x07, TAP_INVALID);
 
-    arm11_add_IR(arm11, ARM11_EXTEST, -1);
+    arm11_add_IR(arm11, ARM11_EXTEST, TAP_INVALID);
 
     scan_field_t	chain7_fields[3];
 

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/arm720t.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -136,10 +136,10 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-	jtag_add_dr_scan(2, fields, -1);
+	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	if (clock)
-		jtag_add_runtest(0, -1);
+		jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	if((retval = jtag_execute_queue()) != ERROR_OK)

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/arm7tdmi.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -169,9 +169,9 @@
 			2,
 			arm7tdmi_num_bits,
 			values,
-			-1);
+			TAP_INVALID);
 
-	jtag_add_runtest(0, -1);
+	jtag_add_runtest(0, TAP_INVALID);
 
 	return ERROR_OK;
 }
@@ -219,9 +219,9 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-	jtag_add_dr_scan(2, fields, -1);
+	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
-	jtag_add_runtest(0, -1);
+	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 {
@@ -291,9 +291,9 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-	jtag_add_dr_scan(2, fields, -1);
+	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
-	jtag_add_runtest(0, -1);
+	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 {

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/arm920t.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -150,12 +150,12 @@
 	fields[3].in_handler = NULL;
 	fields[3].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(4, fields, -1);
+	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 	fields[1].in_handler_priv = value;
 	fields[1].in_handler = arm_jtag_buf_to_u32;
 
-	jtag_add_dr_scan(4, fields, -1);
+	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	jtag_execute_queue();
@@ -222,7 +222,7 @@
 	fields[3].in_handler = NULL;
 	fields[3].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(4, fields, -1);
+	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	LOG_DEBUG(&quot;addr: 0x%x value: %8.8x&quot;, reg_addr, value);
@@ -289,7 +289,7 @@
 	fields[3].in_handler = NULL;
 	fields[3].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(4, fields, -1);
+	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 	arm9tdmi_clock_out(jtag_info, arm_opcode, 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/arm926ejs.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -178,7 +178,7 @@
 	fields[3].in_handler = NULL;
 	fields[3].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(4, fields, -1);
+	jtag_add_dr_scan(4, fields, TAP_INVALID);
 
 	fields[0].in_handler_priv = value;
 	fields[0].in_handler = arm_jtag_buf_to_u32;
@@ -189,7 +189,7 @@
 		/* rescan with NOP, to wait for the access to complete */
 		access = 0;
 		nr_w_buf = 0;
-		jtag_add_dr_scan(4, fields, -1);
+		jtag_add_dr_scan(4, fields, TAP_INVALID);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;
@@ -268,14 +268,14 @@
 	fields[3].in_handler = NULL;
 	fields[3].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(4, fields, -1);
+	jtag_add_dr_scan(4, fields, TAP_INVALID);
 	/*TODO: add timeout*/
 	do
 	{
 		/* rescan with NOP, to wait for the access to complete */
 		access = 0;
 		nr_w_buf = 0;
-		jtag_add_dr_scan(4, fields, -1);
+		jtag_add_dr_scan(4, fields, TAP_INVALID);
 		if((retval = jtag_execute_queue()) != ERROR_OK)
 		{
 			return retval;

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/arm966e.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -214,12 +214,12 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_handler_priv = value;
 	fields[0].in_handler = arm_jtag_buf_to_u32;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	if((retval = jtag_execute_queue()) != ERROR_OK)
@@ -282,7 +282,7 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	LOG_DEBUG(&quot;addr: 0x%x value: %8.8x&quot;, reg_addr, value);

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/arm9tdmi.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -253,9 +253,9 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	jtag_add_runtest(0, -1);
+	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
@@ -320,9 +320,9 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	jtag_add_runtest(0, -1);
+	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{
@@ -403,9 +403,9 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	jtag_add_runtest(0, -1);
+	jtag_add_runtest(0, TAP_INVALID);
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	{

Modified: trunk/src/target/arm_jtag.c
===================================================================
--- trunk/src/target/arm_jtag.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/arm_jtag.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -58,7 +58,7 @@
 		field.in_check_mask = NULL;
 		field.in_handler = handler;
 		field.in_handler_priv = NULL;
-		jtag_add_ir_scan(1, &amp;field, -1);
+		jtag_add_ir_scan(1, &amp;field, TAP_INVALID);
 	}
 
 	return ERROR_OK;
@@ -84,7 +84,7 @@
 				1,
 				num_bits,
 				values,
-				-1);
+				TAP_INVALID);
 
 		jtag_info-&gt;cur_scan_chain = new_scan_chain;
 	}

Modified: trunk/src/target/cortex_swjdp.c
===================================================================
--- trunk/src/target/cortex_swjdp.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/cortex_swjdp.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -91,7 +91,7 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-	jtag_add_dr_scan(2, fields, -1);
+	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	return ERROR_OK;
 }
@@ -136,7 +136,7 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-	jtag_add_dr_scan(2, fields, -1);
+	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	return ERROR_OK;
 }

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/embeddedice.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -283,7 +283,7 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_value = reg-&gt;value;
 	jtag_set_check_value(fields+0, check_value, check_mask, NULL);
@@ -294,7 +294,7 @@
 	 */
 	buf_set_u32(fields[1].out_value, 0, 5, embeddedice_reg_arch_info[EICE_COMMS_CTRL]);
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	return ERROR_OK;
 }
@@ -345,7 +345,7 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	while (size &gt; 0)
 	{
@@ -357,7 +357,7 @@
 
 		fields[0].in_handler = arm_jtag_buf_to_u32;
 		fields[0].in_handler_priv = data;
-		jtag_add_dr_scan(3, fields, -1);
+		jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 		data++;
 		size--;
@@ -465,7 +465,7 @@
 	while (size &gt; 0)
 	{
 		buf_set_u32(fields[0].out_value, 0, 32, *data);
-		jtag_add_dr_scan(3, fields, -1);
+		jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 		data++;
 		size--;
@@ -531,11 +531,11 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 	gettimeofday(&amp;lap, NULL);
 	do
 	{
-		jtag_add_dr_scan(3, fields, -1);
+		jtag_add_dr_scan(3, fields, TAP_INVALID);
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
 			return retval;
 

Modified: trunk/src/target/embeddedice.h
===================================================================
--- trunk/src/target/embeddedice.h	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/embeddedice.h	2009-04-18 10:08:13 UTC (rev 1462)
@@ -124,7 +124,7 @@
 			3,
 			embeddedice_num_bits,
 			values,
-			-1);
+			TAP_INVALID);
 }
 
 void embeddedice_write_dcc(jtag_tap_t *tap, int reg_addr, u8 *buffer, int little, int count);

Modified: trunk/src/target/etb.c
===================================================================
--- trunk/src/target/etb.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/etb.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -82,7 +82,7 @@
 		field.in_handler = NULL;
 		field.in_handler_priv = NULL;
 
-		jtag_add_ir_scan(1, &amp;field, -1);
+		jtag_add_ir_scan(1, &amp;field, TAP_INVALID);
 
 		free(field.out_value);
 	}
@@ -109,7 +109,7 @@
 
 		/* select INTEST instruction */
 		etb_set_instr(etb, 0x2);
-		jtag_add_dr_scan(1, &amp;field, -1);
+		jtag_add_dr_scan(1, &amp;field, TAP_INVALID);
 
 		etb-&gt;cur_scan_chain = new_scan_chain;
 
@@ -220,7 +220,7 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_handler = buf_to_u32_handler;
 
@@ -236,7 +236,7 @@
 			buf_set_u32(fields[1].out_value, 0, 7, 0);
 
 		fields[0].in_handler_priv = &amp;data[i];
-		jtag_add_dr_scan(3, fields, -1);
+		jtag_add_dr_scan(3, fields, TAP_INVALID);
 	}
 
 	jtag_execute_queue();
@@ -291,7 +291,7 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	/* read the identification register in the second run, to make sure we
 	 * don't read the ETB data register twice, skipping every second entry
@@ -301,7 +301,7 @@
 
 	jtag_set_check_value(fields+0, check_value, check_mask, NULL);
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	free(fields[1].out_value);
 	free(fields[2].out_value);
@@ -388,7 +388,7 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	free(fields[0].out_value);
 	free(fields[1].out_value);

Modified: trunk/src/target/etm.c
===================================================================
--- trunk/src/target/etm.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/etm.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -371,12 +371,12 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	fields[0].in_value = reg-&gt;value;
 	jtag_set_check_value(fields+0, check_value, check_mask, NULL);
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	free(fields[1].out_value);
 	free(fields[2].out_value);
@@ -463,7 +463,7 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	free(fields[0].out_value);
 	free(fields[1].out_value);
@@ -883,7 +883,7 @@
 				continue;
 
 			/* indirect branch to the exception vector means an exception occured */
-			if (((ctx-&gt;last_branch &gt;= 0x0) &amp;&amp; (ctx-&gt;last_branch &lt;= 0x20))
+			if ((ctx-&gt;last_branch &lt;= 0x20)
 				|| ((ctx-&gt;last_branch &gt;= 0xffff0000) &amp;&amp; (ctx-&gt;last_branch &lt;= 0xffff0020)))
 			{
 				if ((ctx-&gt;last_branch &amp; 0xff) == 0x10)

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/feroceon.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -162,9 +162,9 @@
 	fields[2].in_handler = NULL;
 	fields[2].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
-	/* no jtag_add_runtest(0, -1) here */
+	/* no jtag_add_runtest(0, TAP_INVALID) here */
 
 	return ERROR_OK;
 }

Modified: trunk/src/target/mips_ejtag.c
===================================================================
--- trunk/src/target/mips_ejtag.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/mips_ejtag.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -55,7 +55,7 @@
 		field.in_check_mask = NULL;
 		field.in_handler = handler;
 		field.in_handler_priv = NULL;
-		jtag_add_ir_scan(1, &amp;field, -1);
+		jtag_add_ir_scan(1, &amp;field, TAP_INVALID);
 	}
 
 	return ERROR_OK;
@@ -78,7 +78,7 @@
 	field.in_check_mask = NULL;
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
-	jtag_add_dr_scan(1, &amp;field, -1);
+	jtag_add_dr_scan(1, &amp;field, TAP_INVALID);
 
 	if (jtag_execute_queue() != ERROR_OK)
 	{
@@ -105,7 +105,7 @@
 	field.in_check_mask = NULL;
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
-	jtag_add_dr_scan(1, &amp;field, -1);
+	jtag_add_dr_scan(1, &amp;field, TAP_INVALID);
 
 	if (jtag_execute_queue() != ERROR_OK)
 	{
@@ -136,7 +136,7 @@
 	field.in_check_mask = NULL;
 	field.in_handler = NULL;
 	field.in_handler_priv = NULL;
-	jtag_add_dr_scan(1, &amp;field, -1);
+	jtag_add_dr_scan(1, &amp;field, TAP_INVALID);
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-04-15 15:44:26 UTC (rev 1461)
+++ trunk/src/target/xscale.c	2009-04-18 10:08:13 UTC (rev 1462)
@@ -229,7 +229,7 @@
 		field.in_value = NULL;
 		jtag_set_check_value(&amp;field, tap-&gt;expected, tap-&gt;expected_mask, NULL);
 
-		jtag_add_ir_scan(1, &amp;field, -1);
+		jtag_add_ir_scan(1, &amp;field, TAP_INVALID);
 
 		free(field.out_value);
 	}
@@ -282,7 +282,7 @@
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &amp;field2_check_value, &amp;field2_check_mask, NULL);
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -302,7 +302,7 @@
 
 	jtag_add_end_state(TAP_IDLE);
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	/* DANGER!!! this must be here. It will make sure that the arguments
 	 * to jtag_set_check_value() does not go out of scope! */
@@ -362,7 +362,7 @@
 
 	jtag_add_end_state(TAP_IDLE);
 	xscale_jtag_set_instr(xscale-&gt;jtag_info.tap, xscale-&gt;jtag_info.dbgtx);
-	jtag_add_runtest(1, -1); /* ensures that we're in the TAP_IDLE state as the above could be a no-op */
+	jtag_add_runtest(1, TAP_INVALID); /* ensures that we're in the TAP_IDLE state as the above could be a no-op */
 
 	/* repeat until all words have been collected */
 	int attempts=0;
@@ -750,7 +750,7 @@
 	fields[2].in_value = NULL;
 	jtag_set_check_value(fields+2, &amp;field2_check_value, &amp;field2_check_mask, NULL);
 
-	jtag_add_dr_scan(3, fields, -1);
+	jtag_add_dr_scan(3, fields, TAP_INVALID);
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
 	{
@@ -822,7 +822,7 @@
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(2, fields, -1);
+	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	fields[0].num_bits = 32;
 	fields[0].out_value = packet;
@@ -834,7 +834,7 @@
 	{
 		buf_set_u32(packet, 0, 32, buffer[word]);
 		cmd = parity(*((u32*)packet));
-		jtag_add_dr_scan(2, fields, -1);
+		jtag_add_dr_scan(2, fields, TAP_INVALID);
 	}
 
 	jtag_execute_queue();
@@ -880,7 +880,7 @@
 	fields[1].in_handler = NULL;
 	fields[1].in_handler_priv = NULL;
 
-	jtag_add_dr_scan(2, fields, -1);
+	jtag_add_dr_scan(2, fields, TAP_INVALID);
 
 	return ERROR_OK;
 }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000245.html">[Openocd-svn] r1461 - trunk/src/target/target
</A></li>
	<LI>Next message: <A HREF="000247.html">[Openocd-svn] r1463 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#246">[ date ]</a>
              <a href="thread.html#246">[ thread ]</a>
              <a href="subject.html#246">[ subject ]</a>
              <a href="author.html#246">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
