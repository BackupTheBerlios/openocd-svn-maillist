<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-719-ga727418
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2011-January/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.4.0-719-ga727418&In-Reply-To=%3CE1PfSfK-0001GQ-ME%40sfp-scmshell-2.v30.ch3.sourceforge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002498.html">
   <LINK REL="Next"  HREF="002500.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-719-ga727418</H1>
    <B>&#216;yvind Harboe</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.4.0-719-ga727418&In-Reply-To=%3CE1PfSfK-0001GQ-ME%40sfp-scmshell-2.v30.ch3.sourceforge.com%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-719-ga727418">gowinex at users.sourceforge.net
       </A><BR>
    <I>Wed Jan 19 08:41:13 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002498.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-718-g4749a40
</A></li>
        <LI>Next message: <A HREF="002500.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-720-g5b34018
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2499">[ date ]</a>
              <a href="thread.html#2499">[ thread ]</a>
              <a href="subject.html#2499">[ subject ]</a>
              <a href="author.html#2499">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  a72741818431d693e48b0f016258be0fec1f79da (commit)
      from  4749a40821de2dcc88cc02d3b3ab5a5418e02c2e (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit a72741818431d693e48b0f016258be0fec1f79da
Author: Eric Wetzel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">thewetzel at gmail.com</A>&gt;
Date:   Tue Jan 18 11:17:22 2011 -0500

    stellaris: automatically generate and update device IDs
    
    Added a Perl script to contrib that uses the header files in StellarisWare complete Firmware Development Package provided by TI/Luminary to generate a new list of device IDs
    
    Used Perl script and revision 6734 of TI/Luminary StellarisWare to update device IDs

diff --git a/contrib/gen-stellaris-part-header.pl b/contrib/gen-stellaris-part-header.pl
new file mode 100755
index 0000000..24ddcb1
--- /dev/null
+++ b/contrib/gen-stellaris-part-header.pl
@@ -0,0 +1,91 @@
+#!/usr/bin/perl
+# Automatically generates the StellarisParts struct in src/flash/nor/stellaris.c
+# Uses the header files from TI/Luminary's StellarisWare complete Firmware Development Package
+# available from: <A HREF="http://www.luminarymicro.com/products/software_updates.html">http://www.luminarymicro.com/products/software_updates.html</A>
+
+$comment = &quot;// Autogenerated by contrib/gen-stellaris-part-header.pl
+// From Stellaris Firmware Development Package revision&quot;;
+
+$struct_header = &quot;static struct {
+	uint32_t partno;
+	const char *partname;
+}	StellarisParts[] =
+{
+&quot;;
+
+$struct_footer = &quot;\t{0,\&quot;Unknown part\&quot;}\n};\n&quot;;
+
+$#ARGV == 1 || die &quot;Usage: $0 &lt;inc directory&gt; &lt;output file&gt;\n&quot;;
+-d $ARGV[0] || die $ARGV[0].&quot; is not a directory\n&quot;;
+$dir = $ARGV[0];
+-f $ARGV[1] || die $ARGV[1].&quot; is not a file\n&quot;;
+$file = $ARGV[1];
+print STDERR &quot;Scanning $dir, Updating $file\n&quot;;
+
+opendir(DIR, $dir) || die &quot;can't open $dir: $!&quot;;
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at files</A> = readdir(DIR);
+closedir(DIR);
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at short_files</A> = sort(grep(/lm3s...\.h/, @files));
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at long_files</A> = sort(grep(/lm3s....\.h/, @files));
+
+$ver = 0;
+$new_struct = $struct_header;
+process_file(@short_files);
+process_file(@long_files);
+$new_struct .= $struct_footer;
+
+$dump = &quot;$comment $ver\n$new_struct&quot;;
+{
+	local($/, *INPUT);
+	open(INPUT, $file) || die &quot;can't open $file: $!&quot;;
+	$contents = &lt;INPUT&gt;;
+	close(INPUT);
+}
+
+$old_struct = qr/((^\/\/.*?\n)*)\Q$struct_header\E.*?$struct_footer/sm;
+$contents =~ s/$old_struct/$dump/;
+open(OUTPUT, &quot;&gt;$file&quot;) || die &quot;can't open file $file for writing: $!&quot;;
+print OUTPUT $contents;
+close(OUTPUT);
+
+sub process_file {
+	foreach $h_file (@_) {
+		($base) = ($h_file =~ m/lm3s(.{3,4})\.h/ig);
+		$base = uc($base);
+		local($/, *FILE);
+		open(FILE, &quot;$dir/$h_file&quot;);
+		$content = &lt;FILE&gt;;
+		close(FILE);
+		$invalid = 0;
+		if ($content =~ /This is part of revision (\d+) of/) {
+			if ($ver != 0 and $ver != $1) {
+				print STDERR &quot;File version mismatch: $ver != $1\n&quot;;
+				$ver = max($ver, $1);
+			} else {
+				$ver = $1;
+			}
+		}
+		if ($content =~ /SYSCTL_DID1_VER_[^M]\s+0x(\S+)/) {
+			$did1_ver = hex($1);
+		} else {
+			print STDERR &quot;$h_file is missing SYSCTL_DID1_VER\n&quot;;
+			$did1_ver = 255;
+			$invalid = 1;
+		}
+		if ($content =~ /SYSCTL_DID1_PRTNO_$base\s+0x(\S+)/) {
+			$prtno = hex($1);
+		} else {
+			print STDERR &quot;$h_file is missing SYSCTL_DID1_PRTNO\n&quot;;
+			$prtno = 0;
+			$invalid = 1;
+		}
+		$id = ($did1_ver | $prtno) &gt;&gt; 16;
+		$new_member = sprintf &quot;{0x%04X,\&quot;LM3S%s\&quot;},&quot;, $id, $base;
+		if ($invalid == 1) {
+			#$new_struct .= &quot;\t//$new_member\t// Invalid\n&quot;;
+		} else {
+			$new_struct .= &quot;\t$new_member\n&quot;;
+		}
+	}
+}
diff --git a/src/flash/nor/stellaris.c b/src/flash/nor/stellaris.c
index 851cab3..6a81047 100644
--- a/src/flash/nor/stellaris.c
+++ b/src/flash/nor/stellaris.c
@@ -123,6 +123,8 @@ struct stellaris_flash_bank
 	const char *mck_desc;
 };
 
+// Autogenerated by contrib/gen-stellaris-part-header.pl
+// From Stellaris Firmware Development Package revision 6734
 static struct {
 	uint32_t partno;
 	const char *partname;
@@ -178,6 +180,7 @@ static struct {
 	{0x1005,&quot;LM3S1627&quot;},
 	{0x10B3,&quot;LM3S1635&quot;},
 	{0x10BD,&quot;LM3S1637&quot;},
+	{0x10B1,&quot;LM3S1651&quot;},
 	{0x10B9,&quot;LM3S1751&quot;},
 	{0x1010,&quot;LM3S1776&quot;},
 	{0x1016,&quot;LM3S1811&quot;},
@@ -193,6 +196,8 @@ static struct {
 	{0x103C,&quot;LM3S1J16&quot;},
 	{0x100E,&quot;LM3S1N11&quot;},
 	{0x103B,&quot;LM3S1N16&quot;},
+	{0x10B2,&quot;LM3S1P51&quot;},
+	{0x109E,&quot;LM3S1R21&quot;},
 	{0x1030,&quot;LM3S1W16&quot;},
 	{0x102F,&quot;LM3S1Z16&quot;},
 	{0x1051,&quot;LM3S2110&quot;},
@@ -221,6 +226,7 @@ static struct {
 	{0x1058,&quot;LM3S2950&quot;},
 	{0x1055,&quot;LM3S2965&quot;},
 	{0x106C,&quot;LM3S2B93&quot;},
+	{0x1008,&quot;LM3S3634&quot;},
 	{0x1043,&quot;LM3S3651&quot;},
 	{0x1044,&quot;LM3S3739&quot;},
 	{0x1049,&quot;LM3S3748&quot;},

-----------------------------------------------------------------------

Summary of changes:
 contrib/gen-stellaris-part-header.pl |   91 ++++++++++++++++++++++++++++++++++
 src/flash/nor/stellaris.c            |    6 ++
 2 files changed, 97 insertions(+), 0 deletions(-)
 create mode 100755 contrib/gen-stellaris-part-header.pl


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002498.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-718-g4749a40
</A></li>
	<LI>Next message: <A HREF="002500.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-720-g5b34018
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2499">[ date ]</a>
              <a href="thread.html#2499">[ thread ]</a>
              <a href="subject.html#2499">[ subject ]</a>
              <a href="author.html#2499">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
