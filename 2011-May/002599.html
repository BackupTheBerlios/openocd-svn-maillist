<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-882-g5d7d08a
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2011-May/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.4.0-882-g5d7d08a&In-Reply-To=%3Cmailman.84.1331736154.7625.openocd-svn%40lists.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002598.html">
   <LINK REL="Next"  HREF="002600.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-882-g5d7d08a</H1>
    <B>Spencer Oliver</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.4.0-882-g5d7d08a&In-Reply-To=%3Cmailman.84.1331736154.7625.openocd-svn%40lists.berlios.de%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-882-g5d7d08a">ntfreak at users.sourceforge.net
       </A><BR>
    <I>Mon May 23 11:45:27 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002598.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-880-gef599ae
</A></li>
        <LI>Next message: <A HREF="002600.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-883-g6d6837f
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2599">[ date ]</a>
              <a href="thread.html#2599">[ thread ]</a>
              <a href="subject.html#2599">[ subject ]</a>
              <a href="author.html#2599">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  5d7d08a1f05a47d18f6c392a9e599db0bf49a381 (commit)
       via  d16b0ea6d46736633e4b765df963682ee684cf5f (commit)
      from  ef599aebfdbca9fa1b710d272d93d9d6b6999801 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 5d7d08a1f05a47d18f6c392a9e599db0bf49a381
Author: Spencer Oliver &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">ntfreak at users.sourceforge.net</A>&gt;
Date:   Mon May 23 10:23:34 2011 +0100

    dsp5680xx: whitespace cleanup
    
    Signed-off-by: Spencer Oliver &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">ntfreak at users.sourceforge.net</A>&gt;

diff --git a/src/target/dsp5680xx.c b/src/target/dsp5680xx.c
index b8e95e4..f2f2dba 100644
--- a/src/target/dsp5680xx.c
+++ b/src/target/dsp5680xx.c
@@ -135,7 +135,7 @@ static int dsp5680xx_read_core_reg(struct target * target, uint8_t reg_addr, uin
 }
 
 static int dsp5680xx_target_create(struct target *target, Jim_Interp * interp){
-  struct dsp5680xx_common *dsp5680xx = calloc(1, sizeof(struct dsp5680xx_common)); 
+  struct dsp5680xx_common *dsp5680xx = calloc(1, sizeof(struct dsp5680xx_common));
   target-&gt;arch_info = dsp5680xx;
   return ERROR_OK;
 }
@@ -153,7 +153,7 @@ static int dsp5680xx_arch_state(struct target *target){
   return ERROR_OK;
 }
 
-int dsp5680xx_target_status(struct target * target, uint8_t * jtag_st, uint16_t * eonce_st){  
+int dsp5680xx_target_status(struct target * target, uint8_t * jtag_st, uint16_t * eonce_st){
   return target-&gt;state;
 }
 
@@ -189,7 +189,7 @@ static int dsp5680xx_poll(struct target *target){
 		LOG_WARNING(&quot;%s: Failed to put EOnCE in debug mode. Is flash locked?...&quot;,__FUNCTION__);
 		return ERROR_TARGET_FAILURE;
       }else{
-		target-&gt;state = TARGET_HALTED;   
+		target-&gt;state = TARGET_HALTED;
 		return ERROR_OK;
       }
     }
@@ -218,7 +218,7 @@ static int dsp5680xx_poll(struct target *target){
     }
     target-&gt;state = TARGET_RUNNING;
     return ERROR_OK;
-  }	  
+  }
   if(jtag_status == JTAG_STATUS_DEAD){
     LOG_ERROR(&quot;%s: Cannot communicate with JTAG. Check connection...&quot;,__FUNCTION__);
     target-&gt;state = TARGET_UNKNOWN;
@@ -287,7 +287,7 @@ static int dsp5680xx_resume(struct target *target, int current, uint32_t address
   int retval;
   uint8_t jtag_status;
   uint16_t eonce_status;
-  
+
   // Verify that EOnCE is enabled (enable it if necessary)
   uint16_t data_read_from_dr = 0;
   retval = eonce_read_status_reg(target,&amp;data_read_from_dr);
@@ -300,7 +300,7 @@ static int dsp5680xx_resume(struct target *target, int current, uint32_t address
     retval = eonce_move_value_to_pc(target,address);
     err_check_propagate(retval);
   }
-  
+
   int retry = 20;
   while(retry-- &gt; 1){
     retval = eonce_exit_debug_mode(target,(uint8_t *)&amp;eonce_status );
@@ -309,7 +309,7 @@ static int dsp5680xx_resume(struct target *target, int current, uint32_t address
 	err_check_propagate(retval);
     if((jtag_status &amp; 0xff) == JTAG_STATUS_NORMAL){
       break;
-    }	
+    }
   }
   if(retry == 0){
     retval = ERROR_TARGET_FAILURE;
@@ -355,7 +355,7 @@ static int eonce_enter_debug_mode(struct target * target, uint16_t * eonce_statu
   // Debug request #1
   retval = dsp5680xx_irscan(target,&amp; instr,&amp; ir_out,DSP5680XX_JTAG_CORE_TAP_IRLEN);
   err_check_propagate(retval);
- 
+
   // Enable EOnCE module
   instr = JTAG_INSTR_ENABLE_ONCE;
   //Two rounds of jtag 0x6  (enable eonce) to enable EOnCE.
@@ -708,7 +708,7 @@ static int dsp5680xx_read_32_single(struct target * target, uint32_t address, ui
 	err_check_propagate(retval);
     retval = eonce_move_at_r0_to_y1(target);
 	err_check_propagate(retval);
-  } 
+  }
   // Get lower part of data to TX/RX
   retval = eonce_load_TX_RX_to_r0(target);
   err_check_propagate(retval);
@@ -737,7 +737,7 @@ static int dsp5680xx_read(struct target * target, uint32_t address, unsigned siz
   int retval = ERROR_OK;
   int pmem = 1;
   uint16_t tmp_wrd;
-  
+
   retval = dsp5680xx_convert_address(&amp;address, &amp;pmem);
   err_check_propagate(retval);
 
@@ -913,7 +913,7 @@ static int dsp5680xx_write(struct target *target, uint32_t address, uint32_t siz
   int p_mem = 1;
   retval = dsp5680xx_convert_address(&amp;address, &amp;p_mem);
   err_check_propagate(retval);
-  
+
   switch (size){
   case 1:
     retval = dsp5680xx_write_8(target, address, count,(uint8_t *) buffer, p_mem);
@@ -939,12 +939,12 @@ static int dsp5680xx_bulk_write_memory(struct target * target,uint32_t address,
 
 // Writes to pram at address
 // r3 holds the destination address-&gt; p:(r3)
-// r2 hold 0xf151 to flash a led (probably cannot see it due to high freq.) 
+// r2 hold 0xf151 to flash a led (probably cannot see it due to high freq.)
 // r0 holds TX/RX address.
 //0x00000073  0x8A44FFFE017B         brclr       #1,X:(R0-2),*-2
-//0x00000076  0xE700                 nop         
+//0x00000076  0xE700                 nop
 //0x00000077  0xF514                 move.w      X:(R0),Y0
-//0x00000078  0xE700                 nop         
+//0x00000078  0xE700                 nop
 //0x00000079  0x8563                 move.w      Y0,P:(R3)+
 //0x0000007A  0x84420003             bfchg       #3,X:(R2)
 //0x0000007C  0xA976                 bra         *-9
@@ -1088,7 +1088,7 @@ static int dsp5680xx_f_execute_command(struct target * target, uint16_t command,
 	err_check_propagate(retval);
 	retval = eonce_rx_upper_data(target,&amp;i);
 	err_check_propagate(retval);
-    if((watchdog--)==1){      
+    if((watchdog--)==1){
 	  retval = ERROR_TARGET_FAILURE;
       err_check(retval,&quot;FM execution did not finish.&quot;);
     }
@@ -1142,7 +1142,7 @@ int dsp5680xx_f_erase_check(struct target * target, uint8_t * erased){
     retval = dsp5680xx_halt(target);
     err_check_propagate(retval);
   }
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Check security
   // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   uint8_t protected;
@@ -1152,9 +1152,9 @@ int dsp5680xx_f_erase_check(struct target * target, uint8_t * erased){
 	retval = ERROR_TARGET_FAILURE;
 	err_check(retval,&quot;Failed to erase, flash is still protected.&quot;);
   }
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Set hfmdiv
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   retval = eonce_set_hfmdiv(target);
   err_check_propagate(retval);
 
@@ -1182,14 +1182,14 @@ int dsp5680xx_f_erase(struct target * target, int first, int last){
     retval = dsp5680xx_halt(target);
 	err_check_propagate(retval);
   }
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Reset SIM
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   retval = dsp5680xx_f_SIM_reset(target);
   err_check_propagate(retval);
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Check security
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   uint8_t protected;
   retval = dsp5680xx_f_protect_check(target,&amp;protected);
   err_check_propagate(retval);
@@ -1197,9 +1197,9 @@ int dsp5680xx_f_erase(struct target * target, int first, int last){
 	retval = ERROR_TARGET_FAILURE;
 	err_check(retval,&quot;Cannot flash, security is still enabled.&quot;);
   }
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Set hfmdiv
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   retval = eonce_set_hfmdiv(target);
   err_check_propagate(retval);
 
@@ -1221,7 +1221,7 @@ int dsp5680xx_f_erase(struct target * target, int first, int last){
 	  err_check(retval,&quot;pviol and/or accer bits set. HFM command execution error&quot;);
     }
     // Verify flash was successfully erased.
-    retval = dsp5680xx_f_erase_check(target,&amp;erased);   
+    retval = dsp5680xx_f_erase_check(target,&amp;erased);
 	err_check_propagate(retval);
 	if(retval == ERROR_OK){
       if (erased)
@@ -1256,10 +1256,10 @@ int dsp5680xx_f_erase(struct target * target, int first, int last){
 //                      bfset       #0x10,X:(R2+0x13)               // clear accerr
 //			bra	    hfm_wait		            // loop
 //0x00000073  0x8A460013407D         brclr       #0x40,X:(R2+0x13),*+0
-//0x00000076  0xE700                 nop         
-//0x00000077  0xE700                 nop         
+//0x00000076  0xE700                 nop
+//0x00000077  0xE700                 nop
 //0x00000078  0x8A44FFFE017B         brclr       #1,X:(R0-2),*-2
-//0x0000007B  0xE700                 nop         
+//0x0000007B  0xE700                 nop
 //0x0000007C  0xF514                 move.w      X:(R0),Y0
 //0x0000007D  0x8563                 move.w      Y0,P:(R3)+
 //0x0000007E  0x864600200014         move.w      #0x20,X:(R2+0x14)
@@ -1280,41 +1280,41 @@ int dsp5680xx_f_wr(struct target * target, uint8_t *buffer, uint32_t address, ui
     retval = dsp5680xx_halt(target);
 	err_check_propagate(retval);
   }
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Check if flash is erased
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   uint8_t erased;
   retval = dsp5680xx_f_erase_check(target,&amp;erased);
   err_check_propagate(retval);
   if(!erased){
 	retval = ERROR_FAIL;
 	err_check(retval,&quot;Flash must be erased before flashing.&quot;);
-  }	
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  }
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Download the pgm that flashes.
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   uint32_t my_favourite_ram_address = 0x8700; // This seems to be a safe address. This one is the one used by codewarrior in 56801x_flash.cfg
   retval = dsp5680xx_write(target, my_favourite_ram_address, 1, pgm_write_pflash_length*2,(uint8_t *) pgm_write_pflash);
   err_check_propagate(retval);
   retval = dsp5680xx_execute_queue();
   err_check_propagate(retval);
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Set hfmdiv
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   retval = eonce_set_hfmdiv(target);
   err_check_propagate(retval);
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Setup registers needed by pgm_write_pflash
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   retval = eonce_move_long_to_r3(target,address);  // Destination address to r3
   err_check_propagate(retval);
   eonce_load_TX_RX_high_to_r0(target);  // TX/RX reg address to r0
   err_check_propagate(retval);
   retval = eonce_move_long_to_r2(target,HFM_BASE_ADDR);// FM base address to r2
   err_check_propagate(retval);
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   // Run flashing program.
-  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
+  // -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
   retval = eonce_move_value_at_r2_disp(target,0x00,HFM_CNFG); // write to HFM_CNFG (lock=0, select bank)
   err_check_propagate(retval);
   retval = eonce_move_value_at_r2_disp(target,0x04,HFM_USTAT);// write to HMF_USTAT, clear PVIOL, ACCERR &amp; BLANK bits
@@ -1342,7 +1342,7 @@ int dsp5680xx_f_wr(struct target * target, uint8_t *buffer, uint32_t address, ui
   int counter_reset = FLUSH_COUNT_FLASH;
   int counter = counter_reset;
   context.flush = 0;
-  for(uint32_t i=1; (i&lt;count/2)&amp;&amp;(i&lt;HFM_SIZE_REAL); i++){ 
+  for(uint32_t i=1; (i&lt;count/2)&amp;&amp;(i&lt;HFM_SIZE_REAL); i++){
 	if(--counter==0){
 	  context.flush = 1;
 	  counter = counter_reset;
@@ -1365,8 +1365,8 @@ int dsp5680xx_f_unlock(struct target * target){
     LOG_ERROR(&quot;Master tap must be enabled to unlock flash.&quot;);
     return ERROR_TARGET_FAILURE;
   }
-  uint32_t data_to_shift_in = MASTER_TAP_CMD_FLASH_ERASE;  
-  uint32_t data_shifted_out;  
+  uint32_t data_to_shift_in = MASTER_TAP_CMD_FLASH_ERASE;
+  uint32_t data_shifted_out;
   retval = dsp5680xx_irscan(target,&amp;data_to_shift_in,&amp;data_shifted_out,8);
   err_check_propagate(retval);
   data_to_shift_in = HFM_CLK_DEFAULT;
@@ -1403,7 +1403,7 @@ struct target_type dsp5680xx_target = {
   .write_buffer = dsp5680xx_write_buffer,
   .read_buffer = dsp5680xx_read_buffer,
 
-  .assert_reset = dsp5680xx_assert_reset,  
+  .assert_reset = dsp5680xx_assert_reset,
   .deassert_reset = dsp5680xx_deassert_reset,
   .soft_reset_halt = dsp5680xx_soft_reset_halt,
 

commit d16b0ea6d46736633e4b765df963682ee684cf5f
Author: Spencer Oliver &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">ntfreak at users.sourceforge.net</A>&gt;
Date:   Mon May 23 10:22:12 2011 +0100

    Fix build issue under cygwin
    
    cygwin does not define sleep, so use our internal win32 version.
    caused by commit 9d4aec6bda90ad39a140747ea270c6a09dd26440
    
    Signed-off-by: Spencer Oliver &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">ntfreak at users.sourceforge.net</A>&gt;

diff --git a/src/target/dsp5680xx.c b/src/target/dsp5680xx.c
index 12b323e..b8e95e4 100644
--- a/src/target/dsp5680xx.c
+++ b/src/target/dsp5680xx.c
@@ -162,7 +162,7 @@ static int dsp5680xx_assert_reset(struct target *target){
   jtag_add_reset(1,0);
   target-&gt;state = TARGET_RESET;
   jtag_add_sleep(500);
-  sleep(1);
+  usleep(1000);
   return ERROR_OK;
 }
 

-----------------------------------------------------------------------

Summary of changes:
 src/target/dsp5680xx.c |   88 ++++++++++++++++++++++++------------------------
 1 files changed, 44 insertions(+), 44 deletions(-)


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002598.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-880-gef599ae
</A></li>
	<LI>Next message: <A HREF="002600.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-883-g6d6837f
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2599">[ date ]</a>
              <a href="thread.html#2599">[ thread ]</a>
              <a href="subject.html#2599">[ subject ]</a>
              <a href="author.html#2599">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
