<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-svn] r1969 - trunk/src/target
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-svn%5D%20r1969%20-%20trunk/src/target&In-Reply-To=%3C200905311132.n4VBWicW014046%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000752.html">
   <LINK REL="Next"  HREF="000754.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-svn] r1969 - trunk/src/target</H1>
    <B>zwelch at mail.berlios.de</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-svn%5D%20r1969%20-%20trunk/src/target&In-Reply-To=%3C200905311132.n4VBWicW014046%40sheep.berlios.de%3E"
       TITLE="[Openocd-svn] r1969 - trunk/src/target">zwelch at mail.berlios.de
       </A><BR>
    <I>Sun May 31 13:32:44 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000752.html">[Openocd-svn] r1968 - trunk/src/target
</A></li>
        <LI>Next message: <A HREF="000754.html">[Openocd-svn] r1970 - in trunk/src: flash helper jtag target
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#753">[ date ]</a>
              <a href="thread.html#753">[ thread ]</a>
              <a href="subject.html#753">[ subject ]</a>
              <a href="author.html#753">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: zwelch
Date: 2009-05-31 13:32:28 +0200 (Sun, 31 May 2009)
New Revision: 1969

Modified:
   trunk/src/target/arm11.c
   trunk/src/target/arm720t.c
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm920t.c
   trunk/src/target/arm926ejs.c
   trunk/src/target/arm966e.c
   trunk/src/target/arm9tdmi.c
   trunk/src/target/avrt.c
   trunk/src/target/cortex_a8.c
   trunk/src/target/cortex_m3.c
   trunk/src/target/feroceon.c
   trunk/src/target/mips_m4k.c
   trunk/src/target/target.c
   trunk/src/target/target.h
   trunk/src/target/target_request.c
   trunk/src/target/xscale.c
Log:
First step in hiding target_type_s from public interface:
- Add DEFINE_TARGET_TYPE_S symbol in files that need it defined.
- Forward declare 'struct target_type_s' only, unless that symbol is defined.


Modified: trunk/src/target/arm11.c
===================================================================
--- trunk/src/target/arm11.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm11.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -26,6 +26,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;arm11.h&quot;
 
 

Modified: trunk/src/target/arm720t.c
===================================================================
--- trunk/src/target/arm720t.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm720t.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -21,6 +21,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;arm720t.h&quot;
 #include &quot;time_support.h&quot;
 

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm7tdmi.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -27,6 +27,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;arm7tdmi.h&quot;
 
 

Modified: trunk/src/target/arm920t.c
===================================================================
--- trunk/src/target/arm920t.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm920t.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -21,6 +21,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;arm920t.h&quot;
 #include &quot;time_support.h&quot;
 

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm926ejs.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -21,6 +21,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;arm926ejs.h&quot;
 #include &quot;time_support.h&quot;
 

Modified: trunk/src/target/arm966e.c
===================================================================
--- trunk/src/target/arm966e.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm966e.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -24,6 +24,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;arm966e.h&quot;
 
 

Modified: trunk/src/target/arm9tdmi.c
===================================================================
--- trunk/src/target/arm9tdmi.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/arm9tdmi.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -27,6 +27,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;arm9tdmi.h&quot;
 
 

Modified: trunk/src/target/avrt.c
===================================================================
--- trunk/src/target/avrt.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/avrt.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -21,6 +21,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;avrt.h&quot;
 #include &quot;target.h&quot;
 

Modified: trunk/src/target/cortex_a8.c
===================================================================
--- trunk/src/target/cortex_a8.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/cortex_a8.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -33,6 +33,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;cortex_a8.h&quot;
 #include &quot;target_request.h&quot;
 

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/cortex_m3.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -31,6 +31,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;cortex_m3.h&quot;
 #include &quot;target_request.h&quot;
 

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/feroceon.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -49,6 +49,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;arm926ejs.h&quot;
 
 

Modified: trunk/src/target/mips_m4k.c
===================================================================
--- trunk/src/target/mips_m4k.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/mips_m4k.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -23,6 +23,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;mips32.h&quot;
 #include &quot;mips_m4k.h&quot;
 #include &quot;mips32_dmaacc.h&quot;

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/target.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -33,6 +33,8 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
+
 #include &quot;target.h&quot;
 #include &quot;target_request.h&quot;
 #include &quot;time_support.h&quot;

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/target.h	2009-05-31 11:32:28 UTC (rev 1969)
@@ -105,7 +105,8 @@
 	struct working_area_s *next;
 } working_area_t;
 
-typedef struct target_type_s
+#ifdef DEFINE_TARGET_TYPE_S
+struct target_type_s
 {
 	/**
 	 * Name of the target.  Do @b not access this field directly, use
@@ -258,7 +259,11 @@
 	int (*virt2phys)(struct target_s *target, u32 address, u32 *physical);
 	int (*mmu)(struct target_s *target, int *enabled);
 
-} target_type_t;
+};
+#else
+struct target_type_s;
+#endif // DEFINE_TARGET_TYPE_S
+typedef struct target_type_s target_type_t;
 
 /* forward decloration */
 typedef struct target_event_action_s target_event_action_t;

Modified: trunk/src/target/target_request.c
===================================================================
--- trunk/src/target/target_request.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/target_request.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -27,6 +27,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;target_request.h&quot;
 #include &quot;binarybuffer.h&quot;
 #include &quot;trace.h&quot;

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-05-31 11:32:10 UTC (rev 1968)
+++ trunk/src/target/xscale.c	2009-05-31 11:32:28 UTC (rev 1969)
@@ -24,6 +24,7 @@
 #include &quot;config.h&quot;
 #endif
 
+#define DEFINE_TARGET_TYPE_S
 #include &quot;xscale.h&quot;
 #include &quot;arm7_9_common.h&quot;
 #include &quot;arm_simulator.h&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000752.html">[Openocd-svn] r1968 - trunk/src/target
</A></li>
	<LI>Next message: <A HREF="000754.html">[Openocd-svn] r1970 - in trunk/src: flash helper jtag target
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#753">[ date ]</a>
              <a href="thread.html#753">[ thread ]</a>
              <a href="subject.html#753">[ subject ]</a>
              <a href="author.html#753">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
