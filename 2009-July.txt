From zwelch at mail.berlios.de  Wed Jul  1 00:25:14 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 1 Jul 2009 00:25:14 +0200
Subject: [Openocd-svn] r2438 - trunk/src/flash
Message-ID: <200906302225.n5UMPEqs027780@sheep.berlios.de>

Author: zwelch
Date: 2009-07-01 00:25:09 +0200 (Wed, 01 Jul 2009)
New Revision: 2438

Modified:
   trunk/src/flash/flash.c
Log:
Remove at91sam3.h from flash.c; use extern like other drivers.

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2009-06-30 21:45:34 UTC (rev 2437)
+++ trunk/src/flash/flash.c	2009-06-30 22:25:09 UTC (rev 2438)
@@ -30,7 +30,6 @@
 #include "flash.h"
 #include "image.h"
 #include "time_support.h"
-#include "at91sam3.h"
 
 /* command handlers */
 static int handle_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
@@ -49,6 +48,7 @@
  */
 extern flash_driver_t lpc2000_flash;
 extern flash_driver_t cfi_flash;
+extern flash_driver_t at91sam3_flash;
 extern flash_driver_t at91sam7_flash;
 extern flash_driver_t str7x_flash;
 extern flash_driver_t str9x_flash;



From ntfreak at mail.berlios.de  Wed Jul  1 12:15:54 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Wed, 1 Jul 2009 12:15:54 +0200
Subject: [Openocd-svn] r2439 - trunk/src/flash
Message-ID: <200907011015.n61AFsis025733@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-01 12:15:53 +0200 (Wed, 01 Jul 2009)
New Revision: 2439

Modified:
   trunk/src/flash/stm32x.c
Log:
- correct stm32 connectivity line programming as per latest manual

Modified: trunk/src/flash/stm32x.c
===================================================================
--- trunk/src/flash/stm32x.c	2009-06-30 22:25:09 UTC (rev 2438)
+++ trunk/src/flash/stm32x.c	2009-07-01 10:15:53 UTC (rev 2439)
@@ -304,14 +304,15 @@
 
 	if (stm32x_info->ppage_size == 2)
 	{
-		/* high density flash */
+		/* high density flash/connectivity line protection */
 
 		set = 1;
 
 		if (protection & (1 << 31))
 			set = 0;
 
-		/* bit 31 controls sector 62 - 255 protection */
+		/* bit 31 controls sector 62 - 255 protection for high density
+		 * bit 31 controls sector 62 - 127 protection for connectivity line */
 		for (s = 62; s < bank->num_sectors; s++)
 		{
 			bank->sectors[s].is_protected = set;
@@ -333,7 +334,7 @@
 	}
 	else
 	{
-		/* medium density flash */
+		/* low/medium density flash protection */
 		for (i = 0; i < num_bits; i++)
 		{
 			set = 1;
@@ -776,10 +777,10 @@
 	}
 	else if ((device_id & 0x7ff) == 0x418)
 	{
-		/* connectivity line density - we have 1k pages
-		 * 4 pages for a protection area */
-		page_size = 1024;
-		stm32x_info->ppage_size = 4;
+		/* connectivity line density - we have 2k pages
+		 * 2 pages for a protection area */
+		page_size = 2048;
+		stm32x_info->ppage_size = 2;
 
 		/* check for early silicon */
 		if (num_pages == 0xffff)
@@ -921,6 +922,10 @@
 				snprintf(buf, buf_size, "A");
 				break;
 
+			case 0x1001:
+				snprintf(buf, buf_size, "Z");
+				break;
+
 			default:
 				snprintf(buf, buf_size, "unknown");
 				break;



From ntfreak at mail.berlios.de  Wed Jul  1 12:29:10 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Wed, 1 Jul 2009 12:29:10 +0200
Subject: [Openocd-svn] r2440 - trunk/tcl/target
Message-ID: <200907011029.n61ATAEf026957@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-01 12:29:10 +0200 (Wed, 01 Jul 2009)
New Revision: 2440

Modified:
   trunk/tcl/target/stm32.cfg
Log:
- add stm32 connectivity line tapid to stm32.cfg

Modified: trunk/tcl/target/stm32.cfg
===================================================================
--- trunk/tcl/target/stm32.cfg	2009-07-01 10:15:53 UTC (rev 2439)
+++ trunk/tcl/target/stm32.cfg	2009-07-01 10:29:10 UTC (rev 2440)
@@ -52,8 +52,10 @@
   set _BSTAPID3 0x16410041
   # High density devices, Rev A
   set _BSTAPID4 0x06414041
+  # Connectivity line devices, Rev A and Rev Z
+  set _BSTAPID5 0x06418041
 }   
-jtag newtap $_CHIPNAME bs  -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID1 -expected-id $_BSTAPID2 -expected-id $_BSTAPID3 -expected-id $_BSTAPID4
+jtag newtap $_CHIPNAME bs  -irlen 5 -ircapture 0x1 -irmask 0x1 -expected-id $_BSTAPID1 -expected-id $_BSTAPID2 -expected-id $_BSTAPID3 -expected-id $_BSTAPID4 -expected-id $_BSTAPID5
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
 target create $_TARGETNAME cortex_m3 -endian $_ENDIAN -chain-position $_TARGETNAME



From zwelch at mail.berlios.de  Wed Jul  1 21:55:32 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 1 Jul 2009 21:55:32 +0200
Subject: [Openocd-svn] r2441 - trunk
Message-ID: <200907011955.n61JtW51016425@sheep.berlios.de>

Author: zwelch
Date: 2009-07-01 21:55:28 +0200 (Wed, 01 Jul 2009)
New Revision: 2441

Modified:
   trunk/README
Log:
Add comments to README about compiler and library dependencies.


Modified: trunk/README
===================================================================
--- trunk/README	2009-07-01 10:29:10 UTC (rev 2440)
+++ trunk/README	2009-07-01 19:55:28 UTC (rev 2441)
@@ -128,7 +128,14 @@
 OpenOCD Dependencies
 --------------------
 
-You will need to install the appropriate driver files, if you want to
+Presently, GCC is required to build OpenOCD.  The developers have begun
+to enforce strict code warnings (-Wall, -Werror, -Wextra, and more) and
+use C99-specific features: inline functions, named initializers, mixing
+declarations with code, and other tricks.  While it may be possible to
+use other compilers, they must be somewhat modern and could require
+extending support to conditionally remove GCC-specific extensions.
+
+Also, you need to install the appropriate driver files, if you want to
 build support for a USB or FTDI-based interface:
 
 - ft2232, jlink, rlink, vsllink, usbprog, arm-jtag-ew:
@@ -139,6 +146,9 @@
     or the Amontec version (from @uref{http://www.amontec.com}), for
     easier support of JTAGkey's vendor and product IDs.
 
+Many Linux distributions provide these packages through their automated
+installation and update mechanisms.
+
 Compiling OpenOCD
 -----------------
 



From zwelch at mail.berlios.de  Wed Jul  1 21:55:37 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 1 Jul 2009 21:55:37 +0200
Subject: [Openocd-svn] r2442 - trunk
Message-ID: <200907011955.n61JtbDC016442@sheep.berlios.de>

Author: zwelch
Date: 2009-07-01 21:55:34 +0200 (Wed, 01 Jul 2009)
New Revision: 2442

Modified:
   trunk/TODO
Log:
Update TODO list to relect 0.2.0 release.


Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-01 19:55:28 UTC (rev 2441)
+++ trunk/TODO	2009-07-01 19:55:34 UTC (rev 2442)
@@ -5,13 +5,6 @@
 
 @section thelist The List
 
-Items with a current patch available should include a link to its
-posting on the openocd-developer mailing list archives.
-
-Some items may be in progress, usually indicated by the individual whose
-initials in parentheses following it.  A key for decoding these initials
-appears after The List.
-
 Most items are open for the taking, but please post to the mailing list
 before spending much time working on anything lists here.  The community
 may have evolved an idea since it was added here.
@@ -33,6 +26,8 @@
       above rely heavily on scripting event mechanisms.
   - Allow full TCL support? add --with-tcl=/path/to/installed/tcl
   - Move TCL support out of foo.[ch] and into foo_tcl.[ch] (other ideas?)
+    - See src/jtag/core.c and src/jtag/tcl.c for an example.
+    - allow some of these TCL command modules to be dynamically loadable?
 
 @section thelistjtag JTAG
 
@@ -44,15 +39,6 @@
 
 - use tap_set_state everywhere to allow logging TAP state transitions
 - rename other tap_states to use standard JTAG names (suggested by ML)
-
-- retire jtag_add_end_state() and replace w/global variable:
-  - removes TAP_INVALID as an argument to jtag_add_xxxx().
-
-  - global variable as argument to jtag_add_xxxx() should be phased out,
-    but it is useful while we need to bug-by-bug compatible while
-    testing changes.
-
- - Suggested by ?H. Michael Bruck also interested in this.
 - Encapsulate cmd_queue_cur_state and related varaible handling.
 
 The following tasks have been suggested for adding new core JTAG support:
@@ -71,13 +57,11 @@
 - rework USB communication to be more robust.  Two possible options are:
   -# use libusb-1.0.1 with libusb-compat-0.1.1 (non-blocking I/O wrapper)
   -# rewrite implementation to use non-blocking I/O
-- FT2232 driver:
-  - integrate FTD2XX High-Speed Device support @par
-      PATCH: https://lists.berlios.de/pipermail/openocd-development/2009-April/005479.html
-  - fix outstanding bugs
 - J-Link driver:
   - fix to work with long scan chains, such as R.Doss's svf test.
-  - fix other outstanding bugs
+- FT2232 (libftdi):
+  - make performance comparable to alternatives
+  - make usability comparable to alternatives
 
 The following tasks have been suggested for adding new JTAG interfaces:
 
@@ -110,8 +94,8 @@
 
 @section thelisttargets Target Support
 
-- general layer cleanup:
-  - https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
+- general layer cleanup: @par
+  https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
 - ARM11 improvements (MB?)
   - fix single stepping  (reported by ?H)
   - implement missing functionality (grep FNC_INFO_NOTIMPLEMENTED ...)
@@ -130,7 +114,7 @@
   - work out how to debug this target
   - AVR debugging protocol.
 - FPGA:
-  - improve things (??)
+  - Altera Nios Soft-CPU support
 - Coldfire (suggested by NC)
   - can we draw from the BDM project?  @par
     http://bdm.sourceforge.net/
@@ -140,11 +124,6 @@
 
 @section thelistsvf SVF/XSVF
 
-- factor and clean-up code
-- review The Guide for OpenOCD Users for documentation errors or omissions
-- update The Manual for OpenOCD Developerrs:
-  - add documentation describing the architecture of each module
-  - provide Technical Primers to bootstrap contributor knowledge
 - develop SVF unit tests 
 - develop XSVF unit tests 
 
@@ -166,6 +145,8 @@
 
 @section thelistdebug Debugger Support
 
+- breakpoints can get lost in some circumstances: @par
+  https://lists.berlios.de/pipermail/openocd-development/2009-June/008853.html
 - integrate Keil AGDI interface to OpenOCD? (submitted by Dario Vecchio)
 
 @section thelisttesting Testing Suite
@@ -210,7 +191,7 @@
 
 @subsection thelisttestreports Test Feedback Tools
 
-These ideas were first introduced here:
+These ideas were first introduced here: @par
   https://lists.berlios.de/pipermail/openocd-development/2009-May/006358.html
 
 - provide report submission scripts for e-mail and web forms
@@ -225,8 +206,13 @@
 
 @section thelistautotools Autotools Build System
 
-- investigate fixes to permit the use of -Wshadow
-- eliminate sources of confusion in @c boostrap script:
+- make entire configure process require less user consideration:
+  - automatically detect the features that are available, unless
+    options were specifically provided to configure
+  - provide a report of the drivers that will be build at the end of
+    running configure, so the users can verify which driverswill be
+    built during 'make' (and their options) .
+- eliminate sources of confusion in @c bootstrap script:
   -# Make @c bootstrap call 'configure --enable-maintainer-mode \<opts\>'?
   -# Add @c buildstrap script to assist with boostrap and configure steps.
 - automatically build tool-chains required for cross-compiling
@@ -239,8 +225,8 @@
 The following architectural tasks need to be accomplished and should be
 fairly easy to complete:
 
+- clean-up code to match style guides
 - factor code to eliminate duplicated functionality
-- overhaul use of types to improve 32/64-bit portability
 - rewrite code that uses casts to access 16-bit and larger types
   from unaligned memory addresses
 - libopenocd support: @par
@@ -250,13 +236,24 @@
 The following strategic tasks will require ambition, knowledge, and time
 to complete:
 
+- overhaul use of types to improve 32/64-bit portability
+  - types for both host and target word sizes?
+  - can we use GDB's CORE_TYPE support?
 - Allow N:M:P mapping of servers, targets, and interfaces
-- loadable module support for interface/target/flash drivers
+- loadable module support for interface/target/flash drivers and commands
+  - support both static and dynamic modules.
+  - should probably use libltdl for dynamic library handing.
 
- at section thelistadmin Administrative Tasks
+ at section thelistadmin Documentation Tasks
 
-- Develop "style" guidelines for committing to Subversion
-- Develop milestone and release guidelines.
+- Develop milestone and release guidelines, processes, and scripts.
+- Develop "style" guidelines (and scripts) for maintainers:
+  - reviewing patches
+  - committing to Subversion
+- Review The Guide for OpenOCD Users for documentation errors or omissions
+- Update The Manual for OpenOCD Developerrs:
+  - Add documentation describing the architecture of each module
+  - Provide more Technical Primers to bootstrap contributor knowledge
 
 */
 /** @file



From zwelch at mail.berlios.de  Wed Jul  1 21:55:42 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 1 Jul 2009 21:55:42 +0200
Subject: [Openocd-svn] r2443 - trunk/src/helper
Message-ID: <200907011955.n61JtgHd016495@sheep.berlios.de>

Author: zwelch
Date: 2009-07-01 21:55:39 +0200 (Wed, 01 Jul 2009)
New Revision: 2443

Modified:
   trunk/src/helper/membuf.h
Log:
Add missing copyright header and fix @page direction in membuf.h.


Modified: trunk/src/helper/membuf.h
===================================================================
--- trunk/src/helper/membuf.h	2009-07-01 19:55:34 UTC (rev 2442)
+++ trunk/src/helper/membuf.h	2009-07-01 19:55:39 UTC (rev 2443)
@@ -1,9 +1,27 @@
+/***************************************************************************
+ *   Copyright (C) 2009 By Duane Ellis                                     *
+ *   openocd at duaneellis.com                                                *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
 #ifndef HELPER_MEMBUF_H
 #define HELPER_MEMBUF_H
 
-/** @file */
-
-/** @page MEMBUF - an auto-growing string buffer
+/** @file
+ * MEMBUF - an auto-growing string buffer
  *
  * With OpenOCD often, one must write code that sends text to
  * different places.. the historical command_ctx, or JIM output,



From zwelch at mail.berlios.de  Wed Jul  1 21:55:49 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 1 Jul 2009 21:55:49 +0200
Subject: [Openocd-svn] r2444 - trunk/src/target
Message-ID: <200907011955.n61JtnG9016521@sheep.berlios.de>

Author: zwelch
Date: 2009-07-01 21:55:46 +0200 (Wed, 01 Jul 2009)
New Revision: 2444

Modified:
   trunk/src/target/target_type.h
Log:
Add missing copyright header to target_type.h.


Modified: trunk/src/target/target_type.h
===================================================================
--- trunk/src/target/target_type.h	2009-07-01 19:55:39 UTC (rev 2443)
+++ trunk/src/target/target_type.h	2009-07-01 19:55:46 UTC (rev 2444)
@@ -1,3 +1,28 @@
+/***************************************************************************
+ *   Copyright (C) 2005 by Dominic Rath                                    *
+ *   Dominic.Rath at gmx.de                                                   *
+ *                                                                         *
+ *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   oyvind.harboe at zylin.com                                               *
+ *                                                                         *
+ *   Copyright (C) 2008 by Spencer Oliver                                  *
+ *   spen at spen-soft.co.uk                                                  *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
 #ifndef TARGET_TYPE_H
 #define TARGET_TYPE_H
 



From zwelch at mail.berlios.de  Wed Jul  1 21:55:56 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Wed, 1 Jul 2009 21:55:56 +0200
Subject: [Openocd-svn] r2445 - trunk/doc/manual
Message-ID: <200907011955.n61JtuVe016548@sheep.berlios.de>

Author: zwelch
Date: 2009-07-01 21:55:52 +0200 (Wed, 01 Jul 2009)
New Revision: 2445

Modified:
   trunk/doc/manual/main.txt
Log:
Minor fixes to Developer Manual pages.
- Fix cosmetic bug on main page
- Add missing JTAG list item.


Modified: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-07-01 19:55:46 UTC (rev 2444)
+++ trunk/doc/manual/main.txt	2009-07-01 19:55:52 UTC (rev 2445)
@@ -1,7 +1,7 @@
 /** @mainpage OpenOCD Reference Manual
 
 Welcome to the OpenOCD Reference Manual -- the developer's resource for
-learning about the internal architecture of the OpenOCD project.
+learning about the internal architecture of the OpenOCD project. @par
 
 In addition, this document contains the tactical and strategic plans
 and processes that have been developed by and for the OpenOCD community.
@@ -69,6 +69,7 @@
   - @ref helperlogging
 - @subpage jtagdocs
   - @ref jtagcore
+  - @ref jtagtcl
   - @ref jtagcmd
   - @ref jtagiface
   - @ref jtagdriver



From zwelch at mail.berlios.de  Thu Jul  2 06:55:20 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 2 Jul 2009 06:55:20 +0200
Subject: [Openocd-svn] r2446 - trunk/src/flash
Message-ID: <200907020455.n624tK9S024871@sheep.berlios.de>

Author: zwelch
Date: 2009-07-02 06:55:10 +0200 (Thu, 02 Jul 2009)
New Revision: 2446

Modified:
   trunk/src/flash/davinci_nand.c
Log:
David Brownell <david-b at pacbell.net>:

Restore some whitespace that got clobbered by over-aggressive
whitepace eradication patches a while back.


Modified: trunk/src/flash/davinci_nand.c
===================================================================
--- trunk/src/flash/davinci_nand.c	2009-07-01 19:55:52 UTC (rev 2445)
+++ trunk/src/flash/davinci_nand.c	2009-07-02 04:55:10 UTC (rev 2446)
@@ -675,7 +675,7 @@
 	if (aemif == 0x01e00000			/* dm6446, dm357 */
 			|| aemif == 0x01e10000	/* dm335, dm355 */
 			|| aemif == 0x01d10000	/* dm365 */
-) {
+			) {
 		if (chip < 0x0200000 || chip >= 0x0a000000) {
 			LOG_ERROR("NAND address %08lx out of range?", chip);
 			goto fail;



From zwelch at mail.berlios.de  Thu Jul  2 06:55:41 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 2 Jul 2009 06:55:41 +0200
Subject: [Openocd-svn] r2447 - in trunk/tcl: board target
Message-ID: <200907020455.n624tfae025160@sheep.berlios.de>

Author: zwelch
Date: 2009-07-02 06:55:35 +0200 (Thu, 02 Jul 2009)
New Revision: 2447

Modified:
   trunk/tcl/board/dm355evm.cfg
   trunk/tcl/target/davinci.cfg
Log:
David Brownell <david-b at pacbell.net>:

Prepare the DaVinci PLL code to support the version 0x0E module
used in newer chips (e.g. dm365):  rename the original code so
it's specific to version 0x02 PLL modules, and update the dm355evm
code to use that new name.

Fix two minor bugs in that version 2 code:  sysclk3 setup used
the sysclk2 divider address (affecting video processing on dm355,
no worry for now) and sysclk2 setup had a syntax error.

Also minor fixups to dm355evm, mostly to permit use of RTCK.


Modified: trunk/tcl/board/dm355evm.cfg
===================================================================
--- trunk/tcl/board/dm355evm.cfg	2009-07-02 04:55:10 UTC (rev 2446)
+++ trunk/tcl/board/dm355evm.cfg	2009-07-02 04:55:35 UTC (rev 2447)
@@ -1,4 +1,3 @@
-#
 # DM355 EVM board
 #   http://focus.ti.com/docs/toolsw/folders/print/tmdsevm355.html
 #   http://c6000.spectrumdigital.com/evmdm355/
@@ -22,7 +21,7 @@
 	puts "Initialize DM355 EVM board"
 
 	# CLKIN	= 24 MHz ... can't talk quickly to ARM yet
-	jtag_khz 1500
+	jtag_rclk 1500
 
 	########################
 	# PLL1		= 432 MHz (/8, x144)
@@ -37,10 +36,10 @@
 	set pll_divs [dict create]
 	dict set pll_divs div3 16
 	dict set pll_divs div4 8
-	pll_setup $addr 144 $pll_divs
+	pll_v02_setup $addr 144 $pll_divs
 
 	# ARM is now running at 216 MHz, so JTAG can go faster
-	jtag_khz 20000
+	jtag_rclk 20000
 
 	########################
 	# PLL2		= 342 MHz (/8, x114)
@@ -50,7 +49,7 @@
 	set addr [dict get $dm355 pllc2]
 	set pll_divs [dict create]
 	dict set pll_divs prediv 8
-	pll_setup $addr 114 $pll_divs
+	pll_v02_setup $addr 114 $pll_divs
 
 	########################
 	# PINMUX

Modified: trunk/tcl/target/davinci.cfg
===================================================================
--- trunk/tcl/target/davinci.cfg	2009-07-02 04:55:10 UTC (rev 2446)
+++ trunk/tcl/target/davinci.cfg	2009-07-02 04:55:35 UTC (rev 2447)
@@ -31,12 +31,10 @@
 # For PLLs that don't have a given register (e.g. plldiv8), or where a
 # given divider is non-programmable, caller provides *NO* config mapping.
 #
-# REVISIT there are minor differences between the PLL controllers.
-# Handle those; maybe check the ID register.  This version behaves
-# for at least the dm355.  On dm6446 and dm357 the PLLRST polarity
-# is different.  On dm365 there are more changes.
-#
-proc pll_setup {pll_addr mult config} {
+
+# PLL version 0x02: tested on dm355
+# REVISIT:  On dm6446 and dm357 the PLLRST polarity is different.
+proc pll_v02_setup {pll_addr mult config} {
 	set pll_ctrl_addr [expr $pll_addr + 0x100]
 	set pll_ctrl [mrw $pll_ctrl_addr]
 
@@ -98,7 +96,7 @@
 		set go 1
 	}
 	if { [dict exists $config div2] } {
-		1et div [dict get $config div2]
+		set div [dict get $config div2]
 		set div [expr 0x8000 | ($div - 1)]
 		mww [expr $pll_addr + 0x011c] $div
 		set go 1
@@ -106,7 +104,7 @@
 	if { [dict exists $config div3] } {
 		set div [dict get $config div3]
 		set div [expr 0x8000 | ($div - 1)]
-		mww [expr $pll_addr + 0x011c] $div
+		mww [expr $pll_addr + 0x0120] $div
 		set go 1
 	}
 	if { [dict exists $config div4] } {



From zwelch at mail.berlios.de  Thu Jul  2 06:55:49 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 2 Jul 2009 06:55:49 +0200
Subject: [Openocd-svn] r2448 - trunk
Message-ID: <200907020455.n624tnC9025234@sheep.berlios.de>

Author: zwelch
Date: 2009-07-02 06:55:46 +0200 (Thu, 02 Jul 2009)
New Revision: 2448

Modified:
   trunk/README
Log:
David Brownell <david-b at pacbell.net>:

More minor improvements to README to help polish the 0.2.0 release:
- Add note about Ubuntu 8.04 (in lieu of starting a README.Linux file).
- Fix introductory paragraph to Bulding OpenOCD
- Remove some vestigial texinfo markup.


Modified: trunk/README
===================================================================
--- trunk/README	2009-07-02 04:55:35 UTC (rev 2447)
+++ trunk/README	2009-07-02 04:55:46 UTC (rev 2448)
@@ -117,13 +117,11 @@
 
 The INSTALL file contains generic instructions for running 'configure'
 and compiling the OpenOCD source code.  That file is provided by default
-for all GNU automake packages, and 
+for all GNU automake packages.  If you are not familiar with the GNU
+autotools, then you should read those instructions first.  
 
-if you are not familiar with the GNU autotools, then you should read
-those instructions first.  
-Still, the
-remainder of this document tries to provide complete instructions for
-those looking for a quick-install
+The remainder of this document tries to provide some instructions for
+those looking for a quick-install.
 
 OpenOCD Dependencies
 --------------------
@@ -143,11 +141,13 @@
 - ft2232 also requires:
   - libftdi: http://www.intra2net.com/opensource/ftdi/  *OR*
   - ftd2xx: http://www.ftdichip.com/Drivers/D2XX.htm,
-    or the Amontec version (from @uref{http://www.amontec.com}), for
+    or the Amontec version (from http://www.amontec.com), for
     easier support of JTAGkey's vendor and product IDs.
 
 Many Linux distributions provide these packages through their automated
-installation and update mechanisms.
+installation and update mechanisms; however, some Linux versions include
+older versions of libftdi.  In particular, using Ubuntu 8.04 has been
+problematic, but newer versions of Ubuntu do not have this problem.
 
 Compiling OpenOCD
 -----------------
@@ -377,7 +377,7 @@
 
    svn checkout svn://svn.berlios.de/openocd/trunk openocd
 
-If you prefer GIT based tools, the @command{git-svn} package works too:
+If you prefer GIT based tools, the git-svn package works too:
 
    git svn clone -s svn://svn.berlios.de/openocd
 
@@ -386,7 +386,7 @@
 
 Building OpenOCD from a repository requires a recent version of the GNU
 autotools (autoconf >= 2.59 and automake >= 1.9).  For building on
-Windows, you have to use Cygwin. Make sure that your @env{PATH}
+Windows, you have to use Cygwin. Make sure that your PATH
 environment variable contains no other locations with Unix utils (like
 UnxUtils) - these can't handle the Cygwin paths, resulting in obscure
 dependency errors.  This was an observation gathered from the logs of



From oharboe at mail.berlios.de  Thu Jul  2 09:13:00 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 2 Jul 2009 09:13:00 +0200
Subject: [Openocd-svn] r2449 - trunk/doc
Message-ID: <200907020713.n627D0Ci016168@sheep.berlios.de>

Author: oharboe
Date: 2009-07-02 09:12:59 +0200 (Thu, 02 Jul 2009)
New Revision: 2449

Modified:
   trunk/doc/openocd.texi
Log:
David Brownell <david-b at pacbell.net> Fix two texinfo formatting bugs.  The first was visible by
reading the output, and both were reported in openocd.log
after making the PDF.

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-07-02 04:55:46 UTC (rev 2448)
+++ trunk/doc/openocd.texi	2009-07-02 07:12:59 UTC (rev 2449)
@@ -176,10 +176,12 @@
 You can download the current SVN version with an SVN client of your
 choice from the following repositories:
 
-   svn://svn.berlios.de/openocd/trunk
+   @uref{svn://svn.berlios.de/openocd/trunk}
+
 or
-   http://svn.berlios.de/svnroot/repos/openocd/trunk
 
+   @uref{http://svn.berlios.de/svnroot/repos/openocd/trunk}
+
 Using the SVN command line client, you can use the following command to
 fetch the latest version (make sure there is no (non-svn) directory
 called "openocd" in the current directory):
@@ -716,7 +718,7 @@
 
 @item
 You may may need to write some C code.
-It may be as simple as a supporting a new new ft2232 or parport
+It may be as simple as a supporting a new ft2232 or parport
 based dongle; a bit more involved, like a NAND or NOR flash
 controller driver; or a big piece of work like supporting
 a new chip architecture.
@@ -3155,8 +3157,8 @@
 readers/updaters: Please remove this worrysome comment after other
 chips are confirmed.}
 
-The AT91SAM3U4[E/C] (256K) chips have 2 flash banks, the other chips
-(3U[1/2][E/C]) have 1 flash bank.  In all cases the flash banks are at
+The AT91SAM3U4[E/C] (256K) chips have two flash banks; most other chips
+have one flash bank.  In all cases the flash banks are at
 the following fixed locations:
 
 @example



From oharboe at mail.berlios.de  Thu Jul  2 09:20:05 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 2 Jul 2009 09:20:05 +0200
Subject: [Openocd-svn] r2450 - in zy1000/trunk: build
	ecoshal/hal/zylin/phi/current/include/pkgconf
Message-ID: <200907020720.n627K5vi016821@sheep.berlios.de>

Author: oharboe
Date: 2009-07-02 09:20:04 +0200 (Thu, 02 Jul 2009)
New Revision: 2450

Modified:
   zy1000/trunk/build/makephi.sh
   zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi
Log:
fix zy1000 build problems(and tested w/Ubuntu 9.04).

Modified: zy1000/trunk/build/makephi.sh
===================================================================
--- zy1000/trunk/build/makephi.sh	2009-07-02 07:12:59 UTC (rev 2449)
+++ zy1000/trunk/build/makephi.sh	2009-07-02 07:20:04 UTC (rev 2450)
@@ -5,7 +5,8 @@
 find tclconvert -regex ".*\.svn" -exec echo rm -rf {} \; | sh
 #sh $OPENOCD/html2tcl.tcl tclconvert
 find tclconvert/ -type f -exec $OPENOCD/html2tcl.tcl {} {} \;
-make -s install-data-am
+make
+make -s install
 
 # copy over installed stuff
 cp -r /tmp/ecosboard/ocdinstall/lib/openocd/* tclconvert/

Modified: zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi
===================================================================
--- zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi	2009-07-02 07:12:59 UTC (rev 2449)
+++ zy1000/trunk/ecoshal/hal/zylin/phi/current/include/pkgconf/mlt_zylin_phi_dram_fast.ldi	2009-07-02 07:20:04 UTC (rev 2450)
@@ -76,7 +76,7 @@
 *kernel* (*.data*) ;
 
 
-* (*cyg_httpd_thread_stack*)    ;  
+//* (*cyg_httpd_thread_stack*)    ;  
 
  *hal_arm_arch_hal_misc.o* (*)    ;  
  *at91_misc* (*)    ;  



From oharboe at mail.berlios.de  Thu Jul  2 11:11:21 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 2 Jul 2009 11:11:21 +0200
Subject: [Openocd-svn] r2451 - trunk/src/jtag/zy1000 zy1000/trunk/build/menu
	zy1000/trunk/build/tcl zy1000/trunk/snapshots
Message-ID: <200907020911.n629BLHg001175@sheep.berlios.de>

Author: oharboe
Date: 2009-07-02 11:11:18 +0200 (Thu, 02 Jul 2009)
New Revision: 2451

Modified:
   trunk/src/jtag/zy1000/zy1000.c
   zy1000/trunk/build/menu/zy1000menu.xml
   zy1000/trunk/build/tcl/browsemem.tcl
   zy1000/trunk/build/tcl/downloadmem.tcl
   zy1000/trunk/build/tcl/editconfigs.tcl
   zy1000/trunk/build/tcl/editfile.tcl
   zy1000/trunk/build/tcl/erase.tcl
   zy1000/trunk/build/tcl/flash.tcl
   zy1000/trunk/build/tcl/flashinfo.tcl
   zy1000/trunk/build/tcl/guiupload.tcl
   zy1000/trunk/build/tcl/index.tcl
   zy1000/trunk/build/tcl/log.tcl
   zy1000/trunk/build/tcl/openocd.tcl
   zy1000/trunk/build/tcl/preconfig.tcl
   zy1000/trunk/build/tcl/production.tcl
   zy1000/trunk/build/tcl/reload.tcl
   zy1000/trunk/build/tcl/run.tcl
   zy1000/trunk/build/tcl/support.tcl
   zy1000/trunk/build/tcl/targets.tcl
   zy1000/trunk/build/tcl/terminal.tcl
   zy1000/trunk/build/tcl/upgrade.tcl
   zy1000/trunk/build/tcl/zy1000.tcl
   zy1000/trunk/snapshots/athttpd.zip
   zy1000/trunk/snapshots/discover.zip
   zy1000/trunk/snapshots/jimtcl.zip
Log:
zy1000 1.53 snapshot

Modified: trunk/src/jtag/zy1000/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000/zy1000.c	2009-07-02 07:20:04 UTC (rev 2450)
+++ trunk/src/jtag/zy1000/zy1000.c	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007-2008 by ?yvind Harboe                              *
+ *   Copyright (C) 2007-2008 by ???yvind Harboe                              *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *
@@ -28,7 +28,7 @@
 #include <cyg/hal/hal_diag.h>
 
 
-#define ZYLIN_VERSION "1.52"
+#define ZYLIN_VERSION "1.53"
 #define ZYLIN_DATE __DATE__
 #define ZYLIN_TIME __TIME__
 #define ZYLIN_OPENOCD "$Revision$"

Modified: zy1000/trunk/build/menu/zy1000menu.xml
===================================================================
--- zy1000/trunk/build/menu/zy1000menu.xml	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/menu/zy1000menu.xml	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1549,14 +1549,13 @@
 			<markup_code><![CDATA[
 			Before contacting Zylin, please submit a support request with relevant information. 
 			<tcl>
-			
-			set form_config [load_config "[load_target]"]
-			set support_id [string range [rand] 0 7]
-			set form_log ""
-			append form_log "Version: [zy1000_version zy1000]"
-			append form_log "OpenOCD version: [zy1000_version openocd]"
-			append form_log "Version date: [zy1000_version date]"
-			append form_log [log]
+				set form_config [load_config "[load_target]"]
+				set support_id [string range [rand] 0 7]
+				set form_log ""
+				append form_log "Version: [zy1000_version zy1000]"
+				append form_log "OpenOCD version: [zy1000_version openocd]"
+				append form_log "Version date: [zy1000_version date]"
+				append form_log [log]
 			</tcl>
 
 			<form action="supportrequest.tcl" method="POST" target="_blank">
@@ -1625,7 +1624,7 @@
 				<tr><td>Contact person</td><td><tcl>append buffer [encode [formfetch name]]</tcl></td></tr>
 				<tr><td>Phone</td><td><tcl>append buffer [encode [formfetch phone]]</tcl></td></tr>
 				<tr><td>email</td><td><tcl>append buffer [encode [formfetch email]]</tcl></td></tr>
-				<tr><td>MAC address</td><td><tcl>append buffer [formfetch serial]]</tcl></td></tr>
+				<tr><td>MAC address</td><td><tcl>append buffer [formfetch serial]</tcl></td></tr>
 				<tr><td colspan="2">Summary:</td></tr>
 				<tr><td colspan="2"><tcl>append buffer [encode [formfetch summary]]</tcl></td></tr>
 				<tr><td colspan="2">Description:</td></tr>

Modified: zy1000/trunk/build/tcl/browsemem.tcl
===================================================================
--- zy1000/trunk/build/tcl/browsemem.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/browsemem.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,155 +1,155 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="browsemem.tcl" style="font-weight: bold;">Browse / Edit</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="downloadmem.tcl" style="">Download</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl" style="font-weight: bold;">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Browse / Edit Memory</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="browsemem.tcl" style="font-weight: bold;">Browse / Edit</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="downloadmem.tcl" style="">Download</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl" style="font-weight: bold;">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Browse / Edit Memory</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 
 
@@ -269,119 +269,119 @@
 			
 
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/browsemem.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/browsemem.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				<p>Browse and edit target memory.<br>
@@ -392,65 +392,65 @@
 				<p><b>Fill</b> - Will fill the specified region with the specified value.</p>
 				<p><b>Refresh</b> - Display the content of the specified memory area.</p>
 					
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/downloadmem.tcl
===================================================================
--- zy1000/trunk/build/tcl/downloadmem.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/downloadmem.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,160 +1,160 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="browsemem.tcl" style="">Browse / Edit</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="downloadmem.tcl" style="font-weight: bold;">Download</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl" style="font-weight: bold;">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Download Memory Range</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="browsemem.tcl" style="">Browse / Edit</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="downloadmem.tcl" style="font-weight: bold;">Download</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl" style="font-weight: bold;">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Download Memory Range</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			<tcl>
 				set form_address [formfetch form_address]
@@ -193,119 +193,119 @@
 
 
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/downloadmem.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/downloadmem.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 					
 				Download memory to ZY1000 from target. <br>
@@ -315,60 +315,60 @@
 				Once the memory is downloaded a link is available on the page to download
 				the file from ZY1000 to your PC.
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/editconfigs.tcl
===================================================================
--- zy1000/trunk/build/tcl/editconfigs.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/editconfigs.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,142 +1,142 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/index.tcl" style="">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Edit Target Configurations</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/index.tcl" style="">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Edit Target Configurations</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			<form action="editconfigs.tcl" method="post">
 			<tcl>
@@ -218,119 +218,119 @@
 					append buffer {</tr></table>} "\n"
 				</tcl>
 			</form>			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/editconfigs.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/editconfigs.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				<p>Here you can edit predefined target configurations, restore predefined configurations to
@@ -346,92 +346,92 @@
 				<b>Note</b> that firmware included configuration files can not be deleted.</p>
 				<p><b>Save</b> - Save the edited file under the a new or the same name.</p>
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/editfile.tcl
===================================================================
--- zy1000/trunk/build/tcl/editfile.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/editfile.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,190 +1,190 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="zy1000.tcl" style="">Set IP Address</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="editfile.tcl" style="font-weight: bold;">Edit File</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="support.tcl" style="">Support Request</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Edit File</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="zy1000.tcl" style="">Set IP Address</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="editfile.tcl" style="font-weight: bold;">Edit File</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="support.tcl" style="">Support Request</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Edit File</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 <tcl>
 			
@@ -248,119 +248,119 @@
 
 	</tcl>
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/editfile.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/editfile.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				Edit any file on the ZY1000 by typing in the
@@ -372,44 +372,44 @@
 					<a href="/rom" target="_blank">Browse files on /rom</a></td>
 				</tr></table>
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/erase.tcl
===================================================================
--- zy1000/trunk/build/tcl/erase.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/erase.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,163 +1,163 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="font-weight: bold;">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Erase Flash</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="font-weight: bold;">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Erase Flash</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 
 
@@ -209,190 +209,190 @@
 			
 
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/erase.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/erase.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				<p>Note that flash programming will erase flash if required.<p/>
 				<p>Reset and init CPU, then erase address range.</p>
 				<p>The length field is specified in number of bytes.</p>
 					
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/flash.tcl
===================================================================
--- zy1000/trunk/build/tcl/flash.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/flash.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,154 +1,154 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="font-weight: bold;">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Program / Verify Flash</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="font-weight: bold;">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Program / Verify Flash</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			
 			<tcl>
@@ -259,119 +259,119 @@
 				
 			</form>
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/flash.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/flash.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				<p>Program and/or verify the flash on your target.</p>
@@ -382,80 +382,80 @@
 					Binary images start at address 0 by default, whereas elf and ihex have addresses encoded into the image.<br> 
 					Typically 0 for elf/ihex and the address to	write the image to for binary files.</p>
 					 
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/flashinfo.tcl
===================================================================
--- zy1000/trunk/build/tcl/flashinfo.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/flashinfo.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,152 +1,152 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="font-weight: bold;">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Flash Information</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="font-weight: bold;">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Flash Information</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 
 			<div style="font-size:14px;">Configured flash banks:</div>
@@ -188,119 +188,119 @@
 			</code>
 			
 
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/flashinfo.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/flashinfo.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				<p>Here you will find information about the flash chips that you have
@@ -309,82 +309,82 @@
 				you more detailed information about your flash. This includes information about
 				the different sectors in the flash, and the flash driver used.</p>
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/guiupload.tcl
===================================================================
--- zy1000/trunk/build/tcl/guiupload.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/guiupload.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,170 +1,170 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="openocd.tcl" style="">Run Command</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="guiupload.tcl" style="font-weight: bold;">Upload File to ZY1000</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl" style="font-weight: bold;">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Upload File to ZY1000</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="openocd.tcl" style="">Run Command</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="guiupload.tcl" style="font-weight: bold;">Upload File to ZY1000</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl" style="font-weight: bold;">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Upload File to ZY1000</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			
 			<tcl>
@@ -192,119 +192,119 @@
 			
 			</tcl>
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/guiupload.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/guiupload.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">	
 				
 				  <p>The ZY1000 has three filing systems "/rom", "/ram" and "/config". "/rom" is a read only filing
@@ -339,50 +339,50 @@
 				  </code>
 				  
 				  
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/index.tcl
===================================================================
--- zy1000/trunk/build/tcl/index.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/index.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,136 +1,136 @@
-
-	
-	
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/index.tcl" style="">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>ZY1000 Zylin JTAG Debugger</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/index.tcl" style="">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>ZY1000 Zylin JTAG Debugger</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 
 			<table>
@@ -143,6 +143,7 @@
 						Version<br>
 						OpenOCD ver.<br>
 						Build date<br>
+						PCB<br>
 						Current IP<br>
 						GDB Port
 					</td>
@@ -167,6 +168,7 @@
 						<tcl>append buffer [zy1000_version zy1000]</tcl><br>
 						<tcl>append buffer [zy1000_version openocd]</tcl><br>
 						<tcl>append buffer [zy1000_version date]</tcl><br>
+						<tcl>append buffer [zy1000_version pcb]</tcl><br>
 						<tcl>append buffer [ip]</tcl><br>
 						<tcl>append buffer [ocd_gdb_port]</tcl>
 					</td>
@@ -248,119 +250,119 @@
 				}
 			</tcl>
 
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/index.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/index.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 					<p>Target status shows that status of the connected target. </p> 
@@ -378,98 +380,98 @@
 					<p>Type "help power" in telnet for command to control power relay.</p>
 					<p><b>Reboot ZY1000</b> - Reboots ZY1000 unit. Type "help reboot" in telnet.</p>
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/log.tcl
===================================================================
--- zy1000/trunk/build/tcl/log.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/log.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,167 +1,167 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="openocd.tcl" style="">Run Command</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="guiupload.tcl" style="">Upload File to ZY1000</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl" style="font-weight: bold;">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>View Tail of Log</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="openocd.tcl" style="">Run Command</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="guiupload.tcl" style="">Upload File to ZY1000</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl" style="font-weight: bold;">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>View Tail of Log</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			<tcl>
 				append buffer "<code style=\"white-space: nowrap;\">"
@@ -174,166 +174,166 @@
 				append buffer "</code>";
 			</tcl>
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/log.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
-<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray"/>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/log.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
+<td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray"/>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/openocd.tcl
===================================================================
--- zy1000/trunk/build/tcl/openocd.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/openocd.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,164 +1,164 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="openocd.tcl" style="font-weight: bold;">Run Command</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="guiupload.tcl" style="">Upload File to ZY1000</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl" style="font-weight: bold;">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Run Command</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="openocd.tcl" style="font-weight: bold;">Run Command</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="guiupload.tcl" style="">Upload File to ZY1000</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl" style="font-weight: bold;">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Run Command</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 
 			<tcl>
@@ -183,119 +183,119 @@
 			
 			</tcl>
 
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/openocd.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/openocd.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				<p>Run tcl statement(s). Add "ocd_" prefix to OpenOCD commands otherwise
@@ -312,56 +312,56 @@
 				</code>
 				
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/preconfig.tcl
===================================================================
--- zy1000/trunk/build/tcl/preconfig.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/preconfig.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,139 +1,139 @@
-
-	
-	
-
-		
-		
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/index.tcl" style="">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Select Preconfigured Target</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/index.tcl" style="">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Select Preconfigured Target</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			
 			<tcl>
@@ -201,214 +201,214 @@
 				
 			</form>
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/preconfig.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/preconfig.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 							
 				<p>ZY1000 comes with complete configurations for various targets.</p>
 				<p>These predefined configurations include reset init scripts and flash configuration.</p>
 				<p><b>Select and reload</b> - Select configuration and reboot ZY1000 unit.</p>
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/production.tcl
===================================================================
--- zy1000/trunk/build/tcl/production.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/production.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,159 +1,159 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="font-weight: bold;">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Production</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="font-weight: bold;">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Production</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			<tcl>
 				set form_action [formfetch form_action]
@@ -206,119 +206,119 @@
 				</tr></table>
 			</form>
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/production.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/production.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				The target script can implement the "production", "production_info" and "production_test" tcl proc's. These procedures
@@ -330,75 +330,75 @@
 				<p><b>Relay off</b> - Relay off.</p>
 				<p><b>Serial number</b> - A target script can use this string in the production procedure. Type "help production" for more info.</p>
 					 
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/reload.tcl
===================================================================
--- zy1000/trunk/build/tcl/reload.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/reload.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,149 +1,149 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/index.tcl" style="">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Reload Config Scripts</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/index.tcl" style="">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Reload Config Scripts</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			
 			<tcl>
@@ -158,200 +158,200 @@
 				<input type="submit" name="form_action" value="Reload">
 			</form>
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/reload.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/reload.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				Restart ZY1000 to reload selected target config script.				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/run.tcl
===================================================================
--- zy1000/trunk/build/tcl/run.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/run.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,166 +1,166 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flashinfo.tcl" style="">Info</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="erase.tcl" style="">Erase</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="flash.tcl" style="">Program / Verify</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="production.tcl" style="">Production</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Run program</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flashinfo.tcl" style="">Info</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="erase.tcl" style="">Erase</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="flash.tcl" style="">Program / Verify</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="production.tcl" style="">Production</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl" style="font-weight: bold;">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Run program</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 
 
@@ -209,119 +209,119 @@
 			
 
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/run.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/run.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				<p>Reset and run - reset CPU and let it run.</p>
@@ -329,68 +329,68 @@
 				<p>Run from address - halt CPU and resume from address. Default is resume from current address.</p>
 				<p>Reset and init - reset CPU and run init script.</p>
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/support.tcl
===================================================================
--- zy1000/trunk/build/tcl/support.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/support.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,211 +1,210 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="zy1000.tcl" style="">Set IP Address</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="editfile.tcl" style="">Edit File</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="support.tcl" style="font-weight: bold;">Support Request</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Submit Support Request</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="zy1000.tcl" style="">Set IP Address</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="editfile.tcl" style="">Edit File</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="support.tcl" style="font-weight: bold;">Support Request</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Submit Support Request</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			Before contacting Zylin, please submit a support request with relevant information. 
 			<tcl>
-			
-			set form_config [load_config "[load_target]"]
-			set support_id [string range [rand] 0 7]
-			set form_log ""
-			append form_log "Version: [zy1000_version zy1000]"
-			append form_log "OpenOCD version: [zy1000_version openocd]"
-			append form_log "Version date: [zy1000_version date]"
-			append form_log [log]
+				set form_config [load_config "[load_target]"]
+				set support_id [string range [rand] 0 7]
+				set form_log ""
+				append form_log "Version: [zy1000_version zy1000]"
+				append form_log "OpenOCD version: [zy1000_version openocd]"
+				append form_log "Version date: [zy1000_version date]"
+				append form_log [log]
 			</tcl>
 
 			<form action="supportrequest.tcl" method="POST" target="_blank">
@@ -241,119 +240,119 @@
 			<input value="Creates support request" type="submit"/></td></tr>
 
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/support.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/support.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				Before contacting Zylin with questions, please fill in and submit this form
@@ -362,34 +361,34 @@
 				Note that you can see precisely what information is submitted to Zylin in the
 				form: the log and your config files.
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/targets.tcl
===================================================================
--- zy1000/trunk/build/tcl/targets.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/targets.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,110 +1,110 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Target config quick start guide</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Target config quick start guide</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 				
 				A target needs an openocd.cfg file. This config file sets up
@@ -121,285 +121,285 @@
 				rarely if ever needs to be changed.
 				
 				
-				</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/targets.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+				</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/targets.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 					
 					  Quick start guide on how to configure a target.
-				</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Target config quick start guide</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+				</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Target config quick start guide</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 				
 				A target needs an openocd.cfg file. This config file sets up
@@ -416,157 +416,157 @@
 				rarely if ever needs to be changed.
 				
 				
-				</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/targets.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+				</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/targets.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 					
 					  Quick start guide on how to configure a target.
-				</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+				</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/terminal.tcl
===================================================================
--- zy1000/trunk/build/tcl/terminal.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/terminal.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,204 +1,204 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/index.tcl" style="">Target Status</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>UART forwarding</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/index.tcl" style="">Target Status</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/preconfig.tcl" style="">Select Target Config</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/editconfigs.tcl" style="">Edit Configurations</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/reload.tcl" style="">Reload Config Scripts</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="/ram/cgi/log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl" style="font-weight: bold;">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>UART forwarding</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			<tcl>
 				set form_baudrate [formfetch form_baudrate]
@@ -238,119 +238,119 @@
 			<APPLET CODE="com.zylin.zy1000.Terminal.class" ARCHIVE="simpleterminal.jar" WIDTH=500 HEIGHT=250>
 			</APPLET>
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/terminal.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/terminal.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">
 				
 				Serial port data to target is forwarded(both directions) in the simple terminal window
@@ -361,30 +361,30 @@
 				the uart speed is set from the target configuration script by adding an "uart N", where
 				N is the baudrate.
 				
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/upgrade.tcl
===================================================================
--- zy1000/trunk/build/tcl/upgrade.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/upgrade.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,187 +1,187 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="zy1000.tcl" style="">Set IP Address</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="upgrade.tcl" style="font-weight: bold;">ZY1000 Firmware</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="editfile.tcl" style="">Edit File</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="support.tcl" style="">Support Request</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Upgrade ZY1000 Firmware</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="zy1000.tcl" style="">Set IP Address</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="upgrade.tcl" style="font-weight: bold;">ZY1000 Firmware</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="editfile.tcl" style="">Edit File</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="support.tcl" style="">Support Request</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Upgrade ZY1000 Firmware</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 			
 			<tcl>
@@ -220,119 +220,119 @@
 				}
 			</tcl>
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/upgrade.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/upgrade.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">	
 				
 					Upload new firmware file to ZY1000, verify that it is a valid ZY1000 firmware
@@ -346,47 +346,47 @@
 					<p/>
 					Check for new firmware at <a target="_blank" href="http://www.zylin.com/zy1000.html">http://www.zylin.com/zy1000.html<a> 
 				  
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/build/tcl/zy1000.tcl
===================================================================
--- zy1000/trunk/build/tcl/zy1000.tcl	2009-07-02 07:20:04 UTC (rev 2450)
+++ zy1000/trunk/build/tcl/zy1000.tcl	2009-07-02 09:11:18 UTC (rev 2451)
@@ -1,197 +1,197 @@
-
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		<html xmlns="http://www.w3.org/TR/REC-html40">
-<head>
-<title>Zylin ZY1000 JTAG debugger</title>
-<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
-<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
-</head>
-<tcl>
-				set console ""
-				set upload_filename /ram/upload
-			</tcl>
-<body style="margin:0px;">
-<div style="width:974px;height:85px;">
-<div style="float:left;position:relative;left:32px;width:478px;">
-<a href="/">
-<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
-</a>
-</div>
-<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
-<div style="position:relative;left:15px;top:4px;" class="textlight">
-<tcl>append buffer [zy1000_version]</tcl>
-</div>
-</div>
-</div>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:33px;">
-<div style="width:20px;height:510px;">
-								&nbsp;
-							</div>
-</td>
-<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
-<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
-<tr style="height:59px;">
-<td/>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="zy1000.tcl" style="font-weight: bold;">Set IP Address</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="editfile.tcl" style="">Edit File</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="support.tcl" style="">Support Request</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
-<div style="position:relative;left:10px;top:10px;font-weight:bold;">
-<a href="log.tcl#tail" style="">View Tail of Log</a>
-</div>
-</td>
-</tr>
-<tr>
-<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
-</tr>
-<tr>
-<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
-</tr>
-<tr>
-<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
-</tr>
-</table>
-</td>
-<td style="vertical-align:top;padding:0px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td>
-<table style="padding:0px;border-collapse:collapse;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/index.tcl">Config Target</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/flashinfo.tcl">Flash</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/browsemem.tcl">Memory</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
-</div>
-</td>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
-<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
-</div>
-</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-<tr>
-<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
-<H1>Set IP Address</H1>
-</td>
-</tr>
-<tr style="height:100%;">
+
+	
+	
+
+		
+		
+		
+		
+
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+
+		
+
+
+
+
+		
+
+
+
+		
+
+
+		
+
+
+		
+
+		
+
+
+		
+
+
+
+		
+
+		
+		
+		
+		
+		
+		
+
+		
+		
+
+		
+
+
+		
+
+
+
+		<html xmlns="http://www.w3.org/TR/REC-html40">
+<head>
+<title>Zylin ZY1000 JTAG debugger</title>
+<meta charset="utf-8" content="text/html" http-equiv="Content-Type"/>
+<link type="text/css" rel="stylesheet" href="/ram/cgi/zylweb.css"/>
+</head>
+<tcl>
+				set console ""
+				set upload_filename /ram/upload
+			</tcl>
+<body style="margin:0px;">
+<div style="width:974px;height:85px;">
+<div style="float:left;position:relative;left:32px;width:478px;">
+<a href="/">
+<img src="/rom/menu_cuts/logo_top.png" style="border:0px;"/>
+</a>
+</div>
+<div style="float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');">
+<div style="position:relative;left:15px;top:4px;" class="textlight">
+<tcl>append buffer [zy1000_version]</tcl>
+</div>
+</div>
+</div>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:33px;">
+<div style="width:20px;height:510px;">
+								&nbsp;
+							</div>
+</td>
+<td style="vertical-align:top;height:100%;width:140px;padding:0px;">
+<table style="padding:0px;border-collapse:collapse;height:100%;width:140px;">
+<tr style="height:59px;">
+<td/>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="zy1000.tcl" style="font-weight: bold;">Set IP Address</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="upgrade.tcl" style="">ZY1000 Firmware</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="editfile.tcl" style="">Edit File</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="support.tcl" style="">Support Request</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;">
+<div style="position:relative;left:10px;top:10px;font-weight:bold;">
+<a href="log.tcl#tail" style="">View Tail of Log</a>
+</div>
+</td>
+</tr>
+<tr>
+<td style="width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')"/>
+</tr>
+<tr>
+<td style="width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')"/>
+</tr>
+<tr>
+<td style="width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')"/>
+</tr>
+</table>
+</td>
+<td style="vertical-align:top;padding:0px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td>
+<table style="padding:0px;border-collapse:collapse;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/index.tcl">Config Target</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/flashinfo.tcl">Flash</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/browsemem.tcl">Memory</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/openocd.tcl">OpenOCD</a>
+</div>
+</td>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;font-weight:bold;text-align:center;width:100px;">
+<a href="/ram/cgi/zy1000.tcl" style="font-weight: bold;">Setup ZY1000</a>
+</div>
+</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td style="height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+<tr>
+<td style="background-color:#ffffff;text-indent:30px;height:40px;" colspan="6">
+<H1>Set IP Address</H1>
+</td>
+</tr>
+<tr style="height:100%;">
 <td style="background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;" colspan="6">
 
 			<tcl>
@@ -274,119 +274,119 @@
 				
 
 			
-			</td>
-</tr>
-<tcl>
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			</tcl>
-<tr style="height:100%;">
-<td style="height:100%;background-color:red;" colspan="6">
-<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
-<td style="width:25px;">&nbsp;</td>
-<tcl>
-												 		if {$show_details==1} {
-												 			append buffer <
-												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
-												 			append buffer >
-												 		} else {
-												 			append buffer <
-												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
-												 			append buffer >
-												 		}
-												 	</tcl>
-<a class="openocd" href="/ram/cgi/zy1000.tcl?toggle_details=1">
-<tcl>
-															if {$show_details==1} {
-																append buffer "Hide details"
-													 			append buffer <br/>
-															} else {
-																append buffer {<div style="position:relative;top:7px;text-align:center;">}
-																append buffer "Show details"
-																append buffer {</div>}
-															}
-															</tcl>
-</a>
-<tcl>
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	</tcl></td><tcl>
-													 	if {$show_details!=1} {
-													 		append buffer {<td>&nbsp;</td>}
-													 	}
-													 </tcl>
-<td style="width:25px;">&nbsp;</td>
-</table>
-</td>
-</tr>
-<tcl>
-									 }
-								</tcl>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
-<div style="width:500px;background-color:#ffffff;height:100%;">
-								 			&nbsp;
-							 			</div>
-</td>
-</tr>
-</table>
-</td>
-<td style="width:6px;"/>
-<td style="width:245px;height:100%">
-<table style="padding:0px;border-collapse:collapse;height:100%;">
-<tr>
-<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
-<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
-										    Documentation
-										 </div>
-</td>
-<td width="40px">
-								 		&nbsp;
-								 	</td>
-<td/>
-</tr>
-<tr>
-<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
-<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
-<br/>
-<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr>
-<td colspan="3">
-<table style="padding:0px;border-collapse:collapse;">
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-<td style="background-color:#999999;width:225px; height:1px;"/>
-<td style="background-color:#d8d7d7;width:10px;height:1px"/>
-</table>
-</td>
-</tr>
-<tr>
-<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
-</tr>
-<tr style="height:100%;">
+			</td>
+</tr>
+<tcl>
+							 		
+								 	set toggle_details [formfetch toggle_details]
+								 	if {[string length $toggle_details]==0} {
+								 		set toggle_details 0
+								 	}
+								 	set show_details [load_var show_details]
+								 	if {[string length $show_details]==0} {
+								 		set show_details 0
+								 	}
+								 	if {$toggle_details==1} {
+								 		set show_details [expr 1-$show_details]
+								 		save_var show_details $show_details
+								 	}
+								 	
+							 		if {[string length $console]!=0} {
+							 			</tcl>
+<tr style="height:100%;">
+<td style="height:100%;background-color:red;" colspan="6">
+<table style="padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%" class="textgray">
+<td style="width:25px;">&nbsp;</td>
+<tcl>
+												 		if {$show_details==1} {
+												 			append buffer <
+												 			append buffer {td style="background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;"}
+												 			append buffer >
+												 		} else {
+												 			append buffer <
+												 			append buffer {td style="background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;"}
+												 			append buffer >
+												 		}
+												 	</tcl>
+<a class="openocd" href="/ram/cgi/zy1000.tcl?toggle_details=1">
+<tcl>
+															if {$show_details==1} {
+																append buffer "Hide details"
+													 			append buffer <br/>
+															} else {
+																append buffer {<div style="position:relative;top:7px;text-align:center;">}
+																append buffer "Show details"
+																append buffer {</div>}
+															}
+															</tcl>
+</a>
+<tcl>
+													 		if {$show_details==1} {
+													 			append buffer $console
+													 		}
+													 	</tcl></td><tcl>
+													 	if {$show_details!=1} {
+													 		append buffer {<td>&nbsp;</td>}
+													 	}
+													 </tcl>
+<td style="width:25px;">&nbsp;</td>
+</table>
+</td>
+</tr>
+<tcl>
+									 }
+								</tcl>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;" colspan="6">
+<div style="width:500px;background-color:#ffffff;height:100%;">
+								 			&nbsp;
+							 			</div>
+</td>
+</tr>
+</table>
+</td>
+<td style="width:6px;"/>
+<td style="width:245px;height:100%">
+<table style="padding:0px;border-collapse:collapse;height:100%;">
+<tr>
+<td style="width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;">
+<div style="position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;" class="textgray">
+										    Documentation
+										 </div>
+</td>
+<td width="40px">
+								 		&nbsp;
+								 	</td>
+<td/>
+</tr>
+<tr>
+<td style="height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');" colspan="3"/>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;" colspan="3">
+<a target="_blank" href="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">Quick Start Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000/openocd.pdf">OpenOCD Manual</a>
+<br/>
+<a target="_blank" href="http://www.zylin.com/zy1000_contact.html">Contact Zylin AS</a>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr>
+<td colspan="3">
+<table style="padding:0px;border-collapse:collapse;">
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+<td style="background-color:#999999;width:225px; height:1px;"/>
+<td style="background-color:#d8d7d7;width:10px;height:1px"/>
+</table>
+</td>
+</tr>
+<tr>
+<td style="background-color:#d8d7d7;height:15px;" colspan="3"/>
+</tr>
+<tr style="height:100%;">
 <td style="height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;" colspan="3" class="textgray">	
 				
 					<p>ZY1000 supports DHCP and fixed IP address.  
@@ -396,37 +396,37 @@
 					The gateway is optional. Leave blank if not in use.</p>
 					<p><b>Use DHCP</b> - Use dynamic DHCP address.</p>
 				  
-			</td>
-</tr>
-<tr>
-<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
-							 			&nbsp;
-							 		</td>
-</tr>
-</table>
-</td>
-</tr>
-<tr>
-<td/>
-<td>
-<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
-</td>
-<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						</td>
-</tr>
-</table>
-</body>
-</html>
-
-		
-		
-
-
-
-		
-
-
-		
-	
-	
+			</td>
+</tr>
+<tr>
+<td style="height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');" colspan="3">
+							 			&nbsp;
+							 		</td>
+</tr>
+</table>
+</td>
+</tr>
+<tr>
+<td/>
+<td>
+<img border="0" src="/rom/menu_cuts/logo_bottom.png"/>
+</td>
+<td style="padding-top:10px;padding-left:10px;margin-top:10px;" class="textlight">
+							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
+						</td>
+</tr>
+</table>
+</body>
+</html>
+
+		
+		
+
+
+
+		
+
+
+		
+	
+	

Modified: zy1000/trunk/snapshots/athttpd.zip
===================================================================
(Binary files differ)

Modified: zy1000/trunk/snapshots/discover.zip
===================================================================
(Binary files differ)

Modified: zy1000/trunk/snapshots/jimtcl.zip
===================================================================
(Binary files differ)



From oharboe at mail.berlios.de  Thu Jul  2 11:12:43 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 2 Jul 2009 11:12:43 +0200
Subject: [Openocd-svn] r2452 - trunk
Message-ID: <200907020912.n629ChYZ001296@sheep.berlios.de>

Author: oharboe
Date: 2009-07-02 11:12:43 +0200 (Thu, 02 Jul 2009)
New Revision: 2452

Modified:
   trunk/
Log:
add svn:ignore to INSTALL file (it's generated)


Property changes on: trunk
___________________________________________________________________
Name: svn:ignore
   - autom4te.cache
.project
aclocal.m4
config.guess
config.h.in
config.sub
configure
depcomp
install-sh
Makefile.in
missing
compile
ltmain.sh.lnk
ltmain.sh

   + autom4te.cache
.project
aclocal.m4
config.guess
config.h.in
config.sub
configure
depcomp
install-sh
Makefile.in
missing
compile
ltmain.sh.lnk
ltmain.sh
INSTALL




From zwelch at mail.berlios.de  Thu Jul  2 12:54:39 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 2 Jul 2009 12:54:39 +0200
Subject: [Openocd-svn] r2453 - trunk/doc/manual
Message-ID: <200907021054.n62Asdj7029669@sheep.berlios.de>

Author: zwelch
Date: 2009-07-02 12:54:30 +0200 (Thu, 02 Jul 2009)
New Revision: 2453

Added:
   trunk/doc/manual/release.txt
Modified:
   trunk/doc/manual/main.txt
Log:
Commit first draft of release process documentation.

Modified: trunk/doc/manual/main.txt
===================================================================
--- trunk/doc/manual/main.txt	2009-07-02 09:12:43 UTC (rev 2452)
+++ trunk/doc/manual/main.txt	2009-07-02 10:54:30 UTC (rev 2453)
@@ -18,6 +18,7 @@
   follow when submitting patches to the project.
 - The @subpage bugs page contains the content of the BUGS file, which
   provides instructions for submitting bug reports to the maintainers.
+- The @subpage releases page describes the project's release process.
 
 @ref primer provide introductory materials for new developers on various
 specific topics.

Added: trunk/doc/manual/release.txt
===================================================================
--- trunk/doc/manual/release.txt	2009-07-02 09:12:43 UTC (rev 2452)
+++ trunk/doc/manual/release.txt	2009-07-02 10:54:30 UTC (rev 2453)
@@ -0,0 +1,122 @@
+/** @page releases Release Processes
+
+This page provides an introduction to the OpenOCD Release Proceses:
+- @ref releaseswhy
+- @ref releaseswho
+- @ref releaseswhen
+- @ref releaseshow
+
+ at section releaseswhy Why Produce Releases?
+
+The OpenOCD maintainers should produce releases periodically.
+he reasons for several reasons that should be given in detail, before
+explaining who and how the processes occur.
+
+At any time, a "source archives" can be produced by running 'make dist'
+in the OpenOCD project tree.  With the 0.2.0 release, this command will
+produce openocd-\<version\>.{tar.gz,tar.bz2,zip} archives, which will be
+suitable for being released when produced properly.
+
+When released for users, these archives present several important
+advantages when contrasted to using the Subversion repository:
+
+-# They allow others to package and distribute the code to users.
+-# They build easier for developers, because they contain
+   a working configure script that was produced by the Release Manager.
+-# They prevent users from trying a random HEAD revision of the trunk.
+-# They free developers from answering questions about trunk breakage.
+
+Hopefully, this shows several good reasons to produce regular releases,
+but these release processes were developed with some additional design
+goals in mind.  Specifically, the releases processes should have the
+following properties:
+
+-# Produce successive sets of release archives cleanly and consistently.
+  - Implementable as a script that automates the critical release steps.
+-# Prevent human operators from doing it wrong, as much as possible.
+-# Allow scheduling and automation of release process milestones.
+
+The current release processes are documented in the following sections.
+They attempt to meet these design goals, but there are many improvements
+remaining to be made toward automating the process.
+
+ at section releaseswho OpenOCD Release Manager
+
+OpenOCD archive releases will be produced by an individual filling the
+role of <i>Release Manager</i>.  This individual determines the schdule
+(@see releaseswhen) and executes the release processes for the
+community.  Each release requires one individual to fulfill this role,
+and these processes should survive any such transition gracefully.
+
+ at section releaseswhen OpenOCD Release Schedule
+
+The OpenOCD release process must be carried out on a periodic basis
+in order to realize the benefits outlined above (@see releaseswhy).
+
+Starting with the 0.2.0 release, the OpenOCD project should produce a
+new minor release each month, with a major release once per year.  Bug
+fix releases could be provided more frequently; however, these should
+not be a priority for the Release Manager until the processes have been
+fully automated, to use resources most efficiently.
+
+If T is the time of the next release, then the following milestones
+describe the release milestones for each new release cycle.
+
+- T minus one month: start of new development cycle
+- T minus two weeks: announce pending trunk closure to new work
+- T minus one week: close trunk to new work, begin testing phase
+- T minus two days: call for final bug fixes
+- T minus one day: produce -rc packages and distribute to testers
+- T minus one hour: produce final packages and post on-line
+
+The process of scheduling release milestones should be community driven,
+though the Release Manager should attempt to follow these guidelines.
+Specifically, missing features that were scheduled for a release should
+be dropped, rather than delaying the release cycle to wait for them.
+
+ at section releaseshow Release Process: Step-by-Step
+
+The exact process likely requires a few releases to work out the bugs,
+as it will take some experience before a script can be developed and
+tested that does everything safely and robustly.  Even then, some steps
+require clear user intervention -- and not only by the release manager.
+
+-# Produce final patches to the trunk (or release branch):
+  - add NEWS item to describe the release changes? (not ready for 0.2.0)
+    - the community should try to help produce this material
+    - can be used to automatically post "blurbs" about the project.
+  - bump library version if our API changed (not yet required)
+  - bump package version
+-# Produce and verify the binary packages:
+  -# Start with a clean working copy, used for producing releases only.
+  -# produce a ChangeLog for the release (using svn2cl).
+  -# bootstrap, configure, and build the package.
+  -# run 'make distcheck' to produce the distribution archives.
+  -# run 'make maintainer-clean'; verify the repository is empty again.
+-# Branch or tag the required tree in the Subversion repository:
+  - For a major/minor release from the main trunk, branch and tag it: 
+    -# svn cp .../trunk .../branches/${BRANCH_VERSION}
+    -# svn cp .../branches/${BRANCH_VERSION} .../tags/${PACKAGE_VERSION}
+  - For a bug-fix or final release from a release branch, only tag it:
+    -# svn cp .../branches/${BRANCH_VERSION} .../tags/${PACKAGE_VERSION}
+  - where:
+    - BRANCH_VERSION - is x.0.0-trunk or x.y.0-trunk
+    - PACKAGE_VERSION - is x.y.z
+-# Upload packages and post announcements of their availability:
+  -# Release packages into files section of berliOS project site.
+  -# Post announcement e-mail to the openocd-development list.
+-# After the community has checked their sanity, we can post "blurbs":
+  -# Post NEWS update to freshmeat.net and other trackers.
+  -# Submit big NEWS updates to news feeds (e.g. Digg, Reddit, etc.).
+
+Totally-automated packaging and distribution of OpenOCD requires more
+patching (post-0.2.0), but the final script(s) should be able to manage
+most steps in these processes.  The steps requiring user input can be
+guided by an "assistant" that walks the Release Manager through the
+process from beginning to end, performing basic sanity checks on their
+various inputs (e.g. the NEWS blurb).
+
+ */
+/** @file
+This file contains the @ref releases page.
+ */


Property changes on: trunk/doc/manual/release.txt
___________________________________________________________________
Name: svn:eol-style
   + native



From zwelch at mail.berlios.de  Thu Jul  2 13:17:01 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 2 Jul 2009 13:17:01 +0200
Subject: [Openocd-svn] r2454 - trunk/src/jtag
Message-ID: <200907021117.n62BH1HB020551@sheep.berlios.de>

Author: zwelch
Date: 2009-07-02 13:16:57 +0200 (Thu, 02 Jul 2009)
New Revision: 2454

Modified:
   trunk/src/jtag/ft2232.c
Log:
Fix FTD2XX build for CygWin.


Modified: trunk/src/jtag/ft2232.c
===================================================================
--- trunk/src/jtag/ft2232.c	2009-07-02 10:54:30 UTC (rev 2453)
+++ trunk/src/jtag/ft2232.c	2009-07-02 11:16:57 UTC (rev 2454)
@@ -1885,7 +1885,7 @@
 			{
 				LOG_ERROR("ListDevices: %lu\n", num_devices);
 				for (i = 0; i < num_devices; i++)
-					LOG_ERROR("%i: \"%s\"", i, desc_array[i]);
+					LOG_ERROR("%" PRIu32 ": \"%s\"", i, desc_array[i]);
 			}
 
 			for (i = 0; i < num_devices; i++)



From zwelch at mail.berlios.de  Thu Jul  2 13:17:10 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 2 Jul 2009 13:17:10 +0200
Subject: [Openocd-svn] r2455 - in trunk/tcl: board target
Message-ID: <200907021117.n62BHA7D020770@sheep.berlios.de>

Author: zwelch
Date: 2009-07-02 13:17:04 +0200 (Thu, 02 Jul 2009)
New Revision: 2455

Modified:
   trunk/tcl/board/csb337.cfg
   trunk/tcl/board/omap2420_h4.cfg
   trunk/tcl/target/icepick.cfg
   trunk/tcl/target/omap2420.cfg
   trunk/tcl/target/ti_dm6446.cfg
Log:
Remove vim editor commands from TCL files.


Modified: trunk/tcl/board/csb337.cfg
===================================================================
--- trunk/tcl/board/csb337.cfg	2009-07-02 11:16:57 UTC (rev 2454)
+++ trunk/tcl/board/csb337.cfg	2009-07-02 11:17:04 UTC (rev 2455)
@@ -112,5 +112,3 @@
 }
 
 $_TARGETNAME configure -event reset-init {csb337_reset_init}
-
-# vim:syntax tcl

Modified: trunk/tcl/board/omap2420_h4.cfg
===================================================================
--- trunk/tcl/board/omap2420_h4.cfg	2009-07-02 11:16:57 UTC (rev 2454)
+++ trunk/tcl/board/omap2420_h4.cfg	2009-07-02 11:17:04 UTC (rev 2455)
@@ -10,5 +10,3 @@
 # has 64M NAND on cs6.
 flash bank cfi 0x04000000 0x02000000 2 2 $_TARGETNAME
 flash bank cfi 0x06000000 0x02000000 2 2 $_TARGETNAME
-
-# vim:syntax tcl

Modified: trunk/tcl/target/icepick.cfg
===================================================================
--- trunk/tcl/target/icepick.cfg	2009-07-02 11:16:57 UTC (rev 2454)
+++ trunk/tcl/target/icepick.cfg	2009-07-02 11:17:04 UTC (rev 2455)
@@ -19,5 +19,3 @@
 	irscan $jrc 0x3F -endstate RUN/IDLE
 	runtest 10
 }
-
-# vim:syntax tcl

Modified: trunk/tcl/target/omap2420.cfg
===================================================================
--- trunk/tcl/target/omap2420.cfg	2009-07-02 11:16:57 UTC (rev 2454)
+++ trunk/tcl/target/omap2420.cfg	2009-07-02 11:17:04 UTC (rev 2455)
@@ -57,5 +57,3 @@
 # REVISIT ... as of 12-June-2009, OpenOCD's ETM code can't talk to ARM11 cores.
 #etm config $_TARGETNAME 16 normal full etb
 #etb config $_TARGETNAME $_CHIPNAME.etb
-
-# vim:syntax tcl

Modified: trunk/tcl/target/ti_dm6446.cfg
===================================================================
--- trunk/tcl/target/ti_dm6446.cfg	2009-07-02 11:16:57 UTC (rev 2454)
+++ trunk/tcl/target/ti_dm6446.cfg	2009-07-02 11:17:04 UTC (rev 2455)
@@ -75,5 +75,3 @@
 # trace setup
 etm config $_TARGETNAME 16 normal full etb
 etb config $_TARGETNAME $_CHIPNAME.etb
-
-# vim:syntax tcl



From zwelch at mail.berlios.de  Thu Jul  2 13:17:18 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 2 Jul 2009 13:17:18 +0200
Subject: [Openocd-svn] r2456 - trunk
Message-ID: <200907021117.n62BHIx0021056@sheep.berlios.de>

Author: zwelch
Date: 2009-07-02 13:17:14 +0200 (Thu, 02 Jul 2009)
New Revision: 2456

Modified:
   trunk/README
   trunk/configure.in
Log:
Remove --enable-release option; if guess-rev.sh is missing, it is a release.


Modified: trunk/README
===================================================================
--- trunk/README	2009-07-02 11:17:04 UTC (rev 2455)
+++ trunk/README	2009-07-02 11:17:14 UTC (rev 2456)
@@ -252,11 +252,6 @@
   --disable-wextra        Disable extra compiler warnings
   --disable-werror        Do not treat warnings as errors
 
-  --enable-release        Enable building of an OpenOCD release.  This
-			  option is intended for project maintainers.
-			  It simply omits the svn version string when
-			  the openocd -v is executed (to KISS).
-
   --disable-option-checking
                           Ignore unrecognized --enable and --with options.
   --disable-dependency-tracking  speeds up one-time build

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-07-02 11:17:04 UTC (rev 2455)
+++ trunk/configure.in	2009-07-02 11:17:14 UTC (rev 2456)
@@ -89,17 +89,20 @@
 is_mingw=no
 is_win32=no
 is_darwin=no
-build_release=yes
 
-AC_ARG_ENABLE(release,
-  AS_HELP_STRING([--enable-release], [Enable Release Build, default no]),
-  [build_release=$enableval], [build_release=no])
+if test $cross_compiling = no; then
+  # guess-rev.sh only exists in the repository, not in the released archives
+  AC_CHECK_FILE("$srcdir/guess-rev.sh", has_guess_rev=yes, has_guess_rev=no)
 
-if test $cross_compiling = no; then
-  if test $build_release = no; then
-    # check we can find guess-rev.sh
-    AC_CHECK_FILE("$srcdir/guess-rev.sh", build_release=no, build_release=yes)
+  AC_MSG_CHECKING([whether to build a release])
+  if test $has_guess_rev = no; then
+    build_release=yes
+  else
+    build_release=no
   fi
+  AC_MSG_RESULT($build_release)
+else
+  build_release=yes
 fi
 
 # We are not *ALWAYS* being installed in the standard place.



From zwelch at mail.berlios.de  Thu Jul  2 13:17:26 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 2 Jul 2009 13:17:26 +0200
Subject: [Openocd-svn] r2457 - trunk
Message-ID: <200907021117.n62BHQ0I021255@sheep.berlios.de>

Author: zwelch
Date: 2009-07-02 13:17:21 +0200 (Thu, 02 Jul 2009)
New Revision: 2457

Modified:
   trunk/AUTHORS
Log:
Add AUTHORS for 0.2.0 release.


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2009-07-02 11:17:14 UTC (rev 2456)
+++ trunk/AUTHORS	2009-07-02 11:17:21 UTC (rev 2457)
@@ -6,3 +6,7 @@
 ?yvind Harboe <oyvind.harboe at zylin.com>
 Duane Ellis <openocd at duaneellis.com>
 Michael Schwingen <michael at schwingen.org>
+Rick Altherr <kc8apf at users.berlios.de>
+David Brownell <dbrownell at users.sourceforge.net>
+Vincint Palatin <vpalatin at users.berlios.de>
+Zachary T Welch <zw at superlucidity.net>



From zwelch at mail.berlios.de  Thu Jul  2 13:18:51 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 2 Jul 2009 13:18:51 +0200
Subject: [Openocd-svn] r2458 - trunk
Message-ID: <200907021118.n62BIpBM023017@sheep.berlios.de>

Author: zwelch
Date: 2009-07-02 13:18:45 +0200 (Thu, 02 Jul 2009)
New Revision: 2458

Added:
   trunk/AUTHORS.ChangeLog
Log:
Add AUTHORS.ChangeLog file suitable to be passed to 'svn2cl --authors'.


Added: trunk/AUTHORS.ChangeLog
===================================================================
--- trunk/AUTHORS.ChangeLog	2009-07-02 11:17:21 UTC (rev 2457)
+++ trunk/AUTHORS.ChangeLog	2009-07-02 11:18:45 UTC (rev 2458)
@@ -0,0 +1,10 @@
+drath:Dominic Rath <Dominic.Rath at gmx.de>
+mlu:Magnus Lundin <lundin at mlu.mine.nu>
+mifi:Michael Fischer <fischermi at t-online.de>
+ntfreak:Spencer Oliver <spen at spen-soft.co.uk>
+duane:Duane Ellis <openocd at duaneellis.com>
+oharboe:?yvind Harboe <oyvind.harboe at zylin.com>
+kc8apf:Rick Altherr <kc8apf at users.berlios.de>
+zwelch:Zachary T Welch <zw at superlucidity.net>
+vpalatin:Vincent Palatin <vpalatin at users.berlios.de>
+bodylove:Carsten Schlote <schlote at vahanus.net>


Property changes on: trunk/AUTHORS.ChangeLog
___________________________________________________________________
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Thu Jul  2 19:47:11 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Thu, 2 Jul 2009 19:47:11 +0200
Subject: [Openocd-svn] r2459 - trunk/tcl/target
Message-ID: <200907021747.n62HlBoY010344@sheep.berlios.de>

Author: oharboe
Date: 2009-07-02 19:47:10 +0200 (Thu, 02 Jul 2009)
New Revision: 2459

Modified:
   trunk/tcl/target/aduc702x.cfg
Log:
Xiaofan Chen <xiaofanc at gmail.com> With this patch, OpenOCD can talk to my
Analog Device Eval-ADuC7060 eval board.

Modified: trunk/tcl/target/aduc702x.cfg
===================================================================
--- trunk/tcl/target/aduc702x.cfg	2009-07-02 11:18:45 UTC (rev 2458)
+++ trunk/tcl/target/aduc702x.cfg	2009-07-02 17:47:10 UTC (rev 2459)
@@ -5,7 +5,7 @@
 if { [info exists CHIPNAME] } {	
    set  _CHIPNAME $CHIPNAME    
 } else {	 
-   set  _CHIPNAME s3c2410
+   set  _CHIPNAME aduc702x
 }
 
 if { [info exists ENDIAN] } {	
@@ -18,7 +18,7 @@
 if { [info exists CPUTAPID] } {	
    set  _CPUTAPID $CPUTAPID    
 } else {	 
-   set  _CPUTAPID 0xffffffff
+   set  _CPUTAPID 0x3f0f0f0f
 }
 
 



From oharboe at mail.berlios.de  Fri Jul  3 09:19:19 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 3 Jul 2009 09:19:19 +0200
Subject: [Openocd-svn] r2460 - trunk/doc
Message-ID: <200907030719.n637JJA9019133@sheep.berlios.de>

Author: oharboe
Date: 2009-07-03 09:19:18 +0200 (Fri, 03 Jul 2009)
New Revision: 2460

Modified:
   trunk/doc/
Log:
more files to svn:ignore


Property changes on: trunk/doc
___________________________________________________________________
Name: svn:ignore
   - Makefile.in
mdate-sh
openocd.info
stamp-vti
texinfo.tex
version.texi

   + Makefile.in
mdate-sh
openocd.info
stamp-vti
texinfo.tex
version.texi
openocd.info-1
openocd.info-2




From oharboe at mail.berlios.de  Fri Jul  3 14:57:32 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 3 Jul 2009 14:57:32 +0200
Subject: [Openocd-svn] r2461 - zy1000/trunk/snapshots
Message-ID: <200907031257.n63CvW5B013734@sheep.berlios.de>

Author: oharboe
Date: 2009-07-03 14:56:34 +0200 (Fri, 03 Jul 2009)
New Revision: 2461

Modified:
   zy1000/trunk/snapshots/repository.zip
Log:
bugfix for eCos romfs

Modified: zy1000/trunk/snapshots/repository.zip
===================================================================
(Binary files differ)



From zwelch at mail.berlios.de  Sat Jul  4 05:47:57 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Sat, 4 Jul 2009 05:47:57 +0200
Subject: [Openocd-svn] r2462 - trunk/doc/manual
Message-ID: <200907040347.n643lv90021687@sheep.berlios.de>

Author: zwelch
Date: 2009-07-04 05:47:54 +0200 (Sat, 04 Jul 2009)
New Revision: 2462

Modified:
   trunk/doc/manual/release.txt
Log:
Major update to release process documentation:
- Provide overview of OpenOCD versioning schema.
- Outline responsibilities and authority of the release manager.
- Explain the need for flexibility in the release schedule.
- Add and refine the release process steps.
- Include tutorials for using new release script.
- Many more improvements, too numerous to list.


Modified: trunk/doc/manual/release.txt
===================================================================
--- trunk/doc/manual/release.txt	2009-07-03 12:56:34 UTC (rev 2461)
+++ trunk/doc/manual/release.txt	2009-07-04 03:47:54 UTC (rev 2462)
@@ -1,21 +1,29 @@
 /** @page releases Release Processes
 
-This page provides an introduction to the OpenOCD Release Proceses:
-- @ref releaseswhy
-- @ref releaseswho
-- @ref releaseswhen
-- @ref releaseshow
+This page provides an introduction to the OpenOCD Release Processes:
 
- at section releaseswhy Why Produce Releases?
+- @ref releasewhy - Explain the motivations for producing
+  releases on a regular basis.
+- @ref releasewho - Describes the responsibilities and
+  authority required to produce official OpenOCD releases.
+- @ref releasewhen - Provides guidelines for scheduling
+  activities for each release cycle.
+- @ref releasehow - Outlines all of the steps for the
+  processes used to produce and release the package source archives.
+- @ref releasescript - Introduces the automated @c release.sh script.
 
-The OpenOCD maintainers should produce releases periodically.
-he reasons for several reasons that should be given in detail, before
-explaining who and how the processes occur.
+ at section releasewhy Why Produce Releases?
 
+The OpenOCD maintainers should produce <i>releases</i> periodically.  This
+section gives several reasons to explain the reasons for making releases
+on a regular basis.  These reasons lead to motivation for developing and
+following a set of <i>release processes</i>.  The actual processes are
+described in the remainder of the @ref releases sections.
+
 At any time, a "source archives" can be produced by running 'make dist'
 in the OpenOCD project tree.  With the 0.2.0 release, this command will
-produce openocd-\<version\>.{tar.gz,tar.bz2,zip} archives, which will be
-suitable for being released when produced properly.
+produce openocd-\<version\>.{tar.gz,tar.bz2,zip} archives.  These files
+will be suitable for being released when produced properly.
 
 When released for users, these archives present several important
 advantages when contrasted to using the Subversion repository:
@@ -32,61 +40,163 @@
 following properties:
 
 -# Produce successive sets of release archives cleanly and consistently.
-  - Implementable as a script that automates the critical release steps.
--# Prevent human operators from doing it wrong, as much as possible.
+-# Implementable as a script that automates the critical release steps.
+-# Prevent human operators from producing bad releases, when possible.
 -# Allow scheduling and automation of release process milestones.
 
 The current release processes are documented in the following sections.
-They attempt to meet these design goals, but there are many improvements
+They attempt to meet these design goals, but there may improvements
 remaining to be made toward automating the process.
 
- at section releaseswho OpenOCD Release Manager
+ at section releaseversions Release Versions
 
+The OpenOCD version string is composed of three numeric components
+separated by two decimal points: @c x.y.z, where @c x is the @a major
+version number, @c y is the @a minor number, and @c z is the @a micro.
+
+For a <i>bug-fix</i> release, the micro version number will be non-zero
+(<code>z > 0</code>).  For a <i>minor release</i>, the micro version
+number will be zero (<code>z = 0</code>).  For a <i>major releases</i>,
+the minor version will @a also be zero (<code>y = 0, z = 0</code>).
+
+The trunk and all branches should have the tag '-in-development' in
+their version number.  This tag helps developers identify reports
+created from the Subversion repository, and it can be detected and
+manipulated by the release script.  Specifically, this tag will be
+removed and re-added during the release process; it should never be
+manipulated by developers in submitted patches.
+
+ at subsection releaseversionsdist Patched Versions
+
+Distributors of patched versions of OpenOCD are encouraged to extend
+the version string when producing external releases, as this helps to
+identify your particular distribution series.
+
+ at subsection releaseversionsdist Version Processes
+
+The release process includes version number manipulations to the tree
+being released, ensuring that all numbers are incremented at the right
+time and in the proper locations of the repository.
+
+The version numbers for any branch should monotonically
+increase to the next successive integer, except when reset to zero
+during major or minor releases.  The community should decide when
+major and minor milestones will be released.
+
+ at section releasewho Release Manager
+
 OpenOCD archive releases will be produced by an individual filling the
-role of <i>Release Manager</i>.  This individual determines the schdule
-(@see releaseswhen) and executes the release processes for the
-community.  Each release requires one individual to fulfill this role,
-and these processes should survive any such transition gracefully.
+role of <i>Release Manager</i>, hereafter abbreviated as <i>RM</i>.  This
+individual determines the schedule and executes the release processes
+for the community.
 
- at section releaseswhen OpenOCD Release Schedule
+ at subsection releasewhohow RM Authority
 
-The OpenOCD release process must be carried out on a periodic basis
-in order to realize the benefits outlined above (@see releaseswhy).
+Each release requires one individual to fulfill the RM role; however,
+graceful transitions of this authority may take place at any time.  The
+current RM may transfer their authority to another contributor in a post
+to the OpenOCD development mailing list.  Such delegation of authority
+must be approved by the individual that will receive it and the
+community of maintainers.  Initial arrangements with the new RM should
+be made off-list, as not every contributor wants these responsibilities.
 
+ at subsection releasewhowhat RM Responsibilities
+
+In addition to the actual process of producing the releases, the RM is
+responsible for keeping the community informed of all progress through
+the release cycle(s) being managed.  The RM is responsible for managing
+the changes to the package version, though the release tools should
+manage the tasks of adding or removing any required development branch
+tags and incrementing the version.
+
+ at section releasewhen Release Schedule
+
+The OpenOCD release process must be carried out on a periodic basis, so
+the project can realize the benefits presented in answer to the question,
+ at ref releasewhy.  
+
 Starting with the 0.2.0 release, the OpenOCD project should produce a
-new minor release each month, with a major release once per year.  Bug
-fix releases could be provided more frequently; however, these should
-not be a priority for the Release Manager until the processes have been
-fully automated, to use resources most efficiently.
+new minor release every month or two, with a major release once a year.
+Bug fix releases could be provided more frequently.  These release
+schedule goals may be adjusted in the future, after the project
+maintainers and distributors receive feedback and experience.
 
-If T is the time of the next release, then the following milestones
-describe the release milestones for each new release cycle.
+More importantly, the statements made in this section do not create an
+obligation by any member of the OpenOCD community to produce new
+releases on regular schedule, now or in the future.
 
+ at subsection releasewhenexample Sample Schedule
+
+The RM must pro-actively communicate with the community from the
+beginning of the development cycle through the delivery of the new
+release.  This section presents guidelines for scheduling key points
+where the community must be informed of changing conditions.
+
+If T is the time of the next release, then the following schedule 
+might describe some of the key milestones of the new release cycle:
+
 - T minus one month: start of new development cycle
 - T minus two weeks: announce pending trunk closure to new work
 - T minus one week: close trunk to new work, begin testing phase
 - T minus two days: call for final bug fixes
 - T minus one day: produce -rc packages and distribute to testers
 - T minus one hour: produce final packages and post on-line
+- T minus zero: Announce the release to our mailing list and the world.
 
-The process of scheduling release milestones should be community driven,
-though the Release Manager should attempt to follow these guidelines.
-Specifically, missing features that were scheduled for a release should
-be dropped, rather than delaying the release cycle to wait for them.
+Some additional supplemental communication will be desirable.  The above
+list omits the step-by-step instructions to daily release management.
+Individuals performing release management need to have the ability to
+interact proactively with the community as a whole, anticipating when
+such interaction will be required and giving ample notification.
 
- at section releaseshow Release Process: Step-by-Step
+The next section explains why the OpenOCD project allows significant
+flexibility in the part of the development that precedes the release
+process.
 
-The exact process likely requires a few releases to work out the bugs,
-as it will take some experience before a script can be developed and
-tested that does everything safely and robustly.  Even then, some steps
-require clear user intervention -- and not only by the release manager.
+ at note The OpenOCD project does not presently produce -rc packages.  As
+such, the step suggested in the list above should be read as trying to
+stimulate others to test the project build and packaging on as many
+platforms as possible.  This proposition will be palatable once release
+management tools have been committed to the tree.
 
+ at subsection releasewhenflex Schedule Flexibility
+
+The Release Manager should attempt to follow the guidelines in this
+document, but the process of scheduling each release milestone should be
+community driven at the start.  By the end, missing features that were
+scheduled for a release must be dropped by the Release Manager, rather
+than allowing the release cycle to be delayed while waiting for them.
+
+Despite any assurances this schedule may appear to give, the Release
+Manager cannot schedule the work that will be done on the project,
+when it will be submitted, review, and deemed suitable to be committed.
+In this way, the RM cannot act as a priest in a cathedral; OpenOCD uses
+the bazaar development model.  The release schedule must adapt
+continuously in response to changes in the rate of churn.
+
+In particular, the suggested period of "one or two month" reflects some
+expectation of a fairly high rate of development.  Fewer releases may be
+required if developers contribute less patches, and more releases may be
+desirable if the project continues to grow and experience high rates of
+community contribution.  During each cycle, the RM should be tracking
+the situation and gathering feedback from the community .
+
+ at section releasehow Release Process: Step-by-Step
+
+The release process may require a few iterations to work out any bugs.
+Even with the release script, some steps require clear user intervention
+-- and not only by the Release Manager.
+
+The following steps should be followed to produce each release:
+
 -# Produce final patches to the trunk (or release branch):
-  - add NEWS item to describe the release changes? (not ready for 0.2.0)
+  -# add NEWS item to describe the release changes? (not ready for 0.2.0)
     - the community should try to help produce this material
     - can be used to automatically post "blurbs" about the project.
-  - bump library version if our API changed (not yet required)
-  - bump package version
+  -# bump library version if our API changed (not yet required)
+  -# Remove -in-development tag from package version:
+    - For major/minor releases, remove version tag from trunk.
+    - For bug-fix releases, remove version tag from release branch.
 -# Produce and verify the binary packages:
   -# Start with a clean working copy, used for producing releases only.
   -# produce a ChangeLog for the release (using svn2cl).
@@ -94,28 +204,181 @@
   -# run 'make distcheck' to produce the distribution archives.
   -# run 'make maintainer-clean'; verify the repository is empty again.
 -# Branch or tag the required tree in the Subversion repository:
-  - For a major/minor release from the main trunk, branch and tag it: 
-    -# svn cp .../trunk .../branches/${BRANCH_VERSION}
-    -# svn cp .../branches/${BRANCH_VERSION} .../tags/${PACKAGE_VERSION}
-  - For a bug-fix or final release from a release branch, only tag it:
-    -# svn cp .../branches/${BRANCH_VERSION} .../tags/${PACKAGE_VERSION}
-  - where:
-    - BRANCH_VERSION - is x.0.0-trunk or x.y.0-trunk
-    - PACKAGE_VERSION - is x.y.z
+  - Tags and branches for releases must be named consistently: @par
+    "${PACKAGE_TARNAME}-${PACKAGE_VERSION}"
+  - For a major/minor release from the main trunk, the code should be
+    branched and tagged in the repository:
+ at verbatim
+svn cp .../trunk .../branches/${RELEASE_BRANCH}
+svn cp .../branches/${RELEASE_BRANCH} .../tags/${RELEASE_TAG}
+ at endverbatim
+  - For bug-fix releases produced in their respective branch, a tag
+    should be created in the repository: 
+ at verbatim
+svn cp .../branches/${RELEASE_BRANCH} .../tags/${RELEASE_TAG}
+ at endverbatim
+-# Prepare to resume normal development activities:
+  - For major/minor release from the trunk:
+    -# Bump major or minor package version in trunk.
+    -# Restore version tag to trunk and release branch.
+  - For bug-fix releases from a release branch:
+    -# Bump bug-fix version in release branch.
+    -# Restore version tag to release branch.
+-# Publish documentation for the release:
+  - Allow users to access the documentation for each of our releases.
+  - Place static copies of the following files on the project website:
+    - NEWS: to provide a blurb for each release (not yet used)
+    - ChangeLog: to show exactly what has been changed
+    - User Guide, Developer Manual: to allow easy on-line viewing
 -# Upload packages and post announcements of their availability:
   -# Release packages into files section of berliOS project site.
   -# Post announcement e-mail to the openocd-development list.
--# After the community has checked their sanity, we can post "blurbs":
-  -# Post NEWS update to freshmeat.net and other trackers.
+  -# Announce updates on freshmeat.net and other trackers.
   -# Submit big NEWS updates to news feeds (e.g. Digg, Reddit, etc.).
 
-Totally-automated packaging and distribution of OpenOCD requires more
-patching (post-0.2.0), but the final script(s) should be able to manage
-most steps in these processes.  The steps requiring user input can be
-guided by an "assistant" that walks the Release Manager through the
-process from beginning to end, performing basic sanity checks on their
-various inputs (e.g. the NEWS blurb).
+ at section releasescript The Release Script
 
+Many of the processes described in the last section are no longer
+entrusted to humans.  Instead, the @c release.sh script provides
+automation of the mechanical steps.
+
+Presently, the @c release.sh script automates steps 1(c) through 4,
+allowing the Release Manager from perform these tasks in easy steps.
+
+The following task still need to be automated:
+
+- Step 5: produce documentation for website using released source archive.
+- Step 6(a): package archive upload process.
+- Step 6(b): package announcement e-mail process.
+- Step 6(c): post files and announce them using releaseforge.
+
+In addition, support for '-rc' releases needs to be added.
+
+ at subsection releasescriptcmds Release Script Commands
+
+The following output was taken from the release script:
+ at verbatim
+usage: tools/release.sh <command>
+
+Main Commands:
+  info          Show a summary of the next pending release.
+  release       Release the current tree as an archive.
+  upload        Upload archives to berliOS project site
+
+Build Commands:
+  bootstrap     Prepare the working copy for configuration and building.
+  configure     Configures the package; runs bootstrap, if needed.
+  build         Compiles the project; runs configure, if needed.
+
+Packaging Commands:
+  changelog     Generate a new ChangeLog using svn2cl.
+  package       Produce new distributable source archives.
+  stage         Move archives to staging area for upload.
+
+Repository Commands:
+  commit        Perform branch and tag, as appropriate for the version.
+  branch        Create a release branch from the project trunk.
+  tag           Create a tag for the current release branch.
+
+Other Commands:
+  version ...   Perform version number and tag manipulations.
+  clean         Forces regeneration of results.
+  clean_all     Removes all traces of the release process.
+  help          Provides this list of commands.
+
+For more information about this script, see the Release Processes page
+in the OpenOCD Developer's Manual (doc/manual/release.txt).
+
+WARNING: This script should be used by the Release Manager ONLY.
+ at endverbatim
+
+Run <code>tools/release.sh help</code> for current command support.
+
+ at subsection releasescriptenv Release Script Environment
+
+The @c release.sh script recognizes some environment variables which
+affect its behavior:
+
+- @c CONFIG_OPTS : Passed as options to the configure script.
+- @c MAKE_OPTS : Passed as options to the 'make' processes.
+- @c RELEASE_DRY_RUN : Set this to null to perform the live release.
+  Unless this variable has been (un)set, the release commands will not
+  affect the repository.
+
+Proper option handling should be added to set these variables in script.
+
+ at section releasetutorial Release Tutorials
+
+This section provides tutorials for using the Release Script to perform
+common release tasks.
+
+ at subsection releasetutorialminor Minor Release Tutorial
+
+The tutorials in this section assume the following environment
+variables have been set properly:
+ at verbatim
+SVN_USER="maintainer"
+SVN_URL="https://${SVN_USER}@svn.berlios.de/svnroot/repos/openocd"
+ at endverbatim
+
+ at subsection releasetutorialminor Minor Release Tutorial
+
+This section provides a step-by-step tutorial for a Release Manager to
+use to run the @c release.sh script to produce a minor release.
+
+If the proper environment has been set, the following steps will produce
+a new minor release:
+
+-# Check out (or update) the project trunk from the berliOS repository:
+ at code
+svn checkout "${SVN_URL}/trunk" openocd-trunk
+ at endcode
+-# Change to the new working copy directory:
+ at code
+cd openocd-trunk
+ at endcode
+-# Run @c release.sh to produce the minor release:
+ at code
+tools/release.sh all
+ at endcode
+
+ at subsection releasetutorialmicro Bug-Fix Release Tutorial
+
+This section provides a step-by-step tutorial for a Release Manager to
+use to run the @c release.sh script to produce a bug-fix release.
+
+In addition to the environment variables described in the introduction
+to these tutorials, the following variables are also used in the
+instructions for this section:
+ at verbatim
+PACKAGE_BRANCH_VERSION="x.y.z"
+PACKAGE_BRANCH="openocd-${PACKAGE_BRANCH_VERSION}"
+ at endverbatim
+
+If the proper environment has been set, the following steps will produce
+a new bug-fix release:
+
+-# Check out (or update) the release branch from the project repository:
+ at code
+svn checkout "${SVN_URL}/branches/${PACKAGE_BRANCH}" "${PACKAGE_BRANCH}"
+ at endcode
+ at code
+cd "${PACKAGE_BRANCH}"
+ at endcode
+-# Run @c release.sh to produce the bug-fix release:
+ at code
+tools/release.sh all
+ at endcode
+
+ at section releasetodo Release Script Shortcomings
+
+Improved automated packaging and distribution of OpenOCD requires more
+patching of the configure script.  The final release script should be
+able to manage most steps of the processes.  The steps requiring user
+input could be guided by an "assistant" that walks the Release Manager
+through the process from beginning to end, performing basic sanity
+checks on their various inputs (e.g. the NEWS blurb).
+
  */
 /** @file
 This file contains the @ref releases page.



From oharboe at mail.berlios.de  Mon Jul  6 09:31:47 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 09:31:47 +0200
Subject: [Openocd-svn] r2463 - trunk/src
Message-ID: <200907060731.n667VlmY026052@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 09:31:46 +0200 (Mon, 06 Jul 2009)
New Revision: 2463

Modified:
   trunk/src/ecosboard.c
Log:
zy1000 now listens for port 1234. Upon accepting connection reboot zy1000.

Modified: trunk/src/ecosboard.c
===================================================================
--- trunk/src/ecosboard.c	2009-07-04 03:47:54 UTC (rev 2462)
+++ trunk/src/ecosboard.c	2009-07-06 07:31:46 UTC (rev 2463)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007-2008 by ?yvind Harboe                              *
+ *   Copyright (C) 2007-2008 by ???yvind Harboe                              *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *
@@ -173,6 +173,62 @@
 	cyg_thread_resume(zylinjtag_thread_handle);
 }
 
+static char zylinjtag_reboot_port_stack[2048];
+static cyg_thread zylinjtag_reboot_port_thread_object;
+static cyg_handle_t zylinjtag_reboot_port_thread_handle;
+
+static void zylinjtag_reboot_port_task(cyg_addrword_t data)
+{
+	int so_reuseaddr_option = 1;
+
+	int fd;
+	if ((fd = socket(AF_INET, SOCK_STREAM, 0)) == -1)
+	{
+		LOG_ERROR("error creating socket: %s", strerror(errno));
+		exit(-1);
+	}
+
+	setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, (void*) &so_reuseaddr_option,
+			sizeof(int));
+
+	struct sockaddr_in sin;
+	unsigned int address_size;
+	address_size = sizeof(sin);
+	memset(&sin, 0, sizeof(sin));
+	sin.sin_family = AF_INET;
+	sin.sin_addr.s_addr = INADDR_ANY;
+	sin.sin_port = htons(1234);
+
+	if (bind(fd, (struct sockaddr *) &sin, sizeof(sin)) == -1)
+	{
+		LOG_ERROR("couldn't bind to socket: %s", strerror(errno));
+		exit(-1);
+	}
+
+	if (listen(fd, 1) == -1)
+	{
+		LOG_ERROR("couldn't listen on socket: %s", strerror(errno));
+		exit(-1);
+	}
+	//	socket_nonblock(fd);
+
+
+	accept(fd, (struct sockaddr *) &sin, &address_size);
+
+	diag_printf("Got reboot signal on port 1234");
+
+	reboot();
+
+}
+
+void reboot_port(void)
+{
+	cyg_thread_create(1, zylinjtag_reboot_port_task, (cyg_addrword_t) 0, "wait for reboot signal on port 1234",
+			(void *) zylinjtag_reboot_port_stack, sizeof(zylinjtag_reboot_port_stack),
+			&zylinjtag_reboot_port_thread_handle, &zylinjtag_reboot_port_thread_object);
+	cyg_thread_resume(zylinjtag_reboot_port_thread_handle);
+}
+
 int configuration_output_handler(struct command_context_s *context,
 		const char* line)
 {
@@ -432,6 +488,10 @@
 		diag_printf("Network not up and running\n");
 		exit(-1);
 	}
+
+	/* very first thing we want is a reboot capability */
+	reboot_port();
+
 #if defined(CYGPKG_NET_FREEBSD_STACK)
 	/*start TFTP*/
 	tftpd_start(69, &fileops);



From oharboe at mail.berlios.de  Mon Jul  6 09:33:39 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 09:33:39 +0200
Subject: [Openocd-svn] r2464 - trunk/src/helper
Message-ID: <200907060733.n667XdGS026240@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 09:33:38 +0200 (Mon, 06 Jul 2009)
New Revision: 2464

Modified:
   trunk/src/helper/command.c
Log:
human readable error message upon invalid arguments

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2009-07-06 07:31:46 UTC (rev 2463)
+++ trunk/src/helper/command.c	2009-07-06 07:33:38 UTC (rev 2464)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008, Duane Ellis                                       *
@@ -867,15 +867,27 @@
 	int parse##name(const char *str, type *ul) \
 	{ \
 		if (!*str) \
+		{ \
+			LOG_ERROR("Invalid command argument"); \
 			return ERROR_COMMAND_ARGUMENT_INVALID; \
+		} \
 		char *end; \
 		*ul = func(str, &end, 0); \
 		if (*end) \
+		{ \
+  		    LOG_ERROR("Invalid command argument"); \
 			return ERROR_COMMAND_ARGUMENT_INVALID; \
+		} \
 		if ((max == *ul) && (ERANGE == errno)) \
+		{ \
+		    LOG_ERROR("Argument overflow"); \
 			return ERROR_COMMAND_ARGUMENT_OVERFLOW; \
+		} \
 		if (min && (min == *ul) && (ERANGE == errno)) \
+		{ \
+		    LOG_ERROR("Argument underflow"); \
 			return ERROR_COMMAND_ARGUMENT_UNDERFLOW; \
+		} \
 		return ERROR_OK; \
 	}
 DEFINE_PARSE_NUM_TYPE(_ulong, unsigned long , strtoul, 0, ULONG_MAX)



From oharboe at mail.berlios.de  Mon Jul  6 10:01:23 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 10:01:23 +0200
Subject: [Openocd-svn] r2465 - trunk/src/helper
Message-ID: <200907060801.n6681Nkc028525@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 10:01:22 +0200 (Mon, 06 Jul 2009)
New Revision: 2465

Modified:
   trunk/src/helper/command.c
Log:
try to use tabs instead of spaces

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2009-07-06 07:33:38 UTC (rev 2464)
+++ trunk/src/helper/command.c	2009-07-06 08:01:22 UTC (rev 2465)
@@ -875,17 +875,17 @@
 		*ul = func(str, &end, 0); \
 		if (*end) \
 		{ \
-  		    LOG_ERROR("Invalid command argument"); \
+			LOG_ERROR("Invalid command argument"); \
 			return ERROR_COMMAND_ARGUMENT_INVALID; \
 		} \
 		if ((max == *ul) && (ERANGE == errno)) \
 		{ \
-		    LOG_ERROR("Argument overflow"); \
+			LOG_ERROR("Argument overflow"); \
 			return ERROR_COMMAND_ARGUMENT_OVERFLOW; \
 		} \
 		if (min && (min == *ul) && (ERANGE == errno)) \
 		{ \
-		    LOG_ERROR("Argument underflow"); \
+			LOG_ERROR("Argument underflow"); \
 			return ERROR_COMMAND_ARGUMENT_UNDERFLOW; \
 		} \
 		return ERROR_OK; \



From oharboe at mail.berlios.de  Mon Jul  6 10:04:58 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 10:04:58 +0200
Subject: [Openocd-svn] r2466 - trunk
Message-ID: <200907060804.n6684wtS028701@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 10:04:57 +0200 (Mon, 06 Jul 2009)
New Revision: 2466

Modified:
   trunk/TODO
Log:
added known problem w/line number's being off in syntax errors for target reset events

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-06 08:01:22 UTC (rev 2465)
+++ trunk/TODO	2009-07-06 08:04:57 UTC (rev 2466)
@@ -15,6 +15,9 @@
 
 This section provides possible things to improve with OpenOCD's TCL support.
 
+- Fix problem with incorrect line numbers reported for a syntax
+  error in a reset init event.
+
 - organize the TCL configurations:
   - provide more directory structure for boards/targets?
   - factor configurations into layers (encapsulation and re-use)
@@ -97,7 +100,7 @@
 - general layer cleanup: @par
   https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
 - ARM11 improvements (MB?)
-  - fix single stepping  (reported by ?H)
+  - fix single stepping  (reported by ???H)
   - implement missing functionality (grep FNC_INFO_NOTIMPLEMENTED ...)
 - Cortex A8 support (ML)
   - add target implementation (ML)
@@ -141,7 +144,7 @@
 - finish implementing bus width/chip width handling (suggested by NC)
 - factor vendor-specific code into separate source files
   - add new callback interface for vendor-specific code
-- investigate/implement "thin wrapper" to use eCos CFI drivers (?H)
+- investigate/implement "thin wrapper" to use eCos CFI drivers (???H)
 
 @section thelistdebug Debugger Support
 



From oharboe at mail.berlios.de  Mon Jul  6 10:05:59 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 10:05:59 +0200
Subject: [Openocd-svn] r2467 - trunk/tcl/board
Message-ID: <200907060805.n6685xeR028859@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 10:05:58 +0200 (Mon, 06 Jul 2009)
New Revision: 2467

Modified:
   trunk/tcl/board/digi_connectcore_wi-9c.cfg
Log:
bitrot: fix numerous syntax errors 
added correct jtag device id

Modified: trunk/tcl/board/digi_connectcore_wi-9c.cfg
===================================================================
--- trunk/tcl/board/digi_connectcore_wi-9c.cfg	2009-07-06 08:04:57 UTC (rev 2466)
+++ trunk/tcl/board/digi_connectcore_wi-9c.cfg	2009-07-06 08:05:58 UTC (rev 2467)
@@ -26,7 +26,7 @@
 if { [info exists CPUTAPID ] } {
    set _CPUTAPID $CPUTAPID
 } else {
-   set _CPUTAPID 0xFFFFFFFF
+   set _CPUTAPID 0x07926031
 }
 
 set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
@@ -41,6 +41,7 @@
 ######################
 
 target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm926ejs
+
 $_TARGETNAME configure -event reset-init {
 	mww 0x90600104 0x33313333
 	mww 0xA0700000 0x00000001  # Enable the memory controller.
@@ -99,12 +100,12 @@
 	mww 0xA0700160 0x00084280   # Enable buffer access
 
 	#Set byte lane state (static mem 1)"
-	mww 0xA0700220, 0x00000082
+	mww 0xA0700220 0x00000082
 	#Flash Start
-	mww 0xA09001F8, 0x50000000
+	mww 0xA09001F8 0x50000000
 	#Flash Mask Reg
-	mww 0xA09001FC, 0xFF000001
-	mww 0xA0700028, 0x00000001
+	mww 0xA09001FC 0xFF000001
+	mww 0xA0700028 0x00000001
 
 	#  RAMAddr = 0x00020000
 	#  RAMSize = 0x00004000
@@ -122,6 +123,3 @@
 #M29DW323DB - not working
 #flash bank cfi <base> <size> <chip width> <bus width> <target#>
 flash bank cfi 0x50000000 0x0400000 2 2 0
-
-
-



From zwelch at mail.berlios.de  Mon Jul  6 10:45:37 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 6 Jul 2009 10:45:37 +0200
Subject: [Openocd-svn] r2468 - trunk/doc
Message-ID: <200907060845.n668jbFe032524@sheep.berlios.de>

Author: zwelch
Date: 2009-07-06 10:45:31 +0200 (Mon, 06 Jul 2009)
New Revision: 2468

Modified:
   trunk/doc/Makefile.am
Log:
Fix maintainer-clean target in doc directory.

Modified: trunk/doc/Makefile.am
===================================================================
--- trunk/doc/Makefile.am	2009-07-06 08:05:58 UTC (rev 2467)
+++ trunk/doc/Makefile.am	2009-07-06 08:45:31 UTC (rev 2468)
@@ -14,4 +14,6 @@
 MAINTAINERCLEANFILES = \
 	$(srcdir)/Makefile.in \
 	$(srcdir)/mdate-sh \
+	$(srcdir)/stamp-vti \
+	$(srcdir)/version.texi \
 	$(srcdir)/texinfo.tex



From oharboe at mail.berlios.de  Mon Jul  6 11:28:39 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 11:28:39 +0200
Subject: [Openocd-svn] r2469 - trunk/src/target
Message-ID: <200907060928.n669SdLB003639@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 11:28:37 +0200 (Mon, 06 Jul 2009)
New Revision: 2469

Modified:
   trunk/src/target/arm7_9_common.c
Log:
simplify debug_reason check

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-07-06 08:45:31 UTC (rev 2468)
+++ trunk/src/target/arm7_9_common.c	2009-07-06 09:28:37 UTC (rev 2469)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *
@@ -1431,18 +1431,10 @@
 		context[15] -= 3 * 4;
 	}
 
-	if ((target->debug_reason == DBG_REASON_BREAKPOINT)
-			|| (target->debug_reason == DBG_REASON_SINGLESTEP)
-			|| (target->debug_reason == DBG_REASON_WATCHPOINT)
-			|| (target->debug_reason == DBG_REASON_WPTANDBKPT)
-			|| ((target->debug_reason == DBG_REASON_DBGRQ) && (arm7_9->use_dbgrq == 0)))
+	if ((target->debug_reason != DBG_REASON_DBGRQ) || (!arm7_9->use_dbgrq))
 		context[15] -= 3 * ((armv4_5->core_state == ARMV4_5_STATE_ARM) ? 4 : 2);
-	else if (target->debug_reason == DBG_REASON_DBGRQ)
-		context[15] -= arm7_9->dbgreq_adjust_pc * ((armv4_5->core_state == ARMV4_5_STATE_ARM) ? 4 : 2);
 	else
-	{
-		LOG_ERROR("unknown debug reason: %i", target->debug_reason);
-	}
+		context[15] -= arm7_9->dbgreq_adjust_pc * ((armv4_5->core_state == ARMV4_5_STATE_ARM) ? 4 : 2);
 
 	if (armv4_5_mode_to_number(armv4_5->core_mode)==-1)
 		return ERROR_FAIL;



From oharboe at mail.berlios.de  Mon Jul  6 11:32:22 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 11:32:22 +0200
Subject: [Openocd-svn] r2470 - trunk/src/target
Message-ID: <200907060932.n669WMaw004422@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 11:32:22 +0200 (Mon, 06 Jul 2009)
New Revision: 2470

Modified:
   trunk/src/target/arm926ejs.c
Log:
10ms timeout check on cp15 read/write

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-07-06 09:28:37 UTC (rev 2469)
+++ trunk/src/target/arm926ejs.c	2009-07-06 09:32:22 UTC (rev 2470)
@@ -159,8 +159,9 @@
 
 	jtag_add_dr_scan(4, fields, jtag_get_end_state());
 
-	/*TODO: add timeout*/
-	do
+	long long then = timeval_ms();
+
+	for (;;)
 	{
 		/* rescan with NOP, to wait for the access to complete */
 		access = 0;
@@ -173,7 +174,19 @@
 		{
 			return retval;
 		}
-	} while (buf_get_u32(&access, 0, 1) != 1);
+		
+		if (buf_get_u32(&access, 0, 1) == 1)
+		{
+			break;
+		}
+		
+		/* 10ms timeout */
+		if ((timeval_ms()-then)>10)
+		{
+			LOG_ERROR("cp15 read operation timed out");
+			return ERROR_FAIL;
+		}
+	}
 
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	LOG_DEBUG("addr: 0x%x value: %8.8x", address, *value);
@@ -228,8 +241,10 @@
 	fields[3].in_value = NULL;
 
 	jtag_add_dr_scan(4, fields, jtag_get_end_state());
-	/*TODO: add timeout*/
-	do
+
+	long long then = timeval_ms();
+
+	for (;;)
 	{
 		/* rescan with NOP, to wait for the access to complete */
 		access = 0;
@@ -239,8 +254,20 @@
 		{
 			return retval;
 		}
-	} while (buf_get_u32(&access, 0, 1) != 1);
 
+		if (buf_get_u32(&access, 0, 1) == 1)
+		{
+			break;
+		}
+
+		/* 10ms timeout */
+		if ((timeval_ms()-then)>10)
+		{
+			LOG_ERROR("cp15 write operation timed out");
+			return ERROR_FAIL;
+		}
+	}
+
 #ifdef _DEBUG_INSTRUCTION_EXECUTION_
 	LOG_DEBUG("addr: 0x%x value: %8.8x", address, value);
 #endif



From zwelch at mail.berlios.de  Mon Jul  6 12:34:42 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 6 Jul 2009 12:34:42 +0200
Subject: [Openocd-svn] r2471 - trunk/src/jtag
Message-ID: <200907061034.n66AYgbr011183@sheep.berlios.de>

Author: zwelch
Date: 2009-07-06 12:34:33 +0200 (Mon, 06 Jul 2009)
New Revision: 2471

Modified:
   trunk/src/jtag/jlink.c
Log:
Gary Carlson <gcarlson at carlson-minot.com>:

Fix intermittent J-Link interface startup failures:
- Use usb_reset to ensure selected dongle is in known good state.
- Assert emulator reset durning status check to prevent supurious failures.
- Eliminate status check loop; not needed due to other fixes.


Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-07-06 09:32:22 UTC (rev 2470)
+++ trunk/src/jtag/jlink.c	2009-07-06 10:34:33 UTC (rev 2471)
@@ -305,7 +305,6 @@
 
 static int jlink_init(void)
 {
-	int check_cnt;
 	int i;
 
 	jlink_jtag_handle = jlink_usb_open();
@@ -315,24 +314,28 @@
 		LOG_ERROR("Cannot find jlink Interface! Please check connection and permissions.");
 		return ERROR_JTAG_INIT_FAILED;
 	}
+	
+	/*
+	 *  The next three instructions were added after discovering a problem while using an oscilloscope.  For the V8
+	 *	SAM-ICE dongle (and likely other j-link device variants), the reset line to the target microprocessor was found to
+	 *	cycle only intermittently during emulator startup (even after encountering the downstream reset instruction later
+	 *	in the code).  This was found to create two issues:  1) In general it is a bad practice to not reset a CPU to a known
+	 *	state when starting an emulator and 2) something critical happens inside the dongle when it does the first read
+	 *	following a new USB session.  Keeping the processor in reset during the first read collecting version information
+	 *	seems to prevent errant "J-Link command EMU_CMD_VERSION failed" issues.
+	 */
+	
+	LOG_INFO("J-Link initialization started / target CPU reset initiated");
+	jlink_simple_command(EMU_CMD_HW_TRST0);
+	jlink_simple_command(EMU_CMD_HW_RESET0);
+	sleep(1);
 
 	jlink_hw_jtag_version = 2;
-	check_cnt = 0;
-	while (check_cnt < 3)
-	{
-		if (jlink_get_version_info() == ERROR_OK)
-		{
-			/* attempt to get status */
-			jlink_get_status();
-			break;
-		}
 
-		check_cnt++;
-	}
-
-	if (check_cnt == 3)
+	if (jlink_get_version_info() == ERROR_OK)
 	{
-		LOG_INFO("J-Link initial read failed, don't worry");
+		/* attempt to get status */
+		jlink_get_status();
 	}
 
 	LOG_INFO("J-Link JTAG Interface ready");
@@ -860,6 +863,15 @@
 			if ((dev->descriptor.idVendor == VID) && (dev->descriptor.idProduct == PID))
 			{
 				result->usb_handle = usb_open(dev);
+				
+				/*
+				 *	Some j-link dongles experience intermittent communication issues at startup to varying degrees
+				 *	depending on the host operating system.  Troubleshooting this problem all the way back to libusb
+				 *	revealed that without a usb reset, the hardware can start in an uncertain state causing a litany
+				 *	of annoying problems.  The next step was added to the original code to address this problem.
+				 */
+				
+				usb_reset(result->usb_handle);
 
 				/* usb_set_configuration required under win32 */
 				usb_set_configuration(result->usb_handle, dev->config[0].bConfigurationValue);



From zwelch at mail.berlios.de  Mon Jul  6 12:34:54 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 6 Jul 2009 12:34:54 +0200
Subject: [Openocd-svn] r2472 - trunk/src/jtag
Message-ID: <200907061034.n66AYsuf011368@sheep.berlios.de>

Author: zwelch
Date: 2009-07-06 12:34:49 +0200 (Mon, 06 Jul 2009)
New Revision: 2472

Modified:
   trunk/src/jtag/amt_jtagaccel.c
Log:
Ferdinand Postema <ferdinand at postema.eu>:

Updates to private TAP state tables in amtjtagaccel interface driver.

The first change is the neccesary one to correct a long-standing bug that
caused the IDCODE to be shifted by one bit too many.  This was caused by
an incorrect path from state RESET to state DRSHIFT.

The value of those 2 bytes were 0x8a and 0x04. This means that the
bitstream to do this transition is 0b 00100 01010 (send LSB first). This
will bring you from the reset state to the shift state; however, you
enter the shift-state twice, which explains why the ID-CODE that will be
read next will be shifted 1 bit.  The fix changes these to 0x05 and 0x00.
This will send the bitstream 0b 00101 (send LSB first).  This will bring
the TAP controller from the RESET state to the DRSHIFT state directly,
without entering the DRSHIFT state twice.

After checking the whole table, two other transitions were found that
could be optimized (5 bits in stead of 10 bits).

Summary off all changes:
  From   To       Old values  Old Bitstream  New values  New Bitstream  Remarks
  ----   -------  ----------  -------------  ----------  -------------  -------
  RESET  DRSHIFT  0x8a 0x04   0b00100 01010  0x05 0x00   0b00101        1,2
  IDLE   DRSHIFT  0x85 0x08   0b01000 00101  0x04 0x00   0b00100        2
  IDLE   IRSHIFT  0x8b 0x08   0b01000 01011  0x06 0x00   0b00110        2

[1] Fixes the IDCODE bug
[2] Optimization


Modified: trunk/src/jtag/amt_jtagaccel.c
===================================================================
--- trunk/src/jtag/amt_jtagaccel.c	2009-07-06 10:34:33 UTC (rev 2471)
+++ trunk/src/jtag/amt_jtagaccel.c	2009-07-06 10:34:49 UTC (rev 2472)
@@ -92,8 +92,8 @@
 static uint8_t amt_jtagaccel_tap_move[6][6][2] =
 {
 	/*	   RESET         IDLE        DRSHIFT       DRPAUSE       IRSHIFT       IRPAUSE             */
-	{{0x1f, 0x00}, {0x0f, 0x00}, {0x8a, 0x04}, {0x0a, 0x00}, {0x06, 0x00}, {0x96, 0x00}},	/* RESET */
-	{{0x1f, 0x00}, {0x00, 0x00}, {0x85, 0x08}, {0x05, 0x00}, {0x8b, 0x08}, {0x0b, 0x00}},	/* IDLE */
+	{{0x1f, 0x00}, {0x0f, 0x00}, {0x05, 0x00}, {0x0a, 0x00}, {0x06, 0x00}, {0x96, 0x00}},	/* RESET */
+	{{0x1f, 0x00}, {0x00, 0x00}, {0x04, 0x00}, {0x05, 0x00}, {0x06, 0x00}, {0x0b, 0x00}},	/* IDLE */
 	{{0x1f, 0x00}, {0x0d, 0x00}, {0x00, 0x00}, {0x01, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* DRSHIFT  */
 	{{0x1f, 0x00}, {0x0c, 0x00}, {0x08, 0x00}, {0x00, 0x00}, {0x8f, 0x09}, {0x8f, 0x01}},	/* DRPAUSE  */
 	{{0x1f, 0x00}, {0x0d, 0x00}, {0x07, 0x00}, {0x97, 0x00}, {0x00, 0x00}, {0x01, 0x00}},	/* IRSHIFT  */



From zwelch at mail.berlios.de  Mon Jul  6 13:21:33 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 6 Jul 2009 13:21:33 +0200
Subject: [Openocd-svn] r2473 - trunk/tools
Message-ID: <200907061121.n66BLXjL026832@sheep.berlios.de>

Author: zwelch
Date: 2009-07-06 13:21:28 +0200 (Mon, 06 Jul 2009)
New Revision: 2473

Added:
   trunk/tools/release.sh
Log:
Add script to automate most of the release process.

Added: trunk/tools/release.sh
===================================================================
--- trunk/tools/release.sh	2009-07-06 10:34:49 UTC (rev 2472)
+++ trunk/tools/release.sh	2009-07-06 11:21:28 UTC (rev 2473)
@@ -0,0 +1,569 @@
+#!/bin/sh -e
+# release.sh: openocd release process automation
+# Copyright (C) 2009 by Zachary T Welch <zw at superlucidity.net>
+# Release under the GNU GPL v2 (or later versions).
+
+## set these to control the build process
+#CONFIG_OPTS=""
+#MAKE_OPTS=""
+
+## DO NOT PERFORM LIVE RELEASES UNLESS YOU ARE THE RELEASE MANAGER!!!
+RELEASE_DRY_RUN=1
+## set this to perform individual steps on past releases
+RELEASE_VERSION=
+
+die() {
+	echo "$@" >&2
+	exit 1
+}
+
+svn_info_get() {
+	svn info | grep "$1" | cut -d':' -f2- | cut -c2-
+}
+
+svn_setup_load() {
+	SVN_ROOT="$(svn_info_get 'Repository Root')"
+	SVN_URL="$(svn_info_get 'URL')"
+
+	SVN_TRUNK="${SVN_ROOT}/trunk"
+
+	SVN_BRANCHES="${SVN_ROOT}/branches"
+	PACKAGE_BRANCH="${SVN_BRANCHES}/${PACKAGE_RELEASE}"
+
+	SVN_TAGS="${SVN_ROOT}/tags"
+	PACKAGE_TAG="${SVN_TAGS}/${PACKAGE_RELEASE}"
+
+	if [ "${SVN_URL}" = "${SVN_TRUNK}" ]; then
+		RELEASE_TYPE=minor
+	elif [ "${SVN_URL/${SVN_BRANCHES}/}" != "${SVN_URL}" ]; then
+		RELEASE_TYPE=micro
+	else
+		echo "error: bad URL: ${SVN_URL}" >&2
+		die "unable to branch from the current location"
+	fi
+}
+svn_setup_show() {
+	cat <<INFO
+Release Type: ${RELEASE_TYPE}
+  Branch URL: ${PACKAGE_BRANCH}
+     Tag URL: ${PACKAGE_TAG}
+INFO
+}
+
+do_svn_echo_msg() { echo "svn: $1: $3"; }
+do_svn_echo() {
+	case "$1" in
+	commit)
+		do_svn_echo_msg "$@"
+		shift 3
+		[ "$*" ] && echo "Files: $@"
+		;;
+	copy|move)
+		do_svn_echo_msg "$@"
+		echo "From: ${4:-$2}"
+		echo "  To: ${5:-$3}"
+		;;
+	*)
+		local ACTION="$1"
+		shift
+		echo "svn: ${ACTION}: $@"
+		;;
+	esac
+}
+do_svn() {
+	do_svn_echo "$@"
+	[ "${RELEASE_DRY_RUN}" ] || svn "$@"
+}
+
+
+package_info_load_name() {
+	grep AC_INIT configure.in | perl -ne 's/^.+\(\[([-\w]*)\],.+$/$1/ and print'
+}
+package_info_load_version() {
+	grep AC_INIT configure.in | perl -ne 's/^.+\[([-\w\.]*)\],$/$1/ and print'
+}
+
+package_info_load() {
+	[ -f "configure.in" ] || \
+		die "package_info_load: configure.in is missing"
+
+	PACKAGE_NAME="$(package_info_load_name)"
+	# todo: fix this
+	PACKAGE_TARNAME="${PACKAGE_NAME}"
+
+	PACKAGE_VERSION="$(package_info_load_version)"
+	[ "${RELEASE_VERSION}" ] || \
+		RELEASE_VERSION=${PACKAGE_VERSION/-in-development/}
+
+	[ "${PACKAGE_NAME}" -a "${PACKAGE_VERSION}" ] || \
+		die "package information is missing from configure script"
+
+	PACKAGE_VERSION_TAGS=
+	[ "${PACKAGE_VERSION/-/}" = "${PACKAGE_VERSION}" ] || \
+		PACKAGE_VERSION_TAGS="-${PACKAGE_VERSION#*-}"
+	PACKAGE_VERSION_BASE="${PACKAGE_VERSION%%-*}"
+	PACKAGE_MICRO="${PACKAGE_VERSION_BASE##*.}"
+	PACKAGE_MAJOR_AND_MINOR="${PACKAGE_VERSION_BASE%.*}"
+	PACKAGE_MAJOR="${PACKAGE_MAJOR_AND_MINOR%.*}"
+	PACKAGE_MINOR="${PACKAGE_MAJOR_AND_MINOR#*.}"
+
+	PACKAGE_STRING="${PACKAGE_NAME} ${PACKAGE_VERSION}"
+	if [ "${RELEASE_DRY_RUN}" ]; then
+		PACKAGE_RELEASE="${PACKAGE_TARNAME}-${PACKAGE_VERSION}"
+	else
+		PACKAGE_RELEASE="${PACKAGE_TARNAME}-${RELEASE_VERSION}"
+	fi
+}
+
+package_info_show() {
+	cat <<INFO
+Name: ${PACKAGE_TARNAME}
+Release: ${RELEASE_VERSION}
+Version: ${PACKAGE_VERSION}
+   Number: ${PACKAGE_VERSION_BASE}
+   Series: ${PACKAGE_MAJOR_AND_MINOR}
+    Major: ${PACKAGE_MAJOR}
+    Minor: ${PACKAGE_MINOR}
+    Micro: ${PACKAGE_MICRO}
+     Tags: ${PACKAGE_VERSION_TAGS}
+ Branch: ${PACKAGE_RELEASE}
+Release: ${PACKAGE_TARNAME}-${PACKAGE_VERSION_BASE}${PACKAGE_VERSION_TAGS}
+INFO
+}
+
+usage() {
+	cat << USAGE
+usage: $0 <command>
+
+Main Commands:
+  info          Show a summary of the next pending release.
+  release       Release the current tree as an archive.
+  upload        Upload archives to berliOS project site
+
+Build Commands:
+  bootstrap     Prepare the working copy for configuration and building.
+  configure     Configures the package; runs bootstrap, if needed.
+  build         Compiles the project; runs configure, if needed.
+
+Packaging Commands:
+  changelog     Generate a new ChangeLog using svn2cl.
+  package       Produce new distributable source archives.
+  stage         Move archives to staging area for upload.
+
+Repository Commands:
+  commit        Perform branch and tag, as appropriate for the version.
+  branch        Create a release branch from the project trunk.
+  tag           Create a tag for the current release branch.
+
+Other Commands:
+  version ...   Perform version number and tag manipulations.
+  maryslamb     Mary had a little lamb, but no one noticed.
+  clean         Forces regeneration of results.
+  clean_all     Removes all traces of the release process.
+  help          Provides this list of commands.
+  
+For more information about this script, see the Release Processes page
+in the OpenOCD Developer's Manual (doc/manual/release.txt).
+
+WARNING: This script should be used by the Release Manager ONLY.
+USAGE
+	exit 0
+}
+do_usage() { usage; }
+do_help()  { usage; }
+
+do_info_show() {
+	echo "Current Release Analysis:"
+	package_info_show
+	svn_setup_show
+}
+
+do_info() {
+	package_info_load
+	svn_setup_load
+	do_info_show
+}
+
+do_bootstrap() {
+	echo -n "Bootstrapping..."
+	./bootstrap 2>&1 | perl tools/logger.pl > "release-bootstrap.log"
+}
+maybe_bootstrap() { [ -f "configure" ] || do_bootstrap; }
+
+do_configure() {
+	maybe_bootstrap
+	echo -n "Configuring..."
+	./configure ${CONFIG_OPTS} 2>&1 | perl tools/logger.pl > "release-config.log"
+}
+maybe_configure() { [ -f "Makefile" ] || do_configure; }
+
+do_build() {
+	maybe_configure
+	echo -n "Compiling OpenOCD ${PACKAGE_VERSION}"
+	make ${MAKE_OPTS} -C doc stamp-vti 2>&1 \
+		| perl tools/logger.pl > "release-version.log"
+	make ${MAKE_OPTS} 2>&1 \
+		| perl tools/logger.pl > "release-make.log"
+}
+maybe_build() { [ -f "src/openocd" ] || do_build; }
+do_build_clean() { [ -f Makefile ] && make maintainer-clean >/dev/null; }
+
+maybe_rebuild() {
+	if [ -f "configure" ]; then
+		echo "Re-running autoconf..."
+		autoconf
+		echo "Re-running automake..."
+		automake
+	fi
+	if [ -f "Makefile" ]; then
+		do_configure
+		do_build
+	fi
+}
+
+do_changelog() {
+	echo "Updating working copy to HEAD..."
+	do_svn update
+	echo "Creating ChangeLog..."
+	svn2cl -i --authors AUTHORS.ChangeLog
+}
+maybe_changelog() {
+	if [ -z "${RELEASE_DRY_RUN}" ] \
+		|| [ ! -f ChangeLog ] \
+		|| [ "$(cat ChangeLog | wc -l)" -lt 2 ]
+	then
+		do_changelog
+	fi
+}
+do_changelog_clean() {
+	do_svn revert ChangeLog
+}
+
+do_package() {
+	package_info_load
+	maybe_changelog
+	maybe_build
+	echo "Building distribution packages..."
+	make ${MAKE_OPTS} distcheck 2>&1 | perl tools/logger.pl > "release-pkg.log"
+}
+maybe_package() { [ -f "${PACKAGE_RELEASE}.zip" ] || do_package; }
+do_package_clean() {
+	for EXT in tar.gz tar.bz2 zip; do
+		rm -v -f *.${EXT}
+	done
+}
+
+do_stage() {
+	maybe_package
+	echo "Staging package archives:"
+	mkdir -p archives
+	for EXT in tar.gz tar.bz2 zip; do
+		mv -v "${PACKAGE_RELEASE}.${EXT}" archives/
+	done
+	cp -a NEWS archives/
+	cp -a ChangeLog archives/
+}
+do_stage_clean() { rm -v -f -r archives; }
+
+do_clean() {
+	do_build_clean
+	do_package_clean
+	rm -v -f configure
+
+	svn revert configure.in
+	rm -v -f release-*.log
+}
+do_clean_all() {
+	do_clean
+	do_changelog_clean
+	do_stage_clean
+}
+
+do_version_usage() {
+	cat << USAGE
+usage: $0 version <command>
+Version Commands:
+  tag {add|remove} <label>     Add or remove the specified tag.
+  bump {major|minor|micro|rc}  Bump the specified version number;
+                               resets less-significant numbers to zero.
+			       All but 'rc' releases drop that tag.
+USAGE
+}
+
+do_version_sed() {
+	local OLD_VERSION="${PACKAGE_VERSION}"
+	local NEW_VERSION="$1"
+	local MSG="$2"
+
+	sed -i -e "/AC_INIT/ s|${OLD_VERSION}|${NEW_VERSION}|" configure.in
+	package_info_load
+	echo "${MSG}: ${OLD_VERSION} -> ${NEW_VERSION}"
+}
+do_version_bump_sed() {
+	local NEW_VERSION="$1"
+	[ -z "${PACKAGE_VERSION_TAGS}" ] || \
+		NEW_VERSION="${NEW_VERSION}${PACKAGE_VERSION_TAGS}"
+
+	do_version_sed "${NEW_VERSION}" \
+		"Bump ${CMD} package version number"
+}
+do_version_bump_major() {
+	has_version_tag 'rc\d' do_version_
+	do_version_bump_sed "$((PACKAGE_MAJOR + 1)).0.0"
+}
+do_version_bump_minor() {
+	do_version_bump_sed "${PACKAGE_MAJOR}.$((PACKAGE_MINOR + 1)).0"
+}
+do_version_bump_micro() {
+	do_version_bump_sed "${PACKAGE_MAJOR_AND_MINOR}.$((PACKAGE_MICRO + 1))"
+}
+do_version_bump_rc() {
+	die "patch missing: -rc support is not implemented"
+}
+do_version_bump() {
+	CMD="$1"
+	shift
+	case "${CMD}" in
+	major|minor|micro|rc)
+		eval "do_version_bump_${CMD}"
+		;;
+	*)
+		do_version_usage
+		;;
+	esac
+}
+
+has_version_tag() {
+	test "${PACKAGE_VERSION/-${TAG}/}" != "${PACKAGE_VERSION}"
+}
+
+do_version_tag_add() {
+	local TAG="$1"
+	has_version_tag && die "error: tag '-${TAG}' exists in '${PACKAGE_VERSION}'"
+	do_version_sed "${PACKAGE_VERSION}-${TAG}" \
+		"Add '-${TAG}' version tag"
+}
+do_version_tag_remove() {
+	local TAG="$1"
+	has_version_tag || die "error: tag '-${TAG}' missing from '${PACKAGE_VERSION}'"
+	do_version_sed "${PACKAGE_VERSION/-${TAG}/}" \
+		"Remove '-${TAG}' version tag"
+}
+do_version_tag() {
+	CMD="$1"
+	shift
+	case "${CMD}" in
+	add|remove)
+		local i=
+		for i in "$@"; do 
+			eval "do_version_tag_${CMD}" "${i}"
+		done
+		;;
+	*)
+		do_version_usage
+		;;
+	esac
+}
+
+do_version_commit() {
+	[ "$(svn diff configure.in | wc -l)" -gt 0 ] || \
+		die "error: no version changes to commit"
+	do_svn commit -m "$1" configure.in
+}
+
+do_version() {
+	package_info_load
+	CMD="$1"
+	shift
+	case "${CMD}" in
+	tag|bump)
+		do_version_commit "$(eval "do_version_${CMD}" "$@")"
+		maybe_rebuild
+		;;
+	commit)
+		local MSG="$1"
+		[ "${MSG}" ] || die "usage: $0 version commit <message>"
+		do_version_commit "${MSG}"
+		maybe_rebuild
+		;;
+	*)
+		do_version_usage
+		;;
+	esac
+}
+
+
+do_branch() {
+	package_info_load
+	svn_setup_load
+	do_svn copy -m "Branching version ${PACKAGE_VERSION}" \
+		"${SVN_TRUNK}" "${PACKAGE_BRANCH}"
+}
+do_tag() {
+	package_info_load
+	svn_setup_load
+	do_svn copy -m "Tagging version ${PACKAGE_VERSION}" \
+		"${PACKAGE_BRANCH}" "${PACKAGE_TAG}"
+}
+do_commit() {
+	package_info_load
+	svn_setup_load
+
+	[ "${PACKAGE_VERSION/in-development/}" = "${PACKAGE_VERSION}" ] || \
+		die "'${PACKAGE_NAME}-${PACKAGE_VERSION}' cannot be released"
+
+	[ "${PACKAGE_VERSION%.0}" = "${PACKAGE_VERSION}" ] || \
+		do_branch
+	do_tag
+}
+
+
+do_release_step_prep() {
+	do_version tag remove in-development
+	# reset RELEASE_VERSION now to allow release version to be detected
+	export RELEASE_VERSION=
+}
+do_release_step_commit() { do_commit; }
+
+do_release_step_branch_bump() {
+	local TYPE="$1"
+	echo "Bump ${TYPE} version and add tag:"
+	do_version_bump ${TYPE}
+	do_version_tag_add in-development
+}
+do_release_step_branch() {
+	do_svn switch "${PACKAGE_BRANCH}"
+	package_info_load
+	do_version_commit "$(do_release_step_branch_bump micro)"
+	do_svn switch "${SVN_URL}"
+	package_info_load
+}
+do_release_step_bump() {
+	# major and minor releases require branch version update too
+	[ "${RELEASE_TYPE}" = "micro" ] || do_release_step_branch
+	# bump the current tree version as required.
+	do_version_commit "$(do_release_step_branch_bump "${RELEASE_TYPE}")"
+
+	# archive NEWS and create new one from template
+	do_svn move "NEWS" "NEWS-${RELEASE_VERSION}"
+
+	[ "${RELEASE_DRY_RUN}" ] || cat >NEWS <<NEWS
+This file should include items worth mentioning in the
+OpenOCD ${PACKAGE_RELEASE} source archive release.
+
+The following areas of OpenOCD functionality changed in this release:
+
+JTAG Layer:
+Target Layer:
+Flash Layer:
+Board, Target, and Interface Configuration Scripts:
+Documentation:
+Build and Release:
+
+For more details about what has changed since the last release,
+see the ChangeLog associated with this source archive.  For older NEWS,
+see the NEWS files associated with each release (i.e. NEWS-<version>).
+
+For more information about contributing test reports, bug fixes, or new
+features and device support, please read the new Developer Manual (or
+the BUGS and PATCHES files in the source archive).
+NEWS
+
+	MSG=<<MSG
+Archive released NEWS file: NEWS -> NEWS-${RELEASE_VERSION}
+Create new NEWS file from relesse script template.
+MSG
+	do_svn commit -m "${MSG}" NEWS NEWS-${RELEASE_VERSION}
+}
+do_release_step_package() {
+	local A=${PACKAGE_TAG}
+	local B=${A/https/http}
+	local PACKAGE_BUILD=${B/${USER}@/}
+	do_svn switch "${PACKAGE_BUILD}"
+	do_stage
+	do_clean
+}
+
+do_release_step_1() { do_release_step_prep; }
+do_release_step_2() { do_release_step_commit; }
+do_release_step_3() { do_release_step_bump; }
+do_release_step_4() { do_release_step_package; }
+
+do_release_check() {
+	echo -n "Are you sure you want to release '${PACKAGE_RELEASE}'?"
+	read ANSWER
+	if [ "${ANSWER}" != 'y' ]; then
+		echo "Live release aborted!"
+		exit 0
+	fi
+}
+do_countdown() {
+	echo -n "$1 in "
+	for i in $(seq 5 -1 1); do
+		echo -n "$i, "
+	done
+	echo "go!"
+}
+
+do_release() {
+	package_info_load
+	package_info_show
+
+	if [ -z "${RELEASE_DRY_RUN}" ]; then
+		do_release_check
+		do_countdown "Starting live release"
+	fi
+
+	local i=
+	for i in $(seq 1 4); do
+		eval "do_release_step_${i}"
+	done
+}
+do_all() { do_release "$@"; }
+
+do_reset() {
+	maybe_bootstrap
+	maybe_configure
+	do_clean_all
+	svn revert configure.in
+}
+
+OPTIONS=$(getopt -o V --long live -n $0 -- "$@")
+if [ $? != 0 ] ; then echo "Terminating..." >&2 ; exit 1 ; fi
+eval set -- "${OPTIONS}"
+while true; do
+	case "$1" in
+	--live)
+		export RELEASE_DRY_RUN=
+		shift
+		;;
+	-V)
+		exec $0 info
+		;;
+	--)
+		shift
+		break
+		;;
+	*)
+		echo "Internal error"
+		exit 1
+		;;
+	esac
+done
+
+CMD=$1
+[ "${CMD}" ] || usage
+shift
+
+ACTION_CMDS="bootstrap|configure|build|changelog|package|stage|clean"
+MISC_CMDS="all|info|version|tag|branch|commit|release|reset|help|usage"
+CLEAN_CMDS="build_clean|changelog_clean|package_clean|stage_clean|clean_all"
+CMDS="|${ACTION_CMDS}|${CLEAN_CMDS}|${MISC_CMDS}|"
+is_command() { echo "${CMDS}" | grep "|$1|" >/dev/null; }
+
+if is_command "${CMD}"; then
+	eval "do_${CMD}" "$@"
+else
+	echo "error: unknown command: '${CMD}'"
+	usage
+fi


Property changes on: trunk/tools/release.sh
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + native



From zwelch at mail.berlios.de  Mon Jul  6 13:26:25 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 6 Jul 2009 13:26:25 +0200
Subject: [Openocd-svn] r2474 - trunk
Message-ID: <200907061126.n66BQPUX000806@sheep.berlios.de>

Author: zwelch
Date: 2009-07-06 13:26:21 +0200 (Mon, 06 Jul 2009)
New Revision: 2474

Modified:
   trunk/NEWS
Log:
Add NEWS file for the 0.2.0 release.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2009-07-06 11:21:28 UTC (rev 2473)
+++ trunk/NEWS	2009-07-06 11:26:21 UTC (rev 2474)
@@ -1 +1,80 @@
-This document is not in use. See mailing list - https://lists.berlios.de/pipermail/openocd-development
+The OpenOCD 0.2.0 source archive release includes numerous improvements
+that were made since the initial 0.1.0 source archive release.  Many
+contributors helped make this release a great success, and the community
+of developers and maintainers look forward to any response.
+
+In addition to the list of changes below, countless bug fixing and
+cleaning was performed across the tree.  Various TCL command parameters
+must past stricter value checks, and many more error conditions have
+been handled correctly.  These efforts helped to make the 0.2.0 release
+more stable and robust, though some changes may expose latent bugs in
+your existing configuration scripts.
+ 
+This release does not maintain backward compatibility in all respects,
+so some target or configuration scripts may need to be updated.  In some
+cases, you may also see warnings; resolve those, because they indicate
+commands that will be removed in the future.
+
+The following areas of OpenOCD functionality changed in this release:
+
+JTAG Layer:
+- Improves modularity: core, TCL, driver commands, and interface have
+  been separated, encapsulated, and documented for developers.  Mostly.
+- Improves JTAG TAP transition tables: 
+   * Makes TAP paths variable length, rather than being fixed at 7 steps.
+   * Fixes problems with some targets that did not like longer paths.
+- Improves JTAG driver/minidriver modularity and encapsulation.
+- New drivers:
+   * Adds stub minidriver for developing new embedded JTAG interfaces.
+- Improves drivers:
+   * ft2232+ftd2xx:
+      + Adds initial high-speed device support: --enable-ftd2xx-highspeed
+      + Supports more types of FTDI-based devices.
+   * jlink:
+      + Works with more versions of the firmware (v3 and newer)
+      + Supports dynamically detects device capabilities and limits
+   * vsllink:
+      + Supports very long scan chains
+   * amtjtagaccel:
+      + Fixes broken ID code detection problems.
+
+Target Layer:
+- New devices: AVR, FA526
+- Improved support: ARM ADI, ARM11, MIPS
+- Numerous other bug fixes and improvements
+
+Flash Layer:
+- Improved drivers: mflash
+- New drivers: AT91SAM3, AVR, Davinci NAND
+
+Board, Interface, and Target Configuration Scripts:
+- Many new and improved targets and boards are now available.
+- Better separation of "board" and "target" configuration
+- Moved all TCL files to top-level "tcl" directory in the source tree
+- Installation moved from '$pkglibdir/' to '$pkgdatadir/scripts/'.
+- Site-specific files should be installed under '$pkgdatadir/site/';
+  files that exist this tree will be used in preference to default
+  distribution configurations in '$pkgdatadir/scripts/'.
+
+Documentation:
+- Updated User Guide:     http://openocd.berlios.de/doc/html/index.html
+   * Partially re-written and re-organized.
+   * Standardized presentation for all commands.
+   * Covers many drivers and commands that were previously omitted.
+   * New index for commands and drivers.
+- Added Developer Manual: http://openocd.berlios.de/doc/doxygen/index.html
+   * Now includes architecture, technical primers, style guides, and more.
+   * Available in-tree and on-line.
+
+Build and Release:
+- Increased configuration and compilation warning coverage.
+   * Use --disable-werror to work around build errors caused by warnings.
+- Use libtool to produce helper libraries as a step toward "libopenocd".
+- New processes and scripting to facilitate future source releases.
+
+For more details about what has changed since 0.1.0, see the ChangeLog
+associated with this release.
+
+For more information about contributing test reports, bug fixes, or new
+features and device support, please read the new Developer Manual (or
+the BUGS and PATCHES files in the source archive).



From zwelch at mail.berlios.de  Mon Jul  6 13:26:31 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 6 Jul 2009 13:26:31 +0200
Subject: [Openocd-svn] r2475 - trunk/doc/manual
Message-ID: <200907061126.n66BQVxR001094@sheep.berlios.de>

Author: zwelch
Date: 2009-07-06 13:26:28 +0200 (Mon, 06 Jul 2009)
New Revision: 2475

Modified:
   trunk/doc/manual/release.txt
Log:
The late birth of the NEWS file also caused me to revisit the release
process once again and reconsider it in some detail.  In doing so,
some further revisions to the process were required:
1) The URL of the repository is embedded in the released code.
   - The packages need to be created from the tagged branch.
   - The URL then points to where to get the tagged code.
2) Improve the instructions for NEWS handling.
   - NEWS file must be updated for each release; describe that process.
   - The NEWS file should be archived an recreated for each release.
3) Add detail steps for the berliOS release process.
4) Minor cleanups to release process doxygen markup.


Modified: trunk/doc/manual/release.txt
===================================================================
--- trunk/doc/manual/release.txt	2009-07-06 11:26:21 UTC (rev 2474)
+++ trunk/doc/manual/release.txt	2009-07-06 11:26:28 UTC (rev 2475)
@@ -190,19 +190,14 @@
 The following steps should be followed to produce each release:
 
 -# Produce final patches to the trunk (or release branch):
-  -# add NEWS item to describe the release changes? (not ready for 0.2.0)
-    - the community should try to help produce this material
-    - can be used to automatically post "blurbs" about the project.
+  -# Finalize @c NEWS file to describe the changes in the release 
+    - This file is Used to automatically post "blurbs" about the project.
+    - This material should be produced during the development cycle.
+    - Add a new item for each @c NEWS-worthy contribution, when committed.
   -# bump library version if our API changed (not yet required)
   -# Remove -in-development tag from package version:
-    - For major/minor releases, remove version tag from trunk.
+    - For major/minor releases, remove version tag from trunk, @a or
     - For bug-fix releases, remove version tag from release branch.
--# Produce and verify the binary packages:
-  -# Start with a clean working copy, used for producing releases only.
-  -# produce a ChangeLog for the release (using svn2cl).
-  -# bootstrap, configure, and build the package.
-  -# run 'make distcheck' to produce the distribution archives.
-  -# run 'make maintainer-clean'; verify the repository is empty again.
 -# Branch or tag the required tree in the Subversion repository:
   - Tags and branches for releases must be named consistently: @par
     "${PACKAGE_TARNAME}-${PACKAGE_VERSION}"
@@ -218,23 +213,37 @@
 svn cp .../branches/${RELEASE_BRANCH} .../tags/${RELEASE_TAG}
 @endverbatim
 -# Prepare to resume normal development activities:
+  - Archive @c NEWS file as <code>doc/news/NEWS-${PACKAGE_VERSION}</code>.
+  - Create a new @c NEWS file for the next release
   - For major/minor release from the trunk:
     -# Bump major or minor package version in trunk.
     -# Restore version tag to trunk and release branch.
   - For bug-fix releases from a release branch:
     -# Bump bug-fix version in release branch.
     -# Restore version tag to release branch.
+-# Produce the package source archives:
+  -# Start with a clean working copy, used for producing releases only.
+  -# Switch to release tag branch: svn switch .../${RELEASE_TAG}
+  -# produce a ChangeLog for the release (using svn2cl).
+  -# @c bootstrap, @c configure, and @c make the package.
+  -# Run <code>make distcheck</code> to produce the distribution archives.
+  -# Run <code>make maintainer-clean</code> verify the repository is empty.
 -# Publish documentation for the release:
   - Allow users to access the documentation for each of our releases.
   - Place static copies of the following files on the project website:
-    - NEWS: to provide a blurb for each release (not yet used)
-    - ChangeLog: to show exactly what has been changed
+    - @c NEWS: to provide a blurb for each release
+    - @c ChangeLog: to show exactly what has been changed
     - User Guide, Developer Manual: to allow easy on-line viewing
 -# Upload packages and post announcements of their availability:
-  -# Release packages into files section of berliOS project site.
+  -# Release packages into files section of berliOS project site:
+     -# Create the new release for the new version.
+     -# Provide @c NEWS and ChangeLog files, as requested.
+     -# Upload files via FTP to ftp://ftp.berlios.de/incoming/
+     -# Edit descriptions for each file.
+     -# Send E-mail Release Notice
   -# Post announcement e-mail to the openocd-development list.
   -# Announce updates on freshmeat.net and other trackers.
-  -# Submit big NEWS updates to news feeds (e.g. Digg, Reddit, etc.).
+  -# Submit big updates to news feeds (e.g. Digg, Reddit, etc.).
 
 @section releasescript The Release Script
 
@@ -377,7 +386,7 @@
 able to manage most steps of the processes.  The steps requiring user
 input could be guided by an "assistant" that walks the Release Manager
 through the process from beginning to end, performing basic sanity
-checks on their various inputs (e.g. the NEWS blurb).
+checks on their various inputs (e.g. the @c NEWS blurb).
 
  */
 /** @file



From zwelch at mail.berlios.de  Mon Jul  6 13:26:41 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Mon, 6 Jul 2009 13:26:41 +0200
Subject: [Openocd-svn] r2476 - trunk/doc/manual
Message-ID: <200907061126.n66BQfcP001159@sheep.berlios.de>

Author: zwelch
Date: 2009-07-06 13:26:34 +0200 (Mon, 06 Jul 2009)
New Revision: 2476

Modified:
   trunk/doc/manual/release.txt
Log:
Update Release Script documentation to reflect current implementation.


Modified: trunk/doc/manual/release.txt
===================================================================
--- trunk/doc/manual/release.txt	2009-07-06 11:26:28 UTC (rev 2475)
+++ trunk/doc/manual/release.txt	2009-07-06 11:26:34 UTC (rev 2476)
@@ -267,7 +267,7 @@
 
 The following output was taken from the release script:
 @verbatim
-usage: tools/release.sh <command>
+usage: tools/release.sh [options] <command>
 
 Main Commands:
   info          Show a summary of the next pending release.
@@ -303,6 +303,20 @@
 
 Run <code>tools/release.sh help</code> for current command support.
 
+ at subsection releasescriptenv Release Script Options
+
+The @c release.sh script recognizes some command-line options that
+affect its behavior:
+
+- @c --live : Use this option to perform a live release.
+  When this option has been given, the release commands will affect
+  the repository; otherwise, the script reports the actions to take,
+  and it produces archives that are unsuitable for public release.
+
+ at note Only the Release Manager should use the @c --live option, as
+it will make permanent changes to the Subversion repository that
+cannot be undone.
+
 @subsection releasescriptenv Release Script Environment
 
 The @c release.sh script recognizes some environment variables which
@@ -310,18 +324,13 @@
 
 - @c CONFIG_OPTS : Passed as options to the configure script.
 - @c MAKE_OPTS : Passed as options to the 'make' processes.
-- @c RELEASE_DRY_RUN : Set this to null to perform the live release.
-  Unless this variable has been (un)set, the release commands will not
-  affect the repository.
 
-Proper option handling should be added to set these variables in script.
-
 @section releasetutorial Release Tutorials
 
 This section provides tutorials for using the Release Script to perform
 common release tasks.
 
- at subsection releasetutorialminor Minor Release Tutorial
+ at subsection releasetutorialsetup Release Tutorial Setup
 
 The tutorials in this section assume the following environment
 variables have been set properly:



From oharboe at mail.berlios.de  Mon Jul  6 14:03:55 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 14:03:55 +0200
Subject: [Openocd-svn] r2477 - trunk/src/jtag/zy1000
Message-ID: <200907061203.n66C3tG0024403@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 14:03:55 +0200 (Mon, 06 Jul 2009)
New Revision: 2477

Modified:
   trunk/src/jtag/zy1000/zy1000.c
Log:
revert svn 1679 - fixes cp15 read/write timeout. Single stepping still broken.

Modified: trunk/src/jtag/zy1000/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000/zy1000.c	2009-07-06 11:26:34 UTC (rev 2476)
+++ trunk/src/jtag/zy1000/zy1000.c	2009-07-06 12:03:55 UTC (rev 2477)
@@ -456,8 +456,13 @@
 
 extern int jtag_check_value(uint8_t *captured, void *priv);
 
-static __inline void scanFields(int num_fields, const scan_field_t *fields, tap_state_t shiftState, tap_state_t end_state)
+static void gotoEndState(tap_state_t end_state)
 {
+	setCurrentState(end_state);
+}
+
+static __inline void scanFields(int num_fields, const scan_field_t *fields, tap_state_t shiftState, int pause)
+{
 	int i;
 	int j;
 	int k;
@@ -488,10 +493,10 @@
 			{
 				k = 32;
 				/* we have more to shift out */
-			} else if (i == num_fields-1)
+			} else if (pause&&(i == num_fields-1))
 			{
 				/* this was the last to shift out this time */
-				pause_state = end_state;
+				pause_state = (shiftState==TAP_DRSHIFT)?TAP_DRPAUSE:TAP_IRPAUSE;
 			}
 
 			// we have (num_bits + 7)/8 bytes of bits to toggle out.
@@ -541,14 +546,7 @@
 	for (tap = jtag_tap_next_enabled(NULL); tap!= NULL; tap = nextTap)
 	{
 		nextTap = jtag_tap_next_enabled(tap);
-		tap_state_t end_state;
-		if (nextTap == NULL)
-		{
-			end_state = state;
-		} else
-		{
-			end_state = TAP_IRSHIFT;
-		}
+		int pause = (nextTap==NULL);
 
 		int found = 0;
 
@@ -561,7 +559,7 @@
 			{
 				found = 1;
 
-				scanFields(1, fields + j, TAP_IRSHIFT, end_state);
+				scanFields(1, fields + j, TAP_IRSHIFT, pause);
 				/* update device information */
 				buf_cpy(fields[j].out_value, tap->cur_instr, scan_size);
 
@@ -579,12 +577,13 @@
 			memset(&tmp, 0, sizeof(tmp));
 			tmp.out_value = ones;
 			tmp.num_bits = scan_size;
-			scanFields(1, &tmp, TAP_IRSHIFT, end_state);
+			scanFields(1, &tmp, TAP_IRSHIFT, pause);
 			/* update device information */
 			buf_cpy(tmp.out_value, tap->cur_instr, scan_size);
 			tap->bypass = 1;
 		}
 	}
+	gotoEndState(state);
 
 	return ERROR_OK;
 }
@@ -595,7 +594,8 @@
 
 int interface_jtag_add_plain_ir_scan(int num_fields, const scan_field_t *fields, tap_state_t state)
 {
-	scanFields(num_fields, fields, TAP_IRSHIFT, state);
+	scanFields(num_fields, fields, TAP_IRSHIFT, 1);
+	gotoEndState(state);
 
 	return ERROR_OK;
 }
@@ -611,14 +611,7 @@
 	{
 		nextTap = jtag_tap_next_enabled(tap);
 		int found = 0;
-		tap_state_t end_state;
-		if (nextTap == NULL)
-		{
-			end_state = state;
-		} else
-		{
-			end_state = TAP_DRSHIFT;
-		}
+		int pause = (nextTap==NULL);
 
 		for (j = 0; j < num_fields; j++)
 		{
@@ -626,7 +619,7 @@
 			{
 				found = 1;
 
-				scanFields(1, fields + j, TAP_DRSHIFT, end_state);
+				scanFields(1, fields+j, TAP_DRSHIFT, pause);
 			}
 		}
 		if (!found)
@@ -637,18 +630,20 @@
 			tmp.out_value = NULL;
 			tmp.in_value = NULL;
 
-			scanFields(1, &tmp, TAP_DRSHIFT, end_state);
+			scanFields(1, &tmp, TAP_DRSHIFT, pause);
 		}
 		else
 		{
 		}
 	}
+	gotoEndState(state);
 	return ERROR_OK;
 }
 
 int interface_jtag_add_plain_dr_scan(int num_fields, const scan_field_t *fields, tap_state_t state)
 {
-	scanFields(num_fields, fields, TAP_DRSHIFT, state);
+	scanFields(num_fields, fields, TAP_DRSHIFT, 1);
+	gotoEndState(state);
 	return ERROR_OK;
 }
 



From oharboe at mail.berlios.de  Mon Jul  6 15:42:12 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 15:42:12 +0200
Subject: [Openocd-svn] r2478 - trunk/src/target
Message-ID: <200907061342.n66DgCV8000114@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 15:42:11 +0200 (Mon, 06 Jul 2009)
New Revision: 2478

Modified:
   trunk/src/target/target.c
Log:
Fix regression in "step" command introduced in 2190

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-07-06 12:03:55 UTC (rev 2477)
+++ trunk/src/target/target.c	2009-07-06 13:42:11 UTC (rev 2478)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008, Duane Ellis                                       *
@@ -2039,15 +2039,18 @@
 	 * with one argument addr = args[0],
 	 * handle breakpoints, debugging */
 	uint32_t addr = 0;
+	int current_pc = 1;
 	if (argc == 1)
 	{
 		int retval = parse_u32(args[0], &addr);
 		if (ERROR_OK != retval)
 			return retval;
+		current_pc = 0;
 	}
 
 	target_t *target = get_current_target(cmd_ctx);
-	return target->type->step(target, 0, addr, 1);
+
+	return target->type->step(target, current_pc, addr, 1);
 }
 
 static void handle_md_output(struct command_context_s *cmd_ctx,



From oharboe at mail.berlios.de  Mon Jul  6 16:25:26 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 16:25:26 +0200
Subject: [Openocd-svn] r2479 - trunk/src/target
Message-ID: <200907061425.n66EPQNl004279@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 16:25:25 +0200 (Mon, 06 Jul 2009)
New Revision: 2479

Modified:
   trunk/src/target/arm926ejs.c
Log:
Fix certain arm926ejs targets(e.g. i.MX27) which report an unknown MOE(method of entry) - interpret this as dbgrq. "reset run" + "halt" + "step" now works.

Modified: trunk/src/target/arm926ejs.c
===================================================================
--- trunk/src/target/arm926ejs.c	2009-07-06 13:42:11 UTC (rev 2478)
+++ trunk/src/target/arm926ejs.c	2009-07-06 14:25:25 UTC (rev 2479)
@@ -360,20 +360,21 @@
 			 * openocd development mailing list if you have hardware
 			 * to donate to look into this problem....
 			 */
-			LOG_ERROR("mystery debug reason MOE = 0xc. Try issuing a resume + halt.");
+			LOG_WARNING("WARNING: mystery debug reason MOE = 0xc. Try issuing a resume + halt.");
 			target->debug_reason = DBG_REASON_DBGRQ;
-			retval = ERROR_TARGET_FAILURE;
 			break;
 		default:
-			LOG_ERROR("BUG: unknown debug reason: 0x%x", debug_reason);
+			LOG_WARNING("WARNING: unknown debug reason: 0x%x", debug_reason);
+			/* Oh agony! should we interpret this as a halt request or
+			 * that the target stopped on it's own accord?
+			 */
 			target->debug_reason = DBG_REASON_DBGRQ;
 			/* if we fail here, we won't talk to the target and it will
 			 * be reported to be in the halted state */
-			retval = ERROR_TARGET_FAILURE;
 			break;
 	}
 
-	return retval;
+	return ERROR_OK;
 }
 
 uint32_t arm926ejs_get_ttb(target_t *target)



From oharboe at mail.berlios.de  Mon Jul  6 16:58:14 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 16:58:14 +0200
Subject: [Openocd-svn] r2480 - trunk/src/target
Message-ID: <200907061458.n66EwEnN006939@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 16:58:13 +0200 (Mon, 06 Jul 2009)
New Revision: 2480

Modified:
   trunk/src/target/armv4_5.h
Log:
a bit more debug output for translation of invalid mode numbers

Modified: trunk/src/target/armv4_5.h
===================================================================
--- trunk/src/target/armv4_5.h	2009-07-06 14:25:25 UTC (rev 2479)
+++ trunk/src/target/armv4_5.h	2009-07-06 14:58:13 UTC (rev 2480)
@@ -114,7 +114,7 @@
 		case ARMV4_5_MODE_SYS: return 6; break;
 		case ARMV4_5_MODE_ANY: return 0; break;	/* map MODE_ANY to user mode */
 		default:
-			LOG_ERROR("invalid mode value encountered");
+			LOG_ERROR("invalid mode value encountered %d", mode);
 			return -1;
 	}
 }



From oharboe at mail.berlios.de  Mon Jul  6 17:04:21 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 6 Jul 2009 17:04:21 +0200
Subject: [Openocd-svn] r2481 - trunk/src/target
Message-ID: <200907061504.n66F4LsL007436@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 17:04:20 +0200 (Mon, 06 Jul 2009)
New Revision: 2481

Modified:
   trunk/src/target/armv4_5.h
Log:
more debug output for translation of arm mode number to enum

Modified: trunk/src/target/armv4_5.h
===================================================================
--- trunk/src/target/armv4_5.h	2009-07-06 14:58:13 UTC (rev 2480)
+++ trunk/src/target/armv4_5.h	2009-07-06 15:04:20 UTC (rev 2481)
@@ -132,7 +132,7 @@
 		case 5: return ARMV4_5_MODE_UND; break;
 		case 6: return ARMV4_5_MODE_SYS; break;
 		default:
-			LOG_ERROR("mode index out of bounds");
+			LOG_ERROR("mode index out of bounds %d", number);
 			return ARMV4_5_MODE_ANY;
 	}
 };



From ntfreak at mail.berlios.de  Mon Jul  6 17:19:11 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Mon, 6 Jul 2009 17:19:11 +0200
Subject: [Openocd-svn] r2482 - in trunk: . src/helper
Message-ID: <200907061519.n66FJBli008335@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-06 17:19:10 +0200 (Mon, 06 Jul 2009)
New Revision: 2482

Modified:
   trunk/configure.in
   trunk/src/helper/replacements.h
Log:
- fix build when using a cross compiler - do not try and run any host tools
- add missing types.h when platform does not contain elf.h

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-07-06 15:04:20 UTC (rev 2481)
+++ trunk/configure.in	2009-07-06 15:19:10 UTC (rev 2482)
@@ -824,7 +824,9 @@
     AC_MSG_RESULT([Success!])
   ], [
     AC_MSG_ERROR([Cannot build & run test program using ftd2xx.lib])
-  ] )
+  ], [
+    AC_MSG_RESULT([Skipping as we are cross-compiling])
+  ])
 
 AC_MSG_CHECKING([whether to build ftd2xx highspeed device support])
 AC_MSG_RESULT([$want_ftd2xx_highspeed])
@@ -891,7 +893,10 @@
       AC_MSG_RESULT([Success])
     ], [
       AC_MSG_ERROR([Cannot build & run test program using libftdi])
+    ], [
+      AC_MSG_RESULT([Skipping as we are cross-compiling])
     ])
+
   # Restore the 'unexpanded ldflags'
   LDFLAGS=$LDFLAGS_SAVE
   CFLAGS=$CFLAGS_SAVE

Modified: trunk/src/helper/replacements.h
===================================================================
--- trunk/src/helper/replacements.h	2009-07-06 15:04:20 UTC (rev 2481)
+++ trunk/src/helper/replacements.h	2009-07-06 15:19:10 UTC (rev 2482)
@@ -210,6 +210,8 @@
 
 #ifndef HAVE_ELF_H
 
+#include "types.h"
+
 typedef uint32_t	Elf32_Addr;
 typedef uint16_t	Elf32_Half;
 typedef uint32_t	Elf32_Off;



From ntfreak at mail.berlios.de  Mon Jul  6 17:41:56 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Mon, 6 Jul 2009 17:41:56 +0200
Subject: [Openocd-svn] r2483 - trunk/src/jtag
Message-ID: <200907061541.n66FfuiI009927@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-06 17:41:55 +0200 (Mon, 06 Jul 2009)
New Revision: 2483

Modified:
   trunk/src/jtag/jlink.c
Log:
- change sleep to usleep - fixes issue under win32 build

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-07-06 15:19:10 UTC (rev 2482)
+++ trunk/src/jtag/jlink.c	2009-07-06 15:41:55 UTC (rev 2483)
@@ -328,7 +328,7 @@
 	LOG_INFO("J-Link initialization started / target CPU reset initiated");
 	jlink_simple_command(EMU_CMD_HW_TRST0);
 	jlink_simple_command(EMU_CMD_HW_RESET0);
-	sleep(1);
+	usleep(1000);
 
 	jlink_hw_jtag_version = 2;
 



From oharboe at mail.berlios.de  Mon Jul  6 23:16:13 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Mon, 6 Jul 2009 23:16:13 +0200
Subject: [Openocd-svn] r2484 - in trunk: doc tcl/target
Message-ID: <200907062116.n66LGDHX030590@sheep.berlios.de>

Author: oharboe
Date: 2009-07-06 23:16:11 +0200 (Mon, 06 Jul 2009)
New Revision: 2484

Modified:
   trunk/doc/openocd.texi
   trunk/tcl/target/ti_dm355.cfg
   trunk/tcl/target/ti_dm365.cfg
   trunk/tcl/target/ti_dm6446.cfg
Log:
David Brownell <david-b at pacbell.net> Update docs to say that "arm7_9 dbgrq enable" is the default
on ARM9 cores, and update the DaVinci config files so they
no longer explicitly specify it.

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-07-06 15:41:55 UTC (rev 2483)
+++ trunk/doc/openocd.texi	2009-07-06 21:16:11 UTC (rev 2484)
@@ -4631,6 +4631,8 @@
 Control use of the EmbeddedIce DBGRQ signal to force entry into debug mode,
 instead of breakpoints.  This should be
 safe for all but ARM7TDMI--S cores (like Philips LPC). 
+This feature is enabled by default on most ARM9 cores,
+including ARM9TDMI, ARM920T, and ARM926EJ-S.
 @end deffn
 
 @deffn Command {arm7_9 dcc_downloads} (@option{enable}|@option{disable})

Modified: trunk/tcl/target/ti_dm355.cfg
===================================================================
--- trunk/tcl/target/ti_dm355.cfg	2009-07-06 15:41:55 UTC (rev 2483)
+++ trunk/tcl/target/ti_dm355.cfg	2009-07-06 21:16:11 UTC (rev 2484)
@@ -83,7 +83,6 @@
 	-work-area-size 0x4000 \
 	-work-area-backup 0
 
-arm7_9 dbgrq enable
 arm7_9 fast_memory_access enable
 arm7_9 dcc_downloads enable
 

Modified: trunk/tcl/target/ti_dm365.cfg
===================================================================
--- trunk/tcl/target/ti_dm365.cfg	2009-07-06 15:41:55 UTC (rev 2483)
+++ trunk/tcl/target/ti_dm365.cfg	2009-07-06 21:16:11 UTC (rev 2484)
@@ -88,7 +88,6 @@
 	-work-area-size 0x4000 \
 	-work-area-backup 0
 
-arm7_9 dbgrq enable
 arm7_9 fast_memory_access enable
 arm7_9 dcc_downloads enable
 

Modified: trunk/tcl/target/ti_dm6446.cfg
===================================================================
--- trunk/tcl/target/ti_dm6446.cfg	2009-07-06 15:41:55 UTC (rev 2483)
+++ trunk/tcl/target/ti_dm6446.cfg	2009-07-06 21:16:11 UTC (rev 2484)
@@ -68,7 +68,6 @@
 target create $_TARGETNAME arm926ejs -chain-position $_TARGETNAME
 $_TARGETNAME configure -work-area-phys 0x0000a000 -work-area-size 0x2000
 
-arm7_9 dbgrq enable
 arm7_9 fast_memory_access enable
 arm7_9 dcc_downloads enable
 



From oharboe at mail.berlios.de  Tue Jul  7 08:54:15 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 7 Jul 2009 08:54:15 +0200
Subject: [Openocd-svn] r2485 - trunk
Message-ID: <200907070654.n676sFia025231@sheep.berlios.de>

Author: oharboe
Date: 2009-07-07 08:54:14 +0200 (Tue, 07 Jul 2009)
New Revision: 2485

Modified:
   trunk/TODO
Log:
added known arm926ejs regressions

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-06 21:16:11 UTC (rev 2484)
+++ trunk/TODO	2009-07-07 06:54:14 UTC (rev 2485)
@@ -11,6 +11,17 @@
 
 Feel free to send patches to add or clarify items on this list, too.
 
+ at section thelisttcl Regressions
+
+- Dominic has spotted a "reset halt" regression between 838(fails) and 729(works)
+
+https://lists.berlios.de/pipermail/openocd-development/2009-July/009206.html
+
+ at section thelisttcl Bugs
+
+- reset run/halt/step for arm926ejs is not robust. Needs lots of testing to
+map out problems.
+
 @section thelisttcl TCL
 
 This section provides possible things to improve with OpenOCD's TCL support.



From oharboe at mail.berlios.de  Tue Jul  7 12:33:21 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 7 Jul 2009 12:33:21 +0200
Subject: [Openocd-svn] r2486 - trunk
Message-ID: <200907071033.n67AXLZ3022276@sheep.berlios.de>

Author: oharboe
Date: 2009-07-07 12:33:20 +0200 (Tue, 07 Jul 2009)
New Revision: 2486

Modified:
   trunk/TODO
Log:
more arm926ejs bugs 

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-07 06:54:14 UTC (rev 2485)
+++ trunk/TODO	2009-07-07 10:33:20 UTC (rev 2486)
@@ -22,6 +22,25 @@
 - reset run/halt/step for arm926ejs is not robust. Needs lots of testing to
 map out problems.
 
+- i.MX27 reset run problems. Notice below that even if the target is running,
+a EICE_DBG_STATUS_DBGACK(I think...) is detected and OpenOCD wrongly believes that the
+target is halted. Polling the target afterwards reveals that the
+target is running. Notice the MOE=0xe value.
+
+> reset run
+JTAG tap: imx27.bs tap/device found: 0x1b900f0f (mfg: 0x787, part: 0xb900, ver: 0x1)
+JTAG Tap/device matched
+JTAG tap: imx27.cpu tap/device found: 0x07926121 (mfg: 0x090, part: 0x7926, ver: 0x0)
+JTAG Tap/device matched
+WARNING: unknown debug reason: 0xe
+target state: halted
+target halted in ARM state due to debug-request, current mode: User
+cpsr: 0x00000000 pc: 0xffffffe8
+MMU: disabled, D-Cache: disabled, I-Cache: disabled
+
+
+
+
 @section thelisttcl TCL
 
 This section provides possible things to improve with OpenOCD's TCL support.



From oharboe at mail.berlios.de  Tue Jul  7 12:43:45 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 7 Jul 2009 12:43:45 +0200
Subject: [Openocd-svn] r2487 - trunk/src/helper
Message-ID: <200907071043.n67Ahj3r031413@sheep.berlios.de>

Author: oharboe
Date: 2009-07-07 12:43:44 +0200 (Tue, 07 Jul 2009)
New Revision: 2487

Modified:
   trunk/src/helper/startup.tcl
Log:
delete long retired commented out code (daemon_startup)

Modified: trunk/src/helper/startup.tcl
===================================================================
--- trunk/src/helper/startup.tcl	2009-07-07 10:33:20 UTC (rev 2486)
+++ trunk/src/helper/startup.tcl	2009-07-07 10:43:44 UTC (rev 2487)
@@ -123,10 +123,6 @@
 	source [find $filename]
 }
 
-#proc daemon_reset {} {
-#	puts "Daemon reset is obsolete. Use -c init -c \"reset halt\" at end of openocd command line instead");
-#}
-
 add_help_text script "<filename> - filename of OpenOCD script (tcl) to run"
 
 # Handle GDB 'R' packet. Can be overriden by configuration script,



From oharboe at mail.berlios.de  Tue Jul  7 12:47:24 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 7 Jul 2009 12:47:24 +0200
Subject: [Openocd-svn] r2488 - trunk/src/jtag
Message-ID: <200907071047.n67AlO9V001178@sheep.berlios.de>

Author: oharboe
Date: 2009-07-07 12:47:23 +0200 (Tue, 07 Jul 2009)
New Revision: 2488

Modified:
   trunk/src/jtag/tcl.c
Log:
fix return value for "reset" and "runtest" command. Found by code inspection.

Modified: trunk/src/jtag/tcl.c
===================================================================
--- trunk/src/jtag/tcl.c	2009-07-07 10:43:44 UTC (rev 2487)
+++ trunk/src/jtag/tcl.c	2009-07-07 10:47:23 UTC (rev 2488)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2009 SoftPLC Corporation                                *
@@ -1016,9 +1016,7 @@
 		return ERROR_JTAG_INIT_FAILED;
 
 	jtag_add_reset(trst, srst);
-	jtag_execute_queue();
-
-	return ERROR_OK;
+	return jtag_execute_queue();
 }
 
 static int handle_runtest_command(struct command_context_s *cmd_ctx,
@@ -1033,9 +1031,7 @@
 		return retval;
 
 	jtag_add_runtest(num_clocks, TAP_IDLE);
-	jtag_execute_queue();
-
-	return ERROR_OK;
+	return jtag_execute_queue();
 }
 
 /*



From oharboe at mail.berlios.de  Tue Jul  7 13:29:35 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 7 Jul 2009 13:29:35 +0200
Subject: [Openocd-svn] r2489 - trunk
Message-ID: <200907071129.n67BTZhA017335@sheep.berlios.de>

Author: oharboe
Date: 2009-07-07 13:29:34 +0200 (Tue, 07 Jul 2009)
New Revision: 2489

Modified:
   trunk/README
Log:
fixed a small typo in howto create doxygen docs

Modified: trunk/README
===================================================================
--- trunk/README	2009-07-07 10:47:23 UTC (rev 2488)
+++ trunk/README	2009-07-07 11:29:34 UTC (rev 2489)
@@ -51,10 +51,11 @@
 The OpenOCD Developer Manual contains information about the internal
 architecture and other details about the code:
 
+  # NB! make sure doxygen is installed, type doxygen --version
   make doxygen
 
   # If HTMLVIEWER is set, this views the HTML Doxygen output.
-  ${HTMLVIEWER} doxyegen/index.html
+  ${HTMLVIEWER} doxygen/index.html
 
 The remaining sections describe how to configure the system such that
 you can build the in-tree documentation.



From oharboe at mail.berlios.de  Tue Jul  7 13:33:00 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 7 Jul 2009 13:33:00 +0200
Subject: [Openocd-svn] r2490 - trunk
Message-ID: <200907071133.n67BX07e021216@sheep.berlios.de>

Author: oharboe
Date: 2009-07-07 13:32:58 +0200 (Tue, 07 Jul 2009)
New Revision: 2490

Modified:
   trunk/TODO
Log:
Use reference to mailing list for known arm926ejs bugs rather fill The List with lots of details

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-07 11:29:34 UTC (rev 2489)
+++ trunk/TODO	2009-07-07 11:32:58 UTC (rev 2490)
@@ -22,25 +22,10 @@
 - reset run/halt/step for arm926ejs is not robust. Needs lots of testing to
 map out problems.
 
-- i.MX27 reset run problems. Notice below that even if the target is running,
-a EICE_DBG_STATUS_DBGACK(I think...) is detected and OpenOCD wrongly believes that the
-target is halted. Polling the target afterwards reveals that the
-target is running. Notice the MOE=0xe value.
+- i.MX27 reset run problems.
 
-> reset run
-JTAG tap: imx27.bs tap/device found: 0x1b900f0f (mfg: 0x787, part: 0xb900, ver: 0x1)
-JTAG Tap/device matched
-JTAG tap: imx27.cpu tap/device found: 0x07926121 (mfg: 0x090, part: 0x7926, ver: 0x0)
-JTAG Tap/device matched
-WARNING: unknown debug reason: 0xe
-target state: halted
-target halted in ARM state due to debug-request, current mode: User
-cpsr: 0x00000000 pc: 0xffffffe8
-MMU: disabled, D-Cache: disabled, I-Cache: disabled
+https://lists.berlios.de/pipermail/openocd-development/2009-July/009240.html
 
-
-
-
 @section thelisttcl TCL
 
 This section provides possible things to improve with OpenOCD's TCL support.



From oharboe at mail.berlios.de  Tue Jul  7 13:39:04 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 7 Jul 2009 13:39:04 +0200
Subject: [Openocd-svn] r2491 - trunk
Message-ID: <200907071139.n67Bd4RN007684@sheep.berlios.de>

Author: oharboe
Date: 2009-07-07 13:39:04 +0200 (Tue, 07 Jul 2009)
New Revision: 2491

Modified:
   trunk/TODO
Log:
Zach Welch: move bugs into the right section

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-07 11:32:58 UTC (rev 2490)
+++ trunk/TODO	2009-07-07 11:39:04 UTC (rev 2491)
@@ -11,21 +11,6 @@
 
 Feel free to send patches to add or clarify items on this list, too.
 
- at section thelisttcl Regressions
-
-- Dominic has spotted a "reset halt" regression between 838(fails) and 729(works)
-
-https://lists.berlios.de/pipermail/openocd-development/2009-July/009206.html
-
- at section thelisttcl Bugs
-
-- reset run/halt/step for arm926ejs is not robust. Needs lots of testing to
-map out problems.
-
-- i.MX27 reset run problems.
-
-https://lists.berlios.de/pipermail/openocd-development/2009-July/009240.html
-
 @section thelisttcl TCL
 
 This section provides possible things to improve with OpenOCD's TCL support.
@@ -114,6 +99,13 @@
 
 - general layer cleanup: @par
   https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
+- regression: "reset halt" between 729(works) and 838(fails): @par
+https://lists.berlios.de/pipermail/openocd-development/2009-July/009206.html
+- ARM923EJS:
+  - reset run/halt/step is not robust; needs testing to map out problems.
+- i.MX27 
+  -reset run problems: @par
+https://lists.berlios.de/pipermail/openocd-development/2009-July/009240.html
 - ARM11 improvements (MB?)
   - fix single stepping  (reported by ?H)
   - implement missing functionality (grep FNC_INFO_NOTIMPLEMENTED ...)



From oharboe at mail.berlios.de  Tue Jul  7 18:50:37 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 7 Jul 2009 18:50:37 +0200
Subject: [Openocd-svn] r2492 - trunk/tcl/target
Message-ID: <200907071650.n67Gobdq000503@sheep.berlios.de>

Author: oharboe
Date: 2009-07-07 18:50:28 +0200 (Tue, 07 Jul 2009)
New Revision: 2492

Modified:
   trunk/tcl/target/imx27.cfg
Log:
srst pulls trst according to Freescale docs for i.mx27

Modified: trunk/tcl/target/imx27.cfg
===================================================================
--- trunk/tcl/target/imx27.cfg	2009-07-07 11:39:04 UTC (rev 2491)
+++ trunk/tcl/target/imx27.cfg	2009-07-07 16:50:28 UTC (rev 2492)
@@ -1,5 +1,10 @@
-#use combined on interfaces or targets that can't set TRST/SRST separately
-reset_config trst_and_srst
+# page 3-34 of "MCIMC27 Multimedia Applications Processor Reference Manual, Rev 0.3"
+# SRST pulls TRST
+#
+# Without setting these options correctly you'll see all sorts
+# of weird errors, e.g. MOE=0xe, invalid cpsr values, reset
+# failing, etc.
+reset_config srst_only srst_pulls_trst
 
 if { [info exists CHIPNAME] } {	
    set  _CHIPNAME $CHIPNAME    



From oharboe at mail.berlios.de  Wed Jul  8 08:32:28 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 8 Jul 2009 08:32:28 +0200
Subject: [Openocd-svn] r2493 - trunk/tcl/target
Message-ID: <200907080632.n686WSG5024933@sheep.berlios.de>

Author: oharboe
Date: 2009-07-08 08:32:27 +0200 (Wed, 08 Jul 2009)
New Revision: 2493

Modified:
   trunk/tcl/target/imx21.cfg
   trunk/tcl/target/imx27.cfg
Log:
sharpen reset_config for imx27 - use both trst & srst. srst pulls trst.

Modified: trunk/tcl/target/imx21.cfg
===================================================================
--- trunk/tcl/target/imx21.cfg	2009-07-07 16:50:28 UTC (rev 2492)
+++ trunk/tcl/target/imx21.cfg	2009-07-08 06:32:27 UTC (rev 2493)
@@ -1,4 +1,6 @@
 #use combined on interfaces or targets that can't set TRST/SRST separately
+#
+# Hmmm.... should srst_pulls_trst be used here like i.MX27???
 reset_config trst_and_srst
 
 if { [info exists CHIPNAME] } {	

Modified: trunk/tcl/target/imx27.cfg
===================================================================
--- trunk/tcl/target/imx27.cfg	2009-07-07 16:50:28 UTC (rev 2492)
+++ trunk/tcl/target/imx27.cfg	2009-07-08 06:32:27 UTC (rev 2493)
@@ -4,7 +4,7 @@
 # Without setting these options correctly you'll see all sorts
 # of weird errors, e.g. MOE=0xe, invalid cpsr values, reset
 # failing, etc.
-reset_config srst_only srst_pulls_trst
+reset_config trst_and_srst srst_pulls_trst
 
 if { [info exists CHIPNAME] } {	
    set  _CHIPNAME $CHIPNAME    



From oharboe at mail.berlios.de  Wed Jul  8 08:49:15 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 8 Jul 2009 08:49:15 +0200
Subject: [Openocd-svn] r2494 - trunk
Message-ID: <200907080649.n686nFIN025846@sheep.berlios.de>

Author: oharboe
Date: 2009-07-08 08:49:15 +0200 (Wed, 08 Jul 2009)
New Revision: 2494

Modified:
   trunk/TODO
Log:
i.MX27 reset problems fixed & update remaining reset problems notes

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-08 06:32:27 UTC (rev 2493)
+++ trunk/TODO	2009-07-08 06:49:15 UTC (rev 2494)
@@ -99,13 +99,10 @@
 
 - general layer cleanup: @par
   https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
-- regression: "reset halt" between 729(works) and 838(fails): @par
+- regression: "reset halt" between 729(works) and 788(fails): @par
 https://lists.berlios.de/pipermail/openocd-development/2009-July/009206.html
 - ARM923EJS:
   - reset run/halt/step is not robust; needs testing to map out problems.
-- i.MX27 
-  -reset run problems: @par
-https://lists.berlios.de/pipermail/openocd-development/2009-July/009240.html
 - ARM11 improvements (MB?)
   - fix single stepping  (reported by ?H)
   - implement missing functionality (grep FNC_INFO_NOTIMPLEMENTED ...)



From oharboe at mail.berlios.de  Wed Jul  8 10:05:21 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 8 Jul 2009 10:05:21 +0200
Subject: [Openocd-svn] r2495 - trunk
Message-ID: <200907080805.n6885Lsp031750@sheep.berlios.de>

Author: oharboe
Date: 2009-07-08 10:05:21 +0200 (Wed, 08 Jul 2009)
New Revision: 2495

Modified:
   trunk/TODO
Log:
some TODO notes on aduc702x which clearly needs more work & testing

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-08 06:49:15 UTC (rev 2494)
+++ trunk/TODO	2009-07-08 08:05:21 UTC (rev 2495)
@@ -136,6 +136,14 @@
 
 @section thelistflash Flash Support
 
+- aduc702x segfault reported by Thomas A Moulton
+
+https://lists.berlios.de/pipermail/openocd-development/2009-July/009186.html
+
+- aduc7024 programming w/working area does not work:
+
+https://lists.berlios.de/pipermail/openocd-development/2009-July/009337.html
+
 - finish documentation for the following flash drivers:
   - avr
   - ecosflash



From oharboe at mail.berlios.de  Wed Jul  8 12:25:24 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 8 Jul 2009 12:25:24 +0200
Subject: [Openocd-svn] r2496 - trunk/src/server
Message-ID: <200907081025.n68APO0U009179@sheep.berlios.de>

Author: oharboe
Date: 2009-07-08 12:25:23 +0200 (Wed, 08 Jul 2009)
New Revision: 2496

Modified:
   trunk/src/server/gdb_server.c
Log:
typo in comment

Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2009-07-08 08:05:21 UTC (rev 2495)
+++ trunk/src/server/gdb_server.c	2009-07-08 10:25:23 UTC (rev 2496)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *
@@ -671,7 +671,7 @@
 {
 	gdb_connection_t *gdb_connection = connection->priv;
 
-	/* In the GDB protocol when we are stepping or coninuing execution,
+	/* In the GDB protocol when we are stepping or continuing execution,
 	 * we have a lingering reply. Upon receiving a halted event
 	 * when we have that lingering packet, we reply to the original
 	 * step or continue packet.



From oharboe at mail.berlios.de  Wed Jul  8 12:25:40 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 8 Jul 2009 12:25:40 +0200
Subject: [Openocd-svn] r2497 - trunk
Message-ID: <200907081025.n68APeAG009204@sheep.berlios.de>

Author: oharboe
Date: 2009-07-08 12:25:39 +0200 (Wed, 08 Jul 2009)
New Revision: 2497

Modified:
   trunk/TODO
Log:
Xscale installation regression entered

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-08 10:25:23 UTC (rev 2496)
+++ trunk/TODO	2009-07-08 10:25:39 UTC (rev 2497)
@@ -97,6 +97,10 @@
 
 @section thelisttargets Target Support
 
+- regression: xscale does not place debug_handler.bin into the right spot:
+
+https://lists.berlios.de/pipermail/openocd-development/2009-July/009338.html
+
 - general layer cleanup: @par
   https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
 - regression: "reset halt" between 729(works) and 788(fails): @par



From oharboe at mail.berlios.de  Wed Jul  8 12:38:51 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 8 Jul 2009 12:38:51 +0200
Subject: [Openocd-svn] r2498 - trunk
Message-ID: <200907081038.n68Acp1v015796@sheep.berlios.de>

Author: oharboe
Date: 2009-07-08 12:38:50 +0200 (Wed, 08 Jul 2009)
New Revision: 2498

Modified:
   trunk/TODO
Log:
fix formatting of xscale bug entry(learning every day)

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-08 10:25:39 UTC (rev 2497)
+++ trunk/TODO	2009-07-08 10:38:50 UTC (rev 2498)
@@ -97,12 +97,10 @@
 
 @section thelisttargets Target Support
 
-- regression: xscale does not place debug_handler.bin into the right spot:
-
-https://lists.berlios.de/pipermail/openocd-development/2009-July/009338.html
-
 - general layer cleanup: @par
   https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
+- regression: xscale does not place debug_handler.bin into the right spot: @par
+  https://lists.berlios.de/pipermail/openocd-development/2009-July/009338.html
 - regression: "reset halt" between 729(works) and 788(fails): @par
 https://lists.berlios.de/pipermail/openocd-development/2009-July/009206.html
 - ARM923EJS:



From oharboe at mail.berlios.de  Wed Jul  8 20:29:04 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Wed, 8 Jul 2009 20:29:04 +0200
Subject: [Openocd-svn] r2499 - trunk/src/flash
Message-ID: <200907081829.n68IT4Xu005558@sheep.berlios.de>

Author: oharboe
Date: 2009-07-08 20:29:03 +0200 (Wed, 08 Jul 2009)
New Revision: 2499

Modified:
   trunk/src/flash/aduc702x.c
Log:
Fix SEGFAULTs and broken error handling for flash programming w/working area

Modified: trunk/src/flash/aduc702x.c
===================================================================
--- trunk/src/flash/aduc702x.c	2009-07-08 10:38:50 UTC (rev 2498)
+++ trunk/src/flash/aduc702x.c	2009-07-08 18:29:03 UTC (rev 2499)
@@ -193,6 +193,11 @@
 	return ERROR_FLASH_OPERATION_FAILED;
 }
 
+/* If this fn returns ERROR_TARGET_RESOURCE_NOT_AVAILABLE, then the caller can fall
+ * back to another mechanism that does not require onboard RAM
+ *
+ * Caller should not check for other return values specifically
+ */
 static int aduc702x_write_block(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count)
 {
 	aduc702x_flash_bank_t *aduc702x_info = bank->driver_priv;
@@ -204,6 +209,12 @@
 	armv4_5_algorithm_t armv4_5_info;
 	int retval = ERROR_OK;
 
+	if (((count%2)!=0)||((offset%2)!=0))
+	{
+		LOG_ERROR("write block must be multiple of two bytes in offset & length");
+		return ERROR_FAIL;
+	}
+
         /* parameters:
 
         r0 - address of source data (absolute)
@@ -249,8 +260,12 @@
 		return ERROR_TARGET_RESOURCE_NOT_AVAILABLE;
 	};
 
-	target_write_buffer(target, aduc702x_info->write_algorithm->address,
+	retval=target_write_buffer(target, aduc702x_info->write_algorithm->address,
                 sizeof(aduc702x_flash_write_code), (uint8_t*)aduc702x_flash_write_code);
+	if (retval!=ERROR_OK)
+	{
+		return retval;
+	}
 
 	/* memory buffer */
 	while (target_alloc_working_area(target, buffer_size, &source) != ERROR_OK)
@@ -279,12 +294,16 @@
 
 	while (count > 0)
 	{
-		uint32_t thisrun_count = (count > (buffer_size / 2)) ? (buffer_size / 2) : count;
+		uint32_t thisrun_count = (count > buffer_size) ? buffer_size : count;
 
-		target_write_buffer(target, source->address, thisrun_count * 2, buffer);
+		retval=target_write_buffer(target, source->address, thisrun_count, buffer);
+		if (retval!=ERROR_OK)
+		{
+			break;
+		}
 
 		buf_set_u32(reg_params[0].value, 0, 32, source->address);
-		buf_set_u32(reg_params[1].value, 0, 32, thisrun_count);
+		buf_set_u32(reg_params[1].value, 0, 32, thisrun_count/2);
 		buf_set_u32(reg_params[2].value, 0, 32, address);
 		buf_set_u32(reg_params[4].value, 0, 32, 0xFFFFF800);
 
@@ -294,17 +313,19 @@
                         10000, &armv4_5_info)) != ERROR_OK)
 		{
 			LOG_ERROR("error executing aduc702x flash write algorithm");
-			retval = ERROR_FLASH_OPERATION_FAILED;
 			break;
 		}
 
-		if ((buf_get_u32(reg_params[3].value, 0, 32) & 1) != 1) {
-			retval = ERROR_FLASH_OPERATION_FAILED;
+		if ((buf_get_u32(reg_params[3].value, 0, 32) & 1) != 1)
+		{
+			/* FIX!!!! what does this mean??? replace w/sensible error message */
+			LOG_ERROR("aduc702x detected error writing flash");
+			retval = ERROR_FAIL;
 			break;
 		}
 
-		buffer += thisrun_count * 2;
-		address += thisrun_count * 2;
+		buffer += thisrun_count;
+		address += thisrun_count;
 		count -= thisrun_count;
 	}
 
@@ -382,14 +403,9 @@
                                 return ERROR_FLASH_OPERATION_FAILED;
                         }
                 }
-                else if (retval == ERROR_FLASH_OPERATION_FAILED)
-                {
-                        LOG_ERROR("flash block writing failed");
-                        return ERROR_FLASH_OPERATION_FAILED;
-                }
         }
 
-        return ERROR_OK;
+        return retval;
 }
 
 static int aduc702x_probe(struct flash_bank_s *bank)



From zwelch at mail.berlios.de  Thu Jul  9 00:26:27 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 9 Jul 2009 00:26:27 +0200
Subject: [Openocd-svn] r2500 - trunk
Message-ID: <200907082226.n68MQRUT003108@sheep.berlios.de>

Author: zwelch
Date: 2009-07-09 00:26:20 +0200 (Thu, 09 Jul 2009)
New Revision: 2500

Modified:
   trunk/BUGS
   trunk/PATCHES
   trunk/TODO
Log:
Add comments to top-level files to "excuse" their Doxygen markup.


Modified: trunk/BUGS
===================================================================
--- trunk/BUGS	2009-07-08 18:29:03 UTC (rev 2499)
+++ trunk/BUGS	2009-07-08 22:26:20 UTC (rev 2500)
@@ -1,3 +1,4 @@
+// This file is part of the Doyxgen Developer Manual
 /** @page bugs Bug Reporting
 
 Please report bugs by subscribing to the OpenOCD mailing list and

Modified: trunk/PATCHES
===================================================================
--- trunk/PATCHES	2009-07-08 18:29:03 UTC (rev 2499)
+++ trunk/PATCHES	2009-07-08 22:26:20 UTC (rev 2500)
@@ -1,7 +1,7 @@
+// This file is part of the Doyxgen Developer Manual
 /** @page patchguide Patch Guidelines
 
-Please mail patches to:
-
+Please mail patches to: @par
 	openocd-development at lists.berlios.de
 
 Note that you can't send patches to that list unless

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-08 18:29:03 UTC (rev 2499)
+++ trunk/TODO	2009-07-08 22:26:20 UTC (rev 2500)
@@ -1,3 +1,4 @@
+// This file is part of the Doyxgen Developer Manual
 /** @page tasks Pending and Open Tasks
 
 This page lists pending and open tasks being considered or worked upon



From zwelch at mail.berlios.de  Thu Jul  9 00:26:33 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 9 Jul 2009 00:26:33 +0200
Subject: [Openocd-svn] r2501 - trunk/doc/manual/primer
Message-ID: <200907082226.n68MQX7f003127@sheep.berlios.de>

Author: zwelch
Date: 2009-07-09 00:26:29 +0200 (Thu, 09 Jul 2009)
New Revision: 2501

Modified:
   trunk/doc/manual/primer/patches.txt
Log:
Add microscopic style guide at the end of the PATCH primer.


Modified: trunk/doc/manual/primer/patches.txt
===================================================================
--- trunk/doc/manual/primer/patches.txt	2009-07-08 22:26:20 UTC (rev 2500)
+++ trunk/doc/manual/primer/patches.txt	2009-07-08 22:26:29 UTC (rev 2501)
@@ -204,6 +204,19 @@
 work on the project voluntarily and without compensation for the time
 that they spend doing these tasks.
 
+ at section primerpatchguide Guidelines for Submitting Patches
+
+- Each patch file should contain:
+  - A commit description that describes all of the changes.
+  - A separator line that contains three hyphens: <code>---</code>
+  - A summary of the changes produced by diffstat (optional)
+  - Another separator line (optional)
+  - The actual patch contents, containing a single change.
+
+- Each patch series should include:
+  - A summary of the patches in the series.
+  - Logically-related patches that contain incremental changes.
+
  */
 /** @file
 This file contains the @ref primerpatches page.



From zwelch at mail.berlios.de  Thu Jul  9 00:26:39 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 9 Jul 2009 00:26:39 +0200
Subject: [Openocd-svn] r2502 - trunk
Message-ID: <200907082226.n68MQdqB003151@sheep.berlios.de>

Author: zwelch
Date: 2009-07-09 00:26:36 +0200 (Thu, 09 Jul 2009)
New Revision: 2502

Modified:
   trunk/README
Log:
Add section to provide some documentation for cross-compiling.


Modified: trunk/README
===================================================================
--- trunk/README	2009-07-08 22:26:29 UTC (rev 2501)
+++ trunk/README	2009-07-08 22:26:36 UTC (rev 2502)
@@ -166,6 +166,29 @@
 final (optional) step, ``make install'', places all of the files in the
 required location.
 
+Cross-Compiling Options
+-----------------------
+
+To cross-compile, you must specify both --build and --host options to
+the 'configure' script.  For example, you can configure OpenOCD to
+cross-compile on a x86 Linux host to run on Windows (MinGW32), you could
+use the following configuration options:
+
+  ./configure --build=i686-pc-linux-gnu --host=i586-mingw32msvc ... 
+
+Likewise, the following options allow OpenOCD to be cross-compiled for
+an ARM target on the same x86 host:
+
+  ./configure --build=i686-pc-linux-gnu --host=arm-elf ...
+
+Both must be specified to work around bugs in autoconf.
+
+Scripts for producing ARM cross-compilers can be found on the web with a
+little searching.  A script to produce an x86 Linux-hosted MinGW32
+cross-compiler can be downloaded from the following URL:
+
+  http://www.mingw.org/wiki/LinuxCrossMinGW
+
 Configuration Options
 ---------------------
 



From zwelch at mail.berlios.de  Thu Jul  9 00:26:47 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 9 Jul 2009 00:26:47 +0200
Subject: [Openocd-svn] r2503 - trunk/doc/manual
Message-ID: <200907082226.n68MQlTj003182@sheep.berlios.de>

Author: zwelch
Date: 2009-07-09 00:26:42 +0200 (Thu, 09 Jul 2009)
New Revision: 2503

Modified:
   trunk/doc/manual/style.txt
Log:
Add style rule to avoid combining assignment and logical tests.


Modified: trunk/doc/manual/style.txt
===================================================================
--- trunk/doc/manual/style.txt	2009-07-08 22:26:36 UTC (rev 2502)
+++ trunk/doc/manual/style.txt	2009-07-08 22:26:42 UTC (rev 2503)
@@ -107,6 +107,20 @@
 	...
 }
 @endcode
+- Separate assignment and logical test statements.  In other words, you
+should write statements like the following:
+ at code
+// separate statements should be preferred
+result = foo();
+if (ERROR_OK != result)
+	...
+ at endcode
+More directly, do @b not combine these kinds of statements:
+ at code
+// Combined statements should be avoided
+if (ERROR_OK != (result = foo()))
+	return result;
+ at endcode
 
  */
 /** @page styledoxygen Doxygen Style Guide



From oharboe at mail.berlios.de  Fri Jul 10 09:21:13 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 10 Jul 2009 09:21:13 +0200
Subject: [Openocd-svn] r2504 - in trunk/tcl: board target
Message-ID: <200907100721.n6A7LDVE031005@sheep.berlios.de>

Author: oharboe
Date: 2009-07-10 09:21:12 +0200 (Fri, 10 Jul 2009)
New Revision: 2504

Added:
   trunk/tcl/board/ek-lm3s3748.cfg
Modified:
   trunk/tcl/target/lm3s3748.cfg
Log:
David Brownell <david-b at pacbell.net> split EK board support out
from the target CPU support .

Added: trunk/tcl/board/ek-lm3s3748.cfg
===================================================================
--- trunk/tcl/board/ek-lm3s3748.cfg	2009-07-08 22:26:42 UTC (rev 2503)
+++ trunk/tcl/board/ek-lm3s3748.cfg	2009-07-10 07:21:12 UTC (rev 2504)
@@ -0,0 +1,17 @@
+# Stellaris lm3s3748 Evaluation Kit
+#  http://www.luminarymicro.com/products/lm3s3748_usb_h_d_evaluation_kits.html
+
+# NOTE:  to use the on-board FT2232 JTAG interface:
+#  source [find interface/luminary.cfg]
+
+source [find target/lm3s3748.cfg]
+
+# LM3S parts don't support RTCK
+jtag_khz 500
+
+jtag_nsrst_delay 100
+jtag_ntrst_delay 100
+
+# Board has only srst
+reset_config srst_only
+

Modified: trunk/tcl/target/lm3s3748.cfg
===================================================================
--- trunk/tcl/target/lm3s3748.cfg	2009-07-08 22:26:42 UTC (rev 2503)
+++ trunk/tcl/target/lm3s3748.cfg	2009-07-10 07:21:12 UTC (rev 2504)
@@ -1,7 +1,4 @@
-# Script for luminary lm3s3748
-#
-# NB! work in progress! Duplicated from lm3s811.cfg, but does
-# it need modification??
+# TI/Luminary Stellaris lm3s3748
 
 if { [info exists CHIPNAME] } {	
    set  _CHIPNAME $CHIPNAME    
@@ -19,31 +16,21 @@
 if { [info exists CPUTAPID ] } {
    set _CPUTAPID $CPUTAPID
 } else {
-  # force an error till we get a good number
    set _CPUTAPID 0x3ba00477
 }
 
-# RCLK 
-jtag_khz 500
-
-jtag_nsrst_delay 100
-jtag_ntrst_delay 100
-
-#lm3s3748 Evaluation Board has only srst
-reset_config srst_only
-
-#jtag scan chain
+# JTAG scan chain
 jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 1 -irmask 0xf -expected-id $_CPUTAPID
 
+# The "lm3s" variant works around an erratum when using Rev A of "DustDevil"
+# parts (third generation, includes LM3S3748).  It keeps the debug registers
+# from being cleared, by using software reset not SRST; NOP on newer revs.
+set _TARGETNAME $_CHIPNAME.cpu
+target create $_TARGETNAME cortex_m3 -endian $_ENDIAN \
+	-chain-position $_TARGETNAME -variant lm3s
 
-# the luminary variant causes a software reset rather than asserting SRST
-# this stops the debug registers from being cleared
-# this will be fixed in later revisions of silicon
-set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
-target create $_TARGETNAME cortex_m3 -endian $_ENDIAN -chain-position $_TARGETNAME -variant lm3s
+# 8k working area at base of ram, not backed up
+$_TARGETNAME configure -work-area-phys 0x20000000 -work-area-size 0x2000
 
-# 8k working area at base of ram
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x20000000 -work-area-size 0x2000 -work-area-backup 0
-
-#flash configuration
+# flash configuration -- one bank of 128K
 flash bank stellaris 0 0 0 0 0



From oharboe at mail.berlios.de  Fri Jul 10 10:46:12 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 10 Jul 2009 10:46:12 +0200
Subject: [Openocd-svn] r2505 - trunk
Message-ID: <200907100846.n6A8kCKf004655@sheep.berlios.de>

Author: oharboe
Date: 2009-07-10 10:46:12 +0200 (Fri, 10 Jul 2009)
New Revision: 2505

Modified:
   trunk/TODO
Log:
noted XScale (or USBProg) problem

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-10 07:21:12 UTC (rev 2504)
+++ trunk/TODO	2009-07-10 08:46:12 UTC (rev 2505)
@@ -102,6 +102,10 @@
   https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
 - regression: xscale does not place debug_handler.bin into the right spot: @par
   https://lists.berlios.de/pipermail/openocd-development/2009-July/009338.html
+- bug: either USBprog is broken with new tms sequence or there is a general
+  problem with XScale and the new tms sequence. Workaround: use "tms_sequence long"
+  @par
+  https://lists.berlios.de/pipermail/openocd-development/2009-July/009426.html
 - regression: "reset halt" between 729(works) and 788(fails): @par
 https://lists.berlios.de/pipermail/openocd-development/2009-July/009206.html
 - ARM923EJS:



From oharboe at mail.berlios.de  Fri Jul 10 10:47:10 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 10 Jul 2009 10:47:10 +0200
Subject: [Openocd-svn] r2506 - trunk
Message-ID: <200907100847.n6A8lAr7004738@sheep.berlios.de>

Author: oharboe
Date: 2009-07-10 10:47:10 +0200 (Fri, 10 Jul 2009)
New Revision: 2506

Modified:
   trunk/TODO
Log:
wrote up workaround for xscale/debug_handler.bin bug

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-10 08:46:12 UTC (rev 2505)
+++ trunk/TODO	2009-07-10 08:47:10 UTC (rev 2506)
@@ -100,7 +100,8 @@
 
 - general layer cleanup: @par
   https://lists.berlios.de/pipermail/openocd-development/2009-May/006590.html
-- regression: xscale does not place debug_handler.bin into the right spot: @par
+- regression: xscale does not place debug_handler.bin into the right spot. workaround:
+  use -s option on command line to place xscale/debug_handler.bin in search path @par
   https://lists.berlios.de/pipermail/openocd-development/2009-July/009338.html
 - bug: either USBprog is broken with new tms sequence or there is a general
   problem with XScale and the new tms sequence. Workaround: use "tms_sequence long"



From duane at mail.berlios.de  Sat Jul 11 04:01:25 2009
From: duane at mail.berlios.de (duane at mail.berlios.de)
Date: Sat, 11 Jul 2009 04:01:25 +0200
Subject: [Openocd-svn] r2507 - trunk/src/jtag
Message-ID: <200907110201.n6B21PBi019406@sheep.berlios.de>

Author: duane
Date: 2009-07-11 04:01:22 +0200 (Sat, 11 Jul 2009)
New Revision: 2507

Modified:
   trunk/src/jtag/presto.c
Log:
Simple warning fix

Modified: trunk/src/jtag/presto.c
===================================================================
--- trunk/src/jtag/presto.c	2009-07-10 08:47:10 UTC (rev 2506)
+++ trunk/src/jtag/presto.c	2009-07-11 02:01:22 UTC (rev 2507)
@@ -239,7 +239,7 @@
 			LOG_DEBUG("FT_Open failed: %i", (int)presto->status);
 			continue;
 		}
-		LOG_DEBUG("FTDI device %i open", i);
+		LOG_DEBUG("FTDI device %i open", (int)i);
 
 		if ((presto->status = FT_GetDeviceInfo(presto->handle, &device, &vidpid,
 				presto->serial, devname, NULL)) == FT_OK)
@@ -251,7 +251,7 @@
 		else
 			LOG_DEBUG("FT_GetDeviceInfo failed: %lu", presto->status);
 
-		LOG_DEBUG("FTDI device %i does not match, closing", i);
+		LOG_DEBUG("FTDI device %i does not match, closing", (int)i);
 		FT_Close(presto->handle);
 		presto->handle = (FT_HANDLE)INVALID_HANDLE_VALUE;
 	}



From oharboe at mail.berlios.de  Sun Jul 12 16:08:17 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 12 Jul 2009 16:08:17 +0200
Subject: [Openocd-svn] r2508 - trunk/doc
Message-ID: <200907121408.n6CE8HMi027345@sheep.berlios.de>

Author: oharboe
Date: 2009-07-12 16:08:16 +0200 (Sun, 12 Jul 2009)
New Revision: 2508

Modified:
   trunk/doc/openocd.texi
Log:
David Brownell <david-b at pacbell.net> Mention how parallel clock voting implementations of RTCK work,
and reference TI's free VHDL code.

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-07-11 02:01:22 UTC (rev 2507)
+++ trunk/doc/openocd.texi	2009-07-12 14:08:16 UTC (rev 2508)
@@ -5661,6 +5661,18 @@
 time. One can set a break point or halt the system in the deep power
 down code, slow step out until the system speeds up.
 
+Note that adaptive clocking may also need to work at the board level,
+when a board-level scan chain has multiple chips.
+Parallel clock voting schemes are good way to implement this,
+both within and between chips, and can easily be implemented
+with a CPLD.
+It's not difficult to have logic fan a module's input TCK signal out
+to each TAP in the scan chain, and then wait until each TAP's RTCK comes
+back with the right polarity before changing the output RTCK signal.
+Texas Instruments makes some clock voting logic available
+for free (with no support) in VHDL form; see
+ at url{http://tiexpressdsp.com/index.php/Adaptive_Clocking}
+
 @b{Solution #2 - Always works - but may be slower}
 
 Often this is a perfectly acceptable solution.



From oharboe at mail.berlios.de  Sun Jul 12 16:11:45 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 12 Jul 2009 16:11:45 +0200
Subject: [Openocd-svn] r2509 - trunk/tcl/interface
Message-ID: <200907121411.n6CEBjn8027671@sheep.berlios.de>

Author: oharboe
Date: 2009-07-12 16:11:43 +0200 (Sun, 12 Jul 2009)
New Revision: 2509

Modified:
   trunk/tcl/interface/usbprog.cfg
Log:
Peter Denison <openwrt at marshadder.org> workaround for broken USBprog w/short tms sequences

Modified: trunk/tcl/interface/usbprog.cfg
===================================================================
--- trunk/tcl/interface/usbprog.cfg	2009-07-12 14:08:16 UTC (rev 2508)
+++ trunk/tcl/interface/usbprog.cfg	2009-07-12 14:11:43 UTC (rev 2509)
@@ -5,4 +5,6 @@
 #
 
 interface usbprog
-
+# USBprog is broken w/short tms sequences, this is a workaround
+# until the C code can be fixed.
+tms_sequence long
\ No newline at end of file



From oharboe at mail.berlios.de  Sun Jul 12 21:29:11 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 12 Jul 2009 21:29:11 +0200
Subject: [Openocd-svn] r2510 - trunk/src/target
Message-ID: <200907121929.n6CJTBV5015382@sheep.berlios.de>

Author: oharboe
Date: 2009-07-12 21:29:08 +0200 (Sun, 12 Jul 2009)
New Revision: 2510

Modified:
   trunk/src/target/cortex_m3.c
Log:
Magnus Lundin  Thc cortex_m3_poll function does not identify that a target is running unless we transition from RESET.

This patch correctly identifies a running target.

Patch made a tad more palatable by David Brownell <david-b at pacbell.net>


Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-07-12 14:11:43 UTC (rev 2509)
+++ trunk/src/target/cortex_m3.c	2009-07-12 19:29:08 UTC (rev 2510)
@@ -512,16 +512,19 @@
 		}
 	}
 
-	/*
-	if (cortex_m3->dcb_dhcsr & S_SLEEP)
-		target->state = TARGET_SLEEP;
-	*/
+	/* REVISIT when S_SLEEP is set, it's in a Sleep or DeepSleep state.
+	 * How best to model low power modes?
+	 */
 
-#if 0
-	/* Read Debug Fault Status Register, added to figure out the lockup when running flashtest.script  */
-	mem_ap_read_atomic_u32(swjdp, NVIC_DFSR, &cortex_m3->nvic_dfsr);
-	LOG_DEBUG("dcb_dhcsr 0x%x, nvic_dfsr 0x%x, target->state: %s", cortex_m3->dcb_dhcsr, cortex_m3->nvic_dfsr, target_state_name(target));
-#endif
+	if (target->state == TARGET_UNKNOWN)
+	{
+		/* check if processor is retiring instructions */
+		if (cortex_m3->dcb_dhcsr & S_RETIRE_ST)
+		{
+			target->state = TARGET_RUNNING;
+			return ERROR_OK;
+		}
+	}
 
 	return ERROR_OK;
 }



From oharboe at mail.berlios.de  Sun Jul 12 21:31:14 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 12 Jul 2009 21:31:14 +0200
Subject: [Openocd-svn] r2511 - trunk/contrib
Message-ID: <200907121931.n6CJVEWO015642@sheep.berlios.de>

Author: oharboe
Date: 2009-07-12 21:31:13 +0200 (Sun, 12 Jul 2009)
New Revision: 2511

Removed:
   trunk/contrib/libftdi/
Log:
Xiaofan Chen <xiaofanc at gmail.com> retire obsolete patch. OpenOCD only supports 0.14 and newer and the patch was for 0.14.



From oharboe at mail.berlios.de  Sun Jul 12 21:32:24 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Sun, 12 Jul 2009 21:32:24 +0200
Subject: [Openocd-svn] r2512 - trunk
Message-ID: <200907121932.n6CJWOhl015919@sheep.berlios.de>

Author: oharboe
Date: 2009-07-12 21:32:22 +0200 (Sun, 12 Jul 2009)
New Revision: 2512

Modified:
   trunk/README
Log:
Xiaofan Chen <xiaofanc at gmail.com> document my experiment
with MinGW cross build.


Modified: trunk/README
===================================================================
--- trunk/README	2009-07-12 19:31:13 UTC (rev 2511)
+++ trunk/README	2009-07-12 19:32:22 UTC (rev 2512)
@@ -416,4 +416,70 @@
 
 2) Run './configure --enable-maintainer-mode' with other options.
 
+The following URL is a good reference if you want to build OpenOCD
+under cygwin.
+http://forum.sparkfun.com/viewtopic.php?t=11221
 
+Alternatively you can build the Windows binary under Linux using
+MinGW cross compiler. The following documents some tips of
+using this cross build option.
+
+a) libusb-win32
+You can choose to use the libusb-win32 binary distribution from
+its Sourceforge page. As of this writing, the latest version
+is 0.1.12.2. This is the recommend version to use since it fixed
+an issue with USB composite device and this is important for FTDI
+based JTAG debuggers.
+http://sourceforge.net/projects/libusb-win32/
+
+You need to download the libusb-win32-device-bin-0.1.12.2.tar.gz 
+package. Please extract this file into a temp directory. 
+
+Copy the file libusb-win32-device-bin-0.1.12.2\include\usb.h
+to your MinGW include directory.
+
+Copy the library libusb-win32-device-bin-0.1.12.2\lib\gcc\libusb.a
+to your MinGW library directory.
+
+Take note that different Linux distros often have different
+MinGW installation directory. Some of them also put the
+library and include into a seperate sys-root directory.
+
+If there is a new svn version of libusb-win32, you can build it
+as well. 
+
+This is the instrunction from the libusb-win32 Makefile.
+# If you're cross-compiling and your mingw32 tools are called
+# i586-mingw32msvc-gcc and so on, then you can compile libusb-win32
+# by running
+#    make host_prefix=i586-mingw32msvc all
+
+b) libftdi
+libftdi source codes can be download from the following website.
+http://www.intra2net.com/en/developer/libftdi/download.php
+
+It does not provide Windows binary. You can build it from the
+source tarball or the git tree.
+
+If you are using the git tree, the following is the instruction 
+from README.mingw. You need to have cmake installed.
+- Edit Toolchain-mingw32.cmake to point to the correct MinGW 
+installation.
+- Create a build directory like "mkdir build-win32", e.g in ../libftdi/
+- cd in that directory and run  
+  "cmake -DCMAKE_TOOLCHAIN_FILE=../Toolchain-mingw32.cmake .."
+- Copy src/ftdi.h to your MinGW include directory.
+- Copy build-win32/src/*.a to your MinGW lib directory.
+
+c) OpenOCD
+Now you can build OpenOCD under Linux using MinGW.
+You need to use --host=your_mingW_prefix in the configure option.
+
+Example for libftdi (in one line, tested under Ubuntu 9.04):
+./configure --host=i586-mingw32msvc --enable-maintainer-mode 
+--disable-shared --enable-ft2232_libftdi
+
+Example for ftd2xx (in one line, tested under Ubuntu 9.04)
+./configure --host=i586-mingw32msvc --enable-maintainer-mode 
+--disable-shared --enable-ft2232_ftd2xx 
+--with-ftd2xx-win32-zipdir=/home/mcuee/Desktop/build/openocd/libftd2xx-win32



From ntfreak at mail.berlios.de  Mon Jul 13 08:36:52 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Mon, 13 Jul 2009 08:36:52 +0200
Subject: [Openocd-svn] r2513 - trunk/src/jtag
Message-ID: <200907130636.n6D6aqrU003326@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-13 08:36:51 +0200 (Mon, 13 Jul 2009)
New Revision: 2513

Modified:
   trunk/src/jtag/jlink.c
Log:
Gary Carlson <gcarlson at carlson-minot.com>
Spencer Oliver <spen at spen-soft.co.uk>

- fix jlink win32/linux/darwin startup issues
- see https://lists.berlios.de/pipermail/openocd-development/2009-July/009438.html

Modified: trunk/src/jtag/jlink.c
===================================================================
--- trunk/src/jtag/jlink.c	2009-07-12 19:32:22 UTC (rev 2512)
+++ trunk/src/jtag/jlink.c	2009-07-13 06:36:51 UTC (rev 2513)
@@ -835,13 +835,37 @@
 	return ERROR_OK;
 }
 
+static struct usb_device* find_jlink_device(void)
+{
+	struct usb_bus *busses;
+	struct usb_bus *bus;
+	struct usb_device *dev;
+
+	usb_find_busses();
+	usb_find_devices();
+
+	busses = usb_get_busses();
+
+	/* find jlink_jtag device in usb bus */
+
+	for (bus = busses; bus; bus = bus->next)
+	{
+		for (dev = bus->devices; dev; dev = dev->next)
+		{
+			if ((dev->descriptor.idVendor == VID) && (dev->descriptor.idProduct == PID)) {
+				return dev;
+			}
+		}
+	}
+
+	return NULL;
+}
+
 /*****************************************************************************/
 /* JLink USB low-level functions */
 
 static jlink_jtag_t* jlink_usb_open()
 {
-	struct usb_bus *busses;
-	struct usb_bus *bus;
 	struct usb_device *dev;
 
 	jlink_jtag_t *result;
@@ -849,56 +873,81 @@
 	result = (jlink_jtag_t*) malloc(sizeof(jlink_jtag_t));
 
 	usb_init();
-	usb_find_busses();
-	usb_find_devices();
 
-	busses = usb_get_busses();
+	if ((dev = find_jlink_device()) == NULL) {
+		free(result);
+		return NULL;
+	}
 
-	/* find jlink_jtag device in usb bus */
+	result->usb_handle = usb_open(dev);
 
-	for (bus = busses; bus; bus = bus->next)
+	if (result->usb_handle)
 	{
-		for (dev = bus->devices; dev; dev = dev->next)
+	
+		/* BE ***VERY CAREFUL*** ABOUT MAKING CHANGES IN THIS AREA!!!!!!!!!!!
+		 * The behavior of libusb is not completely consistent across Windows, Linux, and Mac OS X platforms.  The actions taken
+		 * in the following compiler conditionals may not agree with published documentation for libusb, but were found
+		 * to be necessary through trials and tribulations.  Even little tweaks can break one or more platforms, so if you do make changes
+		 * test them carefully on all platforms before committing them!
+		 */
+
+#if IS_WIN32 == 0
+
+		usb_reset(result->usb_handle);
+
+#if IS_DARWIN == 0
+
+		int timeout = 5;
+
+		/* reopen jlink after usb_reset
+		 * on win32 this may take a second or two to re-enumerate */
+		while ((dev = find_jlink_device()) == NULL)
 		{
-			if ((dev->descriptor.idVendor == VID) && (dev->descriptor.idProduct == PID))
-			{
-				result->usb_handle = usb_open(dev);
-				
-				/*
-				 *	Some j-link dongles experience intermittent communication issues at startup to varying degrees
-				 *	depending on the host operating system.  Troubleshooting this problem all the way back to libusb
-				 *	revealed that without a usb reset, the hardware can start in an uncertain state causing a litany
-				 *	of annoying problems.  The next step was added to the original code to address this problem.
-				 */
-				
-				usb_reset(result->usb_handle);
+			usleep(1000);
+			timeout--;
+			if (!timeout) {
+				break;
+			}
+		}
 
-				/* usb_set_configuration required under win32 */
-				usb_set_configuration(result->usb_handle, dev->config[0].bConfigurationValue);
-				usb_claim_interface(result->usb_handle, 0);
+		if (dev == NULL)
+		{
+			free(result);
+			return NULL;
+		}
 
+		result->usb_handle = usb_open(dev);
+#endif
+
+#endif
+
+		if (result->usb_handle)
+		{
+			/* usb_set_configuration required under win32 */
+			usb_set_configuration(result->usb_handle, dev->config[0].bConfigurationValue);
+			usb_claim_interface(result->usb_handle, 0);
+
 #if 0
-				/*
-				 * This makes problems under Mac OS X. And is not needed
-				 * under Windows. Hopefully this will not break a linux build
-				 */
-				usb_set_altinterface(result->usb_handle, 0);
+			/*
+			 * This makes problems under Mac OS X. And is not needed
+			 * under Windows. Hopefully this will not break a linux build
+			 */
+			usb_set_altinterface(result->usb_handle, 0);
 #endif
-				struct usb_interface *iface = dev->config->interface;
-				struct usb_interface_descriptor *desc = iface->altsetting;
-				for (int i = 0; i < desc->bNumEndpoints; i++)
-				{
-					uint8_t epnum = desc->endpoint[i].bEndpointAddress;
-					bool is_input = epnum & 0x80;
-					LOG_DEBUG("usb ep %s %02x", is_input ? "in" : "out", epnum);
-					if (is_input)
-						jlink_read_ep = epnum;
-					else
-						jlink_write_ep = epnum;
-				}
+			struct usb_interface *iface = dev->config->interface;
+			struct usb_interface_descriptor *desc = iface->altsetting;
+			for (int i = 0; i < desc->bNumEndpoints; i++)
+			{
+				uint8_t epnum = desc->endpoint[i].bEndpointAddress;
+				bool is_input = epnum & 0x80;
+				LOG_DEBUG("usb ep %s %02x", is_input ? "in" : "out", epnum);
+				if (is_input)
+					jlink_read_ep = epnum;
+				else
+					jlink_write_ep = epnum;
+			}
 
-				return result;
-			}
+			return result;
 		}
 	}
 



From zwelch at mail.berlios.de  Tue Jul 14 08:40:00 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 14 Jul 2009 08:40:00 +0200
Subject: [Openocd-svn] r2514 - trunk
Message-ID: <200907140640.n6E6e0cj019820@sheep.berlios.de>

Author: zwelch
Date: 2009-07-14 08:39:55 +0200 (Tue, 14 Jul 2009)
New Revision: 2514

Modified:
   trunk/configure.in
Log:
Make the parport-ppdev option enabled by default.  This may require 
giving --disable-parport-ppdev to configure on some platform(s).


Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-07-13 06:36:51 UTC (rev 2513)
+++ trunk/configure.in	2009-07-14 06:39:55 UTC (rev 2514)
@@ -308,7 +308,7 @@
 AC_ARG_ENABLE(parport_ppdev,
   AS_HELP_STRING([--disable-parport-ppdev],
       [Disable use of ppdev (/dev/parportN) for parport (for x86 only)]), 
-    [parport_use_ppdev=$enableval], [parport_use_ppdev=])
+    [parport_use_ppdev=$enableval], [parport_use_ppdev=yes])
 
 AC_ARG_ENABLE(parport_giveio,
     AS_HELP_STRING([--enable-parport-giveio],



From zwelch at mail.berlios.de  Tue Jul 14 09:35:39 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 14 Jul 2009 09:35:39 +0200
Subject: [Openocd-svn] r2515 - trunk
Message-ID: <200907140735.n6E7ZdY3003157@sheep.berlios.de>

Author: zwelch
Date: 2009-07-14 09:35:29 +0200 (Tue, 14 Jul 2009)
New Revision: 2515

Added:
   trunk/README.Win32
Modified:
   trunk/README
Log:
Split Windows README instructions into new file, with a few fixes.

Modified: trunk/README
===================================================================
--- trunk/README	2009-07-14 06:39:55 UTC (rev 2514)
+++ trunk/README	2009-07-14 07:35:29 UTC (rev 2515)
@@ -305,6 +305,10 @@
 Using LIBFTDI
 -------------
 
+The libftdi source code can be download from the following website:
+
+  http://www.intra2net.com/en/developer/libftdi/download.php
+
 For both Linux and Windows, both libusb and libftdi must be built and
 installed.  To use the newer FT2232H chips, supporting RTCK and USB high
 speed (480 Mbps), you need libftdi version 0.16 or newer.  Many Linux
@@ -353,19 +357,6 @@
 _distributing_ copies of OpenOCD built with the FTDI code would violate
 the OpenOCD licensing terms.  
 
-
-Cygwin/Win32 Notes
-******************
-
-The Cygwin/Win32 ZIP file contains a directory named ftd2xx.win32.
-Assuming that you have extracted this archive in the same directory as
-the OpenOCD package, you could configure with options like the following:
-
-   ./configure \
-	--enable-ft2232_ftd2xx \
-	--with-ftd2xx-win32-zipdir=../ftd2xx.win32 \
-	... other options ...
-
 Linux Notes
 ***********
 
@@ -404,82 +395,9 @@
 ************************************************
 
 Building OpenOCD from a repository requires a recent version of the GNU
-autotools (autoconf >= 2.59 and automake >= 1.9).  For building on
-Windows, you have to use Cygwin. Make sure that your PATH
-environment variable contains no other locations with Unix utils (like
-UnxUtils) - these can't handle the Cygwin paths, resulting in obscure
-dependency errors.  This was an observation gathered from the logs of
-one user; please correct us if this is wrong.
+autotools (autoconf >= 2.59 and automake >= 1.9).  
 
 1) Run './bootstrap' to create the 'configure' script and prepare
    the build process for your host system.
 
 2) Run './configure --enable-maintainer-mode' with other options.
-
-The following URL is a good reference if you want to build OpenOCD
-under cygwin.
-http://forum.sparkfun.com/viewtopic.php?t=11221
-
-Alternatively you can build the Windows binary under Linux using
-MinGW cross compiler. The following documents some tips of
-using this cross build option.
-
-a) libusb-win32
-You can choose to use the libusb-win32 binary distribution from
-its Sourceforge page. As of this writing, the latest version
-is 0.1.12.2. This is the recommend version to use since it fixed
-an issue with USB composite device and this is important for FTDI
-based JTAG debuggers.
-http://sourceforge.net/projects/libusb-win32/
-
-You need to download the libusb-win32-device-bin-0.1.12.2.tar.gz 
-package. Please extract this file into a temp directory. 
-
-Copy the file libusb-win32-device-bin-0.1.12.2\include\usb.h
-to your MinGW include directory.
-
-Copy the library libusb-win32-device-bin-0.1.12.2\lib\gcc\libusb.a
-to your MinGW library directory.
-
-Take note that different Linux distros often have different
-MinGW installation directory. Some of them also put the
-library and include into a seperate sys-root directory.
-
-If there is a new svn version of libusb-win32, you can build it
-as well. 
-
-This is the instrunction from the libusb-win32 Makefile.
-# If you're cross-compiling and your mingw32 tools are called
-# i586-mingw32msvc-gcc and so on, then you can compile libusb-win32
-# by running
-#    make host_prefix=i586-mingw32msvc all
-
-b) libftdi
-libftdi source codes can be download from the following website.
-http://www.intra2net.com/en/developer/libftdi/download.php
-
-It does not provide Windows binary. You can build it from the
-source tarball or the git tree.
-
-If you are using the git tree, the following is the instruction 
-from README.mingw. You need to have cmake installed.
-- Edit Toolchain-mingw32.cmake to point to the correct MinGW 
-installation.
-- Create a build directory like "mkdir build-win32", e.g in ../libftdi/
-- cd in that directory and run  
-  "cmake -DCMAKE_TOOLCHAIN_FILE=../Toolchain-mingw32.cmake .."
-- Copy src/ftdi.h to your MinGW include directory.
-- Copy build-win32/src/*.a to your MinGW lib directory.
-
-c) OpenOCD
-Now you can build OpenOCD under Linux using MinGW.
-You need to use --host=your_mingW_prefix in the configure option.
-
-Example for libftdi (in one line, tested under Ubuntu 9.04):
-./configure --host=i586-mingw32msvc --enable-maintainer-mode 
---disable-shared --enable-ft2232_libftdi
-
-Example for ftd2xx (in one line, tested under Ubuntu 9.04)
-./configure --host=i586-mingw32msvc --enable-maintainer-mode 
---disable-shared --enable-ft2232_ftd2xx 
---with-ftd2xx-win32-zipdir=/home/mcuee/Desktop/build/openocd/libftd2xx-win32

Added: trunk/README.Win32
===================================================================
--- trunk/README.Win32	2009-07-14 06:39:55 UTC (rev 2514)
+++ trunk/README.Win32	2009-07-14 07:35:29 UTC (rev 2515)
@@ -0,0 +1,97 @@
+Building OpenOCD for Windows
+----------------------------
+
+For building on Windows, you have to use CygWin. Make sure that your
+PATH environment variable contains no other locations with Unix utilities
+(like UnxUtils).  Those tools can't handle the CygWin paths, resulting
+in obscure dependency errors.  This was an observation gathered from the
+logs of one user; please correct us if this is wrong.
+
+The following URL is a good reference if you want to build OpenOCD
+under CygWin:
+
+	http://forum.sparkfun.com/viewtopic.php?t=11221
+
+Alternatively you can build the Windows binary under Linux using
+MinGW cross compiler. The following documents some tips of
+using this cross build option.
+
+libusb-win32
+------------
+
+You can choose to use the libusb-win32 binary distribution from
+its SourceForge page. As of this writing, the latest version
+is 0.1.12.2. This is the recommend version to use since it fixed
+an issue with USB composite device and this is important for FTDI
+based JTAG debuggers.
+
+	http://sourceforge.net/projects/libusb-win32/
+
+You need to download the libusb-win32-device-bin-0.1.12.2.tar.gz 
+package.  Extract this file into a temp directory. 
+
+Copy the file libusb-win32-device-bin-0.1.12.2\include\usb.h
+to your MinGW include directory.
+
+Copy the library libusb-win32-device-bin-0.1.12.2\lib\gcc\libusb.a
+to your MinGW library directory.
+
+Take note that different Linux distributions often have different MinGW
+installation directory.  Some of them also put the library and include
+into a separate sys-root directory.
+
+If there is a new svn version of libusb-win32, you can build it as well. 
+
+These are the instruction from the libusb-win32 Makefile:
+
+# If you're cross-compiling and your mingw32 tools are called
+# i586-mingw32msvc-gcc and so on, then you can compile libusb-win32
+# by running
+#    make host_prefix=i586-mingw32msvc all
+
+libftdi
+-------
+
+The author does not provide Windows binary. You can build it from a
+released source tarball or the git tree.
+
+If you are using the git tree, the following are the instructions from
+README.mingw. You will need to have the cmake utility installed.
+
+- Edit Toolchain-mingw32.cmake to point to the correct MinGW 
+  installation.
+- Create a build directory like "mkdir build-win32", e.g in ../libftdi/
+- cd into that directory and run  
+  "cmake -DCMAKE_TOOLCHAIN_FILE=../Toolchain-mingw32.cmake .."
+- Copy src/ftdi.h to your MinGW include directory.
+- Copy build-win32/src/*.a to your MinGW lib directory.
+
+libftd2xx
+---------
+
+The Cygwin/Win32 ZIP file contains a directory named ftd2xx.win32.
+After being extracted, the directory does not need further preparation.
+Instead, its path must be provided to the --with-ftd2xx-win32-zipdir
+configure option, as shown in the next section.
+
+OpenOCD
+-------
+
+Now you can build OpenOCD under Linux using MinGW.  You need to use
+--build and --host configure options.
+
+To use libftdi:
+
+  ./configure --build=i686-pc-linux-gnu --host=i586-mingw32msvc \
+        --enable-ft2232_libftdi \
+        ... other options ...
+
+To use ftd2xx:
+
+  ./configure --build=i686-pc-linux-gnu --host=i586-mingw32msvc \
+        --enable-ft2232_ftd2xx \
+        --with-ftd2xx-win32-zipdir=/path/to/libftd2xx-win32 \
+        ... other options ...
+
+If you are using the SVN repository, see the README file for additional
+instructions about configuring and building OpenOCD.


Property changes on: trunk/README.Win32
___________________________________________________________________
Name: svn:eol-style
   + native



From zwelch at mail.berlios.de  Tue Jul 14 10:52:32 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 14 Jul 2009 10:52:32 +0200
Subject: [Openocd-svn] r2516 - trunk/tools
Message-ID: <200907140852.n6E8qWhh026648@sheep.berlios.de>

Author: zwelch
Date: 2009-07-14 10:52:28 +0200 (Tue, 14 Jul 2009)
New Revision: 2516

Modified:
   trunk/tools/release.sh
Log:
Improve the release script before 0.2.0:
1) Only archive NEWS file on major and minor relesae, not bug-fixes.
2) Switch back to correct development branch during final release step.
3) Add do_svn_switch helper to ensure package variables are reloaded.


Modified: trunk/tools/release.sh
===================================================================
--- trunk/tools/release.sh	2009-07-14 07:35:29 UTC (rev 2515)
+++ trunk/tools/release.sh	2009-07-14 08:52:28 UTC (rev 2516)
@@ -74,6 +74,10 @@
 	do_svn_echo "$@"
 	[ "${RELEASE_DRY_RUN}" ] || svn "$@"
 }
+do_svn_switch() {
+	do_svn switch "$1"
+	package_info_load
+}
 
 
 package_info_load_name() {
@@ -432,11 +436,9 @@
 	do_version_tag_add in-development
 }
 do_release_step_branch() {
-	do_svn switch "${PACKAGE_BRANCH}"
-	package_info_load
+	do_svn_switch "${PACKAGE_BRANCH}"
 	do_version_commit "$(do_release_step_branch_bump micro)"
-	do_svn switch "${SVN_URL}"
-	package_info_load
+	do_svn_switch "${SVN_URL}"
 }
 do_release_step_bump() {
 	# major and minor releases require branch version update too
@@ -444,6 +446,8 @@
 	# bump the current tree version as required.
 	do_version_commit "$(do_release_step_branch_bump "${RELEASE_TYPE}")"
 
+	[ "${RELEASE_TYPE}" = "micro" ] && return
+
 	# archive NEWS and create new one from template
 	do_svn move "NEWS" "NEWS-${RELEASE_VERSION}"
 
@@ -479,9 +483,10 @@
 	local A=${PACKAGE_TAG}
 	local B=${A/https/http}
 	local PACKAGE_BUILD=${B/${USER}@/}
-	do_svn switch "${PACKAGE_BUILD}"
+	do_svn_switch "${PACKAGE_BUILD}"
 	do_stage
 	do_clean
+	do_svn_switch "${SVN_URL}"
 }
 
 do_release_step_1() { do_release_step_prep; }



From zwelch at mail.berlios.de  Tue Jul 14 10:53:44 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 14 Jul 2009 10:53:44 +0200
Subject: [Openocd-svn] r2517 - trunk
Message-ID: <200907140853.n6E8riTv026787@sheep.berlios.de>

Author: zwelch
Date: 2009-07-14 10:53:40 +0200 (Tue, 14 Jul 2009)
New Revision: 2517

Modified:
   trunk/configure.in
Log:
Remove '-in-development' version tag: 0.2.0-in-development -> 0.2.0

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-07-14 08:52:28 UTC (rev 2516)
+++ trunk/configure.in	2009-07-14 08:53:40 UTC (rev 2517)
@@ -1,5 +1,5 @@
 AC_PREREQ(2.60)
-AC_INIT([openocd], [0.2.0-in-development],
+AC_INIT([openocd], [0.2.0],
   [OpenOCD Mailing List <openocd-development at lists.berlios.de>])
 AC_CONFIG_SRCDIR([src/openocd.c])
 



From zwelch at mail.berlios.de  Tue Jul 14 10:54:01 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 14 Jul 2009 10:54:01 +0200
Subject: [Openocd-svn] r2518 - branches
Message-ID: <200907140854.n6E8s1vs026808@sheep.berlios.de>

Author: zwelch
Date: 2009-07-14 10:53:54 +0200 (Tue, 14 Jul 2009)
New Revision: 2518

Added:
   branches/openocd-0.2.0/
Log:
Branching version 0.2.0

Copied: branches/openocd-0.2.0 (from rev 2517, trunk)



From zwelch at mail.berlios.de  Tue Jul 14 10:54:18 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 14 Jul 2009 10:54:18 +0200
Subject: [Openocd-svn] r2519 - tags
Message-ID: <200907140854.n6E8sIH4026847@sheep.berlios.de>

Author: zwelch
Date: 2009-07-14 10:54:14 +0200 (Tue, 14 Jul 2009)
New Revision: 2519

Added:
   tags/openocd-0.2.0/
Log:
Tagging version 0.2.0

Copied: tags/openocd-0.2.0 (from rev 2518, branches/openocd-0.2.0)



From zwelch at mail.berlios.de  Tue Jul 14 10:54:28 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 14 Jul 2009 10:54:28 +0200
Subject: [Openocd-svn] r2520 - branches/openocd-0.2.0
Message-ID: <200907140854.n6E8sSGY026884@sheep.berlios.de>

Author: zwelch
Date: 2009-07-14 10:54:24 +0200 (Tue, 14 Jul 2009)
New Revision: 2520

Modified:
   branches/openocd-0.2.0/configure.in
Log:
Bump micro version and add tag:
Bump micro package version number: 0.2.0 -> 0.2.1
Add '-in-development' version tag: 0.2.1 -> 0.2.1-in-development

Modified: branches/openocd-0.2.0/configure.in
===================================================================
--- branches/openocd-0.2.0/configure.in	2009-07-14 08:54:14 UTC (rev 2519)
+++ branches/openocd-0.2.0/configure.in	2009-07-14 08:54:24 UTC (rev 2520)
@@ -1,5 +1,5 @@
 AC_PREREQ(2.60)
-AC_INIT([openocd], [0.2.0],
+AC_INIT([openocd], [0.2.1-in-development],
   [OpenOCD Mailing List <openocd-development at lists.berlios.de>])
 AC_CONFIG_SRCDIR([src/openocd.c])
 



From zwelch at mail.berlios.de  Tue Jul 14 10:54:39 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 14 Jul 2009 10:54:39 +0200
Subject: [Openocd-svn] r2521 - trunk
Message-ID: <200907140854.n6E8sdBF026898@sheep.berlios.de>

Author: zwelch
Date: 2009-07-14 10:54:36 +0200 (Tue, 14 Jul 2009)
New Revision: 2521

Modified:
   trunk/configure.in
Log:
Bump minor version and add tag:
Bump minor package version number: 0.2.0 -> 0.3.0
Add '-in-development' version tag: 0.3.0 -> 0.3.0-in-development

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-07-14 08:54:24 UTC (rev 2520)
+++ trunk/configure.in	2009-07-14 08:54:36 UTC (rev 2521)
@@ -1,5 +1,5 @@
 AC_PREREQ(2.60)
-AC_INIT([openocd], [0.2.0],
+AC_INIT([openocd], [0.3.0-in-development],
   [OpenOCD Mailing List <openocd-development at lists.berlios.de>])
 AC_CONFIG_SRCDIR([src/openocd.c])
 



From zwelch at mail.berlios.de  Tue Jul 14 11:02:06 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Tue, 14 Jul 2009 11:02:06 +0200
Subject: [Openocd-svn] r2522 - trunk
Message-ID: <200907140902.n6E926Ga028152@sheep.berlios.de>

Author: zwelch
Date: 2009-07-14 11:02:00 +0200 (Tue, 14 Jul 2009)
New Revision: 2522

Added:
   trunk/NEWS
   trunk/NEWS-0.2.0
Removed:
   trunk/NEWS
Log:
Archive released NEWS file: NEWS -> NEWS-0.2.0
Create new NEWS file from release script template.


Deleted: trunk/NEWS
===================================================================
--- trunk/NEWS	2009-07-14 08:54:36 UTC (rev 2521)
+++ trunk/NEWS	2009-07-14 09:02:00 UTC (rev 2522)
@@ -1,80 +0,0 @@
-The OpenOCD 0.2.0 source archive release includes numerous improvements
-that were made since the initial 0.1.0 source archive release.  Many
-contributors helped make this release a great success, and the community
-of developers and maintainers look forward to any response.
-
-In addition to the list of changes below, countless bug fixing and
-cleaning was performed across the tree.  Various TCL command parameters
-must past stricter value checks, and many more error conditions have
-been handled correctly.  These efforts helped to make the 0.2.0 release
-more stable and robust, though some changes may expose latent bugs in
-your existing configuration scripts.
- 
-This release does not maintain backward compatibility in all respects,
-so some target or configuration scripts may need to be updated.  In some
-cases, you may also see warnings; resolve those, because they indicate
-commands that will be removed in the future.
-
-The following areas of OpenOCD functionality changed in this release:
-
-JTAG Layer:
-- Improves modularity: core, TCL, driver commands, and interface have
-  been separated, encapsulated, and documented for developers.  Mostly.
-- Improves JTAG TAP transition tables: 
-   * Makes TAP paths variable length, rather than being fixed at 7 steps.
-   * Fixes problems with some targets that did not like longer paths.
-- Improves JTAG driver/minidriver modularity and encapsulation.
-- New drivers:
-   * Adds stub minidriver for developing new embedded JTAG interfaces.
-- Improves drivers:
-   * ft2232+ftd2xx:
-      + Adds initial high-speed device support: --enable-ftd2xx-highspeed
-      + Supports more types of FTDI-based devices.
-   * jlink:
-      + Works with more versions of the firmware (v3 and newer)
-      + Supports dynamically detects device capabilities and limits
-   * vsllink:
-      + Supports very long scan chains
-   * amtjtagaccel:
-      + Fixes broken ID code detection problems.
-
-Target Layer:
-- New devices: AVR, FA526
-- Improved support: ARM ADI, ARM11, MIPS
-- Numerous other bug fixes and improvements
-
-Flash Layer:
-- Improved drivers: mflash
-- New drivers: AT91SAM3, AVR, Davinci NAND
-
-Board, Interface, and Target Configuration Scripts:
-- Many new and improved targets and boards are now available.
-- Better separation of "board" and "target" configuration
-- Moved all TCL files to top-level "tcl" directory in the source tree
-- Installation moved from '$pkglibdir/' to '$pkgdatadir/scripts/'.
-- Site-specific files should be installed under '$pkgdatadir/site/';
-  files that exist this tree will be used in preference to default
-  distribution configurations in '$pkgdatadir/scripts/'.
-
-Documentation:
-- Updated User Guide:     http://openocd.berlios.de/doc/html/index.html
-   * Partially re-written and re-organized.
-   * Standardized presentation for all commands.
-   * Covers many drivers and commands that were previously omitted.
-   * New index for commands and drivers.
-- Added Developer Manual: http://openocd.berlios.de/doc/doxygen/index.html
-   * Now includes architecture, technical primers, style guides, and more.
-   * Available in-tree and on-line.
-
-Build and Release:
-- Increased configuration and compilation warning coverage.
-   * Use --disable-werror to work around build errors caused by warnings.
-- Use libtool to produce helper libraries as a step toward "libopenocd".
-- New processes and scripting to facilitate future source releases.
-
-For more details about what has changed since 0.1.0, see the ChangeLog
-associated with this release.
-
-For more information about contributing test reports, bug fixes, or new
-features and device support, please read the new Developer Manual (or
-the BUGS and PATCHES files in the source archive).

Added: trunk/NEWS
===================================================================
--- trunk/NEWS	2009-07-14 08:54:36 UTC (rev 2521)
+++ trunk/NEWS	2009-07-14 09:02:00 UTC (rev 2522)
@@ -0,0 +1,19 @@
+This file should include items worth mentioning in the
+OpenOCD openocd-0.2.0 source archive release.
+
+The following areas of OpenOCD functionality changed in this release:
+
+JTAG Layer:
+Target Layer:
+Flash Layer:
+Board, Target, and Interface Configuration Scripts:
+Documentation:
+Build and Release:
+
+For more details about what has changed since the last release,
+see the ChangeLog associated with this source archive.  For older NEWS,
+see the NEWS files associated with each release (i.e. NEWS-<version>).
+
+For more information about contributing test reports, bug fixes, or new
+features and device support, please read the new Developer Manual (or
+the BUGS and PATCHES files in the source archive).

Copied: trunk/NEWS-0.2.0 (from rev 2520, trunk/NEWS)



From ntfreak at mail.berlios.de  Tue Jul 14 13:58:01 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Tue, 14 Jul 2009 13:58:01 +0200
Subject: [Openocd-svn] r2525 - trunk/doc
Message-ID: <200907141158.n6EBw1Dm025602@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-14 13:57:59 +0200 (Tue, 14 Jul 2009)
New Revision: 2525

Modified:
   trunk/doc/openocd.texi
Log:
- fix small typo in documentation

Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-07-14 10:41:16 UTC (rev 2524)
+++ trunk/doc/openocd.texi	2009-07-14 11:57:59 UTC (rev 2525)
@@ -3135,7 +3135,7 @@
 @subsection Internal Flash (Microcontrollers)
 
 @deffn {Flash Driver} aduc702x
-The ADUC702x analog microcontrollers from ST Micro
+The ADUC702x analog microcontrollers from Analog Devices
 include internal flash and use ARM7TDMI cores.
 The aduc702x flash driver works with models ADUC7019 through ADUC7028.
 The setup command only requires the @var{target} argument



From oharboe at mail.berlios.de  Tue Jul 14 12:38:42 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Tue, 14 Jul 2009 12:38:42 +0200
Subject: [Openocd-svn] r2523 - trunk/src/jtag/zy1000
Message-ID: <200907141038.n6EAcgaA011048@sheep.berlios.de>

Author: oharboe
Date: 2009-07-14 12:38:26 +0200 (Tue, 14 Jul 2009)
New Revision: 2523

Modified:
   trunk/src/jtag/zy1000/zy1000.c
Log:
1.54 snapshot

Modified: trunk/src/jtag/zy1000/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000/zy1000.c	2009-07-14 09:02:00 UTC (rev 2522)
+++ trunk/src/jtag/zy1000/zy1000.c	2009-07-14 10:38:26 UTC (rev 2523)
@@ -28,7 +28,7 @@
 #include <cyg/hal/hal_diag.h>
 
 
-#define ZYLIN_VERSION "1.53"
+#define ZYLIN_VERSION "1.54"
 #define ZYLIN_DATE __DATE__
 #define ZYLIN_TIME __TIME__
 #define ZYLIN_OPENOCD "$Revision$"



From oharboe at mail.berlios.de  Tue Jul 14 20:25:17 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 14 Jul 2009 20:25:17 +0200
Subject: [Openocd-svn] r2526 - trunk
Message-ID: <200907141825.n6EIPHMg001756@sheep.berlios.de>

Author: oharboe
Date: 2009-07-14 20:24:59 +0200 (Tue, 14 Jul 2009)
New Revision: 2526

Modified:
   trunk/README
Log:
David Brownell <david-b at pacbell.net> mention udev, and correct D2XX speed mentions

Modified: trunk/README
===================================================================
--- trunk/README	2009-07-14 11:57:59 UTC (rev 2525)
+++ trunk/README	2009-07-14 18:24:59 UTC (rev 2526)
@@ -64,6 +64,12 @@
 Installing OpenOCD
 ==================
 
+On Linux, you may have permissions problems to address.  The best
+way to do this is to use the contrib/udev.rules file.  It probably
+belongs somewhere in /etc/udev/rules.d, but consult your operating
+system documentation to be sure.  In particular, make sure that it
+matches the syntax used by your operating system's version of udev.
+
 A Note to OpenOCD Users
 -----------------------
 
@@ -325,7 +331,7 @@
 Using FTDI's FTD2XX
 -------------------
 
-Some claim the (closed) FTDICHIP.COM solution is faster, which
+The (closed source) FTDICHIP.COM solution is faster on MS-Windows.  That
 is the motivation for supporting it even though its licensing restricts
 it to non-redistributable OpenOCD binaries, and it is not available for
 all operating systems used with OpenOCD.  You may, however, build such
@@ -370,6 +376,9 @@
         --with-ft2xx-linux-tardir=../libftd2xx0.4.16 \
 	... other options ...
 
+Note that on Linux there is no good reason to use these FTDI binaries;
+they are no faster (on Linux) than libftdi, and cause licensing issues.
+
 =================================
 Obtaining OpenOCD From Subversion
 ---------------------------------



From oharboe at mail.berlios.de  Tue Jul 14 20:30:02 2009
From: oharboe at mail.berlios.de (oharboe at mail.berlios.de)
Date: Tue, 14 Jul 2009 20:30:02 +0200
Subject: [Openocd-svn] r2527 - in trunk: . .settings
Message-ID: <200907141830.n6EIU2o4002050@sheep.berlios.de>

Author: oharboe
Date: 2009-07-14 20:30:00 +0200 (Tue, 14 Jul 2009)
New Revision: 2527

Added:
   trunk/.settings/
   trunk/.settings/org.eclipse.core.resources.prefs
Log:
Eclipse settings include charset.

Added: trunk/.settings/org.eclipse.core.resources.prefs
===================================================================
--- trunk/.settings/org.eclipse.core.resources.prefs	2009-07-14 18:24:59 UTC (rev 2526)
+++ trunk/.settings/org.eclipse.core.resources.prefs	2009-07-14 18:30:00 UTC (rev 2527)
@@ -0,0 +1,3 @@
+#Tue Jul 14 20:27:34 CEST 2009
+eclipse.preferences.version=1
+encoding/<project>=Cp1252



From oharboe at mail.berlios.de  Wed Jul 15 08:43:28 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 15 Jul 2009 08:43:28 +0200
Subject: [Openocd-svn] r2528 - trunk
Message-ID: <200907150643.n6F6hSBg031624@sheep.berlios.de>

Author: oharboe
Date: 2009-07-15 08:43:28 +0200 (Wed, 15 Jul 2009)
New Revision: 2528

Removed:
   trunk/.settings/
Log:
retire Eclipse settings, charset will be set elsewhere.



From oharboe at mail.berlios.de  Wed Jul 15 14:30:07 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 15 Jul 2009 14:30:07 +0200
Subject: [Openocd-svn] r2529 - trunk/src/jtag
Message-ID: <200907151230.n6FCU6xB005271@sheep.berlios.de>

Author: oharboe
Date: 2009-07-15 14:30:06 +0200 (Wed, 15 Jul 2009)
New Revision: 2529

Modified:
   trunk/src/jtag/parport.c
Log:
print errno when parport fails to open.

Modified: trunk/src/jtag/parport.c
===================================================================
--- trunk/src/jtag/parport.c	2009-07-15 06:43:28 UTC (rev 2528)
+++ trunk/src/jtag/parport.c	2009-07-15 12:30:06 UTC (rev 2529)
@@ -247,7 +247,7 @@
 static int parport_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, "parport_port", parport_handle_parport_port_command,
-		COMMAND_CONFIG, "either the address of the I/O port or the number of the ?/dev/parport? device");
+		COMMAND_CONFIG, "either the address of the I/O port or the number of the ???/dev/parport??? device");
 	register_command(cmd_ctx, NULL, "parport_cable", parport_handle_parport_cable_command,
 		COMMAND_CONFIG, "the layout of the parallel port cable used to connect to the target");
 	register_command(cmd_ctx, NULL, "parport_write_on_exit", parport_handle_write_on_exit_command,
@@ -337,7 +337,8 @@
 
 	if (device_handle < 0)
 	{
-		LOG_ERROR("cannot open device. check it exists and that user read and write rights are set");
+		int err = errno;
+		LOG_ERROR("cannot open device. check it exists and that user read and write rights are set. errno=%d", err);
 		return ERROR_JTAG_INIT_FAILED;
 	}
 



From zwelch at mail.berlios.de  Thu Jul 16 01:39:45 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:39:45 +0200
Subject: [Openocd-svn] r2530 - in trunk: doc src/target
Message-ID: <200907152339.n6FNdj8f021006@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:39:37 +0200 (Thu, 16 Jul 2009)
New Revision: 2530

Modified:
   trunk/doc/openocd.texi
   trunk/src/target/arm_disassembler.c
   trunk/src/target/arm_disassembler.h
   trunk/src/target/cortex_m3.c
Log:
David Brownell <david-b at pacbell.net>:

Initial support for disassembling Thumb2 code.  This works only for
Cortex-M3 cores so far.  Eventually other cores will also need Thumb2
support ... but they don't yet support any kind of disassembly.

 - Update the 16-bit Thumb decoder:
 
     * Understand CPS, REV*, SETEND, {U,S}XT{B,H} opcodes added
       by ARMv6.  (It already seems to treat CPY as MOV.)

     * Understand CB, CBNZ, WFI, IT, and other opcodes added by
       in Thumb2.

 - A new Thumb2 instruction decode routine is provided.
 
     * This has a different signature:  pass the target, not the
       instruction, so it can fetch a second halfword when needed.  
       The instruction size is likewise returned to the caller.

     * 32-bit instructions are recognized but not yet decoded.
   
 - Start using the current "UAL" syntax in some cases.  "SWI" is
   renamed as "SVC"; "LDMIA" as "LDM"; "STMIA" as "STM".

 - Define a new "cortex_m3 disassemble addr count" command to give
   access to this disassembly.

Sanity checked against "objdump -d" output; a bunch of the new
instructions checked out fine.


Modified: trunk/doc/openocd.texi
===================================================================
--- trunk/doc/openocd.texi	2009-07-15 12:30:06 UTC (rev 2529)
+++ trunk/doc/openocd.texi	2009-07-15 23:39:37 UTC (rev 2530)
@@ -5003,6 +5003,11 @@
 @subsection Cortex-M3 specific commands
 @cindex Cortex-M3
 
+ at deffn Command {cortex_m3 disassemble} address count
+ at cindex disassemble
+Disassembles @var{count} Thumb2 instructions starting at @var{address}.
+ at end deffn
+
 @deffn Command {cortex_m3 maskisr} (@option{on}|@option{off})
 Control masking (disabling) interrupts during target step/resume.
 @end deffn

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 12:30:06 UTC (rev 2529)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:39:37 UTC (rev 2530)
@@ -21,6 +21,7 @@
 #include "config.h"
 #endif
 
+#include "target.h"
 #include "arm_disassembler.h"
 #include "log.h"
 
@@ -63,7 +64,9 @@
 {
 	instruction->type = ARM_SWI;
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%8.8" PRIx32 "\tSWI 0x%6.6" PRIx32 "", address, opcode, (opcode & 0xffffff));
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "\t0x%8.8" PRIx32 "\tSVC %#6.6" PRIx32,
+			address, opcode, (opcode & 0xffffff));
 
 	return ERROR_OK;
 }
@@ -614,7 +617,8 @@
 		if (U)
 		{
 			instruction->info.load_store_multiple.addressing_mode = 0;
-			addressing_mode = "IA";
+			/* "IA" is the default in UAL syntax */
+			addressing_mode = "";
 		}
 		else
 		{
@@ -1180,6 +1184,7 @@
 	/* clear fields, to avoid confusion */
 	memset(instruction, 0, sizeof(arm_instruction_t));
 	instruction->opcode = opcode;
+	instruction->instruction_size = 4;
 
 	/* catch opcodes with condition field [31:28] = b1111 */
 	if ((opcode & 0xf0000000) == 0xf0000000)
@@ -1356,8 +1361,12 @@
 			mnemonic = "BL";
 			break;
 	}
-	/* TODO: deals correctly with dual opcodes BL/BLX ... */
 
+	/* TODO: deal correctly with dual opcode (prefixed) BL/BLX;
+	 * these are effectively 32-bit instructions even in Thumb1.
+	 * Might be simplest to always use the Thumb2 decoder.
+	 */
+
 	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s 0x%8.8" PRIx32 , address, opcode,mnemonic, target_address);
 
 	instruction->info.b_bl_bx_blx.reg_operand = -1;
@@ -1887,12 +1896,12 @@
 		if (L)
 		{
 			instruction->type = ARM_LDM;
-			mnemonic = "LDMIA";
+			mnemonic = "LDM";
 		}
 		else
 		{
 			instruction->type = ARM_STM;
-			mnemonic = "STMIA";
+			mnemonic = "STM";
 		}
 		snprintf(ptr_name,7,"r%i!, ",Rn);
 	}
@@ -1945,7 +1954,9 @@
 	if (cond == 0xf)
 	{
 		instruction->type = ARM_SWI;
-		snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tSWI 0x%02" PRIx32 , address, opcode, offset);
+		snprintf(instruction->text, 128,
+				"0x%8.8" PRIx32 "\t0x%4.4x\tSVC 0x%02" PRIx32,
+				address, opcode, offset);
 		return ERROR_OK;
 	}
 	else if (cond == 0xe)
@@ -1971,11 +1982,148 @@
 	return ERROR_OK;
 }
 
+static int evaluate_cb_thumb(uint16_t opcode, uint32_t address,
+		arm_instruction_t *instruction)
+{
+	unsigned offset;
+
+	/* added in Thumb2 */
+	offset = (opcode >> 3) & 0x1f;
+	offset |= (opcode & 0x0200) >> 4;
+
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "\t0x%4.4x\tCB%sZ r%d, %#8.8" PRIx32,
+			address, opcode,
+			(opcode & 0x0800) ? "N" : "",
+			opcode & 0x7, address + 4 + (offset << 1));
+
+	return ERROR_OK;
+}
+
+static int evaluate_extend_thumb(uint16_t opcode, uint32_t address,
+		arm_instruction_t *instruction)
+{
+	/* added in ARMv6 */
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "\t0x%4.4x\t%cXT%c r%d, r%d",
+			address, opcode,
+			(opcode & 0x0080) ? 'U' : 'S',
+			(opcode & 0x0040) ? 'B' : 'H',
+			opcode & 0x7, (opcode >> 3) & 0x7);
+
+	return ERROR_OK;
+}
+
+static int evaluate_cps_thumb(uint16_t opcode, uint32_t address,
+		arm_instruction_t *instruction)
+{
+	/* added in ARMv6 */
+	if ((opcode & 0x0ff0) == 0x0650)
+		snprintf(instruction->text, 128,
+				"0x%8.8" PRIx32 "\t0x%4.4x\tSETEND %s",
+				address, opcode,
+				(opcode & 0x80) ? "BE" : "LE");
+	else /* ASSUME (opcode & 0x0fe0) == 0x0660 */
+		snprintf(instruction->text, 128,
+				"0x%8.8" PRIx32 "\t0x%4.4x\tCPSI%c %s%s%s",
+				address, opcode,
+				(opcode & 0x0010) ? 'D' : 'E',
+				(opcode & 0x0004) ? "A" : "",
+				(opcode & 0x0002) ? "I" : "",
+				(opcode & 0x0001) ? "F" : "");
+
+	return ERROR_OK;
+}
+
+static int evaluate_byterev_thumb(uint16_t opcode, uint32_t address,
+		arm_instruction_t *instruction)
+{
+	char *suffix;
+
+	/* added in ARMv6 */
+	switch (opcode & 0x00c0) {
+	case 0:
+		suffix = "";
+		break;
+	case 1:
+		suffix = "16";
+		break;
+	default:
+		suffix = "SH";
+		break;
+	}
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "\t0x%4.4x\tREV%s r%d, r%d",
+			address, opcode, suffix,
+			opcode & 0x7, (opcode >> 3) & 0x7);
+
+	return ERROR_OK;
+}
+
+static int evaluate_hint_thumb(uint16_t opcode, uint32_t address,
+		arm_instruction_t *instruction)
+{
+	char *hint;
+
+	switch ((opcode >> 4) & 0x0f) {
+	case 0:
+		hint = "NOP";
+		break;
+	case 1:
+		hint = "YIELD";
+		break;
+	case 2:
+		hint = "WFE";
+		break;
+	case 3:
+		hint = "WFI";
+		break;
+	case 4:
+		hint = "SEV";
+		break;
+	default:
+		hint = "HINT (UNRECOGNIZED)";
+		break;
+	}
+
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "\t0x%4.4x\t%s",
+			address, opcode, hint);
+
+	return ERROR_OK;
+}
+
+static int evaluate_ifthen_thumb(uint16_t opcode, uint32_t address,
+		arm_instruction_t *instruction)
+{
+	unsigned cond = (opcode >> 4) & 0x0f;
+	char *x = "", *y = "", *z = "";
+
+	if (opcode & 0x01)
+		z = (opcode & 0x02) ? "T" : "E";
+	if (opcode & 0x03)
+		y = (opcode & 0x04) ? "T" : "E";
+	if (opcode & 0x07)
+		x = (opcode & 0x08) ? "T" : "E";
+
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "\t0x%4.4x\tIT%s%s%s %s",
+			address, opcode,
+			x, y, z, arm_condition_strings[cond]);
+
+	/* NOTE:  strictly speaking, the next 1-4 instructions should
+	 * now be displayed with the relevant conditional suffix...
+	 */
+
+	return ERROR_OK;
+}
+
 int thumb_evaluate_opcode(uint16_t opcode, uint32_t address, arm_instruction_t *instruction)
 {
 	/* clear fields, to avoid confusion */
 	memset(instruction, 0, sizeof(arm_instruction_t));
 	instruction->opcode = opcode;
+	instruction->instruction_size = 2;
 
 	if ((opcode & 0xe000) == 0x0000)
 	{
@@ -2033,18 +2181,44 @@
 	/* Misc */
 	if ((opcode & 0xf000) == 0xb000)
 	{
-		if ((opcode & 0x0f00) == 0x0000)
+		switch ((opcode >> 8) & 0x0f) {
+		case 0x0:
 			return evaluate_adjust_stack_thumb(opcode, address, instruction);
-		else if ((opcode & 0x0f00) == 0x0e00)
+		case 0x1:
+		case 0x3:
+		case 0x9:
+		case 0xb:
+			return evaluate_cb_thumb(opcode, address, instruction);
+		case 0x2:
+			return evaluate_extend_thumb(opcode, address, instruction);
+		case 0x4:
+		case 0x5:
+		case 0xc:
+		case 0xd:
+			return evaluate_load_store_multiple_thumb(opcode, address,
+						instruction);
+		case 0x6:
+			return evaluate_cps_thumb(opcode, address, instruction);
+		case 0xa:
+			if ((opcode & 0x00c0) == 0x0080)
+				break;
+			return evaluate_byterev_thumb(opcode, address, instruction);
+		case 0xe:
 			return evaluate_breakpoint_thumb(opcode, address, instruction);
-		else if ((opcode & 0x0600) == 0x0400) /* push pop */
-			return evaluate_load_store_multiple_thumb(opcode, address, instruction);
-		else
-		{
-			instruction->type = ARM_UNDEFINED_INSTRUCTION;
-			snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tUNDEFINED INSTRUCTION", address, opcode);
-			return ERROR_OK;
+		case 0xf:
+			if (opcode & 0x000f)
+				return evaluate_ifthen_thumb(opcode, address,
+						instruction);
+			else
+				return evaluate_hint_thumb(opcode, address,
+						instruction);
 		}
+
+		instruction->type = ARM_UNDEFINED_INSTRUCTION;
+		snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "\t0x%4.4x\tUNDEFINED INSTRUCTION",
+			address, opcode);
+		return ERROR_OK;
 	}
 
 	/* Load/Store multiple */
@@ -2078,6 +2252,56 @@
 	return -1;
 }
 
+/*
+ * REVISIT for Thumb2 instructions, instruction->type and friends aren't
+ * always set.  That means eventual arm_simulate_step() support for Thumb2
+ * will need work in this area.
+ */
+int thumb2_opcode(target_t *target, uint32_t address, arm_instruction_t *instruction)
+{
+	int retval;
+	uint16_t op;
+	uint32_t opcode;
+
+	/* clear low bit ... it's set on function pointers */
+	address &= ~1;
+
+	/* clear fields, to avoid confusion */
+	memset(instruction, 0, sizeof(arm_instruction_t));
+
+	/* read first halfword, see if this is the only one */
+	retval = target_read_u16(target, address, &op);
+	if (retval != ERROR_OK)
+		return retval;
+
+	switch (op & 0xf800) {
+	case 0xf800:
+	case 0xf000:
+	case 0xe800:
+		/* 32-bit instructions */
+		instruction->instruction_size = 4;
+		opcode = op << 16;
+		retval = target_read_u16(target, address + 2, &op);
+		if (retval != ERROR_OK)
+			return retval;
+		opcode |= op;
+		instruction->opcode = opcode;
+		break;
+	default:
+		/* 16-bit:  Thumb1 + IT + CBZ/CBNZ + ... */
+		return thumb_evaluate_opcode(op, address, instruction);
+	}
+
+	/* FIXME decode the 32-bit instructions */
+
+	LOG_DEBUG("Can't decode 32-bit Thumb2 yet (opcode=%08x)", opcode);
+
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "\t0x%8.8x\t... 32-bit Thumb2 ...",
+			address, opcode);
+	return ERROR_OK;
+}
+
 int arm_access_size(arm_instruction_t *instruction)
 {
 	if ((instruction->type == ARM_LDRB)

Modified: trunk/src/target/arm_disassembler.h
===================================================================
--- trunk/src/target/arm_disassembler.h	2009-07-15 12:30:06 UTC (rev 2529)
+++ trunk/src/target/arm_disassembler.h	2009-07-15 23:39:37 UTC (rev 2530)
@@ -185,6 +185,9 @@
 	char text[128];
 	uint32_t opcode;
 
+	/* return value ... Thumb-2 sizes vary */
+	unsigned instruction_size;
+
 	union {
 		arm_b_bl_bx_blx_instr_t b_bl_bx_blx;
 		arm_data_proc_instr_t data_proc;
@@ -196,6 +199,8 @@
 
 extern int arm_evaluate_opcode(uint32_t opcode, uint32_t address, arm_instruction_t *instruction);
 extern int thumb_evaluate_opcode(uint16_t opcode, uint32_t address, arm_instruction_t *instruction);
+extern int thumb2_opcode(target_t *target, uint32_t address,
+		arm_instruction_t *instruction);
 extern int arm_access_size(arm_instruction_t *instruction);
 
 #define COND(opcode) (arm_condition_strings[(opcode & 0xf0000000) >> 28])

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-07-15 12:30:06 UTC (rev 2529)
+++ trunk/src/target/cortex_m3.c	2009-07-15 23:39:37 UTC (rev 2530)
@@ -34,6 +34,7 @@
 #include "cortex_m3.h"
 #include "target_request.h"
 #include "target_type.h"
+#include "arm_disassembler.h"
 
 
 /* cli handling */
@@ -1646,6 +1647,47 @@
 	return ERROR_OK;
 }
 
+/*
+ * REVISIT Thumb2 disassembly should work for all ARMv7 cores, as well
+ * as at least ARM-1156T2.  The interesting thing about Cortex-M is
+ * that *only* Thumb2 disassembly matters.  There are also some small
+ * additions to Thumb2 that are specific to ARMv7-M.
+ */
+static int
+handle_cortex_m3_disassemble_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **args, int argc)
+{
+	int retval = ERROR_OK;
+	target_t *target = get_current_target(cmd_ctx);
+	uint32_t address;
+	unsigned long count;
+	arm_instruction_t cur_instruction;
+
+	if (argc != 2) {
+		command_print(cmd_ctx,
+			"usage: cortex_m3 disassemble <address> <count>");
+		return ERROR_OK;
+	}
+
+	errno = 0;
+	address = strtoul(args[0], NULL, 0);
+	if (errno)
+		return ERROR_FAIL;
+	count = strtoul(args[1], NULL, 0);
+	if (errno)
+		return ERROR_FAIL;
+
+	while (count--) {
+		retval = thumb2_opcode(target, address, &cur_instruction);
+		if (retval != ERROR_OK)
+			return retval;
+		command_print(cmd_ctx, "%s", cur_instruction.text);
+		address += cur_instruction.instruction_size;
+	}
+
+	return ERROR_OK;
+}
+
 int cortex_m3_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
@@ -1653,9 +1695,16 @@
 
 	retval = armv7m_register_commands(cmd_ctx);
 
-	cortex_m3_cmd = register_command(cmd_ctx, NULL, "cortex_m3", NULL, COMMAND_ANY, "cortex_m3 specific commands");
-	register_command(cmd_ctx, cortex_m3_cmd, "maskisr", handle_cortex_m3_mask_interrupts_command, COMMAND_EXEC, "mask cortex_m3 interrupts ['on'|'off']");
+	cortex_m3_cmd = register_command(cmd_ctx, NULL, "cortex_m3",
+			NULL, COMMAND_ANY, "cortex_m3 specific commands");
 
+	register_command(cmd_ctx, cortex_m3_cmd, "disassemble",
+			handle_cortex_m3_disassemble_command, COMMAND_EXEC,
+			"disassemble Thumb2 instructions <address> <count>");
+	register_command(cmd_ctx, cortex_m3_cmd, "maskisr",
+			handle_cortex_m3_mask_interrupts_command, COMMAND_EXEC,
+			"mask cortex_m3 interrupts ['on'|'off']");
+
 	return retval;
 }
 



From zwelch at mail.berlios.de  Thu Jul 16 01:39:51 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:39:51 +0200
Subject: [Openocd-svn] r2531 - trunk/src/target
Message-ID: <200907152339.n6FNdpZR021059@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:39:48 +0200 (Thu, 16 Jul 2009)
New Revision: 2531

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

Change layout of Thumb disassembly to work better with Thumb2:

 - Move opcode to the left, allowing space for four hex bytes:
    * after address, two spaces not one tab (taking 6 spaces)
    * after 2-byte opcode, four spaces before tab
 - Also, after opcode mnemonic use a tab not a space, to make
   operands line up

Sample output (after some patches decoding a few 32-bit instructions):

0x00003e5a  0xf4423200	ORR	r2, r2, #131072	; 0x20000
0x00003e5e  0x601a    	STR 	r2, [r3, #0x0]
0x00003e60  0x2800    	CMP	r0, #0x00
0x00003e62  0xd1f3    	BNE	0x00003e4c
0x00003e64  0xf008fa38	BL	0x0000c2d8

The affected lines of code now wrap at sane margins too.


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:39:37 UTC (rev 2530)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:39:48 UTC (rev 2531)
@@ -1367,7 +1367,9 @@
 	 * Might be simplest to always use the Thumb2 decoder.
 	 */
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s 0x%8.8" PRIx32 , address, opcode,mnemonic, target_address);
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%s\t%#8.8" PRIx32,
+			address, opcode, mnemonic, target_address);
 
 	instruction->info.b_bl_bx_blx.reg_operand = -1;
 	instruction->info.b_bl_bx_blx.target_address = target_address;
@@ -1403,15 +1405,17 @@
 	{
 		instruction->info.data_proc.variant = 0; /*immediate*/
 		instruction->info.data_proc.shifter_operand.immediate.immediate = Rm_imm;
-		snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s r%i, r%i, #%d",
-				 address, opcode, mnemonic, Rd, Rn, Rm_imm);
+		snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tr%i, r%i, #%d",
+			address, opcode, mnemonic, Rd, Rn, Rm_imm);
 	}
 	else
 	{
 		instruction->info.data_proc.variant = 1; /*immediate shift*/
 		instruction->info.data_proc.shifter_operand.immediate_shift.Rm = Rm_imm;
-		snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s r%i, r%i, r%i",
-				 address, opcode, mnemonic, Rd, Rn, Rm_imm);
+		snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tr%i, r%i, r%i",
+			address, opcode, mnemonic, Rd, Rn, Rm_imm);
 	}
 
 	return ERROR_OK;
@@ -1455,8 +1459,9 @@
 	instruction->info.data_proc.shifter_operand.immediate_shift.Rm = Rm;
 	instruction->info.data_proc.shifter_operand.immediate_shift.shift_imm = imm;
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s r%i, r%i, #0x%02x" ,
-				 address, opcode, mnemonic, Rd, Rm, imm);
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tr%i, r%i, #%#2.2x" ,
+			address, opcode, mnemonic, Rd, Rm, imm);
 
 	return ERROR_OK;
 }
@@ -1496,8 +1501,9 @@
 			break;
 	}
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s r%i, #0x%02x" ,
-				 address, opcode, mnemonic, Rd, imm);
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tr%i, #%#2.2x",
+			address, opcode, mnemonic, Rd, imm);
 
 	return ERROR_OK;
 }
@@ -1548,18 +1554,28 @@
 					if (H1)
 					{
 						instruction->type = ARM_BLX;
-						snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tBLX r%i", address, opcode, Rm);
+						snprintf(instruction->text, 128,
+							"0x%8.8" PRIx32
+							"  0x%4.4x    \tBLX\tr%i",
+							address, opcode, Rm);
 					}
 					else
 					{
 						instruction->type = ARM_BX;
-						snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tBX r%i", address, opcode, Rm);
+						snprintf(instruction->text, 128,
+							"0x%8.8" PRIx32
+							"  0x%4.4x    \tBX\tr%i",
+							address, opcode, Rm);
 					}
 				}
 				else
 				{
 					instruction->type = ARM_UNDEFINED_INSTRUCTION;
-					snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tUNDEFINED INSTRUCTION", address, opcode);
+					snprintf(instruction->text, 128,
+						"0x%8.8" PRIx32
+						"  0x%4.4x    \t"
+						"UNDEFINED INSTRUCTION",
+						address, opcode);
 				}
 				return ERROR_OK;
 				break;
@@ -1655,8 +1671,9 @@
 		}
 	}
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s r%i, r%i",
-				 address, opcode, mnemonic, Rd, Rm);
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tr%i, r%i",
+			 address, opcode, mnemonic, Rd, Rm);
 
 	return ERROR_OK;
 }
@@ -1669,7 +1686,9 @@
 	instruction->type = ARM_LDR;
 	immediate = opcode & 0x000000ff;
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tLDR r%i, [PC, #0x%" PRIx32 "]", address, opcode, Rd, immediate*4);
+	snprintf(instruction->text, 128,
+		"0x%8.8" PRIx32 "  0x%4.4x    \tLDR\tr%i, [pc, #%#" PRIx32 "]",
+		address, opcode, Rd, immediate*4);
 
 	instruction->info.load_store.Rd = Rd;
 	instruction->info.load_store.Rn = 15 /*PC*/;
@@ -1724,7 +1743,9 @@
 			break;
 	}
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s r%i, [r%i, r%i]", address, opcode, mnemonic, Rd, Rn, Rm);
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tr%i, [r%i, r%i]",
+			address, opcode, mnemonic, Rd, Rn, Rm);
 
 	instruction->info.load_store.Rd = Rd;
 	instruction->info.load_store.Rn = Rn;
@@ -1768,7 +1789,9 @@
 		shift = 0;
 	}
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s%c r%i, [r%i, #0x%" PRIx32 "]", address, opcode, mnemonic, suffix, Rd, Rn, offset << shift);
+	snprintf(instruction->text, 128,
+		"0x%8.8" PRIx32 "  0x%4.4x    \t%s%c\tr%i, [r%i, #%#" PRIx32 "]",
+		address, opcode, mnemonic, suffix, Rd, Rn, offset << shift);
 
 	instruction->info.load_store.Rd = Rd;
 	instruction->info.load_store.Rn = Rn;
@@ -1797,7 +1820,9 @@
 		mnemonic = "STR";
 	}
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s r%i, [SP, #0x%" PRIx32 "]", address, opcode, mnemonic, Rd, offset*4);
+	snprintf(instruction->text, 128,
+		"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tr%i, [SP, #%#" PRIx32 "]",
+		address, opcode, mnemonic, Rd, offset*4);
 
 	instruction->info.load_store.Rd = Rd;
 	instruction->info.load_store.Rn = 13 /*SP*/;
@@ -1829,7 +1854,9 @@
 		Rn = 15;
 	}
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tADD r%i, %s, #0x%" PRIx32 "", address, opcode, Rd,reg_name, imm*4);
+	snprintf(instruction->text, 128,
+		"0x%8.8" PRIx32 "  0x%4.4x  \tADD\tr%i, %s, #%#" PRIx32,
+		address, opcode, Rd, reg_name, imm * 4);
 
 	instruction->info.data_proc.variant = 0 /* immediate */;
 	instruction->info.data_proc.Rd = Rd;
@@ -1857,7 +1884,9 @@
 		mnemonic = "ADD";
 	}
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s SP, #0x%" PRIx32 "", address, opcode, mnemonic, imm*4);
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tSP, #%#" PRIx32,
+			address, opcode, mnemonic, imm*4);
 
 	instruction->info.data_proc.variant = 0 /* immediate */;
 	instruction->info.data_proc.Rd = 13 /*SP*/;
@@ -1873,7 +1902,9 @@
 
 	instruction->type = ARM_BKPT;
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tBKPT 0x%02" PRIx32 "", address, opcode, imm);
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x  \tBKPT\t%#2.2" PRIx32 "",
+			address, opcode, imm);
 
 	return ERROR_OK;
 }
@@ -1934,9 +1965,11 @@
 	if (reg_names_p > reg_names)
 		reg_names_p[-2] = '\0';
 	else /* invalid op : no registers */
-    		reg_names[0] = '\0';
+		reg_names[0] = '\0';
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\t%s %s{%s}", address, opcode, mnemonic, ptr_name,reg_names);
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x  \t%s\t%s{%s}",
+			address, opcode, mnemonic, ptr_name, reg_names);
 
 	instruction->info.load_store_multiple.register_list = reg_list;
 	instruction->info.load_store_multiple.Rn = Rn;
@@ -1955,14 +1988,16 @@
 	{
 		instruction->type = ARM_SWI;
 		snprintf(instruction->text, 128,
-				"0x%8.8" PRIx32 "\t0x%4.4x\tSVC 0x%02" PRIx32,
+				"0x%8.8" PRIx32 "  0x%4.4x    \tSVC\t%#2.2" PRIx32,
 				address, opcode, offset);
 		return ERROR_OK;
 	}
 	else if (cond == 0xe)
 	{
 		instruction->type = ARM_UNDEFINED_INSTRUCTION;
-		snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tUNDEFINED INSTRUCTION", address, opcode);
+		snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \tUNDEFINED INSTRUCTION",
+			address, opcode);
 		return ERROR_OK;
 	}
 
@@ -1972,8 +2007,10 @@
 
 	target_address = address + 4 + (offset << 1);
 
-	snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%4.4x\tB%s 0x%8.8" PRIx32 , address, opcode,
-			 arm_condition_strings[cond], target_address);
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%4.4x    \tB%s\t%#8.8" PRIx32,
+			address, opcode,
+			arm_condition_strings[cond], target_address);
 
 	instruction->type = ARM_B;
 	instruction->info.b_bl_bx_blx.reg_operand = -1;
@@ -1992,7 +2029,7 @@
 	offset |= (opcode & 0x0200) >> 4;
 
 	snprintf(instruction->text, 128,
-			"0x%8.8" PRIx32 "\t0x%4.4x\tCB%sZ r%d, %#8.8" PRIx32,
+			"0x%8.8" PRIx32 "  0x%4.4x    \tCB%sZ\tr%d, %#8.8" PRIx32,
 			address, opcode,
 			(opcode & 0x0800) ? "N" : "",
 			opcode & 0x7, address + 4 + (offset << 1));
@@ -2005,7 +2042,7 @@
 {
 	/* added in ARMv6 */
 	snprintf(instruction->text, 128,
-			"0x%8.8" PRIx32 "\t0x%4.4x\t%cXT%c r%d, r%d",
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%cXT%c\tr%d, r%d",
 			address, opcode,
 			(opcode & 0x0080) ? 'U' : 'S',
 			(opcode & 0x0040) ? 'B' : 'H',
@@ -2020,12 +2057,12 @@
 	/* added in ARMv6 */
 	if ((opcode & 0x0ff0) == 0x0650)
 		snprintf(instruction->text, 128,
-				"0x%8.8" PRIx32 "\t0x%4.4x\tSETEND %s",
+				"0x%8.8" PRIx32 "  0x%4.4x    \tSETEND %s",
 				address, opcode,
 				(opcode & 0x80) ? "BE" : "LE");
 	else /* ASSUME (opcode & 0x0fe0) == 0x0660 */
 		snprintf(instruction->text, 128,
-				"0x%8.8" PRIx32 "\t0x%4.4x\tCPSI%c %s%s%s",
+				"0x%8.8" PRIx32 "  0x%4.4x    \tCPSI%c %s%s%s",
 				address, opcode,
 				(opcode & 0x0010) ? 'D' : 'E',
 				(opcode & 0x0004) ? "A" : "",
@@ -2053,7 +2090,7 @@
 		break;
 	}
 	snprintf(instruction->text, 128,
-			"0x%8.8" PRIx32 "\t0x%4.4x\tREV%s r%d, r%d",
+			"0x%8.8" PRIx32 "  0x%4.4x    \tREV%s\tr%d, r%d",
 			address, opcode, suffix,
 			opcode & 0x7, (opcode >> 3) & 0x7);
 
@@ -2087,7 +2124,7 @@
 	}
 
 	snprintf(instruction->text, 128,
-			"0x%8.8" PRIx32 "\t0x%4.4x\t%s",
+			"0x%8.8" PRIx32 "  0x%4.4x    \t%s",
 			address, opcode, hint);
 
 	return ERROR_OK;
@@ -2107,7 +2144,7 @@
 		x = (opcode & 0x08) ? "T" : "E";
 
 	snprintf(instruction->text, 128,
-			"0x%8.8" PRIx32 "\t0x%4.4x\tIT%s%s%s %s",
+			"0x%8.8" PRIx32 "  0x%4.4x    \tIT%s%s%s\t%s",
 			address, opcode,
 			x, y, z, arm_condition_strings[cond]);
 
@@ -2216,7 +2253,7 @@
 
 		instruction->type = ARM_UNDEFINED_INSTRUCTION;
 		snprintf(instruction->text, 128,
-			"0x%8.8" PRIx32 "\t0x%4.4x\tUNDEFINED INSTRUCTION",
+			"0x%8.8" PRIx32 "  0x%4.4x    \tUNDEFINED INSTRUCTION",
 			address, opcode);
 		return ERROR_OK;
 	}
@@ -2239,7 +2276,10 @@
 		if ((opcode & 0xf801) == 0xe801)
 		{
 			instruction->type = ARM_UNDEFINED_INSTRUCTION;
-			snprintf(instruction->text, 128, "0x%8.8" PRIx32 "\t0x%8.8x\tUNDEFINED INSTRUCTION", address, opcode);
+			snprintf(instruction->text, 128,
+					"0x%8.8" PRIx32 "  0x%8.8x\t"
+					"UNDEFINED INSTRUCTION",
+					address, opcode);
 			return ERROR_OK;
 		}
 		else
@@ -2297,7 +2337,7 @@
 	LOG_DEBUG("Can't decode 32-bit Thumb2 yet (opcode=%08x)", opcode);
 
 	snprintf(instruction->text, 128,
-			"0x%8.8" PRIx32 "\t0x%8.8x\t... 32-bit Thumb2 ...",
+			"0x%8.8" PRIx32 "  0x%8.8x\t... 32-bit Thumb2 ...",
 			address, opcode);
 	return ERROR_OK;
 }



From zwelch at mail.berlios.de  Thu Jul 16 01:48:13 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:48:13 +0200
Subject: [Openocd-svn] r2532 - trunk/src/target
Message-ID: <200907152348.n6FNmDsa021628@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:48:11 +0200 (Thu, 16 Jul 2009)
New Revision: 2532

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

Make the Thumb2 disassembler handle a bunch of 32-bit instructions:

  A5.3.4 Branches and miscellaneous control
 
Note that this shifts some responsabililty out of helper functions,
making the code and layout simpler for 32-bit decoders:  they only
need to know how to format the instruction and its parameters.

Also, technical note:  with this patch, Thumb1 decoders could now
call the Thumb2 decoder if they wanted to get nicer treatment of
the exiting 32-bit B/BLX instructions.


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:39:48 UTC (rev 2531)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:48:11 UTC (rev 2532)
@@ -2292,6 +2292,247 @@
 	return -1;
 }
 
+static int t2ev_b_bl(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	unsigned offset;
+	unsigned b21 = 1 << 21;
+	unsigned b22 = 1 << 22;
+
+	/* instead of combining two smaller 16-bit branch instructions,
+	 * Thumb2 uses only one larger 32-bit instruction.
+	 */
+	offset = opcode & 0x7ff;
+	offset |= (opcode & 0x03ff0000) >> 5;
+	if (opcode & (1 << 26)) {
+		offset |= 0xff << 23;
+		if ((opcode & (1 << 11)) == 0)
+			b21 = 0;
+		if ((opcode & (1 << 13)) == 0)
+			b22 = 0;
+	} else {
+		if (opcode & (1 << 11))
+			b21 = 0;
+		if (opcode & (1 << 13))
+			b22 = 0;
+	}
+	offset |= b21;
+	offset |= b22;
+
+
+	address += 4;
+	address += offset << 1;
+
+	instruction->type = (opcode & (1 << 14)) ? ARM_BL : ARM_B;
+	instruction->info.b_bl_bx_blx.reg_operand = -1;
+	instruction->info.b_bl_bx_blx.target_address = address;
+	sprintf(cp, "%s\t%#8.8" PRIx32,
+			(opcode & (1 << 14)) ? "BL" : "B.W",
+			address);
+
+	return ERROR_OK;
+}
+
+static int t2ev_cond_b(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	unsigned offset;
+	unsigned b17 = 1 << 17;
+	unsigned b18 = 1 << 18;
+	unsigned cond = (opcode >> 22) & 0x0f;
+
+	offset = opcode & 0x7ff;
+	offset |= (opcode & 0x003f0000) >> 5;
+	if (opcode & (1 << 26)) {
+		offset |= 0xffff << 19;
+		if ((opcode & (1 << 11)) == 0)
+			b17 = 0;
+		if ((opcode & (1 << 13)) == 0)
+			b18 = 0;
+	} else {
+		if (opcode & (1 << 11))
+			b17 = 0;
+		if (opcode & (1 << 13))
+			b18 = 0;
+	}
+	offset |= b17;
+	offset |= b18;
+
+	address += 4;
+	address += offset << 1;
+
+	instruction->type = ARM_B;
+	instruction->info.b_bl_bx_blx.reg_operand = -1;
+	instruction->info.b_bl_bx_blx.target_address = address;
+	sprintf(cp, "B%s.W\t%#8.8" PRIx32,
+			arm_condition_strings[cond],
+			address);
+
+	return ERROR_OK;
+}
+
+static const char *special_name(int number)
+{
+	char *special = "(RESERVED)";
+
+	switch (number) {
+	case 0:
+		special = "apsr";
+		break;
+	case 1:
+		special = "iapsr";
+		break;
+	case 2:
+		special = "eapsr";
+		break;
+	case 3:
+		special = "xpsr";
+		break;
+	case 5:
+		special = "ipsr";
+		break;
+	case 6:
+		special = "epsr";
+		break;
+	case 7:
+		special = "iepsr";
+		break;
+	case 8:
+		special = "msp";
+		break;
+	case 9:
+		special = "psp";
+		break;
+	case 16:
+		special = "primask";
+		break;
+	case 17:
+		special = "basepri";
+		break;
+	case 18:
+		special = "basepri_max";
+		break;
+	case 19:
+		special = "faultmask";
+		break;
+	case 20:
+		special = "control";
+		break;
+	}
+	return special;
+}
+
+static int t2ev_hint(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	const char *mnemonic;
+
+	if (opcode & 0x0700) {
+		instruction->type = ARM_UNDEFINED_INSTRUCTION;
+		strcpy(cp, "UNDEFINED");
+		return ERROR_OK;
+	}
+
+	if (opcode & 0x00f0) {
+		sprintf(cp, "DBG\t#%d", opcode & 0xf);
+		return ERROR_OK;
+	}
+
+	switch (opcode & 0x0f) {
+	case 0:
+		mnemonic = "NOP.W";
+		break;
+	case 1:
+		mnemonic = "YIELD.W";
+		break;
+	case 2:
+		mnemonic = "WFE.W";
+		break;
+	case 3:
+		mnemonic = "WFI.W";
+		break;
+	case 4:
+		mnemonic = "SEV.W";
+		break;
+	default:
+		mnemonic = "HINT.W (UNRECOGNIZED)";
+		break;
+	}
+	strcpy(cp, mnemonic);
+	return ERROR_OK;
+}
+
+static int t2ev_misc(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	const char *mnemonic;
+
+	switch ((opcode >> 4) & 0x0f) {
+	case 2:
+		mnemonic = "CLREX";
+		break;
+	case 4:
+		mnemonic = "DSB";
+		break;
+	case 5:
+		mnemonic = "DMB";
+		break;
+	case 6:
+		mnemonic = "ISB";
+		break;
+	default:
+		return ERROR_INVALID_ARGUMENTS;
+	}
+	strcpy(cp, mnemonic);
+	return ERROR_OK;
+}
+
+static int t2ev_b_misc(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	/* permanently undefined */
+	if ((opcode & 0x07f07000) == 0x07f02000) {
+		instruction->type = ARM_UNDEFINED_INSTRUCTION;
+		strcpy(cp, "UNDEFINED");
+		return ERROR_OK;
+	}
+
+	switch ((opcode >> 12) & 0x5) {
+	case 0x1:
+	case 0x5:
+		return t2ev_b_bl(opcode, address, instruction, cp);
+	case 0x4:
+		goto undef;
+	case 0:
+		if (((opcode >> 23) & 0x07) == 0x07)
+			return t2ev_cond_b(opcode, address, instruction, cp);
+		if (opcode & (1 << 26))
+			goto undef;
+		break;
+	}
+
+	switch ((opcode >> 20) & 0x7f) {
+	case 0x38:
+	case 0x39:
+		sprintf(cp, "MSR\t%s, r%d", special_name(opcode & 0xff),
+				(opcode >> 16) & 0x0f);
+		return ERROR_OK;
+	case 0x3a:
+		return t2ev_hint(opcode, address, instruction, cp);
+	case 0x3b:
+		return t2ev_misc(opcode, address, instruction, cp);
+	case 0x3e:
+	case 0x3f:
+		sprintf(cp, "MRS\tr%d, %s", (opcode >> 16) & 0x0f,
+				special_name(opcode & 0xff));
+		return ERROR_OK;
+	}
+
+undef:
+	return ERROR_INVALID_ARGUMENTS;
+}
+
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -2302,6 +2543,7 @@
 	int retval;
 	uint16_t op;
 	uint32_t opcode;
+	char *cp;
 
 	/* clear low bit ... it's set on function pointers */
 	address &= ~1;
@@ -2332,13 +2574,30 @@
 		return thumb_evaluate_opcode(op, address, instruction);
 	}
 
-	/* FIXME decode the 32-bit instructions */
+	snprintf(instruction->text, 128,
+			"0x%8.8" PRIx32 "  0x%8.8" PRIx32 "\t",
+			address, opcode);
+	cp = strchr(instruction->text, 0);
+	retval = ERROR_FAIL;
 
+	/* ARMv7-M: A5.3.4 Branches and miscellaneous control */
+	if ((opcode & 0x18008000) == 0x10008000)
+		retval = t2ev_b_misc(opcode, address, instruction, cp);
+
+	/* FIXME decode more 32-bit instructions */
+
+	if (retval == ERROR_OK)
+		return retval;
+
+	if (retval == ERROR_INVALID_ARGUMENTS) {
+		instruction->type = ARM_UNDEFINED_INSTRUCTION;
+		strcpy(cp, "UNDEFINED OPCODE");
+		return ERROR_OK;
+	}
+
 	LOG_DEBUG("Can't decode 32-bit Thumb2 yet (opcode=%08x)", opcode);
 
-	snprintf(instruction->text, 128,
-			"0x%8.8" PRIx32 "  0x%8.8x\t... 32-bit Thumb2 ...",
-			address, opcode);
+	strcpy(cp, "(32-bit Thumb2 ...)");
 	return ERROR_OK;
 }
 



From zwelch at mail.berlios.de  Thu Jul 16 01:48:19 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:48:19 +0200
Subject: [Openocd-svn] r2533 - trunk/src/target
Message-ID: <200907152348.n6FNmJYk021641@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:48:16 +0200 (Thu, 16 Jul 2009)
New Revision: 2533

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

Make the Thumb2 disassembler handle more 32-bit instructions:

  A5.3.1 Data processing (modified immediate)

My small sample shows GCC likes to use many of these instructions.


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:48:11 UTC (rev 2532)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:48:16 UTC (rev 2533)
@@ -2532,7 +2532,145 @@
 	return ERROR_INVALID_ARGUMENTS;
 }
 
+static int t2ev_data_mod_immed(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	char *mnemonic = NULL;
+	int rn = (opcode >> 16) & 0xf;
+	int rd = (opcode >> 8) & 0xf;
+	unsigned immed = opcode & 0xff;
+	unsigned func;
+	bool one = false;
+	char *suffix = "";
 
+	/* ARMv7-M: A5.3.2 Modified immediate constants */
+	func = (opcode >> 11) & 0x0e;
+	if (immed & 0x80)
+		func |= 1;
+	if (opcode & (1 << 26))
+		func |= 0x10;
+
+	/* "Modified" immediates */
+	switch (func >> 1) {
+	case 0:
+		break;
+	case 2:
+		immed <<= 8;
+		/* FALLTHROUGH */
+	case 1:
+		immed += immed << 16;
+		break;
+	case 3:
+		immed += immed << 8;
+		immed += immed << 16;
+		break;
+	default:
+		immed |= 0x80;
+		immed = ror(immed, func);
+	}
+
+	if (opcode & (1 << 20))
+		suffix = "S";
+
+	switch ((opcode >> 21) & 0xf) {
+	case 0:
+		if (rd == 0xf) {
+			instruction->type = ARM_TST;
+			mnemonic = "TST";
+			one = true;
+			suffix = "";
+			rd = rn;
+		} else {
+			instruction->type = ARM_AND;
+			mnemonic = "AND";
+		}
+		break;
+	case 1:
+		instruction->type = ARM_BIC;
+		mnemonic = "BIC";
+		break;
+	case 2:
+		if (rn == 0xf) {
+			instruction->type = ARM_MOV;
+			mnemonic = "MOV";
+			one = true;
+		} else {
+			instruction->type = ARM_ORR;
+			mnemonic = "ORR";
+		}
+		break;
+	case 3:
+		if (rn == 0xf) {
+			instruction->type = ARM_MVN;
+			mnemonic = "MVN";
+			one = true;
+		} else {
+			// instruction->type = ARM_ORN;
+			mnemonic = "ORN";
+		}
+		break;
+	case 4:
+		if (rd == 0xf) {
+			instruction->type = ARM_TEQ;
+			mnemonic = "TEQ";
+			one = true;
+			suffix = "";
+			rd = rn;
+		} else {
+			instruction->type = ARM_EOR;
+			mnemonic = "EOR";
+		}
+		break;
+	case 8:
+		if (rd == 0xf) {
+			instruction->type = ARM_CMN;
+			mnemonic = "CMN";
+			one = true;
+			suffix = "";
+			rd = rn;
+		} else {
+			instruction->type = ARM_ADD;
+			mnemonic = "ADD";
+		}
+		break;
+	case 10:
+		instruction->type = ARM_ADC;
+		mnemonic = "ADC";
+		break;
+	case 11:
+		instruction->type = ARM_SBC;
+		mnemonic = "SBC";
+		break;
+	case 13:
+		if (rd == 0xf) {
+			instruction->type = ARM_CMP;
+			mnemonic = "CMP";
+			one = true;
+			suffix = "";
+			rd = rn;
+		} else {
+			instruction->type = ARM_SUB;
+			mnemonic = "SUB";
+		}
+		break;
+	case 14:
+		instruction->type = ARM_RSB;
+		mnemonic = "RSB";
+		break;
+	default:
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	if (one)
+		sprintf(cp, "%s\tr%d, #%d\t; %#8.8x",
+				mnemonic, rd, immed, immed);
+	else
+		sprintf(cp, "%s%s\tr%d, r%d, #%d\t; %#8.8x",
+				mnemonic, suffix, rd, rn, immed, immed);
+
+	return ERROR_OK;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -2580,8 +2718,12 @@
 	cp = strchr(instruction->text, 0);
 	retval = ERROR_FAIL;
 
+	/* ARMv7-M: A5.3.1 Data processing (modified immediate) */
+	if ((opcode & 0x1a008000) == 0x10000000)
+		retval = t2ev_data_mod_immed(opcode, address, instruction, cp);
+
 	/* ARMv7-M: A5.3.4 Branches and miscellaneous control */
-	if ((opcode & 0x18008000) == 0x10008000)
+	else if ((opcode & 0x18008000) == 0x10008000)
 		retval = t2ev_b_misc(opcode, address, instruction, cp);
 
 	/* FIXME decode more 32-bit instructions */



From zwelch at mail.berlios.de  Thu Jul 16 01:48:24 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:48:24 +0200
Subject: [Openocd-svn] r2534 - trunk/src/target
Message-ID: <200907152348.n6FNmOru021654@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:48:21 +0200 (Thu, 16 Jul 2009)
New Revision: 2534

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

Make the Thumb2 disassembler handle more 32-bit instructions:

  A5.3.3 Data processing (plain binary immediate)

These use mostly twelve bit literals, but there are also bitfield
and saturated add primitives.


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:48:16 UTC (rev 2533)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:48:21 UTC (rev 2534)
@@ -2671,6 +2671,101 @@
 	return ERROR_OK;
 }
 
+static int t2ev_data_immed(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	char *mnemonic = NULL;
+	int rn = (opcode >> 16) & 0xf;
+	int rd = (opcode >> 8) & 0xf;
+	unsigned immed;
+	bool add = false;
+	bool is_signed = false;
+
+	immed = (opcode & 0x0ff) | ((opcode & 0x7000) >> 12);
+	if (opcode & (1 << 27))
+		immed |= (1 << 11);
+
+	switch ((opcode >> 20) & 0x1f) {
+	case 0:
+		if (rn == 0xf) {
+			add = true;
+			goto do_adr;
+		}
+		mnemonic = "ADD.W";
+		break;
+	case 4:
+		mnemonic = "MOV.W";
+		break;
+	case 0x0a:
+		if (rn == 0xf)
+			goto do_adr;
+		mnemonic = "SUB.W";
+		break;
+	case 0x0c:
+		/* move constant to top 16 bits of register */
+		immed |= (opcode >> 4) & 0xf000;
+		sprintf(cp, "MOVT\tr%d, #%d\t; %#4.4x", rn, immed, immed);
+		return ERROR_OK;
+	case 0x10:
+	case 0x12:
+		is_signed = true;
+	case 0x18:
+	case 0x1a:
+		/* signed/unsigned saturated add */
+		immed = (opcode >> 6) & 0x03;
+		immed |= (opcode >> 10) & 0x1c;
+		sprintf(cp, "%sSAT\tr%d, #%d, r%d, %s #%d\t",
+				is_signed ? "S" : "U",
+				rd, (opcode & 0x1f) + 1, rn,
+				(opcode & (1 << 21)) ? "ASR" : "LSL",
+				immed ? immed : 32);
+		return ERROR_OK;
+	case 0x14:
+		is_signed = true;
+		/* FALLTHROUGH */
+	case 0x1c:
+		/* signed/unsigned bitfield extract */
+		immed = (opcode >> 6) & 0x03;
+		immed |= (opcode >> 10) & 0x1c;
+		sprintf(cp, "%sBFX\tr%d, r%d, #%d, #%d\t",
+				is_signed ? "S" : "U",
+				rd, rn, immed,
+				(opcode & 0x1f) + 1);
+		return ERROR_OK;
+	case 0x16:
+		immed = (opcode >> 6) & 0x03;
+		immed |= (opcode >> 10) & 0x1c;
+		if (rn == 0xf)		/* bitfield clear */
+			sprintf(cp, "BFC\tr%d, #%d, #%d\t",
+					rd, immed,
+					(opcode & 0x1f) + 1 - immed);
+		else			/* bitfield insert */
+			sprintf(cp, "BFI\tr%d, r%d, #%d, #%d\t",
+					rd, rn, immed,
+					(opcode & 0x1f) + 1 - immed);
+		return ERROR_OK;
+	default:
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	sprintf(cp, "%s\tr%d, r%d, #%d\t; %#3.3x", mnemonic,
+			rd, rn, immed, immed);
+	return ERROR_OK;
+
+do_adr:
+	address &= ~0x03;
+	address += 4;
+	if (add)
+		address += immed;
+	else
+		address -= immed;
+	/* REVISIT "ADD/SUB Rd, PC, #const ; 0x..." might be better;
+	 * not hiding the pc-relative stuff will sometimes be useful.
+	 */
+	sprintf(cp, "ADR.W\tr%d, %#8.8" PRIx32, rd, address);
+	return ERROR_OK;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -2722,6 +2817,10 @@
 	if ((opcode & 0x1a008000) == 0x10000000)
 		retval = t2ev_data_mod_immed(opcode, address, instruction, cp);
 
+	/* ARMv7-M: A5.3.3 Data processing (plain binary immediate) */
+	else if ((opcode & 0x1a008000) == 0x12000000)
+		retval = t2ev_data_immed(opcode, address, instruction, cp);
+
 	/* ARMv7-M: A5.3.4 Branches and miscellaneous control */
 	else if ((opcode & 0x18008000) == 0x10008000)
 		retval = t2ev_b_misc(opcode, address, instruction, cp);



From zwelch at mail.berlios.de  Thu Jul 16 01:48:30 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:48:30 +0200
Subject: [Openocd-svn] r2535 - trunk/src/target
Message-ID: <200907152348.n6FNmUkK021670@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:48:27 +0200 (Thu, 16 Jul 2009)
New Revision: 2535

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

Make disassembly of the Thumb load-literal instruction show the
address of the literal being loaded (so users can avoid doing
that math themselves).  Add and use an Align(PC,4) utility.


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:48:21 UTC (rev 2534)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:48:27 UTC (rev 2535)
@@ -1678,6 +1678,12 @@
 	return ERROR_OK;
 }
 
+/* PC-relative data addressing is word-aligned even with Thumb */
+static inline uint32_t thumb_alignpc4(uint32_t addr)
+{
+	return (addr + 4) & ~3;
+}
+
 int evaluate_load_literal_thumb(uint16_t opcode, uint32_t address, arm_instruction_t *instruction)
 {
 	uint32_t immediate;
@@ -1685,17 +1691,20 @@
 
 	instruction->type = ARM_LDR;
 	immediate = opcode & 0x000000ff;
+	immediate *= 4;
 
-	snprintf(instruction->text, 128,
-		"0x%8.8" PRIx32 "  0x%4.4x    \tLDR\tr%i, [pc, #%#" PRIx32 "]",
-		address, opcode, Rd, immediate*4);
-
 	instruction->info.load_store.Rd = Rd;
 	instruction->info.load_store.Rn = 15 /*PC*/;
 	instruction->info.load_store.index_mode = 0; /*offset*/
 	instruction->info.load_store.offset_mode = 0; /*immediate*/
-	instruction->info.load_store.offset.offset = immediate*4;
+	instruction->info.load_store.offset.offset = immediate;
 
+	snprintf(instruction->text, 128,
+		"0x%8.8" PRIx32 "  0x%4.4x    \t"
+		"LDR\tr%i, [pc, #%#" PRIx32 "]\t; %#8.8x",
+		address, opcode, Rd, immediate,
+		thumb_alignpc4(address) + immediate);
+
 	return ERROR_OK;
 }
 
@@ -2753,8 +2762,7 @@
 	return ERROR_OK;
 
 do_adr:
-	address &= ~0x03;
-	address += 4;
+	address = thumb_alignpc4(address);
 	if (add)
 		address += immed;
 	else



From zwelch at mail.berlios.de  Thu Jul 16 01:48:35 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:48:35 +0200
Subject: [Openocd-svn] r2536 - trunk/src/target
Message-ID: <200907152348.n6FNmZwP021683@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:48:32 +0200 (Thu, 16 Jul 2009)
New Revision: 2536

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

Print old-style Thumb NOP instructions as such.  (GCC uses "mov r8, r8"
instead of the architected NOP which is new in Thumb2.)


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:48:27 UTC (rev 2535)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:48:32 UTC (rev 2536)
@@ -1512,6 +1512,7 @@
 {
 	uint8_t high_reg, op, Rm, Rd,H1,H2;
 	char *mnemonic = NULL;
+	bool nop = false;
 
 	high_reg = (opcode & 0x0400) >> 10;
 	op = (opcode & 0x03C0) >> 6;
@@ -1546,6 +1547,8 @@
 			case 0x2:
 				instruction->type = ARM_MOV;
 				mnemonic = "MOV";
+				if (Rd == Rm)
+					nop = true;
 				break;
 			case 0x3:
 				if ((opcode & 0x7) == 0x0)
@@ -1671,9 +1674,15 @@
 		}
 	}
 
-	snprintf(instruction->text, 128,
-			"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tr%i, r%i",
-			 address, opcode, mnemonic, Rd, Rm);
+	if (nop)
+		snprintf(instruction->text, 128,
+				"0x%8.8" PRIx32 "  0x%4.4x    \tNOP\t\t\t"
+				"; (%s r%i, r%i)",
+				 address, opcode, mnemonic, Rd, Rm);
+	else
+		snprintf(instruction->text, 128,
+				"0x%8.8" PRIx32 "  0x%4.4x    \t%s\tr%i, r%i",
+				 address, opcode, mnemonic, Rd, Rm);
 
 	return ERROR_OK;
 }



From zwelch at mail.berlios.de  Thu Jul 16 01:48:40 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:48:40 +0200
Subject: [Openocd-svn] r2537 - trunk/src/target
Message-ID: <200907152348.n6FNmeYq021697@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:48:37 +0200 (Thu, 16 Jul 2009)
New Revision: 2537

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

More Thumb2 32-bit opcode support:

	 A5.3.10 Store single data item 

Byte, word, halfword.  Offset, pre-index, post-index.  And
a "make like you're unprivileged" option when using small
immediate offsets.


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:48:32 UTC (rev 2536)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:48:37 UTC (rev 2537)
@@ -2783,6 +2783,98 @@
 	return ERROR_OK;
 }
 
+static int t2ev_store_single(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	unsigned op = (opcode >> 20) & 0xf;
+	char *size = "";
+	char *suffix = "";
+	char *p1 = "";
+	char *p2 = "]";
+	unsigned immed;
+	unsigned rn = (opcode >> 16) & 0x0f;
+	unsigned rt = (opcode >> 12) & 0x0f;
+
+	if (rn == 0xf)
+		return ERROR_INVALID_ARGUMENTS;
+
+	if (opcode & 0x0800)
+		op |= 1;
+	switch (op) {
+	/* byte */
+	case 0x8:
+	case 0x9:
+		size = "B";
+		goto imm12;
+	case 0x1:
+		size = "B";
+		goto imm8;
+	case 0x0:
+		size = "B";
+		break;
+	/* halfword */
+	case 0xa:
+	case 0xb:
+		size = "H";
+		goto imm12;
+	case 0x3:
+		size = "H";
+		goto imm8;
+	case 0x2:
+		size = "H";
+		break;
+	/* word */
+	case 0xc:
+	case 0xd:
+		goto imm12;
+	case 0x5:
+		goto imm8;
+	case 0x4:
+		break;
+	/* error */
+	default:
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	sprintf(cp, "STR%s.W\tr%d, [r%d, r%d, LSL #%d]",
+			size, rt, rn, opcode & 0x0f,
+			(opcode >> 4) & 0x03);
+
+imm12:
+	immed = opcode & 0x0fff;
+	sprintf(cp, "STR%s.W\tr%d, [r%d, #%u]\t; %#3.3x",
+			size, rt, rn, immed, immed);
+	return ERROR_OK;
+
+imm8:
+	immed = opcode & 0x00ff;
+
+	switch (opcode & 0x700) {
+	case 0x600:
+		suffix = "T";
+		break;
+	case 0x000:
+	case 0x200:
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	/* two indexed modes will write back rn */
+	if (opcode & 0x100) {
+		if (opcode & 0x400)	/* pre-indexed */
+			p2 = "]!";
+		else {			/* post-indexed */
+			p1 = "]";
+			p2 = "";
+		}
+	}
+
+	sprintf(cp, "STR%s%s\tr%d, [r%d%s, #%s%u%s\t; %#2.2x",
+			size, suffix, rt, rn, p1,
+			(opcode & 0x200) ? "" : "-",
+			immed, p2, immed);
+	return ERROR_OK;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -2842,6 +2934,10 @@
 	else if ((opcode & 0x18008000) == 0x10008000)
 		retval = t2ev_b_misc(opcode, address, instruction, cp);
 
+	/* ARMv7-M: A5.3.10 Store single data item */
+	else if ((opcode & 0x1f100000) == 0x18000000)
+		retval = t2ev_store_single(opcode, address, instruction, cp);
+
 	/* FIXME decode more 32-bit instructions */
 
 	if (retval == ERROR_OK)



From zwelch at mail.berlios.de  Thu Jul 16 01:48:46 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:48:46 +0200
Subject: [Openocd-svn] r2538 - trunk/src/target
Message-ID: <200907152348.n6FNmkWL021714@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:48:43 +0200 (Thu, 16 Jul 2009)
New Revision: 2538

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

More instructions decoded:

	A5.3.14 Multiply, and multiply accumulate 
	A5.3.15 Long multiply, long multiply accumulate, divide

The EABI requires *adjacent* register pairs, but the long multiply
ops can use any pair of registers; interesting.


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:48:37 UTC (rev 2537)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:48:43 UTC (rev 2538)
@@ -2875,6 +2875,71 @@
 	return ERROR_OK;
 }
 
+static int t2ev_mul32(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	int ra = (opcode >> 12) & 0xf;
+
+
+	switch (opcode & 0x007000f0) {
+	case 0:
+		if (ra == 0xf)
+			sprintf(cp, "MUL\tr%d, r%d, r%d",
+				(opcode >> 8) & 0xf, (opcode >> 16) & 0xf,
+				(opcode >> 0) & 0xf);
+		else
+			sprintf(cp, "MLA\tr%d, r%d, r%d, r%d",
+				(opcode >> 8) & 0xf, (opcode >> 16) & 0xf,
+				(opcode >> 0) & 0xf, ra);
+		break;
+	case 0x10:
+		sprintf(cp, "MLS\tr%d, r%d, r%d, r%d",
+			(opcode >> 8) & 0xf, (opcode >> 16) & 0xf,
+			(opcode >> 0) & 0xf, ra);
+		break;
+	default:
+		return ERROR_INVALID_ARGUMENTS;
+	}
+	return ERROR_OK;
+}
+
+static int t2ev_mul64_div(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	int op = (opcode >> 4) & 0xf;
+	char *infix = "MUL";
+
+	op += (opcode >> 16) & 0x70;
+	switch (op) {
+	case 0x40:
+	case 0x60:
+		infix = "MLA";
+		/* FALLTHROUGH */
+	case 0:
+	case 0x20:
+		sprintf(cp, "%c%sL\tr%d, r%d, r%d, r%d",
+				(op & 0x20) ? 'U' : 'S',
+				infix,
+				(opcode >> 12) & 0xf,
+				(opcode >> 8) & 0xf,
+				(opcode >> 16) & 0xf,
+				(opcode >> 0) & 0xf);
+		break;
+	case 0x1f:
+	case 0x3f:
+		sprintf(cp, "%cDIV\tr%d, r%d, r%d",
+				(op & 0x20) ? 'U' : 'S',
+				(opcode >> 8) & 0xf,
+				(opcode >> 16) & 0xf,
+				(opcode >> 0) & 0xf);
+		break;
+	default:
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	return ERROR_OK;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -2938,6 +3003,14 @@
 	else if ((opcode & 0x1f100000) == 0x18000000)
 		retval = t2ev_store_single(opcode, address, instruction, cp);
 
+	/* ARMv7-M: A5.3.14 Multiply, and multiply accumulate */
+	else if ((opcode & 0x1f800000) == 0x1b000000)
+		retval = t2ev_mul32(opcode, address, instruction, cp);
+
+	/* ARMv7-M: A5.3.15 Long multiply, long multiply accumulate, divide */
+	else if ((opcode & 0x1f800000) == 0x1b800000)
+		retval = t2ev_mul64_div(opcode, address, instruction, cp);
+
 	/* FIXME decode more 32-bit instructions */
 
 	if (retval == ERROR_OK)



From zwelch at mail.berlios.de  Thu Jul 16 01:48:57 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:48:57 +0200
Subject: [Openocd-svn] r2539 - trunk/src/target
Message-ID: <200907152348.n6FNmvhF021728@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:48:54 +0200 (Thu, 16 Jul 2009)
New Revision: 2539

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

More instructions decoded:

	A5.3.5 Load/store multiple 

The preferred PUSH/POP syntax is shown when appropriate.


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:48:43 UTC (rev 2538)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:48:54 UTC (rev 2539)
@@ -2940,6 +2940,55 @@
 	return ERROR_OK;
 }
 
+static int t2ev_ldm_stm(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	int rn = (opcode >> 16) & 0xf;
+	int op = (opcode >> 22) & 0x6;
+	int t = (opcode >> 21) & 1;
+	unsigned registers = opcode & 0xffff;
+
+	if (opcode & (1 << 20))
+		op |= 1;
+
+	switch (op) {
+	case 2:
+		sprintf(cp, "STMB\tr%d%s, ", rn, t ? "!" : "");
+		break;
+	case 3:
+		if (rn == 13 && t)
+			sprintf(cp, "POP\t");
+		else
+			sprintf(cp, "LDM\tr%d%s, ", rn, t ? "!" : "");
+		break;
+	case 4:
+		if (rn == 13 && t)
+			sprintf(cp, "PUSH\t");
+		else
+			sprintf(cp, "STM\tr%d%s, ", rn, t ? "!" : "");
+		break;
+	case 5:
+		sprintf(cp, "LDMB\tr%d%s, ", rn, t ? "!" : "");
+		break;
+	default:
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	cp = strchr(cp, 0);
+	*cp++ = '{';
+	for (t = 0; registers; t++, registers >>= 1) {
+		if ((registers & 1) == 0)
+			continue;
+		registers &= ~1;
+		sprintf(cp, "r%d%s", t, registers ? "," : "");
+		cp = strchr(cp, 0);
+	}
+	*cp++ = '}';
+	*cp++ = 0;
+
+	return ERROR_OK;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -2999,6 +3048,10 @@
 	else if ((opcode & 0x18008000) == 0x10008000)
 		retval = t2ev_b_misc(opcode, address, instruction, cp);
 
+	/* ARMv7-M: A5.3.5 Load/store multiple */
+	else if ((opcode & 0x1e400000) == 0x08000000)
+		retval = t2ev_ldm_stm(opcode, address, instruction, cp);
+
 	/* ARMv7-M: A5.3.10 Store single data item */
 	else if ((opcode & 0x1f100000) == 0x18000000)
 		retval = t2ev_store_single(opcode, address, instruction, cp);



From zwelch at mail.berlios.de  Thu Jul 16 01:49:03 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:49:03 +0200
Subject: [Openocd-svn] r2540 - trunk/src/target
Message-ID: <200907152349.n6FNn3k6021760@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:49:00 +0200 (Thu, 16 Jul 2009)
New Revision: 2540

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

More 32-bit instruction decoding:

	A5.3.11 Data processing (shifted register)


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:48:54 UTC (rev 2539)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:49:00 UTC (rev 2540)
@@ -2989,6 +2989,170 @@
 	return ERROR_OK;
 }
 
+static int t2ev_data_shift(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	int op = (opcode >> 21) & 0xf;
+	int rd = (opcode >> 8) & 0xf;
+	int rn = (opcode >> 16) & 0xf;
+	int type = (opcode >> 4) & 0x3;
+	int immed = (opcode >> 6) & 0x3;
+	char *mnemonic;
+	char *suffix = "";
+
+	immed |= (opcode >> 10) & 0x7;
+	if (opcode & (1 << 21))
+		suffix = "S";
+
+	switch (op) {
+	case 0:
+		if (rd == 0xf) {
+			if (!(opcode & (1 << 21)))
+				return ERROR_INVALID_ARGUMENTS;
+			instruction->type = ARM_TST;
+			mnemonic = "TST";
+			goto two;
+		}
+		instruction->type = ARM_AND;
+		mnemonic = "AND";
+		break;
+	case 1:
+		instruction->type = ARM_BIC;
+		mnemonic = "BIC";
+		break;
+	case 2:
+		if (rn == 0xf) {
+			instruction->type = ARM_MOV;
+			switch (type) {
+			case 0:
+				if (immed == 0) {
+					sprintf(cp, "MOV%s.W\tr%d, r%d",
+						suffix, rd, (opcode & 0xf));
+					return ERROR_OK;
+				}
+				mnemonic = "LSL";
+				break;
+			case 1:
+				mnemonic = "LSR";
+				break;
+			case 2:
+				mnemonic = "ASR";
+				break;
+			default:
+				if (immed == 0) {
+					sprintf(cp, "RRX%s.W\tr%d, r%d",
+						suffix, rd, (opcode & 0xf));
+					return ERROR_OK;
+				}
+				mnemonic = "ROR";
+				break;
+			}
+			goto immediate;
+		} else {
+			instruction->type = ARM_ORR;
+			mnemonic = "ORR";
+		}
+		break;
+	case 3:
+		if (rn == 0xf) {
+			instruction->type = ARM_MVN;
+			mnemonic = "MVN";
+			rn = rd;
+			goto two;
+		} else {
+			// instruction->type = ARM_ORN;
+			mnemonic = "ORN";
+		}
+		break;
+	case 4:
+		if (rd == 0xf) {
+			if (!(opcode & (1 << 21)))
+				return ERROR_INVALID_ARGUMENTS;
+			instruction->type = ARM_TEQ;
+			mnemonic = "TEQ";
+			goto two;
+		}
+		instruction->type = ARM_EOR;
+		mnemonic = "EOR";
+		break;
+	case 8:
+		if (rd == 0xf) {
+			if (!(opcode & (1 << 21)))
+				return ERROR_INVALID_ARGUMENTS;
+			instruction->type = ARM_CMN;
+			mnemonic = "CMN";
+			goto two;
+		}
+		instruction->type = ARM_ADD;
+		mnemonic = "ADD";
+		break;
+	case 0xa:
+		instruction->type = ARM_ADC;
+		mnemonic = "ADC";
+		break;
+	case 0xb:
+		instruction->type = ARM_SBC;
+		mnemonic = "SBC";
+		break;
+	case 0xd:
+		if (rd == 0xf) {
+			if (!(opcode & (1 << 21)))
+				return ERROR_INVALID_ARGUMENTS;
+			instruction->type = ARM_CMP;
+			mnemonic = "CMP";
+			goto two;
+		}
+		instruction->type = ARM_SUB;
+		mnemonic = "SUB";
+		break;
+	case 0xe:
+		instruction->type = ARM_RSB;
+		mnemonic = "RSB";
+		break;
+	default:
+		return ERROR_INVALID_ARGUMENTS;
+	}
+
+	sprintf(cp, "%s%s.W\tr%d, r%d, r%d",
+		mnemonic, suffix, rd, rn, (opcode & 0xf));
+
+shift:
+	cp = strchr(cp, 0);
+
+	switch (type) {
+	case 0:
+		if (immed == 0)
+			return ERROR_OK;
+		suffix = "LSL";
+		break;
+	case 1:
+		suffix = "LSR";
+		break;
+	case 2:
+		suffix = "ASR";
+		break;
+	case 3:
+		if (immed == 0) {
+			strcpy(cp, "RRX");
+			return ERROR_OK;
+		}
+		suffix = "ROR";
+		break;
+	}
+	sprintf(cp, " %s #%d", suffix, immed ? immed : 32);
+	return ERROR_OK;
+
+two:
+	sprintf(cp, "%s%s.W\tr%d, r%d",
+		mnemonic, suffix, rn, (opcode & 0xf));
+	goto shift;
+
+immediate:
+	sprintf(cp, "%s%s.W\tr%d, r%d, #%d",
+		mnemonic, suffix, rd, (opcode & 0xf), immed ? immed : 32);
+	return ERROR_OK;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -3056,6 +3220,10 @@
 	else if ((opcode & 0x1f100000) == 0x18000000)
 		retval = t2ev_store_single(opcode, address, instruction, cp);
 
+	/* ARMv7-M: A5.3.11 Data processing (shifted register) */
+	else if ((opcode & 0x1e000000) == 0x0a000000)
+		retval = t2ev_data_shift(opcode, address, instruction, cp);
+
 	/* ARMv7-M: A5.3.14 Multiply, and multiply accumulate */
 	else if ((opcode & 0x1f800000) == 0x1b000000)
 		retval = t2ev_mul32(opcode, address, instruction, cp);



From zwelch at mail.berlios.de  Thu Jul 16 01:49:09 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:49:09 +0200
Subject: [Openocd-svn] r2541 - trunk/src/target
Message-ID: <200907152349.n6FNn93v021773@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:49:05 +0200 (Thu, 16 Jul 2009)
New Revision: 2541

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

More 32-bit Thumb2 instruction decoding:

	A5.3.12 Data processing (register)


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:49:00 UTC (rev 2540)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:49:05 UTC (rev 2541)
@@ -3153,6 +3153,107 @@
 	return ERROR_OK;
 }
 
+static int t2ev_data_reg(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	char *mnemonic;
+	char * suffix = "";
+
+	if (((opcode >> 4) & 0xf) == 0) {
+		switch ((opcode >> 21) & 0x7) {
+		case 0:
+			mnemonic = "LSL";
+			break;
+		case 1:
+			mnemonic = "LSR";
+			break;
+		case 2:
+			mnemonic = "ASR";
+			break;
+		case 3:
+			mnemonic = "ROR";
+			break;
+		default:
+			return ERROR_INVALID_ARGUMENTS;
+		}
+
+		instruction->type = ARM_MOV;
+		if (opcode & (1 << 20))
+			suffix = "S";
+		sprintf(cp, "%s%s.W\tr%d, r%d, r%d",
+				mnemonic, suffix,
+				(opcode >> 8) & 0xf,
+				(opcode >> 16) & 0xf,
+				(opcode >> 0) & 0xf);
+
+	} else if (opcode & (1 << 7)) {
+		switch ((opcode >> 24) & 0xf) {
+		case 0:
+		case 1:
+		case 4:
+		case 5:
+			switch ((opcode >> 4) & 0x3) {
+			case 1:
+				suffix = ", ROR #8";
+				break;
+			case 2:
+				suffix = ", ROR #16";
+				break;
+			case 3:
+				suffix = ", ROR #24";
+				break;
+			}
+			sprintf(cp, "%cXT%c.W\tr%d, r%d%s",
+					(opcode & (1 << 24)) ? 'U' : 'S',
+					(opcode & (1 << 26)) ? 'B' : 'H',
+					(opcode >> 8) & 0xf,
+					(opcode >> 16) & 0xf,
+					suffix);
+			break;
+		case 8:
+		case 9:
+		case 0xa:
+		case 0xb:
+			if (opcode & (1 << 6))
+				return ERROR_INVALID_ARGUMENTS;
+			if (~opcode & (0xff << 12))
+				return ERROR_INVALID_ARGUMENTS;
+			if (!(opcode & (1 << 20)))
+				return ERROR_INVALID_ARGUMENTS;
+
+			switch (((opcode >> 19) & 0x04)
+				| ((opcode >> 4) & 0x3)) {
+			case 0:
+				mnemonic = "REV.W";
+				break;
+			case 1:
+				mnemonic = "REV16.W";
+				break;
+			case 2:
+				mnemonic = "RBIT";
+				break;
+			case 3:
+				mnemonic = "REVSH.W";
+				break;
+			case 4:
+				mnemonic = "CLZ";
+				break;
+			default:
+				return ERROR_INVALID_ARGUMENTS;
+			}
+			sprintf(cp, "%s\tr%d, r%d",
+					mnemonic,
+					(opcode >> 8) & 0xf,
+					(opcode >> 0) & 0xf);
+			break;
+		default:
+			return ERROR_INVALID_ARGUMENTS;
+		}
+	}
+
+	return ERROR_OK;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -3224,6 +3325,10 @@
 	else if ((opcode & 0x1e000000) == 0x0a000000)
 		retval = t2ev_data_shift(opcode, address, instruction, cp);
 
+	/* ARMv7-M: A5.3.12 Data processing (register) */
+	else if ((opcode & 0x1f000000) == 0x1a000000)
+		retval = t2ev_data_reg(opcode, address, instruction, cp);
+
 	/* ARMv7-M: A5.3.14 Multiply, and multiply accumulate */
 	else if ((opcode & 0x1f800000) == 0x1b000000)
 		retval = t2ev_mul32(opcode, address, instruction, cp);



From zwelch at mail.berlios.de  Thu Jul 16 01:49:16 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 01:49:16 +0200
Subject: [Openocd-svn] r2542 - trunk/src/target
Message-ID: <200907152349.n6FNnGSB021786@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 01:49:12 +0200 (Thu, 16 Jul 2009)
New Revision: 2542

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

More 32-bit Thumb2 instruction decoding:

	A5.3.7 Load word 


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-15 23:49:05 UTC (rev 2541)
+++ trunk/src/target/arm_disassembler.c	2009-07-15 23:49:12 UTC (rev 2542)
@@ -3254,6 +3254,80 @@
 	return ERROR_OK;
 }
 
+static int t2ev_load_word(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	int rn = (opcode >> 16) & 0xf;
+	int immed;
+
+	instruction->type = ARM_LDR;
+
+	if (rn == 0xf) {
+		immed = opcode & 0x0fff;
+		if (opcode & (1 << 23))
+			immed = -immed;
+		sprintf(cp, "LDR\tr%d, %#8.8" PRIx32,
+				(opcode >> 12) & 0xf,
+				thumb_alignpc4(address) + immed);
+		return ERROR_OK;
+	}
+
+	if (opcode & (1 << 23)) {
+		immed = opcode & 0x0fff;
+		sprintf(cp, "LDR.W\tr%d, [r%d, #%d]\t; %#3.3x",
+				(opcode >> 12) & 0xf,
+				rn, immed, immed);
+		return ERROR_OK;
+	}
+
+	if (!(opcode & (0x3f << 6))) {
+		sprintf(cp, "LDR.W\tr%d, [r%d, r%d, LSL #%d]",
+				(opcode >> 12) & 0xf,
+				rn,
+				(opcode >> 0) & 0xf,
+				(opcode >> 4) & 0x3);
+		return ERROR_OK;
+	}
+
+
+	if (((opcode >> 8) & 0xf) == 0xe) {
+		immed = opcode & 0x00ff;
+
+		sprintf(cp, "LDRT\tr%d, [r%d, #%d]\t; %#2.2x",
+				(opcode >> 12) & 0xf,
+				rn, immed, immed);
+		return ERROR_OK;
+	}
+
+	if (((opcode >> 8) & 0xf) == 0xc || (opcode & 0x0900) == 0x0900) {
+		char *p1 = "]", *p2 = "";
+
+		if (!(opcode & 0x0600))
+			return ERROR_INVALID_ARGUMENTS;
+
+		immed = opcode & 0x00ff;
+
+		/* two indexed modes will write back rn */
+		if (opcode & 0x100) {
+			if (opcode & 0x400)	/* pre-indexed */
+				p2 = "]!";
+			else {			/* post-indexed */
+				p1 = "]";
+				p2 = "";
+			}
+		}
+
+		sprintf(cp, "LDR\tr%d, [r%d%s, #%s%u%s\t; %#2.2x",
+				(opcode >> 12) & 0xf,
+				rn, p1,
+				(opcode & 0x200) ? "" : "-",
+				immed, p2, immed);
+		return ERROR_OK;
+	}
+
+	return ERROR_INVALID_ARGUMENTS;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -3317,6 +3391,10 @@
 	else if ((opcode & 0x1e400000) == 0x08000000)
 		retval = t2ev_ldm_stm(opcode, address, instruction, cp);
 
+	/* ARMv7-M: A5.3.7 Load word */
+	else if ((opcode & 0x1f700000) == 0x18500000)
+		retval = t2ev_load_word(opcode, address, instruction, cp);
+
 	/* ARMv7-M: A5.3.10 Store single data item */
 	else if ((opcode & 0x1f100000) == 0x18000000)
 		retval = t2ev_store_single(opcode, address, instruction, cp);



From zwelch at mail.berlios.de  Thu Jul 16 02:08:31 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 02:08:31 +0200
Subject: [Openocd-svn] r2543 - trunk/src/target
Message-ID: <200907160008.n6G08VQI023054@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 02:08:21 +0200 (Thu, 16 Jul 2009)
New Revision: 2543

Modified:
   trunk/src/target/armv7m.c
   trunk/src/target/armv7m.h
   trunk/src/target/cortex_m3.c
   trunk/src/target/cortex_m3.h
Log:
Magnus Lundin <lundin at mlu.mine.nu>, Oyvind Harboe <oyvind.harboe at zylin.com>, David Brownell <david-b at pacbell.net>:

Some cleanup of the ARMv7-M support:

 - Reference the relevant ARMv7-M ARM doc (DDI 0405C to non-Vendors), and
   update the Cortex-M3 doc refs (DDI 0337C is no longer available).

 - Those registers aren't actually general, and some are incorrect (per all
   public docs anyway).  Update comments and code accordingly.

     * What the Core Debug facility exposes is *implementation-specific*
       not architectural.  These values aren't fully portable.  They match
       Cortex-M3 ... so no current implementation will make trouble, but
       the next v7m implementation might.

     * Four of the registers are actually not exposed that way.  Before
       Cortex-M3 r2p0 they are read/written through MRS/MSR instructions.
       In that newest silicon, they are four bytes in one register, not
       four separate registers.

 - Update the CM3 code to report when that one register is available,
   and not try to access it when it isn't.  Also declare the register
   numbers that an eventual MRS/MSR solution will need to be using.

 - Stop line wrapping the exception labels.

So for parts before r2p0 OpenOCD behavior is effectively unchanged, and
still buggy; but for those newer parts a few things might now be correct.

Most current Cortex-M3 parts use r1p1 (or earlier); this seems to include
most LM3S parts and all STM32 parts.  Parts using r2p0 are available, and
include fourth generation LM3S parts ("Tempest") plus AT91SAM3 and LPC17xx
parts which are now sampling.


Modified: trunk/src/target/armv7m.c
===================================================================
--- trunk/src/target/armv7m.c	2009-07-15 23:49:12 UTC (rev 2542)
+++ trunk/src/target/armv7m.c	2009-07-16 00:08:21 UTC (rev 2543)
@@ -25,6 +25,10 @@
  *   along with this program; if not, write to the                         *
  *   Free Software Foundation, Inc.,                                       *
  *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ *                                                                         *
+ *	ARMv7-M Architecture, Application Level Reference Manual           *
+ *              ARM DDI 0405C (September 2008)                             *
+ *                                                                         *
  ***************************************************************************/
 #ifdef HAVE_CONFIG_H
 #include "config.h"
@@ -44,8 +48,10 @@
 
 char* armv7m_exception_strings[] =
 {
-	"", "Reset", "NMI", "HardFault", "MemManage", "BusFault", "UsageFault", "RESERVED", "RESERVED", "RESERVED", "RESERVED",
-	"SVCall", "DebugMonitor", "RESERVED", "PendSV", "SysTick"
+	"", "Reset", "NMI", "HardFault",
+	"MemManage", "BusFault", "UsageFault", "RESERVED",
+	"RESERVED", "RESERVED", "RESERVED", "SVCall",
+	"DebugMonitor", "RESERVED", "PendSV", "SysTick"
 };
 
 char* armv7m_core_reg_list[] =
@@ -54,8 +60,8 @@
 	"r0", "r1", "r2", "r3", "r4", "r5", "r6", "r7", "r8", "r9", "r10", "r11", "r12",
 	"sp", "lr", "pc",
 	"xPSR", "msp", "psp",
-	/* Registers accessed through special reg 20 */
-	"primask", "basepri", "faultmask", "control"
+	/* reg 20 has 4 bytes: CONTROL, FAULTMASK, BASEPRI, PRIMASK */
+	"spec20",
 };
 
 uint8_t armv7m_gdb_dummy_fp_value[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
@@ -105,11 +111,11 @@
 	{17, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL}, /* MSP */
 	{18, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL}, /* PSP */
 
-	/*  CORE_SP are accesible using coreregister 20 */
-	{19, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}, /* PRIMASK */
-	{20, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}, /* BASEPRI */
-	{21, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}, /* FAULTMASK */
-	{22, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}  /* CONTROL */
+	/* FIXME the register numbers here are core-specific.
+	 * Numbers 0..18 above work for all Cortex-M3 revisions.
+	 * Number 20 below works for CM3 r2p0 and later.
+	 */
+	{20, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL},
 };
 
 int armv7m_core_reg_arch_type = -1;
@@ -381,12 +387,21 @@
 		armv7m_set_core_reg(reg, reg_params[i].value);
 	}
 
-	if (armv7m_algorithm_info->core_mode != ARMV7M_MODE_ANY)
+	/* NOTE:  CONTROL is bits 31:24 of SPEC20 register, if it's present;
+	 * holding a two-bit field.
+	 *
+	 * FIXME need a solution using ARMV7M_T_MSR().  Use it at least for
+	 * earlier cores.
+	 */
+	if (armv7m_algorithm_info->core_mode != ARMV7M_MODE_ANY
+			&& armv7m->has_spec20)
 	{
 		LOG_DEBUG("setting core_mode: 0x%2.2x", armv7m_algorithm_info->core_mode);
-		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_CONTROL].value, 0, 1, armv7m_algorithm_info->core_mode);
-		armv7m->core_cache->reg_list[ARMV7M_CONTROL].dirty = 1;
-		armv7m->core_cache->reg_list[ARMV7M_CONTROL].valid = 1;
+
+		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_SPEC20].value,
+				24, 2, armv7m_algorithm_info->core_mode);
+		armv7m->core_cache->reg_list[ARMV7M_SPEC20].dirty = 1;
+		armv7m->core_cache->reg_list[ARMV7M_SPEC20].valid = 1;
 	}
 
 	/* ARMV7M always runs in Thumb state */

Modified: trunk/src/target/armv7m.h
===================================================================
--- trunk/src/target/armv7m.h	2009-07-15 23:49:12 UTC (rev 2542)
+++ trunk/src/target/armv7m.h	2009-07-16 00:08:21 UTC (rev 2543)
@@ -61,10 +61,15 @@
 	ARMV7M_xPSR = 16,
 	ARMV7M_MSP,
 	ARMV7M_PSP,
-	ARMV7M_PRIMASK,
-	ARMV7M_BASEPRI,
-	ARMV7M_FAULTMASK,
-	ARMV7M_CONTROL,
+
+	/* FIXME the register numbers here are core-specific.  Cortex-M3
+	 * through r1p1 only defines registers up to PSP; see ARM DDI 0337E.
+	 *
+	 * It's r2p0 (see ARM DDI 0337G) which defines the register that's
+	 * called SPEC20 here, with four single-byte fields with CONTROL
+	 * (highest byte), FAULTMASK, BASEPRI, and PRIMASK (lowest byte).
+	 */
+	ARMV7M_SPEC20 = 20,
 	ARMV7NUMCOREREGS
 };
 
@@ -78,6 +83,7 @@
 	int exception_number;
 	swjdp_common_t swjdp_info;
 
+	bool has_spec20;
 
 	/* Direct processor core register read and writes */
 	int (*load_core_reg_u32)(struct target_s *target, enum armv7m_regtype type, uint32_t num, uint32_t *value);

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-07-15 23:49:12 UTC (rev 2542)
+++ trunk/src/target/cortex_m3.c	2009-07-16 00:08:21 UTC (rev 2543)
@@ -24,7 +24,7 @@
  *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
  *                                                                         *
  *                                                                         *
- *   Cortex-M3(tm) TRM, ARM DDI 0337C                                      *
+ *   Cortex-M3(tm) TRM, ARM DDI 0337E (r1p1) and 0337G (r2p0)              *
  *                                                                         *
  ***************************************************************************/
 #ifdef HAVE_CONFIG_H
@@ -395,7 +395,7 @@
 
 	/* Examine target state and mode */
 	/* First load register acessible through core debug port*/
-	for (i = 0; i < ARMV7M_PRIMASK; i++)
+	for (i = 0; i < ARMV7NUMCOREREGS; i++)
 	{
 		if (!armv7m->core_cache->reg_list[i].valid)
 			armv7m->read_core_reg(target, i);
@@ -418,22 +418,19 @@
 		cortex_m3_store_core_reg_u32(target, ARMV7M_REGISTER_CORE_GP, 16, xPSR &~ 0xff);
 	}
 
-	/* Now we can load SP core registers */
-	for (i = ARMV7M_PRIMASK; i < ARMV7NUMCOREREGS; i++)
-	{
-		if (!armv7m->core_cache->reg_list[i].valid)
-			armv7m->read_core_reg(target, i);
-	}
-
 	/* Are we in an exception handler */
 	if (xPSR & 0x1FF)
 	{
 		armv7m->core_mode = ARMV7M_MODE_HANDLER;
 		armv7m->exception_number = (xPSR & 0x1FF);
 	}
-	else
+	else if (armv7m->has_spec20)
 	{
-		armv7m->core_mode = buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_CONTROL].value, 0, 1);
+		/* NOTE:  CONTROL is bits 31:24 of SPEC20 register, holding
+		 * a two-bit field.  Unavailable before r2p0...
+		 */
+		armv7m->core_mode = buf_get_u32(
+			armv7m->core_cache->reg_list[ARMV7M_SPEC20].value, 24, 2);
 		armv7m->exception_number = 0;
 	}
 
@@ -636,16 +633,26 @@
 	if (debug_execution)
 	{
 		/* Disable interrupts */
-		/* We disable interrupts in the PRIMASK register instead of masking with C_MASKINTS,
+		/* We disable interrupts in the PRIMASK register instead
+		 * of masking with C_MASKINTS,
 		 * This is probably the same issue as Cortex-M3 Errata	377493:
-		 * C_MASKINTS in parallel with disabled interrupts can cause local faults to not be taken. */
-		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_PRIMASK].value, 0, 32, 1);
-		armv7m->core_cache->reg_list[ARMV7M_PRIMASK].dirty = 1;
-		armv7m->core_cache->reg_list[ARMV7M_PRIMASK].valid = 1;
+		 * C_MASKINTS in parallel with disabled interrupts can cause
+		 * local faults to not be taken.  (FIXED in r1p0 and later.)
+		 *
+		 * NOTE:  PRIMASK is bits 7:0 of SPEC20 register, holding a
+		 * one bit field.  Available this way for r2p0 and later...
+		 */
+		if (armv7m->has_spec20) {
+			buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_SPEC20]
+					.value, 0, 1, 1);
+			armv7m->core_cache->reg_list[ARMV7M_SPEC20].dirty = 1;
+			armv7m->core_cache->reg_list[ARMV7M_SPEC20].valid = 1;
+		}
 
 		/* Make sure we are in Thumb mode */
 		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_xPSR].value, 0, 32,
-			buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_xPSR].value, 0, 32) | (1 << 24));
+			buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_xPSR].value, 0, 32)
+			| (1 << 24));
 		armv7m->core_cache->reg_list[ARMV7M_xPSR].dirty = 1;
 		armv7m->core_cache->reg_list[ARMV7M_xPSR].valid = 1;
 	}
@@ -1467,8 +1474,14 @@
 		if ((retval = target_read_u32(target, CPUID, &cpuid)) != ERROR_OK)
 			return retval;
 
-		if (((cpuid >> 4) & 0xc3f) == 0xc23)
+		if (((cpuid >> 4) & 0xc3f) == 0xc23) {
 			LOG_DEBUG("CORTEX-M3 processor detected");
+			if (((cpuid >> 20) & 0xf) >= 2) {
+				armv7m->has_spec20 = true;
+				LOG_DEBUG("r2p0 or later detected");
+			}
+		} else
+			LOG_WARNING("not a CORTEX-M3 processor?");
 		LOG_DEBUG("cpuid: 0x%8.8" PRIx32 "", cpuid);
 
 		target_read_u32(target, NVIC_ICTR, &ictr);

Modified: trunk/src/target/cortex_m3.h
===================================================================
--- trunk/src/target/cortex_m3.h	2009-07-15 23:49:12 UTC (rev 2542)
+++ trunk/src/target/cortex_m3.h	2009-07-16 00:08:21 UTC (rev 2543)
@@ -117,6 +117,21 @@
 #define FPCR_REPLACE_BKPT_HIGH  (2 << 30)
 #define FPCR_REPLACE_BKPT_BOTH  (3 << 30)
 
+/* Use MRS/MSR to read/write any of these special registers.  Some of
+ * them (xPSR, MSP, PSP) are always available using DCRxR.  Starting in
+ * Cortex-M3 r2p0, some (CONTROL, BASEPRI, and *MASK) are also available
+ * through DCRxR.
+ * NOTE: this listing omits xPSR components and other mixtures.
+ */
+#define SR_XPSR		3
+#define SR_MSP		8
+#define SR_PSP		9
+#define SR_PRIMASK	16
+#define SR_BASEPRI	17
+#define SR_BASEPRI_MAX	18
+#define SR_FAULTMASK	19
+#define SR_CONTROL	20
+
 typedef struct  cortex_m3_fp_comparator_s
 {
 	int used;



From zwelch at mail.berlios.de  Thu Jul 16 02:08:43 2009
From: zwelch at mail.berlios.de (zwelch at mail.berlios.de)
Date: Thu, 16 Jul 2009 02:08:43 +0200
Subject: [Openocd-svn] r2544 - trunk/src/target
Message-ID: <200907160008.n6G08hfX023068@sheep.berlios.de>

Author: zwelch
Date: 2009-07-16 02:08:36 +0200 (Thu, 16 Jul 2009)
New Revision: 2544

Modified:
   trunk/src/target/arm_adi_v5.c
   trunk/src/target/arm_adi_v5.h
   trunk/src/target/armv7m.c
Log:
Magnus Lundin <lundin at mlu.mine.nu>, Oyvind Harboe <oyvind.harboe at zylin.com>, David Brownell <david-b at pacbell.net>:

Move the dap command handler implementations to arm_adi_v5.c,
leaving just thin wrappers in armv7m.c.  There should be no
change in functionality here.  (From Magnus.)

Minor style cleanup:  whitespace, line length, etc.  Update spec
references to use docs which are currently available.  (From Dave.)


Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-07-16 00:08:21 UTC (rev 2543)
+++ trunk/src/target/arm_adi_v5.c	2009-07-16 00:08:36 UTC (rev 2544)
@@ -29,8 +29,8 @@
  *                                                                         *
  * ARM(tm) Debug Interface v5 Architecture Specification    ARM IHI 0031A  *
  *                                                                         *
- * CoreSight(tm) DAP-Lite TRM, ARM DDI 0316A                               *
- * Cortex-M3(tm) TRM, ARM DDI 0337C                                        *
+ * CoreSight(tm) DAP-Lite TRM, ARM DDI 0316D                               *
+ * Cortex-M3(tm) TRM, ARM DDI 0337G                                        *
  *                                                                         *
 ***************************************************************************/
 
@@ -1129,3 +1129,85 @@
 	return ERROR_OK;
 }
 
+int dap_baseaddr_command(struct command_context_s *cmd_ctx,
+		swjdp_common_t *swjdp, char **args, int argc)
+{
+	uint32_t apsel, apselsave, baseaddr;
+	int retval;
+
+	apsel = swjdp->apsel;
+	apselsave = swjdp->apsel;
+	if (argc > 0)
+		apsel = strtoul(args[0], NULL, 0);
+	if (apselsave != apsel)
+		dap_ap_select(swjdp, apsel);
+
+	dap_ap_read_reg_u32(swjdp, 0xF8, &baseaddr);
+	retval = swjdp_transaction_endcheck(swjdp);
+	command_print(cmd_ctx, "0x%8.8x", baseaddr);
+
+	if (apselsave != apsel)
+		dap_ap_select(swjdp, apselsave);
+
+	return retval;
+}
+
+int dap_memaccess_command(struct command_context_s *cmd_ctx,
+		swjdp_common_t *swjdp, char **args, int argc)
+{
+	uint32_t memaccess_tck;
+
+	memaccess_tck = swjdp->memaccess_tck;
+	if (argc > 0)
+		memaccess_tck = strtoul(args[0], NULL, 0);
+
+	swjdp->memaccess_tck = memaccess_tck;
+	command_print(cmd_ctx, "memory bus access delay set to %i tck",
+			swjdp->memaccess_tck);
+
+	return ERROR_OK;
+}
+
+int dap_apsel_command(struct command_context_s *cmd_ctx,
+		swjdp_common_t *swjdp, char **args, int argc)
+{
+	uint32_t apsel, apid;
+	int retval;
+
+	apsel = 0;
+	if (argc > 0)
+		apsel = strtoul(args[0], NULL, 0);
+
+	dap_ap_select(swjdp, apsel);
+	dap_ap_read_reg_u32(swjdp, 0xFC, &apid);
+	retval = swjdp_transaction_endcheck(swjdp);
+	command_print(cmd_ctx, "ap %i selected, identification register 0x%8.8x",
+			apsel, apid);
+
+	return retval;
+}
+
+int dap_apid_command(struct command_context_s *cmd_ctx,
+		swjdp_common_t *swjdp, char **args, int argc)
+{
+	uint32_t apsel, apselsave, apid;
+	int retval;
+
+	apsel = swjdp->apsel;
+	apselsave = swjdp->apsel;
+	if (argc > 0)
+		apsel = strtoul(args[0], NULL, 0);
+
+	if (apselsave != apsel)
+		dap_ap_select(swjdp, apsel);
+
+	dap_ap_read_reg_u32(swjdp, 0xFC, &apid);
+	retval = swjdp_transaction_endcheck(swjdp);
+	command_print(cmd_ctx, "0x%8.8x", apid);
+	if (apselsave != apsel)
+		dap_ap_select(swjdp, apselsave);
+
+	return retval;
+}
+
+

Modified: trunk/src/target/arm_adi_v5.h
===================================================================
--- trunk/src/target/arm_adi_v5.h	2009-07-16 00:08:21 UTC (rev 2543)
+++ trunk/src/target/arm_adi_v5.h	2009-07-16 00:08:36 UTC (rev 2544)
@@ -145,13 +145,17 @@
 /* Initialisation of the debug system, power domains and registers */
 extern int ahbap_debugport_init(swjdp_common_t *swjdp);
 
-extern int dap_info_command(struct command_context_s *cmd_ctx, swjdp_common_t *swjdp, int apsel);
+
 /* Commands for user dap access */
-/* Currently implemented in armv7m, needs armv7m target structure to find jtag and swjdp structures */
-extern int handle_dap_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-extern int handle_dap_apsel_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-extern int handle_dap_apid_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-extern int handle_dap_baseaddr_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-extern int handle_dap_memaccess_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+int dap_info_command(struct command_context_s *cmd_ctx,
+		swjdp_common_t *swjdp, int apsel);
+int dap_baseaddr_command(struct command_context_s *cmd_ctx,
+		swjdp_common_t *swjdp, char **args, int argc);
+int dap_memaccess_command(struct command_context_s *cmd_ctx,
+		swjdp_common_t *swjdp, char **args, int argc);
+int dap_apsel_command(struct command_context_s *cmd_ctx,
+		swjdp_common_t *swjdp, char **args, int argc);
+int dap_apid_command(struct command_context_s *cmd_ctx,
+		swjdp_common_t *swjdp, char **args, int argc);
 
 #endif

Modified: trunk/src/target/armv7m.c
===================================================================
--- trunk/src/target/armv7m.c	2009-07-16 00:08:21 UTC (rev 2543)
+++ trunk/src/target/armv7m.c	2009-07-16 00:08:36 UTC (rev 2544)
@@ -554,20 +554,6 @@
 	return ERROR_OK;
 }
 
-int armv7m_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *arm_adi_v5_dap_cmd;
-
-	arm_adi_v5_dap_cmd = register_command(cmd_ctx, NULL, "dap", NULL, COMMAND_ANY, "cortex dap specific commands");
-	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "info", handle_dap_info_command, COMMAND_EXEC, "Displays dap info for ap [num], default currently selected AP");
-	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "apsel", handle_dap_apsel_command, COMMAND_EXEC, "Select a different AP [num] (default 0)");
-	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "apid", handle_dap_apid_command, COMMAND_EXEC, "Displays id reg from AP [num], default currently selected AP");
-	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "baseaddr", handle_dap_baseaddr_command, COMMAND_EXEC, "Displays debug base address from AP [num], default currently selected AP");
-	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "memaccess", handle_dap_memaccess_command, COMMAND_EXEC, "set/get number of extra tck for mem-ap memory bus access [0-255]");
-
-	return ERROR_OK;
-}
-
 int armv7m_checksum_memory(struct target_s *target, uint32_t address, uint32_t count, uint32_t* checksum)
 {
 	working_area_t *crc_algorithm;
@@ -711,10 +697,12 @@
 	return ERROR_OK;
 }
 
-/********************************************************************************************************************
-* Return the debug ap baseaddress in hexadecimal, no extra output to simplify script processing
-*********************************************************************************************************************/
-int handle_dap_baseaddr_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+/*
+ * Return the debug ap baseaddress in hexadecimal;
+ * no extra output to simplify script processing
+ */
+static int handle_dap_baseaddr_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);
 	armv7m_common_t *armv7m = target->arch_info;
@@ -746,97 +734,83 @@
 }
 
 
-/********************************************************************************************************************
-* Return the debug ap id in hexadecimal, no extra output to simplify script processing
-*********************************************************************************************************************/
-extern int handle_dap_apid_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+/*
+ * Return the debug ap id in hexadecimal;
+ * no extra output to simplify script processing
+ */
+extern int handle_dap_apid_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);
 	armv7m_common_t *armv7m = target->arch_info;
 	swjdp_common_t *swjdp = &armv7m->swjdp_info;
-	uint32_t apsel, apselsave, apid;
-	int retval;
 
-	apsel = swjdp->apsel;
-	apselsave = swjdp->apsel;
-	if (argc > 0)
-	{
-		apsel = strtoul(args[0], NULL, 0);
-	}
-
-	if (apselsave != apsel)
-	{
-		dap_ap_select(swjdp, apsel);
-	}
-
-	dap_ap_read_reg_u32(swjdp, 0xFC, &apid);
-	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, "0x%8.8" PRIx32 "", apid);
-	if (apselsave != apsel)
-	{
-		dap_ap_select(swjdp, apselsave);
-	}
-
-	return retval;
+	return dap_apid_command(cmd_ctx, swjdp, args, argc);
 }
 
-int handle_dap_apsel_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_dap_apsel_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);
 	armv7m_common_t *armv7m = target->arch_info;
 	swjdp_common_t *swjdp = &armv7m->swjdp_info;
-	uint32_t apsel, apid;
-	int retval;
 
-	apsel = 0;
-	if (argc > 0)
-	{
-		apsel = strtoul(args[0], NULL, 0);
-	}
-
-	dap_ap_select(swjdp, apsel);
-	dap_ap_read_reg_u32(swjdp, 0xFC, &apid);
-	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, "ap %i selected, identification register 0x%8.8" PRIx32 "", (int)apsel, apid);
-
-	return retval;
+	return dap_apsel_command(cmd_ctx, swjdp, args, argc);
 }
 
-int handle_dap_memaccess_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+static int handle_dap_memaccess_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);
 	armv7m_common_t *armv7m = target->arch_info;
 	swjdp_common_t *swjdp = &armv7m->swjdp_info;
-	uint32_t memaccess_tck;
 
-	memaccess_tck = swjdp->memaccess_tck;
-	if (argc > 0)
-	{
-		memaccess_tck = strtoul(args[0], NULL, 0);
-	}
-
-	swjdp->memaccess_tck = memaccess_tck;
-	command_print(cmd_ctx, "memory bus access delay set to %i tck", (int)(swjdp->memaccess_tck));
-
-	return ERROR_OK;
+	return dap_memaccess_command(cmd_ctx, swjdp, args, argc);
 }
 
-int handle_dap_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+
+static int handle_dap_info_command(struct command_context_s *cmd_ctx,
+		char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);
 	armv7m_common_t *armv7m = target->arch_info;
 	swjdp_common_t *swjdp = &armv7m->swjdp_info;
-	int retval;
 	uint32_t apsel;
 
 	apsel =  swjdp->apsel;
 	if (argc > 0)
-	{
 		apsel = strtoul(args[0], NULL, 0);
-	}
 
-	retval = dap_info_command(cmd_ctx, swjdp, apsel);
-
-	return retval;
+	return dap_info_command(cmd_ctx, swjdp, apsel);
 }
 
+int armv7m_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *arm_adi_v5_dap_cmd;
+
+	arm_adi_v5_dap_cmd = register_command(cmd_ctx, NULL, "dap",
+			NULL, COMMAND_ANY,
+			"cortex dap specific commands");
+
+	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "info",
+			handle_dap_info_command, COMMAND_EXEC,
+			"Displays dap info for ap [num],"
+			"default currently selected AP");
+	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "apsel",
+			handle_dap_apsel_command, COMMAND_EXEC,
+			"Select a different AP [num] (default 0)");
+	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "apid",
+			handle_dap_apid_command, COMMAND_EXEC,
+			"Displays id reg from AP [num], "
+			"default currently selected AP");
+	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "baseaddr",
+			handle_dap_baseaddr_command, COMMAND_EXEC,
+			"Displays debug base address from AP [num],"
+			"default currently selected AP");
+	register_command(cmd_ctx, arm_adi_v5_dap_cmd, "memaccess",
+			handle_dap_memaccess_command, COMMAND_EXEC,
+			"set/get number of extra tck for mem-ap "
+			"memory bus access [0-255]");
+
+	return ERROR_OK;
+}



From ntfreak at mail.berlios.de  Thu Jul 16 12:03:34 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Thu, 16 Jul 2009 12:03:34 +0200
Subject: [Openocd-svn] r2545 - trunk
Message-ID: <200907161003.n6GA3YP1005838@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-16 12:03:33 +0200 (Thu, 16 Jul 2009)
New Revision: 2545

Modified:
   trunk/configure.in
Log:
- disable using parport ppdev under win32 hosts

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-07-16 00:08:36 UTC (rev 2544)
+++ trunk/configure.in	2009-07-16 10:03:33 UTC (rev 2545)
@@ -453,6 +453,7 @@
 case $host in 
   *-cygwin*) 
     is_win32=yes
+    parport_use_ppdev=no
 
     AC_COMPILE_IFELSE(AC_LANG_PROGRAM([],[return __MINGW32__;]),
       [is_mingw=yes],[is_mingw=no])
@@ -474,6 +475,7 @@
   *-mingw*) 
     is_mingw=yes
     is_win32=yes
+    parport_use_ppdev=no
 
     if test x$parport_use_giveio = xno; then
       AC_MSG_WARN([--disable-parport-giveio is not supported by MinGW32 hosts])



From oharboe at mail.berlios.de  Thu Jul 16 12:30:51 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 16 Jul 2009 12:30:51 +0200
Subject: [Openocd-svn] r2546 - trunk/src/target
Message-ID: <200907161030.n6GAUp0B013157@sheep.berlios.de>

Author: oharboe
Date: 2009-07-16 12:30:50 +0200 (Thu, 16 Jul 2009)
New Revision: 2546

Modified:
   trunk/src/target/mips_ejtag.c
Log:
microscopic white space fixes

Modified: trunk/src/target/mips_ejtag.c
===================================================================
--- trunk/src/target/mips_ejtag.c	2009-07-16 10:03:33 UTC (rev 2545)
+++ trunk/src/target/mips_ejtag.c	2009-07-16 10:30:50 UTC (rev 2546)
@@ -44,12 +44,8 @@
 		field.num_bits = tap->ir_length;
 		field.out_value = t;
 		buf_set_u32(field.out_value, 0, field.num_bits, new_instr);
-
 		field.in_value = NULL;
 
-
-
-
 		jtag_add_ir_scan(1, &field, jtag_get_end_state());
 	}
 
@@ -67,12 +63,8 @@
 	field.tap = ejtag_info->tap;
 	field.num_bits = 32;
 	field.out_value = NULL;
-
 	field.in_value = (void*)idcode;
 
-
-
-
 	jtag_add_dr_scan(1, &field, jtag_get_end_state());
 
 	if (jtag_execute_queue() != ERROR_OK)
@@ -94,12 +86,8 @@
 	field.tap = ejtag_info->tap;
 	field.num_bits = 32;
 	field.out_value = NULL;
-
 	field.in_value = (void*)impcode;
 
-
-
-
 	jtag_add_dr_scan(1, &field, jtag_get_end_state());
 
 	if (jtag_execute_queue() != ERROR_OK)
@@ -125,12 +113,8 @@
 	field.num_bits = 32;
 	field.out_value = t;
 	buf_set_u32(field.out_value, 0, field.num_bits, *data);
-
 	field.in_value = r;
 
-
-
-
 	jtag_add_dr_scan(1, &field, jtag_get_end_state());
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)



From oharboe at mail.berlios.de  Thu Jul 16 12:43:19 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 16 Jul 2009 12:43:19 +0200
Subject: [Openocd-svn] r2547 - trunk/src/target
Message-ID: <200907161043.n6GAhJfE024270@sheep.berlios.de>

Author: oharboe
Date: 2009-07-16 12:43:15 +0200 (Thu, 16 Jul 2009)
New Revision: 2547

Modified:
   trunk/src/target/feroceon.c
Log:
microscopic whitespace cleanup

Modified: trunk/src/target/feroceon.c
===================================================================
--- trunk/src/target/feroceon.c	2009-07-16 10:30:50 UTC (rev 2546)
+++ trunk/src/target/feroceon.c	2009-07-16 10:43:15 UTC (rev 2547)
@@ -132,33 +132,18 @@
 	fields[0].tap = jtag_info->tap;
 	fields[0].num_bits = 32;
 	fields[0].out_value = out_buf;
-
 	fields[0].in_value = NULL;
 
-
-
-
-
 	fields[1].tap = jtag_info->tap;
 	fields[1].num_bits = 3;
 	fields[1].out_value = &sysspeed_buf;
-
 	fields[1].in_value = NULL;
 
-
-
-
-
 	fields[2].tap = jtag_info->tap;
 	fields[2].num_bits = 32;
 	fields[2].out_value = instr_buf;
-
 	fields[2].in_value = NULL;
 
-
-
-
-
 	jtag_add_dr_scan(3, fields, jtag_get_end_state());
 
 	/* no jtag_add_runtest(0, jtag_get_end_state()) here */



From oharboe at mail.berlios.de  Thu Jul 16 12:44:42 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 16 Jul 2009 12:44:42 +0200
Subject: [Openocd-svn] r2548 - trunk
Message-ID: <200907161044.n6GAigDi026312@sheep.berlios.de>

Author: oharboe
Date: 2009-07-16 12:44:42 +0200 (Thu, 16 Jul 2009)
New Revision: 2548

Modified:
   trunk/TODO
Log:
added item to come up with slick new 32 bit jtag_add_xxx() API

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-16 10:43:15 UTC (rev 2547)
+++ trunk/TODO	2009-07-16 10:44:42 UTC (rev 2548)
@@ -39,11 +39,16 @@
 
 @subsection thelistjtagcore JTAG Core
 
-The following tasks have been suggeted for cleaning up the JTAG layer:
+The following tasks have been suggested for cleaning up the JTAG layer:
 
 - use tap_set_state everywhere to allow logging TAP state transitions
 - rename other tap_states to use standard JTAG names (suggested by ML)
 - Encapsulate cmd_queue_cur_state and related varaible handling.
+- add slick 32 bit versions of jtag_add_xxx_scan() that avoids
+buf_set_u32() calls and other evidence of poor impedance match between
+API and calling code. New API should cut down # of lines in calling
+code by 100's and make things clearer. Also potentially be supported
+directly in minidriver API for better embedded host performance.
 
 The following tasks have been suggested for adding new core JTAG support:
 



From oharboe at mail.berlios.de  Fri Jul 17 21:54:29 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 17 Jul 2009 21:54:29 +0200
Subject: [Openocd-svn] r2549 - in trunk: . doc/manual ecosflash src
	src/flash src/helper src/jtag src/jtag/minidummy
	src/jtag/rlink src/jtag/zy1000 src/server src/target src/xsvf
Message-ID: <200907171954.n6HJsTGS022320@sheep.berlios.de>

Author: oharboe
Date: 2009-07-17 21:54:25 +0200 (Fri, 17 Jul 2009)
New Revision: 2549

Modified:
   trunk/TODO
   trunk/doc/manual/scripting.txt
   trunk/ecosflash/Makefile
   trunk/ecosflash/flash.S
   trunk/ecosflash/flash.c
   trunk/src/ecosboard.c
   trunk/src/flash/ecos.c
   trunk/src/flash/flash.c
   trunk/src/flash/flash.h
   trunk/src/flash/lpc288x.c
   trunk/src/helper/binarybuffer.c
   trunk/src/helper/binarybuffer.h
   trunk/src/helper/command.c
   trunk/src/helper/command.h
   trunk/src/helper/configuration.c
   trunk/src/helper/configuration.h
   trunk/src/helper/fileio.c
   trunk/src/helper/fileio.h
   trunk/src/helper/ioutil.c
   trunk/src/helper/jim-eventloop.c
   trunk/src/helper/jim-eventloop.h
   trunk/src/helper/jim.c
   trunk/src/helper/jim.h
   trunk/src/helper/log.c
   trunk/src/helper/log.h
   trunk/src/helper/options.c
   trunk/src/helper/replacements.c
   trunk/src/helper/replacements.h
   trunk/src/helper/time_support.c
   trunk/src/helper/time_support.h
   trunk/src/helper/types.h
   trunk/src/jtag/bitbang.c
   trunk/src/jtag/bitbang.h
   trunk/src/jtag/core.c
   trunk/src/jtag/dummy.c
   trunk/src/jtag/interface.c
   trunk/src/jtag/jtag.h
   trunk/src/jtag/minidummy/jtag_minidriver.h
   trunk/src/jtag/minidummy/minidummy.c
   trunk/src/jtag/parport.c
   trunk/src/jtag/rlink/rlink.c
   trunk/src/jtag/tcl.c
   trunk/src/jtag/zy1000/jtag_minidriver.h
   trunk/src/jtag/zy1000/zy1000.c
   trunk/src/openocd.c
   trunk/src/server/gdb_server.c
   trunk/src/server/gdb_server.h
   trunk/src/server/httpd.c
   trunk/src/server/server.c
   trunk/src/server/server.h
   trunk/src/server/telnet_server.c
   trunk/src/server/telnet_server.h
   trunk/src/target/arm7_9_common.c
   trunk/src/target/arm7_9_common.h
   trunk/src/target/arm7tdmi.c
   trunk/src/target/arm_jtag.c
   trunk/src/target/arm_jtag.h
   trunk/src/target/armv7m.c
   trunk/src/target/embeddedice.c
   trunk/src/target/embeddedice.h
   trunk/src/target/image.c
   trunk/src/target/image.h
   trunk/src/target/mips32.c
   trunk/src/target/register.c
   trunk/src/target/register.h
   trunk/src/target/target.c
   trunk/src/target/target.h
   trunk/src/target/target_request.c
   trunk/src/target/target_request.h
   trunk/src/target/xscale.c
   trunk/src/target/xscale.h
   trunk/src/xsvf/xsvf.c
Log:
Andreas Fritiofson <andreas.fritiofson at gmail.com> UTF8 fixes

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/TODO	2009-07-17 19:54:25 UTC (rev 2549)
@@ -117,7 +117,7 @@
 - ARM923EJS:
   - reset run/halt/step is not robust; needs testing to map out problems.
 - ARM11 improvements (MB?)
-  - fix single stepping  (reported by ???H)
+  - fix single stepping  (reported by ??H)
   - implement missing functionality (grep FNC_INFO_NOTIMPLEMENTED ...)
 - Cortex A8 support (ML)
   - add target implementation (ML)
@@ -169,7 +169,7 @@
 - finish implementing bus width/chip width handling (suggested by NC)
 - factor vendor-specific code into separate source files
   - add new callback interface for vendor-specific code
-- investigate/implement "thin wrapper" to use eCos CFI drivers (???H)
+- investigate/implement "thin wrapper" to use eCos CFI drivers (??H)
 
 @section thelistdebug Debugger Support
 

Modified: trunk/doc/manual/scripting.txt
===================================================================
--- trunk/doc/manual/scripting.txt	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/doc/manual/scripting.txt	2009-07-17 19:54:25 UTC (rev 2549)
@@ -15,7 +15,7 @@
 to those same end users.
 
 Jim Tcl was chosen as it was easy to integrate, works
-great in an embedded environment and ?yvind Harboe
+great in an embedded environment and ??yvind Harboe
 had experience with it.
 
 @section scriptinguses Uses of scripting

Modified: trunk/ecosflash/Makefile
===================================================================
--- trunk/ecosflash/Makefile	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/ecosflash/Makefile	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,7 +1,7 @@
 #####ECOSGPLCOPYRIGHTBEGIN####
 ## -------------------------------------------
 ## This file is part of eCos, the Embedded Configurable Operating System.
-## Copyright (C) 2008 ?yvind Harboe
+## Copyright (C) 2008 ??yvind Harboe
 ##
 ## eCos is free software; you can redistribute it and/or modify it under
 ## the terms of the GNU General Public License as published by the Free

Modified: trunk/ecosflash/flash.S
===================================================================
--- trunk/ecosflash/flash.S	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/ecosflash/flash.S	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
 #####ECOSGPLCOPYRIGHTBEGIN####
 ## -------------------------------------------
 ## This file is part of eCos, the Embedded Configurable Operating System.
-## Copyright (C) 2008 ?yvind Harboe
+## Copyright (C) 2008 ??yvind Harboe
 ##
 ## eCos is free software; you can redistribute it and/or modify it under
 ## the terms of the GNU General Public License as published by the Free

Modified: trunk/ecosflash/flash.c
===================================================================
--- trunk/ecosflash/flash.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/ecosflash/flash.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
 #####ECOSGPLCOPYRIGHTBEGIN####
 ## -------------------------------------------
 ## This file is part of eCos, the Embedded Configurable Operating System.
-## Copyright (C) 2008 ?yvind Harboe
+## Copyright (C) 2008 ??yvind Harboe
 ##
 ## eCos is free software; you can redistribute it and/or modify it under
 ## the terms of the GNU General Public License as published by the Free

Modified: trunk/src/ecosboard.c
===================================================================
--- trunk/src/ecosboard.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/ecosboard.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007-2008 by ???yvind Harboe                              *
+ *   Copyright (C) 2007-2008 by ??yvind Harboe                              *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *

Modified: trunk/src/flash/ecos.c
===================================================================
--- trunk/src/flash/ecos.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/flash/ecos.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/flash/flash.c
===================================================================
--- trunk/src/flash/flash.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/flash/flash.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/flash/flash.h
===================================================================
--- trunk/src/flash/flash.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/flash/flash.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/flash/lpc288x.c
===================================================================
--- trunk/src/flash/lpc288x.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/flash/lpc288x.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -214,8 +214,8 @@
 	return ERROR_OK;
 }
 
-/* The frequency is the AHB clock frequency divided by (CLK_DIV ?3) + 1.
- * This must be programmed such that the Flash Programming clock frequency is 66 kHz ? 20%.
+/* The frequency is the AHB clock frequency divided by (CLK_DIV ??3) + 1.
+ * This must be programmed such that the Flash Programming clock frequency is 66 kHz ?? 20%.
  * AHB = 12 MHz ?
  * 12000000/66000 = 182
  * CLK_DIV = 60 ? */

Modified: trunk/src/helper/binarybuffer.c
===================================================================
--- trunk/src/helper/binarybuffer.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/binarybuffer.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2004, 2005 by Dominic Rath                              *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/helper/binarybuffer.h
===================================================================
--- trunk/src/helper/binarybuffer.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/binarybuffer.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2004, 2005 by Dominic Rath                              *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/helper/command.c
===================================================================
--- trunk/src/helper/command.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/command.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008, Duane Ellis                                       *

Modified: trunk/src/helper/command.h
===================================================================
--- trunk/src/helper/command.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/command.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/helper/configuration.c
===================================================================
--- trunk/src/helper/configuration.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/configuration.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2004, 2005 by Dominic Rath                              *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/helper/configuration.h
===================================================================
--- trunk/src/helper/configuration.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/configuration.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2004, 2005 by Dominic Rath                              *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/helper/fileio.c
===================================================================
--- trunk/src/helper/fileio.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/fileio.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2007 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/helper/fileio.h
===================================================================
--- trunk/src/helper/fileio.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/fileio.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2007 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/helper/ioutil.c
===================================================================
--- trunk/src/helper/ioutil.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/ioutil.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007-2008 by ?yvind Harboe                              *
+ *   Copyright (C) 2007-2008 by ??yvind Harboe                              *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *

Modified: trunk/src/helper/jim-eventloop.c
===================================================================
--- trunk/src/helper/jim-eventloop.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/jim-eventloop.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -3,7 +3,7 @@
  * Copyright 2005 Salvatore Sanfilippo <antirez at invece.org>
  * Copyright 2005 Clemens Hintze <c.hintze at gmx.net>
  * Copyright 2005 patthoyts - Pat Thoyts <patthoyts at users.sf.net>
- * Copyright 2008 oharboe - ?yvind Harboe - oyvind.harboe at zylin.com
+ * Copyright 2008 oharboe - ??yvind Harboe - oyvind.harboe at zylin.com
  * Copyright 2008 Andrew Lunn <andrew at lunn.ch>
  * Copyright 2008 Duane Ellis <openocd at duaneellis.com>
  * Copyright 2008 Uwe Klein <uklein at klein-messgeraete.de>

Modified: trunk/src/helper/jim-eventloop.h
===================================================================
--- trunk/src/helper/jim-eventloop.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/jim-eventloop.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -3,7 +3,7 @@
  * Copyright 2005 Salvatore Sanfilippo <antirez at invece.org>
  * Copyright 2005 Clemens Hintze <c.hintze at gmx.net>
  * Copyright 2005 patthoyts - Pat Thoyts <patthoyts at users.sf.net>
- * Copyright 2008 oharboe - ?yvind Harboe - oyvind.harboe at zylin.com
+ * Copyright 2008 oharboe - ??yvind Harboe - oyvind.harboe at zylin.com
  * Copyright 2008 Andrew Lunn <andrew at lunn.ch>
  * Copyright 2008 Duane Ellis <openocd at duaneellis.com>
  * Copyright 2008 Uwe Klein <uklein at klein-messgeraete.de>

Modified: trunk/src/helper/jim.c
===================================================================
--- trunk/src/helper/jim.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/jim.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -3,7 +3,7 @@
  * Copyright 2005 Salvatore Sanfilippo <antirez at invece.org>
  * Copyright 2005 Clemens Hintze <c.hintze at gmx.net>
  * Copyright 2005 patthoyts - Pat Thoyts <patthoyts at users.sf.net>
- * Copyright 2008 oharboe - ?yvind Harboe - oyvind.harboe at zylin.com
+ * Copyright 2008 oharboe - ??yvind Harboe - oyvind.harboe at zylin.com
  * Copyright 2008 Andrew Lunn <andrew at lunn.ch>
  * Copyright 2008 Duane Ellis <openocd at duaneellis.com>
  * Copyright 2008 Uwe Klein <uklein at klein-messgeraete.de>

Modified: trunk/src/helper/jim.h
===================================================================
--- trunk/src/helper/jim.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/jim.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -3,7 +3,7 @@
  * Copyright 2005 Salvatore Sanfilippo <antirez at invece.org>
  * Copyright 2005 Clemens Hintze <c.hintze at gmx.net>
  * Copyright 2005 patthoyts - Pat Thoyts <patthoyts at users.sf.net>
- * Copyright 2008 oharboe - ?yvind Harboe - oyvind.harboe at zylin.com
+ * Copyright 2008 oharboe - ??yvind Harboe - oyvind.harboe at zylin.com
  * Copyright 2008 Andrew Lunn <andrew at lunn.ch>
  * Copyright 2008 Duane Ellis <openocd at duaneellis.com>
  * Copyright 2008 Uwe Klein <uklein at klein-messgeraete.de>

Modified: trunk/src/helper/log.c
===================================================================
--- trunk/src/helper/log.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/log.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/helper/log.h
===================================================================
--- trunk/src/helper/log.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/log.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/helper/options.c
===================================================================
--- trunk/src/helper/options.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/options.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2004, 2005 by Dominic Rath                              *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/helper/replacements.c
===================================================================
--- trunk/src/helper/replacements.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/replacements.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2006 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/helper/replacements.h
===================================================================
--- trunk/src/helper/replacements.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/replacements.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2006 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/helper/time_support.c
===================================================================
--- trunk/src/helper/time_support.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/time_support.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2006 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/helper/time_support.h
===================================================================
--- trunk/src/helper/time_support.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/time_support.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2006 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/helper/types.h
===================================================================
--- trunk/src/helper/types.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/helper/types.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2004, 2005 by Dominic Rath                              *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/bitbang.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
@@ -46,12 +46,12 @@
  * Set this to 1 and str912 reset halt will fail.
  *
  * If someone can submit a patch with an explanation it will be greatly
- * appreciated, but as far as I can tell (?H) DCLK is generated upon
+ * appreciated, but as far as I can tell (??H) DCLK is generated upon
  * clk = 0 in TAP_IDLE. Good luck deducing that from the ARM documentation!
  * The ARM documentation uses the term "DCLK is asserted while in the TAP_IDLE
  * state". With hardware there is no such thing as *while* in a state. There
  * are only edges. So clk => 0 is in fact a very subtle state transition that
- * happens *while* in the TAP_IDLE state. "#&?"#?&"#&"#&
+ * happens *while* in the TAP_IDLE state. "#&??"#??&"#&"#&
  *
  * For "reset halt" the last thing that happens before srst is asserted
  * is that the breakpoint is set up. If DCLK is not wiggled one last

Modified: trunk/src/jtag/bitbang.h
===================================================================
--- trunk/src/jtag/bitbang.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/bitbang.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/jtag/core.c
===================================================================
--- trunk/src/jtag/core.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/core.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2009 SoftPLC Corporation                                *

Modified: trunk/src/jtag/dummy.c
===================================================================
--- trunk/src/jtag/dummy.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/dummy.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2008 by ?yvind Harboe                                   *
+ *   Copyright (C) 2008 by ??yvind Harboe                                   *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/jtag/interface.c
===================================================================
--- trunk/src/jtag/interface.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/interface.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2009 SoftPLC Corporation                                *

Modified: trunk/src/jtag/jtag.h
===================================================================
--- trunk/src/jtag/jtag.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/jtag.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
 *   Copyright (C) 2005 by Dominic Rath                                    *
 *   Dominic.Rath at gmx.de                                                   *
 *                                                                         *
-*   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+*   Copyright (C) 2007,2008 ??yvind Harboe                                 *
 *   oyvind.harboe at zylin.com                                               *
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/jtag/minidummy/jtag_minidriver.h
===================================================================
--- trunk/src/jtag/minidummy/jtag_minidriver.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/minidummy/jtag_minidriver.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007-2008 by ?yvind Harboe                              *
+ *   Copyright (C) 2007-2008 by ??yvind Harboe                              *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *

Modified: trunk/src/jtag/minidummy/minidummy.c
===================================================================
--- trunk/src/jtag/minidummy/minidummy.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/minidummy/minidummy.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007-2008 by ?yvind Harboe                              *
+ *   Copyright (C) 2007-2008 by ??yvind Harboe                              *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *

Modified: trunk/src/jtag/parport.c
===================================================================
--- trunk/src/jtag/parport.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/parport.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -247,7 +247,7 @@
 static int parport_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, "parport_port", parport_handle_parport_port_command,
-		COMMAND_CONFIG, "either the address of the I/O port or the number of the ???/dev/parport??? device");
+		COMMAND_CONFIG, "either the address of the I/O port or the number of the '/dev/parport' device");
 	register_command(cmd_ctx, NULL, "parport_cable", parport_handle_parport_cable_command,
 		COMMAND_CONFIG, "the layout of the parallel port cable used to connect to the target");
 	register_command(cmd_ctx, NULL, "parport_write_on_exit", parport_handle_write_on_exit_command,

Modified: trunk/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/rlink/rlink.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 Rob Brown, Lou Deluxe                              *

Modified: trunk/src/jtag/tcl.c
===================================================================
--- trunk/src/jtag/tcl.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/tcl.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2009 SoftPLC Corporation                                *

Modified: trunk/src/jtag/zy1000/jtag_minidriver.h
===================================================================
--- trunk/src/jtag/zy1000/jtag_minidriver.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/zy1000/jtag_minidriver.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007-2008 by ?yvind Harboe                              *
+ *   Copyright (C) 2007-2008 by ??yvind Harboe                              *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *

Modified: trunk/src/jtag/zy1000/zy1000.c
===================================================================
--- trunk/src/jtag/zy1000/zy1000.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/jtag/zy1000/zy1000.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007-2008 by ???yvind Harboe                              *
+ *   Copyright (C) 2007-2008 by ??yvind Harboe                              *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *

Modified: trunk/src/openocd.c
===================================================================
--- trunk/src/openocd.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/openocd.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 Richard Missenden                                  *

Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/server/gdb_server.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/server/gdb_server.h
===================================================================
--- trunk/src/server/gdb_server.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/server/gdb_server.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/server/httpd.c
===================================================================
--- trunk/src/server/httpd.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/server/httpd.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -1,5 +1,5 @@
 /***************************************************************************
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 Free Software Foundation

Modified: trunk/src/server/server.c
===================================================================
--- trunk/src/server/server.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/server/server.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/server/server.h
===================================================================
--- trunk/src/server/server.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/server/server.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/server/telnet_server.c
===================================================================
--- trunk/src/server/telnet_server.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/server/telnet_server.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/server/telnet_server.h
===================================================================
--- trunk/src/server/telnet_server.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/server/telnet_server.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/arm7_9_common.c
===================================================================
--- trunk/src/target/arm7_9_common.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/arm7_9_common.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/arm7_9_common.h
===================================================================
--- trunk/src/target/arm7_9_common.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/arm7_9_common.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/arm7tdmi.c
===================================================================
--- trunk/src/target/arm7tdmi.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/arm7tdmi.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -5,7 +5,7 @@
  *   Copyright (C) 2008 by Spencer Oliver                                  *
  *   spen at spen-soft.co.uk                                                  *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/target/arm_jtag.c
===================================================================
--- trunk/src/target/arm_jtag.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/arm_jtag.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/target/arm_jtag.h
===================================================================
--- trunk/src/target/arm_jtag.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/arm_jtag.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/target/armv7m.c
===================================================================
--- trunk/src/target/armv7m.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/armv7m.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -8,7 +8,7 @@
  *   Copyright (C) 2008 by Spencer Oliver                                  *
  *   spen at spen-soft.co.uk                                                  *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/target/embeddedice.c
===================================================================
--- trunk/src/target/embeddedice.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/embeddedice.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/embeddedice.h
===================================================================
--- trunk/src/target/embeddedice.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/embeddedice.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005, 2006 by Dominic Rath                              *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/image.c
===================================================================
--- trunk/src/target/image.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/image.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2007 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/image.h
===================================================================
--- trunk/src/target/image.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/image.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2007 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/mips32.c
===================================================================
--- trunk/src/target/mips32.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/mips32.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -4,7 +4,7 @@
  *                                                                         *
  *   Copyright (C) 2008 by David T.L. Wong                                 *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/target/register.c
===================================================================
--- trunk/src/target/register.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/register.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/target/register.h
===================================================================
--- trunk/src/target/register.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/register.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/target/target.c
===================================================================
--- trunk/src/target/target.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/target.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ???yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008, Duane Ellis                                       *

Modified: trunk/src/target/target.h
===================================================================
--- trunk/src/target/target.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/target.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/target_request.c
===================================================================
--- trunk/src/target/target_request.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/target_request.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2007 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/target_request.h
===================================================================
--- trunk/src/target/target_request.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/target_request.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2007 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   Copyright (C) 2008 by Spencer Oliver                                  *

Modified: trunk/src/target/xscale.c
===================================================================
--- trunk/src/target/xscale.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/xscale.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2006, 2007 by Dominic Rath                              *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/target/xscale.h
===================================================================
--- trunk/src/target/xscale.h	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/target/xscale.h	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *   Copyright (C) 2005 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
- *   Copyright (C) 2007,2008 ?yvind Harboe                                 *
+ *   Copyright (C) 2007,2008 ??yvind Harboe                                 *
  *   oyvind.harboe at zylin.com                                               *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *

Modified: trunk/src/xsvf/xsvf.c
===================================================================
--- trunk/src/xsvf/xsvf.c	2009-07-16 10:44:42 UTC (rev 2548)
+++ trunk/src/xsvf/xsvf.c	2009-07-17 19:54:25 UTC (rev 2549)
@@ -2,7 +2,7 @@
  *	 Copyright (C) 2005 by Dominic Rath									   *
  *	 Dominic.Rath at gmx.de													   *
  *																		   *
- *	 Copyright (C) 2007,2008 ?yvind Harboe								   *
+ *	 Copyright (C) 2007,2008 ??yvind Harboe								   *
  *	 oyvind.harboe at zylin.com												   *
  *																		   *
  *	 Copyright (C) 2008 Peter Hettkamp									   *



From oharboe at mail.berlios.de  Sun Jul 19 21:31:54 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 19 Jul 2009 21:31:54 +0200
Subject: [Openocd-svn] r2550 - trunk
Message-ID: <200907191931.n6JJVsh4023904@sheep.berlios.de>

Author: oharboe
Date: 2009-07-19 21:31:54 +0200 (Sun, 19 Jul 2009)
New Revision: 2550

Modified:
   trunk/TODO
Log:
aduc flash problems have been resolved

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2009-07-17 19:54:25 UTC (rev 2549)
+++ trunk/TODO	2009-07-19 19:31:54 UTC (rev 2550)
@@ -149,14 +149,6 @@
 
 @section thelistflash Flash Support
 
-- aduc702x segfault reported by Thomas A Moulton
-
-https://lists.berlios.de/pipermail/openocd-development/2009-July/009186.html
-
-- aduc7024 programming w/working area does not work:
-
-https://lists.berlios.de/pipermail/openocd-development/2009-July/009337.html
-
 - finish documentation for the following flash drivers:
   - avr
   - ecosflash



From ntfreak at mail.berlios.de  Mon Jul 20 09:03:12 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Mon, 20 Jul 2009 09:03:12 +0200
Subject: [Openocd-svn] r2551 - trunk/src/flash
Message-ID: <200907200703.n6K73CIg024822@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-20 09:03:11 +0200 (Mon, 20 Jul 2009)
New Revision: 2551

Modified:
   trunk/src/flash/cfi.c
Log:
- fix issue with reading device id, bug appeared when flash_address code was added
- fix issue when multiple flash chips are connected, eg. x16 x 2 on 32bit mcu bus

Modified: trunk/src/flash/cfi.c
===================================================================
--- trunk/src/flash/cfi.c	2009-07-19 19:31:54 UTC (rev 2550)
+++ trunk/src/flash/cfi.c	2009-07-20 07:03:11 UTC (rev 2551)
@@ -2172,7 +2172,7 @@
 		{
 			return retval;
 		}
-		if ((retval = target_read_u16(target, flash_address(bank, 0, 0x02), &cfi_info->device_id)) != ERROR_OK)
+		if ((retval = target_read_u16(target, flash_address(bank, 0, 0x01), &cfi_info->device_id)) != ERROR_OK)
 		{
 			return retval;
 		}
@@ -2383,9 +2383,10 @@
 				sector++;
 			}
 		}
-		if (offset != cfi_info->dev_size)
+		if (offset != (cfi_info->dev_size * bank->bus_width / bank->chip_width))
 		{
-			LOG_WARNING("CFI size is 0x%" PRIx32 ", but total sector size is 0x%" PRIx32 "", cfi_info->dev_size, offset);
+			LOG_WARNING("CFI size is 0x%" PRIx32 ", but total sector size is 0x%" PRIx32 "", \
+				(cfi_info->dev_size * bank->bus_width / bank->chip_width), offset);
 		}
 	}
 



From ntfreak at mail.berlios.de  Tue Jul 21 22:03:17 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Tue, 21 Jul 2009 22:03:17 +0200
Subject: [Openocd-svn] r2552 - trunk/src/target
Message-ID: <200907212003.n6LK3HFV011509@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-21 22:03:17 +0200 (Tue, 21 Jul 2009)
New Revision: 2552

Modified:
   trunk/src/target/armv7m.c
   trunk/src/target/armv7m.h
   trunk/src/target/cortex_m3.c
   trunk/src/target/cortex_m3.h
Log:
David Brownell <david-b at pacbell.net>:

Revert parts of the previous ARMv7-M register patch.
It turns out that part of the issue is a documentation
problem for the Cortex-M3 r1 parts. So for the rest,
simpler fixes are possible (in followup patch).

Modified: trunk/src/target/armv7m.c
===================================================================
--- trunk/src/target/armv7m.c	2009-07-20 07:03:11 UTC (rev 2551)
+++ trunk/src/target/armv7m.c	2009-07-21 20:03:17 UTC (rev 2552)
@@ -60,8 +60,8 @@
 	"r0", "r1", "r2", "r3", "r4", "r5", "r6", "r7", "r8", "r9", "r10", "r11", "r12",
 	"sp", "lr", "pc",
 	"xPSR", "msp", "psp",
-	/* reg 20 has 4 bytes: CONTROL, FAULTMASK, BASEPRI, PRIMASK */
-	"spec20",
+	/* Registers accessed through special reg 20 */
+	"primask", "basepri", "faultmask", "control"
 };
 
 uint8_t armv7m_gdb_dummy_fp_value[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
@@ -111,11 +111,11 @@
 	{17, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL}, /* MSP */
 	{18, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL}, /* PSP */
 
-	/* FIXME the register numbers here are core-specific.
-	 * Numbers 0..18 above work for all Cortex-M3 revisions.
-	 * Number 20 below works for CM3 r2p0 and later.
-	 */
-	{20, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL},
+	/*  CORE_SP are accesible using coreregister 20 */
+	{19, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}, /* PRIMASK */
+	{20, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}, /* BASEPRI */
+	{21, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}, /* FAULTMASK */
+	{22, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}  /* CONTROL */
 };
 
 int armv7m_core_reg_arch_type = -1;
@@ -387,21 +387,12 @@
 		armv7m_set_core_reg(reg, reg_params[i].value);
 	}
 
-	/* NOTE:  CONTROL is bits 31:24 of SPEC20 register, if it's present;
-	 * holding a two-bit field.
-	 *
-	 * FIXME need a solution using ARMV7M_T_MSR().  Use it at least for
-	 * earlier cores.
-	 */
-	if (armv7m_algorithm_info->core_mode != ARMV7M_MODE_ANY
-			&& armv7m->has_spec20)
+	if (armv7m_algorithm_info->core_mode != ARMV7M_MODE_ANY)
 	{
 		LOG_DEBUG("setting core_mode: 0x%2.2x", armv7m_algorithm_info->core_mode);
-
-		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_SPEC20].value,
-				24, 2, armv7m_algorithm_info->core_mode);
-		armv7m->core_cache->reg_list[ARMV7M_SPEC20].dirty = 1;
-		armv7m->core_cache->reg_list[ARMV7M_SPEC20].valid = 1;
+		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_CONTROL].value, 0, 1, armv7m_algorithm_info->core_mode);
+		armv7m->core_cache->reg_list[ARMV7M_CONTROL].dirty = 1;
+		armv7m->core_cache->reg_list[ARMV7M_CONTROL].valid = 1;
 	}
 
 	/* ARMV7M always runs in Thumb state */

Modified: trunk/src/target/armv7m.h
===================================================================
--- trunk/src/target/armv7m.h	2009-07-20 07:03:11 UTC (rev 2551)
+++ trunk/src/target/armv7m.h	2009-07-21 20:03:17 UTC (rev 2552)
@@ -61,15 +61,10 @@
 	ARMV7M_xPSR = 16,
 	ARMV7M_MSP,
 	ARMV7M_PSP,
-
-	/* FIXME the register numbers here are core-specific.  Cortex-M3
-	 * through r1p1 only defines registers up to PSP; see ARM DDI 0337E.
-	 *
-	 * It's r2p0 (see ARM DDI 0337G) which defines the register that's
-	 * called SPEC20 here, with four single-byte fields with CONTROL
-	 * (highest byte), FAULTMASK, BASEPRI, and PRIMASK (lowest byte).
-	 */
-	ARMV7M_SPEC20 = 20,
+	ARMV7M_PRIMASK,
+	ARMV7M_BASEPRI,
+	ARMV7M_FAULTMASK,
+	ARMV7M_CONTROL,
 	ARMV7NUMCOREREGS
 };
 
@@ -83,7 +78,6 @@
 	int exception_number;
 	swjdp_common_t swjdp_info;
 
-	bool has_spec20;
 
 	/* Direct processor core register read and writes */
 	int (*load_core_reg_u32)(struct target_s *target, enum armv7m_regtype type, uint32_t num, uint32_t *value);

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-07-20 07:03:11 UTC (rev 2551)
+++ trunk/src/target/cortex_m3.c	2009-07-21 20:03:17 UTC (rev 2552)
@@ -395,7 +395,7 @@
 
 	/* Examine target state and mode */
 	/* First load register acessible through core debug port*/
-	for (i = 0; i < ARMV7NUMCOREREGS; i++)
+	for (i = 0; i < ARMV7M_PRIMASK; i++)
 	{
 		if (!armv7m->core_cache->reg_list[i].valid)
 			armv7m->read_core_reg(target, i);
@@ -418,19 +418,22 @@
 		cortex_m3_store_core_reg_u32(target, ARMV7M_REGISTER_CORE_GP, 16, xPSR &~ 0xff);
 	}
 
+	/* Now we can load SP core registers */
+	for (i = ARMV7M_PRIMASK; i < ARMV7NUMCOREREGS; i++)
+	{
+		if (!armv7m->core_cache->reg_list[i].valid)
+			armv7m->read_core_reg(target, i);
+	}
+
 	/* Are we in an exception handler */
 	if (xPSR & 0x1FF)
 	{
 		armv7m->core_mode = ARMV7M_MODE_HANDLER;
 		armv7m->exception_number = (xPSR & 0x1FF);
 	}
-	else if (armv7m->has_spec20)
+	else
 	{
-		/* NOTE:  CONTROL is bits 31:24 of SPEC20 register, holding
-		 * a two-bit field.  Unavailable before r2p0...
-		 */
-		armv7m->core_mode = buf_get_u32(
-			armv7m->core_cache->reg_list[ARMV7M_SPEC20].value, 24, 2);
+		armv7m->core_mode = buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_CONTROL].value, 0, 1);
 		armv7m->exception_number = 0;
 	}
 
@@ -633,26 +636,16 @@
 	if (debug_execution)
 	{
 		/* Disable interrupts */
-		/* We disable interrupts in the PRIMASK register instead
-		 * of masking with C_MASKINTS,
+		/* We disable interrupts in the PRIMASK register instead of masking with C_MASKINTS,
 		 * This is probably the same issue as Cortex-M3 Errata	377493:
-		 * C_MASKINTS in parallel with disabled interrupts can cause
-		 * local faults to not be taken.  (FIXED in r1p0 and later.)
-		 *
-		 * NOTE:  PRIMASK is bits 7:0 of SPEC20 register, holding a
-		 * one bit field.  Available this way for r2p0 and later...
-		 */
-		if (armv7m->has_spec20) {
-			buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_SPEC20]
-					.value, 0, 1, 1);
-			armv7m->core_cache->reg_list[ARMV7M_SPEC20].dirty = 1;
-			armv7m->core_cache->reg_list[ARMV7M_SPEC20].valid = 1;
-		}
+		 * C_MASKINTS in parallel with disabled interrupts can cause local faults to not be taken. */
+		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_PRIMASK].value, 0, 32, 1);
+		armv7m->core_cache->reg_list[ARMV7M_PRIMASK].dirty = 1;
+		armv7m->core_cache->reg_list[ARMV7M_PRIMASK].valid = 1;
 
 		/* Make sure we are in Thumb mode */
 		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_xPSR].value, 0, 32,
-			buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_xPSR].value, 0, 32)
-			| (1 << 24));
+			buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_xPSR].value, 0, 32) | (1 << 24));
 		armv7m->core_cache->reg_list[ARMV7M_xPSR].dirty = 1;
 		armv7m->core_cache->reg_list[ARMV7M_xPSR].valid = 1;
 	}
@@ -1474,14 +1467,8 @@
 		if ((retval = target_read_u32(target, CPUID, &cpuid)) != ERROR_OK)
 			return retval;
 
-		if (((cpuid >> 4) & 0xc3f) == 0xc23) {
+		if (((cpuid >> 4) & 0xc3f) == 0xc23)
 			LOG_DEBUG("CORTEX-M3 processor detected");
-			if (((cpuid >> 20) & 0xf) >= 2) {
-				armv7m->has_spec20 = true;
-				LOG_DEBUG("r2p0 or later detected");
-			}
-		} else
-			LOG_WARNING("not a CORTEX-M3 processor?");
 		LOG_DEBUG("cpuid: 0x%8.8" PRIx32 "", cpuid);
 
 		target_read_u32(target, NVIC_ICTR, &ictr);

Modified: trunk/src/target/cortex_m3.h
===================================================================
--- trunk/src/target/cortex_m3.h	2009-07-20 07:03:11 UTC (rev 2551)
+++ trunk/src/target/cortex_m3.h	2009-07-21 20:03:17 UTC (rev 2552)
@@ -117,21 +117,6 @@
 #define FPCR_REPLACE_BKPT_HIGH  (2 << 30)
 #define FPCR_REPLACE_BKPT_BOTH  (3 << 30)
 
-/* Use MRS/MSR to read/write any of these special registers.  Some of
- * them (xPSR, MSP, PSP) are always available using DCRxR.  Starting in
- * Cortex-M3 r2p0, some (CONTROL, BASEPRI, and *MASK) are also available
- * through DCRxR.
- * NOTE: this listing omits xPSR components and other mixtures.
- */
-#define SR_XPSR		3
-#define SR_MSP		8
-#define SR_PSP		9
-#define SR_PRIMASK	16
-#define SR_BASEPRI	17
-#define SR_BASEPRI_MAX	18
-#define SR_FAULTMASK	19
-#define SR_CONTROL	20
-
 typedef struct  cortex_m3_fp_comparator_s
 {
 	int used;



From ntfreak at mail.berlios.de  Tue Jul 21 22:05:06 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Tue, 21 Jul 2009 22:05:06 +0200
Subject: [Openocd-svn] r2553 - trunk/src/target
Message-ID: <200907212005.n6LK56k1011728@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-21 22:05:05 +0200 (Tue, 21 Jul 2009)
New Revision: 2553

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>:

Minor updates to the Thumb2 disassembly:

 - Bugfixes:
    * Distinguish branch from misc via "!=" not "=="
    * MRS register shift is 8 bits (vs MSR being 16)
 - Format tweaks:
    * CPS needed tab (not space)
    * add commma before some shifts
    * add space after comma in LDM/STM
    * use ".W" width spec on various instructions

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-21 20:03:17 UTC (rev 2552)
+++ trunk/src/target/arm_disassembler.c	2009-07-21 20:05:05 UTC (rev 2553)
@@ -2080,7 +2080,7 @@
 				(opcode & 0x80) ? "BE" : "LE");
 	else /* ASSUME (opcode & 0x0fe0) == 0x0660 */
 		snprintf(instruction->text, 128,
-				"0x%8.8" PRIx32 "  0x%4.4x    \tCPSI%c %s%s%s",
+				"0x%8.8" PRIx32 "  0x%4.4x    \tCPSI%c\t%s%s%s",
 				address, opcode,
 				(opcode & 0x0010) ? 'D' : 'E',
 				(opcode & 0x0004) ? "A" : "",
@@ -2522,7 +2522,7 @@
 	case 0x4:
 		goto undef;
 	case 0:
-		if (((opcode >> 23) & 0x07) == 0x07)
+		if (((opcode >> 23) & 0x07) != 0x07)
 			return t2ev_cond_b(opcode, address, instruction, cp);
 		if (opcode & (1 << 26))
 			goto undef;
@@ -2541,7 +2541,7 @@
 		return t2ev_misc(opcode, address, instruction, cp);
 	case 0x3e:
 	case 0x3f:
-		sprintf(cp, "MRS\tr%d, %s", (opcode >> 16) & 0x0f,
+		sprintf(cp, "MRS\tr%d, %s", (opcode >> 8) & 0x0f,
 				special_name(opcode & 0xff));
 		return ERROR_OK;
 	}
@@ -2560,6 +2560,7 @@
 	unsigned func;
 	bool one = false;
 	char *suffix = "";
+	char *suffix2 = "";
 
 	/* ARMv7-M: A5.3.2 Modified immediate constants */
 	func = (opcode >> 11) & 0x0e;
@@ -2597,6 +2598,7 @@
 			mnemonic = "TST";
 			one = true;
 			suffix = "";
+			suffix2 = ".W";
 			rd = rn;
 		} else {
 			instruction->type = ARM_AND;
@@ -2612,6 +2614,7 @@
 			instruction->type = ARM_MOV;
 			mnemonic = "MOV";
 			one = true;
+			suffix2 = ".W";
 		} else {
 			instruction->type = ARM_ORR;
 			mnemonic = "ORR";
@@ -2649,6 +2652,7 @@
 		} else {
 			instruction->type = ARM_ADD;
 			mnemonic = "ADD";
+			suffix2 = ".W";
 		}
 		break;
 	case 10:
@@ -2670,21 +2674,24 @@
 			instruction->type = ARM_SUB;
 			mnemonic = "SUB";
 		}
+		suffix2 = ".W";
 		break;
 	case 14:
 		instruction->type = ARM_RSB;
 		mnemonic = "RSB";
+		suffix2 = ".W";
 		break;
 	default:
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
 	if (one)
-		sprintf(cp, "%s\tr%d, #%d\t; %#8.8x",
-				mnemonic, rd, immed, immed);
+		sprintf(cp, "%s%s\tr%d, #%d\t; %#8.8x",
+				mnemonic, suffix2 ,rd, immed, immed);
 	else
-		sprintf(cp, "%s%s\tr%d, r%d, #%d\t; %#8.8x",
-				mnemonic, suffix, rd, rn, immed, immed);
+		sprintf(cp, "%s%s%s\tr%d, r%d, #%d\t; %#8.8x",
+				mnemonic, suffix, suffix2,
+				rd, rn, immed, immed);
 
 	return ERROR_OK;
 }
@@ -2959,13 +2966,13 @@
 		if (rn == 13 && t)
 			sprintf(cp, "POP\t");
 		else
-			sprintf(cp, "LDM\tr%d%s, ", rn, t ? "!" : "");
+			sprintf(cp, "LDM.W\tr%d%s, ", rn, t ? "!" : "");
 		break;
 	case 4:
 		if (rn == 13 && t)
 			sprintf(cp, "PUSH\t");
 		else
-			sprintf(cp, "STM\tr%d%s, ", rn, t ? "!" : "");
+			sprintf(cp, "STM.W\tr%d%s, ", rn, t ? "!" : "");
 		break;
 	case 5:
 		sprintf(cp, "LDMB\tr%d%s, ", rn, t ? "!" : "");
@@ -2980,7 +2987,7 @@
 		if ((registers & 1) == 0)
 			continue;
 		registers &= ~1;
-		sprintf(cp, "r%d%s", t, registers ? "," : "");
+		sprintf(cp, "r%d%s", t, registers ? ", " : "");
 		cp = strchr(cp, 0);
 	}
 	*cp++ = '}';
@@ -3139,7 +3146,7 @@
 		suffix = "ROR";
 		break;
 	}
-	sprintf(cp, " %s #%d", suffix, immed ? immed : 32);
+	sprintf(cp, ", %s #%d", suffix, immed ? immed : 32);
 	return ERROR_OK;
 
 two:



From ntfreak at mail.berlios.de  Tue Jul 21 22:15:12 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Tue, 21 Jul 2009 22:15:12 +0200
Subject: [Openocd-svn] r2554 - trunk/src/target
Message-ID: <200907212015.n6LKFCpu012552@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-21 22:15:11 +0200 (Tue, 21 Jul 2009)
New Revision: 2554

Modified:
   trunk/src/target/armv7m.c
   trunk/src/target/armv7m.h
   trunk/src/target/cortex_m3.c
Log:
David Brownell <david-b at pacbell.net>:

Clean up treatment of registers in ARMv7-M and Cortex-M3. 

 - At the arch level:
    * Just list registers and names; don't impose core-specific
      policy about how they are accessed.
    * Each register has a symbol.
    * Remove the register mode field (irrelevant to debugger)

 - At the core/implementation level:
    * Just map the registers to their relevant access methods;
      don't require the arch level to say how that should work
      (cores other than Cortex-M3 could do it differently).
    * Don't use undefined bits from register 20.
    * Use register IDs that are part of the ARMv7-M interface.

In short, there's now a real distinction between the arch
and core layers.

Modified: trunk/src/target/armv7m.c
===================================================================
--- trunk/src/target/armv7m.c	2009-07-21 20:05:05 UTC (rev 2553)
+++ trunk/src/target/armv7m.c	2009-07-21 20:15:11 UTC (rev 2554)
@@ -36,7 +36,9 @@
 
 #include "armv7m.h"
 
+#define ARRAY_SIZE(x)	((int)(sizeof(x)/sizeof((x)[0])))
 
+
 #if 0
 #define _DEBUG_INSTRUCTION_EXECUTION_
 #endif
@@ -46,7 +48,7 @@
 	"Thread", "Thread (User)", "Handler",
 };
 
-char* armv7m_exception_strings[] =
+static char *armv7m_exception_strings[] =
 {
 	"", "Reset", "NMI", "HardFault",
 	"MemManage", "BusFault", "UsageFault", "RESERVED",
@@ -54,16 +56,6 @@
 	"DebugMonitor", "RESERVED", "PendSV", "SysTick"
 };
 
-char* armv7m_core_reg_list[] =
-{
-	/* Registers accessed through core debug */
-	"r0", "r1", "r2", "r3", "r4", "r5", "r6", "r7", "r8", "r9", "r10", "r11", "r12",
-	"sp", "lr", "pc",
-	"xPSR", "msp", "psp",
-	/* Registers accessed through special reg 20 */
-	"primask", "basepri", "faultmask", "control"
-};
-
 uint8_t armv7m_gdb_dummy_fp_value[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
 
 reg_t armv7m_gdb_dummy_fp_reg =
@@ -87,37 +79,47 @@
 };
 #endif
 
-armv7m_core_reg_t armv7m_core_reg_list_arch_info[] =
-{
-	/*  CORE_GP are accesible using the core debug registers */
-	{0, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{1, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{2, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{3, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{4, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{5, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{6, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{7, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{8, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{9, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{10, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{11, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{12, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{13, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{14, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
-	{15, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL},
+/*
+ * These registers are not memory-mapped.  The ARMv7-M profile includes
+ * memory mapped registers too, such as for the NVIC (interrupt controller)
+ * and SysTick (timer) modules; those can mostly be treated as peripherals.
+ */
+static const struct {
+	unsigned id;
+	char *name;
+} armv7m_regs[] = {
+	{ ARMV7M_R0, "r0" },
+	{ ARMV7M_R1, "r1" },
+	{ ARMV7M_R2, "r2" },
+	{ ARMV7M_R3, "r3" },
 
-	{16, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL}, /* xPSR */
-	{17, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL}, /* MSP */
-	{18, ARMV7M_REGISTER_CORE_GP, ARMV7M_MODE_ANY, NULL, NULL}, /* PSP */
+	{ ARMV7M_R4, "r4" },
+	{ ARMV7M_R5, "r5" },
+	{ ARMV7M_R6, "r6" },
+	{ ARMV7M_R7, "r7" },
 
-	/*  CORE_SP are accesible using coreregister 20 */
-	{19, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}, /* PRIMASK */
-	{20, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}, /* BASEPRI */
-	{21, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}, /* FAULTMASK */
-	{22, ARMV7M_REGISTER_CORE_SP, ARMV7M_MODE_ANY, NULL, NULL}  /* CONTROL */
+	{ ARMV7M_R8, "r8" },
+	{ ARMV7M_R9, "r9" },
+	{ ARMV7M_R10, "r10" },
+	{ ARMV7M_R11, "r11" },
+
+	{ ARMV7M_R12, "r12" },
+	{ ARMV7M_R13, "sp" },
+	{ ARMV7M_R14, "lr" },
+	{ ARMV7M_PC, "pc" },
+
+	{ ARMV7M_xPSR, "xPSR" },
+	{ ARMV7M_MSP, "msp" },
+	{ ARMV7M_PSP, "psp" },
+
+	{ ARMV7M_PRIMASK, "primask" },
+	{ ARMV7M_BASEPRI, "basepri" },
+	{ ARMV7M_FAULTMASK, "faultmask" },
+	{ ARMV7M_CONTROL, "control" },
 };
 
+#define ARMV7M_NUM_REGS	ARRAY_SIZE(armv7m_regs)
+
 int armv7m_core_reg_arch_type = -1;
 int armv7m_dummy_core_reg_arch_type = -1;
 
@@ -133,7 +135,7 @@
 	if (armv7m->pre_restore_context)
 		armv7m->pre_restore_context(target);
 
-	for (i = ARMV7NUMCOREREGS-1; i >= 0; i--)
+	for (i = ARMV7M_NUM_REGS - 1; i >= 0; i--)
 	{
 		if (armv7m->core_cache->reg_list[i].dirty)
 		{
@@ -204,7 +206,7 @@
 	/* get pointers to arch-specific information */
 	armv7m_common_t *armv7m = target->arch_info;
 
-	if ((num < 0) || (num >= ARMV7NUMCOREREGS))
+	if ((num < 0) || (num >= ARMV7M_NUM_REGS))
 		return ERROR_INVALID_ARGUMENTS;
 
 	armv7m_core_reg = armv7m->core_cache->reg_list[num].arch_info;
@@ -225,7 +227,7 @@
 	/* get pointers to arch-specific information */
 	armv7m_common_t *armv7m = target->arch_info;
 
-	if ((num < 0) || (num >= ARMV7NUMCOREREGS))
+	if ((num < 0) || (num >= ARMV7M_NUM_REGS))
 		return ERROR_INVALID_ARGUMENTS;
 
 	reg_value = buf_get_u32(armv7m->core_cache->reg_list[num].value, 0, 32);
@@ -268,6 +270,13 @@
 	*reg_list_size = 26;
 	*reg_list = malloc(sizeof(reg_t*) * (*reg_list_size));
 
+	/*
+	 * GDB register packet format for ARM:
+	 *  - the first 16 registers are r0..r15
+	 *  - (obsolete) 8 FPA registers
+	 *  - (obsolete) FPA status
+	 *  - CPSR
+	 */
 	for (i = 0; i < 16; i++)
 	{
 		(*reg_list)[i] = &armv7m->core_cache->reg_list[i];
@@ -337,7 +346,7 @@
 	enum armv7m_mode core_mode = armv7m->core_mode;
 	int retval = ERROR_OK;
 	int i;
-	uint32_t context[ARMV7NUMCOREREGS];
+	uint32_t context[ARMV7M_NUM_REGS];
 
 	if (armv7m_algorithm_info->common_magic != ARMV7M_COMMON_MAGIC)
 	{
@@ -353,7 +362,7 @@
 
 	/* refresh core register cache */
 	/* Not needed if core register cache is always consistent with target process state */
-	for (i = 0; i < ARMV7NUMCOREREGS; i++)
+	for (i = 0; i < ARMV7M_NUM_REGS; i++)
 	{
 		if (!armv7m->core_cache->reg_list[i].valid)
 			armv7m->read_core_reg(target, i);
@@ -390,7 +399,8 @@
 	if (armv7m_algorithm_info->core_mode != ARMV7M_MODE_ANY)
 	{
 		LOG_DEBUG("setting core_mode: 0x%2.2x", armv7m_algorithm_info->core_mode);
-		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_CONTROL].value, 0, 1, armv7m_algorithm_info->core_mode);
+		buf_set_u32(armv7m->core_cache->reg_list[ARMV7M_CONTROL].value,
+				0, 1, armv7m_algorithm_info->core_mode);
 		armv7m->core_cache->reg_list[ARMV7M_CONTROL].dirty = 1;
 		armv7m->core_cache->reg_list[ARMV7M_CONTROL].valid = 1;
 	}
@@ -444,14 +454,16 @@
 		}
 	}
 
-	for (i = ARMV7NUMCOREREGS-1; i >= 0; i--)
+	for (i = ARMV7M_NUM_REGS; i >= 0; i--)
 	{
 		uint32_t regvalue;
 		regvalue = buf_get_u32(armv7m->core_cache->reg_list[i].value, 0, 32);
 		if (regvalue != context[i])
 		{
-			LOG_DEBUG("restoring register %s with value 0x%8.8" PRIx32 "", armv7m->core_cache->reg_list[i].name, context[i]);
-			buf_set_u32(armv7m->core_cache->reg_list[i].value, 0, 32, context[i]);
+			LOG_DEBUG("restoring register %s with value 0x%8.8" PRIx32,
+				armv7m->core_cache->reg_list[i].name, context[i]);
+			buf_set_u32(armv7m->core_cache->reg_list[i].value,
+					0, 32, context[i]);
 			armv7m->core_cache->reg_list[i].valid = 1;
 			armv7m->core_cache->reg_list[i].dirty = 1;
 		}
@@ -467,12 +479,13 @@
 	/* get pointers to arch-specific information */
 	armv7m_common_t *armv7m = target->arch_info;
 
-	LOG_USER("target halted due to %s, current mode: %s %s\nxPSR: 0x%8.8" PRIx32 " pc: 0x%8.8" PRIx32 "",
+	LOG_USER("target halted due to %s, current mode: %s %s\n"
+		"xPSR: 0x%8.8" PRIx32 " pc: 0x%8.8" PRIx32,
 		 Jim_Nvp_value2name_simple(nvp_target_debug_reason,target->debug_reason)->name,
 		armv7m_mode_strings[armv7m->core_mode],
 		armv7m_exception_string(armv7m->exception_number),
 		buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_xPSR].value, 0, 32),
-		buf_get_u32(armv7m->core_cache->reg_list[15].value, 0, 32));
+		buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_PC].value, 0, 32));
 
 	return ERROR_OK;
 }
@@ -482,11 +495,11 @@
 	/* get pointers to arch-specific information */
 	armv7m_common_t *armv7m = target->arch_info;
 
-	int num_regs = ARMV7NUMCOREREGS;
+	int num_regs = ARMV7M_NUM_REGS;
 	reg_cache_t **cache_p = register_get_last_cache_p(&target->reg_cache);
 	reg_cache_t *cache = malloc(sizeof(reg_cache_t));
-	reg_t *reg_list = malloc(sizeof(reg_t) * num_regs);
-	armv7m_core_reg_t *arch_info = malloc(sizeof(armv7m_core_reg_t) * num_regs);
+	reg_t *reg_list = calloc(num_regs, sizeof(reg_t));
+	armv7m_core_reg_t *arch_info = calloc(num_regs, sizeof(armv7m_core_reg_t));
 	int i;
 
 	if (armv7m_core_reg_arch_type == -1)
@@ -510,10 +523,10 @@
 
 	for (i = 0; i < num_regs; i++)
 	{
-		arch_info[i] = armv7m_core_reg_list_arch_info[i];
+		arch_info[i].num = armv7m_regs[i].id;
 		arch_info[i].target = target;
 		arch_info[i].armv7m_common = armv7m;
-		reg_list[i].name = armv7m_core_reg_list[i];
+		reg_list[i].name = armv7m_regs[i].name;
 		reg_list[i].size = 32;
 		reg_list[i].value = calloc(1, 4);
 		reg_list[i].dirty = 0;

Modified: trunk/src/target/armv7m.h
===================================================================
--- trunk/src/target/armv7m.h	2009-07-21 20:05:05 UTC (rev 2553)
+++ trunk/src/target/armv7m.h	2009-07-21 20:15:11 UTC (rev 2554)
@@ -50,22 +50,43 @@
 	ARMV7M_REGISTER_MEMMAP
 };
 
-extern char* armv7m_exception_strings[];
-
 extern char *armv7m_exception_string(int number);
 
 /* offsets into armv7m core register cache */
 enum
 {
+	/* for convenience, the first set of indices match
+	 * the Cortex-M3 DCRSR selectors
+	 */
+	ARMV7M_R0,
+	ARMV7M_R1,
+	ARMV7M_R2,
+	ARMV7M_R3,
+
+	ARMV7M_R4,
+	ARMV7M_R5,
+	ARMV7M_R6,
+	ARMV7M_R7,
+
+	ARMV7M_R8,
+	ARMV7M_R9,
+	ARMV7M_R10,
+	ARMV7M_R11,
+
+	ARMV7M_R12,
+	ARMV7M_R13,
+	ARMV7M_R14,
 	ARMV7M_PC = 15,
+
 	ARMV7M_xPSR = 16,
 	ARMV7M_MSP,
 	ARMV7M_PSP,
+
+	/* this next set of indices is arbitrary */
 	ARMV7M_PRIMASK,
 	ARMV7M_BASEPRI,
 	ARMV7M_FAULTMASK,
 	ARMV7M_CONTROL,
-	ARMV7NUMCOREREGS
 };
 
 #define ARMV7M_COMMON_MAGIC 0x2A452A45
@@ -107,7 +128,6 @@
 {
 	uint32_t num;
 	enum armv7m_regtype type;
-	enum armv7m_mode mode;
 	target_t *target;
 	armv7m_common_t *armv7m_common;
 } armv7m_core_reg_t;

Modified: trunk/src/target/cortex_m3.c
===================================================================
--- trunk/src/target/cortex_m3.c	2009-07-21 20:05:05 UTC (rev 2553)
+++ trunk/src/target/cortex_m3.c	2009-07-21 20:15:11 UTC (rev 2554)
@@ -395,7 +395,9 @@
 
 	/* Examine target state and mode */
 	/* First load register acessible through core debug port*/
-	for (i = 0; i < ARMV7M_PRIMASK; i++)
+	int num_regs = armv7m->core_cache->num_regs;
+
+	for (i = 0; i < num_regs; i++)
 	{
 		if (!armv7m->core_cache->reg_list[i].valid)
 			armv7m->read_core_reg(target, i);
@@ -418,13 +420,6 @@
 		cortex_m3_store_core_reg_u32(target, ARMV7M_REGISTER_CORE_GP, 16, xPSR &~ 0xff);
 	}
 
-	/* Now we can load SP core registers */
-	for (i = ARMV7M_PRIMASK; i < ARMV7NUMCOREREGS; i++)
-	{
-		if (!armv7m->core_cache->reg_list[i].valid)
-			armv7m->read_core_reg(target, i);
-	}
-
 	/* Are we in an exception handler */
 	if (xPSR & 0x1FF)
 	{
@@ -1253,8 +1248,12 @@
 	armv7m_common_t *armv7m = target->arch_info;
 	swjdp_common_t *swjdp = &armv7m->swjdp_info;
 
-	if ((type == ARMV7M_REGISTER_CORE_GP) && (num <= ARMV7M_PSP))
-	{
+	/* NOTE:  we "know" here that the register identifiers used
+	 * in the v7m header match the Cortex-M3 Debug Core Register
+	 * Selector values for R0..R15, xPSR, MSP, and PSP.
+	 */
+	switch (num) {
+	case 0 ... 18:
 		/* read a normal core register */
 		retval = cortexm3_dap_read_coreregister_u32(swjdp, value, num);
 
@@ -1264,35 +1263,41 @@
 			return ERROR_JTAG_DEVICE_ERROR;
 		}
 		LOG_DEBUG("load from core reg %i  value 0x%" PRIx32 "",(int)num,*value);
-	}
-	else if (type == ARMV7M_REGISTER_CORE_SP) /* Special purpose core register */
-	{
-		/* read other registers */
+		break;
+
+	case ARMV7M_PRIMASK:
+	case ARMV7M_BASEPRI:
+	case ARMV7M_FAULTMASK:
+	case ARMV7M_CONTROL:
+		/* Cortex-M3 packages these four registers as bitfields
+		 * in one Debug Core register.  So say r0 and r2 docs;
+		 * it was removed from r1 docs, but still works.
+		 */
 		cortexm3_dap_read_coreregister_u32(swjdp, value, 20);
 
 		switch (num)
 		{
-			case 19:
-				*value = buf_get_u32((uint8_t*)value, 0, 8);
+			case ARMV7M_PRIMASK:
+				*value = buf_get_u32((uint8_t*)value, 0, 1);
 				break;
 
-			case 20:
+			case ARMV7M_BASEPRI:
 				*value = buf_get_u32((uint8_t*)value, 8, 8);
 				break;
 
-			case 21:
-				*value = buf_get_u32((uint8_t*)value, 16, 8);
+			case ARMV7M_FAULTMASK:
+				*value = buf_get_u32((uint8_t*)value, 16, 1);
 				break;
 
-			case 22:
-				*value = buf_get_u32((uint8_t*)value, 24, 8);
+			case ARMV7M_CONTROL:
+				*value = buf_get_u32((uint8_t*)value, 24, 2);
 				break;
 		}
 
 		LOG_DEBUG("load from special reg %i value 0x%" PRIx32 "", (int)num, *value);
-	}
-	else
-	{
+		break;
+
+	default:
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1313,14 +1318,19 @@
 	 * in "thumb" mode, or an INVSTATE exception will occur. This is a
 	 * hack to deal with the fact that gdb will sometimes "forge"
 	 * return addresses, and doesn't set the LSB correctly (i.e., when
-	 * printing expressions containing function calls, it sets LR = 0.) */
-
-	if (num == 14)
+	 * printing expressions containing function calls, it sets LR = 0.)
+	 * Valid exception return codes have bit 0 set too.
+	 */
+	if (num == ARMV7M_R14)
 		value |= 0x01;
 #endif
 
-	if ((type == ARMV7M_REGISTER_CORE_GP) && (num <= ARMV7M_PSP))
-	{
+	/* NOTE:  we "know" here that the register identifiers used
+	 * in the v7m header match the Cortex-M3 Debug Core Register
+	 * Selector values for R0..R15, xPSR, MSP, and PSP.
+	 */
+	switch (num) {
+	case 0 ... 18:
 		retval = cortexm3_dap_write_coreregister_u32(swjdp, value, num);
 		if (retval != ERROR_OK)
 		{
@@ -1329,38 +1339,43 @@
 			return ERROR_JTAG_DEVICE_ERROR;
 		}
 		LOG_DEBUG("write core reg %i value 0x%" PRIx32 "", (int)num, value);
-	}
-	else if (type == ARMV7M_REGISTER_CORE_SP) /* Special purpose core register */
-	{
-		/* write other registers */
+		break;
 
+	case ARMV7M_PRIMASK:
+	case ARMV7M_BASEPRI:
+	case ARMV7M_FAULTMASK:
+	case ARMV7M_CONTROL:
+		/* Cortex-M3 packages these four registers as bitfields
+		 * in one Debug Core register.  So say r0 and r2 docs;
+		 * it was removed from r1 docs, but still works.
+		 */
 		cortexm3_dap_read_coreregister_u32(swjdp, &reg, 20);
 
 		switch (num)
 		{
-			case 19:
-				buf_set_u32((uint8_t*)&reg, 0, 8, value);
+			case ARMV7M_PRIMASK:
+				buf_set_u32((uint8_t*)&reg, 0, 1, value);
 				break;
 
-			case 20:
+			case ARMV7M_BASEPRI:
 				buf_set_u32((uint8_t*)&reg, 8, 8, value);
 				break;
 
-			case 21:
-				buf_set_u32((uint8_t*)&reg, 16, 8, value);
+			case ARMV7M_FAULTMASK:
+				buf_set_u32((uint8_t*)&reg, 16, 1, value);
 				break;
 
-			case 22:
-				buf_set_u32((uint8_t*)&reg, 24, 8, value);
+			case ARMV7M_CONTROL:
+				buf_set_u32((uint8_t*)&reg, 24, 2, value);
 				break;
 		}
 
 		cortexm3_dap_write_coreregister_u32(swjdp, reg, 20);
 
 		LOG_DEBUG("write special reg %i value 0x%" PRIx32 " ", (int)num, value);
-	}
-	else
-	{
+		break;
+
+	default:
 		return ERROR_INVALID_ARGUMENTS;
 	}
 



From ntfreak at mail.berlios.de  Tue Jul 21 22:19:03 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Tue, 21 Jul 2009 22:19:03 +0200
Subject: [Openocd-svn] r2555 - trunk/src/target
Message-ID: <200907212019.n6LKJ3J7012747@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-21 22:19:02 +0200 (Tue, 21 Jul 2009)
New Revision: 2555

Modified:
   trunk/src/target/armv7m.c
Log:
David Brownell <david-b at pacbell.net>:

Dump SP on poll, and show whether it's MSP or PSP.

Thread mode can use either stack pointer, so this is
part of the state that's not yet displayed.

Shrink some lines.

Modified: trunk/src/target/armv7m.c
===================================================================
--- trunk/src/target/armv7m.c	2009-07-21 20:15:11 UTC (rev 2554)
+++ trunk/src/target/armv7m.c	2009-07-21 20:19:02 UTC (rev 2555)
@@ -478,14 +478,21 @@
 {
 	/* get pointers to arch-specific information */
 	armv7m_common_t *armv7m = target->arch_info;
+	uint32_t ctrl, sp;
 
+	ctrl = buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_CONTROL].value, 0, 32);
+	sp = buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_R13].value, 0, 32);
+
 	LOG_USER("target halted due to %s, current mode: %s %s\n"
-		"xPSR: 0x%8.8" PRIx32 " pc: 0x%8.8" PRIx32,
-		 Jim_Nvp_value2name_simple(nvp_target_debug_reason,target->debug_reason)->name,
+		"xPSR: %#8.8" PRIx32 " pc: %#8.8" PRIx32 " %csp: %#8.8" PRIx32,
+		Jim_Nvp_value2name_simple(nvp_target_debug_reason,
+				target->debug_reason)->name,
 		armv7m_mode_strings[armv7m->core_mode],
 		armv7m_exception_string(armv7m->exception_number),
 		buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_xPSR].value, 0, 32),
-		buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_PC].value, 0, 32));
+		buf_get_u32(armv7m->core_cache->reg_list[ARMV7M_PC].value, 0, 32),
+		(ctrl & 0x02) ? 'p' : 'm',
+		sp);
 
 	return ERROR_OK;
 }



From oharboe at mail.berlios.de  Wed Jul 22 16:25:57 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 22 Jul 2009 16:25:57 +0200
Subject: [Openocd-svn] r2556 - trunk/tcl/target
Message-ID: <200907221425.n6MEPvNc023567@sheep.berlios.de>

Author: oharboe
Date: 2009-07-22 16:25:56 +0200 (Wed, 22 Jul 2009)
New Revision: 2556

Added:
   trunk/tcl/target/samsung_s3c2450.cfg
Log:
Stefano Voulaz <s.voulaz at projecktstudio.com> first cut samsung_s3c2450 

Added: trunk/tcl/target/samsung_s3c2450.cfg
===================================================================
--- trunk/tcl/target/samsung_s3c2450.cfg	2009-07-21 20:19:02 UTC (rev 2555)
+++ trunk/tcl/target/samsung_s3c2450.cfg	2009-07-22 14:25:56 UTC (rev 2556)
@@ -0,0 +1,49 @@
+# Target configuration for the Samsung 2450 system on chip
+# Processor       : ARM926ejs (wb) rev 0 (v4l)
+# Info:   JTAG tap: s3c2450.cpu tap/device found: 0x07926F0F
+
+
+# FIX!!! what to use here?
+# 
+# RCLK?
+# 
+# jtag_khz 0
+#
+# Really low clock during reset?
+#
+# jtag_khz 1
+
+if { [info exists CHIPNAME] } {
+  set  _CHIPNAME $CHIPNAME
+} else {
+  set  _CHIPNAME s3c2450
+}
+
+if { [info exists ENDIAN] } {
+  set  _ENDIAN $ENDIAN
+} else {
+ # this defaults to a bigendian
+  set  _ENDIAN little
+}
+
+if { [info exists CPUTAPID ] } {
+  set _CPUTAPID $CPUTAPID
+} else {
+ # force an error till we get a good number
+  set _CPUTAPID 0x07926f0f
+}
+
+#jtag scan chain
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0xE -irmask 0x0f -expected-id $_CPUTAPID
+
+set _TARGETNAME [format "%s.cpu" $_CHIPNAME]
+target create $_TARGETNAME arm926ejs -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm926ejs
+
+# FIX!!!!! should this really use srst_pulls_trst?
+# With srst_pulls_trst "reset halt" will not reset into the
+# halted mode, but rather "reset run" and then halt the target.
+#
+# However, without "srst_pulls_trst", then "reset halt" produces weird
+# errors:
+# WARNING: unknown debug reason: 0x0
+reset_config trst_and_srst
\ No newline at end of file


Property changes on: trunk/tcl/target/samsung_s3c2450.cfg
___________________________________________________________________
Name: svn:eol-style
   + native



From oharboe at mail.berlios.de  Wed Jul 22 21:35:23 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Wed, 22 Jul 2009 21:35:23 +0200
Subject: [Openocd-svn] r2557 - trunk/tcl/board
Message-ID: <200907221935.n6MJZNV8009023@sheep.berlios.de>

Author: oharboe
Date: 2009-07-22 21:35:23 +0200 (Wed, 22 Jul 2009)
New Revision: 2557

Modified:
   trunk/tcl/board/crossbow_tech_imote2.cfg
Log:
Jonathan Cameron <jic23 at cam.ac.uk> fix regression from 1836 when the reset_config command was removed from pxa270.cfg

Modified: trunk/tcl/board/crossbow_tech_imote2.cfg
===================================================================
--- trunk/tcl/board/crossbow_tech_imote2.cfg	2009-07-22 14:25:56 UTC (rev 2556)
+++ trunk/tcl/board/crossbow_tech_imote2.cfg	2009-07-22 19:35:23 UTC (rev 2557)
@@ -6,5 +6,7 @@
 # longer-than-normal reset delay
 jtag_nsrst_delay 800 
 
+reset_config trst_and_srst separate
+
 # works for P30 flash
 flash bank cfi 0x00000000 0x2000000 2 2 $_TARGETNAME



From oharboe at mail.berlios.de  Thu Jul 23 09:02:45 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 23 Jul 2009 09:02:45 +0200
Subject: [Openocd-svn] r2558 - trunk/src/target
Message-ID: <200907230702.n6N72j1S006692@sheep.berlios.de>

Author: oharboe
Date: 2009-07-23 09:02:43 +0200 (Thu, 23 Jul 2009)
New Revision: 2558

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net> fix warnings

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-22 19:35:23 UTC (rev 2557)
+++ trunk/src/target/arm_disassembler.c	2009-07-23 07:02:43 UTC (rev 2558)
@@ -1710,7 +1710,7 @@
 
 	snprintf(instruction->text, 128,
 		"0x%8.8" PRIx32 "  0x%4.4x    \t"
-		"LDR\tr%i, [pc, #%#" PRIx32 "]\t; %#8.8x",
+		"LDR\tr%i, [pc, #%#" PRIx32 "]\t; %#8.8" PRIx32,
 		address, opcode, Rd, immediate,
 		thumb_alignpc4(address) + immediate);
 
@@ -2452,7 +2452,7 @@
 	}
 
 	if (opcode & 0x00f0) {
-		sprintf(cp, "DBG\t#%d", opcode & 0xf);
+		sprintf(cp, "DBG\t#%d", (int) opcode & 0xf);
 		return ERROR_OK;
 	}
 
@@ -2533,7 +2533,7 @@
 	case 0x38:
 	case 0x39:
 		sprintf(cp, "MSR\t%s, r%d", special_name(opcode & 0xff),
-				(opcode >> 16) & 0x0f);
+				(int) (opcode >> 16) & 0x0f);
 		return ERROR_OK;
 	case 0x3a:
 		return t2ev_hint(opcode, address, instruction, cp);
@@ -2541,7 +2541,7 @@
 		return t2ev_misc(opcode, address, instruction, cp);
 	case 0x3e:
 	case 0x3f:
-		sprintf(cp, "MRS\tr%d, %s", (opcode >> 8) & 0x0f,
+		sprintf(cp, "MRS\tr%d, %s", (int) (opcode >> 8) & 0x0f,
 				special_name(opcode & 0xff));
 		return ERROR_OK;
 	}
@@ -2741,7 +2741,7 @@
 		immed |= (opcode >> 10) & 0x1c;
 		sprintf(cp, "%sSAT\tr%d, #%d, r%d, %s #%d\t",
 				is_signed ? "S" : "U",
-				rd, (opcode & 0x1f) + 1, rn,
+				rd, (int) (opcode & 0x1f) + 1, rn,
 				(opcode & (1 << 21)) ? "ASR" : "LSL",
 				immed ? immed : 32);
 		return ERROR_OK;
@@ -2755,7 +2755,7 @@
 		sprintf(cp, "%sBFX\tr%d, r%d, #%d, #%d\t",
 				is_signed ? "S" : "U",
 				rd, rn, immed,
-				(opcode & 0x1f) + 1);
+				(int) (opcode & 0x1f) + 1);
 		return ERROR_OK;
 	case 0x16:
 		immed = (opcode >> 6) & 0x03;
@@ -2763,11 +2763,11 @@
 		if (rn == 0xf)		/* bitfield clear */
 			sprintf(cp, "BFC\tr%d, #%d, #%d\t",
 					rd, immed,
-					(opcode & 0x1f) + 1 - immed);
+					(int) (opcode & 0x1f) + 1 - immed);
 		else			/* bitfield insert */
 			sprintf(cp, "BFI\tr%d, r%d, #%d, #%d\t",
 					rd, rn, immed,
-					(opcode & 0x1f) + 1 - immed);
+					(int) (opcode & 0x1f) + 1 - immed);
 		return ERROR_OK;
 	default:
 		return ERROR_INVALID_ARGUMENTS;
@@ -2844,8 +2844,8 @@
 	}
 
 	sprintf(cp, "STR%s.W\tr%d, [r%d, r%d, LSL #%d]",
-			size, rt, rn, opcode & 0x0f,
-			(opcode >> 4) & 0x03);
+			size, rt, rn, (int) opcode & 0x0f,
+			(int) (opcode >> 4) & 0x03);
 
 imm12:
 	immed = opcode & 0x0fff;
@@ -2887,22 +2887,24 @@
 {
 	int ra = (opcode >> 12) & 0xf;
 
-
 	switch (opcode & 0x007000f0) {
 	case 0:
 		if (ra == 0xf)
 			sprintf(cp, "MUL\tr%d, r%d, r%d",
-				(opcode >> 8) & 0xf, (opcode >> 16) & 0xf,
-				(opcode >> 0) & 0xf);
+				(int) (opcode >> 8) & 0xf,
+				(int) (opcode >> 16) & 0xf,
+				(int) (opcode >> 0) & 0xf);
 		else
 			sprintf(cp, "MLA\tr%d, r%d, r%d, r%d",
-				(opcode >> 8) & 0xf, (opcode >> 16) & 0xf,
-				(opcode >> 0) & 0xf, ra);
+				(int) (opcode >> 8) & 0xf,
+				(int) (opcode >> 16) & 0xf,
+				(int) (opcode >> 0) & 0xf, ra);
 		break;
 	case 0x10:
 		sprintf(cp, "MLS\tr%d, r%d, r%d, r%d",
-			(opcode >> 8) & 0xf, (opcode >> 16) & 0xf,
-			(opcode >> 0) & 0xf, ra);
+			(int) (opcode >> 8) & 0xf,
+			(int) (opcode >> 16) & 0xf,
+			(int) (opcode >> 0) & 0xf, ra);
 		break;
 	default:
 		return ERROR_INVALID_ARGUMENTS;
@@ -2927,18 +2929,18 @@
 		sprintf(cp, "%c%sL\tr%d, r%d, r%d, r%d",
 				(op & 0x20) ? 'U' : 'S',
 				infix,
-				(opcode >> 12) & 0xf,
-				(opcode >> 8) & 0xf,
-				(opcode >> 16) & 0xf,
-				(opcode >> 0) & 0xf);
+				(int) (opcode >> 12) & 0xf,
+				(int) (opcode >> 8) & 0xf,
+				(int) (opcode >> 16) & 0xf,
+				(int) (opcode >> 0) & 0xf);
 		break;
 	case 0x1f:
 	case 0x3f:
 		sprintf(cp, "%cDIV\tr%d, r%d, r%d",
 				(op & 0x20) ? 'U' : 'S',
-				(opcode >> 8) & 0xf,
-				(opcode >> 16) & 0xf,
-				(opcode >> 0) & 0xf);
+				(int) (opcode >> 8) & 0xf,
+				(int) (opcode >> 16) & 0xf,
+				(int) (opcode >> 0) & 0xf);
 		break;
 	default:
 		return ERROR_INVALID_ARGUMENTS;
@@ -3034,7 +3036,8 @@
 			case 0:
 				if (immed == 0) {
 					sprintf(cp, "MOV%s.W\tr%d, r%d",
-						suffix, rd, (opcode & 0xf));
+						suffix, rd,
+						(int) (opcode & 0xf));
 					return ERROR_OK;
 				}
 				mnemonic = "LSL";
@@ -3048,7 +3051,8 @@
 			default:
 				if (immed == 0) {
 					sprintf(cp, "RRX%s.W\tr%d, r%d",
-						suffix, rd, (opcode & 0xf));
+						suffix, rd,
+						(int) (opcode & 0xf));
 					return ERROR_OK;
 				}
 				mnemonic = "ROR";
@@ -3121,7 +3125,7 @@
 	}
 
 	sprintf(cp, "%s%s.W\tr%d, r%d, r%d",
-		mnemonic, suffix, rd, rn, (opcode & 0xf));
+		mnemonic, suffix, rd, rn, (int) (opcode & 0xf));
 
 shift:
 	cp = strchr(cp, 0);
@@ -3151,12 +3155,13 @@
 
 two:
 	sprintf(cp, "%s%s.W\tr%d, r%d",
-		mnemonic, suffix, rn, (opcode & 0xf));
+		mnemonic, suffix, rn, (int) (opcode & 0xf));
 	goto shift;
 
 immediate:
 	sprintf(cp, "%s%s.W\tr%d, r%d, #%d",
-		mnemonic, suffix, rd, (opcode & 0xf), immed ? immed : 32);
+		mnemonic, suffix, rd,
+		(int) (opcode & 0xf), immed ? immed : 32);
 	return ERROR_OK;
 }
 
@@ -3189,9 +3194,9 @@
 			suffix = "S";
 		sprintf(cp, "%s%s.W\tr%d, r%d, r%d",
 				mnemonic, suffix,
-				(opcode >> 8) & 0xf,
-				(opcode >> 16) & 0xf,
-				(opcode >> 0) & 0xf);
+				(int) (opcode >> 8) & 0xf,
+				(int) (opcode >> 16) & 0xf,
+				(int) (opcode >> 0) & 0xf);
 
 	} else if (opcode & (1 << 7)) {
 		switch ((opcode >> 24) & 0xf) {
@@ -3213,8 +3218,8 @@
 			sprintf(cp, "%cXT%c.W\tr%d, r%d%s",
 					(opcode & (1 << 24)) ? 'U' : 'S',
 					(opcode & (1 << 26)) ? 'B' : 'H',
-					(opcode >> 8) & 0xf,
-					(opcode >> 16) & 0xf,
+					(int) (opcode >> 8) & 0xf,
+					(int) (opcode >> 16) & 0xf,
 					suffix);
 			break;
 		case 8:
@@ -3250,8 +3255,8 @@
 			}
 			sprintf(cp, "%s\tr%d, r%d",
 					mnemonic,
-					(opcode >> 8) & 0xf,
-					(opcode >> 0) & 0xf);
+					(int) (opcode >> 8) & 0xf,
+					(int) (opcode >> 0) & 0xf);
 			break;
 		default:
 			return ERROR_INVALID_ARGUMENTS;
@@ -3274,7 +3279,7 @@
 		if (opcode & (1 << 23))
 			immed = -immed;
 		sprintf(cp, "LDR\tr%d, %#8.8" PRIx32,
-				(opcode >> 12) & 0xf,
+				(int) (opcode >> 12) & 0xf,
 				thumb_alignpc4(address) + immed);
 		return ERROR_OK;
 	}
@@ -3282,17 +3287,17 @@
 	if (opcode & (1 << 23)) {
 		immed = opcode & 0x0fff;
 		sprintf(cp, "LDR.W\tr%d, [r%d, #%d]\t; %#3.3x",
-				(opcode >> 12) & 0xf,
+				(int) (opcode >> 12) & 0xf,
 				rn, immed, immed);
 		return ERROR_OK;
 	}
 
 	if (!(opcode & (0x3f << 6))) {
 		sprintf(cp, "LDR.W\tr%d, [r%d, r%d, LSL #%d]",
-				(opcode >> 12) & 0xf,
+				(int) (opcode >> 12) & 0xf,
 				rn,
-				(opcode >> 0) & 0xf,
-				(opcode >> 4) & 0x3);
+				(int) (opcode >> 0) & 0xf,
+				(int) (opcode >> 4) & 0x3);
 		return ERROR_OK;
 	}
 
@@ -3301,7 +3306,7 @@
 		immed = opcode & 0x00ff;
 
 		sprintf(cp, "LDRT\tr%d, [r%d, #%d]\t; %#2.2x",
-				(opcode >> 12) & 0xf,
+				(int) (opcode >> 12) & 0xf,
 				rn, immed, immed);
 		return ERROR_OK;
 	}
@@ -3325,7 +3330,7 @@
 		}
 
 		sprintf(cp, "LDR\tr%d, [r%d%s, #%s%u%s\t; %#2.2x",
-				(opcode >> 12) & 0xf,
+				(int) (opcode >> 12) & 0xf,
 				rn, p1,
 				(opcode & 0x200) ? "" : "-",
 				immed, p2, immed);
@@ -3433,7 +3438,8 @@
 		return ERROR_OK;
 	}
 
-	LOG_DEBUG("Can't decode 32-bit Thumb2 yet (opcode=%08x)", opcode);
+	LOG_DEBUG("Can't decode 32-bit Thumb2 yet (opcode=%08" PRIx32 ")",
+			opcode);
 
 	strcpy(cp, "(32-bit Thumb2 ...)");
 	return ERROR_OK;



From oharboe at mail.berlios.de  Thu Jul 23 09:04:22 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 23 Jul 2009 09:04:22 +0200
Subject: [Openocd-svn] r2559 - in trunk/src: jtag target
Message-ID: <200907230704.n6N74MPb007137@sheep.berlios.de>

Author: oharboe
Date: 2009-07-23 09:04:21 +0200 (Thu, 23 Jul 2009)
New Revision: 2559

Modified:
   trunk/src/jtag/amt_jtagaccel.c
   trunk/src/jtag/bitbang.c
   trunk/src/target/arm_adi_v5.c
Log:
Ferdinand Postema <ferdinand at postema.eu> fix cygwin warnings

Modified: trunk/src/jtag/amt_jtagaccel.c
===================================================================
--- trunk/src/jtag/amt_jtagaccel.c	2009-07-23 07:02:43 UTC (rev 2558)
+++ trunk/src/jtag/amt_jtagaccel.c	2009-07-23 07:04:21 UTC (rev 2559)
@@ -374,7 +374,7 @@
 				break;
 			case JTAG_SLEEP:
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG("sleep %i", cmd->cmd.sleep->us);
+				LOG_DEBUG("sleep %" PRIi32, cmd->cmd.sleep->us);
 #endif
 				jtag_sleep(cmd->cmd.sleep->us);
 				break;

Modified: trunk/src/jtag/bitbang.c
===================================================================
--- trunk/src/jtag/bitbang.c	2009-07-23 07:02:43 UTC (rev 2558)
+++ trunk/src/jtag/bitbang.c	2009-07-23 07:04:21 UTC (rev 2559)
@@ -308,7 +308,7 @@
 				break;
 			case JTAG_SLEEP:
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG("sleep %i", cmd->cmd.sleep->us);
+				LOG_DEBUG("sleep %" PRIi32, cmd->cmd.sleep->us);
 #endif
 				jtag_sleep(cmd->cmd.sleep->us);
 				break;

Modified: trunk/src/target/arm_adi_v5.c
===================================================================
--- trunk/src/target/arm_adi_v5.c	2009-07-23 07:02:43 UTC (rev 2558)
+++ trunk/src/target/arm_adi_v5.c	2009-07-23 07:04:21 UTC (rev 2559)
@@ -1144,7 +1144,7 @@
 
 	dap_ap_read_reg_u32(swjdp, 0xF8, &baseaddr);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, "0x%8.8x", baseaddr);
+	command_print(cmd_ctx, "0x%8.8" PRIx32, baseaddr);
 
 	if (apselsave != apsel)
 		dap_ap_select(swjdp, apselsave);
@@ -1162,7 +1162,7 @@
 		memaccess_tck = strtoul(args[0], NULL, 0);
 
 	swjdp->memaccess_tck = memaccess_tck;
-	command_print(cmd_ctx, "memory bus access delay set to %i tck",
+	command_print(cmd_ctx, "memory bus access delay set to %" PRIi32 " tck",
 			swjdp->memaccess_tck);
 
 	return ERROR_OK;
@@ -1181,7 +1181,7 @@
 	dap_ap_select(swjdp, apsel);
 	dap_ap_read_reg_u32(swjdp, 0xFC, &apid);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, "ap %i selected, identification register 0x%8.8x",
+	command_print(cmd_ctx, "ap %" PRIi32 " selected, identification register 0x%8.8" PRIx32,
 			apsel, apid);
 
 	return retval;
@@ -1203,7 +1203,7 @@
 
 	dap_ap_read_reg_u32(swjdp, 0xFC, &apid);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, "0x%8.8x", apid);
+	command_print(cmd_ctx, "0x%8.8" PRIx32, apid);
 	if (apselsave != apsel)
 		dap_ap_select(swjdp, apselsave);
 



From oharboe at mail.berlios.de  Thu Jul 23 17:34:08 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 23 Jul 2009 17:34:08 +0200
Subject: [Openocd-svn] r2560 - trunk/src/target
Message-ID: <200907231534.n6NFY803010327@sheep.berlios.de>

Author: oharboe
Date: 2009-07-23 17:34:03 +0200 (Thu, 23 Jul 2009)
New Revision: 2560

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net> thumb2 disassembly for Load byte, memory hints

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-23 07:04:21 UTC (rev 2559)
+++ trunk/src/target/arm_disassembler.c	2009-07-23 15:34:03 UTC (rev 2560)
@@ -2,6 +2,8 @@
  *   Copyright (C) 2006 by Dominic Rath                                    *
  *   Dominic.Rath at gmx.de                                                   *
  *                                                                         *
+ *   Copyright (C) 2009 by David Brownell                                  *
+ *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *
  *   the Free Software Foundation; either version 2 of the License, or     *
@@ -3340,6 +3342,170 @@
 	return ERROR_INVALID_ARGUMENTS;
 }
 
+static int t2ev_load_byte_hints(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	int rn = (opcode >> 16) & 0xf;
+	int rt = (opcode >> 12) & 0xf;
+	int op2 = (opcode >> 6) & 0x3f;
+	unsigned immed;
+	char *p1 = "]", *p2 = "";
+	char *mnemonic;
+
+	switch ((opcode >> 23) & 0x3) {
+	case 0:
+		if ((rn & rt) == 0xf) {
+preload_immediate_t2:
+			immed = opcode & 0xfff;
+preload_immediate_t1:
+			p1 = (opcode & (1 << 21)) ? "W" : "";
+			sprintf(cp, "PLD%s\t[r%d, #%d]\t; %#6.6x",
+					p1, rn, immed, immed);
+			return ERROR_OK;
+		}
+		if (rn == 0x0f && rt != 0x0f) {
+ldrb_literal:
+			immed = opcode & 0xfff;
+			address = thumb_alignpc4(address);
+			if (opcode & (1 << 23))
+				address += immed;
+			else
+				address -= immed;
+			sprintf(cp, "LDRB\tr%d, %#8.8" PRIx32,
+					rt, address);
+			return ERROR_OK;
+		}
+		if (rn == 0x0f)
+			break;
+		if ((op2 & 0x3c) == 0x38) {
+			immed = opcode & 0xff;
+			sprintf(cp, "LDRBT\tr%d, [r%d, #%d]\t; %#2.2x",
+					rt, rn, immed, immed);
+			return ERROR_OK;
+		}
+		if ((op2 & 0x3c) == 0x30) {
+			if (rt == 0x0f) {
+				immed = opcode & 0xff;
+				goto preload_immediate_t1;
+			}
+			mnemonic = "LDRB";
+ldrxb_immediate_t3:
+			immed = opcode & 0xff;
+			if (opcode & 0x200)
+				immed = -immed;
+
+			/* two indexed modes will write back rn */
+			if (opcode & 0x100) {
+				if (opcode & 0x400)	/* pre-indexed */
+					p2 = "]!";
+				else {			/* post-indexed */
+					p1 = "]";
+					p2 = "";
+				}
+			}
+ldrxb_immediate_t2:
+			sprintf(cp, "%s\tr%d, [r%d%s, #%d%s\t; %#8.8x",
+					mnemonic, rt, rn, p1,
+					immed, p2, immed);
+			return ERROR_OK;
+		}
+		if ((op2 & 0x24) == 0x24) {
+			mnemonic = "LDRB";
+			goto ldrxb_immediate_t3;
+		}
+		if (op2 == 0) {
+			int rm = opcode & 0xf;
+
+			if (rt == 0x0f)
+				sprintf(cp, "PLD\t");
+			else
+				sprintf(cp, "LDRB.W\tr%d, ", rt);
+			immed = (opcode >> 4) & 0x3;
+			cp = strchr(cp, 0);
+			sprintf(cp, "[r%d, r%d, LSL #%d]", rn, rm, immed);
+			return ERROR_OK;
+		}
+		break;
+	case 1:
+		if (rt == 0xf)
+			goto preload_immediate_t2;
+		if (rn == 0x0f)
+			goto ldrb_literal;
+		mnemonic = "LDRB.W";
+		immed = opcode & 0xfff;
+		goto ldrxb_immediate_t2;
+	case 2:
+		if ((rn & rt) == 0xf) {
+pli_immediate:
+			immed = opcode & 0xfff;
+			address = thumb_alignpc4(address);
+			if (opcode & (1 << 23))
+				address += immed;
+			else
+				address -= immed;
+			sprintf(cp, "PLI\t%#8.8" PRIx32, address);
+			return ERROR_OK;
+		}
+		if (rn == 0xf && rt != 0xf) {
+ldrsb_literal:
+			immed = opcode & 0xfff;
+			address = thumb_alignpc4(address);
+			if (opcode & (1 << 23))
+				address += immed;
+			else
+				address -= immed;
+			sprintf(cp, "LDRSB\t%#8.8" PRIx32, address);
+			return ERROR_OK;
+		}
+		if (rn == 0xf)
+			break;
+		if ((op2 & 0x3c) == 0x38) {
+			immed = opcode & 0xff;
+			sprintf(cp, "LDRSBT\tr%d, [r%d, #%d]\t; %2.2x",
+					rt, rn, immed, immed);
+			return ERROR_OK;
+		}
+		if ((op2 & 0x3c) == 0x30) {
+			if (rt == 0xf) {
+				immed = opcode & 0xff;
+				immed = -immed;	// pli
+				sprintf(cp, "PLI\t[r%d, #-%d]\t; %2.2x",
+						rn, immed, immed);
+				return ERROR_OK;
+			}
+			mnemonic = "LDRSB";
+			goto ldrxb_immediate_t3;
+		}
+		if ((op2 & 0x24) == 0x24) {
+			mnemonic = "LDRSB";
+			goto ldrxb_immediate_t3;
+		}
+		if (op2 == 0) {
+			int rm = opcode & 0xf;
+
+			if (rt == 0x0f)
+				sprintf(cp, "PLI\t");
+			else
+				sprintf(cp, "LDRSB.W\tr%d, ", rt);
+			immed = (opcode >> 4) & 0x3;
+			cp = strchr(cp, 0);
+			sprintf(cp, "[r%d, r%d, LSL #%d]", rn, rm, immed);
+			return ERROR_OK;
+		}
+		break;
+	case 3:
+		if (rt == 0xf)
+			goto pli_immediate;
+		if (rn == 0xf)
+			goto ldrsb_literal;
+		immed = opcode & 0xfff;
+		mnemonic = "LDRSB";
+		goto ldrxb_immediate_t2;
+	}
+
+	return ERROR_INVALID_ARGUMENTS;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -3407,6 +3573,10 @@
 	else if ((opcode & 0x1f700000) == 0x18500000)
 		retval = t2ev_load_word(opcode, address, instruction, cp);
 
+	/* ARMv7-M: A5.3.9 Load byte, memory hints */
+	else if ((opcode & 0x1e700000) == 0x18100000)
+		retval = t2ev_load_byte_hints(opcode, address, instruction, cp);
+
 	/* ARMv7-M: A5.3.10 Store single data item */
 	else if ((opcode & 0x1f100000) == 0x18000000)
 		retval = t2ev_store_single(opcode, address, instruction, cp);



From oharboe at mail.berlios.de  Thu Jul 23 17:35:16 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Thu, 23 Jul 2009 17:35:16 +0200
Subject: [Openocd-svn] r2561 - trunk/src/target
Message-ID: <200907231535.n6NFZGbF010436@sheep.berlios.de>

Author: oharboe
Date: 2009-07-23 17:35:16 +0200 (Thu, 23 Jul 2009)
New Revision: 2561

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net>  thumb2 disassembly for Load halfword

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-23 15:34:03 UTC (rev 2560)
+++ trunk/src/target/arm_disassembler.c	2009-07-23 15:35:16 UTC (rev 2561)
@@ -3506,6 +3506,85 @@
 	return ERROR_INVALID_ARGUMENTS;
 }
 
+static int t2ev_load_halfword(uint32_t opcode, uint32_t address,
+		arm_instruction_t *instruction, char *cp)
+{
+	int rn = (opcode >> 16) & 0xf;
+	int rt = (opcode >> 12) & 0xf;
+	int op2 = (opcode >> 6) & 0x3f;
+	char *sign = (opcode & (1 < 24)) ? "S" : "";
+	unsigned immed;
+
+	if (rt == 0xf) {
+		sprintf(cp, "HINT (UNALLOCATED)");
+		return ERROR_OK;
+	}
+
+	if ((opcode & (1 << 23)) == 0) {
+		if (rn == 0xf) {
+ldrh_literal:
+			if (rt == 0xf)
+				return ERROR_INVALID_ARGUMENTS;
+			immed = opcode & 0xfff;
+			address = thumb_alignpc4(address);
+			if (opcode & (1 << 23))
+				address += immed;
+			else
+				address -= immed;
+			sprintf(cp, "LDR%sH\tr%d, %#8.8" PRIx32,
+					sign, rt, address);
+			return ERROR_OK;
+		}
+		if (rt == 0xf)
+			return ERROR_INVALID_ARGUMENTS;
+		if (op2 == 0) {
+			int rm = opcode & 0xf;
+
+			immed = (opcode >> 4) & 0x3;
+			sprintf(cp, "LDR%sH.W\tr%d, [r%d, r%d, LSL #%d]",
+					sign, rt, rn, rm, immed);
+			return ERROR_OK;
+		}
+		if ((op2 & 0x3c) == 0x38) {
+			immed = (opcode >> 4) & 0x3;
+			sprintf(cp, "LDR%sHT\tr%d, [r%d, #%d]\t; %#2.2x",
+					sign, rt, rn, immed, immed);
+			return ERROR_OK;
+		}
+		if ((op2 & 0x3c) == 0x30 || (op2 & 0x24) == 0x24) {
+			char *p1 = "]", *p2 = "";
+
+			immed = opcode & 0xff;
+			if (opcode & 0x200)
+				immed = -immed;
+
+			/* two indexed modes will write back rn */
+			if (opcode & 0x100) {
+				if (opcode & 0x400)	/* pre-indexed */
+					p2 = "]!";
+				else {			/* post-indexed */
+					p1 = "]";
+					p2 = "";
+				}
+			}
+			sprintf(cp, "LDR%sH\tr%d, [r%d%s, #%d%s\t; %#8.8x",
+					sign, rt, rn, p1, immed, p2, immed);
+			return ERROR_OK;
+		}
+	} else {
+		if (rn == 0xf)
+			goto ldrh_literal;
+		if (rt != 0x0f) {
+			immed = opcode & 0xfff;
+			sprintf(cp, "LDR%sH.W\tr%d, [r%d, #%d]\t; %#6.6x",
+					sign, rt, rn, immed, immed);
+			return ERROR_OK;
+		}
+	}
+
+	return ERROR_INVALID_ARGUMENTS;
+}
+
 /*
  * REVISIT for Thumb2 instructions, instruction->type and friends aren't
  * always set.  That means eventual arm_simulate_step() support for Thumb2
@@ -3573,6 +3652,10 @@
 	else if ((opcode & 0x1f700000) == 0x18500000)
 		retval = t2ev_load_word(opcode, address, instruction, cp);
 
+	/* ARMv7-M: A5.3.8 Load halfword, unallocated memory hints */
+	else if ((opcode & 0x1e700000) == 0x18e00000)
+		retval = t2ev_load_halfword(opcode, address, instruction, cp);
+
 	/* ARMv7-M: A5.3.9 Load byte, memory hints */
 	else if ((opcode & 0x1e700000) == 0x18100000)
 		retval = t2ev_load_byte_hints(opcode, address, instruction, cp);
@@ -3585,7 +3668,9 @@
 	else if ((opcode & 0x1e000000) == 0x0a000000)
 		retval = t2ev_data_shift(opcode, address, instruction, cp);
 
-	/* ARMv7-M: A5.3.12 Data processing (register) */
+	/* ARMv7-M: A5.3.12 Data processing (register)
+	 * and      A5.3.13 Miscellaneous operations
+	 */
 	else if ((opcode & 0x1f000000) == 0x1a000000)
 		retval = t2ev_data_reg(opcode, address, instruction, cp);
 



From oharboe at mail.berlios.de  Fri Jul 24 07:42:51 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 24 Jul 2009 07:42:51 +0200
Subject: [Openocd-svn] r2562 - trunk/src/target
Message-ID: <200907240542.n6O5gpnu021858@sheep.berlios.de>

Author: oharboe
Date: 2009-07-24 07:42:45 +0200 (Fri, 24 Jul 2009)
New Revision: 2562

Modified:
   trunk/src/target/arm_disassembler.c
Log:
Andreas Fritiofson <andreas.fritiofson at gmail.com> I noticed there are a few checks for (rt == 0xf) even though that case
is handled with an early return at the top of the function.


Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-23 15:35:16 UTC (rev 2561)
+++ trunk/src/target/arm_disassembler.c	2009-07-24 05:42:45 UTC (rev 2562)
@@ -3523,8 +3523,6 @@
 	if ((opcode & (1 << 23)) == 0) {
 		if (rn == 0xf) {
 ldrh_literal:
-			if (rt == 0xf)
-				return ERROR_INVALID_ARGUMENTS;
 			immed = opcode & 0xfff;
 			address = thumb_alignpc4(address);
 			if (opcode & (1 << 23))
@@ -3535,8 +3533,6 @@
 					sign, rt, address);
 			return ERROR_OK;
 		}
-		if (rt == 0xf)
-			return ERROR_INVALID_ARGUMENTS;
 		if (op2 == 0) {
 			int rm = opcode & 0xf;
 
@@ -3574,12 +3570,11 @@
 	} else {
 		if (rn == 0xf)
 			goto ldrh_literal;
-		if (rt != 0x0f) {
-			immed = opcode & 0xfff;
-			sprintf(cp, "LDR%sH.W\tr%d, [r%d, #%d]\t; %#6.6x",
-					sign, rt, rn, immed, immed);
-			return ERROR_OK;
-		}
+
+		immed = opcode & 0xfff;
+		sprintf(cp, "LDR%sH.W\tr%d, [r%d, #%d]\t; %#6.6x",
+				sign, rt, rn, immed, immed);
+		return ERROR_OK;
 	}
 
 	return ERROR_INVALID_ARGUMENTS;



From oharboe at mail.berlios.de  Fri Jul 24 18:48:16 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 24 Jul 2009 18:48:16 +0200
Subject: [Openocd-svn] r2563 - trunk/src/target
Message-ID: <200907241648.n6OGmGKe015340@sheep.berlios.de>

Author: oharboe
Date: 2009-07-24 18:48:12 +0200 (Fri, 24 Jul 2009)
New Revision: 2563

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net> Bugfix some instruction decoding ... I've crafted asm files
with testcases covering several new encodings in these sections
of the ARMv7-M arch manual:

 A5.3.12 Data processing (register)
 A5.3.13 Miscellaneous operations
 A5.3.14 Multiply, and multiply accumulate
 A5.3.15 Long multiply, long multiply accumulate, and divide

The issues were mostly in '12 and '13; some new related 16-bit
opcodes had issues too.

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-24 05:42:45 UTC (rev 2562)
+++ trunk/src/target/arm_disassembler.c	2009-07-24 16:48:12 UTC (rev 2563)
@@ -2098,7 +2098,7 @@
 	char *suffix;
 
 	/* added in ARMv6 */
-	switch (opcode & 0x00c0) {
+	switch ((opcode >> 6) & 3) {
 	case 0:
 		suffix = "";
 		break;
@@ -3201,7 +3201,7 @@
 				(int) (opcode >> 0) & 0xf);
 
 	} else if (opcode & (1 << 7)) {
-		switch ((opcode >> 24) & 0xf) {
+		switch ((opcode >> 20) & 0xf) {
 		case 0:
 		case 1:
 		case 4:
@@ -3221,7 +3221,7 @@
 					(opcode & (1 << 24)) ? 'U' : 'S',
 					(opcode & (1 << 26)) ? 'B' : 'H',
 					(int) (opcode >> 8) & 0xf,
-					(int) (opcode >> 16) & 0xf,
+					(int) (opcode >> 0) & 0xf,
 					suffix);
 			break;
 		case 8:
@@ -3230,7 +3230,7 @@
 		case 0xb:
 			if (opcode & (1 << 6))
 				return ERROR_INVALID_ARGUMENTS;
-			if (~opcode & (0xff << 12))
+			if (((opcode >> 12) & 0xf) != 0xf)
 				return ERROR_INVALID_ARGUMENTS;
 			if (!(opcode & (1 << 20)))
 				return ERROR_INVALID_ARGUMENTS;



From oharboe at mail.berlios.de  Fri Jul 24 18:49:57 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Fri, 24 Jul 2009 18:49:57 +0200
Subject: [Openocd-svn] r2564 - trunk/src/target
Message-ID: <200907241649.n6OGnvJt016512@sheep.berlios.de>

Author: oharboe
Date: 2009-07-24 18:49:44 +0200 (Fri, 24 Jul 2009)
New Revision: 2564

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net> More instruction decoding fixes based on test cases, covering
ARMv7-M arch manual:

 A5.3.1 Data processing (modified immediate)
 A5.3.3 Data processing (plain binary immediate)
 A5.3.4 Branches and miscellaneous control

and other (immediate) encodings referenced there.  Several of
these just tweak the new syntax ("Unified" ARM/Thumb: UAL) but
there were a few bugs too.

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-24 16:48:12 UTC (rev 2563)
+++ trunk/src/target/arm_disassembler.c	2009-07-24 16:49:44 UTC (rev 2564)
@@ -1644,7 +1644,7 @@
 				break;
 			case 0x9:
 				instruction->type = ARM_RSB;
-				mnemonic = "NEGS";
+				mnemonic = "RSBS";
 				instruction->info.data_proc.variant = 0 /*immediate*/;
 				instruction->info.data_proc.shifter_operand.immediate.immediate = 0;
 				instruction->info.data_proc.Rn = Rm;
@@ -2600,7 +2600,6 @@
 			mnemonic = "TST";
 			one = true;
 			suffix = "";
-			suffix2 = ".W";
 			rd = rn;
 		} else {
 			instruction->type = ARM_AND;
@@ -2660,6 +2659,7 @@
 	case 10:
 		instruction->type = ARM_ADC;
 		mnemonic = "ADC";
+		suffix2 = ".W";
 		break;
 	case 11:
 		instruction->type = ARM_SBC;
@@ -2708,8 +2708,8 @@
 	bool add = false;
 	bool is_signed = false;
 
-	immed = (opcode & 0x0ff) | ((opcode & 0x7000) >> 12);
-	if (opcode & (1 << 27))
+	immed = (opcode & 0x0ff) | ((opcode & 0x7000) >> 4);
+	if (opcode & (1 << 26))
 		immed |= (1 << 11);
 
 	switch ((opcode >> 20) & 0x1f) {
@@ -2718,15 +2718,16 @@
 			add = true;
 			goto do_adr;
 		}
-		mnemonic = "ADD.W";
+		mnemonic = "ADDW";
 		break;
 	case 4:
-		mnemonic = "MOV.W";
-		break;
+		immed |= (opcode >> 4) & 0xf000;
+		sprintf(cp, "MOVW\tr%d, #%d\t; %#3.3x", rd, immed, immed);
+		return ERROR_OK;
 	case 0x0a:
 		if (rn == 0xf)
 			goto do_adr;
-		mnemonic = "SUB.W";
+		mnemonic = "SUBW";
 		break;
 	case 0x0c:
 		/* move constant to top 16 bits of register */
@@ -2743,7 +2744,7 @@
 		immed |= (opcode >> 10) & 0x1c;
 		sprintf(cp, "%sSAT\tr%d, #%d, r%d, %s #%d\t",
 				is_signed ? "S" : "U",
-				rd, (int) (opcode & 0x1f) + 1, rn,
+				rd, (int) (opcode & 0x1f) + is_signed, rn,
 				(opcode & (1 << 21)) ? "ASR" : "LSL",
 				immed ? immed : 32);
 		return ERROR_OK;



From oharboe at mail.berlios.de  Sun Jul 26 21:57:00 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 26 Jul 2009 21:57:00 +0200
Subject: [Openocd-svn] r2565 - trunk/src/target
Message-ID: <200907261957.n6QJv09m000800@sheep.berlios.de>

Author: oharboe
Date: 2009-07-26 21:56:58 +0200 (Sun, 26 Jul 2009)
New Revision: 2565

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net> More instruction decoding fixes:

       A5.3.5 Load/store multiple
       A5.3.7 Load word

There was a longstanding bug in Thumb-1 LDM; the rest of the LDM/STM
fixes are just using width specs to match UAL syntax, except for two
opcode name typos.  Load word had two bitmask goofs.

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-24 16:49:44 UTC (rev 2564)
+++ trunk/src/target/arm_disassembler.c	2009-07-26 19:56:58 UTC (rev 2565)
@@ -1944,17 +1944,21 @@
 
 	if ((opcode & 0xf000) == 0xc000)
 	{ /* generic load/store multiple */
+		char *wback = "!";
+
 		if (L)
 		{
 			instruction->type = ARM_LDM;
 			mnemonic = "LDM";
+			if (opcode & (1 << Rn))
+				wback = "";
 		}
 		else
 		{
 			instruction->type = ARM_STM;
 			mnemonic = "STM";
 		}
-		snprintf(ptr_name,7,"r%i!, ",Rn);
+		snprintf(ptr_name, sizeof ptr_name, "r%i%s, ", Rn, wback);
 	}
 	else
 	{ /* push/pop */
@@ -2965,22 +2969,22 @@
 
 	switch (op) {
 	case 2:
-		sprintf(cp, "STMB\tr%d%s, ", rn, t ? "!" : "");
+		sprintf(cp, "STM.W\tr%d%s, ", rn, t ? "!" : "");
 		break;
 	case 3:
 		if (rn == 13 && t)
-			sprintf(cp, "POP\t");
+			sprintf(cp, "POP.W\t");
 		else
 			sprintf(cp, "LDM.W\tr%d%s, ", rn, t ? "!" : "");
 		break;
 	case 4:
 		if (rn == 13 && t)
-			sprintf(cp, "PUSH\t");
+			sprintf(cp, "PUSH.W\t");
 		else
-			sprintf(cp, "STM.W\tr%d%s, ", rn, t ? "!" : "");
+			sprintf(cp, "STMDB\tr%d%s, ", rn, t ? "!" : "");
 		break;
 	case 5:
-		sprintf(cp, "LDMB\tr%d%s, ", rn, t ? "!" : "");
+		sprintf(cp, "LDMDB.W\tr%d%s, ", rn, t ? "!" : "");
 		break;
 	default:
 		return ERROR_INVALID_ARGUMENTS;
@@ -3279,7 +3283,7 @@
 
 	if (rn == 0xf) {
 		immed = opcode & 0x0fff;
-		if (opcode & (1 << 23))
+		if ((opcode & (1 << 23)) == 0)
 			immed = -immed;
 		sprintf(cp, "LDR\tr%d, %#8.8" PRIx32,
 				(int) (opcode >> 12) & 0xf,
@@ -3317,7 +3321,7 @@
 	if (((opcode >> 8) & 0xf) == 0xc || (opcode & 0x0900) == 0x0900) {
 		char *p1 = "]", *p2 = "";
 
-		if (!(opcode & 0x0600))
+		if (!(opcode & 0x0500))
 			return ERROR_INVALID_ARGUMENTS;
 
 		immed = opcode & 0x00ff;



From oharboe at mail.berlios.de  Sun Jul 26 21:58:25 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 26 Jul 2009 21:58:25 +0200
Subject: [Openocd-svn] r2566 - trunk/src/target
Message-ID: <200907261958.n6QJwP38000966@sheep.berlios.de>

Author: oharboe
Date: 2009-07-26 21:58:25 +0200 (Sun, 26 Jul 2009)
New Revision: 2566

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net> More fixes from test cases:

       A5.3.8 Load halfword, unallocated memory hints

It's mostly the usual sort of bitmasking goofage and getting the
width specs right.  In one case an older x86 GCC generated bad code
unless I structred a conditional differently (sigh).

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-26 19:56:58 UTC (rev 2565)
+++ trunk/src/target/arm_disassembler.c	2009-07-26 19:58:25 UTC (rev 2566)
@@ -3517,7 +3517,7 @@
 	int rn = (opcode >> 16) & 0xf;
 	int rt = (opcode >> 12) & 0xf;
 	int op2 = (opcode >> 6) & 0x3f;
-	char *sign = (opcode & (1 < 24)) ? "S" : "";
+	char *sign = "";
 	unsigned immed;
 
 	if (rt == 0xf) {
@@ -3525,6 +3525,9 @@
 		return ERROR_OK;
 	}
 
+	if (opcode & (1 << 24))
+		sign = "S";
+
 	if ((opcode & (1 << 23)) == 0) {
 		if (rn == 0xf) {
 ldrh_literal:
@@ -3547,16 +3550,16 @@
 			return ERROR_OK;
 		}
 		if ((op2 & 0x3c) == 0x38) {
-			immed = (opcode >> 4) & 0x3;
+			immed = opcode & 0xff;
 			sprintf(cp, "LDR%sHT\tr%d, [r%d, #%d]\t; %#2.2x",
 					sign, rt, rn, immed, immed);
 			return ERROR_OK;
 		}
 		if ((op2 & 0x3c) == 0x30 || (op2 & 0x24) == 0x24) {
-			char *p1 = "]", *p2 = "";
+			char *p1 = "", *p2 = "]";
 
 			immed = opcode & 0xff;
-			if (opcode & 0x200)
+			if (!(opcode & 0x200))
 				immed = -immed;
 
 			/* two indexed modes will write back rn */
@@ -3577,8 +3580,9 @@
 			goto ldrh_literal;
 
 		immed = opcode & 0xfff;
-		sprintf(cp, "LDR%sH.W\tr%d, [r%d, #%d]\t; %#6.6x",
-				sign, rt, rn, immed, immed);
+		sprintf(cp, "LDR%sH%s\tr%d, [r%d, #%d]\t; %#6.6x",
+				sign, *sign ? "" : ".W",
+				rt, rn, immed, immed);
 		return ERROR_OK;
 	}
 
@@ -3653,7 +3657,7 @@
 		retval = t2ev_load_word(opcode, address, instruction, cp);
 
 	/* ARMv7-M: A5.3.8 Load halfword, unallocated memory hints */
-	else if ((opcode & 0x1e700000) == 0x18e00000)
+	else if ((opcode & 0x1e700000) == 0x18300000)
 		retval = t2ev_load_halfword(opcode, address, instruction, cp);
 
 	/* ARMv7-M: A5.3.9 Load byte, memory hints */



From oharboe at mail.berlios.de  Sun Jul 26 21:59:33 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 26 Jul 2009 21:59:33 +0200
Subject: [Openocd-svn] r2567 - trunk/src/target
Message-ID: <200907261959.n6QJxXJv001054@sheep.berlios.de>

Author: oharboe
Date: 2009-07-26 21:59:33 +0200 (Sun, 26 Jul 2009)
New Revision: 2567

Modified:
   trunk/src/target/arm_disassembler.c
Log:
More instruction decoding fixes:

       A5.3.5 Load/store multiple
       A5.3.7 Load word

There was a longstanding bug in Thumb-1 LDM; the rest of the LDM/STM
fixes are just using width specs to match UAL syntax, except for two
opcode name typos.  Load word had two bitmask goofs.

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-26 19:58:25 UTC (rev 2566)
+++ trunk/src/target/arm_disassembler.c	2009-07-26 19:59:33 UTC (rev 2567)
@@ -2853,6 +2853,7 @@
 	sprintf(cp, "STR%s.W\tr%d, [r%d, r%d, LSL #%d]",
 			size, rt, rn, (int) opcode & 0x0f,
 			(int) (opcode >> 4) & 0x03);
+	return ERROR_OK;
 
 imm12:
 	immed = opcode & 0x0fff;
@@ -3354,18 +3355,21 @@
 	int rt = (opcode >> 12) & 0xf;
 	int op2 = (opcode >> 6) & 0x3f;
 	unsigned immed;
-	char *p1 = "]", *p2 = "";
+	char *p1 = "", *p2 = "]";
 	char *mnemonic;
 
 	switch ((opcode >> 23) & 0x3) {
 	case 0:
 		if ((rn & rt) == 0xf) {
-preload_immediate_t2:
+pld_literal:
 			immed = opcode & 0xfff;
-preload_immediate_t1:
-			p1 = (opcode & (1 << 21)) ? "W" : "";
-			sprintf(cp, "PLD%s\t[r%d, #%d]\t; %#6.6x",
-					p1, rn, immed, immed);
+			address = thumb_alignpc4(address);
+			if (opcode & (1 << 23))
+				address += immed;
+			else
+				address -= immed;
+			sprintf(cp, "PLD\tr%d, %#8.8" PRIx32,
+					rt, address);
 			return ERROR_OK;
 		}
 		if (rn == 0x0f && rt != 0x0f) {
@@ -3391,12 +3395,17 @@
 		if ((op2 & 0x3c) == 0x30) {
 			if (rt == 0x0f) {
 				immed = opcode & 0xff;
-				goto preload_immediate_t1;
+				immed = -immed;
+preload_immediate:
+				p1 = (opcode & (1 << 21)) ? "W" : "";
+				sprintf(cp, "PLD%s\t[r%d, #%d]\t; %#6.6x",
+						p1, rn, immed, immed);
+				return ERROR_OK;
 			}
 			mnemonic = "LDRB";
 ldrxb_immediate_t3:
 			immed = opcode & 0xff;
-			if (opcode & 0x200)
+			if (!(opcode & 0x200))
 				immed = -immed;
 
 			/* two indexed modes will write back rn */
@@ -3432,8 +3441,12 @@
 		}
 		break;
 	case 1:
-		if (rt == 0xf)
-			goto preload_immediate_t2;
+		if ((rn & rt) == 0xf)
+			goto pld_literal;
+		if (rt == 0xf) {
+			immed = opcode & 0xfff;
+			goto preload_immediate;
+		}
 		if (rn == 0x0f)
 			goto ldrb_literal;
 		mnemonic = "LDRB.W";
@@ -3441,7 +3454,6 @@
 		goto ldrxb_immediate_t2;
 	case 2:
 		if ((rn & rt) == 0xf) {
-pli_immediate:
 			immed = opcode & 0xfff;
 			address = thumb_alignpc4(address);
 			if (opcode & (1 << 23))
@@ -3466,7 +3478,7 @@
 			break;
 		if ((op2 & 0x3c) == 0x38) {
 			immed = opcode & 0xff;
-			sprintf(cp, "LDRSBT\tr%d, [r%d, #%d]\t; %2.2x",
+			sprintf(cp, "LDRSBT\tr%d, [r%d, #%d]\t; %#2.2x",
 					rt, rn, immed, immed);
 			return ERROR_OK;
 		}
@@ -3474,8 +3486,8 @@
 			if (rt == 0xf) {
 				immed = opcode & 0xff;
 				immed = -immed;	// pli
-				sprintf(cp, "PLI\t[r%d, #-%d]\t; %2.2x",
-						rn, immed, immed);
+				sprintf(cp, "PLI\t[r%d, #%d]\t; -%#2.2x",
+						rn, immed, -immed);
 				return ERROR_OK;
 			}
 			mnemonic = "LDRSB";
@@ -3499,8 +3511,12 @@
 		}
 		break;
 	case 3:
-		if (rt == 0xf)
-			goto pli_immediate;
+		if (rt == 0xf) {
+			immed = opcode & 0xfff;
+			sprintf(cp, "PLI\t[r%d, #%d]\t; %#3.3" PRIx32,
+					rn, immed, immed);
+			return ERROR_OK;
+		}
 		if (rn == 0xf)
 			goto ldrsb_literal;
 		immed = opcode & 0xfff;



From oharboe at mail.berlios.de  Sun Jul 26 22:00:40 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Sun, 26 Jul 2009 22:00:40 +0200
Subject: [Openocd-svn] r2568 - trunk/src/target
Message-ID: <200907262000.n6QK0eED001241@sheep.berlios.de>

Author: oharboe
Date: 2009-07-26 22:00:39 +0200 (Sun, 26 Jul 2009)
New Revision: 2568

Modified:
   trunk/src/target/arm_disassembler.c
Log:
David Brownell <david-b at pacbell.net> More testcase work:

       A5.3.11 Data processing (shifted register)

The usual kinds of problems; the most noteworthy were that
the "S"et flags bit was mis-handled in these instructions.
---
This is the last patch from a quickie set of tests covering all
encodings of the instructions with 32-bit opcodes.  There may
be some corner cases left, plus the instructions that aren't
yet handled, but the Thumb2 disassembler is no longer just
"lightly" tested with GCC output ... the new code paths have
mostly been verified.

Modified: trunk/src/target/arm_disassembler.c
===================================================================
--- trunk/src/target/arm_disassembler.c	2009-07-26 19:59:33 UTC (rev 2567)
+++ trunk/src/target/arm_disassembler.c	2009-07-26 20:00:39 UTC (rev 2568)
@@ -1395,6 +1395,7 @@
 	}
 	else
 	{
+		/* REVISIT:  if reg_imm == 0, display as "MOVS" */
 		instruction->type = ARM_ADD;
 		mnemonic = "ADDS";
 	}
@@ -3017,17 +3018,18 @@
 	char *mnemonic;
 	char *suffix = "";
 
-	immed |= (opcode >> 10) & 0x7;
-	if (opcode & (1 << 21))
+	immed |= (opcode >> 10) & 0x1c;
+	if (opcode & (1 << 20))
 		suffix = "S";
 
 	switch (op) {
 	case 0:
 		if (rd == 0xf) {
-			if (!(opcode & (1 << 21)))
+			if (!(opcode & (1 << 20)))
 				return ERROR_INVALID_ARGUMENTS;
 			instruction->type = ARM_TST;
 			mnemonic = "TST";
+			suffix = "";
 			goto two;
 		}
 		instruction->type = ARM_AND;
@@ -3058,7 +3060,7 @@
 				break;
 			default:
 				if (immed == 0) {
-					sprintf(cp, "RRX%s.W\tr%d, r%d",
+					sprintf(cp, "RRX%s\tr%d, r%d",
 						suffix, rd,
 						(int) (opcode & 0xf));
 					return ERROR_OK;
@@ -3085,10 +3087,11 @@
 		break;
 	case 4:
 		if (rd == 0xf) {
-			if (!(opcode & (1 << 21)))
+			if (!(opcode & (1 << 20)))
 				return ERROR_INVALID_ARGUMENTS;
 			instruction->type = ARM_TEQ;
 			mnemonic = "TEQ";
+			suffix = "";
 			goto two;
 		}
 		instruction->type = ARM_EOR;
@@ -3096,10 +3099,11 @@
 		break;
 	case 8:
 		if (rd == 0xf) {
-			if (!(opcode & (1 << 21)))
+			if (!(opcode & (1 << 20)))
 				return ERROR_INVALID_ARGUMENTS;
 			instruction->type = ARM_CMN;
 			mnemonic = "CMN";
+			suffix = "";
 			goto two;
 		}
 		instruction->type = ARM_ADD;
@@ -3119,6 +3123,7 @@
 				return ERROR_INVALID_ARGUMENTS;
 			instruction->type = ARM_CMP;
 			mnemonic = "CMP";
+			suffix = "";
 			goto two;
 		}
 		instruction->type = ARM_SUB;
@@ -3146,13 +3151,17 @@
 		break;
 	case 1:
 		suffix = "LSR";
+		if (immed == 32)
+			immed = 0;
 		break;
 	case 2:
 		suffix = "ASR";
+		if (immed == 32)
+			immed = 0;
 		break;
 	case 3:
 		if (immed == 0) {
-			strcpy(cp, "RRX");
+			strcpy(cp, ", RRX");
 			return ERROR_OK;
 		}
 		suffix = "ROR";



From oharboe at mail.berlios.de  Mon Jul 27 16:46:50 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 27 Jul 2009 16:46:50 +0200
Subject: [Openocd-svn] r2569 - trunk
Message-ID: <200907271446.n6REko8W014414@sheep.berlios.de>

Author: oharboe
Date: 2009-07-27 16:46:49 +0200 (Mon, 27 Jul 2009)
New Revision: 2569

Modified:
   trunk/BUGS
Log:
add "dummy" interface trick to the BUGS reporting suggestions

Modified: trunk/BUGS
===================================================================
--- trunk/BUGS	2009-07-26 20:00:39 UTC (rev 2568)
+++ trunk/BUGS	2009-07-27 14:46:49 UTC (rev 2569)
@@ -34,8 +34,15 @@
 
 @section bugscrashdump Obtaining Crash Backtraces
 
-If OpenOCD is crashing, you can use GDB to get a trace:@par
+If OpenOCD is crashing, there are two very effective things you can do to
+improve your chances of getting help on the development mailing list. 
+
+Try to reproduce the problem using the dummy JTAG interface to allow other developers to replicate
+your problem robustly and use GDB to get a trace:@par
 @code
+% OPENOCDSRC/configure --enable-dummy ...
+% openocd -f interface/dummy.cfg -f target/xxx.cfg
+=> SEGFAULT
 % gdb --args openocd ....
 (gdb) run
 (gdb) bt



From oharboe at mail.berlios.de  Mon Jul 27 20:56:44 2009
From: oharboe at mail.berlios.de (oharboe at BerliOS)
Date: Mon, 27 Jul 2009 20:56:44 +0200
Subject: [Openocd-svn] r2570 - trunk/src/server
Message-ID: <200907271856.n6RIui4J032465@sheep.berlios.de>

Author: oharboe
Date: 2009-07-27 20:56:43 +0200 (Mon, 27 Jul 2009)
New Revision: 2570

Modified:
   trunk/src/server/gdb_server.c
Log:
Fix NPE in GDB_EVENT_END as logforwarding was not disabled early enough

Modified: trunk/src/server/gdb_server.c
===================================================================
--- trunk/src/server/gdb_server.c	2009-07-27 14:46:49 UTC (rev 2569)
+++ trunk/src/server/gdb_server.c	2009-07-27 18:56:43 UTC (rev 2570)
@@ -816,6 +816,11 @@
 	gdb_service_t *gdb_service = connection->service->priv;
 	gdb_connection_t *gdb_connection = connection->priv;
 
+	/* we're done forwarding messages. Tear down callback before
+	 * cleaning up connection.
+	 */
+	log_remove_callback(gdb_log_callback, connection);
+
 	gdb_actual_connections--;
 	LOG_DEBUG("GDB Close, Target: %s, state: %s, gdb_actual_connections=%d", 
 		  gdb_service->target->cmd_name,
@@ -843,9 +848,10 @@
 		LOG_ERROR("BUG: connection->priv == NULL");
 	}
 
+
 	target_unregister_event_callback(gdb_target_callback_event_handler, connection);
+
 	target_call_event_callbacks(gdb_service->target, TARGET_EVENT_GDB_END);
-	log_remove_callback(gdb_log_callback, connection);
 
 	target_call_event_callbacks(gdb_service->target, TARGET_EVENT_GDB_DETACH);
 



From ntfreak at mail.berlios.de  Fri Jul 31 10:52:04 2009
From: ntfreak at mail.berlios.de (ntfreak at BerliOS)
Date: Fri, 31 Jul 2009 10:52:04 +0200
Subject: [Openocd-svn] r2571 - trunk
Message-ID: <200907310852.n6V8q4Hh005954@sheep.berlios.de>

Author: ntfreak
Date: 2009-07-31 10:52:03 +0200 (Fri, 31 Jul 2009)
New Revision: 2571

Modified:
   trunk/configure.in
Log:
- add configure error if building parport interface under cygwin and sys/io.h missing

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2009-07-27 18:56:43 UTC (rev 2570)
+++ trunk/configure.in	2009-07-31 08:52:03 UTC (rev 2571)
@@ -467,6 +467,10 @@
     else
       is_cygwin=yes
       AC_DEFINE(IS_CYGWIN, 1, [1 if building for Cygwin.])
+      # sys/io.h needed under cygwin for parport access
+      if test $build_parport = yes; then
+        AC_CHECK_HEADERS(sys/io.h,[],AC_MSG_ERROR([Please install the cygwin ioperm package]))
+      fi
     fi
   
     AC_DEFINE(IS_WIN32, 1, [1 if building for Win32.])



