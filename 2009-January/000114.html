<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-svn] r1325 - in branches: . openocd-0.1 openocd-0.1/doc	openocd-0.1/src openocd-0.1/src/flash openocd-0.1/src/helper	openocd-0.1/src/jtag openocd-0.1/src/jtag/rlink	openocd-0.1/src/server openocd-0.1/src/server/httpd	openocd-0.1/src/server/httpd/menu_cuts openocd-0.1/src/target	openocd-0.1/src/target/board openocd-0.1/src/target/interface	openocd-0.1/src/target/target openocd-0.1/src/xsvf	openocd-0.1/testing openocd-0.1/testing/build.test1	openocd-0.1/testing/build.test1/mingw32_help	openocd-0.1/testing/build.test1/mingw32_help/include	openocd-0.1/testing/build.test1/mingw32_help/include/sys	openocd-0.1/testing/build.test2 openocd-0.1/testing/examples	openocd-0.1/testing/examples/ledtest-imx27ads	openocd-0.1/testing/examples/ledtest-imx31pdk	openocd-0.1/tools openocd-0.1/tools/rlink_make_speed_table	openocd-0.1/tools/st7_dtc_as openocd-0.1/tools/xsvf_tools
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-svn%5D%20r1325%20-%20in%20branches%3A%20.%20openocd-0.1%20openocd-0.1/doc%0A%09openocd-0.1/src%20openocd-0.1/src/flash%20openocd-0.1/src/helper%0A%09openocd-0.1/src/jtag%20openocd-0.1/src/jtag/rlink%0A%09openocd-0.1/src/server%20openocd-0.1/src/server/httpd%0A%09openocd-0.1/src/server/httpd/menu_cuts%20openocd-0.1/src/target%0A%09openocd-0.1/src/target/board%20openocd-0.1/src/target/interface%0A%09openocd-0.1/src/target/target%20openocd-0.1/src/xsvf%0A%09openocd-0.1/testing%20openocd-0.1/testing/build.test1%0A%09openocd-0.1/testing/build.test1/mingw32_help%0A%09openocd-0.1/testing/build.test1/mingw32_help/include%0A%09openocd-0.1/testing/build.test1/mingw32_help/include/sys%0A%09openocd-0.1/testing/build.test2%20openocd-0.1/testing/examples%0A%09openocd-0.1/testing/examples/ledtest-imx27ads%0A%09openocd-0.1/testing/examples/ledtest-imx31pdk%0A%09openocd-0.1/tools%20openocd-0.1/tools/rlink_make_speed_table%0A%09openocd-0.1/tools/st7_dtc_as%20openocd-0.1/tools/xsvf_tools&In-Reply-To=%3C200901160646.n0G6kFWg019639%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000108.html">
   <LINK REL="Next"  HREF="000109.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-svn] r1325 - in branches: . openocd-0.1 openocd-0.1/doc	openocd-0.1/src openocd-0.1/src/flash openocd-0.1/src/helper	openocd-0.1/src/jtag openocd-0.1/src/jtag/rlink	openocd-0.1/src/server openocd-0.1/src/server/httpd	openocd-0.1/src/server/httpd/menu_cuts openocd-0.1/src/target	openocd-0.1/src/target/board openocd-0.1/src/target/interface	openocd-0.1/src/target/target openocd-0.1/src/xsvf	openocd-0.1/testing openocd-0.1/testing/build.test1	openocd-0.1/testing/build.test1/mingw32_help	openocd-0.1/testing/build.test1/mingw32_help/include	openocd-0.1/testing/build.test1/mingw32_help/include/sys	openocd-0.1/testing/build.test2 openocd-0.1/testing/examples	openocd-0.1/testing/examples/ledtest-imx27ads	openocd-0.1/testing/examples/ledtest-imx31pdk	openocd-0.1/tools openocd-0.1/tools/rlink_make_speed_table	openocd-0.1/tools/st7_dtc_as openocd-0.1/tools/xsvf_tools</H1>
    <B>kc8apf at mail.berlios.de</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-svn%5D%20r1325%20-%20in%20branches%3A%20.%20openocd-0.1%20openocd-0.1/doc%0A%09openocd-0.1/src%20openocd-0.1/src/flash%20openocd-0.1/src/helper%0A%09openocd-0.1/src/jtag%20openocd-0.1/src/jtag/rlink%0A%09openocd-0.1/src/server%20openocd-0.1/src/server/httpd%0A%09openocd-0.1/src/server/httpd/menu_cuts%20openocd-0.1/src/target%0A%09openocd-0.1/src/target/board%20openocd-0.1/src/target/interface%0A%09openocd-0.1/src/target/target%20openocd-0.1/src/xsvf%0A%09openocd-0.1/testing%20openocd-0.1/testing/build.test1%0A%09openocd-0.1/testing/build.test1/mingw32_help%0A%09openocd-0.1/testing/build.test1/mingw32_help/include%0A%09openocd-0.1/testing/build.test1/mingw32_help/include/sys%0A%09openocd-0.1/testing/build.test2%20openocd-0.1/testing/examples%0A%09openocd-0.1/testing/examples/ledtest-imx27ads%0A%09openocd-0.1/testing/examples/ledtest-imx31pdk%0A%09openocd-0.1/tools%20openocd-0.1/tools/rlink_make_speed_table%0A%09openocd-0.1/tools/st7_dtc_as%20openocd-0.1/tools/xsvf_tools&In-Reply-To=%3C200901160646.n0G6kFWg019639%40sheep.berlios.de%3E"
       TITLE="[Openocd-svn] r1325 - in branches: . openocd-0.1 openocd-0.1/doc	openocd-0.1/src openocd-0.1/src/flash openocd-0.1/src/helper	openocd-0.1/src/jtag openocd-0.1/src/jtag/rlink	openocd-0.1/src/server openocd-0.1/src/server/httpd	openocd-0.1/src/server/httpd/menu_cuts openocd-0.1/src/target	openocd-0.1/src/target/board openocd-0.1/src/target/interface	openocd-0.1/src/target/target openocd-0.1/src/xsvf	openocd-0.1/testing openocd-0.1/testing/build.test1	openocd-0.1/testing/build.test1/mingw32_help	openocd-0.1/testing/build.test1/mingw32_help/include	openocd-0.1/testing/build.test1/mingw32_help/include/sys	openocd-0.1/testing/build.test2 openocd-0.1/testing/examples	openocd-0.1/testing/examples/ledtest-imx27ads	openocd-0.1/testing/examples/ledtest-imx31pdk	openocd-0.1/tools openocd-0.1/tools/rlink_make_speed_table	openocd-0.1/tools/st7_dtc_as openocd-0.1/tools/xsvf_tools">kc8apf at mail.berlios.de
       </A><BR>
    <I>Fri Jan 16 07:46:15 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000108.html">[Openocd-svn] r1324 - in trunk: src/target/board	testing/examples/ledtest-imx27ads testing/examples/ledtest-imx31pdk
</A></li>
        <LI>Next message: <A HREF="000109.html">[Openocd-svn] r1326 - branches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#114">[ date ]</a>
              <a href="thread.html#114">[ thread ]</a>
              <a href="subject.html#114">[ subject ]</a>
              <a href="author.html#114">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: kc8apf
Date: 2009-01-16 07:43:11 +0100 (Fri, 16 Jan 2009)
New Revision: 1325

Added:
   branches/openocd-0.1/
   branches/openocd-0.1/src/flash/pic32mx.c
   branches/openocd-0.1/src/flash/pic32mx.h
   branches/openocd-0.1/src/helper/ioutil.c
   branches/openocd-0.1/src/jtag/rlink/
   branches/openocd-0.1/src/jtag/rlink/Makefile
   branches/openocd-0.1/src/jtag/rlink/call.m4
   branches/openocd-0.1/src/jtag/rlink/dtc_cmd.h
   branches/openocd-0.1/src/jtag/rlink/ep1_cmd.h
   branches/openocd-0.1/src/jtag/rlink/init.m4
   branches/openocd-0.1/src/jtag/rlink/rlink.c
   branches/openocd-0.1/src/jtag/rlink/rlink.h
   branches/openocd-0.1/src/jtag/rlink/rlink_speed_table.c
   branches/openocd-0.1/src/jtag/rlink/st7.h
   branches/openocd-0.1/src/jtag/vsllink.c
   branches/openocd-0.1/src/server/httpd.c
   branches/openocd-0.1/src/server/httpd/
   branches/openocd-0.1/src/server/httpd/Stylizer.class
   branches/openocd-0.1/src/server/httpd/Stylizer.java
   branches/openocd-0.1/src/server/httpd/browsemem.tcl
   branches/openocd-0.1/src/server/httpd/build.sh
   branches/openocd-0.1/src/server/httpd/downloadmem.tcl
   branches/openocd-0.1/src/server/httpd/editconfigs.tcl
   branches/openocd-0.1/src/server/httpd/editfile.tcl
   branches/openocd-0.1/src/server/httpd/erase.tcl
   branches/openocd-0.1/src/server/httpd/flash.tcl
   branches/openocd-0.1/src/server/httpd/flashinfo.tcl
   branches/openocd-0.1/src/server/httpd/guiupload.tcl
   branches/openocd-0.1/src/server/httpd/html2tcl.sh
   branches/openocd-0.1/src/server/httpd/httpd.tcl
   branches/openocd-0.1/src/server/httpd/index.tcl
   branches/openocd-0.1/src/server/httpd/log.tcl
   branches/openocd-0.1/src/server/httpd/menu.xml
   branches/openocd-0.1/src/server/httpd/menu.xsl
   branches/openocd-0.1/src/server/httpd/menu_cuts/
   branches/openocd-0.1/src/server/httpd/menu_cuts/center_bottom.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/center_top.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab1.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab1_selected.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab2.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab2_selected.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab_free.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/logo_bottom.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/logo_top.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/right_bottom.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/right_top.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/right_top_small.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/top_right.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_1.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_2_tile.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_3.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_tab.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_tab_selected.png
   branches/openocd-0.1/src/server/httpd/menuweb.css
   branches/openocd-0.1/src/server/httpd/openocd.tcl
   branches/openocd-0.1/src/server/httpd/preconfig.tcl
   branches/openocd-0.1/src/server/httpd/production.tcl
   branches/openocd-0.1/src/server/httpd/readme.txt
   branches/openocd-0.1/src/server/httpd/reload.tcl
   branches/openocd-0.1/src/server/httpd/run.tcl
   branches/openocd-0.1/src/server/httpd/support.tcl
   branches/openocd-0.1/src/server/httpd/targets.tcl
   branches/openocd-0.1/src/server/httpd/terminal.tcl
   branches/openocd-0.1/src/server/httpd/upgrade.tcl
   branches/openocd-0.1/src/target/board/imx27ads.cfg
   branches/openocd-0.1/src/target/board/imx31pdk.cfg
   branches/openocd-0.1/src/target/board/pic-p32mx.cfg
   branches/openocd-0.1/src/target/board/x300t.cfg
   branches/openocd-0.1/src/target/interface/parport_dlc5.cfg
   branches/openocd-0.1/src/target/interface/rlink.cfg
   branches/openocd-0.1/src/target/target/samsung_s3c2440.cfg
   branches/openocd-0.1/src/target/target/smp8634.cfg
   branches/openocd-0.1/testing/build.test1/
   branches/openocd-0.1/testing/build.test1/Makefile
   branches/openocd-0.1/testing/build.test1/Makefile.confuse
   branches/openocd-0.1/testing/build.test1/Makefile.ftd2xx
   branches/openocd-0.1/testing/build.test1/Makefile.libftdi
   branches/openocd-0.1/testing/build.test1/Makefile.libusb
   branches/openocd-0.1/testing/build.test1/Makefile.openocd
   branches/openocd-0.1/testing/build.test1/README.TXT
   branches/openocd-0.1/testing/build.test1/local.uses
   branches/openocd-0.1/testing/build.test1/mingw32_help/
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/elf.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/cdefs.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf32.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf64.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_common.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_generic.h
   branches/openocd-0.1/testing/build.test2/
   branches/openocd-0.1/testing/build.test2/Makefile
   branches/openocd-0.1/testing/build.test2/README.txt
   branches/openocd-0.1/testing/build.test2/local.uses
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/Makefile
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/crt0.S
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/gdbinit-imx27ads
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/ldscript
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/test.c
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/test.elf
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/Makefile
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/crt0.S
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/gdbinit-imx31pdk
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/ldscript
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/test.c
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/test.elf
   branches/openocd-0.1/tools/
   branches/openocd-0.1/tools/rlink_make_speed_table/
   branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table
   branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table.pl
   branches/openocd-0.1/tools/st7_dtc_as/
   branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as
   branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as.pl
   branches/openocd-0.1/tools/xsvf_tools/
   branches/openocd-0.1/tools/xsvf_tools/svf2xsvf.py
   branches/openocd-0.1/tools/xsvf_tools/xsvfdump.py
Removed:
   branches/openocd-0.1/src/jtag/rlink/Makefile
   branches/openocd-0.1/src/jtag/rlink/call.m4
   branches/openocd-0.1/src/jtag/rlink/dtc_cmd.h
   branches/openocd-0.1/src/jtag/rlink/ep1_cmd.h
   branches/openocd-0.1/src/jtag/rlink/init.m4
   branches/openocd-0.1/src/jtag/rlink/rlink.c
   branches/openocd-0.1/src/jtag/rlink/rlink.h
   branches/openocd-0.1/src/jtag/rlink/rlink_speed_table.c
   branches/openocd-0.1/src/jtag/rlink/st7.h
   branches/openocd-0.1/src/server/httpd/Stylizer.class
   branches/openocd-0.1/src/server/httpd/Stylizer.java
   branches/openocd-0.1/src/server/httpd/browsemem.tcl
   branches/openocd-0.1/src/server/httpd/build.sh
   branches/openocd-0.1/src/server/httpd/downloadmem.tcl
   branches/openocd-0.1/src/server/httpd/editconfigs.tcl
   branches/openocd-0.1/src/server/httpd/editfile.tcl
   branches/openocd-0.1/src/server/httpd/erase.tcl
   branches/openocd-0.1/src/server/httpd/flash.tcl
   branches/openocd-0.1/src/server/httpd/flashinfo.tcl
   branches/openocd-0.1/src/server/httpd/guiupload.tcl
   branches/openocd-0.1/src/server/httpd/html2tcl.sh
   branches/openocd-0.1/src/server/httpd/httpd.tcl
   branches/openocd-0.1/src/server/httpd/index.tcl
   branches/openocd-0.1/src/server/httpd/log.tcl
   branches/openocd-0.1/src/server/httpd/menu.xml
   branches/openocd-0.1/src/server/httpd/menu.xsl
   branches/openocd-0.1/src/server/httpd/menu_cuts/
   branches/openocd-0.1/src/server/httpd/menu_cuts/center_bottom.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/center_top.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab1.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab1_selected.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab2.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab2_selected.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab_free.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/logo_bottom.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/logo_top.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/right_bottom.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/right_top.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/right_top_small.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/top_right.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_1.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_2_tile.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_3.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_tab.png
   branches/openocd-0.1/src/server/httpd/menu_cuts/v_tab_selected.png
   branches/openocd-0.1/src/server/httpd/menuweb.css
   branches/openocd-0.1/src/server/httpd/openocd.tcl
   branches/openocd-0.1/src/server/httpd/preconfig.tcl
   branches/openocd-0.1/src/server/httpd/production.tcl
   branches/openocd-0.1/src/server/httpd/readme.txt
   branches/openocd-0.1/src/server/httpd/reload.tcl
   branches/openocd-0.1/src/server/httpd/run.tcl
   branches/openocd-0.1/src/server/httpd/support.tcl
   branches/openocd-0.1/src/server/httpd/targets.tcl
   branches/openocd-0.1/src/server/httpd/terminal.tcl
   branches/openocd-0.1/src/server/httpd/upgrade.tcl
   branches/openocd-0.1/src/target/target/s3c2440.cfg
   branches/openocd-0.1/testing/build.test1/Makefile
   branches/openocd-0.1/testing/build.test1/Makefile.confuse
   branches/openocd-0.1/testing/build.test1/Makefile.ftd2xx
   branches/openocd-0.1/testing/build.test1/Makefile.libftdi
   branches/openocd-0.1/testing/build.test1/Makefile.libusb
   branches/openocd-0.1/testing/build.test1/Makefile.openocd
   branches/openocd-0.1/testing/build.test1/README.TXT
   branches/openocd-0.1/testing/build.test1/local.uses
   branches/openocd-0.1/testing/build.test1/mingw32_help/
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/elf.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/cdefs.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf32.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf64.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_common.h
   branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_generic.h
   branches/openocd-0.1/testing/build.test2/Makefile
   branches/openocd-0.1/testing/build.test2/README.txt
   branches/openocd-0.1/testing/build.test2/local.uses
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/Makefile
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/crt0.S
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/gdbinit-imx27ads
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/ldscript
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/test.c
   branches/openocd-0.1/testing/examples/ledtest-imx27ads/test.elf
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/Makefile
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/crt0.S
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/gdbinit-imx31pdk
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/ldscript
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/test.c
   branches/openocd-0.1/testing/examples/ledtest-imx31pdk/test.elf
   branches/openocd-0.1/tools/rlink_make_speed_table/
   branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table
   branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table.pl
   branches/openocd-0.1/tools/st7_dtc_as/
   branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as
   branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as.pl
   branches/openocd-0.1/tools/xsvf_tools/
   branches/openocd-0.1/tools/xsvf_tools/svf2xsvf.py
   branches/openocd-0.1/tools/xsvf_tools/xsvfdump.py
Modified:
   branches/openocd-0.1/configure.in
   branches/openocd-0.1/doc/openocd.1
   branches/openocd-0.1/doc/openocd.texi
   branches/openocd-0.1/src/Makefile.am
   branches/openocd-0.1/src/ecosboard.c
   branches/openocd-0.1/src/flash/Makefile.am
   branches/openocd-0.1/src/flash/cfi.h
   branches/openocd-0.1/src/flash/ecos.c
   branches/openocd-0.1/src/flash/flash.c
   branches/openocd-0.1/src/flash/lpc2000.c
   branches/openocd-0.1/src/flash/lpc288x.c
   branches/openocd-0.1/src/flash/lpc3180_nand_controller.c
   branches/openocd-0.1/src/flash/mflash.c
   branches/openocd-0.1/src/flash/mflash.h
   branches/openocd-0.1/src/flash/nand.c
   branches/openocd-0.1/src/flash/s3c24xx_regs_nand.h
   branches/openocd-0.1/src/flash/stellaris.h
   branches/openocd-0.1/src/flash/stm32x.h
   branches/openocd-0.1/src/flash/str7x.c
   branches/openocd-0.1/src/flash/str7x.h
   branches/openocd-0.1/src/flash/str9x.h
   branches/openocd-0.1/src/flash/tms470.c
   branches/openocd-0.1/src/helper/Makefile.am
   branches/openocd-0.1/src/helper/bin2char.c
   branches/openocd-0.1/src/helper/binarybuffer.c
   branches/openocd-0.1/src/helper/command.c
   branches/openocd-0.1/src/helper/configuration.c
   branches/openocd-0.1/src/helper/fileio.h
   branches/openocd-0.1/src/helper/jim.c
   branches/openocd-0.1/src/helper/jim.h
   branches/openocd-0.1/src/helper/log.c
   branches/openocd-0.1/src/helper/log.h
   branches/openocd-0.1/src/helper/options.c
   branches/openocd-0.1/src/helper/replacements.c
   branches/openocd-0.1/src/helper/replacements.h
   branches/openocd-0.1/src/helper/tclapi.c
   branches/openocd-0.1/src/helper/types.h
   branches/openocd-0.1/src/jtag/Makefile.am
   branches/openocd-0.1/src/jtag/bitbang.c
   branches/openocd-0.1/src/jtag/bitq.c
   branches/openocd-0.1/src/jtag/dummy.c
   branches/openocd-0.1/src/jtag/ep93xx.c
   branches/openocd-0.1/src/jtag/ft2232.c
   branches/openocd-0.1/src/jtag/gw16012.c
   branches/openocd-0.1/src/jtag/jlink.c
   branches/openocd-0.1/src/jtag/jtag.c
   branches/openocd-0.1/src/jtag/jtag.h
   branches/openocd-0.1/src/jtag/presto.c
   branches/openocd-0.1/src/jtag/usbprog.c
   branches/openocd-0.1/src/jtag/zy1000.c
   branches/openocd-0.1/src/main.c
   branches/openocd-0.1/src/openocd.c
   branches/openocd-0.1/src/server/Makefile.am
   branches/openocd-0.1/src/server/gdb_server.c
   branches/openocd-0.1/src/server/server.c
   branches/openocd-0.1/src/server/server.h
   branches/openocd-0.1/src/server/tcl_server.c
   branches/openocd-0.1/src/server/telnet_server.c
   branches/openocd-0.1/src/target/arm720t.c
   branches/openocd-0.1/src/target/arm7_9_common.c
   branches/openocd-0.1/src/target/arm7_9_common.h
   branches/openocd-0.1/src/target/arm7tdmi.c
   branches/openocd-0.1/src/target/arm7tdmi.h
   branches/openocd-0.1/src/target/arm920t.c
   branches/openocd-0.1/src/target/arm926ejs.c
   branches/openocd-0.1/src/target/arm926ejs.h
   branches/openocd-0.1/src/target/arm966e.c
   branches/openocd-0.1/src/target/arm9tdmi.c
   branches/openocd-0.1/src/target/arm9tdmi.h
   branches/openocd-0.1/src/target/armv4_5.c
   branches/openocd-0.1/src/target/armv4_5.h
   branches/openocd-0.1/src/target/breakpoints.c
   branches/openocd-0.1/src/target/breakpoints.h
   branches/openocd-0.1/src/target/cortex_m3.c
   branches/openocd-0.1/src/target/cortex_m3.h
   branches/openocd-0.1/src/target/cortex_swjdp.h
   branches/openocd-0.1/src/target/embeddedice.h
   branches/openocd-0.1/src/target/etb.h
   branches/openocd-0.1/src/target/feroceon.c
   branches/openocd-0.1/src/target/image.c
   branches/openocd-0.1/src/target/image.h
   branches/openocd-0.1/src/target/mips32.c
   branches/openocd-0.1/src/target/mips32.h
   branches/openocd-0.1/src/target/mips32_dmaacc.c
   branches/openocd-0.1/src/target/mips32_dmaacc.h
   branches/openocd-0.1/src/target/mips32_pracc.c
   branches/openocd-0.1/src/target/mips32_pracc.h
   branches/openocd-0.1/src/target/mips_ejtag.c
   branches/openocd-0.1/src/target/mips_ejtag.h
   branches/openocd-0.1/src/target/mips_m4k.c
   branches/openocd-0.1/src/target/mips_m4k.h
   branches/openocd-0.1/src/target/oocd_trace.c
   branches/openocd-0.1/src/target/oocd_trace.h
   branches/openocd-0.1/src/target/register.c
   branches/openocd-0.1/src/target/register.h
   branches/openocd-0.1/src/target/target.c
   branches/openocd-0.1/src/target/target.h
   branches/openocd-0.1/src/target/target/imx31.cfg
   branches/openocd-0.1/src/target/target/pic32mx.cfg
   branches/openocd-0.1/src/target/target/str710.cfg
   branches/openocd-0.1/src/target/target/str730.cfg
   branches/openocd-0.1/src/target/target/str750.cfg
   branches/openocd-0.1/src/target/xscale.c
   branches/openocd-0.1/src/xsvf/xsvf.c
Log:
Sync 0.1.x branch with ToT

Copied: branches/openocd-0.1 (from rev 1324, branches/openocd_1_0_branch)

Modified: branches/openocd-0.1/configure.in
===================================================================
--- branches/openocd_1_0_branch/configure.in	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/configure.in	2009-01-16 06:43:11 UTC (rev 1325)
@@ -28,9 +28,145 @@
 is_mingw=no
 is_win32=no
 
+# We are not *ALWAYS* being installed in the standard place.
+# We may be installed in a &quot;tool-build&quot; specific location.
+# Normally with other packages - as part of a tool distro.
+# Thus - we should search that 'libdir' also.
+#
+# And - if we are being installed there - the odds are
+# The libraries unique to what we are are there too.
+#
+
+# Expand nd deal with NONE - just like configure will do later
+OCDprefix=$prefix
+OCDxprefix=$exec_prefix
+test x&quot;$OCDprefix&quot;  = xNONE &amp;&amp; OCDprefix=$ac_default_prefix
+# Let make expand exec_prefix.
+test x&quot;$OCDxprefix&quot; = xNONE &amp;&amp; OCDxprefix=&quot;$OCDprefix&quot;
+
+# what matters is the &quot;exec-prefix&quot;
+if test &quot;$OCDxprefix&quot; != &quot;$ac_default_prefix&quot;
+then
+    # We are installing in a non-standard place
+    # Nonstandard --prefix and/or --exec-prefix
+    # We have an override of some sort.
+    # use build specific install library dir
+    
+    LDFLAGS=&quot;$LDFLAGS -L$OCDxprefix/lib&quot;
+    # RPATH becomes an issue on Linux only
+    if test $host_os = linux-gnu || test $host_os = linux ; then
+	LDFLAGS=&quot;$LDFLAGS -Wl,-rpath,$OCDxprefix/lib&quot;
+    fi
+    # The &quot;INCDIR&quot; is also usable
+    CFLAGS=&quot;$CFLAGS -I$includedir&quot;
+fi
+
+AC_ARG_WITH(ftd2xx,
+   AS_HELP_STRING([--with-ftd2xx=&lt;PATH&gt;],[This option has been removed.]),
+[
+# Option Given.
+cat &lt;&lt; __EOF__
+
+The option: --with-ftd2xx=&lt;PATH&gt; has been removed replaced.
+On Linux, the new option is:
+  
+  --with-ftd2xx-linux-tardir=/path/to/files
+
+Where &lt;path&gt; is the path the the directory where the &quot;tar.gz&quot; file
+from FTDICHIP.COM was unpacked, for example:
+
+  --with-ftd2xx-linux-tardir=/home/duane/libftd2xx-linux-tardir=/home/duane/libftd2xx0.4.16
+
+On Cygwin/MingW32, the new option is:
+
+  --with-ftd2xx-win32-zipdir=/path/to/files
+
+Where &lt;path&gt; is the path to the directory where the &quot;zip&quot; file from
+FTDICHIP.COM was unpacked, for example:
+
+  --with-ftd2xx-win32-zipdir=/home/duane/ftd2xx.cdm.files
+
+__EOF__
+
+   AC_MSG_ERROR([Sorry Cannot continue])
+],
+[ 
+# Option not given
+true
+]
+)
+
+#========================================
+# FTD2XXX support comes in 3 forms.
+#    (1) win32 - via a zip file
+#    (2) linux - via a tar file
+#    (3) linux/cygwin/mingw - via libftdi
+#
+# In case (1) and (2) we need to know where the package was unpacked.
+
+AC_ARG_WITH(ftd2xx-win32-zipdir,
+  AS_HELP_STRING([--with-ftd2xx-win32-zipdir],[Where (CYGWIN/MINGW) the zip file from ftdichip.com was unpacked &lt;default=search&gt;]),
+  [
+  # option present
+  if test -d $with_ftd2xx_win32_zipdir
+  then
+	with_ftd2xx_win32_zipdir=`cd $with_ftd2xx_win32_zipdir &amp;&amp; pwd`
+	AC_MSG_NOTICE([Using: ftdichip.com library: $with_ftd2xx_win32_zipdir])
+  else
+	AC_MSG_ERROR([Parameter to --with-ftd2xx-win32-zipdir is not a dir: $with_ftd2xx_win32_zipdir])
+  fi
+  ],
+  [
+  # not given
+  true
+  ]
+)
+
+AC_ARG_WITH(ftd2xx-linux-tardir,
+  AS_HELP_STRING([--with-ftd2xx-linux-tardir], [Where (Linux/Unix) the tar file from ftdichip.com was unpacked &lt;default=search&gt;]),
+  [
+  # Option present
+  if test $is_win32 = yes ; then
+     AC_MSG_ERROR([The option: --with-ftd2xx-linux-tardir is only usable on linux])
+  fi
+  if test -d $with_ftd2xx_linux_tardir
+  then
+	with_ftd2xx_linux_tardir=`cd $with_ftd2xx_linux_tardir &amp;&amp; pwd`
+	AC_MSG_NOTICE([Using: ftdichip.com library: $with_ftd2xx_linux_tardir])
+  else
+	AC_MSG_ERROR([Parameter to --with-ftd2xx-linux-tardir is not a dir: $with_ftd2xx_linux_tardir])
+  fi
+  ],
+  [
+  # Not given 
+  true
+  ]
+)
+
+AC_ARG_WITH(ftd2xx-lib,
+	AS_HELP_STRING([--with-ftd2xx-lib], [Use static or shared ftd2xx libs on default static]),
+[
+case &quot;$withval&quot; in
+static)
+	with_ftd2xx_lib=$withval
+	;;
+shared)
+	with_ftd2xx_lib=$withval
+	;;
+*)
+	AC_MSG_ERROR([Option: --with-ftd2xx-lib=static or --with-ftd2xx-lib=shared not, $withval])
+	;;
+esac
+],
+[
+	# Default is static - it is simpler :-(
+	with_ftd2xx_lib=static
+]
+)
+
 AC_ARG_ENABLE(gccwarnings,
-	AS_HELP_STRING([--enable-gccwarnings], [Enable compiler warnings, default no]),
-	[gcc_warnings=$enableval], [gcc_warnings=no])
+	AS_HELP_STRING([--enable-gccwarnings], [Enable compiler warnings, default yes]),
+	[gcc_warnings=$enableval], [gcc_warnings=yes])
 
 AC_ARG_ENABLE(parport,
   AS_HELP_STRING([--enable-parport], [Enable building the pc parallel port driver]), 
@@ -52,11 +188,11 @@
 esac
 
 AC_ARG_ENABLE(ft2232_libftdi,
-  AS_HELP_STRING([--enable-ft2232_libftdi], [Enable building support for FT2232 based devices using the libftdi driver]), 
+  AS_HELP_STRING([--enable-ft2232_libftdi], [Enable building support for FT2232 based devices using the libftdi driver, opensource alternate of FTD2XX]), 
   [build_ft2232_libftdi=$enableval], [build_ft2232_libftdi=no])
 
 AC_ARG_ENABLE(ft2232_ftd2xx,
-  AS_HELP_STRING([--enable-ft2232_ftd2xx], [Enable building support for FT2232 based devices using the FTD2XX driver]), 
+  AS_HELP_STRING([--enable-ft2232_ftd2xx], [Enable building support for FT2232 based devices using the FTD2XX driver from ftdichip.com]), 
   [build_ft2232_ftd2xx=$enableval], [build_ft2232_ftd2xx=no])
  
 AC_ARG_ENABLE(amtjtagaccel,
@@ -67,6 +203,14 @@
   AS_HELP_STRING([--enable-ecosboard], [Enable building support for eCosBoard based JTAG debugger]), 
   [build_ecosboard=$enableval], [build_ecosboard=no])
 
+AC_ARG_ENABLE(ioutil,
+  AS_HELP_STRING([--enable-ioutil], [Enable ioutil functions - useful for standalone OpenOCD implementations]), 
+  [build_ioutil=$enableval], [build_ioutil=no])
+
+AC_ARG_ENABLE(httpd,
+  AS_HELP_STRING([--enable-httpd], [Enable builtin httpd server - useful for standalone OpenOCD implementations]), 
+  [build_httpd=$enableval], [build_httpd=no])
+
 case &quot;${host_cpu}&quot; in 
   arm*)
     AC_ARG_ENABLE(ep93xx,
@@ -108,12 +252,14 @@
   AS_HELP_STRING([--enable-jlink], [Enable building support for the Segger J-Link JTAG Programmer]),
   [build_jlink=$enableval], [build_jlink=no])
 
-AC_ARG_WITH(ftd2xx,
-        [AS_HELP_STRING(--with-ftd2xx,
-           [Where libftd2xx can be found &lt;default=search&gt;])],
-        [],
-        with_ftd2xx=search)
+AC_ARG_ENABLE(vsllink,
+  AS_HELP_STRING([--enable-vsllink], [Enable building support for the Versaloon-Link JTAG Programmer]),
+  [build_vsllink=$enableval], [build_vsllink=no])
 
+AC_ARG_ENABLE(rlink,
+  AS_HELP_STRING([--enable-rlink], [Enable building support for the Raisonance RLink JTAG Programmer]),
+  [build_rlink=$enableval], [build_rlink=no])
+
 case $host in 
   *-cygwin*) 
     is_win32=yes
@@ -164,7 +310,6 @@
   AC_DEFINE(BUILD_DUMMY, 0, [0 if you don't want dummy driver.])
 fi
 
-
 if test $build_ep93xx = yes; then
   build_bitbang=yes
   AC_DEFINE(BUILD_EP93XX, 1, [1 if you want ep93xx.])
@@ -179,6 +324,18 @@
   AC_DEFINE(BUILD_ECOSBOARD, 0, [0 if you don't want eCosBoard.])
 fi
 
+if test $build_ioutil = yes; then
+  AC_DEFINE(BUILD_IOUTIL, 1, [1 if you want ioutils.])
+else
+  AC_DEFINE(BUILD_IOUTIL, 0, [0 if you don't want ioutils.])
+fi
+
+if test $build_httpd = yes; then
+  AC_DEFINE(BUILD_HTTPD, 1, [1 if you want httpd.])
+else
+  AC_DEFINE(BUILD_HTTPD, 0, [0 if you don't want httpd.])
+fi
+
 if test $build_at91rm9200 = yes; then
   build_bitbang=yes
   AC_DEFINE(BUILD_AT91RM9200, 1, [1 if you want at91rm9200.])
@@ -266,6 +423,207 @@
   AC_DEFINE(BUILD_JLINK, 0, [0 if you don't want the J-Link JTAG driver.])
 fi
 
+if test $build_vsllink = yes; then
+  AC_DEFINE(BUILD_VSLLINK, 1, [1 if you want the Versaloon-Link JTAG driver.])
+else
+  AC_DEFINE(BUILD_VSLLINK, 0, [0 if you don't want the Versaloon-Link JTAG driver.])
+fi
+
+if test $build_rlink = yes; then
+  AC_DEFINE(BUILD_RLINK, 1, [1 if you want the RLink JTAG driver.])
+else
+  AC_DEFINE(BUILD_RLINK, 0, [0 if you don't want the RLink JTAG driver.])
+fi
+
+#-- Deal with MingW/Cygwin FTD2XX issues
+
+if test $is_win32 = yes; then
+if test &quot;${with_ftd2xx_linux_tardir+set}&quot; = set
+then
+   AC_MSG_ERROR([The option: with_ftd2xx_linux_tardir is for LINUX only.])
+fi
+
+if test $build_ft2232_ftd2xx = yes ; then
+AC_MSG_CHECKING([for ftd2xx.lib exists (win32)])
+
+   # if we are given a zipdir...
+   if test &quot;${with_ftd2xx_win32_zipdir+set}&quot; = set
+   then
+      # Set the CFLAGS for &quot;ftd2xx.h&quot;
+      f=$with_ftd2xx_win32_zipdir/ftd2xx.h
+      if test ! -f $f ; then
+      	 AC_MSG_ERROR([File: $f cannot be found])
+      fi
+      CFLAGS=&quot;$CFLAGS -I$with_ftd2xx_win32_zipdir&quot;
+
+      # And calculate the LDFLAGS for the machine
+      case &quot;$host_cpu&quot; in
+      i?86|x86_*)
+	LDFLAGS=&quot;$LDFLAGS -L$with_ftd2xx_win32_zipdir/i386&quot;
+	LIBS=&quot;$LIBS -lftd2xx&quot;
+	f=$with_ftd2xx_win32_zipdir/i386/ftd2xx.lib
+	;;
+      amd64)
+	LDFLAGS=&quot;$LDFLAGS -L$with_ftd2xx_win32_zipdir/amd64&quot;
+	LIBS=&quot;$LIBS -lftd2xx&quot;
+	f=$with_ftd2xx_win32_zipdir/amd64/ftd2xx.lib
+	;;
+      *)
+	AC_MSG_ERROR([Unknown Win32 host cpu: $host_cpu])
+        ;;
+       esac
+       if test ! -f $f ; then
+       	  AC_MSG_ERROR([Library: $f not found])
+       fi
+   else
+      LIBS=&quot;$LIBS -lftd2xx&quot;
+      AC_MSG_WARN([ASSUMPTION: The (win32) FTDICHIP.COM files: ftd2xx.h and ftd2xx.lib are in a proper place])
+   fi
+fi
+fi
+
+if test $is_win32 = no; then
+
+if test &quot;${with_ftd2xx_win32_zipdir+set}&quot; = set
+then
+   AC_MSG_ERROR([The option: --with-ftd2xx-win32-zipdir is for win32 only])
+fi
+
+if test $build_ft2232_ftd2xx = yes ; then
+   AC_MSG_CHECKING([for libftd2xx.a (linux)])
+   # Must be linux -
+   # Cause FTDICHIP does not supply a MAC-OS version
+   if test $host_os != linux-gnu &amp;&amp; test $host_os != linux ; then
+      AC_MSG_ERROR([The (linux) ftd2xx library from FTDICHIP.com is linux only. Try --enable-ft2232-libftdi instead])
+   fi
+   # Are we given a TAR directory?
+   if test &quot;${with_ftd2xx_linux_tardir+set}&quot; = set
+   then
+	# The .H file is simple..
+	f=$with_ftd2xx_linux_tardir/ftd2xx.h
+	if test ! -f $f ; then
+	   AC_MSG_ERROR([Option: --with-ftd2xx-linux-tardir appears wrong, cannot find: $f])
+	fi
+	CFLAGS=&quot;$CFLAGS -I$with_ftd2xx_linux_tardir&quot;
+	if test $with_ftd2xx_lib = shared
+	then
+	    LDFLAGS=&quot;$LDFLAGS -L$with_ftd2xx_linux_tardir&quot;
+	    LIBS=&quot;$LIBS -lftd2xx&quot;
+	    AC_MSG_RESULT([ Assuming: -L$with_ftd2xx_linux_tardir -lftd2xx])
+	else
+	    # Test #1 - Future proof - if/when ftdichip fixes their distro.
+	    # Try it with the simple &quot;.a&quot; suffix.
+	    f=$with_ftd2xx_linux_tardir/static_lib/libftd2xx.a
+	    if test -f $f ; then
+	       # Yea we are done
+	       LDFLAGS=&quot;$LDFLAGS -L$with_ftd2xx_linux_tardir/static_lib&quot;
+	       LIBS=&quot;$LIBS -lftd2xx&quot;
+            else
+	       # Test Number2.
+	       # Grr.. perhaps it exists as a version number?
+	       f=&quot;$with_ftd2xx_linux_tardir/static_lib/libftd2xx.a.*.*.*&quot;
+	       count=`ls $f | wc -l`
+	       if test $count -gt 1 ; then
+	          AC_MSG_ERROR([Multiple libftd2xx.a files found in: $with_ftd2xx_linux_tardir/static_lib sorry cannot handle this yet])
+	       fi
+	       if test $count -ne 1 ; then
+	          AC_MSG_ERROR([Not found: $f, option: --with-ftd2xx-linux-tardir appears to be wrong])
+	       fi
+	       # Because the &quot;-l&quot; rules do not understand version numbers...
+	       # we will just stuff the absolute path onto the LIBS variable
+	       f=`ls $f`
+	       #
+	       LIBS=&quot;$LIBS $f -lpthread&quot;
+	       # No need to bother with LDFLAGS...
+	    fi
+	    AC_MSG_RESULT([Found: $f])
+        fi
+   else
+	LIBS=&quot;$LIBS -lftd2xx&quot;
+	AC_MSG_RESULT([Assumed: installed])
+	AC_MSG_WARN([The (linux) FTDICHIP.COM files ftd2xx.h and libftd2xx.so are assumed to be in a proper place])
+   fi
+fi
+fi
+
+if test $build_ft2232_ftd2xx = yes; then
+
+# Before we go any further - make sure we can *BUILD* and *RUN*
+# a simple app with the &quot;ftd2xx.lib&quot; file - in what ever form we where given
+# We should be able to compile, link and run this test program now
+  AC_MSG_CHECKING([Test: Build &amp; Link with ftd2xx])
+
+#
+# Save the LDFLAGS for later..
+LDFLAGS_SAVE=$LDFLAGS
+CFLAGS_SAVE=$CFLAGS
+_LDFLAGS=`eval echo $LDFLAGS`
+_CFLAGS=`eval echo $CFLAGS`
+LDFLAGS=$_LDFLAGS
+CFLAGS=$_CFLAGS
+  AC_RUN_IFELSE(
+[
+#include &quot;confdefs.h&quot;
+#if IS_WIN32
+#include &quot;windows.h&quot;
+#endif
+#include &lt;stdio.h&gt;
+#include &lt;ftd2xx.h&gt;
+
+int
+main( int argc, char **argv )
+{
+	DWORD x;
+	FT_GetLibraryVersion( &amp;x );
+	return 0;
+}
+], [ AC_MSG_RESULT([Success!])] , [ AC_MSG_ERROR([Cannot build &amp; run test program using ftd2xx.lib]) ] )
+LDFLAGS=$LDFLAGS_SAVE
+CFLAGS=$CFLAGS_SAVE
+fi
+
+if test $build_ft2232_libftdi = yes ; then
+   # We assume: the package is preinstalled in the proper place
+   # these present as 2 libraries..
+   LIBS=&quot;$LIBS -lftdi -lusb&quot;
+   # 
+   # Try to build a small program.
+   AC_MSG_CHECKING([Build &amp; Link with libftdi...])
+
+LDFLAGS_SAVE=$LDFLAGS
+CFLAGS_SAVE=$CFLAGS
+_LDFLAGS=`eval echo $LDFLAGS`
+_CFLAGS=`eval echo $CFLAGS`
+LDFLAGS=$_LDFLAGS
+CFLAGS=$_CFLAGS
+
+   AC_RUN_IFELSE(
+[
+#include &lt;stdio.h&gt;
+#include &lt;ftdi.h&gt;
+
+int
+main( int argc, char **argv )
+{
+	struct ftdi_context *p;
+	p = ftdi_new();
+	if( p != NULL ){
+	    return 0;
+	} else {
+	    fprintf( stderr, &quot;calling ftdi_new() failed\n&quot;);
+	    return 1;
+        }
+}
+]
+, 
+[ AC_MSG_RESULT([Success]) ]
+, 
+[ AC_MSG_ERROR([Cannot build &amp; run test program using libftdi]) ] )
+# Restore the 'unexpanded ldflags'
+LDFLAGS=$LDFLAGS_SAVE
+CFLAGS=$CFLAGS_SAVE
+fi
+
 AM_CONFIG_HEADER(config.h)
 AM_INIT_AUTOMAKE(openocd, 1.0)
 
@@ -274,6 +632,8 @@
 AM_CONDITIONAL(GIVEIO, test $parport_use_giveio = yes)
 AM_CONDITIONAL(EP93XX, test $build_ep93xx = yes)
 AM_CONDITIONAL(ECOSBOARD, test $build_ecosboard = yes)
+AM_CONDITIONAL(IOUTIL, test $build_ioutil = yes)
+AM_CONDITIONAL(HTTPD, test $build_httpd = yes)
 AM_CONDITIONAL(AT91RM9200, test $build_at91rm9200 = yes)
 AM_CONDITIONAL(BITBANG, test $build_bitbang = yes)
 AM_CONDITIONAL(FT2232_LIBFTDI, test $build_ft2232_libftdi = yes)
@@ -285,10 +645,11 @@
 AM_CONDITIONAL(USBPROG, test $build_usbprog = yes)
 AM_CONDITIONAL(OOCD_TRACE, test $build_oocd_trace = yes)
 AM_CONDITIONAL(JLINK, test $build_jlink = yes)
+AM_CONDITIONAL(VSLLINK, test $build_vsllink = yes)
+AM_CONDITIONAL(RLINK, test $build_rlink = yes)
 AM_CONDITIONAL(IS_CYGWIN, test $is_cygwin = yes)
 AM_CONDITIONAL(IS_MINGW, test $is_mingw = yes)
 AM_CONDITIONAL(IS_WIN32, test $is_win32 = yes)
-AM_CONDITIONAL(FTD2XXDIR, test $with_ftd2xx != search)
 AM_CONDITIONAL(BITQ, test $build_bitq = yes)
 
 AC_LANG_C
@@ -344,6 +705,4 @@
 AC_MSG_RESULT([$EXEEXT_FOR_BUILD])
 AC_SUBST(EXEEXT_FOR_BUILD)
 
-AC_SUBST(WITH_FTD2XX, $with_ftd2xx)
-
 AC_OUTPUT(Makefile src/Makefile src/helper/Makefile src/jtag/Makefile src/xsvf/Makefile src/target/Makefile src/server/Makefile src/flash/Makefile src/pld/Makefile doc/Makefile)

Modified: branches/openocd-0.1/doc/openocd.1
===================================================================
--- branches/openocd_1_0_branch/doc/openocd.1	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/doc/openocd.1	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,37 +1,39 @@
-.TH &quot;OPENOCD&quot; &quot;1&quot; &quot;February 29, 2008&quot;
+.TH &quot;OPENOCD&quot; &quot;1&quot; &quot;January 08, 2009&quot;
 .SH &quot;NAME&quot;
 openocd \- A free and open on\-chip debugging, in\-system programming and
-boundary\-scan testing tool for ARM systems
+boundary\-scan testing tool for ARM and MIPS systems
 .SH &quot;SYNOPSIS&quot;
-.B openocd \fR[\fB\-fsdlchv\fR] [\fB\-\-file\fR &lt;filename&gt;] [\fB\-\-search\fR &lt;dirname&gt;] [\fB\-\-debug\fR &lt;debuglevel&gt;] [\fB\-\-log_output\fR &lt;filename&gt;] [\fB\-\-command\fR &lt;cmd&gt;] [\fB\-\-help\fR] [\fB\-\-version\fR]
+.B openocd \fR[\fB\-fsdlcphv\fR] [\fB\-\-file\fR &lt;filename&gt;] [\fB\-\-search\fR &lt;dirname&gt;] [\fB\-\-debug\fR &lt;debuglevel&gt;] [\fB\-\-log_output\fR &lt;filename&gt;] [\fB\-\-command\fR &lt;cmd&gt;] [\fB\-\-pipe\fR] [\fB\-\-help\fR] [\fB\-\-version\fR]
 .SH &quot;DESCRIPTION&quot;
 .B OpenOCD
 is an on\-chip debugging, in\-system programming and boundary\-scan
-testing tool for ARM systems.
+testing tool for various ARM and MIPS systems.
 .PP 
 The debugger uses an IEEE 1149\-1 compliant JTAG TAP bus master to access
-on\-chip debug functionality available on ARM7/9, XScale, Cortex-M3, and
-Marvell Feroceon (as found in the Orion SoC family) based
-microcontrollers / system\-on\-chip solutions.
+on\-chip debug functionality available on ARM based microcontrollers or
+system-on-chip solutions. For MIPS systems the EJTAG interface is supported.
 .PP 
-User interaction is realized through a telnet command line interface and
-a gdb (the GNU debugger) remote protocol server.
+User interaction is realized through a telnet command line interface,
+a gdb (the GNU debugger) remote protocol server, and a simplified RPC
+connection that can be used to interface with OpenOCD's Jim Tcl engine.
 .PP 
 OpenOCD supports various different types of JTAG interfaces/programmers,
-please check the README for the complete list.
+please check the \fIopenocd\fR info page for the complete list.
 .SH &quot;OPTIONS&quot;
 .TP 
 .B &quot;\-f, \-\-file &lt;filename&gt;&quot;
 Use configuration file
 .BR &lt;filename&gt; .
-If this option is omitted, the config file
+In order to specify multiple config files, you can use multiple
+.B \-\-file
+arguments. If this option is omitted, the config file
 .B openocd.cfg
 in the current working directory will be used.
 .TP 
 .B &quot;\-s, \-\-search &lt;dirname&gt;&quot;
 Search for config files and scripts in the directory
 .BR &lt;dirname&gt; .
-If this option is omitted, openocd searches for config files and scripts
+If this option is omitted, OpenOCD searches for config files and scripts
 in the current directory.
 .TP 
 .B &quot;\-d, \-\-debug &lt;debuglevel&gt;&quot;
@@ -58,6 +60,9 @@
 Run the command
 .BR &lt;cmd&gt; .
 .TP 
+.B &quot;\-p, \-\-pipe&quot;
+Use pipes when talking to gdb.
+.TP 
 .B &quot;\-h, \-\-help&quot;
 Show a help text and exit.
 .TP 
@@ -78,10 +83,12 @@
 .B openocd
 is maintained as a Texinfo manual. If the
 .BR info
+(or
+.BR pinfo )
 and
 .BR openocd
 programs are properly installed at your site, the command
-.B info flex
+.B info openocd
 should give you access to the complete manual.
 .PP
 Also, the OpenOCD wiki contains some more information and examples:

Modified: branches/openocd-0.1/doc/openocd.texi
===================================================================
--- branches/openocd_1_0_branch/doc/openocd.texi	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/doc/openocd.texi	2009-01-16 06:43:11 UTC (rev 1325)
@@ -15,7 +15,7 @@
 
 @itemize @bullet
 @item Copyright @copyright{} 2008 The OpenOCD Project
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at item</A> Copyright @copyright{} 2007-2008 Spen @email{spen@@spen-soft.co.uk}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> Copyright @copyright{} 2007-2008 Spencer Oliver @email{spen@@spen-soft.co.uk}
 @item Copyright @copyright{} 2008 Oyvind Harboe @email{oyvind.harboe@@zylin.com}
 @item Copyright @copyright{} 2008 Duane Ellis @email{openocd@@duaneellis.com}
 @end itemize
@@ -96,8 +96,7 @@
 
 @b{Dongles:} OpenOCD currently many types of hardware dongles: USB
 Based, Parallel Port Based, and other standalone boxes that run
-OpenOCD internally. See the section titled: @xref{JTAG Hardware
-Dongles}.
+OpenOCD internally. See the section titled: @xref{JTAG Hardware Dongles}.
 
 @b{GDB Debug:} It allows ARM7 (ARM7TDMI and ARM720t), ARM9 (ARM920t,
 ARM922t, ARM926ej--s, ARM966e--s), XScale (PXA25x, IXP42x) and
@@ -128,12 +127,54 @@
 @chapter Building
 @cindex building OpenOCD
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Pre-Built Tools
 If you are interested in getting actual work done rather than building
 OpenOCD, then check if your interface supplier provides binaries for
 you. Chances are that that binary is from some SVN version that is more
 stable than SVN trunk where bleeding edge development takes place.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Packagers Please Read!
 
+If you are a @b{PACKAGER} of OpenOCD if you
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at enumerate</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Sell dongles} and include pre-built binaries
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Supply tools} ie: A complete development solution
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Supply IDEs} like Eclipse, or RHIDE, etc.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Build packages} ie: RPM files, or DEB files for a Linux Distro
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> enumerate
+
+As a @b{PACKAGER} - you are at the top of the food chain. You solve
+problems for downstream users. What you fix or solve - solves hundreds
+if not thousands of user questions. If something does not work for you
+please let us know. That said, would also like you to follow a few
+suggestions:
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at enumerate</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Always build with Printer Ports Enabled}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Try where possible to use LIBFTDI + LIBUSB} You cover more bases
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> enumerate
+
+It is your decision..
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at itemize</A> @bullet
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Why YES to LIBFTDI + LIBUSB}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at itemize</A> @bullet
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{LESS} work - libusb perhaps already there
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{LESS} work - identical code multiple platforms
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{MORE} dongles are supported
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{MORE} platforms are supported
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{MORE} complete solution
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> itemize
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Why not LIBFTDI + LIBUSB} (ie: ftd2xx instead)
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at itemize</A> @bullet
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{LESS} Some say it is slower.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{LESS} complex to distribute (external dependencies)
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> itemize
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> itemize
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Building From Source
+
 You can download the current SVN version with SVN client of your choice from the
 following repositories:
 
@@ -167,8 +208,7 @@
 homepage (@uref{www.amontec.com}), as the JTAGkey uses a non-standard VID/PID. 
 @end itemize
 
-libftdi is supported under windows. Versions earlier than 0.13 will require patching.
-see contrib/libftdi for more details.
+libftdi is supported under windows. Do not use versions earlier then 0.14.
 
 In general, the D2XX driver provides superior performance (several times as fast),
 but has the draw-back of being binary-only - though that isn't that bad, as it isn't
@@ -180,36 +220,38 @@
 @end example
 Bootstrap generates the configure script, and prepares building on your system.
 @example
- ./configure 
+ ./configure [options, see below]
 @end example
 Configure generates the Makefiles used to build OpenOCD.
 @example
  make 
+ make install
 @end example
-Make builds OpenOCD, and places the final executable in ./src/.
+Make builds OpenOCD, and places the final executable in ./src/, the last step, ``make install'' is optional.
 
 The configure script takes several options, specifying which JTAG interfaces
 should be included:
 
 @itemize @bullet
 @item
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at option</A>{--enable-parport}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--enable-parport} - Bit bang pc printer ports.
 @item
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at option</A>{--enable-parport_ppdev}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--enable-parport_ppdev} - Parallel Port [see below]
 @item
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at option</A>{--enable-parport_giveio}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--enable-parport_giveio} - Parallel Port [see below]
 @item
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at option</A>{--enable-amtjtagaccel}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--enable-amtjtagaccel} - Parallel Port [Amontec, see below]
 @item
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at option</A>{--enable-ft2232_ftd2xx}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at footnote</A>{Using the latest D2XX drivers from FTDI and following their installation
-instructions, I had to use @option{--enable-ft2232_libftd2xx} for OpenOCD to
-build properly.}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--enable-ft2232_ftd2xx} - Numerous USB Type ARM JTAG dongles use the FT2232C chip from this FTDICHIP.COM chip (closed source).
 @item
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at option</A>{--enable-ft2232_libftdi}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--enable-ft2232_libftdi} - An open source (free) alternate to FTDICHIP.COM ftd2xx solution (Linux, MacOS, Cygwin)
 @item
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at option</A>{--with-ftd2xx=/path/to/d2xx/}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--with-ftd2xx-win32-zipdir=PATH} - If using FTDICHIP.COM ft2232c, point at the directory where the Win32 FTDICHIP.COM 'CDM' driver zip file was unpacked.
 @item
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--with-ftd2xx-linux-tardir=PATH} - Linux only equal of @option{--with-ftd2xx-win32-zipdir}, where you unpacked the TAR.GZ file.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--with-ftd2xx-lib=shared|static} - Linux only. Default: static, specifies how the FTDICHIP.COM libftd2xx driver should be linked. Note 'static' only works in conjunction with @option{--with-ftd2xx-linux-tardir}. Shared is supported (12/26/2008), however you must manually install the required header files and shared libraries in an appropriate place. This uses ``libusb'' internally.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A>
 @option{--enable-gw16012}
 @item
 @option{--enable-usbprog}
@@ -218,22 +260,75 @@
 @item
 @option{--enable-presto_ftd2xx}
 @item
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at option</A>{--enable-jlink}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--enable-jlink} - From SEGGER
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--enable-vsllink}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at option</A>{--enable-rlink} - Raisonance.com dongle.
 @end itemize
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Parallel Port Dongles
+
 If you want to access the parallel port using the PPDEV interface you have to specify
 both the @option{--enable-parport} AND the @option{--enable-parport_ppdev} option since
 the @option{--enable-parport_ppdev} option actually is an option to the parport driver
 (see @uref{<A HREF="http://forum.sparkfun.com/viewtopic.php?t=3795">http://forum.sparkfun.com/viewtopic.php?t=3795</A>} for more info).
 
-Cygwin users have to specify the location of the FTDI D2XX package. This should be an
-absolute path containing no spaces.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> FT2232C Based USB Dongles 
 
-Linux users should copy the various parts of the D2XX package to the appropriate
-locations, i.e. /usr/include, /usr/lib. 
+There are 2 methods of using the FTD2232, either (1) using the
+FTDICHIP.COM closed source driver, or (2) the open (and free) driver
+libftdi. Some claim the (closed) FTDICHIP.COM solution is faster.
 
-Miscellaneous configure options
+The FTDICHIP drivers come as either a (win32) ZIP file, or a (linux)
+TAR.GZ file. You must unpack them ``some where'' convient. As of this
+writing (12/26/2008) FTDICHIP does not supply means to install these
+files ``in an appropriate place'' As a result, there are two
+``./configure'' options that help. 
 
+Below is an example build process:
+
+1) Check out the latest version of ``openocd'' from SVN.
+
+2) Download &amp; Unpack either the Windows or Linux FTD2xx Drivers
+    (@uref{<A HREF="http://www.ftdichip.com/Drivers/D2XX.htm">http://www.ftdichip.com/Drivers/D2XX.htm</A>})
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at example</A>
+   /home/duane/ftd2xx.win32    =&gt; the Cygwin/Win32 ZIP file contents.
+   /home/duane/libftd2xx0.4.16 =&gt; the Linux TAR file contents.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> example
+
+3) Configure with these options:
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at example</A>
+Cygwin FTCICHIP solution
+   ./configure --prefix=/home/duane/mytools \ 
+                  --enable-ft2232_ftd2xx \
+                  --with-ftd2xx-win32-zipdir=/home/duane/ftd2xx.win32
+
+Linux FTDICHIP solution
+   ./configure --prefix=/home/duane/mytools \
+                  --enable-ft2232_ftd2xx \
+                  --with-ft2xx-linux-tardir=/home/duane/libftd2xx0.4.16
+
+Cygwin/Linux LIBFTDI solution
+    Assumes: 
+    1a) For Windows: The windows port of LIBUSB is in place.
+    1b) For Linux: libusb has been built and is inplace.
+
+    2) And libftdi has been built and installed
+    Note: libftdi - relies upon libusb.
+
+    ./configure --prefix=/home/duane/mytools \
+                   --enable-ft2232_libftdi
+       
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> example
+
+4) Then just type ``make'', and perhaps ``make install''.
+
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Miscellaneous configure options
+
 @itemize @bullet
 @item
 @option{--enable-gccwarnings} - enable extra gcc warnings during build
@@ -323,6 +418,18 @@
 @* Link: @url{<A HREF="http://www.iar.com/website1/1.0.1.0/369/1/index.php">http://www.iar.com/website1/1.0.1.0/369/1/index.php</A>}
 @end itemize
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> USB RLINK based
+Raisonance has an adapter called @b{RLink}.  It exists in a stripped-down form on the STM32 Primer, permanently attached to the JTAG lines.  It also exists on the STM32 Primer2, but that is wired for SWD and not JTAG, thus not supported.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at itemize</A> @bullet
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Raisonance RLink}
+@* Link: @url{<A HREF="http://www.raisonance.com/products/RLink.php">http://www.raisonance.com/products/RLink.php</A>}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{STM32 Primer}
+@* Link: @url{<A HREF="http://www.stm32circle.com/resources/stm32primer.php">http://www.stm32circle.com/resources/stm32primer.php</A>}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{STM32 Primer2}
+@* Link: @url{<A HREF="http://www.stm32circle.com/resources/stm32primer2.php">http://www.stm32circle.com/resources/stm32primer2.php</A>}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> itemize
+
 @section USB Other
 @itemize @bullet
 @item @b{USBprog}
@@ -330,6 +437,9 @@
 
 @item @b{USB - Presto} 
 @* Link: @url{<A HREF="http://tools.asix.net/prg_presto.htm">http://tools.asix.net/prg_presto.htm</A>}
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{Versaloon-Link}
+@* Link: @url{<A HREF="http://www.simonqian.com/en/Versaloon">http://www.simonqian.com/en/Versaloon</A>}
 @end itemize
 
 @section IBM PC Parallel Printer Port Based
@@ -411,9 +521,10 @@
 --debug      | -d       set debug level &lt;0-3&gt;
 --log_output | -l       redirect log output to file &lt;name&gt;
 --command    | -c       run &lt;command&gt;
+--pipe       | -p       use pipes when talking to gdb
 @end verbatim
 
-By default openocd reads the file configuration file ``openocd.cfg''
+By default OpenOCD reads the file configuration file ``openocd.cfg''
 in the current directory.  To specify a different (or multiple)
 configuration file, you can use the ``-f'' option. For example:
 
@@ -445,6 +556,8 @@
 the @option{-s &lt;search&gt;} switch. The current directory and the OpenOCD
 target library is in the search path by default.
 
+For details on the @option{-p} option. @xref{Connecting to GDB}.
+
 Note! OpenOCD will launch the GDB &amp; telnet server even if it can not
 establish a connection with the target. In general, it is possible for
 the JTAG controller to be unresponsive until the target is set up
@@ -455,7 +568,7 @@
 @cindex configuration
 
 @section Outline
-There are 4 basic ways of ``configurating'' openocd to run, they are:
+There are 4 basic ways of ``configurating'' OpenOCD to run, they are:
 
 @enumerate
 @item A small openocd.cfg file which ``sources'' other configuration files
@@ -541,7 +654,7 @@
 
 @enumerate
 @item The RESET configuration of your debug environment as a hole
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at item</A> Is there a ``work area'' that that OpenOCD can use?
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> Is there a ``work area'' that OpenOCD can use?
 @* For ARM - work areas mean up to 10x faster downloads.
 @item For MMU/MPU based ARM chips (ie: ARM9 and later) will that work area still be available?
 @item For complex targets (multiple chips) the JTAG SPEED becomes an issue.
@@ -671,7 +784,7 @@
 every chip. If the @t{-expected-id} is nonzero, OpenOCD attempts
 to verify the tap id number verses configuration file and may issue an
 error or warning like this. The hope is this will help pin point
-problem openocd configurations.
+problem OpenOCD configurations.
 
 @example
 Info:   JTAG tap: sam7x256.cpu tap/device found: 0x3f0f0f0f (Manufacturer: 0x787, Part: 0xf0f0, Version: 0x3)
@@ -904,7 +1017,7 @@
 JIM-Tcl commands, and (older) the orginal command interpretor.
 
 @item @b{Commands}
-@* At the openocd telnet command line (or via the GDB mon command) one
+@* At the OpenOCD telnet command line (or via the GDB mon command) one
 can type a Tcl for() loop, set variables, etc.
 
 @item @b{Historical Note}
@@ -917,7 +1030,7 @@
 
 @node Daemon Configuration
 @chapter Daemon Configuration
-The commands here are commonly found inthe openocd.cfg file and are
+The commands here are commonly found in the openocd.cfg file and are
 used to specify what TCP/IP ports are used, and how GDB should be
 supported.
 @section init
@@ -1014,6 +1127,11 @@
 # jlink interface
 interface jlink
 @end verbatim
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at b</A>{A Raisonance RLink}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at verbatim</A>
+# rlink interface
+interface rlink
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> verbatim
 @b{Parallel Port}
 @verbatim
 interface parport
@@ -1063,6 +1181,12 @@
 
 @item @b{jlink}
 @* Segger jlink usb adapter
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{rlink}
+@* Raisonance RLink usb adapter
+
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{vsllink}
+@* vsllink is part of Versaloon which is a versatile USB programmer.
 @comment - End parameters
 @end itemize
 @comment - End Interface
@@ -1145,7 +1269,7 @@
 @b{TODO:} Confirm the following: On windows the name needs to end with
 a ``space A''? Or not? It has to do with the FTD2xx driver. When must
 this be added and when must it not be added? Why can't the code in the
-interface or in openocd automatically add this if needed? -- Duane.
+interface or in OpenOCD automatically add this if needed? -- Duane.
 
 @item @b{ft2232_serial} &lt;@var{serial-number}&gt;
 @cindex ft2232_serial
@@ -1244,6 +1368,7 @@
 @item ft2232: 6MHz / (@var{number}+1)
 @item amt jtagaccel: 8 / 2**@var{number}
 @item jlink: maximum speed in kHz (0-12000), 0 will use RTCK
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> rlink: 24MHz / @var{number}, but only for certain values of @var{number}
 @comment end speed list.
 @end itemize
 
@@ -1381,7 +1506,7 @@
 @itemize @bullet
 @item @b{-irlen NUMBER} - the length in bits of the instruction register
 @item @b{-ircapture NUMBER} - the ID code capture command.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at item</A> @b{-irmask NUMBER} - the corrisponding mask for the ir register.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{-irmask NUMBER} - the corresponding mask for the ir register.
 @comment END REQUIRED
 @end itemize
 An example of a FOOBAR Tap
@@ -1392,8 +1517,6 @@
 bits long, during Capture-IR 0x42 is loaded into the IR, and bits
 [6,4,2,0] are checked.
 
-FIXME: The IDCODE - this was not used in the old code, it should be?
-Right? -Duane.
 @item @b{Optional configparams}
 @comment START Optional
 @itemize @bullet
@@ -1488,13 +1611,13 @@
 @* @b{Removed: 28/nov/2008} This command has been removed and replaced
 by the ``jtag newtap'' command. The documentation remains here so that
 one can easily convert the old syntax to the new syntax. About the old
-syntax: The old syntax is positional, ie: The 4th parameter is the
-``irmask'' The new syntax requires named prefixes, and supports
-additional options, for example ``-irmask 4'' Please refer to the
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at b</A>{jtag newtap} command for deails.
+syntax: The old syntax is positional, ie: The 3rd parameter is the
+``irmask''. The new syntax requires named prefixes, and supports
+additional options, for example ``-expected-id 0x3f0f0f0f''. Please refer to the
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at b</A>{jtag newtap} command for details.
 @example
-OLD: jtag_device 8 0x01 0x0e3 0xfe
-NEW: jtag newtap CHIPNAME TAPNAME -irlen 8 -ircapture 0xe3 -irmask 0xfe
+OLD: jtag_device 8 0x01 0xe3 0xfe
+NEW: jtag newtap CHIPNAME TAPNAME -irlen 8 -ircapture 0x01 -irmask 0xe3
 @end example
 
 @section Enable/Disable Taps
@@ -1527,7 +1650,7 @@
 circuit and skipped.
 
 
-From OpenOCDs view point, a JTAG TAP is in one of 3 states:
+From OpenOCD's view point, a JTAG TAP is in one of 3 states:
 
 @itemize @bullet
 @item @b{Enabled - Not In ByPass} and has a variable bit length
@@ -1540,7 +1663,7 @@
 
 @b{jtag tapisenabled DOTTED.NAME}
 
-This command return 1 if the named tap is currently enabled, 0 if not.
+This command returns 1 if the named tap is currently enabled, 0 if not.
 This command exists so that scripts that manipulate a JRC (like the
 Omap3530 has) can determine if OpenOCD thinks a tap is presently
 enabled, or disabled.
@@ -1555,7 +1678,7 @@
 @section targets [NAME]
 @b{Note:} This command name is PLURAL - not singular.  
 
-With NO parameter, this pural @b{targets} command lists all known
+With NO parameter, this plural @b{targets} command lists all known
 targets in a human friendly form.
 
 With a parameter, this pural @b{targets} command sets the current
@@ -1640,7 +1763,7 @@
     puts [format &quot;The button is %s&quot; $x]
 @end example
     
-In OpenOCDs terms, the ``target'' is an object just like a Tcl/Tk
+In OpenOCD's terms, the ``target'' is an object just like a Tcl/Tk
 button. Commands avaialble as a ``target object'' are:
 
 @comment START targetobj commands.
@@ -1687,13 +1810,13 @@
 @end itemize
 
 @section Target Events
-At various times, certian things happen, or you want to happen.
+At various times, certain things can happen, or you want them to happen.
 
 Examples:
 @itemize @bullet
 @item What should happen when GDB connects? Should your target reset?
 @item When GDB tries to flash the target, do you need to enable the flash via a special command?
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at item</A> During reset, do you need to write to certian memory locations to reconfigure the SDRAM?
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> During reset, do you need to write to certain memory location to reconfigure the SDRAM?
 @end itemize
 
 All of the above items are handled by target events.
@@ -1705,7 +1828,7 @@
 target event name, and BODY is a tcl procedure or string of commands
 to execute. 
 
-The programers model is the: ``-command'' option used in Tcl/Tk
+The programmers model is the ``-command'' option used in Tcl/Tk
 buttons and events. Below are two identical examples, the first
 creates and invokes small procedure. The second inlines the procedure.
 
@@ -1718,8 +1841,8 @@
    mychip.cpu configure -event gdb-attach @{ puts &quot;Reset...&quot; ; reset halt @}
 @end example
 
-Current Events
-
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Current Events
+The following events are available:
 @itemize @bullet
 @item @b{debug-halted}
 @* The target has halted for debug reasons (ie: breakpoint)
@@ -1783,6 +1906,22 @@
 @* Success
 @item @b{resumed}
 @* Target has resumed
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{tap-enable}
+@* Executed by @b{jtag tapenable DOTTED.NAME} command. Example:
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at example</A>
+jtag configure DOTTED.NAME -event tap-enable @{
+  puts &quot;Enabling CPU&quot;
+  ...
+@}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> example
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{tap-disable}
+@*Executed by @b{jtag tapdisable DOTTED.NAME} command. Example:
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at example</A>
+jtag configure DOTTED.NAME -event tap-disable @{
+  puts &quot;Disabling CPU&quot;
+  ...
+@}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> example
 @end itemize
 
 
@@ -1819,13 +1958,13 @@
 @comment end TYPES
 @end itemize
 @item @b{PARAMS}
-@*PARAMs are various target configure parameters, the following are manditory
-at configuration.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at comment</A> START manditory
+@*PARAMs are various target configure parameters, the following are mandatory
+at configuration:
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at comment</A> START mandatory
 @itemize @bullet
 @item @b{-endian big|little}
 @item @b{-chain-position DOTTED.NAME}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at comment</A> end MANDITORY
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at comment</A> end MANDATORY
 @end itemize
 @comment END params
 @end itemize
@@ -1841,7 +1980,7 @@
 @item @b{-work-area-size [ADDRESS]} specify/set the work area
 @item @b{-work-area-backup [0|1]} does the work area get backed up
 @item @b{-endian  [big|little]} 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at item</A> @b{-variant [NAME]} some chips have varients openocd needs to know about
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{-variant [NAME]} some chips have varients OpenOCD needs to know about
 @item @b{-chain-position DOTTED.NAME} the tap name this target refers to.
 @end itemize
 Example:
@@ -1870,7 +2009,7 @@
 @* None (this is also used as the ARM946)
 @item @b{cortex_m3}
 @* use variant &lt;@var{-variant lm3s}&gt; when debugging luminary lm3s targets. This will cause
-openocd to use a software reset rather than asserting SRST to avoid a issue with clearing
+OpenOCD to use a software reset rather than asserting SRST to avoid a issue with clearing
 the debug registers. This is fixed in Fury Rev B, DustDevil Rev B, Tempest, these revisions will
 be detected and the normal reset behaviour used.
 @item @b{xscale}
@@ -1880,9 +2019,9 @@
 @item @b{mips_m4k}
 @* Use variant @option{ejtag_srst} when debugging targets that do not
 provide a functional SRST line on the EJTAG connector.  This causes
-openocd to instead use an EJTAG software reset command to reset the
+OpenOCD to instead use an EJTAG software reset command to reset the
 processor.  You still need to enable @option{srst} on the reset
-configuration command to enable openocd hardware reset functionality.
+configuration command to enable OpenOCD hardware reset functionality.
 @comment END varients
 @end itemize
 @section working_area - Command Removed
@@ -2004,7 +2143,7 @@
 @end itemize
 
 @section flash bank command
-The @b{flash bank} command is used to configure one or more flash chips (or banks in openocd terms)
+The @b{flash bank} command is used to configure one or more flash chips (or banks in OpenOCD terms)
 
 @example
 @b{flash bank} &lt;@var{driver}&gt; &lt;@var{base}&gt; &lt;@var{size}&gt; &lt;@var{chip_width}&gt;
@@ -2170,7 +2309,7 @@
 @end itemize
 
 Note: Before using the str9xpec driver here is some background info to help
-you better understand how the drivers works. Openocd has two flash drivers for
+you better understand how the drivers works. OpenOCD has two flash drivers for
 the str9.
 @enumerate
 @item
@@ -2305,14 +2444,12 @@
 
 @section Daemon Commands
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at subsection</A> sleep
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at b</A>{sleep} &lt;@var{msec}&gt;
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at subsection</A> sleep [@var{msec}]
 @cindex sleep
 @*Wait for n milliseconds before resuming. Useful in connection with script files
 (@var{script} command and @var{target_script} configuration). 
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at subsection</A> sleep
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at b</A>{shutdown}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at subsection</A> shutdown
 @cindex shutdown
 @*Close the OpenOCD daemon, disconnecting all clients (GDB, Telnet, Other). 
 
@@ -2709,7 +2846,8 @@
 example if you need to control a JTAG Route Controller (ie: the
 OMAP3530 on the Beagle Board has one) you might use these commands in
 a script or an event procedure.
-
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Commands
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> Commands
 @itemize @bullet
 @item @b{scan_chain}
 @cindex scan_chain
@@ -2743,7 +2881,45 @@
 Display/modify variable field &lt;@var{var}&gt; &lt;@var{field}&gt; [@var{value}|@var{flip}].
 @end itemize
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Tap states
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> Tap states
+Available tap_states are:
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at itemize</A> @bullet
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{RESET}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> RESET
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{IDLE}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> IDLE
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{DRSELECT}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> DRSELECT
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{DRCAPTURE}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> DRCAPTURE
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{DRSHIFT}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> DRSHIFT
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{DREXIT1}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> DREXIT1
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{DRPAUSE}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> DRPAUSE
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{DREXIT2}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> DREXIT2
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{DRUPDATE}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> DRUPDATE
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{IRSELECT}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> IRSELECT
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{IRCAPTURE}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> IRCAPTURE
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{IRSHIFT}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> IRSHIFT
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{IREXIT1}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> IREXIT1
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{IRPAUSE}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> IRPAUSE
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{IREXIT2}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> IREXIT2
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @b{IRUPDATE}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> IRUPDATE
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> itemize
 
+
 @node TFTP
 @chapter TFTP
 @cindex TFTP
@@ -2793,41 +2969,53 @@
 OpenOCD complies with the remote gdbserver protocol, and as such can be used
 to debug remote targets.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at section</A> Connecting to gdb
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at cindex</A> Connecting to gdb
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Connecting to GDB
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> Connecting to GDB
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at anchor</A>{Connecting to GDB}
 Use GDB 6.7 or newer with OpenOCD if you run into trouble. For
 instance 6.3 has a known bug where it produces bogus memory access
 errors, which has since been fixed: look up 1836 in
 @url{<A HREF="http://sourceware.org/cgi-bin/gnatsweb.pl?database=gdb">http://sourceware.org/cgi-bin/gnatsweb.pl?database=gdb</A>}
 
-
-A connection is typically started as follows:
+@*OpenOCD can communicate with GDB in two ways:
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at enumerate</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A>
+A socket (tcp) connection is typically started as follows:
 @example
 target remote localhost:3333
 @end example
-This would cause gdb to connect to the gdbserver on the local pc using port 3333.
+This would cause GDB to connect to the gdbserver on the local pc using port 3333.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A>
+A pipe connection is typically started as follows:
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at example</A>
+target remote | openocd --pipe
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> example
+This would cause GDB to run OpenOCD and communicate using pipes (stdin/stdout).
+Using this method has the advantage of GDB starting/stopping OpenOCD for the debug
+session.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> enumerate
 
-To see a list of available OpenOCD commands type @option{monitor help} on the
-gdb commandline.
+@*To see a list of available OpenOCD commands type @option{monitor help} on the
+GDB commandline.
 
 OpenOCD supports the gdb @option{qSupported} packet, this enables information
-to be sent by the gdb server (openocd) to gdb. Typical information includes
+to be sent by the gdb server (OpenOCD) to GDB. Typical information includes
 packet size and device memory map.
 
-Previous versions of OpenOCD required the following gdb options to increase
-the packet size and speed up gdb communication.
+Previous versions of OpenOCD required the following GDB options to increase
+the packet size and speed up GDB communication.
 @example
 set remote memory-write-packet-size 1024
 set remote memory-write-packet-size fixed
 set remote memory-read-packet-size 1024
 set remote memory-read-packet-size fixed
 @end example
-This is now handled in the @option{qSupported} PacketSize.
+This is now handled in the @option{qSupported} PacketSize and should not be required.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at section</A> Programming using gdb
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at cindex</A> Programming using gdb
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Programming using GDB
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at cindex</A> Programming using GDB
 
-By default the target memory map is sent to gdb, this can be disabled by
+By default the target memory map is sent to GDB, this can be disabled by
 the following OpenOCD config option:
 @example
 gdb_memory_map disable
@@ -2836,34 +3024,34 @@
 in OpenOCD. For faster performance you should also configure a valid 
 working area.
 
-Informing gdb of the memory map of the target will enable gdb to protect any
+Informing GDB of the memory map of the target will enable GDB to protect any
 flash area of the target and use hardware breakpoints by default. This means
 that the OpenOCD option @option{gdb_breakpoint_override} is not required when
 using a memory map. @xref{gdb_breakpoint_override}.
 
-To view the configured memory map in gdb, use the gdb command @option{info mem}
-All other unasigned addresses within gdb are treated as RAM.
+To view the configured memory map in GDB, use the gdb command @option{info mem}
+All other unasigned addresses within GDB are treated as RAM.
 
 GDB 6.8 and higher set any memory area not in the memory map as inaccessible,
-this can be changed to the old behaviour by using the following gdb command.
+this can be changed to the old behaviour by using the following GDB command.
 @example
 set mem inaccessible-by-default off
 @end example
 
-If @option{gdb_flash_program enable} is also used, gdb will be able to
+If @option{gdb_flash_program enable} is also used, GDB will be able to
 program any flash memory using the vFlash interface.
 
-gdb will look at the target memory map when a load command is given, if any
+GDB will look at the target memory map when a load command is given, if any
 areas to be programmed lie within the target flash area the vFlash packets
 will be used.
 
-If the target needs configuring before gdb programming, an event
+If the target needs configuring before GDB programming, an event
 script can be executed.
 @example
 $_TARGETNAME configure -event EVENTNAME BODY
 @end example
 
-To verify any flash programming the gdb command @option{compare-sections}
+To verify any flash programming the GDB command @option{compare-sections}
 can be used.
 
 @node TCL scripting API
@@ -2996,24 +3184,29 @@
 @*
 
 In digital circuit design it is often refered to as ``clock
-syncronization'' the JTAG interface uses one clock (TCK or TCLK)
+synchronisation'' the JTAG interface uses one clock (TCK or TCLK)
 operating at some speed, your target is operating at another.  The two
-clocks are not syncronized, they are ``asynchronous''
+clocks are not synchronised, they are ``asynchronous''
 
-In order for the two to work together they must syncronize. Otherwise
+In order for the two to work together they must be synchronised. Otherwise
 the two systems will get out of sync with each other and nothing will
-work. There are 2 basic options. @b{1.} use a special circuit or
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at b</A>{2.}  one clock must be some multile slower the the other.
+work. There are 2 basic options.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at enumerate</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A>
+Use a special circuit.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A>
+One clock must be some multiple slower the the other.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> enumerate
 
 @b{Does this really matter?} For some chips and some situations, this
-is a non-issue (ie: A 500mhz ARM926) but for others - for example some
-ATMEL SAM7 and SAM9 chips start operation from reset at 32khz -
+is a non-issue (ie: A 500MHz ARM926) but for others - for example some
+ATMEL SAM7 and SAM9 chips start operation from reset at 32kHz -
 program/enable the oscillators and eventually the main clock. It is in
 those critical times you must slow the jtag clock to sometimes 1 to
-4khz.
+4kHz.
 
-Imagine debugging that 500mhz arm926 hand held battery powered device
-that ``deep sleeps'' at 32khz between every keystroke. It can be
+Imagine debugging that 500MHz ARM926 hand held battery powered device
+that ``deep sleeps'' at 32kHz between every keystroke. It can be
 painful.
 
 @b{Solution #1 - A special circuit} 
@@ -3025,14 +3218,14 @@
 this problem. ARM has a good description of the problem described at
 this link: @url{<A HREF="http://www.arm.com/support/faqdev/4170.html">http://www.arm.com/support/faqdev/4170.html</A>} [checked
 28/nov/2008]. Link title: ``How does the jtag synchronisation logic
-work? / how does adaptive clocking working?''.
+work? / how does adaptive clocking work?''.
 
 The nice thing about adaptive clocking is that ``battery powered hand
 held device example'' - the adaptiveness works perfectly all the
 time. One can set a break point or halt the system in the deep power
 down code, slow step out until the system speeds up.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at b</A>{Solution #2 - Always works - but is slower}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at b</A>{Solution #2 - Always works - but may be slower}
 
 Often this is a perfectly acceptable solution.
 
@@ -3042,7 +3235,7 @@
 based systems require an 8:1 division. @b{Xilinx Rule of thumb} is
 1/12 the clock speed.
 
-Note: Many FTDI2232C based JTAG dongles are limited to 6mhz.
+Note: Many FTDI2232C based JTAG dongles are limited to 6MHz.
 
 You can still debug the 'lower power' situations - you just need to
 manually adjust the clock speed at every step. While painful and
@@ -3056,7 +3249,7 @@
 To set the JTAG frequency use the command:
 
 @example
-        # Example: 1.234mhz
+        # Example: 1.234MHz
         jtag_khz 1234
 @end example
 
@@ -3202,7 +3395,7 @@
 
 Many newer devices have multiple JTAG taps. For example: ST
 Microsystems STM32 chips have two taps, a ``boundary scan tap'' and
-``cortexM3'' tap.  Example: The STM32 reference manual, Document ID:
+``CortexM3'' tap.  Example: The STM32 reference manual, Document ID:
 RM0008, Section 26.5, Figure 259, page 651/681, the ``TDI'' pin is
 connected to the Boundary Scan Tap, which then connects to the
 CortexM3 Tap, which then connects to the TDO pin.
@@ -3255,7 +3448,7 @@
 @section TCL Rule #1
 There is a famous joke, it goes like this:
 @enumerate
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at item</A> Rule #1: The wife is aways correct
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> Rule #1: The wife is always correct
 @item Rule #2: If you think otherwise, See Rule #1
 @end enumerate
 
@@ -3266,7 +3459,7 @@
 @item Rule #2: If you think otherwise, See Rule #1
 @end enumerate
 
-As in the famous joke, the consiquences of Rule #1 are profound. Once
+As in the famous joke, the consequences of Rule #1 are profound. Once
 you understand Rule #1, you will understand TCL.
 
 @section TCL Rule #1b
@@ -3336,9 +3529,9 @@
 28/nov/2008, Jim/OpenOCD does not have a date command.
 @end itemize
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at section</A> Consiquences of Rule 1/2/3/4
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at section</A> Consequences of Rule 1/2/3/4
 
-The consiquences of Rule 1 is profound.
+The consequences of Rule 1 is profound.
 
 @subsection Tokenizing &amp; Execution.
 
@@ -3598,7 +3791,7 @@
 OpenOCD comes with a target configuration script library. These scripts can be
 used as-is or serve as a starting point.
 
-The target library is published together with the openocd executable and 
+The target library is published together with the OpenOCD executable and 
 the path to the target library is in the OpenOCD script search path.
 Similarly there are example scripts for configuring the JTAG interface. 
 

Modified: branches/openocd-0.1/src/Makefile.am
===================================================================
--- branches/openocd_1_0_branch/src/Makefile.am	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/Makefile.am	2009-01-16 06:43:11 UTC (rev 1325)
@@ -6,6 +6,7 @@
 MAINFILE = main.c
 endif
 
+
 openocd_SOURCES = $(MAINFILE) openocd.c
 
 # set the include path found by configure
@@ -46,38 +47,35 @@
 if JLINK
 LIBUSB = -lusb
 else
-LIBUSB =
-endif
-endif
-
-if IS_WIN32
-if FTD2XXDIR
-FTD2XXLDADD = @WITH_FTD2XX@/FTD2XX.lib
+if RLINK
+LIBUSB = -lusb
 else
-FTD2XXLDADD = -lftd2xx
-endif
+if VSLLINK
+LIBUSB = -lusb
 else
-FTD2XXLDADD = -lftd2xx 
+LIBUSB =
 endif
-  
-if FT2232_FTD2XX
-FTD2XXLIB = $(FTD2XXLDADD)
-else
-if PRESTO_FTD2XX
-FTD2XXLIB = $(FTD2XXLDADD)
-else
-FTD2XXLIB =
 endif
 endif
+endif
 
+
+
 openocd_LDADD = $(top_builddir)/src/xsvf/libxsvf.a \
 	$(top_builddir)/src/target/libtarget.a $(top_builddir)/src/jtag/libjtag.a \
 	$(top_builddir)/src/helper/libhelper.a \
 	$(top_builddir)/src/server/libserver.a $(top_builddir)/src/helper/libhelper.a \
 	$(top_builddir)/src/flash/libflash.a $(top_builddir)/src/target/libtarget.a \
 	$(top_builddir)/src/pld/libpld.a \
-	$(FTDI2232LIB) $(FTD2XXLIB) $(MINGWLDADD) $(LIBUSB)
+	$(FTDI2232LIB) $(MINGWLDADD) $(LIBUSB)
 
+
+if HTTPD
+openocd_LDADD += -lmicrohttpd
+endif
+
+
+
 nobase_dist_pkglib_DATA = \
 	tcl/bitsbytes.tcl			\
 	tcl/chip/atmel/at91/aic.tcl		\

Modified: branches/openocd-0.1/src/ecosboard.c
===================================================================
--- branches/openocd_1_0_branch/src/ecosboard.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/ecosboard.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -81,7 +81,6 @@
 #include &lt;ifaddrs.h&gt;
 #include &lt;string.h&gt;
 
-
 #include &lt;unistd.h&gt;
 #include &lt;stdio.h&gt;
 #define MAX_IFS 64
@@ -98,14 +97,6 @@
 
 #endif
 
-#define ZYLIN_VERSION &quot;1.48&quot;
-#define ZYLIN_DATE __DATE__
-#define ZYLIN_TIME __TIME__
-/* hmmm....  we can't pick up the right # during build if we've checked this out
- * in Eclipse... arrggghh...*/
-#define ZYLIN_OPENOCD &quot;$Revision$&quot;
-#define ZYLIN_OPENOCD_VERSION &quot;Zylin JTAG ZY1000 &quot; ZYLIN_VERSION &quot; &quot; ZYLIN_DATE &quot; &quot; ZYLIN_TIME
-#define ZYLIN_CONFIG_DIR &quot;/config/settings&quot;
 
 void diag_write(char *buf, int len)
 {
@@ -121,230 +112,7 @@
 
 char hwaddr[512];
 
-struct FastLoad
-{
-	u32 address;
-	u8 *data;
-	int length;
 
-};
-
-static int fastload_num;
-static struct FastLoad *fastload;
-
-static void free_fastload()
-{
-	if (fastload!=NULL)
-	{
-		int i;
-		for (i=0; i&lt;fastload_num; i++)
-		{
-			if (fastload[i].data)
-				free(fastload[i].data);
-		}
-		free(fastload);
-		fastload=NULL;
-	}
-}
-
-
-int handle_fast_load_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	u8 *buffer;
-	u32 buf_cnt;
-	u32 image_size;
-	u32 min_address=0;
-	u32 max_address=0xffffffff;
-	int i;
-	int retval;
-
-	image_t image;
-
-	duration_t duration;
-	char *duration_text;
-
-	if ((argc &lt; 1)||(argc &gt; 5))
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-
-	/* a base address isn't always necessary, default to 0x0 (i.e. don't relocate) */
-	if (argc &gt;= 2)
-	{
-		image.base_address_set = 1;
-		image.base_address = strtoul(args[1], NULL, 0);
-	}
-	else
-	{
-		image.base_address_set = 0;
-	}
-
-
-	image.start_address_set = 0;
-
-	if (argc&gt;=4)
-	{
-		min_address=strtoul(args[3], NULL, 0);
-	}
-	if (argc&gt;=5)
-	{
-		max_address=strtoul(args[4], NULL, 0)+min_address;
-	}
-
-	if (min_address&gt;max_address)
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-
-	duration_start_measure(&amp;duration);
-
-	if (image_open(&amp;image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
-	{
-		return ERROR_OK;
-	}
-
-	image_size = 0x0;
-	retval = ERROR_OK;
-	fastload_num=image.num_sections;
-	fastload=(struct FastLoad *)malloc(sizeof(struct FastLoad)*image.num_sections);
-	if (fastload==NULL)
-	{
-		image_close(&amp;image);
-		return ERROR_FAIL;
-	}
-	memset(fastload, 0, sizeof(struct FastLoad)*image.num_sections);
-	for (i = 0; i &lt; image.num_sections; i++)
-	{
-		buffer = malloc(image.sections[i].size);
-		if (buffer == NULL)
-		{
-			command_print(cmd_ctx, &quot;error allocating buffer for section (%d bytes)&quot;, image.sections[i].size);
-			break;
-		}
-
-		if ((retval = image_read_section(&amp;image, i, 0x0, image.sections[i].size, buffer, &amp;buf_cnt)) != ERROR_OK)
-		{
-			free(buffer);
-			break;
-		}
-
-		u32 offset=0;
-		u32 length=buf_cnt;
-
-
-		/* DANGER!!! beware of unsigned comparision here!!! */
-
-		if ((image.sections[i].base_address+buf_cnt&gt;=min_address)&amp;&amp;
-				(image.sections[i].base_address&lt;max_address))
-		{
-			if (image.sections[i].base_address&lt;min_address)
-			{
-				/* clip addresses below */
-				offset+=min_address-image.sections[i].base_address;
-				length-=offset;
-			}
-
-			if (image.sections[i].base_address+buf_cnt&gt;max_address)
-			{
-				length-=(image.sections[i].base_address+buf_cnt)-max_address;
-			}
-
-			fastload[i].address=image.sections[i].base_address+offset;
-			fastload[i].data=malloc(length);
-			if (fastload[i].data==NULL)
-			{
-				free(buffer);
-				break;
-			}
-			memcpy(fastload[i].data, buffer+offset, length);
-			fastload[i].length=length;
-
-			image_size += length;
-			command_print(cmd_ctx, &quot;%u byte written at address 0x%8.8x&quot;, length, image.sections[i].base_address+offset);
-		}
-
-		free(buffer);
-	}
-
-	duration_stop_measure(&amp;duration, &amp;duration_text);
-	if (retval==ERROR_OK)
-	{
-		command_print(cmd_ctx, &quot;Loaded %u bytes in %s&quot;, image_size, duration_text);
-		command_print(cmd_ctx, &quot;NB!!! image has not been loaded to target, issue a subsequent 'fast_load' to do so.&quot;);
-	}
-	free(duration_text);
-
-	image_close(&amp;image);
-
-	if (retval!=ERROR_OK)
-	{
-		free_fastload();
-	}
-
-	return retval;
-}
-
-int handle_fast_load_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc&gt;0)
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (fastload==NULL)
-	{
-		LOG_ERROR(&quot;No image in memory&quot;);
-		return ERROR_FAIL;
-	}
-	int i;
-	int ms=timeval_ms();
-	int size=0;
-	for (i=0; i&lt;fastload_num;i++)
-	{
-		int retval;
-		target_t *target = get_current_target(cmd_ctx);
-		if ((retval = target_write_buffer(target, fastload[i].address, fastload[i].length, fastload[i].data)) != ERROR_OK)
-		{
-			return retval;
-		}
-		size+=fastload[i].length;
-	}
-	int after=timeval_ms();
-	command_print(cmd_ctx, &quot;Loaded image %f kBytes/s&quot;, (float)(size/1024.0)/((float)(after-ms)/1000.0));
-	return ERROR_OK;
-}
-
-
-/* Give TELNET a way to find out what version this is */
-int handle_zy1000_version_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc &gt; 1)
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-	if (argc == 0)
-	{
-		command_print(cmd_ctx, ZYLIN_OPENOCD_VERSION);
-	} else if (strcmp(&quot;openocd&quot;, args[0])==0)
-	{
-		int revision;
-		revision=atol(ZYLIN_OPENOCD+strlen(&quot;XRevision: &quot;));
-		command_print(cmd_ctx, &quot;%d&quot;, revision);
-	} else if (strcmp(&quot;zy1000&quot;, args[0])==0)
-	{
-		command_print(cmd_ctx, &quot;%s&quot;, ZYLIN_VERSION);
-	} else if (strcmp(&quot;date&quot;, args[0])==0)
-	{
-		command_print(cmd_ctx, &quot;%s&quot;, ZYLIN_DATE);
-	} else
-	{
-		return ERROR_COMMAND_SYNTAX_ERROR;
-	}
-
-	return ERROR_OK;
-}
-
-
-
-
 extern flash_driver_t *flash_drivers[];
 extern target_type_t *target_types[];
 
@@ -374,48 +142,17 @@
 
 	// no more interrupts than 1/10ms.
 	//profile_on((void *)0, (void *)0x40000, 16, 10000); // SRAM
-//	profile_on(0, &amp;_etext, 16, 10000); // SRAM &amp; DRAM
+	//	profile_on(0, &amp;_etext, 16, 10000); // SRAM &amp; DRAM
 	profile_on(start_of_code, end_of_code, 16, 10000); // Nios DRAM
 }
 #endif
 
-// launch GDB server if a config file exists
-bool zylinjtag_parse_config_file(struct command_context_s *cmd_ctx, const char *config_file_name)
-{
-	bool foundFile = false;
-	FILE *config_file = NULL;
-	command_print(cmd_ctx, &quot;executing config file %s&quot;, config_file_name);
-	config_file = fopen(config_file_name, &quot;r&quot;);
-	if (config_file)
-	{
-		fclose(config_file);
-		int retval;
-		retval = command_run_linef(cmd_ctx, &quot;script %s&quot;, config_file_name);
-		if (retval == ERROR_OK)
-		{
-			foundFile = true;
-		}
-		else
-		{
-			command_print(cmd_ctx, &quot;Failed executing %s %d&quot;, config_file_name, retval);
-		}
-	}
-	else
-	{
-		command_print(cmd_ctx, &quot;No %s found&quot;, config_file_name);
-	}
-
-	return foundFile;
-}
-
 extern int eth0_up;
 static FILE *log;
 
 static char reboot_stack[2048];
 
-
-static void
-zylinjtag_reboot(cyg_addrword_t data)
+static void zylinjtag_reboot(cyg_addrword_t data)
 {
 	serialLog = true;
 	diag_printf(&quot;Rebooting in 100 ticks..\n&quot;);
@@ -430,326 +167,30 @@
 
 void reboot(void)
 {
-    cyg_thread_create(1,
-                      zylinjtag_reboot,
-                      (cyg_addrword_t)0,
-                      &quot;reboot Thread&quot;,
-                      (void *)reboot_stack,
-                      sizeof(reboot_stack),
-                      &amp;zylinjtag_thread_handle,
-                      &amp;zylinjtag_thread_object);
+	cyg_thread_create(1, zylinjtag_reboot, (cyg_addrword_t) 0, &quot;reboot Thread&quot;,
+			(void *) reboot_stack, sizeof(reboot_stack),
+			&amp;zylinjtag_thread_handle, &amp;zylinjtag_thread_object);
 	cyg_thread_resume(zylinjtag_thread_handle);
 }
 
-int configuration_output_handler(struct command_context_s *context, const char* line)
+int configuration_output_handler(struct command_context_s *context,
+		const char* line)
 {
 	diag_printf(&quot;%s&quot;, line);
 
 	return ERROR_OK;
 }
 
-int zy1000_configuration_output_handler_log(struct command_context_s *context, const char* line)
+int zy1000_configuration_output_handler_log(struct command_context_s *context,
+		const char* line)
 {
 	LOG_USER_N(&quot;%s&quot;, line);
 
 	return ERROR_OK;
 }
 
-int handle_rm_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc != 1)
-	{
-		command_print(cmd_ctx, &quot;rm &lt;filename&gt;&quot;);
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	if (unlink(args[0]) != 0)
-	{
-		command_print(cmd_ctx, &quot;failed: %d&quot;, errno);
-	}
-
-	return ERROR_OK;
-}
-
-int loadFile(const char *fileName, void **data, int *len);
-
-int handle_cat_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc != 1)
-	{
-		command_print(cmd_ctx, &quot;cat &lt;filename&gt;&quot;);
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
-	void *data;
-	int len;
-
-	int retval = loadFile(args[0], &amp;data, &amp;len);
-	if (retval == ERROR_OK)
-	{
-		command_print(cmd_ctx, &quot;%s&quot;, data);
-		free(data);
-	}
-	else
-	{
-		command_print(cmd_ctx, &quot;%s not found %d&quot;, args[0], retval);
-	}
-
-	return ERROR_OK;
-}
-int handle_trunc_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc != 1)
-	{
-		command_print(cmd_ctx, &quot;trunc &lt;filename&gt;&quot;);
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	FILE *config_file = NULL;
-	config_file = fopen(args[0], &quot;w&quot;);
-	if (config_file != NULL)
-		fclose(config_file);
-
-	return ERROR_OK;
-}
-
-
-int handle_meminfo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	static int prev = 0;
-	struct mallinfo info;
-
-	if (argc != 0)
-	{
-		command_print(cmd_ctx, &quot;meminfo&quot;);
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	info = mallinfo();
-
-	if (prev &gt; 0)
-	{
-		command_print(cmd_ctx, &quot;Diff:            %d&quot;, prev - info.fordblks);
-	}
-	prev = info.fordblks;
-
-	command_print(cmd_ctx, &quot;Available ram:   %d&quot;, info.fordblks );
-
-	return ERROR_OK;
-}
-
-static bool savePower;
-
-static void setPower(bool power)
-{
-	savePower = power;
-	if (power)
-	{
-		HAL_WRITE_UINT32(0x08000014, 0x8);
-	} else
-	{
-		HAL_WRITE_UINT32(0x08000010, 0x8);
-	}
-}
-
-int handle_power_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc &gt; 1)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	if (argc == 1)
-	{
-		if (strcmp(args[0], &quot;on&quot;) == 0)
-		{
-			setPower(1);
-		}
-		else if (strcmp(args[0], &quot;off&quot;) == 0)
-		{
-			setPower(0);
-		} else
-		{
-			command_print(cmd_ctx, &quot;arg is \&quot;on\&quot; or \&quot;off\&quot;&quot;);
-			return ERROR_INVALID_ARGUMENTS;
-		}
-	}
-
-	command_print(cmd_ctx, &quot;Target power %s&quot;, savePower ? &quot;on&quot; : &quot;off&quot;);
-
-	return ERROR_OK;
-}
-
-int handle_append_command(struct command_context_s *cmd_ctx, char *cmd,
-		char **args, int argc)
-{
-	if (argc &lt; 1)
-	{
-		command_print(cmd_ctx,
-				&quot;append &lt;filename&gt; [&lt;string1&gt;, [&lt;string2&gt;, ...]]&quot;);
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	FILE *config_file = NULL;
-	config_file = fopen(args[0], &quot;a&quot;);
-	if (config_file != NULL)
-	{
-		int i;
-		fseek(config_file, 0, SEEK_END);
-
-		for (i = 1; i &lt; argc; i++)
-		{
-			fwrite(args[i], strlen(args[i]), 1, config_file);
-			if (i != argc - 1)
-			{
-				fwrite(&quot; &quot;, 1, 1, config_file);
-			}
-		}
-		fwrite(&quot;\n&quot;, 1, 1, config_file);
-		fclose(config_file);
-	}
-
-	return ERROR_OK;
-}
-
-extern int telnet_socket;
-
-int readMore(int fd, void *data, int length)
-{
-	/* used in select() */
-	fd_set read_fds;
-
-	/* monitor sockets for acitvity */
-	int fd_max = 1;
-	FD_ZERO(&amp;read_fds);
-	/* listen for new connections */
-	FD_SET(fd, &amp;read_fds);
-
-	// Maximum 5 seconds.
-	struct timeval tv;
-	tv.tv_sec = 5;
-	tv.tv_usec = 0;
-
-	int retval = select(fd_max + 1, &amp;read_fds, NULL, NULL, &amp;tv);
-	if (retval == 0)
-	{
-		diag_printf(&quot;Timed out waiting for binary payload\n&quot;);
-		return -1;
-	}
-	if (retval != 1)
-		return -1;
-
-	return read_socket(fd, data, length);
-}
-
-int readAll(int fd, void *data, int length)
-{
-	int pos = 0;
-	for (;;)
-	{
-		int actual = readMore(fd, ((char *) data) + pos, length - pos);
-		//		diag_printf(&quot;Read %d bytes(pos=%d, length=%d)\n&quot;, actual, pos, length);
-		if (actual &lt;= 0)
-			return -1;
-		pos += actual;
-		if (pos == length)
-			break;
-	}
-	return length;
-}
-
-int handle_peek_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	cyg_uint32 value;
-	if (argc != 1)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-	HAL_READ_UINT32(strtoul(args[0], NULL, 0), value);
-	command_print(cmd_ctx, &quot;0x%x : 0x%x&quot;, strtoul(args[0], NULL, 0), value);
-	return ERROR_OK;
-}
-
-int handle_poke_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc != 2)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-	HAL_WRITE_UINT32(strtoul(args[0], NULL, 0), strtoul(args[1], NULL, 0));
-	return ERROR_OK;
-}
-
-int handle_cp_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
-{
-	if (argc != 2)
-	{
-		return ERROR_INVALID_ARGUMENTS;
-	}
-
-	// NOTE!!! we only have line printing capability so we print the entire file as a single line.
-	void *data;
-	int len;
-
-	int retval = loadFile(args[0], &amp;data, &amp;len);
-	if (retval != ERROR_OK)
-		return retval;
-
-	FILE *f = fopen(args[1], &quot;wb&quot;);
-	if (f == NULL)
-		retval = ERROR_INVALID_ARGUMENTS;
-
-	int pos = 0;
-	for (;;)
-	{
-		int chunk = len - pos;
-		static const int maxChunk = 512 * 1024; // ~1/sec
-		if (chunk &gt; maxChunk)
-		{
-			chunk = maxChunk;
-		}
-
-		if ((retval==ERROR_OK)&amp;&amp;(fwrite(((char *)data)+pos, 1, chunk, f)!=chunk))
-			retval = ERROR_INVALID_ARGUMENTS;
-
-		if (retval != ERROR_OK)
-		{
-			break;
-		}
-
-		command_print(cmd_ctx, &quot;%d&quot;, len - pos);
-
-		pos += chunk;
-
-		if (pos == len)
-			break;
-	}
-
-	if (retval == ERROR_OK)
-	{
-		command_print(cmd_ctx, &quot;Copied %s to %s&quot;, args[0], args[1]);
-	} else
-	{
-		command_print(cmd_ctx, &quot;Failed: %d&quot;, retval);
-	}
-
-	if (data != NULL)
-		free(data);
-	if (f != NULL)
-		fclose(f);
-
-	if (retval != ERROR_OK)
-		unlink(args[1]);
-
-	return retval;
-}
-
 #ifdef CYGPKG_PROFILE_GPROF
-extern void start_profile();
+extern void start_profile(void);
 
 int eCosBoard_handle_eCosBoard_profile_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
@@ -760,13 +201,13 @@
 
 #endif
 
-externC void phi_init_all_network_interfaces();
+externC void phi_init_all_network_interfaces(void);
 
 command_context_t *cmd_ctx;
 
 static bool webRunning = false;
 
-void keep_webserver()
+void keep_webserver(void)
 {
 	// Target initialisation is only attempted at startup, so we sleep forever and
 	// let the http server bail us out(i.e. get config files set up).
@@ -808,116 +249,10 @@
 #endif
 }
 
-#define SHOW_RESULT(a, b) diag_printf(#a &quot; failed %d\n&quot;, (int)b)
+void copyfile(char *name2, char *name1);
 
-#define IOSIZE 512
-static void copyfile(char *name2, char *name1)
-{
+void copydir(char *name, char *destdir);
 
-	int err;
-	char buf[IOSIZE];
-	int fd1, fd2;
-	ssize_t done, wrote;
-
-	fd1 = open(name1, O_WRONLY | O_CREAT);
-	if (fd1 &lt; 0)
-		SHOW_RESULT( open, fd1 );
-
-	fd2 = open(name2, O_RDONLY);
-	if (fd2 &lt; 0)
-		SHOW_RESULT( open, fd2 );
-
-	for (;;)
-	{
-		done = read(fd2, buf, IOSIZE );
-		if (done &lt; 0)
-		{
-			SHOW_RESULT( read, done );
-			break;
-		}
-
-        if( done == 0 ) break;
-
-		wrote = write(fd1, buf, done);
-        if( wrote != done ) SHOW_RESULT( write, wrote );
-
-        if( wrote != done ) break;
-	}
-
-	err = close(fd1);
-    if( err &lt; 0 ) SHOW_RESULT( close, err );
-
-	err = close(fd2);
-    if( err &lt; 0 ) SHOW_RESULT( close, err );
-
-}
-static void copydir(char *name, char *destdir)
-{
-	int err;
-	DIR *dirp;
-
-	dirp = opendir(destdir);
-	if (dirp==NULL)
-	{
-		mkdir(destdir, 0777);
-	} else
-	{
-		err = closedir(dirp);
-	}
-
-	dirp = opendir(name);
-    if( dirp == NULL ) SHOW_RESULT( opendir, -1 );
-
-	for (;;)
-	{
-		struct dirent *entry = readdir(dirp);
-
-		if (entry == NULL)
-			break;
-
-		if (strcmp(entry-&gt;d_name, &quot;.&quot;) == 0)
-			continue;
-		if (strcmp(entry-&gt;d_name, &quot;..&quot;) == 0)
-			continue;
-
-		bool isDir = false;
-		struct stat buf;
-		char fullPath[PATH_MAX];
-		strncpy(fullPath, name, PATH_MAX);
-		strcat(fullPath, &quot;/&quot;);
-		strncat(fullPath, entry-&gt;d_name, PATH_MAX - strlen(fullPath));
-
-		if (stat(fullPath, &amp;buf) == -1)
-		{
-			diag_printf(&quot;unable to read status from %s&quot;, fullPath);
-			break;
-		}
-		isDir = S_ISDIR(buf.st_mode) != 0;
-
-		if (isDir)
-			continue;
-
-		//        diag_printf(&quot;&lt;INFO&gt;: entry %14s&quot;,entry-&gt;d_name);
-		char fullname[PATH_MAX];
-		char fullname2[PATH_MAX];
-
-		strcpy(fullname, name);
-		strcat(fullname, &quot;/&quot;);
-		strcat(fullname, entry-&gt;d_name);
-
-		strcpy(fullname2, destdir);
-		strcat(fullname2, &quot;/&quot;);
-		strcat(fullname2, entry-&gt;d_name);
-		//        diag_printf(&quot;from %s to %s\n&quot;, fullname, fullname2);
-		copyfile(fullname, fullname2);
-
-		//       diag_printf(&quot;\n&quot;);
-	}
-
-	err = closedir(dirp);
-    if( err &lt; 0 ) SHOW_RESULT( stat, err );
-}
-
 #if 0
 MTAB_ENTRY( romfs_mte1,
 		&quot;/rom&quot;,
@@ -926,17 +261,16 @@
 		(CYG_ADDRWORD) &amp;filedata[0] );
 #endif
 
-void openocd_sleep_prelude()
+void openocd_sleep_prelude(void)
 {
 	cyg_mutex_unlock(&amp;httpstate.jim_lock);
 }
 
-void openocd_sleep_postlude()
+void openocd_sleep_postlude(void)
 {
 	cyg_mutex_lock(&amp;httpstate.jim_lock);
 }
 
-
 void format(void)
 {
 	diag_printf(&quot;Formatting JFFS2...\n&quot;);
@@ -951,12 +285,10 @@
 		reboot();
 	}
 
-
 	cyg_uint32 len;
 	cyg_io_flash_getconfig_devsize_t ds;
-	len = sizeof (ds);
-	err = cyg_io_get_config(handle,
-				CYG_IO_GET_CONFIG_FLASH_DEVSIZE, &amp;ds, &amp;len);
+	len = sizeof(ds);
+	err = cyg_io_get_config(handle, CYG_IO_GET_CONFIG_FLASH_DEVSIZE, &amp;ds, &amp;len);
 	if (err != ENOERR)
 	{
 		diag_printf(&quot;Flash error cyg_io_get_config %d\n&quot;, err);
@@ -965,15 +297,14 @@
 
 	cyg_io_flash_getconfig_erase_t e;
 	void *err_addr;
-	len = sizeof (e);
+	len = sizeof(e);
 
 	e.offset = 0;
 	e.len = ds.dev_size;
 	e.err_address = &amp;err_addr;
 
 	diag_printf(&quot;Formatting 0x%08x bytes\n&quot;, ds.dev_size);
-	err = cyg_io_get_config(handle, CYG_IO_GET_CONFIG_FLASH_ERASE,
-				&amp;e, &amp;len);
+	err = cyg_io_get_config(handle, CYG_IO_GET_CONFIG_FLASH_ERASE, &amp;e, &amp;len);
 	if (err != ENOERR)
 	{
 		diag_printf(&quot;Flash erase error %d offset 0x%p\n&quot;, err, err_addr);
@@ -985,11 +316,7 @@
 	reboot();
 }
 
-
-
-static int
-zylinjtag_Jim_Command_format_jffs2(Jim_Interp *interp,
-                                   int argc,
+static int zylinjtag_Jim_Command_format_jffs2(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
 	if (argc != 1)
@@ -998,31 +325,10 @@
 	}
 
 	format();
-	for(;;);
+	for (;;)
+		;
 }
 
-
-static int
-zylinjtag_Jim_Command_rm(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	int del;
-	if (argc != 2)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, &quot;rm ?dirorfile?&quot;);
-		return JIM_ERR;
-	}
-
-	del = 0;
-	if (unlink(Jim_GetString(argv[1], NULL)) == 0)
-		del = 1;
-	if (rmdir(Jim_GetString(argv[1], NULL)) == 0)
-		del = 1;
-
-	return del ? JIM_OK : JIM_ERR;
-}
-
 static int zylinjtag_Jim_Command_threads(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
@@ -1077,198 +383,28 @@
 		Jim_ListAppendElement(interp, threadObj, Jim_NewStringObj(interp,
 				state_string, strlen(state_string)));
 
-		Jim_ListAppendElement	(interp, threadObj, Jim_NewIntObj(interp, id));
-		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp, info.set_pri));
-		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp, info.cur_pri));
+		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp, id));
+		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp,
+				info.set_pri));
+		Jim_ListAppendElement(interp, threadObj, Jim_NewIntObj(interp,
+				info.cur_pri));
 
 		Jim_ListAppendElement(interp, threads, threadObj);
 	}
-	Jim_SetResult( interp, threads);
+	Jim_SetResult(interp, threads);
 
 	return JIM_OK;
 }
 
-
-static int
-zylinjtag_Jim_Command_ls(Jim_Interp *interp,
-                                   int argc,
+static int zylinjtag_Jim_Command_log(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
-	if (argc != 2)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, &quot;ls ?dir?&quot;);
-		return JIM_ERR;
-	}
-
-	char *name = (char*) Jim_GetString(argv[1], NULL);
-
-	DIR *dirp = NULL;
-	dirp = opendir(name);
-	if (dirp == NULL)
-	{
-		return JIM_ERR;
-	}
-	Jim_Obj *objPtr = Jim_NewListObj(interp, NULL, 0);
-
-	for (;;)
-	{
-		struct dirent *entry = NULL;
-		entry = readdir(dirp);
-		if (entry == NULL)
-			break;
-
-		if ((strcmp(&quot;.&quot;, entry-&gt;d_name)==0)||(strcmp(&quot;..&quot;, entry-&gt;d_name)==0))
-			continue;
-
-        Jim_ListAppendElement(interp, objPtr, Jim_NewStringObj(interp, entry-&gt;d_name, strlen(entry-&gt;d_name)));
-	}
-	closedir(dirp);
-
-	Jim_SetResult(interp, objPtr);
-
-	return JIM_OK;
-}
-
-
-static int
-zylinjtag_Jim_Command_getmem(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 3)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, &quot;ls ?dir?&quot;);
-		return JIM_ERR;
-	}
-
-	long address;
-	long length;
-	if (Jim_GetLong(interp, argv[1], &amp;address) != JIM_OK)
-		return JIM_ERR;
-	if (Jim_GetLong(interp, argv[2], &amp;length) != JIM_OK)
-		return JIM_ERR;
-
-	if (length &lt; 0 &amp;&amp; length &gt; (4096 * 1024))
-	{
-		Jim_WrongNumArgs(interp, 1, argv, &quot;getmem ?dir?&quot;);
-		return JIM_ERR;
-	}
-
-	void *mem = malloc(length);
-	if (mem == NULL)
-		return JIM_ERR;
-
-	target_t *target = get_current_target(cmd_ctx);
-
-	int retval;
-	int size = 1;
-	int count = length;
-	if ((address % 4 == 0) &amp;&amp; (count % 4 == 0))
-	{
-		size = 4;
-		count /= 4;
-	}
-
-	if ((retval  = target-&gt;type-&gt;read_memory(target, address, size, count, mem)) != ERROR_OK)
-	{
-		free(mem);
-		return JIM_ERR;
-	}
-
-	Jim_Obj *objPtr = Jim_NewStringObj(interp, mem, length);
-	Jim_SetResult(interp, objPtr);
-
-	free(mem);
-
-	return JIM_OK;
-}
-
-static int
-zylinjtag_Jim_Command_peek(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 2)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, &quot;peek ?address?&quot;);
-		return JIM_ERR;
-	}
-
-	long address;
-	if (Jim_GetLong(interp, argv[1], &amp;address) != JIM_OK)
-		return JIM_ERR;
-
-	int value = *((volatile int *) address);
-
-	Jim_SetResult(interp, Jim_NewIntObj(interp, value));
-
-	return JIM_OK;
-}
-
-static int
-zylinjtag_Jim_Command_poke(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	if (argc != 3)
-	{
-		Jim_WrongNumArgs(interp, 1, argv, &quot;poke ?address? ?value?&quot;);
-		return JIM_ERR;
-	}
-
-	long address;
-	if (Jim_GetLong(interp, argv[1], &amp;address) != JIM_OK)
-		return JIM_ERR;
-	long value;
-	if (Jim_GetLong(interp, argv[2], &amp;value) != JIM_OK)
-		return JIM_ERR;
-
-	*((volatile int *) address) = value;
-
-	return JIM_OK;
-}
-
-
-
-static int
-zylinjtag_Jim_Command_flash(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	int retval;
-	u32 base = 0;
-	flash_bank_t *t = get_flash_bank_by_num_noprobe(0);
-	if (t != NULL)
-	{
-		base = t-&gt;base;
-		retval = JIM_OK;
-    } else
-	{
-		retval = JIM_ERR;
-	}
-
-	if (retval == JIM_OK)
-	{
-		Jim_SetResult(interp, Jim_NewIntObj(interp, base));
-	}
-
-	return retval;
-}
-
-
-
-
-
-static int
-zylinjtag_Jim_Command_log(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
 	Jim_Obj *tclOutput = Jim_NewStringObj(interp, &quot;&quot;, 0);
 
 	if (logCount &gt;= logSize)
 	{
-    	Jim_AppendString(httpstate.jim_interp, tclOutput, logBuffer+logCount%logSize, logSize-logCount%logSize);
+		Jim_AppendString(httpstate.jim_interp, tclOutput, logBuffer + logCount
+				% logSize, logSize - logCount % logSize);
 	}
 	Jim_AppendString(httpstate.jim_interp, tclOutput, logBuffer, writePtr);
 
@@ -1276,78 +412,17 @@
 	return JIM_OK;
 }
 
-static int
-zylinjtag_Jim_Command_reboot(Jim_Interp *interp,
-                                   int argc,
+static int zylinjtag_Jim_Command_reboot(Jim_Interp *interp, int argc,
 		Jim_Obj * const *argv)
 {
 	reboot();
 	return JIM_OK;
 }
 
-static int
-zylinjtag_Jim_Command_mac(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
 
-	Jim_Obj *tclOutput = Jim_NewStringObj(interp, &quot;&quot;, 0);
-
-	Jim_AppendString(httpstate.jim_interp, tclOutput, hwaddr, strlen(hwaddr));
-
-	Jim_SetResult(interp, tclOutput);
-
-	return JIM_OK;
-}
-
-static int
-zylinjtag_Jim_Command_ip(Jim_Interp *interp,
-                                   int argc,
-		Jim_Obj * const *argv)
-{
-	Jim_Obj *tclOutput = Jim_NewStringObj(interp, &quot;&quot;, 0);
-
-	struct ifaddrs *ifa = NULL, *ifp = NULL;
-
-	if (getifaddrs(&amp;ifp) &lt; 0)
-	{
-		return JIM_ERR;
-	}
-
-	for (ifa = ifp; ifa; ifa = ifa-&gt;ifa_next)
-	{
-		char ip[200];
-		socklen_t salen;
-
-		if (ifa-&gt;ifa_addr-&gt;sa_family == AF_INET)
-			salen = sizeof(struct sockaddr_in);
-		else if (ifa-&gt;ifa_addr-&gt;sa_family == AF_INET6)
-			salen = sizeof(struct sockaddr_in6);
-		else
-			continue;
-
-		if (getnameinfo(ifa-&gt;ifa_addr, salen, ip, sizeof(ip), NULL, 0,
-				NI_NUMERICHOST) &lt; 0)
-		{
-			continue;
-		}
-
-		Jim_AppendString(httpstate.jim_interp, tclOutput, ip, strlen(ip));
-		break;
-
-	}
-
-	freeifaddrs(ifp);
-
-	Jim_SetResult(interp, tclOutput);
-
-	return JIM_OK;
-}
-
 extern Jim_Interp *interp;
 
-
-static void zylinjtag_startNetwork()
+static void zylinjtag_startNetwork(void)
 {
 	// Bring TCP/IP up immediately before we're ready to accept commands.
 	//
@@ -1371,18 +446,14 @@
 
 	interp = httpstate.jim_interp;
 
-    Jim_CreateCommand(httpstate.jim_interp, &quot;log&quot;, zylinjtag_Jim_Command_log, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;reboot&quot;, zylinjtag_Jim_Command_reboot, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;peek&quot;, zylinjtag_Jim_Command_peek, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;zy1000_flash&quot;, zylinjtag_Jim_Command_flash, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;poke&quot;, zylinjtag_Jim_Command_poke, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;ls&quot;, zylinjtag_Jim_Command_ls, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;threads&quot;, zylinjtag_Jim_Command_threads, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;getmem&quot;, zylinjtag_Jim_Command_getmem, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;mac&quot;, zylinjtag_Jim_Command_mac, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;ip&quot;, zylinjtag_Jim_Command_ip, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;rm&quot;, zylinjtag_Jim_Command_rm, NULL, NULL);
-    Jim_CreateCommand(httpstate.jim_interp, &quot;format_jffs2&quot;, zylinjtag_Jim_Command_format_jffs2, NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, &quot;log&quot;, zylinjtag_Jim_Command_log,
+			NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, &quot;reboot&quot;,
+			zylinjtag_Jim_Command_reboot, NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, &quot;threads&quot;,
+			zylinjtag_Jim_Command_threads, NULL, NULL);
+	Jim_CreateCommand(httpstate.jim_interp, &quot;format_jffs2&quot;,
+			zylinjtag_Jim_Command_format_jffs2, NULL, NULL);
 
 	cyg_httpd_start();
 
@@ -1415,18 +486,14 @@
 			(int) ((unsigned char *) &amp;ifr.ifr_hwaddr.sa_data)[4],
 			(int) ((unsigned char *) &amp;ifr.ifr_hwaddr.sa_data)[5]);
 
+	discover_message
+			= alloc_printf(&quot;ZY1000 Zylin JTAG debugger MAC %s&quot;, hwaddr);
 
-	discover_message=alloc_printf(&quot;ZY1000 Zylin JTAG debugger MAC %s&quot;, hwaddr);
-
 	discover_launch();
 }
 
-
-
-
-
-static void
-print_exception_handler(cyg_addrword_t data, cyg_code_t exception, cyg_addrword_t info)
+static void print_exception_handler(cyg_addrword_t data, cyg_code_t exception,
+		cyg_addrword_t info)
 {
 	writeLog = false;
 	serialLog = true;
@@ -1435,17 +502,17 @@
 	{
 #ifdef CYGNUM_HAL_VECTOR_UNDEF_INSTRUCTION
 	case CYGNUM_HAL_VECTOR_UNDEF_INSTRUCTION:
-		infoStr = &quot;undefined instruction&quot;;
-		break;
+	infoStr = &quot;undefined instruction&quot;;
+	break;
 	case CYGNUM_HAL_VECTOR_SOFTWARE_INTERRUPT:
-		infoStr = &quot;software interrupt&quot;;
-		break;
+	infoStr = &quot;software interrupt&quot;;
+	break;
 	case CYGNUM_HAL_VECTOR_ABORT_PREFETCH:
-		infoStr = &quot;abort prefetch&quot;;
-		break;
+	infoStr = &quot;abort prefetch&quot;;
+	break;
 	case CYGNUM_HAL_VECTOR_ABORT_DATA:
-		infoStr = &quot;abort data&quot;;
-		break;
+	infoStr = &quot;abort data&quot;;
+	break;
 #endif
 	default:
 		break;
@@ -1472,11 +539,8 @@
 	cyg_exception_handler_t *old_handler;
 	cyg_addrword_t old_data;
 
-	cyg_exception_set_handler(exception,
-	print_exception_handler,
-	0,
-	&amp;old_handler,
-	&amp;old_data);
+	cyg_exception_set_handler(exception, print_exception_handler, 0,
+			&amp;old_handler, &amp;old_data);
 }
 
 static cyg_thread zylinjtag_uart_thread_object;
@@ -1486,8 +550,6 @@
 static char forwardBuffer[1024]; // NB! must be smaller than a TCP/IP packet!!!!!
 static char backwardBuffer[1024];
 
-static cyg_io_handle_t serial_handle;
-
 void setNoDelay(int session, int flag)
 {
 #if 1
@@ -1515,8 +577,7 @@
 } tcpipSent[512 * 1024];
 int cur;
 
-static void
-zylinjtag_uart(cyg_addrword_t data)
+static void zylinjtag_uart(cyg_addrword_t data)
 {
 	int so_reuseaddr_option = 1;
 
@@ -1527,7 +588,8 @@
 		exit(-1);
 	}
 
-	setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, (void*)&amp;so_reuseaddr_option, sizeof(int));
+	setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, (void*) &amp;so_reuseaddr_option,
+			sizeof(int));
 
 	struct sockaddr_in sin;
 	unsigned int address_size;
@@ -1608,7 +670,8 @@
 			if (actual2 &lt;= 0)
 			{
 				memset(backwardBuffer, 's', sizeof(backwardBuffer));
-				actual2=read(serHandle, backwardBuffer, sizeof(backwardBuffer));
+				actual2 = read(serHandle, backwardBuffer,
+						sizeof(backwardBuffer));
 				if (actual2 &lt; 0)
 				{
 					if (errno != EAGAIN)
@@ -1632,7 +695,8 @@
 				y = written;
 			}
 
-			if (FD_ISSET(session, &amp;read_fds)&amp;&amp;(sizeof(forwardBuffer)&gt;actual))
+			if (FD_ISSET(session, &amp;read_fds)
+					&amp;&amp; (sizeof(forwardBuffer) &gt; actual))
 			{
 				// NB! Here it is important that we empty the TCP/IP read buffer
 				// to make transmission tick right
@@ -1640,7 +704,8 @@
 				pos = 0;
 				int t;
 				// this will block if there is no data at all
-				t=read_socket(session, forwardBuffer+actual, sizeof(forwardBuffer)-actual);
+				t = read_socket(session, forwardBuffer + actual,
+						sizeof(forwardBuffer) - actual);
 				if (t &lt;= 0)
 				{
 					goto closeSession;
@@ -1666,7 +731,8 @@
 					}
 					// The serial buffer is full
 					written = 0;
-				} else
+				}
+				else
 				{
 					actual -= written;
 					pos += written;
@@ -1683,14 +749,14 @@
 			}
 
 		}
-	    closeSession:
-	    close(session);
+		closeSession: close(session);
 		close(serHandle);
 
 		int i;
 		for (i = 0; i &lt; 1024; i++)
 		{
-	    	diag_printf(&quot;%d %d %d %d\n&quot;, tcpipSent[i].req, tcpipSent[i].actual, tcpipSent[i].req2, tcpipSent[i].actual2);
+			diag_printf(&quot;%d %d %d %d\n&quot;, tcpipSent[i].req, tcpipSent[i].actual,
+					tcpipSent[i].req2, tcpipSent[i].actual2);
 
 		}
 	}
@@ -1700,28 +766,23 @@
 
 void startUart(void)
 {
-    cyg_thread_create(1,
-                      zylinjtag_uart,
-                      (cyg_addrword_t)0,
-                      &quot;uart thread&quot;,
-                      (void *)uart_stack,
-                      sizeof(uart_stack),
-                      &amp;zylinjtag_uart_thread_handle,
-                      &amp;zylinjtag_uart_thread_object);
+	cyg_thread_create(1, zylinjtag_uart, (cyg_addrword_t) 0, &quot;uart thread&quot;,
+			(void *) uart_stack, sizeof(uart_stack),
+			&amp;zylinjtag_uart_thread_handle, &amp;zylinjtag_uart_thread_object);
 	cyg_thread_set_priority(zylinjtag_uart_thread_handle, 1); // low priority as it sits in a busy loop
 	cyg_thread_resume(zylinjtag_uart_thread_handle);
 }
 
-
-
-int handle_uart_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+int handle_uart_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
 {
 	static int current_baud = 38400;
 	if (argc == 0)
 	{
 		command_print(cmd_ctx, &quot;%d&quot;, current_baud);
 		return ERROR_OK;
-	} else if (argc != 1)
+	}
+	else if (argc != 1)
 	{
 		return ERROR_INVALID_ARGUMENTS;
 	}
@@ -1759,16 +820,28 @@
 	//get existing serial configuration
 	len = sizeof(cyg_serial_info_t);
 	int err;
-	err = cyg_io_get_config(serial_handle, CYG_IO_GET_CONFIG_SERIAL_OUTPUT_DRAIN, &amp;buf, &amp;len);
-	err = cyg_io_get_config(serial_handle, CYG_IO_GET_CONFIG_SERIAL_INFO, &amp;buf, &amp;len);
+	cyg_io_handle_t serial_handle;
+
+	err = cyg_io_lookup(&quot;/dev/ser0&quot;, &amp;serial_handle);
 	if (err != ENOERR)
 	{
+		LOG_ERROR(&quot;/dev/ser0 not found\n&quot;);
+		return ERROR_FAIL;
+	}
+
+	err = cyg_io_get_config(serial_handle,
+			CYG_IO_GET_CONFIG_SERIAL_OUTPUT_DRAIN, &amp;buf, &amp;len);
+	err = cyg_io_get_config(serial_handle, CYG_IO_GET_CONFIG_SERIAL_INFO, &amp;buf,
+			&amp;len);
+	if (err != ENOERR)
+	{
 		command_print(cmd_ctx, &quot;Failed to get serial port settings %d&quot;, err);
 		return ERROR_OK;
 	}
 	buf.baud = baud;
 
-	err = cyg_io_set_config(serial_handle, CYG_IO_SET_CONFIG_SERIAL_INFO, &amp;buf, &amp;len);
+	err = cyg_io_set_config(serial_handle, CYG_IO_SET_CONFIG_SERIAL_INFO, &amp;buf,
+			&amp;len);
 	if (err != ENOERR)
 	{
 		command_print(cmd_ctx, &quot;Failed to set serial port settings %d&quot;, err);
@@ -1780,47 +853,29 @@
 
 bool logAllToSerial = false;
 
-/* boolean parameter stored on config */
-bool boolParam(char *var)
-{
-	bool result = false;
-	char *name = alloc_printf(ZYLIN_CONFIG_DIR &quot;/%s&quot;, var);
-	if (name == NULL)
-		return result;
 
-	void *data;
-	int len;
-	if (loadFile(name, &amp;data, &amp;len) == ERROR_OK)
-	{
-		if (len &gt; 1)
-			len = 1;
-		result = strncmp((char *) data, &quot;1&quot;, len) == 0;
-		free(data);
-	}
-	free(name);
-	return result;
-}
+int boolParam(char *var);
 
-command_context_t *setup_command_handler();
 
+command_context_t *setup_command_handler(void);
+
+extern const char *zylin_config_dir;
+
 int add_default_dirs(void)
 {
-	add_script_search_dir(ZYLIN_CONFIG_DIR);
+	add_script_search_dir(zylin_config_dir);
 	add_script_search_dir(&quot;/rom/lib/openocd&quot;);
 	add_script_search_dir(&quot;/rom&quot;);
 	return ERROR_OK;
 }
 
-static cyg_uint8 *ramblockdevice;
-static const int ramblockdevice_size=4096*1024;
+int ioutil_init(struct command_context_s *cmd_ctx);
+
 int main(int argc, char *argv[])
 {
 	/* ramblockdevice will be the same address every time. The deflate app uses a buffer 16mBytes out, so we
 	 * need to allocate towards the end of the heap.  */
 
-	ramblockdevice=(cyg_uint8 *)malloc(ramblockdevice_size);
-	memset(ramblockdevice, 0xff, ramblockdevice_size);
-
 #ifdef CYGNUM_HAL_VECTOR_UNDEF_INSTRUCTION
 	setHandler(CYGNUM_HAL_VECTOR_UNDEF_INSTRUCTION);
 	setHandler(CYGNUM_HAL_VECTOR_ABORT_PREFETCH);
@@ -1828,17 +883,13 @@
 #endif
 
 	int err;
-	err = cyg_io_lookup(&quot;/dev/ser0&quot;, &amp;serial_handle);
-	if (err != ENOERR)
-	{
-		diag_printf(&quot;/dev/ser0 not found\n&quot;);
-		reboot();
-	}
 
-	setPower(true); // on by default
-
 	atexit(keep_webserver);
 
+	diag_init_putc(_zylinjtag_diag_write_char);
+	// We want this in the log.
+	diag_printf(&quot;Zylin ZY1000.\n&quot;);
+
 	err = mount(&quot;&quot;, &quot;/ram&quot;, &quot;ramfs&quot;);
 	if (err &lt; 0)
 	{
@@ -1873,42 +924,36 @@
 		exit(-1);
 	}
 
-	diag_init_putc(_zylinjtag_diag_write_char);
 
-	// We want this in the log.
-	diag_printf(&quot;Zylin ZY1000. Copyright Zylin AS 2007-2008.\n&quot;);
-	diag_printf(&quot;%s\n&quot;, ZYLIN_OPENOCD_VERSION);
-
 	copydir(&quot;/rom&quot;, &quot;/ram/cgi&quot;);
 
 	err = mount(&quot;/dev/flash1&quot;, &quot;/config&quot;, &quot;jffs2&quot;);
 	if (err &lt; 0)
 	{
-		diag_printf(&quot;unable to mount jffs\n&quot;);
-		reboot();
-	}
-
-	/* are we using a ram disk instead of a flash disk? This is used
-	 * for ZY1000 live demo...
-	 *
-	 * copy over flash disk to ram block device
-	 */
-	if (boolParam(&quot;ramdisk&quot;))
-	{
-		diag_printf(&quot;Unmounting /config from flash and using ram instead\n&quot;);
-		err=umount(&quot;/config&quot;);
+		diag_printf(&quot;unable to mount jffs2, falling back to ram disk..\n&quot;);
+		err = mount(&quot;&quot;, &quot;/config&quot;, &quot;ramfs&quot;);
 		if (err &lt; 0)
 		{
-			diag_printf(&quot;unable to unmount jffs\n&quot;);
+			diag_printf(&quot;unable to mount /config as ramdisk.\n&quot;);
 			reboot();
 		}
-
-		err = mount(&quot;/dev/flash1&quot;, &quot;/config2&quot;, &quot;jffs2&quot;);
-		if (err &lt; 0)
+	}
+	else
+	{
+		/* are we using a ram disk instead of a flash disk? This is used
+		 * for ZY1000 live demo...
+		 *
+		 * copy over flash disk to ram block device
+		 */
+		if (boolParam(&quot;ramdisk&quot;))
 		{
-			diag_printf(&quot;unable to mount jffs\n&quot;);
-			reboot();
-		}
+			diag_printf(&quot;Unmounting /config from flash and using ram instead\n&quot;);
+			err = umount(&quot;/config&quot;);
+			if (err &lt; 0)
+			{
+				diag_printf(&quot;unable to unmount jffs\n&quot;);
+				reboot();
+			}
 
 			err = mount(&quot;/dev/flash1&quot;, &quot;/config2&quot;, &quot;jffs2&quot;);
 			if (err &lt; 0)
@@ -1924,33 +969,22 @@
 				reboot();
 			}
 
-	//		copydir(&quot;/config2&quot;, &quot;/config&quot;);
+			//		copydir(&quot;/config2&quot;, &quot;/config&quot;);
 			copyfile(&quot;/config2/ip&quot;, &quot;/config/ip&quot;);
 			copydir(&quot;/config2/settings&quot;, &quot;/config/settings&quot;);
 
 			umount(&quot;/config2&quot;);
-		} else
-		{
-			diag_printf(&quot;unable to mount ram block device\n&quot;);
-			reboot();
 		}
-
-//		copydir(&quot;/config2&quot;, &quot;/config&quot;);
-		copyfile(&quot;/config2/ip&quot;, &quot;/config/ip&quot;);
-		copydir(&quot;/config2/settings&quot;, &quot;/config/settings&quot;);
-
-		umount(&quot;/config2&quot;);
-	} else
-	{
-		/* we're not going to use a ram block disk */
-		free(ramblockdevice);
 	}
 
+	mkdir(zylin_config_dir, 0777);
+	char *dirname=alloc_printf(&quot;%s/target&quot;, zylin_config_dir);
+	mkdir(dirname, 0777);
+	free(dirname);
+	dirname=alloc_printf(&quot;%s/event&quot;, zylin_config_dir);
+	mkdir(dirname, 0777);
+	free(dirname);
 
-	mkdir(ZYLIN_CONFIG_DIR, 0777);
-	mkdir(ZYLIN_CONFIG_DIR &quot;/target&quot;, 0777);
-	mkdir(ZYLIN_CONFIG_DIR &quot;/event&quot;, 0777);
-
 	logAllToSerial = boolParam(&quot;logserial&quot;);
 
 	// We need the network &amp; web server in case there is something wrong with
@@ -1964,49 +998,26 @@
 	add_default_dirs();
 
 	/* initialize commandline interface */
-	command_context_t *cmd_ctx;
+	command_context_t * cmd_ctx;
 	cmd_ctx = setup_command_handler();
 	command_set_output_handler(cmd_ctx, configuration_output_handler, NULL);
 	command_context_mode(cmd_ctx, COMMAND_CONFIG);
 
+#if BUILD_IOUTIL
+	if (ioutil_init(cmd_ctx) != ERROR_OK)
+	{
+		return EXIT_FAILURE;
+	}
+#endif
 
-	register_command(cmd_ctx, NULL, &quot;zy1000_version&quot;, handle_zy1000_version_command,
-			COMMAND_EXEC, &quot;show zy1000 version numbers&quot;);
 
-	register_command(cmd_ctx, NULL, &quot;rm&quot;, handle_rm_command, COMMAND_ANY,
-			&quot;remove file&quot;);
-
-	register_command(cmd_ctx, NULL, &quot;fast_load_image&quot;, handle_fast_load_image_command, COMMAND_ANY,
-			&quot;same args as load_image, image stored in memory&quot;);
-
-	register_command(cmd_ctx, NULL, &quot;fast_load&quot;, handle_fast_load_command, COMMAND_ANY,
-			&quot;loads active fast load image to current target&quot;);
-
-	register_command(cmd_ctx, NULL, &quot;cat&quot;, handle_cat_command, COMMAND_ANY,
-			&quot;display file content&quot;);
-
-	register_command(cmd_ctx, NULL, &quot;trunc&quot;, handle_trunc_command, COMMAND_ANY,
-			&quot;truncate a file to 0 size&quot;);
-
-	register_command(cmd_ctx, NULL, &quot;append_file&quot;, handle_append_command,
-			COMMAND_ANY, &quot;append a variable number of strings to a file&quot;);
-
-	register_command(cmd_ctx, NULL, &quot;power&quot;, handle_power_command, COMMAND_ANY,
-			&quot;power &lt;on/off&gt; - turn power switch to target on/off. No arguments - print status.&quot;);
-
-	register_command(cmd_ctx, NULL, &quot;meminfo&quot;, handle_meminfo_command,
-			COMMAND_ANY, &quot;display available ram memory&quot;);
-
-	register_command(cmd_ctx, NULL, &quot;cp&quot;, handle_cp_command,
-					 COMMAND_ANY, &quot;copy a file &lt;from&gt; &lt;to&gt;&quot;);
-
 #ifdef CYGPKG_PROFILE_GPROF
 	register_command(cmd_ctx, NULL, &quot;ecosboard_profile&quot;, eCosBoard_handle_eCosBoard_profile_command,
 			COMMAND_ANY, NULL);
 #endif
-	register_command(cmd_ctx, NULL, &quot;uart&quot;, handle_uart_command,
-					 COMMAND_ANY, &quot;uart &lt;baud&gt;  - forward uart on port 5555&quot;);
 
+	register_command(cmd_ctx, NULL, &quot;uart&quot;, handle_uart_command, COMMAND_ANY,
+			&quot;uart &lt;baud&gt;  - forward uart on port 5555&quot;);
 
 	int errVal;
 	errVal = log_init(cmd_ctx);
@@ -2024,11 +1035,12 @@
 
 	if (logAllToSerial)
 	{
-		diag_printf(ZYLIN_CONFIG_DIR &quot;/logserial=1 =&gt; sending log output to serial port using \&quot;debug_level 3\&quot; as default.\n&quot;);
+		diag_printf(
+				 &quot;%s/logserial=1 =&gt; sending log output to serial port using \&quot;debug_level 3\&quot; as default.\n&quot;, zylin_config_dir);
 		command_run_line(cmd_ctx, &quot;debug_level 3&quot;);
 	}
 
-	zylinjtag_parse_config_file(cmd_ctx, &quot;/rom/openocd.cfg&quot;);
+	command_run_linef(cmd_ctx, &quot;script /rom/openocd.cfg&quot;);
 
 	// FIX!!!  Yuk!
 	// diag_printf() is really invoked from many more places than we trust it
@@ -2037,7 +1049,8 @@
 	// Disabling it here is safe and gives us enough logged debug output for now. Crossing
 	// fingers that it doesn't cause any crashes.
 	diag_printf(&quot;Init complete, GDB &amp; telnet servers launched.\n&quot;);
-	command_set_output_handler(cmd_ctx, zy1000_configuration_output_handler_log, NULL);
+	command_set_output_handler(cmd_ctx,
+			zy1000_configuration_output_handler_log, NULL);
 	if (!logAllToSerial)
 	{
 		serialLog = false;
@@ -2055,13 +1068,11 @@
 	umount(&quot;/config&quot;);
 
 	exit(0);
-	for (;;);
+	for (;;)
+		;
 }
 
-
-
-cyg_int32
-cyg_httpd_exec_cgi_tcl(char *file_name);
+cyg_int32 cyg_httpd_exec_cgi_tcl(char *file_name);
 cyg_int32 homeForm(CYG_HTTPD_STATE *p)
 {
 	cyg_httpd_exec_cgi_tcl(&quot;/ram/cgi/index.tcl&quot;);
@@ -2163,18 +1174,12 @@
 // This set of file operations are used for normal open files.
 
 static cyg_fileops tftpfs_fileops =
-{
-	tftpfs_fo_read,
-	tftpfs_fo_write,
-	tftpfs_fo_lseek,
-	(cyg_fileop_ioctl *)cyg_fileio_erofs,
-    cyg_fileio_seltrue,
-    tftpfs_fo_fsync,
-    tftpfs_fo_close,
+{ tftpfs_fo_read, tftpfs_fo_write, tftpfs_fo_lseek,
+		(cyg_fileop_ioctl *) cyg_fileio_erofs, cyg_fileio_seltrue,
+		tftpfs_fo_fsync, tftpfs_fo_close,
 		(cyg_fileop_fstat *) cyg_fileio_erofs,
 		(cyg_fileop_getinfo *) cyg_fileio_erofs,
-	(cyg_fileop_setinfo *)cyg_fileio_erofs,
-};
+		(cyg_fileop_setinfo *) cyg_fileio_erofs, };
 
 // -------------------------------------------------------------------------
 // tftpfs_mount()
@@ -2271,7 +1276,8 @@
 	if (!tftp-&gt;readFile)
 	{
 		int err;
-	    tftp-&gt;actual = tftp_client_get( tftp-&gt;file, tftp-&gt;server, 0, tftp-&gt;mem, tftpMaxSize,   TFTP_OCTET, &amp;err);
+		tftp-&gt;actual = tftp_client_get(tftp-&gt;file, tftp-&gt;server, 0, tftp-&gt;mem,
+				tftpMaxSize, TFTP_OCTET, &amp;err);
 
 		if (tftp-&gt;actual &lt; 0)
 		{
@@ -2286,8 +1292,7 @@
 // tftpfs_fo_write()
 // Read data from file.
 
-static int
-tftpfs_fo_read(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
+static int tftpfs_fo_read(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
 {
 	struct Tftp *tftp = (struct Tftp *) fp-&gt;f_data;
 
@@ -2319,9 +1324,7 @@
 	return ENOERR;
 }
 
-
-static int
-tftpfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
+static int tftpfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
 {
 	struct Tftp *tftp = (struct Tftp *) fp-&gt;f_data;
 
@@ -2352,8 +1355,7 @@
 	return ENOERR;
 }
 
-static int
-tftpfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode)
+static int tftpfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode)
 {
 	int error = ENOERR;
 	return error;
@@ -2370,7 +1372,8 @@
 
 	if (tftp-&gt;write)
 	{
-	    tftp_client_put( tftp-&gt;file, tftp-&gt;server, 0, tftp-&gt;mem, fp-&gt;f_offset,   TFTP_OCTET, &amp;error);
+		tftp_client_put(tftp-&gt;file, tftp-&gt;server, 0, tftp-&gt;mem, fp-&gt;f_offset,
+				TFTP_OCTET, &amp;error);
 	}
 
 	freeTftp(tftp);
@@ -2430,13 +1433,13 @@
 }
 
 // Chunked version.
-cyg_int32
-show_log_entry(CYG_HTTPD_STATE *phttpstate)
+cyg_int32 show_log_entry(CYG_HTTPD_STATE *phttpstate)
 {
 	cyg_httpd_start_chunked(&quot;text&quot;);
 	if (logCount &gt;= logSize)
 	{
-        cyg_httpd_write_chunked(logBuffer+logCount%logSize, logSize-logCount%logSize);
+		cyg_httpd_write_chunked(logBuffer + logCount % logSize, logSize
+				- logCount % logSize);
 	}
 	cyg_httpd_write_chunked(logBuffer, writePtr);
 	cyg_httpd_end_chunked();
@@ -2450,8 +1453,7 @@
 static int logfs_umount(cyg_mtab_entry *mte);
 static int logfs_open(cyg_mtab_entry *mte, cyg_dir dir, const char *name,
 		int mode, cyg_file *fte);
-static int
-logfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio);
+static int logfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio);
 
 // File operations
 static int logfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode);
@@ -2488,18 +1490,12 @@
 // This set of file operations are used for normal open files.
 
 static cyg_fileops logfs_fileops =
-{
-	(cyg_fileop_read *)cyg_fileio_erofs,
-    (cyg_fileop_write *)logfs_fo_write,
+{ (cyg_fileop_read *) cyg_fileio_erofs, (cyg_fileop_write *) logfs_fo_write,
 		(cyg_fileop_lseek *) cyg_fileio_erofs,
-	(cyg_fileop_ioctl *)cyg_fileio_erofs,
-    cyg_fileio_seltrue,
-    logfs_fo_fsync,
-    logfs_fo_close,
-	(cyg_fileop_fstat *)cyg_fileio_erofs,
+		(cyg_fileop_ioctl *) cyg_fileio_erofs, cyg_fileio_seltrue,
+		logfs_fo_fsync, logfs_fo_close, (cyg_fileop_fstat *) cyg_fileio_erofs,
 		(cyg_fileop_getinfo *) cyg_fileio_erofs,
-	(cyg_fileop_setinfo *)cyg_fileio_erofs,
-};
+		(cyg_fileop_setinfo *) cyg_fileio_erofs, };
 
 // -------------------------------------------------------------------------
 // logfs_mount()
@@ -2532,8 +1528,7 @@
 // logfs_fo_write()
 // Write data to file.
 
-static int
-logfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
+static int logfs_fo_write(struct CYG_FILE_TAG *fp, struct CYG_UIO_TAG *uio)
 {
 	int i;
 	for (i = 0; i &lt; uio-&gt;uio_iovcnt; i++)
@@ -2548,8 +1543,7 @@
 
 	return ENOERR;
 }
-static int
-logfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode)
+static int logfs_fo_fsync(struct CYG_FILE_TAG *fp, int mode)
 {
 	return ENOERR;
 }

Modified: branches/openocd-0.1/src/flash/Makefile.am
===================================================================
--- branches/openocd_1_0_branch/src/flash/Makefile.am	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/Makefile.am	2009-01-16 06:43:11 UTC (rev 1325)
@@ -4,7 +4,7 @@
 noinst_LIBRARIES = libflash.a
 libflash_a_SOURCES = flash.c lpc2000.c cfi.c non_cfi.c at91sam7.c at91sam7_old.c str7x.c str9x.c aduc702x.c nand.c lpc3180_nand_controller.c \
 					 stellaris.c str9xpec.c stm32x.c tms470.c ecos.c  \
-		     s3c24xx_nand.c s3c2410_nand.c s3c2412_nand.c s3c2440_nand.c s3c2443_nand.c lpc288x.c ocl.c mflash.c
+		     s3c24xx_nand.c s3c2410_nand.c s3c2412_nand.c s3c2440_nand.c s3c2443_nand.c lpc288x.c ocl.c mflash.c pic32mx.c
 noinst_HEADERS = flash.h lpc2000.h cfi.h non_cfi.h at91sam7.h at91sam7_old.h str7x.h str9x.h nand.h lpc3180_nand_controller.h \
 				 stellaris.h str9xpec.h stm32x.h tms470.h s3c24xx_nand.h s3c24xx_regs_nand.h lpc288x.h mflash.h \
-				 ocl.h
+				 ocl.h pic32mx.h

Modified: branches/openocd-0.1/src/flash/cfi.h
===================================================================
--- branches/openocd_1_0_branch/src/flash/cfi.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/cfi.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -148,10 +148,10 @@
 } cfi_fixup_t;
 
 #define CFI_MFR_AMD		0x0001
-#define CFI_MFR_FUJITSU		0x0004
+#define CFI_MFR_FUJITSU	0x0004
 #define CFI_MFR_ATMEL	0x001F
 #define CFI_MFR_ST		0x0020	/* STMicroelectronics */
-#define CFI_MFR_AMIC		0x0037
+#define CFI_MFR_AMIC	0x0037
 #define CFI_MFR_SST		0x00BF
 #define CFI_MFR_MX		0x00C2
 

Modified: branches/openocd-0.1/src/flash/ecos.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/ecos.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/ecos.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -25,7 +25,6 @@
 
 #include &quot;replacements.h&quot;
 
-
 #include &quot;flash.h&quot;
 
 #include &quot;target.h&quot;
@@ -37,8 +36,6 @@
 #include &quot;../target/embeddedice.h&quot;
 #include &quot;types.h&quot;
 
-
-
 int ecosflash_register_commands(struct command_context_s *cmd_ctx);
 int ecosflash_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
 int ecosflash_erase(struct flash_bank_s *bank, int first, int last);
@@ -99,42 +96,41 @@
 #define FLASH_ERR_DRV_WRONG_PART  0x0d  /* Driver does not support device */
 #define FLASH_ERR_LOW_VOLTAGE     0x0e  /* Not enough juice to complete job */
 
-
 char *
 flash_errmsg(int err)
 {
-    switch (err) {
-    case FLASH_ERR_OK:
-        return &quot;No error - operation complete&quot;;
-    case FLASH_ERR_ERASE_SUSPEND:
-        return &quot;Device is in erase suspend state&quot;;
-    case FLASH_ERR_PROGRAM_SUSPEND:
-        return &quot;Device is in program suspend state&quot;;
-    case FLASH_ERR_INVALID:
-        return &quot;Invalid FLASH address&quot;;
-    case FLASH_ERR_ERASE:
-        return &quot;Error trying to erase&quot;;
-    case FLASH_ERR_LOCK:
-        return &quot;Error trying to lock/unlock&quot;;
-    case FLASH_ERR_PROGRAM:
-        return &quot;Error trying to program&quot;;
-    case FLASH_ERR_PROTOCOL:
-        return &quot;Generic error&quot;;
-    case FLASH_ERR_PROTECT:
-        return &quot;Device/region is write-protected&quot;;
-    case FLASH_ERR_NOT_INIT:
-        return &quot;FLASH sub-system not initialized&quot;;
-    case FLASH_ERR_DRV_VERIFY:
-        return &quot;Data verify failed after operation&quot;;
-    case FLASH_ERR_DRV_TIMEOUT:
-        return &quot;Driver timed out waiting for device&quot;;
-    case FLASH_ERR_DRV_WRONG_PART:
-        return &quot;Driver does not support device&quot;;
-    case FLASH_ERR_LOW_VOLTAGE:
-        return &quot;Device reports low voltage&quot;;
-    default:
-        return &quot;Unknown error&quot;;
-    }
+	switch (err) {
+	case FLASH_ERR_OK:
+		return &quot;No error - operation complete&quot;;
+	case FLASH_ERR_ERASE_SUSPEND:
+		return &quot;Device is in erase suspend state&quot;;
+	case FLASH_ERR_PROGRAM_SUSPEND:
+		return &quot;Device is in program suspend state&quot;;
+	case FLASH_ERR_INVALID:
+		return &quot;Invalid FLASH address&quot;;
+	case FLASH_ERR_ERASE:
+		return &quot;Error trying to erase&quot;;
+	case FLASH_ERR_LOCK:
+		return &quot;Error trying to lock/unlock&quot;;
+	case FLASH_ERR_PROGRAM:
+		return &quot;Error trying to program&quot;;
+	case FLASH_ERR_PROTOCOL:
+		return &quot;Generic error&quot;;
+	case FLASH_ERR_PROTECT:
+		return &quot;Device/region is write-protected&quot;;
+	case FLASH_ERR_NOT_INIT:
+		return &quot;FLASH sub-system not initialized&quot;;
+	case FLASH_ERR_DRV_VERIFY:
+		return &quot;Data verify failed after operation&quot;;
+	case FLASH_ERR_DRV_TIMEOUT:
+		return &quot;Driver timed out waiting for device&quot;;
+	case FLASH_ERR_DRV_WRONG_PART:
+		return &quot;Driver does not support device&quot;;
+	case FLASH_ERR_LOW_VOLTAGE:
+		return &quot;Device reports low voltage&quot;;
+	default:
+		return &quot;Unknown error&quot;;
+	}
 }
 #endif
 
@@ -185,7 +181,6 @@
 	return ERROR_OK;
 }
 
-
 int loadDriver(ecosflash_flash_bank_t *info)
 {
 	u32 buf_cnt;
@@ -228,7 +223,6 @@
 	return ERROR_OK;
 }
 
-
 static int const OFFSET_ERASE=0x0;
 static int const OFFSET_ERASE_SIZE=0x8;
 static int const OFFSET_FLASH=0xc;
@@ -236,7 +230,6 @@
 static int const OFFSET_GET_WORKAREA=0x18;
 static int const OFFSET_GET_WORKAREA_SIZE=0x4;
 
-
 int runCode(ecosflash_flash_bank_t *info,
 		u32 codeStart, u32 codeStop, u32 r0, u32 r1, u32 r2,
 		u32 *result,
@@ -334,8 +327,8 @@
 
 
 	int i;
-    for (i=0; i&lt;len; i+=chunk)
-    {
+	for (i=0; i&lt;len; i+=chunk)
+	{
 		int t=len-i;
 		if (t&gt;chunk)
 		{
@@ -343,38 +336,36 @@
 		}
 
 		int retval;
-    	retval=target_write_buffer(target, buffer, t, ((u8 *)data)+i);
-    	if (retval != ERROR_OK)
-    		return retval;
+		retval=target_write_buffer(target, buffer, t, ((u8 *)data)+i);
+		if (retval != ERROR_OK)
+			return retval;
 
-    	u32 flashErr;
-    	retval=runCode(info,
-    			info-&gt;start_address+OFFSET_FLASH,
-    			info-&gt;start_address+OFFSET_FLASH+OFFSET_FLASH_SIZE,
-    			buffer,
-    			address+i,
-    			t,
-    			&amp;flashErr,
-    			timeout);
-    	if (retval != ERROR_OK)
-    		return retval;
+		u32 flashErr;
+		retval=runCode(info,
+				info-&gt;start_address+OFFSET_FLASH,
+				info-&gt;start_address+OFFSET_FLASH+OFFSET_FLASH_SIZE,
+				buffer,
+				address+i,
+				t,
+				&amp;flashErr,
+				timeout);
+		if (retval != ERROR_OK)
+			return retval;
 
 		if (flashErr != 0x0)
 		{
 			LOG_ERROR(&quot;Flash prog failed with %d (%s)\n&quot;, flashErr, flash_errmsg(flashErr));
 			return ERROR_FAIL;
 		}
-    }
+	}
 	return ERROR_OK;
 }
 
-
 int ecosflash_probe(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
 
-
 int ecosflash_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, &quot;ecosflash&quot;, NULL, COMMAND_ANY, NULL);
@@ -382,7 +373,7 @@
 	return ERROR_OK;
 }
 
-/*
+#if 0
 static void command(flash_bank_t *bank, u8 cmd, u8 *cmd_buf)
 {
 	ecosflash_flash_bank_t *info = bank-&gt;driver_priv;
@@ -403,7 +394,7 @@
 		}
 	}
 }
-*/
+#endif
 
 u32 ecosflash_address(struct flash_bank_s *bank, u32 address)
 {
@@ -421,7 +412,6 @@
 	return retval + bank-&gt;base;
 }
 
-
 int ecosflash_erase(struct flash_bank_s *bank, int first, int last)
 {
 	struct flash_bank_s *c=bank;
@@ -434,7 +424,6 @@
 	return ERROR_OK;
 }
 
-
 int ecosflash_write(struct flash_bank_s *bank, u8 *buffer, u32 offset, u32 count)
 {
 	ecosflash_flash_bank_t *info = bank-&gt;driver_priv;
@@ -442,7 +431,6 @@
 	return eCosBoard_flash(info, buffer, c-&gt;base+offset, count);
 }
 
-
 int ecosflash_protect_check(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
@@ -455,7 +443,6 @@
 	return ERROR_OK;
 }
 
-
 u32 ecosflash_get_flash_status(flash_bank_t *bank)
 {
 	return ERROR_OK;
@@ -475,7 +462,3 @@
 {
 	return ERROR_OK;
 }
-
-
-
-

Modified: branches/openocd-0.1/src/flash/flash.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/flash.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/flash.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -78,6 +78,7 @@
 extern flash_driver_t ecosflash_flash;
 extern flash_driver_t lpc288x_flash;
 extern flash_driver_t ocl_flash;
+extern flash_driver_t pic32mx_flash;
 
 flash_driver_t *flash_drivers[] = {
 	&amp;lpc2000_flash,
@@ -94,6 +95,7 @@
 	&amp;ecosflash_flash,
 	&amp;lpc288x_flash,
 	&amp;ocl_flash,
+	&amp;pic32mx_flash,
 	NULL,
 };
 
@@ -316,14 +318,17 @@
 			/* put flash bank in linked list */
 			if (flash_banks)
 			{
+				int	bank_num = 0;
 				/* find last flash bank */
-				for (p = flash_banks; p &amp;&amp; p-&gt;next; p = p-&gt;next);
+				for (p = flash_banks; p &amp;&amp; p-&gt;next; p = p-&gt;next) bank_num++;
 				if (p)
 					p-&gt;next = c;
+				c-&gt;bank_number = bank_num + 1;
 			}
 			else
 			{
 				flash_banks = c;
+				c-&gt;bank_number = 0;
 			}
 
 			found = 1;
@@ -466,7 +471,6 @@
 						j, p-&gt;sectors[j].offset, p-&gt;sectors[j].size, p-&gt;sectors[j].size&gt;&gt;10,
 						erase_state);
 		}
-
 	}
 
 	return ERROR_OK;
@@ -658,7 +662,6 @@
 		command_print(cmd_ctx, &quot;auto erase enabled&quot;);
 	}
 
-
 	if (argc &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -743,7 +746,6 @@
 	if(count == 0)
 		return ERROR_OK;
 
-
 	switch(cmd[4])
 	{
 	case 'w':
@@ -804,7 +806,6 @@
 		return retval;
 	}
 
-
 	if(err == ERROR_OK)
 	{
 		float speed;

Modified: branches/openocd-0.1/src/flash/lpc2000.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/lpc2000.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/lpc2000.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -577,7 +577,7 @@
 			break;
 		
 		if (bytes_remaining &gt;= thisrun_bytes)
-		{                      
+		{
 			if ((retval = target_write_buffer(bank-&gt;target, download_area-&gt;address, thisrun_bytes, buffer + bytes_written)) != ERROR_OK)
 			{
 				retval = ERROR_FLASH_OPERATION_FAILED;

Modified: branches/openocd-0.1/src/flash/lpc288x.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/lpc288x.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/lpc288x.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -126,7 +126,6 @@
 	.info = lpc288x_info
 };
 
-
 int lpc288x_register_commands(struct command_context_s *cmd_ctx)
 {
 	return ERROR_OK;
@@ -204,7 +203,7 @@
 
 int lpc288x_protect_check(struct flash_bank_s *bank)
 {
-    return ERROR_OK;
+	return ERROR_OK;
 }
 
 /* flash_bank LPC288x 0 0 0 0 &lt;target#&gt; &lt;cclk&gt; */

Modified: branches/openocd-0.1/src/flash/lpc3180_nand_controller.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/lpc3180_nand_controller.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/lpc3180_nand_controller.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -69,7 +69,7 @@
 int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device)
 {
 	lpc3180_nand_controller_t *lpc3180_info;
-		
+	
 	if (argc &lt; 3)
 	{
 		LOG_WARNING(&quot;incomplete 'lpc3180' nand flash configuration&quot;);
@@ -126,7 +126,7 @@
 	
 	if (bypass &amp;&amp; !direct)	/* bypass mode */
 		return fclkin / (2 * p);
-		
+	
 	if (bypass &amp; direct)	/* direct bypass mode */
 		return fclkin;
 	
@@ -273,7 +273,7 @@
 		trhz = ((30 / cycle) + 1);
 		trbwb = ((100 / cycle) + 1);
 		tcea = ((45 / cycle) + 1);
-				
+		
 		/* MLC_LOCK = 0xa25e (unlock protected registers) */
 		target_write_u32(target, 0x200b8044, 0xa25e);
 	

Modified: branches/openocd-0.1/src/flash/mflash.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/mflash.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/mflash.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -80,7 +80,7 @@
 	target_t *target = mflash_bank-&gt;target;
 	int ret;
 
-	// remove alternate function.
+	/* remove alternate function. */
 	mask = 0x3u &lt;&lt; (gpio.num &amp; 0xF)*2;
 
 	addr = PXA270_GAFR0_L + (gpio.num &gt;&gt; 4) * 4;
@@ -95,7 +95,7 @@
 	if ((ret = target_write_u32(target, addr, value)) != ERROR_OK)
 		return ret;
 
-	// set direction to output
+	/* set direction to output */
 	mask = 0x1u &lt;&lt; (gpio.num &amp; 0x1F);
 
 	addr = PXA270_GPDR0 + (gpio.num &gt;&gt; 5) * 4;
@@ -261,75 +261,75 @@
 
 	duration_start_measure(&amp;duration);
 
-    while (time) {
+	while (time) {
 
-    	target_read_u8(target, mg_task_reg + MG_REG_STATUS, &amp;status);
+		target_read_u8(target, mg_task_reg + MG_REG_STATUS, &amp;status);
 
-    	if (status &amp; mg_io_rbit_status_busy)
-	    {
-    		if (wait == mg_io_wait_bsy)
-	               return ERROR_OK;
-	    } else {
-	        switch(wait)
-	        {
-	            case mg_io_wait_not_bsy:
-	                return ERROR_OK;
-	            case mg_io_wait_rdy_noerr:
-	                if (status &amp; mg_io_rbit_status_ready)
-	                    return ERROR_OK;
-	                break;
-	            case mg_io_wait_drq_noerr:
-	                if (status &amp; mg_io_rbit_status_data_req)
-	                    return ERROR_OK;
-	                break;
-	            default:
-	                break;
-	        }
+		if (status &amp; mg_io_rbit_status_busy)
+		{
+			if (wait == mg_io_wait_bsy)
+				return ERROR_OK;
+		} else {
+			switch(wait)
+			{
+				case mg_io_wait_not_bsy:
+					return ERROR_OK;
+				case mg_io_wait_rdy_noerr:
+					if (status &amp; mg_io_rbit_status_ready)
+						return ERROR_OK;
+					break;
+				case mg_io_wait_drq_noerr:
+					if (status &amp; mg_io_rbit_status_data_req)
+						return ERROR_OK;
+					break;
+				default:
+					break;
+			}
 
-	        // Now we check the error condition!
-	        if (status &amp; mg_io_rbit_status_error)
-	        {
-	            target_read_u8(target, mg_task_reg + MG_REG_ERROR, &amp;error);
+			/* Now we check the error condition! */
+			if (status &amp; mg_io_rbit_status_error)
+			{
+				target_read_u8(target, mg_task_reg + MG_REG_ERROR, &amp;error);
 
-                if (error &amp; mg_io_rbit_err_bad_sect_num) {
-                	LOG_ERROR(&quot;sector not found&quot;);
-                    return ERROR_FAIL;
-                }
-                else if (error &amp; (mg_io_rbit_err_bad_block | mg_io_rbit_err_uncorrectable)) {
-                	LOG_ERROR(&quot;bad block&quot;);
-                    return ERROR_FAIL;
-                } else {
-                	LOG_ERROR(&quot;disk operation fail&quot;);
-	                return ERROR_FAIL;
-	            }
-	        }
+				if (error &amp; mg_io_rbit_err_bad_sect_num) {
+					LOG_ERROR(&quot;sector not found&quot;);
+					return ERROR_FAIL;
+				}
+				else if (error &amp; (mg_io_rbit_err_bad_block | mg_io_rbit_err_uncorrectable)) {
+					LOG_ERROR(&quot;bad block&quot;);
+					return ERROR_FAIL;
+				} else {
+					LOG_ERROR(&quot;disk operation fail&quot;);
+					return ERROR_FAIL;
+				}
+			}
 
-	        switch (wait)
-	        {
-	            case mg_io_wait_rdy:
-	                if (status &amp; mg_io_rbit_status_ready)
-	                    return ERROR_OK;
+			switch (wait)
+			{
+				case mg_io_wait_rdy:
+					if (status &amp; mg_io_rbit_status_ready)
+						return ERROR_OK;
 
-	            case mg_io_wait_drq:
-	                if (status &amp; mg_io_rbit_status_data_req)
-	                    return ERROR_OK;
+				case mg_io_wait_drq:
+					if (status &amp; mg_io_rbit_status_data_req)
+						return ERROR_OK;
 
-	            default:
-	            	break;
-	        }
-	    }
+				default:
+					break;
+			}
+		}
 
-    	duration_stop_measure(&amp;duration, NULL);
+		duration_stop_measure(&amp;duration, NULL);
 
-  		t=duration.duration.tv_usec/1000;
-   		t+=duration.duration.tv_sec*1000;
+		t=duration.duration.tv_usec/1000;
+		t+=duration.duration.tv_sec*1000;
 
 		if (t &gt; time)
-            break;
-    }
+			break;
+	}
 
-    LOG_ERROR(&quot;timeout occured&quot;);
-    return ERROR_FAIL;
+	LOG_ERROR(&quot;timeout occured&quot;);
+	return ERROR_FAIL;
 }
 
 static int mg_dsk_srst(u8 on)
@@ -634,7 +634,6 @@
 			LOG_DEBUG(&quot;copies %u byte&quot;, end_addr - cur_addr);
 
 		}
-
 	}
 
 	free(sect_buff);
@@ -671,7 +670,6 @@
 		}
 
 		mg_mflash_write_sects(sect_buff, sect_num, 1);
-
 	}
 
 	if (cur_addr &lt; end_addr) {
@@ -697,9 +695,7 @@
 			memcpy(sect_buff, buff_ptr, end_addr - cur_addr);
 			LOG_DEBUG(&quot;copies %u byte&quot;, end_addr - cur_addr);
 			mg_mflash_write_sects(sect_buff, sect_num, 1);
-
 		}
-
 	}
 
 	free(sect_buff);
@@ -711,7 +707,7 @@
 {
 	u32 address, buf_cnt;
 	u8 *buffer;
-	// TODO : multi-bank support, large file support
+	/* TODO : multi-bank support, large file support */
 	fileio_t fileio;
 	duration_t duration;
 	char *duration_text;
@@ -727,7 +723,6 @@
 		mg_mflash_probe();
 	}
 
-
 	if (fileio_open(&amp;fileio, args[1], FILEIO_READ, FILEIO_BINARY) != ERROR_OK) {
 		return ERROR_FAIL;
 	}
@@ -764,7 +759,7 @@
 {
 	u32 address, size_written, size;
 	u8 *buffer;
-	// TODO : multi-bank support
+	/* TODO : multi-bank support */
 	fileio_t fileio;
 	duration_t duration;
 	char *duration_text;

Modified: branches/openocd-0.1/src/flash/mflash.h
===================================================================
--- branches/openocd_1_0_branch/src/flash/mflash.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/mflash.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -39,79 +39,79 @@
 
 typedef struct _mg_io_type_drv_info {
 
-    mg_io_uint16 general_configuration;            // 00
-    mg_io_uint16 number_of_cylinders;               // 01
-    mg_io_uint16 reserved1;                       // 02
-    mg_io_uint16 number_of_heads;                   // 03
-    mg_io_uint16 unformatted_bytes_per_track;        // 04
-    mg_io_uint16 unformatted_bytes_per_sector;       // 05
-    mg_io_uint16 sectors_per_track;                 // 06
-    mg_io_uint8  vendor_unique1[6];                // 07/08/09
+	mg_io_uint16 general_configuration;				/* 00 */
+	mg_io_uint16 number_of_cylinders;				/* 01 */
+	mg_io_uint16 reserved1;							/* 02 */
+	mg_io_uint16 number_of_heads;					/* 03 */
+	mg_io_uint16 unformatted_bytes_per_track;		/* 04 */
+	mg_io_uint16 unformatted_bytes_per_sector;		/* 05 */
+	mg_io_uint16 sectors_per_track;					/* 06 */
+	mg_io_uint8  vendor_unique1[6];					/* 07/08/09 */
 
-    mg_io_uint8  serial_number[20];                // 10~19
+	mg_io_uint8  serial_number[20];					/* 10~19 */
 
-    mg_io_uint16 buffer_type;                      // 20
-    mg_io_uint16 buffer_sector_size;                // 21
-    mg_io_uint16 number_of_ecc_bytes;                // 22
+	mg_io_uint16 buffer_type;						/* 20 */
+	mg_io_uint16 buffer_sector_size;				/* 21 */
+	mg_io_uint16 number_of_ecc_bytes;				/* 22 */
 
-    mg_io_uint8  firmware_revision[8];             // 23~26
-    mg_io_uint8  model_number[40];                 // 27
+	mg_io_uint8  firmware_revision[8];				/* 23~26 */
+	mg_io_uint8  model_number[40];					/* 27 */
 
-    mg_io_uint8  maximum_block_transfer;            // 47 low byte
-    mg_io_uint8  vendor_unique2;                   // 47 high byte
-    mg_io_uint16 dword_io;                    // 48
+	mg_io_uint8  maximum_block_transfer;			/* 47 low byte */
+	mg_io_uint8  vendor_unique2;					/* 47 high byte */
+	mg_io_uint16 dword_io;							/* 48 */
 
-    mg_io_uint16 capabilities;                    // 49
-    mg_io_uint16 reserved2;                       // 50
+	mg_io_uint16 capabilities;						/* 49 */
+	mg_io_uint16 reserved2;							/* 50 */
 
-    mg_io_uint8  vendor_unique3;                   // 51 low byte
-    mg_io_uint8  pio_cycle_timing_mode;              // 51 high byte
-    mg_io_uint8  vendor_unique4;                   // 52 low byte
-    mg_io_uint8  dma_cycle_timing_mode;              // 52 high byte
-    mg_io_uint16 translation_fields_valid;          // 53 (low bit)
-    mg_io_uint16 number_of_current_cylinders;        // 54
-    mg_io_uint16 number_of_current_heads;            // 55
-    mg_io_uint16 current_sectors_per_track;          // 56
-    mg_io_uint16 current_sector_capacity_lo;      // 57 &amp; 58
-    mg_io_uint16 current_sector_capacity_hi;     // 57 &amp; 58
-    mg_io_uint8  multi_sector_count;                // 59 low
-    mg_io_uint8  multi_sector_setting_valid;         // 59 high (low bit)
+	mg_io_uint8  vendor_unique3;					/* 51 low byte */
+	mg_io_uint8  pio_cycle_timing_mode;				/* 51 high byte */
+	mg_io_uint8  vendor_unique4;					/* 52 low byte */
+	mg_io_uint8  dma_cycle_timing_mode;				/* 52 high byte */
+	mg_io_uint16 translation_fields_valid;			/* 53 (low bit) */
+	mg_io_uint16 number_of_current_cylinders;		/* 54 */
+	mg_io_uint16 number_of_current_heads;			/* 55 */
+	mg_io_uint16 current_sectors_per_track;			/* 56 */
+	mg_io_uint16 current_sector_capacity_lo;		/* 57 &amp; 58 */
+	mg_io_uint16 current_sector_capacity_hi;		/* 57 &amp; 58 */
+	mg_io_uint8  multi_sector_count;				/* 59 low */
+	mg_io_uint8  multi_sector_setting_valid;		/* 59 high (low bit) */
 
-    mg_io_uint16 total_user_addressable_sectors_lo;     // 60 &amp; 61
-    mg_io_uint16 total_user_addressable_sectors_hi;     // 60 &amp; 61
+	mg_io_uint16 total_user_addressable_sectors_lo;	/* 60 &amp; 61 */
+	mg_io_uint16 total_user_addressable_sectors_hi;	/* 60 &amp; 61 */
 
-    mg_io_uint8  single_dma_modes_supported;         // 62 low byte
-    mg_io_uint8  single_dma_transfer_active;         // 62 high byte
-    mg_io_uint8  multi_dma_modes_supported;          // 63 low byte
-    mg_io_uint8  multi_dma_transfer_active;          // 63 high byte
-    mg_io_uint16 adv_pio_mode;
-    mg_io_uint16 min_dma_cyc;
-    mg_io_uint16 recommend_dma_cyc;
-    mg_io_uint16 min_pio_cyc_no_iordy;
-    mg_io_uint16 min_pio_cyc_with_iordy;
-    mg_io_uint8  reserved3[22];
-    mg_io_uint16 major_ver_num;
-    mg_io_uint16 minor_ver_num;
-    mg_io_uint16 feature_cmd_set_suprt0;
-    mg_io_uint16 feature_cmd_set_suprt1;
-    mg_io_uint16 feature_cmd_set_suprt2;
-    mg_io_uint16 feature_cmd_set_en0;
-    mg_io_uint16 feature_cmd_set_en1;
-    mg_io_uint16 feature_cmd_set_en2;
-    mg_io_uint16 reserved4;
-    mg_io_uint16 req_time_for_security_er_done;
-    mg_io_uint16 req_time_for_enhan_security_er_done;
-    mg_io_uint16 adv_pwr_mgm_lvl_val;
-    mg_io_uint16 reserved5;
-    mg_io_uint16 re_of_hw_rst;
-    mg_io_uint8  reserved6[68];
-    mg_io_uint16 security_stas;
-    mg_io_uint8  vendor_uniq_bytes[62];
-    mg_io_uint16 cfa_pwr_mode;
-    mg_io_uint8  reserved7[186];
+	mg_io_uint8  single_dma_modes_supported;		/* 62 low byte */
+	mg_io_uint8  single_dma_transfer_active;		/* 62 high byte */
+	mg_io_uint8  multi_dma_modes_supported;			/* 63 low byte */
+	mg_io_uint8  multi_dma_transfer_active;			/* 63 high byte */
+	mg_io_uint16 adv_pio_mode;
+	mg_io_uint16 min_dma_cyc;
+	mg_io_uint16 recommend_dma_cyc;
+	mg_io_uint16 min_pio_cyc_no_iordy;
+	mg_io_uint16 min_pio_cyc_with_iordy;
+	mg_io_uint8  reserved3[22];
+	mg_io_uint16 major_ver_num;
+	mg_io_uint16 minor_ver_num;
+	mg_io_uint16 feature_cmd_set_suprt0;
+	mg_io_uint16 feature_cmd_set_suprt1;
+	mg_io_uint16 feature_cmd_set_suprt2;
+	mg_io_uint16 feature_cmd_set_en0;
+	mg_io_uint16 feature_cmd_set_en1;
+	mg_io_uint16 feature_cmd_set_en2;
+	mg_io_uint16 reserved4;
+	mg_io_uint16 req_time_for_security_er_done;
+	mg_io_uint16 req_time_for_enhan_security_er_done;
+	mg_io_uint16 adv_pwr_mgm_lvl_val;
+	mg_io_uint16 reserved5;
+	mg_io_uint16 re_of_hw_rst;
+	mg_io_uint8  reserved6[68];
+	mg_io_uint16 security_stas;
+	mg_io_uint8  vendor_uniq_bytes[62];
+	mg_io_uint16 cfa_pwr_mode;
+	mg_io_uint8  reserved7[186];
 
-    mg_io_uint16 scts_per_secure_data_unit;
-    mg_io_uint16 integrity_word;
+	mg_io_uint16 scts_per_secure_data_unit;
+	mg_io_uint16 integrity_word;
 
 } mg_io_type_drv_info;
 
@@ -140,105 +140,105 @@
 extern int mflash_register_commands(struct command_context_s *cmd_ctx);
 extern int mflash_init_drivers(struct command_context_s *cmd_ctx);
 
-#define MG_MFLASH_SECTOR_SIZE       (0x200)        //512Bytes = 2^9
-#define MG_MFLASH_SECTOR_SIZE_MASK  (0x200-1)
-#define MG_MFLASH_SECTOR_SIZE_SHIFT (9)
+#define MG_MFLASH_SECTOR_SIZE		(0x200)		/* 512Bytes = 2^9 */
+#define MG_MFLASH_SECTOR_SIZE_MASK	(0x200-1)
+#define MG_MFLASH_SECTOR_SIZE_SHIFT	(9)
 
-#define MG_BUFFER_OFFSET    0x8000
+#define MG_BUFFER_OFFSET	0x8000
 #define MG_REG_OFFSET		0xC000
-#define MG_REG_FEATURE		0x2 // write case
-#define MG_REG_ERROR		0x2 // read case
+#define MG_REG_FEATURE		0x2		/* write case */
+#define MG_REG_ERROR		0x2		/* read case */
 #define MG_REG_SECT_CNT		0x4
 #define MG_REG_SECT_NUM		0x6
 #define MG_REG_CYL_LOW		0x8
 #define MG_REG_CYL_HIGH		0xA
 #define MG_REG_DRV_HEAD		0xC
-#define MG_REG_COMMAND		0xE // write case
-#define MG_REG_STATUS		0xE // read  case
+#define MG_REG_COMMAND		0xE		/* write case */
+#define MG_REG_STATUS		0xE		/* read  case */
 #define MG_REG_DRV_CTRL		0x10
 #define MG_REG_BURST_CTRL	0x12
 
-#define MG_OEM_DISK_WAIT_TIME_LONG   15000 // msec
-#define MG_OEM_DISK_WAIT_TIME_NORMAL  3000 // msec
-#define MG_OEM_DISK_WAIT_TIME_SHORT   1000 // msec
+#define MG_OEM_DISK_WAIT_TIME_LONG		15000	/* msec */
+#define MG_OEM_DISK_WAIT_TIME_NORMAL	3000	/* msec */
+#define MG_OEM_DISK_WAIT_TIME_SHORT		1000	/* msec */
 
 typedef enum _mg_io_type_wait{
 
-    mg_io_wait_bsy       = 1,
-    mg_io_wait_not_bsy   = 2,
-    mg_io_wait_rdy       = 3,
-    mg_io_wait_drq       = 4,  // wait for data request
-    mg_io_wait_drq_noerr = 5,  // wait for DRQ but ignore the error status bit
-    mg_io_wait_rdy_noerr = 6   // wait for ready, but ignore error status bit
+	mg_io_wait_bsy       = 1,
+	mg_io_wait_not_bsy   = 2,
+	mg_io_wait_rdy       = 3,
+	mg_io_wait_drq       = 4,	/* wait for data request */
+	mg_io_wait_drq_noerr = 5,	/* wait for DRQ but ignore the error status bit */
+	mg_io_wait_rdy_noerr = 6	/* wait for ready, but ignore error status bit */
 
 } mg_io_type_wait;
 
-//= &quot;Status Register&quot; bit masks.
+/*= &quot;Status Register&quot; bit masks. */
 typedef enum _mg_io_type_rbit_status{
 
-    mg_io_rbit_status_error            = 0x01, // error bit in status register
-    mg_io_rbit_status_corrected_error  = 0x04, // corrected error in status register
-    mg_io_rbit_status_data_req         = 0x08, // data request bit in status register
-    mg_io_rbit_status_seek_done        = 0x10, // DSC - Drive Seek Complete
-    mg_io_rbit_status_write_fault      = 0x20, // DWF - Drive Write Fault
-    mg_io_rbit_status_ready            = 0x40,
-    mg_io_rbit_status_busy             = 0x80
+	mg_io_rbit_status_error            = 0x01, /* error bit in status register */
+	mg_io_rbit_status_corrected_error  = 0x04, /* corrected error in status register */
+	mg_io_rbit_status_data_req         = 0x08, /* data request bit in status register */
+	mg_io_rbit_status_seek_done        = 0x10, /* DSC - Drive Seek Complete */
+	mg_io_rbit_status_write_fault      = 0x20, /* DWF - Drive Write Fault */
+	mg_io_rbit_status_ready            = 0x40,
+	mg_io_rbit_status_busy             = 0x80
 
 } mg_io_type_rbit_status;
 
-//= &quot;Error Register&quot; bit masks.
+/*= &quot;Error Register&quot; bit masks. */
 typedef enum _mg_io_type_rbit_error{
 
-    mg_io_rbit_err_general          = 0x01,
-    mg_io_rbit_err_aborted          = 0x04,
-    mg_io_rbit_err_bad_sect_num     = 0x10,
-    mg_io_rbit_err_uncorrectable    = 0x40,
-    mg_io_rbit_err_bad_block        = 0x80
+	mg_io_rbit_err_general          = 0x01,
+	mg_io_rbit_err_aborted          = 0x04,
+	mg_io_rbit_err_bad_sect_num     = 0x10,
+	mg_io_rbit_err_uncorrectable    = 0x40,
+	mg_io_rbit_err_bad_block        = 0x80
 
 } mg_io_type_rbit_error;
 
-//= &quot;Device Control Register&quot; bit.
+/* = &quot;Device Control Register&quot; bit. */
 typedef enum _mg_io_type_rbit_devc{
 
-    mg_io_rbit_devc_intr      = 0x02,//  interrupt enable bit (1:disable, 0:enable)
-    mg_io_rbit_devc_srst      = 0x04  // softwrae reset bit (1:assert, 0:de-assert)
+	mg_io_rbit_devc_intr      = 0x02,	/* interrupt enable bit (1:disable, 0:enable) */
+	mg_io_rbit_devc_srst      = 0x04	/* softwrae reset bit (1:assert, 0:de-assert) */
 
 } mg_io_type_rbit_devc;
 
-// &quot;Drive Select/Head Register&quot; values.
+/* &quot;Drive Select/Head Register&quot; values. */
 typedef enum _mg_io_type_rval_dev{
 
-    mg_io_rval_dev_must_be_on      =   0x80, // These 1 bits are always on
-    mg_io_rval_dev_drv_master      =  (0x00 | mg_io_rval_dev_must_be_on),// Master
-    mg_io_rval_dev_drv_slave0      =  (0x10 | mg_io_rval_dev_must_be_on),// Slave0
-    mg_io_rval_dev_drv_slave1      =  (0x20 | mg_io_rval_dev_must_be_on),// Slave1
-    mg_io_rval_dev_drv_slave2      =  (0x30 | mg_io_rval_dev_must_be_on),// Slave2
-    mg_io_rval_dev_lba_mode        =  (0x40 | mg_io_rval_dev_must_be_on)
+	mg_io_rval_dev_must_be_on      =   0x80, /* These 1 bits are always on */
+	mg_io_rval_dev_drv_master      =  (0x00 | mg_io_rval_dev_must_be_on), /* Master */
+	mg_io_rval_dev_drv_slave0      =  (0x10 | mg_io_rval_dev_must_be_on), /* Slave0 */
+	mg_io_rval_dev_drv_slave1      =  (0x20 | mg_io_rval_dev_must_be_on), /* Slave1 */
+	mg_io_rval_dev_drv_slave2      =  (0x30 | mg_io_rval_dev_must_be_on), /* Slave2 */
+	mg_io_rval_dev_lba_mode        =  (0x40 | mg_io_rval_dev_must_be_on)
 
 } mg_io_type_rval_dev;
 
 typedef enum _mg_io_type_cmd
 {
-    mg_io_cmd_read             =0x20,
-    mg_io_cmd_write            =0x30,
+	mg_io_cmd_read             =0x20,
+	mg_io_cmd_write            =0x30,
 
-    mg_io_cmd_setmul           =0xC6,
-    mg_io_cmd_readmul          =0xC4,
-    mg_io_cmd_writemul         =0xC5,
+	mg_io_cmd_setmul           =0xC6,
+	mg_io_cmd_readmul          =0xC4,
+	mg_io_cmd_writemul         =0xC5,
 
-    mg_io_cmd_idle             =0x97,//0xE3
-    mg_io_cmd_idle_immediate   =0x95,//0xE1
+	mg_io_cmd_idle             =0x97, /* 0xE3 */
+	mg_io_cmd_idle_immediate   =0x95, /* 0xE1 */
 
-    mg_io_cmd_setsleep         =0x99,//0xE6
-    mg_io_cmd_stdby            =0x96,//0xE2
-    mg_io_cmd_stdby_immediate  =0x94,//0xE0
+	mg_io_cmd_setsleep         =0x99, /* 0xE6 */
+	mg_io_cmd_stdby            =0x96, /* 0xE2 */
+	mg_io_cmd_stdby_immediate  =0x94, /* 0xE0 */
 
-    mg_io_cmd_identify         =0xEC,
-    mg_io_cmd_set_feature      =0xEF,
+	mg_io_cmd_identify         =0xEC,
+	mg_io_cmd_set_feature      =0xEF,
 
-    mg_io_cmd_confirm_write    =0x3C,
-    mg_io_cmd_confirm_read     =0x40,
-    mg_io_cmd_wakeup           =0xC3
+	mg_io_cmd_confirm_write    =0x3C,
+	mg_io_cmd_confirm_read     =0x40,
+	mg_io_cmd_wakeup           =0xC3
 
 } mg_io_type_cmd;
 

Modified: branches/openocd-0.1/src/flash/nand.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/nand.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/nand.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -375,7 +375,7 @@
 int nand_probe(struct nand_device_s *device)
 {
 	u8 manufacturer_id, device_id;
-	u8 id_buff[5];
+	u8 id_buff[6];
 	int retval;
 	int i;
 
@@ -1524,4 +1524,3 @@
 	
 	return ERROR_OK;
 }
-

Copied: branches/openocd-0.1/src/flash/pic32mx.c (from rev 1324, trunk/src/flash/pic32mx.c)

Copied: branches/openocd-0.1/src/flash/pic32mx.h (from rev 1324, trunk/src/flash/pic32mx.h)

Modified: branches/openocd-0.1/src/flash/s3c24xx_regs_nand.h
===================================================================
--- branches/openocd_1_0_branch/src/flash/s3c24xx_regs_nand.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/s3c24xx_regs_nand.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -85,11 +85,11 @@
 #define S3C2440_NFCONT_SPARE_ECCLOCK	(1&lt;&lt;6)
 #define S3C2440_NFCONT_MAIN_ECCLOCK	(1&lt;&lt;5)
 #define S3C2440_NFCONT_INITECC		(1&lt;&lt;4)
-#define S3C2440_NFCONT_nFCE		(1&lt;&lt;1)
+#define S3C2440_NFCONT_nFCE			(1&lt;&lt;1)
 #define S3C2440_NFCONT_ENABLE		(1&lt;&lt;0)
 
 #define S3C2440_NFSTAT_READY		(1&lt;&lt;0)
-#define S3C2440_NFSTAT_nCE		(1&lt;&lt;1)
+#define S3C2440_NFSTAT_nCE			(1&lt;&lt;1)
 #define S3C2440_NFSTAT_RnB_CHANGE	(1&lt;&lt;2)
 #define S3C2440_NFSTAT_ILLEGAL_ACCESS	(1&lt;&lt;3)
 
@@ -114,13 +114,13 @@
 #define S3C2412_NFSTAT_RnB_CHANGE	(1&lt;&lt;4)
 #define S3C2412_NFSTAT_nFCE1		(1&lt;&lt;3)
 #define S3C2412_NFSTAT_nFCE0		(1&lt;&lt;2)
-#define S3C2412_NFSTAT_Res1		(1&lt;&lt;1)
+#define S3C2412_NFSTAT_Res1			(1&lt;&lt;1)
 #define S3C2412_NFSTAT_READY		(1&lt;&lt;0)
 
 #define S3C2412_NFECCERR_SERRDATA(x)	(((x) &gt;&gt; 21) &amp; 0xf)
-#define S3C2412_NFECCERR_SERRBIT(x)	(((x) &gt;&gt; 18) &amp; 0x7)
+#define S3C2412_NFECCERR_SERRBIT(x)		(((x) &gt;&gt; 18) &amp; 0x7)
 #define S3C2412_NFECCERR_MERRDATA(x)	(((x) &gt;&gt; 7) &amp; 0x3ff)
-#define S3C2412_NFECCERR_MERRBIT(x)	(((x) &gt;&gt; 4) &amp; 0x7)
+#define S3C2412_NFECCERR_MERRBIT(x)		(((x) &gt;&gt; 4) &amp; 0x7)
 #define S3C2412_NFECCERR_SPARE_ERR(x)	(((x) &gt;&gt; 2) &amp; 0x3)
 #define S3C2412_NFECCERR_MAIN_ERR(x)	(((x) &gt;&gt; 2) &amp; 0x3)
 #define S3C2412_NFECCERR_NONE		(0)

Modified: branches/openocd-0.1/src/flash/stellaris.h
===================================================================
--- branches/openocd_1_0_branch/src/flash/stellaris.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/stellaris.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -83,7 +83,6 @@
 #define AMASK	1
 #define PMASK	2
 
-
 /* Flash Controller Command bits */
 #define FMC_WRKEY	(0xA442&lt;&lt;16)
 #define FMC_COMT	(1&lt;&lt;3)

Modified: branches/openocd-0.1/src/flash/stm32x.h
===================================================================
--- branches/openocd_1_0_branch/src/flash/stm32x.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/stm32x.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -100,4 +100,3 @@
 } stm32x_mem_layout_t;
 
 #endif /* STM32X_H */
-

Modified: branches/openocd-0.1/src/flash/str7x.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/str7x.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/str7x.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -717,4 +717,3 @@
 	
 	return ERROR_OK;
 }
-

Modified: branches/openocd-0.1/src/flash/str7x.h
===================================================================
--- branches/openocd_1_0_branch/src/flash/str7x.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/str7x.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -109,4 +109,3 @@
 } str7x_mem_layout_t;
 
 #endif /* STR7X_H */
-

Modified: branches/openocd-0.1/src/flash/str9x.h
===================================================================
--- branches/openocd_1_0_branch/src/flash/str9x.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/str9x.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -50,7 +50,7 @@
 	STR9X_BUSY = 11
 };
 
-/*  Flash registers */
+/* Flash registers */
 
 #define FLASH_BBSR		0x54000000		/* Boot Bank Size Register                */
 #define FLASH_NBBSR		0x54000004		/* Non-Boot Bank Size Register            */
@@ -61,4 +61,3 @@
 #define FLASH_BCE5ADDR	0x54000020		/* BC Fifth Entry Target Address Register */
 
 #endif /* STR9X_H */
-

Modified: branches/openocd-0.1/src/flash/tms470.c
===================================================================
--- branches/openocd_1_0_branch/src/flash/tms470.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/flash/tms470.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -73,7 +73,7 @@
 };
 
 #define TMS470R1A256_NUM_SECTORS \
-  (sizeof(TMS470R1A256_SECTORS)/sizeof(TMS470R1A256_SECTORS[0]))
+	(sizeof(TMS470R1A256_SECTORS)/sizeof(TMS470R1A256_SECTORS[0]))
 
 const flash_sector_t TMS470R1A288_BANK0_SECTORS[] = {
 	{0x00000000, 0x00002000, -1, -1},
@@ -83,7 +83,7 @@
 };
 
 #define TMS470R1A288_BANK0_NUM_SECTORS \
-  (sizeof(TMS470R1A288_BANK0_SECTORS)/sizeof(TMS470R1A288_BANK0_SECTORS[0]))
+	(sizeof(TMS470R1A288_BANK0_SECTORS)/sizeof(TMS470R1A288_BANK0_SECTORS[0]))
 
 const flash_sector_t TMS470R1A288_BANK1_SECTORS[] = {
 	{0x00040000, 0x00010000, -1, -1},
@@ -93,43 +93,43 @@
 };
 
 #define TMS470R1A288_BANK1_NUM_SECTORS \
-  (sizeof(TMS470R1A288_BANK1_SECTORS)/sizeof(TMS470R1A288_BANK1_SECTORS[0]))
+	(sizeof(TMS470R1A288_BANK1_SECTORS)/sizeof(TMS470R1A288_BANK1_SECTORS[0]))
 
 const flash_sector_t TMS470R1A384_BANK0_SECTORS[] = {
-    {0x00000000, 0x00002000, -1, -1},
-    {0x00002000, 0x00002000, -1, -1},
-    {0x00004000, 0x00004000, -1, -1},
-    {0x00008000, 0x00004000, -1, -1},
-    {0x0000C000, 0x00004000, -1, -1},
-    {0x00010000, 0x00004000, -1, -1},
-    {0x00014000, 0x00004000, -1, -1},
-    {0x00018000, 0x00002000, -1, -1},
-    {0x0001C000, 0x00002000, -1, -1},
-    {0x0001E000, 0x00002000, -1, -1},
+	{0x00000000, 0x00002000, -1, -1},
+	{0x00002000, 0x00002000, -1, -1},
+	{0x00004000, 0x00004000, -1, -1},
+	{0x00008000, 0x00004000, -1, -1},
+	{0x0000C000, 0x00004000, -1, -1},
+	{0x00010000, 0x00004000, -1, -1},
+	{0x00014000, 0x00004000, -1, -1},
+	{0x00018000, 0x00002000, -1, -1},
+	{0x0001C000, 0x00002000, -1, -1},
+	{0x0001E000, 0x00002000, -1, -1},
 };
 
 #define TMS470R1A384_BANK0_NUM_SECTORS \
-  (sizeof(TMS470R1A384_BANK0_SECTORS)/sizeof(TMS470R1A384_BANK0_SECTORS[0]))
+	(sizeof(TMS470R1A384_BANK0_SECTORS)/sizeof(TMS470R1A384_BANK0_SECTORS[0]))
 
 const flash_sector_t TMS470R1A384_BANK1_SECTORS[] = {
-    {0x00020000, 0x00008000, -1, -1},
-    {0x00028000, 0x00008000, -1, -1},
-    {0x00030000, 0x00008000, -1, -1},
-    {0x00038000, 0x00008000, -1, -1},
+	{0x00020000, 0x00008000, -1, -1},
+	{0x00028000, 0x00008000, -1, -1},
+	{0x00030000, 0x00008000, -1, -1},
+	{0x00038000, 0x00008000, -1, -1},
 };
 
 #define TMS470R1A384_BANK1_NUM_SECTORS \
-  (sizeof(TMS470R1A384_BANK1_SECTORS)/sizeof(TMS470R1A384_BANK1_SECTORS[0]))
+	(sizeof(TMS470R1A384_BANK1_SECTORS)/sizeof(TMS470R1A384_BANK1_SECTORS[0]))
 
 const flash_sector_t TMS470R1A384_BANK2_SECTORS[] = {
-    {0x00040000, 0x00008000, -1, -1},
-    {0x00048000, 0x00008000, -1, -1},
-    {0x00050000, 0x00008000, -1, -1},
-    {0x00058000, 0x00008000, -1, -1},
+	{0x00040000, 0x00008000, -1, -1},
+	{0x00048000, 0x00008000, -1, -1},
+	{0x00050000, 0x00008000, -1, -1},
+	{0x00058000, 0x00008000, -1, -1},
 };
 
 #define TMS470R1A384_BANK2_NUM_SECTORS \
-  (sizeof(TMS470R1A384_BANK2_SECTORS)/sizeof(TMS470R1A384_BANK2_SECTORS[0]))
+	(sizeof(TMS470R1A384_BANK2_SECTORS)/sizeof(TMS470R1A384_BANK2_SECTORS[0]))
 
 /* ---------------------------------------------------------------------- */
 
@@ -229,56 +229,56 @@
 		}
 		break;
 
-    case 0x2d:
-        part_name = &quot;TMS470R1A384&quot;;
+	case 0x2d:
+		part_name = &quot;TMS470R1A384&quot;;
 
-        if ((bank-&gt;base &gt;= 0x00000000) &amp;&amp; (bank-&gt;base &lt; 0x00020000))
-        {
-            tms470_info-&gt;ordinal = 0;
-            bank-&gt;base = 0x00000000;
-            bank-&gt;size = 128 * 1024;
-            bank-&gt;num_sectors = TMS470R1A384_BANK0_NUM_SECTORS;
-            bank-&gt;sectors = malloc(sizeof(TMS470R1A384_BANK0_SECTORS));
-            if (!bank-&gt;sectors)
-            {
-                return ERROR_FLASH_OPERATION_FAILED;
-            }
-            (void)memcpy(bank-&gt;sectors, TMS470R1A384_BANK0_SECTORS, sizeof(TMS470R1A384_BANK0_SECTORS));
-        }
-        else if ((bank-&gt;base &gt;= 0x00020000) &amp;&amp; (bank-&gt;base &lt; 0x00040000))
-        {
-            tms470_info-&gt;ordinal = 1;
-            bank-&gt;base = 0x00020000;
-            bank-&gt;size = 128 * 1024;
-            bank-&gt;num_sectors = TMS470R1A384_BANK1_NUM_SECTORS;
-            bank-&gt;sectors = malloc(sizeof(TMS470R1A384_BANK1_SECTORS));
-            if (!bank-&gt;sectors)
-            {
-                return ERROR_FLASH_OPERATION_FAILED;
-            }
-            (void)memcpy(bank-&gt;sectors, TMS470R1A384_BANK1_SECTORS, sizeof(TMS470R1A384_BANK1_SECTORS));
-        }
-        else if ((bank-&gt;base &gt;= 0x00040000) &amp;&amp; (bank-&gt;base &lt; 0x00060000))
-        {
-            tms470_info-&gt;ordinal = 2;
-            bank-&gt;base = 0x00040000;
-            bank-&gt;size = 128 * 1024;
-            bank-&gt;num_sectors = TMS470R1A384_BANK2_NUM_SECTORS;
-            bank-&gt;sectors = malloc(sizeof(TMS470R1A384_BANK2_SECTORS));
-            if (!bank-&gt;sectors)
-            {
-                return ERROR_FLASH_OPERATION_FAILED;
-            }
-            (void)memcpy(bank-&gt;sectors, TMS470R1A384_BANK2_SECTORS, sizeof(TMS470R1A384_BANK2_SECTORS));
-        }
-        else
-        {
-            LOG_ERROR(&quot;No %s flash bank contains base address 0x%08x.&quot;, part_name, bank-&gt;base);
-            return ERROR_FLASH_OPERATION_FAILED;
-        }
-        break;
+		if ((bank-&gt;base &gt;= 0x00000000) &amp;&amp; (bank-&gt;base &lt; 0x00020000))
+		{
+			tms470_info-&gt;ordinal = 0;
+			bank-&gt;base = 0x00000000;
+			bank-&gt;size = 128 * 1024;
+			bank-&gt;num_sectors = TMS470R1A384_BANK0_NUM_SECTORS;
+			bank-&gt;sectors = malloc(sizeof(TMS470R1A384_BANK0_SECTORS));
+			if (!bank-&gt;sectors)
+			{
+				return ERROR_FLASH_OPERATION_FAILED;
+			}
+			(void)memcpy(bank-&gt;sectors, TMS470R1A384_BANK0_SECTORS, sizeof(TMS470R1A384_BANK0_SECTORS));
+		}
+		else if ((bank-&gt;base &gt;= 0x00020000) &amp;&amp; (bank-&gt;base &lt; 0x00040000))
+		{
+			tms470_info-&gt;ordinal = 1;
+			bank-&gt;base = 0x00020000;
+			bank-&gt;size = 128 * 1024;
+			bank-&gt;num_sectors = TMS470R1A384_BANK1_NUM_SECTORS;
+			bank-&gt;sectors = malloc(sizeof(TMS470R1A384_BANK1_SECTORS));
+			if (!bank-&gt;sectors)
+			{
+				return ERROR_FLASH_OPERATION_FAILED;
+			}
+			(void)memcpy(bank-&gt;sectors, TMS470R1A384_BANK1_SECTORS, sizeof(TMS470R1A384_BANK1_SECTORS));
+		}
+		else if ((bank-&gt;base &gt;= 0x00040000) &amp;&amp; (bank-&gt;base &lt; 0x00060000))
+		{
+			tms470_info-&gt;ordinal = 2;
+			bank-&gt;base = 0x00040000;
+			bank-&gt;size = 128 * 1024;
+			bank-&gt;num_sectors = TMS470R1A384_BANK2_NUM_SECTORS;
+			bank-&gt;sectors = malloc(sizeof(TMS470R1A384_BANK2_SECTORS));
+			if (!bank-&gt;sectors)
+			{
+				return ERROR_FLASH_OPERATION_FAILED;
+			}
+			(void)memcpy(bank-&gt;sectors, TMS470R1A384_BANK2_SECTORS, sizeof(TMS470R1A384_BANK2_SECTORS));
+		}
+		else
+		{
+			LOG_ERROR(&quot;No %s flash bank contains base address 0x%08x.&quot;, part_name, bank-&gt;base);
+			return ERROR_FLASH_OPERATION_FAILED;
+		}
+		break;
 
-    default:
+	default:
 		LOG_WARNING(&quot;Could not identify part 0x%02x as a member of the TMS470 family.&quot;, part_number);
 		return ERROR_FLASH_OPERATION_FAILED;
 	}

Modified: branches/openocd-0.1/src/helper/Makefile.am
===================================================================
--- branches/openocd_1_0_branch/src/helper/Makefile.am	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/Makefile.am	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,4 +1,4 @@
-INCLUDES = -I$(top_srcdir)/src $(all_includes) -I$(top_srcdir)/src/target
+INCLUDES = -I$(top_srcdir)/src $(all_includes) -I$(top_srcdir)/src/target -I$(top_srcdir)/src/server
 METASOURCES = AUTO
 AM_CPPFLAGS = -DPKGDATADIR=\&quot;$(pkgdatadir)\&quot; -DPKGLIBDIR=\&quot;$(pkglibdir)\&quot; @CPPFLAGS@
 noinst_LIBRARIES = libhelper.a
@@ -9,9 +9,16 @@
 CONFIGFILES = options.c jim.c jim-eventloop.c 
 endif
 
+
+
 libhelper_a_SOURCES = binarybuffer.c $(CONFIGFILES) configuration.c log.c command.c time_support.c \
 	replacements.c fileio.c startup_tcl.c
 
+if IOUTIL
+libhelper_a_SOURCES += ioutil.c
+endif
+
+
 noinst_HEADERS = binarybuffer.h configuration.h types.h log.h command.h \
 	time_support.h replacements.h fileio.h jim.h jim-eventloop.h \
 	startup.tcl bin2char.c

Modified: branches/openocd-0.1/src/helper/bin2char.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/bin2char.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/bin2char.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -30,7 +30,7 @@
 	if (argc == 1) {
 		fprintf(stderr, &quot;bin2char &lt;varname&gt;\n&quot;);
 		fprintf(stderr, &quot;read from standard input and write a char&quot;
-		    &quot; array out to standard output\n&quot;);
+			&quot; array out to standard output\n&quot;);
 		exit(1);
 	}
 

Modified: branches/openocd-0.1/src/helper/binarybuffer.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/binarybuffer.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/binarybuffer.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -210,7 +210,7 @@
 	else if (radix == 10)
 	{
 		factor = 2.40824;   /* log(256) / log(10) = 2.40824 */
-    }
+	}
 	else if (radix == 8)
 	{
 		factor = 2.66667;	/* log(256) / log(8) = 2.66667 */
@@ -222,20 +222,20 @@
 	str = calloc(str_len + 1, 1);
 	
 	for (i = b256_len - 1; i &gt;= 0; i--)
-    {
-        tmp = buf[i];
-    	if ((i == (buf_len / 8)) &amp;&amp; (buf_len % 8))
-    		tmp &amp;= (0xff &gt;&gt; (8 - (buf_len % 8)));
+	{
+		tmp = buf[i];
+		if ((i == (buf_len / 8)) &amp;&amp; (buf_len % 8))
+			tmp &amp;= (0xff &gt;&gt; (8 - (buf_len % 8)));
 
-        for (j = str_len; j &gt; 0; j--)
-        {
-            tmp += (u32)str[j-1] * 256;
-            str[j-1] = (u8)(tmp % radix);
-            tmp /= radix;
-        }
-    }
-    
-    for (j = 0; j &lt; str_len; j++)
+		for (j = str_len; j &gt; 0; j--)
+		{
+			tmp += (u32)str[j-1] * 256;
+			str[j-1] = (u8)(tmp % radix);
+			tmp /= radix;
+		}
+	}
+
+	for (j = 0; j &lt; str_len; j++)
 		str[j] = DIGITS[(int)str[j]];
 	
 	return str;
@@ -295,23 +295,23 @@
 	for (i = 0; charbuf[i]; i++)
 	{ 
 		tmp = charbuf[i];
-        if ((tmp &gt;= '0') &amp;&amp; (tmp &lt;= '9'))
-        	tmp = (tmp - '0');
-        else if ((tmp &gt;= 'a') &amp;&amp; (tmp &lt;= 'f'))
-        	tmp = (tmp - 'a' + 10);
-        else if ((tmp &gt;= 'A') &amp;&amp; (tmp &lt;= 'F'))
-        	tmp = (tmp - 'A' + 10);
-        else continue;	/* skip characters other than [0-9,a-f,A-F] */
+		if ((tmp &gt;= '0') &amp;&amp; (tmp &lt;= '9'))
+			tmp = (tmp - '0');
+		else if ((tmp &gt;= 'a') &amp;&amp; (tmp &lt;= 'f'))
+			tmp = (tmp - 'a' + 10);
+		else if ((tmp &gt;= 'A') &amp;&amp; (tmp &lt;= 'F'))
+			tmp = (tmp - 'A' + 10);
+		else continue;	/* skip characters other than [0-9,a-f,A-F] */
 		
 		if (tmp &gt;= radix)
 			continue;	/* skip digits invalid for the current radix */ 
 		
 		for (j = 0; j &lt; b256_len; j++)
-        {
-            tmp += (u32)b256_buf[j] * radix;
-            b256_buf[j] = (u8)(tmp &amp; 0xFF);
-            tmp &gt;&gt;= 8;
-        }
+		{
+			tmp += (u32)b256_buf[j] * radix;
+			b256_buf[j] = (u8)(tmp &amp; 0xFF);
+			tmp &gt;&gt;= 8;
+		}
 		
 	}
 	

Modified: branches/openocd-0.1/src/helper/command.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/command.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/command.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -229,9 +229,9 @@
 	free((void *)override_name);
 
 	/* accumulate help text in Tcl helptext list.  */
-    Jim_Obj *helptext=Jim_GetGlobalVariableStr(interp, &quot;ocd_helptext&quot;, JIM_ERRMSG);
-    if (Jim_IsShared(helptext))
-        helptext = Jim_DuplicateObj(interp, helptext);
+	Jim_Obj *helptext=Jim_GetGlobalVariableStr(interp, &quot;ocd_helptext&quot;, JIM_ERRMSG);
+	if (Jim_IsShared(helptext))
+		helptext = Jim_DuplicateObj(interp, helptext);
 	Jim_Obj *cmd_entry=Jim_NewListObj(interp, NULL, 0);
 
 	Jim_Obj *cmd_list=Jim_NewListObj(interp, NULL, 0);
@@ -290,9 +290,9 @@
 
 	/* find command */
 	c = context-&gt;commands;
-	
+
 	while(NULL != c)
-	{		
+	{
 		if (strcmp(name, c-&gt;name) == 0)
 		{
 			/* unlink command */
@@ -305,7 +305,7 @@
 				/* first element in command list */
 				context-&gt;commands = c-&gt;next;
 			}
-			
+
 			/* unregister children */
 			while(NULL != c-&gt;children)
 			{
@@ -316,7 +316,7 @@
 				free(c2);
 				c2 = NULL;
 			}
-			
+
 			/* delete command */
 			free(c-&gt;name);
 			c-&gt;name = NULL;
@@ -324,7 +324,7 @@
 			c = NULL;
 			return ERROR_OK;
 		}
-		
+
 		/* remember the last command for unlinking */
 		p = c;
 		c = c-&gt;next;
@@ -356,8 +356,8 @@
 		 * The latter bit isn't precisely neat, but will do for now.
 		 */
 		LOG_USER_N(&quot;%s&quot;, string);
-		// We already printed it above
-		//command_output_text(context, string);
+		/* We already printed it above */
+		/* command_output_text(context, string); */
 		free(string);
 	}
 
@@ -381,8 +381,8 @@
 		 * The latter bit isn't precisely neat, but will do for now.
 		 */
 		LOG_USER_N(&quot;%s&quot;, string);
-		// We already printed it above
-		//command_output_text(context, string);
+		/* We already printed it above */
+		/* command_output_text(context, string); */
 		free(string);
 	}
 
@@ -479,21 +479,20 @@
 		int reslen;
 
 		result = Jim_GetString(Jim_GetResult(interp), &amp;reslen);
-		if (reslen) {
-			int i;
-			char buff[256+1];
-			for (i = 0; i &lt; reslen; i += 256)
-			{
-				int chunk;
-				chunk = reslen - i;
-				if (chunk &gt; 256)
-					chunk = 256;
-				strncpy(buff, result+i, chunk);
-				buff[chunk] = 0;
-				LOG_USER_N(&quot;%s&quot;, buff);
-			}
-			LOG_USER_N(&quot;%s&quot;, &quot;\n&quot;);
+		int i;
+		char buff[256+1];
+		for (i = 0; i &lt; reslen; i += 256)
+		{
+			int chunk;
+			chunk = reslen - i;
+			if (chunk &gt; 256)
+				chunk = 256;
+			strncpy(buff, result+i, chunk);
+			buff[chunk] = 0;
+			LOG_USER_N(&quot;%s&quot;, buff);
 		}
+		LOG_USER_N(&quot;%s&quot;, &quot;\n&quot;);
+		retval=ERROR_OK;
 	}
 	return retval;
 }
@@ -644,7 +643,6 @@
 	return NULL;
 }
 
-
 static int jim_capture(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 {
 	if (argc != 2)
@@ -801,7 +799,7 @@
 	Jim_CreateCommand(interp, name, cmd, NULL, NULL);
 
 	/* FIX!!! it would be prettier to invoke add_help_text...
-	   accumulate help text in Tcl helptext list.  */
+	 * accumulate help text in Tcl helptext list.  */
 	Jim_Obj *helptext=Jim_GetGlobalVariableStr(interp, &quot;ocd_helptext&quot;, JIM_ERRMSG);
 	if (Jim_IsShared(helptext))
 		helptext = Jim_DuplicateObj(interp, helptext);
@@ -816,7 +814,6 @@
 	Jim_ListAppendElement(interp, helptext, cmd_entry);
 }
 
-
 /* return global variable long value or 0 upon failure */
 long jim_global_long(const char *variable)
 {

Modified: branches/openocd-0.1/src/helper/configuration.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/configuration.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/configuration.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -91,7 +91,6 @@
 	return NULL;
 }
 
-
 FILE *open_file_from_path (char *file, char *mode)
 {
 	if (mode[0]!='r')

Modified: branches/openocd-0.1/src/helper/fileio.h
===================================================================
--- branches/openocd_1_0_branch/src/helper/fileio.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/fileio.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -44,7 +44,6 @@
 	FILEIO_BINARY,
 };
 
-
 enum fileio_access
 {
 	FILEIO_READ,		/* open for reading, position at beginning */
@@ -71,7 +70,7 @@
 extern int fileio_open(fileio_t *fileio, char *url, enum fileio_access access, enum fileio_type type);
 extern int fileio_read_u32(fileio_t *fileio, u32 *data);
 extern int fileio_write_u32(fileio_t *fileio, u32 data);
-	
+
 #define ERROR_FILEIO_LOCATION_UNKNOWN	(-1200)
 #define ERROR_FILEIO_NOT_FOUND			(-1201)
 #define ERROR_FILEIO_OPERATION_FAILED		(-1202)

Copied: branches/openocd-0.1/src/helper/ioutil.c (from rev 1324, trunk/src/helper/ioutil.c)

Modified: branches/openocd-0.1/src/helper/jim.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/jim.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/jim.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -7,6 +7,7 @@
  * Copyright 2008 Andrew Lunn &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">andrew at lunn.ch</A>&gt;
  * Copyright 2008 Duane Ellis &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">openocd at duaneellis.com</A>&gt;
  * Copyright 2008 Uwe Klein &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">uklein at klein-messgeraete.de</A>&gt;
+ * Copyright 2008 Steve Bennett &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">steveb at workware.net.au</A>&gt;
  * 
  * The FreeBSD license
  * 
@@ -48,6 +49,7 @@
 #define JIM_DYNLIB      /* Dynamic library support for UNIX and WIN32 */
 #endif /* JIM_ANSIC */
 
+#define _GNU_SOURCE	/* for vasprintf() */
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
@@ -85,6 +87,10 @@
 #endif /* WIN32 */
 #endif /* JIM_DYNLIB */
 
+#ifndef WIN32
+#include &lt;unistd.h&gt;
+#endif
+
 #ifdef __ECOS
 #include &lt;cyg/jimtcl/jim.h&gt;
 #else
@@ -1325,19 +1331,21 @@
     if (brace) {
         while (!stop) {
             if (*pc-&gt;p == '}' || pc-&gt;len == 0) {
+                pc-&gt;tend = pc-&gt;p-1;
                 stop = 1;
                 if (pc-&gt;len == 0)
-                    continue;
+                    break;
             }
             else if (*pc-&gt;p == '\n')
                 pc-&gt;linenr++;
             pc-&gt;p++; pc-&gt;len--;
         }
-        if (pc-&gt;len == 0)
-            pc-&gt;tend = pc-&gt;p-1;
-        else
-            pc-&gt;tend = pc-&gt;p-2;
     } else {
+        /* Include leading colons */
+        while (*pc-&gt;p == ':') {
+            pc-&gt;p++;
+            pc-&gt;len--;
+        }
         while (!stop) {
             if (!((*pc-&gt;p &gt;= 'a' &amp;&amp; *pc-&gt;p &lt;= 'z') ||
                 (*pc-&gt;p &gt;= 'A' &amp;&amp; *pc-&gt;p &lt;= 'Z') ||
@@ -2197,9 +2205,14 @@
 
 static Jim_Obj *JimStringToLower(Jim_Interp *interp, Jim_Obj *strObjPtr)
 {
-    char *buf = Jim_Alloc(strObjPtr-&gt;length+1);
+    char *buf;
     int i;
+    if (strObjPtr-&gt;typePtr != &amp;stringObjType) {
+        SetStringFromAny(interp, strObjPtr);
+    }
 
+    buf = Jim_Alloc(strObjPtr-&gt;length+1);
+
     memcpy(buf, strObjPtr-&gt;bytes, strObjPtr-&gt;length+1);
     for (i = 0; i &lt; strObjPtr-&gt;length; i++)
         buf[i] = tolower(buf[i]);
@@ -2208,9 +2221,14 @@
 
 static Jim_Obj *JimStringToUpper(Jim_Interp *interp, Jim_Obj *strObjPtr)
 {
-    char *buf = Jim_Alloc(strObjPtr-&gt;length+1);
+    char *buf;
     int i;
+    if (strObjPtr-&gt;typePtr != &amp;stringObjType) {
+        SetStringFromAny(interp, strObjPtr);
+    }
 
+    buf = Jim_Alloc(strObjPtr-&gt;length+1);
+
     memcpy(buf, strObjPtr-&gt;bytes, strObjPtr-&gt;length+1);
     for (i = 0; i &lt; strObjPtr-&gt;length; i++)
         buf[i] = toupper(buf[i]);
@@ -2289,32 +2307,32 @@
 			/* non-terminals */
 		case '0': /* zero pad */
 			zpad = 1;
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			goto next_fmt;
 			break;
 		case '+':
 			forceplus = 1;
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			goto next_fmt;
 			break;
 		case ' ': /* sign space */
 			spad = 1;
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			goto next_fmt;
 			break;
 		case '-':
 			ljust = 1;
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			goto next_fmt;
 			break;
 		case '#':
 			altfm = 1;
-			*fmt++; fmtLen--;
+			fmt++; fmtLen--;
  			goto next_fmt;
-
+			
 		case '.':
 			inprec = 1;
-			*fmt++; fmtLen--;
+			fmt++; fmtLen--;
  			goto next_fmt;
 			break;
 		case '1':
@@ -2340,7 +2358,7 @@
 			goto next_fmt;
 		case '*':
 			/* suck up the next item as an integer */
-			*fmt++;  fmtLen--;
+			fmt++;  fmtLen--;
 			objc--;
 			if( objc &lt;= 0 ){
 				goto not_enough_args;
@@ -2358,12 +2376,12 @@
 					prec = 0;
 				}
 			} else {
-				width = wideValue;
-				if( width &lt; 0 ){
-					ljust = 1;
-					width = -width;
-				}
+			width = wideValue;
+			if( width &lt; 0 ){
+				ljust = 1;
+				width = -width;
 			}
+			}
 			objv++;
 			goto next_fmt;
 			break;
@@ -2455,6 +2473,7 @@
 			break;
         case 'b':
         case 'd':
+        case 'o':
 		case 'i':
 		case 'u':
 		case 'x':
@@ -3009,7 +3028,7 @@
         initialLineNumber = objPtr-&gt;internalRep.sourceValue.lineNumber;
         propagateSourceInfo = 1;
     } else {
-        script-&gt;fileName = Jim_StrDup(&quot;?&quot;);
+        script-&gt;fileName = Jim_StrDup(&quot;&quot;);
         initialLineNumber = 1;
     }
 
@@ -3161,9 +3180,6 @@
     he = Jim_FindHashEntry(&amp;interp-&gt;commands, cmdName);
     if (he == NULL) { /* New command to create */
         cmdPtr = Jim_Alloc(sizeof(*cmdPtr));
-        cmdPtr-&gt;cmdProc = cmdProc;
-        cmdPtr-&gt;privData = privData;
-        cmdPtr-&gt;delProc = delProc;
         Jim_AddHashEntry(&amp;interp-&gt;commands, cmdName, cmdPtr);
     } else {
         Jim_InterpIncrProcEpoch(interp);
@@ -3181,9 +3197,13 @@
             /* If it was a C coded command, call the delProc if any */
             cmdPtr-&gt;delProc(interp, cmdPtr-&gt;privData);
         }
-        cmdPtr-&gt;cmdProc = cmdProc;
-        cmdPtr-&gt;privData = privData;
     }
+
+    /* Store the new details for this proc */
+    cmdPtr-&gt;delProc = delProc;
+    cmdPtr-&gt;cmdProc = cmdProc;
+    cmdPtr-&gt;privData = privData;
+
     /* There is no need to increment the 'proc epoch' because
      * creation of a new procedure can never affect existing
      * cached commands. We don't do negative caching. */
@@ -3463,15 +3483,23 @@
     /* Make sure it's not syntax glue to get/set dict. */
     if (Jim_NameIsDictSugar(varName, len))
             return JIM_DICT_SUGAR;
-    /* Lookup this name into the variables hash table */
-    he = Jim_FindHashEntry(&amp;interp-&gt;framePtr-&gt;vars, varName);
-    if (he == NULL) {
-        /* Try with static vars. */
-        if (interp-&gt;framePtr-&gt;staticVars == NULL)
+    if (varName[0] == ':' &amp;&amp; varName[1] == ':') {
+        he = Jim_FindHashEntry(&amp;interp-&gt;topFramePtr-&gt;vars, varName + 2);
+        if (he == NULL) {
             return JIM_ERR;
-        if (!(he = Jim_FindHashEntry(interp-&gt;framePtr-&gt;staticVars, varName)))
-            return JIM_ERR;
+        }
     }
+    else {
+        /* Lookup this name into the variables hash table */
+        he = Jim_FindHashEntry(&amp;interp-&gt;framePtr-&gt;vars, varName);
+        if (he == NULL) {
+            /* Try with static vars. */
+            if (interp-&gt;framePtr-&gt;staticVars == NULL)
+                return JIM_ERR;
+            if (!(he = Jim_FindHashEntry(interp-&gt;framePtr-&gt;staticVars, varName)))
+                return JIM_ERR;
+        }
+    }
     /* Free the old internal repr and set the new one. */
     Jim_FreeIntRep(interp, objPtr);
     objPtr-&gt;typePtr = &variableObjType;
@@ -3509,7 +3537,13 @@
         Jim_IncrRefCount(valObjPtr);
         var-&gt;linkFramePtr = NULL;
         /* Insert the new variable */
-        Jim_AddHashEntry(&amp;interp-&gt;framePtr-&gt;vars, name, var);
+        if (name[0] == ':' &amp;&amp; name[1] == ':') {
+            /* Into to the top evel frame */
+            Jim_AddHashEntry(&amp;interp-&gt;topFramePtr-&gt;vars, name + 2, var);
+        }
+        else {
+            Jim_AddHashEntry(&amp;interp-&gt;framePtr-&gt;vars, name, var);
+        }
         /* Make the object int rep a variable */
         Jim_FreeIntRep(interp, nameObjPtr);
         nameObjPtr-&gt;typePtr = &variableObjType;
@@ -4410,6 +4444,7 @@
     i-&gt;result = i-&gt;emptyObj;
     i-&gt;stackTrace = Jim_NewListObj(i, NULL, 0);
     i-&gt;unknown = Jim_NewStringObj(i, &quot;unknown&quot;, -1);
+    i-&gt;unknown_called = 0;
     Jim_IncrRefCount(i-&gt;emptyObj);
     Jim_IncrRefCount(i-&gt;result);
     Jim_IncrRefCount(i-&gt;stackTrace);
@@ -4624,6 +4659,11 @@
 static void JimAppendStackTrace(Jim_Interp *interp, const char *procname,
         const char *filename, int linenr)
 {
+    /* No need to add this dummy entry to the stack trace */
+    if (strcmp(procname, &quot;unknown&quot;) == 0) {
+        return;
+    }
+
     if (Jim_IsShared(interp-&gt;stackTrace)) {
         interp-&gt;stackTrace =
             Jim_DuplicateObj(interp, interp-&gt;stackTrace);
@@ -6592,7 +6632,7 @@
             case JIM_EXPROP_STRING:
                 break;
             default:
-                op = JimExprOperatorInfoByOpcode(expr-&gt;opcode[i]);
+                op = JimExprOperatorInfoByOpcode(expr-&gt;opcode[leftindex]);
                 if (op == NULL) {
                     Jim_Panic(interp,&quot;Default reached in ExprMakeLazy()&quot;);
                 }
@@ -6982,6 +7022,16 @@
             /* --- Double --- */
             if (Jim_GetDouble(interp, A, &amp;dA) != JIM_OK ||
                 Jim_GetDouble(interp, B, &amp;dB) != JIM_OK) {
+
+                /* Hmmm! For compatibility, maybe convert != and == into ne and eq */
+                if (expr-&gt;opcode[i] == JIM_EXPROP_NUMNE) {
+                    opcode = JIM_EXPROP_STRNE;
+                    goto retry_as_string;
+                }
+                else if (expr-&gt;opcode[i] == JIM_EXPROP_NUMEQ) {
+                    opcode = JIM_EXPROP_STREQ;
+                    goto retry_as_string;
+                }
                 Jim_DecrRefCount(interp, A);
                 Jim_DecrRefCount(interp, B);
                 error = 1;
@@ -7043,9 +7093,10 @@
         } else if (opcode == JIM_EXPROP_STREQ || opcode == JIM_EXPROP_STRNE) {
             B = stack[--stacklen];
             A = stack[--stacklen];
+retry_as_string:
             sA = Jim_GetString(A, &amp;Alen);
             sB = Jim_GetString(B, &amp;Blen);
-            switch(expr-&gt;opcode[i]) {
+            switch(opcode) {
             case JIM_EXPROP_STREQ:
                 if (Alen == Blen &amp;&amp; memcmp(sA, sB, Alen) ==0)
                     wC = 1;
@@ -7877,21 +7928,21 @@
             if (Jim_ListIndex(interp, libPathObjPtr, i,
                     &amp;prefixObjPtr, JIM_NONE) != JIM_OK)
                 continue;
-            prefix = Jim_GetString(prefixObjPtr, NULL);
-            prefixlen = strlen(prefix);
+            prefix = Jim_GetString(prefixObjPtr, &amp;prefixlen);
             if (prefixlen+strlen(pathName)+1 &gt;= JIM_PATH_LEN)
                 continue;
-            if (prefixlen &amp;&amp; prefix[prefixlen-1] == '/')
+            if (*pathName == '/') {
+                strcpy(buf, pathName);
+            }    
+            else if (prefixlen &amp;&amp; prefix[prefixlen-1] == '/')
                 sprintf(buf, &quot;%s%s&quot;, prefix, pathName);
             else
                 sprintf(buf, &quot;%s/%s&quot;, prefix, pathName);
-            printf(&quot;opening '%s'\n&quot;, buf);
             fp = fopen(buf, &quot;r&quot;);
             if (fp == NULL)
                 continue;
             fclose(fp);
             handle = dlopen(buf, RTLD_LAZY);
-            printf(&quot;got handle %p\n&quot;, handle);
         }
         if (handle == NULL) {
             Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
@@ -8235,6 +8286,9 @@
     Jim_HashEntry *he;
     int requiredVer;
 
+    /* Start with an empty error string */
+    Jim_SetResultString(interp, &quot;&quot;, 0);
+
     if (JimPackageVersionToInt(interp, ver, &amp;requiredVer, JIM_ERRMSG) != JIM_OK)
         return NULL;
     he = Jim_FindHashEntry(&amp;interp-&gt;packages, name);
@@ -8249,8 +8303,9 @@
         }
         /* No way... return an error. */
         if (flags &amp; JIM_ERRMSG) {
-            Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
-            Jim_AppendStrings(interp, Jim_GetResult(interp),
+            int len;
+            Jim_GetString(Jim_GetResult(interp), &amp;len);
+            Jim_AppendStrings(interp, Jim_GetResult(interp), len ? &quot;\n&quot; : &quot;&quot;,
                     &quot;Can't find package '&quot;, name, &quot;'&quot;, NULL);
         }
         return NULL;
@@ -8263,7 +8318,6 @@
         }
         /* Check if version matches. */
         if (JimPackageMatchVersion(requiredVer, actualVer, flags) == 0) {
-            Jim_SetResult(interp, Jim_NewEmptyStringObj(interp));
             Jim_AppendStrings(interp, Jim_GetResult(interp),
                     &quot;Package '&quot;, name, &quot;' already loaded, but with version &quot;,
                     he-&gt;val, NULL);
@@ -8288,6 +8342,13 @@
     Jim_Obj **v, *sv[JIM_EVAL_SARGV_LEN];
     int retCode;
 
+    /* If JimUnknown() is recursively called (e.g. error in the unknown proc,
+     * done here
+     */
+    if (interp-&gt;unknown_called) {
+        return JIM_ERR;
+    }
+
     /* If the [unknown] command does not exists returns
      * just now */
     if (Jim_GetCommand(interp, interp-&gt;unknown, JIM_NONE) == NULL)
@@ -8308,7 +8369,10 @@
     memcpy(v+1, argv, sizeof(Jim_Obj*)*argc);
     v[0] = interp-&gt;unknown;
     /* Call it */
+    interp-&gt;unknown_called++;
     retCode = Jim_EvalObjVector(interp, argc+1, v);
+    interp-&gt;unknown_called--;
+
     /* Clean up */
     if (v != sv)
         Jim_Free(v);
@@ -8342,12 +8406,16 @@
         if (cmdPtr-&gt;cmdProc) {
             interp-&gt;cmdPrivData = cmdPtr-&gt;privData;
             retcode = cmdPtr-&gt;cmdProc(interp, objc, objv);
+            if (retcode == JIM_ERR_ADDSTACK) {
+                //JimAppendStackTrace(interp, &quot;&quot;, script-&gt;fileName, token[i-argc*2].linenr);
+                retcode = JIM_ERR;
+            }
         } else {
             retcode = JimCallProcedure(interp, cmdPtr, objc, objv);
-    if (retcode == JIM_ERR) {
-        JimAppendStackTrace(interp,
-            Jim_GetString(objv[0], NULL), &quot;?&quot;, 1);
-    }
+            if (retcode == JIM_ERR) {
+                JimAppendStackTrace(interp,
+                    Jim_GetString(objv[0], NULL), &quot;&quot;, 1);
+            }
         }
     }
     /* Decr refcount of arguments and return the retcode */
@@ -8628,6 +8696,10 @@
             if (cmd-&gt;cmdProc) {
                 interp-&gt;cmdPrivData = cmd-&gt;privData;
                 retcode = cmd-&gt;cmdProc(interp, argc, argv);
+                if ((retcode == JIM_ERR)||(retcode == JIM_ERR_ADDSTACK)) {
+                    JimAppendStackTrace(interp, &quot;&quot;, script-&gt;fileName, token[i-argc*2].linenr);
+                    retcode = JIM_ERR;
+                }
             } else {
                 retcode = JimCallProcedure(interp, cmd, argc, argv);
                 if (retcode == JIM_ERR) {
@@ -8641,7 +8713,7 @@
             retcode = JimUnknown(interp, argc, argv);
             if (retcode == JIM_ERR) {
                 JimAppendStackTrace(interp,
-                    Jim_GetString(argv[0], NULL), script-&gt;fileName,
+                    &quot;&quot;, script-&gt;fileName,
                     token[i-argc*2].linenr);
             }
         }
@@ -8697,6 +8769,7 @@
 {
     int i, retcode;
     Jim_CallFrame *callFramePtr;
+    int num_args;
 
     /* Check arity */
     if (argc &lt; cmd-&gt;arityMin || (cmd-&gt;arityMax != -1 &amp;&amp;
@@ -8727,19 +8800,47 @@
     Jim_IncrRefCount(cmd-&gt;bodyObjPtr);
     interp-&gt;framePtr = callFramePtr;
     interp-&gt;numLevels ++;
+
     /* Set arguments */
-    for (i = 0; i &lt; cmd-&gt;arityMin-1; i++) {
-        Jim_Obj *objPtr;
+    Jim_ListLength(interp, cmd-&gt;argListObjPtr, &amp;num_args);
 
-        Jim_ListIndex(interp, cmd-&gt;argListObjPtr, i, &amp;objPtr, JIM_NONE);
-        Jim_SetVariable(interp, objPtr, argv[i+1]);
+    /* If last argument is 'args', don't set it here */
+    if (cmd-&gt;arityMax == -1) {
+        num_args--;
     }
+
+    for (i = 0; i &lt; num_args; i++) {
+        Jim_Obj *argObjPtr;
+        Jim_Obj *nameObjPtr;
+        Jim_Obj *valueObjPtr;
+
+        Jim_ListIndex(interp, cmd-&gt;argListObjPtr, i, &amp;argObjPtr, JIM_NONE);
+        if (i + 1 &gt;= cmd-&gt;arityMin) {
+            /* The name is the first element of the list */
+            Jim_ListIndex(interp, argObjPtr, 0, &amp;nameObjPtr, JIM_NONE);
+        }
+        else {
+            /* The element arg is the name */
+            nameObjPtr = argObjPtr;
+        }
+
+        if (i + 1 &gt;= argc) {
+            /* No more values, so use default */
+            /* The value is the second element of the list */
+            Jim_ListIndex(interp, argObjPtr, 1, &amp;valueObjPtr, JIM_NONE);
+        }
+        else {
+            valueObjPtr = argv[i+1];
+        }
+        Jim_SetVariable(interp, nameObjPtr, valueObjPtr);
+    }
+    /* Set optional arguments */
     if (cmd-&gt;arityMax == -1) {
         Jim_Obj *listObjPtr, *objPtr;
 
-        listObjPtr = Jim_NewListObj(interp, argv+cmd-&gt;arityMin,
-                argc-cmd-&gt;arityMin);
-        Jim_ListIndex(interp, cmd-&gt;argListObjPtr, i, &amp;objPtr, JIM_NONE);
+        i++;
+        listObjPtr = Jim_NewListObj(interp, argv+i, argc-i);
+        Jim_ListIndex(interp, cmd-&gt;argListObjPtr, num_args, &amp;objPtr, JIM_NONE);
         Jim_SetVariable(interp, objPtr, listObjPtr);
     }
     /* Eval the body */
@@ -10895,17 +10996,31 @@
     }
     Jim_ListLength(interp, argv[2], &amp;argListLen);
     arityMin = arityMax = argListLen+1;
+
     if (argListLen) {
         const char *str;
         int len;
-        Jim_Obj *lastArgPtr;
+        Jim_Obj *argPtr;
         
-        Jim_ListIndex(interp, argv[2], argListLen-1, &amp;lastArgPtr, JIM_NONE);
-        str = Jim_GetString(lastArgPtr, &amp;len);
+        /* Check for 'args' and adjust arityMin and arityMax if necessary */
+        Jim_ListIndex(interp, argv[2], argListLen-1, &amp;argPtr, JIM_NONE);
+        str = Jim_GetString(argPtr, &amp;len);
         if (len == 4 &amp;&amp; memcmp(str, &quot;args&quot;, 4) == 0) {
             arityMin--;
             arityMax = -1;
         }
+
+        /* Check for default arguments and reduce arityMin if necessary */
+        while (arityMin &gt; 1) {
+            int len;
+            Jim_ListIndex(interp, argv[2], arityMin - 2, &amp;argPtr, JIM_NONE);
+            Jim_ListLength(interp, argPtr, &amp;len);
+            if (len != 2) {
+                /* No default argument */
+                break;
+            }
+            arityMin--;
+        }
     }
     if (argc == 4) {
         return Jim_CreateProcedure(interp, Jim_GetString(argv[1], NULL),
@@ -11537,10 +11652,10 @@
     int cmd, result = JIM_OK;
     static const char *commands[] = {
         &quot;body&quot;, &quot;commands&quot;, &quot;exists&quot;, &quot;globals&quot;, &quot;level&quot;, &quot;locals&quot;,
-        &quot;vars&quot;, &quot;version&quot;, &quot;complete&quot;, &quot;args&quot;, NULL
+        &quot;vars&quot;, &quot;version&quot;, &quot;complete&quot;, &quot;args&quot;, &quot;hostname&quot;, NULL
     };
     enum {INFO_BODY, INFO_COMMANDS, INFO_EXISTS, INFO_GLOBALS, INFO_LEVEL,
-          INFO_LOCALS, INFO_VARS, INFO_VERSION, INFO_COMPLETE, INFO_ARGS};
+          INFO_LOCALS, INFO_VARS, INFO_VERSION, INFO_COMPLETE, INFO_ARGS, INFO_HOSTNAME};
     
     if (argc &lt; 2) {
         Jim_WrongNumArgs(interp, 1, argv, &quot;command ?args ...?&quot;);
@@ -11636,6 +11751,10 @@
         s = Jim_GetString(argv[2], &amp;len);
         Jim_SetResult(interp,
                 Jim_NewIntObj(interp, Jim_ScriptIsComplete(s, len, NULL)));
+    } else if (cmd == INFO_HOSTNAME) {
+        /* Redirect to os.hostname if it exists */
+        Jim_Obj *command = Jim_NewStringObj(interp, &quot;os.gethostname&quot;, -1);
+        result = Jim_EvalObjVector(interp, 1, &amp;command);
     }
     return result;
 }
@@ -11854,6 +11973,24 @@
     const char *key;
     char *val;
 
+    if (argc == 1) {
+        extern char **environ;
+
+        int i;
+        Jim_Obj *listObjPtr = Jim_NewListObj(interp, NULL, 0);
+
+        for (i = 0; environ[i]; i++) {
+            const char *equals = strchr(environ[i], '=');
+            if (equals) {
+                Jim_ListAppendElement(interp, listObjPtr, Jim_NewStringObj(interp, environ[i], equals - environ[i]));
+                Jim_ListAppendElement(interp, listObjPtr, Jim_NewStringObj(interp, equals + 1, -1));
+            }
+        }
+
+        Jim_SetResult(interp, listObjPtr);
+        return JIM_OK;
+    }
+
     if (argc != 2) {
         Jim_WrongNumArgs(interp, 1, argv, &quot;varName&quot;);
         return JIM_ERR;
@@ -11882,6 +12019,9 @@
         return JIM_ERR;
     }
     retval = Jim_EvalFile(interp, Jim_GetString(argv[1], NULL));
+    if (retval == JIM_ERR) {
+        return JIM_ERR_ADDSTACK;
+    }
     if (retval == JIM_RETURN)
         return JIM_OK;
     return retval;
@@ -12031,7 +12171,7 @@
                 argc == 4 ? Jim_GetString(argv[3], NULL) : &quot;&quot;,
                 JIM_ERRMSG);
         if (ver == NULL)
-            return JIM_ERR;
+            return JIM_ERR_ADDSTACK;
         Jim_SetResultString(interp, ver, -1);
     } else if (option == OPT_PROVIDE) {
         if (argc != 4) {
@@ -12044,108 +12184,6 @@
     return JIM_OK;
 }
 
-
-static void
-jim_get_s_us( jim_wide *s, jim_wide *us )
-{
-#if defined(WIN32)
-	/* 
-	 * Sorry - I do not have, or use Win32.
-	 * This concept is from 
-	 * 
-	 * Method is from: 
-	 *    <A HREF="http://www.openasthra.com/c-tidbits/gettimeofday-function-for-windows/">http://www.openasthra.com/c-tidbits/gettimeofday-function-for-windows/</A>
-	 *
-	 * I have no method to test/verify.
-	 *  - Duane 6-sep-2008.
-	 * (once verified, please somebody remove this comment)
-	 */
-#if defined(_MSC_VER) || defined(_MSC_EXTENSIONS)
-  #define DELTA_EPOCH_IN_MICROSECS  11644473600000000Ui64
-#else
-  #define DELTA_EPOCH_IN_MICROSECS  11644473600000000ULL
-#endif
-
-	FILETIME ft;
-	unsigned __int64 tmpres;
-	tmpres = 0;
-	GetSystemTimeAsFileTime( &amp;ft );
-
-	tmpres |= ft.dwHighDateTime;
-	tmpres &lt;&lt;= 32;
-	tmpres |= ft.dwLowDateTime;
-	/* convert to unix representation */
-	tmpres /= 10;
-	tmpres -= DELTA_EPOCH_IN_MICROSECS;
-	
-	*s  = (tmpres / 1000000ULL);
-	*us = (tmpres % 1000000ULL);
-	
-#undef DELTA_EPOCH_IN_MICROSECS
-
-#else
-	/* LINUX/CYGWIN */
-	struct timeval tv;
-	struct timezone tz;
-	gettimeofday( &amp;tv, &amp;tz );
-	*s  = tv.tv_sec;
-	*us = tv.tv_usec;
-#endif
-}
-
-
-/* [clock] */
-static int Jim_ClockCoreCommand( Jim_Interp *interp, int argc,
-								   Jim_Obj *const *argv)
-{
-	/*
-	 *  See: TCL man page for 'clock'
-	 *  we do not impliment all features.
-	 */
-	jim_wide r,s,us;
-	int option;
-	const char *options[] = {
-		&quot;clicks&quot;,
-		&quot;microseconds&quot;,
-		&quot;milliseconds&quot;,
-		&quot;seconds&quot;,
-		NULL 
-	};
-	enum { OPT_CLICKS, OPT_USEC, OPT_MSEC, OPT_SEC };
-
-	if( argc &lt; 2 ){
-		Jim_WrongNumArgs( interp, 1, argv, &quot;option ?arguments ...?&quot;);
-		return JIM_ERR;
-	}
-
-	if( Jim_GetEnum(interp, argv[1], options, &amp;option, &quot;option&quot;,
-					JIM_ERRMSG) != JIM_OK ){
-		return JIM_ERR;
-	}
-
-	// platform independent get time.
-	jim_get_s_us( &amp;s, &amp;us );
-
-	r = 0;
-	switch(option){
-	case OPT_CLICKS:
-	case OPT_USEC:
-		/* clicks &amp; usecs are the same */
-		r = (s * 1000000) + us;
-		break;
-	case OPT_MSEC:
-		r = (s * 1000) + (us / 1000);
-		break;
-	case OPT_SEC:
-		r = s;
-		break;
-	}
-		
-	Jim_SetResult( interp, Jim_NewWideObj( interp, r ) );
-	return JIM_OK;
-}
-	 
-
 static struct {
     const char *name;
     Jim_CmdProc cmdProc;
@@ -12210,7 +12248,6 @@
     {&quot;rand&quot;, Jim_RandCoreCommand},
     {&quot;package&quot;, Jim_PackageCoreCommand},
     {&quot;tailcall&quot;, Jim_TailcallCoreCommand},
-	{&quot;clock&quot;, Jim_ClockCoreCommand},
     {NULL, NULL},
 };
 
@@ -12250,9 +12287,11 @@
 {
     int len, i;
 
-    Jim_fprintf(interp, interp-&gt;cookie_stderr, &quot;Runtime error, file \&quot;%s\&quot;, line %d:&quot; JIM_NL,
-				interp-&gt;errorFileName, interp-&gt;errorLine);
-    Jim_fprintf(interp,interp-&gt;cookie_stderr, &quot;    %s&quot; JIM_NL,
+    if (*interp-&gt;errorFileName) {
+        Jim_fprintf(interp, interp-&gt;cookie_stderr, &quot;Runtime error, file \&quot;%s\&quot;, line %d:&quot; JIM_NL &quot;    &quot;,
+                                    interp-&gt;errorFileName, interp-&gt;errorLine);
+    }
+    Jim_fprintf(interp,interp-&gt;cookie_stderr, &quot;%s&quot; JIM_NL,
             Jim_GetString(interp-&gt;result, NULL));
     Jim_ListLength(interp, interp-&gt;stackTrace, &amp;len);
     for (i = len-3; i &gt;= 0; i-= 3) {
@@ -12267,9 +12306,18 @@
         Jim_ListIndex(interp, interp-&gt;stackTrace, i+2, &amp;objPtr,
                 JIM_NONE);
         line = Jim_GetString(objPtr, NULL);
-		Jim_fprintf( interp, interp-&gt;cookie_stderr,
-                &quot;In procedure '%s' called at file \&quot;%s\&quot;, line %s&quot; JIM_NL,
-                proc, file, line);
+        if (*proc) {
+            Jim_fprintf( interp, interp-&gt;cookie_stderr,
+                    &quot;in procedure '%s' &quot;, proc);
+        }
+        if (*file) {
+            Jim_fprintf( interp, interp-&gt;cookie_stderr,
+                    &quot;called at file \&quot;%s\&quot;, line %s&quot;,
+                    file, line);
+        }
+        if (*file || *proc) {
+            Jim_fprintf( interp, interp-&gt;cookie_stderr, JIM_NL);
+        }
     }
 }
 
@@ -12393,7 +12441,6 @@
 	}
 	return (*(interp-&gt;cb_fgets))( s, size, cookie );
 }
-
 Jim_Nvp *
 Jim_Nvp_name2value_simple( const Jim_Nvp *p, const char *name )
 {
@@ -12555,7 +12602,7 @@
 	Jim_Obj *o;
 	
 	o = NULL; // failure 
-	if( goi-&gt;argc &gt; 0 ){
+	if( goi-&gt;argc ){
 		// success 
 		o = goi-&gt;argv[0];
 		goi-&gt;argc -= 1;
@@ -12704,7 +12751,7 @@
 {
 	va_list ap;
 	char *buf;
-	
+
 	va_start(ap,fmt);
 	buf = jim_vasprintf( fmt, ap );
 	va_end(ap);
@@ -12773,3 +12820,12 @@
 
 	return Jim_GetString( debug_string_obj, NULL );
 }
+
+	
+
+/*
+ * Local Variables: ***
+ * c-basic-offset: 4 ***
+ * tab-width: 4 ***
+ * End: ***
+ */

Modified: branches/openocd-0.1/src/helper/jim.h
===================================================================
--- branches/openocd_1_0_branch/src/helper/jim.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/jim.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -164,6 +164,7 @@
 #define JIM_CONTINUE 4
 #define JIM_EVAL 5
 #define JIM_EXIT 6
+#define JIM_ERR_ADDSTACK 7
 #define JIM_MAX_NESTING_DEPTH 10000 /* default max nesting depth */
 
 /* Some function get an integer argument with flags to change
@@ -530,6 +531,7 @@
     struct Jim_HashTable sharedStrings; /* Shared Strings hash table */
     Jim_Obj *stackTrace; /* Stack trace object. */
     Jim_Obj *unknown; /* Unknown command cache */
+    int unknown_called; /* The unknown command has been invoked */
     int errorFlag; /* Set if an error occurred during execution. */
     int evalRetcodeLevel; /* Level where the last return with code JIM_EVAL
                              happened. */
@@ -560,6 +562,7 @@
  * cached can no longer considered valid. */
 #define Jim_InterpIncrProcEpoch(i) (i)-&gt;procEpoch++
 #define Jim_SetResultString(i,s,l) Jim_SetResult(i, Jim_NewStringObj(i,s,l))
+#define Jim_SetResultInt(i,intval) Jim_SetResult(i, Jim_NewIntObj(i,intval))
 #define Jim_SetEmptyResult(i) Jim_SetResult(i, (i)-&gt;emptyObj)
 #define Jim_GetResult(i) ((i)-&gt;result)
 #define Jim_CmdPrivData(i) ((i)-&gt;cmdPrivData)
@@ -1296,7 +1299,7 @@
   JIM_GET_API(Nvp_name2value);
   JIM_GET_API(Nvp_name2value_nocase);
   JIM_GET_API(Nvp_name2value_simple);
-
+  
   JIM_GET_API(Nvp_value2name);
   JIM_GET_API(Nvp_value2name_simple);
 
@@ -1337,3 +1340,10 @@
 #endif
 
 #endif /* __JIM__H */
+
+/*
+ * Local Variables: ***
+ * c-basic-offset: 4 ***
+ * tab-width: 4 ***
+ * End: ***
+ */

Modified: branches/openocd-0.1/src/helper/log.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/log.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/log.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -31,6 +31,7 @@
 #include &quot;configuration.h&quot;
 #include &quot;time_support.h&quot;
 #include &quot;command.h&quot;
+#include &quot;server.h&quot;
 
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
@@ -54,13 +55,14 @@
 
 static char *log_strings[5] =
 {
-	&quot;User:   &quot;,
-	&quot;Error:  &quot;,
-	&quot;Warning:&quot;,
-	&quot;Info:   &quot;,
-	&quot;Debug:  &quot;
+	&quot;User : &quot;,
+	&quot;Error: &quot;,
+	&quot;Warn : &quot;,  /* want a space after each colon, all same width, colons aligned */
+	&quot;Info : &quot;,
+	&quot;Debug: &quot;
 };
 
+
 static int count = 0;
 
 /* The log_puts() serves to somewhat different goals:
@@ -98,7 +100,7 @@
 			struct mallinfo info;
 			info = mallinfo();
 #endif
-			fprintf(log_output, &quot;%s %d %d %s:%d %s()&quot;
+			fprintf(log_output, &quot;%s%d %d %s:%d %s()&quot;
 #if PRINT_MEM()
 					&quot; %d&quot;
 #endif
@@ -108,9 +110,11 @@
 #endif
 					string);
 		}
-		else
+		else if(server_use_pipes == 0)
 		{
-			if (strcmp(string, &quot;\n&quot;)!=0)
+			/* if we are using gdb through pipes then we do not want any output
+			 * to the pipe otherwise we get repeated strings */
+			if (strcmp(string, &quot;\n&quot;) != 0)
 			{
 				/* print human readable output - but skip empty lines */
 				fprintf(log_output, &quot;%s%s&quot;,
@@ -203,6 +207,18 @@
 	if (debug_level &gt; 3)
 		debug_level = 3;
 
+	if (debug_level &gt;= LOG_LVL_DEBUG &amp;&amp; server_use_pipes == 1)
+	{
+		/* if we are enabling debug info then we need to write to a log file
+		 * otherwise the pipe will get full and cause issues with gdb */
+		FILE* file = fopen(&quot;openocd.log&quot;, &quot;w&quot;);
+		if (file)
+		{
+			log_output = file;
+			LOG_WARNING(&quot;enabling log output as we are using pipes&quot;);
+		}
+	}
+
 	return ERROR_OK;
 }
 
@@ -413,7 +429,6 @@
 	}
 }
 
-
 void busy_sleep(int ms)
 {
 	long long then;

Modified: branches/openocd-0.1/src/helper/log.h
===================================================================
--- branches/openocd_1_0_branch/src/helper/log.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/log.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -124,6 +124,6 @@
 /* see &quot;Error:&quot; log entry for meaningful message to the user. The caller should 
  * make no assumptions about what went wrong and try to handle the problem.
  */
-#define ERROR_FAIL       			(-4)
+#define ERROR_FAIL					(-4)
 
 #endif /* LOG_H */

Modified: branches/openocd-0.1/src/helper/options.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/options.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/options.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -24,10 +24,13 @@
 #include &quot;config.h&quot;
 #endif
 
+#include &quot;replacements.h&quot;
+
 #include &quot;types.h&quot;
 #include &quot;command.h&quot;
 #include &quot;configuration.h&quot;
 #include &quot;log.h&quot;
+#include &quot;server.h&quot;
 
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
@@ -43,8 +46,9 @@
 	{&quot;debug&quot;,	optional_argument,	0,		'd'},
 	{&quot;file&quot;, 	required_argument,	0,		'f'},
 	{&quot;search&quot;,	required_argument,	0,		's'},
-	{&quot;log_output&quot;,	required_argument,	0,		'l'},
+	{&quot;log_output&quot;,	required_argument,	0,	'l'},
 	{&quot;command&quot;,	required_argument,	0,		'c'},
+	{&quot;pipe&quot;,	no_argument,		0,		'p'},
 	{0, 0, 0, 0}
 };
 
@@ -95,7 +99,7 @@
 		/* getopt_long stores the option index here. */
 		int option_index = 0;
 		
-		c = getopt_long(argc, argv, &quot;hvd::l:f:s:c:&quot;, long_options, &amp;option_index);
+		c = getopt_long(argc, argv, &quot;hvd::l:f:s:c:p&quot;, long_options, &amp;option_index);
 		
 		/* Detect the end of the options. */
 		if (c == -1)
@@ -140,7 +144,14 @@
 					add_config_command(optarg);
 				}	
 				break;
-				
+			case 'p':	/* --pipe | -p */
+#if BUILD_ECOSBOARD == 1
+				/* pipes unsupported on hosted platforms */
+				LOG_WARNING(&quot;pipes not supported on this platform&quot;);
+#else
+				server_use_pipes = 1;
+#endif
+				break;
 		}
 	}
 
@@ -154,15 +165,16 @@
 		LOG_OUTPUT(&quot;--debug      | -d\tset debug level &lt;0-3&gt;\n&quot;);
 		LOG_OUTPUT(&quot;--log_output | -l\tredirect log output to file &lt;name&gt;\n&quot;);
 		LOG_OUTPUT(&quot;--command    | -c\trun &lt;command&gt;\n&quot;);
+		LOG_OUTPUT(&quot;--pipe       | -p\tuse pipes for gdb communication\n&quot;);
 		exit(-1);
 	}	
 
 	if (version_flag)
 	{
 		/* Nothing to do, version gets printed automatically. */
-		exit(-1);
-	}	
-
-
+		// It is not an error to request the VERSION number.
+		exit(0);
+	}
+	
 	return ERROR_OK;
 }

Modified: branches/openocd-0.1/src/helper/replacements.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/replacements.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/replacements.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -68,6 +68,10 @@
 
 #include &lt;stdio.h&gt;
 
+#ifdef _WIN32
+#include &lt;io.h&gt;
+#endif
+
 /* replacements for gettimeofday */
 #ifndef HAVE_GETTIMEOFDAY
 
@@ -82,19 +86,19 @@
 
 int gettimeofday(struct timeval *tv, struct timezone *tz)
 {
-	FILETIME        ft;
-	LARGE_INTEGER   li;
-	__int64         t;
-	static int      tzflag;
+	FILETIME ft;
+	LARGE_INTEGER li;
+	__int64 t;
+	static int tzflag;
 
 	if (tv)
 	{
 		GetSystemTimeAsFileTime(&amp;ft);
 		li.LowPart  = ft.dwLowDateTime;
 		li.HighPart = ft.dwHighDateTime;
-		t  = li.QuadPart;                   /* In 100-nanosecond intervals */
-		t -= EPOCHFILETIME;                 /* Offset to the Epoch time */
-		t /= 10;                            /* In microseconds */
+		t  = li.QuadPart;					/* In 100-nanosecond intervals */
+		t -= EPOCHFILETIME;					/* Offset to the Epoch time */
+		t /= 10;							/* In microseconds */
 		tv-&gt;tv_sec  = (long)(t / 1000000);
 		tv-&gt;tv_usec = (long)(t % 1000000);
 	}
@@ -137,3 +141,151 @@
 	return (char *) memcpy (new, s, len);
 }
 #endif
+
+#ifdef _WIN32
+int win_select(int max_fd, fd_set *rfds, fd_set *wfds, fd_set *efds, struct timeval *tv)
+{
+	DWORD ms_total, limit;
+	HANDLE handles[MAXIMUM_WAIT_OBJECTS];
+	int handle_slot_to_fd[MAXIMUM_WAIT_OBJECTS];
+	int n_handles = 0, i;
+	fd_set sock_read, sock_write, sock_except;
+	fd_set aread, awrite, aexcept;
+	int sock_max_fd = -1;
+	struct timeval tvslice;
+	int retcode;
+
+#define SAFE_FD_ISSET(fd, set)	(set != NULL &amp;&amp; FD_ISSET(fd, set))
+
+	/* calculate how long we need to wait in milliseconds */
+	if (tv == NULL) {
+		ms_total = INFINITE;
+	} else {
+		ms_total = tv-&gt;tv_sec * 1000;
+		ms_total += tv-&gt;tv_usec / 1000;
+	}
+
+	FD_ZERO(&amp;sock_read);
+	FD_ZERO(&amp;sock_write);
+	FD_ZERO(&amp;sock_except);
+
+	/* build an array of handles for non-sockets */
+	for (i = 0; i &lt; max_fd; i++) {
+		if (SAFE_FD_ISSET(i, rfds) || SAFE_FD_ISSET(i, wfds) || SAFE_FD_ISSET(i, efds)) {
+			handles[n_handles] = (HANDLE)_get_osfhandle(i);
+			if (handles[n_handles] == INVALID_HANDLE_VALUE) {
+				/* socket */
+				if (SAFE_FD_ISSET(i, rfds)) {
+					FD_SET(i, &amp;sock_read);
+				}
+				if (SAFE_FD_ISSET(i, wfds)) {
+					FD_SET(i, &amp;sock_write);
+				}
+				if (SAFE_FD_ISSET(i, efds)) {
+					FD_SET(i, &amp;sock_except);
+				}
+				if (i &gt; sock_max_fd) {
+					sock_max_fd = i;
+				}
+			} else {
+				handle_slot_to_fd[n_handles] = i;
+				n_handles++;
+			}
+		}
+	}
+
+	if (n_handles == 0) {
+		/* plain sockets only - let winsock handle the whole thing */
+		return select(max_fd, rfds, wfds, efds, tv);
+	}
+
+	/* mixture of handles and sockets; lets multiplex between
+	 * winsock and waiting on the handles */
+
+	FD_ZERO(&amp;aread);
+	FD_ZERO(&amp;awrite);
+	FD_ZERO(&amp;aexcept);
+	
+	limit = GetTickCount() + ms_total;
+	do {
+		retcode = 0;
+	
+		if (sock_max_fd &gt;= 0) {
+			/* overwrite the zero'd sets here; the select call
+			 * will clear those that are not active */
+			aread = sock_read;
+			awrite = sock_write;
+			aexcept = sock_except;
+
+			tvslice.tv_sec = 0;
+			tvslice.tv_usec = 100000;
+
+			retcode = select(sock_max_fd+1, &amp;aread, &amp;awrite, &amp;aexcept, &amp;tvslice);
+		}
+		if (n_handles &gt; 0) {
+			/* check handles */
+			DWORD wret;
+
+			wret = MsgWaitForMultipleObjects(n_handles, handles, FALSE, retcode &gt; 0 ? 0 : 100, QS_ALLEVENTS);
+
+			if (wret == WAIT_TIMEOUT) {
+				/* set retcode to 0; this is the default.
+				 * select() may have set it to something else,
+				 * in which case we leave it alone, so this branch
+				 * does nothing */
+				;
+			} else if (wret == WAIT_FAILED) {
+				if (retcode == 0) {
+					retcode = -1;
+				}
+			} else {
+				if (retcode &lt; 0) {
+					retcode = 0;
+				}
+				for (i = 0; i &lt; n_handles; i++) {
+					if (WAIT_OBJECT_0 == WaitForSingleObject(handles[i], 0)) {
+						if (SAFE_FD_ISSET(handle_slot_to_fd[i], rfds)) {
+							DWORD dwBytes;
+							
+							if (PeekNamedPipe((HANDLE)_get_osfhandle(handle_slot_to_fd[i]), NULL, 0, NULL, &amp;dwBytes, NULL))
+							{
+								/* check to see if gdb pipe has data available */
+								if (dwBytes)
+								{
+									FD_SET(handle_slot_to_fd[i], &amp;aread);
+									retcode++;
+								}
+							}
+							else
+							{
+								FD_SET(handle_slot_to_fd[i], &amp;aread);
+								retcode++;
+							}
+						}
+						if (SAFE_FD_ISSET(handle_slot_to_fd[i], wfds)) {
+							FD_SET(handle_slot_to_fd[i], &amp;awrite);
+							retcode++;
+						}
+						if (SAFE_FD_ISSET(handle_slot_to_fd[i], efds)) {
+							FD_SET(handle_slot_to_fd[i], &amp;aexcept);
+							retcode++;
+						}
+					}
+				}
+			}
+		}
+	} while (retcode == 0 &amp;&amp; (ms_total == INFINITE || GetTickCount() &lt; limit));
+
+	if (rfds) {
+		*rfds = aread;
+	}
+	if (wfds) {
+		*wfds = awrite;
+	}
+	if (efds) {
+		*efds = aexcept;
+	}
+
+	return retcode;
+}
+#endif

Modified: branches/openocd-0.1/src/helper/replacements.h
===================================================================
--- branches/openocd_1_0_branch/src/helper/replacements.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/replacements.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -84,10 +84,9 @@
 /* gettimeofday() */
 #ifndef HAVE_GETTIMEOFDAY
 
-
 #ifdef _WIN32
 struct timezone {
-    int tz_minuteswest;
+	int tz_minuteswest;
 	int tz_dsttime;
 };
 #endif
@@ -161,6 +160,12 @@
 #include &lt;windows.h&gt;
 #include &lt;time.h&gt;
 
+/* win32 systems do not support ETIMEDOUT */
+
+#ifndef ETIMEDOUT
+#define ETIMEDOUT WSAETIMEDOUT
+#endif
+
 #if IS_MINGW == 1
 static __inline unsigned char inb(unsigned short int port)
 {
@@ -175,33 +180,36 @@
 }
 
 #endif /* IS_MINGW */
+
+int win_select(int max_fd, fd_set *rfds, fd_set *wfds, fd_set *efds, struct timeval *tv);
+
 #endif  /* _WIN32 */
 
 /* generic socket functions for Windows and Posix */
 static __inline int write_socket( int handle, const void *buffer, unsigned int count )
 {
 #ifdef _WIN32
-    return send(handle, buffer, count, 0);
+	return send(handle, buffer, count, 0);
 #else
-    return write(handle, buffer, count);
+	return write(handle, buffer, count);
 #endif
 }
 
 static __inline int read_socket( int handle, void *buffer, unsigned int count )
 {
 #ifdef _WIN32
-    return recv(handle, buffer, count, 0);
+	return recv(handle, buffer, count, 0);
 #else
-    return read(handle, buffer, count);
+	return read(handle, buffer, count);
 #endif
 }
 
 static __inline int close_socket(int sock)
 {
 #ifdef _WIN32
-    return closesocket(sock);
+	return closesocket(sock);
 #else
-    return close(sock);
+	return close(sock);
 #endif
 }
 
@@ -216,6 +224,15 @@
 #endif
 }
 
+static __inline int socket_select(int max_fd, fd_set *rfds, fd_set *wfds, fd_set *efds, struct timeval *tv)
+{
+#ifdef _WIN32
+	return win_select(max_fd, rfds, wfds, efds, tv);
+#else
+	return select(max_fd, rfds, wfds, efds, tv);
+#endif
+}
+
 #ifndef HAVE_ELF_H
 
 typedef struct
@@ -229,9 +246,9 @@
 	u32	e_shoff;		/* Section header table file offset */
 	u32	e_flags;		/* Processor-specific flags */
 	u16	e_ehsize;		/* ELF header size in bytes */
-	u16	e_phentsize;		/* Program header table entry size */
+	u16	e_phentsize;	/* Program header table entry size */
 	u16	e_phnum;		/* Program header table entry count */
-	u16	e_shentsize;		/* Section header table entry size */
+	u16	e_shentsize;	/* Section header table entry size */
 	u16	e_shnum;		/* Section header table entry count */
 	u16	e_shstrndx;		/* Section header string table index */
 } Elf32_Ehdr;

Modified: branches/openocd-0.1/src/helper/tclapi.c
===================================================================
--- branches/openocd_1_0_branch/src/helper/tclapi.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/tclapi.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -525,7 +525,6 @@
 	return JIM_OK;
 }
 
-
 int tclapi_register_commands()
 {
 	register_jim(&quot;ocd_mem2array&quot;, jim_mem2array, &quot;read memory and return as a TCL array for script processing&quot;);

Modified: branches/openocd-0.1/src/helper/types.h
===================================================================
--- branches/openocd_1_0_branch/src/helper/types.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/helper/types.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -43,42 +43,74 @@
 typedef unsigned long long u64;
 #endif
 
-
 typedef struct jtag_tap_s jtag_tap_t;
 
 
-/* DANGER!!!! here be dragons! Note that the pointer in 
- * memory might be unaligned. On some CPU's, i.e. ARM7,
- * the 2 lsb are ignored for 32 bit access, on others
- * it will cause an exception and on e.g. x86, it works
- * the same as if aligned.
+/* DANGER!!!! here be dragons!
+ *
+ * Leave these fn's as byte accesses because it is safe
+ * across architectures. Clever usage of 32 bit access
+ * will create problems on some hosts.
+ *
+ * Note that the &quot;buf&quot; pointer in memory is probably unaligned.
+ *
+ * Were these functions to be re-written to take a 32 bit wide or 16 bit wide
+ * memory access shortcut, then on some CPU's, i.e. ARM7, the 2 lsbytes of the address are
+ * ignored for 32 bit access, whereas on other CPU's a 32 bit wide unaligned memory access
+ * will cause an exception, and lastly on x86, an unaligned &quot;greater than bytewide&quot;
+ * memory access works as if aligned.  So what follows below will work for all
+ * platforms and gives the compiler leeway to do its own platform specific optimizations.
+ *
+ * Again, note that the &quot;buf&quot; pointer in memory is probably unaligned.
  */
-#define le_to_h_u32(x) ((u32)((x)[0] | (x)[1] &lt;&lt; 8 | (x)[2] &lt;&lt; 16 | (x)[3] &lt;&lt; 24))
-#define le_to_h_u16(x) ((u16)((x)[0] | (x)[1] &lt;&lt; 8))
-#define be_to_h_u32(x) ((u32)((x)[3] | (x)[2] &lt;&lt; 8 | (x)[1] &lt;&lt; 16 | (x)[0] &lt;&lt; 24))
-#define be_to_h_u16(x) ((u16)((x)[1] | (x)[0] &lt;&lt; 8))
 
-#define h_u32_to_le(buf, val) do {\
-(buf)[3] = ((val) &amp; 0xff000000) &gt;&gt; 24;\
-(buf)[2] = ((val) &amp; 0x00ff0000) &gt;&gt; 16;\
-(buf)[1] = ((val) &amp; 0x0000ff00) &gt;&gt; 8;\
-(buf)[0] = ((val) &amp; 0x000000ff);\
-} while (0)
-#define h_u32_to_be(buf, val) do {\
-(buf)[0] = ((val) &amp; 0xff000000) &gt;&gt; 24;\
-(buf)[1] = ((val) &amp; 0x00ff0000) &gt;&gt; 16;\
-(buf)[2] = ((val) &amp; 0x0000ff00) &gt;&gt; 8;\
-(buf)[3] = ((val) &amp; 0x000000ff);\
-} while (0)
 
-#define h_u16_to_le(buf, val) do {\
-(buf)[1] = ((val) &amp; 0xff00) &gt;&gt; 8;\
-(buf)[0] = ((val) &amp; 0x00ff) &gt;&gt; 0;\
-} while (0)
-#define h_u16_to_be(buf, val) do {\
-(buf)[0] = ((val) &amp; 0xff00) &gt;&gt; 8;\
-(buf)[1] = ((val) &amp; 0x00ff) &gt;&gt; 0;\
-} while (0)
+static inline u32 le_to_h_u32(const u8* buf)
+{
+	return (u32)(buf[0] | buf[1] &lt;&lt; 8 | buf[2] &lt;&lt; 16 | buf[3] &lt;&lt; 24);
+}
 
+static inline u16 le_to_h_u16(const u8* buf)
+{
+	return (u16)(buf[0] | buf[1] &lt;&lt; 8);
+}
 
+static inline u32 be_to_h_u32(const u8* buf)
+{
+	return (u32)(buf[3] | buf[2] &lt;&lt; 8 | buf[1] &lt;&lt; 16 | buf[0] &lt;&lt; 24);
+}
+
+static inline u16 be_to_h_u16(const u8* buf)
+{
+	return (u16)(buf[1] | buf[0] &lt;&lt; 8);
+}
+
+static inline void h_u32_to_le(u8* buf, int val)
+{
+	buf[3] = (u8) (val &gt;&gt; 24);
+	buf[2] = (u8) (val &gt;&gt; 16);
+	buf[1] = (u8) (val &gt;&gt; 8);
+	buf[0] = (u8) (val &gt;&gt; 0);
+}
+
+static inline void h_u32_to_be(u8* buf, int val)
+{
+	buf[0] = (u8) (val &gt;&gt; 24);
+	buf[1] = (u8) (val &gt;&gt; 16);
+	buf[2] = (u8) (val &gt;&gt; 8);
+	buf[3] = (u8) (val &gt;&gt; 0);
+}
+
+static inline void h_u16_to_le(u8* buf, int val)
+{
+	buf[1] = (u8) (val &gt;&gt; 8);
+	buf[0] = (u8) (val &gt;&gt; 0);
+}
+
+static inline void h_u16_to_be(u8* buf, int val)
+{
+	buf[0] = (u8) (val &gt;&gt; 8);
+	buf[1] = (u8) (val &gt;&gt; 0);
+}
+
 #endif /* TYPES_H */

Modified: branches/openocd-0.1/src/jtag/Makefile.am
===================================================================
--- branches/openocd_1_0_branch/src/jtag/Makefile.am	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/Makefile.am	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,15 +1,6 @@
 
-if FTD2XXDIR
-if IS_MINGW
-FTD2XXINC = <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">-I at WITH_FTD2XX</A>@
-else
-FTD2XXINC = <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">-I at WITH_FTD2XX</A>@/
-endif
-else
-FTD2XXINC =
-endif
 
-INCLUDES = -I$(top_srcdir)/src -I$(top_srcdir)/src/helper $(FTD2XXINC) $(all_includes) -I$(top_srcdir)/src/target 
+INCLUDES = -I$(top_srcdir)/src -I$(top_srcdir)/src/helper  $(all_includes) -I$(top_srcdir)/src/target 
 METASOURCES = AUTO
 noinst_LIBRARIES = libjtag.a
 
@@ -99,7 +90,19 @@
 JLINKFILES =
 endif
 
+if RLINK
+RLINKFILES = rlink/rlink.c rlink/rlink_speed_table.c
+else
+RLINKFILES =
+endif
+
+if VSLLINK
+VSLLINKFILES = vsllink.c
+else
+VSLLINKFILES =
+endif
+
 libjtag_a_SOURCES = jtag.c $(BITBANGFILES) $(PARPORTFILES) $(DUMMYFILES) $(FT2232FILES) $(AMTJTAGACCELFILES) $(EP93XXFILES) \
-	$(AT91RM9200FILES) $(GW16012FILES) $(BITQFILES) $(PRESTOFILES) $(USBPROGFILES) $(ECOSBOARDFILES) $(JLINKFILES)
+	$(AT91RM9200FILES) $(GW16012FILES) $(BITQFILES) $(PRESTOFILES) $(USBPROGFILES) $(ECOSBOARDFILES) $(JLINKFILES) $(RLINKFILES) $(VSLLINKFILES)
 
 noinst_HEADERS = bitbang.h jtag.h

Modified: branches/openocd-0.1/src/jtag/bitbang.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/bitbang.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/bitbang.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -37,9 +37,12 @@
 #include &lt;stdlib.h&gt;
 #include &lt;unistd.h&gt;
 
+
+static void bitbang_stableclocks(int num_cycles);
+
+
 bitbang_interface_t *bitbang_interface;
 
-
 /* DANGER!!!! clock absolutely *MUST* be 0 in idle or reset won't work!
  *
  * Set this to 1 and str912 reset halt will fail.
@@ -62,6 +65,8 @@
 
 int bitbang_execute_queue(void);
 
+
+
 /* The bitbang driver leaves the TCK 0 when in idle */
 
 void bitbang_end_state(enum tap_state state)
@@ -110,7 +115,7 @@
 		}
 		else
 		{
-			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, tap_state_strings[cur_state], tap_state_strings[cmd-&gt;path[state_count]]);
+			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, jtag_state_name(cur_state), jtag_state_name(cmd-&gt;path[state_count]));
 			exit(-1);
 		}
 
@@ -154,6 +159,21 @@
 		bitbang_state_move();
 }
 
+
+static void bitbang_stableclocks(int num_cycles)
+{
+	int i;
+
+	/* send num_cycles clocks onto the cable */
+	for (i = 0; i &lt; num_cycles; i++)
+	{
+		bitbang_interface-&gt;write(1, 0, 0);
+		bitbang_interface-&gt;write(0, 0, 0);
+	}
+}
+
+
+
 void bitbang_scan(int ir_scan, enum scan_type type, u8 *buffer, int scan_size)
 {
 	enum tap_state saved_end_state = end_state;
@@ -248,7 +268,7 @@
 		{
 			case JTAG_END_STATE:
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;end_state: %i&quot;, cmd-&gt;cmd.end_state-&gt;end_state);
+				LOG_DEBUG(&quot;end_state: %s&quot;, jtag_state_name(cmd-&gt;cmd.end_state-&gt;end_state) );
 #endif
 				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
 					bitbang_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
@@ -265,15 +285,20 @@
 				break;
 			case JTAG_RUNTEST:
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;runtest %i cycles, end in %i&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, cmd-&gt;cmd.runtest-&gt;end_state);
+				LOG_DEBUG(&quot;runtest %i cycles, end in %s&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, jtag_state_name(cmd-&gt;cmd.runtest-&gt;end_state) );
 #endif
 				if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
 					bitbang_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
 				bitbang_runtest(cmd-&gt;cmd.runtest-&gt;num_cycles);
 				break;
+
+			case JTAG_STABLECLOCKS:
+				bitbang_stableclocks(cmd-&gt;cmd.stableclocks-&gt;num_cycles);
+				break;
+
 			case JTAG_STATEMOVE:
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;statemove end in %i&quot;, cmd-&gt;cmd.statemove-&gt;end_state);
+				LOG_DEBUG(&quot;statemove end in %s&quot;, jtag_state_name(cmd-&gt;cmd.statemove-&gt;end_state));
 #endif
 				if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
 					bitbang_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
@@ -281,13 +306,14 @@
 				break;
 			case JTAG_PATHMOVE:
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;pathmove: %i states, end in %i&quot;, cmd-&gt;cmd.pathmove-&gt;num_states, cmd-&gt;cmd.pathmove-&gt;path[cmd-&gt;cmd.pathmove-&gt;num_states - 1]);
+				LOG_DEBUG(&quot;pathmove: %i states, end in %s&quot;, cmd-&gt;cmd.pathmove-&gt;num_states,
+					jtag_state_name(cmd-&gt;cmd.pathmove-&gt;path[cmd-&gt;cmd.pathmove-&gt;num_states - 1]));
 #endif
 				bitbang_path_move(cmd-&gt;cmd.pathmove);
 				break;
 			case JTAG_SCAN:
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;%s scan end in %i&quot;,  (cmd-&gt;cmd.scan-&gt;ir_scan) ? &quot;IR&quot; : &quot;DR&quot;, cmd-&gt;cmd.scan-&gt;end_state);
+				LOG_DEBUG(&quot;%s scan end in %s&quot;,  (cmd-&gt;cmd.scan-&gt;ir_scan) ? &quot;IR&quot; : &quot;DR&quot;, jtag_state_name(cmd-&gt;cmd.scan-&gt;end_state) );
 #endif
 				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
 					bitbang_end_state(cmd-&gt;cmd.scan-&gt;end_state);
@@ -316,4 +342,3 @@
 
 	return retval;
 }
-

Modified: branches/openocd-0.1/src/jtag/bitq.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/bitq.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/bitq.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -34,7 +34,6 @@
 #include &lt;stdlib.h&gt;
 #include &lt;unistd.h&gt;
 
-
 bitq_interface_t *bitq_interface; /* low level bit queue interface */
 
 bitq_state_t bitq_in_state; /* state of input queue */
@@ -42,7 +41,6 @@
 u8 *bitq_in_buffer; /* buffer dynamically reallocated as needed */
 unsigned long bitq_in_bufsize=32; /* min. buffer size */
 
-
 /*
  * input queue processing does not use jtag_read_buffer() to avoid unnecessary overhead
  * also the buffer for incomming data is reallocated only if necessary
@@ -129,8 +127,6 @@
 	}
 }
 
-
-
 void bitq_io(int tms, int tdi, int tdo_req)
 {
 	bitq_interface-&gt;out(tms, tdi, tdo_req);
@@ -138,7 +134,6 @@
 	if (bitq_interface-&gt;in_rdy()) bitq_in_proc();
 }
 
-
 void bitq_end_state(enum tap_state state)
 {
 	if (state==-1) return;
@@ -149,7 +144,6 @@
 	end_state = state;
 }
 
-
 void bitq_state_move(enum tap_state new_state)
 {
 	int i=0;
@@ -170,16 +164,17 @@
 	cur_state = new_state;
 }
 
-
 void bitq_path_move(pathmove_command_t *cmd)
 {
 	int i;
 
 	for (i=0; i&lt;=cmd-&gt;num_states; i++) {
-		if (tap_transitions[cur_state].low == cmd-&gt;path[i]) bitq_io(0, 0, 0);
-		else if (tap_transitions[cur_state].high == cmd-&gt;path[i]) bitq_io(1, 0, 0);
+		if (tap_transitions[cur_state].low == cmd-&gt;path[i]) 
+			bitq_io(0, 0, 0);
+		else if (tap_transitions[cur_state].high == cmd-&gt;path[i]) 
+			bitq_io(1, 0, 0);
 		else {
-			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, tap_state_strings[cur_state], tap_state_strings[cmd-&gt;path[i]]);
+			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, jtag_state_name(cur_state), jtag_state_name(cmd-&gt;path[i]));
 			exit(-1);
 		}
 
@@ -189,7 +184,6 @@
 	end_state = cur_state;
 }
 
-
 void bitq_runtest(int num_cycles)
 {
 	int i;
@@ -205,7 +199,6 @@
 	if (cur_state != end_state) bitq_state_move(end_state);
 }
 
-
 void bitq_scan_field(scan_field_t *field, int pause)
 {
 	int bit_cnt;
@@ -245,7 +238,6 @@
 	}
 }
 
-
 void bitq_scan(scan_command_t *cmd)
 {
 	int i;
@@ -258,7 +250,6 @@
 	bitq_scan_field(&amp;cmd-&gt;fields[i], 1);
 }
 
-
 int bitq_execute_queue(void)
 {
 	jtag_command_t *cmd = jtag_command_queue; /* currently processed command */
@@ -356,7 +347,6 @@
 	return bitq_in_state.status;
 }
 
-
 void bitq_cleanup(void)
 {
 	if (bitq_in_buffer!=NULL)

Modified: branches/openocd-0.1/src/jtag/dummy.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/dummy.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/dummy.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -27,22 +27,41 @@
 #include &quot;bitbang.h&quot;
 
 
+/* my private tap controller state, which tracks state for calling code */
+static tap_state_t dummy_state = TAP_RESET;
+
+static int dummy_clock;         /* edge detector */
+
+static int clock_count;         /* count clocks in any stable state, only stable states */
+
+
+static tap_state_t tap_state_transition(tap_state_t cur_state, int tms);
+
+static u32 dummy_data;
+
+
 int dummy_speed(int speed);
 int dummy_register_commands(struct command_context_s *cmd_ctx);
 int dummy_init(void);
 int dummy_quit(void);
+static int dummy_khz(int khz, int *jtag_speed);
+static int dummy_speed_div(int speed, int *khz);
 
-/* The dummy driver is used to easily check the code path 
+
+/* The dummy driver is used to easily check the code path
  * where the target is unresponsive.
  */
-jtag_interface_t dummy_interface = 
+jtag_interface_t dummy_interface =
 {
 	.name = &quot;dummy&quot;,
-	
+
 	.execute_queue = bitbang_execute_queue,
 
-	.speed = dummy_speed,	
+	.speed = dummy_speed,
 	.register_commands = dummy_register_commands,
+	.khz = dummy_khz,
+	.speed_div = dummy_speed_div,
+
 	.init = dummy_init,
 	.quit = dummy_quit,
 };
@@ -62,19 +81,86 @@
 
 int dummy_read(void)
 {
-	return 1;
+	int data = 1 &amp; dummy_data;
+	dummy_data = (dummy_data &gt;&gt; 1) | (1&lt;&lt;31);
+	return data;
 }
 
 
 void dummy_write(int tck, int tms, int tdi)
 {
+	/* TAP standard: &quot;state transitions occur on rising edge of clock&quot; */
+	if( tck != dummy_clock )
+	{
+		if( tck )
+		{
+			int old_state = dummy_state;
+			dummy_state = tap_state_transition( old_state, tms );
+
+			if( old_state != dummy_state )
+			{
+				if( clock_count )
+				{
+					LOG_DEBUG(&quot;dummy_tap: %d stable clocks&quot;, clock_count);
+					clock_count = 0;
+				}
+
+				LOG_DEBUG(&quot;dummy_tap: %s&quot;, jtag_state_name(dummy_state) );
+
+#if defined(DEBUG)
+				if(dummy_state == TAP_DRCAPTURE)
+					dummy_data = 0x01255043;
+#endif
+			}
+			else
+			{
+				/* this is a stable state clock edge, no change of state here,
+				 * simply increment clock_count for subsequent logging
+				 */
+				++clock_count;
+			}
+		}
+		dummy_clock = tck;
+	}
 }
 
 void dummy_reset(int trst, int srst)
 {
+	dummy_clock = 0;
+
+	if (trst || (srst &amp;&amp; (jtag_reset_config &amp; RESET_SRST_PULLS_TRST)))
+		dummy_state = TAP_RESET;
+
+	LOG_DEBUG(&quot;reset to: %s&quot;, jtag_state_name(dummy_state) );
 }
-	
 
+static int dummy_khz(int khz, int *jtag_speed)
+{
+	if (khz==0)
+	{
+		*jtag_speed=0;
+	}
+	else
+	{
+		*jtag_speed=64000/khz;
+	}
+	return ERROR_OK;
+}
+
+static int dummy_speed_div(int speed, int *khz)
+{
+	if (speed==0)
+	{
+		*khz = 0;
+	}
+	else
+	{
+		*khz=64000/speed;
+	}
+
+	return ERROR_OK;
+}
+
 int dummy_speed(int speed)
 {
 	return ERROR_OK;
@@ -85,10 +171,9 @@
 	return ERROR_OK;
 }
 
-
 int dummy_init(void)
 {
-	bitbang_interface = &amp;dummy_bitbang;	
+	bitbang_interface = &amp;dummy_bitbang;
 
 	return ERROR_OK;
 }
@@ -98,8 +183,110 @@
 	return ERROR_OK;
 }
 
-
 void dummy_led(int on)
 {
 }
 
+
+/**
+ * Function tap_state_transition
+ * takes a current TAP state and returns the next state according to the tms value.
+ *
+ * Even though there is code to duplicate this elsewhere, we do it here a little
+ * differently just to get a second opinion, i.e. a verification, on state tracking
+ * in that other logic. Plus array lookups without index checking are no favorite thing.
+ * This is educational for developers new to TAP controllers.
+ */
+static tap_state_t tap_state_transition(tap_state_t cur_state, int tms)
+{
+	tap_state_t new_state;
+
+	if (tms)
+	{
+		switch (cur_state)
+		{
+		case TAP_RESET:
+			new_state = cur_state;
+			break;
+		case TAP_IDLE:
+		case TAP_DRUPDATE:
+		case TAP_IRUPDATE:
+			new_state = TAP_DRSELECT;
+			break;
+		case TAP_DRSELECT:
+			new_state = TAP_IRSELECT;
+			break;
+		case TAP_DRCAPTURE:
+		case TAP_DRSHIFT:
+			new_state = TAP_DREXIT1;
+			break;
+		case TAP_DREXIT1:
+		case TAP_DREXIT2:
+			new_state = TAP_DRUPDATE;
+			break;
+		case TAP_DRPAUSE:
+			new_state = TAP_DREXIT2;
+			break;
+		case TAP_IRSELECT:
+			new_state = TAP_RESET;
+			break;
+		case TAP_IRCAPTURE:
+		case TAP_IRSHIFT:
+			new_state = TAP_IREXIT1;
+			break;
+		case TAP_IREXIT1:
+		case TAP_IREXIT2:
+			new_state = TAP_IRUPDATE;
+			break;
+		case TAP_IRPAUSE:
+			new_state = TAP_IREXIT2;
+			break;
+		default:
+			LOG_ERROR( &quot;fatal: invalid argument cur_state=%d&quot;, cur_state );
+			exit(1);
+			break;
+		}
+	}
+	else
+	{
+		switch (cur_state)
+		{
+		case TAP_RESET:
+		case TAP_IDLE:
+		case TAP_DRUPDATE:
+		case TAP_IRUPDATE:
+			new_state = TAP_IDLE;
+			break;
+		case TAP_DRSELECT:
+			new_state = TAP_DRCAPTURE;
+			break;
+		case TAP_DRCAPTURE:
+		case TAP_DRSHIFT:
+		case TAP_DREXIT2:
+			new_state = TAP_DRSHIFT;
+			break;
+		case TAP_DREXIT1:
+		case TAP_DRPAUSE:
+			new_state = TAP_DRPAUSE;
+			break;
+		case TAP_IRSELECT:
+			new_state = TAP_IRCAPTURE;
+			break;
+		case TAP_IRCAPTURE:
+		case TAP_IRSHIFT:
+		case TAP_IREXIT2:
+			new_state = TAP_IRSHIFT;
+			break;
+		case TAP_IREXIT1:
+		case TAP_IRPAUSE:
+			new_state = TAP_IRPAUSE;
+			break;
+		default:
+			LOG_ERROR( &quot;fatal: invalid argument cur_state=%d&quot;, cur_state );
+			exit(1);
+			break;
+		}
+	}
+
+	return new_state;
+}

Modified: branches/openocd-0.1/src/jtag/ep93xx.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/ep93xx.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/ep93xx.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -64,7 +64,7 @@
 jtag_interface_t ep93xx_interface = 
 {
 	.name = &quot;ep93xx&quot;,
-	
+
 	.execute_queue = bitbang_execute_queue,
 
 	.speed = ep93xx_speed,	
@@ -126,7 +126,7 @@
 
 int ep93xx_speed(int speed)
 {
-	
+
 	return ERROR_OK;
 }
 

Modified: branches/openocd-0.1/src/jtag/ft2232.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/ft2232.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/ft2232.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -76,6 +76,18 @@
 int ft2232_handle_vid_pid_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 int ft2232_handle_latency_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
+
+/**
+ * Function ft2232_stableclocks
+ * will send out \a num_cycles on the TCK line while the TAP(s)
+ * are in a stable state.  Calling code must ensure that current state is
+ * stable, that verification is not done in here.
+ * @param num_cycles is the count of clocks cycles to send.
+ * @return int - ERROR_OK or ERROR_JTAG_QUEUE_FAILED
+ */
+static int ft2232_stableclocks(int num_cycles, jtag_command_t *cmd);
+
+
 char *ft2232_device_desc = NULL;
 char *ft2232_serial = NULL;
 char *ft2232_layout = NULL;
@@ -149,10 +161,15 @@
 static struct ftdi_context ftdic;
 #endif
 
+
+static jtag_command_t *first_unsent;		/* next command that has to be sent */
+static int require_send;
+
 static u8 *ft2232_buffer = NULL;
 static int ft2232_buffer_size = 0;
 static int ft2232_read_pointer = 0;
 static int ft2232_expect_read = 0;
+
 #define FT2232_BUFFER_SIZE	131072
 #define BUFFER_ADD ft2232_buffer[ft2232_buffer_size++]
 #define BUFFER_READ ft2232_buffer[ft2232_read_pointer++]
@@ -344,7 +361,7 @@
 
 void ft2232_read_scan(enum scan_type type, u8* buffer, int scan_size)
 {
-	int num_bytes = ((scan_size + 7) / 8);
+	int num_bytes = (scan_size + 7) / 8;
 	int bits_left = scan_size;
 	int cur_byte = 0;
 
@@ -442,7 +459,7 @@
 		timeval_subtract(&amp;d_inter2, &amp;inter2, &amp;start);
 		timeval_subtract(&amp;d_end, &amp;end, &amp;start);
 
-		LOG_INFO(&quot;inter: %i.%i, inter2: %i.%i end: %i.%i&quot;, d_inter.tv_sec, d_inter.tv_usec, d_inter2.tv_sec, d_inter2.tv_usec, d_end.tv_sec, d_end.tv_usec);
+		LOG_INFO(&quot;inter: %i.%06i, inter2: %i.%06i end: %i.%06i&quot;, d_inter.tv_sec, d_inter.tv_usec, d_inter2.tv_sec, d_inter2.tv_usec, d_end.tv_sec, d_end.tv_usec);
 #endif
 
 
@@ -525,7 +542,7 @@
 				buf_set_u32(&amp;tms_byte, bit_count++, 1, 0x1);
 			else
 			{
-				LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, tap_state_strings[cur_state], tap_state_strings[cmd-&gt;path[state_count]]);
+				LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, jtag_state_name(cur_state), jtag_state_name(cmd-&gt;path[state_count]));
 				exit(-1);
 			}
 
@@ -903,14 +920,14 @@
 	if (type == SCAN_IN)	/* only from device to host */
 	{
 		/* complete bytes */
-		predicted_size += (CEIL(num_bytes, 65536)) * 3;
+		predicted_size += CEIL(num_bytes, 65536) * 3;
 		/* remaining bits - 1 (up to 7) */
 		predicted_size += ((scan_size - 1) % 8) ? 2 : 0;
 	}
 	else					/* host to device, or bidirectional */
 	{
 		/* complete bytes */
-		predicted_size += num_bytes + (CEIL(num_bytes, 65536)) * 3;
+		predicted_size += num_bytes + CEIL(num_bytes, 65536) * 3;
 		/* remaining bits -1 (up to 7) */
 		predicted_size += ((scan_size - 1) % 8) ? 3 : 0;
 	}
@@ -1185,15 +1202,16 @@
 int ft2232_execute_queue()
 {
 	jtag_command_t *cmd = jtag_command_queue; /* currently processed command */
-	jtag_command_t *first_unsent = cmd;	/* next command that has to be sent */
 	u8 *buffer;
 	int scan_size;	/* size of IR or DR scan */
 	enum scan_type type;
 	int i;
 	int predicted_size = 0;
-	int require_send = 0;
 	int retval;
 
+	first_unsent = cmd;			/* next command that has to be sent */
+	require_send = 0;
+
 	/* return ERROR_OK, unless ft2232_send_and_recv reports a failed check
 	 * that wasn't handled by a caller-provided error handler
 	 */
@@ -1214,6 +1232,7 @@
 				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
 					ft2232_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
 				break;
+
 			case JTAG_RESET:
 				/* only send the maximum buffer size that FT2232C can handle */
 				predicted_size = 3;
@@ -1236,6 +1255,7 @@
 				LOG_DEBUG(&quot;trst: %i, srst: %i&quot;, cmd-&gt;cmd.reset-&gt;trst, cmd-&gt;cmd.reset-&gt;srst);
 #endif
 				break;
+
 			case JTAG_RUNTEST:
 				/* only send the maximum buffer size that FT2232C can handle */
 				predicted_size = 0;
@@ -1292,9 +1312,10 @@
 				}
 				require_send = 1;
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;runtest: %i, end in %i&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, end_state);
+				LOG_DEBUG(&quot;runtest: %i, end in %s&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, jtag_state_name(end_state));
 #endif
 				break;
+
 			case JTAG_STATEMOVE:
 				/* only send the maximum buffer size that FT2232C can handle */
 				predicted_size = 3;
@@ -1317,9 +1338,10 @@
 				cur_state = end_state;
 				require_send = 1;
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;statemove: %i&quot;, end_state);
+				LOG_DEBUG(&quot;statemove: %s&quot;, jtag_state_name(end_state));
 #endif
 				break;
+
 			case JTAG_PATHMOVE:
 				/* only send the maximum buffer size that FT2232C can handle */
 				predicted_size = 3 * CEIL(cmd-&gt;cmd.pathmove-&gt;num_states, 7);
@@ -1333,9 +1355,11 @@
 				ft2232_add_pathmove(cmd-&gt;cmd.pathmove);
 				require_send = 1;
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;pathmove: %i states, end in %i&quot;, cmd-&gt;cmd.pathmove-&gt;num_states, cmd-&gt;cmd.pathmove-&gt;path[cmd-&gt;cmd.pathmove-&gt;num_states - 1]);
+				LOG_DEBUG(&quot;pathmove: %i states, end in %s&quot;, cmd-&gt;cmd.pathmove-&gt;num_states,
+					jtag_state_name(cmd-&gt;cmd.pathmove-&gt;path[cmd-&gt;cmd.pathmove-&gt;num_states - 1]));
 #endif
 				break;
+
 			case JTAG_SCAN:
 				scan_size = jtag_build_buffer(cmd-&gt;cmd.scan, &amp;buffer);
 				type = jtag_scan_type(cmd-&gt;cmd.scan);
@@ -1375,18 +1399,45 @@
 				if (buffer)
 					free(buffer);
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;%s scan, %i bit, end in %i&quot;, (cmd-&gt;cmd.scan-&gt;ir_scan) ? &quot;IR&quot; : &quot;DR&quot;, scan_size, end_state);
+				LOG_DEBUG(&quot;%s scan, %i bits, end in %s&quot;, (cmd-&gt;cmd.scan-&gt;ir_scan) ? &quot;IR&quot; : &quot;DR&quot;, scan_size,
+					jtag_state_name(end_state));
 #endif
 				break;
+
 			case JTAG_SLEEP:
 				if (ft2232_send_and_recv(first_unsent, cmd) != ERROR_OK)
 					retval = ERROR_JTAG_QUEUE_FAILED;
 				first_unsent = cmd-&gt;next;
 				jtag_sleep(cmd-&gt;cmd.sleep-&gt;us);
 #ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;sleep %i usec&quot;, cmd-&gt;cmd.sleep-&gt;us);
+				LOG_DEBUG(&quot;sleep %i usec while in %s&quot;, cmd-&gt;cmd.sleep-&gt;us, jtag_state_name(cur_state));
 #endif
 				break;
+
+			case JTAG_STABLECLOCKS:
+				/* &quot;if (tap_move_map[cur_state] != -1)&quot; is of no help when cur_state==TAP_IDLE */
+				switch(cur_state)
+				{
+				case TAP_DRSHIFT:
+				case TAP_IDLE:
+				case TAP_RESET:
+				case TAP_DRPAUSE:
+				case TAP_IRSHIFT:
+				case TAP_IRPAUSE:
+					 break;			/* above stable states are OK */
+				default:
+					 LOG_ERROR( &quot;jtag_add_clocks() was called with TAP in non-stable state \&quot;%s\&quot;&quot;,
+							 jtag_state_name(cur_state) );
+					 retval = ERROR_JTAG_QUEUE_FAILED;
+				}
+
+				if (ft2232_stableclocks(cmd-&gt;cmd.stableclocks-&gt;num_cycles, cmd) != ERROR_OK)
+					retval = ERROR_JTAG_QUEUE_FAILED;
+#ifdef _DEBUG_JTAG_IO_
+				LOG_DEBUG(&quot;clocks %i while in %s&quot;, cmd-&gt;cmd.stableclocks-&gt;num_cycles, jtag_state_name(cur_state));
+#endif
+				break;
+
 			default:
 				LOG_ERROR(&quot;BUG: unknown JTAG command type encountered&quot;);
 				exit(-1);
@@ -1469,7 +1520,7 @@
 			{
 				LOG_ERROR(&quot;ListDevices: %lu\n&quot;, num_devices);
 				for (i = 0; i &lt; num_devices; i++)
-					LOG_ERROR(&quot;%i: %s&quot;, i, desc_array[i]);
+					LOG_ERROR(&quot;%i: \&quot;%s\&quot;&quot;, i, desc_array[i]);
 			}
 
 			for (i = 0; i &lt; num_devices; i++)
@@ -2279,3 +2330,42 @@
 
 	return ERROR_OK;
 }
+
+
+static int ft2232_stableclocks(int num_cycles, jtag_command_t *cmd)
+{
+	int retval = 0;
+
+	while (num_cycles &gt; 0)
+	{
+		/* the command 0x4b, &quot;Clock Data to TMS/CS Pin (no Read)&quot; handles
+		 * at most 7 bits per invocation.  Here we invoke it potentially
+		 * several times.
+		 */
+		int bitcount_per_command = (num_cycles &gt; 7) ? 7 : num_cycles;
+
+		if (ft2232_buffer_size + 3 &gt;= FT2232_BUFFER_SIZE)
+		{
+			if (ft2232_send_and_recv(first_unsent, cmd) != ERROR_OK)
+				retval = ERROR_JTAG_QUEUE_FAILED;
+
+			first_unsent = cmd;
+		}
+
+		/* command &quot;Clock Data to TMS/CS Pin (no Read)&quot; */
+		BUFFER_ADD = 0x4b;
+
+		/* scan 7 bit */
+		BUFFER_ADD = bitcount_per_command - 1;
+
+		/* TMS data bits are all zeros to stay in the current stable state */
+		BUFFER_ADD = 0x0;
+
+		require_send = 1;
+
+		num_cycles -= bitcount_per_command;
+	}
+
+	return retval;
+}
+

Modified: branches/openocd-0.1/src/jtag/gw16012.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/gw16012.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/gw16012.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -240,7 +240,7 @@
 		}
 		else
 		{
-			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, tap_state_strings[cur_state], tap_state_strings[cmd-&gt;path[state_count]]);
+			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, jtag_state_name(cur_state), jtag_state_name(cmd-&gt;path[state_count]));
 			exit(-1);
 		}
 
@@ -438,26 +438,26 @@
 #if PARPORT_USE_GIVEIO == 1
 int gw16012_get_giveio_access()
 {
-    HANDLE h;
-    OSVERSIONINFO version;
+	HANDLE h;
+	OSVERSIONINFO version;
 
-    version.dwOSVersionInfoSize = sizeof version;
-    if (!GetVersionEx( &amp;version )) {
-	errno = EINVAL;
-	return -1;
-    }
-    if (version.dwPlatformId != VER_PLATFORM_WIN32_NT)
-	return 0;
+	version.dwOSVersionInfoSize = sizeof version;
+	if (!GetVersionEx( &amp;version )) {
+		errno = EINVAL;
+		return -1;
+	}
+	if (version.dwPlatformId != VER_PLATFORM_WIN32_NT)
+		return 0;
 
-    h = CreateFile( &quot;\\\\.\\giveio&quot;, GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );
-    if (h == INVALID_HANDLE_VALUE) {
-	errno = ENODEV;
-	return -1;
-    }
+	h = CreateFile( &quot;\\\\.\\giveio&quot;, GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL );
+	if (h == INVALID_HANDLE_VALUE) {
+		errno = ENODEV;
+		return -1;
+	}
 
-    CloseHandle( h );
+	CloseHandle( h );
 
-    return 0;
+	return 0;
 }
 #endif
 

Modified: branches/openocd-0.1/src/jtag/jlink.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/jlink.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/jlink.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -376,7 +376,7 @@
 		}
 		else
 		{
-			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, tap_state_strings[cur_state], tap_state_strings[path[i]]);
+			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, jtag_state_name(cur_state), jtag_state_name(path[i]));
 			exit(-1);
 		}
 

Modified: branches/openocd-0.1/src/jtag/jtag.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/jtag.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/jtag.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -41,14 +41,6 @@
 int jtag_error=ERROR_OK;
 
 
-char* tap_state_strings[16] =
-{
-	&quot;tlr&quot;,
-	&quot;sds&quot;, &quot;cd&quot;, &quot;sd&quot;, &quot;e1d&quot;, &quot;pd&quot;, &quot;e2d&quot;, &quot;ud&quot;,
-	&quot;rti&quot;,
-	&quot;sis&quot;, &quot;ci&quot;, &quot;si&quot;, &quot;e1i&quot;, &quot;pi&quot;, &quot;e2i&quot;, &quot;ui&quot;
-};
-
 typedef struct cmd_queue_page_s
 {
 	void *address;
@@ -87,22 +79,22 @@
 
 tap_transition_t tap_transitions[16] =
 {
-	{TAP_RESET, TAP_IDLE},		/* RESET */
-	{TAP_IRSELECT, TAP_DRCAPTURE},		/* DRSELECT */
-	{TAP_DREXIT1, TAP_DRSHIFT},		/* DRCAPTURE  */
-	{TAP_DREXIT1, TAP_DRSHIFT},		/* DRSHIFT  */
+	{TAP_RESET, 		TAP_IDLE},			/* RESET */
+	{TAP_IRSELECT, 	TAP_DRCAPTURE},		/* DRSELECT */
+	{TAP_DREXIT1,	TAP_DRSHIFT},		/* DRCAPTURE  */
+	{TAP_DREXIT1, 	TAP_DRSHIFT},		/* DRSHIFT  */
 	{TAP_DRUPDATE,  TAP_DRPAUSE}, 		/* DREXIT1 */
-	{TAP_DREXIT2, TAP_DRPAUSE},		/* DRPAUSE  */
+	{TAP_DREXIT2, 	TAP_DRPAUSE},		/* DRPAUSE  */
 	{TAP_DRUPDATE,  TAP_DRSHIFT},		/* DREXIT2 */
-	{TAP_DRSELECT, TAP_IDLE},		/* DRUPDATE  */
-	{TAP_DRSELECT, TAP_IDLE},		/* IDLE */
-	{TAP_RESET, TAP_IRCAPTURE},		/* IRSELECT */
-	{TAP_IREXIT1, TAP_IRSHIFT},		/* IRCAPTURE  */
-	{TAP_IREXIT1, TAP_IRSHIFT},		/* IRSHIFT  */
+	{TAP_DRSELECT, 	TAP_IDLE},			/* DRUPDATE  */
+	{TAP_DRSELECT, 	TAP_IDLE},			/* IDLE */
+	{TAP_RESET, 		TAP_IRCAPTURE},		/* IRSELECT */
+	{TAP_IREXIT1, 	TAP_IRSHIFT},		/* IRCAPTURE  */
+	{TAP_IREXIT1, 	TAP_IRSHIFT},		/* IRSHIFT  */
 	{TAP_IRUPDATE,  TAP_IRPAUSE}, 		/* IREXIT1 */
-	{TAP_IREXIT2, TAP_IRPAUSE},		/* IRPAUSE  */
+	{TAP_IREXIT2, 	TAP_IRPAUSE},		/* IRPAUSE  */
 	{TAP_IRUPDATE,  TAP_IRSHIFT},		/* IREXIT2 */
-	{TAP_DRSELECT, TAP_IDLE}		/* IRUPDATE  */
+	{TAP_DRSELECT, 	TAP_IDLE}			/* IRUPDATE  */
 };
 
 char* jtag_event_strings[] =
@@ -197,6 +189,14 @@
 	extern jtag_interface_t jlink_interface;
 #endif
 
+#if BUILD_VSLLINK == 1
+	extern jtag_interface_t vsllink_interface;
+#endif
+
+#if BUILD_RLINK == 1
+	extern jtag_interface_t rlink_interface;
+#endif
+
 jtag_interface_t *jtag_interfaces[] = {
 #if BUILD_ECOSBOARD == 1
 	&amp;zy1000_interface,
@@ -234,6 +234,12 @@
 #if BUILD_JLINK == 1
 	&amp;jlink_interface,
 #endif
+#if BUILD_VSLLINK == 1
+	&amp;vsllink_interface,
+#endif
+#if BUILD_RLINK == 1
+	&amp;rlink_interface,
+#endif
 	NULL,
 };
 
@@ -243,8 +249,6 @@
 jtag_interface_t *jtag_interface = NULL;
 int jtag_speed = 0;
 
-
-
 /* forward declarations */
 void jtag_add_pathmove(int num_states, enum tap_state *path);
 void jtag_add_runtest(int num_cycles, enum tap_state endstate);
@@ -272,14 +276,12 @@
 
 int handle_verify_ircapture_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
-
 jtag_tap_t *jtag_AllTaps(void)
 {
-  return jtag_all_taps;
+	return jtag_all_taps;
 };
 
-int
-jtag_NumTotalTaps(void)
+int jtag_NumTotalTaps(void)
 {
 	jtag_tap_t *t;
 	int n;
@@ -293,8 +295,7 @@
 	return n;
 }
 
-int
-jtag_NumEnabledTaps(void)
+int jtag_NumEnabledTaps(void)
 {
 	jtag_tap_t *t;
 	int n;
@@ -338,8 +339,7 @@
 	return t;
 }
 
-jtag_tap_t *
-jtag_TapByJimObj( Jim_Interp *interp, Jim_Obj *o )
+jtag_tap_t * jtag_TapByJimObj( Jim_Interp *interp, Jim_Obj *o )
 {
 	jtag_tap_t *t;
 	const char *cp;
@@ -358,8 +358,7 @@
 }
 
 /* returns a pointer to the n-th device in the scan chain */
-jtag_tap_t *
-jtag_TapByAbsPosition( int n )
+jtag_tap_t * jtag_TapByAbsPosition( int n )
 {
 	int orig_n;
 	jtag_tap_t *t;
@@ -370,11 +369,10 @@
 	while( t &amp;&amp; (n &gt; 0)) {
 		n--;
 		t = t-&gt;next_tap;
-    }
+	}
 	return t;
 }
 
-
 int jtag_register_event_callback(int (*callback)(enum jtag_event event, void *priv), void *priv)
 {
 	jtag_event_callback_t **callbacks_p = &amp;jtag_event_callbacks;
@@ -456,7 +454,6 @@
 	return last_comand_pointer;
 }
 
-
 void* cmd_queue_alloc(size_t size)
 {
 	cmd_queue_page_t **p_page = &amp;cmd_queue_pages;
@@ -484,18 +481,17 @@
 	 *
 	 */
 	union worse_case_align {
-	  int i;
-	  long l;
-	  float f;
-	  void *v;
+		int i;
+		long l;
+		float f;
+		void *v;
 	};
 #define ALIGN_SIZE  (sizeof(union worse_case_align))
 
-	// The alignment process.
+	/* The alignment process. */
 	size = (size + ALIGN_SIZE -1) &amp; (~(ALIGN_SIZE-1));
-	// Done...
+	/* Done... */
 
-
 	if (*p_page)
 	{
 		while ((*p_page)-&gt;next)
@@ -645,7 +641,6 @@
 			(*last_cmd)-&gt;cmd.scan-&gt;fields[nth_tap].out_value = buf_set_ones(cmd_queue_alloc(CEIL(scan_size, 8)), scan_size);
 			(*last_cmd)-&gt;cmd.scan-&gt;fields[nth_tap].out_mask = NULL;
 			tap-&gt;bypass = 1;
-
 		}
 
 		/* update device information */
@@ -967,7 +962,7 @@
 		jtag_error=retval;
 }
 
-int MINIDRIVER(interface_jtag_add_tlr)()
+int MINIDRIVER(interface_jtag_add_tlr)(void)
 {
 	enum tap_state state = TAP_RESET;
 	jtag_command_t **last_cmd = jtag_get_last_command_p();
@@ -981,7 +976,6 @@
 	(*last_cmd)-&gt;cmd.statemove = cmd_queue_alloc(sizeof(statemove_command_t));
 	(*last_cmd)-&gt;cmd.statemove-&gt;end_state = state;
 
-
 	return ERROR_OK;
 }
 
@@ -1008,7 +1002,7 @@
 		if ((tap_transitions[cur_state].low != path[i])&amp;&amp;
 				(tap_transitions[cur_state].high != path[i]))
 		{
-			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, tap_state_strings[cur_state], tap_state_strings[path[i]]);
+			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, jtag_state_name(cur_state), jtag_state_name(path[i]));
 			exit(-1);
 		}
 		cur_state = path[i];
@@ -1016,7 +1010,6 @@
 
 	jtag_prelude1();
 
-
 	retval=interface_jtag_add_pathmove(num_states, path);
 	cmd_queue_cur_state = path[num_states - 1];
 	if (retval!=ERROR_OK)
@@ -1073,6 +1066,33 @@
 		jtag_error=retval;
 }
 
+
+int MINIDRIVER(interface_jtag_add_clocks)( int num_cycles )
+{
+	jtag_command_t **last_cmd = jtag_get_last_command_p();
+
+	/* allocate memory for a new list member */
+	*last_cmd = cmd_queue_alloc(sizeof(jtag_command_t));
+	(*last_cmd)-&gt;next = NULL;
+	last_comand_pointer = &amp;((*last_cmd)-&gt;next);
+	(*last_cmd)-&gt;type = JTAG_STABLECLOCKS;
+
+	(*last_cmd)-&gt;cmd.stableclocks = cmd_queue_alloc(sizeof(stableclocks_command_t));
+	(*last_cmd)-&gt;cmd.stableclocks-&gt;num_cycles = num_cycles;
+	return ERROR_OK;
+}
+
+void jtag_add_clocks( int num_cycles )
+{
+	int retval;
+
+	jtag_prelude1();
+
+	retval=interface_jtag_add_clocks(num_cycles);
+	if (retval!=ERROR_OK)
+		jtag_error=retval;
+}
+
 void jtag_add_reset(int req_tlr_or_trst, int req_srst)
 {
 	int trst_with_tlr = 0;
@@ -1251,6 +1271,10 @@
 
 	bit_count = 0;
 
+#ifdef _DEBUG_JTAG_IO_
+	LOG_DEBUG(&quot;num_fields: %i&quot;,cmd-&gt;num_fields);
+#endif
+
 	for (i = 0; i &lt; cmd-&gt;num_fields; i++)
 	{
 		if (cmd-&gt;fields[i].out_value)
@@ -1260,12 +1284,15 @@
 #endif
 			buf_set_buf(cmd-&gt;fields[i].out_value, 0, *buffer, bit_count, cmd-&gt;fields[i].num_bits);
 #ifdef _DEBUG_JTAG_IO_
-			LOG_DEBUG(&quot;fields[%i].out_value: 0x%s&quot;, i, char_buf);
+			LOG_DEBUG(&quot;fields[%i].out_value[%i]: 0x%s&quot;, i, cmd-&gt;fields[i].num_bits, char_buf);
 			free(char_buf);
 #endif
 		}
 
 		bit_count += cmd-&gt;fields[i].num_bits;
+#ifdef _DEBUG_JTAG_IO_
+		LOG_DEBUG(&quot;bit_count totalling: %i&quot;,  bit_count );
+#endif
 	}
 
 	return bit_count;
@@ -1291,10 +1318,8 @@
 			u8 *captured = buf_set_buf(buffer, bit_count, malloc(CEIL(num_bits, 8)), 0, num_bits);
 
 #ifdef _DEBUG_JTAG_IO_
-			char *char_buf;
-
-			char_buf = buf_to_str(captured, (num_bits &gt; 64) ? 64 : num_bits, 16);
-			LOG_DEBUG(&quot;fields[%i].in_value: 0x%s&quot;, i, char_buf);
+			char *char_buf = buf_to_str(captured, (num_bits &gt; 64) ? 64 : num_bits, 16);
+			LOG_DEBUG(&quot;fields[%i].in_value[%i]: 0x%s&quot;, i, num_bits, char_buf);
 			free(char_buf);
 #endif
 
@@ -1306,7 +1331,7 @@
 				{
 					if (cmd-&gt;fields[i].in_handler(cmd-&gt;fields[i].in_value, cmd-&gt;fields[i].in_handler_priv, cmd-&gt;fields+i) != ERROR_OK)
 					{
-						LOG_WARNING(&quot;in_handler reported a failed check&quot;);
+						LOG_WARNING(&quot;in_handler: with \&quot;in_value\&quot;, mismatch in %s&quot;, cmd-&gt;ir_scan ? &quot;SIR&quot; : &quot;SDR&quot; );
 						retval = ERROR_JTAG_QUEUE_FAILED;
 					}
 				}
@@ -1320,7 +1345,7 @@
 					/* We're going to call the error:handler later, but if the in_handler
 					 * reported an error we report this failure upstream
 					 */
-					LOG_WARNING(&quot;in_handler reported a failed check&quot;);
+					LOG_WARNING(&quot;in_handler: w/o \&quot;in_value\&quot;, mismatch in %s&quot;,  cmd-&gt;ir_scan ? &quot;SIR&quot; : &quot;SDR&quot; );
 					retval = ERROR_JTAG_QUEUE_FAILED;
 				}
 			}
@@ -1333,6 +1358,11 @@
 	return retval;
 }
 
+static const char *jtag_tap_name(jtag_tap_t *tap)
+{
+	return (tap == NULL) ? &quot;(unknown)&quot; : tap-&gt;dotted_name;
+}
+
 int jtag_check_value(u8 *captured, void *priv, scan_field_t *field)
 {
 	int retval = ERROR_OK;
@@ -1351,7 +1381,7 @@
 		 * acknowledged the error
 		 */
 		LOG_WARNING(&quot;TAP %s:&quot;,
-					(field-&gt;tap == NULL) ? &quot;(unknown)&quot; : field-&gt;tap-&gt;dotted_name );
+					jtag_tap_name(field-&gt;tap));
 		if (compare_failed)
 		{
 			char *captured_char = buf_to_str(captured, (num_bits &gt; 64) ? 64 : num_bits, 16);
@@ -1667,17 +1697,18 @@
 
 	tap = NULL;
 	chain_pos = 0;
+	int val;
 	for(;;){
 		tap = jtag_NextEnabledTap(tap);
 		if( tap == NULL ){
 			break;
 		}
 
-
-		if (buf_get_u32(ir_test, chain_pos, 2) != 0x1)
+		val = buf_get_u32(ir_test, chain_pos, 2);
+		if (val != 0x1)
 		{
 			char *cbuf = buf_to_str(ir_test, total_ir_length, 16);
-			LOG_ERROR(&quot;Error validating JTAG scan chain, IR mismatch, scan returned 0x%s&quot;, cbuf);
+			LOG_ERROR(&quot;Could not validate JTAG scan chain, IR mismatch, scan returned 0x%s. tap=%s pos=%d expected 0x1 got %0x&quot;, cbuf, jtag_tap_name(tap), chain_pos, val);
 			free(cbuf);
 			free(ir_test);
 			return ERROR_JTAG_INIT_FAILED;
@@ -1685,10 +1716,11 @@
 		chain_pos += tap-&gt;ir_length;
 	}
 
-	if (buf_get_u32(ir_test, chain_pos, 2) != 0x3)
+	val = buf_get_u32(ir_test, chain_pos, 2);
+	if (val != 0x3)
 	{
 		char *cbuf = buf_to_str(ir_test, total_ir_length, 16);
-		LOG_ERROR(&quot;Error validating JTAG scan chain, IR mismatch, scan returned 0x%s&quot;, cbuf);
+		LOG_ERROR(&quot;Could not validate end of JTAG scan chain, IR mismatch, scan returned 0x%s. pos=%d expected 0x3 got %0x&quot;, cbuf, chain_pos, val);
 		free(cbuf);
 		free(ir_test);
 		return ERROR_JTAG_INIT_FAILED;
@@ -1701,8 +1733,96 @@
 
 
 static int
-jim_newtap_cmd( Jim_GetOptInfo *goi )
+jtag_tap_configure_cmd( Jim_GetOptInfo *goi,
+		jtag_tap_t * tap)
 {
+	Jim_Nvp *n;
+	Jim_Obj *o;
+	int e;
+
+	/* parse config or cget options */
+	while (goi-&gt;argc &gt; 0) {
+		Jim_SetEmptyResult (goi-&gt;interp);
+
+		e = Jim_GetOpt_Nvp(goi, nvp_config_opts, &amp;n);
+		if (e != JIM_OK) {
+			Jim_GetOpt_NvpUnknown(goi, nvp_config_opts, 0);
+			return e;
+		}
+
+		switch (n-&gt;value) {
+			case JCFG_EVENT:
+				if (goi-&gt;argc == 0) {
+					Jim_WrongNumArgs( goi-&gt;interp, goi-&gt;argc, goi-&gt;argv, &quot;-event ?event-name? ...&quot; );
+					return JIM_ERR;
+				}
+
+				e = Jim_GetOpt_Nvp( goi, nvp_jtag_tap_event, &amp;n );
+				if (e != JIM_OK) {
+					Jim_GetOpt_NvpUnknown(goi, nvp_jtag_tap_event, 1);
+					return e;
+				}
+
+				if (goi-&gt;isconfigure) {
+					if (goi-&gt;argc != 1) {
+						Jim_WrongNumArgs(goi-&gt;interp, goi-&gt;argc, goi-&gt;argv, &quot;-event ?event-name? ?EVENT-BODY?&quot;);
+						return JIM_ERR;
+					}
+				} else {
+					if (goi-&gt;argc != 0) {
+						Jim_WrongNumArgs(goi-&gt;interp, goi-&gt;argc, goi-&gt;argv, &quot;-event ?event-name?&quot;);
+						return JIM_ERR;
+					}
+				}
+
+				{
+					jtag_tap_event_action_t *jteap;
+
+					jteap = tap-&gt;event_action;
+					/* replace existing? */
+					while (jteap) {
+						if (jteap-&gt;event == n-&gt;value) {
+							break;
+						}
+						jteap = jteap-&gt;next;
+					}
+
+					if (goi-&gt;isconfigure) {
+						if (jteap == NULL) {
+							/* create new */
+							jteap = calloc(1, sizeof (*jteap));
+						}
+						jteap-&gt;event = n-&gt;value;
+						Jim_GetOpt_Obj( goi, &amp;o);
+						if (jteap-&gt;body) {
+							Jim_DecrRefCount(interp, jteap-&gt;body);
+						}
+						jteap-&gt;body = Jim_DuplicateObj(goi-&gt;interp, o);
+						Jim_IncrRefCount(jteap-&gt;body);
+
+						/* add to head of event list */
+						jteap-&gt;next = tap-&gt;event_action;
+						tap-&gt;event_action = jteap;
+						Jim_SetEmptyResult(goi-&gt;interp);
+					} else {
+						/* get */
+						if (jteap == NULL) {
+							Jim_SetEmptyResult(goi-&gt;interp);
+						} else {
+							Jim_SetResult(goi-&gt;interp, Jim_DuplicateObj(goi-&gt;interp, jteap-&gt;body));
+						}
+					}
+				}
+				/* loop for more */
+				break;
+		}
+	} /* while (goi-&gt;argc) */
+
+	return JIM_OK;
+}
+
+static int jim_newtap_cmd( Jim_GetOptInfo *goi )
+{
 	jtag_tap_t *pTap;
 	jtag_tap_t **ppTap;
 	jim_wide w;
@@ -1719,24 +1839,23 @@
 #define NTAP_OPT_IRCAPTURE 2
 		{ .name = &quot;-ircapture&quot;		,	.value = NTAP_OPT_IRCAPTURE },
 #define NTAP_OPT_ENABLED   3
-		{ .name = &quot;-enable&quot;			,   .value = NTAP_OPT_ENABLED },
+		{ .name = &quot;-enable&quot;			,	.value = NTAP_OPT_ENABLED },
 #define NTAP_OPT_DISABLED  4
-		{ .name = &quot;-disable&quot;		,   .value = NTAP_OPT_DISABLED },
+		{ .name = &quot;-disable&quot;		,	.value = NTAP_OPT_DISABLED },
 #define NTAP_OPT_EXPECTED_ID 5
-		{ .name = &quot;-expected-id&quot;	,   .value = NTAP_OPT_EXPECTED_ID },
-		{ .name = NULL				,   .value = -1 },
+		{ .name = &quot;-expected-id&quot;	,	.value = NTAP_OPT_EXPECTED_ID },
+		{ .name = NULL				,	.value = -1 },
 	};
 
-
 	pTap = malloc( sizeof(jtag_tap_t) );
 	memset( pTap, 0, sizeof(*pTap) );
 	if( !pTap ){
 		Jim_SetResult_sprintf( goi-&gt;interp, &quot;no memory&quot;);
 		return JIM_ERR;
 	}
-	//
-	// we expect CHIP + TAP + OPTIONS
-	//
+	/*
+	 * we expect CHIP + TAP + OPTIONS
+	 * */
 	if( goi-&gt;argc &lt; 3 ){
 		Jim_SetResult_sprintf(goi-&gt;interp, &quot;Missing CHIP TAP OPTIONS ....&quot;);
 		return JIM_ERR;
@@ -1747,7 +1866,7 @@
 	Jim_GetOpt_String( goi, &amp;cp, NULL );
 	pTap-&gt;tapname = strdup(cp);
 
-	// name + dot + name + null
+	/* name + dot + name + null */
 	x = strlen(pTap-&gt;chip) + 1 + strlen(pTap-&gt;tapname) + 1;
 	cp = malloc( x );
 	sprintf( cp, &quot;%s.%s&quot;, pTap-&gt;chip, pTap-&gt;tapname );
@@ -1756,16 +1875,15 @@
 	LOG_DEBUG(&quot;Creating New Tap, Chip: %s, Tap: %s, Dotted: %s, %d params&quot;,
 			  pTap-&gt;chip, pTap-&gt;tapname, pTap-&gt;dotted_name, goi-&gt;argc);
 
-
-	// default is enabled
+	/* default is enabled */
 	pTap-&gt;enabled = 1;
 
-	// deal with options
+	/* deal with options */
 #define NTREQ_IRLEN      1
 #define NTREQ_IRCAPTURE  2
 #define NTREQ_IRMASK     4
 
-	// clear them as we find them
+	/* clear them as we find them */
 	reqbits = (NTREQ_IRLEN | NTREQ_IRCAPTURE | NTREQ_IRMASK);
 
 	while( goi-&gt;argc ){
@@ -1816,7 +1934,7 @@
 				return e;
 			}
 			if( (w &lt; 0) || (w &gt; 0xffff) ){
-				// wacky value
+				/* wacky value */
 				Jim_SetResult_sprintf( goi-&gt;interp, &quot;option: %s - wacky value: %d (0x%x)&quot;,
 									   n-&gt;name, (int)(w), (int)(w));
 				return JIM_ERR;
@@ -1835,17 +1953,17 @@
 				reqbits &amp;= (~(NTREQ_IRCAPTURE));
 				break;
 			}
-		} // switch(n-&gt;value)
-	} // while( goi-&gt;argc )
+		} /* switch(n-&gt;value) */
+	} /* while( goi-&gt;argc ) */
 
-	// Did we get all the options?
+	/* Did we get all the options? */
 	if( reqbits ){
 		// no
 		Jim_SetResult_sprintf( goi-&gt;interp,
 							   &quot;newtap: %s missing required parameters&quot;,
 							   pTap-&gt;dotted_name);
-		// fixme: Tell user what is missing :-(
-		// no memory leaks pelase
+		/* TODO: Tell user what is missing :-( */
+		/* no memory leaks pelase */
 		free(((void *)(pTap-&gt;expected_ids)));
 		free(((void *)(pTap-&gt;chip)));
 		free(((void *)(pTap-&gt;tapname)));
@@ -1871,7 +1989,6 @@
 
 	pTap-&gt;bypass = 1;
 
-
 	jtag_register_event_callback(jtag_reset_callback, pTap );
 
 	ppTap = &amp;(jtag_all_taps);
@@ -1884,19 +2001,16 @@
 		pTap-&gt;abs_chain_position = n_taps++;
 	}
 	LOG_DEBUG( &quot;Created Tap: %s @ abs position %d, irlen %d, capture: 0x%x mask: 0x%x&quot;,
-			   (*ppTap)-&gt;dotted_name,
-			   (*ppTap)-&gt;abs_chain_position,
-			   (*ppTap)-&gt;ir_length,
-			   (*ppTap)-&gt;ir_capture_value,
-			   (*ppTap)-&gt;ir_capture_mask );
+				(*ppTap)-&gt;dotted_name,
+				(*ppTap)-&gt;abs_chain_position,
+				(*ppTap)-&gt;ir_length,
+				(*ppTap)-&gt;ir_capture_value,
+				(*ppTap)-&gt;ir_capture_mask );
 
-
 	return ERROR_OK;
 }
 
-
-static int
-jim_jtag_command( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
+static int jim_jtag_command( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
 {
 	Jim_GetOptInfo goi;
 	int e;
@@ -1924,7 +2038,7 @@
 	};
 
 	context = Jim_GetAssocData(interp, &quot;context&quot;);
-	// go past the command
+	/* go past the command */
 	Jim_GetOpt_Setup( &amp;goi, interp, argc-1, argv+1 );
 
 	e = Jim_GetOpt_Nvp( &amp;goi, jtag_cmds, &amp;n );
@@ -1935,9 +2049,9 @@
 		Jim_SetEmptyResult( goi.interp );
 	switch( n-&gt;value ){
 	case JTAG_CMD_INTERFACE:
-		// return the name of the interface
-		// TCL code might need to know the exact type...
-		// FUTURE: we allow this as a means to &quot;set&quot; the interface.
+		/* return the name of the interface */
+		/* TCL code might need to know the exact type... */
+		/* FUTURE: we allow this as a means to &quot;set&quot; the interface. */
 		if( goi.argc != 0 ){
 			Jim_WrongNumArgs( goi.interp, 1, goi.argv-1, &quot;(no params)&quot;);
 			return JIM_ERR;
@@ -1974,7 +2088,7 @@
 			}
 			switch( n-&gt;value ){
 			case JTAG_CMD_TAPISENABLED:
-				// below
+				e = t-&gt;enabled;
 				break;
 			case JTAG_CMD_TAPENABLE:
 				e = 1;
@@ -1990,7 +2104,6 @@
 		}
 	}
 
-
 	return JIM_ERR;
 }
 
@@ -2007,7 +2120,8 @@
 	register_command(cmd_ctx, NULL, &quot;jtag_device&quot;, handle_jtag_device_command,
 		COMMAND_CONFIG, &quot;jtag_device &lt;ir_length&gt; &lt;ir_expected&gt; &lt;ir_mask&gt;&quot;);
 	register_command(cmd_ctx, NULL, &quot;reset_config&quot;, handle_reset_config_command,
-		COMMAND_CONFIG, NULL);
+		COMMAND_ANY,
+		&quot;[none/trst_only/srst_only/trst_and_srst] [srst_pulls_trst/trst_pulls_srst] [combined/separate] [trst_push_pull/trst_open_drain] [srst_push_pull/srst_open_drain]&quot;);
 	register_command(cmd_ctx, NULL, &quot;jtag_nsrst_delay&quot;, handle_jtag_nsrst_delay_command,
 		COMMAND_ANY, &quot;jtag_nsrst_delay &lt;ms&gt; - delay after deasserting srst in ms&quot;);
 	register_command(cmd_ctx, NULL, &quot;jtag_ntrst_delay&quot;, handle_jtag_ntrst_delay_command,
@@ -2051,8 +2165,6 @@
 	if (jtag_interface-&gt;init() != ERROR_OK)
 		return ERROR_JTAG_INIT_FAILED;
 
-
-
 	jtag = jtag_interface;
 	return ERROR_OK;
 }
@@ -2064,7 +2176,6 @@
 
 	LOG_DEBUG(&quot;Init JTAG chain&quot;);
 
-
 	tap = jtag_NextEnabledTap(NULL);
 	if( tap == NULL ){
 		LOG_ERROR(&quot;There are no enabled taps?&quot;);
@@ -2083,7 +2194,7 @@
 
 	if (jtag_validate_chain() != ERROR_OK)
 	{
-		LOG_ERROR(&quot;Could not validate JTAG chain, continuing anyway...&quot;);
+		LOG_WARNING(&quot;Could not validate JTAG chain, continuing anyway...&quot;);
 	}
 
 	return ERROR_OK;
@@ -2238,14 +2349,14 @@
 	int e;
 	char buf[1024];
 	Jim_Obj *newargs[ 10 ];
-	//
-	// CONVERT SYNTAX
-	//
-	//   argv[-1] = command
-	//   argv[ 0] = ir length
-	//   argv[ 1] = ir capture
-	//   argv[ 2] = ir mask
-	//   argv[ 3] = not actually used by anything but in the docs
+	/*
+	 * CONVERT SYNTAX
+	 * argv[-1] = command
+	 * argv[ 0] = ir length
+	 * argv[ 1] = ir capture
+	 * argv[ 2] = ir mask
+	 * argv[ 3] = not actually used by anything but in the docs
+	 */
 
 	if( argc &lt; 4 ){
 		command_print( cmd_ctx, &quot;OLD DEPRECATED SYNTAX: Please use the NEW syntax&quot;);
@@ -2261,8 +2372,6 @@
 	command_print( cmd_ctx, &quot;jtag newtap stm32 boundry  ....., and the tap: \&quot;stm32.boundery\&quot;&quot;);
 	command_print( cmd_ctx, &quot;And then refer to the taps by the dotted name.&quot;);
 
-
-
 	newargs[0] = Jim_NewStringObj( interp, &quot;jtag&quot;, -1   );
 	newargs[1] = Jim_NewStringObj( interp, &quot;newtap&quot;, -1 );
 	sprintf( buf, &quot;chip%d&quot;, jtag_NumTotalTaps() );
@@ -2289,8 +2398,6 @@
 			 Jim_GetString( newargs[8], NULL ),
 			 Jim_GetString( newargs[9], NULL ) );
 
-
-
 	e = jim_jtag_command( interp, 10, newargs );
 	if( e != JIM_OK ){
 		command_print( cmd_ctx, &quot;%s&quot;, Jim_GetString( Jim_GetResult(interp), NULL ) );
@@ -2298,7 +2405,6 @@
 	return e;
 }
 
-
 int handle_scan_chain_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	jtag_tap_t *tap;
@@ -2532,14 +2638,14 @@
 	{
 		for (state = 0; state &lt; 16; state++)
 		{
-			if (strcmp(args[0], tap_state_strings[state]) == 0)
+			if (strcmp(args[0], jtag_state_name(state)) == 0)
 			{
 				jtag_add_end_state(state);
 				jtag_execute_queue();
 			}
 		}
 	}
-	command_print(cmd_ctx, &quot;current endstate: %s&quot;, tap_state_strings[cmd_queue_end_state]);
+	command_print(cmd_ctx, &quot;current endstate: %s&quot;, jtag_state_name(cmd_queue_end_state));
 
 	return ERROR_OK;
 }
@@ -2683,7 +2789,6 @@
 		Jim_GetLong(interp, args[i], &amp;bits);
 		str = Jim_GetString(args[i+1], &amp;len);
 
-
 		fields[field_count].tap = tap;
 		fields[field_count].num_bits = bits;
 		fields[field_count].out_value = malloc(CEIL(bits, 8));
@@ -2752,7 +2857,6 @@
 	return ERROR_OK;
 }
 
-
 int jtag_power_dropout(int *dropout)
 {
 	return jtag-&gt;power_dropout(dropout);
@@ -2763,3 +2867,64 @@
 	return jtag-&gt;srst_asserted(srst_asserted);
 }
 
+void jtag_tap_handle_event( jtag_tap_t * tap, enum jtag_tap_event e)
+{
+	jtag_tap_event_action_t * jteap;
+	int done;
+
+	jteap = tap-&gt;event_action;
+
+	done = 0;
+	while (jteap) {
+		if (jteap-&gt;event == e) {
+			done = 1;
+			LOG_DEBUG( &quot;JTAG tap: %s event: %d (%s) action: %s\n&quot;,
+					tap-&gt;dotted_name,
+					e,
+					Jim_Nvp_value2name_simple(nvp_jtag_tap_event, e)-&gt;name,
+					Jim_GetString(jteap-&gt;body, NULL) );
+			if (Jim_EvalObj(interp, jteap-&gt;body) != JIM_OK) {
+				Jim_PrintErrorMessage(interp);
+			}
+		}
+
+		jteap = jteap-&gt;next;
+	}
+
+	if (!done) {
+		LOG_DEBUG( &quot;event %d %s - no action&quot;,
+				e,
+				Jim_Nvp_value2name_simple( nvp_jtag_tap_event, e)-&gt;name);
+	}
+}
+
+
+/* map state number to SVF state string */
+const char* jtag_state_name(enum tap_state state)
+{
+	const char* ret;
+
+	switch( state )
+	{
+	case TAP_RESET:		ret = &quot;RESET&quot;;			break;
+	case TAP_IDLE:		ret = &quot;IDLE&quot;;			break;
+	case TAP_DRSELECT:	ret = &quot;DRSELECT&quot;;		break;
+	case TAP_DRCAPTURE: ret = &quot;DRCAPTURE&quot;;		break;
+	case TAP_DRSHIFT:	ret = &quot;DRSHIFT&quot;;			break;
+	case TAP_DREXIT1:	ret = &quot;DREXIT1&quot;;			break;
+	case TAP_DRPAUSE:	ret = &quot;DRPAUSE&quot;;			break;
+	case TAP_DREXIT2:	ret = &quot;DREXIT2&quot;;			break;
+	case TAP_DRUPDATE:	ret = &quot;DRUPDATE&quot;;		break;
+	case TAP_IRSELECT:	ret = &quot;IRSELECT&quot;;		break;
+	case TAP_IRCAPTURE: ret = &quot;IRCAPTURE&quot;;		break;
+	case TAP_IRSHIFT:	ret = &quot;IRSHIFT&quot;;			break;
+	case TAP_IREXIT1:	ret = &quot;IREXIT1&quot;;			break;
+	case TAP_IRPAUSE:	ret = &quot;IRPAUSE&quot;;			break;
+	case TAP_IREXIT2:	ret = &quot;IREXIT2&quot;;			break;
+	case TAP_IRUPDATE:	ret = &quot;IRUPDATE&quot;;		break;
+	default:				ret = &quot;???&quot;;
+	}
+
+	return ret;
+}
+

Modified: branches/openocd-0.1/src/jtag/jtag.h
===================================================================
--- branches/openocd_1_0_branch/src/jtag/jtag.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/jtag.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -29,20 +29,21 @@
 
 #include &quot;command.h&quot;
 
+
 #if 0
 #define _DEBUG_JTAG_IO_
 #endif
 
 /* 16 Tap States, from page 21 of ASSET InterTech, Inc.'s svf.pdf
  */
-enum tap_state
+typedef enum tap_state
 {
 	TAP_RESET = 0x0, TAP_IDLE = 0x8,
 	TAP_DRSELECT = 0x1, TAP_DRCAPTURE = 0x2, TAP_DRSHIFT = 0x3, TAP_DREXIT1 = 0x4,
 	TAP_DRPAUSE = 0x5, TAP_DREXIT2 = 0x6, TAP_DRUPDATE = 0x7,
 	TAP_IRSELECT = 0x9, TAP_IRCAPTURE = 0xa, TAP_IRSHIFT = 0xb, TAP_IREXIT1 = 0xc,
 	TAP_IRPAUSE = 0xd, TAP_IREXIT2 = 0xe, TAP_IRUPDATE = 0xf
-};
+} tap_state_t;
 
 typedef struct tap_transition_s
 {
@@ -50,7 +51,6 @@
 	enum tap_state low;
 } tap_transition_t;
 
-extern char* tap_state_strings[16];
 extern int tap_move_map[16];	/* map 16 TAP states to 6 stable states */
 extern u8 tap_move[6][6];		/* value scanned to TMS to move from one of six stable states to another */
 extern tap_transition_t tap_transitions[16];	/* describe the TAP state diagram */
@@ -78,11 +78,10 @@
 	/* in_check_value/mask, in_handler_error_handler, in_handler_priv can be used by the in handler, otherwise they contain garbage  */
 	u8 *in_check_value;	/* used to validate scan results */
 	u8 *in_check_mask;	/* check specified bits against check_value */
-	in_handler_t in_handler;	    /* process received buffer using this handler */
+	in_handler_t in_handler;/* process received buffer using this handler */
 	void *in_handler_priv;	/* additional information for the in_handler */
 } scan_field_t;
 
-
 enum scan_type
 {
 	/* IN: from device to host, OUT: from host to device */
@@ -114,6 +113,13 @@
 	enum tap_state end_state;	/* TAP state in which JTAG commands should finish */
 } runtest_command_t;
 
+
+typedef struct stableclocks_command_s
+{
+	int num_cycles;				/* number of clock cycles that should be sent */
+} stableclocks_command_t;
+
+
 typedef struct reset_command_s
 {
 	int trst;			/* trst/srst 0: deassert, 1: assert, -1: don't change */
@@ -136,6 +142,7 @@
 	statemove_command_t *statemove;
 	pathmove_command_t *pathmove;
 	runtest_command_t *runtest;
+	stableclocks_command_t *stableclocks;
 	reset_command_t *reset;
 	end_state_command_t *end_state;
 	sleep_command_t *sleep;
@@ -146,7 +153,8 @@
 	JTAG_SCAN = 1,
 	JTAG_STATEMOVE = 2, JTAG_RUNTEST = 3,
 	JTAG_RESET = 4, JTAG_END_STATE = 5,
-	JTAG_PATHMOVE = 6, JTAG_SLEEP = 7
+	JTAG_PATHMOVE = 6, JTAG_SLEEP = 7,
+	JTAG_STABLECLOCKS = 8
 };
 
 typedef struct jtag_command_s
@@ -158,9 +166,12 @@
 
 extern jtag_command_t *jtag_command_queue;
 
-// this is really: typedef jtag_tap_t
-// But - the typedef is done in &quot;types.h&quot;
-// due to &quot;forward decloration reasons&quot;
+/* forward declaration */
+typedef struct jtag_tap_event_action_s jtag_tap_event_action_t;
+
+/* this is really: typedef jtag_tap_t */
+/* But - the typedef is done in &quot;types.h&quot; */
+/* due to &quot;forward decloration reasons&quot; */
 struct jtag_tap_s
 {
 	const char *chip;
@@ -182,22 +193,21 @@
 };
 extern jtag_tap_t *jtag_AllTaps(void);
 extern jtag_tap_t *jtag_TapByPosition(int n);
-extern jtag_tap_t *jtag_TapByPosition( int n );
-extern jtag_tap_t *jtag_TapByString( const char *dotted_name );
-extern jtag_tap_t *jtag_TapByJimObj( Jim_Interp *interp, Jim_Obj *obj );
-extern jtag_tap_t *jtag_TapByAbsPosition( int abs_position );
-extern int         jtag_NumEnabledTaps(void);
-extern int         jtag_NumTotalTaps(void);
+extern jtag_tap_t *jtag_TapByPosition(int n);
+extern jtag_tap_t *jtag_TapByString(const char *dotted_name);
+extern jtag_tap_t *jtag_TapByJimObj(Jim_Interp *interp, Jim_Obj *obj);
+extern jtag_tap_t *jtag_TapByAbsPosition(int abs_position);
+extern int jtag_NumEnabledTaps(void);
+extern int jtag_NumTotalTaps(void);
 
-
 static __inline__ jtag_tap_t *
 jtag_NextEnabledTap( jtag_tap_t *p )
 {
 	if( p == NULL ){
-		// start at the head of list
+		/* start at the head of list */
 		p = jtag_AllTaps();
 	} else {
-		// start *after* this one
+		/* start *after* this one */
 		p = p-&gt;next_tap;
 	}
 	while( p ){
@@ -210,9 +220,6 @@
 	return p;
 }
 
-
-
-
 enum reset_line_mode
 {
 	LINE_OPEN_DRAIN = 0x0,
@@ -421,7 +428,15 @@
 extern int interface_jtag_add_sleep(u32 us);
 
 
+/**
+ * Function jtag_add_stable_clocks
+ * first checks that the state in which the clocks are to be issued is
+ * stable, then queues up clock_count clocks for transmission.
+ */
+void jtag_add_clocks( int num_cycles );
+int interface_jtag_add_clocks( int num_cycles );
 
+
 /*
  * For software FIFO implementations, the queued commands can be executed
  * during this call or earlier. A sw queue might decide to push out
@@ -448,7 +463,6 @@
 extern int jtag_power_dropout(int *dropout);
 extern int jtag_srst_asserted(int *srst_asserted);
 
-
 /* JTAG support functions */
 extern void jtag_set_check_value(scan_field_t *field, u8 *value,  u8 *mask, error_handler_t *in_error_handler);
 extern enum scan_type jtag_scan_type(scan_command_t *cmd);
@@ -472,8 +486,6 @@
 #define ERROR_JTAG_QUEUE_FAILED			(-104)
 #define ERROR_JTAG_DEVICE_ERROR			(-107)
 
-
-
 /* this allows JTAG devices to implement the entire jtag_xxx() layer in hw/sw */
 #ifdef HAVE_JTAG_MINIDRIVER_H
 /* Here a #define MINIDRIVER() and an inline version of hw fifo interface_jtag_add_dr_out can be defined */
@@ -505,9 +517,6 @@
 		enum tap_state end_state);
 #endif
 
-
-
-
 static __inline__ void jtag_add_dr_out(jtag_tap_t *tap,
 		int num_fields,
 		const int *num_bits,
@@ -520,5 +529,11 @@
 	interface_jtag_add_dr_out(tap, num_fields, num_bits, value, cmd_queue_end_state);
 }
 
+/**
+ * Function jtag_state_name
+ * Returns a string suitable for display representing the JTAG tap_state
+ */
+const char* jtag_state_name(enum tap_state state);
 
+
 #endif /* JTAG_H */

Modified: branches/openocd-0.1/src/jtag/presto.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/presto.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/presto.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -49,7 +49,6 @@
 #error &quot;BUG: either FTD2XX and LIBFTDI has to be used&quot;
 #endif
 
-
 int presto_jtag_speed(int speed);
 int presto_jtag_khz(int khz, int *jtag_speed);
 int presto_jtag_speed_div(int speed, int *khz);
@@ -69,7 +68,6 @@
 	.quit = presto_jtag_quit,
 };
 
-
 int presto_bitq_out(int tms, int tdi, int tdo_req);
 int presto_bitq_flush(void);
 int presto_bitq_sleep(unsigned long us);
@@ -87,10 +85,8 @@
 	.in = presto_bitq_in,
 };
 
-
 /* -------------------------------------------------------------------------- */
 
-
 #define FT_DEVICE_NAME_LEN 64
 #define FT_DEVICE_SERNUM_LEN 64
 
@@ -486,7 +482,6 @@
 	return result;
 }
 
-
 int presto_flush(void)
 {
 	if (presto-&gt;buff_out_pos == 0)
@@ -530,7 +525,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_sendbyte(int data)
 {
 	if (data == EOF) return presto_flush();
@@ -555,7 +549,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_getbyte(void)
 {
 	if (presto-&gt;buff_in_pos &lt; presto-&gt;buff_in_len)
@@ -573,10 +566,8 @@
 	return -1;
 }
 
-
 /* -------------------------------------------------------------------------- */
 
-
 int presto_tdi_flush(void)
 {
 	if (presto-&gt;jtag_tdi_count == 0)
@@ -596,7 +587,6 @@
 	return 0;
 }
 
-
 int presto_tck_idle(void)
 {
 	if (presto-&gt;jtag_tck == 1)
@@ -608,10 +598,8 @@
 	return 0;
 }
 
-
 /* -------------------------------------------------------------------------- */
 
-
 int presto_bitq_out(int tms, int tdi, int tdo_req)
 {
 	int i;
@@ -658,7 +646,6 @@
 	return 0;
 }
 
-
 int presto_bitq_flush(void)
 {
 	presto_tdi_flush();
@@ -669,7 +656,6 @@
 	return presto_flush();
 }
 
-
 int presto_bitq_in_rdy(void)
 {
 	if (presto-&gt;buff_in_pos&gt;=presto-&gt;buff_in_len)
@@ -677,7 +663,6 @@
 	return presto-&gt;buff_in_len-presto-&gt;buff_in_pos;
 }
 
-
 int presto_bitq_in(void)
 {
 	if (presto-&gt;buff_in_pos&gt;=presto-&gt;buff_in_len)
@@ -686,7 +671,6 @@
 	return 0;
 }
 
-
 int presto_bitq_sleep(unsigned long us)
 {
 	long waits;
@@ -708,7 +692,6 @@
 	return 0;
 }
 
-
 int presto_bitq_reset(int trst, int srst)
 {
 	presto_tdi_flush();
@@ -724,10 +707,8 @@
 	return 0;
 }
 
-
 /* -------------------------------------------------------------------------- */
 
-
 int presto_jtag_khz(int khz, int *jtag_speed)
 {
 	if (khz &lt; 0)
@@ -742,7 +723,6 @@
 	return 0;
 }
 
-
 int presto_jtag_speed_div(int speed, int *khz)
 {
 	if ((speed &lt; 0) || (speed &gt; 1000))
@@ -757,7 +737,6 @@
 	return 0;
 }
 
-
 int presto_jtag_speed(int speed)
 {
 	int khz;
@@ -777,7 +756,6 @@
 	return 0;
 }
 
-
 char *presto_serial;
 
 int presto_handle_serial_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
@@ -796,7 +774,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_jtag_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, &quot;presto_serial&quot;, presto_handle_serial_command,
@@ -804,7 +781,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_jtag_init(void)
 {
 	if (presto_open(presto_serial) != ERROR_OK)
@@ -825,7 +801,6 @@
 	return ERROR_OK;
 }
 
-
 int presto_jtag_quit(void)
 {
 	bitq_cleanup();

Copied: branches/openocd-0.1/src/jtag/rlink (from rev 1324, trunk/src/jtag/rlink)

Deleted: branches/openocd-0.1/src/jtag/rlink/Makefile
===================================================================
--- trunk/src/jtag/rlink/Makefile	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/rlink/Makefile	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,73 +0,0 @@
-#***************************************************************************
-#*   Copyright (C) 2008 Lou Deluxe                                         *
-#*   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>                                   *
-#*                                                                         *
-#*   This program is free software; you can redistribute it and/or modify  *
-#*   it under the terms of the GNU General Public License as published by  *
-#*   the Free Software Foundation; either version 2 of the License, or     *
-#*   (at your option) any later version.                                   *
-#*                                                                         *
-#*   This program is distributed in the hope that it will be useful,       *
-#*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
-#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
-#*   GNU General Public License for more details.                          *
-#*                                                                         *
-#*   You should have received a copy of the GNU General Public License     *
-#*   along with this program; if not, write to the                         *
-#*   Free Software Foundation, Inc.,                                       *
-#*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
-#***************************************************************************
-
-TOP = ../../..
-INTERFACE_NAME = rlink
-
-PERL = perl
-M4 = m4
-
-TARGETDIR = ${TOP}/src/target
-TOOLSDIR = ${TOP}/tools
-
-MAKE_SPEED_TABLE = ${TOOLSDIR}/rlink_make_speed_table/rlink_make_speed_table
-ST7_DTC_AS = ${TOOLSDIR}/st7_dtc_as/st7_dtc_as
-
-OPENOCD = ${TOP}/src/openocd
-OPENOCD_CONFIG = -s ${TARGETDIR}
-OPENOCD_CONFIG += -f interface/rlink.cfg
-OPENOCD_CONFIG += -f board/stm32f10x_128k_eval.cfg
-
-PATCHFILE = /tmp/openocd_${INTERFACE_NAME}.diff.gz
-
-# relative to ${TOP}
-SVNADDFILES =
-SVNADDFILES += src/target/interface/rlink.cfg
-SVNADDFILES += src/jtag/${INTERFACE_NAME}.c
-SVNADDFILES += src/jtag/${INTERFACE_NAME}
-
-PRESCALERS = 64 11 8 2
-
-DTCFILES =
-DTCFILES += $(addsuffix _init.dtc, ${PRESCALERS})
-DTCFILES += $(addsuffix _call.dtc, ${PRESCALERS})
-
-default: rlink_speed_table.c clean
-
-%_init.fsm: init.m4
-	${M4} -P -DSHIFTER_PRESCALER=`echo &quot;$@&quot; | sed -e's/_.*//'` $&lt; &gt; $@
-
-%_call.fsm: call.m4
-	${M4} -P -DSHIFTER_PRESCALER=`echo &quot;$@&quot; | sed -e's/_.*//'` $&lt; &gt; $@
-
-%.dtc: %.fsm
-	${ST7_DTC_AS} -b -o $@ -i $&lt; &gt; /dev/null
-
-rlink_speed_table.c: ${DTCFILES}
-	${MAKE_SPEED_TABLE} ${PRESCALERS} &gt; $@ || rm $@
-
-clean:
-	-rm *.dtc *.fsm
-
-distclean: clean
-
-test: default
-	(cd ${TOP} &amp;&amp; (rm src/jtag/${INTERFACE_NAME}.o; ${MAKE}))
-	${OPENOCD} -d0 ${OPENOCD_CONFIG} -c init -c 'poll off'

Copied: branches/openocd-0.1/src/jtag/rlink/Makefile (from rev 1324, trunk/src/jtag/rlink/Makefile)

Deleted: branches/openocd-0.1/src/jtag/rlink/call.m4
===================================================================
--- trunk/src/jtag/rlink/call.m4	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/rlink/call.m4	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,485 +0,0 @@
-m4_divert(`-1')
-/***************************************************************************
- *   Copyright (C) 2008 Lou Deluxe                                         *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>                                   *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-m4_dnl Setup and hold times depend on SHIFTER_PRESCALER
-m4_define(`SETUP_DELAY_CYCLES', m4_eval(`('SHIFTER_PRESCALER` + 1) / 2'))
-m4_define(`HOLD_DELAY_CYCLES', m4_eval(`'SHIFTER_PRESCALER` / 2'))
-
-m4_dnl Some macros to make nybble handling a little easier
-m4_define(`m4_high_nybble', `m4_eval(`(($1) &gt;&gt; 4) &amp; 0xf')')
-m4_define(`m4_low_nybble', `m4_eval(`($1) &amp; 0xf')')
-
-m4_dnl A macro to generate a number of NOPs depending on the argument
-m4_define(`m4_0_to_5_nops', `m4_ifelse(m4_eval(`($1) &gt;= 1'), 1, `	NOP
-'m4_ifelse(m4_eval(`($1) &gt;= 2'), 1, `	NOP
-'m4_ifelse(m4_eval(`($1) &gt;= 3'), 1, `	NOP
-'m4_ifelse(m4_eval(`($1) &gt;= 4'), 1, `	NOP
-'m4_ifelse(m4_eval(`($1) &gt;= 5'), 1, `	NOP
-')))))')
-
-
-m4_dnl Some macros to facilitate bit-banging delays.
-m4_dnl There are 3 of them.  One for self-contained delays, and two for those which must be split between setup and loop to keep from disturbing A at delay time.
-m4_dnl The argument passed to any of them is the number of cycles which the delay should consume.
-
-m4_dnl This one is self-contained.
-
-m4_define(`m4_delay',
-`; delay (m4_eval($1) cycles)'
-`m4_ifelse(m4_eval(`('$1`) &lt; 6'), 1,
-	m4_0_to_5_nops($1)
-,
-	m4_ifelse(m4_eval(`(('$1`) - 3) % 2'), 1, `	NOP')
-	A.H = m4_high_nybble(`(('$1`) - 3) / 2')
-	A.L = m4_low_nybble(`(('$1`) - 3) / 2')
-	Y = A
-	DECY
-	JP -1
-)')
-
-
-m4_dnl These are the setup and loop parts of the split delay.
-m4_dnl The argument passed to both must match for the result to make sense.
-m4_dnl The setup does not figure into the delay.  It takes 3 cycles when a loop is used and none if nops are used.
-
-m4_define(`m4_delay_setup',
-`; delay setup (m4_eval($1) cycles)'
-`m4_ifelse(m4_eval(`('$1`) &lt; 6'), 0, `	'
-	A.H = m4_high_nybble(`('$1`) / 2')
-	A.L = m4_low_nybble(`('$1`) / 2')
-	Y = A
-)')
-	
-m4_define(`m4_delay_loop',
-`; delay loop (m4_eval($1) cycles)'
-`m4_ifelse(m4_eval(`('$1`) &lt; 6'), 1,
-	m4_0_to_5_nops($1)
-,
-	m4_ifelse(m4_eval(`('$1`) % 2'), 1, `	NOP')
-	DECY
-	JP -1
-)')
-
-m4_dnl These are utility macros for use with delays.  Specifically, there is code below which needs some predictability in code size for relative jumps to reach.  The m4_delay macro generates an extra NOP when an even delay is needed, and the m4_delay_loop macro generates an extra NOP when an odd delay is needed.  Using this for the argument to the respective macro rounds up the argument so that the extra NOP will not be generated.  There is also logic built in to cancel the rounding when the result is small enough that a loop would not be generated.
-	
-m4_define(`m4_delay_loop_round_up', `m4_ifelse(m4_eval($1` &lt; 6'), 1, $1, m4_eval(`(('$1`) + 1) / 2 * 2'))')
-m4_define(`m4_delay_round_up', `m4_ifelse(m4_eval($1` &lt; 6'), 1, $1, m4_eval(`(('$1`) / 2 * 2) + 1'))')
-
-
-m4_divert(`0')m4_dnl
-
-;------------------------------------------------------------------------------
-:opcode_error
-; This is at address 0x00 in case of empty LUT entries
-	STATUS STOP ERROR
-
-;------------------------------------------------------------------------------
-; Command interpreter at address 0x01 because it is branched to a lot and having it be 0x01 means we can use X for it, which is already used for other purposes which want it to be 1.
-; Assumes X is 1
-; Assumes ADR_BUFFER0 points to the next command byte
-; Stores the current command byte in CMP01
-
-:command_interpreter
-	A = DATA_BUFFER0
-	ADR_BUFFER0 += X
-	CMP01 = A	; store the current command for later
-
-	EXCHANGE	; put MSN into LSN
-	A.H = 0xc	; lookup table at 0x1550 + 0xc0 = 0x1610
-
-	; branch to address in lookup table
-	Y = A 
-	A = &lt;Y&gt;
-	BRANCH
-
-;------------------------------------------------------------------------------
-; LUT for high nybble
-
-;LUT; c0 opcode_error
-;LUT; c1 opcode_shift_tdi_andor_tms_bytes
-;LUT; c2 opcode_shift_tdi_andor_tms_bytes
-;LUT; c3 opcode_shift_tdi_andor_tms_bytes
-;LUT; c4 opcode_shift_tdo_bytes
-;LUT; c5 opcode_error
-;LUT; c6 opcode_shift_tdio_bytes
-;LUT; c7 opcode_error
-;LUT; c8 opcode_shift_tms_tdi_bit_pair
-;LUT; c9 opcode_shift_tms_bits
-;LUT; ca opcode_error
-;LUT; cb opcode_error
-;LUT; cc opcode_error
-;LUT; cd opcode_error
-;LUT; ce opcode_shift_tdio_bits
-;LUT; cf opcode_stop
-
-
-;------------------------------------------------------------------------------
-; USB/buffer handling
-;
-
-;ENTRY; download entry_download
-
-opcode_stop:
-opcode_next_buffer:
-	; pointer to completion flag
-	A.H = 0xf
-	A.L = 0xf
-	Y = A
-
-	A = OR_MPEG	; buffer indicator from previous iteration
-	&lt;Y&gt; = A		; either indicator will have bit 0 set
-	BSET 1		; was buffer 1 previously current?
-;	A.H = 0		; already zero from OR_MPEG
-	JP opcode_next_buffer_0
-
-opcode_next_buffer_1:
-	A.L = 0x1	; ack buffer 0
-	BUFFER_MNGT = A
-;	A.H = 0x0	; already zero from BUFFER_MNGT
-	A.L = 0x3	; Input buffer 1 = 0x1850 (0x0300)
-	JP +4
-
-opcode_next_buffer_0:
-	A.L = 0x2	; ack buffer 1
-	BUFFER_MNGT = A
-entry_download:
-	A = X		; Input buffer 0 = 0x1650 (0x0100)
-
-	ADR_BUFFER01 = A
-	OR_MPEG = A	; store for next iteration
-
-	A.L = 0x0
-	BUFFER_MNGT = A	; finish acking previous buffer
-	Y = A
-	ADR_BUFFER00 = A
-	ADR_BUFFER11 = A
-
-	A.H = 0x4	; Output buffer = 0x1590 (0x0040)
-	ADR_BUFFER10 = A
-
-	EXCHANGE	; 0x04
-	X = A		; for the spin loop below
-
-	; pointer to status in shared memory
-	DECY		; setting to 0 above and decrementing here saves a byte
-
-	; wait until a command buffer is available
-	A = BUFFER_MNGT	; spin while neither of bits 2 or 3 are set
-	CP A&lt;X		; this is slightly faster and smaller than trying to AND and compare the result, and it lets us just use the nybble-swapped 0x40 from the output buffer setup.
-	JP -2
-	&lt;Y&gt; = A		; update status once done spinning
-
-	; restore X, since we used it
-;	A.H = 0	; high nybble of BUFFER_MNGT will always be 0 the way we use it
-	A.L = 1
-	X = A
-
-	; go to command interpreter
-	BRANCH
-
-
-;;------------------------------------------------------------------------------
-;:opcode_stop
-;;
-;
-;	; Ack buffer 0 in download mode
-;	A.L = 0x1
-;	BUFFER_MNGT = A
-;	
-;	STATUS STOP
-
-
-;------------------------------------------------------------------------------
-:opcode_shift_tdi_andor_tms_bytes
-;
-
-	A = CMP01	; bits 3..0 contain the number of bytes to shift - 1
-	A.H = 0
-	Y = A		; loop counter 
-
-	A = CMP01
-	EXCHANGE
-	CMP01 = A	; we're interested in bits in the high nybble
-
-opcode_shift_tdi_andor_tms_bytes__loop:
-
-; set tdi to supplied byte or zero
-	A = CMP01
-	BSET 1
-	JP +4
-	A.H = 0
-	A.L = 0
-	JP +3
-	A = DATA_BUFFER0
-	ADR_BUFFER0 += X
-	SHIFT_MPEG = A
-
-; set tms to supplied byte or zero
-	A = CMP01
-	BCLR 0
-	JP +5
-	A = DATA_BUFFER0
-	ADR_BUFFER0 += X
-	SHIFT_CARD = A
-	SHIFT CARD OUT=&gt;PIN0
-
-; run both shifters as nearly simultaneously as possible
-	SHIFT MPEG OUT=&gt;PIN1
-
-	A = CTRL_FCI
-	EXCHANGE
-	BCLR 3
-	JP -3
-
-	DECY
-	JP opcode_shift_tdi_andor_tms_bytes__loop
-
-	A = X
-	BRANCH
-
-
-;------------------------------------------------------------------------------
-:opcode_shift_tdo_bytes
-;
-
-	A = CMP01	; bits 3..0 contain the number of bytes to shift - 1
-	A.H = 0
-	Y = A		; loop counter 
-
-opcode_shift_tdo_bytes__loop:
-	SHIFT MPEG PIN0=&gt;IN
-
-	A = CTRL_FCI
-	EXCHANGE
-	BCLR 3
-	JP -3
-
-	; put shifted byte into output buffer
-	A = SHIFT_MPEG
-	DATA_BUFFER1 = A
-	ADR_BUFFER1 += X
-
-	DECY
-	JP opcode_shift_tdo_bytes__loop
-
-	A = X
-	BRANCH
-
-
-;------------------------------------------------------------------------------
-:opcode_shift_tdio_bytes
-;
-
-	A = CMP01	; bits 3..0 contain the number of bytes to shift - 1
-	A.H = 0
-	CMP10 = A	; byte loop counter
-
-	A.H = opcode_shift_tdio_bytes__sub_return
-	A.L = opcode_shift_tdio_bytes__sub_return
-	CMP00 = A	; return address
-
-opcode_shift_tdio_bytes__loop:
-	A.H = 0
-	A.L = 7
-	CMP11 = A		; always use 8 bits
-
-	JP sub_shift_tdio_bits
-opcode_shift_tdio_bytes__sub_return:
-	
-	A = CMP10	; byte loop counter
-	CP A=&gt;X
-	CLC
-	A -= X
-	CMP10 = A
-	JP opcode_shift_tdio_bytes__loop
-
-	A = X
-;DR_MPEG = A ; return TCK low, as str912 reset halt seems to require it
-	BRANCH
-
-
-;------------------------------------------------------------------------------
-:opcode_shift_tdio_bits
-;
-
-	A = CMP01	; bits 2..0 contain the number of bits to shift - 1
-	A.H = 0
-	BCLR 3		; set TMS=1 if bit 3 was set
-	CMP11 = A	; bit loop counter 
-
-	A.H = opcode_shift_tdio_bits__sub_return
-	A.L = opcode_shift_tdio_bits__sub_return
-	CMP00 = A	; return address
-
-	JP sub_shift_tdio_bits
-	A.L = 0x1	; TMS=1
-	DR_CARD = A
-	JP sub_shift_tdio_bits
-opcode_shift_tdio_bits__sub_return:
-	
-	A = X
-;DR_MPEG = A ; return TCK low, as str912 reset halt seems to require it
-	BRANCH
-
-
-;------------------------------------------------------------------------------
-:sub_shift_tdio_bits
-;
-
-	A = DATA_BUFFER0	; get byte from input buffer
-	ADR_BUFFER0 += X
-	MASK = A		; put it in MASK where bit routine will use it
-
-:sub_shift_tdio_bits__loop
-m4_delay_setup(m4_delay_loop_round_up(SETUP_DELAY_CYCLES - 1))
-
-	A = MASK	; shift TDO into and TDI out of MASK via carry
-	A += MASK
-	MASK = A
-
-	; shifting out TDI
-	A.L = 0x2	; TCK=0, TDI=1
-	CP CARRY
-	JP +2
-	A.L = 0x0	; TCK=0, TDI=0
-	DR_MPEG = A
-
-m4_delay_loop(m4_delay_loop_round_up(SETUP_DELAY_CYCLES - 1))
-
-	BSET 2		; TCK high
-	DR_MPEG = A 
-
-	A = DR_MPEG	; set carry bit to TDO 
-	CLC
-	BCLR 0
-	JP +2
-	SEC
-
-m4_delay(HOLD_DELAY_CYCLES - 10)
-
-	A = CMP11	; bit loop counter
-	Y = A		; use Y to avoid corrupting carry bit with subtract
-	DECY
-	A = Y
-	CMP11 = A
-	JP :sub_shift_tdio_bits__loop
-
-	; shift last TDO bit into result
-	A = MASK
-	A += MASK
-	DATA_BUFFER1 = A
-	ADR_BUFFER1 += X
-
-	A = CMP00	; return to caller
-	BRANCH
-
-
-;------------------------------------------------------------------------------
-:opcode_shift_tms_tdi_bit_pair
-;
-
-; set TMS line manually
-	A = CMP01	; bits 3..0 contain TDI and TMS bits and whether to return TDO
-	BSET 0		; TMS bit
-	A.L = 0x1	; TMS=1
-	JP +2
-	A.L = 0x0	; TMS=0
-	DR_CARD = A
-
-; stuff command buffer with bitmap of single TDI bit
-	A = CMP01
-	BSET 1		; TDI bit
-	A.H = 0x8	; TDI=1
-	JP +2
-	A.H = 0x0	; TDI=0
-	ADR_BUFFER0 -= X
-	DATA_BUFFER0 = A
-
-	A.H = 0
-	A.L = 0
-	CMP11 = A	; bit loop counter (only doing one bit)
-
-	A.H = opcode_shift_tms_tdi_bit_pair__sub_return
-	A.L = opcode_shift_tms_tdi_bit_pair__sub_return
-	CMP00 = A	; return address
-
-; jump this way due to relative jump range issues
-	A.H = sub_shift_tdio_bits
-	A.L = sub_shift_tdio_bits
-	BRANCH
-opcode_shift_tms_tdi_bit_pair__sub_return:
-
-	A = CMP01
-	BSET 3		; bit says whether to return TDO
-	JP +2
-	ADR_BUFFER1 -= X	; subroutine returns it, so undo that
-	
-	A = X
-	DR_MPEG = A ; return TCK low, as str912 reset halt seems to require it
-	BRANCH
-
-
-;------------------------------------------------------------------------------
-:opcode_shift_tms_bits
-;
-
-	A = CMP01	; bits 3..0 contain the number of bits to shift - 1 (only 1-8 bits is valid... no checking, just improper operation)
-	A.H = 0
-	CMP11 = A	; bit loop counter 
-
-	A = DATA_BUFFER0	; get byte from input buffer
-	ADR_BUFFER0 += X
-	MASK = A		; The byte we'll be shifting
-
-:opcode_shift_tms_bits__loop
-m4_delay_setup(SETUP_DELAY_CYCLES - 1)
-
-	A = MASK	; shift TMS out of MASK via carry
-	A += MASK
-	MASK = A
-
-	; shifting out TMS
-	A.L = 0x1	; TCK=0, TDI=0, TMS=1
-	CP CARRY
-	JP +2
-	A.L = 0x0	; TCK=0, TDI=0, TMS=0
-	DR_CARD = A
-	DR_MPEG = A
-
-m4_delay_loop(SETUP_DELAY_CYCLES - 1)
-
-	BSET 2		; TCK high
-	DR_MPEG = A 
-
-m4_delay(HOLD_DELAY_CYCLES - 10)
-
-	A = CMP11	; bit loop counter
-	CP A=&gt;X
-	CLC
-	A -= X
-	CMP11 = A
-	JP :opcode_shift_tms_bits__loop
-
-	A = X
-	DR_MPEG = A ; return TCK low, as str912 reset halt seems to require it
-	BRANCH
-
-

Copied: branches/openocd-0.1/src/jtag/rlink/call.m4 (from rev 1324, trunk/src/jtag/rlink/call.m4)

Deleted: branches/openocd-0.1/src/jtag/rlink/dtc_cmd.h
===================================================================
--- trunk/src/jtag/rlink/dtc_cmd.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/rlink/dtc_cmd.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,66 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2008 Lou Deluxe                                         *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>                                   *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-/* A command position with the high nybble of 0x0 is reserved for an error condition.  If executed, it stops the DTC and raises the ERROR flag */
-
-#define DTC_CMD_SHIFT_TMS_BYTES(bytes)	((0x1 &lt;&lt; 4) | ((bytes) - 1))
-/* Shift 1-16 bytes out TMS. TDI is 0. */
-/* Bytes to shift follow. */
-
-#define DTC_CMD_SHIFT_TDI_BYTES(bytes)	((0x2 &lt;&lt; 4) | ((bytes) - 1))
-/* Shift 1-16 bytes out TDI. TMS is 0. */
-/* Bytes to shift follow. */
-
-#define DTC_CMD_SHIFT_TDI_AND_TMS_BYTES(bytes)	((0x3 &lt;&lt; 4) | ((bytes) - 1))
-/* Shift 1-16 byte pairs out TDI and TMS. */
-/* Byte pairs to shift follow in TDI, TMS order. */
-
-#define DTC_CMD_SHIFT_TDO_BYTES(bytes)	((0x4 &lt;&lt; 4) | ((bytes) - 1))
-/* Shift 1-16 bytes in TDO. TMS is unaffected. */
-/* Reply buffer contains bytes shifted in. */
-
-#define DTC_CMD_SHIFT_TDIO_BYTES(bytes)	((0x6 &lt;&lt; 4) | ((bytes) - 1))
-/* Shift 1-16 bytes out TDI and in TDO. TMS is unaffected. */
-
-#define DTC_CMD_SHIFT_TMS_TDI_BIT_PAIR(tms, tdi, tdo)	((0x8 &lt;&lt; 4) | (	\
-		(tms) ? (1 &lt;&lt; 0) : 0	\
-	) | (	\
-		(tdi) ? (1 &lt;&lt; 1) : 0	\
-	) | (	\
-		(tdo) ? (1 &lt;&lt; 3) : 0	\
-	))
-/* Single bit shift. */
-/* tms and tdi are the levels shifted out on TMS and TDI, respectively. */
-/* tdo indicates whether a byte will be returned in the reply buffer with its least significant bit set to reflect TDO */
-/* Care should be taken when tdo is zero, as the underlying code actually does put that byte in the reply buffer.  Setting tdo to zero just moves the pointer back.  The result is that if this command is executed when the reply buffer is already full, a byte will be written erroneously to memory not belonging to the reply buffer.  This could be worked around at the expense of DTC code space and speed. */
-
-#define DTC_CMD_SHIFT_TMS_BITS(bits)	((0x9 &lt;&lt; 4) | ((bits) - 1))
-/* Shift 1-8 bits out TMS. */
-/* Bits to be shifted out are left justified in the following byte. */
-
-#define DTC_CMD_SHIFT_TDIO_BITS(bits)	((0xe &lt;&lt; 4) | ((bits) - 1))
-/* Shift 1-8 bits out TDI and in TDO, TMS is unaffected. */
-/* Bits to be shifted out are left justified in the following byte. */
-/* Bits shifted in are right justified in the byte placed in the reply buffer. */
-
-
-#define DTC_CMD_STOP			(0xf &lt;&lt; 4)
-/* Stop processing the command buffer and wait for the next one. */
-/* A shared status byte is updated with bit 0 set when this has happened, and it is cleared when a new command buffer becomes ready.  The host can poll that byte to see when it is safe to read a reply. */

Copied: branches/openocd-0.1/src/jtag/rlink/dtc_cmd.h (from rev 1324, trunk/src/jtag/rlink/dtc_cmd.h)

Deleted: branches/openocd-0.1/src/jtag/rlink/ep1_cmd.h
===================================================================
--- trunk/src/jtag/rlink/ep1_cmd.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/rlink/ep1_cmd.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,57 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2008 Lou Deluxe                                         *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>                                   *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-/*
- * Command opcodes that can be sent over endpoint 1.
- * This codifies information provided by Rob Brown &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">rob at cobbleware.com</A>&gt;.
- * The buffer can contain several of these, but only one which returns data.
- * Some of these opcodes have arguments, which follow immediately.
- * If shorter than the packet size, trailing positions should be zero-filled.
- */
-
-/* LED update enables:
- *  When enabled, each LED is updated automatically.
- *  When not enabled, each LED can be controlled manually with EP1_CMD_SET_PORTD_LEDS.
- */
-#define EP1_CMD_LEDUE_BOTH				(0x05)
-/* EP1_CMD_LEDUE_NONE has the side effect of turning the LEDs on */
-#define EP1_CMD_LEDUE_NONE				(0x06)
-#define EP1_CMD_LEDUE_ERROR				(0x17)
-#define EP1_CMD_LEDUE_BUSY				(0x18)
-
-#define EP1_CMD_DTC_STOP				(0x0b)
-#define EP1_CMD_DTC_LOAD				(0x0c)
-#define EP1_CMD_DTC_CALL				(0x0d)
-#define EP1_CMD_SET_UPLOAD				(0x0f)
-#define EP1_CMD_SET_DOWNLOAD			(0x10)
-#define EP1_CMD_DTC_WAIT				(0x12)
-#define EP1_CMD_DTC_GET_STATUS			(0x15)
-/* a quick way to just read back one byte */
-#define EP1_CMD_DTC_GET_CACHED_STATUS	(0x16)
-
-/* Writes upper 2 bits port D with argument */
-#define EP1_CMD_SET_PORTD_UPPER			(0x19)
-/* Writes lower 2 bits (BUSY and ERROR) of port D with argument */
-#define EP1_CMD_SET_PORTD_LEDS			(0x1a)
-
-#define EP1_CMD_MEMORY_READ				(0x28)
-#define EP1_CMD_MEMORY_WRITE			(0x29)
-#define EP1_CMD_GET_FWREV				(0xfe)
-#define EP1_CMD_GET_SERIAL				(0xff)

Copied: branches/openocd-0.1/src/jtag/rlink/ep1_cmd.h (from rev 1324, trunk/src/jtag/rlink/ep1_cmd.h)

Deleted: branches/openocd-0.1/src/jtag/rlink/init.m4
===================================================================
--- trunk/src/jtag/rlink/init.m4	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/rlink/init.m4	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,74 +0,0 @@
-m4_divert(`-1')
-/***************************************************************************
- *   Copyright (C) 2008 Lou Deluxe                                         *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>                                   *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-m4_undefine(`CTRL_MPEG_L')
-m4_undefine(`CTRL_CARD_L')
-
-m4_ifelse(SHIFTER_PRESCALER, 1, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x0')')
-')
-m4_ifelse(SHIFTER_PRESCALER, 2, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x2')')
-	m4_define(`CTRL_CARD_L', `m4_eval(`0x8 | 0x1')')
-')
-m4_ifelse(SHIFTER_PRESCALER, 8, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x3')')
-')
-m4_ifelse(SHIFTER_PRESCALER, 11, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x4')')
-')
-m4_ifelse(SHIFTER_PRESCALER, 64, `
-	m4_define(`CTRL_MPEG_L', `m4_eval(`0x8 | 0x7')')
-')
-
-m4_ifdef(`CTRL_MPEG_L',,`
-	m4_errprint(`SHIFTER_PRESCALER was not defined with a supported value
-')	m4_m4exit(`1')
-')
-
-m4_divert(`0')m4_dnl
-
-init:
-	A.H = 0
-
-	A.L = 0
-
-	DR_MPEG = A	; TDI and TCK start out low
-	DR_CARD = A	; TMS starts out low
-
-	A.L = 0x6
-
-	CTRL_FCI = A	; MPEG and CARD driven by FCI
-	DDR_MPEG = A	; TDI and TCK are outputs
-
-	A.L = 0x1
-
-	X = A		; X == 1
-	DDR_CARD = A	; TMS is output
-
-	A.L = CTRL_MPEG_L
-	CTRL_MPEG = A
-m4_ifdef(`CTRL_CARD_L',
-`	A.L = 'CTRL_CARD_L`
-')m4_dnl
-	CTRL_CARD = A
-
-	STATUS STOP

Copied: branches/openocd-0.1/src/jtag/rlink/init.m4 (from rev 1324, trunk/src/jtag/rlink/init.m4)

Deleted: branches/openocd-0.1/src/jtag/rlink/rlink.c
===================================================================
--- trunk/src/jtag/rlink/rlink.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/rlink/rlink.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,1817 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2005 by Dominic Rath                                    *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">Dominic.Rath at gmx.de</A>                                                   *
- *                                                                         *
- *   Copyright (C) 2007,2008 &#216;yvind Harboe                                 *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">oyvind.harboe at zylin.com</A>                                               *
- *                                                                         *
- *   Copyright (C) 2008 Rob Brown, Lou Deluxe                              *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">rob at cobbleware.com</A>, <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>               *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-#ifdef HAVE_CONFIG_H
-#include &quot;config.h&quot;
-#endif
-
-/* system includes */
-#include &lt;errno.h&gt;
-#include &lt;string.h&gt;
-#include &lt;usb.h&gt;
-#include &lt;stdint.h&gt;
-
-/* project specific includes */
-#include &quot;log.h&quot;
-#include &quot;types.h&quot;
-#include &quot;jtag.h&quot;
-#include &quot;configuration.h&quot;
-#include &quot;rlink.h&quot;
-#include &quot;st7.h&quot;
-#include &quot;ep1_cmd.h&quot;
-#include &quot;dtc_cmd.h&quot;
-
-
-/* This feature is made useless by running the DTC all the time.  When automatic, the LED is on whenever the DTC is running.  Otherwise, USB messages are sent to turn it on and off. */
-#undef AUTOMATIC_BUSY_LED
-
-/* This feature may require derating the speed due to reduced hold time. */
-#undef USE_HARDWARE_SHIFTER_FOR_TMS
-
-
-#define INTERFACE_NAME		&quot;RLink&quot;
-
-#define USB_IDVENDOR		(0x138e)
-#define USB_IDPRODUCT		(0x9000)
-
-#define USB_EP1OUT_ADDR		(0x01)
-#define USB_EP1OUT_SIZE		(16)
-#define USB_EP1IN_ADDR		(USB_EP1OUT_ADDR | 0x80)
-#define USB_EP1IN_SIZE		(USB_EP1OUT_SIZE)
-
-#define USB_EP2OUT_ADDR		(0x02)
-#define USB_EP2OUT_SIZE		(64)
-#define USB_EP2IN_ADDR		(USB_EP2OUT_ADDR | 0x80)
-#define USB_EP2IN_SIZE		(USB_EP2OUT_SIZE)
-#define USB_EP2BANK_SIZE	(512)
-
-#define USB_TIMEOUT_MS		(3 * 1000)
-
-#define DTC_STATUS_POLL_BYTE	(ST7_USB_BUF_EP0OUT + 0xff)
-
-
-/* Symbolic names for some pins */
-#define ST7_PA_NJTAG_TRST		ST7_PA1
-#define ST7_PA_NRLINK_RST		ST7_PA3
-#define ST7_PA_NLINE_DRIVER_ENABLE	ST7_PA5
-
-/* mask for negative-logic pins */
-#define ST7_PA_NUNASSERTED	(0	\
-	| ST7_PA_NJTAG_TRST	\
-	| ST7_PA_NRLINK_RST	\
-	| ST7_PA_NLINE_DRIVER_ENABLE	\
-)
-
-#define ST7_PD_NBUSY_LED		ST7_PD0
-#define ST7_PD_NERROR_LED		ST7_PD1
-#define ST7_PD_NRUN_LED			ST7_PD7
-
-#define ST7_PE_ADAPTER_SENSE_IN		ST7_PE3
-#define ST7_PE_ADAPTER_SENSE_OUT	ST7_PE4
-
-static usb_dev_handle *pHDev;
-
-
-/*
- * ep1 commands are up to USB_EP1OUT_SIZE bytes in length.
- * This function takes care of zeroing the unused bytes before sending the packet.
- * Any reply packet is not handled by this function.
- */
-static
-int
-ep1_generic_commandl(
-	usb_dev_handle	*pHDev,
-	size_t		length,
-	...
-) {
-	uint8_t		usb_buffer[USB_EP1OUT_SIZE];
-	uint8_t		*usb_buffer_p;
-	va_list		ap;
-	int		usb_ret;
-
-	if(length &gt; sizeof(usb_buffer)) {
-		length = sizeof(usb_buffer);
-	}
-
-	usb_buffer_p = usb_buffer;
-
-	va_start(ap, length);
-	while(length &gt; 0) {
-		*usb_buffer_p++ = va_arg(ap, int);
-		length--;
-	}
-	
-	memset(
-		usb_buffer_p,
-		0,
-		sizeof(usb_buffer) - (usb_buffer_p - usb_buffer)
-	);
-
-	usb_ret = usb_bulk_write(
-		pHDev,
-		USB_EP1OUT_ADDR,
-		(char *)usb_buffer, sizeof(usb_buffer),
-		USB_TIMEOUT_MS
-	);
-
-	return(usb_ret);
-}
-
-
-
-#if 0
-static
-ssize_t
-ep1_memory_read(
-	usb_dev_handle	*pHDev,
-	uint16_t	addr,
-	size_t		length,
-	uint8_t		*buffer
-) {
-	uint8_t		usb_buffer[USB_EP1OUT_SIZE];
-	int		usb_ret;
-	size_t		remain;
-	ssize_t		count;
-
-	usb_buffer[0] = EP1_CMD_MEMORY_READ;
-	memset(
-		usb_buffer + 4,
-		0,
-		sizeof(usb_buffer) - 4
-	);
-
-	remain = length;
-	count = 0;
-
-	while(remain) {
-		if(remain &gt; sizeof(usb_buffer)) {
-			length = sizeof(usb_buffer);
-		} else {
-			length = remain;
-		}
-
-		usb_buffer[1] = addr &gt;&gt; 8;
-		usb_buffer[2] = addr;
-		usb_buffer[3] = length;
-
-      		usb_ret = usb_bulk_write(
-			pHDev, USB_EP1OUT_ADDR,
-			usb_buffer, sizeof(usb_buffer),
-			USB_TIMEOUT_MS
-		);
-
-		if(usb_ret &lt; sizeof(usb_buffer)) {
-			break;
-		}
-		
-		usb_ret = usb_bulk_read(
-			pHDev, USB_EP1IN_ADDR,
-			buffer, length,
-			USB_TIMEOUT_MS
-		);
-
-		if(usb_ret &lt; length) {
-			break;
-		}
-		
-		addr += length;
-		buffer += length;
-		count += length;
-		remain -= length;
-	}
-
-	return(count);
-}
-#endif
-
-
-
-static
-ssize_t
-ep1_memory_write(
-	usb_dev_handle	*pHDev,
-	uint16_t	addr,
-	size_t		length,
-	uint8_t	const	*buffer
-) {
-	uint8_t		usb_buffer[USB_EP1OUT_SIZE];
-	int		usb_ret;
-	size_t		remain;
-	ssize_t		count;
-
-	usb_buffer[0] = EP1_CMD_MEMORY_WRITE;
-
-	remain = length;
-	count = 0;
-
-	while(remain) {
-		if(remain &gt; (sizeof(usb_buffer) - 4)) {
-			length = (sizeof(usb_buffer) - 4);
-		} else {
-			length = remain;
-		}
-
-		usb_buffer[1] = addr &gt;&gt; 8;
-		usb_buffer[2] = addr;
-		usb_buffer[3] = length;
-		memcpy(
-			usb_buffer + 4,
-			buffer,
-			length
-		);
-		memset(
-			usb_buffer + 4 + length,
-			0,
-			sizeof(usb_buffer) - 4 - length
-		);
-
-      		usb_ret = usb_bulk_write(
-			pHDev, USB_EP1OUT_ADDR,
-			(char *)usb_buffer, sizeof(usb_buffer),
-			USB_TIMEOUT_MS
-		);
-
-		if(usb_ret &lt; sizeof(usb_buffer)) {
-			break;
-		}
-		
-		addr += length;
-		buffer += length;
-		count += length;
-		remain -= length;
-	}
-
-	return(count);
-}
-
-
-#if 0
-static
-ssize_t
-ep1_memory_writel(
-	usb_dev_handle	*pHDev,
-	uint16_t	addr,
-	size_t		length,
-	...
-) {
-	uint8_t		buffer[USB_EP1OUT_SIZE - 4];
-	uint8_t		*buffer_p;
-	va_list		ap;
-	size_t		remain;
-
-	if(length &gt; sizeof(buffer)) {
-		length = sizeof(buffer);
-	}
-
-	remain = length;
-	buffer_p = buffer;
-
-	va_start(ap, length);
-	while(remain &gt; 0) {
-		*buffer_p++ = va_arg(ap, int);
-		remain--;
-	}
-
-	return(ep1_memory_write(pHDev, addr, length, buffer));
-}
-#endif
-
-
-#define DTCLOAD_COMMENT		(0)
-#define DTCLOAD_ENTRY		(1)
-#define DTCLOAD_LOAD		(2)
-#define DTCLOAD_RUN			(3)
-#define DTCLOAD_LUT_START	(4)
-#define DTCLOAD_LUT			(5)
-
-#define DTC_LOAD_BUFFER		ST7_USB_BUF_EP2UIDO
-
-/* This gets set by the DTC loader */
-static uint8_t dtc_entry_download;
-
-
-/* The buffer is specially formatted to represent a valid image to load into the DTC. */
-static
-int
-dtc_load_from_buffer(
-	usb_dev_handle	*pHDev,
-	const u8		*buffer,
-	size_t			length
-) {
-	struct header_s {
-		u8	type;
-		u8	length;
-	};
-
-	int				usb_err;
-	struct header_s	*header;
-	u8				lut_start = 0xc0;
-
-	dtc_entry_download = 0;
-
-	/* Stop the DTC before loading anything. */
-	usb_err = ep1_generic_commandl(
-		pHDev, 1,
-		EP1_CMD_DTC_STOP
-	);
-	if(usb_err &lt; 0) return(usb_err);
-
-	while(length) {
-		if(length &lt; sizeof(*header)) {
-			LOG_ERROR(&quot;Malformed DTC image\n&quot;);
-			exit(1);
-		}
-		
-		header = (struct header_s *)buffer;
-		buffer += sizeof(*header);
-		length -= sizeof(*header);
-
-		if(length &lt; header-&gt;length + 1) {
-			LOG_ERROR(&quot;Malformed DTC image\n&quot;);
-			exit(1);
-		}
-		
-		switch(header-&gt;type) {
-			case DTCLOAD_COMMENT:
-				break;
-
-			case DTCLOAD_ENTRY:
-				/* store entry addresses somewhere */
-				if(!strncmp(&quot;download&quot;, (char *)buffer + 1, 8)) {
-					dtc_entry_download = buffer[0];
-				}
-				break;
-
-			case DTCLOAD_LOAD:
-   				/* Send the DTC program to ST7 RAM. */
-				usb_err = ep1_memory_write(
-					pHDev,
-					DTC_LOAD_BUFFER,
-					header-&gt;length + 1, buffer
-				);
-				if(usb_err &lt; 0) return(usb_err);
-
-				/* Load it into the DTC. */
-				usb_err = ep1_generic_commandl(
-					pHDev, 3,
-					EP1_CMD_DTC_LOAD,
-						(DTC_LOAD_BUFFER &gt;&gt; 8),
-						DTC_LOAD_BUFFER
-				);
-				if(usb_err &lt; 0) return(usb_err);
-
-				break;
-
-			case DTCLOAD_RUN:
-				usb_err = ep1_generic_commandl(
-					pHDev, 3,
-					EP1_CMD_DTC_CALL,
-						buffer[0],
-					EP1_CMD_DTC_WAIT
-				);
-				if(usb_err &lt; 0) return(usb_err);
-
-				break;
-
-			case DTCLOAD_LUT_START:
-				lut_start = buffer[0];
-				break;
-		
-			case DTCLOAD_LUT:
-   				usb_err = ep1_memory_write(
-					pHDev,
-					ST7_USB_BUF_EP0OUT + lut_start,
-					header-&gt;length + 1, buffer
-				);
-				if(usb_err &lt; 0) return(usb_err);
-				break;
-
-			default:
-				LOG_ERROR(&quot;Invalid DTC image record type: 0x%02x\n&quot;, header-&gt;type);
-				exit(1);
-				break;
-		}
-		
-		buffer += (header-&gt;length + 1);
-		length -= (header-&gt;length + 1);
-	}
-
-	return(0);
-}
-
-
-/*
- * Start the DTC running in download mode (waiting for 512 byte command packets on ep2).
- */
-static
-int
-dtc_start_download(void) {
-	int	usb_err;
-	u8	ep2txr;
-
-	/* set up for download mode and make sure EP2 is set up to transmit */
-	usb_err = ep1_generic_commandl(
-		pHDev, 7,
-		 
-		EP1_CMD_DTC_STOP,
-		EP1_CMD_SET_UPLOAD,
-		EP1_CMD_SET_DOWNLOAD,
-		EP1_CMD_MEMORY_READ,	/* read EP2TXR for its data toggle */
-			ST7_EP2TXR &gt;&gt; 8,
-			ST7_EP2TXR,
-			1
-	);
-	if(usb_err &lt; 0) return(usb_err);
-
-	/* read back ep2txr */
-	usb_err = usb_bulk_read(
-		pHDev, USB_EP1IN_ADDR,
-		(char *)&amp;ep2txr, 1,
-		USB_TIMEOUT_MS
-	);
-	if(usb_err &lt; 0) return(usb_err);
-
-	usb_err = ep1_generic_commandl(
-		pHDev, 13,
-		 
-		EP1_CMD_MEMORY_WRITE,	/* preinitialize poll byte */
-			DTC_STATUS_POLL_BYTE &gt;&gt; 8,
-			DTC_STATUS_POLL_BYTE,
-			1,
-			0x00,
-		EP1_CMD_MEMORY_WRITE,	/* set EP2IN to return data */
-			ST7_EP2TXR &gt;&gt; 8,
-			ST7_EP2TXR,
-			1,
-			(ep2txr &amp; ST7_EP2TXR_DTOG_TX) | ST7_EP2TXR_STAT_VALID,
-		EP1_CMD_DTC_CALL,	/* start running the DTC */
-			dtc_entry_download,
-		EP1_CMD_DTC_GET_CACHED_STATUS
-	);
-	if(usb_err &lt; 0) return(usb_err);
-
-	/* wait for completion */
-	usb_err = usb_bulk_read(
-		pHDev, USB_EP1IN_ADDR,
-		(char *)&amp;ep2txr, 1,
-		USB_TIMEOUT_MS
-	);
-
-	return(usb_err);
-}
-
-
-static
-int
-dtc_run_download(
-	usb_dev_handle	*pHDev,
-	u8	*command_buffer,
-	int	command_buffer_size,
-	u8	*reply_buffer,
-	int	reply_buffer_size
-) {
-	u8	ep2_buffer[USB_EP2IN_SIZE];
-	int	usb_err;
-	int	i;
-
-	LOG_DEBUG(&quot;: %d/%d\n&quot;, command_buffer_size, reply_buffer_size);
-
-	usb_err = usb_bulk_write(
-		pHDev,
-		USB_EP2OUT_ADDR,
-		(char *)command_buffer, USB_EP2BANK_SIZE,
-		USB_TIMEOUT_MS
-	);
-	if(usb_err &lt; 0) return(usb_err);
-
-
-	/* Wait for DTC to finish running command buffer */
-	for(i = 5;;) {
-		usb_err = ep1_generic_commandl(
-			pHDev, 4,
-
-			EP1_CMD_MEMORY_READ,
-				DTC_STATUS_POLL_BYTE &gt;&gt; 8,
-				DTC_STATUS_POLL_BYTE,
-				1
-		);
-		if(usb_err &lt; 0) return(usb_err);
-
-		usb_err = usb_bulk_read(
-			pHDev,
-			USB_EP1IN_ADDR,
-			(char *)ep2_buffer, 1,
-			USB_TIMEOUT_MS
-		);
-		if(usb_err &lt; 0) return(usb_err);
-
-		if(ep2_buffer[0] &amp; 0x01) break;
-
-		if(!--i) {
-			LOG_ERROR(&quot;%s, %d: too many retries waiting for DTC status\n&quot;,
-				__FILE__, __LINE__
-			);
-			return(-ETIMEDOUT);
-		}
-	}
-
-
-	if(!reply_buffer) reply_buffer_size = 0;
-	if(reply_buffer_size) {
-		usb_err = usb_bulk_read(
-			pHDev,
-			USB_EP2IN_ADDR,
-			(char *)ep2_buffer, sizeof(ep2_buffer),
-			USB_TIMEOUT_MS
-		);
-
-		if(usb_err &lt; (int)sizeof(ep2_buffer)) {
-			LOG_ERROR(&quot;%s, %d: Read of endpoint 2 returned %d\n&quot;,
-				__FILE__, __LINE__, usb_err
-			);
-			return(usb_err);
-		}
-
-		memcpy(reply_buffer, ep2_buffer, reply_buffer_size);
-
-	}
-
-	return(usb_err);
-}
-
-
-/*
- * The dtc reply queue is a singly linked list that describes what to do with the reply packet that comes from the DTC.  Only SCAN_IN and SCAN_IO generate these entries.
- */
-
-typedef
-struct dtc_reply_queue_entry_s {
-	struct dtc_reply_queue_entry_s	*next;
-	jtag_command_t	*cmd;	/* the command that resulted in this entry */
-
-	struct {
-		u8		*buffer;	/* the scan buffer */
-		int		size;		/* size of the scan buffer in bits */
-		int		offset;		/* how many bits were already done before this? */
-		int		length;		/* how many bits are processed in this operation? */
-		enum scan_type	type;		/* SCAN_IN/SCAN_OUT/SCAN_IO */
-	} scan;
-} dtc_reply_queue_entry_t;
-
-
-/*
- * The dtc_queue consists of a buffer of pending commands and a reply queue.
- * rlink_scan and tap_state_run add to the command buffer and maybe to the reply queue.
- */
-
-static
-struct {
-	dtc_reply_queue_entry_t	*rq_head;
-	dtc_reply_queue_entry_t	*rq_tail;
-	int			cmd_index;
-	int			reply_index;
-	u8			cmd_buffer[USB_EP2BANK_SIZE];
-} dtc_queue;
-
-
-/*
- * The tap state queue is for accumulating TAP state changes wiithout needlessly flushing the dtc_queue.  When it fills or is run, it adds the accumulated bytes to the dtc_queue.
- */
-
-static
-struct {
-	int	length;
-	u32	buffer;
-} tap_state_queue;
-
-
-
-static
-int
-dtc_queue_init(void) {
-	dtc_queue.rq_head = NULL;
-	dtc_queue.rq_tail = NULL;
-	dtc_queue.cmd_index = 0;
-	dtc_queue.reply_index = 0;
-	return(0);
-}
-
-
-static
-inline
-dtc_reply_queue_entry_t *
-dtc_queue_enqueue_reply(
-	enum scan_type	type,
-	u8				*buffer,
-	int				size,
-	int				offset,
-	int				length,
-	jtag_command_t	*cmd
-) {
-	dtc_reply_queue_entry_t	*rq_entry;
-
-	rq_entry = malloc(sizeof(dtc_reply_queue_entry_t));
-	if(rq_entry != NULL) {
-		rq_entry-&gt;scan.type = type;
-		rq_entry-&gt;scan.buffer = buffer;
-		rq_entry-&gt;scan.size = size;
-		rq_entry-&gt;scan.offset = offset;
-		rq_entry-&gt;scan.length = length;
-		rq_entry-&gt;cmd = cmd;
-		rq_entry-&gt;next = NULL;
-
-		if(dtc_queue.rq_head == NULL)
-			dtc_queue.rq_head = rq_entry;
-		else
-			dtc_queue.rq_tail-&gt;next = rq_entry;
-
-		dtc_queue.rq_tail = rq_entry;
-	}
-
-	return(rq_entry);
-}
-
-
-/*
- * Running the queue means that any pending command buffer is run and any reply data dealt with.  The command buffer is then cleared for subsequent processing.
- * The queue is automatically run by append when it is necessary to get space for the append.
-*/
-
-static
-int
-dtc_queue_run(void) {
-	dtc_reply_queue_entry_t	*rq_p, *rq_next;
-	int			retval;
-	int			usb_err;
-	int			bit_cnt;
-	int			x;
-	u8			*dtc_p, *tdo_p;
-	u8			dtc_mask, tdo_mask;
-	u8			reply_buffer[USB_EP2IN_SIZE];
-
-	retval = ERROR_OK;
-
-	if(dtc_queue.cmd_index &lt; 1) return(retval);
-
-	dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = DTC_CMD_STOP;
-
-	/* run the cmd */
-	if(dtc_queue.rq_head == NULL) {
-		usb_err = dtc_run_download(pHDev,
-			dtc_queue.cmd_buffer, dtc_queue.cmd_index,
-			NULL, 0
-		);	
-		if(usb_err &lt; 0) {
-			LOG_ERROR(&quot;dtc_run_download: %s\n&quot;, usb_strerror());
-			exit(1);
-		}
-	} else {
-		usb_err = dtc_run_download(pHDev,
-			dtc_queue.cmd_buffer, dtc_queue.cmd_index,
-			reply_buffer, dtc_queue.reply_index
-		);	
-		if(usb_err &lt; 0) {
-			LOG_ERROR(&quot;dtc_run_download: %s\n&quot;, usb_strerror());
-			exit(1);
-		} else {
-			/* process the reply, which empties the reply queue and frees its entries */
-			dtc_p = reply_buffer;
-
-			/* The rigamarole with the masks and doing it bit-by-bit is due to the fact that the scan buffer is LSb-first and the DTC code is MSb-first for hardware reasons.   It was that or craft a function to do the reversal, and that wouldn't work with bit-stuffing (supplying extra bits to use mostly byte operations), or any other scheme which would throw the byte alignment off. */
-
-			for(
-				rq_p = dtc_queue.rq_head;
-				rq_p != NULL;
-				rq_p = rq_next
-			) {
-				tdo_p = rq_p-&gt;scan.buffer + (rq_p-&gt;scan.offset / 8);
-				tdo_mask = 1 &lt;&lt; (rq_p-&gt;scan.offset % 8);
-
-
-				bit_cnt = rq_p-&gt;scan.length;
-				if(bit_cnt &gt;= 8) {
-					/* bytes */
-
-					dtc_mask = 1 &lt;&lt; (8 - 1);
-
-					for(
-						;
-						bit_cnt;
-						bit_cnt--
-					) {
-						if(*dtc_p &amp; dtc_mask) {
-							*tdo_p |= tdo_mask;
-						} else {
-							*tdo_p &amp;=~ tdo_mask;
-						}
-						
-						dtc_mask &gt;&gt;= 1;
-						if(dtc_mask == 0) {
-							dtc_p++;
-							dtc_mask = 1 &lt;&lt; (8 - 1);
-						}
-
-						tdo_mask &lt;&lt;= 1;
-						if(tdo_mask == 0) {
-							tdo_p++;
-							tdo_mask = 1;
-						}
-					}
-				} else {
-					/*  extra bits or last bit */
-
-					x = *dtc_p++;
-					if((
-						rq_p-&gt;scan.type == SCAN_IN
-					) &amp;&amp; (
-						rq_p-&gt;scan.offset != rq_p-&gt;scan.size - 1
-					)) {
-						/* extra bits were sent as a full byte with padding on the end */
-						dtc_mask = 1 &lt;&lt; (8 - 1);
-					} else {
-						dtc_mask = 1 &lt;&lt; (bit_cnt - 1);
-					}
-
-					for(
-						;
-						bit_cnt;
-						bit_cnt--
-					) {
-						if(x &amp; dtc_mask) {
-							*tdo_p |= tdo_mask;
-						} else {
-							*tdo_p &amp;=~ tdo_mask;
-						}
-
-						dtc_mask &gt;&gt;= 1;
-
-						tdo_mask &lt;&lt;= 1;
-						if(tdo_mask == 0) {
-							tdo_p++;
-							tdo_mask = 1;
-						}
-								
-					}
-				}
-
-				if((rq_p-&gt;scan.offset + rq_p-&gt;scan.length) &gt;= rq_p-&gt;scan.size) {
-					/* feed scan buffer back into openocd and free it */
-					if(jtag_read_buffer(rq_p-&gt;scan.buffer, rq_p-&gt;cmd-&gt;cmd.scan) != ERROR_OK) {
-						 retval = ERROR_JTAG_QUEUE_FAILED;
-					}
-					free(rq_p-&gt;scan.buffer);
-				}
-
-				rq_next = rq_p-&gt;next;
-				free(rq_p);
-			}
-			dtc_queue.rq_head = NULL;
-			dtc_queue.rq_tail = NULL;
-		}
-
-	}
-
-
-	/* reset state for new appends */
-	dtc_queue.cmd_index = 0;
-	dtc_queue.reply_index = 0;
-
-	return(retval);
-}
-
-
-
-static
-int
-tap_state_queue_init(void) {
-	tap_state_queue.length = 0;
-	tap_state_queue.buffer = 0;
-	return(0);
-}
-
-
-static
-int
-tap_state_queue_run(void) {
-	int	i;
-	int	bits;
-	u8	byte;
-	int	retval;
-
-	retval = 0;
-	if(!tap_state_queue.length) return(retval);
-	bits = 1;
-	byte = 0;
-	for(i = tap_state_queue.length; i--;) {
-		
-		byte &lt;&lt;= 1;
-		if(tap_state_queue.buffer &amp; 1) {
-			byte |= 1;
-		}
-		if((bits &gt;= 8) || !i) {
-			byte &lt;&lt;= (8 - bits);
-
-			/* make sure there's room for stop, byte op, and one byte */
-			if(dtc_queue.cmd_index &gt;= (sizeof(dtc_queue.cmd_buffer) - (1 + 1 + 1))) {
-				dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
-					DTC_CMD_STOP;
-				dtc_queue_run();
-			}
-
-#ifdef USE_HARDWARE_SHIFTER_FOR_TMS
-			if(bits == 8) {
-				dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
-					DTC_CMD_SHIFT_TMS_BYTES(1);
-			} else {
-#endif
-				dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
-					DTC_CMD_SHIFT_TMS_BITS(bits);
-#ifdef USE_HARDWARE_SHIFTER_FOR_TMS
-			}
-#endif
-
-			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
-				byte;
-
-			byte = 0;
-			bits = 1;
-		} else {
-			bits++;
-		}
-
-		tap_state_queue.buffer &gt;&gt;= 1;
-	}
-	retval = tap_state_queue_init();
-	return(retval);
-}
-
-
-static
-int
-tap_state_queue_append(
-	u8	tms
-) {
-	int	retval;
-
-	if(tap_state_queue.length &gt;= sizeof(tap_state_queue.buffer) * 8) {
-		retval = tap_state_queue_run();
-		if(retval != 0) return(retval);
-	}
-
-	if(tms) {
-		tap_state_queue.buffer |= (1 &lt;&lt; tap_state_queue.length);
-	}
-	tap_state_queue.length++;
-
-	return(0);
-}
-
-
-static
-void rlink_end_state(enum tap_state state)
-{
-	if (tap_move_map[state] != -1)
-		end_state = state;
-	else
-	{
-		LOG_ERROR(&quot;BUG: %i is not a valid end state&quot;, state);
-		exit(-1);
-	}
-}
-
-
-static
-void rlink_state_move(void) {
-
-	int i=0, tms=0;
-	u8 tms_scan = TAP_MOVE(cur_state, end_state);
-
-	for (i = 0; i &lt; 7; i++)
-	{
-		tms = (tms_scan &gt;&gt; i) &amp; 1;
-		tap_state_queue_append(tms);
-	}
-
-	cur_state = end_state;
-}
-
-static
-void rlink_path_move(pathmove_command_t *cmd)
-{
-	int num_states = cmd-&gt;num_states;
-	int state_count;
-	int tms = 0;
-
-	state_count = 0;
-	while (num_states)
-	{
-		if (tap_transitions[cur_state].low == cmd-&gt;path[state_count])
-		{
-			tms = 0;
-		}
-		else if (tap_transitions[cur_state].high == cmd-&gt;path[state_count])
-		{
-			tms = 1;
-		}
-		else
-		{
-			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, jtag_state_name(cur_state), jtag_state_name(cmd-&gt;path[state_count]));
-			exit(-1);
-		}
-
-		tap_state_queue_append(tms);
-
-		cur_state = cmd-&gt;path[state_count];
-		state_count++;
-		num_states--;
-	}
-
-	end_state = cur_state;
-}
-
-
-static
-void rlink_runtest(int num_cycles)
-{
-	int i;
-
-	enum tap_state saved_end_state = end_state;
-
-	/* only do a state_move when we're not already in RTI */
-	if (cur_state != TAP_IDLE)
-	{
-		rlink_end_state(TAP_IDLE);
-		rlink_state_move();
-	}
-
-	/* execute num_cycles */
-	for (i = 0; i &lt; num_cycles; i++)
-	{
-		tap_state_queue_append(0);
-	}
-
-	/* finish in end_state */
-	rlink_end_state(saved_end_state);
-	if (cur_state != end_state)
-		rlink_state_move();
-}
-
-
-/* (1) assert or (0) deassert reset lines */
-static
-void rlink_reset(int trst, int srst)
-{
-	u8			bitmap;
-	int			usb_err;
-
-	bitmap = ((~(ST7_PA_NLINE_DRIVER_ENABLE)) &amp; ST7_PA_NUNASSERTED);
-
-	if(trst) {
-		bitmap &amp;= ~ST7_PA_NJTAG_TRST;
-	}
-	if(srst) {
-		bitmap &amp;= ~ST7_PA_NRLINK_RST;
-	}
-
-	usb_err = ep1_generic_commandl(
-		pHDev, 6,
-		 
-		EP1_CMD_MEMORY_WRITE,
-			ST7_PADR &gt;&gt; 8,
-			ST7_PADR,
-			1,
-			bitmap,
-		EP1_CMD_DTC_GET_CACHED_STATUS
-	);
-	if(usb_err &lt; 0) {
-		LOG_ERROR(&quot;%s: %s\n&quot;, __func__, usb_strerror());
-		exit(1);
-	}
-
-	usb_err = usb_bulk_read(
-		pHDev, USB_EP1IN_ADDR,
-		&amp;bitmap, 1,
-		USB_TIMEOUT_MS
-	);
-	if(usb_err &lt; 1) {
-		LOG_ERROR(&quot;%s: %s\n&quot;, __func__, usb_strerror());
-		exit(1);
-	}
-}
-
-
-static
-int
-rlink_scan(
-	jtag_command_t	*cmd,
-	enum scan_type	type,
-	u8			*buffer,
-	int			scan_size
-) {
-	int			ir_scan;
-	enum tap_state	saved_end_state;
-	int			byte_bits;
-	int			extra_bits;
-	int			chunk_bits;
-	int			chunk_bytes;
-	int			x;
-
-	int			tdi_bit_offset;
-	u8			tdi_mask, *tdi_p;
-	u8			dtc_mask;
-
-	if(scan_size &lt; 1) {
-		LOG_ERROR(&quot;scan_size cannot be less than 1 bit\n&quot;);
-		exit(1);
-	}
-
-	ir_scan = cmd-&gt;cmd.scan-&gt;ir_scan;
-
-	/* Move to the proper state before starting to shift TDI/TDO. */
-	if (!(
-		(!ir_scan &amp;&amp; (cur_state == TAP_DRSHIFT))
-		||
-		(ir_scan &amp;&amp; (cur_state == TAP_IRSHIFT))
-	)) {
-		saved_end_state = end_state;
-		rlink_end_state(ir_scan ? TAP_IRSHIFT : TAP_DRSHIFT);
-		rlink_state_move();
-		rlink_end_state(saved_end_state);
-	}
-
-	tap_state_queue_run();
-
-
-#if 0
-	printf(&quot;scan_size = %d, type=0x%x\n&quot;, scan_size, type);
-	{
-		int   i;
-
-		/* clear unused bits in scan buffer for ease of debugging */
-		/* (it makes diffing output easier) */
-		buffer[scan_size / 8] &amp;= ((1 &lt;&lt; ((scan_size - 1) % 8) + 1) - 1);
-
-		printf(&quot;before scan:&quot;);
-		for(i = 0; i &lt; (scan_size + 7) / 8; i++) {
-			printf(&quot; %02x&quot;, buffer[i]);
-		}
-		printf(&quot;\n&quot;);
-	}
-#endif
-
-	/* The number of bits that can be shifted as complete bytes */
-	byte_bits = (int)(scan_size - 1) / 8 * 8;
-	/* The number of bits left over, not counting the last bit */
-	extra_bits = (scan_size - 1) - byte_bits;
-
-	tdi_bit_offset = 0;
-	tdi_p = buffer;
-	tdi_mask = 1;
-
-	if(extra_bits &amp;&amp; (type == SCAN_OUT)) {
-		/* Schedule any extra bits into the DTC command buffer, padding as needed */
-		/* For SCAN_OUT, this comes before the full bytes so the (leading) padding bits will fall off the end */
-		/* make sure there's room for stop, byte op, and one byte */
-		if(
-			(dtc_queue.cmd_index &gt;= sizeof(dtc_queue.cmd_buffer) - (1 + 1 + 1))
-		) {
-			dtc_queue_run();
-		}
-
-		x = 0;
-		dtc_mask = 1 &lt;&lt; (extra_bits - 1);
-	
-		while(extra_bits--) {
-			if(*tdi_p &amp; tdi_mask) {
-				x |= dtc_mask;
-			}
-
-			dtc_mask &gt;&gt;= 1;
-
-			tdi_mask &lt;&lt;= 1;
-			if(tdi_mask == 0) {
-				tdi_p++;
-				tdi_mask = 1;
-			}
-		}
-
-		dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
-			DTC_CMD_SHIFT_TDI_BYTES(1);
-
-		dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = x;
-	}
-
-	/* Loop scheduling full bytes into the DTC command buffer */
-	while(byte_bits) {
-		if(type == SCAN_IN) {
-			/* make sure there's room for stop and byte op */
-			x = (dtc_queue.cmd_index &gt;= sizeof(dtc_queue.cmd_buffer) - (1 + 1));
-		} else {
-			/* make sure there's room for stop, byte op, and at least one byte */
-			x = (dtc_queue.cmd_index &gt;= sizeof(dtc_queue.cmd_buffer) - (1 + 1 + 1));
-		}
-
-		if(type != SCAN_OUT) {
-			/* make sure there's room for at least one reply byte */
-			x |= (dtc_queue.reply_index &gt;= USB_EP2IN_SIZE - (1));
-		}
-
-		if(x) {
-			dtc_queue_run();
-		}
-
-		chunk_bits = byte_bits;
-		/* we can only use up to 16 bytes at a time */
-		if(chunk_bits &gt; (16 * 8)) chunk_bits = (16 * 8);
-
-		if(type != SCAN_IN) {
-			/* how much is there room for, considering stop and byte op? */
-			x = (sizeof(dtc_queue.cmd_buffer) - (dtc_queue.cmd_index + 1 + 1)) * 8;
-			if(chunk_bits &gt; x) chunk_bits = x;
-		}
-
-		if(type != SCAN_OUT) {
-			/* how much is there room for in the reply buffer? */
-			x = (USB_EP2IN_SIZE - dtc_queue.reply_index) * 8;
-			if(chunk_bits &gt; x) chunk_bits = x;
-		}
-
-		/* so the loop will end */
-		byte_bits -= chunk_bits;
-
-		if(type != SCAN_OUT) {
-			if(dtc_queue_enqueue_reply(
-				type, buffer, scan_size, tdi_bit_offset,
-				chunk_bits,
-				cmd
-			) == NULL) {
-				LOG_ERROR(&quot;enqueuing DTC reply entry: %s\n&quot;, strerror(errno));
-				exit(1);
-			}
-			
-			tdi_bit_offset += chunk_bits;
-		}
-
-		/* chunk_bits is a multiple of 8, so there are no rounding issues. */
-		chunk_bytes = chunk_bits / 8;
-
-		switch(type) {
-			case SCAN_IN:
-				x = DTC_CMD_SHIFT_TDO_BYTES(chunk_bytes);
-				break;
-			case SCAN_OUT:
-				x = DTC_CMD_SHIFT_TDI_BYTES(chunk_bytes);
-				break;
-			default:
-				x = DTC_CMD_SHIFT_TDIO_BYTES(chunk_bytes);
-				break;
-		}
-		dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = x;
-
-		if(type != SCAN_IN) {
-			x = 0;
-			dtc_mask = 1 &lt;&lt; (8 - 1);
-		
-			while(chunk_bits--) {
-				if(*tdi_p &amp; tdi_mask) {
-					x |= dtc_mask;
-				}
-	
-				dtc_mask &gt;&gt;= 1;
-				if(dtc_mask == 0) {
-					dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = x;
-					dtc_queue.reply_index++;
-					x = 0;
-					dtc_mask = 1 &lt;&lt; (8 - 1);
-				}
-	
-				tdi_mask &lt;&lt;= 1;
-				if(tdi_mask == 0) {
-					tdi_p++;
-					tdi_mask = 1;
-				}
-			}
-		}
-	}
-
-	if(extra_bits &amp;&amp; (type != SCAN_OUT)) {
-		/* Schedule any extra bits into the DTC command buffer */
-		/* make sure there's room for stop, byte op, and one byte */
-		if(
-			(dtc_queue.cmd_index &gt;= sizeof(dtc_queue.cmd_buffer) - (1 + 1 + 1))
-			||
-			(dtc_queue.reply_index &gt;= USB_EP2IN_SIZE - (1))
-		) {
-			dtc_queue_run();
-		}
-
-		if(dtc_queue_enqueue_reply(
-			type, buffer, scan_size, tdi_bit_offset,
-			extra_bits,
-			cmd
-		) == NULL) {
-			LOG_ERROR(&quot;enqueuing DTC reply entry: %s\n&quot;, strerror(errno));
-			exit(1);
-		}
-			
-		tdi_bit_offset += extra_bits;
-
-		if(type == SCAN_IN) {
-			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
-				DTC_CMD_SHIFT_TDO_BYTES(1);
-
-		} else {
-			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
-				DTC_CMD_SHIFT_TDIO_BITS(extra_bits);
-
-			x = 0;
-			dtc_mask = 1 &lt;&lt; (8 - 1);
-		
-			while(extra_bits--) {
-				if(*tdi_p &amp; tdi_mask) {
-					x |= dtc_mask;
-				}
-	
-				dtc_mask &gt;&gt;= 1;
-	
-				tdi_mask &lt;&lt;= 1;
-				if(tdi_mask == 0) {
-					tdi_p++;
-					tdi_mask = 1;
-				}
-			}
-
-			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = x;
-		}
-
-		dtc_queue.reply_index++;
-	}
-
-	/* Schedule the last bit into the DTC command buffer */
-	{
-		/* make sure there's room for stop, and bit pair command */
-		if(
-			(dtc_queue.cmd_index &gt;= sizeof(dtc_queue.cmd_buffer) - (1 + 1))
-			||
-			(dtc_queue.reply_index &gt;= USB_EP2IN_SIZE - (1))
-		) {
-			dtc_queue_run();
-		}
-
-		if(type == SCAN_OUT) {
-			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] =
-				DTC_CMD_SHIFT_TMS_TDI_BIT_PAIR(1, (*tdi_p &amp; tdi_mask), 0);
-
-		} else {
-			if(dtc_queue_enqueue_reply(
-				type, buffer, scan_size, tdi_bit_offset,
-				1,
-				cmd
-			) == NULL) {
-				LOG_ERROR(&quot;enqueuing DTC reply entry: %s\n&quot;, strerror(errno));
-				exit(1);
-			}
-			
-			dtc_queue.cmd_buffer[dtc_queue.cmd_index++] = 
-				DTC_CMD_SHIFT_TMS_TDI_BIT_PAIR(1, (*tdi_p &amp; tdi_mask), 1);
-
-			dtc_queue.reply_index++;
-		}
-	}
-
-	/* Move to pause state */
-	tap_state_queue_append(0);
-	cur_state = ir_scan ? TAP_IRPAUSE : TAP_DRPAUSE;
-	if (cur_state != end_state) rlink_state_move();
-
-	return(0);
-}
-
-
-static
-int rlink_execute_queue(void)
-{
-	jtag_command_t *cmd = jtag_command_queue; /* currently processed command */
-	int scan_size;
-	enum scan_type type;
-	u8 *buffer;
-	int retval, tmp_retval;
-
-	/* return ERROR_OK, unless something goes wrong */
-	retval = ERROR_OK;
-
-#ifndef AUTOMATIC_BUSY_LED
-	/* turn LED on */
-	ep1_generic_commandl(pHDev, 2,
-		EP1_CMD_SET_PORTD_LEDS,
-		~(ST7_PD_NBUSY_LED)
-	);
-#endif
-
-	while (cmd)
-	{
-		switch (cmd-&gt;type)
-		{
-			case JTAG_END_STATE:
-			case JTAG_RUNTEST:
-			case JTAG_STATEMOVE:
-			case JTAG_PATHMOVE:
-			case JTAG_SCAN:
-				break;
-
-			default:
-				/* some events, such as resets, need a queue flush to ensure consistency */
-				tap_state_queue_run();
-				dtc_queue_run();
-				break;
-		}
-
-		switch (cmd-&gt;type)
-		{
-			case JTAG_END_STATE:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;end_state: %i&quot;, cmd-&gt;cmd.end_state-&gt;end_state);
-#endif
-				if (cmd-&gt;cmd.end_state-&gt;end_state != -1)
-					rlink_end_state(cmd-&gt;cmd.end_state-&gt;end_state);
-				break;
-			case JTAG_RESET:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;reset trst: %i srst %i&quot;, cmd-&gt;cmd.reset-&gt;trst, cmd-&gt;cmd.reset-&gt;srst);
-#endif
-				if ((cmd-&gt;cmd.reset-&gt;trst == 1) || (cmd-&gt;cmd.reset-&gt;srst &amp;&amp; (jtag_reset_config &amp; RESET_SRST_PULLS_TRST)))
-				{
-					cur_state = TAP_RESET;
-				}
-				rlink_reset(cmd-&gt;cmd.reset-&gt;trst, cmd-&gt;cmd.reset-&gt;srst);
-				break;
-			case JTAG_RUNTEST:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;runtest %i cycles, end in %i&quot;, cmd-&gt;cmd.runtest-&gt;num_cycles, cmd-&gt;cmd.runtest-&gt;end_state);
-#endif
-				if (cmd-&gt;cmd.runtest-&gt;end_state != -1)
-					rlink_end_state(cmd-&gt;cmd.runtest-&gt;end_state);
-				rlink_runtest(cmd-&gt;cmd.runtest-&gt;num_cycles);
-				break;
-			case JTAG_STATEMOVE:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;statemove end in %i&quot;, cmd-&gt;cmd.statemove-&gt;end_state);
-#endif
-				if (cmd-&gt;cmd.statemove-&gt;end_state != -1)
-					rlink_end_state(cmd-&gt;cmd.statemove-&gt;end_state);
-				rlink_state_move();
-				break;
-			case JTAG_PATHMOVE:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;pathmove: %i states, end in %i&quot;, cmd-&gt;cmd.pathmove-&gt;num_states, cmd-&gt;cmd.pathmove-&gt;path[cmd-&gt;cmd.pathmove-&gt;num_states - 1]);
-#endif
-				rlink_path_move(cmd-&gt;cmd.pathmove);
-				break;
-			case JTAG_SCAN:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;%s scan end in %i&quot;,  (cmd-&gt;cmd.scan-&gt;ir_scan) ? &quot;IR&quot; : &quot;DR&quot;, cmd-&gt;cmd.scan-&gt;end_state);
-#endif
-				if (cmd-&gt;cmd.scan-&gt;end_state != -1)
-					rlink_end_state(cmd-&gt;cmd.scan-&gt;end_state);
-				scan_size = jtag_build_buffer(cmd-&gt;cmd.scan, &amp;buffer);
-				type = jtag_scan_type(cmd-&gt;cmd.scan);
-				if(rlink_scan(cmd, type, buffer, scan_size) != ERROR_OK) {
-					retval = ERROR_FAIL;
-				}
-				break;
-			case JTAG_SLEEP:
-#ifdef _DEBUG_JTAG_IO_
-				LOG_DEBUG(&quot;sleep %i&quot;, cmd-&gt;cmd.sleep-&gt;us);
-#endif
-				jtag_sleep(cmd-&gt;cmd.sleep-&gt;us);
-				break;
-			default:
-				LOG_ERROR(&quot;BUG: unknown JTAG command type encountered&quot;);
-				exit(-1);
-		}
-		cmd = cmd-&gt;next;
-	}
-
-	/* Flush the DTC queue to make sure any pending reads have been done before exiting this function */
-	tap_state_queue_run();
-	tmp_retval = dtc_queue_run();
-	if(tmp_retval != ERROR_OK) {
-		retval = tmp_retval;
-	}
-
-#ifndef AUTOMATIC_BUSY_LED
-	/* turn LED onff */
-	ep1_generic_commandl(pHDev, 2,
-		EP1_CMD_SET_PORTD_LEDS,
-		~0
-	);
-#endif
-
-	return retval;
-}
-
-
-/* Using an unindexed table because it is infrequently accessed and it is short.  The table must be in order of ascending speed (and descending prescaler), as it is scanned in reverse. */
-
-static
-int rlink_speed(int speed)
-{
-	int		i;
-
-	if(speed == 0) {
-		/* fastest speed */
-		speed = rlink_speed_table[rlink_speed_table_size - 1].prescaler;
-	}
-
-	for(i = rlink_speed_table_size; i--; ) {
-		if(rlink_speed_table[i].prescaler == speed) {
-			if(dtc_load_from_buffer(pHDev, rlink_speed_table[i].dtc, rlink_speed_table[i].dtc_size) != 0) {
-				LOG_ERROR(&quot;An error occurred while trying to load DTC code for speed \&quot;%d\&quot;.\n&quot;, speed);
-				exit(1);
-			}
-	
-			if(dtc_start_download() &lt; 0) {
-				LOG_ERROR(&quot;%s, %d: starting DTC: %s&quot;,
-					__FILE__, __LINE__,
-					usb_strerror()
-				);
-				exit(1);
-			}
-
-			return ERROR_OK;
-		}
-	}
-
-	LOG_ERROR(&quot;%d is not a supported speed&quot;, speed);
-	return(ERROR_FAIL);
-}
-
-
-static
-int rlink_speed_div(
-	int speed,
-	int *khz
-) {
-	int	i;
-
-	for(i = rlink_speed_table_size; i--; ) {
-		if(rlink_speed_table[i].prescaler == speed) {
-			*khz = rlink_speed_table[i].khz;
-			return(ERROR_OK);
-		}
-	}
-
-	LOG_ERROR(&quot;%d is not a supported speed&quot;, speed);
-	return(ERROR_FAIL);
-}
-
-
-static
-int rlink_khz(
-	int khz,
-	int *speed
-) {
-	int	i;
-
-	if(khz == 0) {
-		LOG_ERROR(&quot;RCLK not supported&quot;);
-		return ERROR_FAIL;
-	}
-
-	for(i = rlink_speed_table_size; i--; ) {
-		if(rlink_speed_table[i].khz &lt;= khz) {
-			*speed = rlink_speed_table[i].prescaler;
-			return(ERROR_OK);
-		}
-	}
-
-	LOG_WARNING(&quot;The lowest supported JTAG speed is %d KHz&quot;, rlink_speed_table[0].khz);
-	*speed = rlink_speed_table[0].prescaler;
-	return(ERROR_OK);
-}
-
-
-#if 0
-static
-int
-handle_dtc_directory_command(
-	struct command_context_s *cmd_ctx,
-	char *cmd,
-	char **args,
-	int argc
-) {
-	if(argc != 1) {
-		LOG_ERROR(&quot;expected exactly one argument to rlink_dtc_directory &lt;directory-path&gt;&quot;);
-		return(ERROR_INVALID_ARGUMENTS);
-	}
-
-	printf(&quot;handle_dtc_directory_command called with \&quot;%s\&quot;\n&quot;, args[0]);
-
-	return(ERROR_OK);
-}
-#endif
-
-
-static
-int rlink_register_commands(struct command_context_s *cmd_ctx)
-{
-
-#ifdef _DEBUG_JTAG_IO_
-	LOG_DEBUG(&quot;rlink_register_commands called with cmd_ctx=%p\n&quot;, cmd_ctx);
-#endif
-
-#if 0
-	register_command(
-		cmd_ctx, NULL,
-		&quot;rlink_dtc_directory&quot;,
-		handle_dtc_directory_command,
-		COMMAND_CONFIG,
-		&quot;The directory in which to search for DTC load images&quot;
-	);
-#endif
-
-	return ERROR_OK;
-}
-
-
-static
-int rlink_init(void)
-{
-	struct usb_bus *busses;
-	struct usb_bus *bus;
-	int i, j, retries;
-	int found=0;
-	int success=0;
-	u8 reply_buffer[USB_EP1IN_SIZE];
-
-	usb_init();
-	usb_find_busses();
-	usb_find_devices();
-
-	busses = usb_get_busses();
-
-	for(bus = busses; bus; bus = bus-&gt;next)
-	{
-		struct usb_device *dev;
-
-		for(dev = bus-&gt;devices; dev; dev = dev-&gt;next)
-		{
-			if( (dev-&gt;descriptor.idVendor == USB_IDVENDOR) &amp;&amp; (dev-&gt;descriptor.idProduct == USB_IDPRODUCT) )
-			{
-				found = 1;
-				LOG_DEBUG(&quot;Found device on bus.\n&quot;);
-
-				do
-				{
-					if( dev-&gt;descriptor.bNumConfigurations &gt; 1 )
-					{
-						LOG_ERROR(&quot;Whoops! NumConfigurations is not 1, don't know what to do...\n&quot;);
-						break;
-					}
-					if( dev-&gt;config-&gt;bNumInterfaces &gt; 1 )
-					{
-						LOG_ERROR(&quot;Whoops! NumInterfaces is not 1, don't know what to do...\n&quot;);
-						break;
-					}
-
-					pHDev=usb_open(dev);
-					if( !pHDev )
-						LOG_ERROR (&quot;Failed to open device.\n&quot;);
-					else
-					{
-						LOG_DEBUG(&quot;Opened device, pHDev = %p\n&quot;,pHDev);
-
-						/* usb_set_configuration required under win32 */
-						usb_set_configuration(pHDev, dev-&gt;config[0].bConfigurationValue);
-						
-						retries = 3;
-						do
-						{
-							i = usb_claim_interface(pHDev,0);
-							if(i)
-							{
-								LOG_ERROR(&quot;usb_claim_interface: %s&quot;, usb_strerror());
-#ifdef LIBUSB_HAS_DETACH_KERNEL_DRIVER_NP
-								j = usb_detach_kernel_driver_np(pHDev, 0);
-								if(j)
-									LOG_ERROR(&quot;detach kernel driver: %s&quot;, usb_strerror());
-#endif
-							}
-							else
-							{
-								LOG_DEBUG(&quot;interface claimed!\n&quot;);
-								break;
-							}
-						} while(--retries);
-
-						if(!i)
-						{
-							if( usb_set_altinterface(pHDev,0) )
-							{
-								LOG_ERROR(&quot;Failed to set interface.\n&quot;);
-								break;
-							}
-							else
-								success=1;
-						}
-					}
-				} while(0);
-			}
-		}
-	}
-
-	if( !found )
-	{
-		LOG_ERROR(&quot;No device found on bus.\n&quot;);
-		exit(1);
-	}
-
-	if( !success )
-	{
-		LOG_ERROR(&quot;Initialisation failed.&quot;);
-		exit(1);
-	}
-
-
-	/* The device starts out in an unknown state on open.  As such, result reads time out, and it's not even known whether the command was accepted.  So, for this first command, we issue it repeatedly until its response doesn't time out.  Also, if sending a command is going to time out, we'll find that out here. */
-	/* It must be possible to open the device in such a way that this special magic isn't needed, but, so far, it escapes us. */
-	for(i = 0; i &lt; 5; i++) {
-		j = ep1_generic_commandl(
-			pHDev, 1,
-			EP1_CMD_GET_FWREV
-		);
-		if(j &lt; USB_EP1OUT_SIZE) {
-			LOG_ERROR(&quot;USB write error: %s&quot;, usb_strerror());
-			return(ERROR_FAIL);
-		}
-		j = usb_bulk_read(
-			pHDev, USB_EP1IN_ADDR,
-			(char *)reply_buffer, sizeof(reply_buffer),
-			200
-		);
-		if(j != -ETIMEDOUT) break;
-	}
-
-	if(j &lt; (int)sizeof(reply_buffer)) {
-		LOG_ERROR(&quot;USB read error: %s&quot;, usb_strerror());
-		return(ERROR_FAIL);
-	}
-	LOG_DEBUG(INTERFACE_NAME&quot; firmware version: %d.%d.%d\n&quot;, reply_buffer[0], reply_buffer[1], reply_buffer[2]);
-
-	if((reply_buffer[0] != 0) || (reply_buffer[1] != 0) || (reply_buffer[2] != 3)) {
-		LOG_WARNING(&quot;The rlink device is not of the version that the developers have played with.  It may or may not work.\n&quot;);
-	}
-
-	/* Probe port E for adapter presence */
-	ep1_generic_commandl(
-		pHDev, 16,
-		EP1_CMD_MEMORY_WRITE,	/* Drive sense pin with 0 */
-			ST7_PEDR &gt;&gt; 8,
-			ST7_PEDR,
-			3,
-			0x00,
-			ST7_PE_ADAPTER_SENSE_OUT,
-			ST7_PE_ADAPTER_SENSE_OUT,
-		EP1_CMD_MEMORY_READ,	/* Read back */
-			ST7_PEDR &gt;&gt; 8,
-			ST7_PEDR,
-			1,
-		EP1_CMD_MEMORY_WRITE,	/* Drive sense pin with 1 */
-			ST7_PEDR &gt;&gt; 8,
-			ST7_PEDR,
-			1,
-			ST7_PE_ADAPTER_SENSE_OUT
-	);
-
-	usb_bulk_read(
-		pHDev, USB_EP1IN_ADDR,
-		(char *)reply_buffer, 1,
-		USB_TIMEOUT_MS
-	);
-
-	if((reply_buffer[0] &amp; ST7_PE_ADAPTER_SENSE_IN) != 0) {
-		LOG_WARNING(&quot;target detection problem\n&quot;);
-	}
-
-	ep1_generic_commandl(
-		pHDev, 11,
-		EP1_CMD_MEMORY_READ,	/* Read back */
-			ST7_PEDR &gt;&gt; 8,
-			ST7_PEDR,
-			1,
-		EP1_CMD_MEMORY_WRITE,	/* float port E */
-			ST7_PEDR &gt;&gt; 8,
-			ST7_PEDR,
-			3,
-			0x00,
-			0x00,
-			0x00
-	);
-
-	usb_bulk_read(
-		pHDev, USB_EP1IN_ADDR,
-		(char *)reply_buffer, 1,
-		USB_TIMEOUT_MS
-	);
-
-
-	if((reply_buffer[0] &amp; ST7_PE_ADAPTER_SENSE_IN) == 0) {
-		LOG_WARNING(&quot;target not plugged in\n&quot;);
-	}
-
-	/* float port A, make sure DTC is stopped, set upper 2 bits of port D, and set up port A */
-	ep1_generic_commandl(
-		pHDev, 15,
-		EP1_CMD_MEMORY_WRITE,
-			ST7_PADDR &gt;&gt; 8,
-			ST7_PADDR,
-			2,
-			0x00,
-			0x00,
-		EP1_CMD_DTC_STOP,
-		EP1_CMD_SET_PORTD_UPPER,
-			~(ST7_PD_NRUN_LED),
-		EP1_CMD_MEMORY_WRITE,
-			ST7_PADR &gt;&gt; 8,
-			ST7_PADR,
-			2,
-			((~(ST7_PA_NLINE_DRIVER_ENABLE)) &amp; ST7_PA_NUNASSERTED),
-			(ST7_PA_NLINE_DRIVER_ENABLE | ST7_PA_NRLINK_RST | ST7_PA_NJTAG_TRST)
-	);
-
-	/* set LED updating mode and make sure they're unlit */
-	ep1_generic_commandl(
-		pHDev, 3,
-#ifdef AUTOMATIC_BUSY_LED
-		EP1_CMD_LEDUE_BUSY,
-#else
-		EP1_CMD_LEDUE_NONE,
-#endif
-		EP1_CMD_SET_PORTD_LEDS,
-			~0
-	);
-
-	tap_state_queue_init();
-	dtc_queue_init();
-	rlink_speed(jtag_speed);
-	rlink_reset(0, 0);
-
-	return ERROR_OK;
-}
-
-
-static
-int rlink_quit(void)
-{
-	/* stop DTC and make sure LEDs are off */
-	ep1_generic_commandl(
-		pHDev, 6,
-		EP1_CMD_DTC_STOP,
-		EP1_CMD_LEDUE_NONE,
-		EP1_CMD_SET_PORTD_LEDS,
-			~0,
-		EP1_CMD_SET_PORTD_UPPER,
-			~0
-	);
-
-	usb_release_interface(pHDev,0);
-	usb_close(pHDev);
-
-
-	return ERROR_OK;
-}
-
-
-jtag_interface_t rlink_interface =
-{
-	.name = &quot;rlink&quot;,
-	.init = rlink_init,
-	.quit = rlink_quit,
-	.register_commands = rlink_register_commands,
-	.speed = rlink_speed,
-	.speed_div = rlink_speed_div,
-	.khz = rlink_khz,
-	.execute_queue = rlink_execute_queue,
-};

Copied: branches/openocd-0.1/src/jtag/rlink/rlink.c (from rev 1324, trunk/src/jtag/rlink/rlink.c)

Deleted: branches/openocd-0.1/src/jtag/rlink/rlink.h
===================================================================
--- trunk/src/jtag/rlink/rlink.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/rlink/rlink.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,33 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2008 Lou Deluxe                                         *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>                                   *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-#include &quot;types.h&quot;
-#include &lt;sys/types.h&gt;
-
-typedef
-struct rlink_speed_table_s {
-	u8 const	*dtc;
-	u16			dtc_size;
-	u16			khz;
-	u8			prescaler;
-} rlink_speed_table_t;
-
-extern const rlink_speed_table_t	rlink_speed_table[];
-extern const size_t					rlink_speed_table_size;

Copied: branches/openocd-0.1/src/jtag/rlink/rlink.h (from rev 1324, trunk/src/jtag/rlink/rlink.h)

Deleted: branches/openocd-0.1/src/jtag/rlink/rlink_speed_table.c
===================================================================
--- trunk/src/jtag/rlink/rlink_speed_table.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/rlink/rlink_speed_table.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,98 +0,0 @@
-/* This file was created automatically by ../../../tools/rlink_make_speed_table/rlink_make_speed_table.pl. */
-
-#include &quot;rlink.h&quot;
-#include &quot;st7.h&quot;
-
-static const u8 dtc_64[] = {
-	0, 2, 68, 84, 67, 2, 13, 160, 176, 151, 147, 182, 141, 152, 177, 129, 148,
-	191, 143, 142, 5, 3, 0, 0, 0, 2, 68, 84, 67, 4, 0, 192, 5, 15, 0, 42, 42,
-	42, 73, 0, 88, 0, 160, 189, 0, 0, 0, 0, 106, 9, 1, 8, 22, 100, 111, 119,
-	110, 108, 111, 97, 100, 2, 226, 7, 219, 39, 137, 51, 172, 130, 192, 96,
-	175, 191, 130, 217, 128, 57, 69, 177, 159, 179, 68, 178, 159, 193, 133,
-	153, 176, 159, 130, 132, 135, 164, 134, 51, 129, 60, 223, 9, 98, 128, 177,
-	129, 96, 201, 160, 130, 201, 51, 137, 201, 57, 68, 160, 176, 67, 219, 39,
-	154, 201, 40, 69, 219, 39, 150, 17, 27, 205, 51, 43, 99, 60, 118, 193,
-	96, 201, 160, 130, 24, 205, 51, 43, 99, 218, 156, 47, 60, 105, 193, 96,
-	201, 160, 138, 166, 178, 136, 160, 183, 139, 86, 202, 8, 2, 36, 138, 105,
-	193, 96, 201, 160, 43, 139, 167, 181, 136, 70, 177, 147, 67, 193, 96, 219,
-	39, 131, 161, 176, 130, 195, 53, 131, 178, 10, 66, 176, 151, 60, 97, 58,
-	151, 215, 2, 40, 66, 1, 0, 160, 185, 130, 60, 97, 203, 130, 60, 194, 139,
-	127, 195, 53, 156, 47, 200, 96, 201, 56, 177, 66, 176, 147, 201, 57, 168,
-	66, 160, 38, 155, 160, 176, 139, 171, 182, 136, 167, 183, 96, 201, 59,
-	66, 46, 193, 151, 96, 201, 160, 139, 219, 39, 131, 160, 191, 130, 195,
-	53, 131, 177, 10, 66, 176, 147, 151, 0, 60, 97, 58, 151, 0, 160, 185, 130,
-	60, 97, 203, 8, 2, 36, 139, 124, 193, 151, 96
-};
-
-static const u8 dtc_11[] = {
-	0, 2, 68, 84, 67, 2, 13, 160, 176, 151, 147, 182, 141, 152, 177, 129, 148,
-	188, 143, 142, 5, 3, 0, 0, 0, 2, 68, 84, 67, 4, 0, 192, 5, 15, 0, 42, 42,
-	42, 73, 0, 88, 0, 154, 183, 0, 0, 0, 0, 106, 9, 1, 8, 22, 100, 111, 119,
-	110, 108, 111, 97, 100, 2, 213, 7, 219, 39, 137, 51, 172, 130, 192, 96,
-	175, 191, 130, 217, 128, 57, 69, 177, 159, 179, 68, 178, 159, 193, 133,
-	153, 176, 159, 130, 132, 135, 164, 134, 51, 129, 60, 223, 9, 98, 128, 177,
-	129, 96, 201, 160, 130, 201, 51, 137, 201, 57, 68, 160, 176, 67, 219, 39,
-	154, 201, 40, 69, 219, 39, 150, 17, 27, 205, 51, 43, 99, 60, 118, 193,
-	96, 201, 160, 130, 24, 205, 51, 43, 99, 218, 156, 47, 60, 105, 193, 96,
-	201, 160, 138, 166, 178, 136, 160, 183, 139, 86, 202, 8, 2, 36, 138, 105,
-	193, 96, 201, 160, 43, 139, 167, 181, 136, 70, 177, 147, 67, 193, 96, 219,
-	39, 131, 195, 53, 131, 178, 10, 66, 176, 151, 0, 0, 0, 0, 0, 58, 151, 215,
-	2, 40, 66, 1, 203, 130, 60, 194, 139, 121, 195, 53, 156, 47, 200, 96, 201,
-	56, 177, 66, 176, 147, 201, 57, 168, 66, 160, 38, 155, 160, 176, 139, 171,
-	176, 136, 167, 183, 96, 201, 59, 66, 46, 193, 151, 96, 201, 160, 139, 219,
-	39, 131, 195, 53, 131, 177, 10, 66, 176, 147, 151, 0, 0, 0, 0, 0, 58, 151,
-	203, 8, 2, 36, 139, 117, 193, 151, 96
-};
-
-static const u8 dtc_8[] = {
-	0, 2, 68, 84, 67, 2, 13, 160, 176, 151, 147, 182, 141, 152, 177, 129, 148,
-	187, 143, 142, 5, 3, 0, 0, 0, 2, 68, 84, 67, 4, 0, 192, 5, 15, 0, 42, 42,
-	42, 73, 0, 88, 0, 152, 181, 0, 0, 0, 0, 106, 9, 1, 8, 22, 100, 111, 119,
-	110, 108, 111, 97, 100, 2, 209, 7, 219, 39, 137, 51, 172, 130, 192, 96,
-	175, 191, 130, 217, 128, 57, 69, 177, 159, 179, 68, 178, 159, 193, 133,
-	153, 176, 159, 130, 132, 135, 164, 134, 51, 129, 60, 223, 9, 98, 128, 177,
-	129, 96, 201, 160, 130, 201, 51, 137, 201, 57, 68, 160, 176, 67, 219, 39,
-	154, 201, 40, 69, 219, 39, 150, 17, 27, 205, 51, 43, 99, 60, 118, 193,
-	96, 201, 160, 130, 24, 205, 51, 43, 99, 218, 156, 47, 60, 105, 193, 96,
-	201, 160, 138, 166, 178, 136, 160, 183, 139, 86, 202, 8, 2, 36, 138, 105,
-	193, 96, 201, 160, 43, 139, 167, 181, 136, 70, 177, 147, 67, 193, 96, 219,
-	39, 131, 195, 53, 131, 178, 10, 66, 176, 151, 0, 0, 0, 58, 151, 215, 2,
-	40, 66, 1, 203, 130, 60, 194, 139, 119, 195, 53, 156, 47, 200, 96, 201,
-	56, 177, 66, 176, 147, 201, 57, 168, 66, 160, 38, 155, 160, 176, 139, 170,
-	190, 136, 167, 183, 96, 201, 59, 66, 46, 193, 151, 96, 201, 160, 139, 219,
-	39, 131, 195, 53, 131, 177, 10, 66, 176, 147, 151, 0, 0, 0, 58, 151, 203,
-	8, 2, 36, 139, 115, 193, 151, 96
-};
-
-static const u8 dtc_2[] = {
-	0, 2, 68, 84, 67, 2, 14, 160, 176, 151, 147, 182, 141, 152, 177, 129, 148,
-	186, 143, 185, 142, 5, 3, 0, 0, 0, 2, 68, 84, 67, 4, 0, 192, 5, 15, 0,
-	42, 42, 42, 73, 0, 88, 0, 149, 178, 0, 0, 0, 0, 106, 9, 1, 8, 22, 100,
-	111, 119, 110, 108, 111, 97, 100, 2, 203, 7, 219, 39, 137, 51, 172, 130,
-	192, 96, 175, 191, 130, 217, 128, 57, 69, 177, 159, 179, 68, 178, 159,
-	193, 133, 153, 176, 159, 130, 132, 135, 164, 134, 51, 129, 60, 223, 9,
-	98, 128, 177, 129, 96, 201, 160, 130, 201, 51, 137, 201, 57, 68, 160, 176,
-	67, 219, 39, 154, 201, 40, 69, 219, 39, 150, 17, 27, 205, 51, 43, 99, 60,
-	118, 193, 96, 201, 160, 130, 24, 205, 51, 43, 99, 218, 156, 47, 60, 105,
-	193, 96, 201, 160, 138, 166, 178, 136, 160, 183, 139, 86, 202, 8, 2, 36,
-	138, 105, 193, 96, 201, 160, 43, 139, 167, 181, 136, 70, 177, 147, 67,
-	193, 96, 219, 39, 131, 195, 53, 131, 178, 10, 66, 176, 151, 58, 151, 215,
-	2, 40, 66, 1, 203, 130, 60, 194, 139, 116, 195, 53, 156, 47, 200, 96, 201,
-	56, 177, 66, 176, 147, 201, 57, 168, 66, 160, 38, 155, 160, 176, 139, 170,
-	187, 136, 167, 183, 96, 201, 59, 66, 46, 193, 151, 96, 201, 160, 139, 219,
-	39, 131, 195, 53, 131, 177, 10, 66, 176, 147, 151, 58, 151, 203, 8, 2,
-	36, 139, 112, 193, 151, 96
-};
-
-const rlink_speed_table_t rlink_speed_table[] = {{
-	dtc_64, sizeof(dtc_64), (ST7_FOSC * 2) / (1000 * 64), 64
-}, {
-	dtc_11, sizeof(dtc_11), (ST7_FOSC * 2) / (1000 * 11), 11
-}, {
-	dtc_8, sizeof(dtc_8), (ST7_FOSC * 2) / (1000 * 8), 8
-}, {
-	dtc_2, sizeof(dtc_2), (ST7_FOSC * 2) / (1000 * 2), 2
-}};
-
-const size_t rlink_speed_table_size = sizeof(rlink_speed_table) / sizeof(*rlink_speed_table);
-

Copied: branches/openocd-0.1/src/jtag/rlink/rlink_speed_table.c (from rev 1324, trunk/src/jtag/rlink/rlink_speed_table.c)

Deleted: branches/openocd-0.1/src/jtag/rlink/st7.h
===================================================================
--- trunk/src/jtag/rlink/st7.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/rlink/st7.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,114 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2008 Lou Deluxe                                         *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>                                   *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-#define ST7_FOSC		(12 * 1000000)
-
-/* This is not a complete enumeration of ST7 registers, but it is sufficient for this interface driver. */
-
-#define ST7_PADR		(0x0000)
-#define ST7_PADDR		(ST7_PADR + 1)
-#define ST7_PAOR		(ST7_PADR + 2)
-#define ST7_PBDR		(0x0003)
-#define ST7_PBDDR		(ST7_PBDR + 1)
-#define ST7_PCDR		(0x0006)
-#define ST7_PCDDR		(ST7_PCDR + 1)
-#define ST7_PCOR		(ST7_PCDR + 2)
-#define ST7_PDDR		(0x0009)
-#define ST7_PDDDR		(ST7_PDDR + 1)
-#define ST7_PDOR		(ST7_PDDR + 2)
-#define ST7_PEDR		(0x000c)
-#define ST7_PEDDR		(ST7_PEDR + 1)
-#define ST7_PEOR		(ST7_PEDR + 2)
-#define ST7_PFDR		(0x000f)
-#define ST7_PFDDR		(ST7_PFDR + 1)
-
-#define ST7_ADCDR		(0x0012)
-#define ST7_ADCCSR		(ST7_ADCDR + 1)
-
-#define ST7_EP2TXR		(0x003e)
-#define ST7_EP2TXR_STAT_TX0	(1 &lt;&lt; 0)
-#define ST7_EP2TXR_STAT_TX1	(1 &lt;&lt; 1)
-#define ST7_EP2TXR_STAT_DISABLED	(0)
-#define ST7_EP2TXR_STAT_STALL	(ST7_EP2TXR_STAT_TX0)
-#define ST7_EP2TXR_STAT_VALID	(ST7_EP2TXR_STAT_TX1 | ST7_EP2TXR_STAT_TX0)
-#define ST7_EP2TXR_STAT_NAK	(ST7_EP2TXR_STAT_TX1)
-#define ST7_EP2TXR_DTOG_TX	(1 &lt;&lt; 2)
-#define ST7_EP2TXR_CTR_TX	(1 &lt;&lt; 3)
-
-#define ST7_USB_BUF_EP0OUT	(0x1550)
-#define ST7_USB_BUF_EP0IN	(0x1560)
-#define ST7_USB_BUF_EP1OUT	(0x1570)
-#define ST7_USB_BUF_EP1IN	(0x1580)
-#define ST7_USB_BUF_EP2UODI	(0x1590)
-#define ST7_USB_BUF_EP2UIDO	(0x1650)
-
-#define ST7_PA0			(1 &lt;&lt; 0)
-#define ST7_PA1			(1 &lt;&lt; 1)
-#define ST7_PA2			(1 &lt;&lt; 2)
-#define ST7_PA3			(1 &lt;&lt; 3)
-#define ST7_PA4			(1 &lt;&lt; 4)
-#define ST7_PA5			(1 &lt;&lt; 5)
-#define ST7_PA6			(1 &lt;&lt; 6)
-#define ST7_PA7			(1 &lt;&lt; 7)
-
-#define ST7_PB0			(1 &lt;&lt; 0)
-#define ST7_PB1			(1 &lt;&lt; 1)
-#define ST7_PB2			(1 &lt;&lt; 2)
-#define ST7_PB3			(1 &lt;&lt; 3)
-#define ST7_PB4			(1 &lt;&lt; 4)
-#define ST7_PB5			(1 &lt;&lt; 5)
-#define ST7_PB6			(1 &lt;&lt; 6)
-#define ST7_PB7			(1 &lt;&lt; 7)
-
-#define ST7_PC0			(1 &lt;&lt; 0)
-#define ST7_PC1			(1 &lt;&lt; 1)
-#define ST7_PC2			(1 &lt;&lt; 2)
-#define ST7_PC3			(1 &lt;&lt; 3)
-#define ST7_PC4			(1 &lt;&lt; 4)
-#define ST7_PC5			(1 &lt;&lt; 5)
-#define ST7_PC6			(1 &lt;&lt; 6)
-#define ST7_PC7			(1 &lt;&lt; 7)
-
-#define ST7_PD0			(1 &lt;&lt; 0)
-#define ST7_PD1			(1 &lt;&lt; 1)
-#define ST7_PD2			(1 &lt;&lt; 2)
-#define ST7_PD3			(1 &lt;&lt; 3)
-#define ST7_PD4			(1 &lt;&lt; 4)
-#define ST7_PD5			(1 &lt;&lt; 5)
-#define ST7_PD6			(1 &lt;&lt; 6)
-#define ST7_PD7			(1 &lt;&lt; 7)
-
-#define ST7_PE0			(1 &lt;&lt; 0)
-#define ST7_PE1			(1 &lt;&lt; 1)
-#define ST7_PE2			(1 &lt;&lt; 2)
-#define ST7_PE3			(1 &lt;&lt; 3)
-#define ST7_PE4			(1 &lt;&lt; 4)
-#define ST7_PE5			(1 &lt;&lt; 5)
-#define ST7_PE6			(1 &lt;&lt; 6)
-#define ST7_PE7			(1 &lt;&lt; 7)
-
-#define ST7_PF0			(1 &lt;&lt; 0)
-#define ST7_PF1			(1 &lt;&lt; 1)
-#define ST7_PF2			(1 &lt;&lt; 2)
-#define ST7_PF3			(1 &lt;&lt; 3)
-#define ST7_PF4			(1 &lt;&lt; 4)
-#define ST7_PF5			(1 &lt;&lt; 5)
-#define ST7_PF6			(1 &lt;&lt; 6)
-#define ST7_PF7			(1 &lt;&lt; 7)

Copied: branches/openocd-0.1/src/jtag/rlink/st7.h (from rev 1324, trunk/src/jtag/rlink/st7.h)

Modified: branches/openocd-0.1/src/jtag/usbprog.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/usbprog.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/usbprog.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -47,10 +47,10 @@
 #define PID 0x0c63
 
 /* Pins at usbprog */
-#define TDO_BIT         0
-#define TDI_BIT         3
-#define TCK_BIT         2
-#define TMS_BIT         1
+#define TDO_BIT			0
+#define TDI_BIT			3
+#define TCK_BIT			2
+#define TMS_BIT			1
 
 int usbprog_execute_queue(void);
 int usbprog_speed(int speed);
@@ -74,17 +74,17 @@
 	.quit = usbprog_quit
 };
 
-#define UNKOWN_COMMAND  0x00
-#define PORT_DIRECTION  0x01
-#define PORT_SET        0x02
-#define PORT_GET        0x03
-#define PORT_SETBIT     0x04
-#define PORT_GETBIT     0x05
-#define WRITE_TDI     	0x06
-#define READ_TDO     	0x07
-#define WRITE_AND_READ 	0x08
-#define WRITE_TMS     	0x09
-#define WRITE_TMS_CHAIN 0x0A
+#define UNKOWN_COMMAND	0x00
+#define PORT_DIRECTION	0x01
+#define PORT_SET		0x02
+#define PORT_GET		0x03
+#define PORT_SETBIT		0x04
+#define PORT_GETBIT		0x05
+#define WRITE_TDI		0x06
+#define READ_TDO		0x07
+#define WRITE_AND_READ	0x08
+#define WRITE_TMS		0x09
+#define WRITE_TMS_CHAIN	0x0A
 
 struct usbprog_jtag
 {
@@ -93,7 +93,7 @@
 
 struct usbprog_jtag * usbprog_jtag_handle;
 
-struct usbprog_jtag* usbprog_jtag_open();
+struct usbprog_jtag* usbprog_jtag_open(void);
 void usbprog_jtag_close(struct usbprog_jtag *usbprog_jtag);
 void usbprog_jtag_init(struct usbprog_jtag *usbprog_jtag);
 unsigned char usbprog_jtag_message(struct usbprog_jtag *usbprog_jtag, char *msg, int msglen);
@@ -282,7 +282,7 @@
 		}
 		else
 		{
-			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, tap_state_strings[cur_state], tap_state_strings[cmd-&gt;path[state_count]]);
+			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, jtag_state_name(cur_state), jtag_state_name(cmd-&gt;path[state_count]));
 			exit(-1);
 		}
 
@@ -405,7 +405,7 @@
 
 struct usb_bus *busses;
 
-struct usbprog_jtag* usbprog_jtag_open()
+struct usbprog_jtag* usbprog_jtag_open(void)
 {
 	struct usb_bus *bus;
 	struct usb_device *dev;

Copied: branches/openocd-0.1/src/jtag/vsllink.c (from rev 1324, trunk/src/jtag/vsllink.c)

Modified: branches/openocd-0.1/src/jtag/zy1000.c
===================================================================
--- branches/openocd_1_0_branch/src/jtag/zy1000.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/jtag/zy1000.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -32,6 +32,12 @@
 
 #include &lt;stdlib.h&gt;
 
+#define ZYLIN_VERSION &quot;1.48&quot;
+#define ZYLIN_DATE __DATE__
+#define ZYLIN_TIME __TIME__
+#define ZYLIN_OPENOCD &quot;$Revision: 1241 $&quot;
+#define ZYLIN_OPENOCD_VERSION &quot;Zylin JTAG ZY1000 &quot; ZYLIN_VERSION &quot; &quot; ZYLIN_DATE &quot; &quot; ZYLIN_TIME
+const char *zylin_config_dir=&quot;/config/settings&quot;;
 
 extern int jtag_error;
 
@@ -77,7 +83,7 @@
 	return ERROR_OK;
 }
 
-static bool readPowerDropout()
+static bool readPowerDropout(void)
 {
 	cyg_uint32 state;
 	// sample and clear power dropout
@@ -89,7 +95,7 @@
 }
 
 
-static bool readSRST()
+static bool readSRST(void)
 {
 	cyg_uint32 state;
 	// sample and clear SRST sensing
@@ -146,7 +152,7 @@
 	return -1;
 }
 
-extern bool readSRST();
+extern bool readSRST(void);
 
 void zy1000_reset(int trst, int srst)
 {
@@ -223,7 +229,7 @@
 	{
 		if(speed &gt; 8190 || speed &lt; 2)
 		{
-			LOG_ERROR(&quot;valid ZY1000 jtag_speed=[8190,2]. Divisor is 64MHz / even values between 8190-2, i.e. min 7814Hz, max 32MHz&quot;);
+			LOG_USER(&quot;valid ZY1000 jtag_speed=[8190,2]. Divisor is 64MHz / even values between 8190-2, i.e. min 7814Hz, max 32MHz&quot;);
 			return ERROR_INVALID_ARGUMENTS;
 		}
 
@@ -234,91 +240,146 @@
 	return ERROR_OK;
 }
 
-int zy1000_register_commands(struct command_context_s *cmd_ctx)
+static bool savePower;
+
+
+static void setPower(bool power)
 {
-	return ERROR_OK;
+	savePower = power;
+	if (power)
+	{
+		HAL_WRITE_UINT32(ZY1000_JTAG_BASE+0x14, 0x8);
+	} else
+	{
+		HAL_WRITE_UINT32(ZY1000_JTAG_BASE+0x10, 0x8);
+	}
 }
 
-
-int zy1000_init(void)
+int handle_power_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
-	ZY1000_POKE(0x08000010, 0x30); // Turn on LED1 &amp; LED2
+	if (argc &gt; 1)
+	{
+		return ERROR_INVALID_ARGUMENTS;
+	}
 
-	 /* deassert resets. Important to avoid infinite loop waiting for SRST to deassert */
-	zy1000_reset(0, 0);
-	zy1000_speed(jtag_speed);
+	if (argc == 1)
+	{
+		if (strcmp(args[0], &quot;on&quot;) == 0)
+		{
+			setPower(1);
+		}
+		else if (strcmp(args[0], &quot;off&quot;) == 0)
+		{
+			setPower(0);
+		} else
+		{
+			command_print(cmd_ctx, &quot;arg is \&quot;on\&quot; or \&quot;off\&quot;&quot;);
+			return ERROR_INVALID_ARGUMENTS;
+		}
+	}
 
-	bitbang_interface = &amp;zy1000_bitbang;
+	command_print(cmd_ctx, &quot;Target power %s&quot;, savePower ? &quot;on&quot; : &quot;off&quot;);
 
 	return ERROR_OK;
 }
 
-int zy1000_quit(void)
+
+/* Give TELNET a way to find out what version this is */
+int handle_zy1000_version_command(struct command_context_s *cmd_ctx, char *cmd,
+		char **args, int argc)
 {
+	if (argc &gt; 1)
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+	if (argc == 0)
+	{
+		command_print(cmd_ctx, ZYLIN_OPENOCD_VERSION);
+	}
+	else if (strcmp(&quot;openocd&quot;, args[0]) == 0)
+	{
+		int revision;
+		revision = atol(ZYLIN_OPENOCD+strlen(&quot;XRevision: &quot;));
+		command_print(cmd_ctx, &quot;%d&quot;, revision);
+	}
+	else if (strcmp(&quot;zy1000&quot;, args[0]) == 0)
+	{
+		command_print(cmd_ctx, &quot;%s&quot;, ZYLIN_VERSION);
+	}
+	else if (strcmp(&quot;date&quot;, args[0]) == 0)
+	{
+		command_print(cmd_ctx, &quot;%s&quot;, ZYLIN_DATE);
+	}
+	else
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
 
 	return ERROR_OK;
 }
 
 
-
-/* loads a file and returns a pointer to it in memory. The file contains
- * a 0 byte(sentinel) after len bytes - the length of the file. */
-int loadFile(const char *fileName, void **data, int *len)
+static int
+zylinjtag_Jim_Command_powerstatus(Jim_Interp *interp,
+                                   int argc,
+		Jim_Obj * const *argv)
 {
-	FILE * pFile;
-	pFile = fopen (fileName,&quot;rb&quot;);
-	if (pFile==NULL)
+	if (argc != 1)
 	{
-		LOG_ERROR(&quot;Can't open %s\n&quot;, fileName);
-		return ERROR_JTAG_DEVICE_ERROR;
+		Jim_WrongNumArgs(interp, 1, argv, &quot;powerstatus&quot;);
+		return JIM_ERR;
 	}
-    if (fseek (pFile, 0, SEEK_END)!=0)
-    {
-		LOG_ERROR(&quot;Can't open %s\n&quot;, fileName);
-		fclose(pFile);
-		return ERROR_JTAG_DEVICE_ERROR;
-    }
-    *len=ftell (pFile);
-    if (*len==-1)
-    {
-		LOG_ERROR(&quot;Can't open %s\n&quot;, fileName);
-		fclose(pFile);
-		return ERROR_JTAG_DEVICE_ERROR;
-    }
 
-    if (fseek (pFile, 0, SEEK_SET)!=0)
-    {
-		LOG_ERROR(&quot;Can't open %s\n&quot;, fileName);
-		fclose(pFile);
-		return ERROR_JTAG_DEVICE_ERROR;
-    }
-    *data=malloc(*len+1);
-    if (*data==NULL)
-    {
-		LOG_ERROR(&quot;Can't open %s\n&quot;, fileName);
-		fclose(pFile);
-		return ERROR_JTAG_DEVICE_ERROR;
-    }
+	cyg_uint32 status;
+	ZY1000_PEEK(ZY1000_JTAG_BASE+0x10, status);
 
-    if (fread(*data, 1, *len, pFile)!=*len)
-    {
-		fclose(pFile);
-	free(*data);
-		LOG_ERROR(&quot;Can't open %s\n&quot;, fileName);
-		return ERROR_JTAG_DEVICE_ERROR;
-    }
-    fclose (pFile);
-    *(((char *)(*data))+*len)=0; /* sentinel */
+	Jim_SetResult(interp, Jim_NewIntObj(interp, (status&amp;0x80)!=0));
 
-    return ERROR_OK;
+	return JIM_OK;
+}
 
+int zy1000_register_commands(struct command_context_s *cmd_ctx)
+{
+	register_command(cmd_ctx, NULL, &quot;power&quot;, handle_power_command, COMMAND_ANY,
+			&quot;power &lt;on/off&gt; - turn power switch to target on/off. No arguments - print status.&quot;);
+	register_command(cmd_ctx, NULL, &quot;zy1000_version&quot;, handle_zy1000_version_command,
+			COMMAND_EXEC, &quot;show zy1000 version numbers&quot;);
 
+	Jim_CreateCommand(interp, &quot;powerstatus&quot;, zylinjtag_Jim_Command_powerstatus, NULL, NULL);
 
+	return ERROR_OK;
 }
 
 
 
 
+int zy1000_init(void)
+{
+	LOG_USER(&quot;%s&quot;, ZYLIN_OPENOCD_VERSION);
+
+	ZY1000_POKE(ZY1000_JTAG_BASE+0x10, 0x30); // Turn on LED1 &amp; LED2
+
+	setPower(true); // on by default
+
+
+	 /* deassert resets. Important to avoid infinite loop waiting for SRST to deassert */
+	zy1000_reset(0, 0);
+	zy1000_speed(jtag_speed);
+
+	bitbang_interface = &amp;zy1000_bitbang;
+
+	return ERROR_OK;
+}
+
+int zy1000_quit(void)
+{
+
+	return ERROR_OK;
+}
+
+
+
+
 int interface_jtag_execute_queue(void)
 {
 	cyg_uint32 empty;
@@ -343,7 +404,7 @@
 
 
 
-static cyg_uint32 getShiftValue()
+static cyg_uint32 getShiftValue(void)
 {
 	cyg_uint32 value;
 	waitIdle();
@@ -352,7 +413,7 @@
 	return value;
 }
 #if 0
-static cyg_uint32 getShiftValueFlip()
+static cyg_uint32 getShiftValueFlip(void)
 {
 	cyg_uint32 value;
 	waitIdle();
@@ -365,7 +426,7 @@
 #if 0
 static void shiftValueInnerFlip(const enum tap_state state, const enum tap_state endState, int repeat, cyg_uint32 value)
 {
-	VERBOSE(LOG_INFO(&quot;shiftValueInner %s %s %d %08x (flipped)&quot;, tap_state_strings[state], tap_state_strings[endState], repeat, value));
+	VERBOSE(LOG_INFO(&quot;shiftValueInner %s %s %d %08x (flipped)&quot;, jtag_state_name(state), jtag_state_name(endState), repeat, value));
 	cyg_uint32 a,b;
 	a=state;
 	b=endState;
@@ -377,7 +438,7 @@
 
 extern int jtag_check_value(u8 *captured, void *priv);
 
-static void gotoEndState()
+static void gotoEndState(void)
 {
 	setCurrentState(cmd_queue_end_state);
 }
@@ -476,7 +537,7 @@
 			int r=fields[i].in_handler(inBuffer, fields[i].in_handler_priv, fields+i);
 			if (r!=ERROR_OK)
 			{
-			    /* this will cause jtag_execute_queue() to return an error */
+				/* this will cause jtag_execute_queue() to return an error */
 				jtag_error=r;
 			}
 		}
@@ -632,10 +693,10 @@
 	return ERROR_OK;
 }
 
-int interface_jtag_add_runtest(int num_cycles, enum tap_state state)
+static int zy1000_jtag_add_clocks(int num_cycles, enum tap_state state, enum tap_state clockstate)
 {
 	/* num_cycles can be 0 */
-	setCurrentState(TAP_IDLE);
+	setCurrentState(clockstate);
 
 	/* execute num_cycles, 32 at the time. */
 	int i;
@@ -647,7 +708,7 @@
 		{
 			num=num_cycles-i;
 		}
-		shiftValueInner(TAP_IDLE, TAP_IDLE, num, 0);
+		shiftValueInner(clockstate, clockstate, num, 0);
 	}
 
 #if !TEST_MANUAL()
@@ -673,6 +734,16 @@
 	return ERROR_OK;
 }
 
+int interface_jtag_add_runtest(int num_cycles, enum tap_state state)
+{
+	return zy1000_jtag_add_clocks(num_cycles, state, TAP_IDLE);
+}
+
+int interface_jtag_add_clocks(int num_cycles)
+{
+	return zy1000_jtag_add_clocks(num_cycles, cmd_queue_cur_state, cmd_queue_end_state);
+}
+
 int interface_jtag_add_sleep(u32 us)
 {
 	jtag_sleep(us);
@@ -703,7 +774,7 @@
 		}
 		else
 		{
-			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, tap_state_strings[cur_state], tap_state_strings[path[state_count]]);
+			LOG_ERROR(&quot;BUG: %s -&gt; %s isn't a valid TAP transition&quot;, jtag_state_name(cur_state), jtag_state_name(path[state_count]));
 			exit(-1);
 		}
 
@@ -760,3 +831,27 @@
 	}
 }
 
+int loadFile(const char *fileName, void **data, int *len);
+
+/* boolean parameter stored on config */
+int boolParam(char *var)
+{
+	bool result = false;
+	char *name = alloc_printf(&quot;%s/%s&quot;, zylin_config_dir, var);
+	if (name == NULL)
+		return result;
+
+	void *data;
+	int len;
+	if (loadFile(name, &amp;data, &amp;len) == ERROR_OK)
+	{
+		if (len &gt; 1)
+			len = 1;
+		result = strncmp((char *) data, &quot;1&quot;, len) == 0;
+		free(data);
+	}
+	free(name);
+	return result;
+}
+
+

Modified: branches/openocd-0.1/src/main.c
===================================================================
--- branches/openocd_1_0_branch/src/main.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/main.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -18,6 +18,12 @@
  *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
  ***************************************************************************/
 
+
+#ifdef HAVE_CONFIG_H
+#include &quot;config.h&quot;
+#endif
+
+#if !BUILD_HTTPD
 /* implementations of OpenOCD that uses multithreading needs to know when
  * OpenOCD is sleeping. No-op in vanilla OpenOCD
  */
@@ -28,13 +34,14 @@
 void openocd_sleep_postlude(void)
 {
 }
+#endif
 
 /* This is the main entry for developer PC hosted OpenOCD.
  *
  * OpenOCD can also be used as a library that is linked with
  * another application(not mainstream yet, but possible), e.g.
  * w/as an embedded application.
- * 
+ *
  * Those applications will have their own main() implementation
  * and use bits and pieces from openocd.c. */
 

Modified: branches/openocd-0.1/src/openocd.c
===================================================================
--- branches/openocd_1_0_branch/src/openocd.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/openocd.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -71,7 +71,7 @@
 	/* DANGER!!! make sure that the line below does not appear in a patch, do not remove */
 	/* DANGER!!! make sure that the line below does not appear in a patch, do not remove */
 	/* DANGER!!! make sure that the line below does not appear in a patch, do not remove */
-	LOG_OUTPUT( &quot;$URL$\n&quot;);
+	LOG_OUTPUT(&quot;$URL$\n&quot;);
 	/* DANGER!!! make sure that the line above does not appear in a patch, do not remove */
 	/* DANGER!!! make sure that the line above does not appear in a patch, do not remove */
 	/* DANGER!!! make sure that the line above does not appear in a patch, do not remove */
@@ -79,17 +79,12 @@
 	/* DANGER!!! make sure that the line above does not appear in a patch, do not remove */
 }
 
-
-
-
-
-
-
-
-
 /* Give TELNET a way to find out what version this is */
 int handle_version_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
+	if (argc!=0)
+		return ERROR_COMMAND_SYNTAX_ERROR;
+
 	command_print(cmd_ctx, OPENOCD_VERSION);
 
 	return ERROR_OK;
@@ -126,9 +121,15 @@
 	return ERROR_OK;
 }
 
+int ioutil_init(struct command_context_s *cmd_ctx);
+
 /* OpenOCD can't really handle failure of this command. Patches welcome! :-) */
 int handle_init_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
+
+	if (argc!=0)
+		return ERROR_COMMAND_SYNTAX_ERROR;
+
 	int retval;
 	static int initialized=0;
 	if (initialized)
@@ -228,6 +229,9 @@
 	return cmd_ctx;
 }
 
+int httpd_start(void);
+void httpd_stop(void);
+
 /* normally this is the main() function entry, but if OpenOCD is linked
  * into application, then this fn will not be invoked, but rather that
  * application will have it's own implementation of main(). */
@@ -240,8 +244,15 @@
 
 	cmd_ctx = setup_command_handler();
 
-	LOG_OUTPUT( &quot;\n\nBUGS? Read <A HREF="http://svn.berlios.de/svnroot/repos/openocd/trunk/BUGS\n\n\n">http://svn.berlios.de/svnroot/repos/openocd/trunk/BUGS\n\n\n</A>&quot;);
+#if BUILD_IOUTIL
+	if (ioutil_init(cmd_ctx) != ERROR_OK)
+	{
+		return EXIT_FAILURE;
+	}
+#endif
 
+	LOG_OUTPUT(&quot;\n\nBUGS? Read <A HREF="http://svn.berlios.de/svnroot/repos/openocd/trunk/BUGS\n\n\n">http://svn.berlios.de/svnroot/repos/openocd/trunk/BUGS\n\n\n</A>&quot;);
+
 	print_version();
 
 	command_context_mode(cmd_ctx, COMMAND_CONFIG);
@@ -254,6 +265,11 @@
 	if ( (ret != ERROR_OK) &amp;&amp; (ret != ERROR_COMMAND_CLOSE_CONNECTION) )
 		return EXIT_FAILURE;
 
+#if BUILD_HTTPD
+	if (httpd_start()!=ERROR_OK)
+		return EXIT_FAILURE;
+#endif
+
 	if (ret != ERROR_COMMAND_CLOSE_CONNECTION)
 	{
 		command_context_mode(cmd_ctx, COMMAND_EXEC);
@@ -267,10 +283,15 @@
 	/* shut server down */
 	server_quit();
 
+#if BUILD_HTTPD
+	httpd_stop();
+#endif
+
 	unregister_all_commands(cmd_ctx);
 
 	/* free commandline interface */
 	command_done(cmd_ctx);
 
+
 	return EXIT_SUCCESS;
 }

Modified: branches/openocd-0.1/src/server/Makefile.am
===================================================================
--- branches/openocd_1_0_branch/src/server/Makefile.am	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/Makefile.am	2009-01-16 06:43:11 UTC (rev 1325)
@@ -4,6 +4,18 @@
 noinst_HEADERS = server.h telnet_server.h gdb_server.h
 libserver_a_SOURCES = server.c telnet_server.c gdb_server.c
 
+if HTTPD
+libserver_a_SOURCES += httpd.c
+endif
+
+
 # tcl server addons
 noinst_HEADERS += tcl_server.h
 libserver_a_SOURCES += tcl_server.c
+
+if HTTPD
+nobase_dist_pkglib_DATA = $(wildcard $(srcdir)/httpd/*.tcl)
+nobase_dist_pkglib_DATA += $(wildcard $(srcdir)/httpd/*.css)
+nobase_dist_pkglib_DATA += $(wildcard $(srcdir)/httpd/menu_cuts/*.png)
+endif
+AM_CPPFLAGS = -DPKGLIBDIR=\&quot;$(pkglibdir)\&quot; @CPPFLAGS@
\ No newline at end of file

Modified: branches/openocd-0.1/src/server/gdb_server.c
===================================================================
--- branches/openocd_1_0_branch/src/server/gdb_server.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/gdb_server.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -126,7 +126,7 @@
 
 	tv.tv_sec = timeout_s;
 	tv.tv_usec = 0;
-	if (select(connection-&gt;fd + 1, &amp;read_fds, NULL, NULL, &amp;tv) == 0)
+	if (socket_select(connection-&gt;fd + 1, &amp;read_fds, NULL, NULL, &amp;tv) == 0)
 	{
 		/* This can typically be because a &quot;monitor&quot; command took too long
 		 * before printing any progress messages
@@ -169,10 +169,18 @@
 
 	for (;;)
 	{
-		retval=check_pending(connection, 1, NULL);
-		if (retval!=ERROR_OK)
-			return retval;
-		gdb_con-&gt;buf_cnt = read_socket(connection-&gt;fd, gdb_con-&gt;buffer, GDB_BUFFER_SIZE);
+		if (connection-&gt;service-&gt;type == CONNECTION_PIPE)
+		{
+			gdb_con-&gt;buf_cnt = read(connection-&gt;fd, gdb_con-&gt;buffer, GDB_BUFFER_SIZE);
+		}
+		else
+		{
+			retval = check_pending(connection, 1, NULL);
+			if (retval != ERROR_OK)
+				return retval;
+			gdb_con-&gt;buf_cnt = read_socket(connection-&gt;fd, gdb_con-&gt;buffer, GDB_BUFFER_SIZE);
+		}
+
 		if (gdb_con-&gt;buf_cnt &gt; 0)
 		{
 			break;
@@ -269,10 +277,21 @@
 	if (gdb_con-&gt;closed)
 		return ERROR_SERVER_REMOTE_CLOSED;
 
-	if (write_socket(connection-&gt;fd, data, len) == len)
+	if (connection-&gt;service-&gt;type == CONNECTION_PIPE)
 	{
-		return ERROR_OK;
+		/* write to stdout */
+		if (write(STDOUT_FILENO, data, len) == len)
+		{
+			return ERROR_OK;
+		}
 	}
+	else
+	{
+		if (write_socket(connection-&gt;fd, data, len) == len)
+		{
+			return ERROR_OK;
+		}
+	}
 	gdb_con-&gt;closed = 1;
 	return ERROR_SERVER_REMOTE_CLOSED;
 }
@@ -307,7 +326,7 @@
 		if ((retval = gdb_get_char(connection, &amp;reply)) != ERROR_OK)
 			return retval;
 		if( reply == '$' ){
-			// fix a problem with some IAR tools
+			/* fix a problem with some IAR tools */
 			gdb_putback_char( connection, reply );
 			LOG_DEBUG(&quot;Unexpected start of new packet&quot;);
 			break;
@@ -719,7 +738,6 @@
 	return ERROR_OK;
 }
 
-
 int gdb_new_connection(connection_t *connection)
 {
 	gdb_connection_t *gdb_connection = malloc(sizeof(gdb_connection_t));
@@ -847,7 +865,6 @@
 	return ERROR_OK;
 }
 
-
 static int gdb_reg_pos(target_t *target, int pos, int len)
 {
 	if (target-&gt;endianness == TARGET_LITTLE_ENDIAN)
@@ -2160,7 +2177,7 @@
 	if (retval == ERROR_SERVER_REMOTE_CLOSED)
 		return retval;
 
-	/* logging does not propagate the error, yet can set th gdb_con-&gt;closed flag */
+	/* logging does not propagate the error, yet can set the gdb_con-&gt;closed flag */
 	if (gdb_con-&gt;closed)
 		return ERROR_SERVER_REMOTE_CLOSED;
 
@@ -2179,32 +2196,35 @@
 		return ERROR_OK;
 	}
 
-	if (gdb_port == 0)
+	if (gdb_port == 0 &amp;&amp; server_use_pipes == 0)
 	{
 		LOG_WARNING(&quot;no gdb port specified, using default port 3333&quot;);
 		gdb_port = 3333;
 	}
 
-	while (target)
+	if (server_use_pipes)
 	{
-		char service_name[8];
+		/* only a single gdb connection when using a pipe */
 
-		snprintf(service_name, 8, &quot;gdb-%2.2i&quot;, target-&gt;target_number);
-
 		gdb_service = malloc(sizeof(gdb_service_t));
 		gdb_service-&gt;target = target;
 
-		add_service(&quot;gdb&quot;, CONNECTION_GDB,
-			    gdb_port + target-&gt;target_number,
-			    1, gdb_new_connection, gdb_input,
-			    gdb_connection_closed,
-			    gdb_service);
+		add_service(&quot;gdb&quot;, CONNECTION_PIPE, 0, 1, gdb_new_connection, gdb_input, gdb_connection_closed, gdb_service);
 
-		LOG_DEBUG(&quot;gdb service for target %s at port %i&quot;,
-			  target-&gt;type-&gt;name,
-			  gdb_port + target-&gt;target_number);
+		LOG_DEBUG(&quot;gdb service for target %s using pipes&quot;, target-&gt;type-&gt;name);
+	}
+	else
+	{
+		while (target)
+		{
+			gdb_service = malloc(sizeof(gdb_service_t));
+			gdb_service-&gt;target = target;
 
-		target = target-&gt;next;
+			add_service(&quot;gdb&quot;, CONNECTION_TCP, gdb_port + target-&gt;target_number, 1, gdb_new_connection, gdb_input, gdb_connection_closed, gdb_service);
+
+			LOG_DEBUG(&quot;gdb service for target %s at port %i&quot;, target-&gt;type-&gt;name, gdb_port + target-&gt;target_number);
+			target = target-&gt;next;
+		}
 	}
 
 	return ERROR_OK;
@@ -2354,11 +2374,10 @@
 	return ERROR_OK;
 }
 
-
 int gdb_register_commands(command_context_t *command_context)
 {
 	register_command(command_context, NULL, &quot;gdb_port&quot;, handle_gdb_port_command,
-			COMMAND_CONFIG, &quot;daemon configuration command gdb_port&quot;);
+			COMMAND_ANY, &quot;daemon configuration command gdb_port&quot;);
 	register_command(command_context, NULL, &quot;gdb_detach&quot;, handle_gdb_detach_command,
 			COMMAND_CONFIG, &quot;&quot;);
 	register_command(command_context, NULL, &quot;gdb_memory_map&quot;, handle_gdb_memory_map_command,

Copied: branches/openocd-0.1/src/server/httpd (from rev 1324, trunk/src/server/httpd)

Deleted: branches/openocd-0.1/src/server/httpd/Stylizer.class
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/Stylizer.class (from rev 1324, trunk/src/server/httpd/Stylizer.class)

Deleted: branches/openocd-0.1/src/server/httpd/Stylizer.java
===================================================================
--- trunk/src/server/httpd/Stylizer.java	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/Stylizer.java	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,114 +0,0 @@
-import java.io.File;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.io.OutputStream;
-
-import javax.xml.parsers.DocumentBuilder;
-import javax.xml.parsers.DocumentBuilderFactory;
-import javax.xml.parsers.ParserConfigurationException;
-import javax.xml.transform.Transformer;
-import javax.xml.transform.TransformerConfigurationException;
-import javax.xml.transform.TransformerException;
-import javax.xml.transform.TransformerFactory;
-import javax.xml.transform.dom.DOMSource;
-import javax.xml.transform.stream.StreamResult;
-import javax.xml.transform.stream.StreamSource;
-
-import org.apache.xpath.XPathAPI;
-import org.w3c.dom.Document;
-import org.w3c.dom.Node;
-import org.w3c.dom.NodeList;
-import org.xml.sax.SAXException;
-
-/** used to generate .tcl files from */
-public class Stylizer
-{
-	// Global value so it can be ref'd by the tree-adapter
-	static Document document;
-	public static void main(String argv[])
-	{
-		if (argv.length != 3)
-		{
-			System.err.println(&quot;Usage: java Stylizer stylesheet xmlfile outputdir&quot;);
-			System.exit(1);
-		}
-		DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
-		try
-		{
-			System.err.println(&quot;Starting conversion...&quot;);
-			
-			File stylesheet = new File(argv[0]);
-			File datafile = new File(argv[1]);
-			DocumentBuilder builder = factory.newDocumentBuilder();
-			document = builder.parse(datafile);
-			
-			NodeList list = XPathAPI.selectNodeList(document, &quot;website/language/page&quot;);
-
-			for (int i=0; i&lt;list.getLength(); i++)
-			{
-				Node node=list.item(i);
-				
-				// Use a Transformer for output
-				TransformerFactory tFactory = TransformerFactory.newInstance();
-				StreamSource stylesource = new StreamSource(stylesheet);
-				Transformer transformer = tFactory.newTransformer(stylesource);
-				
-				Node fileName = XPathAPI.selectSingleNode(node, &quot;outfile/text()&quot;);
-				
-				System.err.println(&quot;Converting &quot; + fileName.getNodeValue());
-				DOMSource source = new DOMSource(document);
-				
-				OutputStream output=new FileOutputStream(new File(argv[2], fileName.getNodeValue()));
-				
-				
-				try
-				{
-					StreamResult result = new StreamResult(output);
-					
-					transformer.setParameter(&quot;pagetogenerate&quot;, fileName.getNodeValue());
-					transformer.transform(source, result);
-				} 
-				finally
-				{
-					output.close();
-				}
-			}
-		} catch (TransformerConfigurationException tce)
-		{
-			// Error generated by the parser
-			System.out.println(&quot;\n** Transformer Factory error&quot;);
-			System.out.println(&quot;   &quot; + tce.getMessage());
-			// Use the contained exception, if any
-			Throwable x = tce;
-			if (tce.getException() != null)
-				x = tce.getException();
-			x.printStackTrace();
-		} catch (TransformerException te)
-		{
-			// Error generated by the parser
-			System.out.println(&quot;\n** Transformation error&quot;);
-			System.out.println(&quot;   &quot; + te.getMessage());
-			// Use the contained exception, if any
-			Throwable x = te;
-			if (te.getException() != null)
-				x = te.getException();
-			x.printStackTrace();
-		} catch (SAXException sxe)
-		{
-			// Error generated by this application
-			// (or a parser-initialization error)
-			Exception x = sxe;
-			if (sxe.getException() != null)
-				x = sxe.getException();
-			x.printStackTrace();
-		} catch (ParserConfigurationException pce)
-		{
-			// Parser with specified options can't be built
-			pce.printStackTrace();
-		} catch (IOException ioe)
-		{
-			// I/O error
-			ioe.printStackTrace();
-		}
-	} // main
-}

Copied: branches/openocd-0.1/src/server/httpd/Stylizer.java (from rev 1324, trunk/src/server/httpd/Stylizer.java)

Deleted: branches/openocd-0.1/src/server/httpd/browsemem.tcl
===================================================================
--- trunk/src/server/httpd/browsemem.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/browsemem.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,454 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Browse / Edit&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;downloadmem.tcl&quot; style=&quot;&quot;&gt;Download&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Browse / Edit Memory&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-
-
-			
-			}
-
-			
-			set form_address [formfetch form_address]
-			set form_length [formfetch form_length]
-			set form_type [formfetch form_type]
-			set form_action [formfetch form_action]
-			set form_value [formfetch form_value]
-			
-			if {[string compare $form_length &quot;&quot;]==0} {
-				set form_length 0
-			}  
-			if {$form_length&lt;=0} {
-				set form_length 0x80
-			} 
-			if {$form_length&gt;0x1000} {
-				set form_length 0x1000
-			} 
-			
-			if {[string compare $form_type &quot;&quot;]==0} {
-				set form_type mdw
-			}
-			
-			if {[string compare $form_type &quot;mdw&quot;]==0} {
-				set wordsize 4
-				set modify_cmd mww 
-			}
-			if {[string compare $form_type &quot;mdh&quot;]==0} {
-				set wordsize 2
-				set modify_cmd mwh 
-			}
-			if {[string compare $form_type &quot;mdb&quot;]==0} {
-				set wordsize 1
-				set modify_cmd mwb 
-			}
-			
-			
-			
-			
-			if {[string compare $form_address &quot;&quot;]!=0} {
-				if {[string compare $form_action &quot;Previous&quot;]==0} {
-					# Kludge! Work around problems parsing hex in Jim Tcl expressions
-					incr form_address ; set form_address [expr $form_address-1]
-					if {$form_address-$form_length&gt;0} {
-						set form_address &quot;0x[tohex [expr $form_address-$form_length]]&quot;
-					} else {
-						set form_address &quot;0x0&quot;
-					}
-				}  
-				if {[string compare $form_action &quot;Next&quot;]==0} {
-					# Kludge! Work around problems parsing hex in Jim Tcl expressions
-					incr form_address ; set form_address [expr $form_address-1]
-					set form_address &quot;0x[tohex [expr $form_address+$form_length]]&quot;
-				}  
-				if {[string compare $form_action &quot;Modify&quot;]==0} {
-					append console [capture_catch &quot;$modify_cmd $form_address $form_value&quot;]
-				}  
-				if {[string compare $form_action &quot;Fill&quot;]==0} {
-					append console [capture_catch &quot;$modify_cmd $form_address $form_value $form_length&quot;]
-				}  
-			}
-			
-			
-			
-append buffer {
-			
-			&lt;form action=&quot;browsemem.tcl&quot; method=&quot;post&quot;&gt; 
-				&lt;table&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Address&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_address&quot; value=&quot;}
-append buffer $form_address
-append buffer {&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Length&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_length&quot; value=&quot;}
-append buffer &quot;0x[tohex $form_length]&quot;
-append buffer {&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Value&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_value&quot; value=&quot;}
-append buffer $form_value
-append buffer {&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Modify&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Fill&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Type&lt;/td&gt;&lt;td style=&quot;padding-top:1px;&quot;&gt;
-				&lt;select name=&quot;form_type&quot;&gt;
-				  &lt;option 
-				    }
-if {[string compare $form_type &quot;mdb&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  
-append buffer { value =&quot;mdb&quot;&gt;8 bit
-				  &lt;/option&gt;
-				  &lt;option 
-				   }
-if {[string compare $form_type &quot;mdh&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  
-append buffer { value =&quot;mdh&quot;&gt;16 bit
-				  &lt;/option&gt;
-			  		&lt;option
-					   }
-if {[string compare $form_type &quot;mdw&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  
-append buffer {value =&quot;mdw&quot;&gt;32 bit
-				  	&lt;/option&gt;
-				&lt;/select&gt;
-				
-				&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-				&lt;table&gt;&lt;tr&gt;
-					&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Refresh&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Previous&quot; &gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Next&quot; &gt;&lt;/td&gt;
-				&lt;/tr&gt;&lt;/table&gt;
-				&lt;br&gt;
-				
-			&lt;/form&gt;
-			&lt;p&gt;
-			&lt;div class=&quot;fontbigger&quot;&gt;Memory:&lt;/div&gt;&lt;p&gt;
-			&lt;code style=&quot;white-space: nowrap; font-size:11px;font:courier new;&quot;&gt;
-				}
-
-				if {[string compare $form_address &quot;&quot;]!=0} {
-					append console [encode [capture_catch halt]]
-					append buffer [encode [capture_catch &quot;$form_type $form_address [expr $form_length]&quot;]]
-				} 
-				
-append buffer {
-			&lt;/code&gt;
-
-
-			
-
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;browsemem.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				&lt;p&gt;Browse and edit target memory.&lt;br&gt;
-				   Length is in bytes, maximum 4096 bytes.&lt;/p&gt; 
-				&lt;p&gt;An error message is shown when trying to browse or edit memory which cases a CPU fault.&lt;/p&gt;
-				&lt;p&gt;CPU will be halted if required.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Modify&lt;/b&gt; - Will modify only one byte, half-word or word starting at Address.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Fill&lt;/b&gt; - Will fill the specified region with the specified value.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Refresh&lt;/b&gt; - Display the content of the specified memory area.&lt;/p&gt;
-					
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/browsemem.tcl (from rev 1324, trunk/src/server/httpd/browsemem.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/build.sh
===================================================================
--- trunk/src/server/httpd/build.sh	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/build.sh	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,5 +0,0 @@
-set e
-java -classpath ../../../../zy1000/build/xalan.jar\;. Stylizer menu.xsl menu.xml .
-find . -regex &quot;.*\.tcl&quot; -type f -exec sh html2tcl.sh {} {} \;
-echo &quot;Copy .tcl files to /usr/local/lib/openocd/httpd/&quot;
-cp *.tcl /usr/local/lib/openocd/httpd/
\ No newline at end of file

Copied: branches/openocd-0.1/src/server/httpd/build.sh (from rev 1324, trunk/src/server/httpd/build.sh)

Deleted: branches/openocd-0.1/src/server/httpd/downloadmem.tcl
===================================================================
--- trunk/src/server/httpd/downloadmem.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/downloadmem.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,366 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot; style=&quot;&quot;&gt;Browse / Edit&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;downloadmem.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Download&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Download Memory Range&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			}
-
-				set form_address [formfetch form_address]
-				set form_length [formfetch form_length]
-				set form_action [formfetch form_action]
-			
-append buffer {			
-			&lt;form action=&quot;downloadmem.tcl&quot; method=&quot;post&quot;&gt; 
-				&lt;table&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Address&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_address&quot; value=&quot;}
-append buffer $form_address
-append buffer {&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Length&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_length&quot; value=&quot;}
-append buffer $form_length
-append buffer {&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-				&lt;input type=&quot;submit&quot; value=&quot;Download&quot; name=&quot;form_action&quot;&gt;
-				
-				
-			&lt;/form&gt;
-			}
-
-				if {[string compare $form_action &quot;Download&quot;]==0} {
-					append console [encode [capture_catch &quot;reset init&quot;]]
-					append console [encode [capture_catch &quot;dump_image /tmp/dump.bin $form_address $form_length&quot;]]
-					
-append buffer {
-					&lt;form action=&quot;../dump.bin&quot; target=&quot;_blank&quot;&gt; 
-						&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Save downloaded memory&quot;&gt;
-					&lt;/form&gt;
-					}
- 
-				}
-				
-			
-append buffer {
-
-
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;downloadmem.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-					
-				Download memory from target. &lt;br&gt;
-				&lt;b&gt;Note&lt;/b&gt; that download memory can take
-				a long time(potentially minutes for megabytes at low JTAG clk speeds).
-				&lt;p/&gt;
-				Once the memory is downloaded a link is available on the page to download
-				the file to your PC.
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/downloadmem.tcl (from rev 1324, trunk/src/server/httpd/downloadmem.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/editconfigs.tcl
===================================================================
--- trunk/src/server/httpd/editconfigs.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/editconfigs.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,462 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-		
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;Zylin ZY1000 JTAG debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-&lt;img src=&quot;menu_cuts/logo_top.png&quot; style=&quot;border:0px;&quot;/&gt;
-&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;&quot;&gt;Target Status&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;preconfig.tcl&quot; style=&quot;&quot;&gt;Select Target Config&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;editconfigs.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Edit Configurations&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;reload.tcl&quot; style=&quot;&quot;&gt;Reload Config Scripts&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Edit Target Configurations&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			&lt;form action=&quot;editconfigs.tcl&quot; method=&quot;post&quot;&gt;
-			}
-
-				set form_edittext [formfetch form_edittext]
-				set form_action [formfetch form_action]
-				set form_filename [formfetch form_filename]
-				set form_selected [formfetch form_selected] 
-				
-				if {[string compare $form_action &quot;Load&quot;]==0} {
-					set form_filename $form_selected
-				}
-				
-				if {[string compare $form_action &quot;Delete&quot;]==0} {
-					capture_catch &quot;rm /config/settings/$form_selected&quot;
-				}
-				
-				if {[string compare $form_action &quot;Save&quot;]==0} {
-					save_var $form_filename [from_textarea $form_edittext] 
-					append buffer &quot;Wrote file $form_filename&lt;br&gt;&quot;
-				}
-			
-				set form_edittext &quot;&quot;
-				
-				# load original or script saved on disk.
-				if {[string compare $form_action &quot;Show default&quot;]==0} {
-					set form_edittext [load_file &quot;/rom/$form_selected&quot;]
-					set form_filename $form_selected
-				} else {
-				    set form_edittext [load_config $form_filename]
-				}
-			
-				set form_edittext_subst [to_textarea $form_edittext]
-			
-				
-				proc prepend { val list } {
-					set res &quot;&quot;				
-			        foreach value $list {
-			        	set t $val
-			        	append t $value
-			            lappend res $t
-			        }
-			        return $res
-				 }				
-				
-				set files [prepend target/ [ls /rom/target]]
-				set files [lunion $files [prepend event/ [ls /config/settings/event]]]
-				set files [lunion $files [prepend target/ [ls /config/settings/target]]]
-				set files [lsort $files]
-				
-				
-append buffer {
-				&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;&lt;tr&gt;
-					&lt;td style=&quot;padding-top:1px;&quot;&gt;&lt;select name=&quot;form_selected&quot;&gt;
-						}
-
-							set foundTarget 0
-							foreach i $files {
-								
-append buffer {
-							  		&lt;option 
-							  		}
-
-								  		if {[string compare $form_filename $i]==0} { 
-											set foundTarget 1
-									  		append buffer {selected=&quot;selected&quot;} 
-								  		}
-								  	
-append buffer {
-						  		value=&quot;}
-append buffer $i
-append buffer {&quot;&gt;}
-append buffer $i
-append buffer {&lt;/option&gt;
-								}
-
-							}
-							if {$foundTarget==0} {
-								
-append buffer {
-							  		&lt;option selected=&quot;selected&quot; value=&quot;&quot;&gt;Select target config&lt;/option&gt;
-								}
-
-							}
-						
-append buffer {
-					&lt;/select&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;
-					&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Load&quot; name=&quot;form_action&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;
-					&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Show default&quot; name=&quot;form_action&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;
-					&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Delete&quot; name=&quot;form_action&quot;&gt;&lt;/td&gt;
-				&lt;/tr&gt;&lt;/table&gt;
-				&lt;textarea  style=&quot;overflow:auto;&quot;  rows=&quot;21&quot; cols=&quot;65&quot; name=&quot;form_edittext&quot; wrap=&quot;off&quot;&gt;}
-append buffer $form_edittext_subst
-append buffer {&lt;/textarea&gt;
-				&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;&lt;tr&gt;
-				}
-
-					append buffer {&lt;td class=&quot;formtext&quot;&gt;File&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_filename&quot; } &quot;\n&quot;
-					append buffer &quot;value=\&quot;$form_filename\&quot; &gt;&lt;/td&gt;\n&quot;
-					append buffer {&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Save&quot; name=&quot;form_action&quot;&gt;&lt;/td&gt;&lt;br&gt;} &quot;\n&quot;
-					append buffer {&lt;/tr&gt;&lt;/table&gt;} &quot;\n&quot;
-				
-append buffer {
-			&lt;/form&gt;			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;editconfigs.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf</A>&quot;&gt;Quick Start Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/openocd.pdf">http://www.zylin.com/zy1000/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000_contact.html">http://www.zylin.com/zy1000_contact.html</A>&quot;&gt;Contact Zylin AS&lt;/a&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				&lt;p&gt;Here you can edit predefined target configurations, restore predefined configurations to
-				default state and create new target configurations.&lt;p/&gt;
-				&lt;p&gt;Typically when creating a new target configuration, you would take an existing
-				configuration that resembles the most your needs and modify it for your
-				purposes and save it under a different name.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Load&lt;/b&gt; - Loads a configuration file into the editor.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Show default&lt;/b&gt; - Loads the firmware included version of the
-				configuration file (if any), into the editor.&lt;br&gt;
-				&lt;b&gt;Note&lt;/b&gt; that the editor content is not saved.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Delete&lt;/b&gt; - Deletes a custom created configuration file.&lt;br&gt;
-				&lt;b&gt;Note&lt;/b&gt; that firmware included configuration files can not be deleted.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Save&lt;/b&gt; - Save the edited file under the a new or the same name.&lt;/p&gt;
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td/&gt;
-&lt;td&gt;
-&lt;img border=&quot;0&quot; src=&quot;menu_cuts/logo_bottom.png&quot;/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/editconfigs.tcl (from rev 1324, trunk/src/server/httpd/editconfigs.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/editfile.tcl
===================================================================
--- trunk/src/server/httpd/editfile.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/editfile.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,436 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;Zylin ZY1000 JTAG debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-&lt;img src=&quot;menu_cuts/logo_top.png&quot; style=&quot;border:0px;&quot;/&gt;
-&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;zy1000.tcl&quot; style=&quot;&quot;&gt;Set IP Address&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;upgrade.tcl&quot; style=&quot;&quot;&gt;ZY1000 Firmware&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;editfile.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Edit File&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;support.tcl&quot; style=&quot;&quot;&gt;Support Request&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;log.tcl#tail&quot; style=&quot;&quot;&gt;View Tail of Log&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/zy1000.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Setup ZY1000&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Edit File&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-}
-
-			
-
-#Read a text file, edit it and write it back. Useful for interactive debugging
-#of tcl scripts
-
-set data &quot;&quot;
-append buffer {&lt;form action=&quot;editfile.tcl&quot; method=&quot;post&quot;&gt;} &quot;\n&quot;
-
-set err &quot;&quot;;
-
-set form_edittext [formfetch form_edittext];
-set form_action [formfetch form_action];
-set form_filename [formfetch form_filename];
-
-puts Action $form_action
-
-if {[string compare $form_action &quot;Load&quot;]==0} {
-
-	set form_edittext &quot;&quot;
-	catch {
-		set fp [aio.open $form_filename r];
-		set form_edittext [$fp read];
-		$fp close;
-	} err
-}
-if {[string compare $form_action &quot;Delete&quot;]==0} {
-	capture &quot;rm $form_filename&quot;
-}
-
-set form_edittext_subst [to_textarea $form_edittext]
-
-
-if {[string compare $form_action &quot;Save&quot;]==0} {
-	if {[catch {
-		set fp [aio.open $form_filename w];
-		$fp puts [from_textarea $form_edittext]
-		$fp close
-		append buffer &quot;Wrote file $form_filename&lt;br&gt;&quot;
-	} err]} {
-		append buffer &quot;Could not write $form_filename&lt;br&gt;&quot;
-	} 
-}
-
-
-
-
-append buffer {&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;File&lt;/td&gt;&lt;td style=&quot;padding-top:1px;&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;form_filename&quot; } &quot;\n&quot;
-append buffer &quot;value=\&quot;$form_filename\&quot; &gt;&lt;/td&gt;\n&quot;
-append buffer {&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Load&quot; name=&quot;form_action&quot; &gt;&lt;/td&gt;&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Save&quot; name=&quot;form_action&quot;&gt;&lt;/td&gt;&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Delete&quot; name=&quot;form_action&quot;&gt;&lt;/td&gt;} &quot;\n&quot;
-append buffer {&lt;/tr&gt;&lt;/table&gt;} &quot;\n&quot;
-append buffer {&lt;br&gt;}	
-
-append buffer {&lt;textarea  style=&quot;overflow:auto;&quot;  rows=&quot;18&quot; cols=&quot;65&quot; name=&quot;form_edittext&quot; wrap=&quot;off&quot;&gt;}
-append buffer $form_edittext_subst
-append buffer {&lt;/textarea&gt;&lt;br&gt;}
-
-append buffer {&lt;/html&gt; } &quot;\n&quot;
-
-
-	
-append buffer {
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;/ram/cgi/editfile.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf</A>&quot;&gt;Quick Start Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/openocd.pdf">http://www.zylin.com/zy1000/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000_contact.html">http://www.zylin.com/zy1000_contact.html</A>&quot;&gt;Contact Zylin AS&lt;/a&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				Edit any file on the ZY1000 by typing in the
-				filename and pressing Load.
-				&lt;/p&gt;
-				&lt;table style=&quot;line-height:17px;&quot;&gt;&lt;tr&gt;
-					&lt;td&gt;&lt;a href=&quot;/ram&quot; target=&quot;_blank&quot;&gt;Browse files on /ram&lt;/a&gt;&lt;br&gt;
-					&lt;a href=&quot;/config&quot; target=&quot;_blank&quot;&gt;Browse files on /config&lt;/a&gt;&lt;br&gt;
-					&lt;a href=&quot;/rom&quot; target=&quot;_blank&quot;&gt;Browse files on /rom&lt;/a&gt;&lt;/td&gt;
-				&lt;/tr&gt;&lt;/table&gt;
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td/&gt;
-&lt;td&gt;
-&lt;img border=&quot;0&quot; src=&quot;menu_cuts/logo_bottom.png&quot;/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-		
-
-
-
-		
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/editfile.tcl (from rev 1324, trunk/src/server/httpd/editfile.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/erase.tcl
===================================================================
--- trunk/src/server/httpd/erase.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/erase.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,387 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;&quot;&gt;Info&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;erase.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Erase&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flash.tcl&quot; style=&quot;&quot;&gt;Program / Verify&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;production.tcl&quot; style=&quot;&quot;&gt;Production&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Erase Flash&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-
-
-			
-			}
-
-			
-			set form_address [formfetch form_address]
-			set form_length [formfetch form_length]
-			set form_action [formfetch form_action]
-			
-			if {[string compare $form_length &quot;&quot;]==0} {
-				set form_length 0x10000
-			}  
-			if {[string compare $form_address &quot;&quot;]==0} {
-				if {[catch {[first_flash_base]} result]==0} {
-						set form_address &quot;0x[tohex $result]&quot;
-					}			
-			}  
-			
-			
-			if {[string compare $form_address &quot;&quot;]!=0} {
-				if {[string compare $form_action &quot;Erase&quot;]==0} {
-						append buffer &quot;&lt;code style=\&quot;white-space: nowrap;\&quot;&gt;&quot;
-						append console [encode [capture_catch {
-						reset init
-						flash erase_address $form_address $form_length}]]
-						append buffer &lt;/code&gt;
-				}  
-			}
-			
-			
-			
-append buffer {
-			
-			&lt;form action=&quot;erase.tcl&quot; method=&quot;post&quot;&gt; 
-				&lt;table&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot; style=&quot;padding-right:10px;&quot;&gt;Address&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_address&quot; value=&quot;}
-append buffer $form_address
-append buffer {&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Length&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_length&quot; value=&quot;}
-append buffer $form_length
-append buffer {&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-				&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Erase&quot;&gt;&lt;br&gt;
-				
-				
-			&lt;/form&gt;
-			
-
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;erase.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				&lt;p&gt;Note that flash programming will erase flash if required.&lt;p/&gt;
-				&lt;p&gt;Reset and init CPU, then erase address range.&lt;/p&gt;
-				&lt;p&gt;The length field is specified in number of bytes.&lt;/p&gt;
-					
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/erase.tcl (from rev 1324, trunk/src/server/httpd/erase.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/flash.tcl
===================================================================
--- trunk/src/server/httpd/flash.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/flash.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,459 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;&quot;&gt;Info&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;erase.tcl&quot; style=&quot;&quot;&gt;Erase&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flash.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Program / Verify&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;production.tcl&quot; style=&quot;&quot;&gt;Production&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Program / Verify Flash&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			
-			}
-
-			
-			set form_offset [formfetch form_offset]
-			set form_action [formfetch form_action]
-			set form_type [formfetch form_type]
-			
-			
-			set post &quot;&quot;
-			catch {set post $post_data} err
-			
-			if {[string compare $form_offset &quot;&quot;]==0} {
-				set form_offset 0
-			}
-			if {[string compare $form_type &quot;&quot;]==0} {
-				set form_type &quot;&quot;
-			}
-			
-			
-append buffer {&lt;code style=&quot;white-space: nowrap;&quot;&gt;}
-
-			
-			set data &quot;&quot;
-			append buffer {&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;flash.tcl&quot; method=&quot;post&quot;&gt;}
-			
-			set action_reset [expr {[string length $form_action]!=0}] 
-			set action_flash [expr {[string compare $form_action &quot;Flash&quot;]==0 || [string compare $form_action &quot;Flash and verify&quot;]==0}] 
-			set action_verify [expr {[string compare $form_action &quot;Verify&quot;]==0 || [string compare $form_action &quot;Flash and verify&quot;]==0}]
-			
-			if {$action_reset} {
-				append console [encode [capture_catch &quot;reset init&quot;]]
-			}
-			
-append buffer {
-			&lt;/code&gt;}
-
-				
-			append buffer {&lt;table&gt;}
-			append buffer {&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;File&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;file&quot; name=&quot;form_filecontent&quot;&gt;&lt;/td&gt;&lt;/tr&gt;}
-			append buffer &quot;&lt;tr&gt;&lt;td class=\&quot;formtext\&quot; &gt;Offset&lt;/td&gt;&lt;td&gt;&lt;input type=\&quot;text\&quot; name=\&quot;form_offset\&quot; value=\&quot;$form_offset\&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&quot;
-			
-			
-append buffer {
-			&lt;tr&gt;&lt;td class=&quot;formtext&quot; style=&quot;padding-top:1px;&quot;&gt;Type&lt;/td&gt;&lt;td&gt;
-			&lt;select name=&quot;form_type&quot;&gt;
-			  		&lt;option
-			   }
-if {[string compare $form_type &quot;&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  
-append buffer {
-			  		value =&quot;&quot;&gt;auto&lt;/option&gt;
-			  &lt;option 
-			   }
-if {[string compare $form_type &quot;elf&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  
-append buffer {
-			  value =&quot;elf&quot;&gt;elf&lt;/option&gt;
-			  &lt;option 
-			   }
-if {[string compare $form_type &quot;bin&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  
-append buffer {
-			  value =&quot;bin&quot;&gt;binary&lt;/option&gt;
-			  &lt;option 
-			   }
-if {[string compare $form_type &quot;ihex&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  
-append buffer {
-			  value =&quot;ihex&quot;&gt;ihex&lt;/option&gt;
-			  &lt;!-- broken &lt;option value =&quot;s19&quot;&gt;s19&lt;/option&gt; --&gt;
-			&lt;/select&gt;
-			&lt;/td&gt;
-			
-			&lt;/tr&gt;
-			
-			
-			&lt;/table&gt;
-			
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-			&lt;table&gt;&lt;tr&gt;
-				&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Flash&quot; &gt;&lt;/td&gt;
-				&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Flash and verify&quot; &gt;&lt;/td&gt;
-				&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Verify&quot; &gt;&lt;/td&gt;
-			&lt;/tr&gt;&lt;/table&gt;
-		
-			&lt;p&gt;
-			}
-
-			
-			if {$action_flash||$action_verify} {
-				catch {writeform form_filecontent $upload_filename} result
-				append console [encode $result]
-			}
-			append buffer &quot;&lt;br&gt;&quot;
-			if {$action_flash} {
-				append console [encode [capture_catch &quot;halt&quot;]]
-				append buffer &quot;&lt;b&gt;&quot;
-				if {[catch {capture_catch {eval &quot;flash write_image erase $upload_filename $form_offset $form_type&quot;}} result]} {
-					append buffer &quot;Flash write failed&lt;br&gt;&quot;
-					append console [encode $result]
-				} else {
-					append buffer [encode $result]
-					append buffer &quot;Flash write succeed&lt;br&gt;&quot;
-				}
-				append buffer &quot;&lt;/b&gt;&quot;
-			}
-			if {$action_verify} {
-				append console [encode [capture_catch &quot;halt&quot;]]
-				append buffer &quot;&lt;b&gt;&quot;
-				if {[catch {capture_catch {eval &quot;verify_image $upload_filename $form_offset $form_type&quot;}} result]} {
-					append buffer &quot;Verify failed&lt;br&gt;&quot;
-					append console [encode $result]
-				} else {
-					append buffer [encode $result]
-					append buffer &quot;Verify succeed&lt;br&gt;&quot;
-				}
-				append buffer &quot;&lt;/b&gt;&quot;
-			}
-			
-append buffer {		
-				
-			&lt;/form&gt;
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;flash.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				&lt;p&gt;Program and/or verify the flash on your target.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Flash&lt;/b&gt; - Halt CPU, automatically erase flash if required and program flash with image.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Flash and verify&lt;/b&gt; - Programs the flash and verifies the programmed flash content is correct.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Verify&lt;/b&gt; - Halt CPU and verify image in flash or RAM.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Offset&lt;/b&gt; - This value is added to the address of the image.&lt;br&gt; 
-					Binary images start at address 0 by default, whereas elf and ihex have addresses encoded into the image.&lt;br&gt; 
-					Typically 0 for elf/ihex and the address to	write the image to for binary files.&lt;/p&gt;
-					 
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/flash.tcl (from rev 1324, trunk/src/server/httpd/flash.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/flashinfo.tcl
===================================================================
--- trunk/src/server/httpd/flashinfo.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/flashinfo.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,382 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Info&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;erase.tcl&quot; style=&quot;&quot;&gt;Erase&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flash.tcl&quot; style=&quot;&quot;&gt;Program / Verify&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;production.tcl&quot; style=&quot;&quot;&gt;Production&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Flash Information&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-
-			&lt;div style=&quot;font-size:14px;&quot;&gt;Configured flash banks:&lt;/div&gt;
-			&lt;p&gt;			
-			&lt;code style=&quot;white-space: nowrap;&quot;&gt;
-				}
-
-					set flash_return [ocd_flash_banks]
-					if {[llength $flash_return]!=0} {
-						append buffer [encode [flash banks]]
-					
-						set form_action [formfetch form_action]
-						if {[string compare $form_action &quot;Reset CPU and probe flash&quot;]==0} {
-							append console [encode [capture_catch &quot;reset init&quot;]]
-							append buffer [encode [capture_catch &quot;flash probe 0&quot;]]
-							append buffer [encode [capture_catch &quot;flash info 0&quot;]]
-						}
-					} else {
-						append buffer &quot;No flash bank configured.&quot;
-					}
-				
-append buffer {
-				&lt;p&gt;
-				&lt;form action=&quot;flashinfo.tcl&quot; method=&quot;post&quot;&gt; 
-					&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Reset CPU and probe flash&quot;&gt;
-				&lt;/form&gt;
-				}
-
-					foreach a [ocd_flash_banks] {
-						append buffer &quot;Flash bank at [format &quot;0x%08x size 0x%08x&quot; $a(base) $a(size)]: &quot;
-						
-append buffer {
-							&lt;form action=&quot;downloadmem.tcl&quot; method=&quot;post&quot;&gt; 
-								&lt;input type=&quot;hidden&quot; name=&quot;form_address&quot; value=&quot;}
-append buffer [format &quot;0x%08x&quot; $a(base)]
-append buffer {&quot;&gt;
-								&lt;input type=&quot;hidden&quot; name=&quot;form_length&quot; value=&quot;}
-append buffer [format &quot;0x%08x&quot; $a(size)]
-append buffer {&quot;&gt;
-		
-								&lt;input type=&quot;submit&quot; value=&quot;Download&quot; name=&quot;form_action&quot;&gt;
-								&lt;br&gt;
-							&lt;/form&gt;
-						}
-
-					}
-				
-append buffer {
-			&lt;/code&gt;
-			
-
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;flashinfo.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				&lt;p&gt;Here you will find information about the flash chips that you have
-				in your configuration.&lt;p/&gt;
-				&lt;p&gt;&lt;b&gt;Reset CPU and probe flash&lt;/b&gt; - This will reset the CPU and show
-				you more detailed information about your flash. This includes information about
-				the different sectors in the flash, and the flash driver used.&lt;/p&gt;
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/flashinfo.tcl (from rev 1324, trunk/src/server/httpd/flashinfo.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/guiupload.tcl
===================================================================
--- trunk/src/server/httpd/guiupload.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/guiupload.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,336 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot; style=&quot;&quot;&gt;Run Command&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;guiupload.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Upload File&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Upload File&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			
-			}
-
-				set form_filename [formfetch form_filename];
-				set form_action [formfetch form_action];
-				#set form_filecontent [formfetch form_filecontent];
-				
-				append buffer {&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;guiupload.tcl&quot; method=&quot;post&quot;&gt;}
-				append buffer &lt;br&gt; 
-				if {[string compare $form_action &quot;Upload&quot;]==0} {
-					if {[catch {writeform form_filecontent $form_filename} result]==0} {
-						append buffer [encode $result]
-					} else {
-						append buffer Wrote $form_filename
-					}
-				}
-				
-				append buffer {&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Filename on OpenOCD machine&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_filename&quot;&gt;&lt;/td&gt;&lt;/tr&gt;}
-				append buffer {&lt;td class=&quot;formtext&quot;&gt;File to upload&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;file&quot; name=&quot;form_filecontent&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;}
-				append buffer {&lt;table&gt;&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;}
-				append buffer {&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Upload&quot; &gt;&lt;br&gt; }
-				append buffer {&lt;/form&gt;}
-			
-			
-append buffer {
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;guiupload.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/guiupload.tcl (from rev 1324, trunk/src/server/httpd/guiupload.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/html2tcl.sh
===================================================================
--- trunk/src/server/httpd/html2tcl.sh	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/html2tcl.sh	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,128 +0,0 @@
-#!/bin/bash
-# restart using a Tcl shell \
-	exec sh -c 'for tclshell in tclsh tclsh83 cygtclsh80 ; do \
-			( echo | $tclshell ) 2&gt; /dev/null &amp;&amp; exec $tclshell &quot;`( cygpath -w \&quot;$0\&quot; ) 2&gt; /dev/null || echo $0`&quot; &quot;$@&quot; ; \
-		done ; \
-		echo &quot;file2c.tcl: cannot find Tcl shell&quot; ; exit 1' &quot;$0&quot; &quot;$@&quot;
-
-#===============================================================================
-#
-#    file2c.tcl
-#
-#    Convert a file into a header that can be #included from C.
-#
-#===============================================================================
-#####ECOSGPLCOPYRIGHTBEGIN####
-## -------------------------------------------
-## This file is part of eCos, the Embedded Configurable Operating System.
-## Copyright (C) 1998, 1999, 2000, 2001, 2002 Red Hat, Inc.
-##
-## eCos is free software; you can redistribute it and/or modify it under
-## the terms of the GNU General Public License as published by the Free
-## Software Foundation; either version 2 or (at your option) any later version.
-##
-## eCos is distributed in the hope that it will be useful, but WITHOUT ANY
-## WARRANTY; without even the implied warranty of MERCHANTABILITY or
-## FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-## for more details.
-##
-## You should have received a copy of the GNU General Public License along
-## with eCos; if not, write to the Free Software Foundation, Inc.,
-## 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
-##
-## As a special exception, if other files instantiate templates or use macros
-## or inline functions from this file, or you compile this file and link it
-## with other works to produce a work based on this file, this file does not
-## by itself cause the resulting work to be covered by the GNU General Public
-## License. However the source code for this file must still be made available
-## in accordance with section (3) of the GNU General Public License.
-##
-## This exception does not invalidate any other reasons why a work based on
-## this file might be covered by the GNU General Public License.
-##
-## Alternative licenses for eCos may be arranged by contacting Red Hat, Inc.
-## at <A HREF="http://sources.redhat.com/ecos/ecos-license/">http://sources.redhat.com/ecos/ecos-license/</A>
-## -------------------------------------------
-#####ECOSGPLCOPYRIGHTEND####
-#===============================================================================
-######DESCRIPTIONBEGIN####
-#
-# Author(s):	jlarmour,bartv
-# Contact(s):	
-# Date:		2001-07-20
-# Purpose:      
-# Description:
-# Usage:        file2c.tcl &lt;file to encode&gt; &lt;output C header file&gt;
-#
-#####DESCRIPTIONEND####
-#===============================================================================
-
-if { $argc != 2 } {
-	puts &quot;Usage: html2tcl.tcl &lt;infile&gt; &lt;outfile&gt;&quot;
-	exit 1
-}
-set infile [lindex $argv 0]
-set outfile [lindex $argv 1]
-				
-set infilefd [open $infile &quot;r&quot;]
-set data [read $infilefd]
-close $infilefd
-
-
-
-
-if [string match *\.tcl $infile]==0 {
-	puts &quot;Not .tcl file, skipping $infile&quot;
-	exit 0
-}
-
-set outfilefd [ open $outfile &quot;w&quot; ]
-if [regexp -start 0 {^\s*&lt;html.*} $data]==0 {
-	puts &quot;copy $infile&quot;
-	puts -nonewline $outfilefd $data
-	close $outfilefd
-	exit 0
-}
-
-puts &quot;converting $infile&quot;
-
-set result &quot;&quot;
-append result &quot;# converted to .tcl by html2tcl.tcl\n&quot;
-append result &quot;set buffer \&quot;\&quot;\n&quot;
-
-set pos 0
-set done 0
-while {$done==0} {
-	set start [string first &lt;tcl&gt; $data $pos]
-	if $start==-1 {
-		# We're done...
-		set done 1
-		set start [string length $data]
-		set end $start
-	} else {
-		set end [string first &lt;/tcl&gt; $data $start]
-		if $end==-1 {
-			# uh-oh, not closed
-			puts &quot;&lt;tcl&gt; not closed!&quot;
-			exit 1
-		}
-	}
-	#puts &quot;done $done start $start end $end&quot;
-	# Dump HTML into resulting file.
-	append result &quot;append buffer {&quot;
-	append result [string range $data $pos [expr $start-1]]
-	#puts [string range $data $pos $start]
-	append result &quot;}\n&quot;
-	
-	# Dump TCL into resulting file.
-	append result &quot;[string range $data [expr $start+5] [expr $end-1]]\n&quot;
-	
-	set pos [expr $end+6]
-}
-
-append result &quot;start_chunked \&quot;html\&quot;\n&quot;
-append result {write_chunked $buffer} &quot;\n&quot;
-append result &quot;end_chunked\n&quot;
-
-puts $outfilefd $result
-close $outfilefd

Copied: branches/openocd-0.1/src/server/httpd/html2tcl.sh (from rev 1324, trunk/src/server/httpd/html2tcl.sh)

Deleted: branches/openocd-0.1/src/server/httpd/httpd.tcl
===================================================================
--- trunk/src/server/httpd/httpd.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/httpd.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,113 +0,0 @@
-# some dummy proc's to get things going for test purposes
-
-
-
-proc ip {} {
-return 10.0.0.55
-}
-
-proc start_chunked {a} {
-	global httpdata
-	global httpmime
-	set httpmime $a
-	set httpdata &quot;&quot;
-}
-
-proc write_chunked {a} {
-	global httpdata
-	append httpdata $a
-}
-
-proc end_chunked {} {
-}
-
-
-
-#proc formfetch {a} {
-#	global httppostdata
-	#catch { 
-#	echo &quot;$a=$httppostdata($a)&quot;
-	#return $httppostdata($a) 
-	#}
-#	
-	#return &quot;&quot;  
-#}
-
-
-
-
-proc tohex {a} {
-   set r &quot;&quot;
-   while 1 {
-
-      set rem [expr $a%16]
-      set a [expr $a/16]
-      set r [string index &quot;0123456789abcdef&quot; $rem]$r
-      if ($a==0) then break
-   }  
-   return $r 
-}
-
-# encode text
-proc encode {a} {
-	return [string map {\n &lt;br/&gt; { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &gt; &gt; &lt; &lt; / &#47;} $a]
-}
-
-#stubs that can be overriden to save between sessions
-proc load_var {a} {
-	global glob_var
-	catch {
-		return $glob_var($a)
-	}
-	return &quot;&quot;
-}
-#stubs that can be overriden to save between sessions
-proc save_var {a b} {
-	catch { 
-	set glob_var($a) $b
-	return &quot;&quot;
-	} err
-	set glob_var($a) &quot;&quot;
-	return &quot;&quot;
-}
-
-
-
-proc to_textarea {a} {
-	return [string map {&amp; &#38; &gt; &gt; &lt; &lt; / &#47;} $a]
-}	
-
-proc from_textarea {a} {
-	return [string map {&gt; &gt; &lt; &lt; &#38; &amp; &#47; /} $a]
-}
-	
-proc lunion {a b} {
-	foreach e $a {
-		set x($e) {}
-	}
- 	foreach e $b {
-		if {![info exists x($e)]} {
-    		lappend a $e
-		}
-	}
- 	return $a
-}
- 
-
-# encode text
-proc encode {a} {
-	return [string map {\n &lt;br/&gt; { } {&nbsp;} \t {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &gt; &gt; &lt; &lt; / &#47;} $a]
-}
-
-# catch any exceptions, capture output and return it 
-proc capture_catch {a} {
-	catch {
-		capture {uplevel $a}
-	} result
-	return $result 
-}
-
-proc first_flash_base {} {
-	set t [lindex 0 [ocd_flash_banks]]
-	return $t(base)
-}

Copied: branches/openocd-0.1/src/server/httpd/httpd.tcl (from rev 1324, trunk/src/server/httpd/httpd.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/index.tcl
===================================================================
--- trunk/src/server/httpd/index.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/index.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,376 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Target Status&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;OpenOCD debugger&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-
-			
-			&lt;table&gt;
-				&lt;tr&gt;&lt;td style=&quot;height:10px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td style=&quot;height:5px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-			&lt;/table&gt;
-
-			&lt;H1&gt;Target Status&lt;/H1&gt;
-
-			&lt;table&gt;
-				&lt;tr&gt;
-					&lt;td class=&quot;fontbigger&quot;&gt;
-						}
-
-							set form_address [formfetch form_address]
-							set form_action [formfetch form_action]
-							
-							if {[string compare $form_action &quot;Halt&quot;]==0} {
-								append console [encode [capture_catch &quot;halt&quot;]]
-							}
-							if {[string compare $form_action &quot;Resume&quot;]==0} {
-								append console [encode [capture_catch &quot;resume&quot;]]
-							}
-							  
-							if {[string compare $form_action &quot;Reset and run&quot;]==0} {
-								append console [encode [capture_catch &quot;reset run&quot;]]
-							}
-							
-							if {[string compare $form_action &quot;Power on&quot;]==0} {
-								append console [encode [capture_catch &quot;power on&quot;]]
-							}
-							if {[string compare $form_action &quot;Power off&quot;]==0} {
-								append console [encode [capture_catch &quot;power off&quot;]]
-							}
-						
-append buffer {
-					
-						}
-append console [encode [capture_catch poll]]
-append buffer {
-					&lt;/td&gt;
-				&lt;/tr&gt;
-			&lt;/table&gt;
-
-			&lt;form action=&quot;index.tcl&quot; method=&quot;post&quot;&gt; 
-				&lt;table&gt;&lt;tr&gt;
-					&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Reset and run&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Halt&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Resume&quot;&gt;&lt;/td&gt;
-					&lt;td style=&quot;width:50px;&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Power on&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Power off&quot;&gt;&lt;/td&gt;
-				&lt;/tr&gt;&lt;/table&gt;
-
-				&lt;br&gt;						
-				&lt;br&gt;						
-										
-				&lt;p&gt;
-			&lt;/form&gt;
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;index.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-					&lt;p&gt;Target status shows that status of the connected target. &lt;/p&gt; 
-					&lt;p&gt;&lt;b&gt;Current target&lt;/b&gt; - selected target configuration. &lt;br&gt;
-					&lt;p&gt;&lt;b&gt;Startup&lt;/b&gt; - whether or not the target script ran to completion. Note
-					that even if the target is disconnected, powered down or unresponsive, the
-					startup script will still run to completion. Startup - OK does not mean
-					that the target is fully operational, simply that the configuration script
-					did not contain syntax errors for instance. 
-					See log for details. &lt;br&gt;
-					&lt;p&gt;&lt;b&gt;Target power&lt;/b&gt; - Detects power on target. &lt;br&gt;
-					If the JTAG cable is not connected, or the target has no power, then no target power will be detected.&lt;/p&gt;
-					&lt;p&gt;Type &quot;help power&quot; in telnet for command to control power relay.&lt;/p&gt;
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/index.tcl (from rev 1324, trunk/src/server/httpd/index.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/log.tcl
===================================================================
--- trunk/src/server/httpd/log.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/log.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,343 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;Zylin ZY1000 JTAG debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-&lt;img src=&quot;menu_cuts/logo_top.png&quot; style=&quot;border:0px;&quot;/&gt;
-&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot; style=&quot;&quot;&gt;Run Command&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;guiupload.tcl&quot; style=&quot;&quot;&gt;Upload File to ZY1000&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;log.tcl#tail&quot; style=&quot;&quot;&gt;View Tail of Log&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;View Tail of Log&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			}
-
-				append buffer &quot;&lt;code style=\&quot;white-space: nowrap;\&quot;&gt;&quot;
-				append buffer [encode [log]]
-				append buffer {&lt;p&gt;&lt;p&gt;&lt;p&gt;&lt;a name=&quot;tail&quot;/&gt;} 
-				append buffer {&lt;a href=&quot;log.tcl}
-				append buffer &quot;?rnd=[rand]&quot;
-				append buffer {#tail&quot;&gt;Refresh&lt;/a&gt;} 
-				append buffer {&lt;p&gt;} 
-				append buffer &quot;&lt;/code&gt;&quot;;
-			
-append buffer {
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;log.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf</A>&quot;&gt;Quick Start Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/openocd.pdf">http://www.zylin.com/zy1000/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000_contact.html">http://www.zylin.com/zy1000_contact.html</A>&quot;&gt;Contact Zylin AS&lt;/a&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td/&gt;
-&lt;td&gt;
-&lt;img border=&quot;0&quot; src=&quot;menu_cuts/logo_bottom.png&quot;/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/log.tcl (from rev 1324, trunk/src/server/httpd/log.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/menu.xml
===================================================================
--- trunk/src/server/httpd/menu.xml	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/menu.xml	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,973 +0,0 @@
-&lt;?xml version = &quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot;?&gt;
-&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;plaintext.xsl&quot;?&gt;
-&lt;website&gt;
-	
-	&lt;language lang=&quot;Norsk&quot;&gt;
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;index.tcl&lt;/outfile&gt;
-			&lt;menutext&gt;Config Target&lt;/menutext&gt; 
-			&lt;menulink&gt;index.tcl&lt;/menulink&gt; 
-			&lt;pageheading&gt;OpenOCD debugger&lt;/pageheading&gt;
-			&lt;level2parent&gt;index.tcl&lt;/level2parent&gt;
-			&lt;level2menu href=&quot;index.tcl&quot; title=&quot;Target Status&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;/level2menu&gt;
-			&lt;!-- 
-			&lt;level2menu href=&quot;terminal.tcl&quot; title=&quot;UART forwarding&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;/level2menu&gt;
-			 --&gt;
-		
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-
-			
-			&lt;table&gt;
-				&lt;tr&gt;&lt;td style=&quot;height:10px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td style=&quot;height:5px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-			&lt;/table&gt;
-
-			&lt;H1&gt;Target Status&lt;/H1&gt;
-
-			&lt;table&gt;
-				&lt;tr&gt;
-					&lt;td class=&quot;fontbigger&quot;&gt;
-						&lt;tcl&gt;
-							set form_address [formfetch form_address]
-							set form_action [formfetch form_action]
-							
-							if {[string compare $form_action &quot;Halt&quot;]==0} {
-								append console [encode [capture_catch &quot;halt&quot;]]
-							}
-							if {[string compare $form_action &quot;Resume&quot;]==0} {
-								append console [encode [capture_catch &quot;resume&quot;]]
-							}
-							  
-							if {[string compare $form_action &quot;Reset and run&quot;]==0} {
-								append console [encode [capture_catch &quot;reset run&quot;]]
-							}
-							
-							if {[string compare $form_action &quot;Power on&quot;]==0} {
-								append console [encode [capture_catch &quot;power on&quot;]]
-							}
-							if {[string compare $form_action &quot;Power off&quot;]==0} {
-								append console [encode [capture_catch &quot;power off&quot;]]
-							}
-						&lt;/tcl&gt;
-					
-						&lt;tcl&gt;append console [encode [capture_catch poll]]&lt;/tcl&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-			&lt;/table&gt;
-
-			&lt;form action=&quot;index.tcl&quot; method=&quot;post&quot;&gt; 
-				&lt;table&gt;&lt;tr&gt;
-					&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Reset and run&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Halt&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Resume&quot;&gt;&lt;/td&gt;
-					&lt;td style=&quot;width:50px;&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Power on&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Power off&quot;&gt;&lt;/td&gt;
-				&lt;/tr&gt;&lt;/table&gt;
-
-				&lt;br&gt;						
-				&lt;br&gt;						
-										
-				&lt;p&gt;
-			&lt;/form&gt;
-			]]&gt;&lt;/markup_code&gt;
-			&lt;right_column&gt;
-				&lt;markup_code&gt;&lt;![CDATA[
-					&lt;p&gt;Target status shows that status of the connected target. &lt;/p&gt; 
-					&lt;p&gt;&lt;b&gt;Current target&lt;/b&gt; - selected target configuration. &lt;br&gt;
-					&lt;p&gt;&lt;b&gt;Startup&lt;/b&gt; - whether or not the target script ran to completion. Note
-					that even if the target is disconnected, powered down or unresponsive, the
-					startup script will still run to completion. Startup - OK does not mean
-					that the target is fully operational, simply that the configuration script
-					did not contain syntax errors for instance. 
-					See log for details. &lt;br&gt;
-					&lt;p&gt;&lt;b&gt;Target power&lt;/b&gt; - Detects power on target. &lt;br&gt;
-					If the JTAG cable is not connected, or the target has no power, then no target power will be detected.&lt;/p&gt;
-					&lt;p&gt;Type &quot;help power&quot; in telnet for command to control power relay.&lt;/p&gt;
-				]]&gt;&lt;/markup_code&gt;
-			&lt;/right_column&gt;
-			
-			&lt;/pagetext&gt;
-		&lt;/page&gt;
-		
-		
-
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;targets.tcl&lt;/outfile&gt;
-			&lt;level2parent&gt;documentation.tcl&lt;/level2parent&gt;
-			&lt;pageheading&gt;Target config quick start guide&lt;/pageheading&gt;
-			&lt;pagetext&gt;
-				&lt;markup_code&gt;&lt;![CDATA[
-				
-				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either OpenOCD ships with an
-				openocd.cfg file for your target or you need to take an existing
-				config file and modify it for your needs.
-				&lt;p&gt; 
-				The reset init script is crucial. It will set up e.g. MMU, chip
-				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
-				&lt;p&gt;
-				Writing an openocd.cfg from scratch is a non-trivial exercise, but
-				fortunally it only has to be done once for a target and afterwards it
-				rarely if ever needs to be changed.
-				
-				
-				]]&gt;&lt;/markup_code&gt;
-				&lt;right_column&gt;
-					
-					  Quick start guide on how to configure a target.
-				&lt;/right_column&gt;
-			&lt;/pagetext&gt;
-			
-			
-		&lt;/page&gt;
-
-
-
-		
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;flashinfo.tcl&lt;/outfile&gt;
-			&lt;menutext&gt;Flash&lt;/menutext&gt; 
-			&lt;menulink&gt;flashinfo.tcl&lt;/menulink&gt; 
-			&lt;pageheading&gt;Flash Information&lt;/pageheading&gt;
-			&lt;level2parent&gt;flashinfo.tcl&lt;/level2parent&gt;
-			&lt;level2menu href=&quot;flashinfo.tcl&quot; title=&quot;Info&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;/level2menu&gt;
-			&lt;level2menu href=&quot;erase.tcl&quot; title=&quot;Erase&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;/level2menu&gt;
-			&lt;level2menu href=&quot;flash.tcl&quot; title=&quot;Program / Verify&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;/level2menu&gt;
-			&lt;level2menu href=&quot;production.tcl&quot; title=&quot;Production&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;/level2menu&gt;
-
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-
-			&lt;div style=&quot;font-size:14px;&quot;&gt;Configured flash banks:&lt;/div&gt;
-			&lt;p&gt;			
-			&lt;code style=&quot;white-space: nowrap;&quot;&gt;
-				&lt;tcl&gt;
-					set flash_return [ocd_flash_banks]
-					if {[llength $flash_return]!=0} {
-						append buffer [encode [flash banks]]
-					
-						set form_action [formfetch form_action]
-						if {[string compare $form_action &quot;Reset CPU and probe flash&quot;]==0} {
-							append console [encode [capture_catch &quot;reset init&quot;]]
-							append buffer [encode [capture_catch &quot;flash probe 0&quot;]]
-							append buffer [encode [capture_catch &quot;flash info 0&quot;]]
-						}
-					} else {
-						append buffer &quot;No flash bank configured.&quot;
-					}
-				&lt;/tcl&gt;
-				&lt;p&gt;
-				&lt;form action=&quot;flashinfo.tcl&quot; method=&quot;post&quot;&gt; 
-					&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Reset CPU and probe flash&quot;&gt;
-				&lt;/form&gt;
-				&lt;tcl&gt;
-					foreach a [ocd_flash_banks] {
-						append buffer &quot;Flash bank at [format &quot;0x%08x size 0x%08x&quot; $a(base) $a(size)]: &quot;
-						&lt;/tcl&gt;
-							&lt;form action=&quot;downloadmem.tcl&quot; method=&quot;post&quot;&gt; 
-								&lt;input type=&quot;hidden&quot; name=&quot;form_address&quot; value=&quot;&lt;tcl&gt;append buffer [format &quot;0x%08x&quot; $a(base)]&lt;/tcl&gt;&quot;&gt;
-								&lt;input type=&quot;hidden&quot; name=&quot;form_length&quot; value=&quot;&lt;tcl&gt;append buffer [format &quot;0x%08x&quot; $a(size)]&lt;/tcl&gt;&quot;&gt;
-		
-								&lt;input type=&quot;submit&quot; value=&quot;Download&quot; name=&quot;form_action&quot;&gt;
-								&lt;br&gt;
-							&lt;/form&gt;
-						&lt;tcl&gt;
-					}
-				&lt;/tcl&gt;
-			&lt;/code&gt;
-			
-
-			]]&gt;&lt;/markup_code&gt;
-			&lt;right_column&gt;
-				&lt;![CDATA[
-				&lt;p&gt;Here you will find information about the flash chips that you have
-				in your configuration.&lt;p/&gt;
-				&lt;p&gt;&lt;b&gt;Reset CPU and probe flash&lt;/b&gt; - This will reset the CPU and show
-				you more detailed information about your flash. This includes information about
-				the different sectors in the flash, and the flash driver used.&lt;/p&gt;
-				]]&gt;
-			&lt;/right_column&gt;
-			
-			&lt;/pagetext&gt;
-		&lt;/page&gt;
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;flash.tcl&lt;/outfile&gt;
-			&lt;level2parent&gt;flashinfo.tcl&lt;/level2parent&gt;
-			&lt;pageheading&gt;Program / Verify Flash&lt;/pageheading&gt;
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-			
-			&lt;tcl&gt;
-			
-			set form_offset [formfetch form_offset]
-			set form_action [formfetch form_action]
-			set form_type [formfetch form_type]
-			
-			
-			set post &quot;&quot;
-			catch {set post $post_data} err
-			
-			if {[string compare $form_offset &quot;&quot;]==0} {
-				set form_offset 0
-			}
-			if {[string compare $form_type &quot;&quot;]==0} {
-				set form_type &quot;&quot;
-			}
-			
-			&lt;/tcl&gt;&lt;code style=&quot;white-space: nowrap;&quot;&gt;&lt;tcl&gt;
-			
-			set data &quot;&quot;
-			append buffer {&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;flash.tcl&quot; method=&quot;post&quot;&gt;}
-			
-			set action_reset [expr {[string length $form_action]!=0}] 
-			set action_flash [expr {[string compare $form_action &quot;Flash&quot;]==0 || [string compare $form_action &quot;Flash and verify&quot;]==0}] 
-			set action_verify [expr {[string compare $form_action &quot;Verify&quot;]==0 || [string compare $form_action &quot;Flash and verify&quot;]==0}]
-			
-			if {$action_reset} {
-				append console [encode [capture_catch &quot;reset init&quot;]]
-			}
-			&lt;/tcl&gt;
-			&lt;/code&gt;&lt;tcl&gt;
-				
-			append buffer {&lt;table&gt;}
-			append buffer {&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;File&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;file&quot; name=&quot;form_filecontent&quot;&gt;&lt;/td&gt;&lt;/tr&gt;}
-			append buffer &quot;&lt;tr&gt;&lt;td class=\&quot;formtext\&quot; &gt;Offset&lt;/td&gt;&lt;td&gt;&lt;input type=\&quot;text\&quot; name=\&quot;form_offset\&quot; value=\&quot;$form_offset\&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&quot;
-			
-			&lt;/tcl&gt;
-			&lt;tr&gt;&lt;td class=&quot;formtext&quot; style=&quot;padding-top:1px;&quot;&gt;Type&lt;/td&gt;&lt;td&gt;
-			&lt;select name=&quot;form_type&quot;&gt;
-			  		&lt;option
-			   &lt;tcl&gt;if {[string compare $form_type &quot;&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  &lt;/tcl&gt;
-			  		value =&quot;&quot;&gt;auto&lt;/option&gt;
-			  &lt;option 
-			   &lt;tcl&gt;if {[string compare $form_type &quot;elf&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  &lt;/tcl&gt;
-			  value =&quot;elf&quot;&gt;elf&lt;/option&gt;
-			  &lt;option 
-			   &lt;tcl&gt;if {[string compare $form_type &quot;bin&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  &lt;/tcl&gt;
-			  value =&quot;bin&quot;&gt;binary&lt;/option&gt;
-			  &lt;option 
-			   &lt;tcl&gt;if {[string compare $form_type &quot;ihex&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  &lt;/tcl&gt;
-			  value =&quot;ihex&quot;&gt;ihex&lt;/option&gt;
-			  &lt;!-- broken &lt;option value =&quot;s19&quot;&gt;s19&lt;/option&gt; --&gt;
-			&lt;/select&gt;
-			&lt;/td&gt;
-			
-			&lt;/tr&gt;
-			
-			
-			&lt;/table&gt;
-			
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-			&lt;table&gt;&lt;tr&gt;
-				&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Flash&quot; &gt;&lt;/td&gt;
-				&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Flash and verify&quot; &gt;&lt;/td&gt;
-				&lt;td class=&quot;buttonspacesmall&quot;&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Verify&quot; &gt;&lt;/td&gt;
-			&lt;/tr&gt;&lt;/table&gt;
-		
-			&lt;p&gt;
-			&lt;tcl&gt;
-			
-			if {$action_flash||$action_verify} {
-				catch {writeform form_filecontent $upload_filename} result
-				append console [encode $result]
-			}
-			append buffer &quot;&lt;br&gt;&quot;
-			if {$action_flash} {
-				append console [encode [capture_catch &quot;halt&quot;]]
-				append buffer &quot;&lt;b&gt;&quot;
-				if {[catch {capture_catch {eval &quot;flash write_image erase $upload_filename $form_offset $form_type&quot;}} result]} {
-					append buffer &quot;Flash write failed&lt;br&gt;&quot;
-					append console [encode $result]
-				} else {
-					append buffer [encode $result]
-					append buffer &quot;Flash write succeed&lt;br&gt;&quot;
-				}
-				append buffer &quot;&lt;/b&gt;&quot;
-			}
-			if {$action_verify} {
-				append console [encode [capture_catch &quot;halt&quot;]]
-				append buffer &quot;&lt;b&gt;&quot;
-				if {[catch {capture_catch {eval &quot;verify_image $upload_filename $form_offset $form_type&quot;}} result]} {
-					append buffer &quot;Verify failed&lt;br&gt;&quot;
-					append console [encode $result]
-				} else {
-					append buffer [encode $result]
-					append buffer &quot;Verify succeed&lt;br&gt;&quot;
-				}
-				append buffer &quot;&lt;/b&gt;&quot;
-			}
-			&lt;/tcl&gt;		
-				
-			&lt;/form&gt;
-			
-			]]&gt;&lt;/markup_code&gt;
-			
-			&lt;right_column&gt;
-				&lt;![CDATA[
-				&lt;p&gt;Program and/or verify the flash on your target.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Flash&lt;/b&gt; - Halt CPU, automatically erase flash if required and program flash with image.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Flash and verify&lt;/b&gt; - Programs the flash and verifies the programmed flash content is correct.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Verify&lt;/b&gt; - Halt CPU and verify image in flash or RAM.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Offset&lt;/b&gt; - This value is added to the address of the image.&lt;br&gt; 
-					Binary images start at address 0 by default, whereas elf and ihex have addresses encoded into the image.&lt;br&gt; 
-					Typically 0 for elf/ihex and the address to	write the image to for binary files.&lt;/p&gt;
-					]]&gt; 
-			&lt;/right_column&gt;
-			
-			
-			&lt;/pagetext&gt;
-			
-		&lt;/page&gt;
-
-
-
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;production.tcl&lt;/outfile&gt;
-			&lt;level2parent&gt;flashinfo.tcl&lt;/level2parent&gt;
-			&lt;pageheading&gt;Production&lt;/pageheading&gt;
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-			&lt;tcl&gt;
-				set form_action [formfetch form_action]
-				set form_serialnumber [formfetch form_serialnumber]
-				append buffer [production_info]
-			&lt;/tcl&gt;
-				
-			&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;production.tcl&quot; method=&quot;post&quot;&gt;
-				&lt;code style=&quot;white-space: nowrap;&quot;&gt;
-					&lt;tcl&gt;	
-						if {[string compare $form_action &quot;Upload firmware&quot;]==0} {
-							set wrotedata [catch {writeform form_filecontent $upload_filename} result]  
-							append buffer [encode $result]
-							if {$wrotedata==0} {
-								append buffer &quot;&lt;br&gt;Running production procedure&lt;p&gt;&quot;
-								append buffer &quot;&lt;br&gt;Reset and init: &lt;br&gt;&quot;
-								
-								append console [encode [capture_catch {catch &quot;production $upload_filename $form_serialnumber&quot;}]]
-							}
-						}
-						if {[string compare $form_action &quot;Test&quot;]==0} {
-							append buffer &quot;&lt;br&gt;Running production test. Output from first 10 seconds printed below. &lt;p&gt;&quot;
-							
-							append console [encode [capture_catch {catch production_test}]]
-						}
-						if {[string compare $form_action &quot;Power on&quot;]==0} {
-							append console [encode [capture_catch &quot;power on&quot;]]
-						}
-						if {[string compare $form_action &quot;Power off&quot;]==0} {
-							append console [encode [capture_catch &quot;power off&quot;]]
-						}
-					&lt;/tcl&gt;
-				&lt;/code&gt;
-				&lt;tcl&gt;
-					append buffer {&lt;p class=&quot;formtext&quot;&gt;Firmware file(raw binary) &lt;input type=&quot;file&quot; name=&quot;form_filecontent&quot;&gt;&lt;p&gt;}
-					append buffer {&lt;p class=&quot;formtext&quot;&gt;Serial number &lt;input type=&quot;text&quot; name=&quot;form_serialnumber&quot;&gt;&lt;p&gt;}
-				&lt;/tcl&gt;
-				
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-				&lt;table&gt;&lt;tr&gt;
-					&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Upload firmware&quot; &gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Test&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Power on&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Power off&quot;&gt;
-				&lt;/tr&gt;&lt;/table&gt;
-			&lt;/form&gt;
-			
-			]]&gt;&lt;/markup_code&gt;
-			
-			&lt;right_column&gt;
-				&lt;![CDATA[
-				The target script can implement the &quot;production&quot;, &quot;production_info&quot; and &quot;production_test&quot; tcl proc's. These procedures
-				are used on this page. There are default implementations that do nothing.
-				
-				&lt;p&gt;&lt;b&gt;Upload firmware&lt;/b&gt; - Power cycle target, reset target and program raw binary file to flash bank 0, offset 0 and verify flash programming. Leave target powered on.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Test&lt;/b&gt; -  Power up target, run 10 second target test. Output is provided via the DCC output channel. &lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Power on&lt;/b&gt; - Power on target.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Power off&lt;/b&gt; - Power off target.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Serial number&lt;/b&gt; - A target script can use this string in the production procedure. Type &quot;help production&quot; for more info.&lt;/p&gt;
-					]]&gt; 
-			&lt;/right_column&gt;
-			
-			
-			&lt;/pagetext&gt;
-			
-		&lt;/page&gt;
-
-
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;erase.tcl&lt;/outfile&gt;
-			&lt;menulink&gt;erase.tcl&lt;/menulink&gt; 
-			&lt;pageheading&gt;Erase Flash&lt;/pageheading&gt;
-			&lt;level2parent&gt;flashinfo.tcl&lt;/level2parent&gt;
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-
-
-			
-			&lt;tcl&gt;
-			
-			set form_address [formfetch form_address]
-			set form_length [formfetch form_length]
-			set form_action [formfetch form_action]
-			
-			if {[string compare $form_length &quot;&quot;]==0} {
-				set form_length 0x10000
-			}  
-			if {[string compare $form_address &quot;&quot;]==0} {
-				if {[catch {[first_flash_base]} result]==0} {
-						set form_address &quot;0x[tohex $result]&quot;
-					}			
-			}  
-			
-			
-			if {[string compare $form_address &quot;&quot;]!=0} {
-				if {[string compare $form_action &quot;Erase&quot;]==0} {
-						append buffer &quot;&lt;code style=\&quot;white-space: nowrap;\&quot;&gt;&quot;
-						append console [encode [capture_catch {
-						reset init
-						flash erase_address $form_address $form_length}]]
-						append buffer &lt;/code&gt;
-				}  
-			}
-			
-			
-			&lt;/tcl&gt;
-			
-			&lt;form action=&quot;erase.tcl&quot; method=&quot;post&quot;&gt; 
-				&lt;table&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot; style=&quot;padding-right:10px;&quot;&gt;Address&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_address&quot; value=&quot;&lt;tcl&gt;append buffer $form_address&lt;/tcl&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Length&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_length&quot; value=&quot;&lt;tcl&gt;append buffer $form_length&lt;/tcl&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-				&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Erase&quot;&gt;&lt;br&gt;
-				
-				
-			&lt;/form&gt;
-			
-
-			
-			]]&gt;&lt;/markup_code&gt;
-			&lt;right_column&gt;
-				&lt;![CDATA[
-				&lt;p&gt;Note that flash programming will erase flash if required.&lt;p/&gt;
-				&lt;p&gt;Reset and init CPU, then erase address range.&lt;/p&gt;
-				&lt;p&gt;The length field is specified in number of bytes.&lt;/p&gt;
-					]]&gt;
-			&lt;/right_column&gt;
-			
-			&lt;/pagetext&gt;
-		&lt;/page&gt;
-
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;run.tcl&lt;/outfile&gt;
-			&lt;menulink&gt;run.tcl&lt;/menulink&gt; 
-			&lt;pageheading&gt;Run program&lt;/pageheading&gt;
-			&lt;level2parent&gt;flashinfo.tcl&lt;/level2parent&gt;
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-
-
-			
-&lt;tcl&gt;
-
-set form_address [formfetch form_address]
-set form_action [formfetch form_action]
-
-if {[string compare $form_action &quot;Run from address&quot;]==0} {
-	append console [encode [capture_catch &quot;halt&quot;]]
-	append console [encode [capture_catch &quot;wait_halt&quot;]]
-	append console [encode [capture_catch &quot;resume $form_address&quot;]]
-}  
-
-if {[string compare $form_action &quot;Halt&quot;]==0} {
-	append console [encode [capture_catch &quot;halt&quot;]]
-	append console [encode [capture_catch &quot;wait_halt&quot;]]
-}
-  
-if {[string compare $form_action &quot;Reset and run&quot;]==0} {
-	append console [encode [capture_catch &quot;reset run&quot;]]
-}
-  
-if {[string compare $form_action &quot;Reset and init&quot;]==0} {
-	append console [encode [capture_catch &quot;reset init&quot;]]
-}  
-
-append console [encode [capture_catch poll]]
-
-&lt;/tcl&gt;
-
-&lt;form action=&quot;run.tcl&quot; method=&quot;post&quot;&gt; 
-	&lt;table&gt;
-	&lt;tr&gt;&lt;td class=&quot;formtext&quot; style=&quot;padding-right:10px;&quot;&gt;Address&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_address&quot; value=&quot;&lt;tcl&gt;append buffer $form_address&lt;/tcl&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-	&lt;/td&gt;&lt;/tr&gt;
-	&lt;/table&gt;
-	&lt;table&gt;
-		&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-		&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-		&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-	&lt;/table&gt;
-	
-	&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Reset and run&quot;&gt; &lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Run from address&quot;&gt; &lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Halt&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Reset and init&quot;&gt;&lt;br&gt;
-&lt;/form&gt;
-			
-
-			
-			]]&gt;&lt;/markup_code&gt;
-			&lt;right_column&gt;
-				&lt;![CDATA[
-				&lt;p&gt;Reset and run - reset CPU and let it run.&lt;/p&gt;
-				&lt;p&gt;Halt - halt CPU.&lt;/p&gt;
-				&lt;p&gt;Run from address - halt CPU and resume from address. Default is resume from current address.&lt;/p&gt;
-				&lt;p&gt;Reset and init - reset CPU and run init script.&lt;/p&gt;
-				]]&gt;
-			&lt;/right_column&gt;
-			
-			&lt;/pagetext&gt;
-		&lt;/page&gt;
-
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;browsemem.tcl&lt;/outfile&gt;
-			&lt;menutext&gt;Memory&lt;/menutext&gt; 
-			&lt;menulink&gt;browsemem.tcl&lt;/menulink&gt; 
-			&lt;pageheading&gt;Browse / Edit Memory&lt;/pageheading&gt;
-			&lt;level2parent&gt;browsemem.tcl&lt;/level2parent&gt;
-			&lt;level2menu href=&quot;browsemem.tcl&quot; title=&quot;Browse / Edit&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;![CDATA[
-				Browse and edit memory.
-			]]&gt;
-			&lt;/level2menu&gt;
-			&lt;level2menu href=&quot;downloadmem.tcl&quot; title=&quot;Download&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;![CDATA[
-			    Copy memory range to developer machine
-			]]&gt;
-			&lt;/level2menu&gt;
-			
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-
-
-			
-			&lt;tcl&gt;
-			
-			set form_address [formfetch form_address]
-			set form_length [formfetch form_length]
-			set form_type [formfetch form_type]
-			set form_action [formfetch form_action]
-			set form_value [formfetch form_value]
-			
-			if {[string compare $form_length &quot;&quot;]==0} {
-				set form_length 0
-			}  
-			if {$form_length&lt;=0} {
-				set form_length 0x80
-			} 
-			if {$form_length&gt;0x1000} {
-				set form_length 0x1000
-			} 
-			
-			if {[string compare $form_type &quot;&quot;]==0} {
-				set form_type mdw
-			}
-			
-			if {[string compare $form_type &quot;mdw&quot;]==0} {
-				set wordsize 4
-				set modify_cmd mww 
-			}
-			if {[string compare $form_type &quot;mdh&quot;]==0} {
-				set wordsize 2
-				set modify_cmd mwh 
-			}
-			if {[string compare $form_type &quot;mdb&quot;]==0} {
-				set wordsize 1
-				set modify_cmd mwb 
-			}
-			
-			
-			
-			
-			if {[string compare $form_address &quot;&quot;]!=0} {
-				if {[string compare $form_action &quot;Previous&quot;]==0} {
-					# Kludge! Work around problems parsing hex in Jim Tcl expressions
-					incr form_address ; set form_address [expr $form_address-1]
-					if {$form_address-$form_length&gt;0} {
-						set form_address &quot;0x[tohex [expr $form_address-$form_length]]&quot;
-					} else {
-						set form_address &quot;0x0&quot;
-					}
-				}  
-				if {[string compare $form_action &quot;Next&quot;]==0} {
-					# Kludge! Work around problems parsing hex in Jim Tcl expressions
-					incr form_address ; set form_address [expr $form_address-1]
-					set form_address &quot;0x[tohex [expr $form_address+$form_length]]&quot;
-				}  
-				if {[string compare $form_action &quot;Modify&quot;]==0} {
-					append console [capture_catch &quot;$modify_cmd $form_address $form_value&quot;]
-				}  
-				if {[string compare $form_action &quot;Fill&quot;]==0} {
-					append console [capture_catch &quot;$modify_cmd $form_address $form_value $form_length&quot;]
-				}  
-			}
-			
-			
-			&lt;/tcl&gt;
-			
-			&lt;form action=&quot;browsemem.tcl&quot; method=&quot;post&quot;&gt; 
-				&lt;table&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Address&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_address&quot; value=&quot;&lt;tcl&gt;append buffer $form_address&lt;/tcl&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Length&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_length&quot; value=&quot;&lt;tcl&gt;append buffer &quot;0x[tohex $form_length]&quot;&lt;/tcl&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Value&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_value&quot; value=&quot;&lt;tcl&gt;append buffer $form_value&lt;/tcl&gt;&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Modify&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Fill&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Type&lt;/td&gt;&lt;td style=&quot;padding-top:1px;&quot;&gt;
-				&lt;select name=&quot;form_type&quot;&gt;
-				  &lt;option 
-				    &lt;tcl&gt;if {[string compare $form_type &quot;mdb&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  &lt;/tcl&gt; value =&quot;mdb&quot;&gt;8 bit
-				  &lt;/option&gt;
-				  &lt;option 
-				   &lt;tcl&gt;if {[string compare $form_type &quot;mdh&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  &lt;/tcl&gt; value =&quot;mdh&quot;&gt;16 bit
-				  &lt;/option&gt;
-			  		&lt;option
-					   &lt;tcl&gt;if {[string compare $form_type &quot;mdw&quot;]==0} { append buffer {selected=&quot;selected&quot;} }  &lt;/tcl&gt;value =&quot;mdw&quot;&gt;32 bit
-				  	&lt;/option&gt;
-				&lt;/select&gt;
-				
-				&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-				&lt;table&gt;&lt;tr&gt;
-					&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Refresh&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Previous&quot; &gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Next&quot; &gt;&lt;/td&gt;
-				&lt;/tr&gt;&lt;/table&gt;
-				&lt;br&gt;
-				
-			&lt;/form&gt;
-			&lt;p&gt;
-			&lt;div class=&quot;fontbigger&quot;&gt;Memory:&lt;/div&gt;&lt;p&gt;
-			&lt;code style=&quot;white-space: nowrap; font-size:11px;font:courier new;&quot;&gt;
-				&lt;tcl&gt;
-				if {[string compare $form_address &quot;&quot;]!=0} {
-					append console [encode [capture_catch halt]]
-					append buffer [encode [capture_catch &quot;$form_type $form_address [expr $form_length]&quot;]]
-				} 
-				&lt;/tcl&gt;
-			&lt;/code&gt;
-
-
-			
-
-			
-			]]&gt;&lt;/markup_code&gt;
-			&lt;right_column&gt;
-				&lt;![CDATA[
-				&lt;p&gt;Browse and edit target memory.&lt;br&gt;
-				   Length is in bytes, maximum 4096 bytes.&lt;/p&gt; 
-				&lt;p&gt;An error message is shown when trying to browse or edit memory which cases a CPU fault.&lt;/p&gt;
-				&lt;p&gt;CPU will be halted if required.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Modify&lt;/b&gt; - Will modify only one byte, half-word or word starting at Address.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Fill&lt;/b&gt; - Will fill the specified region with the specified value.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Refresh&lt;/b&gt; - Display the content of the specified memory area.&lt;/p&gt;
-					]]&gt;
-			&lt;/right_column&gt;
-			
-			&lt;/pagetext&gt;
-		&lt;/page&gt;
-
-		
-
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;downloadmem.tcl&lt;/outfile&gt;
-			&lt;level2parent&gt;browsemem.tcl&lt;/level2parent&gt;
-			&lt;pageheading&gt;Download Memory Range&lt;/pageheading&gt;
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-			&lt;tcl&gt;
-				set form_address [formfetch form_address]
-				set form_length [formfetch form_length]
-				set form_action [formfetch form_action]
-			&lt;/tcl&gt;			
-			&lt;form action=&quot;downloadmem.tcl&quot; method=&quot;post&quot;&gt; 
-				&lt;table&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Address&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_address&quot; value=&quot;&lt;tcl&gt;append buffer $form_address&lt;/tcl&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Length&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_length&quot; value=&quot;&lt;tcl&gt;append buffer $form_length&lt;/tcl&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-				&lt;input type=&quot;submit&quot; value=&quot;Download&quot; name=&quot;form_action&quot;&gt;
-				
-				
-			&lt;/form&gt;
-			&lt;tcl&gt;
-				if {[string compare $form_action &quot;Download&quot;]==0} {
-					append console [encode [capture_catch &quot;reset init&quot;]]
-					append console [encode [capture_catch &quot;dump_image /tmp/dump.bin $form_address $form_length&quot;]]
-					&lt;/tcl&gt;
-					&lt;form action=&quot;../dump.bin&quot; target=&quot;_blank&quot;&gt; 
-						&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Save downloaded memory&quot;&gt;
-					&lt;/form&gt;
-					&lt;tcl&gt; 
-				}
-				
-			&lt;/tcl&gt;
-
-
-			
-			]]&gt;&lt;/markup_code&gt;
-			&lt;right_column&gt;
-				&lt;![CDATA[	
-				Download memory from target. &lt;br&gt;
-				&lt;b&gt;Note&lt;/b&gt; that download memory can take
-				a long time(potentially minutes for megabytes at low JTAG clk speeds).
-				&lt;p/&gt;
-				Once the memory is downloaded a link is available on the page to download
-				the file to your PC.
-				]]&gt;
-			&lt;/right_column&gt;
-			&lt;/pagetext&gt;
-			
-		&lt;/page&gt;
-
-
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;openocd.tcl&lt;/outfile&gt;
-			&lt;menutext&gt;OpenOCD&lt;/menutext&gt; 
-			&lt;menulink&gt;openocd.tcl&lt;/menulink&gt; 
-			&lt;pageheading&gt;Run Command&lt;/pageheading&gt;
-			&lt;level2parent&gt;openocd.tcl&lt;/level2parent&gt;
-			&lt;level2menu href=&quot;openocd.tcl&quot; title=&quot;Run Command&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;/level2menu&gt;
-			&lt;level2menu href=&quot;guiupload.tcl&quot; title=&quot;Upload File&quot; titlestyle=&quot;color:#4e6627;&quot;&gt;
-			&lt;![CDATA[
-			    Upload file
-			]]&gt;
-			&lt;/level2menu&gt;
-			
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-
-			&lt;tcl&gt;
-				set form_command [formfetch form_command]
-
-				set form_edittext &quot;&quot;
-				if {[string length $form_command]&gt;0} {
-					set form_edittext [capture_catch {eval $form_command}]
-				}
-				
-				append buffer {&lt;form action=&quot;openocd.tcl&quot; method=&quot;post&quot;&gt;} &quot;\n&quot;
-				append buffer {Command&lt;br&gt;}
-				append buffer {&lt;textarea  style=&quot;overflow:auto;&quot;  rows=&quot;5&quot; cols=&quot;65&quot; name=&quot;form_command&quot; wrap=&quot;off&quot;&gt;}
-				append buffer [to_textarea $form_command]
-				append buffer {&lt;/textarea&gt;&lt;br&gt;}
-				append buffer {&lt;input type=&quot;submit&quot; value=&quot;Run&quot; name=&quot;form_action&quot; &gt;&lt;br&gt;}
-				append buffer {&lt;textarea  style=&quot;overflow:auto;&quot;  rows=&quot;21&quot; cols=&quot;65&quot; name=&quot;form_edittext&quot; readonly=1 wrap=&quot;off&quot;&gt;}
-				append buffer [to_textarea $form_edittext]
-				append buffer {&lt;/textarea&gt;&lt;br&gt;}
-				
-				append buffer {&lt;/form&gt;} &quot;\n&quot;
-			
-			&lt;/tcl&gt;
-
-			]]&gt;&lt;/markup_code&gt;
-			
-			&lt;right_column&gt;
-				&lt;![CDATA[
-				&lt;p&gt;Run tcl statement(s). Add &quot;ocd_&quot; prefix to OpenOCD commands otherwise
-				there will be no output, e.g. &quot;reset init&quot; use &quot;ocd_reset init&quot;.
-				&lt;p/&gt;
-				&lt;p&gt;&lt;a href=&quot;/ram/log&quot;&gt;Click here to download log&lt;/a&gt;.&lt;/p&gt;
-				&lt;p&gt;To download log you can also use commands like &quot;wget <A HREF="http://&lt;tcl">http://&lt;tcl</A>&gt;append buffer [ip]&lt;/tcl&gt;/ram/log&quot;, or
-				point your web browser to said address.&lt;/p&gt;
-				&lt;p&gt;
-				You can also execute tcl commands using curl from your developer PC:
-				&lt;/p&gt;
-				&lt;code&gt;
-				curl --form form_command=ocd_version &lt;tcl&gt;append buffer [ip]&lt;/tcl&gt;runtcl.tcl
-				&lt;/code&gt;
-				
-				]]&gt;
-			&lt;/right_column&gt;
-			&lt;/pagetext&gt;
-		&lt;/page&gt;
-
-		
-		
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;guiupload.tcl&lt;/outfile&gt;
-			&lt;level2parent&gt;openocd.tcl&lt;/level2parent&gt;
-			&lt;pageheading&gt;Upload File&lt;/pageheading&gt;
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-			
-			&lt;tcl&gt;
-				set form_filename [formfetch form_filename];
-				set form_action [formfetch form_action];
-				#set form_filecontent [formfetch form_filecontent];
-				
-				append buffer {&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;guiupload.tcl&quot; method=&quot;post&quot;&gt;}
-				append buffer &lt;br&gt; 
-				if {[string compare $form_action &quot;Upload&quot;]==0} {
-					if {[catch {writeform form_filecontent $form_filename} result]==0} {
-						append buffer [encode $result]
-					} else {
-						append buffer Wrote $form_filename
-					}
-				}
-				
-				append buffer {&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;&lt;tr&gt;&lt;td class=&quot;formtext&quot;&gt;Filename on OpenOCD machine&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_filename&quot;&gt;&lt;/td&gt;&lt;/tr&gt;}
-				append buffer {&lt;td class=&quot;formtext&quot;&gt;File to upload&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;file&quot; name=&quot;form_filecontent&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;}
-				append buffer {&lt;table&gt;&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;}
-				append buffer {&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Upload&quot; &gt;&lt;br&gt; }
-				append buffer {&lt;/form&gt;}
-			
-			&lt;/tcl&gt;
-			
-			]]&gt;&lt;/markup_code&gt;
-			&lt;/pagetext&gt;
-			
-		&lt;/page&gt;
-		
-
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;outfile&gt;targets.tcl&lt;/outfile&gt;
-			&lt;level2parent&gt;documentation.tcl&lt;/level2parent&gt;
-			&lt;pageheading&gt;Target config quick start guide&lt;/pageheading&gt;
-			&lt;pagetext&gt;
-				&lt;markup_code&gt;&lt;![CDATA[
-				
-				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either OpenOCD ships with an
-				openocd.cfg file for your target or you need to take an existing
-				config file and modify it for your needs.
-				&lt;p&gt; 
-				The reset init script is crucial. It will set up e.g. MMU, chip
-				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
-				&lt;p&gt;
-				Writing an openocd.cfg from scratch is a non-trivial exercise, but
-				fortunally it only has to be done once for a target and afterwards it
-				rarely if ever needs to be changed.
-				
-				
-				]]&gt;&lt;/markup_code&gt;
-				&lt;right_column&gt;
-					
-					  Quick start guide on how to configure a target.
-				&lt;/right_column&gt;
-			&lt;/pagetext&gt;
-			
-			
-		&lt;/page&gt;
-
-
-		
-
-
-		&lt;page lang=&quot;eng&quot;&gt;
-			&lt;menulink&gt;index.tcl&lt;/menulink&gt; 
-			&lt;level2parent&gt;index.tcl&lt;/level2parent&gt;
-			&lt;outfile&gt;terminal.tcl&lt;/outfile&gt;
-			&lt;pageheading&gt;UART forwarding&lt;/pageheading&gt;
-			&lt;pagetext&gt;
-			&lt;markup_code&gt;&lt;![CDATA[
-			&lt;tcl&gt;
-				set form_baudrate [formfetch form_baudrate]
-				if {[string length $form_baudrate]==0} {
-					set form_baudrate [ocd_uart]
-					set form_baudrate [string range $form_baudrate 0 [expr [string length $form_baudrate]-2]]
-				}
-				set form_action [formfetch form_action]
-			&lt;/tcl&gt;
-			&lt;form action=&quot;terminal.tcl&quot; method=&quot;post&quot;&gt;
-				Target baudrate: 
-					&lt;select name=&quot;form_baudrate&quot;&gt;
-						&lt;tcl&gt;
-							foreach i {9600 19200 38400 57600 115200} { 
-							&lt;/tcl&gt;
-				  				&lt;option &lt;tcl&gt;if {[string compare $form_baudrate $i]==0} { append buffer {selected=&quot;selected&quot;} }  &lt;/tcl&gt;
-				  				value =&quot;&lt;tcl&gt;append buffer $i&lt;/tcl&gt;&quot;&gt;&lt;tcl&gt;append buffer $i&lt;/tcl&gt;&lt;/option&gt;
-				  			&lt;tcl&gt;
-				  			}
-				  			&lt;/tcl&gt;
-						&lt;/select&gt;
-
-					&lt;p&gt;	
-					&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Set baudrate&quot; &gt;
-				&lt;/form&gt;			
-			&lt;tcl&gt;
-				if {[string compare $form_action &quot;Set baudrate&quot;]==0} {
-					append console [encode [ocd_uart $form_baudrate]]
-				}
-			&lt;/tcl&gt;
-			
-			&lt;h2&gt;Simple UART&lt;/h2&gt;
-			This terminal window is purely for illustrative purposes. Use telnet or a terminal program
-			to talk to the target over TCP/IP for anything but trivial case of reading/writing a few
-			lines of texts in simple tests.
-			&lt;p&gt;
-			]]&gt;&lt;/markup_code&gt;
-			&lt;right_column&gt;
-				&lt;![CDATA[
-				Serial port data to target is forwarded(both directions) in the simple terminal window
-				to the left. Alternatively you can &lt;b&gt;telnet &lt;tcl&gt;append buffer [ip]&lt;/tcl&gt; 5555&lt;/b&gt;
-				or connect via TCP/IP from e.g. HyperTerminal.
-				&lt;p&gt;
-				Type &quot;help uart&quot; in telnet for information on how to set uart speed for target. Normally
-				the uart speed is set from the target configuration script by adding an &quot;uart N&quot;, where
-				N is the baudrate.
-				]]&gt;
-			&lt;/right_column&gt;
-			&lt;/pagetext&gt;
-			
-		&lt;/page&gt;
-
-
-		
-	&lt;/language&gt;
-	
-&lt;/website&gt;
\ No newline at end of file

Copied: branches/openocd-0.1/src/server/httpd/menu.xml (from rev 1324, trunk/src/server/httpd/menu.xml)

Deleted: branches/openocd-0.1/src/server/httpd/menu.xsl
===================================================================
--- trunk/src/server/httpd/menu.xsl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/menu.xsl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,298 +0,0 @@
-&lt;?xml version=&quot;1.0&quot;?&gt;
-&lt;!DOCTYPE xsl:stylesheet [&lt;!ENTITY nbsp &quot;&#160;&quot;&gt;]&gt;
-&lt;xsl:stylesheet xmlns:xsl=&quot;<A HREF="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</A>&quot; xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot; version=&quot;1.0&quot;&gt;
-	&lt;xsl:output method=&quot;html&quot; version=&quot;4.0&quot; indent=&quot;yes&quot; encoding=&quot;UTF-8&quot;
-	
-	 media-type=&quot;text/plain; charset=UTF-8&quot;/&gt;
-
-	&lt;xsl:param name=&quot;pagetogenerate&quot; select=&quot;UNDEFINED&quot;/&gt;
-	&lt;xsl:template match=&quot;page[outfile!=$pagetogenerate]&quot;&gt;
-	&lt;/xsl:template&gt;
-
-	&lt;xsl:template match=&quot;page[outfile=$pagetogenerate]&quot;&gt;
-		&lt;xsl:variable name=&quot;Xlevel2parent&quot; select=&quot;level2parent&quot;/&gt;
-		&lt;xsl:variable name=&quot;Xlevel3parent&quot; select=&quot;level3parent&quot;/&gt;
-
-		&lt;html&gt;
-			&lt;head&gt;
-				&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-				&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html&quot;  charset=&quot;utf-8&quot;/&gt;
-				&lt;link href=&quot;menuweb.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;/&gt;				
-				
-			&lt;/head&gt;
-	
-			
-			&lt;tcl&gt;
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			&lt;/tcl&gt;
-			
-			&lt;body style=&quot;margin:0px;&quot;&gt;
-				&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-					&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-						&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-					&lt;/div&gt;
-					&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-						&lt;div class=&quot;textlight&quot; style=&quot;position:relative;left:15px;top:4px;&quot;&gt;
-							&lt;tcl&gt;append buffer [capture version]&lt;/tcl&gt;
-						&lt;/div&gt;
-					&lt;/div&gt;
-				&lt;/div&gt;
-				&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-					&lt;tr&gt;
-						&lt;td style=&quot;width:33px;&quot;&gt;
-							&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-						&lt;/td&gt;
-						&lt;!-- level 2 menu bar on left --&gt;
-						&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-							&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-								&lt;tr style=&quot;height:59px;&quot;&gt;
-									&lt;td&gt;&lt;/td&gt;
-								&lt;/tr&gt;
-								&lt;xsl:for-each select=&quot;parent::language/page[outfile = $Xlevel2parent]/level2menu&quot;&gt;
-									&lt;tr&gt;
-										&lt;td&gt;
-											&lt;xsl:choose&gt;
-												&lt;xsl:when test=&quot;contains(@href, $pagetogenerate)&quot;&gt;
-													&lt;xsl:attribute name=&quot;style&quot;&gt;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&lt;/xsl:attribute&gt;
-												&lt;/xsl:when&gt;
-												&lt;xsl:otherwise&gt;
-													&lt;xsl:attribute name=&quot;style&quot;&gt;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&lt;/xsl:attribute&gt;
-												&lt;/xsl:otherwise&gt;
-											&lt;/xsl:choose&gt;
-											&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-												&lt;a&gt;
-													&lt;xsl:attribute name=&quot;href&quot;&gt;
-														&lt;xsl:value-of select=&quot;@href&quot;/&gt;
-													&lt;/xsl:attribute&gt;
-													&lt;xsl:choose&gt;
-														&lt;xsl:when test=&quot;(@href = $pagetogenerate)&quot;&gt;
-															&lt;xsl:attribute name=&quot;style&quot;&gt;font-weight: bold;&lt;/xsl:attribute&gt;
-														&lt;/xsl:when&gt;
-														&lt;xsl:otherwise&gt;
-															&lt;xsl:choose&gt;
-																&lt;xsl:when test=&quot;(@href = $Xlevel3parent)&quot;&gt;
-																	&lt;xsl:attribute name=&quot;style&quot;&gt;font-weight: bold;&lt;/xsl:attribute&gt;
-																&lt;/xsl:when&gt;
-																&lt;xsl:otherwise&gt;
-																	&lt;xsl:attribute name=&quot;style&quot;&gt;&lt;/xsl:attribute&gt;
-																&lt;/xsl:otherwise&gt;
-															&lt;/xsl:choose&gt;
-														&lt;/xsl:otherwise&gt;
-													&lt;/xsl:choose&gt;
-													&lt;xsl:value-of select=&quot;@title&quot;/&gt;
-												&lt;/a&gt;
-											&lt;/div&gt;
-										&lt;/td&gt;
-									&lt;/tr&gt;
-								&lt;/xsl:for-each&gt;
-								&lt;tr&gt;
-									&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;&gt;
-									
-									&lt;/td&gt;
-								&lt;/tr&gt;
-								&lt;tr&gt;
-									&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;&gt;
-									
-									&lt;/td&gt;
-								&lt;/tr&gt;
-								&lt;tr&gt;
-									&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;&gt;
-									
-									&lt;/td&gt;
-								&lt;/tr&gt;
-							&lt;/table&gt;
-						&lt;/td&gt;
-						&lt;!-- top level menu --&gt;
-						&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-							&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-								&lt;tr&gt;
-									&lt;td&gt;
-										&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-											&lt;tr&gt;
-												&lt;xsl:for-each select=&quot;parent::language/page&quot;&gt;
-													&lt;xsl:if test=&quot;menutext&quot;&gt;
-														&lt;td&gt;
-															&lt;xsl:choose&gt;
-																&lt;xsl:when test=&quot;(outfile = $pagetogenerate) or (outfile = $Xlevel2parent)&quot;&gt;
-																	&lt;xsl:attribute name=&quot;style&quot;&gt;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&lt;/xsl:attribute&gt;
-																&lt;/xsl:when&gt;
-																&lt;xsl:otherwise&gt;
-																	&lt;xsl:attribute name=&quot;style&quot;&gt;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&lt;/xsl:attribute&gt;
-																&lt;/xsl:otherwise&gt;
-															&lt;/xsl:choose&gt;
-															&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-																&lt;a&gt;
-																	&lt;xsl:attribute name=&quot;href&quot;&gt;&lt;xsl:value-of select=&quot;menulink&quot;/&gt;&lt;/xsl:attribute&gt;
-																	&lt;xsl:if test=&quot;(outfile = $pagetogenerate)&quot;&gt;
-																		&lt;xsl:attribute name=&quot;style&quot;&gt;font-weight: bold;&lt;/xsl:attribute&gt;
-																	&lt;/xsl:if&gt;
-																	&lt;xsl:if test=&quot;(outfile = $Xlevel2parent)&quot;&gt;
-																		&lt;xsl:attribute name=&quot;style&quot;&gt;font-weight: bold;&lt;/xsl:attribute&gt;
-																	&lt;/xsl:if&gt;
-																	&lt;xsl:value-of select=&quot;menutext&quot;/&gt;
-																&lt;/a&gt;
-															 &lt;/div&gt;
-														 &lt;/td&gt;
-													&lt;/xsl:if&gt;
-												&lt;/xsl:for-each&gt;
-											&lt;/tr&gt;
-										&lt;/table&gt;
-								 	&lt;/td&gt;
-								&lt;/tr&gt;			
-							 	&lt;tr&gt;
-							 		&lt;td colspan=&quot;6&quot; style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot;&gt;
-							 			&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-							 		&lt;/td&gt;
-							 	&lt;/tr&gt;
-							 	&lt;tr&gt;
-							 		&lt;td colspan=&quot;6&quot; style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot;&gt;
-							 			&lt;H1&gt;&lt;xsl:value-of select=&quot;pageheading&quot;/&gt;&lt;/H1&gt;
-							 		&lt;/td&gt;
-							 	&lt;/tr&gt;
-							 	&lt;tr style=&quot;height:100%;&quot;&gt;
-							 		&lt;td colspan=&quot;6&quot; style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot;&gt;
-										&lt;xsl:value-of disable-output-escaping=&quot;yes&quot; select=&quot;pagetext/markup_code&quot;/&gt;
-							 		&lt;/td&gt;
-							 	&lt;/tr&gt;
-							 	&lt;tcl&gt;
-							 		&lt;!-- This is the output from any OpenOCD commands --&gt;
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			&lt;/tcl&gt;
-									 	&lt;tr style=&quot;height:100%;&quot;&gt;
-									 		&lt;td colspan=&quot;6&quot; style=&quot;height:100%;background-color:red;&quot;&gt;
-												&lt;table class=&quot;textgray&quot; style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot;&gt;
-											 		&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-											 		&lt;tcl&gt;
-												 		if {$show_details==1} {
-												 			append buffer &lt;xsl:text disable-output-escaping=&quot;yes&quot;&gt;&lt;![CDATA[&lt;]]&gt;&lt;/xsl:text&gt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &lt;xsl:text disable-output-escaping=&quot;yes&quot;&gt;&lt;![CDATA[&gt;]]&gt;&lt;/xsl:text&gt;
-												 		} else {
-												 			append buffer &lt;xsl:text disable-output-escaping=&quot;yes&quot;&gt;&lt;![CDATA[&lt;]]&gt;&lt;/xsl:text&gt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &lt;xsl:text disable-output-escaping=&quot;yes&quot;&gt;&lt;![CDATA[&gt;]]&gt;&lt;/xsl:text&gt;
-												 		}
-												 	&lt;/tcl&gt;
-											 			&lt;a class=&quot;openocd&quot;&gt;
-															&lt;xsl:attribute name=&quot;href&quot;&gt;&lt;xsl:value-of select=&quot;$pagetogenerate&quot;/&gt;?toggle_details=1&lt;/xsl:attribute&gt;
-															&lt;tcl&gt;
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															&lt;/tcl&gt;
-											 			&lt;/a&gt;
-											 			&lt;tcl&gt;
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	&lt;/tcl&gt;
-													 &lt;xsl:text disable-output-escaping=&quot;yes&quot;&gt;&lt;![CDATA[&lt;]]&gt;&lt;/xsl:text&gt;/td&lt;xsl:text disable-output-escaping=&quot;yes&quot;&gt;&lt;![CDATA[&gt;]]&gt;&lt;/xsl:text&gt;
-													 &lt;tcl&gt;
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 &lt;/tcl&gt;
-											 		&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-											 	&lt;/table&gt;
-										 	&lt;/td&gt;
-										 &lt;/tr&gt;
-									 	&lt;tcl&gt;
-									 }
-								&lt;/tcl&gt;
-							 	&lt;tr&gt;
-							 		&lt;td colspan=&quot;6&quot; style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot;&gt;
-							 			&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-							 		&lt;/td&gt;
-							 	&lt;/tr&gt;
-						 	&lt;/table&gt;
-						&lt;/td&gt;
-						&lt;td style=&quot;width:6px;&quot;&gt;
-						&lt;/td&gt;
-						&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-							&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-								&lt;tr&gt;
-									&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-										&lt;div class=&quot;textgray&quot; style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-								 	&lt;/td&gt;
-								 	&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;		
-								 	&lt;td&gt;
-								 	&lt;/td&gt;	
-								&lt;/tr&gt;
-							 	&lt;tr&gt;
-							 		&lt;td colspan=&quot;3&quot; style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot;&gt;&lt;/td&gt;
-							 	&lt;/tr&gt;
-							 	&lt;tr&gt;
-							 		&lt;td colspan=&quot;3&quot; style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot;&gt;
-							 			&lt;a href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot; target=&quot;_blank&quot;&gt;OpenOCD Manual&lt;/a&gt;&lt;br/&gt;
-							 		&lt;/td&gt;
-							 	&lt;/tr&gt;
-							 	&lt;tr&gt;&lt;td colspan=&quot;3&quot; style=&quot;background-color:#d8d7d7;height:15px;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-							 	&lt;tr&gt;
-							 		&lt;td colspan=&quot;3&quot;&gt;
-							 			&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-							 				&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;&gt;&lt;/td&gt;
-							 				&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;&gt;&lt;/td&gt;
-							 				&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;&gt;&lt;/td&gt;
-							 			&lt;/table&gt;
-							 		&lt;/td&gt;
-							 	&lt;/tr&gt;
-							 	&lt;tr&gt;&lt;td colspan=&quot;3&quot; style=&quot;background-color:#d8d7d7;height:15px;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-							 	&lt;tr style=&quot;height:100%;&quot;&gt;
-							 		&lt;td class=&quot;textgray&quot; colspan=&quot;3&quot;  style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot;&gt;
-										&lt;xsl:choose&gt;
-											&lt;xsl:when test=&quot;(pagetext/right_column)&quot;&gt;
-												&lt;xsl:value-of disable-output-escaping=&quot;yes&quot; select=&quot;pagetext/right_column&quot;/&gt;
-											&lt;/xsl:when&gt;
-											&lt;xsl:otherwise&gt;
-		
-											&lt;/xsl:otherwise&gt;
-										&lt;/xsl:choose&gt;
-							 		&lt;/td&gt;
-							 	&lt;/tr&gt;
-							 	&lt;tr&gt;
-							 		&lt;td colspan=&quot;3&quot; style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-							 	&lt;/tr&gt;
-							 &lt;/table&gt;
-				
-						&lt;/td&gt;
-					&lt;/tr&gt;
-					
-				&lt;/table&gt;
-			&lt;/body&gt;
-		&lt;/html&gt;
-
-	&lt;/xsl:template&gt;
-&lt;/xsl:stylesheet&gt;

Copied: branches/openocd-0.1/src/server/httpd/menu.xsl (from rev 1324, trunk/src/server/httpd/menu.xsl)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts (from rev 1324, trunk/src/server/httpd/menu_cuts)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/center_bottom.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/center_bottom.png (from rev 1324, trunk/src/server/httpd/menu_cuts/center_bottom.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/center_top.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/center_top.png (from rev 1324, trunk/src/server/httpd/menu_cuts/center_top.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab1.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab1.png (from rev 1324, trunk/src/server/httpd/menu_cuts/h_tab1.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab1_selected.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab1_selected.png (from rev 1324, trunk/src/server/httpd/menu_cuts/h_tab1_selected.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab2.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab2.png (from rev 1324, trunk/src/server/httpd/menu_cuts/h_tab2.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab2_selected.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab2_selected.png (from rev 1324, trunk/src/server/httpd/menu_cuts/h_tab2_selected.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab_free.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/h_tab_free.png (from rev 1324, trunk/src/server/httpd/menu_cuts/h_tab_free.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/logo_bottom.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/logo_bottom.png (from rev 1324, trunk/src/server/httpd/menu_cuts/logo_bottom.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/logo_top.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/logo_top.png (from rev 1324, trunk/src/server/httpd/menu_cuts/logo_top.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/right_bottom.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/right_bottom.png (from rev 1324, trunk/src/server/httpd/menu_cuts/right_bottom.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/right_top.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/right_top.png (from rev 1324, trunk/src/server/httpd/menu_cuts/right_top.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/right_top_small.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/right_top_small.png (from rev 1324, trunk/src/server/httpd/menu_cuts/right_top_small.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/top_right.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/top_right.png (from rev 1324, trunk/src/server/httpd/menu_cuts/top_right.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/v_1.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/v_1.png (from rev 1324, trunk/src/server/httpd/menu_cuts/v_1.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/v_2_tile.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/v_2_tile.png (from rev 1324, trunk/src/server/httpd/menu_cuts/v_2_tile.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/v_3.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/v_3.png (from rev 1324, trunk/src/server/httpd/menu_cuts/v_3.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/v_tab.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/v_tab.png (from rev 1324, trunk/src/server/httpd/menu_cuts/v_tab.png)

Deleted: branches/openocd-0.1/src/server/httpd/menu_cuts/v_tab_selected.png
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/src/server/httpd/menu_cuts/v_tab_selected.png (from rev 1324, trunk/src/server/httpd/menu_cuts/v_tab_selected.png)

Deleted: branches/openocd-0.1/src/server/httpd/menuweb.css
===================================================================
--- trunk/src/server/httpd/menuweb.css	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/menuweb.css	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,132 +0,0 @@
-a:link
-{
-	font-size: 12px;
-	color : #024d67;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a:visited
-{
-	font-size: 12px;
-	color : #024d67;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a:active
-{
-	font-size: 12px;
-	color : #024d67;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a:hover
-{
-	font-size: 12px;
-	color : #555555;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a.openocd:link
-{
-	font-size: 12px;
-	color : #555555;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a.openocd:visited
-{
-	font-size: 12px;
-	color : #555555;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a.openocd:active
-{
-	font-size: 12px;
-	color : #555555;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-a.openocd:hover
-{
-	font-size: 12px;
-	color : #024d67;
-	font-weight:bold;
-	text-decoration : none;
-}
-
-body
-{
-	background-color : green;
-	background-color : #176e8c;
-	font-family : Arial;
-	font-size: 12px;
-	line-height: 15px;
-	color : #024d67;
-	
-}
-
-h1
-{
-	padding: 0px;
-	font-size: 18px;
-	font-weight:bold;
-	text-decoration : none;
-	margin-bottom: 8px;
-}
-
-td
-{
-	padding: 0px;
-	font-size: 12px;
- 	vertical-align:top;
-
-}
-
-.textlight
-{
-	color: #cccccc;
-	padding: 0px;
-	font-size: 12px;
- 	vertical-align:top;
-
-}
-
-.fontbigger
-{
-	font-size:14px;
-}
-
-.textgray
-{
-	color: #555555;
-}
-
-.formtext
-{
-	padding-top: 4px;
-	font-size: 14px;
-	padding-right:10px;
-}
-
-input
-{
-	font-size: 14px;
-}
-
-.buttonspacelarge
-{
-	width:20px;
-}
-
-.buttonspacesmall
-{
-	width:8px;
-}

Copied: branches/openocd-0.1/src/server/httpd/menuweb.css (from rev 1324, trunk/src/server/httpd/menuweb.css)

Deleted: branches/openocd-0.1/src/server/httpd/openocd.tcl
===================================================================
--- trunk/src/server/httpd/openocd.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/openocd.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,355 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Run Command&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;guiupload.tcl&quot; style=&quot;&quot;&gt;Upload File&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Run Command&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-
-			}
-
-				set form_command [formfetch form_command]
-
-				set form_edittext &quot;&quot;
-				if {[string length $form_command]&gt;0} {
-					set form_edittext [capture_catch {eval $form_command}]
-				}
-				
-				append buffer {&lt;form action=&quot;openocd.tcl&quot; method=&quot;post&quot;&gt;} &quot;\n&quot;
-				append buffer {Command&lt;br&gt;}
-				append buffer {&lt;textarea  style=&quot;overflow:auto;&quot;  rows=&quot;5&quot; cols=&quot;65&quot; name=&quot;form_command&quot; wrap=&quot;off&quot;&gt;}
-				append buffer [to_textarea $form_command]
-				append buffer {&lt;/textarea&gt;&lt;br&gt;}
-				append buffer {&lt;input type=&quot;submit&quot; value=&quot;Run&quot; name=&quot;form_action&quot; &gt;&lt;br&gt;}
-				append buffer {&lt;textarea  style=&quot;overflow:auto;&quot;  rows=&quot;21&quot; cols=&quot;65&quot; name=&quot;form_edittext&quot; readonly=1 wrap=&quot;off&quot;&gt;}
-				append buffer [to_textarea $form_edittext]
-				append buffer {&lt;/textarea&gt;&lt;br&gt;}
-				
-				append buffer {&lt;/form&gt;} &quot;\n&quot;
-			
-			
-append buffer {
-
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;openocd.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				&lt;p&gt;Run tcl statement(s). Add &quot;ocd_&quot; prefix to OpenOCD commands otherwise
-				there will be no output, e.g. &quot;reset init&quot; use &quot;ocd_reset init&quot;.
-				&lt;p/&gt;
-				&lt;p&gt;&lt;a href=&quot;/ram/log&quot;&gt;Click here to download log&lt;/a&gt;.&lt;/p&gt;
-				&lt;p&gt;To download log you can also use commands like &quot;wget <A HREF="http://">http://</A>}
-append buffer [ip]
-append buffer {/ram/log&quot;, or
-				point your web browser to said address.&lt;/p&gt;
-				&lt;p&gt;
-				You can also execute tcl commands using curl from your developer PC:
-				&lt;/p&gt;
-				&lt;code&gt;
-				curl --form form_command=ocd_version }
-append buffer [ip]
-append buffer {runtcl.tcl
-				&lt;/code&gt;
-				
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/openocd.tcl (from rev 1324, trunk/src/server/httpd/openocd.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/preconfig.tcl
===================================================================
--- trunk/src/server/httpd/preconfig.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/preconfig.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,429 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;Zylin ZY1000 JTAG debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-&lt;img src=&quot;menu_cuts/logo_top.png&quot; style=&quot;border:0px;&quot;/&gt;
-&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;&quot;&gt;Target Status&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;preconfig.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Select Target Config&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;editconfigs.tcl&quot; style=&quot;&quot;&gt;Edit Configurations&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;reload.tcl&quot; style=&quot;&quot;&gt;Reload Config Scripts&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Select Preconfigured Target&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			
-			}
-
-			
-			set form_target [formfetch form_target]
-			set form_action [formfetch form_action]
-			
-			append buffer {&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;preconfig.tcl&quot; method=&quot;post&quot;&gt;}
-			if {[string compare $form_action &quot;Select and reload&quot;]==0} {
-				capture_catch &quot;trunc /config/settings/openocd.cfg&quot;
-				capture_catch &quot;append_file /config/settings/openocd.cfg script target/$form_target&quot;
-				reboot 
-			}
-			
-			set form_target [load_target] 
-			
-			set files [ls /rom/target]
-			set files [lunion $files [ls /config/settings/target]]
-			set files [lsort $files]
-			 
-			if {[string compare $form_action &quot;Select and reload&quot;]!=0} {
-				
-append buffer {
-				&lt;table&gt;&lt;tr&gt;
-				&lt;td style=&quot;padding-top:1px;&quot;&gt;
-					&lt;select name=&quot;form_target&quot;&gt;
-						}
-
-							set foundTarget 0
-							foreach i $files {
-								if {[string match *.cfg $i]} {
-									
-append buffer {
-								  		&lt;option 
-								  		}
-
-									  		if {[string compare $form_target $i]==0} { 
-											set foundTarget 1
-									  		append buffer {selected=&quot;selected&quot;} 
-							  		}
-append buffer {
-							  		value=&quot;}
-append buffer $i
-append buffer {&quot;&gt;}
-append buffer $i
-append buffer {&lt;/option&gt;
-									}
-
-								}
-							}
-							
-							if {$foundTarget==0} {
-								
-append buffer {
-							  		&lt;option selected=&quot;selected&quot; value=&quot;&quot;&gt;Preconfigured target not active&lt;/option&gt;
-								}
-
-							}
-						
-append buffer {
-					&lt;/select&gt;
-				&lt;/td&gt;
-				&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;
-				&lt;td&gt;
-					&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Select and reload&quot;&gt;
-					
-					&nbsp;&nbsp;&nbsp;&nbsp;
-					&lt;a href=&quot;editconfigs.tcl?form_action=Load&amp;form_selected=}
-append buffer &quot;target/$form_target&quot;
-append buffer {&quot;&gt;Edit target configuration&lt;/a&gt;
-				&lt;/td&gt;
-				&lt;/tr&gt;&lt;/table&gt;
-			}
-
-			} else {
-			    append buffer &quot;Reloading setting(ca. 30 seconds)...&quot;
-			}
-			
-append buffer {
-				
-			&lt;/form&gt;
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;preconfig.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf</A>&quot;&gt;Quick Start Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/openocd.pdf">http://www.zylin.com/zy1000/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000_contact.html">http://www.zylin.com/zy1000_contact.html</A>&quot;&gt;Contact Zylin AS&lt;/a&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-							
-				&lt;p&gt;ZY1000 comes with complete configurations for various targets.&lt;/p&gt;
-				&lt;p&gt;These predefined configurations include reset init scripts and flash configuration.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Select and reload&lt;/b&gt; - Select configuration and reboot ZY1000 unit.&lt;/p&gt;
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td/&gt;
-&lt;td&gt;
-&lt;img border=&quot;0&quot; src=&quot;menu_cuts/logo_bottom.png&quot;/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/preconfig.tcl (from rev 1324, trunk/src/server/httpd/preconfig.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/production.tcl
===================================================================
--- trunk/src/server/httpd/production.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/production.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,392 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;&quot;&gt;Info&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;erase.tcl&quot; style=&quot;&quot;&gt;Erase&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flash.tcl&quot; style=&quot;&quot;&gt;Program / Verify&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;production.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Production&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Production&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			}
-
-				set form_action [formfetch form_action]
-				set form_serialnumber [formfetch form_serialnumber]
-				append buffer [production_info]
-			
-append buffer {
-				
-			&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;production.tcl&quot; method=&quot;post&quot;&gt;
-				&lt;code style=&quot;white-space: nowrap;&quot;&gt;
-					}
-	
-						if {[string compare $form_action &quot;Upload firmware&quot;]==0} {
-							set wrotedata [catch {writeform form_filecontent $upload_filename} result]  
-							append buffer [encode $result]
-							if {$wrotedata==0} {
-								append buffer &quot;&lt;br&gt;Running production procedure&lt;p&gt;&quot;
-								append buffer &quot;&lt;br&gt;Reset and init: &lt;br&gt;&quot;
-								
-								append console [encode [capture_catch {catch &quot;production $upload_filename $form_serialnumber&quot;}]]
-							}
-						}
-						if {[string compare $form_action &quot;Test&quot;]==0} {
-							append buffer &quot;&lt;br&gt;Running production test. Output from first 10 seconds printed below. &lt;p&gt;&quot;
-							
-							append console [encode [capture_catch {catch production_test}]]
-						}
-						if {[string compare $form_action &quot;Power on&quot;]==0} {
-							append console [encode [capture_catch &quot;power on&quot;]]
-						}
-						if {[string compare $form_action &quot;Power off&quot;]==0} {
-							append console [encode [capture_catch &quot;power off&quot;]]
-						}
-					
-append buffer {
-				&lt;/code&gt;
-				}
-
-					append buffer {&lt;p class=&quot;formtext&quot;&gt;Firmware file(raw binary) &lt;input type=&quot;file&quot; name=&quot;form_filecontent&quot;&gt;&lt;p&gt;}
-					append buffer {&lt;p class=&quot;formtext&quot;&gt;Serial number &lt;input type=&quot;text&quot; name=&quot;form_serialnumber&quot;&gt;&lt;p&gt;}
-				
-append buffer {
-				
-				&lt;table&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-					&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-			
-				&lt;table&gt;&lt;tr&gt;
-					&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Upload firmware&quot; &gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Test&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Power on&quot;&gt;&lt;/td&gt;
-					&lt;td class=&quot;buttonspacesmall&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Power off&quot;&gt;
-				&lt;/tr&gt;&lt;/table&gt;
-			&lt;/form&gt;
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;production.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				The target script can implement the &quot;production&quot;, &quot;production_info&quot; and &quot;production_test&quot; tcl proc's. These procedures
-				are used on this page. There are default implementations that do nothing.
-				
-				&lt;p&gt;&lt;b&gt;Upload firmware&lt;/b&gt; - Power cycle target, reset target and program raw binary file to flash bank 0, offset 0 and verify flash programming. Leave target powered on.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Test&lt;/b&gt; -  Power up target, run 10 second target test. Output is provided via the DCC output channel. &lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Power on&lt;/b&gt; - Power on target.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Power off&lt;/b&gt; - Power off target.&lt;/p&gt;
-				&lt;p&gt;&lt;b&gt;Serial number&lt;/b&gt; - A target script can use this string in the production procedure. Type &quot;help production&quot; for more info.&lt;/p&gt;
-					 
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/production.tcl (from rev 1324, trunk/src/server/httpd/production.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/readme.txt
===================================================================
--- trunk/src/server/httpd/readme.txt	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/readme.txt	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,24 +0,0 @@
-work in progress... stay tuned....
-
-
-1. To build .tcl pages. This will convert menu.xml and menu.xsl into
-lots of .html pages w/embedded tcl, which are then inverted into
-tcl with embedded html.
-
-sh build.sh
-
-xalan.jar can be gotten from apache.org. 
-
-
-2. libmicrohttpd is a bit tricky to build under Cygwin:
-
-<A HREF="https://gnunet.org/mantis/view.php?id=1440">https://gnunet.org/mantis/view.php?id=1440</A>
-
-3. To test:
-
-../openocd/configure --enable-httpd --enable-dummy  --enable-ioutil
-make
-make install
-openocd  -f httpd/httpd.tcl -c &quot;interface dummy&quot; -f target/at91eb40a.cfg
-
-4. Point browser to: <A HREF="http://localhost:8888">http://localhost:8888</A>

Copied: branches/openocd-0.1/src/server/httpd/readme.txt (from rev 1324, trunk/src/server/httpd/readme.txt)

Deleted: branches/openocd-0.1/src/server/httpd/reload.tcl
===================================================================
--- trunk/src/server/httpd/reload.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/reload.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,322 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;&quot;&gt;Target Status&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Reload Config Scripts&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			
-			}
-
-				set form_action [formfetch form_action]
-	
-				if {[string compare $form_action &quot;Reload&quot;]==0} {
-					append buffer &quot;Reloading Config Scripts...&lt;p&gt;&quot;
-					reboot
-				}
-			
-append buffer {
-			&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;reload.tcl&quot; method=&quot;post&quot;&gt;
-				&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Reload&quot;&gt;
-			&lt;/form&gt;
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;reload.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				Restart ZY1000 to reload selected target config script.				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/reload.tcl (from rev 1324, trunk/src/server/httpd/reload.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/run.tcl
===================================================================
--- trunk/src/server/httpd/run.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/run.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,382 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;&quot;&gt;Info&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;erase.tcl&quot; style=&quot;&quot;&gt;Erase&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;flash.tcl&quot; style=&quot;&quot;&gt;Program / Verify&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;production.tcl&quot; style=&quot;&quot;&gt;Production&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Run program&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-
-
-			
-}
-
-
-set form_address [formfetch form_address]
-set form_action [formfetch form_action]
-
-if {[string compare $form_action &quot;Run from address&quot;]==0} {
-	append console [encode [capture_catch &quot;halt&quot;]]
-	append console [encode [capture_catch &quot;wait_halt&quot;]]
-	append console [encode [capture_catch &quot;resume $form_address&quot;]]
-}  
-
-if {[string compare $form_action &quot;Halt&quot;]==0} {
-	append console [encode [capture_catch &quot;halt&quot;]]
-	append console [encode [capture_catch &quot;wait_halt&quot;]]
-}
-  
-if {[string compare $form_action &quot;Reset and run&quot;]==0} {
-	append console [encode [capture_catch &quot;reset run&quot;]]
-}
-  
-if {[string compare $form_action &quot;Reset and init&quot;]==0} {
-	append console [encode [capture_catch &quot;reset init&quot;]]
-}  
-
-append console [encode [capture_catch poll]]
-
-
-append buffer {
-
-&lt;form action=&quot;run.tcl&quot; method=&quot;post&quot;&gt; 
-	&lt;table&gt;
-	&lt;tr&gt;&lt;td class=&quot;formtext&quot; style=&quot;padding-right:10px;&quot;&gt;Address&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form_address&quot; value=&quot;}
-append buffer $form_address
-append buffer {&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-	&lt;/td&gt;&lt;/tr&gt;
-	&lt;/table&gt;
-	&lt;table&gt;
-		&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-		&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-		&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;
-	&lt;/table&gt;
-	
-	&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Reset and run&quot;&gt; &lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Run from address&quot;&gt; &lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Halt&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Reset and init&quot;&gt;&lt;br&gt;
-&lt;/form&gt;
-			
-
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;run.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				&lt;p&gt;Reset and run - reset CPU and let it run.&lt;/p&gt;
-				&lt;p&gt;Halt - halt CPU.&lt;/p&gt;
-				&lt;p&gt;Run from address - halt CPU and resume from address. Default is resume from current address.&lt;/p&gt;
-				&lt;p&gt;Reset and init - reset CPU and run init script.&lt;/p&gt;
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/run.tcl (from rev 1324, trunk/src/server/httpd/run.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/support.tcl
===================================================================
--- trunk/src/server/httpd/support.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/support.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,431 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;Zylin ZY1000 JTAG debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;/ram/cgi/zylweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-&lt;img src=&quot;/rom/menu_cuts/logo_top.png&quot; style=&quot;border:0px;&quot;/&gt;
-&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('/rom/menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture zy1000_version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;zy1000.tcl&quot; style=&quot;&quot;&gt;Set IP Address&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;upgrade.tcl&quot; style=&quot;&quot;&gt;ZY1000 Firmware&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;editfile.tcl&quot; style=&quot;&quot;&gt;Edit File&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;support.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Support Request&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('/rom/menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;log.tcl#tail&quot; style=&quot;&quot;&gt;View Tail of Log&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('/rom/menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('/rom/menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('/rom/menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/zy1000.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Setup ZY1000&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('/rom/menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Submit Support Request&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			Before contacting Zylin, please submit a support request with relevant information. 
-			}
-
-			
-			set form_config [load_config &quot;target/[load_target]&quot;]
-			set support_id [string range [rand] 0 7]
-			set form_log &quot;&quot;
-			append form_log &quot;Version: [capture &quot;zy1000_version zy1000&quot;]&quot;
-			append form_log &quot;OpenOCD version: [capture &quot;zy1000_version openocd&quot;]&quot;
-			append form_log &quot;Version date: [capture &quot;zy1000_version date&quot;]&quot;
-			append form_log [log]
-			
-append buffer {
-
-			&lt;form action=&quot;supportrequest.tcl&quot; method=&quot;POST&quot; target=&quot;_blank&quot;&gt;
-				&lt;input TYPE=&quot;hidden&quot; NAME=&quot;id&quot; VALUE=&quot;}
-append buffer $support_id
-append buffer {&quot;&gt;
-				&lt;input TYPE=&quot;hidden&quot; NAME=&quot;success&quot; VALUE=&quot;<A HREF="http://www.zylin.com/zy1000_support.html">http://www.zylin.com/zy1000_support.html</A>&quot;&gt;
-				&lt;input size=&quot;50&quot; name=&quot;subject&quot; type=&quot;hidden&quot; value=&quot;ZY1000 support request&quot;&gt;
-				&lt;table cellspacing=&quot;5&quot;&gt;
-				&lt;tr&gt;&lt;td&gt;Support ID&lt;/td&gt;&lt;td&gt;}
-append buffer $support_id
-append buffer {&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td&gt;Contact person&lt;/td&gt;&lt;td&gt;&lt;input size=&quot;50&quot; name=&quot;name&quot; type=&quot;text&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td&gt;Phone&lt;/td&gt;&lt;td&gt;&lt;input size=&quot;50&quot; name=&quot;phone&quot; type=&quot;text&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td&gt;email&lt;/td&gt;&lt;td&gt;&lt;input size=&quot;50&quot; name=&quot;email&quot; type=&quot;text&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;tr&gt;&lt;td&gt;MAC address&lt;/td&gt;&lt;td&gt;&lt;input size=&quot;50&quot; name=&quot;serial&quot; type=&quot;text&quot; value=&quot;}
-append buffer [mac]
-append buffer {&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
-				&lt;/td&gt;&lt;/tr&gt;
-				&lt;/table&gt;
-				&lt;p&gt;
-				Summary:
-				&lt;p&gt;
-				&lt;input name=&quot;summary&quot; size=&quot;50&quot;&gt;
-				&lt;p&gt;
-				Description:
-				&lt;p&gt;
-				&lt;textarea  style=&quot;overflow:auto;font-size:11px;&quot;  name=&quot;description&quot; cols=&quot;50&quot; rows=&quot;4&quot; type=&quot;textarea&quot; wrap=&quot;off&quot;&gt;&lt;/textarea&gt;
-				
-				&lt;p&gt;				
-				Log:&lt;p&gt;
-				&lt;textarea  style=&quot;overflow:auto;font-size:11px;&quot;  name=&quot;log&quot; cols=&quot;50&quot; rows=&quot;5&quot; type=&quot;textarea&quot; wrap=&quot;off&quot;&gt;}
-append buffer $form_log
-append buffer {&lt;/textarea&gt;
-				&lt;p&gt;				
-				Config:&lt;p&gt;
-				&lt;textarea  style=&quot;overflow:auto;font-size:11px;&quot;  name=&quot;config&quot; cols=&quot;50&quot; rows=&quot;5&quot; type=&quot;textarea&quot; wrap=&quot;off&quot;&gt;}
-append buffer $form_config
-append buffer {&lt;/textarea&gt;
-				&lt;p&gt;
-			&lt;/form&gt;
-			&lt;p&gt;
-			&lt;input value=&quot;Creates support request&quot; type=&quot;submit&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
-
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('/rom/menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;/ram/cgi/support.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('/rom/menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('/rom/menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('/rom/menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf</A>&quot;&gt;Quick Start Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/openocd.pdf">http://www.zylin.com/zy1000/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000_contact.html">http://www.zylin.com/zy1000_contact.html</A>&quot;&gt;Contact Zylin AS&lt;/a&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				Before contacting Zylin with questions, please fill in and submit this form
-				and allow us time to review the information and answer by email if possible.
-				&lt;p/&gt; 
-				Note that you can see precisely what information is submitted to Zylin in the
-				form: the log and your config files.
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('/rom/menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td/&gt;
-&lt;td&gt;
-&lt;img border=&quot;0&quot; src=&quot;/rom/menu_cuts/logo_bottom.png&quot;/&gt;
-&lt;/td&gt;
-&lt;td style=&quot;padding-top:10px;padding-left:10px;margin-top:10px;&quot; class=&quot;textlight&quot;&gt;
-							Zylin AS, Auglendsdalen 78, N-4017 Stavanger, Norway - www.zylin.com
-						&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/support.tcl (from rev 1324, trunk/src/server/httpd/support.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/targets.tcl
===================================================================
--- trunk/src/server/httpd/targets.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/targets.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,560 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Target config quick start guide&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-				
-				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either OpenOCD ships with an
-				openocd.cfg file for your target or you need to take an existing
-				config file and modify it for your needs.
-				&lt;p&gt; 
-				The reset init script is crucial. It will set up e.g. MMU, chip
-				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
-				&lt;p&gt;
-				Writing an openocd.cfg from scratch is a non-trivial exercise, but
-				fortunally it only has to be done once for a target and afterwards it
-				rarely if ever needs to be changed.
-				
-				
-				&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;targets.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-					
-					  Quick start guide on how to configure a target.
-				&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Target config quick start guide&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-				
-				A target needs an openocd.cfg file. This config file sets up
-				the CPU, flash and reset init script. Either OpenOCD ships with an
-				openocd.cfg file for your target or you need to take an existing
-				config file and modify it for your needs.
-				&lt;p&gt; 
-				The reset init script is crucial. It will set up e.g. MMU, chip
-				select registers, etc. after a reset. The init.cfg (reset init script)
-				is embedded into the openocd.cfg file in the sampls OpenOCD provides.
-				&lt;p&gt;
-				Writing an openocd.cfg from scratch is a non-trivial exercise, but
-				fortunally it only has to be done once for a target and afterwards it
-				rarely if ever needs to be changed.
-				
-				
-				&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;targets.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-					
-					  Quick start guide on how to configure a target.
-				&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/targets.tcl (from rev 1324, trunk/src/server/httpd/targets.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/terminal.tcl
===================================================================
--- trunk/src/server/httpd/terminal.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/terminal.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,364 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-
-
-		
-
-
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;OpenOCD debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-							OpenOCD
-						&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;&quot;&gt;Target Status&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;index.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;UART forwarding&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			}
-
-				set form_baudrate [formfetch form_baudrate]
-				if {[string length $form_baudrate]==0} {
-					set form_baudrate [ocd_uart]
-					set form_baudrate [string range $form_baudrate 0 [expr [string length $form_baudrate]-2]]
-				}
-				set form_action [formfetch form_action]
-			
-append buffer {
-			&lt;form action=&quot;terminal.tcl&quot; method=&quot;post&quot;&gt;
-				Target baudrate: 
-					&lt;select name=&quot;form_baudrate&quot;&gt;
-						}
-
-							foreach i {9600 19200 38400 57600 115200} { 
-							
-append buffer {
-				  				&lt;option }
-if {[string compare $form_baudrate $i]==0} { append buffer {selected=&quot;selected&quot;} }  
-append buffer {
-				  				value =&quot;}
-append buffer $i
-append buffer {&quot;&gt;}
-append buffer $i
-append buffer {&lt;/option&gt;
-				  			}
-
-				  			}
-				  			
-append buffer {
-						&lt;/select&gt;
-
-					&lt;p&gt;	
-					&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Set baudrate&quot; &gt;
-				&lt;/form&gt;			
-			}
-
-				if {[string compare $form_action &quot;Set baudrate&quot;]==0} {
-					append console [encode [ocd_uart $form_baudrate]]
-				}
-			
-append buffer {
-			
-			&lt;h2&gt;Simple UART&lt;/h2&gt;
-			This terminal window is purely for illustrative purposes. Use telnet or a terminal program
-			to talk to the target over TCP/IP for anything but trivial case of reading/writing a few
-			lines of texts in simple tests.
-			&lt;p&gt;
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;terminal.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://openocd.berlios.de/doc/openocd.pdf">http://openocd.berlios.de/doc/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;
-				
-				Serial port data to target is forwarded(both directions) in the simple terminal window
-				to the left. Alternatively you can &lt;b&gt;telnet }
-append buffer [ip]
-append buffer { 5555&lt;/b&gt;
-				or connect via TCP/IP from e.g. HyperTerminal.
-				&lt;p&gt;
-				Type &quot;help uart&quot; in telnet for information on how to set uart speed for target. Normally
-				the uart speed is set from the target configuration script by adding an &quot;uart N&quot;, where
-				N is the baudrate.
-				
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/terminal.tcl (from rev 1324, trunk/src/server/httpd/terminal.tcl)

Deleted: branches/openocd-0.1/src/server/httpd/upgrade.tcl
===================================================================
--- trunk/src/server/httpd/upgrade.tcl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/httpd/upgrade.tcl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,418 +0,0 @@
-# converted to .tcl by html2tcl.tcl
-set buffer &quot;&quot;
-append buffer {
-	
-	
-
-		
-		
-		
-		
-
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-
-		
-
-
-
-
-		
-
-
-
-		
-
-
-		
-
-
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-		
-		
-		
-		
-		
-
-		&lt;html xmlns=&quot;<A HREF="http://www.w3.org/TR/REC-html40">http://www.w3.org/TR/REC-html40</A>&quot;&gt;
-&lt;head&gt;
-&lt;title&gt;Zylin ZY1000 JTAG debugger&lt;/title&gt;
-&lt;meta charset=&quot;utf-8&quot; content=&quot;text/html&quot; http-equiv=&quot;Content-Type&quot;/&gt;
-&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;menuweb.css&quot;/&gt;
-&lt;/head&gt;
-}
-
-				set console &quot;&quot;
-				set upload_filename /ram/upload
-			
-append buffer {
-&lt;body style=&quot;margin:0px;&quot;&gt;
-&lt;div style=&quot;width:974px;height:85px;&quot;&gt;
-&lt;div style=&quot;float:left;position:relative;left:32px;width:478px;&quot;&gt;
-&lt;a href=&quot;/&quot;&gt;
-&lt;img src=&quot;menu_cuts/logo_top.png&quot; style=&quot;border:0px;&quot;/&gt;
-&lt;/a&gt;
-&lt;/div&gt;
-&lt;div style=&quot;float:left;position:relative;height:26px; width:278px;left:122px;background-image:url('menu_cuts/top_right.png');&quot;&gt;
-&lt;div style=&quot;position:relative;left:15px;top:4px;&quot; class=&quot;textlight&quot;&gt;
-}
-append buffer [capture version]
-append buffer {
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;/div&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:33px;&quot;&gt;
-&lt;div style=&quot;width:20px;height:510px;&quot;&gt;
-								&nbsp;
-							&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;height:100%;width:140px;padding:0px;&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;width:140px;&quot;&gt;
-&lt;tr style=&quot;height:59px;&quot;&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;zy1000.tcl&quot; style=&quot;&quot;&gt;Set IP Address&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;upgrade.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;ZY1000 Firmware&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;editfile.tcl&quot; style=&quot;&quot;&gt;Edit File&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;support.tcl&quot; style=&quot;&quot;&gt;Support Request&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:38px;background-image:url('menu_cuts/v_tab.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;left:10px;top:10px;font-weight:bold;&quot;&gt;
-&lt;a href=&quot;log.tcl#tail&quot; style=&quot;&quot;&gt;View Tail of Log&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:35px;background-image:url('menu_cuts/v_1.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;background-image:url('menu_cuts/v_2_tile.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:140px;height:140px;background-image:url('menu_cuts/v_3.png')&quot;/&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;vertical-align:top;padding:0px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/index.tcl&quot;&gt;Config Target&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/flashinfo.tcl&quot;&gt;Flash&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/browsemem.tcl&quot;&gt;Memory&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/openocd.tcl&quot;&gt;OpenOCD&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab1_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;font-weight:bold;text-align:center;width:100px;&quot;&gt;
-&lt;a href=&quot;/ram/cgi/zy1000.tcl&quot; style=&quot;font-weight: bold;&quot;&gt;Setup ZY1000&lt;/a&gt;
-&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;width:535px;background-image:url('menu_cuts/center_top.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#ffffff;text-indent:30px;height:40px;&quot; colspan=&quot;6&quot;&gt;
-&lt;H1&gt;Upgrade ZY1000 Firmware&lt;/H1&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;background-color:#ffffff;padding-left:30px;padding-right:30px;width=535px;height:100%;&quot; colspan=&quot;6&quot;&gt;
-			
-			}
-
-				set form_action [formfetch form_action];
-				set form_filecontent [formfetch form_filecontent];
-				
-				append buffer {&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;upgrade.tcl&quot; method=&quot;post&quot;&gt;}
-				if {[string compare $form_action &quot;Upload&quot;]==0} {
-					
-					if [string match ZylinPhiFirmware* $form_filecontent]==1 {
-						set form_filename /config/firmware.phi 
-						puts &quot;Writing firmware to $form_filename&quot;
-						set fp [aio.open $form_filename w];
-						$fp puts -nonewline $form_filecontent
-						$fp close
-						puts &quot;Done writing firmware to $form_filename&quot;
-						append buffer &quot;&lt;br&gt;&lt;div style='font-size:14px;'&gt;Upgraded Zylin JTAG, rebooting (wait ca. 30 seconds)...&lt;/div&gt;&lt;br&gt;&quot;
-						reboot
-					} else {
-						append buffer &quot;&lt;br&gt;Not a valid Zylin JTAG firmware file.&lt;br&gt;&quot;
-					}
-				} elseif {[string compare $form_action &quot;Restore factory settings&quot;]==0} {
-					proc rmdir { dir } {
-						set entries {}
-						catch {set entries [ls $dir]} err
-						foreach { entry } $entries {
-							rmdir $dir/$entry
-							rm $dir/$entry
-						}
-					}				
-					rmdir /config/settings
-					reboot
-					append buffer &quot;Restoring factory settings (wait ca. 30 seconds)...&lt;br&gt;&quot;
-				} else {
-					append buffer {&lt;div style=&quot;font-size:14px;&quot;&gt;Upgrade Zylin JTAG firmware + reboot. &lt;/div&gt;&lt;p&gt;}
-					append buffer {&lt;input type=&quot;file&quot; name=&quot;form_filecontent&quot;&gt; &lt;br&gt;}
-					append buffer {&lt;table&gt;&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;height:1px;width:535px;background-color:#a2c5d1;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;height:15px;width:535px;&quot;&gt;&amp;nbsp&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;}
-					append buffer {&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Upload&quot; &gt;&lt;br&gt; }
-					append buffer {&lt;input type=&quot;submit&quot; name=&quot;form_action&quot; value=&quot;Restore factory settings&quot; &gt;&lt;br&gt; }
-					append buffer {&lt;/form&gt; }
-				}
-			
-append buffer {
-			
-			&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-							 		
-								 	set toggle_details [formfetch toggle_details]
-								 	if {[string length $toggle_details]==0} {
-								 		set toggle_details 0
-								 	}
-								 	set show_details [load_var show_details]
-								 	if {[string length $show_details]==0} {
-								 		set show_details 0
-								 	}
-								 	if {$toggle_details==1} {
-								 		set show_details [expr 1-$show_details]
-								 		save_var show_details $show_details
-								 	}
-								 	
-							 		if {[string length $console]!=0} {
-							 			
-append buffer {
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:red;&quot; colspan=&quot;6&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;background-color:#ffffff;width:100%&quot; class=&quot;textgray&quot;&gt;
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-}
-
-												 		if {$show_details==1} {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-color:#dddddd;padding-left:5px;padding-right:5px;padding-top:3px;padding-bottom:3px;&quot;}
-												 			append buffer &gt;
-												 		} else {
-												 			append buffer &lt;
-												 			append buffer {td style=&quot;background-image:url('menu_cuts/h_tab_free.png');width:110px;height:29px;background-repeat: no-repeat;background-position:top left;&quot;}
-												 			append buffer &gt;
-												 		}
-												 	
-append buffer {
-&lt;a class=&quot;openocd&quot; href=&quot;/ram/cgi/upgrade.tcl?toggle_details=1&quot;&gt;
-}
-
-															if {$show_details==1} {
-																append buffer &quot;Hide details&quot;
-													 			append buffer &lt;br/&gt;
-															} else {
-																append buffer {&lt;div style=&quot;position:relative;top:7px;text-align:center;&quot;&gt;}
-																append buffer &quot;Show details&quot;
-																append buffer {&lt;/div&gt;}
-															}
-															
-append buffer {
-&lt;/a&gt;
-}
-
-													 		if {$show_details==1} {
-													 			append buffer $console
-													 		}
-													 	
-append buffer {&lt;/td&gt;}
-
-													 	if {$show_details!=1} {
-													 		append buffer {&lt;td&gt;&nbsp;&lt;/td&gt;}
-													 	}
-													 
-append buffer {
-&lt;td style=&quot;width:25px;&quot;&gt;&nbsp;&lt;/td&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-}
-
-									 }
-								
-append buffer {
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/center_bottom.png');background-repeat: no-repeat;background-position:top right;&quot; colspan=&quot;6&quot;&gt;
-&lt;div style=&quot;width:500px;background-color:#ffffff;height:100%;&quot;&gt;
-								 			&nbsp;
-							 			&lt;/div&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;td style=&quot;width:6px;&quot;/&gt;
-&lt;td style=&quot;width:245px;height:100%&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;height:100%;&quot;&gt;
-&lt;tr&gt;
-&lt;td style=&quot;width:103px;height:29px;background-image:url('menu_cuts/h_tab2_selected.png');background-repeat: no-repeat;&quot;&gt;
-&lt;div style=&quot;position:relative;top:7px;;font-weight:bold;text-align:center;width:100px;&quot; class=&quot;textgray&quot;&gt;
-										    Documentation
-										 &lt;/div&gt;
-&lt;/td&gt;
-&lt;td width=&quot;40px&quot;&gt;
-								 		&nbsp;
-								 	&lt;/td&gt;
-&lt;td/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:10px;width:245px;background-image:url('menu_cuts/right_top_small.png');&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:245px;padding-left:10px;padding-buttom:10px;line-height:17px;&quot; colspan=&quot;3&quot;&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf">http://www.zylin.com/zy1000/ZY1000_Quick_Start_Guide.pdf</A>&quot;&gt;Quick Start Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000/openocd.pdf">http://www.zylin.com/zy1000/openocd.pdf</A>&quot;&gt;OpenOCD Manual&lt;/a&gt;
-&lt;br/&gt;
-&lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000_contact.html">http://www.zylin.com/zy1000_contact.html</A>&quot;&gt;Contact Zylin AS&lt;/a&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td colspan=&quot;3&quot;&gt;
-&lt;table style=&quot;padding:0px;border-collapse:collapse;&quot;&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;td style=&quot;background-color:#999999;width:225px; height:1px;&quot;/&gt;
-&lt;td style=&quot;background-color:#d8d7d7;width:10px;height:1px&quot;/&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;background-color:#d8d7d7;height:15px;&quot; colspan=&quot;3&quot;/&gt;
-&lt;/tr&gt;
-&lt;tr style=&quot;height:100%;&quot;&gt;
-&lt;td style=&quot;height:100%;background-color:#d8d7d7;padding-left:10px;padding-right:10px;&quot; colspan=&quot;3&quot; class=&quot;textgray&quot;&gt;	
-				
-					Upload new firmware file to ZY1000, verify that it is a valid ZY1000 firmware
-					file, and upgrade flash.
-					&lt;p/&gt;
-					Restore factory settings restores all factory settings except the TCP/IP settings.
-					&lt;p/&gt;
-					The current version of the firmware is visible at the top of the web page.
-					&lt;p/&gt;
-					ZY1000 firmware can also be upgraded using serial port YModem upload.
-					&lt;p/&gt;
-					Check for new firmware at &lt;a target=&quot;_blank&quot; href=&quot;<A HREF="http://www.zylin.com/zy1000.html">http://www.zylin.com/zy1000.html</A>&quot;&gt;<A HREF="http://www.zylin.com/zy1000.html&lt;a">http://www.zylin.com/zy1000.html&lt;a</A>&gt; 
-				  
-			&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td style=&quot;height:30px;background-image:url('menu_cuts/right_bottom.png');&quot; colspan=&quot;3&quot;&gt;
-							 			&nbsp;
-							 		&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;tr&gt;
-&lt;td/&gt;
-&lt;td&gt;
-&lt;img border=&quot;0&quot; src=&quot;menu_cuts/logo_bottom.png&quot;/&gt;
-&lt;/td&gt;
-&lt;/tr&gt;
-&lt;/table&gt;
-&lt;/body&gt;
-&lt;/html&gt;
-		
-
-		
-
-
-		
-
-
-
-		
-
-		
-
-
-		
-
-
-		
-	
-	
-}
-
-start_chunked &quot;html&quot;
-write_chunked $buffer
-end_chunked
-

Copied: branches/openocd-0.1/src/server/httpd/upgrade.tcl (from rev 1324, trunk/src/server/httpd/upgrade.tcl)

Copied: branches/openocd-0.1/src/server/httpd.c (from rev 1324, trunk/src/server/httpd.c)

Modified: branches/openocd-0.1/src/server/server.c
===================================================================
--- branches/openocd_1_0_branch/src/server/server.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/server.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -53,6 +53,9 @@
 static int shutdown_openocd = 0;
 int handle_shutdown_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
+/* set when using pipes rather than tcp */
+int server_use_pipes = 0;
+
 int add_connection(service_t *service, command_context_t *cmd_ctx)
 {
 	unsigned int address_size;
@@ -69,28 +72,43 @@
 	c-&gt;priv = NULL;
 	c-&gt;next = NULL;
 
-	address_size = sizeof(c-&gt;sin);
-	
-	c-&gt;fd = accept(service-&gt;fd, (struct sockaddr *)&amp;service-&gt;sin, &amp;address_size);
-	
-	/* This increases performance dramatically for e.g. GDB load which
-	 * does not have a sliding window protocol. */
-	retval=setsockopt(c-&gt;fd,	/* socket affected */
-			IPPROTO_TCP,		/* set option at TCP level */
-			TCP_NODELAY,		/* name of option */
-			(char *)&amp;flag,		/* the cast is historical cruft */
-			sizeof(int));		/* length of option value */
+	if (service-&gt;type == CONNECTION_TCP)
+	{
+		address_size = sizeof(c-&gt;sin);
 		
-	LOG_INFO(&quot;accepting '%s' connection from %i&quot;, service-&gt;name, c-&gt;sin.sin_port);
-	if ((retval = service-&gt;new_connection(c)) == ERROR_OK)
-	{
+		c-&gt;fd = accept(service-&gt;fd, (struct sockaddr *)&amp;service-&gt;sin, &amp;address_size);
+		
+		/* This increases performance dramatically for e.g. GDB load which
+		 * does not have a sliding window protocol. */
+		retval=setsockopt(c-&gt;fd,	/* socket affected */
+				IPPROTO_TCP,		/* set option at TCP level */
+				TCP_NODELAY,		/* name of option */
+				(char *)&amp;flag,		/* the cast is historical cruft */
+				sizeof(int));		/* length of option value */
+			
+		LOG_INFO(&quot;accepting '%s' connection from %i&quot;, service-&gt;name, c-&gt;sin.sin_port);
+		if ((retval = service-&gt;new_connection(c)) != ERROR_OK)
+		{
+			close_socket(c-&gt;fd);
+			LOG_ERROR(&quot;attempted '%s' connection rejected&quot;, service-&gt;name);
+			free(c);
+			return retval;
+		}
 	}
-	else
+	else if (service-&gt;type == CONNECTION_PIPE)
 	{
-		close_socket(c-&gt;fd);
-		LOG_ERROR(&quot;attempted '%s' connection rejected&quot;, service-&gt;name);
-		free(c);
-		return retval;
+		c-&gt;fd = service-&gt;fd;
+		
+		/* do not check for new connections again on stdin */
+		service-&gt;fd = -1;
+		
+		LOG_INFO(&quot;accepting '%s' connection from pipe&quot;, service-&gt;name);
+		if ((retval = service-&gt;new_connection(c)) != ERROR_OK)
+		{
+			LOG_ERROR(&quot;attempted '%s' connection rejected&quot;, service-&gt;name);
+			free(c);
+			return retval;
+		}
 	}
 	
 	/* add to the end of linked list */
@@ -113,7 +131,8 @@
 		if (c-&gt;fd == connection-&gt;fd)
 		{	
 			service-&gt;connection_closed(c);
-			close_socket(c-&gt;fd);
+			if (service-&gt;type == CONNECTION_TCP)
+				close_socket(c-&gt;fd);
 			command_done(c-&gt;cmd_ctx);
 			
 			/* delete connection */
@@ -150,45 +169,70 @@
 	c-&gt;priv = priv;
 	c-&gt;next = NULL;
 	
-	if ((c-&gt;fd = socket(AF_INET, SOCK_STREAM, 0)) == -1)
+	if (type == CONNECTION_TCP)
 	{
-		LOG_ERROR(&quot;error creating socket: %s&quot;, strerror(errno));
-		exit(-1);
-	}
-	
-	setsockopt(c-&gt;fd, SOL_SOCKET, SO_REUSEADDR, (void*)&amp;so_reuseaddr_option, sizeof(int));
-	
-	socket_nonblock(c-&gt;fd);
-	
-	memset(&amp;c-&gt;sin, 0, sizeof(c-&gt;sin));
-	c-&gt;sin.sin_family = AF_INET;
-	c-&gt;sin.sin_addr.s_addr = INADDR_ANY;
-	c-&gt;sin.sin_port = htons(port);
-	
-	if (bind(c-&gt;fd, (struct sockaddr *)&amp;c-&gt;sin, sizeof(c-&gt;sin)) == -1)
-	{
-		LOG_ERROR(&quot;couldn't bind to socket: %s&quot;, strerror(errno));
-		exit(-1);
-	}
-	
+		if ((c-&gt;fd = socket(AF_INET, SOCK_STREAM, 0)) == -1)
+		{
+			LOG_ERROR(&quot;error creating socket: %s&quot;, strerror(errno));
+			exit(-1);
+		}
+		
+		setsockopt(c-&gt;fd, SOL_SOCKET, SO_REUSEADDR, (void*)&amp;so_reuseaddr_option, sizeof(int));
+		
+		socket_nonblock(c-&gt;fd);
+		
+		memset(&amp;c-&gt;sin, 0, sizeof(c-&gt;sin));
+		c-&gt;sin.sin_family = AF_INET;
+		c-&gt;sin.sin_addr.s_addr = INADDR_ANY;
+		c-&gt;sin.sin_port = htons(port);
+		
+		if (bind(c-&gt;fd, (struct sockaddr *)&amp;c-&gt;sin, sizeof(c-&gt;sin)) == -1)
+		{
+			LOG_ERROR(&quot;couldn't bind to socket: %s&quot;, strerror(errno));
+			exit(-1);
+		}
+		
 #ifndef _WIN32
-	int segsize=65536;
-	setsockopt(c-&gt;fd, IPPROTO_TCP, TCP_MAXSEG,  &amp;segsize, sizeof(int));
+		int segsize=65536;
+		setsockopt(c-&gt;fd, IPPROTO_TCP, TCP_MAXSEG,  &amp;segsize, sizeof(int));
 #endif
-	int window_size = 128 * 1024;	
-
-	/* These setsockopt()s must happen before the listen() */
+		int window_size = 128 * 1024;	
 	
-	setsockopt(c-&gt;fd, SOL_SOCKET, SO_SNDBUF,
-		(char *)&amp;window_size, sizeof(window_size));
-	setsockopt(c-&gt;fd, SOL_SOCKET, SO_RCVBUF,
-		(char *)&amp;window_size, sizeof(window_size));
-	
-	if (listen(c-&gt;fd, 1) == -1)
+		/* These setsockopt()s must happen before the listen() */
+		
+		setsockopt(c-&gt;fd, SOL_SOCKET, SO_SNDBUF,
+			(char *)&amp;window_size, sizeof(window_size));
+		setsockopt(c-&gt;fd, SOL_SOCKET, SO_RCVBUF,
+			(char *)&amp;window_size, sizeof(window_size));
+		
+		if (listen(c-&gt;fd, 1) == -1)
+		{
+			LOG_ERROR(&quot;couldn't listen on socket: %s&quot;, strerror(errno));
+			exit(-1);
+		}
+	}
+	else if (type == CONNECTION_PIPE)
 	{
-		LOG_ERROR(&quot;couldn't listen on socket: %s&quot;, strerror(errno));
-		exit(-1);
+		/* use stdin */
+		c-&gt;fd = STDIN_FILENO;
+		
+#ifdef _WIN32
+		/* for win32 set stdin/stdout to binary mode */
+		if (_setmode(_fileno(stdout), _O_BINARY) &lt; 0)
+			LOG_WARNING(&quot;cannot change stdout mode to binary&quot;);
+		if (_setmode(_fileno(stdin), _O_BINARY) &lt; 0)
+			LOG_WARNING(&quot;cannot change stdin mode to binary&quot;);
+		if (_setmode(_fileno(stderr), _O_BINARY) &lt; 0)
+			LOG_WARNING(&quot;cannot change stderr mode to binary&quot;);
+#else
+		socket_nonblock(c-&gt;fd);
+#endif
 	}
+	else
+	{
+		LOG_ERROR(&quot;unknown connection type: %d&quot;, type);
+		exit(1);
+	}
 	
 	/* add to the end of linked list */
 	for (p = &services; *p; p = &amp;(*p)-&gt;next);
@@ -310,15 +354,19 @@
 		
 #ifndef _WIN32
 #if BUILD_ECOSBOARD == 0
-		/* add STDIN to read_fds */
-		FD_SET(fileno(stdin), &amp;read_fds);
+		if (server_use_pipes == 0)
+		{
+			/* add STDIN to read_fds */
+			FD_SET(fileno(stdin), &amp;read_fds);
+		}
 #endif
 #endif
 
 		openocd_sleep_prelude();
 		kept_alive();
-		// Only while we're sleeping we'll let others run
-		retval = select(fd_max + 1, &amp;read_fds, NULL, NULL, &amp;tv);
+		
+		/* Only while we're sleeping we'll let others run */
+		retval = socket_select(fd_max + 1, &amp;read_fds, NULL, NULL, &amp;tv);
 		openocd_sleep_postlude();
 
 		if (retval == -1)
@@ -371,11 +419,14 @@
 				}
 				else
 				{
-					struct sockaddr_in sin;
-					unsigned int address_size = sizeof(sin);
-					int tmp_fd;
-					tmp_fd = accept(service-&gt;fd, (struct sockaddr *)&amp;service-&gt;sin, &amp;address_size);
-					close_socket(tmp_fd);
+					if (service-&gt;type != CONNECTION_PIPE)
+					{
+						struct sockaddr_in sin;
+						unsigned int address_size = sizeof(sin);
+						int tmp_fd;
+						tmp_fd = accept(service-&gt;fd, (struct sockaddr *)&amp;service-&gt;sin, &amp;address_size);
+						close_socket(tmp_fd);
+					}
 					LOG_INFO(&quot;rejected '%s' connection, no more connections allowed&quot;, service-&gt;name);
 				}
 			}
@@ -389,11 +440,16 @@
 				{
 					if ((FD_ISSET(c-&gt;fd, &amp;read_fds)) || c-&gt;input_pending)
 					{
-						if (service-&gt;input(c) != ERROR_OK)
+						if ((retval = service-&gt;input(c)) != ERROR_OK)
 						{
 							connection_t *next = c-&gt;next;
+							if (service-&gt;type == CONNECTION_PIPE)
+							{
+								/* if connection uses a pipe then shutdown openocd on error */
+								shutdown_openocd = 1;
+							}
 							remove_connection(service, c);
-							LOG_INFO(&quot;dropped '%s' connection&quot;, service-&gt;name);
+							LOG_INFO(&quot;dropped '%s' connection - error %d&quot;, service-&gt;name, retval);
 							c = next;
 							continue;
 						}
@@ -405,11 +461,15 @@
 		
 #ifndef _WIN32
 #if BUILD_ECOSBOARD == 0
-		if (FD_ISSET(fileno(stdin), &amp;read_fds))
+		/* check for data on stdin if not using pipes */
+		if (server_use_pipes == 0)
 		{
-			if (getc(stdin) == 'x')
+			if (FD_ISSET(fileno(stdin), &amp;read_fds))
 			{
-				shutdown_openocd = 1;
+				if (getc(stdin) == 'x')
+				{
+					shutdown_openocd = 1;
+				}
 			}
 		}
 #endif
@@ -429,12 +489,12 @@
 #ifdef _WIN32
 BOOL WINAPI ControlHandler(DWORD dwCtrlType)
 {
-    shutdown_openocd = 1;
-    return TRUE;
+	shutdown_openocd = 1;
+	return TRUE;
 }
 
 void sig_handler(int sig) {
-    shutdown_openocd = 1;
+	shutdown_openocd = 1;
 }
 #endif
 
@@ -444,7 +504,7 @@
 	WORD wVersionRequested;
 	WSADATA wsaData;
 
-	wVersionRequested = MAKEWORD( 2, 2 );
+	wVersionRequested = MAKEWORD(2, 2);
 
 	if (WSAStartup(wVersionRequested, &amp;wsaData) != 0)
 	{
@@ -452,14 +512,22 @@
 		exit(-1);
 	}
 
-	SetConsoleCtrlHandler( ControlHandler, TRUE );
+	if (server_use_pipes == 0)
+	{
+		/* register ctrl-c handler */
+		SetConsoleCtrlHandler(ControlHandler, TRUE);
+	}
+	else
+	{
+		/* we are using pipes so ignore ctrl-c */
+		SetConsoleCtrlHandler(NULL, TRUE);
+	}
 
 	signal(SIGINT, sig_handler);
 	signal(SIGTERM, sig_handler);
 	signal(SIGBREAK, sig_handler);
 	signal(SIGABRT, sig_handler);
 #endif
-
 	
 	return ERROR_OK;
 }
@@ -491,5 +559,3 @@
 
 	return ERROR_COMMAND_CLOSE_CONNECTION;
 }
-
-

Modified: branches/openocd-0.1/src/server/server.h
===================================================================
--- branches/openocd_1_0_branch/src/server/server.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/server.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -34,9 +34,8 @@
 
 enum connection_type
 {
-	CONNECTION_GDB,
-	CONNECTION_TELNET,
-	CONNECTION_TCL,
+	CONNECTION_TCP,
+	CONNECTION_PIPE
 };
 
 typedef struct connection_s
@@ -76,6 +75,8 @@
 extern int server_loop(command_context_t *command_context);
 extern int server_register_commands(command_context_t *context);
 
+extern int server_use_pipes;
+
 #define ERROR_SERVER_REMOTE_CLOSED	(-400)
 #define ERROR_CONNECTION_REJECTED	(-401)
 

Modified: branches/openocd-0.1/src/server/tcl_server.c
===================================================================
--- branches/openocd_1_0_branch/src/server/tcl_server.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/tcl_server.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -179,7 +179,7 @@
 		tcl_port = 6666;
 	}
 
-	retval = add_service(&quot;tcl&quot;, CONNECTION_TCL, tcl_port, 1, tcl_new_connection, tcl_input, tcl_closed, NULL);
+	retval = add_service(&quot;tcl&quot;, CONNECTION_TCP, tcl_port, 1, tcl_new_connection, tcl_input, tcl_closed, NULL);
 	return retval;
 }
 

Modified: branches/openocd-0.1/src/server/telnet_server.c
===================================================================
--- branches/openocd_1_0_branch/src/server/telnet_server.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/server/telnet_server.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -188,8 +188,6 @@
 
 	log_add_callback(telnet_log_callback, connection);
 
-
-
 	return ERROR_OK;
 }
 
@@ -617,7 +615,7 @@
 
 	telnet_service-&gt;banner = banner;
 
-	add_service(&quot;telnet&quot;, CONNECTION_TELNET, telnet_port, 1, telnet_new_connection, telnet_input, telnet_connection_closed, telnet_service);
+	add_service(&quot;telnet&quot;, CONNECTION_TCP, telnet_port, 1, telnet_new_connection, telnet_input, telnet_connection_closed, telnet_service);
 
 	return ERROR_OK;
 }
@@ -628,7 +626,7 @@
 					 COMMAND_EXEC, &quot;exit telnet session&quot;);
 
 	register_command(command_context, NULL, &quot;telnet_port&quot;, handle_telnet_port_command,
-					 COMMAND_CONFIG, &quot;port on which to listen for incoming telnet connections&quot;);
+					 COMMAND_ANY, &quot;port on which to listen for incoming telnet connections&quot;);
 
 	return ERROR_OK;
 }

Modified: branches/openocd-0.1/src/target/arm720t.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm720t.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm720t.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -447,21 +447,19 @@
 	arm7tdmi_init_target(cmd_ctx, target);
 
 	return ERROR_OK;
-
 }
 
 int arm720t_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm720t_init_arch_info(target_t *target, arm720t_common_t *arm720t, jtag_tap_t *tap, const char *variant)
+int arm720t_init_arch_info(target_t *target, arm720t_common_t *arm720t, jtag_tap_t *tap)
 {
 	arm7tdmi_common_t *arm7tdmi = &amp;arm720t-&gt;arm7tdmi_common;
 	arm7_9_common_t *arm7_9 = &amp;arm7tdmi-&gt;arm7_9_common;
 
-	arm7tdmi_init_arch_info(target, arm7tdmi, tap, variant);
+	arm7tdmi_init_arch_info(target, arm7tdmi, tap);
 
 	arm7tdmi-&gt;arch_info = arm720t;
 	arm720t-&gt;common_magic = ARM720T_COMMON_MAGIC;
@@ -485,7 +483,7 @@
 {
 	arm720t_common_t *arm720t = calloc(1,sizeof(arm720t_common_t));
 
-	arm720t_init_arch_info(target, arm720t, target-&gt;tap, target-&gt;variant);
+	arm720t_init_arch_info(target, arm720t, target-&gt;tap);
 
 	return ERROR_OK;
 }

Modified: branches/openocd-0.1/src/target/arm7_9_common.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm7_9_common.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm7_9_common.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -66,7 +66,6 @@
 int handle_arm7_9_dcc_downloads_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 int handle_arm7_9_etm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
-
 static int arm7_9_clear_watchpoints(arm7_9_common_t *arm7_9)
 {
 	embeddedice_write_reg(&amp;arm7_9-&gt;eice_cache-&gt;reg_list[EICE_W0_CONTROL_VALUE], 0x0);
@@ -143,7 +142,6 @@
 	return arm7_9_clear_watchpoints(arm7_9);
 }
 
-
 int arm7_9_get_arch_pointers(target_t *target, armv4_5_common_t **armv4_5_p, arm7_9_common_t **arm7_9_p)
 {
 	armv4_5_common_t *armv4_5 = target-&gt;arch_info;
@@ -269,7 +267,6 @@
 	}
 
 	return retval;
-
 }
 
 int arm7_9_unset_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
@@ -388,7 +385,6 @@
 		}
 	}
 
-
 	arm7_9-&gt;breakpoint_count++;
 
 	return arm7_9_set_breakpoint(target, breakpoint);
@@ -571,9 +567,6 @@
 	return ERROR_OK;
 }
 
-
-
-
 int arm7_9_execute_sys_speed(struct target_s *target)
 {
 	int retval;
@@ -642,9 +635,9 @@
 		/* check for DBGACK and SYSCOMP set (others don't care) */
 
 		/* NB! These are constants that must be available until after next jtag_execute() and
-		   we evaluate the values upon first execution in lieu of setting up these constants
-		   during early setup.
-		*/
+		 * we evaluate the values upon first execution in lieu of setting up these constants
+		 * during early setup.
+		 * */
 		buf_set_u32(check_value, 0, 32, 0x9);
 		buf_set_u32(check_mask, 0, 32, 0x9);
 		set=1;
@@ -689,7 +682,6 @@
 	arm_jtag_t *jtag_info = &amp;arm7_9-&gt;jtag_info;
 	reg_t *dcc_control = &amp;arm7_9-&gt;eice_cache-&gt;reg_list[EICE_COMMS_CTRL];
 
-
 	if (!target-&gt;dbg_msg_enabled)
 		return ERROR_OK;
 
@@ -857,29 +849,26 @@
 		jtag_add_reset(0, 1);
 	}
 
-
 	target-&gt;state = TARGET_RESET;
 	jtag_add_sleep(50000);
 
 	armv4_5_invalidate_core_regs(target);
 
-    if ((target-&gt;reset_halt)&amp;&amp;((jtag_reset_config &amp; RESET_SRST_PULLS_TRST)==0))
+	if ((target-&gt;reset_halt)&amp;&amp;((jtag_reset_config &amp; RESET_SRST_PULLS_TRST)==0))
 	{
 		/* debug entry was already prepared in arm7_9_assert_reset() */
 		target-&gt;debug_reason = DBG_REASON_DBGRQ;
 	}
 
 	return ERROR_OK;
-
 }
 
 int arm7_9_deassert_reset(target_t *target)
 {
 	int retval=ERROR_OK;
 	LOG_DEBUG(&quot;target-&gt;state: %s&quot;,
-		  Jim_Nvp_value2name_simple( nvp_target_state,target-&gt;state)-&gt;name);
+		Jim_Nvp_value2name_simple( nvp_target_state,target-&gt;state)-&gt;name);
 
-
 	/* deassert reset lines */
 	jtag_add_reset(0, 0);
 
@@ -1527,7 +1516,6 @@
 	}
 }
 
-
 int arm7_9_resume(struct target_s *target, int current, u32 address, int handle_breakpoints, int debug_execution)
 {
 	armv4_5_common_t *armv4_5 = target-&gt;arch_info;
@@ -1833,7 +1821,6 @@
 		}
 
 	return err;
-
 }
 
 int arm7_9_read_core_reg(struct target_s *target, int num, enum armv4_5_mode mode)
@@ -1900,7 +1887,6 @@
 	}
 
 	return ERROR_OK;
-
 }
 
 int arm7_9_write_core_reg(struct target_s *target, int num, enum armv4_5_mode mode, u32 value)
@@ -2326,7 +2312,6 @@
 static int dcc_count;
 static u8 *dcc_buffer;
 
-
 static int arm7_9_dcc_completion(struct target_s *target, u32 exit_point, int timeout_ms, void *arch_info)
 {
 	int retval = ERROR_OK;
@@ -2342,8 +2327,7 @@
 	if (count&gt;2)
 	{
 		/* Handle first &amp; last using standard embeddedice_write_reg and the middle ones w/the
-		   core function repeated.
-		 */
+		 * core function repeated. */
 		embeddedice_write_reg(&amp;arm7_9-&gt;eice_cache-&gt;reg_list[EICE_COMMS_DATA], fast_target_buffer_get_u32(buffer, little));
 		buffer+=4;
 
@@ -2373,7 +2357,6 @@
 	return target_wait_state(target, TARGET_HALTED, 500);
 }
 
-
 static const u32 dcc_code[] =
 {
 	/* MRC      TST         BNE         MRC         STR         B */
@@ -2382,7 +2365,6 @@
 
 int armv4_5_run_algorithm_inner(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_params, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info, int (*run_it)(struct target_s *target, u32 exit_point, int timeout_ms, void *arch_info));
 
-
 int arm7_9_bulk_write_memory(target_t *target, u32 address, u32 count, u8 *buffer)
 {
 	int retval;
@@ -2429,8 +2411,6 @@
 
 	buf_set_u32(reg_params[0].value, 0, 32, address);
 
-	//armv4_5_run_algorithm_inner(struct target_s *target, int num_mem_params, mem_param_t *mem_params,
-	// int num_reg_params, reg_param_t *reg_params, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info, int (*run_it)(struct target_s *target, u32 exit_point, int timeout_ms, void *arch_info))
 	dcc_count=count;
 	dcc_buffer=buffer;
 	retval = armv4_5_run_algorithm_inner(target, 0, NULL, 1, reg_params,
@@ -2741,10 +2721,8 @@
 	value = strtoul(args[2], NULL, 0);
 
 	return arm7_9_write_core_reg(target, num, mode, value);
-
 }
 
-
 int handle_arm7_9_dbgrq_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);

Modified: branches/openocd-0.1/src/target/arm7_9_common.h
===================================================================
--- branches/openocd_1_0_branch/src/target/arm7_9_common.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm7_9_common.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -154,5 +154,4 @@
 int arm7_9_init_arch_info(target_t *target, arm7_9_common_t *arm7_9);
 int arm7_9_get_arch_pointers(target_t *target, armv4_5_common_t **armv4_5_p, arm7_9_common_t **arm7_9_p);
 
-
 #endif /* ARM7_9_COMMON_H */

Modified: branches/openocd-0.1/src/target/arm7tdmi.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm7tdmi.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm7tdmi.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -364,7 +364,6 @@
 	 * reading PC in Thumb state gives address of instruction + 4
 	 */
 	*pc -= 0xa;
-
 }
 
 void arm7tdmi_read_core_regs(target_t *target, u32 mask, u32* core_regs[16])
@@ -391,7 +390,6 @@
 			/* nothing fetched, STM still in EXECUTE (1+i cycle) */
 			arm7tdmi_clock_data_in(jtag_info, core_regs[i]);
 	}
-
 }
 
 void arm7tdmi_read_core_regs_target_buffer(target_t *target, u32 mask, void* buffer, int size)
@@ -435,7 +433,6 @@
 			}
 		}
 	}
-
 }
 
 void arm7tdmi_read_xpsr(target_t *target, u32 *xpsr, int spsr)
@@ -456,7 +453,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	/* nothing fetched, STR still in EXECUTE (2nd cycle) */
 	arm7tdmi_clock_data_in(jtag_info, xpsr);
-
 }
 
 void arm7tdmi_write_xpsr(target_t *target, u32 xpsr, int spsr)
@@ -507,7 +503,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	/* nothing fetched, MSR in EXECUTE (2) */
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
-
 }
 
 void arm7tdmi_write_core_regs(target_t *target, u32 mask, u32 core_regs[16])
@@ -535,7 +530,6 @@
 			arm7tdmi_clock_out_inner(jtag_info, core_regs[i], 0);
 	}
 	arm7tdmi_clock_out_inner(jtag_info, ARMV4_5_NOP, 0);
-
 }
 
 void arm7tdmi_load_word_regs(target_t *target, u32 mask)
@@ -549,7 +543,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_LDMIA(0, mask &amp; 0xffff, 0, 1), NULL, 0);
-
 }
 
 void arm7tdmi_load_hword_reg(target_t *target, int num)
@@ -563,7 +556,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_LDRH_IP(num, 0), NULL, 0);
-
 }
 
 void arm7tdmi_load_byte_reg(target_t *target, int num)
@@ -577,7 +569,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_LDRB_IP(num, 0), NULL, 0);
-
 }
 
 void arm7tdmi_store_word_regs(target_t *target, u32 mask)
@@ -591,7 +582,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STMIA(0, mask, 0, 1), NULL, 0);
-
 }
 
 void arm7tdmi_store_hword_reg(target_t *target, int num)
@@ -605,7 +595,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STRH_IP(num, 0), NULL, 0);
-
 }
 
 void arm7tdmi_store_byte_reg(target_t *target, int num)
@@ -619,7 +608,6 @@
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 0);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_STRB_IP(num, 0), NULL, 0);
-
 }
 
 void arm7tdmi_write_pc(target_t *target, u32 pc)
@@ -658,7 +646,6 @@
 
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_NOP, NULL, 1);
 	arm7tdmi_clock_out_inner(jtag_info, ARMV4_5_B(0xfffffa, 0), 0);
-
 }
 
 void arm7tdmi_branch_resume_thumb(target_t *target)
@@ -720,7 +707,6 @@
 
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, NULL, 1);
 	arm7tdmi_clock_out(jtag_info, ARMV4_5_T_B(0x7f8), NULL, 0);
-
 }
 
 void arm7tdmi_build_reg_cache(target_t *target)
@@ -771,20 +757,17 @@
 
 int arm7tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target)
 {
-
 	arm7tdmi_build_reg_cache(target);
 
 	return ERROR_OK;
-
 }
 
 int arm7tdmi_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm7tdmi_init_arch_info(target_t *target, arm7tdmi_common_t *arm7tdmi, jtag_tap_t *tap, const char *variant)
+int arm7tdmi_init_arch_info(target_t *target, arm7tdmi_common_t *arm7tdmi, jtag_tap_t *tap)
 {
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -838,34 +821,21 @@
 	arm7tdmi-&gt;arch_info = NULL;
 	arm7tdmi-&gt;common_magic = ARM7TDMI_COMMON_MAGIC;
 
-	if (variant)
-	{
-		arm7tdmi-&gt;variant = strdup(variant);
-	}
-	else
-	{
-		arm7tdmi-&gt;variant = strdup(&quot;&quot;);
-	}
-
 	arm7_9_init_arch_info(target, arm7_9);
 
 	return ERROR_OK;
 }
 
-
-
 int arm7tdmi_target_create( struct target_s *target, Jim_Interp *interp )
 {
 	arm7tdmi_common_t *arm7tdmi;
 
 	arm7tdmi = calloc(1,sizeof(arm7tdmi_common_t));
+	arm7tdmi_init_arch_info(target, arm7tdmi, target-&gt;tap);
 
-	arm7tdmi_init_arch_info(target, arm7tdmi, target-&gt;tap, target-&gt;variant);
-
 	return ERROR_OK;
 }
 
-
 int arm7tdmi_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
@@ -873,5 +843,4 @@
 	retval = arm7_9_register_commands(cmd_ctx);
 
 	return retval;
-
 }

Modified: branches/openocd-0.1/src/target/arm7tdmi.h
===================================================================
--- branches/openocd_1_0_branch/src/target/arm7tdmi.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm7tdmi.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -35,15 +35,13 @@
 typedef struct arm7tdmi_common_s
 {
 	int common_magic;
-	char *variant;
 	void *arch_info;
 	arm7_9_common_t arm7_9_common;
 } arm7tdmi_common_t;
 
 int arm7tdmi_register_commands(struct command_context_s *cmd_ctx);
-int arm7tdmi_init_arch_info(target_t *target, arm7tdmi_common_t *arm7tdmi, jtag_tap_t *tap, const char *variant);
+int arm7tdmi_init_arch_info(target_t *target, arm7tdmi_common_t *arm7tdmi, jtag_tap_t *tap);
 int arm7tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target);
 int arm7tdmi_examine(struct target_s *target);
 
-
 #endif /* ARM7TDMI_H */

Modified: branches/openocd-0.1/src/target/arm920t.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm920t.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm920t.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -703,23 +703,21 @@
 	arm9tdmi_init_target(cmd_ctx, target);
 
 	return ERROR_OK;
-
 }
 
 int arm920t_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm920t_init_arch_info(target_t *target, arm920t_common_t *arm920t, jtag_tap_t *tap, const char *variant)
+int arm920t_init_arch_info(target_t *target, arm920t_common_t *arm920t, jtag_tap_t *tap)
 {
 	arm9tdmi_common_t *arm9tdmi = &amp;arm920t-&gt;arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &amp;arm9tdmi-&gt;arm7_9_common;
 
 	/* initialize arm9tdmi specific info (including arm7_9 and armv4_5)
 	 */
-	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
+	arm9tdmi_init_arch_info(target, arm9tdmi, tap);
 
 	arm9tdmi-&gt;arch_info = arm920t;
 	arm920t-&gt;common_magic = ARM920T_COMMON_MAGIC;
@@ -752,7 +750,7 @@
 {
 	arm920t_common_t *arm920t = calloc(1,sizeof(arm920t_common_t));
 
-	arm920t_init_arch_info(target, arm920t, target-&gt;tap, target-&gt;variant);
+	arm920t_init_arch_info(target, arm920t, target-&gt;tap);
 
 	return ERROR_OK;
 }
@@ -995,10 +993,8 @@
 				 i_cache[segment][index].data[i] = regs[i];
 				 fprintf(output, &quot;%i: 0x%8.8x\n&quot;, i-1, regs[i]);
 			}
-
 		}
 
-
 		/* Ra: r0 = index(31:26):SBZ(25:8):segment(7:5):SBZ(4:0) */
 		regs[0] = 0x0 | (segment &lt;&lt; 5) | (C15_C_D_Ind &lt;&lt; 26);
 		arm9tdmi_write_core_regs(target, 0x1, regs);

Modified: branches/openocd-0.1/src/target/arm926ejs.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm926ejs.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm926ejs.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -98,7 +98,6 @@
 	.mmu = arm926ejs_mmu
 };
 
-
 int arm926ejs_catch_broken_irscan(u8 *captured, void *priv, scan_field_t *field)
 {
 	/* The ARM926EJ-S' instruction register is 4 bits wide */
@@ -498,7 +497,6 @@
 	LOG_DEBUG(&quot;D FSR: 0x%8.8x, D FAR: 0x%8.8x, I FSR: 0x%8.8x&quot;,
 		arm926ejs-&gt;d_fsr, arm926ejs-&gt;d_far, arm926ejs-&gt;i_fsr);
 
-
 	u32 cache_dbg_ctrl;
 
 	/* read-modify-write CP15 cache debug control register
@@ -666,7 +664,6 @@
 	arm926ejs-&gt;armv4_5_mmu.armv4_5_cache.i_cache_enabled = 0;
 
 	return target_call_event_callbacks(target, TARGET_EVENT_HALTED);
-
 }
 
 int arm926ejs_write_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer)
@@ -705,23 +702,21 @@
 	arm9tdmi_init_target(cmd_ctx, target);
 
 	return ERROR_OK;
-
 }
 
 int arm926ejs_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm926ejs_init_arch_info(target_t *target, arm926ejs_common_t *arm926ejs, jtag_tap_t *tap, const char *variant)
+int arm926ejs_init_arch_info(target_t *target, arm926ejs_common_t *arm926ejs, jtag_tap_t *tap)
 {
 	arm9tdmi_common_t *arm9tdmi = &amp;arm926ejs-&gt;arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &amp;arm9tdmi-&gt;arm7_9_common;
 
 	/* initialize arm9tdmi specific info (including arm7_9 and armv4_5)
 	 */
-	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
+	arm9tdmi_init_arch_info(target, arm9tdmi, tap);
 
 	arm9tdmi-&gt;arch_info = arm926ejs;
 	arm926ejs-&gt;common_magic = ARM926EJS_COMMON_MAGIC;
@@ -755,7 +750,7 @@
 {
 	arm926ejs_common_t *arm926ejs = calloc(1,sizeof(arm926ejs_common_t));
 
-	arm926ejs_init_arch_info(target, arm926ejs, target-&gt;tap, target-&gt;variant);
+	arm926ejs_init_arch_info(target, arm926ejs, target-&gt;tap);
 
 	return ERROR_OK;
 }
@@ -945,6 +940,7 @@
 
 	return armv4_5_mmu_handle_mw_phys_command(cmd_ctx, cmd, args, argc, target, &amp;arm926ejs-&gt;armv4_5_mmu);
 }
+
 static int arm926ejs_virt2phys(struct target_s *target, u32 virtual, u32 *physical)
 {
 	int retval;

Modified: branches/openocd-0.1/src/target/arm926ejs.h
===================================================================
--- branches/openocd_1_0_branch/src/target/arm926ejs.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm926ejs.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -43,7 +43,7 @@
 	u32 d_far;
 } arm926ejs_common_t;
 
-extern int arm926ejs_init_arch_info(target_t *target, arm926ejs_common_t *arm926ejs, jtag_tap_t *tap, const char *variant);
+extern int arm926ejs_init_arch_info(target_t *target, arm926ejs_common_t *arm926ejs, jtag_tap_t *tap);
 extern int arm926ejs_register_commands(struct command_context_s *cmd_ctx); 
 extern int arm926ejs_arch_state(struct target_s *target); 
 extern int arm926ejs_write_memory(struct target_s *target, u32 address, u32 size, u32 count, u8 *buffer); 

Modified: branches/openocd-0.1/src/target/arm966e.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm966e.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm966e.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -98,16 +98,15 @@
 
 int arm966e_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm966e_init_arch_info(target_t *target, arm966e_common_t *arm966e, jtag_tap_t *tap, const char *variant)
+int arm966e_init_arch_info(target_t *target, arm966e_common_t *arm966e, jtag_tap_t *tap)
 {
 	arm9tdmi_common_t *arm9tdmi = &amp;arm966e-&gt;arm9tdmi_common;
 	arm7_9_common_t *arm7_9 = &amp;arm9tdmi-&gt;arm7_9_common;
 
-	arm9tdmi_init_arch_info(target, arm9tdmi, tap, variant);
+	arm9tdmi_init_arch_info(target, arm9tdmi, tap);
 
 	arm9tdmi-&gt;arch_info = arm966e;
 	arm966e-&gt;common_magic = ARM966E_COMMON_MAGIC;
@@ -125,7 +124,7 @@
 {
 	arm966e_common_t *arm966e = calloc(1,sizeof(arm966e_common_t));
 
-	arm966e_init_arch_info(target, arm966e, target-&gt;tap, target-&gt;variant);
+	arm966e_init_arch_info(target, arm966e, target-&gt;tap);
 
 	return ERROR_OK;
 }

Modified: branches/openocd-0.1/src/target/arm9tdmi.c
===================================================================
--- branches/openocd_1_0_branch/src/target/arm9tdmi.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm9tdmi.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -507,7 +507,6 @@
 			/* nothing fetched, STM in MEMORY (i'th cycle) */
 			arm9tdmi_clock_data_in(jtag_info, core_regs[i]);
 	}
-
 }
 
 void arm9tdmi_read_core_regs_target_buffer(target_t *target, u32 mask, void* buffer, int size)
@@ -549,7 +548,6 @@
 					break;
 			}
 	}
-
 }
 
 void arm9tdmi_read_xpsr(target_t *target, u32 *xpsr, int spsr)
@@ -574,7 +572,6 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	/* nothing fetched, STR in MEMORY */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, xpsr, 0);
-
 }
 
 void arm9tdmi_write_xpsr(target_t *target, u32 xpsr, int spsr)
@@ -664,7 +661,6 @@
 			arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, core_regs[i], NULL, 0);
 	}
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-
 }
 
 void arm9tdmi_load_word_regs(target_t *target, u32 mask)
@@ -677,7 +673,6 @@
 	/* put system-speed load-multiple into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_LDMIA(0, mask &amp; 0xffff, 0, 1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_load_hword_reg(target_t *target, int num)
@@ -702,7 +697,6 @@
 	/* put system-speed load byte into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_LDRB_IP(num, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_store_word_regs(target_t *target, u32 mask)
@@ -715,7 +709,6 @@
 	/* put system-speed store-multiple into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_STMIA(0, mask, 0, 1), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_store_hword_reg(target_t *target, int num)
@@ -728,7 +721,6 @@
 	/* put system-speed store half-word into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_STRH_IP(num, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_store_byte_reg(target_t *target, int num)
@@ -741,7 +733,6 @@
 	/* put system-speed store byte into the pipeline */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_STRB_IP(num, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_write_pc(target_t *target, u32 pc)
@@ -768,7 +759,6 @@
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
 	/* fetch NOP, LDM in EXECUTE stage (5th cycle) */
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 0);
-
 }
 
 void arm9tdmi_branch_resume(target_t *target)
@@ -780,7 +770,6 @@
 
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_B(0xfffffc, 0), 0, NULL, 0);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_NOP, 0, NULL, 1);
-
 }
 
 void arm9tdmi_branch_resume_thumb(target_t *target)
@@ -841,7 +830,6 @@
 
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_B(0x7f7), 0, NULL, 1);
 	arm9tdmi_clock_out(jtag_info, ARMV4_5_T_NOP, 0, NULL, 0);
-
 }
 
 void arm9tdmi_enable_single_step(target_t *target, u32 next_pc)
@@ -888,7 +876,6 @@
 	armv4_5-&gt;core_cache = (*cache_p);
 }
 
-
 int arm9tdmi_examine(struct target_s *target)
 {
 	/* get pointers to arch-specific information */
@@ -932,16 +919,14 @@
 	arm9tdmi_build_reg_cache(target);
 
 	return ERROR_OK;
-
 }
 
 int arm9tdmi_quit(void)
 {
-
 	return ERROR_OK;
 }
 
-int arm9tdmi_init_arch_info(target_t *target, arm9tdmi_common_t *arm9tdmi, jtag_tap_t *tap, const char *variant)
+int arm9tdmi_init_arch_info(target_t *target, arm9tdmi_common_t *arm9tdmi, jtag_tap_t *tap)
 {
 	armv4_5_common_t *armv4_5;
 	arm7_9_common_t *arm7_9;
@@ -995,15 +980,6 @@
 	arm9tdmi-&gt;common_magic = ARM9TDMI_COMMON_MAGIC;
 	arm9tdmi-&gt;arch_info = NULL;
 
-	if (variant)
-	{
-		arm9tdmi-&gt;variant = strdup(variant);
-	}
-	else
-	{
-		arm9tdmi-&gt;variant = strdup(&quot;&quot;);
-	}
-
 	arm7_9_init_arch_info(target, arm7_9);
 
 	/* override use of DBGRQ, this is safe on ARM9TDMI */
@@ -1045,13 +1021,11 @@
 	return ERROR_OK;
 }
 
-
-
 int arm9tdmi_target_create(struct target_s *target, Jim_Interp *interp)
 {
 	arm9tdmi_common_t *arm9tdmi = calloc(1,sizeof(arm9tdmi_common_t));
 
-	arm9tdmi_init_arch_info(target, arm9tdmi, target-&gt;tap, target-&gt;variant);
+	arm9tdmi_init_arch_info(target, arm9tdmi, target-&gt;tap);
 
 	return ERROR_OK;
 }
@@ -1059,19 +1033,13 @@
 int arm9tdmi_register_commands(struct command_context_s *cmd_ctx)
 {
 	int retval;
-
 	command_t *arm9tdmi_cmd;
-
-
+	
 	retval = arm7_9_register_commands(cmd_ctx);
-
 	arm9tdmi_cmd = register_command(cmd_ctx, NULL, &quot;arm9tdmi&quot;, NULL, COMMAND_ANY, &quot;arm9tdmi specific commands&quot;);
-
 	register_command(cmd_ctx, arm9tdmi_cmd, &quot;vector_catch&quot;, handle_arm9tdmi_catch_vectors_command, COMMAND_EXEC, &quot;catch arm920t vectors ['all'|'none'|'&lt;vec1 vec2 ...&gt;']&quot;);
-
-
+	
 	return retval;
-
 }
 
 int handle_arm9tdmi_catch_vectors_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)

Modified: branches/openocd-0.1/src/target/arm9tdmi.h
===================================================================
--- branches/openocd_1_0_branch/src/target/arm9tdmi.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/arm9tdmi.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -35,7 +35,6 @@
 typedef struct arm9tdmi_common_s
 {
 	int common_magic;
-	char *variant;
 	void *arch_info;
 	arm7_9_common_t arm7_9_common;
 } arm9tdmi_common_t;
@@ -60,7 +59,7 @@
 
 extern int arm9tdmi_init_target(struct command_context_s *cmd_ctx, struct target_s *target);
 int arm9tdmi_examine(struct target_s *target);
-extern int arm9tdmi_init_arch_info(target_t *target, arm9tdmi_common_t *arm9tdmi, jtag_tap_t *tap, const char *variant);
+extern int arm9tdmi_init_arch_info(target_t *target, arm9tdmi_common_t *arm9tdmi, jtag_tap_t *tap);
 extern int arm9tdmi_register_commands(struct command_context_s *cmd_ctx);
 
 extern int arm9tdmi_clock_out(arm_jtag_t *jtag_info, u32 instr, u32 out, u32 *in, int sysspeed);

Modified: branches/openocd-0.1/src/target/armv4_5.c
===================================================================
--- branches/openocd_1_0_branch/src/target/armv4_5.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/armv4_5.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -178,7 +178,6 @@
 	&quot;GDB dummy floating-point status register&quot;, armv4_5_gdb_dummy_fps_value, 0, 1, 32, NULL, 0, NULL, 0
 };
 
-
 int armv4_5_get_core_reg(reg_t *reg)
 {
 	int retval;
@@ -663,7 +662,6 @@
 	return retval;
 }
 
-
 int armv4_5_run_algorithm(struct target_s *target, int num_mem_params, mem_param_t *mem_params, int num_reg_params, reg_param_t *reg_params, u32 entry_point, u32 exit_point, int timeout_ms, void *arch_info)
 {
 	return armv4_5_run_algorithm_inner(target, num_mem_params, mem_params, num_reg_params, reg_params, entry_point, exit_point, timeout_ms, arch_info, armv4_5_run_algorithm_completion);

Modified: branches/openocd-0.1/src/target/armv4_5.h
===================================================================
--- branches/openocd_1_0_branch/src/target/armv4_5.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/armv4_5.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -137,7 +137,6 @@
 	}
 };
 
-
 extern int armv4_5_arch_state(struct target_s *target);
 extern int armv4_5_get_gdb_reg_list(target_t *target, reg_t **reg_list[], int *reg_list_size);
 extern int armv4_5_invalidate_core_regs(target_t *target);

Copied: branches/openocd-0.1/src/target/board/imx27ads.cfg (from rev 1324, trunk/src/target/board/imx27ads.cfg)

Copied: branches/openocd-0.1/src/target/board/imx31pdk.cfg (from rev 1324, trunk/src/target/board/imx31pdk.cfg)

Copied: branches/openocd-0.1/src/target/board/pic-p32mx.cfg (from rev 1324, trunk/src/target/board/pic-p32mx.cfg)

Copied: branches/openocd-0.1/src/target/board/x300t.cfg (from rev 1324, trunk/src/target/board/x300t.cfg)

Modified: branches/openocd-0.1/src/target/breakpoints.c
===================================================================
--- branches/openocd_1_0_branch/src/target/breakpoints.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/breakpoints.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -238,8 +238,6 @@
 	free(watchpoint);
 }
 
-
-
 void watchpoint_remove(target_t *target, u32 address)
 {
 	watchpoint_t *watchpoint = target-&gt;watchpoints;
@@ -263,7 +261,6 @@
 	}
 }
 
-
 void watchpoint_clear_target(target_t *target)
 {
 	watchpoint_t *watchpoint;

Modified: branches/openocd-0.1/src/target/breakpoints.h
===================================================================
--- branches/openocd_1_0_branch/src/target/breakpoints.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/breakpoints.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -69,4 +69,3 @@
 extern void watchpoint_clear_target(struct target_s *target);
 
 #endif /* BREAKPOINTS_H */
-

Modified: branches/openocd-0.1/src/target/cortex_m3.c
===================================================================
--- branches/openocd_1_0_branch/src/target/cortex_m3.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/cortex_m3.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -740,7 +740,7 @@
 	 * when srst is asserted the luminary device seesm to also clear the debug registers
 	 * which does not match the armv7 debug TRM */
 		
-	if (strcmp(cortex_m3-&gt;variant, &quot;lm3s&quot;) == 0)
+	if (strcmp(target-&gt;variant, &quot;lm3s&quot;) == 0)
 	{
 		/* get revision of lm3s target, only early silicon has this issue
 		 * Fury Rev B, DustDevil Rev B, Tempest all ok */
@@ -1407,7 +1407,7 @@
 		/* Setup FPB */
 		target_read_u32(target, FP_CTRL, &amp;fpcr);
 		cortex_m3-&gt;auto_bp_type = 1;
-		cortex_m3-&gt;fp_num_code = (fpcr &gt;&gt; 8) &amp; 0x70 | (fpcr &gt;&gt; 4) &amp; 0xF; /* bits [14:12] and [7:4] */
+		cortex_m3-&gt;fp_num_code = ((fpcr &gt;&gt; 8) &amp; 0x70) | ((fpcr &gt;&gt; 4) &amp; 0xF); /* bits [14:12] and [7:4] */
 		cortex_m3-&gt;fp_num_lit = (fpcr &gt;&gt; 8) &amp; 0xF;
 		cortex_m3-&gt;fp_code_available = cortex_m3-&gt;fp_num_code;
 		cortex_m3-&gt;fp_comparator_list = calloc(cortex_m3-&gt;fp_num_code + cortex_m3-&gt;fp_num_lit, sizeof(cortex_m3_fp_comparator_t));
@@ -1517,7 +1517,7 @@
 	return ERROR_OK;
 }
 
-int cortex_m3_init_arch_info(target_t *target, cortex_m3_common_t *cortex_m3, jtag_tap_t *tap, const char *variant)
+int cortex_m3_init_arch_info(target_t *target, cortex_m3_common_t *cortex_m3, jtag_tap_t *tap)
 {
 	armv7m_common_t *armv7m;
 	armv7m = &amp;cortex_m3-&gt;armv7m;
@@ -1545,15 +1545,6 @@
 	armv7m-&gt;pre_restore_context = NULL;
 	armv7m-&gt;post_restore_context = NULL;
 	
-	if (variant)
-	{
-		cortex_m3-&gt;variant = strdup(variant);
-	}
-	else
-	{
-		cortex_m3-&gt;variant = strdup(&quot;&quot;);
-	}
-	
 	armv7m_init_arch_info(target, armv7m);	
 	armv7m-&gt;arch_info = cortex_m3;
 	armv7m-&gt;load_core_reg_u32 = cortex_m3_load_core_reg_u32;
@@ -1568,7 +1559,7 @@
 {
 	cortex_m3_common_t *cortex_m3 = calloc(1,sizeof(cortex_m3_common_t));
 	
-	cortex_m3_init_arch_info(target, cortex_m3, target-&gt;tap, target-&gt;variant);
+	cortex_m3_init_arch_info(target, cortex_m3, target-&gt;tap);
 	
 	return ERROR_OK;
 }

Modified: branches/openocd-0.1/src/target/cortex_m3.h
===================================================================
--- branches/openocd_1_0_branch/src/target/cortex_m3.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/cortex_m3.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -138,7 +138,6 @@
 {
 	int common_magic;
 	arm_jtag_t jtag_info;
-	char *variant;
 	
 	/* Context information */
 	u32 dcb_dhcsr;
@@ -190,6 +189,6 @@
 int cortex_m3_remove_watchpoint(struct target_s *target, watchpoint_t *watchpoint);
 
 extern int cortex_m3_register_commands(struct command_context_s *cmd_ctx);
-extern int cortex_m3_init_arch_info(target_t *target, cortex_m3_common_t *cortex_m3, jtag_tap_t *tap, const char *variant);
+extern int cortex_m3_init_arch_info(target_t *target, cortex_m3_common_t *cortex_m3, jtag_tap_t *tap);
 
 #endif /* CORTEX_M3_H */

Modified: branches/openocd-0.1/src/target/cortex_swjdp.h
===================================================================
--- branches/openocd_1_0_branch/src/target/cortex_swjdp.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/cortex_swjdp.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -33,9 +33,9 @@
 #define DPAP_WRITE		0
 #define DPAP_READ		1
 #define DP_ZERO			0
-#define DP_CTRL_STAT    0x4
-#define DP_SELECT       0x8
-#define DP_RDBUFF       0xC
+#define DP_CTRL_STAT	0x4
+#define DP_SELECT		0x8
+#define DP_RDBUFF		0xC
 
 #define CORUNDETECT		(1&lt;&lt;0)
 #define SSTICKYORUN		(1&lt;&lt;1)

Modified: branches/openocd-0.1/src/target/embeddedice.h
===================================================================
--- branches/openocd_1_0_branch/src/target/embeddedice.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/embeddedice.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -129,5 +129,4 @@
 
 void embeddedice_write_dcc(jtag_tap_t *tap, int reg_addr, u8 *buffer, int little, int count);
 
-
 #endif /* EMBEDDED_ICE_H */

Modified: branches/openocd-0.1/src/target/etb.h
===================================================================
--- branches/openocd_1_0_branch/src/target/etb.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/etb.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -31,15 +31,15 @@
 /* ETB registers */
 enum
 {
-    ETB_ID = 0x00,
-    ETB_RAM_DEPTH = 0x01,
-    ETB_RAM_WIDTH = 0x02,
-    ETB_STATUS = 0x03,
-    ETB_RAM_DATA = 0x04,
-    ETB_RAM_READ_POINTER = 0x05,
-    ETB_RAM_WRITE_POINTER = 0x06,
-    ETB_TRIGGER_COUNTER = 0x07,
-    ETB_CTRL = 0x08,
+	ETB_ID = 0x00,
+	ETB_RAM_DEPTH = 0x01,
+	ETB_RAM_WIDTH = 0x02,
+	ETB_STATUS = 0x03,
+	ETB_RAM_DATA = 0x04,
+	ETB_RAM_READ_POINTER = 0x05,
+	ETB_RAM_WRITE_POINTER = 0x06,
+	ETB_TRIGGER_COUNTER = 0x07,
+	ETB_CTRL = 0x08,
 };
 
 typedef struct etb_s

Modified: branches/openocd-0.1/src/target/feroceon.c
===================================================================
--- branches/openocd_1_0_branch/src/target/feroceon.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/feroceon.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -645,7 +645,7 @@
 	arm7_9_common_t *arm7_9;
 	arm926ejs_common_t *arm926ejs = calloc(1,sizeof(arm926ejs_common_t));
 
-	arm926ejs_init_arch_info(target, arm926ejs, target-&gt;tap, target-&gt;variant);
+	arm926ejs_init_arch_info(target, arm926ejs, target-&gt;tap);
 
 	armv4_5 = target-&gt;arch_info;
 	arm7_9 = armv4_5-&gt;arch_info;
@@ -684,7 +684,6 @@
 	return ERROR_OK;
 }
 
-
 int feroceon_examine(struct target_s *target)
 {
 	armv4_5_common_t *armv4_5;

Modified: branches/openocd-0.1/src/target/image.c
===================================================================
--- branches/openocd_1_0_branch/src/target/image.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/image.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -83,15 +83,15 @@
 		LOG_DEBUG(&quot;ELF image detected.&quot;);
 		image-&gt;type = IMAGE_ELF;
 	}
-	else if  ((buffer[0]==':') /* record start byte */
-	        &amp;&amp;(isxdigit(buffer[1]))
-	        &amp;&amp;(isxdigit(buffer[2]))
-	        &amp;&amp;(isxdigit(buffer[3]))
-	        &amp;&amp;(isxdigit(buffer[4]))
-	        &amp;&amp;(isxdigit(buffer[5]))
-	        &amp;&amp;(isxdigit(buffer[6]))
-	        &amp;&amp;(buffer[7]=='0') /* record type : 00 -&gt; 05 */
-	        &amp;&amp;(buffer[8]&gt;='0')&amp;&amp;(buffer[8]&lt;'6'))
+	else if ((buffer[0]==':') /* record start byte */
+		&amp;&amp;(isxdigit(buffer[1]))
+		&amp;&amp;(isxdigit(buffer[2]))
+		&amp;&amp;(isxdigit(buffer[3]))
+		&amp;&amp;(isxdigit(buffer[4]))
+		&amp;&amp;(isxdigit(buffer[5]))
+		&amp;&amp;(isxdigit(buffer[6]))
+		&amp;&amp;(buffer[7]=='0') /* record type : 00 -&gt; 05 */
+		&amp;&amp;(buffer[8]&gt;='0')&amp;&amp;(buffer[8]&lt;'6'))
 	{
 		LOG_DEBUG(&quot;IHEX image detected.&quot;);
 		image-&gt;type = IMAGE_IHEX;
@@ -381,7 +381,6 @@
 		return ERROR_IMAGE_FORMAT_ERROR;
 	}
 
-
 	elf-&gt;endianness = elf-&gt;header-&gt;e_ident[EI_DATA];
 	if ((elf-&gt;endianness!=ELFDATA2LSB)
 		 &amp;&amp;(elf-&gt;endianness!=ELFDATA2MSB))
@@ -1042,5 +1041,3 @@
 	*checksum = crc;
 	return ERROR_OK;
 }
-
-

Modified: branches/openocd-0.1/src/target/image.h
===================================================================
--- branches/openocd_1_0_branch/src/target/image.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/image.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -44,12 +44,12 @@
 
 typedef enum image_type
 {
-    IMAGE_BINARY,	/* plain binary */
-    IMAGE_IHEX,		/* intel hex-record format */
-    IMAGE_MEMORY,	/* target-memory pseudo-image */
-    IMAGE_ELF,		/* ELF binary */
-    IMAGE_SRECORD,	/* motorola s19 */
-    IMAGE_BUILDER,	/* when building a new image */
+	IMAGE_BINARY,	/* plain binary */
+	IMAGE_IHEX,		/* intel hex-record format */
+	IMAGE_MEMORY,	/* target-memory pseudo-image */
+	IMAGE_ELF,		/* ELF binary */
+	IMAGE_SRECORD,	/* motorola s19 */
+	IMAGE_BUILDER,	/* when building a new image */
 } image_type_t;
 
 typedef struct image_section_s

Copied: branches/openocd-0.1/src/target/interface/parport_dlc5.cfg (from rev 1324, trunk/src/target/interface/parport_dlc5.cfg)

Copied: branches/openocd-0.1/src/target/interface/rlink.cfg (from rev 1324, trunk/src/target/interface/rlink.cfg)

Modified: branches/openocd-0.1/src/target/mips32.c
===================================================================
--- branches/openocd_1_0_branch/src/target/mips32.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips32.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -85,18 +85,16 @@
 	{37, NULL, NULL},
 };
 
-u8 mips32_gdb_dummy_fsr_value[] = {0, 0, 0, 0};
+/* number of mips dummy fp regs fp0 - fp31 + fsr and fir
+ * we also add 18 unknown registers to handle gdb requests */
 
-reg_t mips32_gdb_dummy_fsr_reg =
-{
-	&quot;GDB dummy floating-point status register&quot;, mips32_gdb_dummy_fsr_value, 0, 1, 32, NULL, 0, NULL, 0
-};
+#define MIPS32NUMFPREGS 34 + 18
 
-u8 mips32_gdb_dummy_fir_value[] = {0, 0, 0, 0};
+u8 mips32_gdb_dummy_fp_value[] = {0, 0, 0, 0};
 
-reg_t mips32_gdb_dummy_fir_reg =
+reg_t mips32_gdb_dummy_fp_reg =
 {
-	&quot;GDB dummy floating-point register&quot;, mips32_gdb_dummy_fir_value, 0, 1, 32, NULL, 0, NULL, 0
+	&quot;GDB dummy floating-point register&quot;, mips32_gdb_dummy_fp_value, 0, 1, 32, NULL, 0, NULL, 0
 };
 
 int mips32_core_reg_arch_type = -1;
@@ -198,8 +196,8 @@
 	mips32_common_t *mips32 = target-&gt;arch_info;
 	int i;
 	
-	/* include fsr/fir reg */
-	*reg_list_size = MIPS32NUMCOREREGS + 2;
+	/* include floating point registers */
+	*reg_list_size = MIPS32NUMCOREREGS + MIPS32NUMFPREGS;
 	*reg_list = malloc(sizeof(reg_t*) * (*reg_list_size));
 	
 	for (i = 0; i &lt; MIPS32NUMCOREREGS; i++)
@@ -208,9 +206,11 @@
 	}
 	
 	/* add dummy floating points regs */
-	(*reg_list)[38] = &amp;mips32_gdb_dummy_fsr_reg;
-	(*reg_list)[39] = &amp;mips32_gdb_dummy_fir_reg;
-	
+	for (i = MIPS32NUMCOREREGS; i &lt; (MIPS32NUMCOREREGS + MIPS32NUMFPREGS); i++)
+	{
+		(*reg_list)[i] = &amp;mips32_gdb_dummy_fp_reg;
+	}
+
 	return ERROR_OK;
 }
 
@@ -290,8 +290,7 @@
 	if (mips32_core_reg_arch_type == -1)
 		mips32_core_reg_arch_type = register_reg_arch_type(mips32_get_core_reg, mips32_set_core_reg);
 
-	register_init_dummy(&amp;mips32_gdb_dummy_fsr_reg);
-	register_init_dummy(&amp;mips32_gdb_dummy_fir_reg);
+	register_init_dummy(&amp;mips32_gdb_dummy_fp_reg);
 
 	/* Build the process context cache */ 
 	cache-&gt;name = &quot;mips32 registers&quot;;
@@ -320,7 +319,7 @@
 	return cache;
 }
 
-int mips32_init_arch_info(target_t *target, mips32_common_t *mips32, jtag_tap_t *tap, const char *variant)
+int mips32_init_arch_info(target_t *target, mips32_common_t *mips32, jtag_tap_t *tap)
 {
 	target-&gt;arch_info = mips32;
 	mips32-&gt;common_magic = MIPS32_COMMON_MAGIC;

Modified: branches/openocd-0.1/src/target/mips32.h
===================================================================
--- branches/openocd_1_0_branch/src/target/mips32.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips32.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -116,10 +116,14 @@
 #define MIPS32_SB(reg, off, base)	MIPS32_I_INST(MIPS32_OP_SB, base, reg, off)
 #define MIPS32_SH(reg, off, base)	MIPS32_I_INST(MIPS32_OP_SH, base, reg, off)
 #define MIPS32_SW(reg, off, base)	MIPS32_I_INST(MIPS32_OP_SW, base, reg, off)
+
+/* ejtag specific instructions */
 #define MIPS32_DRET					0x4200001F
+#define MIPS32_SDBBP				0x7000003F
+#define MIPS16_SDBBP 				0xE801
 
 extern int mips32_arch_state(struct target_s *target);
-extern int mips32_init_arch_info(target_t *target, mips32_common_t *mips32, jtag_tap_t *tap, const char *variant);
+extern int mips32_init_arch_info(target_t *target, mips32_common_t *mips32, jtag_tap_t *tap);
 extern int mips32_restore_context(target_t *target);
 extern int mips32_save_context(target_t *target);
 extern reg_cache_t *mips32_build_reg_cache(target_t *target);

Modified: branches/openocd-0.1/src/target/mips32_dmaacc.c
===================================================================
--- branches/openocd_1_0_branch/src/target/mips32_dmaacc.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips32_dmaacc.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -182,7 +182,7 @@
 		return ERROR_JTAG_DEVICE_ERROR;
 	}
 
-	// Handle the bigendian/littleendian
+	/* Handle the bigendian/littleendian */
 	switch (addr &amp; 0x3) {
 		case 0:
 			*data = v &amp; 0xff;

Modified: branches/openocd-0.1/src/target/mips32_dmaacc.h
===================================================================
--- branches/openocd_1_0_branch/src/target/mips32_dmaacc.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips32_dmaacc.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -27,10 +27,10 @@
 
 #include &quot;mips_ejtag.h&quot;
 
-#define EJTAG_CTRL_DMA_BYTE        0x00000000
-#define EJTAG_CTRL_DMA_HALFWORD    0x00000080
-#define EJTAG_CTRL_DMA_WORD        0x00000100
-#define EJTAG_CTRL_DMA_TRIPLEBYTE  0x00000180
+#define EJTAG_CTRL_DMA_BYTE			0x00000000
+#define EJTAG_CTRL_DMA_HALFWORD		0x00000080
+#define EJTAG_CTRL_DMA_WORD			0x00000100
+#define EJTAG_CTRL_DMA_TRIPLEBYTE	0x00000180
 
 #define RETRY_ATTEMPTS	0
 
@@ -45,9 +45,4 @@
 extern int mips32_dmaacc_write_mem16(mips_ejtag_t *ejtag_info, u32 addr, int count, u16 *buf);
 extern int mips32_dmaacc_write_mem32(mips_ejtag_t *ejtag_info, u32 addr, int count, u32 *buf);
 
-#if 0
-extern int mips32_dmaacc_read_regs(mips_ejtag_t *ejtag_info, u32 *regs);
-extern int mips32_dmaacc_write_regs(mips_ejtag_t *ejtag_info, u32 *regs);
 #endif
-
-#endif

Modified: branches/openocd-0.1/src/target/mips32_pracc.c
===================================================================
--- branches/openocd_1_0_branch/src/target/mips32_pracc.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips32_pracc.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -218,7 +218,10 @@
 		case 2:
 			return mips32_pracc_read_mem16(ejtag_info, addr, count, (u16*)buf);
 		case 4:
-			return mips32_pracc_read_mem32(ejtag_info, addr, count, (u32*)buf);
+			if(count==1)
+				return mips32_pracc_read_u32(ejtag_info, addr, (u32*)buf);
+			else
+				return mips32_pracc_read_mem32(ejtag_info, addr, count, (u32*)buf);
 	}
 	
 	return ERROR_OK;
@@ -247,8 +250,8 @@
 		MIPS32_BEQ(0,10,9),									/* beq 0, $10, end */
 		MIPS32_NOP,
 		
-		MIPS32_LW(12,0,9), 									/* lw $12,0($9), Load $12 with the word @mem[$9] */
-		MIPS32_SW(12,0,11), 								/* sw $12,0($11) */
+		MIPS32_LW(8,0,9), 									/* lw $8,0($9), Load $8 with the word @mem[$9] */
+		MIPS32_SW(8,0,11), 									/* sw $8,0($11) */
 		
 		MIPS32_ADDI(10,10,NEG16(1)), 						/* $10-- */
 		MIPS32_ADDI(9,9,4), 								/* $1+=4 */
@@ -298,6 +301,47 @@
 	return retval;
 }
 
+int mips32_pracc_read_u32(mips_ejtag_t *ejtag_info, u32 addr, u32 *buf)
+{
+	u32 code[] = {
+															/* start: */
+		MIPS32_MTC0(15,31,0),								/* move $15 to COP0 DeSave */
+		MIPS32_LUI(15,UPPER16(MIPS32_PRACC_STACK)), 		/* $15 = MIPS32_PRACC_STACK */
+		MIPS32_ORI(15,15,LOWER16(MIPS32_PRACC_STACK)),
+		MIPS32_SW(8,0,15), 									/* sw $8,($15) */
+		MIPS32_SW(9,0,15), 									/* sw $9,($15) */
+
+		MIPS32_LUI(8,UPPER16(MIPS32_PRACC_PARAM_IN)),		/* $8 = MIPS32_PRACC_PARAM_IN */
+		MIPS32_ORI(8,8,LOWER16(MIPS32_PRACC_PARAM_IN)),
+		MIPS32_LW(8,0,8),									/* $8=mem[$8]; read addr */
+		MIPS32_LUI(9,UPPER16(MIPS32_PRACC_PARAM_OUT)), 		/* $9=MIPS32_PRACC_PARAM_OUT */
+		MIPS32_ORI(9,9,LOWER16(MIPS32_PRACC_PARAM_OUT)),
+
+		MIPS32_LW(8,0,8), 									/* lw $8,0($8), Load $8 with the word @mem[$8] */
+		MIPS32_SW(8,0,9), 									/* sw $8,0($9) */
+
+		MIPS32_LW(9,0,15), 									/* lw $9,($15) */
+		MIPS32_LW(8,0,15), 									/* lw $8,($15) */
+		MIPS32_MFC0(15,31,0),								/* move COP0 DeSave to $15 */
+		MIPS32_NOP,
+		MIPS32_B(NEG16(17)),								/* b start */
+		MIPS32_NOP,
+	};
+
+	int retval = ERROR_OK;
+	u32 param_in[1];
+
+	param_in[0] = addr;
+
+	if ((retval = mips32_pracc_exec(ejtag_info, sizeof(code)/sizeof(code[0]), code, 
+		sizeof(param_in)/sizeof(param_in[0]), param_in, sizeof(u32), buf, 1)) != ERROR_OK)
+	{
+		return retval;
+	}
+
+	return retval;
+}
+
 int mips32_pracc_read_mem16(mips_ejtag_t *ejtag_info, u32 addr, int count, u16 *buf)
 {
 	u32 code[] = {
@@ -321,8 +365,8 @@
 		MIPS32_BEQ(0,10,9), 								/* beq 0, $10, end */
 		MIPS32_NOP,
 		
-		MIPS32_LHU(12,0,9), 								/* lw $12,0($9), Load $12 with the halfword @mem[$9] */
-		MIPS32_SW(12,0,11), 								/* sw $12,0($11) */
+		MIPS32_LHU(8,0,9), 									/* lw $8,0($9), Load $8 with the halfword @mem[$9] */
+		MIPS32_SW(8,0,11), 									/* sw $8,0($11) */
 		
 		MIPS32_ADDI(10,10,NEG16(1)), 						/* $10-- */
 		MIPS32_ADDI(9,9,2), 								/* $9+=2 */
@@ -400,8 +444,8 @@
 		MIPS32_BEQ(0,10,9), 								/* beq 0, $10, end */
 		MIPS32_NOP,
 		
-		MIPS32_LBU(12,0,9), 								/* lw $12,0($9), Load t4 with the byte @mem[t1] */
-		MIPS32_SW(12,0,11), 								/* sw $12,0($11) */
+		MIPS32_LBU(8,0,9), 									/* lw $8,0($9), Load t4 with the byte @mem[t1] */
+		MIPS32_SW(8,0,11), 									/* sw $8,0($11) */
 		
 		MIPS32_ADDI(10,10,NEG16(1)), 						/* $10-- */
 		MIPS32_ADDI(9,9,1), 								/* $9+=1 */
@@ -465,7 +509,10 @@
 		case 2:
 			return mips32_pracc_write_mem16(ejtag_info, addr, count,(u16*)buf);
 		case 4:
-			return mips32_pracc_write_mem32(ejtag_info, addr, count, (u32*)buf);
+			if(count==1)
+				return mips32_pracc_write_u32(ejtag_info, addr, (u32*)buf);
+			else
+				return mips32_pracc_write_mem32(ejtag_info, addr, count, (u32*)buf);
 	}
 	
 	return ERROR_OK;
@@ -526,6 +573,42 @@
 	return ERROR_OK;
 }
 
+int mips32_pracc_write_u32(mips_ejtag_t *ejtag_info, u32 addr, u32 *buf)
+{
+	u32 code[] = {
+															/* start: */
+		MIPS32_MTC0(15,31,0),								/* move $15 to COP0 DeSave */
+		MIPS32_LUI(15,UPPER16(MIPS32_PRACC_STACK)), 		/* $15 = MIPS32_PRACC_STACK */
+		MIPS32_ORI(15,15,LOWER16(MIPS32_PRACC_STACK)),
+		MIPS32_SW(8,0,15), 									/* sw $8,($15) */
+		MIPS32_SW(9,0,15), 									/* sw $9,($15) */
+
+		MIPS32_LUI(8,UPPER16((MIPS32_PRACC_PARAM_IN+4))), 	/* $8 = MIPS32_PRACC_PARAM_IN+4 */
+		MIPS32_ORI(8,8,LOWER16((MIPS32_PRACC_PARAM_IN+4))),
+		MIPS32_LW(9,NEG16(4),8), 							/* Load write addr to $9 */
+
+		MIPS32_LW(8,0,8), 									/* lw $8,0($8), Load $8 with the word @mem[$8] */
+		MIPS32_SW(8,0,9), 									/* sw $8,0($9) */
+
+		MIPS32_LW(9,0,15), 									/* lw $9,($15) */
+		MIPS32_LW(8,0,15), 									/* lw $8,($15) */
+		MIPS32_MFC0(15,31,0),								/* move COP0 DeSave to $15 */
+		MIPS32_NOP,
+		MIPS32_B(NEG16(15)),								/* b start */
+		MIPS32_NOP,
+	};
+
+	/* TODO remove array */
+	u32 param_in[1+1];
+	param_in[0] = addr;
+	param_in[1] = *buf;
+
+	mips32_pracc_exec(ejtag_info, sizeof(code)/sizeof(code[0]), code, \
+		sizeof(param_in)/sizeof(param_in[0]),param_in, 0, NULL, 1);
+
+	return ERROR_OK;
+}
+
 int mips32_pracc_write_mem16(mips_ejtag_t *ejtag_info, u32 addr, int count, u16 *buf)
 {
 	u32 code[] = {

Modified: branches/openocd-0.1/src/target/mips32_pracc.h
===================================================================
--- branches/openocd_1_0_branch/src/target/mips32_pracc.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips32_pracc.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -34,7 +34,7 @@
 #define UPPER16(u32) (u32 &gt;&gt; 16)
 #define LOWER16(u32) (u32 &amp; 0xFFFF)
 #define NEG16(v) (((~(v)) + 1) &amp; 0xFFFF)
-//#define NEG18(v) ( ((~(v)) + 1) &amp; 0x3FFFF )
+/*#define NEG18(v) ( ((~(v)) + 1) &amp; 0x3FFFF )*/
 
 extern int mips32_pracc_read_mem(mips_ejtag_t *ejtag_info, u32 addr, int size, int count, void *buf);
 extern int mips32_pracc_write_mem(mips_ejtag_t *ejtag_info, u32 addr, int size, int count, void *buf);
@@ -42,10 +42,12 @@
 extern int mips32_pracc_read_mem8(mips_ejtag_t *ejtag_info, u32 addr, int count, u8 *buf);
 extern int mips32_pracc_read_mem16(mips_ejtag_t *ejtag_info, u32 addr, int count, u16 *buf);
 extern int mips32_pracc_read_mem32(mips_ejtag_t *ejtag_info, u32 addr, int count, u32 *buf);
+extern int mips32_pracc_read_u32(mips_ejtag_t *ejtag_info, u32 addr, u32 *buf);
 
 extern int mips32_pracc_write_mem8(mips_ejtag_t *ejtag_info, u32 addr, int count, u8 *buf);
 extern int mips32_pracc_write_mem16(mips_ejtag_t *ejtag_info, u32 addr, int count, u16 *buf);
 extern int mips32_pracc_write_mem32(mips_ejtag_t *ejtag_info, u32 addr, int count, u32 *buf);
+extern int mips32_pracc_write_u32(mips_ejtag_t *ejtag_info, u32 addr, u32 *buf);
 
 extern int mips32_pracc_read_regs(mips_ejtag_t *ejtag_info, u32 *regs);
 extern int mips32_pracc_write_regs(mips_ejtag_t *ejtag_info, u32 *regs);

Modified: branches/openocd-0.1/src/target/mips_ejtag.c
===================================================================
--- branches/openocd_1_0_branch/src/target/mips_ejtag.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips_ejtag.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -144,6 +144,8 @@
 		return retval;
 	}
 
+	keep_alive();
+
 	return ERROR_OK;
 }
 

Modified: branches/openocd-0.1/src/target/mips_ejtag.h
===================================================================
--- branches/openocd_1_0_branch/src/target/mips_ejtag.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips_ejtag.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -102,6 +102,7 @@
 {
 	jtag_tap_t *tap;
 	u32 impcode;
+	u32 idcode;
 	/*int use_dma;*/
 	u32 ejtag_ctrl;
 } mips_ejtag_t;

Modified: branches/openocd-0.1/src/target/mips_m4k.c
===================================================================
--- branches/openocd_1_0_branch/src/target/mips_m4k.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips_m4k.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -50,6 +50,7 @@
 int mips_m4k_examine(struct target_s *target);
 int mips_m4k_assert_reset(target_t *target);
 int mips_m4k_deassert_reset(target_t *target);
+int mips_m4k_checksum_memory(target_t *target, u32 address, u32 size, u32 *checksum);
 
 target_type_t mips_m4k_target =
 {
@@ -73,7 +74,7 @@
 	.read_memory = mips_m4k_read_memory,
 	.write_memory = mips_m4k_write_memory,
 	.bulk_write_memory = mips_m4k_bulk_write_memory,
-	.checksum_memory = NULL,
+	.checksum_memory = mips_m4k_checksum_memory,
 	.blank_check_memory = NULL,
 
 	.run_algorithm = mips32_run_algorithm,
@@ -265,7 +266,6 @@
 {
 	mips32_common_t *mips32 = target-&gt;arch_info;
 	mips_ejtag_t *ejtag_info = &amp;mips32-&gt;ejtag_info;
-	mips_m4k_common_t *mips_m4k = mips32-&gt;arch_info;
 
 	LOG_DEBUG(&quot;target-&gt;state: %s&quot;,
 		Jim_Nvp_value2name_simple( nvp_target_state, target-&gt;state )-&gt;name);
@@ -288,7 +288,7 @@
 		mips_ejtag_set_instr(ejtag_info, EJTAG_INST_NORMALBOOT, NULL);
 	}
 
-	if (strcmp(mips_m4k-&gt;variant, &quot;ejtag_srst&quot;) == 0)
+	if (strcmp(target-&gt;variant, &quot;ejtag_srst&quot;) == 0)
 	{
 		u32 ejtag_ctrl = ejtag_info-&gt;ejtag_ctrl | EJTAG_CTRL_PRRST | EJTAG_CTRL_PERRST;
 		LOG_DEBUG(&quot;Using EJTAG reset (PRRST) to reset processor...&quot;);
@@ -490,7 +490,8 @@
 {
 	mips32_common_t *mips32 = target-&gt;arch_info;
 	mips32_comparator_t * comparator_list = mips32-&gt;inst_break_list;
-
+	int retval;
+	
 	if (breakpoint-&gt;set)
 	{
 		LOG_WARNING(&quot;breakpoint already set&quot;);
@@ -519,7 +520,54 @@
 	}
 	else if (breakpoint-&gt;type == BKPT_SOFT)
 	{
-
+		if (breakpoint-&gt;length == 4)
+		{
+			u32 verify = 0xffffffff;
+			
+			if((retval = target-&gt;type-&gt;read_memory(target, breakpoint-&gt;address, breakpoint-&gt;length, 1, breakpoint-&gt;orig_instr)) != ERROR_OK)
+			{
+				return retval;
+			}
+			if ((retval = target_write_u32(target, breakpoint-&gt;address, MIPS32_SDBBP)) != ERROR_OK)
+			{
+				return retval;
+			}
+			
+			if ((retval = target_read_u32(target, breakpoint-&gt;address, &amp;verify)) != ERROR_OK)
+			{
+				return retval;
+			}
+			if (verify != MIPS32_SDBBP)
+			{
+				LOG_ERROR(&quot;Unable to set 32bit breakpoint at address %08x - check that memory is read/writable&quot;, breakpoint-&gt;address);
+				return ERROR_OK;
+			}
+		}
+		else
+		{
+			u16 verify = 0xffff;
+			
+			if((retval = target-&gt;type-&gt;read_memory(target, breakpoint-&gt;address, breakpoint-&gt;length, 1, breakpoint-&gt;orig_instr)) != ERROR_OK)
+			{
+				return retval;
+			}
+			if ((retval = target_write_u16(target, breakpoint-&gt;address, MIPS16_SDBBP)) != ERROR_OK)
+			{
+				return retval;
+			}
+			
+			if ((retval = target_read_u16(target, breakpoint-&gt;address, &amp;verify)) != ERROR_OK)
+			{
+				return retval;
+			}
+			if (verify != MIPS16_SDBBP)
+			{
+				LOG_ERROR(&quot;Unable to set 16bit breakpoint at address %08x - check that memory is read/writable&quot;, breakpoint-&gt;address);
+				return ERROR_OK;
+			}
+		}
+		
+		breakpoint-&gt;set = 20; /* Any nice value but 0 */
 	}
 
 	return ERROR_OK;
@@ -530,7 +578,8 @@
 	/* get pointers to arch-specific information */
 	mips32_common_t *mips32 = target-&gt;arch_info;
 	mips32_comparator_t * comparator_list = mips32-&gt;inst_break_list;
-
+	int retval;
+	
 	if (!breakpoint-&gt;set)
 	{
 		LOG_WARNING(&quot;breakpoint not set&quot;);
@@ -551,7 +600,42 @@
 	}
 	else
 	{
-
+		/* restore original instruction (kept in target endianness) */
+		if (breakpoint-&gt;length == 4)
+		{
+			u32 current_instr;
+			
+			/* check that user program has not modified breakpoint instruction */
+			if ((retval = target-&gt;type-&gt;read_memory(target, breakpoint-&gt;address, 4, 1, (u8*)&amp;current_instr)) != ERROR_OK)
+			{
+				return retval;
+			}
+			if (current_instr == MIPS32_SDBBP)
+			{
+				if((retval = target-&gt;type-&gt;write_memory(target, breakpoint-&gt;address, 4, 1, breakpoint-&gt;orig_instr)) != ERROR_OK)
+				{
+					return retval;
+				}
+			}
+		}
+		else
+		{
+			u16 current_instr;
+			
+			/* check that user program has not modified breakpoint instruction */
+			if ((retval = target-&gt;type-&gt;read_memory(target, breakpoint-&gt;address, 2, 1, (u8*)&amp;current_instr)) != ERROR_OK)
+			{
+				return retval;
+			}
+			
+			if (current_instr == MIPS16_SDBBP)
+			{
+				if((retval = target-&gt;type-&gt;write_memory(target, breakpoint-&gt;address, 2, 1, breakpoint-&gt;orig_instr)) != ERROR_OK)
+				{
+					return retval;
+				}
+			}
+		}
 	}
 	breakpoint-&gt;set = 0;
 
@@ -562,16 +646,17 @@
 {
 	mips32_common_t *mips32 = target-&gt;arch_info;
 
-	if (mips32-&gt;num_inst_bpoints_avail &lt; 1)
+	if (breakpoint-&gt;type == BKPT_HARD)
 	{
-		LOG_INFO(&quot;no hardware breakpoint available&quot;);
-		return ERROR_TARGET_RESOURCE_NOT_AVAILABLE;
-	}
+		if (mips32-&gt;num_inst_bpoints_avail &lt; 1)
+		{
+			LOG_INFO(&quot;no hardware breakpoint available&quot;);
+			return ERROR_TARGET_RESOURCE_NOT_AVAILABLE;
+		}
+		
+		mips32-&gt;num_inst_bpoints_avail--;
+	}	
 
-	/* default to hardware for now */
-	breakpoint-&gt;type = BKPT_HARD;
-
-	mips32-&gt;num_inst_bpoints_avail--;
 	mips_m4k_set_breakpoint(target, breakpoint);
 
 	return ERROR_OK;
@@ -735,23 +820,14 @@
 	return ERROR_OK;
 }
 
-int mips_m4k_init_arch_info(target_t *target, mips_m4k_common_t *mips_m4k, jtag_tap_t *tap, const char *variant)
+int mips_m4k_init_arch_info(target_t *target, mips_m4k_common_t *mips_m4k, jtag_tap_t *tap)
 {
 	mips32_common_t *mips32 = &amp;mips_m4k-&gt;mips32_common;
 
-	if (variant)
-	{
-		mips_m4k-&gt;variant = strdup(variant);
-	}
-	else
-	{
-		mips_m4k-&gt;variant = strdup(&quot;&quot;);
-	}
-
 	mips_m4k-&gt;common_magic = MIPSM4K_COMMON_MAGIC;
 
 	/* initialize mips4k specific info */
-	mips32_init_arch_info(target, mips32, tap, variant);
+	mips32_init_arch_info(target, mips32, tap);
 	mips32-&gt;arch_info = mips_m4k;
 
 	return ERROR_OK;
@@ -761,7 +837,7 @@
 {
 	mips_m4k_common_t *mips_m4k = calloc(1,sizeof(mips_m4k_common_t));
 
-	mips_m4k_init_arch_info(target, mips_m4k, target-&gt;tap, target-&gt;variant);
+	mips_m4k_init_arch_info(target, mips_m4k, target-&gt;tap);
 
 	return ERROR_OK;
 }
@@ -776,7 +852,8 @@
 	if (!target-&gt;type-&gt;examined)
 	{
 		mips_ejtag_get_idcode(ejtag_info, &amp;idcode, NULL);
-
+		ejtag_info-&gt;idcode = idcode;
+		
 		if (((idcode &gt;&gt; 1) &amp; 0x7FF) == 0x29)
 		{
 			/* we are using a pic32mx so select ejtag port
@@ -800,3 +877,8 @@
 {
 	return mips_m4k_write_memory(target, address, 4, count, buffer);
 }
+
+int mips_m4k_checksum_memory(target_t *target, u32 address, u32 size, u32 *checksum)
+{
+	return ERROR_FAIL; /* use bulk read method */
+}

Modified: branches/openocd-0.1/src/target/mips_m4k.h
===================================================================
--- branches/openocd_1_0_branch/src/target/mips_m4k.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/mips_m4k.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -32,8 +32,6 @@
 {
 	int common_magic;
 	mips32_common_t mips32_common;
-	
-	char *variant;
 } mips_m4k_common_t;
 
 extern int mips_m4k_bulk_write_memory(target_t *target, u32 address, u32 count, u8 *buffer);

Modified: branches/openocd-0.1/src/target/oocd_trace.c
===================================================================
--- branches/openocd_1_0_branch/src/target/oocd_trace.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/oocd_trace.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -61,19 +61,19 @@
 
 int oocd_trace_write_reg(oocd_trace_t *oocd_trace, int reg, u32 value)
 {
-    size_t bytes_written;
-    u8 data[5];
+	size_t bytes_written;
+	u8 data[5];
 
-    data[0] = 0x18 | (reg &amp; 0x7);
-    data[1] = value &amp; 0xff;
-    data[2] = (value &amp; 0xff00) &gt;&gt; 8;
-    data[3] = (value &amp; 0xff0000) &gt;&gt; 16;
-    data[4] = (value &amp; 0xff000000) &gt;&gt; 24;
+	data[0] = 0x18 | (reg &amp; 0x7);
+	data[1] = value &amp; 0xff;
+	data[2] = (value &amp; 0xff00) &gt;&gt; 8;
+	data[3] = (value &amp; 0xff0000) &gt;&gt; 16;
+	data[4] = (value &amp; 0xff000000) &gt;&gt; 24;
 
-    bytes_written = write(oocd_trace-&gt;tty_fd, data, 5);
-    LOG_DEBUG(&quot;reg #%i: 0x%8.8x\n&quot;, reg, value);
+	bytes_written = write(oocd_trace-&gt;tty_fd, data, 5);
+	LOG_DEBUG(&quot;reg #%i: 0x%8.8x\n&quot;, reg, value);
 
-    return ERROR_OK;
+	return ERROR_OK;
 }
 
 int oocd_trace_read_memory(oocd_trace_t *oocd_trace, u8 *data, u32 address, u32 size)
@@ -143,7 +143,7 @@
 	 * read up any leftover characters to ensure communication is in sync */
 	while ((bytes_read = read(oocd_trace-&gt;tty_fd, trash, sizeof(trash))) &gt; 0)
 	{
-	    LOG_DEBUG(&quot;%i bytes read\n&quot;, bytes_read);
+		LOG_DEBUG(&quot;%i bytes read\n&quot;, bytes_read);
 	};
 	
 	return ERROR_OK;
@@ -190,8 +190,8 @@
 	u8 *trace_data;
 	int i;
 
-    oocd_trace_read_reg(oocd_trace, OOCD_TRACE_STATUS, &amp;status);
-    oocd_trace_read_reg(oocd_trace, OOCD_TRACE_ADDRESS, &amp;address);
+	oocd_trace_read_reg(oocd_trace, OOCD_TRACE_STATUS, &amp;status);
+	oocd_trace_read_reg(oocd_trace, OOCD_TRACE_ADDRESS, &amp;address);
 
 	/* check if we overflowed, and adjust first frame of the trace accordingly
 	 * if we didn't overflow, read only up to the frame that would be written next,

Modified: branches/openocd-0.1/src/target/oocd_trace.h
===================================================================
--- branches/openocd_1_0_branch/src/target/oocd_trace.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/oocd_trace.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -30,12 +30,12 @@
 /* registers */
 enum
 {
-    OOCD_TRACE_ID = 0x7,
-    OOCD_TRACE_ADDRESS = 0x0,
-    OOCD_TRACE_TRIGGER_COUNTER = 0x01,
-    OOCD_TRACE_CONTROL = 0x2,
-    OOCD_TRACE_STATUS = 0x3,
-    OOCD_TRACE_SDRAM_COUNTER = 0x4,
+	OOCD_TRACE_ID = 0x7,
+	OOCD_TRACE_ADDRESS = 0x0,
+	OOCD_TRACE_TRIGGER_COUNTER = 0x01,
+	OOCD_TRACE_CONTROL = 0x2,
+	OOCD_TRACE_STATUS = 0x3,
+	OOCD_TRACE_SDRAM_COUNTER = 0x4,
 };
 
 /* commands */

Modified: branches/openocd-0.1/src/target/register.c
===================================================================
--- branches/openocd_1_0_branch/src/target/register.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/register.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -107,8 +107,6 @@
 	return NULL;
 }
 
-
-
 static int register_get_dummy_core_reg(reg_t *reg)
 {
 	return ERROR_OK;

Modified: branches/openocd-0.1/src/target/register.h
===================================================================
--- branches/openocd_1_0_branch/src/target/register.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/register.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -70,4 +70,3 @@
 extern void register_init_dummy(reg_t *reg);
 
 #endif /* REGISTER_H */
-

Modified: branches/openocd-0.1/src/target/target/imx31.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/imx31.cfg	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/target/imx31.cfg	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,7 +1,8 @@
 # imx31 config
 #
-# NB! Does not work yet. Work in progress
 
+reset_config trst_and_srst
+
 if { [info exists CHIPNAME] } {	
    set  _CHIPNAME $CHIPNAME    
 } else {	 
@@ -17,19 +18,24 @@
 if { [info exists CPUTAPID ] } {
    set _CPUTAPID $CPUTAPID
 } else {
-  # force an error till we get a good number
-   set _CPUTAPID 0xffffffff
+   set _CPUTAPID 0x07b3601d
 }
 
+if { [info exists SDMATAPID ] } {
+   set _SDMATAPID $SDMATAPID
+} else {
+   set _SDMATAPID 0x2190101d
+}
+
 #========================================
 # The &quot;system jtag controller&quot; 
 # IMX31 reference manual, page 6-28 - figure 6-14
 if { [info exists SJCTAPID ] } {
    set _SJCTAPID $SJCTAPID
 } else {
-   set _SJCTAPID 0xffffffff
+   set _SJCTAPID 0x2b900f0f
 }
-jtag newtap $_CHIPNAME sjc -irlen 4 -ircapture 00 irmask 0x0 -expected-id $_SJCTAPID
+jtag newtap $_CHIPNAME sjc -irlen 4 -ircapture 0x0 -irmask 0x0 -expected-id $_SJCTAPID
 
 # The &quot;SDMA&quot; - &lt;S&gt;mart &lt;DMA&gt; controller debug tap
 # Based on some IO pins - this can be disabled &amp; removed
@@ -38,28 +44,19 @@
 #    SJC_MOD - controls multiplexer - disables ARM1136
 #    SDMA_BYPASS - disables SDMA    - 
 #  
-if { [info exists SDMATAPID ] } {
-   set _SDMATAPID $SDMATAPID
-} else {
-   set _SDMATAPID 0xffffffff
-}
-# Per section 40.17.1, table 40-85 the IR register is 4 bits
-# But this conflicts with Diagram 6-13, &quot;3bits ir and drs&quot;
-jtag newtap $_CHIPNAME smda -irlen 4 -ircapture 0xe -irmask 0xf -expected-id $_SJCTAPID
-
-# The ARM11 core tap
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-   set _CPUTAPID 0xffffffff
-}
 # Per ARM: DDI0211J_arm1136_r1p5_trm.pdf - the ARM 1136 as a 5 bit IR register
-jtag newtap $_CHIPNAME cpu -irlen 5 -ircapture 0x1e irmask 0x1f -expected-id $_SJCTAPID
+jtag newtap $_CHIPNAME cpu -irlen 5 -ircapture 0x1 -irmask 0x1f -expected-id $_CPUTAPID
 
+# No IDCODE for this TAP
+jtag newtap $_CHIPNAME whatchacallit -irlen 4 -ircapture 0 -irmask 0xf -expected-id 0x0
 
-jtag_nsrst_delay 500
-jtag_ntrst_delay 500
+# Per section 40.17.1, table 40-85 the IR register is 4 bits
+# But this conflicts with Diagram 6-13, &quot;3bits ir and drs&quot;
+jtag newtap $_CHIPNAME smda -irlen 5 -ircapture 0x1 -irmask 0x1f -expected-id $_SDMATAPID
 
 set _TARGETNAME [format &quot;%s.cpu&quot; $_CHIPNAME]
 target create $_TARGETNAME arm11 -endian $_ENDIAN -chain-position $_TARGETNAME
- 
+
+
+proc power_restore {} { puts &quot;Sensed power restore. No action.&quot; } 
+proc srst_deasserted {} { puts &quot;Sensed nSRST deasserted. No action.&quot; }

Modified: branches/openocd-0.1/src/target/target/pic32mx.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/pic32mx.cfg	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/target/pic32mx.cfg	2009-01-16 06:43:11 UTC (rev 1325)
@@ -15,7 +15,7 @@
    set _CPUTAPID $CPUTAPID
 } else {
   # force an error till we get a good number
-   set _CPUTAPID 0xffffffff
+   set _CPUTAPID 0x30938053
 }
 
 jtag_nsrst_delay 100
@@ -26,13 +26,15 @@
 
 #jtag scan chain
 #format L IRC IRCM IDCODE (Length, IR Capture, IR Capture Mask, IDCODE)
-jtag newtap $_CPUNAME cpu -irlen 5  -ircapture 0x1 -irmask 0x1 -expected-id $_CPUTAPID
+jtag newtap $_CHIPNAME cpu -irlen 5  -ircapture 0x1 -irmask 0x1f -expected-id $_CPUTAPID
 
 set _TARGETNAME [format &quot;%s.cpu&quot; $_CHIPNAME]
 target create $_TARGETNAME mips_m4k -endian $_ENDIAN -chain-position $_TARGETNAME
 
 $_TARGETNAME configure -work-area-virt 0 -work-area-phys 0xa0000000 -work-area-size 16384 -work-area-backup 0
 
+flash bank pic32mx 0xbd000000 0 0 0 0
+flash bank pic32mx 0xbfc00000 0 0 0 0
 
 # For more information about the configuration files, take a look at:
 # openocd.texi

Deleted: branches/openocd-0.1/src/target/target/s3c2440.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/s3c2440.cfg	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/target/s3c2440.cfg	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,37 +0,0 @@
-# Target configuration for the Samsung 2440 system on chip
-# Tested on a S3C2440 Evaluation board
-# Processor       : ARM920Tid(wb) rev 0 (v4l)
-# Info:   JTAG device found: 0x0032409d (Manufacturer: 0x04e, Part: 0x0324, Version: 0x0)
-# [Duane Ellis 27/nov/2008: Above 0x0032409d appears to be copy/paste from other places]
-# [and I do not believe it to be accurate, hence the 0xffffffff below]
-
-if { [info exists CHIPNAME] } {	
-   set  _CHIPNAME $CHIPNAME    
-} else {	 
-   set  _CHIPNAME s3c2440
-}
-
-if { [info exists ENDIAN] } {	
-   set  _ENDIAN $ENDIAN    
-} else {	 
-  # this defaults to a bigendian
-   set  _ENDIAN little
-}
-
-if { [info exists CPUTAPID ] } {
-   set _CPUTAPID $CPUTAPID
-} else {
-  # force an error till we get a good number
-   set _CPUTAPID 0xFFFFFFFF
-}
-
-#jtag scan chain
-jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
-
-set _TARGETNAME [format &quot;%s.cpu&quot; $_CHIPNAME]
-target create $_TARGETNAME arm920t -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm920t
-$_TARGETNAME configure -work-area-virt 0 -work-area-phys 0x200000 -work-area-size 0x4000 -work-area-backup 1
-
-#reset configuration
-reset_config trst_and_srst
-

Copied: branches/openocd-0.1/src/target/target/samsung_s3c2440.cfg (from rev 1324, trunk/src/target/target/samsung_s3c2440.cfg)

Copied: branches/openocd-0.1/src/target/target/smp8634.cfg (from rev 1324, trunk/src/target/target/smp8634.cfg)

Modified: branches/openocd-0.1/src/target/target/str710.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/str710.cfg	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/target/str710.cfg	2009-01-16 06:43:11 UTC (rev 1325)
@@ -24,7 +24,7 @@
 
 #jtag scan chain
 
-tag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
 
 set _TARGETNAME [format &quot;%s.cpu&quot; $_CHIPNAME]
 target create $_TARGETNAME arm7tdmi -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm7tdmi

Modified: branches/openocd-0.1/src/target/target/str730.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/str730.cfg	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/target/str730.cfg	2009-01-16 06:43:11 UTC (rev 1325)
@@ -25,7 +25,7 @@
 reset_config trst_and_srst srst_pulls_trst
 
 #jtag scan chain
-tag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
 
 #jtag nTRST and nSRST delay
 jtag_nsrst_delay 500

Modified: branches/openocd-0.1/src/target/target/str750.cfg
===================================================================
--- branches/openocd_1_0_branch/src/target/target/str750.cfg	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/target/str750.cfg	2009-01-16 06:43:11 UTC (rev 1325)
@@ -27,7 +27,7 @@
 
 #jtag scan chain
 
-tag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
+jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
 
 #jtag nTRST and nSRST delay
 jtag_nsrst_delay 500

Modified: branches/openocd-0.1/src/target/target.c
===================================================================
--- branches/openocd_1_0_branch/src/target/target.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/target.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -61,7 +61,6 @@
 
 int cli_target_callback_event_handler(struct target_s *target, enum target_event event, void *priv);
 
-
 int handle_targets_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 
 int handle_reg_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
@@ -83,6 +82,9 @@
 int handle_rwp_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 int handle_virt2phys_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc);
 int handle_profile_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+int handle_fast_load_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+int handle_fast_load_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+
 static int jim_array2mem(Jim_Interp *interp, int argc, Jim_Obj *const *argv);
 static int jim_mem2array(Jim_Interp *interp, int argc, Jim_Obj *const *argv);
 static int jim_target( Jim_Interp *interp, int argc, Jim_Obj *const *argv);
@@ -90,8 +92,6 @@
 static int target_array2mem(Jim_Interp *interp, target_t *target, int argc, Jim_Obj *const *argv);
 static int target_mem2array(Jim_Interp *interp, target_t *target, int argc, Jim_Obj *const *argv);
 
-
-
 /* targets */
 extern target_type_t arm7tdmi_target;
 extern target_type_t arm720t_target;
@@ -166,18 +166,15 @@
 	{ .value = TARGET_EVENT_OLD_gdb_program_config , .name = &quot;old-gdb_program_config&quot; },
 	{ .value = TARGET_EVENT_OLD_pre_resume         , .name = &quot;old-pre_resume&quot; },
 
-
 	{ .value = TARGET_EVENT_EARLY_HALTED, .name = &quot;early-halted&quot; },
 	{ .value = TARGET_EVENT_HALTED, .name = &quot;halted&quot; },
 	{ .value = TARGET_EVENT_RESUMED, .name = &quot;resumed&quot; },
 	{ .value = TARGET_EVENT_RESUME_START, .name = &quot;resume-start&quot; },
 	{ .value = TARGET_EVENT_RESUME_END, .name = &quot;resume-end&quot; },
 
-
 	{ .name = &quot;gdb-start&quot;, .value = TARGET_EVENT_GDB_START },
 	{ .name = &quot;gdb-end&quot;, .value = TARGET_EVENT_GDB_END },
 
-
 	/* historical name */
 
 	{ .value = TARGET_EVENT_RESET_START, .name = &quot;reset-start&quot; },
@@ -193,21 +190,15 @@
 	{ .value = TARGET_EVENT_RESET_INIT , .name = &quot;reset-init&quot; },
 	{ .value = TARGET_EVENT_RESET_END, .name = &quot;reset-end&quot; },
 
-
-
-
-
 	{ .value = TARGET_EVENT_EXAMINE_START, .name = &quot;examine-start&quot; },
 	{ .value = TARGET_EVENT_EXAMINE_END, .name = &quot;examine-end&quot; },
 
-
 	{ .value = TARGET_EVENT_DEBUG_HALTED, .name = &quot;debug-halted&quot; },
 	{ .value = TARGET_EVENT_DEBUG_RESUMED, .name = &quot;debug-resumed&quot; },
 
 	{ .value = TARGET_EVENT_GDB_ATTACH, .name = &quot;gdb-attach&quot; },
 	{ .value = TARGET_EVENT_GDB_DETACH, .name = &quot;gdb-detach&quot; },
 
-
 	{ .value = TARGET_EVENT_GDB_FLASH_WRITE_START, .name = &quot;gdb-flash-write-start&quot; },
 	{ .value = TARGET_EVENT_GDB_FLASH_WRITE_END  , .name = &quot;gdb-flash-write-end&quot;   },
 
@@ -230,7 +221,6 @@
 	{ .name = NULL, .value = -1 },
 };
 
-
 const Jim_Nvp nvp_target_debug_reason [] = {
 	{ .name = &quot;debug-request&quot;            , .value = DBG_REASON_DBGRQ },
 	{ .name = &quot;breakpoint&quot;               , .value = DBG_REASON_BREAKPOINT },
@@ -242,12 +232,11 @@
 	{ .name = NULL, .value = -1 },
 };
 
-
 const Jim_Nvp nvp_target_endian[] = {
 	{ .name = &quot;big&quot;,    .value = TARGET_BIG_ENDIAN },
 	{ .name = &quot;little&quot;, .value = TARGET_LITTLE_ENDIAN },
 	{ .name = &quot;be&quot;,     .value = TARGET_BIG_ENDIAN },
-        { .name = &quot;le&quot;,     .value = TARGET_LITTLE_ENDIAN },
+	{ .name = &quot;le&quot;,     .value = TARGET_LITTLE_ENDIAN },
 	{ .name = NULL,     .value = -1 },
 };
 
@@ -259,8 +248,7 @@
 	{ .name = NULL     , .value = -1 },
 };
 
-static int
-max_target_number( void )
+static int max_target_number(void)
 {
 	target_t *t;
 	int x;
@@ -277,8 +265,7 @@
 }
 
 /* determine the number of the new target */
-static int
-new_target_number( void )
+static int new_target_number(void)
 {
 	target_t *t;
 	int x;
@@ -378,7 +365,6 @@
 	return target;
 }
 
-
 int target_poll(struct target_s *target)
 {
 	/* We can't poll until after examine */
@@ -422,7 +408,6 @@
 	return retval;
 }
 
-
 int target_process_reset(struct command_context_s *cmd_ctx, enum target_reset_mode reset_mode)
 {
 	char buf[100];
@@ -448,7 +433,6 @@
 	return retval;
 }
 
-
 static int default_virt2phys(struct target_s *target, u32 virtual, u32 *physical)
 {
 	*physical = virtual;
@@ -467,7 +451,6 @@
 	return ERROR_OK;
 }
 
-
 /* Targets that correctly implement init+examine, i.e.
  * no communication with target during init:
  *
@@ -563,7 +546,6 @@
 		target-&gt;type-&gt;run_algorithm_imp = target-&gt;type-&gt;run_algorithm;
 		target-&gt;type-&gt;run_algorithm = target_run_algorithm_imp;
 
-
 		if (target-&gt;type-&gt;mmu == NULL)
 		{
 			target-&gt;type-&gt;mmu = default_mmu;
@@ -709,7 +691,6 @@
 		target_call_event_callbacks(target, TARGET_EVENT_EARLY_HALTED);
 	}
 
-
 	LOG_DEBUG(&quot;target event %i (%s)&quot;,
 			  event,
 			  Jim_Nvp_value2name_simple( nvp_target_event, event )-&gt;name );
@@ -948,6 +929,14 @@
 	register_command(cmd_ctx, NULL, &quot;virt2phys&quot;, handle_virt2phys_command, COMMAND_ANY, &quot;translate a virtual address into a physical address&quot;);
 	register_command(cmd_ctx, NULL, &quot;profile&quot;, handle_profile_command, COMMAND_EXEC, &quot;profiling samples the CPU PC&quot;);
 
+	register_command(cmd_ctx, NULL, &quot;fast_load_image&quot;, handle_fast_load_image_command, COMMAND_ANY,
+			&quot;same args as load_image, image stored in memory - mainly for profiling purposes&quot;);
+
+	register_command(cmd_ctx, NULL, &quot;fast_load&quot;, handle_fast_load_command, COMMAND_ANY,
+			&quot;loads active fast load image to current target - mainly for profiling purposes&quot;);
+
+
+
 	register_jim(cmd_ctx, &quot;target&quot;, jim_target, &quot;configure target&quot; );
 
 
@@ -1051,7 +1040,6 @@
 	return ERROR_OK;
 }
 
-
 /* Single aligned words are guaranteed to use 16 or 32 bit access
  * mode respectively, otherwise data is handled as quickly as
  * possible
@@ -1347,7 +1335,6 @@
 	if((retval = trace_register_commands(cmd_ctx)) != ERROR_OK)
 		return retval;
 
-
 	return retval;
 }
 
@@ -1387,7 +1374,7 @@
 	}
 DumpTargets:
 
-  target = all_targets;
+	target = all_targets;
 	command_print(cmd_ctx, &quot;    CmdName    Type       Endian     AbsChainPos Name          State     &quot;);
 	command_print(cmd_ctx, &quot;--  ---------- ---------- ---------- ----------- ------------- ----------&quot;);
 	while (target)
@@ -1407,8 +1394,7 @@
 	return ERROR_OK;
 }
 
-// every 300ms we check for reset &amp; powerdropout and issue a &quot;reset halt&quot; if
-// so.
+/* every 300ms we check for reset &amp; powerdropout and issue a &quot;reset halt&quot; if so. */
 
 static int powerDropout;
 static int srstAsserted;
@@ -1476,7 +1462,6 @@
 	return ERROR_OK;
 }
 
-
 /* process target state changes */
 int handle_target(void *priv)
 {
@@ -1546,7 +1531,6 @@
 		target = target-&gt;next;
 	}
 
-
 	return retval;
 }
 
@@ -1661,7 +1645,6 @@
 	return ERROR_OK;
 }
 
-
 int handle_poll_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
 	int retval = ERROR_OK;
@@ -1694,7 +1677,6 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-
 	return retval;
 }
 
@@ -1739,14 +1721,14 @@
 		{
 			once=0;
 			LOG_DEBUG(&quot;waiting for target %s...&quot;,
-			      Jim_Nvp_value2name_simple(nvp_target_state,state)-&gt;name);
+				Jim_Nvp_value2name_simple(nvp_target_state,state)-&gt;name);
 		}
 
 		gettimeofday(&amp;now, NULL);
 		if ((now.tv_sec &gt; timeout.tv_sec) || ((now.tv_sec == timeout.tv_sec) &amp;&amp; (now.tv_usec &gt;= timeout.tv_usec)))
 		{
 			LOG_ERROR(&quot;timed out while waiting for target %s&quot;,
-			      Jim_Nvp_value2name_simple(nvp_target_state,state)-&gt;name);
+				Jim_Nvp_value2name_simple(nvp_target_state,state)-&gt;name);
 			return ERROR_FAIL;
 		}
 	}
@@ -1858,7 +1840,6 @@
 
 	address = strtoul(args[0], NULL, 0);
 
-
 	switch (cmd[2])
 	{
 		case 'w':
@@ -2025,7 +2006,6 @@
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-
 	duration_start_measure(&amp;duration);
 
 	if (image_open(&amp;image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
@@ -2053,7 +2033,6 @@
 		u32 offset=0;
 		u32 length=buf_cnt;
 
-
 		/* DANGER!!! beware of unsigned comparision here!!! */
 
 		if ((image.sections[i].base_address+buf_cnt&gt;=min_address)&amp;&amp;
@@ -2470,6 +2449,7 @@
 	}
 	return retval;
 }
+
 static void writeLong(FILE *f, int l)
 {
 	int i;
@@ -2480,14 +2460,13 @@
 	}
 
 }
+
 static void writeString(FILE *f, char *s)
 {
 	fwrite(s, 1, strlen(s), f);
 }
 
-
-
-// Dump a gmon.out histogram file.
+/* Dump a gmon.out histogram file. */
 static void writeGmon(u32 *samples, int sampleNum, char *filename)
 {
 	int i;
@@ -2495,14 +2474,14 @@
 	if (f==NULL)
 		return;
 	fwrite(&quot;gmon&quot;, 1, 4, f);
-	writeLong(f, 0x00000001); // Version
-	writeLong(f, 0); // padding
-	writeLong(f, 0); // padding
-	writeLong(f, 0); // padding
+	writeLong(f, 0x00000001); /* Version */
+	writeLong(f, 0); /* padding */
+	writeLong(f, 0); /* padding */
+	writeLong(f, 0); /* padding */
 
-	fwrite(&quot;&quot;, 1, 1, f);  // GMON_TAG_TIME_HIST
+	fwrite(&quot;&quot;, 1, 1, f);  /* GMON_TAG_TIME_HIST */
 
-	// figure out bucket size
+	/* figure out bucket size */
 	u32 min=samples[0];
 	u32 max=samples[0];
 	for (i=0; i&lt;sampleNum; i++)
@@ -2519,7 +2498,7 @@
 
 	int addressSpace=(max-min+1);
 
-	static int const maxBuckets=256*1024; // maximum buckets.
+	static int const maxBuckets=256*1024; /* maximum buckets. */
 	int length=addressSpace;
 	if (length &gt; maxBuckets)
 	{
@@ -2538,23 +2517,23 @@
 		long long a=address-min;
 		long long b=length-1;
 		long long c=addressSpace-1;
-		int index=(a*b)/c; // danger!!!! int32 overflows
+		int index=(a*b)/c; /* danger!!!! int32 overflows */
 		buckets[index]++;
 	}
 
-	//			   append binary memory gmon.out &amp;profile_hist_hdr ((char*)&amp;profile_hist_hdr + sizeof(struct gmon_hist_hdr))
-	writeLong(f, min); 					// low_pc
-	writeLong(f, max);		// high_pc
-	writeLong(f, length);		// # of samples
-	writeLong(f, 64000000); 			// 64MHz
+	/* append binary memory gmon.out &amp;profile_hist_hdr ((char*)&amp;profile_hist_hdr + sizeof(struct gmon_hist_hdr)) */
+	writeLong(f, min); 			/* low_pc */
+	writeLong(f, max);			/* high_pc */
+	writeLong(f, length);		/* # of samples */
+	writeLong(f, 64000000); 	/* 64MHz */
 	writeString(f, &quot;seconds&quot;);
 	for (i=0; i&lt;(15-strlen(&quot;seconds&quot;)); i++)
 	{
-		fwrite(&quot;&quot;, 1, 1, f);  // padding
+		fwrite(&quot;&quot;, 1, 1, f);	/* padding */
 	}
 	writeString(f, &quot;s&quot;);
 
-//			   append binary memory gmon.out profile_hist_data (profile_hist_data + profile_hist_hdr.hist_size)
+	/*append binary memory gmon.out profile_hist_data (profile_hist_data + profile_hist_hdr.hist_size) */
 
 	char *data=malloc(2*length);
 	if (data!=NULL)
@@ -2608,7 +2587,7 @@
 
 	int numSamples=0;
 	int retval=ERROR_OK;
-	// hopefully it is safe to cache! We want to stop/restart as quickly as possible.
+	/* hopefully it is safe to cache! We want to stop/restart as quickly as possible. */
 	reg_t *reg = register_get_by_name(target-&gt;reg_cache, &quot;pc&quot;, 1);
 
 	for (;;)
@@ -2620,10 +2599,10 @@
 			samples[numSamples++]=t;
 			retval = target_resume(target, 1, 0, 0, 0); /* current pc, addr = 0, do not handle breakpoints, not debugging */
 			target_poll(target);
-			alive_sleep(10); // sleep 10ms, i.e. &lt;100 samples/second.
+			alive_sleep(10); /* sleep 10ms, i.e. &lt;100 samples/second. */
 		} else if (target-&gt;state == TARGET_RUNNING)
 		{
-			// We want to quickly sample the PC.
+			/* We want to quickly sample the PC. */
 			if((retval = target_halt(target)) != ERROR_OK)
 			{
 				free(samples);
@@ -2898,7 +2877,6 @@
 	return target_array2mem( interp,target, argc, argv );
 }
 
-
 static int target_array2mem(Jim_Interp *interp, target_t *target, int argc, Jim_Obj *const *argv)
 {
 	long l;
@@ -2983,7 +2961,6 @@
 		return JIM_ERR;
 	}
 
-
 	/* Transfer loop */
 
 	/* index counter */
@@ -3031,15 +3008,13 @@
 	return JIM_OK;
 }
 
-void
-target_all_handle_event( enum target_event e )
+void target_all_handle_event( enum target_event e )
 {
 	target_t *target;
 
-
 	LOG_DEBUG( &quot;**all*targets: event: %d, %s&quot;,
-		   e,
-		   Jim_Nvp_value2name_simple( nvp_target_event, e )-&gt;name );
+			e,
+			Jim_Nvp_value2name_simple( nvp_target_event, e )-&gt;name );
 
 	target = all_targets;
 	while (target){
@@ -3048,8 +3023,7 @@
 	}
 }
 
-void
-target_handle_event( target_t *target, enum target_event e )
+void target_handle_event( target_t *target, enum target_event e )
 {
 	target_event_action_t *teap;
 	int done;
@@ -3093,7 +3067,6 @@
 	TCFG_CHAIN_POSITION,
 };
 
-
 static Jim_Nvp nvp_config_opts[] = {
 	{ .name = &quot;-type&quot;,             .value = TCFG_TYPE },
 	{ .name = &quot;-event&quot;,            .value = TCFG_EVENT },
@@ -3108,10 +3081,7 @@
 	{ .name = NULL, .value = -1 }
 };
 
-
-static int
-target_configure( Jim_GetOptInfo *goi,
-				  target_t *target )
+static int target_configure( Jim_GetOptInfo *goi, target_t *target )
 {
 	Jim_Nvp *n;
 	Jim_Obj *o;
@@ -3119,11 +3089,10 @@
 	char *cp;
 	int e;
 
-
 	/* parse config or cget options ... */
 	while( goi-&gt;argc &gt; 0 ){
 		Jim_SetEmptyResult( goi-&gt;interp );
-		//Jim_GetOpt_Debug( goi );
+		/* Jim_GetOpt_Debug( goi ); */
 
 		if( target-&gt;type-&gt;target_jim_configure ){
 			/* target defines a configure function */
@@ -3184,7 +3153,6 @@
 				}
 			}
 
-
 			{
 				target_event_action_t *teap;
 
@@ -3377,12 +3345,8 @@
 	return JIM_OK;
 }
 
-
 /** this is the 'tcl' handler for the target specific command */
-static int
-tcl_target_func( Jim_Interp *interp,
-				 int argc,
-				 Jim_Obj *const *argv )
+static int tcl_target_func( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
 {
 	Jim_GetOptInfo goi;
 	jim_wide a,b,c;
@@ -3393,7 +3357,6 @@
 	struct command_context_s *cmd_ctx;
 	int e;
 
-
 	enum {
 		TS_CMD_CONFIGURE,
 		TS_CMD_CGET,
@@ -3436,7 +3399,6 @@
 		{ .name = NULL, .value = -1 },
 	};
 
-
 	/* go past the &quot;command&quot; */
 	Jim_GetOpt_Setup( &amp;goi, interp, argc-1, argv+1 );
 
@@ -3449,7 +3411,7 @@
 		Jim_GetOpt_NvpUnknown( &amp;goi, target_options, 0 );
 		return e;
 	}
-	// Assume blank result
+	/* Assume blank result */
 	Jim_SetEmptyResult( goi.interp );
 
 	switch( n-&gt;value ){
@@ -3680,17 +3642,17 @@
 			Jim_GetOpt_NvpUnknown( &amp;goi, nvp_assert, 1 );
 			return e;
 		}
-		// the halt or not param
+		/* the halt or not param */
 		e = Jim_GetOpt_Wide( &amp;goi, &amp;a);
 		if( e != JIM_OK ){
 			return e;
 		}
-		// determine if we should halt or not.
+		/* determine if we should halt or not. */
 		target-&gt;reset_halt = !!a;
-		// When this happens - all workareas are invalid.
+		/* When this happens - all workareas are invalid. */
 		target_free_all_working_areas_restore(target, 0);
 
-		// do the assert
+		/* do the assert */
 		if( n-&gt;value == NVP_ASSERT ){
 			target-&gt;type-&gt;assert_reset( target );
 		} else {
@@ -3705,7 +3667,7 @@
 		target-&gt;type-&gt;halt( target );
 		return JIM_OK;
 	case TS_CMD_WAITSTATE:
-		// params:  &lt;name&gt;  statename timeoutmsecs
+		/* params:  &lt;name&gt;  statename timeoutmsecs */
 		if( goi.argc != 2 ){
 			Jim_SetResult_sprintf( goi.interp, &quot;%s STATENAME TIMEOUTMSECS&quot;, n-&gt;name );
 			return JIM_ERR;
@@ -3725,7 +3687,7 @@
 								   &quot;target: %s wait %s fails (%d) %s&quot;,
 								   target-&gt;cmd_name,
 								   n-&gt;name,
-					       e, target_strerror_safe(e) );
+								   e, target_strerror_safe(e) );
 			return JIM_ERR;
 		} else {
 			return JIM_OK;
@@ -3776,11 +3738,8 @@
 	return JIM_ERR;
 }
 
-
-static int
-target_create( Jim_GetOptInfo *goi )
+static int target_create( Jim_GetOptInfo *goi )
 {
-
 	Jim_Obj *new_cmd;
 	Jim_Cmd *cmd;
 	const char *cp;
@@ -3834,7 +3793,6 @@
 		return JIM_ERR;
 	}
 
-
 	/* Create it */
 	target = calloc(1,sizeof(target_t));
 	/* set target number */
@@ -3892,6 +3850,10 @@
 		target-&gt;endianness = TARGET_LITTLE_ENDIAN;
 	}
 
+	/* incase variant is not set */
+	if (!target-&gt;variant)
+		target-&gt;variant = strdup(&quot;&quot;);
+
 	/* create the target specific commands */
 	if( target-&gt;type-&gt;register_commands ){
 		(*(target-&gt;type-&gt;register_commands))( cmd_ctx );
@@ -3924,8 +3886,7 @@
 	return e;
 }
 
-static int
-jim_target( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
+static int jim_target( Jim_Interp *interp, int argc, Jim_Obj *const *argv )
 {
 	int x,r,e;
 	jim_wide w;
@@ -3944,7 +3905,7 @@
 	const char *target_cmds[] = {
 		&quot;create&quot;, &quot;types&quot;, &quot;names&quot;, &quot;current&quot;, &quot;number&quot;,
 		&quot;count&quot;,
-		NULL // terminate
+		NULL /* terminate */
 	};
 
 	LOG_DEBUG(&quot;Target command params:&quot;);
@@ -3959,7 +3920,7 @@
 		return JIM_ERR;
 	}
 
-	//Jim_GetOpt_Debug( &amp;goi );
+	/* Jim_GetOpt_Debug( &amp;goi ); */
 	r = Jim_GetOpt_Enum( &amp;goi, target_cmds, &amp;x   );
 	if( r != JIM_OK ){
 		return r;
@@ -4040,3 +4001,196 @@
 
 	return JIM_ERR;
 }
+
+
+struct FastLoad
+{
+	u32 address;
+	u8 *data;
+	int length;
+
+};
+
+static int fastload_num;
+static struct FastLoad *fastload;
+
+static void free_fastload(void)
+{
+	if (fastload!=NULL)
+	{
+		int i;
+		for (i=0; i&lt;fastload_num; i++)
+		{
+			if (fastload[i].data)
+				free(fastload[i].data);
+		}
+		free(fastload);
+		fastload=NULL;
+	}
+}
+
+
+
+
+int handle_fast_load_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	u8 *buffer;
+	u32 buf_cnt;
+	u32 image_size;
+	u32 min_address=0;
+	u32 max_address=0xffffffff;
+	int i;
+	int retval;
+
+	image_t image;
+
+	duration_t duration;
+	char *duration_text;
+
+	if ((argc &lt; 1)||(argc &gt; 5))
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+
+	/* a base address isn't always necessary, default to 0x0 (i.e. don't relocate) */
+	if (argc &gt;= 2)
+	{
+		image.base_address_set = 1;
+		image.base_address = strtoul(args[1], NULL, 0);
+	}
+	else
+	{
+		image.base_address_set = 0;
+	}
+
+
+	image.start_address_set = 0;
+
+	if (argc&gt;=4)
+	{
+		min_address=strtoul(args[3], NULL, 0);
+	}
+	if (argc&gt;=5)
+	{
+		max_address=strtoul(args[4], NULL, 0)+min_address;
+	}
+
+	if (min_address&gt;max_address)
+	{
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	}
+
+	duration_start_measure(&amp;duration);
+
+	if (image_open(&amp;image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	{
+		return ERROR_OK;
+	}
+
+	image_size = 0x0;
+	retval = ERROR_OK;
+	fastload_num=image.num_sections;
+	fastload=(struct FastLoad *)malloc(sizeof(struct FastLoad)*image.num_sections);
+	if (fastload==NULL)
+	{
+		image_close(&amp;image);
+		return ERROR_FAIL;
+	}
+	memset(fastload, 0, sizeof(struct FastLoad)*image.num_sections);
+	for (i = 0; i &lt; image.num_sections; i++)
+	{
+		buffer = malloc(image.sections[i].size);
+		if (buffer == NULL)
+		{
+			command_print(cmd_ctx, &quot;error allocating buffer for section (%d bytes)&quot;, image.sections[i].size);
+			break;
+		}
+
+		if ((retval = image_read_section(&amp;image, i, 0x0, image.sections[i].size, buffer, &amp;buf_cnt)) != ERROR_OK)
+		{
+			free(buffer);
+			break;
+		}
+
+		u32 offset=0;
+		u32 length=buf_cnt;
+
+
+		/* DANGER!!! beware of unsigned comparision here!!! */
+
+		if ((image.sections[i].base_address+buf_cnt&gt;=min_address)&amp;&amp;
+				(image.sections[i].base_address&lt;max_address))
+		{
+			if (image.sections[i].base_address&lt;min_address)
+			{
+				/* clip addresses below */
+				offset+=min_address-image.sections[i].base_address;
+				length-=offset;
+			}
+
+			if (image.sections[i].base_address+buf_cnt&gt;max_address)
+			{
+				length-=(image.sections[i].base_address+buf_cnt)-max_address;
+			}
+
+			fastload[i].address=image.sections[i].base_address+offset;
+			fastload[i].data=malloc(length);
+			if (fastload[i].data==NULL)
+			{
+				free(buffer);
+				break;
+			}
+			memcpy(fastload[i].data, buffer+offset, length);
+			fastload[i].length=length;
+
+			image_size += length;
+			command_print(cmd_ctx, &quot;%u byte written at address 0x%8.8x&quot;, length, image.sections[i].base_address+offset);
+		}
+
+		free(buffer);
+	}
+
+	duration_stop_measure(&amp;duration, &amp;duration_text);
+	if (retval==ERROR_OK)
+	{
+		command_print(cmd_ctx, &quot;Loaded %u bytes in %s&quot;, image_size, duration_text);
+		command_print(cmd_ctx, &quot;NB!!! image has not been loaded to target, issue a subsequent 'fast_load' to do so.&quot;);
+	}
+	free(duration_text);
+
+	image_close(&amp;image);
+
+	if (retval!=ERROR_OK)
+	{
+		free_fastload();
+	}
+
+	return retval;
+}
+
+int handle_fast_load_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+{
+	if (argc&gt;0)
+		return ERROR_COMMAND_SYNTAX_ERROR;
+	if (fastload==NULL)
+	{
+		LOG_ERROR(&quot;No image in memory&quot;);
+		return ERROR_FAIL;
+	}
+	int i;
+	int ms=timeval_ms();
+	int size=0;
+	for (i=0; i&lt;fastload_num;i++)
+	{
+		int retval;
+		target_t *target = get_current_target(cmd_ctx);
+		if ((retval = target_write_buffer(target, fastload[i].address, fastload[i].length, fastload[i].data)) != ERROR_OK)
+		{
+			return retval;
+		}
+		size+=fastload[i].length;
+	}
+	int after=timeval_ms();
+	command_print(cmd_ctx, &quot;Loaded image %f kBytes/s&quot;, (float)(size/1024.0)/((float)(after-ms)/1000.0));
+	return ERROR_OK;
+}

Modified: branches/openocd-0.1/src/target/target.h
===================================================================
--- branches/openocd_1_0_branch/src/target/target.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/target.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -40,15 +40,15 @@
 struct reg_s;
 struct command_context_s;
 /*
-TARGET_UNKNOWN = 0: we don't know anything about the target yet
-TARGET_RUNNING = 1: the target is executing user code
-TARGET_HALTED  = 2: the target is not executing code, and ready to talk to the
-debugger. on an xscale it means that the debug handler is executing
-TARGET_RESET   = 3: the target is being held in reset (only a temporary state,
-not sure how this is used with all the recent changes)
-TARGET_DEBUG_RUNNING = 4: the target is running, but it is executing code on
-behalf of the debugger (e.g. algorithm for flashing)
-*/
+ * TARGET_UNKNOWN = 0: we don't know anything about the target yet
+ * TARGET_RUNNING = 1: the target is executing user code
+ * TARGET_HALTED  = 2: the target is not executing code, and ready to talk to the
+ * debugger. on an xscale it means that the debug handler is executing
+ * TARGET_RESET   = 3: the target is being held in reset (only a temporary state,
+ * not sure how this is used with all the recent changes)
+ * TARGET_DEBUG_RUNNING = 4: the target is running, but it is executing code on
+ * behalf of the debugger (e.g. algorithm for flashing) */
+
 enum target_state
 {
 	TARGET_UNKNOWN = 0,
@@ -228,7 +228,7 @@
 	 *
 	 * It is illegal to talk to the target at this stage as this fn is invoked
 	 * before the JTAG chain has been examined/verified
-     */
+	 * */
 	int (*init_target)(struct command_context_s *cmd_ctx, struct target_s *target);
 	int (*quit)(void);
 
@@ -237,21 +237,21 @@
 
 } target_type_t;
 
-// forward decloration
+/* forward decloration */
 typedef struct target_event_action_s target_event_action_t;
 
 typedef struct target_s
 {
 	target_type_t *type;				/* target type definition (name, access functions) */
-	const char *cmd_name;               /* tcl Name of target */
-	int target_number;                  /* generaly, target index but may not be in order */
-	jtag_tap_t *tap;                 /* where on the jtag chain is this */
-	const char *variant;                /* what varient of this chip is it? */
+	const char *cmd_name;				/* tcl Name of target */
+	int target_number;					/* generaly, target index but may not be in order */
+	jtag_tap_t *tap;					/* where on the jtag chain is this */
+	const char *variant;				/* what varient of this chip is it? */
 	target_event_action_t *event_action;
 
 	int reset_halt;						/* attempt resetting the CPU into the halted mode? */
 	u32 working_area;					/* working area (initialized RAM). Evaluated
-										   upon first allocation from virtual/physical address. */
+										 * upon first allocation from virtual/physical address. */
 	u32 working_area_virt;				/* virtual address */
 	u32 working_area_phys;				/* physical address */
 	u32 working_area_size;				/* size in bytes */
@@ -269,27 +269,27 @@
 	void *arch_info;					/* architecture specific information */
 	struct target_s *next;				/* next target in list */
 
-	int display; 						/* display async info in telnet session. Do not display
-										   lots of halted/resumed info when stepping in debugger. */
+	int display;						/* display async info in telnet session. Do not display
+										 * lots of halted/resumed info when stepping in debugger. */
 } target_t;
 
 enum target_event
 {
-	// OLD historical names
-	//  - Prior to the great TCL change
-	//  - June/July/Aug 2008
-	//  - Duane Ellis
+	/* LD historical names
+	 * - Prior to the great TCL change
+	 * - June/July/Aug 2008
+	 * - Duane Ellis */
 	TARGET_EVENT_OLD_gdb_program_config,
 	TARGET_EVENT_OLD_pre_reset,
 	TARGET_EVENT_OLD_post_reset,
 	TARGET_EVENT_OLD_pre_resume,
 
 	/* allow GDB to do stuff before others handle the halted event,
- 	this is in lieu of defining ordering of invocation of events,
- 	which would be more complicated */
- 	TARGET_EVENT_EARLY_HALTED,
- 	TARGET_EVENT_HALTED,		/* target entered debug state from normal execution or reset */
- 	TARGET_EVENT_RESUMED,		/* target resumed to normal execution */
+	 * this is in lieu of defining ordering of invocation of events,
+	 * which would be more complicated */
+	TARGET_EVENT_EARLY_HALTED,
+	TARGET_EVENT_HALTED,		/* target entered debug state from normal execution or reset */
+	TARGET_EVENT_RESUMED,		/* target resumed to normal execution */
 	TARGET_EVENT_RESUME_START,
 	TARGET_EVENT_RESUME_END,
 
@@ -308,14 +308,12 @@
 	TARGET_EVENT_RESET_INIT,
 	TARGET_EVENT_RESET_END,
 
+	TARGET_EVENT_DEBUG_HALTED,	/* target entered debug state, but was executing on behalf of the debugger */
+	TARGET_EVENT_DEBUG_RESUMED, /* target resumed to execute on behalf of the debugger */
 
- 	TARGET_EVENT_DEBUG_HALTED,	/* target entered debug state, but was executing on behalf of the debugger */
- 	TARGET_EVENT_DEBUG_RESUMED, /* target resumed to execute on behalf of the debugger */
-
 	TARGET_EVENT_EXAMINE_START,
 	TARGET_EVENT_EXAMINE_END,
 
-
 	TARGET_EVENT_GDB_ATTACH,
 	TARGET_EVENT_GDB_DETACH,
 
@@ -330,7 +328,7 @@
 struct target_event_action_s {
 	enum target_event event;
 	Jim_Obj *body;
-	int      has_percent;
+	int has_percent;
 	target_event_action_t *next;
  };
 
@@ -428,7 +426,6 @@
 void target_handle_event( target_t *t, enum target_event e);
 void target_all_handle_event( enum target_event e );
 
-
 #define ERROR_TARGET_INVALID	(-300)
 #define ERROR_TARGET_INIT_FAILED (-301)
 #define ERROR_TARGET_TIMEOUT	(-302)

Modified: branches/openocd-0.1/src/target/xscale.c
===================================================================
--- branches/openocd_1_0_branch/src/target/xscale.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/target/xscale.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -353,8 +353,6 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-
-
 	fields[2].tap = xscale-&gt;jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
@@ -474,8 +472,6 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-
-
 	fields[2].tap = xscale-&gt;jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = NULL;
@@ -572,8 +568,6 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-
-
 	fields[2].tap = xscale-&gt;jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &amp;field2;
@@ -749,8 +743,6 @@
 	fields[1].in_check_value = NULL;
 	fields[1].in_check_mask = NULL;
 
-
-
 	fields[2].tap = xscale-&gt;jtag_info.tap;
 	fields[2].num_bits = 1;
 	fields[2].out_value = &amp;field2;
@@ -1718,7 +1710,7 @@
 
 			for (; buf_cnt &lt; 32; buf_cnt += 4)
 			{
-					cache_line[buf_cnt / 4] = 0xe1a08008;
+				cache_line[buf_cnt / 4] = 0xe1a08008;
 			}
 
 			/* only load addresses other than the reset vectors */
@@ -1766,19 +1758,16 @@
 		jtag_add_reset(0, 0);
 	}
 
-
 	return ERROR_OK;
 }
 
 int xscale_soft_reset_halt(struct target_s *target)
 {
-
 	return ERROR_OK;
 }
 
 int xscale_read_core_reg(struct target_s *target, int num, enum armv4_5_mode mode)
 {
-
 	return ERROR_OK;
 }
 
@@ -2243,7 +2232,6 @@
 	}
 
 	return ERROR_OK;
-
 }
 
 int xscale_add_breakpoint(struct target_s *target, breakpoint_t *breakpoint)
@@ -3041,7 +3029,6 @@
 
 int xscale_quit(void)
 {
-
 	return ERROR_OK;
 }
 
@@ -3267,7 +3254,6 @@
 	int domain;
 	u32 ap;
 
-
 	if ((retval = xscale_get_arch_pointers(target, &amp;armv4_5, &amp;xscale)) != ERROR_OK)
 	{
 		return retval;
@@ -3295,7 +3281,6 @@
 	return ERROR_OK;
 }
 
-
 int xscale_handle_mmu_command(command_context_t *cmd_ctx, char *cmd, char **args, int argc)
 {
 	target_t *target = get_current_target(cmd_ctx);

Modified: branches/openocd-0.1/src/xsvf/xsvf.c
===================================================================
--- branches/openocd_1_0_branch/src/xsvf/xsvf.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/src/xsvf/xsvf.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,28 +1,42 @@
 /***************************************************************************
- *   Copyright (C) 2005 by Dominic Rath                                    *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">Dominic.Rath at gmx.de</A>                                                   *
- *                                                                         *
- *   Copyright (C) 2007,2008 &#216;yvind Harboe                                 *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">oyvind.harboe at zylin.com</A>                                               *
- *                                                                         *
- *   Copyright (C) 2008 Peter Hettkamp                                     *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">peter.hettkamp at htp-tel.de</A>                                             *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ *	 Copyright (C) 2005 by Dominic Rath									   *
+ *	 <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">Dominic.Rath at gmx.de</A>													   *
+ *																		   *
+ *	 Copyright (C) 2007,2008 &#216;yvind Harboe								   *
+ *	 <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">oyvind.harboe at zylin.com</A>												   *
+ *																		   *
+ *	 Copyright (C) 2008 Peter Hettkamp									   *
+ *	 <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">peter.hettkamp at htp-tel.de</A>											   *
+ *																		   *
+ *	 Copyright (C) 2009 SoftPLC Corporation. <A HREF="http://softplc.com">http://softplc.com</A>             *
+ *	 <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dick at softplc.com</A>											           *
+ *                                                                          *
+ *	 This program is free software; you can redistribute it and/or modify   *
+ *	 it under the terms of the GNU General Public License as published by   *
+ *	 the Free Software Foundation; either version 2 of the License, or	   *
+ *	 (at your option) any later version.									   *
+ *																		   *
+ *	 This program is distributed in the hope that it will be useful,		   *
+ *	 but WITHOUT ANY WARRANTY; without even the implied warranty of		   *
+ *	 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the		   *
+ *	 GNU General Public License for more details.						   *
+ *																		   *
+ *	 You should have received a copy of the GNU General Public License	   *
+ *	 along with this program; if not, write to the						   *
+ *	 Free Software Foundation, Inc.,										   *
+ *	 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.			   *
  ***************************************************************************/
+
+
+/* The specification for SVF is available here:
+ * <A HREF="http://www.asset-intertech.com/support/svf.pdf">http://www.asset-intertech.com/support/svf.pdf</A>
+ * Below, this document is refered to as the &quot;SVF spec&quot;.
+ *
+ * The specification for XSVF is available here:
+ * <A HREF="http://www.xilinx.com/support/documentation/application_notes/xapp503.pdf">http://www.xilinx.com/support/documentation/application_notes/xapp503.pdf</A>
+ * Below, this document is refered to as the &quot;XSVF spec&quot;.
+ */
+
 #ifdef HAVE_CONFIG_H
 #include &quot;config.h&quot;
 #endif
@@ -43,50 +57,131 @@
 #include &lt;sys/time.h&gt;
 #include &lt;time.h&gt;
 
-#define XSTATE_MAX_PATH (12)
 
-int handle_xsvf_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+/* XSVF commands, from appendix B of xapp503.pdf  */
+#define XCOMPLETE		0x00
+#define XTDOMASK			0x01
+#define XSIR				0x02
+#define XSDR				0x03
+#define XRUNTEST			0x04
+#define XREPEAT			0x07
+#define XSDRSIZE			0x08
+#define XSDRTDO			0x09
+#define XSETSDRMASKS		0x0A
+#define XSDRINC			0x0B
+#define XSDRB			0x0C
+#define XSDRC			0x0D
+#define XSDRE			0x0E
+#define XSDRTDOB			0x0F
+#define XSDRTDOC			0x10
+#define XSDRTDOE			0x11
+#define XSTATE			0x12
+#define XENDIR			0x13
+#define XENDDR			0x14
+#define XSIR2			0x15
+#define XCOMMENT			0x16
+#define XWAIT			0x17
 
-int xsvf_fd = 0;
+/* XWAITSTATE is not in the xilinx XSVF spec, but the svf2xsvf.py translator
+ * generates this.  Arguably it is needed because the XSVF XRUNTEST command
+ * was ill conceived and does not directly flow out of the SVF RUNTEST command.
+ * This XWAITSTATE does map directly from the SVF RUNTEST command.
+ */
+#define XWAITSTATE		0x18
 
-u8 *dr_out_buf;	/* from host to device (TDI) */
-u8 *dr_in_buf;	/* from device to host (TDO) */
-u8 *dr_in_mask;
+/* Lattice has extended the SVF file format, and Dick Hollenbeck's python based
+ * SVF2XSVF converter supports these 3 additional XSVF opcodes, LCOUNT, LDELAY, LSDR.
+ * Here is an example of usage of the 3 lattice opcode extensions:
 
-int xsdrsize = 0;
-int xruntest = 0;	/* number of TCK cycles / microseconds */
-int xrepeat = 0x20; /* number of XC9500 retries */
+! Set the maximum loop count to 25.
+LCOUNT	25;
+! Step to DRPAUSE give 5 clocks and wait for 1.00e+000 SEC.
+LDELAY	DRPAUSE	5 TCK	1.00E-003 SEC;
+! Test for the completed status. Match means pass.
+! Loop back to LDELAY line if not match and loop count less than 25.
 
-int xendir = 0;
-int xenddr = 0;
+LSDR 1  TDI  (0)
+		TDO  (1);
+*/
 
-enum tap_state xsvf_to_tap[] =
-{
-	TAP_RESET, TAP_IDLE,
-	TAP_DRSELECT, TAP_DRCAPTURE, TAP_DRSHIFT, TAP_DREXIT1, TAP_DRPAUSE, TAP_DREXIT2, TAP_DRUPDATE,
-	TAP_IRSELECT, TAP_IRCAPTURE, TAP_IRSHIFT, TAP_IREXIT1, TAP_IRPAUSE, TAP_IREXIT2, TAP_IRUPDATE,
-};
+#define LCOUNT			0x19
+#define LDELAY			0x1A
+#define LSDR				0x1B
 
-int tap_to_xsvf[] =
+
+/* XSVF valid state values for the XSTATE command, from appendix B of xapp503.pdf */
+#define XSV_RESET		0x00
+#define XSV_IDLE			0x01
+#define XSV_DRSELECT		0x02
+#define XSV_DRCAPTURE	0x03
+#define XSV_DRSHIFT		0x04
+#define XSV_DREXIT1		0x05
+#define XSV_DRPAUSE		0x06
+#define XSV_DREXIT2		0x07
+#define XSV_DRUPDATE		0x08
+#define XSV_IRSELECT		0x09
+#define XSV_IRCAPTURE	0x0A
+#define XSV_IRSHIFT		0x0B
+#define XSV_IREXIT1		0x0C
+#define XSV_IRPAUSE		0x0D
+#define XSV_IREXIT2		0x0E
+#define XSV_IRUPDATE		0x0F
+
+
+#define XSTATE_MAX_PATH 12
+
+static int handle_xsvf_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
+
+static int xsvf_fd = 0;
+
+
+/* map xsvf tap state to an openocd &quot;enum tap_state&quot; */
+static tap_state_t xsvf_to_tap( int xsvf_state )
 {
-	0x0, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x1, 0x9, 0xa, 0xb, 0xc, 0xe, 0xf
-};
+	tap_state_t	ret;
 
+	switch( xsvf_state )
+	{
+	case XSV_RESET:			ret = TAP_RESET;			break;
+	case XSV_IDLE:			ret = TAP_IDLE;			break;
+	case XSV_DRSELECT:		ret = TAP_DRSELECT;		break;
+	case XSV_DRCAPTURE:		ret = TAP_DRCAPTURE;		break;
+	case XSV_DRSHIFT:		ret = TAP_DRSHIFT;		break;
+	case XSV_DREXIT1:		ret = TAP_DREXIT1;		break;
+	case XSV_DRPAUSE:		ret = TAP_DRPAUSE;		break;
+	case XSV_DREXIT2:		ret = TAP_DREXIT2;		break;
+	case XSV_DRUPDATE:		ret = TAP_DRUPDATE;		break;
+	case XSV_IRSELECT:		ret = TAP_IRSELECT;		break;
+	case XSV_IRCAPTURE:		ret = TAP_IRCAPTURE;		break;
+	case XSV_IRSHIFT:		ret = TAP_IRSHIFT;		break;
+	case XSV_IREXIT1:		ret = TAP_IREXIT1;		break;
+	case XSV_IRPAUSE:		ret = TAP_IRPAUSE;		break;
+	case XSV_IREXIT2:		ret = TAP_IREXIT2;		break;
+	case XSV_IRUPDATE:		ret = TAP_IRUPDATE;		break;
+	default:
+		LOG_ERROR( &quot;UNKNOWN XSVF STATE 0x%02X&quot;, xsvf_state );
+		exit(1);
+	}
 
+	return ret;
+}
+
+
 /* xsvf has it's own definition of a statemove. This needs
- * to be handled according to the specs, which has nothing
+ * to be handled according to the xsvf spec, which has nothing
  * to do with the JTAG spec or OpenOCD as such.
  *
  * Implemented via jtag_add_pathmove().
  */
-void xsvf_add_statemove(enum tap_state state)
+static void xsvf_add_statemove(tap_state_t state)
 {
-	enum tap_state moves[7]; /* max # of transitions */
+	tap_state_t moves[7]; 	/* max # of transitions */
+	tap_state_t curstate = cmd_queue_cur_state;
 	int i;
-	enum tap_state curstate = cmd_queue_cur_state;
+
 	u8 move = TAP_MOVE(cmd_queue_cur_state, state);
 
-	if ((state != TAP_RESET) &amp;&amp; (state == cmd_queue_cur_state))
+	if (state != TAP_RESET  &amp;&amp;  state==cmd_queue_cur_state)
 		return;
 
 	if(state==TAP_RESET)
@@ -94,13 +189,15 @@
 		jtag_add_tlr();
 		return;
 	}
+
 	for (i=0; i&lt;7; i++)
 	{
 		int j = (move &gt;&gt; i) &amp; 1;
 		if (j)
 		{
 			curstate = tap_transitions[curstate].high;
-		} else
+		}
+		else
 		{
 			curstate = tap_transitions[curstate].low;
 		}
@@ -113,17 +210,18 @@
 int xsvf_register_commands(struct command_context_s *cmd_ctx)
 {
 	register_command(cmd_ctx, NULL, &quot;xsvf&quot;, handle_xsvf_command,
-		COMMAND_EXEC, &quot;run xsvf &lt;file&gt;&quot;);
+		COMMAND_EXEC, &quot;run xsvf &lt;file&gt; [virt2]&quot;);
 
 	return ERROR_OK;
 }
 
-int xsvf_read_buffer(int num_bits, int fd, u8* buf)
+static int xsvf_read_buffer(int num_bits, int fd, u8* buf)
 {
 	int num_bytes;
 
 	for (num_bytes = (num_bits + 7) / 8; num_bytes &gt; 0; num_bytes--)
 	{
+		/* reverse the order of bytes as they are read sequentially from file */
 		if (read(fd, buf + num_bytes - 1, 1) &lt; 0)
 			return ERROR_XSVF_EOF;
 	}
@@ -131,13 +229,16 @@
 	return ERROR_OK;
 }
 
-int xsvf_read_xstates(int fd, enum tap_state *path, int max_path, int *path_len)
+
+static int xsvf_read_xstates(int fd, tap_state_t *path, int max_path, int *path_len)
 {
 	char c;
-	unsigned char uc;
+	u8   uc;
 
-	while ((read(fd, &amp;c, 1) &gt; 0) &amp;&amp; (c == 0x12))
+	while ((read(fd, &amp;c, 1) &gt; 0) &amp;&amp; (c == XSTATE))
 	{
+		tap_state_t	mystate;
+
 		if (*path_len &gt; max_path)
 		{
 			LOG_WARNING(&quot;XSTATE path longer than max_path&quot;);
@@ -147,7 +248,12 @@
 		{
 			return ERROR_XSVF_EOF;
 		}
-		path[(*path_len)++] = xsvf_to_tap[uc];
+
+		mystate = xsvf_to_tap(uc);
+
+		LOG_DEBUG(&quot;XSTATE %02X %s&quot;, uc, jtag_state_name(mystate) );
+
+		path[(*path_len)++] = mystate;
 	}
 
 	lseek(fd, -1, SEEK_CUR);
@@ -155,273 +261,325 @@
 	return ERROR_OK;
 }
 
-int handle_xsvf_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
+
+static int handle_xsvf_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc)
 {
-	char c;
-	u8 buf4[4], buf2[2];
-	unsigned char uc, uc2;
-	unsigned int ui;
-	unsigned short us;
+	u8 *dr_out_buf = NULL; 				/* from host to device (TDI) */
+	u8 *dr_in_buf = NULL;				/* from device to host (TDO) */
+	u8 *dr_in_mask = NULL;
 
-	int do_abort = 0;
-	int unsupported = 0;
-	int tdo_mismatch = 0;
+	int xsdrsize = 0;
+	int xruntest = 0;					/* number of TCK cycles OR microseconds */
+	int xrepeat	 = 0;					/* number of retries */
 
-	int runtest_requires_tck = 0;
+	tap_state_t	xendir = TAP_IDLE;		/* see page 8 of the SVF spec, initial xendir to be TAP_IDLE */
+	tap_state_t xenddr = TAP_IDLE;
 
-	jtag_tap_t *tap = NULL;
+	u8  		opcode;
+	u8		uc;
+	long		file_offset = 0;
+
+	int		loop_count = 0;
+	tap_state_t	loop_state = TAP_IDLE;
+	int		loop_clocks = 0;
+	int		loop_usecs = 0;
+
+	int 		do_abort = 0;
+	int 		unsupported = 0;
+	int 		tdo_mismatch = 0;
+	int 		result;
+
+	int 		runtest_requires_tck = 0;	/* a flag telling whether to clock TCK during waits, or simply sleep, controled by virt2 */
+
+
 	/* use NULL to indicate a &quot;plain&quot; xsvf file which accounts for
 	   additional devices in the scan chain, otherwise the device
-	   that should be affected */
+	   that should be affected
+	*/
+	jtag_tap_t *tap = NULL;
 
 	if (argc &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;usage: xsvf &lt;device#|plain&gt; &lt;file&gt; &lt;variant&gt;&quot;);
-		return ERROR_OK;
+		return ERROR_FAIL;
 	}
 
 	if (strcmp(args[0], &quot;plain&quot;) != 0)
 	{
-	  tap = jtag_TapByString( args[0] );
-	  if( !tap ){
-	    command_print( cmd_ctx, &quot;Tap: %s unknown&quot;, args[0] );
-	    return ERROR_OK;
-	  }
+		tap = jtag_TapByString( args[0] );
+		if (!tap )
+		{
+			command_print( cmd_ctx, &quot;Tap: %s unknown&quot;, args[0] );
+			return ERROR_FAIL;
+		}
 	}
 
 	if ((xsvf_fd = open(args[1], O_RDONLY)) &lt; 0)
 	{
-		command_print(cmd_ctx, &quot;file %s not found&quot;, args[0]);
-		return ERROR_OK;
+		command_print(cmd_ctx, &quot;file \&quot;%s\&quot; not found&quot;, args[1]);
+		return ERROR_FAIL;
 	}
 
+	/* if this argument is present, then interpret xruntest counts as TCK cycles rather than as usecs */
 	if ((argc &gt; 2) &amp;&amp; (strcmp(args[2], &quot;virt2&quot;) == 0))
 	{
 		runtest_requires_tck = 1;
 	}
 
-	while (read(xsvf_fd, &amp;c, 1) &gt; 0)
+	LOG_USER(&quot;xsvf processing file: \&quot;%s\&quot;&quot;, args[1]);
+
+	while( read(xsvf_fd, &amp;opcode, 1) &gt; 0 )
 	{
-		switch (c)
+		/* record the position of the just read opcode within the file */
+		file_offset = lseek(xsvf_fd, 0, SEEK_CUR) - 1;
+
+		switch (opcode)
 		{
-			case 0x00:	/* XCOMPLETE */
+			case XCOMPLETE:
 				LOG_DEBUG(&quot;XCOMPLETE&quot;);
-				if (jtag_execute_queue() != ERROR_OK)
+
+				result = jtag_execute_queue();
+				if (result != ERROR_OK)
 				{
 					tdo_mismatch = 1;
 					break;
 				}
 				break;
-			case 0x01:	/* XTDOMASK */
+
+			case XTDOMASK:
 				LOG_DEBUG(&quot;XTDOMASK&quot;);
 				if (dr_in_mask &amp;&amp; (xsvf_read_buffer(xsdrsize, xsvf_fd, dr_in_mask) != ERROR_OK))
 					do_abort = 1;
 				break;
-			case 0x02:	/* XSIR */
-				LOG_DEBUG(&quot;XSIR&quot;);
-				if (read(xsvf_fd, &amp;c, 1) &lt; 0)
-					do_abort = 1;
-				else
+
+			case XRUNTEST:
 				{
-					u8 *ir_buf = malloc((c + 7) / 8);
-					if (xsvf_read_buffer(c, xsvf_fd, ir_buf) != ERROR_OK)
+					u8	xruntest_buf[4];
+
+					if (read(xsvf_fd, xruntest_buf, 4) &lt; 0)
+					{
 						do_abort = 1;
-					else
-					{
-						scan_field_t field;
-						field.tap = tap;
-						field.num_bits = c;
-						field.out_value = ir_buf;
-						field.out_mask = NULL;
-						field.in_value = NULL;
-						field.in_check_value = NULL;
-						field.in_check_mask = NULL;
-						field.in_handler = NULL;
-						field.in_handler_priv = NULL;
-						if (tap == NULL)
-							jtag_add_plain_ir_scan(1, &amp;field, TAP_IRPAUSE);
-						else
-							jtag_add_ir_scan(1, &amp;field, TAP_IRPAUSE);
-						if (jtag_execute_queue() != ERROR_OK)
-						{
-							tdo_mismatch = 1;
-							free(ir_buf);
-							break;
-						}
-						if (xruntest)
-						{
-							if (runtest_requires_tck)
-								jtag_add_runtest(xruntest, xsvf_to_tap[xendir]);
-							else
-							{
-								xsvf_add_statemove(TAP_IDLE);
-								jtag_add_sleep(xruntest);
-								xsvf_add_statemove(xsvf_to_tap[xendir]);
-							}
-						}
-						else if (xendir != 0xd)	/* Pause-IR */
-							xsvf_add_statemove(xsvf_to_tap[xendir]);
+						break;
 					}
-					free(ir_buf);
+
+					xruntest = be_to_h_u32(xruntest_buf);
+					LOG_DEBUG(&quot;XRUNTEST %d 0x%08X&quot;, xruntest, xruntest);
 				}
 				break;
-			case 0x03:	/* XSDR */
-				LOG_DEBUG(&quot;XSDR&quot;);
-				if (xsvf_read_buffer(xsdrsize, xsvf_fd, dr_out_buf) != ERROR_OK)
-					do_abort = 1;
-				else
+
+			case XREPEAT:
 				{
-					scan_field_t field;
-					field.tap = tap;
-					field.num_bits = xsdrsize;
-					field.out_value = dr_out_buf;
-					field.out_mask = NULL;
-					field.in_value = NULL;
-					jtag_set_check_value(&amp;field, dr_in_buf, dr_in_mask, NULL);
-					if (tap == NULL)
-						jtag_add_plain_dr_scan(1, &amp;field, TAP_DRPAUSE);
+					u8 myrepeat;
+
+					if (read(xsvf_fd, &amp;myrepeat, 1) &lt; 0)
+						do_abort = 1;
 					else
-						jtag_add_dr_scan(1, &amp;field, TAP_DRPAUSE);
-					if (jtag_execute_queue() != ERROR_OK)
 					{
-						tdo_mismatch = 1;
-						break;
+						xrepeat = myrepeat;
+						LOG_DEBUG(&quot;XREPEAT %d&quot;, xrepeat );
 					}
-					if (xruntest)
-					{
-						if (runtest_requires_tck)
-							jtag_add_runtest(xruntest, xsvf_to_tap[xenddr]);
-						else
-						{
-							xsvf_add_statemove(TAP_IDLE);
-							jtag_add_sleep(xruntest);
-							xsvf_add_statemove(xsvf_to_tap[xenddr]);
-						}
-					}
-					else if (xendir != 0x6)	/* Pause-DR */
-						xsvf_add_statemove(xsvf_to_tap[xenddr]);
 				}
 				break;
-			case 0x04:	/* XRUNTEST */
-				LOG_DEBUG(&quot;XRUNTEST&quot;);
-				if (read(xsvf_fd, buf4, 4) &lt; 0)
-					do_abort = 1;
-				else
+
+			case XSDRSIZE:
 				{
-					xruntest = be_to_h_u32(buf4);
-				}
-				break;
-			case 0x07:	/* XREPEAT */
-				LOG_DEBUG(&quot;XREPEAT&quot;);
-				if (read(xsvf_fd, &amp;c, 1) &lt; 0)
-					do_abort = 1;
-				else
-				{
-					xrepeat = c;
-				}
-				break;
-			case 0x08:	/* XSDRSIZE */
-				LOG_DEBUG(&quot;XSDRSIZE&quot;);
-				if (read(xsvf_fd, buf4, 4) &lt; 0)
-					do_abort = 1;
-				else
-				{
-					xsdrsize = be_to_h_u32(buf4);
-					free(dr_out_buf);
-					free(dr_in_buf);
-					free(dr_in_mask);
+					u8	xsdrsize_buf[4];
+
+					if (read(xsvf_fd, xsdrsize_buf, 4) &lt; 0)
+					{
+						do_abort = 1;
+						break;
+					}
+
+					xsdrsize = be_to_h_u32(xsdrsize_buf);
+					LOG_DEBUG(&quot;XSDRSIZE %d&quot;, xsdrsize);
+
+					if( dr_out_buf ) free(dr_out_buf);
+					if( dr_in_buf)   free(dr_in_buf);
+					if( dr_in_mask)  free(dr_in_mask);
+
 					dr_out_buf = malloc((xsdrsize + 7) / 8);
 					dr_in_buf = malloc((xsdrsize + 7) / 8);
 					dr_in_mask = malloc((xsdrsize + 7) / 8);
 				}
 				break;
-			case 0x09:	/* XSDRTDO */
-				LOG_DEBUG(&quot;XSDRTDO&quot;);
-				if (xsvf_read_buffer(xsdrsize, xsvf_fd, dr_out_buf) != ERROR_OK)
-					do_abort = 1;
-				else
+
+			case XSDR:		/* these two are identical except for the dr_in_buf */
+			case XSDRTDO:
 				{
-					if (xsvf_read_buffer(xsdrsize, xsvf_fd, dr_in_buf) != ERROR_OK)
+					int limit = xrepeat;
+					int	matched = 0;
+					int attempt;
+
+					const char* op_name = (opcode == XSDR ? &quot;XSDR&quot; : &quot;XSDRTDO&quot;);
+
+					if (xsvf_read_buffer(xsdrsize, xsvf_fd, dr_out_buf) != ERROR_OK)
+					{
 						do_abort = 1;
-					else
+						break;
+					}
+
+					if (opcode == XSDRTDO)
 					{
+						if(xsvf_read_buffer(xsdrsize, xsvf_fd, dr_in_buf)  != ERROR_OK )
+						{
+							do_abort = 1;
+							break;
+						}
+					}
+
+					if (limit &lt; 1)
+						limit = 1;
+
+					LOG_DEBUG(&quot;%s %d&quot;, op_name, xsdrsize);
+
+					for( attempt=0; attempt&lt;limit;  ++attempt )
+					{
 						scan_field_t field;
+
+						if( attempt&gt;0 )
+						{
+							/* perform the XC9500 exception handling sequence shown in xapp067.pdf and
+							   illustrated in psuedo code at end of this file.  We start from state
+							   DRPAUSE:
+							   go to Exit2-DR
+							   go to Shift-DR
+							   go to Exit1-DR
+							   go to Update-DR
+							   go to Run-Test/Idle
+
+							   This sequence should be harmless for other devices, and it
+							   will be skipped entirely if xrepeat is set to zero.
+							*/
+
+							static tap_state_t exception_path[] = {
+								TAP_DREXIT2,
+								TAP_DRSHIFT,
+								TAP_DREXIT1,
+								TAP_DRUPDATE,
+								TAP_IDLE,
+							};
+
+							jtag_add_pathmove( sizeof(exception_path)/sizeof(exception_path[0]), exception_path);
+
+							LOG_USER(&quot;%s %d retry %d&quot;, op_name, xsdrsize, attempt);
+						}
+
 						field.tap = tap;
 						field.num_bits = xsdrsize;
 						field.out_value = dr_out_buf;
 						field.out_mask = NULL;
 						field.in_value = NULL;
+
 						jtag_set_check_value(&amp;field, dr_in_buf, dr_in_mask, NULL);
+
 						if (tap == NULL)
 							jtag_add_plain_dr_scan(1, &amp;field, TAP_DRPAUSE);
 						else
 							jtag_add_dr_scan(1, &amp;field, TAP_DRPAUSE);
-						if (jtag_execute_queue() != ERROR_OK)
+
+						/* LOG_DEBUG(&quot;FLUSHING QUEUE&quot;); */
+						result = jtag_execute_queue();
+						if (result == ERROR_OK)
 						{
-							tdo_mismatch = 1;
+							matched = 1;
 							break;
 						}
-						if (xruntest)
-						{
-							if (runtest_requires_tck)
-								jtag_add_runtest(xruntest, xsvf_to_tap[xenddr]);
-							else
-							{
-								xsvf_add_statemove(TAP_IDLE);
-								jtag_add_sleep(xruntest);
-								xsvf_add_statemove(xsvf_to_tap[xenddr]);
-							}
-						}
-						else if (xendir != 0x6)	/* Pause-DR */
-							xsvf_add_statemove(xsvf_to_tap[xenddr]);
 					}
+
+					if (!matched)
+					{
+						LOG_USER( &quot;%s mismatch&quot;, op_name);
+						tdo_mismatch = 1;
+						break;
+					}
+
+					/* See page 19 of XSVF spec regarding opcode &quot;XSDR&quot; */
+					if (xruntest)
+					{
+						xsvf_add_statemove(TAP_IDLE);
+
+						if (runtest_requires_tck)
+							jtag_add_clocks(xruntest);
+						else
+							jtag_add_sleep(xruntest);
+					}
+					else if (xendir != TAP_DRPAUSE)	/* we are already in TAP_DRPAUSE */
+						xsvf_add_statemove(xenddr);
 				}
 				break;
-			case 0x0a:	/* XSETDRMASKS */
+
+			case XSETSDRMASKS:
 				LOG_ERROR(&quot;unsupported XSETSDRMASKS\n&quot;);
 				unsupported = 1;
 				break;
-			case 0x0b:	/* XSDRINC */
+
+			case XSDRINC:
 				LOG_ERROR(&quot;unsupported XSDRINC\n&quot;);
 				unsupported = 1;
 				break;
-			case 0x0c:	/* XSDRB */
+
+			case XSDRB:
+				LOG_ERROR(&quot;unsupported XSDRB\n&quot;);
 				unsupported = 1;
 				break;
-			case 0x0d:	/* XSDRC */
+
+			case XSDRC:
+				LOG_ERROR(&quot;unsupported XSDRC\n&quot;);
 				unsupported = 1;
 				break;
-			case 0x0e:	/* XSDRE */
+
+			case XSDRE:
+				LOG_ERROR(&quot;unsupported XSDRE\n&quot;);
 				unsupported = 1;
 				break;
-			case 0x0f:	/* XSDRTDOB */
+
+			case XSDRTDOB:
+				LOG_ERROR(&quot;unsupported XSDRTDOB\n&quot;);
 				unsupported = 1;
 				break;
-			case 0x10:	/* XSDRTDOB */
+
+			case XSDRTDOC:
+				LOG_ERROR(&quot;unsupported XSDRTDOC\n&quot;);
 				unsupported = 1;
 				break;
-			case 0x11:	/* XSDRTDOB */
+
+			case XSDRTDOE:
+				LOG_ERROR(&quot;unsupported XSDRTDOE\n&quot;);
 				unsupported = 1;
 				break;
-			case 0x12:	/* XSTATE */
-				LOG_DEBUG(&quot;XSTATE&quot;);
-				if (read(xsvf_fd, &amp;uc, 1) &lt; 0)
-					do_abort = 1;
-				else
+
+			case XSTATE:
 				{
-					enum tap_state *path = calloc(XSTATE_MAX_PATH, 4);
-					int path_len = 1;
-					path[0] = xsvf_to_tap[uc];
+					tap_state_t	mystate;
+					tap_state_t *path;
+					int path_len;
+
+					if (read(xsvf_fd, &amp;uc, 1) &lt; 0)
+					{
+						do_abort = 1;
+						break;
+					}
+
+					mystate = xsvf_to_tap(uc);
+
+					LOG_DEBUG(&quot;XSTATE 0x%02X %s&quot;, uc, jtag_state_name(mystate) );
+
+					path = calloc(XSTATE_MAX_PATH, 4);
+					path_len = 1;
+
+					path[0] = mystate;
 					if (xsvf_read_xstates(xsvf_fd, path, XSTATE_MAX_PATH, &amp;path_len) != ERROR_OK)
 						do_abort = 1;
 					else
 					{
 						int i,lasti;
+
 						/* here the trick is that jtag_add_pathmove() must end in a stable
-						state, so we must only invoke jtag_add_tlr() when we absolutely
-						have to
-						*/
-						for(i=0,lasti=0;i&lt;path_len;i++)
+						 * state, so we must only invoke jtag_add_tlr() when we absolutely
+						 * have to
+						 */
+						for(i=0,lasti=0;  i&lt;path_len;  i++)
 						{
 							if(path[i]==TAP_RESET)
 							{
@@ -441,56 +599,100 @@
 					free(path);
 				}
 				break;
-			case 0x13:	/* XENDIR */
-				LOG_DEBUG(&quot;XENDIR&quot;);
-				if (read(xsvf_fd, &amp;c, 1) &lt; 0)
-					do_abort = 1;
-				else
+
+			case XENDIR:
 				{
-					if (c == 0)
-						xendir = 1;
-					else if (c == 1)
-						xendir = 0xd;
-					else
+					tap_state_t	 mystate;
+
+					if (read(xsvf_fd, &amp;uc, 1) &lt; 0)
 					{
-						LOG_ERROR(&quot;unknown XENDIR endstate&quot;);
+						do_abort = 1;
+						break;
+					}
+
+					/* see page 22 of XSVF spec */
+					mystate = uc == 1 ? TAP_IRPAUSE : TAP_IDLE;
+
+					LOG_DEBUG(&quot;XENDIR 0x%02X %s&quot;, uc, jtag_state_name(mystate));
+
+					/* assuming that the XRUNTEST comes from SVF RUNTEST, then only these states
+					 * should come here because the SVF spec only allows these with a RUNTEST
+					 */
+					if (mystate != TAP_IRPAUSE &amp;&amp; mystate != TAP_DRPAUSE &amp;&amp; mystate != TAP_RESET &amp;&amp; mystate != TAP_IDLE )
+					{
+						LOG_ERROR(&quot;illegal XENDIR endstate: \&quot;%s\&quot;&quot;, jtag_state_name(mystate));
 						unsupported = 1;
+						break;
 					}
+					xendir = mystate;
 				}
 				break;
-			case 0x14:	/* XENDDR */
-				LOG_DEBUG(&quot;XENDDR&quot;);
-				if (read(xsvf_fd, &amp;c, 1) &lt; 0)
-					do_abort = 1;
-				else
+
+			case XENDDR:
 				{
-					if (c == 0)
-						xenddr = 1;
-					else if (c == 1)
-						xenddr = 0x6;
-					else
+					tap_state_t	 mystate;
+
+					if (read(xsvf_fd, &amp;uc, 1) &lt; 0)
 					{
-						LOG_ERROR(&quot;unknown XENDDR endstate&quot;);
+						do_abort = 1;
+						break;
+					}
+
+					/* see page 22 of XSVF spec */
+					mystate = uc == 1 ? TAP_DRPAUSE : TAP_IDLE;
+
+					LOG_DEBUG(&quot;XENDDR %02X %s&quot;, uc, jtag_state_name(mystate));
+
+					if (mystate != TAP_IRPAUSE &amp;&amp; mystate != TAP_DRPAUSE &amp;&amp; mystate != TAP_RESET &amp;&amp; mystate != TAP_IDLE )
+					{
+						LOG_ERROR(&quot;illegal XENDDR endstate: \&quot;%s\&quot;&quot;, jtag_state_name( mystate ));
 						unsupported = 1;
+						break;
 					}
+					xenddr = mystate;
 				}
 				break;
-			case 0x15:	/* XSIR2 */
-				LOG_DEBUG(&quot;XSIR2&quot;);
-				if (read(xsvf_fd, buf2, 2) &lt; 0)
-					do_abort = 1;
-				else
+
+			case XSIR:
+			case XSIR2:
 				{
-					u8 *ir_buf;
-					us = be_to_h_u16(buf2);
-					ir_buf = malloc((us + 7) / 8);
-					if (xsvf_read_buffer(us, xsvf_fd, ir_buf) != ERROR_OK)
+					u8	short_buf[2];
+					u8*	ir_buf;
+					int bitcount;
+					tap_state_t my_end_state = xruntest ? TAP_IDLE : xendir;
+
+					if( opcode == XSIR )
+					{
+						/* one byte bitcount */
+						if (read(xsvf_fd, short_buf, 1) &lt; 0)
+						{
+							do_abort = 1;
+							break;
+						}
+						bitcount = short_buf[0];
+						LOG_DEBUG(&quot;XSIR %d&quot;, bitcount);
+					}
+					else
+					{
+						if (read(xsvf_fd, short_buf, 2) &lt; 0)
+						{
+							do_abort = 1;
+							break;
+						}
+						bitcount = be_to_h_u16(short_buf);
+						LOG_DEBUG(&quot;XSIR2 %d&quot;, bitcount);
+					}
+
+					ir_buf = malloc((bitcount+7) / 8);
+
+					if (xsvf_read_buffer(bitcount, xsvf_fd, ir_buf) != ERROR_OK)
 						do_abort = 1;
 					else
 					{
 						scan_field_t field;
+
 						field.tap = tap;
-						field.num_bits = us;
+						field.num_bits = bitcount;
 						field.out_value = ir_buf;
 						field.out_mask = NULL;
 						field.in_value = NULL;
@@ -498,61 +700,297 @@
 						field.in_check_mask = NULL;
 						field.in_handler = NULL;
 						field.in_handler_priv = NULL;
+
 						if (tap == NULL)
-							jtag_add_plain_ir_scan(1, &amp;field, xsvf_to_tap[xendir]);
+							jtag_add_plain_ir_scan(1, &amp;field, my_end_state);
 						else
-							jtag_add_ir_scan(1, &amp;field, xsvf_to_tap[xendir]);
+							jtag_add_ir_scan(1, &amp;field, my_end_state);
+
+						if (xruntest)
+						{
+							if (runtest_requires_tck)
+								jtag_add_clocks(xruntest);
+							else
+								jtag_add_sleep(xruntest);
+						}
+
+						/* Note that an -irmask of non-zero in your config file
+						 * can cause this to fail.  Setting -irmask to zero cand work
+						 * around the problem.
+						 */
+
+						/* LOG_DEBUG(&quot;FLUSHING QUEUE&quot;); */
+						result = jtag_execute_queue();
+						if(result != ERROR_OK)
+						{
+							tdo_mismatch = 1;
+						}
 					}
 					free(ir_buf);
 				}
 				break;
-			case 0x16:	/* XCOMMENT */
-				do
+
+			case XCOMMENT:
 				{
-					if (read(xsvf_fd, &amp;c, 1) &lt; 0)
+					int		ndx = 0;
+					char 	comment[128];
+
+					do
 					{
+						if (read(xsvf_fd, &amp;uc, 1) &lt; 0)
+						{
+							do_abort = 1;
+							break;
+						}
+
+						if ( ndx &lt; sizeof(comment)-1 )
+							comment[ndx++] = uc;
+
+					} while (uc != 0);
+
+					comment[sizeof(comment)-1] = 0;		/* regardless, terminate */
+					LOG_USER(comment);
+				}
+				break;
+
+			case XWAIT:
+				{
+					/* expected in stream:
+					   XWAIT &lt;u8 wait_state&gt; &lt;u8 end_state&gt; &lt;u32 usecs&gt;
+					*/
+
+					u8	wait;
+					u8	end;
+					u8	delay_buf[4];
+
+					tap_state_t wait_state;
+					tap_state_t end_state;
+					int 	delay;
+
+					if ( read(xsvf_fd, &amp;wait, 1) &lt; 0
+					  || read(xsvf_fd, &amp;end, 1) &lt; 0
+					  || read(xsvf_fd, delay_buf, 4) &lt; 0)
+					{
 						do_abort = 1;
 						break;
 					}
-				} while (c != 0);
+
+					wait_state = xsvf_to_tap(wait);
+					end_state  = xsvf_to_tap(end);
+					delay      = be_to_h_u32(delay_buf);
+
+					LOG_DEBUG(&quot;XWAIT %s %s usecs:%d&quot;, jtag_state_name(wait_state), jtag_state_name(end_state), delay);
+
+					if (runtest_requires_tck &amp;&amp; wait_state == TAP_IDLE )
+					{
+						jtag_add_runtest(delay, end_state);
+					}
+					else
+					{
+						xsvf_add_statemove( wait_state );
+						jtag_add_sleep(delay);
+						xsvf_add_statemove( end_state );
+					}
+				}
 				break;
-			case 0x17:	/* XWAIT */
-				LOG_DEBUG(&quot;XWAIT&quot;);
-				if ((read(xsvf_fd, &amp;uc, 1) &lt; 0) || (read(xsvf_fd, &amp;uc2, 1) &lt; 0) || (read(xsvf_fd, buf4, 4) &lt; 0))
-					do_abort = 1;
-				else
+
+			case XWAITSTATE:
 				{
-					xsvf_add_statemove(xsvf_to_tap[uc]);
-					ui = be_to_h_u32(buf4);
-					jtag_add_sleep(ui);
-					xsvf_add_statemove(xsvf_to_tap[uc2]);
+					/* expected in stream:
+					   XWAITSTATE &lt;u8 wait_state&gt; &lt;u8 end_state&gt; &lt;u32 clock_count&gt; &lt;u32 usecs&gt;
+					*/
+
+					u8  clock_buf[4];
+					u8  	usecs_buf[4];
+					u8	wait;
+					u8	end;
+					tap_state_t wait_state;
+					tap_state_t end_state;
+					int clock_count;
+					int usecs;
+
+					if ( read(xsvf_fd, &amp;wait, 1) &lt; 0
+					 ||  read(xsvf_fd, &amp;end, 1) &lt; 0
+					 ||  read(xsvf_fd, clock_buf, 4) &lt; 0
+					 ||  read(xsvf_fd, usecs_buf, 4) &lt; 0 )
+					{
+						do_abort = 1;
+						break;
+					}
+
+					wait_state = xsvf_to_tap( wait );
+					end_state  = xsvf_to_tap( end );
+
+					clock_count = be_to_h_u32(clock_buf);
+					usecs       = be_to_h_u32(usecs_buf);
+
+					LOG_DEBUG(&quot;XWAITSTATE %s %s clocks:%i usecs:%i&quot;,
+						jtag_state_name(wait_state),
+						jtag_state_name(end_state),
+						clock_count, usecs);
+
+					/* the following states are 'stable', meaning that they have a transition
+					 * in the state diagram back to themselves.  This is necessary because we will
+					 * be issuing a number of clocks in this state.  This set of allowed states is also
+					 * determined by the SVF RUNTEST command's allowed states.
+					 */
+					if (wait_state != TAP_IRPAUSE &amp;&amp; wait_state != TAP_DRPAUSE &amp;&amp; wait_state != TAP_RESET &amp;&amp; wait_state != TAP_IDLE)
+					{
+						LOG_ERROR(&quot;illegal XWAITSTATE wait_state: \&quot;%s\&quot;&quot;, jtag_state_name( wait_state ));
+						unsupported = 1;
+					}
+
+					xsvf_add_statemove( wait_state );
+
+					jtag_add_clocks( clock_count );
+
+					jtag_add_sleep( usecs );
+
+					xsvf_add_statemove( end_state );
 				}
 				break;
+
+			case LCOUNT:
+				{
+					/* expected in stream:
+					   LCOUNT &lt;u32 loop_count&gt;
+					*/
+					u8  count_buf[4];
+
+					if ( read(xsvf_fd, count_buf, 4) &lt; 0 )
+					{
+						do_abort = 1;
+						break;
+					}
+
+					loop_count = be_to_h_u32(count_buf);
+					LOG_DEBUG(&quot;LCOUNT %d&quot;, loop_count);
+				}
+				break;
+
+			case LDELAY:
+				{
+					/* expected in stream:
+					   LDELAY &lt;u8 wait_state&gt; &lt;u32 clock_count&gt; &lt;u32 usecs_to_sleep&gt;
+					*/
+					u8	state;
+					u8  clock_buf[4];
+					u8  usecs_buf[4];
+
+					if ( read(xsvf_fd, &amp;state, 1) &lt; 0
+					  || read(xsvf_fd, clock_buf, 4) &lt; 0
+					  ||	 read(xsvf_fd, usecs_buf, 4) &lt; 0 )
+					{
+						do_abort = 1;
+						break;
+					}
+
+					loop_state  = xsvf_to_tap(state);
+					loop_clocks = be_to_h_u32(clock_buf);
+					loop_usecs  = be_to_h_u32(usecs_buf);
+
+					LOG_DEBUG(&quot;LDELAY %s clocks:%d usecs:%d&quot;, jtag_state_name(loop_state), loop_clocks, loop_usecs);
+				}
+				break;
+
+			/* LSDR is more like XSDRTDO than it is like XSDR.  It uses LDELAY which
+			 * comes with clocks !AND! sleep requirements.
+			 */
+			case LSDR:
+				{
+					int limit = loop_count;
+					int matched = 0;
+					int attempt;
+
+					LOG_DEBUG(&quot;LSDR&quot;);
+
+					if ( xsvf_read_buffer(xsdrsize, xsvf_fd, dr_out_buf) != ERROR_OK
+					  || xsvf_read_buffer(xsdrsize, xsvf_fd, dr_in_buf) != ERROR_OK )
+					{
+						do_abort = 1;
+						break;
+					}
+
+					if (limit &lt; 1)
+						limit = 1;
+
+					for( attempt=0; attempt&lt;limit;  ++attempt )
+					{
+						scan_field_t field;
+
+						field.tap = tap;
+						field.num_bits = xsdrsize;
+						field.out_value = dr_out_buf;
+						field.out_mask = NULL;
+						field.in_value = NULL;
+
+						if (attempt &gt; 0)
+							LOG_USER(&quot;LSDR retry %d&quot;, attempt);
+
+						jtag_set_check_value(&amp;field, dr_in_buf, dr_in_mask, NULL);
+						if (tap == NULL)
+							jtag_add_plain_dr_scan(1, &amp;field, loop_state);
+						else
+							jtag_add_dr_scan(1, &amp;field, loop_state);
+
+						/* LOG_DEBUG(&quot;FLUSHING QUEUE&quot;); */
+						result = jtag_execute_queue();
+						if(result == ERROR_OK)
+						{
+							matched = 1;
+							break;
+						}
+
+						jtag_add_clocks(loop_clocks);
+						jtag_add_sleep(loop_usecs);
+					}
+
+					if (!matched )
+					{
+						LOG_USER( &quot;LSDR mismatch&quot; );
+						tdo_mismatch = 1;
+						break;
+					}
+				}
+				break;
+
 			default:
-				LOG_ERROR(&quot;unknown xsvf command (0x%2.2x)\n&quot;, c);
+				LOG_ERROR(&quot;unknown xsvf command (0x%02X)\n&quot;, uc);
 				unsupported = 1;
 		}
 
 		if (do_abort || unsupported || tdo_mismatch)
+		{
+			LOG_DEBUG(&quot;xsvf failed, setting taps to reasonable state&quot;);
+
+			/* upon error, return the TAPs to a reasonable state */
+			xsvf_add_statemove( TAP_IDLE );
+			jtag_execute_queue();
 			break;
+		}
 	}
 
 	if (tdo_mismatch)
 	{
-		command_print(cmd_ctx, &quot;TDO mismatch, aborting&quot;);
-		return ERROR_OK;
+		command_print(cmd_ctx, &quot;TDO mismatch, somewhere near offset %lu in xsvf file, aborting&quot;,
+					  file_offset );
+
+
+		return ERROR_FAIL;
 	}
 
 	if (unsupported)
 	{
-		command_print(cmd_ctx, &quot;unsupported xsvf command encountered, aborting&quot;);
-		return ERROR_OK;
+		command_print(cmd_ctx,
+			 &quot;unsupported xsvf command: 0x%02X in xsvf file at offset %ld, aborting&quot;,
+					  uc,  lseek(xsvf_fd, 0, SEEK_CUR)-1 );
+		return ERROR_FAIL;
 	}
 
 	if (do_abort)
 	{
-		command_print(cmd_ctx, &quot;premature end detected, aborting&quot;);
-		return ERROR_OK;
+		command_print(cmd_ctx, &quot;premature end of xsvf file detected, aborting&quot;);
+		return ERROR_FAIL;
 	}
 
 	if (dr_out_buf)
@@ -570,3 +1008,54 @@
 
 	return ERROR_OK;
 }
+
+
+/* PSUEDO-Code from Xilinx Appnote XAPP067.pdf:
+
+the following pseudo code clarifies the intent of the xrepeat support.  The
+flow given is for the entire processing of an SVF file, not an XSVF file.
+No idea if this is just for the XC9500/XL/XV devices or all Xilinx parts.
+
+&quot;Pseudo-Code Algorithm for SVF-Based ISP&quot;
+
+1. Go to Test-Logic-Reset state
+2. Go to Run-Test Idle state
+3. Read SVF record
+
+4. if SIR record then
+	   go to Shift-IR state
+	   Scan in &lt;TDI value&gt;
+
+5. else if SDR record then
+	   set &lt;repeat count&gt; to 0
+	   store &lt;TDI value&gt; as &lt;current TDI value&gt;
+	   store &lt;TDO value&gt; as &lt;current TDO value&gt;
+6. go to Shift-DR state
+	   scan in &lt;current TDI value&gt;
+	   if &lt;current TDO value&gt; is specified then
+		   if &lt;current TDO value&gt; does not equal &lt;actual TDO value&gt; then
+			   if &lt;repeat count&gt; &gt; 32 then
+				   LOG ERROR
+				   go to Run-Test Idle state
+				   go to Step 3
+			   end if
+			   go to Pause-DR
+			   go to Exit2-DR
+			   go to Shift-DR
+			   go to Exit1-DR
+			   go to Update-DR
+			   go to Run-Test/Idle
+			   increment &lt;repeat count&gt; by 1
+			   pause &lt;current pause time&gt; microseconds
+			   go to Step 6)
+		   end if
+	   else
+		   go to Run-Test Idle state
+		   go to Step 3
+	   endif
+else if RUNTEST record then
+   pause tester for &lt;TCK value&gt; microseconds
+   store &lt;TCK value&gt; as &lt;current pause time&gt;
+end if
+
+*/

Copied: branches/openocd-0.1/testing/build.test1 (from rev 1324, trunk/testing/build.test1)


Property changes on: branches/openocd-0.1/testing/build.test1
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: branches/openocd-0.1/testing/build.test1/Makefile
===================================================================
--- trunk/testing/build.test1/Makefile	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/Makefile	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,98 +0,0 @@
-# -*- mode: makefile -*-
-#
-default: _complain_
-include ./local.uses
-
-%: _complain_
-
-
-_complain_:
-	@echo &quot;&quot;
-	@echo &quot; Try the target: cygwin.buildtest or linux.buildtest &quot;
-	@echo &quot;&quot;
-
-remove.install:
-	rm -rf ${INSTALL_DIR}
-
-.PHONY: remove.install
-
-cygwin.buildtest:
-	${MAKE} -f Makefile.ftd2xx clean all
-	${MAKE} -f Makefile.openocd cygwin.easy.permutations
-	${MAKE} -f Makefile.openocd mingw32.easy.permutations
-	${MAKE} -f Makefile.libftdi all
-	${MAKE} -f Makefile.openocd cygwin.libftdi
-
-linux.buildtest: 
-	${MAKE} linux.easy.buildtest
-	${MAKE} linux.ftd2xx_installed 
-	${MAKE} linux.ft2232_libftdi
-	@echo &quot;&quot;
-	@echo &quot;&quot;
-	@echo &quot;========================================&quot;
-	@echo &quot; Linux Build Tests Complete &quot;
-	@echo &quot;========================================&quot;
-	@echo &quot;&quot;
-	@echo &quot;&quot;
-
-
-linux.easy.buildtest:
-	@test -d openocd || (echo &quot;Where the source to openocd?&quot; &amp;&amp; exit 1)
-	${MAKE} -f Makefile.openocd bootstrap
-	${MAKE} -f Makefile.ftd2xx  all
-	${MAKE} -f Makefile.openocd linux.easy.permutations
-
-linux.ftd2xx_installed: 
-	${MAKE} remove.install
-	${MAKE} linux.ftd2xx_installed.setup
-	${MAKE} -f Makefile.openocd $@
-
- linux.ft2232_libftdi:
-	${MAKE} remove.install 
-	${MAKE} -f Makefile.libusb  all
-	${MAKE} -f Makefile.confuse all
-	${MAKE} -f Makefile.libftdi all
-	${MAKE} -f Makefile.openocd $@
-
-# This target is used to &quot;install&quot; files from
-# the FTDICHIP.COM tar.gz unpack directory
-# into &quot;a proper place&quot; - where they should be found.
-linux.ftd2xx_installed.setup:
-	mkdir -p ${INSTALL_DIR}/include
-	mkdir -p ${EXEC_PREFIX}/lib
-	@#
-	@# Sanity check - make sure the .H file is findable
-	@#
-	@f=$(FTD2XX_LINUX_DIR)/ftd2xx.h &amp;&amp; \
-	test -f $$f || (echo &quot;Error: $$f not found&quot; ; exit 1)
-	@#
-	@# Header files are simple... just copy them.
-	@#
-	cp $(FTD2XX_LINUX_DIR)/ftd2xx.h   $(PREFIX)/include/.
-	cp $(FTD2XX_LINUX_DIR)/WinTypes.h $(PREFIX)/include/.
-	@#
-	@# .SO files are harder.
-	@#     (1) copy them, (2) make links
-	@#
-	cp $(FTD2XX_LINUX_DIR)/libftd2xx.so.$(FTD2XX_LINUX_VERSION) $(EXEC_PREFIX)/lib/.
-	cd $(EXEC_PREFIX)/lib &amp;&amp; rm -f libftd2xx.so.0
-	cd $(EXEC_PREFIX)/lib &amp;&amp; ln -s libftd2xx.so.$(FTD2XX_LINUX_VERSION) libftd2xx.so.0
-	cd $(EXEC_PREFIX)/lib &amp;&amp; rm -f libftd2xx.so
-	cd $(EXEC_PREFIX)/lib &amp;&amp; ln -s libftd2xx.so.$(FTD2XX_LINUX_VERSION) libftd2xx.so
-
-
-all.download:
-	mkdir -p ${VIRGINS}
-	${MAKE} -f Makefile.confuse download
-	${MAKE} -f Makefile.libftdi download
-	${MAKE} -f Makefile.ftd2xx  download
-	${MAKE} -f Makefile.libusb  download
-
-.PHONY: linux.buildtest \
-	linux.easy.buildtest \
-	linux.ftd2xx_installed \
-	linux.ft22232_libftdi \
-	linux.ftd2xx_installed.setup
-
-
-

Copied: branches/openocd-0.1/testing/build.test1/Makefile (from rev 1324, trunk/testing/build.test1/Makefile)

Deleted: branches/openocd-0.1/testing/build.test1/Makefile.confuse
===================================================================
--- trunk/testing/build.test1/Makefile.confuse	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/Makefile.confuse	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,46 +0,0 @@
-# -*- mode: makefile -*-
-default: _complain_
-include ./local.uses
-
-TARFILE_LOCAL=${VIRGINS}/confuse-${LIBCONFUSE_VERSION}.tar.gz
-TARFILE_URL  =<A HREF="http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/confuse-${LIBCONFUSE_VERSION">http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/confuse-${LIBCONFUSE_VERSION</A>}.tar.gz
-
-CONFUSE_SRC_DIR   =${HERE}/confuse-${LIBCONFUSE_VERSION}
-CONFUSE_BUILD_DIR =${HERE}/confuse-build
-
-download:
-	wget -O ${TARFILE_LOCAL} ${TARFILE_URL}
-
-unpack:
-	rm -rf ${CONFUSE_SRC_DIR}
-	tar xfz ${TARFILE_LOCAL}
-
-clean::
-	rm -rf ${CONFUSE_SRC_DIR}
-
-configure:
-	rm -rf ${CONFUSE_BUILD_DIR} 
-	mkdir ${CONFUSE_BUILD_DIR}
-	cd ${CONFUSE_BUILD_DIR} &amp;&amp; ${CONFUSE_SRC_DIR}/configure \
-	   --prefix=${PREFIX} \
-	   --exec-prefix=${EXEC_PREFIX}
-
-clean::
-	rm -rf ${CONFUSE_BUILD_DIR}
-
-build:
-	cd ${CONFUSE_BUILD_DIR} &amp;&amp; ${MAKE}
-
-install:
-	cd ${CONFUSE_BUILD_DIR} &amp;&amp; ${MAKE} install
-
-all: unpack configure build install
-
-_complain_:
-	@echo &quot;&quot;
-	@echo &quot;Please try one of these targets: bootstrap, clean, configure, build, install&quot;
-	@echo &quot; Or read the makefile and learn about the permutation test targets&quot;
-	@echo &quot;&quot;
-	@echo &quot;You also might find the download and unpack targets helpful.&quot;
-	@echo &quot;&quot;
-	@exit 1

Copied: branches/openocd-0.1/testing/build.test1/Makefile.confuse (from rev 1324, trunk/testing/build.test1/Makefile.confuse)

Deleted: branches/openocd-0.1/testing/build.test1/Makefile.ftd2xx
===================================================================
--- trunk/testing/build.test1/Makefile.ftd2xx	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/Makefile.ftd2xx	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,88 +0,0 @@
-# -*- mode: makefile -*-
-#
-default: _complain_
-
-include ./local.uses
-
-# WARNING... the file on the ftdi chip site has a SPACE in the filename GRRR!!!
-# We fix that with the &quot;-O&quot; option to wget.
-ZIPFILE_LOCAL=${VIRGINS}/cdm.${FTD2XX_WIN32_VERSION}.zip
-ZIPFILE_URL  =&quot;<A HREF="http://www.ftdichip.com/Drivers/CDM/CDM">http://www.ftdichip.com/Drivers/CDM/CDM</A> ${FTD2XX_WIN32_VERSION}.zip&quot;
-
-TARFILE_LOCAL=${VIRGINS}/libftd2xx${FTD2XX_LINUX_VERSION}.tar.gz
-TARFILE_URL  =<A HREF="http://www.ftdichip.com/Drivers/D2XX/Linux/libftd2xx${FTD2XX_LINUX_VERSION">http://www.ftdichip.com/Drivers/D2XX/Linux/libftd2xx${FTD2XX_LINUX_VERSION</A>}.tar.gz
-
-TARFILE_64_LOCAL=${VIRGINS}/libftd2xx${FTD2XX_LINUX_VERSION}_x86_64.tar.gz
-TARFILE_64_URL  =<A HREF="http://www.ftdichip.com/Drivers/D2XX/Linux/libftd2xx${FTD2XX_LINUX_VERSION">http://www.ftdichip.com/Drivers/D2XX/Linux/libftd2xx${FTD2XX_LINUX_VERSION</A>}_x86_64.tar.gz
-
-
-download.win32:
-	mkdir -p ${VIRGINS}
-	wget -O ${ZIPFILE_LOCAL} ${ZIPFILE_URL}
-
-unpack.win32:
-	rm -rf ${FTD2XX_WIN32_DIR}
-	mkdir -p ${FTD2XX_WIN32_DIR}
-	cd ${FTD2XX_WIN32_DIR} &amp;&amp; unzip ${ZIPFILE_LOCAL}
-
-clean::
-	rm -rf ${FTD2XX_WIN32_DIR}
-
-download.linux:
-	mkdir -p ${VIRGINS}
-	wget -O ${TARFILE_LOCAL} ${TARFILE_URL}
-
-clean:: 
-	rm -rf ${FTD2XX_LINUX_DIR}
-
-unpack.linux:
-	rm -rf ${FTD2XX_LINUX_DIR}
-	mkdir -p ${FTD2XX_LINUX_DIR}
-	tar xfz ${TARFILE_LOCAL}
-
-download.linux.x86_64:
-	mkdir -p ${VIRGINS}
-	wget -O ${TARFILE_LOCAL} ${TARFILE_URL}
-
-unpack.linux.x86_64:
-	rm -rf ${FTD2XX_LINUX_64_DIR}
-	mkdir -p ${FTD2XX_LINUX_64_DIR}
-	tar xfz ${TARFILE_64_LOCAL}
-
-clean::
-	rm -rf ${FTD2XX_LINUX_64_DIR}
-
-download: download.win32 download.linux
-
-unpack.cygwin unpack.mingw32: unpack.win32
-
-unpack: unpack.${BUILD_SYSNAME}
-
-# Nothing to do here
-build:
-	@echo &quot;Done&quot;
-
-#Nothing to do here
-configure:
-	@echo &quot;Done&quot;
-
-# Nothing to do here
-install: 
-	@echo &quot;Done&quot;
-
-all: unpack configure build install
-
-.PHONY: install
-
-# Nothing to do here
-clean::
-	@echo &quot;Done&quot;
-
-_complain_:
-	@echo &quot;&quot;
-	@echo &quot;Please try one of these targets: bootstrap, clean, configure, build, install&quot;
-	@echo &quot; Or read the makefile and learn about the permutation test targets&quot;
-	@echo &quot;&quot;
-	@echo &quot;You also might find the download and unpack targets helpful.&quot;
-	@echo &quot;&quot;
-	@exit 1

Copied: branches/openocd-0.1/testing/build.test1/Makefile.ftd2xx (from rev 1324, trunk/testing/build.test1/Makefile.ftd2xx)

Deleted: branches/openocd-0.1/testing/build.test1/Makefile.libftdi
===================================================================
--- trunk/testing/build.test1/Makefile.libftdi	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/Makefile.libftdi	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,51 +0,0 @@
-# -*- mode: makefile -*-
-default: _complain_
-include ./local.uses
-
-TARFILE_LOCAL    = ${VIRGINS}/libftdi-${LIBFTDI_VERSION}.tar.gz
-TARFILE_URL      = <A HREF="http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/libftdi-${LIBFTDI_VERSION">http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/libftdi-${LIBFTDI_VERSION</A>}.tar.gz
-
-LIBFTDI_SRC_DIR  = ${HERE}/libftdi-${LIBFTDI_VERSION}
-LIBFTDI_BUILD_DIR= ${HERE}/libftdi-build
-
-download:
-	mkdir -p virgins
-	wget -O  ${TARFILE_LOCAL} ${TARFILE_URL}
-
-clean::
-	rm -rf ${LIBFTDI_SRC_DIR}
-
-unpack:
-	tar xf ${TARFILE_LOCAL}
-
-PATH := ${EXEC_PREFIX}/bin:${PATH}
-export PATH
-
-clean::
-	rm -rf ${LIBFTDI_BUILD_DIR}
-
-configure:
-	rm -rf ${LIBFTDI_BUILD_DIR}
-	mkdir -p ${LIBFTDI_BUILD_DIR}
-	cd ${LIBFTDI_BUILD_DIR} &amp;&amp; ${LIBFTDI_SRC_DIR}/configure \
-		--prefix=${PREFIX} \
-		--exec-prefix=${EXEC_PREFIX}
-
-build:
-	cd ${LIBFTDI_BUILD_DIR} &amp;&amp; ${MAKE}
-
-install: 
-	cd ${LIBFTDI_BUILD_DIR} &amp;&amp; ${MAKE} install
-
-all: unpack configure build install
-
-.PHONY: install
-
-_complain_:
-	@echo &quot;&quot;
-	@echo &quot;Please try one of these targets: bootstrap, clean, configure, build, install&quot;
-	@echo &quot; Or read the makefile and learn about the permutation test targets&quot;
-	@echo &quot;&quot;
-	@echo &quot;You also might find the download and unpack targets helpful.&quot;
-	@echo &quot;&quot;
-	@exit 1

Copied: branches/openocd-0.1/testing/build.test1/Makefile.libftdi (from rev 1324, trunk/testing/build.test1/Makefile.libftdi)

Deleted: branches/openocd-0.1/testing/build.test1/Makefile.libusb
===================================================================
--- trunk/testing/build.test1/Makefile.libusb	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/Makefile.libusb	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,55 +0,0 @@
-# -*- mode: makefile -*-
-default: _complain_
-
-include ./local.uses
-
-ifeq (x&quot;$BUILD_SYSNAME&quot;,x&quot;cygwin&quot;)
-$(error Please use the Win32 specific port of LibUSB not the Unix version)
-endif
-ifeq (x&quot;$BUILD_SYSNAME&quot;,x&quot;mingw32&quot;)
-$(error Please use the win32 specific port of LibUSB not the Unix version)
-endif 
-
-TARFILE_LOCAL    = ${VIRGINS}/libusb-${LIBUSB_VERSION_linux}.tar.bz2
-TARFILE_URL      = <A HREF="http://downloads.sourceforge.net/libusb/libusb-${LIBUSB_VERSION_linux">http://downloads.sourceforge.net/libusb/libusb-${LIBUSB_VERSION_linux</A>}.tar.gz
-
-LIBUSB_SRC_DIR   = ${HERE}/libusb-${LIBUSB_VERSION}
-LIBUSB_BUILD_DIR = ${HERE}/libusb-build
-
-download:
-	wget -O ${TARFILE_LOCAL} ${TARFILE_URL}
-
-unpack:
-	rm -rf ${LIBUSB_SRC_DIR}
-	tar xfz ${TARFILE_LOCAL}
-
-clean::
-	rm -rf ${LIBUSB_SRC_DIR}
-
-configure:
-	rm -rf ${LIBUSB_BUILD_DIR}
-	mkdir -p ${LIBUSB_BUILD_DIR}
-	cd ${LIBUSB_BUILD_DIR} &amp;&amp; ${LIBUSB_SRC_DIR}/configure \
-		--prefix=${PREFIX} --exec-prefix=${EXEC_PREFIX}
-
-clean::
-	rm -rf ${LIBUSB_BUILD_DIR}
-
-build:
-	cd ${LIBUSB_BUILD_DIR} &amp;&amp; ${MAKE}
-
-install: 
-	cd ${LIBUSB_BUILD_DIR} &amp;&amp; ${MAKE} install
-
-all: unpack configure build install
-
-.PHONY: install
-
-_complain_:
-	@echo &quot;&quot;
-	@echo &quot;Please try one of these targets: bootstrap, clean, configure, build, install&quot;
-	@echo &quot; Or read the makefile and learn about the permutation test targets&quot;
-	@echo &quot;&quot;
-	@echo &quot;You also might find the download and unpack targets helpful.&quot;
-	@echo &quot;&quot;
-	@exit 1

Copied: branches/openocd-0.1/testing/build.test1/Makefile.libusb (from rev 1324, trunk/testing/build.test1/Makefile.libusb)

Deleted: branches/openocd-0.1/testing/build.test1/Makefile.openocd
===================================================================
--- trunk/testing/build.test1/Makefile.openocd	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/Makefile.openocd	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,193 +0,0 @@
-# -*- mode: makefile -*-
-#
-default: _complain_
-
-include ./local.uses
-
-
-SRC_DIR      ?= $(HERE)/openocd
-BUILD_SUFFIX ?= $(BUILD_MACHINE)
-BUILD_DIR =$(HERE)/openocd.$(BUILD_SUFFIX)
-
-checkout:
-	svn co <A HREF="https://svn.berlios.de/svnroot/repos/openocd/trunk">https://svn.berlios.de/svnroot/repos/openocd/trunk</A> openocd
-
-remove.install:
-	rm -rf ${INSTALL_DIR}
-
-#========================================
-# Win32 Build Permutations
-#   none
-#   parport
-#   ftd2xx - (ftdichip)
-#   libftd
-CONFIG_OPTIONS_win32_none     = 
-CONFIG_OPTIONS_win32_parport  = --enable-parport
-CONFIG_OPTIONS_win32_ftd2xx   = --enable-parport --enable-ft2232_ftd2xx --with-ftd2xx-win32-zipdir=$(FTD2XX_WIN32_DIR)
-
-CYGWIN_EASY_PERMUTATIONS += none
-CYGWIN_EASY_PERMUTATIONS += parport
-CYGWIN_EASY_PERMUTATIONS += ftd2xx
-
-MINGW32_EASY_PERMUTATIONS += none
-MINGW32_EASY_PERMUTATIONS += parport
-MINGW32_EASY_PERMUTATIONS += ftd2xx
-
-
-# This is not a possible permutation, it is manual :-(
-# Why? Because &quot;libftdi&quot; installs things into install/include
-# which would efect the 'ftd2xx' win32 build
-CONFIG_OPTIONS_win32_libftdi  = --enable-parport --enable-ft2232_libftdi
-
-# Default build for win32... is the ftd2xx type build.
-PERMUTE_win32          ?= ftd2xx
-CONFIG_OPTIONS_win32   ?= $(CONFIG_OPTIONS_win32_$(PERMUTE_win32))
-CONFIG_OPTIONS_cygwin   = $(CONFIG_OPTIONS_win32)
-CONFIG_OPTIONS_mingw32  = $(CONFIG_OPTIONS_win32)
-
-#========================================
-# Linux Build Permuatations
-#    none
-#    parport
-#    ft2232_ftd2xx
-#    ft2232_libftdi 
-CONFIG_OPTIONS_linux_none    =
-LINUX_EASY_PERMUTATIONS     += none
-
-CONFIG_OPTIONS_linux_parport = --enable-parport
-LINUX_EASY_PERMUTATIONS     += parport
-
-CONFIG_OPTIONS_linux_ft2232_libftdi = --enable-parport --enable-ft2232-libftdi
-#this cannot be done as part of the permutations.
-#LINUX_EASY_PERMUTATIONS += ft2232_libftdi
-
-CONFIG_OPTIONS_linux_ft2232_ftd2xx_static  = \
-	--enable-parport \
-	--enable-ft2232-ftd2xx --with-ftd2xx-lib=static --with-ftd2xx-linux-tardir=$(FTD2XX_LINUX_DIR)
-LINUX_EASY_PERMUTATIONS += ft2232_ftd2xx_static
-
-# this is not a possible permutation it is manual :-(
-# why? because it interfers with the other permutations
-# by &quot;installing files&quot; in the $(INSTALL_DIR)
-CONFIG_OPTIONS_linux_ftd2xx_installed  = \
-	--enable-parport \
-	--enable-ft2232-ftd2xx \
-	--with-ftd2xx-lib=shared
-
-# The default build permutation is
-PERMUTE_linux ?= ft2232_ftd2xx_static
-CONFIG_OPTIONS_linux = $(CONFIG_OPTIONS_linux_$(PERMUTE_linux))
-
-CONFIG_OPTIONS_darwin=\
-	--enable-ftd2232-libftdi
-
-# Which build are we doing?
-CONFIG_OPTIONS := $(CONFIG_OPTIONS_$(BUILD_SYSNAME))
-
-bootstrap:
-	cd $(SRC_DIR) &amp;&amp; bash ./bootstrap
-
-clean::
-	rm -rf $(BUILD_DIR)
-
-ifndef CFLAGS
-_CFLAGS=true
-else
-_CFLAGS=export CFLAGS=&quot;${CFLAGS}&quot;
-endif
-
-
-# if this was given... then pass it on 
-configure:
-	@echo &quot;     Build Sysname: $(BUILD_SYSNAME)&quot;
-	@echo &quot;    Config Options: $(CONFIG_OPTIONS)&quot;
-	rm -rf $(BUILD_DIR)
-	mkdir $(BUILD_DIR)
-	${_CFLAGS} &amp;&amp; \
-	cd $(BUILD_DIR) &amp;&amp; \
-		$(SRC_DIR)/configure \
-			--prefix=$(PREFIX) \
-			--exec-prefix=$(EXEC_PREFIX) \
-			$(CONFIG_OPTIONS)
-
-build:
-	cd $(BUILD_DIR) &amp;&amp; $(MAKE)
-
-install:
-	cd $(BUILD_DIR) &amp;&amp; $(MAKE) install
-
-all: configure build install
-
-.PHONY: install
-
-# The &quot;cygwin.libftdi&quot; requires that libftdi be built
-# and installed *PRIOR* to running this target.
-# it is not part of the permutations because ... 
-# it interfers with the ftd2xx based builds
-cygwin.libftdi: 
-	$(MAKE) -f Makefile.openocd bootstrap
-	$(MAKE) BUILD_SUFFIX=$@ PERMUTE_win32=libftdi -f Makefile.openocd all
-
-cygwin.easy.permutations: remove.install ${CYGWIN_EASY_PERMUTATIONS:%=_cygwin.%}
-
-_cygwin.%:
-	@echo &quot;&quot;
-	@echo &quot;&quot;
-	@echo &quot;========================================&quot;
-	@echo &quot;Permutation Build... $@&quot;
-	@echo &quot;========================================&quot;
-	@echo &quot;&quot;
-	@echo &quot;&quot;
-	$(MAKE) PERMUTE_win32=$* BUILD_SUFFIX=cygwin.$* -f Makefile.openocd all 
-	$(EXEC_PREFIX)/bin/openocd -v   
-
-mingw32.easy.permutations: remove.install ${MINGW32_EASY_PERMUTATIONS:%=_mingw32.%}
-
-# I (duane) build openocd-mingw32 via Cygwin.
-# Sadly, the &quot;mingw32&quot; buid for cygwin does not include
-# the required &quot;elf.h&quot; header files... so ... 
-# we have them in our own private helper place.
-_mingw32.%:
-	@echo &quot;&quot;
-	@echo &quot;&quot;
-	@echo &quot;========================================&quot;
-	@echo &quot;Permutation Build... $@&quot;
-	@echo &quot;========================================&quot;
-	@echo &quot;&quot;
-	@echo &quot;&quot;
-	CFLAGS=&quot;-mno-cygwin -I$(HERE)/mingw32_help/include&quot; \
-	$(MAKE) -f Makefile.openocd all ;\
-	$(EXEC_PREFIX)/bin/openocd -v   
-
-win32.permutations: mingw32.permutations cygwin.permutations
-
-
-# SMOKE TEST - Build every linux permuation...
-# If &quot;openocd -v&quot; does exit(0) we are good enough.
-
-linux.easy.permutations: remove.install ${LINUX_EASY_PERMUTATIONS:%=_linux.%}
-
-
-_linux.%:
-	@echo &quot;&quot;
-	@echo &quot;&quot;
-	@echo &quot;========================================&quot;
-	@echo &quot;Permutation Build... $@&quot;
-	@echo &quot;========================================&quot;
-	@echo &quot;&quot;
-	@echo &quot;&quot;
-	$(MAKE) PERMUTE_linux=$* BUILD_SUFFIX=linux.$* -f Makefile.openocd all 
-	$(EXEC_PREFIX)/bin/openocd -v   
-
-linux.ftd2xx_installed:
-	${MAKE} -f Makefile.openocd _$@
-
-linux.ft2232_libftdi:
-	${MAKE} -f Makefile.openocd _$@
-
-_complain_:
-	@echo &quot;&quot;
-	@echo &quot;Please try one of these targets: bootstrap, clean, configure, build, install&quot;
-	@echo &quot; Or read the makefile and learn about the permutation test targets&quot;
-	@echo &quot;&quot;
-	@exit 1

Copied: branches/openocd-0.1/testing/build.test1/Makefile.openocd (from rev 1324, trunk/testing/build.test1/Makefile.openocd)

Deleted: branches/openocd-0.1/testing/build.test1/README.TXT
===================================================================
--- trunk/testing/build.test1/README.TXT	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/README.TXT	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,39 +0,0 @@
--- Duane Ellis'es test case for building numerous openocd configurations...
-Dec 26,2008
----------------------------------------------------------------------------
-
-1)	Make a directory some where..
-
-	mkdir ~/test
-
-2)	Change to that directory
-
-	cd  ~/test
-
-3)	Checkout OpenOCD in that directory.
-
-	cd ~/test
-	svn co <A HREF="https://svn.berlios.de/svnroot/repos/openocd/trunk">https://svn.berlios.de/svnroot/repos/openocd/trunk</A> openocd
-
-4)      Copy the &quot;build.test1&quot; directory to the &quot;~/work&quot; directory.
-
-
-	cd ~/test
-	cp ~/openocd/testing/build.test1/.  ~/test/.
-
-5)	If needed, download various components.
-
-	cd ~/work
-	make all.download
-
-
-6)	For Linux - type: 
-
-	cd ~/work
-	make linux.buildtest
-
-7)	For Cygwin - type:
-
-	cd ~/work
-	make cygwin.buildtest
-

Copied: branches/openocd-0.1/testing/build.test1/README.TXT (from rev 1324, trunk/testing/build.test1/README.TXT)

Deleted: branches/openocd-0.1/testing/build.test1/local.uses
===================================================================
--- trunk/testing/build.test1/local.uses	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/local.uses	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,39 +0,0 @@
-# -*- mode: makefile -*-
-HERE := $(shell pwd)
-
-# Solve problems on systems with DASH.. Grrr...
-SHELL=/bin/bash
-export SHELL
-
-VIRGINS=${HERE}/virgins
-
-# Determine the build platform.
-BUILD_SYSNAME_Linux      =linux
-BUILD_SYSNAME_linux      =linux
-BUILD_SYSNAME_CYGWIN_NT  =cygwin
-BUILD_SYSNAME_MINGW32_NT =mingw32
-BUILD_SYSNAME_Darwin     =darwin
-BUILD_SYSNAME_darwin     =darwin
-BUILD_SYSNAME :=$(BUILD_SYSNAME_$(shell uname --sysname | cut -d'-' -f1))
-
-# And machine (ie: i686, x86_64, or what)
-BUILD_MACHINE :=$(BUILD_SYSNAME).$(shell uname -m)
-
-
-INSTALL_DIR     := $(HERE)/install
-PREFIX          := ${INSTALL_DIR}
-EXEC_PREFIX     := ${INSTALL_DIR}/${BUILD_MACHINE}
-
-LIBFTDI_VERSION=0.14
-LIBCONFUSE_VERSION=2.5
-
-LIBUSB_VERSION_linux=0.1.12
-
-LIBUSB_VERSION=${LIBUSB_VERSION_${BUILD_SYSNAME}}
-
-FTD2XX_WIN32_VERSION=2.04.14
-FTD2XX_WIN32_DIR    = ${HERE}/ftd2xx.win32
-
-FTD2XX_LINUX_VERSION=0.4.16
-FTD2XX_LINUX_DIR    = ${HERE}/libftd2xx${FTD2XX_LINUX_VERSION}
-FTD2XX_LINUX_64_DIR = ${HERE}/libftd2xx${FTD2XX_LINUX_VERSION}_x86_64

Copied: branches/openocd-0.1/testing/build.test1/local.uses (from rev 1324, trunk/testing/build.test1/local.uses)

Copied: branches/openocd-0.1/testing/build.test1/mingw32_help (from rev 1324, trunk/testing/build.test1/mingw32_help)

Copied: branches/openocd-0.1/testing/build.test1/mingw32_help/include (from rev 1324, trunk/testing/build.test1/mingw32_help/include)

Deleted: branches/openocd-0.1/testing/build.test1/mingw32_help/include/elf.h
===================================================================
--- trunk/testing/build.test1/mingw32_help/include/elf.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/mingw32_help/include/elf.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,38 +0,0 @@
-/* elf.h
-
-  Copyright 2005 Red Hat, Inc.
-
-This file is part of Cygwin.
-
-This software is a copyrighted work licensed under the terms of the
-Cygwin license.  Please consult the file &quot;CYGWIN_LICENSE&quot; for
-details. */
-
-#ifndef	_ELF_H_
-#define	_ELF_H_
-
-#include &lt;stdint.h&gt;
-
-typedef signed char int8_t;
-typedef unsigned char u_int8_t;
-typedef short int16_t;
-typedef unsigned short u_int16_t;
-typedef int int32_t;
-typedef unsigned int u_int32_t;
-typedef long long int64_t;
-typedef unsigned long long u_int64_t;
-typedef int32_t register_t;
-
-
-#ifdef __cplusplus
-extern &quot;C&quot; {
-#endif
-#include &lt;sys/types.h&gt;
-#include &lt;sys/elf32.h&gt;
-#include &lt;sys/elf64.h&gt;
-#include &lt;sys/elf_generic.h&gt;
-#ifdef __cplusplus
-}
-#endif
-
-#endif /*_ELF_H_*/

Copied: branches/openocd-0.1/testing/build.test1/mingw32_help/include/elf.h (from rev 1324, trunk/testing/build.test1/mingw32_help/include/elf.h)

Copied: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys (from rev 1324, trunk/testing/build.test1/mingw32_help/include/sys)

Deleted: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/cdefs.h
===================================================================
--- trunk/testing/build.test1/mingw32_help/include/sys/cdefs.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/cdefs.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,23 +0,0 @@
-/* sys/cdefs.h
-
-   Copyright 1998, 2000, 2001 Red Hat, Inc.
-
-This file is part of Cygwin.
-
-This software is a copyrighted work licensed under the terms of the
-Cygwin license.  Please consult the file &quot;CYGWIN_LICENSE&quot; for
-details. */
-
-#ifndef	_SYS_CDEFS_H
-#define _SYS_CDEFS_H
-#ifdef	__cplusplus
-#define	__BEGIN_DECLS	extern &quot;C&quot; {
-#define	__END_DECLS	}
-#else
-#define	__BEGIN_DECLS
-#define	__END_DECLS
-#endif
-#define __P(protos)     protos		/* full-blown ANSI C */
-#define  __CONCAT(__x,__y)   __x##__y
-#endif
-

Copied: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/cdefs.h (from rev 1324, trunk/testing/build.test1/mingw32_help/include/sys/cdefs.h)

Deleted: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf32.h
===================================================================
--- trunk/testing/build.test1/mingw32_help/include/sys/elf32.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf32.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,156 +0,0 @@
-/*-
- * Copyright (c) 1996-1998 John D. Polstra.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- * 1. Redistributions of source code must retain the above copyright
- *    notice, this list of conditions and the following disclaimer.
- * 2. Redistributions in binary form must reproduce the above copyright
- *    notice, this list of conditions and the following disclaimer in the
- *    documentation and/or other materials provided with the distribution.
- *
- * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
- * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
- * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
- * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
- * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
- * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
- * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
- * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
- * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- *
- * $FreeBSD: src/sys/sys/elf32.h,v 1.8 2002/05/30 08:32:18 dfr Exp $
- */
-
-#ifndef _SYS_ELF32_H_
-#define _SYS_ELF32_H_ 1
-
-#include &lt;sys/elf_common.h&gt;
-
-/*
- * ELF definitions common to all 32-bit architectures.
- */
-
-typedef u_int32_t	Elf32_Addr;
-typedef u_int16_t	Elf32_Half;
-typedef u_int32_t	Elf32_Off;
-typedef int32_t		Elf32_Sword;
-typedef u_int32_t	Elf32_Word;
-typedef u_int32_t	Elf32_Size;
-typedef Elf32_Off	Elf32_Hashelt;
-
-/*
- * ELF header.
- */
-
-typedef struct {
-	unsigned char	e_ident[EI_NIDENT];	/* File identification. */
-	Elf32_Half	e_type;		/* File type. */
-	Elf32_Half	e_machine;	/* Machine architecture. */
-	Elf32_Word	e_version;	/* ELF format version. */
-	Elf32_Addr	e_entry;	/* Entry point. */
-	Elf32_Off	e_phoff;	/* Program header file offset. */
-	Elf32_Off	e_shoff;	/* Section header file offset. */
-	Elf32_Word	e_flags;	/* Architecture-specific flags. */
-	Elf32_Half	e_ehsize;	/* Size of ELF header in bytes. */
-	Elf32_Half	e_phentsize;	/* Size of program header entry. */
-	Elf32_Half	e_phnum;	/* Number of program header entries. */
-	Elf32_Half	e_shentsize;	/* Size of section header entry. */
-	Elf32_Half	e_shnum;	/* Number of section header entries. */
-	Elf32_Half	e_shstrndx;	/* Section name strings section. */
-} Elf32_Ehdr;
-
-/*
- * Section header.
- */
-
-typedef struct {
-	Elf32_Word	sh_name;	/* Section name (index into the
-					   section header string table). */
-	Elf32_Word	sh_type;	/* Section type. */
-	Elf32_Word	sh_flags;	/* Section flags. */
-	Elf32_Addr	sh_addr;	/* Address in memory image. */
-	Elf32_Off	sh_offset;	/* Offset in file. */
-	Elf32_Size	sh_size;	/* Size in bytes. */
-	Elf32_Word	sh_link;	/* Index of a related section. */
-	Elf32_Word	sh_info;	/* Depends on section type. */
-	Elf32_Size	sh_addralign;	/* Alignment in bytes. */
-	Elf32_Size	sh_entsize;	/* Size of each entry in section. */
-} Elf32_Shdr;
-
-/*
- * Program header.
- */
-
-typedef struct {
-	Elf32_Word	p_type;		/* Entry type. */
-	Elf32_Off	p_offset;	/* File offset of contents. */
-	Elf32_Addr	p_vaddr;	/* Virtual address in memory image. */
-	Elf32_Addr	p_paddr;	/* Physical address (not used). */
-	Elf32_Size	p_filesz;	/* Size of contents in file. */
-	Elf32_Size	p_memsz;	/* Size of contents in memory. */
-	Elf32_Word	p_flags;	/* Access permission flags. */
-	Elf32_Size	p_align;	/* Alignment in memory and file. */
-} Elf32_Phdr;
-
-/*
- * Dynamic structure.  The &quot;.dynamic&quot; section contains an array of them.
- */
-
-typedef struct {
-	Elf32_Sword	d_tag;		/* Entry type. */
-	union {
-		Elf32_Size	d_val;	/* Integer value. */
-		Elf32_Addr	d_ptr;	/* Address value. */
-	} d_un;
-} Elf32_Dyn;
-
-/*
- * Relocation entries.
- */
-
-/* Relocations that don't need an addend field. */
-typedef struct {
-	Elf32_Addr	r_offset;	/* Location to be relocated. */
-	Elf32_Word	r_info;		/* Relocation type and symbol index. */
-} Elf32_Rel;
-
-/* Relocations that need an addend field. */
-typedef struct {
-	Elf32_Addr	r_offset;	/* Location to be relocated. */
-	Elf32_Word	r_info;		/* Relocation type and symbol index. */
-	Elf32_Sword	r_addend;	/* Addend. */
-} Elf32_Rela;
-
-/* Macros for accessing the fields of r_info. */
-#define ELF32_R_SYM(info)	((info) &gt;&gt; 8)
-#define ELF32_R_TYPE(info)	((unsigned char)(info))
-
-/* Macro for constructing r_info from field values. */
-#define ELF32_R_INFO(sym, type)	(((sym) &lt;&lt; 8) + (unsigned char)(type))
-
-/*
- * Symbol table entries.
- */
-
-typedef struct {
-	Elf32_Word	st_name;	/* String table index of name. */
-	Elf32_Addr	st_value;	/* Symbol value. */
-	Elf32_Size	st_size;	/* Size of associated object. */
-	unsigned char	st_info;	/* Type and binding information. */
-	unsigned char	st_other;	/* Reserved (not used). */
-	Elf32_Half	st_shndx;	/* Section index of symbol. */
-} Elf32_Sym;
-
-/* Macros for accessing the fields of st_info. */
-#define ELF32_ST_BIND(info)		((info) &gt;&gt; 4)
-#define ELF32_ST_TYPE(info)		((info) &amp; 0xf)
-
-/* Macro for constructing st_info from field values. */
-#define ELF32_ST_INFO(bind, type)	(((bind) &lt;&lt; 4) + ((type) &amp; 0xf))
-
-#endif /* !_SYS_ELF32_H_ */

Copied: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf32.h (from rev 1324, trunk/testing/build.test1/mingw32_help/include/sys/elf32.h)

Deleted: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf64.h
===================================================================
--- trunk/testing/build.test1/mingw32_help/include/sys/elf64.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf64.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,172 +0,0 @@
-/*-
- * Copyright (c) 1996-1998 John D. Polstra.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- * 1. Redistributions of source code must retain the above copyright
- *    notice, this list of conditions and the following disclaimer.
- * 2. Redistributions in binary form must reproduce the above copyright
- *    notice, this list of conditions and the following disclaimer in the
- *    documentation and/or other materials provided with the distribution.
- *
- * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
- * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
- * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
- * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
- * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
- * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
- * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
- * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
- * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- *
- * $FreeBSD: src/sys/sys/elf64.h,v 1.10 2002/05/30 08:32:18 dfr Exp $
- */
-
-#ifndef _SYS_ELF64_H_
-#define _SYS_ELF64_H_ 1
-
-#include &lt;sys/elf_common.h&gt;
-
-/*
- * ELF definitions common to all 64-bit architectures.
- */
-
-typedef uint64_t	Elf64_Addr;
-typedef uint16_t	Elf64_Half;
-typedef uint32_t	Elf64_Word;
-typedef int32_t		Elf64_Sword;
-typedef uint64_t	Elf64_Xword;
-typedef int64_t		Elf64_Sxword;
-typedef uint64_t	Elf64_Off;
-typedef uint16_t	Elf64_Section;
-typedef Elf64_Half	Elf64_Versym;
-typedef uint16_t	Elf64_Quarter;
-
-/*
- * Types of dynamic symbol hash table bucket and chain elements.
- *
- * This is inconsistent among 64 bit architectures, so a machine dependent
- * typedef is required.
- */
-
-#ifdef __alpha__
-typedef Elf64_Off	Elf64_Hashelt;
-#else
-typedef Elf64_Half	Elf64_Hashelt;
-#endif
-
-/*
- * ELF header.
- */
-
-typedef struct {
-	unsigned char	e_ident[EI_NIDENT];	/* File identification. */
-	Elf64_Half	e_type;		/* File type. */
-	Elf64_Half	e_machine;	/* Machine architecture. */
-	Elf64_Word	e_version;	/* ELF format version. */
-	Elf64_Addr	e_entry;	/* Entry point. */
-	Elf64_Off	e_phoff;	/* Program header file offset. */
-	Elf64_Off	e_shoff;	/* Section header file offset. */
-	Elf64_Word	e_flags;	/* Architecture-specific flags. */
-	Elf64_Half	e_ehsize;	/* Size of ELF header in bytes. */
-	Elf64_Half	e_phentsize;	/* Size of program header entry. */
-	Elf64_Half	e_phnum;	/* Number of program header entries. */
-	Elf64_Half	e_shentsize;	/* Size of section header entry. */
-	Elf64_Half	e_shnum;	/* Number of section header entries. */
-	Elf64_Half	e_shstrndx;	/* Section name strings section. */
-} Elf64_Ehdr;
-
-/*
- * Section header.
- */
-
-typedef struct {
-	Elf64_Word	sh_name;	/* Section name (index into the
-					   section header string table). */
-	Elf64_Word	sh_type;	/* Section type. */
-	Elf64_Xword	sh_flags;	/* Section flags. */
-	Elf64_Addr	sh_addr;	/* Address in memory image. */
-	Elf64_Off	sh_offset;	/* Offset in file. */
-	Elf64_Xword	sh_size;	/* Size in bytes. */
-	Elf64_Word	sh_link;	/* Index of a related section. */
-	Elf64_Word	sh_info;	/* Depends on section type. */
-	Elf64_Xword	sh_addralign;	/* Alignment in bytes. */
-	Elf64_Xword	sh_entsize;	/* Size of each entry in section. */
-} Elf64_Shdr;
-
-/*
- * Program header.
- */
-
-typedef struct {
-	Elf64_Word	p_type;		/* Entry type. */
-	Elf64_Word	p_flags;	/* Access permission flags. */
-	Elf64_Off	p_offset;	/* File offset of contents. */
-	Elf64_Addr	p_vaddr;	/* Virtual address in memory image. */
-	Elf64_Addr	p_paddr;	/* Physical address (not used). */
-	Elf64_Xword	p_filesz;	/* Size of contents in file. */
-	Elf64_Xword	p_memsz;	/* Size of contents in memory. */
-	Elf64_Xword	p_align;	/* Alignment in memory and file. */
-} Elf64_Phdr;
-
-/*
- * Dynamic structure.  The &quot;.dynamic&quot; section contains an array of them.
- */
-
-typedef struct {
-	Elf64_Sxword	d_tag;		/* Entry type. */
-	union {
-		Elf64_Xword	d_val;	/* Integer value. */
-		Elf64_Addr	d_ptr;	/* Address value. */
-	} d_un;
-} Elf64_Dyn;
-
-/*
- * Relocation entries.
- */
-
-/* Relocations that don't need an addend field. */
-typedef struct {
-	Elf64_Addr	r_offset;	/* Location to be relocated. */
-	Elf64_Xword	r_info;		/* Relocation type and symbol index. */
-} Elf64_Rel;
-
-/* Relocations that need an addend field. */
-typedef struct {
-	Elf64_Addr	r_offset;	/* Location to be relocated. */
-	Elf64_Xword	r_info;		/* Relocation type and symbol index. */
-	Elf64_Sxword	r_addend;	/* Addend. */
-} Elf64_Rela;
-
-/* Macros for accessing the fields of r_info. */
-#define ELF64_R_SYM(info)	((info) &gt;&gt; 32)
-#define ELF64_R_TYPE(info)	((unsigned char)(info))
-
-/* Macro for constructing r_info from field values. */
-#define ELF64_R_INFO(sym, type)	(((sym) &lt;&lt; 32) + (unsigned char)(type))
-
-/*
- * Symbol table entries.
- */
-
-typedef struct {
-	Elf64_Word	st_name;	/* String table index of name. */
-	unsigned char	st_info;	/* Type and binding information. */
-	unsigned char	st_other;	/* Reserved (not used). */
-	Elf64_Section	st_shndx;	/* Section index of symbol. */
-	Elf64_Addr	st_value;	/* Symbol value. */
-	Elf64_Xword	st_size;	/* Size of associated object. */
-} Elf64_Sym;
-
-/* Macros for accessing the fields of st_info. */
-#define ELF64_ST_BIND(info)		((info) &gt;&gt; 4)
-#define ELF64_ST_TYPE(info)		((info) &amp; 0xf)
-
-/* Macro for constructing st_info from field values. */
-#define ELF64_ST_INFO(bind, type)	(((bind) &lt;&lt; 4) + ((type) &amp; 0xf))
-
-#endif /* !_SYS_ELF64_H_ */

Copied: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf64.h (from rev 1324, trunk/testing/build.test1/mingw32_help/include/sys/elf64.h)

Deleted: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_common.h
===================================================================
--- trunk/testing/build.test1/mingw32_help/include/sys/elf_common.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_common.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,299 +0,0 @@
-/*-
- * Copyright (c) 1998 John D. Polstra.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- * 1. Redistributions of source code must retain the above copyright
- *    notice, this list of conditions and the following disclaimer.
- * 2. Redistributions in binary form must reproduce the above copyright
- *    notice, this list of conditions and the following disclaimer in the
- *    documentation and/or other materials provided with the distribution.
- *
- * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
- * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
- * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
- * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
- * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
- * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
- * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
- * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
- * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- *
- * $FreeBSD: src/sys/sys/elf_common.h,v 1.15 2004/05/05 02:38:54 marcel Exp $
- */
-
-#ifndef _SYS_ELF_COMMON_H_
-#define _SYS_ELF_COMMON_H_ 1
-
-/*
- * ELF definitions that are independent of architecture or word size.
- */
-
-/*
- * Note header.  The &quot;.note&quot; section contains an array of notes.  Each
- * begins with this header, aligned to a word boundary.  Immediately
- * following the note header is n_namesz bytes of name, padded to the
- * next word boundary.  Then comes n_descsz bytes of descriptor, again
- * padded to a word boundary.  The values of n_namesz and n_descsz do
- * not include the padding.
- */
-
-typedef struct {
-	u_int32_t	n_namesz;	/* Length of name. */
-	u_int32_t	n_descsz;	/* Length of descriptor. */
-	u_int32_t	n_type;		/* Type of this note. */
-} Elf_Note;
-
-/* Indexes into the e_ident array.  Keep synced with
-   <A HREF="http://www.sco.com/developer/gabi/ch4.eheader.html">http://www.sco.com/developer/gabi/ch4.eheader.html</A> */
-#define EI_MAG0		0	/* Magic number, byte 0. */
-#define EI_MAG1		1	/* Magic number, byte 1. */
-#define EI_MAG2		2	/* Magic number, byte 2. */
-#define EI_MAG3		3	/* Magic number, byte 3. */
-#define EI_CLASS	4	/* Class of machine. */
-#define EI_DATA		5	/* Data format. */
-#define EI_VERSION	6	/* ELF format version. */
-#define EI_OSABI	7	/* Operating system / ABI identification */
-#define EI_ABIVERSION	8	/* ABI version */
-#define OLD_EI_BRAND	8	/* Start of architecture identification. */
-#define EI_PAD		9	/* Start of padding (per SVR4 ABI). */
-#define EI_NIDENT	16	/* Size of e_ident array. */
-
-/* Values for the magic number bytes. */
-#define ELFMAG0		0x7f
-#define ELFMAG1		'E'
-#define ELFMAG2		'L'
-#define ELFMAG3		'F'
-#define ELFMAG		&quot;\177ELF&quot;	/* magic string */
-#define SELFMAG		4		/* magic string size */
-
-/* Values for e_ident[EI_VERSION] and e_version. */
-#define EV_NONE		0
-#define EV_CURRENT	1
-
-/* Values for e_ident[EI_CLASS]. */
-#define ELFCLASSNONE	0	/* Unknown class. */
-#define ELFCLASS32	1	/* 32-bit architecture. */
-#define ELFCLASS64	2	/* 64-bit architecture. */
-
-/* Values for e_ident[EI_DATA]. */
-#define ELFDATANONE	0	/* Unknown data format. */
-#define ELFDATA2LSB	1	/* 2's complement little-endian. */
-#define ELFDATA2MSB	2	/* 2's complement big-endian. */
-
-/* Values for e_ident[EI_OSABI]. */
-#define ELFOSABI_SYSV		0	/* UNIX System V ABI */
-#define ELFOSABI_NONE		ELFOSABI_SYSV	/* symbol used in old spec */
-#define ELFOSABI_HPUX		1	/* HP-UX operating system */
-#define ELFOSABI_NETBSD		2	/* NetBSD */
-#define ELFOSABI_LINUX		3	/* GNU/Linux */
-#define ELFOSABI_HURD		4	/* GNU/Hurd */
-#define ELFOSABI_86OPEN		5	/* 86Open common IA32 ABI */
-#define ELFOSABI_SOLARIS	6	/* Solaris */
-#define ELFOSABI_MONTEREY	7	/* Monterey */
-#define ELFOSABI_IRIX		8	/* IRIX */
-#define ELFOSABI_FREEBSD	9	/* FreeBSD */
-#define ELFOSABI_TRU64		10	/* TRU64 UNIX */
-#define ELFOSABI_MODESTO	11	/* Novell Modesto */
-#define ELFOSABI_OPENBSD	12	/* OpenBSD */
-#define ELFOSABI_ARM		97	/* ARM */
-#define ELFOSABI_STANDALONE	255	/* Standalone (embedded) application */
-
-/* e_ident */
-#define IS_ELF(ehdr)	((ehdr).e_ident[EI_MAG0] == ELFMAG0 &amp;&amp; \
-			 (ehdr).e_ident[EI_MAG1] == ELFMAG1 &amp;&amp; \
-			 (ehdr).e_ident[EI_MAG2] == ELFMAG2 &amp;&amp; \
-			 (ehdr).e_ident[EI_MAG3] == ELFMAG3)
-
-/* Values for e_type. */
-#define ET_NONE		0	/* Unknown type. */
-#define ET_REL		1	/* Relocatable. */
-#define ET_EXEC		2	/* Executable. */
-#define ET_DYN		3	/* Shared object. */
-#define ET_CORE		4	/* Core file. */
-
-/* Values for e_machine. */
-#define EM_NONE		0	/* Unknown machine. */
-#define EM_M32		1	/* AT&amp;T WE32100. */
-#define EM_SPARC	2	/* Sun SPARC. */
-#define EM_386		3	/* Intel i386. */
-#define EM_68K		4	/* Motorola 68000. */
-#define EM_88K		5	/* Motorola 88000. */
-#define EM_486		6	/* Intel i486. */
-#define EM_860		7	/* Intel i860. */
-#define EM_MIPS		8	/* MIPS R3000 Big-Endian only */
-
-/* Extensions.  This list is not complete. */
-#define EM_S370		9	/* IBM System/370 */
-#define EM_MIPS_RS4_BE	10	/* MIPS R4000 Big-Endian */ /* Depreciated */
-#define EM_PARISC	15	/* HPPA */
-#define EM_SPARC32PLUS	18	/* SPARC v8plus */
-#define EM_PPC		20	/* PowerPC 32-bit */
-#define EM_PPC64	21	/* PowerPC 64-bit */
-#define EM_ARM		40	/* ARM */
-#define EM_SPARCV9	43	/* SPARC v9 64-bit */
-#define EM_IA_64	50	/* Intel IA-64 Processor */
-#define EM_X86_64	62	/* Advanced Micro Devices x86-64 */
-#define EM_ALPHA	0x9026	/* Alpha (written in the absence of an ABI */
-
-/* Special section indexes. */
-#define SHN_UNDEF	     0		/* Undefined, missing, irrelevant. */
-#define SHN_LORESERVE	0xff00		/* First of reserved range. */
-#define SHN_LOPROC	0xff00		/* First processor-specific. */
-#define SHN_HIPROC	0xff1f		/* Last processor-specific. */
-#define SHN_ABS		0xfff1		/* Absolute values. */
-#define SHN_COMMON	0xfff2		/* Common data. */
-#define SHN_HIRESERVE	0xffff		/* Last of reserved range. */
-
-/* sh_type */
-#define SHT_NULL	0		/* inactive */
-#define SHT_PROGBITS	1		/* program defined information */
-#define SHT_SYMTAB	2		/* symbol table section */
-#define SHT_STRTAB	3		/* string table section */
-#define SHT_RELA	4		/* relocation section with addends */
-#define SHT_HASH	5		/* symbol hash table section */
-#define SHT_DYNAMIC	6		/* dynamic section */
-#define SHT_NOTE	7		/* note section */
-#define SHT_NOBITS	8		/* no space section */
-#define SHT_REL		9		/* relocation section - no addends */
-#define SHT_SHLIB	10		/* reserved - purpose unknown */
-#define SHT_DYNSYM	11		/* dynamic symbol table section */
-#define SHT_NUM		12		/* number of section types */
-#define SHT_LOOS	0x60000000	/* First of OS specific semantics */
-#define SHT_HIOS	0x6fffffff	/* Last of OS specific semantics */
-#define SHT_LOPROC	0x70000000	/* reserved range for processor */
-#define SHT_HIPROC	0x7fffffff	/* specific section header types */
-#define SHT_LOUSER	0x80000000	/* reserved range for application */
-#define SHT_HIUSER	0xffffffff	/* specific indexes */
-
-/* Flags for sh_flags. */
-#define SHF_WRITE	0x1		/* Section contains writable data. */
-#define SHF_ALLOC	0x2		/* Section occupies memory. */
-#define SHF_EXECINSTR	0x4		/* Section contains instructions. */
-#define SHF_TLS		0x400		/* Section contains TLS data. */
-#define SHF_MASKPROC	0xf0000000	/* Reserved for processor-specific. */
-
-/* Values for p_type. */
-#define PT_NULL		0	/* Unused entry. */
-#define PT_LOAD		1	/* Loadable segment. */
-#define PT_DYNAMIC	2	/* Dynamic linking information segment. */
-#define PT_INTERP	3	/* Pathname of interpreter. */
-#define PT_NOTE		4	/* Auxiliary information. */
-#define PT_SHLIB	5	/* Reserved (not used). */
-#define PT_PHDR		6	/* Location of program header itself. */
-#define	PT_TLS		7	/* Thread local storage segment */
-
-#define PT_COUNT	8	/* Number of defined p_type values. */
-
-#define	PT_LOOS		0x60000000	/* OS-specific */
-#define	PT_HIOS		0x6fffffff	/* OS-specific */
-#define PT_LOPROC	0x70000000	/* First processor-specific type. */
-#define PT_HIPROC	0x7fffffff	/* Last processor-specific type. */
-
-/* Values for p_flags. */
-#define PF_X		0x1	/* Executable. */
-#define PF_W		0x2	/* Writable. */
-#define PF_R		0x4	/* Readable. */
-
-/* Values for d_tag. */
-#define DT_NULL		0	/* Terminating entry. */
-#define DT_NEEDED	1	/* String table offset of a needed shared
-				   library. */
-#define DT_PLTRELSZ	2	/* Total size in bytes of PLT relocations. */
-#define DT_PLTGOT	3	/* Processor-dependent address. */
-#define DT_HASH		4	/* Address of symbol hash table. */
-#define DT_STRTAB	5	/* Address of string table. */
-#define DT_SYMTAB	6	/* Address of symbol table. */
-#define DT_RELA		7	/* Address of ElfNN_Rela relocations. */
-#define DT_RELASZ	8	/* Total size of ElfNN_Rela relocations. */
-#define DT_RELAENT	9	/* Size of each ElfNN_Rela relocation entry. */
-#define DT_STRSZ	10	/* Size of string table. */
-#define DT_SYMENT	11	/* Size of each symbol table entry. */
-#define DT_INIT		12	/* Address of initialization function. */
-#define DT_FINI		13	/* Address of finalization function. */
-#define DT_SONAME	14	/* String table offset of shared object
-				   name. */
-#define DT_RPATH	15	/* String table offset of library path. [sup] */
-#define DT_SYMBOLIC	16	/* Indicates &quot;symbolic&quot; linking. [sup] */
-#define DT_REL		17	/* Address of ElfNN_Rel relocations. */
-#define DT_RELSZ	18	/* Total size of ElfNN_Rel relocations. */
-#define DT_RELENT	19	/* Size of each ElfNN_Rel relocation. */
-#define DT_PLTREL	20	/* Type of relocation used for PLT. */
-#define DT_DEBUG	21	/* Reserved (not used). */
-#define DT_TEXTREL	22	/* Indicates there may be relocations in
-				   non-writable segments. [sup] */
-#define DT_JMPREL	23	/* Address of PLT relocations. */
-#define	DT_BIND_NOW	24	/* [sup] */
-#define	DT_INIT_ARRAY	25	/* Address of the array of pointers to
-				   initialization functions */
-#define	DT_FINI_ARRAY	26	/* Address of the array of pointers to
-				   termination functions */
-#define	DT_INIT_ARRAYSZ	27	/* Size in bytes of the array of
-				   initialization functions. */
-#define	DT_FINI_ARRAYSZ	28	/* Size in bytes of the array of
-				   terminationfunctions. */
-#define	DT_RUNPATH	29	/* String table offset of a null-terminated
-				   library search path string. */
-#define	DT_FLAGS	30	/* Object specific flag values. */
-#define	DT_ENCODING	32	/* Values greater than or equal to DT_ENCODING
-				   and less than DT_LOOS follow the rules for
-				   the interpretation of the d_un union
-				   as follows: even == 'd_ptr', even == 'd_val'
-				   or none */
-#define	DT_PREINIT_ARRAY 32	/* Address of the array of pointers to
-				   pre-initialization functions. */
-#define	DT_PREINIT_ARRAYSZ 33	/* Size in bytes of the array of
-				   pre-initialization functions. */
-
-#define	DT_COUNT	33	/* Number of defined d_tag values. */
-
-#define	DT_LOOS		0x6000000d	/* First OS-specific */
-#define	DT_HIOS		0x6fff0000	/* Last OS-specific */
-#define	DT_LOPROC	0x70000000	/* First processor-specific type. */
-#define	DT_HIPROC	0x7fffffff	/* Last processor-specific type. */
-
-/* Values for DT_FLAGS */
-#define	DF_ORIGIN	0x0001	/* Indicates that the object being loaded may
-				   make reference to the $ORIGIN substitution
-				   string */
-#define	DF_SYMBOLIC	0x0002	/* Indicates &quot;symbolic&quot; linking. */
-#define	DF_TEXTREL	0x0004	/* Indicates there may be relocations in
-				   non-writable segments. */
-#define	DF_BIND_NOW	0x0008	/* Indicates that the dynamic linker should
-				   process all relocations for the object
-				   containing this entry before transferring
-				   control to the program. */
-#define	DF_STATIC_TLS	0x0010	/* Indicates that the shared object or
-				   executable contains code using a static
-				   thread-local storage scheme. */
-
-/* Values for n_type.  Used in core files. */
-#define NT_PRSTATUS	1	/* Process status. */
-#define NT_FPREGSET	2	/* Floating point registers. */
-#define NT_PRPSINFO	3	/* Process state info. */
-
-/* Symbol Binding - ELFNN_ST_BIND - st_info */
-#define STB_LOCAL	0	/* Local symbol */
-#define STB_GLOBAL	1	/* Global symbol */
-#define STB_WEAK	2	/* like global - lower precedence */
-#define STB_LOPROC	13	/* reserved range for processor */
-#define STB_HIPROC	15	/*  specific symbol bindings */
-
-/* Symbol type - ELFNN_ST_TYPE - st_info */
-#define STT_NOTYPE	0	/* Unspecified type. */
-#define STT_OBJECT	1	/* Data object. */
-#define STT_FUNC	2	/* Function. */
-#define STT_SECTION	3	/* Section. */
-#define STT_FILE	4	/* Source file. */
-#define STT_TLS		6	/* TLS object. */
-#define STT_LOPROC	13	/* reserved range for processor */
-#define STT_HIPROC	15	/*  specific symbol types */
-
-/* Special symbol table indexes. */
-#define STN_UNDEF	0	/* Undefined symbol index. */
-
-#endif /* !_SYS_ELF_COMMON_H_ */

Copied: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_common.h (from rev 1324, trunk/testing/build.test1/mingw32_help/include/sys/elf_common.h)

Deleted: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_generic.h
===================================================================
--- trunk/testing/build.test1/mingw32_help/include/sys/elf_generic.h	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_generic.h	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,91 +0,0 @@
-/*-
- * Copyright (c) 1998 John D. Polstra.
- * All rights reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- * 1. Redistributions of source code must retain the above copyright
- *    notice, this list of conditions and the following disclaimer.
- * 2. Redistributions in binary form must reproduce the above copyright
- *    notice, this list of conditions and the following disclaimer in the
- *    documentation and/or other materials provided with the distribution.
- *
- * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
- * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
- * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
- * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
- * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
- * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
- * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
- * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
- * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- *
- * $FreeBSD: src/sys/sys/elf_generic.h,v 1.6 2002/07/20 02:56:11 peter Exp $
- */
-
-#ifndef _SYS_ELF_GENERIC_H_
-#define _SYS_ELF_GENERIC_H_ 1
-
-#include &lt;sys/cdefs.h&gt;
-
-/*
- * Definitions of generic ELF names which relieve applications from
- * needing to know the word size.
- */
-
-#ifndef __ELF_WORD_SIZE
-# define __ELF_WORD_SIZE 32
-#endif
-
-#if __ELF_WORD_SIZE != 32 &amp;&amp; __ELF_WORD_SIZE != 64
-#error &quot;__ELF_WORD_SIZE must be defined as 32 or 64&quot;
-#endif
-
-#define ELF_CLASS	__CONCAT(ELFCLASS,__ELF_WORD_SIZE)
-
-#if BYTE_ORDER == LITTLE_ENDIAN
-#define ELF_DATA	ELFDATA2LSB
-#elif BYTE_ORDER == BIG_ENDIAN
-#define ELF_DATA	ELFDATA2MSB
-#else
-#error &quot;Unknown byte order&quot;
-#endif
-
-#if __ELF_WORD_SIZE == 32
-#define __elfN(x)	elf32_##x
-#define __ElfN(x)	Elf32_##x
-#define __ELFN(x)	ELF32_##x
-#else
-#define __elfN(x)	elf364_##x
-#define __ElfN(x)	Elf364_##x
-#define __ELFN(x)	ELF364_##x
-#endif
-#define __ElfType(x)	typedef __ElfN(x) Elf_##x
-
-#define FOO
-__ElfType(Addr);
-__ElfType(Half);
-__ElfType(Off);
-__ElfType(Sword);
-__ElfType(Word);
-__ElfType(Size);
-__ElfType(Hashelt);
-__ElfType(Ehdr);
-__ElfType(Shdr);
-__ElfType(Phdr);
-__ElfType(Dyn);
-__ElfType(Rel);
-__ElfType(Rela);
-__ElfType(Sym);
-
-#define ELF_R_SYM	__ELFN(R_SYM)
-#define ELF_R_TYPE	__ELFN(R_TYPE)
-#define ELF_R_INFO	__ELFN(R_INFO)
-#define ELF_ST_BIND	__ELFN(ST_BIND)
-#define ELF_ST_TYPE	__ELFN(ST_TYPE)
-#define ELF_ST_INFO	__ELFN(ST_INFO)
-
-#endif /* !_SYS_ELF_GENERIC_H_ */

Copied: branches/openocd-0.1/testing/build.test1/mingw32_help/include/sys/elf_generic.h (from rev 1324, trunk/testing/build.test1/mingw32_help/include/sys/elf_generic.h)

Copied: branches/openocd-0.1/testing/build.test2 (from rev 1324, trunk/testing/build.test2)

Deleted: branches/openocd-0.1/testing/build.test2/Makefile
===================================================================
--- trunk/testing/build.test2/Makefile	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test2/Makefile	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,193 +0,0 @@
-# -*- mode: makefile -*-
-#========================================
-# DO NOT DELETE THE LINE BELOW
-_default: default
-# DO NOT DELETE THE LINE_ABOVE
-#========================================
-
-#========================================
-#
-# There are no user configurable options here.
-#
-# All user configurable options are in local.uses
-#
-include ./local.uses
-#
-#========================================
-
-#========================================
-# This is the USB driver for the FTDI2XX chips.
-# It is a &quot;closed&quot; solution from FTDICHIP.COM
-# Some claim it is faster then the open/free
-# solution:  win32-libusb+libftdi.
-# 
-ftd2xx.download:
-	mkdir -p ${VIRGINS}
-	wget -O ${FTD2XX_ZIPFILE_LOCAL} \
-		 ${FTD2XX_ZIPFILE_URL}
-
-ftd2xx.unpack:
-	rm -rf ${FTD2XX_WIN32_DIR}
-	mkdir -p ${FTD2XX_WIN32_DIR}
-	cd ${FTD2XX_WIN32_DIR} &amp;&amp; unzip \
-		${FTD2XX_ZIPFILE_LOCAL}
-
-ftd2xx.build:
-	@echo &quot;Nothing to do for: $@&quot;
-
-ftd2xx.configure:
-	@echo &quot;Nothing to do for: $@&quot;
-
-ftd2xx.install:
-	@echo &quot;Nothing to do for: $@&quot;
-
-clean::
-	rm -rf ${FTD2XX_WIN32_DIR}
-
-ftd2xx.all: ftd2xx.unpack ftd2xx.configure \
-	ftd2xx.build ftd2xx.install
-
-
-#========================================-
-# LIBFTDI - requires LIBCONFUSE..
-#   So we handle it here :-(
-
-libconfuse.download: 
-	mkdir -p virgins
-	wget -O ${LIBCONFUSE_TARFILE_LOCAL} \
-		${LIBCONFUSE_TARFILE_URL}
-
-libconfuse.unpack:
-	tar xfz ${LIBCONFUSE_TARFILE_LOCAL}
-
-clean::
-	rm -rf ${LIBCONFUSE_SRC_DIR}
-
-libconfuse.configure:
-	rm -rf ${LIBCONFUSE_BUILD_DIR}
-	mkdir -p ${LIBCONFUSE_BUILD_DIR}
-	cd ${LIBCONFUSE_BUILD_DIR} &amp;&amp; \
-		${LIBCONFUSE_SRC_DIR}/configure \
-		--prefix=${PREFIX}
-
-clean::
-	rm -rf ${LIBCONFUSE_BUILD_DIR}
-
-libconfuse.build:
-	cd ${LIBCONFUSE_BUILD_DIR} &amp;&amp; ${MAKE}
-
-libconfuse.install:
-	cd ${LIBCONFUSE_BUILD_DIR} &amp;&amp; ${MAKE} install
-
-libconfuse.all: libconfuse.unpack libconfuse.configure \
-	 libconfuse.build libconfuse.install
-
-#========================================
-# LIBFTDI - the open source (and free)
-# alternative to (closed) FTD2XX drivers.
-
-libftdi.download: 
-	mkdir -p virgins
-	wget -O ${LIBFTDI_TARFILE_LOCAL} \
-		${LIBFTDI_TARFILE_URL}
-
-libftdi.unpack:
-	tar xfz ${LIBFTDI_TARFILE_LOCAL}
-
-clean::
-	rm -rf ${LIBFTDI_SRC_DIR}
-
-libftdi.configure:
-	rm -rf ${LIBFTDI_BUILD_DIR}
-	mkdir -p ${LIBFTDI_BUILD_DIR}
-	cd ${LIBFTDI_BUILD_DIR} &amp;&amp; \
-		${LIBFTDI_SRC_DIR}/configure \
-		--prefix=${PREFIX}
-
-clean::
-	rm -rf ${LIBFTDI_BUILD_DIR}
-
-libftdi.build:
-	cd ${LIBFTDI_BUILD_DIR} &amp;&amp; ${MAKE}
-
-libftdi.install:
-	cd ${LIBFTDI_BUILD_DIR} &amp;&amp; ${MAKE} install
-
-libftdi.all: libftdi.unpack libftdi.configure \
-	libftdi.build libftdi.install
-
-#========================================
-# Openocd...
-
-openocd.bootstrap:
-	cd ${OPENOCD_SRC_DIR} &amp;&amp; bash ./bootstrap
-
-openocd.configure:
-	rm -rf ${OPENOCD_BUILD_DIR}
-	mkdir -p ${OPENOCD_BUILD_DIR}
-	cd ${OPENOCD_BUILD_DIR} &amp;&amp; ${OPENOCD_SRC_DIR}/configure \
-		--prefix=${INSTALL_DIR} \
-		${OPENOCD_CONFIG_OPTIONS}
-
-openocd.build:
-	cd ${OPENOCD_BUILD_DIR} &amp;&amp; ${MAKE}
-
-openocd.docs:
-	cd ${OPENOCD_BUILD_DIR}/docs &amp;&amp; ${MAKE}
-
-openocd.docs.pdf:
-	cd ${OPENOCD_BUILD_DIR}/docs &amp;&amp; ${MAKE} pdf
-
-openocd.docs.html:
-	cd ${OPENOCD_BUILD_DIR}/docs &amp;&amp; ${MAKE} html
-
-# fixme:
-#   need to add a &quot;make one huge html file target&quot;
-
-openocd.install:
-	cd ${OPENOCD_BUILD_DIR} &amp;&amp; ${MAKE} install
-
-#========================================
-# The world...
-
-# Manual step.
-download.all: \
-	ftd2xx.download		\
-	libconfuse.download	\
-	libftdi.download
-
-ifeq (x&quot;${FT2232_DRIVER}&quot;,x&quot;ftd2xx&quot;)
-prebuild: ftd2xx.all
-endif
-
-ifeq (x&quot;${FT2232_DRIVER}&quot;,x&quot;libftdi&quot;)
-prebuild: libconfuse.all libftdi.all
-endif
-
-remake: \
-	openocd.bootstrap \
-	openocd.configure \
-	openocd.build     \
-	openocd.install
-
-initial.build : download.all prebuild remake
-
-all: 
-	@echo &quot;&quot;
-	@echo &quot; This makefile does not support an 'all' target&quot;
-	@echo &quot;&quot;
-	@echo &quot; If this is your *FIRST* time building... &quot;
-	@echo &quot; Then use this command: \&quot;make initial.build\&quot;&quot;
-	@echo &quot;&quot;
-	@echo &quot; The \&quot;default\&quot; target is for openocd developers&quot;
-	@echo &quot; and rebuilds openocd completely..&quot;
-	@echo &quot;&quot;
-
-default: 
-	test -d ${OPENOCD_SRC_DIR} || (echo &quot;Where is: The OPENOCD source?&quot;; exit 1)
-	${MAKE} remake
-
-whatis_%:
-	@echo &quot;&quot;
-	@echo &quot;Makevariable: $*  =&gt; ${${*}}&quot;
-	@echo &quot;&quot;

Copied: branches/openocd-0.1/testing/build.test2/Makefile (from rev 1324, trunk/testing/build.test2/Makefile)

Deleted: branches/openocd-0.1/testing/build.test2/README.txt
===================================================================
--- trunk/testing/build.test2/README.txt	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test2/README.txt	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,59 +0,0 @@
-
-This makefile is how I Duane Ellis (<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">openocd at duaneellis.com</A>) builds
-openocd test purposes on Cygwin. I have included it here so others
-might also make use of the same configuration that I use to develop
-Openocd.
-
---Duane Ellis
-
-To make use of it do the following:
-
-(1)	Check out openocd in the standard way.
-
-For example - in cygwin, type this:
-
-    bash$  mkdir -p /home/duane/test
-    bash$  cd /home/duane/test
-    bash$  svn co <A HREF="https://svn.berlios.de/svnroot/repos/openocd/trunk">https://svn.berlios.de/svnroot/repos/openocd/trunk</A> openocd
-
-(2)	COPY this folder &quot;right above&quot; where you have OpenOCD.
-
-    bash$  cd /home/duane/test
-    bash$  cp ./openocd/testing/build.test2/*   /home/duane/test/.
-
-(3) OPTIONALLY
-
-    You might want to review the file &quot;local.uses&quot;
-    Change options and so forth at the top of the file.
-
-(4) 	Initially, you need to download some additional files.
-	These include &quot;libftdi&quot;, &quot;libconfuse&quot;, and the ftd2xx drivers.
-
-(5)	You also need to build the supporting libraries and install them
-	(They are installed &quot;locally&quot; only)
-
-	Type this command:
-
-    bash$ cd /home/duane/test
-
-    bash$ make initial.build
-
-    	  which:  (1) downloads files
-	  	  (2) builds the libs
-		  (3) builds OpenOCD
-
-(6)     As you hack upon OpenOCD... to rebuild OpenOCD...
-	
-    bash$ cd /home/duane/test
-
-    bash$ make remake
-
-    	  which: (1) re-bootstraps 
-	  	 (2) re-configures
-		 (3) re-builds
-		 (4) re-installs.
-   
-=======
-**END**
-=======
-

Copied: branches/openocd-0.1/testing/build.test2/README.txt (from rev 1324, trunk/testing/build.test2/README.txt)

Deleted: branches/openocd-0.1/testing/build.test2/local.uses
===================================================================
--- trunk/testing/build.test2/local.uses	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/build.test2/local.uses	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,161 +0,0 @@
-# -*- mode: makefile -*-
-#========================================
-# DO NOT REMOVE THE LINE BELOW
-HERE := $(shell pwd)
-# DO NOT REMOVE THE LINE ABOVE
-#========================================
-
-# These are common CYGWIN build settings.
-# Comment out things you do not want.
-# Or unComment things you want.
-
-# PCs always have printer ports...
-X86_PRINTER_PORT   ?= y
-
-# Chose *ONE* of these three solutions.
-#FTD2232_DRIVER = none
-FT2232_DRIVER  = ftd2xx
-#FT2232_DRIVER  = libftdi
-
-# Do you have &quot;libusb&quot; installed?
-ifeq (x&quot;${FT2232_DRIVER}&quot;,x&quot;libftdi&quot;)
-# With LIBFTDI... LIBUSB is manditory.
-USE_LIBUSB     = y
-endif
-
-# By default... we assume libusb not present.
-USE_LIBUSB    ?= n
-
-#========================================
-# DO NOT EDIT SETTINGS BELOW THIS LINE
-#========================================
-
-
-
-#========================================
-# House keeping...
-
-# Solve problems on systems with DASH.. Grrr...
-SHELL=/bin/bash
-export SHELL
-
-VIRGINS         ?= ${HERE}/virgins
-INSTALL_DIR     ?= $(HERE)/install
-PREFIX          ?= ${INSTALL_DIR}
-
-# Determine the build platform.
-BUILD_SYSNAME_Linux      =linux
-BUILD_SYSNAME_linux      =linux
-BUILD_SYSNAME_CYGWIN_NT  =cygwin
-BUILD_SYSNAME_MINGW32_NT =mingw32
-BUILD_SYSNAME_Darwin     =darwin
-BUILD_SYSNAME_darwin     =darwin
-BUILD_SYSNAME :=$(BUILD_SYSNAME_$(shell uname --sysname | cut -d'-' -f1))
-
-# And machine (ie: i686, x86_64, or what ever)
-BUILD_MACHINE :=$(BUILD_SYSNAME).$(shell uname -m)
-
-
-#========================================
-# 
-
-FTD2XX_LINUX_VERSION=0.4.16
-FTD2XX_LINUX_DIR    = ${HERE}/libftd2xx${FTD2XX_LINUX_VERSION}
-FTD2XX_LINUX_64_DIR = ${HERE}/libftd2xx${FTD2XX_LINUX_VERSION}_x86_64
-
-
-# Wiggler type interfaces are here.
-OPENOCD_CONFIG_OPTIONS_printer_y += --enable-parport 
-OPENOCD_CONFIG_OPTIONS_printer_y += --enable-parport-giveio
-OPENOCD_CONFIG_OPTIONS_printer_y += --enable-gw16012
-OPENOCD_CONFIG_OPTIONS_printer_y += --enable-parport-giveio
-OPENOCD_CONFIG_OPTIONS_printer_y += --enable-amtjtagaccel
-
-
-# FTD2XX only supports these
-OPENOCD_CONFIG_OPTIONS_ft2232_none    =
-OPENOCD_CONFIG_OPTIONS_ft2232_ftd2xx  = --enable-ft2232_ftd2xx  --enable-presto_ftd2xx --with-ftd2xx-win32-zipdir=${FTD2XX_WIN32_DIR}
-OPENOCD_CONFIG_OPTIONS_ft2232_libftdi = --enable-ft2232_libftdi --enable-presto_libftdi 
-
-# LIBUSB - adds support for these.
-OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-jlink 
-OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-usbprog
-OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-rlink 
-OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-vsllink
-OPENOCD_CONFIG_OPTIONS_libusb_y += --enable-usbprog
-
-#========================================
-# EXPLICITY NOT SUPPORTED INTERFACES
-#
-#  zy1000.c
-#     This is a standalone hardware box
-#     it is *NOT* a cygwin thing.
-#
-#  at91rm9200.c
-#     This is a uC/Linux (or linux) that
-#     runs uC/Linux and uses the gpio pins
-#     to bit-bang JTAG stuff.
-#
-#  ep93xx.c
-#     Just like at91rm9200 - different chip.
-
-#========================================
-# Build OPENOCD config options...
-# Always enable &quot;dummy&quot;
-OPENOCD_CONFIG_OPTIONS += --enable-dummy
-# 
-# Today: Cannot enable 'oocd_trace' on cygwin.
-# it assumes/uses termios functions like
-# cfmakeraw() which do not exist on cygwin.
-#
-#OPENOCD_CONFIG_OPTIONS += --enable-oocd-trace
-#
-# Add printer options..
-OPENOCD_CONFIG_OPTIONS += ${OPENOCD_CONFIG_OPTIONS_printer_${X86_PRINTER_PORT}}
-
-# Add the FTD2232 based options.
-OPENOCD_CONFIG_OPTIONS += ${OPENOCD_CONFIG_OPTIONS_ft2232_${FT2232_DRIVER}}
-
-# Add LIBUSB based options.
-OPENOCD_CONFIG_OPTIONS += ${OPENOCD_CONFIG_OPTIONS_libusb_${USE_LIBUSB}}
-
-
-#========================================
-# WARNING... the file on the ftdi chip site has a SPACE in the filename GRRR!!!
-# We fix that with the &quot;-O&quot; option to wget.
-FTD2XX_WIN32_VERSION=2.04.14
-FTD2XX_WIN32_DIR    = ${HERE}/ftd2xx.win32
-
-FTD2XX_ZIPFILE_LOCAL=${VIRGINS}/cdm.${FTD2XX_WIN32_VERSION}.zip
-# Damn thing has a space in the F-ing filename!
-FTD2XX_ZIPFILE_URL  =&quot;<A HREF="http://www.ftdichip.com/Drivers/CDM/CDM">http://www.ftdichip.com/Drivers/CDM/CDM</A> ${FTD2XX_WIN32_VERSION}.zip&quot;
-
-
-#========================================
-# LIBCONFUSE - used by LIBFTDI..
-LIBCONFUSE_VERSION=2.5
-LIBCONFUSE_TARFILE_LOCAL=${VIRGINS}/confuse-${LIBCONFUSE_VERSION}.tar.gz
-LIBCONFUSE_TARFILE_URL  =<A HREF="http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/confuse-${LIBCONFUSE_VERSION">http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/confuse-${LIBCONFUSE_VERSION</A>}.tar.gz
-
-LIBCONFUSE_SRC_DIR   =${HERE}/confuse-${LIBCONFUSE_VERSION}
-LIBCONFUSE_BUILD_DIR =${HERE}/confuse-build
-
-
-#========================================
-# LIBFTDI... (which uses libusb, and libconfuse)
-LIBFTDI_VERSION=0.14
-LIBFTDI_TARFILE_LOCAL    = ${VIRGINS}/libftdi-${LIBFTDI_VERSION}.tar.gz
-LIBFTDI_TARFILE_URL      = <A HREF="http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/libftdi-${LIBFTDI_VERSION">http://www.intra2net.com/de/produkte/opensource/ftdi/TGZ/libftdi-${LIBFTDI_VERSION</A>}.tar.gz
-
-LIBFTDI_SRC_DIR  = ${HERE}/libftdi-${LIBFTDI_VERSION}
-LIBFTDI_BUILD_DIR= ${HERE}/libftdi-build
-
-#========================================
-# Finally - OpenOCD...
-#
-OPENOCD_BUILD_DIR =${HERE}/openocd-build
-OPENOCD_SRC_DIR   =${HERE}/openocd
-
-#========================================
-# END ..
-#========================================

Copied: branches/openocd-0.1/testing/build.test2/local.uses (from rev 1324, trunk/testing/build.test2/local.uses)

Copied: branches/openocd-0.1/testing/examples/ledtest-imx27ads (from rev 1324, trunk/testing/examples/ledtest-imx27ads)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx27ads/Makefile
===================================================================
--- trunk/testing/examples/ledtest-imx27ads/Makefile	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx27ads/Makefile	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,42 +0,0 @@
-# This will make the test program for a Freescale iMX27 ADS Board with a 
-# FreeScale iMX27 CPU 
-
-PROC=arm
-TYPE=926ejs-linux
-LDSCRIPT=ldscript
-
-PATH:=/opt/freescale/usr/local/gcc-4.1.1-glibc-2.4-nptl-sf-1/arm-926ejs-linux/bin/:$(PATH)
-CC=$(PROC)-$(TYPE)-gcc
-AS=$(PROC)-$(TYPE)-as
-AR=$(PROC)-$(TYPE)-ar
-LD=$(PROC)-$(TYPE)-ld
-NM=$(PROC)-$(TYPE)-nm
-OBJDUMP=$(PROC)-$(TYPE)-objdump
-CFLAGS= -g -c -mcpu=arm920t
-
-all: test.elf
-
-# Make a little endian image:
-# In Eclipse, add the line :
-#    source gdbinit 
-# to : Run -&gt; Debug... (menu) -&gt; Commands (tab): Commands (listbox)
-# To start gdb from a window use : arm-elf-gdb --command=gdbinit
-test.elf: test.c Makefile ldscript crt0.S
-	$(CC) $(CFLAGS) -o crt0.o crt0.S
-	$(CC) $(CFLAGS) -o test.o test.c
-	$(LD) -g -v -T$(LDSCRIPT) -o test.elf crt0.o test.o 
-	$(NM) test.elf
-
-
-dump:
-	$(OBJDUMP) --all-headers test.elf
-
-dump_test:
-	$(OBJDUMP) --disassemble test.elf
-
-dump_full:
-	$(OBJDUMP) --full-contents test.elf
-
-clean:
-	-/bin/rm -f *.o *~ test.elf
-

Copied: branches/openocd-0.1/testing/examples/ledtest-imx27ads/Makefile (from rev 1324, trunk/testing/examples/ledtest-imx27ads/Makefile)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx27ads/crt0.S
===================================================================
--- trunk/testing/examples/ledtest-imx27ads/crt0.S	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx27ads/crt0.S	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,47 +0,0 @@
-/* Sample initialization file */
-	
-	.extern	main
-	.extern	exit
-	
-/* .text is used instead of .section .text so it works with arm-aout too.  */
-	.text
-	.code 32
-	.align 	0
-
-	.global	_mainCRTStartup
-	.global	_start
-	.global	start
-start:
-_start:
-_mainCRTStartup:
-
-/* Start by setting up a stack */
-	/*  Set up the stack pointer to end of bss */
-	ldr	r3, .LC2
-	mov 	sp, r3
-
-	sub	sl, sp, #512	/* Still assumes 512 bytes below sl */
-
-	mov 	a2, #0		/* Second arg: fill value */
-	mov	fp, a2		/* Null frame pointer */
-	mov	r7, a2		/* Null frame pointer for Thumb */
-	
-	ldr	a1, .LC1	/* First arg: start of memory block */
-	ldr	a3, .LC2	/* Second arg: end of memory block */
-	sub	a3, a3, a1	/* Third arg: length of block */
-	
-	mov	r0, #0		/*  no arguments  */
-	mov	r1, #0		/*  no argv either */
-
-	bl	main
-	bl	exit		/* Should not return */
-
-	/* For Thumb, constants must be after the code since only 
-	positive offsets are supported for PC relative addresses. */
-	
-	.align 0
-.LC1:
-	.word	__bss_start__
-.LC2:
-	.word	__bss_end__
-

Copied: branches/openocd-0.1/testing/examples/ledtest-imx27ads/crt0.S (from rev 1324, trunk/testing/examples/ledtest-imx27ads/crt0.S)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx27ads/gdbinit-imx27ads
===================================================================
--- trunk/testing/examples/ledtest-imx27ads/gdbinit-imx27ads	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx27ads/gdbinit-imx27ads	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,36 +0,0 @@
-echo Script to load ledtest on iMX27ADS.\n
-
-# Note: you need to startup openocd with &quot;-f board/imx27ads.cfg&quot;
-# in order to it initialize RAM memory.
-
-# SETUP GDB :
-#
-# Common gdb setup for ARM CPUs
-set complaints 1
-set output-radix 10
-set input-radix 10
-set prompt (arm-gdb)
-set endian little
-dir .
-
-# CONNECT TO TARGET :
-target remote 127.0.0.1:3333
-
-#  LOAD IMAGE :
-#
-
-# Load the program executable called &quot;u-boot&quot;
-load test.elf
-
-# Load the symbols for the program.
-symbol-file test.elf
-
-# RUN TO MAIN :
-#
-# Set a breakpoint at main().
-#b reset
-b main
-
-# Run to the breakpoint.
-c
-

Copied: branches/openocd-0.1/testing/examples/ledtest-imx27ads/gdbinit-imx27ads (from rev 1324, trunk/testing/examples/ledtest-imx27ads/gdbinit-imx27ads)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx27ads/ldscript
===================================================================
--- trunk/testing/examples/ledtest-imx27ads/ldscript	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx27ads/ldscript	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,18 +0,0 @@
-SECTIONS
-{
-    . = 0xA0000000;
-	.text : { *(.text) }
-	.data ALIGN(0x10): { *(.data) }
-	.bss ALIGN(0x10): {
-	    __bss_start__ = ABSOLUTE(.);
-	    *(.bss)
-	    . += 0x100;
-        }
-	__bss_end__ = .;
-PROVIDE (__stack = .);
-	_end = .;
-	.debug_info     0 : { *(.debug_info) }
-   	.debug_abbrev   0 : { *(.debug_abbrev) }
-   	.debug_line     0 : { *(.debug_line) }
-   	.debug_frame    0 : { *(.debug_frame) }
-}

Copied: branches/openocd-0.1/testing/examples/ledtest-imx27ads/ldscript (from rev 1324, trunk/testing/examples/ledtest-imx27ads/ldscript)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx27ads/test.c
===================================================================
--- trunk/testing/examples/ledtest-imx27ads/test.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx27ads/test.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,60 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2009 by Alan Carvalho de Assis       		           *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">acassis at gmail.com</A>                                                     *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-void delay()
-{
-	int i;
-	for (i = 0; i &lt; 500000; i++);
-}
-
-/* MAIN ARM FUNTION */
-int main (void)  
-{
-	int i;	
-        volatile unsigned char *ledoff = ((volatile unsigned char *)0xD4000008);
-        volatile unsigned char *ledon = ((volatile unsigned char *)0xD400000C);
-	
-	for (i = 0; i &lt; 10000; i++)
-    	{
-		*ledon = 0x30;
-		delay();
-		*ledoff = 0x30;
-		delay();
-    	} /* FOR */
-
-} /* MAIN */
-
-__gccmain()
-{
-} /* GCCMAIN */
-
-
-void exit(int exit_code)
-{
-  while(1);
-} /* EXIT */
-
-
-atexit()
-{
-  while(1);
-} /* ATEXIT */
-
-

Copied: branches/openocd-0.1/testing/examples/ledtest-imx27ads/test.c (from rev 1324, trunk/testing/examples/ledtest-imx27ads/test.c)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx27ads/test.elf
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/testing/examples/ledtest-imx27ads/test.elf (from rev 1324, trunk/testing/examples/ledtest-imx27ads/test.elf)

Copied: branches/openocd-0.1/testing/examples/ledtest-imx31pdk (from rev 1324, trunk/testing/examples/ledtest-imx31pdk)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/Makefile
===================================================================
--- trunk/testing/examples/ledtest-imx31pdk/Makefile	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx31pdk/Makefile	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,42 +0,0 @@
-# $Header: $
-# This will make the test program for ARM.
-
-PROC=arm
-TYPE=none-linux-gnueabi
-LDSCRIPT=ldscript
-
-PATH:=/opt/freescale/usr/local/gcc-4.1.2-glibc-2.5-nptl-3/arm-none-linux-gnueabi/bin/:$(PATH)
-CC=$(PROC)-$(TYPE)-gcc
-AS=$(PROC)-$(TYPE)-as
-AR=$(PROC)-$(TYPE)-ar
-LD=$(PROC)-$(TYPE)-ld
-NM=$(PROC)-$(TYPE)-nm
-OBJDUMP=$(PROC)-$(TYPE)-objdump
-CFLAGS= -g -c -mcpu=arm1136j-s
-
-all: test.elf
-
-# Make a little endian image:
-# In Eclipse, add the line :
-#    source gdbinit 
-# to : Run -&gt; Debug... (menu) -&gt; Commands (tab): Commands (listbox)
-# To start gdb from a window use : arm-elf-gdb --command=gdbinit
-test.elf: test.c Makefile ldscript crt0.S
-	$(CC) $(CFLAGS) -o crt0.o crt0.S
-	$(CC) $(CFLAGS) -o test.o test.c
-	$(LD) -g -v -T$(LDSCRIPT) -o test.elf crt0.o test.o 
-	$(NM) test.elf
-
-	
-dump:
-	$(OBJDUMP) --all-headers test.elf
-
-dump_test:
-	$(OBJDUMP) --disassemble test.elf
-
-dump_full:
-	$(OBJDUMP) --full-contents test.elf
-
-clean:
-	-/bin/rm -f *.o *~ test.elf
-

Copied: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/Makefile (from rev 1324, trunk/testing/examples/ledtest-imx31pdk/Makefile)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/crt0.S
===================================================================
--- trunk/testing/examples/ledtest-imx31pdk/crt0.S	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx31pdk/crt0.S	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,47 +0,0 @@
-/* Sample initialization file */
-	
-	.extern	main
-	.extern	exit
-	
-/* .text is used instead of .section .text so it works with arm-aout too.  */
-	.text
-	.code 32
-	.align 	0
-
-	.global	_mainCRTStartup
-	.global	_start
-	.global	start
-start:
-_start:
-_mainCRTStartup:
-
-/* Start by setting up a stack */
-	/*  Set up the stack pointer to end of bss */
-	ldr	r3, .LC2
-	mov 	sp, r3
-
-	sub	sl, sp, #512	/* Still assumes 512 bytes below sl */
-
-	mov 	a2, #0		/* Second arg: fill value */
-	mov	fp, a2		/* Null frame pointer */
-	mov	r7, a2		/* Null frame pointer for Thumb */
-	
-	ldr	a1, .LC1	/* First arg: start of memory block */
-	ldr	a3, .LC2	/* Second arg: end of memory block */
-	sub	a3, a3, a1	/* Third arg: length of block */
-	
-	mov	r0, #0		/*  no arguments  */
-	mov	r1, #0		/*  no argv either */
-
-	bl	main
-	bl	exit		/* Should not return */
-
-	/* For Thumb, constants must be after the code since only 
-	positive offsets are supported for PC relative addresses. */
-	
-	.align 0
-.LC1:
-	.word	__bss_start__
-.LC2:
-	.word	__bss_end__
-

Copied: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/crt0.S (from rev 1324, trunk/testing/examples/ledtest-imx31pdk/crt0.S)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/gdbinit-imx31pdk
===================================================================
--- trunk/testing/examples/ledtest-imx31pdk/gdbinit-imx31pdk	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx31pdk/gdbinit-imx31pdk	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,36 +0,0 @@
-echo Script to load ledtest on iMX31PDK.\n
-
-# Note: you need to startup openocd with &quot;-f board/imx31pdk.cfg&quot;
-# in order to it initialize RAM memory.
-
-# SETUP GDB :
-#
-# Common gdb setup for ARM CPUs
-set complaints 1
-set output-radix 10
-set input-radix 10
-set prompt (arm-gdb)
-set endian little
-dir .
-
-# CONNECT TO TARGET :
-target remote 127.0.0.1:3333
-
-#  LOAD IMAGE :
-#
-
-# Load the program executable called &quot;u-boot&quot;
-load test.elf
-
-# Load the symbols for the program.
-symbol-file test.elf
-
-# RUN TO MAIN :
-#
-# Set a breakpoint at main().
-#b reset
-b main
-
-# Run to the breakpoint.
-c
-

Copied: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/gdbinit-imx31pdk (from rev 1324, trunk/testing/examples/ledtest-imx31pdk/gdbinit-imx31pdk)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/ldscript
===================================================================
--- trunk/testing/examples/ledtest-imx31pdk/ldscript	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx31pdk/ldscript	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,18 +0,0 @@
-SECTIONS
-{
-	. = 0x80000100;
-	.text : { *(.text) }
-	.data ALIGN(0x10): { *(.data) }
-	.bss ALIGN(0x10): {
-	    __bss_start__ = ABSOLUTE(.);
-	    *(.bss)
-	    . += 0x100;
-        }
-	__bss_end__ = .;
-PROVIDE (__stack = .);
-	_end = .;
-	.debug_info     0 : { *(.debug_info) }
-   	.debug_abbrev   0 : { *(.debug_abbrev) }
-   	.debug_line     0 : { *(.debug_line) }
-   	.debug_frame    0 : { *(.debug_frame) }
-}

Copied: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/ldscript (from rev 1324, trunk/testing/examples/ledtest-imx31pdk/ldscript)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/test.c
===================================================================
--- trunk/testing/examples/ledtest-imx31pdk/test.c	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/testing/examples/ledtest-imx31pdk/test.c	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,58 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2009 by Alan Carvalho de Assis       		           *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">acassis at gmail.com</A>                                                     *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
- ***************************************************************************/
-
-void delay()
-{
-	int i;
-	for (i = 0; i &lt; 500000; i++);
-}
-
-/* MAIN ARM FUNTION */
-int main (void)  
-{
-        volatile unsigned char *led = ((volatile unsigned char *)0xB6020000);
-	
-	while(1)
-    	{
-		*led = 0xFF;
-		delay();
-		*led = 0x00;
-		delay();
-    	} /* FOR */
-
-} /* MAIN */
-
-__gccmain()
-{
-} /* GCCMAIN */
-
-
-void exit(int exit_code)
-{
-  while(1);
-} /* EXIT */
-
-
-atexit()
-{
-  while(1);
-} /* ATEXIT */
-
-

Copied: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/test.c (from rev 1324, trunk/testing/examples/ledtest-imx31pdk/test.c)

Deleted: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/test.elf
===================================================================
(Binary files differ)

Copied: branches/openocd-0.1/testing/examples/ledtest-imx31pdk/test.elf (from rev 1324, trunk/testing/examples/ledtest-imx31pdk/test.elf)

Copied: branches/openocd-0.1/tools (from rev 1324, trunk/tools)

Copied: branches/openocd-0.1/tools/rlink_make_speed_table (from rev 1324, trunk/tools/rlink_make_speed_table)

Deleted: branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table
===================================================================
--- trunk/tools/rlink_make_speed_table/rlink_make_speed_table	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,2 +0,0 @@
-#!/bin/sh
-exec perl &quot;$0.pl&quot; $*

Copied: branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table (from rev 1324, trunk/tools/rlink_make_speed_table/rlink_make_speed_table)

Deleted: branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table.pl
===================================================================
--- trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table.pl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,68 +0,0 @@
-#!/bin/perl
-#***************************************************************************
-#*   Copyright (C) 2008 Lou Deluxe                                         *
-#*   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>                                   *
-#*                                                                         *
-#*   This program is free software; you can redistribute it and/or modify  *
-#*   it under the terms of the GNU General Public License as published by  *
-#*   the Free Software Foundation; either version 2 of the License, or     *
-#*   (at your option) any later version.                                   *
-#*                                                                         *
-#*   This program is distributed in the hope that it will be useful,       *
-#*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
-#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
-#*   GNU General Public License for more details.                          *
-#*                                                                         *
-#*   You should have received a copy of the GNU General Public License     *
-#*   along with this program; if not, write to the                         *
-#*   Free Software Foundation, Inc.,                                       *
-#*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
-#***************************************************************************
-
-# A simple utility to read a list of files (names composed by numeric prescaler arguments) and compose a C source file defining data structures which hold the binary data read from those files.
-
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at speed_table</A> = ();
-
-printf(&quot;/* This file was created automatically by %s. */\n\n&quot;, $0);
-for $i ('rlink', 'st7') {
-	printf(&quot;#include \&quot;$i.h\&quot;\n&quot;);
-}
-printf(&quot;\n&quot;);
-
-for $prescaler (sort {$b &lt;=&gt; $a} @ARGV) {
-	my(@ary) = (
-		byte_array_from_file(${prescaler} . &quot;_init.dtc&quot;),
-		byte_array_from_file(${prescaler} . &quot;_call.dtc&quot;)
-	);
-
-	for $i (@ary) {
-		$i = sprintf(&quot;%d&quot;, $i);
-	}
-	$bytes = join(', ', @ary);
-	$bytes =~ s/(^|\s)(.{70}?\S*)/\2\n/go;	# break up long lines
-	$bytes =~ s/\n +/\n/go;
-	$bytes =~ s/(^|\n)/\1\t/go;		# format nicely
-	printf(&quot;static const u8 dtc_%d[] = {\n%s\n};\n\n&quot;, $prescaler, $bytes);
-	push(@speed_table, sprintf(&quot;\tdtc_%d, sizeof(dtc_%d), (ST7_FOSC * 2) / (1000 * %d), %d\n&quot;, $prescaler, $prescaler, $prescaler, $prescaler));
-}
-
-printf(&quot;const rlink_speed_table_t rlink_speed_table[] = {{\n%s}};\n\n&quot;, join(&quot;}, {\n&quot;, @speed_table));
-printf(&quot;const size_t rlink_speed_table_size = sizeof(rlink_speed_table) / sizeof(*rlink_speed_table);\n\n&quot;);
-
-
-sub byte_array_from_file {
-	my($filename) = @_;
-
-	my(@array, $text, $i) = ();
-
-	open(IN, '&lt;', $filename) || die &quot;$filename: $!&quot;;
-	undef($/);
-	$text = &lt;IN&gt;;
-	close(IN);
-
-	for($i = 0; $i &lt; length($text); $i++) {
-		push(@array, ord(substr($text, $i, 1)));
-	}
-
-	@array;
-}

Copied: branches/openocd-0.1/tools/rlink_make_speed_table/rlink_make_speed_table.pl (from rev 1324, trunk/tools/rlink_make_speed_table/rlink_make_speed_table.pl)

Copied: branches/openocd-0.1/tools/st7_dtc_as (from rev 1324, trunk/tools/st7_dtc_as)

Deleted: branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as
===================================================================
--- trunk/tools/st7_dtc_as/st7_dtc_as	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,2 +0,0 @@
-#!/bin/sh
-exec perl &quot;$0.pl&quot; $*

Copied: branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as (from rev 1324, trunk/tools/st7_dtc_as/st7_dtc_as)

Deleted: branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as.pl
===================================================================
--- trunk/tools/st7_dtc_as/st7_dtc_as.pl	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as.pl	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,709 +0,0 @@
-#!/bin/perl
-#***************************************************************************
-#*   Copyright (C) 2008 Lou Deluxe                                         *
-#*   <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">lou.openocd012 at fixit.nospammail.net</A>                                   *
-#*                                                                         *
-#*   This program is free software; you can redistribute it and/or modify  *
-#*   it under the terms of the GNU General Public License as published by  *
-#*   the Free Software Foundation; either version 2 of the License, or     *
-#*   (at your option) any later version.                                   *
-#*                                                                         *
-#*   This program is distributed in the hope that it will be useful,       *
-#*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
-#*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
-#*   GNU General Public License for more details.                          *
-#*                                                                         *
-#*   You should have received a copy of the GNU General Public License     *
-#*   along with this program; if not, write to the                         *
-#*   Free Software Foundation, Inc.,                                       *
-#*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
-#***************************************************************************
-
-# A rudimentary assembler for DTC code.
-# It is not robust, by any means, but it gets the job done.
-
-{package DTC_as;
-
-my($i);	# for later loop to generate reverse lookup
-
-sub new {
-	my($self) = bless{};
-
-	$self-&gt;{'pagewidth'} = 60;
-	$self;
-}
-
-
-
-%status_bit_arg = (
-	'STOP' =&gt; 0x01,
-	'ERROR' =&gt; 0x02,
-);
-
-%cp_arg = (
-	'A=&gt;X' =&gt; 0x00,
-	'A&lt;X' =&gt; 0x01,
-	'CARRY' =&gt; 0x02,
-	'ALWAYS' =&gt; 0x03,
-	'ADR_BUFFER0=&gt;CMP0' =&gt; 0x04,
-	'ADR_BUFFER0&lt;CMP0' =&gt; 0x05,
-	'ADR_BUFFER1=&gt;CMP1' =&gt; 0x06,
-	'ADR_BUFFER1&lt;CMP1' =&gt; 0x07,
-);
-
-%shift_unit_arg = (
-	'CARD' =&gt; 0x00,
-	'MPEG' =&gt; 0x08,
-);
-
-%shift_pin_arg = (
-	'PIN0=&gt;IN' =&gt; 0x00,
-	'PIN1=&gt;IN' =&gt; 0x04,
-	'OUT=&gt;PIN0' =&gt; 0x01,
-	'OUT=&gt;PIN1' =&gt; 0x03,
-);
-
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at ld_arg</A> = (
-	'&lt;Y&gt;',
-	'X',
-	'Y',
-	'MASK',
-	'ADR_BUFFER00',
-	'ADR_BUFFER01',
-	'ADR_BUFFER10',
-	'ADR_BUFFER11',
-	'CMP00',
-	'CMP01',
-	'CMP10',
-	'CMP11',
-	'DATA_FLASH',
-	'CTRL_FCI',
-	'CTRL_CARD',
-	'CTRL_MPEG',
-	'DR_PARALLEL',
-	'DDR_PARALLEL',
-	'OR_PARALLEL',
-	'DR_CARD',
-	'DDR_CARD',
-	'OR_CARD',
-	'SHIFT_CARD',
-	'DR_MPEG',
-	'DDR_MPEG',
-	'OR_MPEG',
-	'SHIFT_MPEG',
-	'DATA_BUFFER0',
-	'DATA_BUFFER1',
-	'ECC_CRC',
-	'TMP_ECC',
-	'BUFFER_MNGT'
-);
-
-for($i = 0; $i &lt; @ld_arg; $i++) {
-	$ld_arg{$ld_arg[$i]} = $i;
-}
-
-
-# ADDER8 / SUB8
-sub alu8 {
-	my($self) = shift;
-	my($operand, $i) = shift;
-
-	if(defined($ld_arg{$operand})) {
-		$i = $ld_arg{$operand};
-
-		if($i &gt; 0x00 &amp;&amp; $i &lt; 0x04) {
-			return(($i - 0x01) &lt;&lt; 3);
-		}
-	}
-
-	return undef;
-}
-
-# ADDER16 / SUB16
-sub alu16 {
-	my($self) = shift;
-	my($operand, $i) = shift;
-
-	$operand .= '0';
-
-	if(defined($ld_arg{$operand})) {
-		$i = $ld_arg{$operand};
-
-		if($i &gt; 0x03 &amp;&amp; $i &lt; 0x0c) {
-			return(($i - 0x04) &lt;&lt; 2);
-		}
-	}
-
-	return undef;
-}
-
-
-# BSET / BCLR
-sub bsetorclr {
-	my($self) = shift;
-	my($ret);
-	
-	if(@_ &lt; 1) {
-		return undef;
-	}
-	$ret = $_[0];
-
-	if(($ret &lt; 0) || ($ret &gt; 3)) {
-		return undef;
-	}
-
-	return $ret;
-}
-
-
-# Opcode lookup table
-%op = (
-	'NOP' =&gt; [
-		0x0,
-	],
-	'SEC' =&gt; [
-		0x1,
-	],
-	'CLC' =&gt; [
-		0x2,
-	],
-	'RET' =&gt; [
-		0x3,
-	],
-	'STATUS' =&gt; [
-		0x4,
-		sub {
-			my($self) = shift;
-			my($ret, $i);
-
-			for $i (@_) {
-				if(!defined($status_bit_arg{&quot;\U$i&quot;})) {
-					return undef;
-				}
-
-				$ret |= $status_bit_arg{&quot;\U$i&quot;};
-			}
-			if($ret &lt; 1) {
-				return undef;
-			}
-
-			return $ret;
-		}
-	],
-	'CP' =&gt; [
-		0x8,
-		sub {
-			my($self) = shift;
-			if((@_ != 1) || (!defined($cp_arg{&quot;\U$_[0]&quot;}))) {
-				return undef;
-			}
-			return($cp_arg{&quot;\U$_[0]&quot;});
-		}
-	],
-	'SHIFT' =&gt; [
-		0x10,
-		sub {
-			my($self) = shift;
-			my($ret, $i);
-			
-			if((@_ &lt; 2) || (!defined($shift_unit_arg{&quot;\U$_[0]&quot;}))) {
-				return undef;
-			}
-			$ret = $shift_unit_arg{&quot;\U$_[0]&quot;};
-			shift;
-
-			for $i (@_) {
-				if(!defined($shift_pin_arg{&quot;\U$i&quot;})) {
-					return undef;
-				}
-
-				$ret |= $shift_pin_arg{&quot;\U$i&quot;};
-			}
-
-			return $ret;
-		}
-	],
-	'SUB8' =&gt; [
-		0x24,
-		\&amp;alu8
-	],
-	'ADDER8' =&gt; [
-		0x25,
-		\&amp;alu8
-	],
-	'SUB16' =&gt; [
-		0x26,
-		\&amp;alu16
-	],
-	'ADDER16' =&gt; [
-		0x27,
-		\&amp;alu16
-	],
-	'BCLR' =&gt; [
-		0x28,
-		\&amp;bsetorclr
-	],
-	'BSET' =&gt; [
-		0x38,
-		\&amp;bsetorclr
-	],
-	'REVERSE' =&gt; [
-		0x30,
-	],
-	'XOR' =&gt; [
-		0x31,
-	],
-	'AND' =&gt; [
-		0x32,
-	],
-	'EXCHANGE' =&gt; [
-		0x33,
-	],
-	'DECY' =&gt; [
-		0x3c,
-	],
-	'INCY' =&gt; [
-		0x3d,
-	],
-	'JP' =&gt; [
-		0x40,
-		sub {
-			my($self) = shift;
-			my($i);
-
-			if(@_ != 1) {
-				return undef;
-			}
-			$i = $_[0];
-			if(!defined($self-&gt;{'label'}{$i})) {
-				$i =~ s/^://o;
-				if(!defined($self-&gt;{'label'}{$i})) {
-					# not a defined label
-					undef $i;
-				}
-			}
-
-			if(defined($i)) {
-				$i = $self-&gt;{'label'}{$i} - $self-&gt;{'pc'};
-			} else {
-				$i = $_[0];
-			}
-
-			if($i =~ m/^([+-]?\d+)$/) {
-				$i = 0 + $1;
-				if(($i &gt; 31) || ($i &lt; -31)) {
-					warn &quot;relative jump ($i) out of range&quot;;
-					return undef;
-				}
-				if($i &lt; 0) {
-					return(0x20 - $1);
-				} else {
-					return(0x00 + $1);
-				}
-			}
-
-			return undef;
-		}
-	],
-	'BRANCH' =&gt; [
-		0x60,
-	],
-	'LD' =&gt; [
-		0x80,
-		sub {
-			my($self) = shift;
-			my($i);
-
-#			print STDERR join(&quot;, &quot;, LD, @_), &quot;\n&quot;;
-
-			if(@_ == 1) {
-				$_[1] = 'A';
-			}
-			if(@_ != 2) {
-				return undef;
-			}
-
-				
-			if($_[0] =~ m/^([ML])S[BN]$/o) {
-				# MSB/LSB aka MSN/LSN
-				if($1 eq 'L') {
-					$_[0] = 'A.L';
-				} else {
-					$_[0] = 'A.H';
-				}
-			}
-			if($_[0] =~ m/^A\.([LH])$/o) {
-				# A.L/A.H
-				my($islsb) = ($1 eq 'L') ? 1 : 0;
-				$i = $_[1];
-				if($i =~ s/^0x([0-9a-fA-F])$/hex($1)/e) {
-#					print &quot;$i looks hex\n&quot;;
-				} elsif($i =~ m/^\d+$/) {
-#					print &quot;$i looks decimal\n&quot;;
-				} elsif(defined($self-&gt;{'label'}{$i})) {
-#					print &quot;label match for $i ($self-&gt;{'label'}{$i})\n&quot;;
-					$i = $self-&gt;{'label'}{$i};
-#					print &quot;\$i=$i\n&quot;;
-#					print &quot;\$islsb=$islsb\n&quot;;
-					if($islsb) {
-						$i = ($i &amp; 0xf);
-					} else {
-						$i = ($i &gt;&gt; 4) &amp; 0xf;
-					}
-#					print &quot;\$i=$i\n&quot;;
-				} else {
-					print &quot;no label match for $i\n&quot;;
-					return undef;
-				}
-				if(($i &lt; 0) || ($i &gt; 0xf)) {
-					return undef;
-				}
-				if($islsb) {
-					$i |= 0x10;
-				};
-				return(0x20 | $i);
-			} elsif($_[0] eq 'A') {
-				if(!defined($ld_arg{$_[1]})) {
-					return undef;
-				}
-				return(0x40 | $ld_arg{$_[1]});
-			} elsif($_[1] eq 'A') {
-				if(!defined($ld_arg{$_[0]})) {
-					return undef;
-				}
-				return(0x00 | $ld_arg{$_[0]});
-			}
-
-			return undef;
-		}
-	],
-);
-
-$op{'JR'} = $op{'JP'};
-
-
-sub pass {
-	my($self, $ifh, $ofh, $passnum) = @_;
-
-	# passnum=0 for plain parsing pass to populate label values
-	# passnum=1 for actual pass to assemble
-
-	my($line, $oline, $opcd);
-
-	if($passnum == 0) {
-		delete($self-&gt;{'label'});
-		delete($self-&gt;{'binary'});
-		delete($self-&gt;{'ENTRY'});
-		delete($self-&gt;{'LUT'});
-	}
-
-	seek($ifh, 0, 0); # rewind
-	$self-&gt;{'pc'} = 0;
-	$self-&gt;{'line_number'} = 0;
-	while(defined($line = &lt;$ifh&gt;)) {
-		$self-&gt;{'line_number'}++;
-		$line =~ s/\s+$//so;
-		$oline = $line;
-		$line =~ s/;.*//o;
-		$line =~ s/^\s+//o;
-		@_ = split(/[\s,]+/, $line);
-
-		undef($opcd);
-
-		if(@_ &gt; 0) {
-
-			if(
-				($_[0] =~ s/^://o)
-				||
-				($_[0] =~ s/:$//o)
-			) {
-				if($passnum == 0) {
-					if(defined($self-&gt;{'label'}{$_[0]})) {
-						die &quot;label redefinition for \&quot;$_[0]\&quot; in line $self-&gt;{'line_number'}&quot;;
-					}
-					$self-&gt;{'label'}{$_[0]} = $self-&gt;{'pc'};
-				}
-				shift(@_);
-			}
-
-			if(@_ &gt; 0) {
-				if($passnum == 1) {
-					if((@_ == 3) &amp;&amp; ($_[1] eq '=')) {
-						# convert this = that to LD 
-						$_[1] = $_[0];
-						$_[0] = 'LD';
-					}
-					elsif((@_ == 3) &amp;&amp; ($_[1] eq '+=')) {
-						# convert this += that to ADDER8 or ADDER16
-						if($_[0] eq 'A') {
-							@_ = ('ADDER8', $_[2]);
-						}
-						elsif($_[2] eq 'X') {
-							@_ = ('ADDER16', $_[0]);
-						}
-					}
-					elsif((@_ == 3) &amp;&amp; ($_[1] eq '-=')) {
-						# convert this -= that to ADDER8 or ADDER16
-						if($_[0] eq 'A') {
-							@_ = ('SUB8', $_[2]);
-						}
-						elsif($_[2] eq 'X') {
-							@_ = ('SUB16', $_[0]);
-						}
-					}
-					elsif((@_ == 1) &amp;&amp; ($_[0] =~ m/^(B((SET)|(CLR)))([1-4])$/oi)) {
-						# convert BSETn or BCLRn to BSET n-1 or BCLR n-1
-						$_[0] = $1;
-						$_[1] = $5 - 1;
-					}
-
-					$op = &quot;\U$_[0]&quot;;
-					if(!defined($op{$op})) {
-						die &quot;unknown instruction: $op in line $self-&gt;{'line_number'}&quot;;
-					}
-					shift(@_);
-
-					$op = $op{$op};
-					$sub = $op-&gt;[1];
-					if(defined($sub)) {
-						$opcd = &amp;$sub($self, @_);
-					} else {
-						$opcd = 0;
-					}
-
-					if(!defined($opcd)) {
-						die &quot;bad argument(s) in line $self-&gt;{'line_number'}&quot;;
-					}
-
-					$opcd |= $op-&gt;[0];
-				}
-
-				$self-&gt;{'pc'}++;
-			}
-
-		} else {
-			if($passnum == 0) {
-				if($oline =~ m/^;LUT; (.*)/o) {
-					my($entry, $label) = split(/\s+/, $1);
-					$entry =~ s/^0x//o;
-					$self-&gt;{'LUT'}[hex($entry)] = $label;
-				}
-				if($oline =~ m/^;ENTRY; (.*)/o) {
-					my($id, $label) = split(/\s+/, $1);
-					$self-&gt;{'ENTRY'}{$id} = $label;
-				}
-			}
-		}
-
-		if($passnum == 1) {
-			if(defined($opcd)) {
-				$self-&gt;{'binary'} .= chr($opcd);
-
-				printf $ofh (&quot;/* 0x%02x */ 0x%02x%s /* %-*s */\n&quot;,
-					$self-&gt;{'pc'} - 1,
-					$opcd,
-					(
-						(
-							($self-&gt;{'last pc'} &lt; 0xff)
-							|| 
-							($self-&gt;{'last pc'} != $self-&gt;{'pc'} - 1)
-						) ?
-							','
-						:
-							''
-					),
-					$self-&gt;{'pagewidth'} - 23,
-					$oline
-				);
-			} else {
-				if($oline ne '') {
-					print $ofh &quot;                 /* $oline */\n&quot;;
-				} else {
-					print $ofh &quot;\n&quot;;
-				}
-			}
-		}
-	}
-
-	if($passnum == 0) {
-		$self-&gt;{'last pc'} = $self-&gt;{'pc'} - 1;
-	}
-
-	if($passnum == 1) {
-		while($self-&gt;{'pc'} &lt; 0xff) {
-			printf $ofh (&quot;/* 0x%02x */ 0,\n&quot;,
-				$self-&gt;{'pc'}
-			);
-			$self-&gt;{'pc'}++;
-		}
-		if($self-&gt;{'pc'} &lt; 0x100) {
-			printf $ofh (&quot;/* 0x%02x */ 0\n&quot;,
-				$self-&gt;{'pc'}
-			);
-			$self-&gt;{'pc'}++;
-		}
-	}
-}
-
-} # package DTC_as
-
-
-use Getopt::Std;
-
-%opt = (
-	't' =&gt; 'unsigned char',
-);
-
-# -t type of arrays (defaults to unsigned char)
-# -l lookup table array name (no table generated if not provided)
-# -d DTC code array name (naked elements if not provided)
-# -i input filename (trailing argument if not provided)
-# -o output filename (stdout if not provided)
-getopts('l:d:i:o:t:b', \%opt);
-
-if(defined($opt{'i'})) {
-	$infile = $opt{'i'};
-} else {
-	$infile = shift;
-}
-
-if(!open(IN, '&lt;', $infile)) {
-	die &quot;$infile: $!&quot;;
-}
-
-
-if($opt{'b'}) {
-	if(!defined($opt{'o'})) {
-		die &quot;binary format requires -o&quot;;
-	}
-	if(!open(OUT, '&gt;&amp;', *STDOUT)) {
-		die &quot;dup stdout: $!&quot;;
-	}
-	open(STDOUT, '&gt;&amp;', *STDERR);
-} else {
-	if(defined($opt{'o'})) {
-		if(!open(OUT, '&gt;', $opt{'o'})) {
-			die &quot;$opt{'o'}: $!&quot;;
-		}
-	} else {
-		if(!open(OUT, '&gt;&amp;', *STDOUT)) {
-			die &quot;dup stdout: $!&quot;;
-		}
-		open(STDOUT, '&gt;&amp;', *STDERR);
-	}
-}
-	
-
-$as = new DTC_as;
-
-$as-&gt;pass(*IN, *OUT, 0);
-
-if(defined($opt{'d'})) {
-	print OUT &quot;$opt{'t'} $opt{'d'}&quot;, &quot;[0x100] = {\n&quot;;
-}
-$as-&gt;pass(*IN, *OUT, 1);
-if(defined($opt{'d'})) {
-	print OUT &quot;};\n\n&quot;;
-}
-
-close(IN);
-
-if(defined($opt{'l'})) {
-	print OUT &quot;$opt{'t'} $opt{'l'}&quot;, &quot;[0x40] = {\n&quot;;
-#	$end = @{$as-&gt;{'LUT'}};
-#	if($end &gt; 0x100) {
-#		$end = 0x100;
-#	}
-	for($i = 0xc0; $i &lt; 0x100; $i++) {
-		$label = $as-&gt;{'LUT'}[$i];
-		if(defined($label)) {
-			if(defined($as-&gt;{'label'}{$label})) {
-				printf OUT (&quot;/* 0x%02x */ 0x%02x%s /* %s */\n&quot;,
-					$i,
-					$as-&gt;{'label'}{$label},
-					(($i &lt; 0xff) ? ',' : ''),
-					$label
-				);
-			} else {
-				die &quot;label $label has not been defined&quot;;
-			}
-		} else {
-			printf OUT (&quot;/* 0x%02x */ 0%s\n&quot;,
-				$i,
-				(($i &lt; 0xff) ? ',' : ''),
-			);
-		}
-	}
-	print OUT &quot;};\n\n&quot;;
-}
-
-
-close(OUT);
-
-sub DTCLOAD_COMMENT { 0; }
-sub DTCLOAD_ENTRY { 1; }
-sub DTCLOAD_LOAD { 2; }
-sub DTCLOAD_RUN { 3; }
-sub DTCLOAD_LUT_START { 4; }
-sub DTCLOAD_LUT { 5; }
-
-
-if($opt{'b'}) {
-	open(OUT, &quot;&gt;&quot;, $opt{'o'}) || die &quot;$opt{'o'}: $!&quot;;
-	syswrite(OUT, pack('CC', DTCLOAD_LUT_COMMENT, 3 - 1) . 'DTC');
-	
-	$ref = $as-&gt;{'LUT'};
-	if(@$ref &gt; 0) {
-		for($start = 0; $start &lt; @$ref &amp;&amp; !defined($ref-&gt;[$start]); $start++) {}
-		for($end = 0xff; $end &gt;= $start &amp;&amp; !defined($ref-&gt;[$end]); $end--) {}
-		undef($lut);
-		for($i = $start; $i &lt;= $end; $i++) {
-			if(!defined($ref-&gt;[$i])) {
-				$lut .= &quot;\0&quot;;
-				next;
-			}
-			$label = $ref-&gt;[$i];
-			if(defined($as-&gt;{'label'}{$label})) {
-				$label = $as-&gt;{'label'}{$label};
-#				printf(&quot;adding LUT entry 0x%02x\n&quot;, $label);
-				$lut .= chr($label);
-			} else {
-				die &quot;label $label has not been defined&quot;;
-			}
-		}
-		if(length($lut) &gt; 0) {
-			syswrite(OUT, pack('CCC', DTCLOAD_LUT_START, 1 - 1, $start));
-			syswrite(OUT, pack('CC', DTCLOAD_LUT, length($lut) - 1) . $lut);
-		}
-	}
-
-	while(($key, $label) = each(%{$as-&gt;{'ENTRY'}})) {
-#		print &quot;$key = $label\n&quot;;
-		if(defined($as-&gt;{'label'}{$label})) {
-			$label = $as-&gt;{'label'}{$label};
-#			print &quot;key=$key\n&quot;;
-#			print &quot;label=$label\n&quot;;
-			syswrite(OUT, pack('CCC', DTCLOAD_ENTRY, length($key), $label) . $key);
-		} else {
-			die &quot;label $label has not been defined&quot;;
-		}
-	}
-
-	if(length($as-&gt;{'binary'})) {
-#		printf(&quot;DTC code size: 0x%x\n&quot;, length($as-&gt;{'binary'}));
-		syswrite(OUT, pack('CC',
-			DTCLOAD_LOAD ,
-			length($as-&gt;{'binary'}) - 1
-		) . $as-&gt;{'binary'});
-
-		if(%{$as-&gt;{'ENTRY'}} &lt; 1) {
-			syswrite(OUT, pack('CCC', DTCLOAD_RUN, 1 - 1, 0x00));
-		}
-	}
-
-	close(OUT);
-}
-
-
-0;
-

Copied: branches/openocd-0.1/tools/st7_dtc_as/st7_dtc_as.pl (from rev 1324, trunk/tools/st7_dtc_as/st7_dtc_as.pl)

Copied: branches/openocd-0.1/tools/xsvf_tools (from rev 1324, trunk/tools/xsvf_tools)

Deleted: branches/openocd-0.1/tools/xsvf_tools/svf2xsvf.py
===================================================================
--- trunk/tools/xsvf_tools/svf2xsvf.py	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/tools/xsvf_tools/svf2xsvf.py	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,699 +0,0 @@
-#!/usr/bin/python3.0
-
-# Copyright 2008, SoftPLC Corporation  <A HREF="http://softplc.com">http://softplc.com</A>
-# Dick Hollenbeck <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dick at softplc.com</A>
-
-
-# This program is free software; you can redistribute it and/or
-# modify it under the terms of the GNU General Public License
-# as published by the Free Software Foundation; either version 2
-# of the License, or (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, you may find one here:
-# <A HREF="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">http://www.gnu.org/licenses/old-licenses/gpl-2.0.html</A>
-# or you may search the <A HREF="http://www.gnu.org">http://www.gnu.org</A> website for the version 2 license,
-# or you may write to the Free Software Foundation, Inc.,
-# 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
-
-
-# A python program to convert an SVF file to an XSVF file.  There is an
-# option to include comments containing the source file line number from the origin
-# SVF file before each outputted XSVF statement.
-#
-# We deviate from the XSVF spec in that we introduce a new command called
-# XWAITSTATE which directly flows from the SVF RUNTEST command.  Unfortunately
-# XRUNSTATE was ill conceived and is not used here.  We also add support for the
-# three Lattice extensions to SVF: LCOUNT, LDELAY, and LSDR.  The xsvf file
-# generated from this program is suitable for use with the xsvf player in
-# OpenOCD with my modifications to xsvf.c.
-#
-# This program is written for python 3.0, and it is not easy to change this
-# back to 2.x.  You may find it easier to use python 3.x even if that means
-# building it.
-
-
-import re
-import sys
-import struct
-
-
-# There are both ---&lt;Lexer&gt;--- and ---&lt;Parser&gt;--- sections to this program
-
-
-if len( sys.argv ) &lt; 3:
-    print(&quot;usage %s &lt;svf_filename&gt; &lt;xsvf_filename&gt;&quot; % sys.argv[0])
-    exit(1)
-
-
-inputFilename = sys.argv[1]
-outputFilename = sys.argv[2]
-
-doCOMMENTs = True       # Save XCOMMENTs in the output xsvf file
-#doCOMMENTs = False       # Save XCOMMENTs in the output xsvf file
-
-xrepeat = 0             # argument to XREPEAT, gives retry count for masked compares
-
-
-#-----&lt; Lexer &gt;---------------------------------------------------------------
-
-StateBin = (RESET,IDLE,
-    DRSELECT,DRCAPTURE,DRSHIFT,DREXIT1,DRPAUSE,DREXIT2,DRUPDATE,
-    IRSELECT,IRCAPTURE,IRSHIFT,IREXIT1,IRPAUSE,IREXIT2,IRUPDATE) = range(16)
-
-# Any integer index into this tuple will be equal to its corresponding StateBin value
-StateTxt = (&quot;RESET&quot;,&quot;IDLE&quot;,
-    &quot;DRSELECT&quot;,&quot;DRCAPTURE&quot;,&quot;DRSHIFT&quot;,&quot;DREXIT1&quot;,&quot;DRPAUSE&quot;,&quot;DREXIT2&quot;,&quot;DRUPDATE&quot;,
-    &quot;IRSELECT&quot;,&quot;IRCAPTURE&quot;,&quot;IRSHIFT&quot;,&quot;IREXIT1&quot;,&quot;IRPAUSE&quot;,&quot;IREXIT2&quot;,&quot;IRUPDATE&quot;)
-
-
-(XCOMPLETE,XTDOMASK,XSIR,XSDR,XRUNTEST,hole0,hole1,XREPEAT,XSDRSIZE,XSDRTDO,
-    XSETSDRMASKS,XSDRINC,XSDRB,XSDRC,XSDRE,XSDRTDOB,XSDRTDOC,
-    XSDRTDOE,XSTATE,XENDIR,XENDDR,XSIR2,XCOMMENT,XWAIT,XWAITSTATE,LCOUNT,LDELAY,LSDR) = range(28)
-
-#Note: LCOUNT, LDELAY, and LSDR are Lattice extensions to SVF and provide a way to loop back
-# and check a completion status, essentially waiting on a part until it signals that it is done.
-# For example below: loop 25 times, each time through the loop do a LDELAY (same as a true RUNTEST)
-# and exit loop when LSDR compares match.
-&quot;&quot;&quot;
-LCOUNT	25;
-! Step to DRPAUSE give 5 clocks and wait for 1.00e+000 SEC.
-LDELAY	DRPAUSE	5 TCK	1.00E-003 SEC;
-! Test for the completed status. Match means pass.
-! Loop back to LDELAY line if not match and loop count less than 25.
-LSDR  1 TDI  (0)
-        TDO  (1);
-&quot;&quot;&quot;
-
-LineNumber = 1
-
-def s_ident(scanner, token): return (&quot;ident&quot;, token.upper(), LineNumber)
-
-def s_hex(scanner, token):
-    global LineNumber
-    LineNumber = LineNumber + token.count('\n')
-    token = ''.join(token.split())
-    return (&quot;hex&quot;, token[1:-1], LineNumber)
-
-def s_int(scanner, token): return (&quot;int&quot;, int(token), LineNumber)
-def s_float(scanner, token): return (&quot;float&quot;, float(token), LineNumber)
-#def s_comment(scanner, token): return (&quot;comment&quot;, token, LineNumber)
-def s_semicolon(scanner, token): return (&quot;semi&quot;, token, LineNumber)
-
-def s_nl(scanner,token):
-    global LineNumber
-    LineNumber = LineNumber + 1
-    #print( 'LineNumber=', LineNumber, file=sys.stderr )
-    return None
-
-#2.00E-002
-
-scanner = re.Scanner([
-    (r&quot;[a-zA-Z]\w*&quot;, s_ident),
-#    (r&quot;[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?&quot;, s_float),
-    (r&quot;[-+]?[0-9]+(([.][0-9eE+-]*)|([eE]+[-+]?[0-9]+))&quot;, s_float),
-    (r&quot;\d+&quot;, s_int),
-    (r&quot;\(([0-9a-fA-F]|\s)*\)&quot;, s_hex),
-    (r&quot;(!|//).*$&quot;, None),
-    (r&quot;;&quot;, s_semicolon),
-    (r&quot;\n&quot;,s_nl),
-    (r&quot;\s*&quot;, None),
-    ],
-    re.MULTILINE
-    )
-
-# read all svf file input into string &quot;input&quot;
-input = open( sys.argv[1] ).read()
-
-# Lexer:
-# create a list of tuples containing (tokenType, tokenValue, LineNumber)
-tokens = scanner.scan( input )[0]
-
-input = None    # allow gc to reclaim memory holding file
-
-#for tokenType, tokenValue, ln in tokens: print( &quot;line %d: %s&quot; % (ln, tokenType), tokenValue )
-
-
-#-----&lt;parser&gt;-----------------------------------------------------------------
-
-tokVal = tokType = tokLn = None
-
-tup = iter( tokens )
-
-def nextTok():
-    &quot;&quot;&quot;
-    Function to read the next token from tup into tokType, tokVal, tokLn (linenumber)
-    which are globals.
-    &quot;&quot;&quot;
-    global tokType, tokVal, tokLn, tup
-    tokType, tokVal, tokLn = tup.__next__()
-
-
-class ParseError(Exception):
-    &quot;&quot;&quot;A class to hold a parsing error message&quot;&quot;&quot;
-    def __init__(self, linenumber, token, message):
-        self.linenumber = linenumber
-        self.token = token
-        self.message = message
-    def __str__(self):
-        global inputFilename
-        return &quot;Error in file \'%s\' at line %d near token %s\n %s&quot; % (
-                   inputFilename, self.linenumber, repr(self.token), self.message)
-
-
-class MASKSET(object):
-    &quot;&quot;&quot;
-    Class MASKSET holds a set of bit vectors, all of which are related, will all
-    have the same length, and are associated with one of the seven shiftOps:
-    HIR, HDR, TIR, TDR, SIR, SDR, LSDR. One of these holds a mask, smask, tdi, tdo, and a
-    size.
-    &quot;&quot;&quot;
-    def __init__(self, name):
-        self.empty()
-        self.name = name
-
-    def empty(self):
-        self.mask = bytearray()
-        self.smask = bytearray()
-        self.tdi = bytearray()
-        self.tdo = bytearray()
-        self.size = 0
-
-    def syncLengths( self, sawTDI, sawTDO, sawMASK, sawSMASK, newSize ):
-        &quot;&quot;&quot;
-        Set all the lengths equal in the event some of the masks were
-        not seen as part of the last change set.
-        &quot;&quot;&quot;
-        if self.size == newSize:
-            return
-
-        if newSize == 0:
-            self.empty()
-            return
-
-        # If an SIR was given without a MASK(), then use a mask of all zeros.
-        # this is not consistent with the SVF spec, but it makes sense because
-        # it would be odd to be testing an instruction register read out of a
-        # tap without giving a mask for it.  Also, lattice seems to agree and is
-        # generating SVF files that comply with this philosophy.
-        if self.name == 'SIR' and not sawMASK:
-            self.mask = bytearray( newSize )
-
-        if newSize != len(self.mask):
-            self.mask = bytearray( newSize )
-            if self.name == 'SDR':  # leave mask for HIR,HDR,TIR,TDR,SIR zeros
-                for i in range( newSize ):
-                    self.mask[i] = 1
-
-        if newSize != len(self.tdo):
-            self.tdo = bytearray( newSize )
-
-        if newSize != len(self.tdi):
-            self.tdi = bytearray( newSize )
-
-        if newSize != len(self.smask):
-            self.smask = bytearray( newSize )
-
-        self.size = newSize
-#-----&lt;/MASKSET&gt;-----
-
-
-def makeBitArray( hexString, bitCount ):
-    &quot;&quot;&quot;
-    Converts a packed sequence of hex ascii characters into a bytearray where
-    each element in the array holds exactly one bit. Only &quot;bitCount&quot; bits are
-    scanned and these must be the least significant bits in the hex number. That
-    is, it is legal to have some unused bits in the must significant hex nibble
-    of the input &quot;hexString&quot;. The string is scanned starting from the backend,
-    then just before returning we reverse the array. This way the append()
-    method can be used, which I assume is faster than an insert.
-    &quot;&quot;&quot;
-    global tokLn
-    a = bytearray()
-    length = bitCount
-    hexString = list(hexString)
-    hexString.reverse()
-    #print(hexString)
-    for c in hexString:
-        if length &lt;= 0:
-            break;
-        c = int(c, 16)
-        for mask in [1,2,4,8]:
-            if length &lt;= 0:
-                break;
-            length = length - 1
-            a.append( (c &amp; mask) != 0 )
-    if length &gt; 0:
-        raise ParseError( tokLn, hexString, &quot;Insufficient hex characters for given length of %d&quot; % bitCount )
-    a.reverse()
-    #print(a)
-    return a
-
-
-def makeXSVFbytes( bitarray ):
-    &quot;&quot;&quot;
-    Make a bytearray which is contains the XSVF bits which will be written
-    directly to disk.  The number of bytes needed is calculated from the size
-    of the argument bitarray.
-    &quot;&quot;&quot;
-    bitCount = len(bitarray)
-    byteCount = (bitCount+7)//8
-    ba = bytearray( byteCount )
-    firstBit = (bitCount % 8) - 1
-    if firstBit == -1:
-        firstBit = 7
-    bitNdx = 0
-    for byteNdx in range(byteCount):
-        mask = 1&lt;&lt;firstBit
-        byte = 0
-        while mask:
-            if bitarray[bitNdx]:
-                byte |= mask;
-            mask = mask &gt;&gt; 1
-            bitNdx = bitNdx + 1
-        ba[byteNdx] = byte
-        firstBit = 7
-    return ba
-
-
-def writeComment( outputFile, shiftOp_linenum, shiftOp ):
-    &quot;&quot;&quot;
-    Write an XCOMMENT record to outputFile
-    &quot;&quot;&quot;
-    comment = &quot;%s @%d\0&quot; % (shiftOp, shiftOp_linenum)   # \0 is terminating nul
-    ba = bytearray(1)
-    ba[0] = XCOMMENT
-    ba += comment.encode()
-    outputFile.write( ba )
-
-
-def combineBitVectors( trailer, meat, header ):
-    &quot;&quot;&quot;
-    Combine the 3 bit vectors comprizing a transmission.  Since the least
-    significant bits are sent first, the header is put onto the list last so
-    they are sent first from that least significant position.
-    &quot;&quot;&quot;
-    ret = bytearray()
-    ret.extend( trailer )
-    ret.extend( meat )
-    ret.extend( header )
-    return ret
-
-
-def writeRUNTEST( outputFile, run_state, end_state, run_count, min_time, tokenTxt ):
-    &quot;&quot;&quot;
-    Write the output for the SVF RUNTEST command.
-    run_count - the number of clocks
-    min_time - the number of seconds
-    tokenTxt - either RUNTEST or LDELAY
-    &quot;&quot;&quot;
-    # convert from secs to usecs
-    min_time = int( min_time * 1000000)
-
-    # the SVF RUNTEST command does NOT map to the XSVF XRUNTEST command.  Check the SVF spec, then
-    # read the XSVF command.   They are not the same.  Use an XSVF XWAITSTATE to
-    # implement the required behavior of the SVF RUNTEST command.
-    if doCOMMENTs:
-        writeComment( output, tokLn, tokenTxt )
-
-    if tokenTxt == 'RUNTEST':
-        obuf = bytearray(11)
-        obuf[0] = XWAITSTATE
-        obuf[1] = run_state
-        obuf[2] = end_state
-        struct.pack_into(&quot;&gt;i&quot;, obuf, 3, run_count )  # big endian 4 byte int to obuf
-        struct.pack_into(&quot;&gt;i&quot;, obuf, 7, min_time )   # big endian 4 byte int to obuf
-        outputFile.write( obuf )
-    else:   # == 'LDELAY'
-        obuf = bytearray(10)
-        obuf[0] = LDELAY
-        obuf[1] = run_state
-        # LDELAY has no end_state
-        struct.pack_into(&quot;&gt;i&quot;, obuf, 2, run_count )  # big endian 4 byte int to obuf
-        struct.pack_into(&quot;&gt;i&quot;, obuf, 6, min_time )   # big endian 4 byte int to obuf
-        outputFile.write( obuf )
-
-
-output = open( outputFilename, mode='wb' )
-
-hir = MASKSET('HIR')
-hdr = MASKSET('HDR')
-tir = MASKSET('TIR')
-tdr = MASKSET('TDR')
-sir = MASKSET('SIR')
-sdr = MASKSET('SDR')
-
-
-expecting_eof = True
-
-
-# one of the commands that take the shiftParts after the length, the parse
-# template for all of these commands is identical
-shiftOps = ('SDR', 'SIR', 'LSDR', 'HDR', 'HIR', 'TDR', 'TIR')
-
-# the order must correspond to shiftOps, this holds the MASKSETS.  'LSDR' shares sdr with 'SDR'
-shiftSets = (sdr, sir, sdr, hdr, hir, tdr, tir )
-
-# what to expect as parameters to a shiftOp, i.e. after a SDR length or SIR length
-shiftParts = ('TDI', 'TDO', 'MASK', 'SMASK')
-
-# the set of legal states which can trail the RUNTEST command
-run_state_allowed = ('IRPAUSE', 'DRPAUSE', 'RESET', 'IDLE')
-
-enddr_state_allowed = ('DRPAUSE', 'IDLE')
-endir_state_allowed = ('IRPAUSE', 'IDLE')
-
-enddr_state = IDLE
-endir_state = IDLE
-
-frequency = 	1.00e+006 # HZ;
-
-# change detection for xsdrsize and xtdomask
-xsdrsize = -1           # the last one sent, send only on change
-xtdomask = bytearray()  # the last one sent, send only on change
-
-
-# we use a number of single byte writes for the XSVF command below
-cmdbuf = bytearray(1)
-
-
-# Save the XREPEAT setting into the file as first thing.
-obuf = bytearray(2)
-obuf[0] = XREPEAT
-obuf[1] = xrepeat
-output.write( obuf )
-
-
-try:
-    while 1:
-        expecting_eof = True
-        nextTok()
-        expecting_eof = False
-        # print( tokType, tokVal, tokLn )
-
-        if tokVal in shiftOps:
-            shiftOp_linenum = tokLn
-            shiftOp = tokVal
-
-            set = shiftSets[shiftOps.index(shiftOp)]
-
-            # set flags false, if we see one later, set that one true later
-            sawTDI = sawTDO = sawMASK = sawSMASK = False
-
-            nextTok()
-            if tokType != 'int':
-                raise ParseError( tokLn, tokVal, &quot;Expecting 'int' giving %s length, got '%s'&quot; % (shiftOp, tokType) )
-            length = tokVal
-
-            nextTok()
-
-            while tokVal != ';':
-                if tokVal not in shiftParts:
-                    raise ParseError( tokLn, tokVal, &quot;Expecting TDI, TDO, MASK, SMASK, or ';'&quot;)
-                shiftPart = tokVal
-
-                nextTok()
-
-                if tokType != 'hex':
-                    raise ParseError( tokLn, tokVal, &quot;Expecting hex bits&quot; )
-                bits = makeBitArray( tokVal, length )
-
-                if shiftPart == 'TDI':
-                    sawTDI = True
-                    set.tdi = bits
-
-                elif shiftPart == 'TDO':
-                    sawTDO = True
-                    set.tdo = bits
-
-                elif shiftPart == 'MASK':
-                    sawMASK = True
-                    set.mask = bits
-
-                elif shiftPart == 'SMASK':
-                    sawSMASK = True
-                    set.smask = bits
-
-                nextTok()
-
-            set.syncLengths( sawTDI, sawTDO, sawMASK, sawSMASK, length )
-
-            # process all the gathered parameters and generate outputs here
-            if shiftOp == 'SIR':
-                if doCOMMENTs:
-                    writeComment( output, shiftOp_linenum, 'SIR' )
-
-                tdi = combineBitVectors( tir.tdi, sir.tdi, hir.tdi )
-                if len(tdi) &gt; 255:
-                    obuf = bytearray(3)
-                    obuf[0] = XSIR2
-                    struct.pack_into( &quot;&gt;h&quot;, obuf, 1, len(tdi) )
-                else:
-                    obuf = bytearray(2)
-                    obuf[0] = XSIR
-                    obuf[1] = len(tdi)
-                output.write( obuf )
-                obuf = makeXSVFbytes( tdi )
-                output.write( obuf )
-
-            elif shiftOp == 'SDR':
-                if doCOMMENTs:
-                    writeComment( output, shiftOp_linenum, shiftOp )
-
-                if not sawTDO:
-                    # pass a zero filled bit vector for the sdr.mask
-                    mask = combineBitVectors( tdr.mask, bytearray(sdr.size), hdr.mask )
-                    tdi  = combineBitVectors( tdr.tdi,  sdr.tdi,  hdr.tdi )
-
-                    if xsdrsize != len(tdi):
-                        xsdrsize = len(tdi)
-                        cmdbuf[0] = XSDRSIZE
-                        output.write( cmdbuf )
-                        obuf = bytearray(4)
-                        struct.pack_into( &quot;&gt;i&quot;, obuf, 0, xsdrsize )  # big endian 4 byte int to obuf
-                        output.write( obuf )
-
-                    if xtdomask != mask:
-                        xtdomask = mask
-                        cmdbuf[0] = XTDOMASK
-                        output.write( cmdbuf )
-                        obuf = makeXSVFbytes( mask )
-                        output.write( obuf )
-
-                    cmdbuf[0] = XSDR
-                    output.write( cmdbuf )
-                    obuf = makeXSVFbytes( tdi )
-                    output.write( obuf )
-
-                else:
-                    mask = combineBitVectors( tdr.mask, sdr.mask, hdr.mask )
-                    tdi  = combineBitVectors( tdr.tdi,  sdr.tdi,  hdr.tdi )
-                    tdo  = combineBitVectors( tdr.tdo,  sdr.tdo,  hdr.tdo )
-
-                    if xsdrsize != len(tdi):
-                        xsdrsize = len(tdi)
-                        cmdbuf[0] = XSDRSIZE
-                        output.write( cmdbuf )
-                        obuf = bytearray(4)
-                        struct.pack_into(&quot;&gt;i&quot;, obuf, 0, xsdrsize )  # big endian 4 byte int to obuf
-                        output.write( obuf )
-
-                    if xtdomask != mask:
-                        xtdomask = mask
-                        cmdbuf[0] = XTDOMASK
-                        output.write( cmdbuf )
-                        obuf = makeXSVFbytes( mask )
-                        output.write( obuf )
-
-                    cmdbuf[0] = XSDRTDO
-                    output.write( cmdbuf )
-                    obuf = makeXSVFbytes( tdi )
-                    output.write( obuf )
-                    obuf = makeXSVFbytes( tdo )
-                    output.write( obuf )
-                    #print( &quot;len(tdo)=&quot;, len(tdo), &quot;len(tdr.tdo)=&quot;, len(tdr.tdo), &quot;len(sdr.tdo)=&quot;, len(sdr.tdo), &quot;len(hdr.tdo)=&quot;, len(hdr.tdo) )
-
-            elif shiftOp == 'LSDR':
-                if doCOMMENTs:
-                    writeComment( output, shiftOp_linenum, shiftOp )
-
-                mask = combineBitVectors( tdr.mask, sdr.mask, hdr.mask )
-                tdi  = combineBitVectors( tdr.tdi,  sdr.tdi,  hdr.tdi )
-                tdo  = combineBitVectors( tdr.tdo,  sdr.tdo,  hdr.tdo )
-
-                if xsdrsize != len(tdi):
-                    xsdrsize = len(tdi)
-                    cmdbuf[0] = XSDRSIZE
-                    output.write( cmdbuf )
-                    obuf = bytearray(4)
-                    struct.pack_into(&quot;&gt;i&quot;, obuf, 0, xsdrsize )  # big endian 4 byte int to obuf
-                    output.write( obuf )
-
-                if xtdomask != mask:
-                    xtdomask = mask
-                    cmdbuf[0] = XTDOMASK
-                    output.write( cmdbuf )
-                    obuf = makeXSVFbytes( mask )
-                    output.write( obuf )
-
-                cmdbuf[0] = LSDR
-                output.write( cmdbuf )
-                obuf = makeXSVFbytes( tdi )
-                output.write( obuf )
-                obuf = makeXSVFbytes( tdo )
-                output.write( obuf )
-                #print( &quot;len(tdo)=&quot;, len(tdo), &quot;len(tdr.tdo)=&quot;, len(tdr.tdo), &quot;len(sdr.tdo)=&quot;, len(sdr.tdo), &quot;len(hdr.tdo)=&quot;, len(hdr.tdo) )
-
-        elif tokVal == 'RUNTEST' or tokVal == 'LDELAY':
-            # e.g. from lattice tools:
-            # &quot;RUNTEST	IDLE  	5 TCK	1.00E-003 SEC;&quot;
-            saveTok = tokVal
-            nextTok()
-            min_time = 0
-            run_count = 0
-            max_time = 600  # ten minutes
-            if tokVal in run_state_allowed:
-                run_state = StateTxt.index(tokVal)
-                end_state = run_state  # bottom of page 17 of SVF spec
-                nextTok()
-            if tokType != 'int' and tokType != 'float':
-                raise ParseError( tokLn, tokVal, &quot;Expecting 'int' or 'float' after RUNTEST [run_state]&quot;)
-            timeval = tokVal;
-            nextTok()
-            if tokVal != 'TCK' and tokVal != 'SEC' and tokVal != 'SCK':
-                raise ParseError( tokLn, tokVal, &quot;Expecting 'TCK' or 'SEC' or 'SCK' after RUNTEST [run_state] (run_count|min_time)&quot;)
-            if tokVal == 'TCK' or tokVal == 'SCK':
-                run_count = int( timeval )
-            else:
-                min_time = timeval
-            nextTok()
-            if tokType == 'int' or tokType == 'float':
-                min_time = tokVal
-                nextTok()
-                if tokVal != 'SEC':
-                    raise ParseError( tokLn, tokVal, &quot;Expecting 'SEC' after RUNTEST [run_state] run_count min_time&quot;)
-                nextTok()
-            if tokVal == 'MAXIMUM':
-                nextTok()
-                if tokType != 'int' and tokType != 'float':
-                    raise ParseError( tokLn, tokVal, &quot;Expecting 'max_time' after RUNTEST [run_state] min_time SEC MAXIMUM&quot;)
-                max_time = tokVal
-                nextTok()
-                if tokVal != 'SEC':
-                    raise ParseError( tokLn, tokVal, &quot;Expecting 'max_time' after RUNTEST [run_state] min_time SEC MAXIMUM max_time&quot;)
-                nextTok()
-            if tokVal == 'ENDSTATE':
-                nextTok()
-                if tokVal not in run_state_allowed:
-                    raise ParseError( tokLn, tokVal, &quot;Expecting 'run_state' after RUNTEST .... ENDSTATE&quot;)
-                end_state = StateTxt.index(tokVal)
-                nextTok()
-            if tokVal != ';':
-                raise ParseError( tokLn, tokVal, &quot;Expecting ';' after RUNTEST ....&quot;)
-            # print( &quot;run_count=&quot;, run_count, &quot;min_time=&quot;, min_time,
-                # &quot;max_time=&quot;, max_time, &quot;run_state=&quot;, State[run_state], &quot;end_state=&quot;, State[end_state] )
-            writeRUNTEST( output, run_state, end_state, run_count, min_time, saveTok )
-
-        elif tokVal == 'LCOUNT':
-            nextTok()
-            if tokType != 'int':
-                raise ParseError( tokLn, tokVal, &quot;Expecting integer 'count' after LCOUNT&quot;)
-            loopCount = tokVal
-            nextTok()
-            if tokVal != ';':
-                raise ParseError( tokLn, tokVal, &quot;Expecting ';' after LCOUNT count&quot;)
-            if doCOMMENTs:
-                writeComment( output, tokLn, 'LCOUNT' )
-            obuf = bytearray(5)
-            obuf[0] = LCOUNT
-            struct.pack_into(&quot;&gt;i&quot;, obuf, 1, loopCount )  # big endian 4 byte int to obuf
-            output.write( obuf )
-
-        elif tokVal == 'ENDDR':
-            nextTok()
-            if tokVal not in enddr_state_allowed:
-                raise ParseError( tokLn, tokVal, &quot;Expecting 'stable_state' after ENDDR. (one of: DRPAUSE, IDLE)&quot;)
-            enddr_state = StateTxt.index(tokVal)
-            nextTok()
-            if tokVal != ';':
-                raise ParseError( tokLn, tokVal, &quot;Expecting ';' after ENDDR stable_state&quot;)
-            if doCOMMENTs:
-                writeComment( output, tokLn, 'ENDDR' )
-            obuf = bytearray(2)
-            obuf[0] = XENDDR
-            # Page 10 of the March 1999 SVF spec shows that RESET is also allowed here.
-            # Yet the XSVF spec has no provision for that, and uses a non-standard, i.e.
-            # boolean argument to XENDDR which only handles two of the 3 intended states.
-            obuf[1] = 1 if enddr_state == DRPAUSE else 0
-            output.write( obuf )
-
-        elif tokVal == 'ENDIR':
-            nextTok()
-            if tokVal not in endir_state_allowed:
-                raise ParseError( tokLn, tokVal, &quot;Expecting 'stable_state' after ENDIR. (one of: IRPAUSE, IDLE)&quot;)
-            endir_state = StateTxt.index(tokVal)
-            nextTok()
-            if tokVal != ';':
-                raise ParseError( tokLn, tokVal, &quot;Expecting ';' after ENDIR stable_state&quot;)
-            if doCOMMENTs:
-                writeComment( output, tokLn, 'ENDIR' )
-            obuf = bytearray(2)
-            obuf[0] = XENDIR
-            # Page 10 of the March 1999 SVF spec shows that RESET is also allowed here.
-            # Yet the XSVF spec has no provision for that, and uses a non-standard, i.e.
-            # boolean argument to XENDDR which only handles two of the 3 intended states.
-            obuf[1] = 1 if endir_state == IRPAUSE else 0
-            output.write( obuf )
-
-        elif tokVal == 'STATE':
-            nextTok()
-            ln = tokLn
-            while tokVal != ';':
-                if tokVal not in StateTxt:
-                    raise ParseError( tokLn, tokVal, &quot;Expecting 'stable_state' after STATE&quot;)
-                stable_state = StateTxt.index( tokVal )
-
-                if doCOMMENTs and ln != -1:
-                    writeComment( output, ln, 'STATE' )
-                    ln = -1     # save comment only once
-
-                obuf = bytearray(2)
-                obuf[0] = XSTATE
-                obuf[1] = stable_state
-                output.write( obuf )
-                nextTok()
-
-        elif tokVal == 'FREQUENCY':
-            nextTok()
-            if tokVal != ';':
-                if tokType != 'int' and tokType != 'float':
-                    raise ParseError( tokLn, tokVal, &quot;Expecting 'cycles HZ' after FREQUENCY&quot;)
-                frequency = tokVal
-                nextTok()
-                if tokVal != 'HZ':
-                    raise ParseError( tokLn, tokVal, &quot;Expecting 'HZ' after FREQUENCY cycles&quot;)
-                nextTok()
-                if tokVal != ';':
-                    raise ParseError( tokLn, tokVal, &quot;Expecting ';' after FREQUENCY cycles HZ&quot;)
-
-        else:
-            raise ParseError( tokLn, tokVal, &quot;Unknown token '%s'&quot; % tokVal)
-
-except StopIteration:
-    if not expecting_eof:
-        print( &quot;Unexpected End of File at line &quot;, tokLn )
-
-except ParseError as pe:
-    print( &quot;\n&quot;, pe )
-
-finally:
-    # print( &quot;closing file&quot; )
-    cmdbuf[0] = XCOMPLETE
-    output.write( cmdbuf )
-    output.close()
-

Copied: branches/openocd-0.1/tools/xsvf_tools/svf2xsvf.py (from rev 1324, trunk/tools/xsvf_tools/svf2xsvf.py)

Deleted: branches/openocd-0.1/tools/xsvf_tools/xsvfdump.py
===================================================================
--- trunk/tools/xsvf_tools/xsvfdump.py	2009-01-15 20:58:17 UTC (rev 1324)
+++ branches/openocd-0.1/tools/xsvf_tools/xsvfdump.py	2009-01-16 06:43:11 UTC (rev 1325)
@@ -1,255 +0,0 @@
-#!/usr/bin/python3.0
-
-# Copyright 2008, SoftPLC Corporation  <A HREF="http://softplc.com">http://softplc.com</A>
-# Dick Hollenbeck <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dick at softplc.com</A>
-
-# This program is free software; you can redistribute it and/or
-# modify it under the terms of the GNU General Public License
-# as published by the Free Software Foundation; either version 2
-# of the License, or (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, you may find one here:
-# <A HREF="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">http://www.gnu.org/licenses/old-licenses/gpl-2.0.html</A>
-# or you may search the <A HREF="http://www.gnu.org">http://www.gnu.org</A> website for the version 2 license,
-# or you may write to the Free Software Foundation, Inc.,
-# 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
-
-# Dump an Xilinx XSVF file to stdout
-
-# This program is written for python 3.0, and it is not easy to change this
-# back to 2.x.  You may find it easier to use python 3.x even if that means
-# building it.
-
-
-import sys
-import struct
-
-
-LABEL = &quot;A script to dump an XSVF file to stdout&quot;
-
-
-Xsdrsize = 0
-
-
-(XCOMPLETE,XTDOMASK,XSIR,XSDR,XRUNTEST,hole0,hole1,XREPEAT,XSDRSIZE,XSDRTDO,
-    XSETSDRMASKS,XSDRINC,XSDRB,XSDRC,XSDRE,XSDRTDOB,XSDRTDOC,
-    XSDRTDOE,XSTATE,XENDIR,XENDDR,XSIR2,XCOMMENT,XWAIT,XWAITSTATE,LCOUNT,LDELAY,LSDR) = range(28)
-
-
-(RESET,IDLE,
-    DRSELECT,DRCAPTURE,DRSHIFT,DREXIT1,DRPAUSE,DREXIT2,DRUPDATE,
-    IRSELECT,IRCAPTURE,IRSHIFT,IREXIT1,IRPAUSE,IREXIT2,IRUPDATE) = range(16)
-
-
-State = (&quot;RESET&quot;,&quot;IDLE&quot;,
-    &quot;DRSELECT&quot;,&quot;DRCAPTURE&quot;,&quot;DRSHIFT&quot;,&quot;DREXIT1&quot;,&quot;DRPAUSE&quot;,&quot;DREXIT2&quot;,&quot;DRUPDATE&quot;,
-    &quot;IRSELECT&quot;,&quot;IRCAPTURE&quot;,&quot;IRSHIFT&quot;,&quot;IREXIT1&quot;,&quot;IRPAUSE&quot;,&quot;IREXIT2&quot;,&quot;IRUPDATE&quot;)
-
-Setsdrmasks = 0
-SetsdrmasksOnesCount = 0
-
-def ReadSDRMASKS( f, len ):
-    global Setsdrmasks, SetsdrmasksOnesCount
-    byteCount = (len+7)//8
-    Setsdrmasks = f.read( byteCount )
-    ls = []
-    SetsdrmasksOnesCount = 0
-    for b in Setsdrmasks:
-        ls.append( &quot;%x&quot; % ((b &amp; 0xf0) &gt;&gt; 4) )
-        ls.append( &quot;%x&quot; % ( b &amp; 0x0f ) )
-        for i in range(8):
-            if b &amp; (1&lt;&lt;i):
-                SetsdrmasksOnesCount = SetsdrmasksOnesCount +1
-    return ''.join(ls)
-
-
-def bytes2hexString( f, len ):
-    byteCount = (len+7)//8
-    bytebuf = f.read( byteCount )
-    ls = []
-    for b in bytebuf:
-        ls.append( &quot;%x&quot; % ((b &amp; 0xf0) &gt;&gt; 4) )
-        ls.append( &quot;%x&quot; % ( b &amp; 0x0f ) )
-    return ''.join(ls)
-
-
-def ReadByte( f ):
-    &quot;&quot;&quot;Read a byte from a file and return it as an int in least significant 8 bits&quot;&quot;&quot;
-    b = f.read(1)
-    if b:
-        return 0xff &amp; b[0];
-    else:
-        return -1
-
-
-def ShowState( state ):
-    &quot;&quot;&quot;return the given state int as a state string&quot;&quot;&quot;
-    #return &quot;0x%02x&quot; % state # comment this out to get textual state form
-    global State
-    if 0 &lt;= state &lt;= IRUPDATE:
-        return State[state]
-    else:
-        return &quot;Unknown state 0x%02x&quot; % state
-
-
-def ShowOpcode( op, f ):
-    &quot;&quot;&quot;return the given byte as an opcode string&quot;&quot;&quot;
-    global Xsdrsize
-    if op == XCOMPLETE:
-        print(&quot;XCOMPLETE&quot;)
-
-    elif op == XTDOMASK:
-        buf = bytes2hexString( f, Xsdrsize )
-        print(&quot;XTDOMASK 0x%s&quot; % buf)
-
-    elif op == XSIR:
-        len = ReadByte( f )
-        buf = bytes2hexString( f, len )
-        print(&quot;XSIR 0x%02X 0x%s&quot; % (len, buf))
-
-    elif op == XSDR:
-        tdi = bytes2hexString( f, Xsdrsize )
-        print(&quot;XSDR 0x%s&quot; % tdi)
-
-    elif op == XRUNTEST:
-        len = struct.unpack( '&gt;i', f.read(4) )[0]
-        print(&quot;XRUNTEST 0x%08X&quot; % len)
-
-    elif op == XREPEAT:
-        len = ReadByte( f )
-        print(&quot;XREPEAT 0x%02X&quot; % len)
-
-    elif op == XSDRSIZE:
-        Xsdrsize = struct.unpack( '&gt;i', f.read(4) )[0]
-        #print(&quot;XSDRSIZE 0x%08X&quot; % Xsdrsize, file=sys.stderr )
-        print(&quot;XSDRSIZE 0x%08X %d&quot; % (Xsdrsize, Xsdrsize) )
-
-    elif op == XSDRTDO:
-        tdi = bytes2hexString( f, Xsdrsize )
-        tdo = bytes2hexString( f, Xsdrsize )
-        print(&quot;XSDRTDO 0x%s 0x%s&quot; % (tdi, tdo) )
-
-    elif op == XSETSDRMASKS:
-        addrmask = bytes2hexString( f, Xsdrsize )
-        datamask = ReadSDRMASKS( f, Xsdrsize )
-        print(&quot;XSETSDRMASKS 0x%s 0x%s&quot; % (addrmask, datamask) )
-
-    elif op == XSDRINC:
-        startaddr = bytes2hexString( f, Xsdrsize )
-        len = ReadByte(f)
-        print(&quot;XSDRINC 0x%s 0x%02X&quot; % (startaddr, len), end='' )
-        for numTimes in range(len):
-            data = bytes2hexString( f, SetsdrmasksOnesCount)
-            print(&quot; 0x%s&quot; % data )
-        print() # newline
-
-    elif op == XSDRB:
-        tdi = bytes2hexString( f, Xsdrsize )
-        print(&quot;XSDRB 0x%s&quot; % tdi )
-
-    elif op == XSDRC:
-        tdi = bytes2hexString( f, Xsdrsize )
-        print(&quot;XSDRC 0x%s&quot; % tdi )
-
-    elif op == XSDRE:
-        tdi = bytes2hexString( f, Xsdrsize )
-        print(&quot;XSDRE 0x%s&quot; % tdi )
-
-    elif op == XSDRTDOB:
-        tdo = bytes2hexString( f, Xsdrsize )
-        print(&quot;XSDRTDOB 0x%s&quot; % tdo )
-
-    elif op == XSDRTDOC:
-        tdi = bytes2hexString( f, Xsdrsize )
-        tdo = bytes2hexString( f, Xsdrsize )
-        print(&quot;XSDRTDOC 0x%s 0x%s&quot; % (tdi, tdo) )
-
-    elif op == XSDRTDOE:
-        tdi = bytes2hexString( f, Xsdrsize )
-        tdo = bytes2hexString( f, Xsdrsize )
-        print(&quot;XSDRTDOE 0x%s 0x%s&quot; % (tdi, tdo) )
-
-    elif op == XSTATE:
-        b = ReadByte(f)
-        print(&quot;XSTATE %s&quot; % ShowState(b))
-
-    elif op == XENDIR:
-        b = ReadByte( f )
-        print(&quot;XENDIR %s&quot; % 'IRPAUSE' if b==1 else 'IDLE')
-
-    elif op == XENDDR:
-        b = ReadByte( f )
-        print(&quot;XENDDR %s&quot; % 'DRPAUSE' if b==1 else 'IDLE')
-
-    elif op == XSIR2:
-        len = struct.unpack( '&gt;H', f.read(2) )[0]
-        buf = bytes2hexString( f, len )
-        print(&quot;XSIR2 0x%04X 0x%s&quot; % (len, buf))
-
-    elif op == XCOMMENT:
-        cmt = []
-        while 1:
-            b = ReadByte(f)
-            if b == 0:          # terminating nul
-                break;
-            cmt.append( chr(b) )
-        print(&quot;XCOMMENT \&quot;%s\&quot;&quot; % ''.join(cmt)  )
-
-    elif op == XWAIT:
-        run_state = ReadByte(f)
-        end_state = ReadByte(f)
-        useconds  = struct.unpack( '&gt;i', f.read(4) )[0]
-        print(&quot;XWAIT %s %s&quot; % (ShowState(run_state), ShowState(end_state)), useconds)
-
-    elif op == XWAITSTATE:
-        run_state = ReadByte(f)
-        end_state = ReadByte(f)
-        clocks    = struct.unpack( '&gt;i', f.read(4) )[0]
-        useconds  = struct.unpack( '&gt;i', f.read(4) )[0]
-        print(&quot;XWAITSTATE %s %s CLOCKS=%d USECS=%d&quot; % (ShowState(run_state), ShowState(end_state), clocks, useconds) )
-
-    elif op == LCOUNT:
-        loop_count = struct.unpack( '&gt;i', f.read(4) )[0]
-        print(&quot;LCOUNT&quot;, loop_count )
-
-    elif op == LDELAY:
-        run_state = ReadByte(f)
-        clocks    = struct.unpack( '&gt;i', f.read(4) )[0]
-        useconds  = struct.unpack( '&gt;i', f.read(4) )[0]
-        print(&quot;LDELAY %s CLOCKS=%d USECS=%d&quot; % (ShowState(run_state), clocks, useconds) )
-
-    elif op == LSDR:
-        tdi = bytes2hexString( f, Xsdrsize )
-        tdo = bytes2hexString( f, Xsdrsize )
-        print(&quot;LSDR 0x%s 0x%s&quot; % (tdi, tdo) )
-
-    else:
-        print(&quot;UNKNOWN op 0x%02X %d&quot; % (op, op))
-        exit(1)
-
-
-def main():
-
-    if len( sys.argv ) &lt; 2:
-        print(&quot;usage %s &lt;xsvf_filename&gt;&quot; % sys.argv[0])
-        exit(1)
-
-    f = open( sys.argv[1], 'rb' )
-
-    opcode = ReadByte( f )
-    while opcode != -1:
-        # print the position within the file, then the command
-        print( &quot;%d: &quot; % f.tell(), end='' )
-        ShowOpcode( opcode, f )
-        opcode = ReadByte(f)
-
-
-if __name__ == &quot;__main__&quot;:
-    main()
-

Copied: branches/openocd-0.1/tools/xsvf_tools/xsvfdump.py (from rev 1324, trunk/tools/xsvf_tools/xsvfdump.py)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000108.html">[Openocd-svn] r1324 - in trunk: src/target/board	testing/examples/ledtest-imx27ads testing/examples/ledtest-imx31pdk
</A></li>
	<LI>Next message: <A HREF="000109.html">[Openocd-svn] r1326 - branches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#114">[ date ]</a>
              <a href="thread.html#114">[ thread ]</a>
              <a href="subject.html#114">[ subject ]</a>
              <a href="author.html#114">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
