<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-svn] r2396 - in trunk/src: flash helper
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-June/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-svn%5D%20r2396%20-%20in%20trunk/src%3A%20flash%20helper&In-Reply-To=%3C200906240938.n5O9cCaj022683%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001179.html">
   <LINK REL="Next"  HREF="001181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-svn] r2396 - in trunk/src: flash helper</H1>
    <B>zwelch at mail.berlios.de</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-svn%5D%20r2396%20-%20in%20trunk/src%3A%20flash%20helper&In-Reply-To=%3C200906240938.n5O9cCaj022683%40sheep.berlios.de%3E"
       TITLE="[Openocd-svn] r2396 - in trunk/src: flash helper">zwelch at mail.berlios.de
       </A><BR>
    <I>Wed Jun 24 11:38:12 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001179.html">[Openocd-svn] r2395 - in trunk/src: flash helper
</A></li>
        <LI>Next message: <A HREF="001181.html">[Openocd-svn] r2397 - in trunk/src: flash helper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1180">[ date ]</a>
              <a href="thread.html#1180">[ thread ]</a>
              <a href="subject.html#1180">[ subject ]</a>
              <a href="author.html#1180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: zwelch
Date: 2009-06-24 11:38:08 +0200 (Wed, 24 Jun 2009)
New Revision: 2396

Modified:
   trunk/src/flash/at91sam3.c
   trunk/src/helper/membuf.c
   trunk/src/helper/membuf.h
Log:
Remove whitespace that occurs before ')'.
- Replace '[ \t]*[)]' with ')'.


Modified: trunk/src/flash/at91sam3.c
===================================================================
--- trunk/src/flash/at91sam3.c	2009-06-24 09:38:01 UTC (rev 2395)
+++ trunk/src/flash/at91sam3.c	2009-06-24 09:38:08 UTC (rev 2396)
@@ -100,7 +100,7 @@
 
 
 static float
-_tomhz(uint32_t freq_hz )
+_tomhz(uint32_t freq_hz)
 {
 	float f;
 
@@ -224,34 +224,34 @@
 
 struct sam3_reg_list {
 	uint32_t address;  size_t struct_offset; const char *name;
-	void (*explain_func)(struct sam3_chip *pInfo );
+	void (*explain_func)(struct sam3_chip *pInfo);
 };
 
 
 static struct sam3_chip *all_sam3_chips;
 
 static struct sam3_chip *
-get_current_sam3(struct command_context_s *cmd_ctx )
+get_current_sam3(struct command_context_s *cmd_ctx)
 {
 	target_t *t;
 	static struct sam3_chip *p;
 
-	t = get_current_target(cmd_ctx );
-	if (!t ){
+	t = get_current_target(cmd_ctx);
+	if (!t){
 		command_print(cmd_ctx, &quot;No current target?&quot;);
 		return NULL;
 	}
 
 	p = all_sam3_chips;
-	if (!p ){
+	if (!p){
 		// this should not happen
 		// the command is not registered until the chip is created?
 		command_print(cmd_ctx, &quot;No SAM3 chips exist?&quot;);
 		return NULL;
 	}
 
-	while (p ){
-		if (p-&gt;target == t ){
+	while (p){
+		if (p-&gt;target == t){
 			return p;
 		}
 		p = p-&gt;next;
@@ -540,10 +540,10 @@
  * @param v        - result goes here
  */
 static int 
-EFC_GetStatus(struct sam3_bank_private *pPrivate, uint32_t *v )
+EFC_GetStatus(struct sam3_bank_private *pPrivate, uint32_t *v)
 {
 	int r;
-	r = target_read_u32(pPrivate-&gt;pChip-&gt;target, pPrivate-&gt;controller_address + offset_EFC_FSR, v );
+	r = target_read_u32(pPrivate-&gt;pChip-&gt;target, pPrivate-&gt;controller_address + offset_EFC_FSR, v);
 	LOG_DEBUG(&quot;Status: 0x%08x (lockerror: %d, cmderror: %d, ready: %d)&quot;, 
 			  (unsigned int)(*v),
 			  ((unsigned int)((*v &gt;&gt; 2) &amp; 1)),
@@ -558,12 +558,12 @@
  * @param v        - result goes here
  */
 static int 
-EFC_GetResult(struct sam3_bank_private *pPrivate, uint32_t *v )
+EFC_GetResult(struct sam3_bank_private *pPrivate, uint32_t *v)
 {
 	int r;
 	uint32_t rv;
-	r = target_read_u32(pPrivate-&gt;pChip-&gt;target, pPrivate-&gt;controller_address + offset_EFC_FRR, &amp;rv );
-	if (v ){
+	r = target_read_u32(pPrivate-&gt;pChip-&gt;target, pPrivate-&gt;controller_address + offset_EFC_FRR, &amp;rv);
+	if (v){
 		*v = rv;
 	}
 	LOG_DEBUG(&quot;Result: 0x%08x&quot;, ((unsigned int)(rv)));
@@ -572,7 +572,7 @@
 
 static int
 EFC_StartCommand(struct sam3_bank_private *pPrivate,
-				 unsigned command, unsigned argument )
+				 unsigned command, unsigned argument)
 {
 	uint32_t n,v;
 	int r;
@@ -593,16 +593,16 @@
 	case AT91C_EFC_FCMD_SLB:
 	case AT91C_EFC_FCMD_CLB:
 		n = (pPrivate-&gt;size_bytes / pPrivate-&gt;page_size);
-		if (argument &gt;= n ){
+		if (argument &gt;= n){
 			LOG_ERROR(&quot;*BUG*: Embedded flash has only %u pages&quot;, (unsigned)(n));
 		}
 		break;
 		
 	case AT91C_EFC_FCMD_SFB:
 	case AT91C_EFC_FCMD_CFB:
-		if (argument &gt;= pPrivate-&gt;pChip-&gt;details.n_gpnvms ){
+		if (argument &gt;= pPrivate-&gt;pChip-&gt;details.n_gpnvms){
 			LOG_ERROR(&quot;*BUG*: Embedded flash has only %d GPNVMs&quot;, 
-					  pPrivate-&gt;pChip-&gt;details.n_gpnvms );
+					  pPrivate-&gt;pChip-&gt;details.n_gpnvms);
 		}
 		break;
 		
@@ -612,8 +612,8 @@
 	case AT91C_EFC_FCMD_GFB:
 	case AT91C_EFC_FCMD_STUI:
 	case AT91C_EFC_FCMD_SPUI:
-		if (argument != 0 ){
-			LOG_ERROR(&quot;Argument is meaningless for cmd: %d&quot;, command );
+		if (argument != 0){
+			LOG_ERROR(&quot;Argument is meaningless for cmd: %d&quot;, command);
 		}
 		break;
 	default:
@@ -621,42 +621,42 @@
 		break;
     }
 
-	if (command == AT91C_EFC_FCMD_SPUI ){
+	if (command == AT91C_EFC_FCMD_SPUI){
 		// this is a very special situation.
 		// Situation (1) - error/retry - see below
 		//      And we are being called recursively
 		// Situation (2) - normal, finished reading unique id
 	} else {
 		// it should be &quot;ready&quot;
-		EFC_GetStatus(pPrivate, &amp;v );
-		if (v &amp; 1 ){
+		EFC_GetStatus(pPrivate, &amp;v);
+		if (v &amp; 1){
 			// then it is ready
 			// we go on
 		} else {
-			if (retry ){
+			if (retry){
 				// we have done this before
 				// the controller is not responding.
-				LOG_ERROR(&quot;flash controller(%d) is not ready! Error&quot;, pPrivate-&gt;bank_number );
+				LOG_ERROR(&quot;flash controller(%d) is not ready! Error&quot;, pPrivate-&gt;bank_number);
 				return ERROR_FAIL;
 			} else {
 				retry++;
 				LOG_ERROR(&quot;Flash controller(%d) is not ready, attempting reset&quot;, 
-						  pPrivate-&gt;bank_number );
+						  pPrivate-&gt;bank_number);
 				// we do that by issuing the *STOP* command
-				EFC_StartCommand(pPrivate, AT91C_EFC_FCMD_SPUI, 0 );
+				EFC_StartCommand(pPrivate, AT91C_EFC_FCMD_SPUI, 0);
 				// above is recursive, and further recursion is blocked by 
-				// if (command == AT91C_EFC_FCMD_SPUI ) above
+				// if (command == AT91C_EFC_FCMD_SPUI) above
 				goto do_retry;
 			}
 		}
 	}
 
 	v = (0x5A &lt;&lt; 24) | (argument &lt;&lt; 8) | command;
-	LOG_DEBUG(&quot;Command: 0x%08x&quot;, ((unsigned int)(v)) );
+	LOG_DEBUG(&quot;Command: 0x%08x&quot;, ((unsigned int)(v)));
 	r = target_write_u32(pPrivate-&gt;pBank-&gt;target, 
 						  pPrivate-&gt;controller_address + offset_EFC_FCR,
 						  v);
-	if (r != ERROR_OK ){
+	if (r != ERROR_OK){
 		LOG_DEBUG(&quot;Error Write failed&quot;);
 	}
 	return r;
@@ -681,12 +681,12 @@
 	long long ms_now, ms_end;
 
 	// default 
-	if (status ){
+	if (status){
 		*status = 0;
 	}
 
-	r = EFC_StartCommand(pPrivate, command, argument );
-	if (r != ERROR_OK ){
+	r = EFC_StartCommand(pPrivate, command, argument);
+	if (r != ERROR_OK){
 		return r;
 	}
 
@@ -694,22 +694,22 @@
 
 
     do {
-		r = EFC_GetStatus(pPrivate, &amp;v );
-		if (r != ERROR_OK ){
+		r = EFC_GetStatus(pPrivate, &amp;v);
+		if (r != ERROR_OK){
 			return r;
 		}
 		ms_now = timeval_ms();
-		if (ms_now &gt; ms_end ){
+		if (ms_now &gt; ms_end){
 			// error
 			LOG_ERROR(&quot;Command timeout&quot;);
 			return ERROR_FAIL;
 		}
     }
-    while ((v &amp; 1) == 0 )
+    while ((v &amp; 1) == 0)
 		;
 
 	// error bits..
-	if (status ){
+	if (status){
 		*status = (v &amp; 0x6);
 	}
 	return ERROR_OK;
@@ -728,7 +728,7 @@
  */
 
 static int
-FLASHD_ReadUniqueID (struct sam3_bank_private *pPrivate )
+FLASHD_ReadUniqueID (struct sam3_bank_private *pPrivate)
 {
 	int r;
 	uint32_t v;
@@ -741,21 +741,21 @@
 
 	LOG_DEBUG(&quot;Begin&quot;);
 	r = EFC_StartCommand(pPrivate, AT91C_EFC_FCMD_STUI, 0);
-	if (r &lt; 0 ){
+	if (r &lt; 0){
 		return r;
 	}
 
-	for (x = 0 ; x &lt; 4 ; x++ ){
+	for (x = 0 ; x &lt; 4 ; x++){
 		r = target_read_u32(pPrivate-&gt;pChip-&gt;target, 
 							 pPrivate-&gt;pBank-&gt;base + (x * 4),
-							 &amp;v );
-		if (r &lt; 0 ){
+							 &amp;v);
+		if (r &lt; 0){
 			return r;
 		}
 		pPrivate-&gt;pChip-&gt;cfg.unique_id[x] = v;
 	}
 
-    r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_SPUI, 0, NULL );
+    r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_SPUI, 0, NULL);
 	LOG_DEBUG(&quot;End: R=%d, id = 0x%08x, 0x%08x, 0x%08x, 0x%08x&quot;,
 			  r, 
 			  (unsigned int)(pPrivate-&gt;pChip-&gt;cfg.unique_id[0]),
@@ -770,10 +770,10 @@
  * @param pPrivate - the info about the bank.
  */
 static int
-FLASHD_EraseEntireBank(struct sam3_bank_private *pPrivate )
+FLASHD_EraseEntireBank(struct sam3_bank_private *pPrivate)
 {
 	LOG_DEBUG(&quot;Here&quot;);
-	return EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_EA, 0, NULL );
+	return EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_EA, 0, NULL);
 }
 
 
@@ -792,27 +792,27 @@
 	int r;
 
 	LOG_DEBUG(&quot;Here&quot;);
-	if (pPrivate-&gt;bank_number != 0 ){
+	if (pPrivate-&gt;bank_number != 0){
 		LOG_ERROR(&quot;GPNVM only works with Bank0&quot;);
 		return ERROR_FAIL;
 	}
 
-	if (gpnvm &gt;= pPrivate-&gt;pChip-&gt;details.n_gpnvms ){
+	if (gpnvm &gt;= pPrivate-&gt;pChip-&gt;details.n_gpnvms){
 		LOG_ERROR(&quot;Invalid GPNVM %d, max: %d, ignored&quot;,
-				  gpnvm,pPrivate-&gt;pChip-&gt;details.n_gpnvms );
+				  gpnvm,pPrivate-&gt;pChip-&gt;details.n_gpnvms);
 		return ERROR_FAIL;
 	}
 
     // Get GPNVMs status
-	r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_GFB, 0, NULL );
-	if (r != ERROR_OK ){
+	r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_GFB, 0, NULL);
+	if (r != ERROR_OK){
 		LOG_ERROR(&quot;Failed&quot;);
 		return r;
 	}
 
-    r = EFC_GetResult(pPrivate, &amp;v );
+    r = EFC_GetResult(pPrivate, &amp;v);
 
-	if (puthere ){
+	if (puthere){
 		// Check if GPNVM is set
 		// get the bit and make it a 0/1 
 		*puthere = (v &gt;&gt; gpnvm) &amp; 1;
@@ -836,19 +836,19 @@
 	unsigned v;
 
 	LOG_DEBUG(&quot;Here&quot;);
-	if (pPrivate-&gt;bank_number != 0 ){
+	if (pPrivate-&gt;bank_number != 0){
 		LOG_ERROR(&quot;GPNVM only works with Bank0&quot;);
 		return ERROR_FAIL;
 	}
 
-	if (gpnvm &gt;= pPrivate-&gt;pChip-&gt;details.n_gpnvms ){
+	if (gpnvm &gt;= pPrivate-&gt;pChip-&gt;details.n_gpnvms){
 		LOG_ERROR(&quot;Invalid GPNVM %d, max: %d, ignored&quot;,
-				  gpnvm,pPrivate-&gt;pChip-&gt;details.n_gpnvms );
+				  gpnvm,pPrivate-&gt;pChip-&gt;details.n_gpnvms);
 		return ERROR_FAIL;
 	}
 
-	r = FLASHD_GetGPNVM(pPrivate, gpnvm, &amp;v );
-	if (r != ERROR_OK ){
+	r = FLASHD_GetGPNVM(pPrivate, gpnvm, &amp;v);
+	if (r != ERROR_OK){
 		LOG_DEBUG(&quot;Failed: %d&quot;,r);
 		return r;
 	}
@@ -869,27 +869,27 @@
 	int r;
 	unsigned v;
 
-	if (pPrivate-&gt;bank_number != 0 ){
+	if (pPrivate-&gt;bank_number != 0){
 		LOG_ERROR(&quot;GPNVM only works with Bank0&quot;);
 		return ERROR_FAIL;
 	}
 
-	if (gpnvm &gt;= pPrivate-&gt;pChip-&gt;details.n_gpnvms ){
+	if (gpnvm &gt;= pPrivate-&gt;pChip-&gt;details.n_gpnvms){
 		LOG_ERROR(&quot;Invalid GPNVM %d, max: %d, ignored&quot;,
-				  gpnvm,pPrivate-&gt;pChip-&gt;details.n_gpnvms );
+				  gpnvm,pPrivate-&gt;pChip-&gt;details.n_gpnvms);
 		return ERROR_FAIL;
 	}
 
-	r = FLASHD_GetGPNVM(pPrivate, gpnvm, &amp;v );
-	if (r != ERROR_OK ){
+	r = FLASHD_GetGPNVM(pPrivate, gpnvm, &amp;v);
+	if (r != ERROR_OK){
 		return r;
 	}
-	if (v ){
+	if (v){
 		// already set
 		r = ERROR_OK;
 	} else {
 		// set it
-		r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_SFB, gpnvm, NULL );
+		r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_SFB, gpnvm, NULL);
 	}
 	return r;
 }
@@ -902,13 +902,13 @@
  */
 
 static int 
-FLASHD_GetLockBits(struct sam3_bank_private *pPrivate, uint32_t *v )
+FLASHD_GetLockBits(struct sam3_bank_private *pPrivate, uint32_t *v)
 {
 	int r;
 	LOG_DEBUG(&quot;Here&quot;);
     r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_GLB, 0, NULL);
-	if (r == ERROR_OK ){
-		r = EFC_GetResult(pPrivate, v );
+	if (r == ERROR_OK){
+		r = EFC_GetResult(pPrivate, v);
 	}
 	LOG_DEBUG(&quot;End: %d&quot;,r);
 	return r;
@@ -924,7 +924,7 @@
 static int
 FLASHD_Unlock(struct sam3_bank_private *pPrivate,
 			   unsigned start_sector,
-			   unsigned end_sector )
+			   unsigned end_sector)
 {
 	int r;
 	uint32_t status;
@@ -937,7 +937,7 @@
     while (start_sector &lt;= end_sector){
 		pg = start_sector * pages_per_sector;
 
-        r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_CLB, pg, &amp;status );
+        r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_CLB, pg, &amp;status);
         if (r != ERROR_OK) {
             return r;
         }
@@ -958,7 +958,7 @@
 static int 
 FLASHD_Lock(struct sam3_bank_private *pPrivate,
 			 unsigned start_sector,
-			 unsigned end_sector )
+			 unsigned end_sector)
 {
 	uint32_t status;
 	uint32_t pg;
@@ -971,7 +971,7 @@
     while (start_sector &lt;= end_sector){
 		pg = start_sector * pages_per_sector;
 
-        r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_SLB, pg, &amp;status );
+        r = EFC_PerformCommand(pPrivate, AT91C_EFC_FCMD_SLB, pg, &amp;status);
         if (r != ERROR_OK) {
             return r;
         }
@@ -986,15 +986,15 @@
 /* begin helpful debug code */
 
 static void
-sam3_sprintf(struct sam3_chip *pChip , const char *fmt, ... )
+sam3_sprintf(struct sam3_chip *pChip , const char *fmt, ...)
 {
 	va_list ap;
 	va_start(ap,fmt);
-	if (pChip-&gt;mbuf == NULL ){
+	if (pChip-&gt;mbuf == NULL){
 		return;
 	}
 
-	membuf_vsprintf(pChip-&gt;mbuf, fmt, ap );
+	membuf_vsprintf(pChip-&gt;mbuf, fmt, ap);
 	va_end(ap);
 }
 
@@ -1013,7 +1013,7 @@
 	// extract the field
 	v = value &gt;&gt; shift;
 	v = v &amp; ((1 &lt;&lt; width)-1);
-	if (width &lt;= 16 ){
+	if (width &lt;= 16){
 		hwidth = 4;
 		dwidth = 5;
 	} else {
@@ -1025,7 +1025,7 @@
 	sam3_sprintf(pChip, &quot;\t%*s: %*d [0x%0*x] &quot;, 
 				  REG_NAME_WIDTH, regname,
 				  dwidth, v,
-				  hwidth, v  );
+				  hwidth, v);
 	return v;
 }
 
@@ -1137,9 +1137,9 @@
 	
 };
 
-static const char *_yes_or_no(uint32_t v )
+static const char *_yes_or_no(uint32_t v)
 {
-	if (v ){
+	if (v){
 		return &quot;YES&quot;;
 	} else {
 		return &quot;NO&quot;;
@@ -1151,27 +1151,27 @@
 };
 
 static void 
-sam3_explain_ckgr_mor(struct sam3_chip *pChip )
+sam3_explain_ckgr_mor(struct sam3_chip *pChip)
 {
 	uint32_t v;
 	uint32_t rcen;
 
-	v = sam3_reg_fieldname(pChip, &quot;MOSCXTEN&quot;, pChip-&gt;cfg.CKGR_MOR, 0, 1 );
+	v = sam3_reg_fieldname(pChip, &quot;MOSCXTEN&quot;, pChip-&gt;cfg.CKGR_MOR, 0, 1);
 	sam3_sprintf(pChip, &quot;(main xtal enabled: %s)\n&quot;,
-				  _yes_or_no(v) );
-	v = sam3_reg_fieldname(pChip, &quot;MOSCXTBY&quot;, pChip-&gt;cfg.CKGR_MOR, 1, 1 ); 
+				  _yes_or_no(v));
+	v = sam3_reg_fieldname(pChip, &quot;MOSCXTBY&quot;, pChip-&gt;cfg.CKGR_MOR, 1, 1); 
 	sam3_sprintf(pChip, &quot;(main osc bypass: %s)\n&quot;,
-				  _yes_or_no(v) );
-	rcen = sam3_reg_fieldname(pChip, &quot;MOSCRCEN&quot;, pChip-&gt;cfg.CKGR_MOR, 2, 1 );
+				  _yes_or_no(v));
+	rcen = sam3_reg_fieldname(pChip, &quot;MOSCRCEN&quot;, pChip-&gt;cfg.CKGR_MOR, 2, 1);
 	sam3_sprintf(pChip, &quot;(onchip RC-OSC enabled: %s)\n&quot;,
-				  _yes_or_no(rcen) );
-	v = sam3_reg_fieldname(pChip, &quot;MOSCRCF&quot;, pChip-&gt;cfg.CKGR_MOR, 4, 3 );
+				  _yes_or_no(rcen));
+	v = sam3_reg_fieldname(pChip, &quot;MOSCRCF&quot;, pChip-&gt;cfg.CKGR_MOR, 4, 3);
 	sam3_sprintf(pChip, &quot;(onchip RC-OSC freq: %s)\n&quot;,
-				  _rc_freq[v] );
+				  _rc_freq[v]);
 
 	pChip-&gt;cfg.rc_freq = 0;
-	if (rcen ){
-		switch (v ){
+	if (rcen){
+		switch (v){
 		default:
 			pChip-&gt;cfg.rc_freq = 0;
 		case 0:
@@ -1186,14 +1186,14 @@
 		}
 	}
 
-	v = sam3_reg_fieldname(pChip,&quot;MOSCXTST&quot;, pChip-&gt;cfg.CKGR_MOR, 8, 8 );
+	v = sam3_reg_fieldname(pChip,&quot;MOSCXTST&quot;, pChip-&gt;cfg.CKGR_MOR, 8, 8);
 	sam3_sprintf(pChip, &quot;(startup clks, time= %f uSecs)\n&quot;,
 				  ((float)(v * 1000000)) / ((float)(pChip-&gt;cfg.slow_freq)));
-	v = sam3_reg_fieldname(pChip, &quot;MOSCSEL&quot;, pChip-&gt;cfg.CKGR_MOR, 24, 1 );
+	v = sam3_reg_fieldname(pChip, &quot;MOSCSEL&quot;, pChip-&gt;cfg.CKGR_MOR, 24, 1);
 	sam3_sprintf(pChip, &quot;(mainosc source: %s)\n&quot;,
 				  v ? &quot;external xtal&quot; : &quot;internal RC&quot;);
 	
-	v = sam3_reg_fieldname(pChip,&quot;CFDEN&quot;, pChip-&gt;cfg.CKGR_MOR, 25, 1 );
+	v = sam3_reg_fieldname(pChip,&quot;CFDEN&quot;, pChip-&gt;cfg.CKGR_MOR, 25, 1);
 	sam3_sprintf(pChip, &quot;(clock failure enabled: %s)\n&quot;,
 				 _yes_or_no(v));
 }
@@ -1201,97 +1201,97 @@
 	
 
 static void 
-sam3_explain_chipid_cidr(struct sam3_chip *pChip )
+sam3_explain_chipid_cidr(struct sam3_chip *pChip)
 {
 	int x;
 	uint32_t v;
 	const char *cp;
 
-	sam3_reg_fieldname(pChip, &quot;Version&quot;, pChip-&gt;cfg.CHIPID_CIDR, 0, 5 );
+	sam3_reg_fieldname(pChip, &quot;Version&quot;, pChip-&gt;cfg.CHIPID_CIDR, 0, 5);
 	sam3_sprintf(pChip,&quot;\n&quot;);
 
-	v = sam3_reg_fieldname(pChip, &quot;EPROC&quot;, pChip-&gt;cfg.CHIPID_CIDR, 5, 3 );
+	v = sam3_reg_fieldname(pChip, &quot;EPROC&quot;, pChip-&gt;cfg.CHIPID_CIDR, 5, 3);
 	sam3_sprintf(pChip, &quot;%s\n&quot;, eproc_names[v]);
 	
-	v = sam3_reg_fieldname(pChip, &quot;NVPSIZE&quot;, pChip-&gt;cfg.CHIPID_CIDR, 8, 4 );
+	v = sam3_reg_fieldname(pChip, &quot;NVPSIZE&quot;, pChip-&gt;cfg.CHIPID_CIDR, 8, 4);
 	sam3_sprintf(pChip, &quot;%s\n&quot;, nvpsize[v]);
 
-	v = sam3_reg_fieldname(pChip, &quot;NVPSIZE2&quot;, pChip-&gt;cfg.CHIPID_CIDR, 12, 4 );
+	v = sam3_reg_fieldname(pChip, &quot;NVPSIZE2&quot;, pChip-&gt;cfg.CHIPID_CIDR, 12, 4);
 	sam3_sprintf(pChip, &quot;%s\n&quot;, nvpsize2[v]);
 
-	v = sam3_reg_fieldname(pChip, &quot;SRAMSIZE&quot;, pChip-&gt;cfg.CHIPID_CIDR, 16,4 );
-	sam3_sprintf(pChip, &quot;%s\n&quot;, sramsize[ v ] );
+	v = sam3_reg_fieldname(pChip, &quot;SRAMSIZE&quot;, pChip-&gt;cfg.CHIPID_CIDR, 16,4);
+	sam3_sprintf(pChip, &quot;%s\n&quot;, sramsize[ v ]);
 
-	v = sam3_reg_fieldname(pChip, &quot;ARCH&quot;, pChip-&gt;cfg.CHIPID_CIDR, 20, 8 );
+	v = sam3_reg_fieldname(pChip, &quot;ARCH&quot;, pChip-&gt;cfg.CHIPID_CIDR, 20, 8);
 	cp = _unknown;
-	for (x = 0 ; archnames[x].name ; x++ ){
-		if (v == archnames[x].value ){
+	for (x = 0 ; archnames[x].name ; x++){
+		if (v == archnames[x].value){
 			cp = archnames[x].name;
 			break;
 		}
 	}
 	
-	sam3_sprintf(pChip, &quot;%s\n&quot;, cp );
+	sam3_sprintf(pChip, &quot;%s\n&quot;, cp);
 
-	v = sam3_reg_fieldname(pChip, &quot;NVPTYP&quot;, pChip-&gt;cfg.CHIPID_CIDR, 28, 3 );
-	sam3_sprintf(pChip, &quot;%s\n&quot;, nvptype[ v ] );
+	v = sam3_reg_fieldname(pChip, &quot;NVPTYP&quot;, pChip-&gt;cfg.CHIPID_CIDR, 28, 3);
+	sam3_sprintf(pChip, &quot;%s\n&quot;, nvptype[ v ]);
 
-	v = sam3_reg_fieldname(pChip, &quot;EXTID&quot;, pChip-&gt;cfg.CHIPID_CIDR, 31, 1 );
+	v = sam3_reg_fieldname(pChip, &quot;EXTID&quot;, pChip-&gt;cfg.CHIPID_CIDR, 31, 1);
 	sam3_sprintf(pChip, &quot;(exists: %s)\n&quot;, _yes_or_no(v));
 }
 
 static void 
-sam3_explain_ckgr_mcfr(struct sam3_chip *pChip )
+sam3_explain_ckgr_mcfr(struct sam3_chip *pChip)
 {
 	uint32_t v;
 
 	
-	v = sam3_reg_fieldname(pChip, &quot;MAINFRDY&quot;, pChip-&gt;cfg.CKGR_MCFR, 16, 1 );
-	sam3_sprintf(pChip, &quot;(main ready: %s)\n&quot;, _yes_or_no(v ));
+	v = sam3_reg_fieldname(pChip, &quot;MAINFRDY&quot;, pChip-&gt;cfg.CKGR_MCFR, 16, 1);
+	sam3_sprintf(pChip, &quot;(main ready: %s)\n&quot;, _yes_or_no(v));
 
-	v = sam3_reg_fieldname(pChip, &quot;MAINF&quot;, pChip-&gt;cfg.CKGR_MCFR, 0, 16 );
+	v = sam3_reg_fieldname(pChip, &quot;MAINF&quot;, pChip-&gt;cfg.CKGR_MCFR, 0, 16);
 	
 	v = (v * pChip-&gt;cfg.slow_freq) / 16;
 	pChip-&gt;cfg.mainosc_freq = v;
 
 	sam3_sprintf(pChip, &quot;(%3.03f Mhz (%d.%03dkhz slowclk)\n&quot;,
-				 _tomhz(v ),
+				 _tomhz(v),
 				 pChip-&gt;cfg.slow_freq / 1000,
 				 pChip-&gt;cfg.slow_freq % 1000);
 
 }
 
 static void
-sam3_explain_ckgr_plla(struct sam3_chip *pChip )
+sam3_explain_ckgr_plla(struct sam3_chip *pChip)
 {
 	uint32_t mula,diva;
 
-	diva = sam3_reg_fieldname(pChip, &quot;DIVA&quot;, pChip-&gt;cfg.CKGR_PLLAR, 0, 8 );
+	diva = sam3_reg_fieldname(pChip, &quot;DIVA&quot;, pChip-&gt;cfg.CKGR_PLLAR, 0, 8);
 	sam3_sprintf(pChip,&quot;\n&quot;);
-	mula = sam3_reg_fieldname(pChip, &quot;MULA&quot;, pChip-&gt;cfg.CKGR_PLLAR, 16, 11 );
+	mula = sam3_reg_fieldname(pChip, &quot;MULA&quot;, pChip-&gt;cfg.CKGR_PLLAR, 16, 11);
 	sam3_sprintf(pChip,&quot;\n&quot;);
 	pChip-&gt;cfg.plla_freq = 0;
-	if (mula == 0 ){
+	if (mula == 0){
 		sam3_sprintf(pChip,&quot;\tPLLA Freq: (Disabled,mula = 0)\n&quot;);
-	} else if (diva == 0 ){
+	} else if (diva == 0){
 		sam3_sprintf(pChip,&quot;\tPLLA Freq: (Disabled,diva = 0)\n&quot;);
-	} else if (diva == 1 ){
+	} else if (diva == 1){
 		pChip-&gt;cfg.plla_freq = (pChip-&gt;cfg.mainosc_freq * (mula + 1));
 		sam3_sprintf(pChip,&quot;\tPLLA Freq: %3.03f MHz\n&quot;,
-					 _tomhz(pChip-&gt;cfg.plla_freq ));
+					 _tomhz(pChip-&gt;cfg.plla_freq));
 	}
 }
 		
 		
 static void
-sam3_explain_mckr(struct sam3_chip *pChip )
+sam3_explain_mckr(struct sam3_chip *pChip)
 {
 	uint32_t css, pres,fin;
 	int pdiv;
 	const char *cp;
 
-	css = sam3_reg_fieldname(pChip, &quot;CSS&quot;, pChip-&gt;cfg.PMC_MCKR, 0, 2 );
-	switch (css &amp; 3 ){
+	css = sam3_reg_fieldname(pChip, &quot;CSS&quot;, pChip-&gt;cfg.PMC_MCKR, 0, 2);
+	switch (css &amp; 3){
 	case 0:
 		fin = pChip-&gt;cfg.slow_freq;
 		cp = &quot;slowclk&quot;;
@@ -1305,7 +1305,7 @@
 		cp  = &quot;plla&quot;;
 		break;
 	case 3:
-		if (pChip-&gt;cfg.CKGR_UCKR &amp; (1 &lt;&lt; 16) ){
+		if (pChip-&gt;cfg.CKGR_UCKR &amp; (1 &lt;&lt; 16)){
 			fin = 480 * 1000 * 1000;
 			cp = &quot;upll&quot;;
 		} else {
@@ -1317,9 +1317,9 @@
 
 	sam3_sprintf(pChip, &quot;%s (%3.03f Mhz)\n&quot;,
 				  cp, 
-				  _tomhz(fin ) );
-	pres = sam3_reg_fieldname(pChip, &quot;PRES&quot;, pChip-&gt;cfg.PMC_MCKR, 4, 3 );
-	switch (pres &amp; 0x07 ){
+				  _tomhz(fin));
+	pres = sam3_reg_fieldname(pChip, &quot;PRES&quot;, pChip-&gt;cfg.PMC_MCKR, 4, 3);
+	switch (pres &amp; 0x07){
 	case 0:
 		pdiv = 1;
 		cp = &quot;selected clock&quot;;
@@ -1352,7 +1352,7 @@
 		cp = &quot;clock/6&quot;;
 		break;
 	}
-	sam3_sprintf(pChip, &quot;(%s)\n&quot;, cp );
+	sam3_sprintf(pChip, &quot;(%s)\n&quot;, cp);
 	fin = fin / pdiv;
 	// sam3 has a *SINGLE* clock - 
 	// other at91 series parts have divisors for these.
@@ -1360,22 +1360,22 @@
 	pChip-&gt;cfg.mclk_freq = fin;
 	pChip-&gt;cfg.fclk_freq = fin;
 	sam3_sprintf(pChip, &quot;\t\tResult CPU Freq: %3.03f\n&quot;,
-				  _tomhz(fin ) );
+				  _tomhz(fin));
 }
 	
 #if 0
 static struct sam3_chip *
-target2sam3(target_t *pTarget )
+target2sam3(target_t *pTarget)
 {
 	struct sam3_chip *pChip;
 
-	if (pTarget == NULL ){
+	if (pTarget == NULL){
 		return NULL;
 	}
 
 	pChip = all_sam3_chips;
 	while (pChip){
-		if (pChip-&gt;target == pTarget ){
+		if (pChip-&gt;target == pTarget){
 			break; // return below
 		} else {
 			pChip = pChip-&gt;next;
@@ -1386,7 +1386,7 @@
 #endif
 
 static uint32_t *
-sam3_get_reg_ptr(struct sam3_cfg *pCfg, const struct sam3_reg_list *pList )
+sam3_get_reg_ptr(struct sam3_cfg *pCfg, const struct sam3_reg_list *pList)
 {
 	// this function exists to help 
 	// keep funky offsetof() errors
@@ -1395,29 +1395,29 @@
 	// By using prototypes - we can detect what would
 	// be casting errors.
 
-	return ((uint32_t *)(((char *)(pCfg)) + pList-&gt;struct_offset ));
+	return ((uint32_t *)(((char *)(pCfg)) + pList-&gt;struct_offset));
 }
 	
 	
-#define SAM3_ENTRY(NAME, FUNC )  { .address = SAM3_ ## NAME, .struct_offset = offsetof(struct sam3_cfg, NAME ), #NAME, FUNC }
+#define SAM3_ENTRY(NAME, FUNC)  { .address = SAM3_ ## NAME, .struct_offset = offsetof(struct sam3_cfg, NAME), #NAME, FUNC }
 static const struct sam3_reg_list sam3_all_regs[] = {
-	SAM3_ENTRY(CKGR_MOR , sam3_explain_ckgr_mor ),
-	SAM3_ENTRY(CKGR_MCFR , sam3_explain_ckgr_mcfr ),
-	SAM3_ENTRY(CKGR_PLLAR , sam3_explain_ckgr_plla ),
-	SAM3_ENTRY(CKGR_UCKR , NULL ),
-	SAM3_ENTRY(PMC_FSMR , NULL ),
-	SAM3_ENTRY(PMC_FSPR , NULL ),
-	SAM3_ENTRY(PMC_IMR , NULL ),
-	SAM3_ENTRY(PMC_MCKR , sam3_explain_mckr ),
-	SAM3_ENTRY(PMC_PCK0 , NULL ),
-	SAM3_ENTRY(PMC_PCK1 , NULL ),
-	SAM3_ENTRY(PMC_PCK2 , NULL ),
-	SAM3_ENTRY(PMC_PCSR , NULL ),
-	SAM3_ENTRY(PMC_SCSR , NULL ),
-	SAM3_ENTRY(PMC_SR , NULL ),
-	SAM3_ENTRY(CHIPID_CIDR , sam3_explain_chipid_cidr ),
-	SAM3_ENTRY(CHIPID_EXID , NULL ),
-	SAM3_ENTRY(SUPC_CR, NULL ),
+	SAM3_ENTRY(CKGR_MOR , sam3_explain_ckgr_mor),
+	SAM3_ENTRY(CKGR_MCFR , sam3_explain_ckgr_mcfr),
+	SAM3_ENTRY(CKGR_PLLAR , sam3_explain_ckgr_plla),
+	SAM3_ENTRY(CKGR_UCKR , NULL),
+	SAM3_ENTRY(PMC_FSMR , NULL),
+	SAM3_ENTRY(PMC_FSPR , NULL),
+	SAM3_ENTRY(PMC_IMR , NULL),
+	SAM3_ENTRY(PMC_MCKR , sam3_explain_mckr),
+	SAM3_ENTRY(PMC_PCK0 , NULL),
+	SAM3_ENTRY(PMC_PCK1 , NULL),
+	SAM3_ENTRY(PMC_PCK2 , NULL),
+	SAM3_ENTRY(PMC_PCSR , NULL),
+	SAM3_ENTRY(PMC_SCSR , NULL),
+	SAM3_ENTRY(PMC_SR , NULL),
+	SAM3_ENTRY(CHIPID_CIDR , sam3_explain_chipid_cidr),
+	SAM3_ENTRY(CHIPID_EXID , NULL),
+	SAM3_ENTRY(SUPC_CR, NULL),
 
 	// TERMINATE THE LIST
 	{ .name = NULL }
@@ -1428,7 +1428,7 @@
 
 
 static struct sam3_bank_private *
-get_sam3_bank_private(flash_bank_t *bank )
+get_sam3_bank_private(flash_bank_t *bank)
 {
 	return (struct sam3_bank_private *)(bank-&gt;driver_priv);
 }
@@ -1438,7 +1438,7 @@
  *    Determine the register name, address from the all registers table.
  */
 static const struct sam3_reg_list *
-sam3_GetReg(struct sam3_chip *pChip, uint32_t *goes_here )
+sam3_GetReg(struct sam3_chip *pChip, uint32_t *goes_here)
 {
 	const struct sam3_reg_list *pReg;
 
@@ -1449,10 +1449,10 @@
 		// calculate where this one go..
 		// it is &quot;possibly&quot; this register.
 		
-		pPossible = ((uint32_t *)(((char *)(&amp;(pChip-&gt;cfg))) + pReg-&gt;struct_offset ));
+		pPossible = ((uint32_t *)(((char *)(&amp;(pChip-&gt;cfg))) + pReg-&gt;struct_offset));
 
 		// well? Is it this register
-		if (pPossible == goes_here ){
+		if (pPossible == goes_here){
 			// Jump for joy!
 			return pReg;
 		}
@@ -1467,20 +1467,20 @@
 
 
 static int
-sam3_ReadThisReg(struct sam3_chip *pChip, uint32_t *goes_here )
+sam3_ReadThisReg(struct sam3_chip *pChip, uint32_t *goes_here)
 {
 	const struct sam3_reg_list *pReg;
 	int r;
 
-	pReg = sam3_GetReg(pChip, goes_here );
-	if (!pReg ){
+	pReg = sam3_GetReg(pChip, goes_here);
+	if (!pReg){
 		return ERROR_FAIL;
 	}
 
-	r = target_read_u32(pChip-&gt;target, pReg-&gt;address, goes_here );
-	if (r != ERROR_OK ){
+	r = target_read_u32(pChip-&gt;target, pReg-&gt;address, goes_here);
+	if (r != ERROR_OK){
 		LOG_ERROR(&quot;Cannot read SAM3 register: %s @ 0x%08x, Err: %d\n&quot;,
-				  pReg-&gt;name, (unsigned)(pReg-&gt;address), r );
+				  pReg-&gt;name, (unsigned)(pReg-&gt;address), r);
 	}
 	return r;
 }
@@ -1488,18 +1488,18 @@
 	
 
 static int
-sam3_ReadAllRegs(struct sam3_chip *pChip )
+sam3_ReadAllRegs(struct sam3_chip *pChip)
 {
 	int r;
 	const struct sam3_reg_list *pReg;
 
 	pReg = &amp;(sam3_all_regs[0]);
-	while (pReg-&gt;name ){
+	while (pReg-&gt;name){
 		r = sam3_ReadThisReg(pChip, 
-								  sam3_get_reg_ptr(&amp;(pChip-&gt;cfg), pReg ) );
-		if (r != ERROR_OK ){
+								  sam3_get_reg_ptr(&amp;(pChip-&gt;cfg), pReg));
+		if (r != ERROR_OK){
 			LOG_ERROR(&quot;Cannot read SAM3 registere: %s @ 0x%08x, Error: %d\n&quot;,
-					  pReg-&gt;name, ((unsigned)(pReg-&gt;address)), r );
+					  pReg-&gt;name, ((unsigned)(pReg-&gt;address)), r);
 			return r;
 		}
 		
@@ -1511,35 +1511,35 @@
 
 
 static int
-sam3_GetInfo(struct sam3_chip *pChip )
+sam3_GetInfo(struct sam3_chip *pChip)
 {
 	const struct sam3_reg_list *pReg;
 	uint32_t regval;
 
-	membuf_reset(pChip-&gt;mbuf );
+	membuf_reset(pChip-&gt;mbuf);
 
 
 	pReg = &amp;(sam3_all_regs[0]);
 	while (pReg-&gt;name){
 		// display all regs
-		LOG_DEBUG(&quot;Start: %s&quot;, pReg-&gt;name );
-		regval = *sam3_get_reg_ptr(&amp;(pChip-&gt;cfg), pReg );
+		LOG_DEBUG(&quot;Start: %s&quot;, pReg-&gt;name);
+		regval = *sam3_get_reg_ptr(&amp;(pChip-&gt;cfg), pReg);
 		sam3_sprintf(pChip, &quot;%*s: [0x%08x] -&gt; 0x%08x\n&quot;, 
 					 REG_NAME_WIDTH,
 					 pReg-&gt;name,
 					 pReg-&gt;address,
-					 regval );
- 		if (pReg-&gt;explain_func ){
-			(*(pReg-&gt;explain_func))(pChip );
+					 regval);
+ 		if (pReg-&gt;explain_func){
+			(*(pReg-&gt;explain_func))(pChip);
 		}
-		LOG_DEBUG(&quot;End: %s&quot;, pReg-&gt;name );
+		LOG_DEBUG(&quot;End: %s&quot;, pReg-&gt;name);
 		pReg++;
 	}
-	sam3_sprintf(pChip,&quot;   rc-osc: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.rc_freq		));
-	sam3_sprintf(pChip,&quot;  mainosc: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.mainosc_freq	));
-	sam3_sprintf(pChip,&quot;     plla: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.plla_freq		));
-	sam3_sprintf(pChip,&quot; cpu-freq: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.cpu_freq		));
-	sam3_sprintf(pChip,&quot;mclk-freq: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.mclk_freq		));	
+	sam3_sprintf(pChip,&quot;   rc-osc: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.rc_freq));
+	sam3_sprintf(pChip,&quot;  mainosc: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.mainosc_freq));
+	sam3_sprintf(pChip,&quot;     plla: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.plla_freq));
+	sam3_sprintf(pChip,&quot; cpu-freq: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.cpu_freq));
+	sam3_sprintf(pChip,&quot;mclk-freq: %3.03f MHz\n&quot;, _tomhz(pChip-&gt;cfg.mclk_freq));	
 
 
 	sam3_sprintf(pChip, &quot; UniqueId: 0x%08x 0x%08x 0x%08x 0x%08x\n&quot;,
@@ -1563,13 +1563,13 @@
 		LOG_ERROR(&quot;Target not halted&quot;);
 		return ERROR_TARGET_NOT_HALTED;
 	}
-	if (0 == bank-&gt;num_sectors ){
+	if (0 == bank-&gt;num_sectors){
 		LOG_ERROR(&quot;Target: not supported/not probed\n&quot;);
 		return ERROR_FAIL;
 	}
 
 	LOG_INFO(&quot;sam3 - supports auto-erase, erase_check ignored&quot;);
-	for (x = 0 ; x &lt; bank-&gt;num_sectors ; x++ ){
+	for (x = 0 ; x &lt; bank-&gt;num_sectors ; x++){
 		bank-&gt;sectors[x].is_erased = 1;
 	}
 
@@ -1592,21 +1592,21 @@
 	}
 
 	pPrivate = get_sam3_bank_private(bank);
-	if (!pPrivate ){
+	if (!pPrivate){
 		LOG_ERROR(&quot;no private for this bank?&quot;);
 		return ERROR_FAIL;
 	}
-	if (!(pPrivate-&gt;probed) ){
+	if (!(pPrivate-&gt;probed)){
 		return ERROR_FLASH_BANK_NOT_PROBED;
 	}
 	
-	r = FLASHD_GetLockBits(pPrivate , &amp;v );
-	if (r != ERROR_OK ){
+	r = FLASHD_GetLockBits(pPrivate , &amp;v);
+	if (r != ERROR_OK){
 		LOG_DEBUG(&quot;Failed: %d&quot;,r);
 		return r;
 	}
 
-	for (x = 0 ; x &lt; pPrivate-&gt;nsectors ; x++ ){
+	for (x = 0 ; x &lt; pPrivate-&gt;nsectors ; x++){
 		bank-&gt;sectors[x].is_protected = (!!(v &amp; (1 &lt;&lt; x)));
 	}
 	LOG_DEBUG(&quot;Done&quot;);
@@ -1626,16 +1626,16 @@
 	
 	// is this an existing chip?
 	while (pChip){
-		if (pChip-&gt;target == bank-&gt;target ){
+		if (pChip-&gt;target == bank-&gt;target){
 			break;
 		}
 		pChip = pChip-&gt;next;
 	}
 
-	if (!pChip ){
+	if (!pChip){
 		// this is a *NEW* chip
-		pChip = calloc(1, sizeof(struct sam3_chip) );
-		if (!pChip ){
+		pChip = calloc(1, sizeof(struct sam3_chip));
+		if (!pChip){
 			LOG_ERROR(&quot;NO RAM!&quot;);
 			return ERROR_FAIL;
 		}
@@ -1648,13 +1648,13 @@
 		pChip-&gt;cfg.slow_freq = 32768;
 		pChip-&gt;probed = 0;
 		pChip-&gt;mbuf = membuf_new();
-		if (!(pChip-&gt;mbuf) ){
+		if (!(pChip-&gt;mbuf)){
 			LOG_ERROR(&quot;no memory&quot;);
 			return ERROR_FAIL;
 		}
 	}
 	
-	switch (bank-&gt;base ){
+	switch (bank-&gt;base){
 	default:
 		LOG_ERROR(&quot;Address 0x%08x invalid bank address (try 0x%08x or 0x%08x)&quot;,
 				  ((unsigned int)(bank-&gt;base)),
@@ -1681,7 +1681,7 @@
 }
 
 static int
-sam3_GetDetails(struct sam3_bank_private *pPrivate )
+sam3_GetDetails(struct sam3_bank_private *pPrivate)
 {
 	const struct sam3_chip_details *pDetails;
 	struct sam3_chip *pChip;
@@ -1693,26 +1693,26 @@
 
 	LOG_DEBUG(&quot;Begin&quot;);
 	pDetails = all_sam3_details;
-	while (pDetails-&gt;name ){
-		if (pDetails-&gt;chipid_cidr == pPrivate-&gt;pChip-&gt;cfg.CHIPID_CIDR ){
+	while (pDetails-&gt;name){
+		if (pDetails-&gt;chipid_cidr == pPrivate-&gt;pChip-&gt;cfg.CHIPID_CIDR){
 			break;
 		} else {
 			pDetails++;
 		}
 	}
-	if (pDetails-&gt;name == NULL ){
+	if (pDetails-&gt;name == NULL){
 		LOG_ERROR(&quot;SAM3 ChipID 0x%08x not found in table (perhaps you can this chip?)&quot;, 
-				  (unsigned int)(pPrivate-&gt;pChip-&gt;cfg.CHIPID_CIDR) );
+				  (unsigned int)(pPrivate-&gt;pChip-&gt;cfg.CHIPID_CIDR));
 		// Help the victim, print details about the chip
-		membuf_reset(pPrivate-&gt;pChip-&gt;mbuf );
+		membuf_reset(pPrivate-&gt;pChip-&gt;mbuf);
 		membuf_sprintf(pPrivate-&gt;pChip-&gt;mbuf, 
 						&quot;SAM3 CHIPID_CIDR: 0x%08x decodes as follows\n&quot;,
-						pPrivate-&gt;pChip-&gt;cfg.CHIPID_CIDR );
-		sam3_explain_chipid_cidr(pPrivate-&gt;pChip );
-		cp = membuf_strtok(pPrivate-&gt;pChip-&gt;mbuf, &quot;\n&quot;, &amp;vp );
+						pPrivate-&gt;pChip-&gt;cfg.CHIPID_CIDR);
+		sam3_explain_chipid_cidr(pPrivate-&gt;pChip);
+		cp = membuf_strtok(pPrivate-&gt;pChip-&gt;mbuf, &quot;\n&quot;, &amp;vp);
 		while (cp){
-			LOG_INFO(&quot;%s&quot;, cp );
-			cp = membuf_strtok(NULL, &quot;\n&quot;, &amp;vp );
+			LOG_INFO(&quot;%s&quot;, cp);
+			cp = membuf_strtok(NULL, &quot;\n&quot;, &amp;vp);
 		}
 		return ERROR_FAIL;
 	}
@@ -1730,7 +1730,7 @@
 	//
 
 	// save the &quot;bank&quot; pointers
-	for (x = 0 ; x &lt; SAM3_MAX_FLASH_BANKS ; x++ ){
+	for (x = 0 ; x &lt; SAM3_MAX_FLASH_BANKS ; x++){
 		saved_banks[ x ] = pChip-&gt;details.bank[x].pBank;
 	}
 
@@ -1740,7 +1740,7 @@
 			sizeof(pPrivate-&gt;pChip-&gt;details));
 
 	// now fix the ghosted pointers
-	for (x = 0 ; x &lt; SAM3_MAX_FLASH_BANKS ; x++ ){
+	for (x = 0 ; x &lt; SAM3_MAX_FLASH_BANKS ; x++){
 		pChip-&gt;details.bank[x].pChip = pChip;
 		pChip-&gt;details.bank[x].pBank = saved_banks[x];
 	}
@@ -1761,56 +1761,56 @@
 	struct sam3_bank_private *pPrivate;
 
 
-	LOG_DEBUG(&quot;Begin: Bank: %d, Noise: %d&quot;, bank-&gt;bank_number, noise );
+	LOG_DEBUG(&quot;Begin: Bank: %d, Noise: %d&quot;, bank-&gt;bank_number, noise);
 	if (bank-&gt;target-&gt;state != TARGET_HALTED)
 	{
 		LOG_ERROR(&quot;Target not halted&quot;);
 		return ERROR_TARGET_NOT_HALTED;
 	}
 
-	pPrivate = get_sam3_bank_private(bank );
-	if (!pPrivate ){
+	pPrivate = get_sam3_bank_private(bank);
+	if (!pPrivate){
 		LOG_ERROR(&quot;Invalid/unknown bank number\n&quot;);
 		return ERROR_FAIL;
 	}
 
 	r = sam3_ReadAllRegs(pPrivate-&gt;pChip);
-	if (r != ERROR_OK ){
+	if (r != ERROR_OK){
 		return r;
 	}
 
 	
 	LOG_DEBUG(&quot;Here&quot;);
-	r = sam3_GetInfo(pPrivate-&gt;pChip );
-	if (r != ERROR_OK ){
+	r = sam3_GetInfo(pPrivate-&gt;pChip);
+	if (r != ERROR_OK){
 		return r;
 	}
-	if (!(pPrivate-&gt;pChip-&gt;probed) ){
+	if (!(pPrivate-&gt;pChip-&gt;probed)){
 		pPrivate-&gt;pChip-&gt;probed = 1;
 		LOG_DEBUG(&quot;Here&quot;);
-		r = sam3_GetDetails(pPrivate );
-		if (r != ERROR_OK ){
+		r = sam3_GetDetails(pPrivate);
+		if (r != ERROR_OK){
 			return r;
 		}		
 	}
 
 	// update the flash bank size
-	for (x = 0 ; x &lt; SAM3_MAX_FLASH_BANKS ; x++ ){
-		if (bank-&gt;base == pPrivate-&gt;pChip-&gt;details.bank[0].base_address ){
+	for (x = 0 ; x &lt; SAM3_MAX_FLASH_BANKS ; x++){
+		if (bank-&gt;base == pPrivate-&gt;pChip-&gt;details.bank[0].base_address){
 			bank-&gt;size =  pPrivate-&gt;pChip-&gt;details.bank[0].size_bytes;
 			break;
 		}
 	}
 
-	if (bank-&gt;sectors == NULL ){
-		bank-&gt;sectors     = calloc(pPrivate-&gt;nsectors, (sizeof((bank-&gt;sectors)[0] )));
-		if (bank-&gt;sectors == NULL ){
+	if (bank-&gt;sectors == NULL){
+		bank-&gt;sectors     = calloc(pPrivate-&gt;nsectors, (sizeof((bank-&gt;sectors)[0])));
+		if (bank-&gt;sectors == NULL){
 			LOG_ERROR(&quot;No memory!&quot;);
 			return ERROR_FAIL;
 		}
 		bank-&gt;num_sectors = pPrivate-&gt;nsectors;
 			
-		for (x = 0 ; ((int)(x)) &lt; bank-&gt;num_sectors ; x++ ){
+		for (x = 0 ; ((int)(x)) &lt; bank-&gt;num_sectors ; x++){
 			bank-&gt;sectors[x].size         = pPrivate-&gt;sector_size;
 			bank-&gt;sectors[x].offset       = x * (pPrivate-&gt;sector_size);
 			// mark as unknown
@@ -1821,14 +1821,14 @@
 
 	pPrivate-&gt;probed = 1;
 
-	r = sam3_protect_check(bank );
-	if (r != ERROR_OK ){
+	r = sam3_protect_check(bank);
+	if (r != ERROR_OK){
 		return r;
 	}
 
 	LOG_DEBUG(&quot;Bank = %d, nbanks = %d&quot;,
 			  pPrivate-&gt;bank_number , pPrivate-&gt;pChip-&gt;details.n_banks);
-	if ((pPrivate-&gt;bank_number + 1) == pPrivate-&gt;pChip-&gt;details.n_banks ){
+	if ((pPrivate-&gt;bank_number + 1) == pPrivate-&gt;pChip-&gt;details.n_banks){
 		// read unique id, 
 		// it appears to be associated with the *last* flash bank.
 		FLASHD_ReadUniqueID(pPrivate);
@@ -1840,13 +1840,13 @@
 static int 
 sam3_probe(struct flash_bank_s *bank)
 {
-	return _sam3_probe(bank, 1 );
+	return _sam3_probe(bank, 1);
 }
 
 static int 
 sam3_auto_probe(struct flash_bank_s *bank)
 {
-	return _sam3_probe(bank, 0 );
+	return _sam3_probe(bank, 0);
 }
 
 
@@ -1863,21 +1863,21 @@
 		return ERROR_TARGET_NOT_HALTED;
 	}
 
-	r = sam3_auto_probe(bank );
-	if (r != ERROR_OK ){
+	r = sam3_auto_probe(bank);
+	if (r != ERROR_OK){
 		LOG_DEBUG(&quot;Here,r=%d&quot;,r);
 		return r;
 	}
 
-	pPrivate = get_sam3_bank_private(bank );
-	if (!(pPrivate-&gt;probed) ){
+	pPrivate = get_sam3_bank_private(bank);
+	if (!(pPrivate-&gt;probed)){
 		return ERROR_FLASH_BANK_NOT_PROBED;
 	}
 
-	if ((first == 0) &amp;&amp; ((last + 1)== ((int)(pPrivate-&gt;nsectors))) ){
+	if ((first == 0) &amp;&amp; ((last + 1)== ((int)(pPrivate-&gt;nsectors)))){
 		// whole chip
 		LOG_DEBUG(&quot;Here&quot;);
-		return FLASHD_EraseEntireBank(pPrivate );
+		return FLASHD_EraseEntireBank(pPrivate);
 	}
 	LOG_INFO(&quot;sam3 auto-erases while programing (request ignored)&quot;);
 	return ERROR_OK;
@@ -1895,12 +1895,12 @@
 		return ERROR_TARGET_NOT_HALTED;
 	}
 
-	pPrivate = get_sam3_bank_private(bank );
-	if (!(pPrivate-&gt;probed) ){
+	pPrivate = get_sam3_bank_private(bank);
+	if (!(pPrivate-&gt;probed)){
 		return ERROR_FLASH_BANK_NOT_PROBED;
 	}
 
-	if (set ){
+	if (set){
 		r = FLASHD_Lock(pPrivate, (unsigned)(first), (unsigned)(last));
 	} else {
 		r = FLASHD_Unlock(pPrivate, (unsigned)(first), (unsigned)(last));
@@ -1913,7 +1913,7 @@
 
 
 static int
-sam3_info(flash_bank_t *bank, char *buf, int buf_size )
+sam3_info(flash_bank_t *bank, char *buf, int buf_size)
 {
 	if (bank-&gt;target-&gt;state != TARGET_HALTED) {
 		LOG_ERROR(&quot;Target not halted&quot;);
@@ -1924,7 +1924,7 @@
 }
 
 static int
-sam3_page_read(struct sam3_bank_private *pPrivate, unsigned pagenum, uint8_t *buf )
+sam3_page_read(struct sam3_bank_private *pPrivate, unsigned pagenum, uint8_t *buf)
 {
 	uint32_t adr;
 	int r;
@@ -1936,9 +1936,9 @@
 							adr,
 							4, /* THIS*MUST*BE* in 32bit values */
 							pPrivate-&gt;page_size / 4,
-							buf );
-	if (r != ERROR_OK ){
-		LOG_ERROR(&quot;SAM3: Flash program failed to read page phys address: 0x%08x&quot;, (unsigned int)(adr) );
+							buf);
+	if (r != ERROR_OK){
+		LOG_ERROR(&quot;SAM3: Flash program failed to read page phys address: 0x%08x&quot;, (unsigned int)(adr));
 	}
 	return r;
 }
@@ -1964,7 +1964,7 @@
 // };
 //
 // 
-// uint32_t sam3_function(struct foo *p )
+// uint32_t sam3_function(struct foo *p)
 // {
 //   volatile uint32_t *v;
 //   uint32_t *d;
@@ -1978,7 +1978,7 @@
 // 
 //   do {
 //     *d++ = *s++;
-//   } while (--n )
+//   } while (--n)
 //     ;
 // 
 //   v = p-&gt;base;
@@ -1986,7 +1986,7 @@
 //   v[ 1 ] = p-&gt;cmd;
 //   do {
 //     r = v[8/4];
-//   } while (!(r&amp;1) )
+//   } while (!(r&amp;1))
 //     ;
 //   return r;
 // }
@@ -2036,7 +2036,7 @@
 
 
 static int
-sam3_page_write(struct sam3_bank_private *pPrivate, unsigned pagenum, uint8_t *buf )
+sam3_page_write(struct sam3_bank_private *pPrivate, unsigned pagenum, uint8_t *buf)
 {
 	uint32_t adr;
 	uint32_t status;
@@ -2045,14 +2045,14 @@
 	adr = pagenum * pPrivate-&gt;page_size;
 	adr += (adr + pPrivate-&gt;base_address);
 
-	LOG_DEBUG(&quot;Wr Page %u @ phys address: 0x%08x&quot;, pagenum, (unsigned int)(adr) );
+	LOG_DEBUG(&quot;Wr Page %u @ phys address: 0x%08x&quot;, pagenum, (unsigned int)(adr));
 	r = target_write_memory(pPrivate-&gt;pChip-&gt;target, 
 							 adr,
 							 4, /* THIS*MUST*BE* in 32bit values */
 							 pPrivate-&gt;page_size / 4,
-							 buf );
-	if (r != ERROR_OK ){
-		LOG_ERROR(&quot;SAM3: Failed to write (buffer) page at phys address 0x%08x&quot;, (unsigned int)(adr) );
+							 buf);
+	if (r != ERROR_OK){
+		LOG_ERROR(&quot;SAM3: Failed to write (buffer) page at phys address 0x%08x&quot;, (unsigned int)(adr));
 		return r;
 	}
 
@@ -2060,17 +2060,17 @@
 							// send Erase &amp; Write Page
 							AT91C_EFC_FCMD_EWP,
 							pagenum,
-							&amp;status );
+							&amp;status);
 
-	if (r != ERROR_OK ){
-		LOG_ERROR(&quot;SAM3: Error performing Erase &amp; Write page @ phys address 0x%08x&quot;, (unsigned int)(adr) );
+	if (r != ERROR_OK){
+		LOG_ERROR(&quot;SAM3: Error performing Erase &amp; Write page @ phys address 0x%08x&quot;, (unsigned int)(adr));
 	}
-	if (status &amp; (1 &lt;&lt; 2) ){
-		LOG_ERROR(&quot;SAM3: Page @ Phys address 0x%08x is locked&quot;, (unsigned int)(adr) );
+	if (status &amp; (1 &lt;&lt; 2)){
+		LOG_ERROR(&quot;SAM3: Page @ Phys address 0x%08x is locked&quot;, (unsigned int)(adr));
 		return ERROR_FAIL;
 	}
-	if (status &amp; (1 &lt;&lt; 1) ){
-		LOG_ERROR(&quot;SAM3: Flash Command error @phys address 0x%08x&quot;, (unsigned int)(adr) );
+	if (status &amp; (1 &lt;&lt; 1)){
+		LOG_ERROR(&quot;SAM3: Flash Command error @phys address 0x%08x&quot;, (unsigned int)(adr));
 		return ERROR_FAIL;
 	}
 	return ERROR_OK;
@@ -2095,7 +2095,7 @@
 	uint8_t *pagebuffer;
 
 	// ignore dumb requests
-	if (count == 0 ){
+	if (count == 0){
 		return ERROR_OK;
 	}
 
@@ -2105,28 +2105,28 @@
 	}
 
 	pPrivate = get_sam3_bank_private(bank);
-	if (!(pPrivate-&gt;probed) ){
+	if (!(pPrivate-&gt;probed)){
 		return ERROR_FLASH_BANK_NOT_PROBED;
 	}
 
 
-	if ((offset + count) &gt; pPrivate-&gt;size_bytes ){
+	if ((offset + count) &gt; pPrivate-&gt;size_bytes){
 		LOG_ERROR(&quot;Flash write error - past end of bank&quot;);
 		LOG_ERROR(&quot; offset: 0x%08x, count 0x%08x, BankEnd: 0x%08x&quot;,
 				  (unsigned int)(offset), 
 				  (unsigned int)(count),
-				  (unsigned int)(pPrivate-&gt;size_bytes) );
+				  (unsigned int)(pPrivate-&gt;size_bytes));
 		return ERROR_FAIL;
 	}
 
-	pagebuffer = alloca(pPrivate-&gt;page_size );
+	pagebuffer = alloca(pPrivate-&gt;page_size);
 		
 	// what page do we start &amp; end in?
 	page_cur = offset / pPrivate-&gt;page_size;
 	page_end = (offset + count - 1) / pPrivate-&gt;page_size;
 	
 	LOG_DEBUG(&quot;Offset: 0x%08x, Count: 0x%08x&quot;, (unsigned int)(offset), (unsigned int)(count));
-	LOG_DEBUG(&quot;Page start: %d, Page End: %d&quot;, (int)(page_cur), (int)(page_end) );
+	LOG_DEBUG(&quot;Page start: %d, Page End: %d&quot;, (int)(page_cur), (int)(page_end));
 			  
 	// Special case: all one page
 	//
@@ -2136,20 +2136,20 @@
 	//    (3) non-aligned end.
 	
 	// Handle special case - all one page.
-	if (page_cur == page_end ){
+	if (page_cur == page_end){
 		LOG_DEBUG(&quot;Special case, all in one page&quot;);
-		r = sam3_page_read(pPrivate, page_cur, pagebuffer );
-		if (r != ERROR_OK ){
+		r = sam3_page_read(pPrivate, page_cur, pagebuffer);
+		if (r != ERROR_OK){
 			return r;
 		}
 		
 		page_offset = (offset &amp; (pPrivate-&gt;page_size-1));
 		memcpy(pagebuffer + page_offset,
 				buffer,
-				count );
+				count);
 		
-		r = sam3_page_write(pPrivate, page_cur, pagebuffer );
-		if (r != ERROR_OK ){
+		r = sam3_page_write(pPrivate, page_cur, pagebuffer);
+		if (r != ERROR_OK){
 			return r;
 		}
 		return ERROR_OK;
@@ -2157,22 +2157,22 @@
 
 	// non-aligned start
 	page_offset = offset &amp; (pPrivate-&gt;page_size - 1);
-	if (page_offset ){
+	if (page_offset){
 		LOG_DEBUG(&quot;Not-Aligned start&quot;);
 		// read the partial
-		r = sam3_page_read(pPrivate, page_cur, pagebuffer );
-		if (r != ERROR_OK ){
+		r = sam3_page_read(pPrivate, page_cur, pagebuffer);
+		if (r != ERROR_OK){
 			return r;
 		}
 
 		// over-write with new data
-		n = (pPrivate-&gt;page_size - page_offset );
+		n = (pPrivate-&gt;page_size - page_offset);
 		memcpy(pagebuffer + page_offset,
 				buffer,
-				n );
+				n);
 	
-		r = sam3_page_write(pPrivate, page_cur, pagebuffer );
-		if (r != ERROR_OK ){
+		r = sam3_page_write(pPrivate, page_cur, pagebuffer);
+		if (r != ERROR_OK){
 			return r;
 		}
 
@@ -2186,12 +2186,12 @@
 	// also - the final *terminal* 
 	// if that terminal page is a full page
 	LOG_DEBUG(&quot;Full Page Loop: cur=%d, end=%d, count = 0x%08x&quot;, 
-			  (int)page_cur, (int)page_end, (unsigned int)(count) );
+			  (int)page_cur, (int)page_end, (unsigned int)(count));
 
 	while ((page_cur &lt; page_end) &amp;&amp; 
-		   (count &gt;= pPrivate-&gt;page_size) ){
-		r = sam3_page_write(pPrivate, page_cur, buffer );
-		if (r != ERROR_OK ){
+		   (count &gt;= pPrivate-&gt;page_size)){
+		r = sam3_page_write(pPrivate, page_cur, buffer);
+		if (r != ERROR_OK){
 			return r;
 		}
 		count    -= pPrivate-&gt;page_size;
@@ -2200,17 +2200,17 @@
 	}
 
 	// terminal partial page?
-	if (count ){
+	if (count){
 		LOG_DEBUG(&quot;Terminal partial page, count = 0x%08x&quot;, (unsigned int)(count));
 		// we have a partial page
-		r = sam3_page_read(pPrivate, page_cur, pagebuffer );
-		if (r != ERROR_OK ){
+		r = sam3_page_read(pPrivate, page_cur, pagebuffer);
+		if (r != ERROR_OK){
 			return r;
 		}
 		// data goes at start
-		memcpy(pagebuffer, buffer, count );
-		r = sam3_page_write(pPrivate, page_cur, pagebuffer );
-		if (r != ERROR_OK ){
+		memcpy(pagebuffer, buffer, count);
+		r = sam3_page_write(pPrivate, page_cur, pagebuffer);
+		if (r != ERROR_OK){
 			return r;
 		}
 		buffer += count;
@@ -2221,7 +2221,7 @@
 }
 
 static int
-sam3_handle_info_command(struct command_context_s *cmd_ctx, char *cmd, char **argv, int argc )
+sam3_handle_info_command(struct command_context_s *cmd_ctx, char *cmd, char **argv, int argc)
 {
 	struct sam3_chip *pChip;
 	void *vp;
@@ -2230,27 +2230,27 @@
 	int r;
 
 	pChip = get_current_sam3(cmd_ctx);
-	if (!pChip ){
+	if (!pChip){
 		return ERROR_OK;
 	}
 
 	r = 0;
 	
 	// bank0 must exist before we can do anything
-	if (pChip-&gt;details.bank[0].pBank == NULL ){
+	if (pChip-&gt;details.bank[0].pBank == NULL){
 		x = 0;
 	need_define:
 		command_print(cmd_ctx, 
 					   &quot;Please define bank %d via command: flash bank %s ... &quot;, 
 					   x,
-					   at91sam3_flash.name );
+					   at91sam3_flash.name);
 		return ERROR_FAIL;
 	}
 
 	// if bank 0 is not probed, then probe it
-	if (!(pChip-&gt;details.bank[0].probed) ){
-		r = sam3_auto_probe(pChip-&gt;details.bank[0].pBank );
-		if (r != ERROR_OK ){
+	if (!(pChip-&gt;details.bank[0].probed)){
+		r = sam3_auto_probe(pChip-&gt;details.bank[0].pBank);
+		if (r != ERROR_OK){
 			return ERROR_FAIL;
 		}
 	}
@@ -2260,39 +2260,39 @@
 		
 
 	// auto-probe other banks, 0 done above
-    for (x = 1 ; x &lt; SAM3_MAX_FLASH_BANKS ; x++ ){
+    for (x = 1 ; x &lt; SAM3_MAX_FLASH_BANKS ; x++){
 		// skip banks not present
-		if (!(pChip-&gt;details.bank[x].present) ){
+		if (!(pChip-&gt;details.bank[x].present)){
 			continue;
 		}
 		
-		if (pChip-&gt;details.bank[x].pBank == NULL ){
+		if (pChip-&gt;details.bank[x].pBank == NULL){
 			goto need_define;
 		}
 
-		if (pChip-&gt;details.bank[x].probed ){
+		if (pChip-&gt;details.bank[x].probed){
 			continue;
 		}
 		
-		r = sam3_auto_probe(pChip-&gt;details.bank[x].pBank );
-		if (r != ERROR_OK ){
+		r = sam3_auto_probe(pChip-&gt;details.bank[x].pBank);
+		if (r != ERROR_OK){
 			return r;
 		}
 	}
 			
 
-	r = sam3_GetInfo(pChip );
-	if (r != ERROR_OK ){
+	r = sam3_GetInfo(pChip);
+	if (r != ERROR_OK){
 		LOG_DEBUG(&quot;Sam3Info, Failed %d\n&quot;,r);
 		return r;
 	}
 	
 
 	// print results
-	cp = membuf_strtok(pChip-&gt;mbuf, &quot;\n&quot;, &amp;vp );
+	cp = membuf_strtok(pChip-&gt;mbuf, &quot;\n&quot;, &amp;vp);
 	while (cp){
-		command_print(cmd_ctx,&quot;%s&quot;, cp );
-		cp = membuf_strtok(NULL, &quot;\n&quot;, &amp;vp );
+		command_print(cmd_ctx,&quot;%s&quot;, cp);
+		cp = membuf_strtok(NULL, &quot;\n&quot;, &amp;vp);
 	}
 	return ERROR_OK;
 }
@@ -2306,30 +2306,30 @@
 	struct sam3_chip *pChip;
 
 	pChip = get_current_sam3(cmd_ctx);
-	if (!pChip ){
+	if (!pChip){
 		return ERROR_OK;
 	}
 
-	if (pChip-&gt;target-&gt;state != TARGET_HALTED ){
+	if (pChip-&gt;target-&gt;state != TARGET_HALTED){
 		LOG_ERROR(&quot;sam3 - target not halted&quot;);
 		return ERROR_TARGET_NOT_HALTED;
 	}
 
 
-	if (pChip-&gt;details.bank[0].pBank == NULL ){
+	if (pChip-&gt;details.bank[0].pBank == NULL){
 		command_print(cmd_ctx, &quot;Bank0 must be defined first via: flash bank %s ...&quot;,
-					   at91sam3_flash.name );
+					   at91sam3_flash.name);
 		return ERROR_FAIL;
 	}
-	if (!pChip-&gt;details.bank[0].probed ){
-		r = sam3_auto_probe(pChip-&gt;details.bank[0].pBank );
-		if (r != ERROR_OK ){
+	if (!pChip-&gt;details.bank[0].probed){
+		r = sam3_auto_probe(pChip-&gt;details.bank[0].pBank);
+		if (r != ERROR_OK){
 			return r;
 		}
 	}
 
 
-	switch (argc ){
+	switch (argc){
 	default:
 		command_print(cmd_ctx,&quot;Too many parameters\n&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2342,12 +2342,12 @@
 		who = -1;
 		break;
 	case 2:
-		if ((0 == strcmp(argv[0], &quot;show&quot; )) &amp;&amp; (0 == strcmp(argv[1], &quot;all&quot; )) ){
+		if ((0 == strcmp(argv[0], &quot;show&quot;)) &amp;&amp; (0 == strcmp(argv[1], &quot;all&quot;))){
 			who = -1;
 		} else {
-			r = parse_u32(argv[1], &amp;v32 );
-			if (r != ERROR_OK ){
-				command_print(cmd_ctx, &quot;Not a number: %s&quot;, argv[1] );
+			r = parse_u32(argv[1], &amp;v32);
+			if (r != ERROR_OK){
+				command_print(cmd_ctx, &quot;Not a number: %s&quot;, argv[1]);
 				return r;
 			}
 			who = v32;
@@ -2355,40 +2355,40 @@
 		break;
 	}
 
-	if (0 == strcmp(&quot;show&quot;, argv[0] ) ){
-		if (who == -1 ){
+	if (0 == strcmp(&quot;show&quot;, argv[0])){
+		if (who == -1){
 		showall:
-			for (x = 0 ; x &lt; pChip-&gt;details.n_gpnvms ; x++ ){
-				r = FLASHD_GetGPNVM(&amp;(pChip-&gt;details.bank[0]), x, &amp;v );
-				if (r != ERROR_OK ){
+			for (x = 0 ; x &lt; pChip-&gt;details.n_gpnvms ; x++){
+				r = FLASHD_GetGPNVM(&amp;(pChip-&gt;details.bank[0]), x, &amp;v);
+				if (r != ERROR_OK){
 					break;
 				}
-				command_print(cmd_ctx, &quot;sam3-gpnvm%u: %u&quot;, x, v );
+				command_print(cmd_ctx, &quot;sam3-gpnvm%u: %u&quot;, x, v);
 			}
 			return r;
 		}
-		if ((who &gt;= 0) &amp;&amp; (((unsigned)(who)) &lt; pChip-&gt;details.n_gpnvms) ){
-			r = FLASHD_GetGPNVM(&amp;(pChip-&gt;details.bank[0]), who, &amp;v );
-			command_print(cmd_ctx, &quot;sam3-gpnvm%u: %u&quot;, who, v );
+		if ((who &gt;= 0) &amp;&amp; (((unsigned)(who)) &lt; pChip-&gt;details.n_gpnvms)){
+			r = FLASHD_GetGPNVM(&amp;(pChip-&gt;details.bank[0]), who, &amp;v);
+			command_print(cmd_ctx, &quot;sam3-gpnvm%u: %u&quot;, who, v);
 			return r;
 		} else {
-			command_print(cmd_ctx, &quot;sam3-gpnvm invalid GPNVM: %u&quot;, who );
+			command_print(cmd_ctx, &quot;sam3-gpnvm invalid GPNVM: %u&quot;, who);
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
 	}
 
-	if (who == -1 ){
+	if (who == -1){
 		command_print(cmd_ctx, &quot;Missing GPNVM number&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 	
-	if (0 == strcmp(&quot;set&quot;, argv[0] ) ){
-		r = FLASHD_SetGPNVM(&amp;(pChip-&gt;details.bank[0]), who );
-	} else if ((0 == strcmp(&quot;clr&quot;, argv[0] )) ||
-			   (0 == strcmp(&quot;clear&quot;, argv[0])) ){ // quietly accept both
-		r = FLASHD_ClrGPNVM(&amp;(pChip-&gt;details.bank[0]), who );
+	if (0 == strcmp(&quot;set&quot;, argv[0])){
+		r = FLASHD_SetGPNVM(&amp;(pChip-&gt;details.bank[0]), who);
+	} else if ((0 == strcmp(&quot;clr&quot;, argv[0])) ||
+			   (0 == strcmp(&quot;clear&quot;, argv[0]))){ // quietly accept both
+		r = FLASHD_ClrGPNVM(&amp;(pChip-&gt;details.bank[0]), who);
 	} else {
-		command_print(cmd_ctx, &quot;Unkown command: %s&quot;, argv[0] );
+		command_print(cmd_ctx, &quot;Unkown command: %s&quot;, argv[0]);
 		r = ERROR_COMMAND_SYNTAX_ERROR;
 	}
 	return r;
@@ -2403,19 +2403,19 @@
 	struct sam3_chip *pChip;
 
 	pChip = get_current_sam3(cmd_ctx);
-	if (!pChip ){
+	if (!pChip){
 		return ERROR_OK;
 	}
 
 
-	switch (argc ){
+	switch (argc){
 	case 0:
 		// show
 		break;
 	case 1:
 		// set
-		r = parse_u32(argv[0], &amp;v );
-		if (v &gt; 200000 ){
+		r = parse_u32(argv[0], &amp;v);
+		if (v &gt; 200000){
 			// absurd slow clock of 200Khz?
 			command_print(cmd_ctx,&quot;Absurd/illegal slow clock freq: %d\n&quot;, (int)(v));
 			return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2443,10 +2443,10 @@
 	command_t *pCmd;
 
 	// only register once
-	if (!sam3_registered ){
+	if (!sam3_registered){
 		sam3_registered++;
 
-		pCmd = register_command(cmd_ctx, NULL, &quot;at91sam3&quot;, NULL, COMMAND_ANY, NULL );
+		pCmd = register_command(cmd_ctx, NULL, &quot;at91sam3&quot;, NULL, COMMAND_ANY, NULL);
 		register_command(cmd_ctx, pCmd,
 						  &quot;gpnvm&quot;, 
 						  sam3_handle_gpnvm_command, 

Modified: trunk/src/helper/membuf.c
===================================================================
--- trunk/src/helper/membuf.c	2009-06-24 09:38:01 UTC (rev 2395)
+++ trunk/src/helper/membuf.c	2009-06-24 09:38:08 UTC (rev 2396)
@@ -37,32 +37,32 @@
 };
 
 
-#define space_avail(pBuf )  (pBuf-&gt;maxlen - pBuf-&gt;curlen)
-#define dataend(pBuf )      (((char *)(pBuf-&gt;buf)) + pBuf-&gt;curlen )
+#define space_avail(pBuf)  (pBuf-&gt;maxlen - pBuf-&gt;curlen)
+#define dataend(pBuf)      (((char *)(pBuf-&gt;buf)) + pBuf-&gt;curlen)
 
 size_t 
-membuf_len(struct membuf *pBuf )
+membuf_len(struct membuf *pBuf)
 {
     return pBuf-&gt;curlen;
 }
 
 const void *
-membuf_datapointer(struct membuf *pBuf )
+membuf_datapointer(struct membuf *pBuf)
 {
     return ((void *)(pBuf-&gt;buf));
 }
 
 const char *
-membuf_strtok(struct membuf *pBuf, const char *sep, void **pLast )
+membuf_strtok(struct membuf *pBuf, const char *sep, void **pLast)
 {
-    if (pBuf ){
+    if (pBuf){
 	pBuf-&gt;_strtoklast = NULL;
 	*pLast = pBuf;
-	return strtok_r(((char *)(pBuf-&gt;buf)), sep, &amp;(pBuf-&gt;_strtoklast) );
+	return strtok_r(((char *)(pBuf-&gt;buf)), sep, &amp;(pBuf-&gt;_strtoklast));
     } else {
 	// recover our pBuf
 	pBuf = *((struct membuf **)(pLast));
-	return strtok_r(NULL, sep, &amp;(pBuf-&gt;_strtoklast) );
+	return strtok_r(NULL, sep, &amp;(pBuf-&gt;_strtoklast));
     }
 }
 	
@@ -74,11 +74,11 @@
     // by default - parameters are zero.
     struct membuf *pBuf;
 
-    pBuf = calloc(1, sizeof(*pBuf) );
-    if (pBuf ){
+    pBuf = calloc(1, sizeof(*pBuf));
+    if (pBuf){
 	// we *ALWAYS* allocate +1 for null terminator.
 	pBuf-&gt;buf = calloc(DEFAULT_BUFSIZE + 1, sizeof(char));
-	if (pBuf-&gt;buf == NULL ){
+	if (pBuf-&gt;buf == NULL){
 	    free(pBuf);
 	    pBuf = NULL;
 	} else {
@@ -90,7 +90,7 @@
 
 
 struct membuf *
-membuf_grow(struct membuf *pBuf, int n )
+membuf_grow(struct membuf *pBuf, int n)
 {
     void *vp;
     signed int newsize;
@@ -99,13 +99,13 @@
     newsize = ((int)(pBuf-&gt;maxlen)) + n;
 
     // do not go negative, or too small
-    if (newsize &lt; DEFAULT_BUFSIZE ){
+    if (newsize &lt; DEFAULT_BUFSIZE){
 	newsize = DEFAULT_BUFSIZE;
     }
 
     // always alloc +1 for the null terminator
-    vp = realloc(pBuf-&gt;buf, newsize + 1 );
-    if (vp ){
+    vp = realloc(pBuf-&gt;buf, newsize + 1);
+    if (vp){
 	pBuf-&gt;buf    = vp;
 	pBuf-&gt;maxlen = newsize;
 	return pBuf;
@@ -115,15 +115,15 @@
 }
 
 
-void membuf_reset(struct membuf *pBuf )
+void membuf_reset(struct membuf *pBuf)
 {
     pBuf-&gt;curlen = 0;
 }
 
 
-void membuf_delete(struct membuf *pBuf )
+void membuf_delete(struct membuf *pBuf)
 {
-    if (pBuf ){
+    if (pBuf){
 	if (pBuf-&gt;buf){
 	    // wack data so it cannot be reused
 	    memset(pBuf-&gt;buf,0,pBuf-&gt;maxlen);
@@ -136,18 +136,18 @@
 }
 
 int
-membuf_sprintf(struct membuf *pBuf , const char *fmt, ... )
+membuf_sprintf(struct membuf *pBuf , const char *fmt, ...)
 {
     int r;
     va_list ap;
-    va_start(ap, fmt );
-    r = membuf_vsprintf(pBuf, fmt, ap );
+    va_start(ap, fmt);
+    r = membuf_vsprintf(pBuf, fmt, ap);
     va_end(ap);
     return r;
 }
 
 int
-membuf_vsprintf(struct membuf *pBuf, const char *fmt, va_list ap )
+membuf_vsprintf(struct membuf *pBuf, const char *fmt, va_list ap)
 {
     int r;
     size_t sa;
@@ -159,11 +159,11 @@
 	sa = space_avail(pBuf);
 
 	// do work
-	r = vsnprintf(dataend(pBuf ),
+	r = vsnprintf(dataend(pBuf),
 		       sa,
 		       fmt, 
-		       ap );
-	if ((r &gt; 0) &amp;&amp; (((size_t)(r)) &lt; sa) ){
+		       ap);
+	if ((r &gt; 0) &amp;&amp; (((size_t)(r)) &lt; sa)){
 	    // Success!
 	    pBuf-&gt;curlen += ((size_t)(r));
 	    // remember: We always alloc'ed +1
@@ -174,7 +174,7 @@
 	}
 
 	// failure
-	if (r &lt; 0 ){
+	if (r &lt; 0){
 	    // Option(A) format error
 	    // Option(B) glibc2.0 bug
 	    // assume (B).
@@ -182,12 +182,12 @@
 	}
 
 	// don't do this again
-	if (grew ){
+	if (grew){
 	    r = -1;
 	    break;
 	}
 	grew = 1;
-	pBuf = membuf_grow(pBuf, r );
+	pBuf = membuf_grow(pBuf, r);
 	if (pBuf == NULL){
 	    // grow failed
 	    r = -1;
@@ -198,26 +198,26 @@
 }
 
 struct membuf *
-membuf_strcat(struct membuf *pBuf, const char *pStr )
+membuf_strcat(struct membuf *pBuf, const char *pStr)
 {
-    return membuf_append(pBuf, pStr, strlen(pStr ) );
+    return membuf_append(pBuf, pStr, strlen(pStr));
 }
 
 struct membuf *
-membuf_append(struct membuf *pBuf, const void *pData, size_t len )
+membuf_append(struct membuf *pBuf, const void *pData, size_t len)
 {
     size_t sa;
     int r;
 
     // how much room is there?
-    sa = space_avail(pBuf );
+    sa = space_avail(pBuf);
 
     // will it fit?
-    if (sa &lt; len ){
+    if (sa &lt; len){
 	// if not, how much do we need?
 	r = ((int)(sa - len));
 	// do the grow.
-	pBuf = membuf_grow(pBuf, r );
+	pBuf = membuf_grow(pBuf, r);
 	// failed?
 	if (pBuf == NULL){
 	    return pBuf;
@@ -226,7 +226,7 @@
     // append
     memcpy(dataend(pBuf),
 	    pData,
-	    len );
+	    len);
     pBuf-&gt;curlen += len;
     return pBuf;
 }

Modified: trunk/src/helper/membuf.h
===================================================================
--- trunk/src/helper/membuf.h	2009-06-24 09:38:01 UTC (rev 2395)
+++ trunk/src/helper/membuf.h	2009-06-24 09:38:08 UTC (rev 2396)
@@ -30,7 +30,7 @@
 /** delete (destroy) the mem buffer
  * @param pBuf - buffer to release
  */
-void membuf_delete(struct membuf *pBuf );
+void membuf_delete(struct membuf *pBuf);
 
 
 /** grow/shrink a membuf by specified amount.
@@ -39,14 +39,14 @@
  *
  * Symantics of 'realloc()' return NULL on failure
  */
-struct membuf *membuf_grow(struct membuf *pBuf, int amount );
+struct membuf *membuf_grow(struct membuf *pBuf, int amount);
 
 /** how long is this buffer (memlen(), strlen())
  * @param pBuf - the buffer
  * 
  * @returns: length of current buffer.
  */
-size_t membuf_len(struct membuf *pBuf );
+size_t membuf_len(struct membuf *pBuf);
 
 
 /** reset an membuf to zero length.
@@ -54,7 +54,7 @@
  *
  * Note this does not 'release' the memory buffer
  */
-void membuf_reset(struct membuf *pBuf );
+void membuf_reset(struct membuf *pBuf);
 
 
 /** sprintf() to the string buffer
@@ -64,7 +64,7 @@
  * Returns 0 on success
  * Returns non-zero on failure
  */
-int membuf_sprintf(struct membuf *pBuf , const char *fmt, ... );
+int membuf_sprintf(struct membuf *pBuf , const char *fmt, ...);
 
 /** vsprintf() to the string buffer
  * @param pBuf - buffer to capture sprintf() data into
@@ -84,14 +84,14 @@
  *
  * NOTE: This call is &lt;b &gt; destructive&lt;/b&gt; to the buffer.
  */
-const char *membuf_strtok(struct membuf *pBuf, const char *delim, void **pSave );
+const char *membuf_strtok(struct membuf *pBuf, const char *delim, void **pSave);
 
 /** Return pointer to the memory in the buffer
  * @param pBuf - buffer
  *
  * NOTE: Thou shall not modify this pointer, it is &lt;b &gt; CONST&lt;/b&gt;
  */
-const void *membuf_datapointer(struct membuf *pBuf );
+const void *membuf_datapointer(struct membuf *pBuf);
 
 
 /** Append data to the buffer
@@ -102,7 +102,7 @@
  * Modified symantics of &quot;memcpy()&quot;.  On memory allocation failure
  * returns NULL.  On success, returns pointer to orginal membuf.
  */
-struct membuf *membuf_append(struct membuf *pBuf, const void *pData, size_t len );
+struct membuf *membuf_append(struct membuf *pBuf, const void *pData, size_t len);
 
 
 /** Append string to the buffer
@@ -112,7 +112,7 @@
  * Modified symantics of &quot;strcat()&quot;.  On memory allocation failure
  * returns NULL.  On success, returns pointer to orginal membuf.
  */
-struct membuf *membuf_strcat(struct membuf *pBuf, const char *s );
+struct membuf *membuf_strcat(struct membuf *pBuf, const char *s);
 
 
 #endif


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001179.html">[Openocd-svn] r2395 - in trunk/src: flash helper
</A></li>
	<LI>Next message: <A HREF="001181.html">[Openocd-svn] r2397 - in trunk/src: flash helper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1180">[ date ]</a>
              <a href="thread.html#1180">[ thread ]</a>
              <a href="subject.html#1180">[ subject ]</a>
              <a href="author.html#1180">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
