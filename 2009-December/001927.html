<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-877-gaf1d759
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-877-gaf1d759&In-Reply-To=%3CE1NGmbh-0002uk-6z%40sfp-scmshell-4.v30.ch3.sourceforge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001926.html">
   <LINK REL="Next"  HREF="001928.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-877-gaf1d759</H1>
    <B>David Brownell</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-877-gaf1d759&In-Reply-To=%3CE1NGmbh-0002uk-6z%40sfp-scmshell-4.v30.ch3.sourceforge.com%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-877-gaf1d759">dbrownell at users.sourceforge.net
       </A><BR>
    <I>Sat Dec  5 05:50:55 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001926.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-867-gf67f6fe
</A></li>
        <LI>Next message: <A HREF="001928.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-881-g899c997
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1927">[ date ]</a>
              <a href="thread.html#1927">[ thread ]</a>
              <a href="subject.html#1927">[ subject ]</a>
              <a href="author.html#1927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  af1d7590edf04077aa8f22fba9097e0c68431f68 (commit)
       via  3edcff8b8efff841dfe601e87f42de7fe7b4792b (commit)
       via  c2cc677056f8b383ff8f88ed8a16f1aa4b530ae2 (commit)
       via  340e2eb7629fc1fdb6d2ead2952982584abdcefa (commit)
       via  e51b9a4ac7afa0fde11690268ba88861e1000f60 (commit)
       via  87589043faf8cdb954c602c988698c40fcf9c108 (commit)
       via  56e01714203406b50b40dd7738983e3b019d4df2 (commit)
       via  d4d16f1036bff4ce3c36edd1995e579fbf64e1c9 (commit)
       via  0073e7a69e55eb435fc2e274ba245a27779963e4 (commit)
       via  31e3ea7c19d39589ac9a8b2220331206b6d1e25c (commit)
      from  f67f6fe5bb8a466cc4d49f83608f026c4b233949 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit af1d7590edf04077aa8f22fba9097e0c68431f68
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 20:44:29 2009 -0800

    ARM: doc updates for main header
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index 56461e7..a93087e 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -30,7 +30,8 @@
 #include &lt;helper/command.h&gt;
 
 
-/* These numbers match the five low bits of the *PSR registers on
+/**
+ * These numbers match the five low bits of the *PSR registers on
  * &quot;classic ARM&quot; processors, which build on the ARMv4 processor
  * modes and register set.
  */
@@ -49,7 +50,7 @@ enum arm_mode {
 const char *arm_mode_name(unsigned psr_mode);
 bool is_arm_mode(unsigned psr_mode);
 
-/* The PSR &quot;T&quot; and &quot;J&quot; bits define the mode of &quot;classic ARM&quot; cores */
+/** The PSR &quot;T&quot; and &quot;J&quot; bits define the mode of &quot;classic ARM&quot; cores. */
 enum arm_state {
 	ARM_STATE_ARM,
 	ARM_STATE_THUMB,
@@ -95,6 +96,7 @@ struct arm
 	/** Handle to the SPSR; valid only in core modes with an SPSR. */
 	struct reg *spsr;
 
+	/** Support for arm_reg_current() */
 	const int *map;
 
 	/**
@@ -105,7 +107,10 @@ struct arm
 	 */
 	enum arm_mode core_type;
 
+	/** Record the current core mode: SVC, USR, or some other mode. */
 	enum arm_mode core_mode;
+
+	/** Record the current core state: ARM, Thumb, or otherwise. */
 	enum arm_state core_state;
 
 	/** Flag reporting unavailability of the BKPT instruction. */
@@ -128,7 +133,10 @@ struct arm
 
 	/* FIXME all these methods should take &quot;struct arm *&quot; not target */
 
+	/** Retrieve all core registers, for display. */
 	int (*full_context)(struct target *target);
+
+	/** Retrieve a single core register. */
 	int (*read_core_reg)(struct target *target, struct reg *reg,
 			int num, enum arm_mode mode);
 	int (*write_core_reg)(struct target *target, struct reg *reg,
@@ -140,7 +148,7 @@ struct arm
 			uint32_t CRn, uint32_t CRm,
 			uint32_t *value);
 
-	/* Write coprocessor register.  */
+	/** Write coprocessor register.  */
 	int (*mcr)(struct target *target, int cpnum,
 			uint32_t op1, uint32_t op2,
 			uint32_t CRn, uint32_t CRm,

commit 3edcff8b8efff841dfe601e87f42de7fe7b4792b
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 20:33:02 2009 -0800

    ARM: rename armv4_5_build_reg_cache() as arm_*()
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/arm7tdmi.c b/src/target/arm7tdmi.c
index a0b12b9..fffc632 100644
--- a/src/target/arm7tdmi.c
+++ b/src/target/arm7tdmi.c
@@ -643,7 +643,7 @@ static void arm7tdmi_build_reg_cache(struct target *target)
 	struct reg_cache **cache_p = register_get_last_cache_p(&amp;target-&gt;reg_cache);
 	struct arm *armv4_5 = target_to_arm(target);
 
-	(*cache_p) = armv4_5_build_reg_cache(target, armv4_5);
+	(*cache_p) = arm_build_reg_cache(target, armv4_5);
 }
 
 int arm7tdmi_init_target(struct command_context *cmd_ctx, struct target *target)
diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index 10f88f7..09199c7 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -753,7 +753,7 @@ static void arm9tdmi_build_reg_cache(struct target *target)
 	struct reg_cache **cache_p = register_get_last_cache_p(&amp;target-&gt;reg_cache);
 	struct arm *armv4_5 = target_to_arm(target);
 
-	(*cache_p) = armv4_5_build_reg_cache(target, armv4_5);
+	(*cache_p) = arm_build_reg_cache(target, armv4_5);
 }
 
 int arm9tdmi_init_target(struct command_context *cmd_ctx,
diff --git a/src/target/arm_dpm.c b/src/target/arm_dpm.c
index b65e922..ff89c47 100644
--- a/src/target/arm_dpm.c
+++ b/src/target/arm_dpm.c
@@ -819,7 +819,7 @@ int arm_dpm_setup(struct arm_dpm *dpm)
 	arm-&gt;read_core_reg = arm_dpm_read_core_reg;
 	arm-&gt;write_core_reg = arm_dpm_write_core_reg;
 
-	cache = armv4_5_build_reg_cache(target, arm);
+	cache = arm_build_reg_cache(target, arm);
 	if (!cache)
 		return ERROR_FAIL;
 
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index e07f606..ad89b2f 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -533,7 +533,7 @@ static const struct reg_arch_type arm_reg_type = {
 	.set = armv4_5_set_core_reg,
 };
 
-struct reg_cache* armv4_5_build_reg_cache(struct target *target, struct arm *armv4_5_common)
+struct reg_cache *arm_build_reg_cache(struct target *target, struct arm *arm)
 {
 	int num_regs = ARRAY_SIZE(arm_core_regs);
 	struct reg_cache *cache = malloc(sizeof(struct reg_cache));
@@ -557,7 +557,7 @@ struct reg_cache* armv4_5_build_reg_cache(struct target *target, struct arm *arm
 	{
 		/* Skip registers this core doesn't expose */
 		if (arm_core_regs[i].mode == ARM_MODE_MON
-				&amp;&amp; armv4_5_common-&gt;core_type != ARM_MODE_MON)
+				&amp;&amp; arm-&gt;core_type != ARM_MODE_MON)
 			continue;
 
 		/* REVISIT handle Cortex-M, which only shadows R13/SP */
@@ -565,7 +565,7 @@ struct reg_cache* armv4_5_build_reg_cache(struct target *target, struct arm *arm
 		arch_info[i].num = arm_core_regs[i].cookie;
 		arch_info[i].mode = arm_core_regs[i].mode;
 		arch_info[i].target = target;
-		arch_info[i].armv4_5_common = armv4_5_common;
+		arch_info[i].armv4_5_common = arm;
 
 		reg_list[i].name = (char *) arm_core_regs[i].name;
 		reg_list[i].size = 32;
@@ -576,8 +576,8 @@ struct reg_cache* armv4_5_build_reg_cache(struct target *target, struct arm *arm
 		cache-&gt;num_regs++;
 	}
 
-	armv4_5_common-&gt;cpsr = reg_list + ARMV4_5_CPSR;
-	armv4_5_common-&gt;core_cache = cache;
+	arm-&gt;cpsr = reg_list + ARMV4_5_CPSR;
+	arm-&gt;core_cache = cache;
 	return cache;
 }
 
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index 0b28301..56461e7 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -177,8 +177,7 @@ struct arm_reg
 	uint32_t value;
 };
 
-struct reg_cache* armv4_5_build_reg_cache(struct target *target,
-		struct arm *armv4_5_common);
+struct reg_cache *arm_build_reg_cache(struct target *target, struct arm *arm);
 
 int armv4_5_arch_state(struct target *target);
 int armv4_5_get_gdb_reg_list(struct target *target,
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 352e159..d5b1d63 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -2859,7 +2859,7 @@ static void xscale_build_reg_cache(struct target *target)
 	int i;
 	int num_regs = ARRAY_SIZE(xscale_reg_arch_info);
 
-	(*cache_p) = armv4_5_build_reg_cache(target, armv4_5);
+	(*cache_p) = arm_build_reg_cache(target, armv4_5);
 
 	(*cache_p)-&gt;next = malloc(sizeof(struct reg_cache));
 	cache_p = &amp;(*cache_p)-&gt;next;

commit c2cc677056f8b383ff8f88ed8a16f1aa4b530ae2
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 20:19:49 2009 -0800

    ARM: rename armv4_5_algorithm as arm_algorithm
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/flash/arm_nandio.c b/src/flash/arm_nandio.c
index 12c4b2f..67619d5 100644
--- a/src/flash/arm_nandio.c
+++ b/src/flash/arm_nandio.c
@@ -93,7 +93,7 @@ int arm_code_to_working_area(struct target *target,
 int arm_nandwrite(struct arm_nand_data *nand, uint8_t *data, int size)
 {
 	struct target		*target = nand-&gt;target;
-	struct armv4_5_algorithm	algo;
+	struct arm_algorithm	algo;
 	struct arm		*armv4_5 = target-&gt;arch_info;
 	struct reg_param	reg_params[3];
 	uint32_t		target_buf;
@@ -177,7 +177,7 @@ int arm_nandwrite(struct arm_nand_data *nand, uint8_t *data, int size)
 int arm_nandread(struct arm_nand_data *nand, uint8_t *data, uint32_t size)
 {
 	struct target *target = nand-&gt;target;
-	struct armv4_5_algorithm algo;
+	struct arm_algorithm algo;
 	struct arm *armv4_5 = target-&gt;arch_info;
 	struct reg_param reg_params[3];
 	uint32_t target_buf;
diff --git a/src/flash/nor/aduc702x.c b/src/flash/nor/aduc702x.c
index de362cb..57018bb 100644
--- a/src/flash/nor/aduc702x.c
+++ b/src/flash/nor/aduc702x.c
@@ -165,7 +165,7 @@ static int aduc702x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32
 	struct working_area *source;
 	uint32_t address = bank-&gt;base + offset;
 	struct reg_param reg_params[6];
-	struct armv4_5_algorithm armv4_5_info;
+	struct arm_algorithm armv4_5_info;
 	int retval = ERROR_OK;
 
 	if (((count%2)!=0)||((offset%2)!=0))
diff --git a/src/flash/nor/cfi.c b/src/flash/nor/cfi.c
index cffc22a..1ab9341 100644
--- a/src/flash/nor/cfi.c
+++ b/src/flash/nor/cfi.c
@@ -1012,7 +1012,7 @@ static int cfi_intel_write_block(struct flash_bank *bank, uint8_t *buffer, uint3
 	struct cfi_flash_bank *cfi_info = bank-&gt;driver_priv;
 	struct target *target = bank-&gt;target;
 	struct reg_param reg_params[7];
-	struct armv4_5_algorithm armv4_5_info;
+	struct arm_algorithm armv4_5_info;
 	struct working_area *source;
 	uint32_t buffer_size = 32768;
 	uint32_t write_command_val, busy_pattern_val, error_pattern_val;
@@ -1257,7 +1257,7 @@ static int cfi_spansion_write_block(struct flash_bank *bank, uint8_t *buffer, ui
 	struct cfi_spansion_pri_ext *pri_ext = cfi_info-&gt;pri_ext;
 	struct target *target = bank-&gt;target;
 	struct reg_param reg_params[10];
-	struct armv4_5_algorithm armv4_5_info;
+	struct arm_algorithm armv4_5_info;
 	struct working_area *source;
 	uint32_t buffer_size = 32768;
 	uint32_t status;
diff --git a/src/flash/nor/ecos.c b/src/flash/nor/ecos.c
index b216903..b51e0a0 100644
--- a/src/flash/nor/ecos.c
+++ b/src/flash/nor/ecos.c
@@ -209,7 +209,7 @@ static int runCode(struct ecosflash_flash_bank *info,
 	struct target *target = info-&gt;target;
 
 	struct reg_param reg_params[3];
-	struct armv4_5_algorithm armv4_5_info;
+	struct arm_algorithm armv4_5_info;
 	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
diff --git a/src/flash/nor/lpc2000.c b/src/flash/nor/lpc2000.c
index 6888b76..0caf3e0 100644
--- a/src/flash/nor/lpc2000.c
+++ b/src/flash/nor/lpc2000.c
@@ -242,7 +242,7 @@ static int lpc2000_iap_call(struct flash_bank *bank, int code, uint32_t param_ta
 	struct target *target = bank-&gt;target;
 	struct mem_param mem_params[2];
 	struct reg_param reg_params[5];
-	struct armv4_5_algorithm armv4_5_info; /* for LPC2000 */
+	struct arm_algorithm armv4_5_info; /* for LPC2000 */
 	struct armv7m_algorithm armv7m_info;   /* for LPC1700 */
  	uint32_t status_code;
 	uint32_t iap_entry_point = 0; /* to make compiler happier */
diff --git a/src/flash/nor/lpc2900.c b/src/flash/nor/lpc2900.c
index 1ef759e..ce74bbb 100644
--- a/src/flash/nor/lpc2900.c
+++ b/src/flash/nor/lpc2900.c
@@ -1302,7 +1302,7 @@ static int lpc2900_write(struct flash_bank *bank, uint8_t *buffer,
 	if( warea )
 	{
 		struct reg_param reg_params[5];
-		struct armv4_5_algorithm armv4_5_info;
+		struct arm_algorithm armv4_5_info;
 
 		/* We can use target mode. Download the algorithm. */
 		retval = target_write_buffer( target,
diff --git a/src/flash/nor/str7x.c b/src/flash/nor/str7x.c
index 45aa657..ef693e9 100644
--- a/src/flash/nor/str7x.c
+++ b/src/flash/nor/str7x.c
@@ -318,7 +318,7 @@ static int str7x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32_t
 	struct working_area *source;
 	uint32_t address = bank-&gt;base + offset;
 	struct reg_param reg_params[6];
-	struct armv4_5_algorithm armv4_5_info;
+	struct arm_algorithm armv4_5_info;
 	int retval = ERROR_OK;
 
 	uint32_t str7x_flash_write_code[] = {
diff --git a/src/flash/nor/str9x.c b/src/flash/nor/str9x.c
index 95da3e2..9cddb50 100644
--- a/src/flash/nor/str9x.c
+++ b/src/flash/nor/str9x.c
@@ -356,7 +356,7 @@ static int str9x_write_block(struct flash_bank *bank,
 	struct working_area *source;
 	uint32_t address = bank-&gt;base + offset;
 	struct reg_param reg_params[4];
-	struct armv4_5_algorithm armv4_5_info;
+	struct arm_algorithm armv4_5_info;
 	int retval = ERROR_OK;
 
 	uint32_t str9x_flash_write_code[] = {
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index 68005c0..25f8cb3 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2693,7 +2693,7 @@ int arm7_9_bulk_write_memory(struct target *target, uint32_t address, uint32_t c
 		}
 	}
 
-	struct armv4_5_algorithm armv4_5_info;
+	struct arm_algorithm armv4_5_info;
 	struct reg_param reg_params[1];
 
 	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 6941c16..e07f606 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -1037,7 +1037,7 @@ int armv4_5_run_algorithm_inner(struct target *target,
 				int timeout_ms, void *arch_info))
 {
 	struct arm *armv4_5 = target_to_arm(target);
-	struct armv4_5_algorithm *armv4_5_algorithm_info = arch_info;
+	struct arm_algorithm *arm_algorithm_info = arch_info;
 	enum arm_state core_state = armv4_5-&gt;core_state;
 	uint32_t context[17];
 	uint32_t cpsr;
@@ -1047,7 +1047,7 @@ int armv4_5_run_algorithm_inner(struct target *target,
 
 	LOG_DEBUG(&quot;Running algorithm&quot;);
 
-	if (armv4_5_algorithm_info-&gt;common_magic != ARM_COMMON_MAGIC)
+	if (arm_algorithm_info-&gt;common_magic != ARM_COMMON_MAGIC)
 	{
 		LOG_ERROR(&quot;current target isn't an ARMV4/5 target&quot;);
 		return ERROR_TARGET_INVALID;
@@ -1077,10 +1077,10 @@ int armv4_5_run_algorithm_inner(struct target *target,
 		struct reg *r;
 
 		r = &amp;ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache,
-				armv4_5_algorithm_info-&gt;core_mode, i);
+				arm_algorithm_info-&gt;core_mode, i);
 		if (!r-&gt;valid)
 			armv4_5-&gt;read_core_reg(target, r, i,
-					armv4_5_algorithm_info-&gt;core_mode);
+					arm_algorithm_info-&gt;core_mode);
 		context[i] = buf_get_u32(r-&gt;value, 0, 32);
 	}
 	cpsr = buf_get_u32(armv4_5-&gt;cpsr-&gt;value, 0, 32);
@@ -1114,7 +1114,7 @@ int armv4_5_run_algorithm_inner(struct target *target,
 		}
 	}
 
-	armv4_5-&gt;core_state = armv4_5_algorithm_info-&gt;core_state;
+	armv4_5-&gt;core_state = arm_algorithm_info-&gt;core_state;
 	if (armv4_5-&gt;core_state == ARM_STATE_ARM)
 		exit_breakpoint_size = 4;
 	else if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
@@ -1125,12 +1125,12 @@ int armv4_5_run_algorithm_inner(struct target *target,
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
-	if (armv4_5_algorithm_info-&gt;core_mode != ARM_MODE_ANY)
+	if (arm_algorithm_info-&gt;core_mode != ARM_MODE_ANY)
 	{
 		LOG_DEBUG(&quot;setting core_mode: 0x%2.2x&quot;,
-				armv4_5_algorithm_info-&gt;core_mode);
+				arm_algorithm_info-&gt;core_mode);
 		buf_set_u32(armv4_5-&gt;cpsr-&gt;value, 0, 5,
-				armv4_5_algorithm_info-&gt;core_mode);
+				arm_algorithm_info-&gt;core_mode);
 		armv4_5-&gt;cpsr-&gt;dirty = 1;
 		armv4_5-&gt;cpsr-&gt;valid = 1;
 	}
@@ -1193,13 +1193,13 @@ int armv4_5_run_algorithm_inner(struct target *target,
 	for (i = 0; i &lt;= 16; i++)
 	{
 		uint32_t regvalue;
-		regvalue = buf_get_u32(ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, armv4_5_algorithm_info-&gt;core_mode, i).value, 0, 32);
+		regvalue = buf_get_u32(ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, arm_algorithm_info-&gt;core_mode, i).value, 0, 32);
 		if (regvalue != context[i])
 		{
-			LOG_DEBUG(&quot;restoring register %s with value 0x%8.8&quot; PRIx32 &quot;&quot;, ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, armv4_5_algorithm_info-&gt;core_mode, i).name, context[i]);
-			buf_set_u32(ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, armv4_5_algorithm_info-&gt;core_mode, i).value, 0, 32, context[i]);
-			ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, armv4_5_algorithm_info-&gt;core_mode, i).valid = 1;
-			ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, armv4_5_algorithm_info-&gt;core_mode, i).dirty = 1;
+			LOG_DEBUG(&quot;restoring register %s with value 0x%8.8&quot; PRIx32 &quot;&quot;, ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, arm_algorithm_info-&gt;core_mode, i).name, context[i]);
+			buf_set_u32(ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, arm_algorithm_info-&gt;core_mode, i).value, 0, 32, context[i]);
+			ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, arm_algorithm_info-&gt;core_mode, i).valid = 1;
+			ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, arm_algorithm_info-&gt;core_mode, i).dirty = 1;
 		}
 	}
 
@@ -1225,7 +1225,7 @@ int arm_checksum_memory(struct target *target,
 		uint32_t address, uint32_t count, uint32_t *checksum)
 {
 	struct working_area *crc_algorithm;
-	struct armv4_5_algorithm armv4_5_info;
+	struct arm_algorithm armv4_5_info;
 	struct reg_param reg_params[2];
 	int retval;
 	uint32_t i;
@@ -1320,7 +1320,7 @@ int arm_blank_check_memory(struct target *target,
 {
 	struct working_area *check_algorithm;
 	struct reg_param reg_params[3];
-	struct armv4_5_algorithm armv4_5_info;
+	struct arm_algorithm armv4_5_info;
 	int retval;
 	uint32_t i;
 
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index b56a1f1..0b28301 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -160,7 +160,7 @@ static inline bool is_arm(struct arm *arm)
 	return arm &amp;&amp; arm-&gt;common_magic == ARM_COMMON_MAGIC;
 }
 
-struct armv4_5_algorithm
+struct arm_algorithm
 {
 	int common_magic;
 

commit 340e2eb7629fc1fdb6d2ead2952982584abdcefa
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 20:14:46 2009 -0800

    ARM: misc generic cleanup
    
    Remove an undesirable use of the CPSR symbol ... it needs to vanish.
    Flag mode-to-number stuff as obsolete; say why ... should also vanish.
    
    Get rid of no-longer-used mode and state typedefs.
    
    Comment a few of the implicit ties to &quot;classic ARM&quot;.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/arm_semihosting.c b/src/target/arm_semihosting.c
index d71fbae..39625f6 100644
--- a/src/target/arm_semihosting.c
+++ b/src/target/arm_semihosting.c
@@ -379,15 +379,22 @@ static int do_semihosting(struct target *target)
 	}
 
 	/* resume execution to the original mode */
+
+	/* return value in R0 */
 	buf_set_u32(armv4_5-&gt;core_cache-&gt;reg_list[0].value, 0, 32, result);
 	armv4_5-&gt;core_cache-&gt;reg_list[0].dirty = 1;
+
+	/* LR --&gt; PC */
 	buf_set_u32(armv4_5-&gt;core_cache-&gt;reg_list[15].value, 0, 32, lr);
 	armv4_5-&gt;core_cache-&gt;reg_list[15].dirty = 1;
-	buf_set_u32(armv4_5-&gt;core_cache-&gt;reg_list[ARMV4_5_CPSR].value, 0, 32, spsr);
-	armv4_5-&gt;core_cache-&gt;reg_list[ARMV4_5_CPSR].dirty = 1;
+
+	/* saved PSR --&gt; current PSR */
+	buf_set_u32(armv4_5-&gt;cpsr-&gt;value, 0, 32, spsr);
+	armv4_5-&gt;cpsr-&gt;dirty = 1;
 	armv4_5-&gt;core_mode = spsr &amp; 0x1f;
 	if (spsr &amp; 0x20)
 		armv4_5-&gt;core_state = ARM_STATE_THUMB;
+
 	return target_resume(target, 1, 0, 0, 0);
 }
 
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index 6a082a5..b56a1f1 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -30,8 +30,11 @@
 #include &lt;helper/command.h&gt;
 
 
-typedef enum arm_mode
-{
+/* These numbers match the five low bits of the *PSR registers on
+ * &quot;classic ARM&quot; processors, which build on the ARMv4 processor
+ * modes and register set.
+ */
+enum arm_mode {
 	ARM_MODE_USR = 16,
 	ARM_MODE_FIQ = 17,
 	ARM_MODE_IRQ = 18,
@@ -41,24 +44,29 @@ typedef enum arm_mode
 	ARM_MODE_UND = 27,
 	ARM_MODE_SYS = 31,
 	ARM_MODE_ANY = -1
-} arm_mode_t;
+};
 
 const char *arm_mode_name(unsigned psr_mode);
 bool is_arm_mode(unsigned psr_mode);
 
-int arm_mode_to_number(enum arm_mode mode);
-enum arm_mode armv4_5_number_to_mode(int number);
-
-typedef enum arm_state
-{
+/* The PSR &quot;T&quot; and &quot;J&quot; bits define the mode of &quot;classic ARM&quot; cores */
+enum arm_state {
 	ARM_STATE_ARM,
 	ARM_STATE_THUMB,
 	ARM_STATE_JAZELLE,
 	ARM_STATE_THUMB_EE,
-} arm_state_t;
+};
 
 extern const char *arm_state_strings[];
 
+/* OBSOLETE, DO NOT USE IN NEW CODE!  The &quot;number&quot; of an arm_mode is an
+ * index into the armv4_5_core_reg_map array.  Its remaining users are
+ * remnants which could as easily walk * the register cache directly as
+ * use the expensive ARMV4_5_CORE_REG_MODE() macro.
+ */
+int arm_mode_to_number(enum arm_mode mode);
+enum arm_mode armv4_5_number_to_mode(int number);
+
 extern const int armv4_5_core_reg_map[8][17];
 
 #define ARMV4_5_CORE_REG_MODE(cache, mode, num) \
diff --git a/src/target/etm.h b/src/target/etm.h
index 92df0bf..5aea657 100644
--- a/src/target/etm.h
+++ b/src/target/etm.h
@@ -164,7 +164,7 @@ struct etm_context
 	uint32_t trace_depth;		/* number of cycles to be analyzed, 0 if no data available */
 	etm_portmode_t portmode;	/* normal, multiplexed or demultiplexed */
 	etmv1_tracemode_t tracemode;	/* type of info trace contains */
-	int /*arm_state_t*/ core_state;	/* current core state */
+	int /*arm_state*/ core_state;	/* current core state */
 	struct image *image;		/* source for target opcodes */
 	uint32_t pipe_index;		/* current trace cycle */
 	uint32_t data_index;		/* cycle holding next data packet */
diff --git a/src/target/xscale.h b/src/target/xscale.h
index 2bb2ba5..43edeec 100644
--- a/src/target/xscale.h
+++ b/src/target/xscale.h
@@ -79,7 +79,7 @@ struct xscale_trace
 	int buffer_fill;				/* maximum number of trace runs to read (-1 for wrap-around) */
 	int pc_ok;
 	uint32_t current_pc;
-	arm_state_t core_state;		/* current core state (ARM, Thumb, Jazelle) */
+	enum arm_state core_state;	/* current core state (ARM, Thumb) */
 };
 
 struct xscale_common

commit e51b9a4ac7afa0fde11690268ba88861e1000f60
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 19:46:44 2009 -0800

    ARM: ARMV4_5_COMMON_MAGIC --&gt; ARM_COMMON_MAGIC
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/flash/arm_nandio.c b/src/flash/arm_nandio.c
index 3991c0f..12c4b2f 100644
--- a/src/flash/arm_nandio.c
+++ b/src/flash/arm_nandio.c
@@ -136,7 +136,7 @@ int arm_nandwrite(struct arm_nand_data *nand, uint8_t *data, int size)
 		return retval;
 
 	/* set up algorithm and parameters */
-	algo.common_magic = ARMV4_5_COMMON_MAGIC;
+	algo.common_magic = ARM_COMMON_MAGIC;
 	algo.core_mode = ARM_MODE_SVC;
 	algo.core_state = ARM_STATE_ARM;
 
@@ -212,7 +212,7 @@ int arm_nandread(struct arm_nand_data *nand, uint8_t *data, uint32_t size)
 	target_buf = nand-&gt;copy_area-&gt;address + sizeof(code);
 
 	/* set up algorithm and parameters */
-	algo.common_magic = ARMV4_5_COMMON_MAGIC;
+	algo.common_magic = ARM_COMMON_MAGIC;
 	algo.core_mode = ARM_MODE_SVC;
 	algo.core_state = ARM_STATE_ARM;
 
diff --git a/src/flash/nor/aduc702x.c b/src/flash/nor/aduc702x.c
index 69c8274..de362cb 100644
--- a/src/flash/nor/aduc702x.c
+++ b/src/flash/nor/aduc702x.c
@@ -241,7 +241,7 @@ static int aduc702x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32
 		}
 	}
 
-	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
diff --git a/src/flash/nor/cfi.c b/src/flash/nor/cfi.c
index 16ba999..cffc22a 100644
--- a/src/flash/nor/cfi.c
+++ b/src/flash/nor/cfi.c
@@ -1085,7 +1085,7 @@ static int cfi_intel_write_block(struct flash_bank *bank, uint8_t *buffer, uint3
 
 	cfi_intel_clear_status_register(bank);
 
-	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
@@ -1408,7 +1408,7 @@ static int cfi_spansion_write_block(struct flash_bank *bank, uint8_t *buffer, ui
 		0xeafffffe 	/* b	8204 &lt;sp_8_done&gt;               */
 	};
 
-	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
diff --git a/src/flash/nor/ecos.c b/src/flash/nor/ecos.c
index 2524ae7..b216903 100644
--- a/src/flash/nor/ecos.c
+++ b/src/flash/nor/ecos.c
@@ -210,7 +210,7 @@ static int runCode(struct ecosflash_flash_bank *info,
 
 	struct reg_param reg_params[3];
 	struct armv4_5_algorithm armv4_5_info;
-	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
diff --git a/src/flash/nor/lpc2000.c b/src/flash/nor/lpc2000.c
index c14df1f..6888b76 100644
--- a/src/flash/nor/lpc2000.c
+++ b/src/flash/nor/lpc2000.c
@@ -292,7 +292,7 @@ static int lpc2000_iap_call(struct flash_bank *bank, int code, uint32_t param_ta
 			break;
 		case lpc2000_v1:
 		case lpc2000_v2:
-			armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+			armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 			armv4_5_info.core_mode = ARM_MODE_SVC;
 			armv4_5_info.core_state = ARM_STATE_ARM;
 			iap_entry_point = 0x7ffffff1;
diff --git a/src/flash/nor/lpc2900.c b/src/flash/nor/lpc2900.c
index aec8bcd..1ef759e 100644
--- a/src/flash/nor/lpc2900.c
+++ b/src/flash/nor/lpc2900.c
@@ -1423,7 +1423,7 @@ static int lpc2900_write(struct flash_bank *bank, uint8_t *buffer,
 			buf_set_u32(reg_params[4].value, 0, 32, FPTR_EN_T | prog_time);
 
 			/* Execute algorithm, assume breakpoint for last instruction */
-			armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+			armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 			armv4_5_info.core_mode = ARM_MODE_SVC;
 			armv4_5_info.core_state = ARM_STATE_ARM;
 
diff --git a/src/flash/nor/str7x.c b/src/flash/nor/str7x.c
index 5767b93..45aa657 100644
--- a/src/flash/nor/str7x.c
+++ b/src/flash/nor/str7x.c
@@ -371,7 +371,7 @@ static int str7x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32_t
 		}
 	}
 
-	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
diff --git a/src/flash/nor/str9x.c b/src/flash/nor/str9x.c
index 60367cb..95da3e2 100644
--- a/src/flash/nor/str9x.c
+++ b/src/flash/nor/str9x.c
@@ -408,7 +408,7 @@ static int str9x_write_block(struct flash_bank *bank,
 		}
 	}
 
-	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index 408259e..68005c0 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2696,7 +2696,7 @@ int arm7_9_bulk_write_memory(struct target *target, uint32_t address, uint32_t c
 	struct armv4_5_algorithm armv4_5_info;
 	struct reg_param reg_params[1];
 
-	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 4fc8c82..6941c16 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -585,7 +585,7 @@ int armv4_5_arch_state(struct target *target)
 {
 	struct arm *armv4_5 = target_to_arm(target);
 
-	if (armv4_5-&gt;common_magic != ARMV4_5_COMMON_MAGIC)
+	if (armv4_5-&gt;common_magic != ARM_COMMON_MAGIC)
 	{
 		LOG_ERROR(&quot;BUG: called for a non-ARM target&quot;);
 		return ERROR_FAIL;
@@ -1047,7 +1047,7 @@ int armv4_5_run_algorithm_inner(struct target *target,
 
 	LOG_DEBUG(&quot;Running algorithm&quot;);
 
-	if (armv4_5_algorithm_info-&gt;common_magic != ARMV4_5_COMMON_MAGIC)
+	if (armv4_5_algorithm_info-&gt;common_magic != ARM_COMMON_MAGIC)
 	{
 		LOG_ERROR(&quot;current target isn't an ARMV4/5 target&quot;);
 		return ERROR_TARGET_INVALID;
@@ -1273,7 +1273,7 @@ int arm_checksum_memory(struct target *target,
 			return retval;
 	}
 
-	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
@@ -1350,7 +1350,7 @@ int arm_blank_check_memory(struct target *target,
 			return retval;
 	}
 
-	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5_info.common_magic = ARM_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
@@ -1424,7 +1424,7 @@ int armv4_5_init_arch_info(struct target *target, struct arm *armv4_5)
 	target-&gt;arch_info = armv4_5;
 	armv4_5-&gt;target = target;
 
-	armv4_5-&gt;common_magic = ARMV4_5_COMMON_MAGIC;
+	armv4_5-&gt;common_magic = ARM_COMMON_MAGIC;
 	arm_set_cpsr(armv4_5, ARM_MODE_USR);
 
 	/* core_type may be overridden by subtype logic */
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index 42fbeac..6a082a5 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -67,7 +67,7 @@ extern const int armv4_5_core_reg_map[8][17];
 /* offset into armv4_5 core register cache -- OBSOLETE, DO NOT USE! */
 enum { ARMV4_5_CPSR = 31, };
 
-#define ARMV4_5_COMMON_MAGIC 0x0A450A45
+#define ARM_COMMON_MAGIC 0x0A450A45
 
 /**
  * Represents a generic ARM core, with standard application registers.
@@ -149,7 +149,7 @@ static inline struct arm *target_to_arm(struct target *target)
 
 static inline bool is_arm(struct arm *arm)
 {
-	return arm &amp;&amp; arm-&gt;common_magic == ARMV4_5_COMMON_MAGIC;
+	return arm &amp;&amp; arm-&gt;common_magic == ARM_COMMON_MAGIC;
 }
 
 struct armv4_5_algorithm
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 0fa3270..352e159 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -857,7 +857,7 @@ static int xscale_arch_state(struct target *target)
 		&quot;&quot;, &quot;\n(processor reset)&quot;, &quot;\n(trace buffer full)&quot;
 	};
 
-	if (armv4_5-&gt;common_magic != ARMV4_5_COMMON_MAGIC)
+	if (armv4_5-&gt;common_magic != ARM_COMMON_MAGIC)
 	{
 		LOG_ERROR(&quot;BUG: called for a non-ARMv4/5 target&quot;);
 		return ERROR_INVALID_ARGUMENTS;

commit 87589043faf8cdb954c602c988698c40fcf9c108
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 19:43:03 2009 -0800

    ARM: switch target_to_armv4_5() to target_to_arm()
    
    And remove that old symbol.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/arm7tdmi.c b/src/target/arm7tdmi.c
index 7d14ed6..a0b12b9 100644
--- a/src/target/arm7tdmi.c
+++ b/src/target/arm7tdmi.c
@@ -641,7 +641,7 @@ static void arm7tdmi_branch_resume_thumb(struct target *target)
 static void arm7tdmi_build_reg_cache(struct target *target)
 {
 	struct reg_cache **cache_p = register_get_last_cache_p(&amp;target-&gt;reg_cache);
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 
 	(*cache_p) = armv4_5_build_reg_cache(target, armv4_5);
 }
diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index 6a5faff..305f0de 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -212,7 +212,7 @@ static int arm920t_execute_cp15(struct target *target, uint32_t cp15_opcode,
 static int arm920t_read_cp15_interpreted(struct target *target,
 		uint32_t cp15_opcode, uint32_t address, uint32_t *value)
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 	uint32_t* regs_p[1];
 	uint32_t regs[2];
 	uint32_t cp15c15 = 0x0;
@@ -259,7 +259,7 @@ int arm920t_write_cp15_interpreted(struct target *target,
 		uint32_t cp15_opcode, uint32_t value, uint32_t address)
 {
 	uint32_t cp15c15 = 0x0;
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 	uint32_t regs[2];
 	struct reg *r = armv4_5-&gt;core_cache-&gt;reg_list;
 
diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index 7eb5641..10f88f7 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -751,7 +751,7 @@ void arm9tdmi_disable_single_step(struct target *target)
 static void arm9tdmi_build_reg_cache(struct target *target)
 {
 	struct reg_cache **cache_p = register_get_last_cache_p(&amp;target-&gt;reg_cache);
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 
 	(*cache_p) = armv4_5_build_reg_cache(target, armv4_5);
 }
diff --git a/src/target/arm_semihosting.c b/src/target/arm_semihosting.c
index dd6a669..d71fbae 100644
--- a/src/target/arm_semihosting.c
+++ b/src/target/arm_semihosting.c
@@ -43,7 +43,7 @@
 
 static int do_semihosting(struct target *target)
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 	uint32_t r0 = buf_get_u32(armv4_5-&gt;core_cache-&gt;reg_list[0].value, 0, 32);
 	uint32_t r1 = buf_get_u32(armv4_5-&gt;core_cache-&gt;reg_list[1].value, 0, 32);
 	uint32_t lr = buf_get_u32(ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, ARM_MODE_SVC, 14).value, 0, 32);
@@ -406,7 +406,7 @@ static int do_semihosting(struct target *target)
  */
 int arm_semihosting(struct target *target, int *retval)
 {
-	struct arm *arm = target_to_armv4_5(target);
+	struct arm *arm = target_to_arm(target);
 	uint32_t lr, spsr;
 	struct reg *r;
 
diff --git a/src/target/arm_simulator.c b/src/target/arm_simulator.c
index cb1f651..443f29b 100644
--- a/src/target/arm_simulator.c
+++ b/src/target/arm_simulator.c
@@ -850,7 +850,7 @@ static enum arm_mode armv4_5_get_mode(struct arm_sim_interface *sim)
 
 int arm_simulate_step(struct target *target, uint32_t *dry_run_pc)
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 	struct arm_sim_interface sim;
 
 	sim.user_data = armv4_5;
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 102913b..4fc8c82 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -491,7 +491,7 @@ static int armv4_5_set_core_reg(struct reg *reg, uint8_t *buf)
 {
 	struct arm_reg *armv4_5 = reg-&gt;arch_info;
 	struct target *target = armv4_5-&gt;target;
-	struct arm *armv4_5_target = target_to_armv4_5(target);
+	struct arm *armv4_5_target = target_to_arm(target);
 	uint32_t value = buf_get_u32(buf, 0, 32);
 
 	if (target-&gt;state != TARGET_HALTED)
@@ -583,7 +583,7 @@ struct reg_cache* armv4_5_build_reg_cache(struct target *target, struct arm *arm
 
 int armv4_5_arch_state(struct target *target)
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 
 	if (armv4_5-&gt;common_magic != ARMV4_5_COMMON_MAGIC)
 	{
@@ -611,7 +611,7 @@ int armv4_5_arch_state(struct target *target)
 COMMAND_HANDLER(handle_armv4_5_reg_command)
 {
 	struct target *target = get_current_target(CMD_CTX);
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 	unsigned num_regs;
 	struct reg *regs;
 
@@ -698,7 +698,7 @@ COMMAND_HANDLER(handle_armv4_5_reg_command)
 COMMAND_HANDLER(handle_armv4_5_core_state_command)
 {
 	struct target *target = get_current_target(CMD_CTX);
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 
 	if (!is_arm(armv4_5))
 	{
@@ -974,7 +974,7 @@ const struct command_registration arm_command_handlers[] = {
 
 int armv4_5_get_gdb_reg_list(struct target *target, struct reg **reg_list[], int *reg_list_size)
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 	int i;
 
 	if (!is_arm_mode(armv4_5-&gt;core_mode))
@@ -999,7 +999,7 @@ int armv4_5_get_gdb_reg_list(struct target *target, struct reg **reg_list[], int
 static int armv4_5_run_algorithm_completion(struct target *target, uint32_t exit_point, int timeout_ms, void *arch_info)
 {
 	int retval;
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 
 	if ((retval = target_wait_state(target, TARGET_HALTED, timeout_ms)) != ERROR_OK)
 	{
@@ -1036,7 +1036,7 @@ int armv4_5_run_algorithm_inner(struct target *target,
 		int (*run_it)(struct target *target, uint32_t exit_point,
 				int timeout_ms, void *arch_info))
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 	struct armv4_5_algorithm *armv4_5_algorithm_info = arch_info;
 	enum arm_state core_state = armv4_5-&gt;core_state;
 	uint32_t context[17];
@@ -1388,7 +1388,7 @@ int arm_blank_check_memory(struct target *target,
 
 static int arm_full_context(struct target *target)
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 	unsigned num_regs = armv4_5-&gt;core_cache-&gt;num_regs;
 	struct reg *reg = armv4_5-&gt;core_cache-&gt;reg_list;
 	int retval = ERROR_OK;
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index 5d58aa3..42fbeac 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -141,8 +141,6 @@ struct arm
 	void *arch_info;
 };
 
-#define target_to_armv4_5 target_to_arm
-
 /** Convert target handle to generic ARM target state handle. */
 static inline struct arm *target_to_arm(struct target *target)
 {
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 253decb..0fa3270 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -1429,7 +1429,7 @@ static int xscale_step_inner(struct target *target, int current,
 static int xscale_step(struct target *target, int current,
 		uint32_t address, int handle_breakpoints)
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 	struct breakpoint *breakpoint = target-&gt;breakpoints;
 
 	uint32_t current_pc;
@@ -1675,7 +1675,7 @@ static int xscale_write_core_reg(struct target *target, struct reg *r,
 
 static int xscale_full_context(struct target *target)
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 
 	uint32_t *buffer;
 
@@ -1757,7 +1757,7 @@ static int xscale_full_context(struct target *target)
 
 static int xscale_restore_banked(struct target *target)
 {
-	struct arm *armv4_5 = target_to_armv4_5(target);
+	struct arm *armv4_5 = target_to_arm(target);
 
 	int i, j;
 

commit 56e01714203406b50b40dd7738983e3b019d4df2
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 19:39:25 2009 -0800

    ARM: rename armv4_5_state_* as arm_state_*
    
    And make arm_state_strings[] be const.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/arm720t.c b/src/target/arm720t.c
index a4d274e..48cfdf0 100644
--- a/src/target/arm720t.c
+++ b/src/target/arm720t.c
@@ -237,7 +237,7 @@ static int arm720t_arch_state(struct target *target)
 	LOG_USER(&quot;target halted in %s state due to %s, current mode: %s\n&quot;
 			&quot;cpsr: 0x%8.8&quot; PRIx32 &quot; pc: 0x%8.8&quot; PRIx32 &quot;\n&quot;
 			&quot;MMU: %s, Cache: %s&quot;,
-			 armv4_5_state_strings[armv4_5-&gt;core_state],
+			 arm_state_strings[armv4_5-&gt;core_state],
 			 Jim_Nvp_value2name_simple(nvp_target_debug_reason, target-&gt;debug_reason)-&gt;name ,
 			 arm_mode_name(armv4_5-&gt;core_mode),
 			 buf_get_u32(armv4_5-&gt;cpsr-&gt;value, 0, 32),
diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index e8c1950..6a5faff 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -451,7 +451,7 @@ int arm920t_arch_state(struct target *target)
 	LOG_USER(&quot;target halted in %s state due to %s, current mode: %s\n&quot;
 			&quot;cpsr: 0x%8.8&quot; PRIx32 &quot; pc: 0x%8.8&quot; PRIx32 &quot;\n&quot;
 			&quot;MMU: %s, D-Cache: %s, I-Cache: %s&quot;,
-			 armv4_5_state_strings[armv4_5-&gt;core_state],
+			 arm_state_strings[armv4_5-&gt;core_state],
 			 Jim_Nvp_value2name_simple(nvp_target_debug_reason, target-&gt;debug_reason)-&gt;name,
 			 arm_mode_name(armv4_5-&gt;core_mode),
 			 buf_get_u32(armv4_5-&gt;cpsr-&gt;value, 0, 32),
diff --git a/src/target/arm926ejs.c b/src/target/arm926ejs.c
index 4dec23d..cacb942 100644
--- a/src/target/arm926ejs.c
+++ b/src/target/arm926ejs.c
@@ -507,7 +507,7 @@ int arm926ejs_arch_state(struct target *target)
 	LOG_USER(&quot;target halted in %s state due to %s, current mode: %s\n&quot;
 			&quot;cpsr: 0x%8.8&quot; PRIx32 &quot; pc: 0x%8.8&quot; PRIx32 &quot;\n&quot;
 			&quot;MMU: %s, D-Cache: %s, I-Cache: %s&quot;,
-			 armv4_5_state_strings[armv4_5-&gt;core_state],
+			 arm_state_strings[armv4_5-&gt;core_state],
 			 Jim_Nvp_value2name_simple(nvp_target_debug_reason,target-&gt;debug_reason)-&gt;name,
 			 arm_mode_name(armv4_5-&gt;core_mode),
 			 buf_get_u32(armv4_5-&gt;cpsr-&gt;value, 0, 32),
diff --git a/src/target/arm_simulator.c b/src/target/arm_simulator.c
index c252b44..cb1f651 100644
--- a/src/target/arm_simulator.c
+++ b/src/target/arm_simulator.c
@@ -824,14 +824,14 @@ static uint32_t armv4_5_get_cpsr(struct arm_sim_interface *sim, int pos, int bit
 	return buf_get_u32(armv4_5-&gt;cpsr-&gt;value, pos, bits);
 }
 
-static enum armv4_5_state armv4_5_get_state(struct arm_sim_interface *sim)
+static enum arm_state armv4_5_get_state(struct arm_sim_interface *sim)
 {
 	struct arm *armv4_5 = (struct arm *)sim-&gt;user_data;
 
 	return armv4_5-&gt;core_state;
 }
 
-static void armv4_5_set_state(struct arm_sim_interface *sim, enum armv4_5_state mode)
+static void armv4_5_set_state(struct arm_sim_interface *sim, enum arm_state mode)
 {
 	struct arm *armv4_5 = (struct arm *)sim-&gt;user_data;
 
diff --git a/src/target/arm_simulator.h b/src/target/arm_simulator.h
index ae3afad..bd5458e 100644
--- a/src/target/arm_simulator.h
+++ b/src/target/arm_simulator.h
@@ -32,8 +32,8 @@ struct arm_sim_interface
 	uint32_t (*get_reg_mode)(struct arm_sim_interface *sim, int reg);
 	void (*set_reg_mode)(struct arm_sim_interface *sim, int reg, uint32_t value);
 	uint32_t (*get_cpsr)(struct arm_sim_interface *sim, int pos, int bits);
-	enum armv4_5_state (*get_state)(struct arm_sim_interface *sim);
-	void (*set_state)(struct arm_sim_interface *sim, enum armv4_5_state mode);
+	enum arm_state (*get_state)(struct arm_sim_interface *sim);
+	void (*set_state)(struct arm_sim_interface *sim, enum arm_state mode);
 	enum arm_mode (*get_mode)(struct arm_sim_interface *sim);
 };
 
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 15c0a7f..102913b 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -216,7 +216,7 @@ enum arm_mode armv4_5_number_to_mode(int number)
 	}
 }
 
-char* armv4_5_state_strings[] =
+const char *arm_state_strings[] =
 {
 	&quot;ARM&quot;, &quot;Thumb&quot;, &quot;Jazelle&quot;, &quot;ThumbEE&quot;,
 };
@@ -374,7 +374,7 @@ void arm_set_cpsr(struct arm *arm, uint32_t cpsr)
 			: arm-&gt;core_cache-&gt;reg_list + arm-&gt;map[16];
 
 	/* Older ARMs won't have the J bit */
-	enum armv4_5_state state;
+	enum arm_state state;
 
 	if (cpsr &amp; (1 &lt;&lt; 5)) {	/* T */
 		if (cpsr &amp; (1 &lt;&lt; 24)) {	/* J */
@@ -393,7 +393,7 @@ void arm_set_cpsr(struct arm *arm, uint32_t cpsr)
 
 	LOG_DEBUG(&quot;set CPSR %#8.8x: %s mode, %s state&quot;, (unsigned) cpsr,
 			arm_mode_name(mode),
-			armv4_5_state_strings[arm-&gt;core_state]);
+			arm_state_strings[arm-&gt;core_state]);
 }
 
 /**
@@ -593,7 +593,7 @@ int armv4_5_arch_state(struct target *target)
 
 	LOG_USER(&quot;target halted in %s state due to %s, current mode: %s\n&quot;
 			&quot;cpsr: 0x%8.8&quot; PRIx32 &quot; pc: 0x%8.8&quot; PRIx32 &quot;%s&quot;,
-			 armv4_5_state_strings[armv4_5-&gt;core_state],
+			 arm_state_strings[armv4_5-&gt;core_state],
 			 Jim_Nvp_value2name_simple(nvp_target_debug_reason,
 					target-&gt;debug_reason)-&gt;name,
 			 arm_mode_name(armv4_5-&gt;core_mode),
@@ -718,7 +718,7 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
 		}
 	}
 
-	command_print(CMD_CTX, &quot;core state: %s&quot;, armv4_5_state_strings[armv4_5-&gt;core_state]);
+	command_print(CMD_CTX, &quot;core state: %s&quot;, arm_state_strings[armv4_5-&gt;core_state]);
 
 	return ERROR_OK;
 }
@@ -1038,7 +1038,7 @@ int armv4_5_run_algorithm_inner(struct target *target,
 {
 	struct arm *armv4_5 = target_to_armv4_5(target);
 	struct armv4_5_algorithm *armv4_5_algorithm_info = arch_info;
-	enum armv4_5_state core_state = armv4_5-&gt;core_state;
+	enum arm_state core_state = armv4_5-&gt;core_state;
 	uint32_t context[17];
 	uint32_t cpsr;
 	int exit_breakpoint_size = 0;
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index e2b7b5a..5d58aa3 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -49,15 +49,15 @@ bool is_arm_mode(unsigned psr_mode);
 int arm_mode_to_number(enum arm_mode mode);
 enum arm_mode armv4_5_number_to_mode(int number);
 
-typedef enum armv4_5_state
+typedef enum arm_state
 {
 	ARM_STATE_ARM,
 	ARM_STATE_THUMB,
 	ARM_STATE_JAZELLE,
 	ARM_STATE_THUMB_EE,
-} armv4_5_state_t;
+} arm_state_t;
 
-extern char* armv4_5_state_strings[];
+extern const char *arm_state_strings[];
 
 extern const int armv4_5_core_reg_map[8][17];
 
@@ -98,7 +98,7 @@ struct arm
 	enum arm_mode core_type;
 
 	enum arm_mode core_mode;
-	enum armv4_5_state core_state;
+	enum arm_state core_state;
 
 	/** Flag reporting unavailability of the BKPT instruction. */
 	bool is_armv4;
@@ -159,7 +159,7 @@ struct armv4_5_algorithm
 	int common_magic;
 
 	enum arm_mode core_mode;
-	enum armv4_5_state core_state;
+	enum arm_state core_state;
 };
 
 struct arm_reg
diff --git a/src/target/armv7a.h b/src/target/armv7a.h
index ad1f094..24ec819 100644
--- a/src/target/armv7a.h
+++ b/src/target/armv7a.h
@@ -119,7 +119,7 @@ struct armv7a_algorithm
 	int common_magic;
 
 	enum arm_mode core_mode;
-	enum armv4_5_state core_state;
+	enum arm_state core_state;
 };
 
 struct armv7a_core_reg
diff --git a/src/target/etm.h b/src/target/etm.h
index 656e04b..92df0bf 100644
--- a/src/target/etm.h
+++ b/src/target/etm.h
@@ -164,7 +164,7 @@ struct etm_context
 	uint32_t trace_depth;		/* number of cycles to be analyzed, 0 if no data available */
 	etm_portmode_t portmode;	/* normal, multiplexed or demultiplexed */
 	etmv1_tracemode_t tracemode;	/* type of info trace contains */
-	int /*armv4_5_state_t*/ core_state;	/* current core state */
+	int /*arm_state_t*/ core_state;	/* current core state */
 	struct image *image;		/* source for target opcodes */
 	uint32_t pipe_index;		/* current trace cycle */
 	uint32_t data_index;		/* cycle holding next data packet */
diff --git a/src/target/feroceon.c b/src/target/feroceon.c
index 2644560..1c70154 100644
--- a/src/target/feroceon.c
+++ b/src/target/feroceon.c
@@ -455,7 +455,7 @@ int feroceon_bulk_write_memory(struct target *target, uint32_t address, uint32_t
 	int retval;
 	struct arm *armv4_5 = target-&gt;arch_info;
 	struct arm7_9_common *arm7_9 = armv4_5-&gt;arch_info;
-	enum armv4_5_state core_state = armv4_5-&gt;core_state;
+	enum arm_state core_state = armv4_5-&gt;core_state;
 	uint32_t x, flip, shift, save[7];
 	uint32_t i;
 
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 45692b8..253decb 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -867,7 +867,7 @@ static int xscale_arch_state(struct target *target)
 			&quot;cpsr: 0x%8.8&quot; PRIx32 &quot; pc: 0x%8.8&quot; PRIx32 &quot;\n&quot;
 			&quot;MMU: %s, D-Cache: %s, I-Cache: %s&quot;
 			&quot;%s&quot;,
-			 armv4_5_state_strings[armv4_5-&gt;core_state],
+			 arm_state_strings[armv4_5-&gt;core_state],
 			 Jim_Nvp_value2name_simple(nvp_target_debug_reason, target-&gt;debug_reason)-&gt;name ,
 			 arm_mode_name(armv4_5-&gt;core_mode),
 			 buf_get_u32(armv4_5-&gt;cpsr-&gt;value, 0, 32),
diff --git a/src/target/xscale.h b/src/target/xscale.h
index 6f81178..2bb2ba5 100644
--- a/src/target/xscale.h
+++ b/src/target/xscale.h
@@ -79,7 +79,7 @@ struct xscale_trace
 	int buffer_fill;				/* maximum number of trace runs to read (-1 for wrap-around) */
 	int pc_ok;
 	uint32_t current_pc;
-	armv4_5_state_t core_state;		/* current core state (ARM, Thumb, Jazelle) */
+	arm_state_t core_state;		/* current core state (ARM, Thumb, Jazelle) */
 };
 
 struct xscale_common

commit d4d16f1036bff4ce3c36edd1995e579fbf64e1c9
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 19:33:33 2009 -0800

    ARM: rename armv4_5_mode_* AS arm_mode_*
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index 928923d..408259e 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -1582,7 +1582,7 @@ int arm7_9_restore_context(struct target *target)
 	struct arm *armv4_5 = &amp;arm7_9-&gt;armv4_5_common;
 	struct reg *reg;
 	struct arm_reg *reg_arch_info;
-	enum armv4_5_mode current_mode = armv4_5-&gt;core_mode;
+	enum arm_mode current_mode = armv4_5-&gt;core_mode;
 	int i, j;
 	int dirty;
 	int mode_change;
@@ -2093,7 +2093,7 @@ int arm7_9_step(struct target *target, int current, uint32_t address, int handle
 }
 
 static int arm7_9_read_core_reg(struct target *target, struct reg *r,
-		int num, enum armv4_5_mode mode)
+		int num, enum arm_mode mode)
 {
 	uint32_t* reg_p[16];
 	uint32_t value;
@@ -2157,7 +2157,7 @@ static int arm7_9_read_core_reg(struct target *target, struct reg *r,
 }
 
 static int arm7_9_write_core_reg(struct target *target, struct reg *r,
-		int num, enum armv4_5_mode mode, uint32_t value)
+		int num, enum arm_mode mode, uint32_t value)
 {
 	uint32_t reg[16];
 	struct arm_reg *areg = r-&gt;arch_info;
diff --git a/src/target/arm_dpm.c b/src/target/arm_dpm.c
index 7cc48ab..b65e922 100644
--- a/src/target/arm_dpm.c
+++ b/src/target/arm_dpm.c
@@ -102,7 +102,7 @@ static int dpm_mcr(struct target *target, int cpnum,
 /* Toggles between recorded core mode (USR, SVC, etc) and a temporary one.
  * Routines *must* restore the original mode before returning!!
  */
-static int dpm_modeswitch(struct arm_dpm *dpm, enum armv4_5_mode mode)
+static int dpm_modeswitch(struct arm_dpm *dpm, enum arm_mode mode)
 {
 	int retval;
 	uint32_t cpsr;
@@ -348,7 +348,7 @@ int arm_dpm_write_dirty_registers(struct arm_dpm *dpm, bool bpwp)
 	 * actually find anything to do...
 	 */
 	do {
-		enum armv4_5_mode mode = ARM_MODE_ANY;
+		enum arm_mode mode = ARM_MODE_ANY;
 
 		did_write = false;
 
@@ -370,7 +370,7 @@ int arm_dpm_write_dirty_registers(struct arm_dpm *dpm, bool bpwp)
 
 			/* may need to pick and set a mode */
 			if (!did_write) {
-				enum armv4_5_mode tmode;
+				enum arm_mode tmode;
 
 				did_write = true;
 				mode = tmode = r-&gt;mode;
@@ -432,10 +432,10 @@ done:
  * Caller already filtered out SPSR access; mode is never MODE_SYS
  * or MODE_ANY.
  */
-static enum armv4_5_mode dpm_mapmode(struct arm *arm,
-		unsigned num, enum armv4_5_mode mode)
+static enum arm_mode dpm_mapmode(struct arm *arm,
+		unsigned num, enum arm_mode mode)
 {
-	enum armv4_5_mode amode = arm-&gt;core_mode;
+	enum arm_mode amode = arm-&gt;core_mode;
 
 	/* don't switch if the mode is already correct */
 	if (amode == ARM_MODE_SYS)
@@ -473,7 +473,7 @@ static enum armv4_5_mode dpm_mapmode(struct arm *arm,
  */
 
 static int arm_dpm_read_core_reg(struct target *target, struct reg *r,
-		int regnum, enum armv4_5_mode mode)
+		int regnum, enum arm_mode mode)
 {
 	struct arm_dpm *dpm = target_to_arm(target)-&gt;dpm;
 	int retval;
@@ -513,7 +513,7 @@ fail:
 }
 
 static int arm_dpm_write_core_reg(struct target *target, struct reg *r,
-		int regnum, enum armv4_5_mode mode, uint32_t value)
+		int regnum, enum arm_mode mode, uint32_t value)
 {
 	struct arm_dpm *dpm = target_to_arm(target)-&gt;dpm;
 	int retval;
@@ -566,7 +566,7 @@ static int arm_dpm_full_context(struct target *target)
 		goto done;
 
 	do {
-		enum armv4_5_mode mode = ARM_MODE_ANY;
+		enum arm_mode mode = ARM_MODE_ANY;
 
 		did_read = false;
 
diff --git a/src/target/arm_simulator.c b/src/target/arm_simulator.c
index 326240b..c252b44 100644
--- a/src/target/arm_simulator.c
+++ b/src/target/arm_simulator.c
@@ -665,7 +665,7 @@ int arm_simulate_step_core(struct target *target,
 		}
 		else
 		{
-			enum armv4_5_mode mode = sim-&gt;get_mode(sim);
+			enum arm_mode mode = sim-&gt;get_mode(sim);
 			int update_cpsr = 0;
 
 			if (instruction.info.load_store_multiple.S)
@@ -721,7 +721,7 @@ int arm_simulate_step_core(struct target *target,
 			uint32_t Rn = sim-&gt;get_reg_mode(sim,
 					instruction.info.load_store_multiple.Rn);
 			int bits_set = 0;
-			enum armv4_5_mode mode = sim-&gt;get_mode(sim);
+			enum arm_mode mode = sim-&gt;get_mode(sim);
 
 			for (i = 0; i &lt; 16; i++)
 			{
@@ -839,7 +839,7 @@ static void armv4_5_set_state(struct arm_sim_interface *sim, enum armv4_5_state
 }
 
 
-static enum armv4_5_mode armv4_5_get_mode(struct arm_sim_interface *sim)
+static enum arm_mode armv4_5_get_mode(struct arm_sim_interface *sim)
 {
 	struct arm *armv4_5 = (struct arm *)sim-&gt;user_data;
 
diff --git a/src/target/arm_simulator.h b/src/target/arm_simulator.h
index daca371..ae3afad 100644
--- a/src/target/arm_simulator.h
+++ b/src/target/arm_simulator.h
@@ -34,7 +34,7 @@ struct arm_sim_interface
 	uint32_t (*get_cpsr)(struct arm_sim_interface *sim, int pos, int bits);
 	enum armv4_5_state (*get_state)(struct arm_sim_interface *sim);
 	void (*set_state)(struct arm_sim_interface *sim, enum armv4_5_state mode);
-	enum armv4_5_mode (*get_mode)(struct arm_sim_interface *sim);
+	enum arm_mode (*get_mode)(struct arm_sim_interface *sim);
 };
 
 /* armv4_5 version */
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 1a92374..15c0a7f 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -163,7 +163,7 @@ bool is_arm_mode(unsigned psr_mode)
 }
 
 /** Map PSR mode bits to linear number indexing armv4_5_core_reg_map */
-int armv4_5_mode_to_number(enum armv4_5_mode mode)
+int arm_mode_to_number(enum arm_mode mode)
 {
 	switch (mode) {
 	case ARM_MODE_ANY:
@@ -191,7 +191,7 @@ int armv4_5_mode_to_number(enum armv4_5_mode mode)
 }
 
 /** Map linear number indexing armv4_5_core_reg_map to PSR mode bits. */
-enum armv4_5_mode armv4_5_number_to_mode(int number)
+enum arm_mode armv4_5_number_to_mode(int number)
 {
 	switch (number) {
 	case 0:
@@ -243,7 +243,7 @@ static const struct {
 	 * (Exception modes have both CPSR and SPSR registers ...)
 	 */
 	unsigned cookie;
-	enum armv4_5_mode mode;
+	enum arm_mode mode;
 } arm_core_regs[] = {
 	/* IMPORTANT:  we guarantee that the first eight cached registers
 	 * correspond to r0..r7, and the fifteenth to PC, so that callers
@@ -346,7 +346,7 @@ const int armv4_5_core_reg_map[8][17] =
  */
 void arm_set_cpsr(struct arm *arm, uint32_t cpsr)
 {
-	enum armv4_5_mode mode = cpsr &amp; 0x1f;
+	enum arm_mode mode = cpsr &amp; 0x1f;
 	int num;
 
 	/* NOTE:  this may be called very early, before the register
@@ -362,7 +362,7 @@ void arm_set_cpsr(struct arm *arm, uint32_t cpsr)
 	arm-&gt;core_mode = mode;
 
 	/* mode_to_number() warned; set up a somewhat-sane mapping */
-	num = armv4_5_mode_to_number(mode);
+	num = arm_mode_to_number(mode);
 	if (num &lt; 0) {
 		mode = ARM_MODE_USR;
 		num = 0;
@@ -512,7 +512,7 @@ static int armv4_5_set_core_reg(struct reg *reg, uint8_t *buf)
 		 * it won't hurt since CPSR is always flushed anyway.
 		 */
 		if (armv4_5_target-&gt;core_mode !=
-				(enum armv4_5_mode)(value &amp; 0x1f)) {
+				(enum arm_mode)(value &amp; 0x1f)) {
 			LOG_DEBUG(&quot;changing ARM core mode to '%s'&quot;,
 					arm_mode_name(value &amp; 0x1f));
 			value &amp;= ~((1 &lt;&lt; 24) | (1 &lt;&lt; 5));
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index 8e2fca2..e2b7b5a 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -30,7 +30,7 @@
 #include &lt;helper/command.h&gt;
 
 
-typedef enum armv4_5_mode
+typedef enum arm_mode
 {
 	ARM_MODE_USR = 16,
 	ARM_MODE_FIQ = 17,
@@ -41,13 +41,13 @@ typedef enum armv4_5_mode
 	ARM_MODE_UND = 27,
 	ARM_MODE_SYS = 31,
 	ARM_MODE_ANY = -1
-} armv4_5_mode_t;
+} arm_mode_t;
 
 const char *arm_mode_name(unsigned psr_mode);
 bool is_arm_mode(unsigned psr_mode);
 
-int armv4_5_mode_to_number(enum armv4_5_mode mode);
-enum armv4_5_mode armv4_5_number_to_mode(int number);
+int arm_mode_to_number(enum arm_mode mode);
+enum arm_mode armv4_5_number_to_mode(int number);
 
 typedef enum armv4_5_state
 {
@@ -62,7 +62,7 @@ extern char* armv4_5_state_strings[];
 extern const int armv4_5_core_reg_map[8][17];
 
 #define ARMV4_5_CORE_REG_MODE(cache, mode, num) \
-		cache-&gt;reg_list[armv4_5_core_reg_map[armv4_5_mode_to_number(mode)][num]]
+		cache-&gt;reg_list[armv4_5_core_reg_map[arm_mode_to_number(mode)][num]]
 
 /* offset into armv4_5 core register cache -- OBSOLETE, DO NOT USE! */
 enum { ARMV4_5_CPSR = 31, };
@@ -95,9 +95,9 @@ struct arm
 	 * seen on for example ARM7TDMI cores.  ARM_MODE_MON indicates three
 	 * more registers are shadowed, for &quot;Secure Monitor&quot; mode.
 	 */
-	enum armv4_5_mode core_type;
+	enum arm_mode core_type;
 
-	enum armv4_5_mode core_mode;
+	enum arm_mode core_mode;
 	enum armv4_5_state core_state;
 
 	/** Flag reporting unavailability of the BKPT instruction. */
@@ -122,9 +122,9 @@ struct arm
 
 	int (*full_context)(struct target *target);
 	int (*read_core_reg)(struct target *target, struct reg *reg,
-			int num, enum armv4_5_mode mode);
+			int num, enum arm_mode mode);
 	int (*write_core_reg)(struct target *target, struct reg *reg,
-			int num, enum armv4_5_mode mode, uint32_t value);
+			int num, enum arm_mode mode, uint32_t value);
 
 	/** Read coprocessor register.  */
 	int (*mrc)(struct target *target, int cpnum,
@@ -158,14 +158,14 @@ struct armv4_5_algorithm
 {
 	int common_magic;
 
-	enum armv4_5_mode core_mode;
+	enum arm_mode core_mode;
 	enum armv4_5_state core_state;
 };
 
 struct arm_reg
 {
 	int num;
-	enum armv4_5_mode mode;
+	enum arm_mode mode;
 	struct target *target;
 	struct arm *armv4_5_common;
 	uint32_t value;
diff --git a/src/target/armv7a.h b/src/target/armv7a.h
index f089c5c..ad1f094 100644
--- a/src/target/armv7a.h
+++ b/src/target/armv7a.h
@@ -118,14 +118,14 @@ struct armv7a_algorithm
 {
 	int common_magic;
 
-	enum armv4_5_mode core_mode;
+	enum arm_mode core_mode;
 	enum armv4_5_state core_state;
 };
 
 struct armv7a_core_reg
 {
 	int num;
-	enum armv4_5_mode mode;
+	enum arm_mode mode;
 	struct target *target;
 	struct armv7a_common *armv7a_common;
 };
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 57b1081..45692b8 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -1658,7 +1658,7 @@ static int xscale_deassert_reset(struct target *target)
 }
 
 static int xscale_read_core_reg(struct target *target, struct reg *r,
-		int num, enum armv4_5_mode mode)
+		int num, enum arm_mode mode)
 {
 	/** \todo add debug handler support for core register reads */
 	LOG_ERROR(&quot;not implemented&quot;);
@@ -1666,7 +1666,7 @@ static int xscale_read_core_reg(struct target *target, struct reg *r,
 }
 
 static int xscale_write_core_reg(struct target *target, struct reg *r,
-		int num, enum armv4_5_mode mode, uint32_t value)
+		int num, enum arm_mode mode, uint32_t value)
 {
 	/** \todo add debug handler support for core register writes */
 	LOG_ERROR(&quot;not implemented&quot;);
@@ -1697,7 +1697,7 @@ static int xscale_full_context(struct target *target)
 	 */
 	for (i = 1; i &lt; 7; i++)
 	{
-		enum armv4_5_mode mode = armv4_5_number_to_mode(i);
+		enum arm_mode mode = armv4_5_number_to_mode(i);
 		bool valid = true;
 		struct reg *r;
 
@@ -1774,7 +1774,7 @@ static int xscale_restore_banked(struct target *target)
 	 */
 	for (i = 1; i &lt; 7; i++)
 	{
-		enum armv4_5_mode mode = armv4_5_number_to_mode(i);
+		enum arm_mode mode = armv4_5_number_to_mode(i);
 		struct reg *r;
 
 		if (mode == ARM_MODE_USR)

commit 0073e7a69e55eb435fc2e274ba245a27779963e4
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 19:21:14 2009 -0800

    ARM: rename ARMV4_5_MODE_* as ARM_MODE_*
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/flash/arm_nandio.c b/src/flash/arm_nandio.c
index 558ed94..3991c0f 100644
--- a/src/flash/arm_nandio.c
+++ b/src/flash/arm_nandio.c
@@ -137,7 +137,7 @@ int arm_nandwrite(struct arm_nand_data *nand, uint8_t *data, int size)
 
 	/* set up algorithm and parameters */
 	algo.common_magic = ARMV4_5_COMMON_MAGIC;
-	algo.core_mode = ARMV4_5_MODE_SVC;
+	algo.core_mode = ARM_MODE_SVC;
 	algo.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN);
@@ -213,7 +213,7 @@ int arm_nandread(struct arm_nand_data *nand, uint8_t *data, uint32_t size)
 
 	/* set up algorithm and parameters */
 	algo.common_magic = ARMV4_5_COMMON_MAGIC;
-	algo.core_mode = ARMV4_5_MODE_SVC;
+	algo.core_mode = ARM_MODE_SVC;
 	algo.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN);
diff --git a/src/flash/nor/aduc702x.c b/src/flash/nor/aduc702x.c
index c223ec4..69c8274 100644
--- a/src/flash/nor/aduc702x.c
+++ b/src/flash/nor/aduc702x.c
@@ -242,7 +242,7 @@ static int aduc702x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32
 	}
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
diff --git a/src/flash/nor/cfi.c b/src/flash/nor/cfi.c
index 991110b..16ba999 100644
--- a/src/flash/nor/cfi.c
+++ b/src/flash/nor/cfi.c
@@ -1086,7 +1086,7 @@ static int cfi_intel_write_block(struct flash_bank *bank, uint8_t *buffer, uint3
 	cfi_intel_clear_status_register(bank);
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	/* If we are setting up the write_algorith, we need target_code_src */
@@ -1409,7 +1409,7 @@ static int cfi_spansion_write_block(struct flash_bank *bank, uint8_t *buffer, ui
 	};
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	int target_code_size;
diff --git a/src/flash/nor/ecos.c b/src/flash/nor/ecos.c
index 41b06b3..2524ae7 100644
--- a/src/flash/nor/ecos.c
+++ b/src/flash/nor/ecos.c
@@ -211,7 +211,7 @@ static int runCode(struct ecosflash_flash_bank *info,
 	struct reg_param reg_params[3];
 	struct armv4_5_algorithm armv4_5_info;
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN_OUT);
diff --git a/src/flash/nor/lpc2000.c b/src/flash/nor/lpc2000.c
index 2b1e671..c14df1f 100644
--- a/src/flash/nor/lpc2000.c
+++ b/src/flash/nor/lpc2000.c
@@ -293,7 +293,7 @@ static int lpc2000_iap_call(struct flash_bank *bank, int code, uint32_t param_ta
 		case lpc2000_v1:
 		case lpc2000_v2:
 			armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-			armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+			armv4_5_info.core_mode = ARM_MODE_SVC;
 			armv4_5_info.core_state = ARM_STATE_ARM;
 			iap_entry_point = 0x7ffffff1;
 			break;
diff --git a/src/flash/nor/lpc2900.c b/src/flash/nor/lpc2900.c
index 8dc06d1..aec8bcd 100644
--- a/src/flash/nor/lpc2900.c
+++ b/src/flash/nor/lpc2900.c
@@ -1424,7 +1424,7 @@ static int lpc2900_write(struct flash_bank *bank, uint8_t *buffer,
 
 			/* Execute algorithm, assume breakpoint for last instruction */
 			armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-			armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+			armv4_5_info.core_mode = ARM_MODE_SVC;
 			armv4_5_info.core_state = ARM_STATE_ARM;
 
 			retval = target_run_algorithm(target, 0, NULL, 5, reg_params,
diff --git a/src/flash/nor/str7x.c b/src/flash/nor/str7x.c
index ea584a5..5767b93 100644
--- a/src/flash/nor/str7x.c
+++ b/src/flash/nor/str7x.c
@@ -372,7 +372,7 @@ static int str7x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32_t
 	}
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
diff --git a/src/flash/nor/str9x.c b/src/flash/nor/str9x.c
index 21760f3..60367cb 100644
--- a/src/flash/nor/str9x.c
+++ b/src/flash/nor/str9x.c
@@ -409,7 +409,7 @@ static int str9x_write_block(struct flash_bank *bank,
 	}
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index 4d81189..928923d 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -1622,10 +1622,10 @@ int arm7_9_restore_context(struct target *target)
 				{
 					dirty = 1;
 					LOG_DEBUG(&quot;examining dirty reg: %s&quot;, reg-&gt;name);
-					if ((reg_arch_info-&gt;mode != ARMV4_5_MODE_ANY)
+					if ((reg_arch_info-&gt;mode != ARM_MODE_ANY)
 						&amp;&amp; (reg_arch_info-&gt;mode != current_mode)
-						&amp;&amp; !((reg_arch_info-&gt;mode == ARMV4_5_MODE_USR) &amp;&amp; (armv4_5-&gt;core_mode == ARMV4_5_MODE_SYS))
-						&amp;&amp; !((reg_arch_info-&gt;mode == ARMV4_5_MODE_SYS) &amp;&amp; (armv4_5-&gt;core_mode == ARMV4_5_MODE_USR)))
+						&amp;&amp; !((reg_arch_info-&gt;mode == ARM_MODE_USR) &amp;&amp; (armv4_5-&gt;core_mode == ARM_MODE_SYS))
+						&amp;&amp; !((reg_arch_info-&gt;mode == ARM_MODE_SYS) &amp;&amp; (armv4_5-&gt;core_mode == ARM_MODE_USR)))
 					{
 						mode_change = 1;
 						LOG_DEBUG(&quot;require mode change&quot;);
@@ -1684,7 +1684,7 @@ int arm7_9_restore_context(struct target *target)
 
 			reg = &amp;ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, armv4_5_number_to_mode(i), 16);
 			reg_arch_info = reg-&gt;arch_info;
-			if ((reg-&gt;dirty) &amp;&amp; (reg_arch_info-&gt;mode != ARMV4_5_MODE_ANY))
+			if ((reg-&gt;dirty) &amp;&amp; (reg_arch_info-&gt;mode != ARM_MODE_ANY))
 			{
 				LOG_DEBUG(&quot;writing SPSR of mode %i with value 0x%8.8&quot; PRIx32 &quot;&quot;, i, buf_get_u32(reg-&gt;value, 0, 32));
 				arm7_9-&gt;write_xpsr(target, buf_get_u32(reg-&gt;value, 0, 32), 1);
@@ -2107,9 +2107,9 @@ static int arm7_9_read_core_reg(struct target *target, struct reg *r,
 	if ((num &lt; 0) || (num &gt; 16))
 		return ERROR_INVALID_ARGUMENTS;
 
-	if ((mode != ARMV4_5_MODE_ANY)
+	if ((mode != ARM_MODE_ANY)
 			&amp;&amp; (mode != armv4_5-&gt;core_mode)
-			&amp;&amp; (areg-&gt;mode != ARMV4_5_MODE_ANY))
+			&amp;&amp; (areg-&gt;mode != ARM_MODE_ANY))
 	{
 		uint32_t tmp_cpsr;
 
@@ -2132,7 +2132,7 @@ static int arm7_9_read_core_reg(struct target *target, struct reg *r,
 		/* read a program status register
 		 * if the register mode is MODE_ANY, we read the cpsr, otherwise a spsr
 		 */
-		arm7_9-&gt;read_xpsr(target, &amp;value, areg-&gt;mode != ARMV4_5_MODE_ANY);
+		arm7_9-&gt;read_xpsr(target, &amp;value, areg-&gt;mode != ARM_MODE_ANY);
 	}
 
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
@@ -2144,9 +2144,9 @@ static int arm7_9_read_core_reg(struct target *target, struct reg *r,
 	r-&gt;dirty = 0;
 	buf_set_u32(r-&gt;value, 0, 32, value);
 
-	if ((mode != ARMV4_5_MODE_ANY)
+	if ((mode != ARM_MODE_ANY)
 			&amp;&amp; (mode != armv4_5-&gt;core_mode)
-			&amp;&amp; (areg-&gt;mode != ARMV4_5_MODE_ANY))	{
+			&amp;&amp; (areg-&gt;mode != ARM_MODE_ANY))	{
 		/* restore processor mode (mask T bit) */
 		arm7_9-&gt;write_xpsr_im8(target,
 				buf_get_u32(armv4_5-&gt;cpsr-&gt;value, 0, 8)
@@ -2169,9 +2169,9 @@ static int arm7_9_write_core_reg(struct target *target, struct reg *r,
 	if ((num &lt; 0) || (num &gt; 16))
 		return ERROR_INVALID_ARGUMENTS;
 
-	if ((mode != ARMV4_5_MODE_ANY)
+	if ((mode != ARM_MODE_ANY)
 			&amp;&amp; (mode != armv4_5-&gt;core_mode)
-			&amp;&amp; (areg-&gt;mode != ARMV4_5_MODE_ANY))	{
+			&amp;&amp; (areg-&gt;mode != ARM_MODE_ANY))	{
 		uint32_t tmp_cpsr;
 
 		/* change processor mode (mask T bit) */
@@ -2193,7 +2193,7 @@ static int arm7_9_write_core_reg(struct target *target, struct reg *r,
 		/* write a program status register
 		* if the register mode is MODE_ANY, we write the cpsr, otherwise a spsr
 		*/
-		int spsr = (areg-&gt;mode != ARMV4_5_MODE_ANY);
+		int spsr = (areg-&gt;mode != ARM_MODE_ANY);
 
 		/* if we're writing the CPSR, mask the T bit */
 		if (!spsr)
@@ -2205,9 +2205,9 @@ static int arm7_9_write_core_reg(struct target *target, struct reg *r,
 	r-&gt;valid = 1;
 	r-&gt;dirty = 0;
 
-	if ((mode != ARMV4_5_MODE_ANY)
+	if ((mode != ARM_MODE_ANY)
 			&amp;&amp; (mode != armv4_5-&gt;core_mode)
-			&amp;&amp; (areg-&gt;mode != ARMV4_5_MODE_ANY))	{
+			&amp;&amp; (areg-&gt;mode != ARM_MODE_ANY))	{
 		/* restore processor mode (mask T bit) */
 		arm7_9-&gt;write_xpsr_im8(target,
 				buf_get_u32(armv4_5-&gt;cpsr-&gt;value, 0, 8)
@@ -2383,7 +2383,7 @@ int arm7_9_read_memory(struct target *target, uint32_t address, uint32_t size, u
 		return ERROR_TARGET_DATA_ABORT;
 	}
 
-	if (((cpsr &amp; 0x1f) == ARMV4_5_MODE_ABT) &amp;&amp; (armv4_5-&gt;core_mode != ARMV4_5_MODE_ABT))
+	if (((cpsr &amp; 0x1f) == ARM_MODE_ABT) &amp;&amp; (armv4_5-&gt;core_mode != ARM_MODE_ABT))
 	{
 		LOG_WARNING(&quot;memory read caused data abort (address: 0x%8.8&quot; PRIx32 &quot;, size: 0x%&quot; PRIx32 &quot;, count: 0x%&quot; PRIx32 &quot;)&quot;, address, size, count);
 
@@ -2571,7 +2571,7 @@ int arm7_9_write_memory(struct target *target, uint32_t address, uint32_t size,
 		return ERROR_TARGET_DATA_ABORT;
 	}
 
-	if (((cpsr &amp; 0x1f) == ARMV4_5_MODE_ABT) &amp;&amp; (armv4_5-&gt;core_mode != ARMV4_5_MODE_ABT))
+	if (((cpsr &amp; 0x1f) == ARM_MODE_ABT) &amp;&amp; (armv4_5-&gt;core_mode != ARM_MODE_ABT))
 	{
 		LOG_WARNING(&quot;memory write caused data abort (address: 0x%8.8&quot; PRIx32 &quot;, size: 0x%&quot; PRIx32 &quot;, count: 0x%&quot; PRIx32 &quot;)&quot;, address, size, count);
 
@@ -2697,7 +2697,7 @@ int arm7_9_bulk_write_memory(struct target *target, uint32_t address, uint32_t c
 	struct reg_param reg_params[1];
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN_OUT);
diff --git a/src/target/arm_dpm.c b/src/target/arm_dpm.c
index df9bd95..7cc48ab 100644
--- a/src/target/arm_dpm.c
+++ b/src/target/arm_dpm.c
@@ -108,7 +108,7 @@ static int dpm_modeswitch(struct arm_dpm *dpm, enum armv4_5_mode mode)
 	uint32_t cpsr;
 
 	/* restore previous mode */
-	if (mode == ARMV4_5_MODE_ANY)
+	if (mode == ARM_MODE_ANY)
 		cpsr = buf_get_u32(dpm-&gt;arm-&gt;cpsr-&gt;value, 0, 32);
 
 	/* else force to the specified mode */
@@ -348,7 +348,7 @@ int arm_dpm_write_dirty_registers(struct arm_dpm *dpm, bool bpwp)
 	 * actually find anything to do...
 	 */
 	do {
-		enum armv4_5_mode mode = ARMV4_5_MODE_ANY;
+		enum armv4_5_mode mode = ARM_MODE_ANY;
 
 		did_write = false;
 
@@ -382,10 +382,10 @@ int arm_dpm_write_dirty_registers(struct arm_dpm *dpm, bool bpwp)
 					 * we &quot;know&quot; core mode is accurate
 					 * since we haven't changed it yet
 					 */
-					if (arm-&gt;core_mode == ARMV4_5_MODE_FIQ
-							&amp;&amp; ARMV4_5_MODE_ANY
+					if (arm-&gt;core_mode == ARM_MODE_FIQ
+							&amp;&amp; ARM_MODE_ANY
 								!= mode)
-						tmode = ARMV4_5_MODE_USR;
+						tmode = ARM_MODE_USR;
 					break;
 				case 16:
 					/* SPSR */
@@ -394,7 +394,7 @@ int arm_dpm_write_dirty_registers(struct arm_dpm *dpm, bool bpwp)
 				}
 
 				/* REVISIT error checks */
-				if (tmode != ARMV4_5_MODE_ANY)
+				if (tmode != ARM_MODE_ANY)
 					retval = dpm_modeswitch(dpm, tmode);
 			}
 			if (r-&gt;mode != mode)
@@ -412,7 +412,7 @@ int arm_dpm_write_dirty_registers(struct arm_dpm *dpm, bool bpwp)
 	 * or it's dirty.  Must write PC to ensure the return address is
 	 * defined, and must not write it before CPSR.
 	 */
-	retval = dpm_modeswitch(dpm, ARMV4_5_MODE_ANY);
+	retval = dpm_modeswitch(dpm, ARM_MODE_ANY);
 	arm-&gt;cpsr-&gt;dirty = false;
 
 	retval = dpm_write_reg(dpm, &amp;cache-&gt;reg_list[15], 15);
@@ -427,7 +427,7 @@ done:
 	return retval;
 }
 
-/* Returns ARMV4_5_MODE_ANY or temporary mode to use while reading the
+/* Returns ARM_MODE_ANY or temporary mode to use while reading the
  * specified register ... works around flakiness from ARM core calls.
  * Caller already filtered out SPSR access; mode is never MODE_SYS
  * or MODE_ANY.
@@ -438,10 +438,10 @@ static enum armv4_5_mode dpm_mapmode(struct arm *arm,
 	enum armv4_5_mode amode = arm-&gt;core_mode;
 
 	/* don't switch if the mode is already correct */
-	if (amode == ARMV4_5_MODE_SYS)
-		 amode = ARMV4_5_MODE_USR;
+	if (amode == ARM_MODE_SYS)
+		 amode = ARM_MODE_USR;
 	if (mode == amode)
-		return ARMV4_5_MODE_ANY;
+		return ARM_MODE_ANY;
 
 	switch (num) {
 	/* don't switch for non-shadowed registers (r0..r7, r15/pc, cpsr) */
@@ -451,7 +451,7 @@ static enum armv4_5_mode dpm_mapmode(struct arm *arm,
 		break;
 	/* r8..r12 aren't shadowed for anything except FIQ */
 	case 8 ... 12:
-		if (mode == ARMV4_5_MODE_FIQ)
+		if (mode == ARM_MODE_FIQ)
 			return mode;
 		break;
 	/* r13/sp, and r14/lr are always shadowed */
@@ -462,7 +462,7 @@ static enum armv4_5_mode dpm_mapmode(struct arm *arm,
 		LOG_WARNING(&quot;invalid register #%u&quot;, num);
 		break;
 	}
-	return ARMV4_5_MODE_ANY;
+	return ARM_MODE_ANY;
 }
 
 
@@ -482,7 +482,7 @@ static int arm_dpm_read_core_reg(struct target *target, struct reg *r,
 		return ERROR_INVALID_ARGUMENTS;
 
 	if (regnum == 16) {
-		if (mode != ARMV4_5_MODE_ANY)
+		if (mode != ARM_MODE_ANY)
 			regnum = 17;
 	} else
 		mode = dpm_mapmode(dpm-&gt;arm, regnum, mode);
@@ -495,7 +495,7 @@ static int arm_dpm_read_core_reg(struct target *target, struct reg *r,
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (mode != ARMV4_5_MODE_ANY) {
+	if (mode != ARM_MODE_ANY) {
 		retval = dpm_modeswitch(dpm, mode);
 		if (retval != ERROR_OK)
 			goto fail;
@@ -504,8 +504,8 @@ static int arm_dpm_read_core_reg(struct target *target, struct reg *r,
 	retval = dpm_read_reg(dpm, r, regnum);
 	/* always clean up, regardless of error */
 
-	if (mode != ARMV4_5_MODE_ANY)
-		/* (void) */ dpm_modeswitch(dpm, ARMV4_5_MODE_ANY);
+	if (mode != ARM_MODE_ANY)
+		/* (void) */ dpm_modeswitch(dpm, ARM_MODE_ANY);
 
 fail:
 	/* (void) */ dpm-&gt;finish(dpm);
@@ -523,7 +523,7 @@ static int arm_dpm_write_core_reg(struct target *target, struct reg *r,
 		return ERROR_INVALID_ARGUMENTS;
 
 	if (regnum == 16) {
-		if (mode != ARMV4_5_MODE_ANY)
+		if (mode != ARM_MODE_ANY)
 			regnum = 17;
 	} else
 		mode = dpm_mapmode(dpm-&gt;arm, regnum, mode);
@@ -536,7 +536,7 @@ static int arm_dpm_write_core_reg(struct target *target, struct reg *r,
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (mode != ARMV4_5_MODE_ANY) {
+	if (mode != ARM_MODE_ANY) {
 		retval = dpm_modeswitch(dpm, mode);
 		if (retval != ERROR_OK)
 			goto fail;
@@ -545,8 +545,8 @@ static int arm_dpm_write_core_reg(struct target *target, struct reg *r,
 	retval = dpm_write_reg(dpm, r, regnum);
 	/* always clean up, regardless of error */
 
-	if (mode != ARMV4_5_MODE_ANY)
-		/* (void) */ dpm_modeswitch(dpm, ARMV4_5_MODE_ANY);
+	if (mode != ARM_MODE_ANY)
+		/* (void) */ dpm_modeswitch(dpm, ARM_MODE_ANY);
 
 fail:
 	/* (void) */ dpm-&gt;finish(dpm);
@@ -566,7 +566,7 @@ static int arm_dpm_full_context(struct target *target)
 		goto done;
 
 	do {
-		enum armv4_5_mode mode = ARMV4_5_MODE_ANY;
+		enum armv4_5_mode mode = ARM_MODE_ANY;
 
 		did_read = false;
 
@@ -593,8 +593,8 @@ static int arm_dpm_full_context(struct target *target)
 				/* For R8..R12 when we've entered debug
 				 * state in FIQ mode... patch mode.
 				 */
-				if (mode == ARMV4_5_MODE_ANY)
-					mode = ARMV4_5_MODE_USR;
+				if (mode == ARM_MODE_ANY)
+					mode = ARM_MODE_USR;
 
 				/* REVISIT error checks */
 				retval = dpm_modeswitch(dpm, mode);
@@ -611,7 +611,7 @@ static int arm_dpm_full_context(struct target *target)
 
 	} while (did_read);
 
-	retval = dpm_modeswitch(dpm, ARMV4_5_MODE_ANY);
+	retval = dpm_modeswitch(dpm, ARM_MODE_ANY);
 	/* (void) */ dpm-&gt;finish(dpm);
 done:
 	return retval;
diff --git a/src/target/arm_semihosting.c b/src/target/arm_semihosting.c
index f4e9199..dd6a669 100644
--- a/src/target/arm_semihosting.c
+++ b/src/target/arm_semihosting.c
@@ -46,7 +46,7 @@ static int do_semihosting(struct target *target)
 	struct arm *armv4_5 = target_to_armv4_5(target);
 	uint32_t r0 = buf_get_u32(armv4_5-&gt;core_cache-&gt;reg_list[0].value, 0, 32);
 	uint32_t r1 = buf_get_u32(armv4_5-&gt;core_cache-&gt;reg_list[1].value, 0, 32);
-	uint32_t lr = buf_get_u32(ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, ARMV4_5_MODE_SVC, 14).value, 0, 32);
+	uint32_t lr = buf_get_u32(ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache, ARM_MODE_SVC, 14).value, 0, 32);
 	uint32_t spsr = buf_get_u32(armv4_5-&gt;spsr-&gt;value, 0, 32);;
 	uint8_t params[16];
 	int retval, result;
@@ -410,7 +410,7 @@ int arm_semihosting(struct target *target, int *retval)
 	uint32_t lr, spsr;
 	struct reg *r;
 
-	if (!arm-&gt;is_semihosting || arm-&gt;core_mode != ARMV4_5_MODE_SVC)
+	if (!arm-&gt;is_semihosting || arm-&gt;core_mode != ARM_MODE_SVC)
 		return 0;
 
 	/* Check for PC == 8:  Supervisor Call vector
diff --git a/src/target/arm_simulator.c b/src/target/arm_simulator.c
index a1ed54c..326240b 100644
--- a/src/target/arm_simulator.c
+++ b/src/target/arm_simulator.c
@@ -673,7 +673,7 @@ int arm_simulate_step_core(struct target *target,
 				if (instruction.info.load_store_multiple.register_list &amp; 0x8000)
 					update_cpsr = 1;
 				else
-					mode = ARMV4_5_MODE_USR;
+					mode = ARM_MODE_USR;
 			}
 
 			for (i = 0; i &lt; 16; i++)
@@ -731,7 +731,7 @@ int arm_simulate_step_core(struct target *target,
 
 			if (instruction.info.load_store_multiple.S)
 			{
-				mode = ARMV4_5_MODE_USR;
+				mode = ARM_MODE_USR;
 			}
 
 			switch (instruction.info.load_store_multiple.addressing_mode)
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index a893e11..1a92374 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -89,43 +89,43 @@ static const struct {
 	 */
 	{
 		.name = &quot;User&quot;,
-		.psr = ARMV4_5_MODE_USR,
+		.psr = ARM_MODE_USR,
 		.n_indices = ARRAY_SIZE(arm_usr_indices),
 		.indices = arm_usr_indices,
 	},
 	{
 		.name = &quot;FIQ&quot;,
-		.psr = ARMV4_5_MODE_FIQ,
+		.psr = ARM_MODE_FIQ,
 		.n_indices = ARRAY_SIZE(arm_fiq_indices),
 		.indices = arm_fiq_indices,
 	},
 	{
 		.name = &quot;Supervisor&quot;,
-		.psr = ARMV4_5_MODE_SVC,
+		.psr = ARM_MODE_SVC,
 		.n_indices = ARRAY_SIZE(arm_svc_indices),
 		.indices = arm_svc_indices,
 	},
 	{
 		.name = &quot;Abort&quot;,
-		.psr = ARMV4_5_MODE_ABT,
+		.psr = ARM_MODE_ABT,
 		.n_indices = ARRAY_SIZE(arm_abt_indices),
 		.indices = arm_abt_indices,
 	},
 	{
 		.name = &quot;IRQ&quot;,
-		.psr = ARMV4_5_MODE_IRQ,
+		.psr = ARM_MODE_IRQ,
 		.n_indices = ARRAY_SIZE(arm_irq_indices),
 		.indices = arm_irq_indices,
 	},
 	{
 		.name = &quot;Undefined instruction&quot;,
-		.psr = ARMV4_5_MODE_UND,
+		.psr = ARM_MODE_UND,
 		.n_indices = ARRAY_SIZE(arm_und_indices),
 		.indices = arm_und_indices,
 	},
 	{
 		.name = &quot;System&quot;,
-		.psr = ARMV4_5_MODE_SYS,
+		.psr = ARM_MODE_SYS,
 		.n_indices = ARRAY_SIZE(arm_usr_indices),
 		.indices = arm_usr_indices,
 	},
@@ -166,21 +166,21 @@ bool is_arm_mode(unsigned psr_mode)
 int armv4_5_mode_to_number(enum armv4_5_mode mode)
 {
 	switch (mode) {
-	case ARMV4_5_MODE_ANY:
+	case ARM_MODE_ANY:
 		/* map MODE_ANY to user mode */
-	case ARMV4_5_MODE_USR:
+	case ARM_MODE_USR:
 		return 0;
-	case ARMV4_5_MODE_FIQ:
+	case ARM_MODE_FIQ:
 		return 1;
-	case ARMV4_5_MODE_IRQ:
+	case ARM_MODE_IRQ:
 		return 2;
-	case ARMV4_5_MODE_SVC:
+	case ARM_MODE_SVC:
 		return 3;
-	case ARMV4_5_MODE_ABT:
+	case ARM_MODE_ABT:
 		return 4;
-	case ARMV4_5_MODE_UND:
+	case ARM_MODE_UND:
 		return 5;
-	case ARMV4_5_MODE_SYS:
+	case ARM_MODE_SYS:
 		return 6;
 	case ARM_MODE_MON:
 		return 7;
@@ -195,24 +195,24 @@ enum armv4_5_mode armv4_5_number_to_mode(int number)
 {
 	switch (number) {
 	case 0:
-		return ARMV4_5_MODE_USR;
+		return ARM_MODE_USR;
 	case 1:
-		return ARMV4_5_MODE_FIQ;
+		return ARM_MODE_FIQ;
 	case 2:
-		return ARMV4_5_MODE_IRQ;
+		return ARM_MODE_IRQ;
 	case 3:
-		return ARMV4_5_MODE_SVC;
+		return ARM_MODE_SVC;
 	case 4:
-		return ARMV4_5_MODE_ABT;
+		return ARM_MODE_ABT;
 	case 5:
-		return ARMV4_5_MODE_UND;
+		return ARM_MODE_UND;
 	case 6:
-		return ARMV4_5_MODE_SYS;
+		return ARM_MODE_SYS;
 	case 7:
 		return ARM_MODE_MON;
 	default:
 		LOG_ERROR(&quot;mode index out of bounds %d&quot;, number);
-		return ARMV4_5_MODE_ANY;
+		return ARM_MODE_ANY;
 	}
 }
 
@@ -249,59 +249,59 @@ static const struct {
 	 * correspond to r0..r7, and the fifteenth to PC, so that callers
 	 * don't need to map them.
 	 */
-	{ .name = &quot;r0&quot;, .cookie = 0, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r1&quot;, .cookie = 1, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r2&quot;, .cookie = 2, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r3&quot;, .cookie = 3, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r4&quot;, .cookie = 4, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r5&quot;, .cookie = 5, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r6&quot;, .cookie = 6, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r7&quot;, .cookie = 7, .mode = ARMV4_5_MODE_ANY, },
+	{ .name = &quot;r0&quot;, .cookie = 0, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r1&quot;, .cookie = 1, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r2&quot;, .cookie = 2, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r3&quot;, .cookie = 3, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r4&quot;, .cookie = 4, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r5&quot;, .cookie = 5, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r6&quot;, .cookie = 6, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r7&quot;, .cookie = 7, .mode = ARM_MODE_ANY, },
 
 	/* NOTE: regs 8..12 might be shadowed by FIQ ... flagging
 	 * them as MODE_ANY creates special cases.  (ANY means
 	 * &quot;not mapped&quot; elsewhere; here it's &quot;everything but FIQ&quot;.)
 	 */
-	{ .name = &quot;r8&quot;, .cookie = 8, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r9&quot;, .cookie = 9, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r10&quot;, .cookie = 10, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r11&quot;, .cookie = 11, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;r12&quot;, .cookie = 12, .mode = ARMV4_5_MODE_ANY, },
+	{ .name = &quot;r8&quot;, .cookie = 8, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r9&quot;, .cookie = 9, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r10&quot;, .cookie = 10, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r11&quot;, .cookie = 11, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;r12&quot;, .cookie = 12, .mode = ARM_MODE_ANY, },
 
 	/* NOTE all MODE_USR registers are equivalent to MODE_SYS ones */
-	{ .name = &quot;sp_usr&quot;, .cookie = 13, .mode = ARMV4_5_MODE_USR, },
-	{ .name = &quot;lr_usr&quot;, .cookie = 14, .mode = ARMV4_5_MODE_USR, },
+	{ .name = &quot;sp_usr&quot;, .cookie = 13, .mode = ARM_MODE_USR, },
+	{ .name = &quot;lr_usr&quot;, .cookie = 14, .mode = ARM_MODE_USR, },
 
 	/* guaranteed to be at index 15 */
-	{ .name = &quot;pc&quot;, .cookie = 15, .mode = ARMV4_5_MODE_ANY, },
+	{ .name = &quot;pc&quot;, .cookie = 15, .mode = ARM_MODE_ANY, },
 
-	{ .name = &quot;r8_fiq&quot;, .cookie = 8, .mode = ARMV4_5_MODE_FIQ, },
-	{ .name = &quot;r9_fiq&quot;, .cookie = 9, .mode = ARMV4_5_MODE_FIQ, },
-	{ .name = &quot;r10_fiq&quot;, .cookie = 10, .mode = ARMV4_5_MODE_FIQ, },
-	{ .name = &quot;r11_fiq&quot;, .cookie = 11, .mode = ARMV4_5_MODE_FIQ, },
-	{ .name = &quot;r12_fiq&quot;, .cookie = 12, .mode = ARMV4_5_MODE_FIQ, },
+	{ .name = &quot;r8_fiq&quot;, .cookie = 8, .mode = ARM_MODE_FIQ, },
+	{ .name = &quot;r9_fiq&quot;, .cookie = 9, .mode = ARM_MODE_FIQ, },
+	{ .name = &quot;r10_fiq&quot;, .cookie = 10, .mode = ARM_MODE_FIQ, },
+	{ .name = &quot;r11_fiq&quot;, .cookie = 11, .mode = ARM_MODE_FIQ, },
+	{ .name = &quot;r12_fiq&quot;, .cookie = 12, .mode = ARM_MODE_FIQ, },
 
-	{ .name = &quot;sp_fiq&quot;, .cookie = 13, .mode = ARMV4_5_MODE_FIQ, },
-	{ .name = &quot;lr_fiq&quot;, .cookie = 14, .mode = ARMV4_5_MODE_FIQ, },
+	{ .name = &quot;sp_fiq&quot;, .cookie = 13, .mode = ARM_MODE_FIQ, },
+	{ .name = &quot;lr_fiq&quot;, .cookie = 14, .mode = ARM_MODE_FIQ, },
 
-	{ .name = &quot;sp_irq&quot;, .cookie = 13, .mode = ARMV4_5_MODE_IRQ, },
-	{ .name = &quot;lr_irq&quot;, .cookie = 14, .mode = ARMV4_5_MODE_IRQ, },
+	{ .name = &quot;sp_irq&quot;, .cookie = 13, .mode = ARM_MODE_IRQ, },
+	{ .name = &quot;lr_irq&quot;, .cookie = 14, .mode = ARM_MODE_IRQ, },
 
-	{ .name = &quot;sp_svc&quot;, .cookie = 13, .mode = ARMV4_5_MODE_SVC, },
-	{ .name = &quot;lr_svc&quot;, .cookie = 14, .mode = ARMV4_5_MODE_SVC, },
+	{ .name = &quot;sp_svc&quot;, .cookie = 13, .mode = ARM_MODE_SVC, },
+	{ .name = &quot;lr_svc&quot;, .cookie = 14, .mode = ARM_MODE_SVC, },
 
-	{ .name = &quot;sp_abt&quot;, .cookie = 13, .mode = ARMV4_5_MODE_ABT, },
-	{ .name = &quot;lr_abt&quot;, .cookie = 14, .mode = ARMV4_5_MODE_ABT, },
+	{ .name = &quot;sp_abt&quot;, .cookie = 13, .mode = ARM_MODE_ABT, },
+	{ .name = &quot;lr_abt&quot;, .cookie = 14, .mode = ARM_MODE_ABT, },
 
-	{ .name = &quot;sp_und&quot;, .cookie = 13, .mode = ARMV4_5_MODE_UND, },
-	{ .name = &quot;lr_und&quot;, .cookie = 14, .mode = ARMV4_5_MODE_UND, },
+	{ .name = &quot;sp_und&quot;, .cookie = 13, .mode = ARM_MODE_UND, },
+	{ .name = &quot;lr_und&quot;, .cookie = 14, .mode = ARM_MODE_UND, },
 
-	{ .name = &quot;cpsr&quot;, .cookie = 16, .mode = ARMV4_5_MODE_ANY, },
-	{ .name = &quot;spsr_fiq&quot;, .cookie = 16, .mode = ARMV4_5_MODE_FIQ, },
-	{ .name = &quot;spsr_irq&quot;, .cookie = 16, .mode = ARMV4_5_MODE_IRQ, },
-	{ .name = &quot;spsr_svc&quot;, .cookie = 16, .mode = ARMV4_5_MODE_SVC, },
-	{ .name = &quot;spsr_abt&quot;, .cookie = 16, .mode = ARMV4_5_MODE_ABT, },
-	{ .name = &quot;spsr_und&quot;, .cookie = 16, .mode = ARMV4_5_MODE_UND, },
+	{ .name = &quot;cpsr&quot;, .cookie = 16, .mode = ARM_MODE_ANY, },
+	{ .name = &quot;spsr_fiq&quot;, .cookie = 16, .mode = ARM_MODE_FIQ, },
+	{ .name = &quot;spsr_irq&quot;, .cookie = 16, .mode = ARM_MODE_IRQ, },
+	{ .name = &quot;spsr_svc&quot;, .cookie = 16, .mode = ARM_MODE_SVC, },
+	{ .name = &quot;spsr_abt&quot;, .cookie = 16, .mode = ARM_MODE_ABT, },
+	{ .name = &quot;spsr_und&quot;, .cookie = 16, .mode = ARM_MODE_UND, },
 
 	{ .name = &quot;sp_mon&quot;, .cookie = 13, .mode = ARM_MODE_MON, },
 	{ .name = &quot;lr_mon&quot;, .cookie = 14, .mode = ARM_MODE_MON, },
@@ -364,12 +364,12 @@ void arm_set_cpsr(struct arm *arm, uint32_t cpsr)
 	/* mode_to_number() warned; set up a somewhat-sane mapping */
 	num = armv4_5_mode_to_number(mode);
 	if (num &lt; 0) {
-		mode = ARMV4_5_MODE_USR;
+		mode = ARM_MODE_USR;
 		num = 0;
 	}
 
 	arm-&gt;map = &amp;armv4_5_core_reg_map[num][0];
-	arm-&gt;spsr = (mode == ARMV4_5_MODE_USR || mode == ARMV4_5_MODE_SYS)
+	arm-&gt;spsr = (mode == ARM_MODE_USR || mode == ARM_MODE_SYS)
 			? NULL
 			: arm-&gt;core_cache-&gt;reg_list + arm-&gt;map[16];
 
@@ -517,7 +517,7 @@ static int armv4_5_set_core_reg(struct reg *reg, uint8_t *buf)
 					arm_mode_name(value &amp; 0x1f));
 			value &amp;= ~((1 &lt;&lt; 24) | (1 &lt;&lt; 5));
 			armv4_5_target-&gt;write_core_reg(target, reg,
-					16, ARMV4_5_MODE_ANY, value);
+					16, ARM_MODE_ANY, value);
 		}
 	} else {
 		buf_set_u32(reg-&gt;value, 0, 32, value);
@@ -646,9 +646,9 @@ COMMAND_HANDLER(handle_armv4_5_reg_command)
 
 		/* label this bank of registers (or shadows) */
 		switch (arm_mode_data[mode].psr) {
-		case ARMV4_5_MODE_SYS:
+		case ARM_MODE_SYS:
 			continue;
-		case ARMV4_5_MODE_USR:
+		case ARM_MODE_USR:
 			name = &quot;System and User&quot;;
 			sep = &quot;&quot;;
 			break;
@@ -1125,7 +1125,7 @@ int armv4_5_run_algorithm_inner(struct target *target,
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
-	if (armv4_5_algorithm_info-&gt;core_mode != ARMV4_5_MODE_ANY)
+	if (armv4_5_algorithm_info-&gt;core_mode != ARM_MODE_ANY)
 	{
 		LOG_DEBUG(&quot;setting core_mode: 0x%2.2x&quot;,
 				armv4_5_algorithm_info-&gt;core_mode);
@@ -1274,7 +1274,7 @@ int arm_checksum_memory(struct target *target,
 	}
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN_OUT);
@@ -1351,7 +1351,7 @@ int arm_blank_check_memory(struct target *target,
 	}
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
-	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
+	armv4_5_info.core_mode = ARM_MODE_SVC;
 	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
@@ -1425,10 +1425,10 @@ int armv4_5_init_arch_info(struct target *target, struct arm *armv4_5)
 	armv4_5-&gt;target = target;
 
 	armv4_5-&gt;common_magic = ARMV4_5_COMMON_MAGIC;
-	arm_set_cpsr(armv4_5, ARMV4_5_MODE_USR);
+	arm_set_cpsr(armv4_5, ARM_MODE_USR);
 
 	/* core_type may be overridden by subtype logic */
-	armv4_5-&gt;core_type = ARMV4_5_MODE_ANY;
+	armv4_5-&gt;core_type = ARM_MODE_ANY;
 
 	/* default full_context() has no core-specific optimizations */
 	if (!armv4_5-&gt;full_context &amp;&amp; armv4_5-&gt;read_core_reg)
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index de1b933..8e2fca2 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -32,15 +32,15 @@
 
 typedef enum armv4_5_mode
 {
-	ARMV4_5_MODE_USR = 16,
-	ARMV4_5_MODE_FIQ = 17,
-	ARMV4_5_MODE_IRQ = 18,
-	ARMV4_5_MODE_SVC = 19,
-	ARMV4_5_MODE_ABT = 23,
+	ARM_MODE_USR = 16,
+	ARM_MODE_FIQ = 17,
+	ARM_MODE_IRQ = 18,
+	ARM_MODE_SVC = 19,
+	ARM_MODE_ABT = 23,
 	ARM_MODE_MON = 26,
-	ARMV4_5_MODE_UND = 27,
-	ARMV4_5_MODE_SYS = 31,
-	ARMV4_5_MODE_ANY = -1
+	ARM_MODE_UND = 27,
+	ARM_MODE_SYS = 31,
+	ARM_MODE_ANY = -1
 } armv4_5_mode_t;
 
 const char *arm_mode_name(unsigned psr_mode);
@@ -91,7 +91,7 @@ struct arm
 
 	/**
 	 * Indicates what registers are in the ARM state core register set.
-	 * ARMV4_5_MODE_ANY indicates the standard set of 37 registers,
+	 * ARM_MODE_ANY indicates the standard set of 37 registers,
 	 * seen on for example ARM7TDMI cores.  ARM_MODE_MON indicates three
 	 * more registers are shadowed, for &quot;Secure Monitor&quot; mode.
 	 */
diff --git a/src/target/armv7a.c b/src/target/armv7a.c
index e889a8a..300ac28 100644
--- a/src/target/armv7a.c
+++ b/src/target/armv7a.c
@@ -105,7 +105,7 @@ int armv7a_arch_state(struct target *target)
 		 state[armv7a-&gt;armv4_5_mmu.armv4_5_cache.d_u_cache_enabled],
 		 state[armv7a-&gt;armv4_5_mmu.armv4_5_cache.i_cache_enabled]);
 
-	if (armv4_5-&gt;core_mode == ARMV4_5_MODE_ABT)
+	if (armv4_5-&gt;core_mode == ARM_MODE_ABT)
 		armv7a_show_fault_registers(target);
 	if (target-&gt;debug_reason == DBG_REASON_WATCHPOINT)
 		LOG_USER(&quot;Watchpoint triggered at PC %#08x&quot;,
diff --git a/src/target/xscale.c b/src/target/xscale.c
index f52965a..57b1081 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -1701,7 +1701,7 @@ static int xscale_full_context(struct target *target)
 		bool valid = true;
 		struct reg *r;
 
-		if (mode == ARMV4_5_MODE_USR)
+		if (mode == ARM_MODE_USR)
 			continue;
 
 		/* check if there are invalid registers in the current mode
@@ -1724,7 +1724,7 @@ static int xscale_full_context(struct target *target)
 		/* get banked registers:  r8 to r14; and SPSR
 		 * except in USR/SYS mode
 		 */
-		if (mode != ARMV4_5_MODE_SYS) {
+		if (mode != ARM_MODE_SYS) {
 			/* SPSR */
 			r = &amp;ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache,
 					mode, 16);
@@ -1777,7 +1777,7 @@ static int xscale_restore_banked(struct target *target)
 		enum armv4_5_mode mode = armv4_5_number_to_mode(i);
 		struct reg *r;
 
-		if (mode == ARMV4_5_MODE_USR)
+		if (mode == ARM_MODE_USR)
 			continue;
 
 		/* check if there are dirty registers in this mode */
@@ -1789,7 +1789,7 @@ static int xscale_restore_banked(struct target *target)
 		}
 
 		/* if not USR/SYS, check if the SPSR needs to be written */
-		if (mode != ARMV4_5_MODE_SYS)
+		if (mode != ARM_MODE_SYS)
 		{
 			if (ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache,
 					mode, 16).dirty)
@@ -1817,7 +1817,7 @@ dirty:
 		}
 
 		/* send spsr if not in USR/SYS mode */
-		if (mode != ARMV4_5_MODE_SYS) {
+		if (mode != ARM_MODE_SYS) {
 			r = &amp;ARMV4_5_CORE_REG_MODE(armv4_5-&gt;core_cache,
 					mode, 16);
 			xscale_send_u32(target, buf_get_u32(r-&gt;value, 0, 32));

commit 31e3ea7c19d39589ac9a8b2220331206b6d1e25c
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Fri Dec 4 19:14:48 2009 -0800

    ARM: rename ARMV4_5_STATE_* as ARM_STATE_*
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/flash/arm_nandio.c b/src/flash/arm_nandio.c
index 1b43b5f..558ed94 100644
--- a/src/flash/arm_nandio.c
+++ b/src/flash/arm_nandio.c
@@ -138,7 +138,7 @@ int arm_nandwrite(struct arm_nand_data *nand, uint8_t *data, int size)
 	/* set up algorithm and parameters */
 	algo.common_magic = ARMV4_5_COMMON_MAGIC;
 	algo.core_mode = ARMV4_5_MODE_SVC;
-	algo.core_state = ARMV4_5_STATE_ARM;
+	algo.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN);
 	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_IN);
@@ -214,7 +214,7 @@ int arm_nandread(struct arm_nand_data *nand, uint8_t *data, uint32_t size)
 	/* set up algorithm and parameters */
 	algo.common_magic = ARMV4_5_COMMON_MAGIC;
 	algo.core_mode = ARMV4_5_MODE_SVC;
-	algo.core_state = ARMV4_5_STATE_ARM;
+	algo.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN);
 	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_IN);
diff --git a/src/flash/nor/aduc702x.c b/src/flash/nor/aduc702x.c
index 1b9f5c0..c223ec4 100644
--- a/src/flash/nor/aduc702x.c
+++ b/src/flash/nor/aduc702x.c
@@ -243,7 +243,7 @@ static int aduc702x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
 	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
diff --git a/src/flash/nor/cfi.c b/src/flash/nor/cfi.c
index c00d65f..991110b 100644
--- a/src/flash/nor/cfi.c
+++ b/src/flash/nor/cfi.c
@@ -1087,7 +1087,7 @@ static int cfi_intel_write_block(struct flash_bank *bank, uint8_t *buffer, uint3
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	/* If we are setting up the write_algorith, we need target_code_src */
 	/* if not we only need target_code_size. */
@@ -1410,7 +1410,7 @@ static int cfi_spansion_write_block(struct flash_bank *bank, uint8_t *buffer, ui
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	int target_code_size;
 	const uint32_t *target_code_src;
diff --git a/src/flash/nor/ecos.c b/src/flash/nor/ecos.c
index 799015e..41b06b3 100644
--- a/src/flash/nor/ecos.c
+++ b/src/flash/nor/ecos.c
@@ -212,7 +212,7 @@ static int runCode(struct ecosflash_flash_bank *info,
 	struct armv4_5_algorithm armv4_5_info;
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN_OUT);
 	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
diff --git a/src/flash/nor/lpc2000.c b/src/flash/nor/lpc2000.c
index d824c37..2b1e671 100644
--- a/src/flash/nor/lpc2000.c
+++ b/src/flash/nor/lpc2000.c
@@ -294,7 +294,7 @@ static int lpc2000_iap_call(struct flash_bank *bank, int code, uint32_t param_ta
 		case lpc2000_v2:
 			armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 			armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-			armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+			armv4_5_info.core_state = ARM_STATE_ARM;
 			iap_entry_point = 0x7ffffff1;
 			break;
 		default:
diff --git a/src/flash/nor/lpc2900.c b/src/flash/nor/lpc2900.c
index 0b42d48..8dc06d1 100644
--- a/src/flash/nor/lpc2900.c
+++ b/src/flash/nor/lpc2900.c
@@ -1425,7 +1425,7 @@ static int lpc2900_write(struct flash_bank *bank, uint8_t *buffer,
 			/* Execute algorithm, assume breakpoint for last instruction */
 			armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 			armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-			armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+			armv4_5_info.core_state = ARM_STATE_ARM;
 
 			retval = target_run_algorithm(target, 0, NULL, 5, reg_params,
 				(warea-&gt;address) + buffer_size,
diff --git a/src/flash/nor/str7x.c b/src/flash/nor/str7x.c
index 4f93ec9..ea584a5 100644
--- a/src/flash/nor/str7x.c
+++ b/src/flash/nor/str7x.c
@@ -373,7 +373,7 @@ static int str7x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32_t
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
 	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
diff --git a/src/flash/nor/str9x.c b/src/flash/nor/str9x.c
index 36096ff..21760f3 100644
--- a/src/flash/nor/str9x.c
+++ b/src/flash/nor/str9x.c
@@ -410,7 +410,7 @@ static int str9x_write_block(struct flash_bank *bank,
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
 	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index b411672..4d81189 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -1211,7 +1211,7 @@ int arm7_9_soft_reset_halt(struct target *target)
 		uint32_t r0_thumb, pc_thumb;
 		LOG_DEBUG(&quot;target entered debug from Thumb state, changing to ARM&quot;);
 		/* Entered debug from Thumb mode */
-		armv4_5-&gt;core_state = ARMV4_5_STATE_THUMB;
+		armv4_5-&gt;core_state = ARM_STATE_THUMB;
 		arm7_9-&gt;change_to_arm(target, &amp;r0_thumb, &amp;pc_thumb);
 	}
 
@@ -1373,7 +1373,7 @@ static int arm7_9_debug_entry(struct target *target)
 	{
 		LOG_DEBUG(&quot;target entered debug from Thumb state&quot;);
 		/* Entered debug from Thumb mode */
-		armv4_5-&gt;core_state = ARMV4_5_STATE_THUMB;
+		armv4_5-&gt;core_state = ARM_STATE_THUMB;
 		cpsr_mask = 1 &lt;&lt; 5;
 		arm7_9-&gt;change_to_arm(target, &amp;r0_thumb, &amp;pc_thumb);
 		LOG_DEBUG(&quot;r0_thumb: 0x%8.8&quot; PRIx32
@@ -1385,13 +1385,13 @@ static int arm7_9_debug_entry(struct target *target)
 		 * B.7.3 for the reverse.  That'd be the bare minimum...
 		 */
 		LOG_DEBUG(&quot;target entered debug from Jazelle state&quot;);
-		armv4_5-&gt;core_state = ARMV4_5_STATE_JAZELLE;
+		armv4_5-&gt;core_state = ARM_STATE_JAZELLE;
 		cpsr_mask = 1 &lt;&lt; 24;
 		LOG_ERROR(&quot;Jazelle debug entry -- BROKEN!&quot;);
 	} else {
 		LOG_DEBUG(&quot;target entered debug from ARM state&quot;);
 		/* Entered debug from ARM mode */
-		armv4_5-&gt;core_state = ARMV4_5_STATE_ARM;
+		armv4_5-&gt;core_state = ARM_STATE_ARM;
 	}
 
 	for (i = 0; i &lt; 16; i++)
@@ -1419,21 +1419,21 @@ static int arm7_9_debug_entry(struct target *target)
 	LOG_DEBUG(&quot;target entered debug state in %s mode&quot;,
 			 arm_mode_name(armv4_5-&gt;core_mode));
 
-	if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
+	if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
 	{
 		LOG_DEBUG(&quot;thumb state, applying fixups&quot;);
 		context[0] = r0_thumb;
 		context[15] = pc_thumb;
-	} else if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
+	} else if (armv4_5-&gt;core_state == ARM_STATE_ARM)
 	{
 		/* adjust value stored by STM */
 		context[15] -= 3 * 4;
 	}
 
 	if ((target-&gt;debug_reason != DBG_REASON_DBGRQ) || (!arm7_9-&gt;use_dbgrq))
-		context[15] -= 3 * ((armv4_5-&gt;core_state == ARMV4_5_STATE_ARM) ? 4 : 2);
+		context[15] -= 3 * ((armv4_5-&gt;core_state == ARM_STATE_ARM) ? 4 : 2);
 	else
-		context[15] -= arm7_9-&gt;dbgreq_adjust_pc * ((armv4_5-&gt;core_state == ARMV4_5_STATE_ARM) ? 4 : 2);
+		context[15] -= arm7_9-&gt;dbgreq_adjust_pc * ((armv4_5-&gt;core_state == ARM_STATE_ARM) ? 4 : 2);
 
 	for (i = 0; i &lt;= 15; i++)
 	{
@@ -1846,9 +1846,9 @@ int arm7_9_resume(struct target *target, int current, uint32_t address, int hand
 				return retval;
 			}
 
-			if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
+			if (armv4_5-&gt;core_state == ARM_STATE_ARM)
 				arm7_9-&gt;branch_resume(target);
-			else if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
+			else if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
 			{
 				arm7_9-&gt;branch_resume_thumb(target);
 			}
@@ -1895,11 +1895,11 @@ int arm7_9_resume(struct target *target, int current, uint32_t address, int hand
 		return retval;
 	}
 
-	if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
+	if (armv4_5-&gt;core_state == ARM_STATE_ARM)
 	{
 		arm7_9-&gt;branch_resume(target);
 	}
-	else if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
+	else if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
 	{
 		arm7_9-&gt;branch_resume_thumb(target);
 	}
@@ -2046,11 +2046,11 @@ int arm7_9_step(struct target *target, int current, uint32_t address, int handle
 
 	arm7_9-&gt;enable_single_step(target, next_pc);
 
-	if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
+	if (armv4_5-&gt;core_state == ARM_STATE_ARM)
 	{
 		arm7_9-&gt;branch_resume(target);
 	}
-	else if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
+	else if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
 	{
 		arm7_9-&gt;branch_resume_thumb(target);
 	}
@@ -2698,7 +2698,7 @@ int arm7_9_bulk_write_memory(struct target *target, uint32_t address, uint32_t c
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN_OUT);
 
diff --git a/src/target/arm_dpm.c b/src/target/arm_dpm.c
index a9ce880..df9bd95 100644
--- a/src/target/arm_dpm.c
+++ b/src/target/arm_dpm.c
@@ -147,14 +147,14 @@ static int dpm_read_reg(struct arm_dpm *dpm, struct reg *r, unsigned regnum)
 		 * is always right except in those broken-by-intent cases.
 		 */
 		switch (dpm-&gt;arm-&gt;core_state) {
-		case ARMV4_5_STATE_ARM:
+		case ARM_STATE_ARM:
 			value -= 8;
 			break;
-		case ARMV4_5_STATE_THUMB:
+		case ARM_STATE_THUMB:
 		case ARM_STATE_THUMB_EE:
 			value -= 4;
 			break;
-		case ARMV4_5_STATE_JAZELLE:
+		case ARM_STATE_JAZELLE:
 			/* core-specific ... ? */
 			LOG_WARNING(&quot;Jazelle PC adjustment unknown&quot;);
 			break;
@@ -744,14 +744,14 @@ static int dpm_remove_watchpoint(struct target *target, struct watchpoint *wp)
 void arm_dpm_report_wfar(struct arm_dpm *dpm, uint32_t addr)
 {
 	switch (dpm-&gt;arm-&gt;core_state) {
-	case ARMV4_5_STATE_ARM:
+	case ARM_STATE_ARM:
 		addr -= 8;
 		break;
-	case ARMV4_5_STATE_THUMB:
+	case ARM_STATE_THUMB:
 	case ARM_STATE_THUMB_EE:
 		addr -= 4;
 		break;
-	case ARMV4_5_STATE_JAZELLE:
+	case ARM_STATE_JAZELLE:
 		/* ?? */
 		break;
 	}
diff --git a/src/target/arm_semihosting.c b/src/target/arm_semihosting.c
index 7fe0a97..f4e9199 100644
--- a/src/target/arm_semihosting.c
+++ b/src/target/arm_semihosting.c
@@ -387,7 +387,7 @@ static int do_semihosting(struct target *target)
 	armv4_5-&gt;core_cache-&gt;reg_list[ARMV4_5_CPSR].dirty = 1;
 	armv4_5-&gt;core_mode = spsr &amp; 0x1f;
 	if (spsr &amp; 0x20)
-		armv4_5-&gt;core_state = ARMV4_5_STATE_THUMB;
+		armv4_5-&gt;core_state = ARM_STATE_THUMB;
 	return target_resume(target, 1, 0, 0, 0);
 }
 
diff --git a/src/target/arm_simulator.c b/src/target/arm_simulator.c
index 4b8d86e..a1ed54c 100644
--- a/src/target/arm_simulator.c
+++ b/src/target/arm_simulator.c
@@ -135,7 +135,7 @@ static uint32_t arm_shifter_operand(struct arm_sim_interface *sim,
 	uint32_t return_value;
 	int instruction_size;
 
-	if (sim-&gt;get_state(sim) == ARMV4_5_STATE_ARM)
+	if (sim-&gt;get_state(sim) == ARM_STATE_ARM)
 		instruction_size = 4;
 	else
 		instruction_size = 2;
@@ -286,7 +286,7 @@ int arm_simulate_step_core(struct target *target,
 	int instruction_size;
 	int retval = ERROR_OK;
 
-	if (sim-&gt;get_state(sim) == ARMV4_5_STATE_ARM)
+	if (sim-&gt;get_state(sim) == ARM_STATE_ARM)
 	{
 		uint32_t opcode;
 
@@ -392,7 +392,7 @@ int arm_simulate_step_core(struct target *target,
 			else if (instruction.type == ARM_BL)
 			{
 				uint32_t old_pc = sim-&gt;get_reg(sim, 15);
-				int T = (sim-&gt;get_state(sim) == ARMV4_5_STATE_THUMB);
+				int T = (sim-&gt;get_state(sim) == ARM_STATE_THUMB);
 				sim-&gt;set_reg_mode(sim, 14, old_pc + 4 + T);
 				sim-&gt;set_reg(sim, 15, target);
 			}
@@ -400,27 +400,27 @@ int arm_simulate_step_core(struct target *target,
 			{
 				if (target &amp; 0x1)
 				{
-					sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
+					sim-&gt;set_state(sim, ARM_STATE_THUMB);
 				}
 				else
 				{
-					sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
+					sim-&gt;set_state(sim, ARM_STATE_ARM);
 				}
 				sim-&gt;set_reg(sim, 15, target &amp; 0xfffffffe);
 			}
 			else if (instruction.type == ARM_BLX)
 			{
 				uint32_t old_pc = sim-&gt;get_reg(sim, 15);
-				int T = (sim-&gt;get_state(sim) == ARMV4_5_STATE_THUMB);
+				int T = (sim-&gt;get_state(sim) == ARM_STATE_THUMB);
 				sim-&gt;set_reg_mode(sim, 14, old_pc + 4 + T);
 
 				if (target &amp; 0x1)
 				{
-					sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
+					sim-&gt;set_state(sim, ARM_STATE_THUMB);
 				}
 				else
 				{
-					sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
+					sim-&gt;set_state(sim, ARM_STATE_ARM);
 				}
 				sim-&gt;set_reg(sim, 15, target &amp; 0xfffffffe);
 			}
@@ -493,9 +493,9 @@ int arm_simulate_step_core(struct target *target,
 			if (instruction.info.data_proc.Rd == 15) {
 				sim-&gt;set_reg_mode(sim, 15, Rd &amp; ~1);
 				if (Rd &amp; 1)
-					sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
+					sim-&gt;set_state(sim, ARM_STATE_THUMB);
 				else
-					sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
+					sim-&gt;set_state(sim, ARM_STATE_ARM);
 				return ERROR_OK;
 			}
 			sim-&gt;set_reg_mode(sim, instruction.info.data_proc.Rd, Rd);
@@ -605,9 +605,9 @@ int arm_simulate_step_core(struct target *target,
 			if (instruction.info.load_store.Rd == 15) {
 				sim-&gt;set_reg_mode(sim, 15, load_value &amp; ~1);
 				if (load_value &amp; 1)
-					sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
+					sim-&gt;set_state(sim, ARM_STATE_THUMB);
 				else
-					sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
+					sim-&gt;set_state(sim, ARM_STATE_ARM);
 				return ERROR_OK;
 			}
 			sim-&gt;set_reg_mode(sim, instruction.info.load_store.Rd, load_value);
@@ -684,9 +684,9 @@ int arm_simulate_step_core(struct target *target,
 						uint32_t val = load_values[i];
 					sim-&gt;set_reg_mode(sim, i, val &amp; ~1);
 					if (val &amp; 1)
-						sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
+						sim-&gt;set_state(sim, ARM_STATE_THUMB);
 					else
-						sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
+						sim-&gt;set_state(sim, ARM_STATE_ARM);
 					} else {
 						sim-&gt;set_reg_mode(sim, i, load_values[i]);
 					}
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 412b829..a893e11 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -381,13 +381,13 @@ void arm_set_cpsr(struct arm *arm, uint32_t cpsr)
 			LOG_WARNING(&quot;ThumbEE -- incomplete support&quot;);
 			state = ARM_STATE_THUMB_EE;
 		} else
-			state = ARMV4_5_STATE_THUMB;
+			state = ARM_STATE_THUMB;
 	} else {
 		if (cpsr &amp; (1 &lt;&lt; 24)) {	/* J */
 			LOG_ERROR(&quot;Jazelle state handling is BROKEN!&quot;);
-			state = ARMV4_5_STATE_JAZELLE;
+			state = ARM_STATE_JAZELLE;
 		} else
-			state = ARMV4_5_STATE_ARM;
+			state = ARM_STATE_ARM;
 	}
 	arm-&gt;core_state = state;
 
@@ -710,11 +710,11 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
 	{
 		if (strcmp(CMD_ARGV[0], &quot;arm&quot;) == 0)
 		{
-			armv4_5-&gt;core_state = ARMV4_5_STATE_ARM;
+			armv4_5-&gt;core_state = ARM_STATE_ARM;
 		}
 		if (strcmp(CMD_ARGV[0], &quot;thumb&quot;) == 0)
 		{
-			armv4_5-&gt;core_state = ARMV4_5_STATE_THUMB;
+			armv4_5-&gt;core_state = ARM_STATE_THUMB;
 		}
 	}
 
@@ -1115,9 +1115,9 @@ int armv4_5_run_algorithm_inner(struct target *target,
 	}
 
 	armv4_5-&gt;core_state = armv4_5_algorithm_info-&gt;core_state;
-	if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
+	if (armv4_5-&gt;core_state == ARM_STATE_ARM)
 		exit_breakpoint_size = 4;
-	else if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
+	else if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
 		exit_breakpoint_size = 2;
 	else
 	{
@@ -1275,7 +1275,7 @@ int arm_checksum_memory(struct target *target,
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN_OUT);
 	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
@@ -1352,7 +1352,7 @@ int arm_blank_check_memory(struct target *target,
 
 	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
 	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
-	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
+	armv4_5_info.core_state = ARM_STATE_ARM;
 
 	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
 	buf_set_u32(reg_params[0].value, 0, 32, address);
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index 615e486..de1b933 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -51,9 +51,9 @@ enum armv4_5_mode armv4_5_number_to_mode(int number);
 
 typedef enum armv4_5_state
 {
-	ARMV4_5_STATE_ARM,
-	ARMV4_5_STATE_THUMB,
-	ARMV4_5_STATE_JAZELLE,
+	ARM_STATE_ARM,
+	ARM_STATE_THUMB,
+	ARM_STATE_JAZELLE,
 	ARM_STATE_THUMB_EE,
 } armv4_5_state_t;
 
diff --git a/src/target/cortex_a8.c b/src/target/cortex_a8.c
index eb42a5d..57e4bcd 100644
--- a/src/target/cortex_a8.c
+++ b/src/target/cortex_a8.c
@@ -705,17 +705,17 @@ static int cortex_a8_resume(struct target *target, int current,
 	 */
 	switch (armv4_5-&gt;core_state)
 	{
-	case ARMV4_5_STATE_ARM:
+	case ARM_STATE_ARM:
 		resume_pc &amp;= 0xFFFFFFFC;
 		break;
-	case ARMV4_5_STATE_THUMB:
+	case ARM_STATE_THUMB:
 	case ARM_STATE_THUMB_EE:
 		/* When the return address is loaded into PC
 		 * bit 0 must be 1 to stay in Thumb state
 		 */
 		resume_pc |= 0x1;
 		break;
-	case ARMV4_5_STATE_JAZELLE:
+	case ARM_STATE_JAZELLE:
 		LOG_ERROR(&quot;How do I resume into Jazelle state??&quot;);
 		return ERROR_FAIL;
 	}
@@ -974,7 +974,7 @@ static int cortex_a8_step(struct target *target, int current, uint32_t address,
 
 	/* Setup single step breakpoint */
 	stepbreakpoint.address = address;
-	stepbreakpoint.length = (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
+	stepbreakpoint.length = (armv4_5-&gt;core_state == ARM_STATE_THUMB)
 			? 2 : 4;
 	stepbreakpoint.type = BKPT_HARD;
 	stepbreakpoint.set = 0;
diff --git a/src/target/etm.c b/src/target/etm.c
index 520e22f..b45fcf5 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -659,7 +659,7 @@ static int etm_read_instruction(struct etm_context *ctx, struct arm_instruction
 		return ERROR_TRACE_INSTRUCTION_UNAVAILABLE;
 	}
 
-	if (ctx-&gt;core_state == ARMV4_5_STATE_ARM)
+	if (ctx-&gt;core_state == ARM_STATE_ARM)
 	{
 		uint8_t buf[4];
 		if ((retval = image_read_section(ctx-&gt;image, section,
@@ -672,7 +672,7 @@ static int etm_read_instruction(struct etm_context *ctx, struct arm_instruction
 		opcode = target_buffer_get_u32(ctx-&gt;target, buf);
 		arm_evaluate_opcode(opcode, ctx-&gt;current_pc, instruction);
 	}
-	else if (ctx-&gt;core_state == ARMV4_5_STATE_THUMB)
+	else if (ctx-&gt;core_state == ARM_STATE_THUMB)
 	{
 		uint8_t buf[2];
 		if ((retval = image_read_section(ctx-&gt;image, section,
@@ -685,7 +685,7 @@ static int etm_read_instruction(struct etm_context *ctx, struct arm_instruction
 		opcode = target_buffer_get_u16(ctx-&gt;target, buf);
 		thumb_evaluate_opcode(opcode, ctx-&gt;current_pc, instruction);
 	}
-	else if (ctx-&gt;core_state == ARMV4_5_STATE_JAZELLE)
+	else if (ctx-&gt;core_state == ARM_STATE_JAZELLE)
 	{
 		LOG_ERROR(&quot;BUG: tracing of jazelle code not supported&quot;);
 		return ERROR_FAIL;
@@ -829,7 +829,7 @@ static int etmv1_branch_address(struct etm_context *ctx)
 	/* if a full address was output, we might have branched into Jazelle state */
 	if ((shift == 32) &amp;&amp; (packet &amp; 0x80))
 	{
-		ctx-&gt;core_state = ARMV4_5_STATE_JAZELLE;
+		ctx-&gt;core_state = ARM_STATE_JAZELLE;
 	}
 	else
 	{
@@ -837,12 +837,12 @@ static int etmv1_branch_address(struct etm_context *ctx)
 		 * encoded in bit 0 of the branch target address */
 		if (ctx-&gt;last_branch &amp; 0x1)
 		{
-			ctx-&gt;core_state = ARMV4_5_STATE_THUMB;
+			ctx-&gt;core_state = ARM_STATE_THUMB;
 			ctx-&gt;last_branch &amp;= ~0x1;
 		}
 		else
 		{
-			ctx-&gt;core_state = ARMV4_5_STATE_ARM;
+			ctx-&gt;core_state = ARM_STATE_ARM;
 			ctx-&gt;last_branch &amp;= ~0x3;
 		}
 	}
@@ -1126,12 +1126,12 @@ static int etmv1_analyze_trace(struct etm_context *ctx, struct command_context *
 			}
 			else
 			{
-				next_pc += (ctx-&gt;core_state == ARMV4_5_STATE_ARM) ? 4 : 2;
+				next_pc += (ctx-&gt;core_state == ARM_STATE_ARM) ? 4 : 2;
 			}
 		}
 		else if (pipestat == STAT_IN)
 		{
-			next_pc += (ctx-&gt;core_state == ARMV4_5_STATE_ARM) ? 4 : 2;
+			next_pc += (ctx-&gt;core_state == ARM_STATE_ARM) ? 4 : 2;
 		}
 
 		if ((pipestat != STAT_TD) &amp;&amp; (pipestat != STAT_WT))
@@ -1498,7 +1498,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 	etm_ctx-&gt;trigger_percent = 50;
 	etm_ctx-&gt;trace_data = NULL;
 	etm_ctx-&gt;portmode = portmode;
-	etm_ctx-&gt;core_state = ARMV4_5_STATE_ARM;
+	etm_ctx-&gt;core_state = ARM_STATE_ARM;
 
 	arm-&gt;etm = etm_ctx;
 
diff --git a/src/target/feroceon.c b/src/target/feroceon.c
index 432d49d..2644560 100644
--- a/src/target/feroceon.c
+++ b/src/target/feroceon.c
@@ -524,7 +524,7 @@ int feroceon_bulk_write_memory(struct target *target, uint32_t address, uint32_t
 	buf_set_u32(armv4_5-&gt;core_cache-&gt;reg_list[0].value, 0, 32, address);
 	armv4_5-&gt;core_cache-&gt;reg_list[0].valid = 1;
 	armv4_5-&gt;core_cache-&gt;reg_list[0].dirty = 1;
-	armv4_5-&gt;core_state = ARMV4_5_STATE_ARM;
+	armv4_5-&gt;core_state = ARM_STATE_ARM;
 
 	embeddedice_write_reg(&amp;arm7_9-&gt;eice_cache-&gt;reg_list[EICE_COMMS_DATA], 0);
 	arm7_9_resume(target, 0, arm7_9-&gt;dcc_working_area-&gt;address, 1, 1);
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 1acaba0..f52965a 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -2607,7 +2607,7 @@ static int xscale_read_instruction(struct target *target,
 		return ERROR_TRACE_INSTRUCTION_UNAVAILABLE;
 	}
 
-	if (xscale-&gt;trace.core_state == ARMV4_5_STATE_ARM)
+	if (xscale-&gt;trace.core_state == ARM_STATE_ARM)
 	{
 		uint8_t buf[4];
 		if ((retval = image_read_section(xscale-&gt;trace.image, section,
@@ -2620,7 +2620,7 @@ static int xscale_read_instruction(struct target *target,
 		opcode = target_buffer_get_u32(target, buf);
 		arm_evaluate_opcode(opcode, xscale-&gt;trace.current_pc, instruction);
 	}
-	else if (xscale-&gt;trace.core_state == ARMV4_5_STATE_THUMB)
+	else if (xscale-&gt;trace.core_state == ARM_STATE_THUMB)
 	{
 		uint8_t buf[2];
 		if ((retval = image_read_section(xscale-&gt;trace.image, section,
@@ -2672,7 +2672,7 @@ static int xscale_analyze_trace(struct target *target, struct command_context *c
 		int rollover;
 		int branch;
 		int exception;
-		xscale-&gt;trace.core_state = ARMV4_5_STATE_ARM;
+		xscale-&gt;trace.core_state = ARM_STATE_ARM;
 
 		chkpt = 0;
 		rollover = 0;
@@ -2806,7 +2806,7 @@ static int xscale_analyze_trace(struct target *target, struct command_context *c
 					}
 					else
 					{
-						xscale-&gt;trace.current_pc += (xscale-&gt;trace.core_state == ARMV4_5_STATE_ARM) ? 4 : 2;
+						xscale-&gt;trace.current_pc += (xscale-&gt;trace.core_state == ARM_STATE_ARM) ? 4 : 2;
 					}
 					command_print(cmd_ctx, &quot;%s&quot;, instruction.text);
 				}
@@ -2821,7 +2821,7 @@ static int xscale_analyze_trace(struct target *target, struct command_context *c
 			}
 		}
 
-		for (; xscale-&gt;trace.current_pc &lt; trace_data-&gt;last_instruction; xscale-&gt;trace.current_pc += (xscale-&gt;trace.core_state == ARMV4_5_STATE_ARM) ? 4 : 2)
+		for (; xscale-&gt;trace.current_pc &lt; trace_data-&gt;last_instruction; xscale-&gt;trace.current_pc += (xscale-&gt;trace.core_state == ARM_STATE_ARM) ? 4 : 2)
 		{
 			struct arm_instruction instruction;
 			if ((retval = xscale_read_instruction(target, &amp;instruction)) != ERROR_OK)

-----------------------------------------------------------------------

Summary of changes:
 src/flash/arm_nandio.c       |   16 ++--
 src/flash/nor/aduc702x.c     |    8 +-
 src/flash/nor/cfi.c          |   16 ++--
 src/flash/nor/ecos.c         |    8 +-
 src/flash/nor/lpc2000.c      |    8 +-
 src/flash/nor/lpc2900.c      |    8 +-
 src/flash/nor/str7x.c        |    8 +-
 src/flash/nor/str9x.c        |    8 +-
 src/target/arm720t.c         |    2 +-
 src/target/arm7_9_common.c   |   74 +++++++-------
 src/target/arm7tdmi.c        |    4 +-
 src/target/arm920t.c         |    6 +-
 src/target/arm926ejs.c       |    2 +-
 src/target/arm9tdmi.c        |    4 +-
 src/target/arm_dpm.c         |   78 +++++++-------
 src/target/arm_semihosting.c |   21 +++--
 src/target/arm_simulator.c   |   44 ++++----
 src/target/arm_simulator.h   |    6 +-
 src/target/armv4_5.c         |  244 +++++++++++++++++++++---------------------
 src/target/armv4_5.h         |   91 +++++++++-------
 src/target/armv7a.c          |    2 +-
 src/target/armv7a.h          |    6 +-
 src/target/cortex_a8.c       |    8 +-
 src/target/etm.c             |   18 ++--
 src/target/etm.h             |    2 +-
 src/target/feroceon.c        |    4 +-
 src/target/xscale.c          |   40 ++++----
 src/target/xscale.h          |    2 +-
 28 files changed, 379 insertions(+), 359 deletions(-)


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001926.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-867-gf67f6fe
</A></li>
	<LI>Next message: <A HREF="001928.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-881-g899c997
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1927">[ date ]</a>
              <a href="thread.html#1927">[ thread ]</a>
              <a href="subject.html#1927">[ subject ]</a>
              <a href="author.html#1927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
