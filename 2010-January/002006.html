<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-69-g12c143d
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2010-January/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.4.0-rc1-69-g12c143d&In-Reply-To=%3CE1NT3K7-0004hx-2j%40sfp-scmshell-2.v30.ch3.sourceforge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002005.html">
   <LINK REL="Next"  HREF="002007.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-69-g12c143d</H1>
    <B>David Brownell</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.4.0-rc1-69-g12c143d&In-Reply-To=%3CE1NT3K7-0004hx-2j%40sfp-scmshell-2.v30.ch3.sourceforge.com%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-69-g12c143d">dbrownell at users.sourceforge.net
       </A><BR>
    <I>Fri Jan  8 02:07:29 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002005.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-58-g991d030
</A></li>
        <LI>Next message: <A HREF="002007.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-70-g296a011
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2006">[ date ]</a>
              <a href="thread.html#2006">[ thread ]</a>
              <a href="subject.html#2006">[ subject ]</a>
              <a href="author.html#2006">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  12c143d5948355b3b54c9c0decc779177b22d5d9 (commit)
       via  82c0fb527783a56f7cf82e21b85546b425378b00 (commit)
       via  e7965cd3eb6204e618f9555331b7172e3dba7df8 (commit)
       via  a42bea654ce1316dd521b1c9beffa8f829bf8be0 (commit)
       via  e0b6e5deef2d7b0054058116b6ddf9c684053739 (commit)
       via  199abf49ea02f03aedd1239b6ef3928d35f5dbb7 (commit)
       via  48d51e1719c2b48509786bba7c84c09d329929d3 (commit)
       via  17921f51abc4402c9c5aadf3e664eb37663f744f (commit)
       via  e19fe9ad09e28df1976257052afe6edf765aa778 (commit)
       via  dd8f679aa2ea447a96f393db3a8938259f63eebc (commit)
       via  7c3aee96b2f122fd16ec20e305cb16fe89180c9b (commit)
      from  991d030fcc9be971f29498ea7e1b3afbed05815b (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 12c143d5948355b3b54c9c0decc779177b22d5d9
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 16:41:42 2010 -0800

    misc ARM help/usage updates
    
    Usage syntax messages have the same EBNF as the User's Guide;
    there should be no angle brackets in either place.
    
    Uupdate some helptext to be more accurate.
    
    Don't use &quot;&amp;function&quot;; functions are like arrays, their address
    is their name.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/arm926ejs.c b/src/target/arm926ejs.c
index 4ac92a2..e099919 100644
--- a/src/target/arm926ejs.c
+++ b/src/target/arm926ejs.c
@@ -757,7 +757,7 @@ static int arm926ejs_mmu(struct target *target, int *enabled)
 static const struct command_registration arm926ejs_exec_command_handlers[] = {
 	{
 		.name = &quot;cache_info&quot;,
-		.handler = &amp;arm926ejs_handle_cache_info_command,
+		.handler = arm926ejs_handle_cache_info_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display information about target caches&quot;,
 
diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index ae0c4e0..823e962 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -918,7 +918,9 @@ static const struct command_registration arm9tdmi_exec_command_handlers[] = {
 		.name = &quot;vector_catch&quot;,
 		.handler = handle_arm9tdmi_catch_vectors_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;[all|none|reset|undef|swi|pabt|dabt|irq|fiq] ...&quot;,
+		.help = &quot;Display, after optionally updating, configuration &quot;
+			&quot;of vector catch unit.&quot;,
+		.usage = &quot;[all|none|(reset|undef|swi|pabt|dabt|irq|fiq)*]&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 1c4923b..c7b7367 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -928,22 +928,22 @@ static int jim_mcrmrc(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 static const struct command_registration arm_exec_command_handlers[] = {
 	{
 		.name = &quot;reg&quot;,
-		.handler = &amp;handle_armv4_5_reg_command,
+		.handler = handle_armv4_5_reg_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display ARM core registers&quot;,
 	},
 	{
 		.name = &quot;core_state&quot;,
-		.handler = &amp;handle_armv4_5_core_state_command,
+		.handler = handle_armv4_5_core_state_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;arm | thumb&gt;&quot;,
+		.usage = &quot;['arm'|'thumb']&quot;,
 		.help = &quot;display/change ARM core state&quot;,
 	},
 	{
 		.name = &quot;disassemble&quot;,
-		.handler = &amp;handle_armv4_5_disassemble_command,
+		.handler = handle_armv4_5_disassemble_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;address&gt; [&lt;count&gt; ['thumb']]&quot;,
+		.usage = &quot;address [count ['thumb']]&quot;,
 		.help = &quot;disassemble instructions &quot;,
 	},
 	{

commit 82c0fb527783a56f7cf82e21b85546b425378b00
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 16:39:32 2010 -0800

    ARM966: help/usage updates
    
    Usage syntax messages have the same EBNF as the User's Guide;
    there should be no angle brackets in either place.
    
    Fix the User's Guide to say where the magic CP15 bits are defined;
    and add comments in case someone provides mcr/mrc methods.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/doc/openocd.texi b/doc/openocd.texi
index 285603a..84bdb3c 100644
--- a/doc/openocd.texi
+++ b/doc/openocd.texi
@@ -6030,6 +6030,10 @@ and ARM9 commands.
 @deffn Command {arm966e cp15} regnum [value]
 Display cp15 register @var{regnum};
 else if a @var{value} is provided, that value is written to that register.
+The six bit @var{regnum} values are bits 37..32 from table 7-2 of the
+ARM966E-S TRM.
+There is no current control over bits 31..30 from that table,
+as required for BIST support.
 @end deffn
 
 @subsection XScale specific commands
diff --git a/src/target/arm966e.c b/src/target/arm966e.c
index 82be738..86af0f6 100644
--- a/src/target/arm966e.c
+++ b/src/target/arm966e.c
@@ -68,6 +68,13 @@ static int arm966e_verify_pointer(struct command_context *cmd_ctx,
 	return ERROR_OK;
 }
 
+/*
+ * REVISIT:  The &quot;read_cp15&quot; and &quot;write_cp15&quot; commands could hook up
+ * to eventual mrc() and mcr() routines ... the reg_addr values being
+ * constructed (for CP15 only) from Opcode_1, Opcode_2, and CRn values.
+ * See section 7.3 of the ARM966E-S TRM.
+ */
+
 static int arm966e_read_cp15(struct target *target, int reg_addr, uint32_t *value)
 {
 	int retval = ERROR_OK;
@@ -86,6 +93,9 @@ static int arm966e_read_cp15(struct target *target, int reg_addr, uint32_t *valu
 
 	fields[0].tap = jtag_info-&gt;tap;
 	fields[0].num_bits = 32;
+	/* REVISIT: table 7-2 shows that bits 31-31 need to be
+	 * specified for accessing BIST registers ...
+	 */
 	fields[0].out_value = NULL;
 	fields[0].in_value = NULL;
 
@@ -227,7 +237,7 @@ static const struct command_registration arm966e_exec_command_handlers[] = {
 		.name = &quot;cp15&quot;,
 		.handler = arm966e_handle_cp15_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;opcode&gt; [value]&quot;,
+		.usage = &quot;regnum [value]&quot;,
 		.help = &quot;display/modify cp15 register&quot;,
 	},
 	COMMAND_REGISTRATION_DONE

commit e7965cd3eb6204e618f9555331b7172e3dba7df8
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 16:34:44 2010 -0800

    Xscale: User's Guide updates
    
    Fix some EBNF goofs ... these commands have *optional* params, etc
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/doc/openocd.texi b/doc/openocd.texi
index bf7402d..285603a 100644
--- a/doc/openocd.texi
+++ b/doc/openocd.texi
@@ -6105,7 +6105,7 @@ else if a @var{value} is provided, that value is written to that register.
 Changes the address used for the specified target's debug handler.
 @end deffn
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {xscale dcache} (@option{enable}|@option{disable})
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {xscale dcache} [@option{enable}|@option{disable}]
 Enables or disable the CPU's data cache.
 @end deffn
 
@@ -6113,17 +6113,18 @@ Enables or disable the CPU's data cache.
 Dumps the raw contents of the trace buffer to @file{filename}.
 @end deffn
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {xscale icache} (@option{enable}|@option{disable})
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {xscale icache} [@option{enable}|@option{disable}]
 Enables or disable the CPU's instruction cache.
 @end deffn
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {xscale mmu} (@option{enable}|@option{disable})
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {xscale mmu} [@option{enable}|@option{disable}]
 Enables or disable the CPU's memory management unit.
 @end deffn
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {xscale trace_buffer} (@option{enable}|@option{disable}) [@option{fill} [n] | @option{wrap}]
-Enables or disables the trace buffer,
-and controls how it is emptied.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {xscale trace_buffer} [@option{enable}|@option{disable} [@option{fill} [n] | @option{wrap}]]
+Displays the trace buffer status, after optionally
+enabling or disabling the trace buffer
+and modifying how it is emptied.
 @end deffn
 
 @deffn Command {xscale trace_image} filename [offset [type]]
@@ -6155,7 +6156,7 @@ The mask bits correspond with bit 16..23 in the DCSR:
 @end deffn
 
 @anchor{xscale vector_table}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {xscale vector_table} [&lt;low|high&gt; &lt;index&gt; &lt;value&gt;]
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {xscale vector_table} [(@option{low}|@option{high}) index value]
 @cindex vector_table
 
 Set an entry in the mini-IC vector table. There are two tables: one for

commit a42bea654ce1316dd521b1c9beffa8f829bf8be0
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 16:30:09 2010 -0800

    ARM720: help/usage updates
    
    Deprecate the &quot;pass an instruction opcode&quot; flavor of cp15
    access in favor of the &quot;arm mcr ...&quot; and &quot;arm mrc ...&quot;
    commands, which offer fewer ways to break things.
    
    Use the same EBNF syntax in the code as for the user's guide.
    
    Update User's Guide to say where to find those magic values
    (which table in the ARM920 TRM).
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/doc/openocd.texi b/doc/openocd.texi
index ea23bf7..bf7402d 100644
--- a/doc/openocd.texi
+++ b/doc/openocd.texi
@@ -5978,13 +5978,21 @@ is an ARM920T (2x16kByte cache) or ARM922T (2x8kByte cache).
 @deffn Command {arm920t cp15} regnum [value]
 Display cp15 register @var{regnum};
 else if a @var{value} is provided, that value is written to that register.
+This uses &quot;physical access&quot; and the register number is as
+shown in bits 38..33 of table 9-9 in the ARM920T TRM.
+(Not all registers can be written.)
 @end deffn
 
 @deffn Command {arm920t cp15i} opcode [value [address]]
-Interpreted access using cp15 @var{opcode}.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at emph</A>{DEPRECATED -- avoid using this.
+Use the @command{arm mrc} or @command{arm mcr} commands instead.}
+
+Interpreted access using ARM instruction @var{opcode}, which should
+be the value of either an MRC or MCR instruction
+(as shown tables 9-11, 9-12, and 9-13 in the ARM920T TRM).
 If no @var{value} is provided, the result is displayed.
 Else if that value is written using the specified @var{address},
-or using zero if no other address is not provided.
+or using zero if no other address is provided.
 @end deffn
 
 @deffn Command {arm920t read_cache} filename
diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index c5b7c88..29eb62d 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -1384,35 +1384,39 @@ static int arm920t_mcr(struct target *target, int cpnum,
 static const struct command_registration arm920t_exec_command_handlers[] = {
 	{
 		.name = &quot;cp15&quot;,
-		.handler = &amp;arm920t_handle_cp15_command,
+		.handler = arm920t_handle_cp15_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display/modify cp15 register&quot;,
-		.usage = &quot;&lt;num&gt; [value]&quot;,
+		.usage = &quot;regnum [value]&quot;,
 	},
 	{
 		.name = &quot;cp15i&quot;,
-		.handler = &amp;arm920t_handle_cp15i_command,
+		.handler = arm920t_handle_cp15i_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;display/modify cp15 (interpreted access)&quot;,
-		.usage = &quot;&lt;opcode&gt; [value] [address]&quot;,
+		/* prefer using less error-prone &quot;arm mcr&quot; or &quot;arm mrc&quot; */
+		.help = &quot;display/modify cp15 register using ARM opcode&quot;
+			&quot; (DEPRECATED)&quot;,
+		.usage = &quot;instruction [value [address]]&quot;,
 	},
 	{
 		.name = &quot;cache_info&quot;,
-		.handler = &amp;arm920t_handle_cache_info_command,
+		.handler = arm920t_handle_cache_info_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display information about target caches&quot;,
 	},
 	{
 		.name = &quot;read_cache&quot;,
-		.handler = &amp;arm920t_handle_read_cache_command,
+		.handler = arm920t_handle_read_cache_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;display I/D cache content&quot;,
+		.help = &quot;dump I/D cache content to file&quot;,
+		.usage = &quot;filename&quot;,
 	},
 	{
 		.name = &quot;read_mmu&quot;,
-		.handler = &amp;arm920t_handle_read_mmu_command,
+		.handler = arm920t_handle_read_mmu_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;display I/D mmu content&quot;,
+		.help = &quot;dump I/D mmu content to file&quot;,
+		.usage = &quot;filename&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };

commit e0b6e5deef2d7b0054058116b6ddf9c684053739
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 16:25:03 2010 -0800

    ARM720: help/usage updates
    
    Deprecate the &quot;pass an instruction opcode&quot; flavor of cp15 access
    in favor of the &quot;arm mcr ...&quot; and &quot;arm mrc ...&quot; commands, which
    offer fewer ways to break things.
    
    Use the same EBNF syntax in the code as for the user's guide.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/doc/openocd.texi b/doc/openocd.texi
index a6fb970..ea23bf7 100644
--- a/doc/openocd.texi
+++ b/doc/openocd.texi
@@ -5921,9 +5921,13 @@ which are implementations of the ARMv4T architecture
 based on the ARM7TDMI-S integer core.
 They are available in addition to the ARM and ARM7/ARM9 commands.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {arm720t cp15} regnum [value]
-Display cp15 register @var{regnum};
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {arm720t cp15} opcode [value]
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at emph</A>{DEPRECATED -- avoid using this.
+Use the @command{arm mrc} or @command{arm mcr} commands instead.}
+
+Display cp15 register returned by the ARM instruction @var{opcode};
 else if a @var{value} is provided, that value is written to that register.
+The @var{opcode} should be the value of either an MRC or MCR instruction.
 @end deffn
 
 @subsection ARM9 specific commands
diff --git a/src/target/arm720t.c b/src/target/arm720t.c
index 84c66b8..2f51699 100644
--- a/src/target/arm720t.c
+++ b/src/target/arm720t.c
@@ -516,8 +516,10 @@ static const struct command_registration arm720t_exec_command_handlers[] = {
 		.name = &quot;cp15&quot;,
 		.handler = arm720t_handle_cp15_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;opcode&gt; [value]&quot;,
-		.help = &quot;display/modify cp15 register&quot;,
+		/* prefer using less error-prone &quot;arm mcr&quot; or &quot;arm mrc&quot; */
+		.help = &quot;display/modify cp15 register using ARM opcode&quot;
+			&quot; (DEPRECATED)&quot;,
+		.usage = &quot;instruction [value]&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };

commit 199abf49ea02f03aedd1239b6ef3928d35f5dbb7
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 16:21:10 2010 -0800

    ARM11: help/usage updates
    
    Usage syntax messages have the same EBNF as the User's Guide;
    there should be no angle brackets in either place.
    
    Uupdate some helptext to be more accurate.
    
    Fix the User's Guide in a few places to be more consistent (mostly
    to use brackets not parentheses) and to recognize that parameter may
    be entirely optional (in which case the command just displays output,
    and changes nothing).  Also reference NXP, not Philips, for LPC chips.
    
    Don't use &quot;&amp;function&quot;; functions are like arrays, their address
    is their name.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/doc/openocd.texi b/doc/openocd.texi
index b91e754..a6fb970 100644
--- a/doc/openocd.texi
+++ b/doc/openocd.texi
@@ -6162,27 +6162,29 @@ Without arguments, the current settings are displayed.
 @subsection ARM11 specific commands
 @cindex ARM11
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {arm11 memwrite burst} [value]
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {arm11 memwrite burst} [@option{enable}|@option{disable}]
 Displays the value of the memwrite burst-enable flag,
-which is enabled by default. Burst writes are only used
-for memory writes larger than 1 word. Single word writes
-are likely to be from reset init scripts and those writes
-are often to non-memory locations which could easily have
-many wait states, which could easily break burst writes.
-If @var{value} is defined, first assigns that.
+which is enabled by default.
+If a boolean parameter is provided, first assigns that flag.
+Burst writes are only used for memory writes larger than 1 word.
+They improve performance by assuming that the CPU has read each data
+word over JTAG and completed its write before the next word arrives,
+instead of polling for a status flag to verify that completion.
+This is usually safe, because JTAG runs much slower than the CPU.
 @end deffn
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {arm11 memwrite error_fatal} [value]
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {arm11 memwrite error_fatal} [@option{enable}|@option{disable}]
 Displays the value of the memwrite error_fatal flag,
 which is enabled by default.
-If @var{value} is defined, first assigns that.
+If a boolean parameter is provided, first assigns that flag.
+When set, certain memory write errors cause earlier transfer termination.
 @end deffn
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {arm11 step_irq_enable}  [value]
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {arm11 step_irq_enable} [@option{enable}|@option{disable}]
 Displays the value of the flag controlling whether
 IRQs are enabled during single stepping;
 they are disabled by default.
-If @var{value} is defined, first assigns that.
+If a boolean parameter is provided, first assigns that.
 @end deffn
 
 @deffn Command {arm11 vcr} [value]
diff --git a/src/target/arm11.c b/src/target/arm11.c
index 67a8409..082930a 100644
--- a/src/target/arm11.c
+++ b/src/target/arm11.c
@@ -1318,17 +1318,20 @@ COMMAND_HANDLER(arm11_handle_vcr)
 static const struct command_registration arm11_mw_command_handlers[] = {
 	{
 		.name = &quot;burst&quot;,
-		.handler = &amp;arm11_handle_bool_memwrite_burst,
+		.handler = arm11_handle_bool_memwrite_burst,
 		.mode = COMMAND_ANY,
-		.help = &quot;Enable/Disable potentially risky fast burst mode&quot;
-			&quot; (default: enabled)&quot;,
+		.help = &quot;Display or modify flag controlling potentially &quot;
+			&quot;risky fast burst mode (default: enabled)&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 	},
 	{
 		.name = &quot;error_fatal&quot;,
-		.handler = &amp;arm11_handle_bool_memwrite_error_fatal,
+		.handler = arm11_handle_bool_memwrite_error_fatal,
 		.mode = COMMAND_ANY,
-		.help = &quot;Terminate program if transfer error was found&quot;
+		.help = &quot;Display or modify flag controlling transfer &quot;
+			&quot;termination on transfer errors&quot;
 			&quot; (default: enabled)&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
@@ -1338,11 +1341,11 @@ static const struct command_registration arm11_any_command_handlers[] = {
 		 * simulate + breakpoint implementation is broken.
 		 * TEMPORARY! NOT DOCUMENTED! */
 		.name = &quot;hardware_step&quot;,
-		.handler = &amp;arm11_handle_bool_hardware_step,
+		.handler = arm11_handle_bool_hardware_step,
 		.mode = COMMAND_ANY,
 		.help = &quot;DEBUG ONLY - Hardware single stepping&quot;
 			&quot; (default: disabled)&quot;,
-		.usage = &quot;(enable|disable)&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 	},
 	{
 		.name = &quot;memwrite&quot;,
@@ -1352,16 +1355,18 @@ static const struct command_registration arm11_any_command_handlers[] = {
 	},
 	{
 		.name = &quot;step_irq_enable&quot;,
-		.handler = &amp;arm11_handle_bool_step_irq_enable,
+		.handler = arm11_handle_bool_step_irq_enable,
 		.mode = COMMAND_ANY,
-		.help = &quot;Enable interrupts while stepping&quot;
-			&quot; (default: disabled)&quot;,
+		.help = &quot;Display or modify flag controlling interrupt &quot;
+			&quot;enable while stepping (default: disabled)&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 	},
 	{
 		.name = &quot;vcr&quot;,
-		.handler = &amp;arm11_handle_vcr,
+		.handler = arm11_handle_vcr,
 		.mode = COMMAND_ANY,
-		.help = &quot;Control (Interrupt) Vector Catch Register&quot;,
+		.help = &quot;Display or modify Vector Catch Register&quot;,
+		.usage = &quot;[value]&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };

commit 48d51e1719c2b48509786bba7c84c09d329929d3
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 16:20:14 2010 -0800

    ARM7/ARM9: help/usage updates
    
    Provide helptext which was sometimes missing; update some of it
    to be more accurate.
    
    Usage syntax messages have the same EBNF as the User's Guide;
    there should be no angle brackets in either place.
    
    Fix the User's Guide in a few places to be more consistent (mostly
    to use brackets not parentheses) and to recognize that parameter may
    be entirely optional (in which case the command just displays output,
    and changes nothing).  Also reference NXP, not Philips, for LPC chips.
    
    Don't use &quot;&amp;function&quot;; functions are like arrays, their address
    is their name.  Shrink some overlong lines.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/doc/openocd.texi b/doc/openocd.texi
index 6057aad..b91e754 100644
--- a/doc/openocd.texi
+++ b/doc/openocd.texi
@@ -2501,7 +2501,7 @@ signal implementations.
 The default behaviour if no option given is @option{separate},
 indicating everything behaves normally.
 @option{srst_pulls_trst} states that the
-test logic is reset together with the reset of the system (e.g. Philips
+test logic is reset together with the reset of the system (e.g. NXP
 LPC2000, &quot;broken&quot; board layout), @option{trst_pulls_srst} says that
 the system is reset together with the test logic (only hypothetical, I
 haven't seen hardware with such a bug, and can be worked around).
@@ -5867,26 +5867,36 @@ ARM9TDMI, ARM920T or ARM926EJ-S.
 They are available in addition to the ARM commands,
 and any other core-specific commands that may be available.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {arm7_9 dbgrq} (@option{enable}|@option{disable})
-Control use of the EmbeddedIce DBGRQ signal to force entry into debug mode,
-instead of breakpoints.  This should be
-safe for all but ARM7TDMI--S cores (like Philips LPC).
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {arm7_9 dbgrq} [@option{enable}|@option{disable}]
+Displays the value of the flag controlling use of the
+the EmbeddedIce DBGRQ signal to force entry into debug mode,
+instead of breakpoints.
+If a boolean parameter is provided, first assigns that flag.
+
+This should be
+safe for all but ARM7TDMI-S cores (like NXP LPC).
 This feature is enabled by default on most ARM9 cores,
 including ARM9TDMI, ARM920T, and ARM926EJ-S.
 @end deffn
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {arm7_9 dcc_downloads} (@option{enable}|@option{disable})
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {arm7_9 dcc_downloads} [@option{enable}|@option{disable}]
 @cindex DCC
-Control the use of the debug communications channel (DCC) to write larger (&gt;128 byte)
-amounts of memory. DCC downloads offer a huge speed increase, but might be
+Displays the value of the flag controlling use of the debug communications
+channel (DCC) to write larger (&gt;128 byte) amounts of memory.
+If a boolean parameter is provided, first assigns that flag.
+
+DCC downloads offer a huge speed increase, but might be
 unsafe, especially with targets running at very low speeds. This command was introduced
 with OpenOCD rev. 60, and requires a few bytes of working area.
 @end deffn
 
 @anchor{arm7_9 fast_memory_access}
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {arm7_9 fast_memory_access} (@option{enable}|@option{disable})
-Enable or disable memory writes and reads that don't check completion of
-the operation. This provides a huge speed increase, especially with USB JTAG
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {arm7_9 fast_memory_access} [@option{enable}|@option{disable}]
+Displays the value of the flag controlling use of memory writes and reads
+that don't check completion of the operation.
+If a boolean parameter is provided, first assigns that flag.
+
+This provides a huge speed increase, especially with USB JTAG
 cables (FT2232), but might be unsafe if used with targets running at very low
 speeds, like the 32kHz startup clock of an AT91RM9200.
 @end deffn
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index a09b0ad..2f4c408 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2864,32 +2864,32 @@ int arm7_9_init_arch_info(struct target *target, struct arm7_9_common *arm7_9)
 static const struct command_registration arm7_9_any_command_handlers[] = {
 	{
 		&quot;dbgrq&quot;,
-		.handler = &amp;handle_arm7_9_dbgrq_command,
+		.handler = handle_arm7_9_dbgrq_command,
 		.mode = COMMAND_ANY,
-		.usage = &quot;&lt;enable|disable&gt;&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 		.help = &quot;use EmbeddedICE dbgrq instead of breakpoint &quot;
 			&quot;for target halt requests&quot;,
 	},
 	{
 		&quot;fast_memory_access&quot;,
-		.handler = &amp;handle_arm7_9_fast_memory_access_command,
+		.handler = handle_arm7_9_fast_memory_access_command,
 		.mode = COMMAND_ANY,
-		.usage = &quot;&lt;enable|disable&gt;&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 		.help = &quot;use fast memory accesses instead of slower &quot;
 			&quot;but potentially safer accesses&quot;,
 	},
 	{
 		&quot;dcc_downloads&quot;,
-		.handler = &amp;handle_arm7_9_dcc_downloads_command,
+		.handler = handle_arm7_9_dcc_downloads_command,
 		.mode = COMMAND_ANY,
-		.usage = &quot;&lt;enable | disable&gt;&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 		.help = &quot;use DCC downloads for larger memory writes&quot;,
 	},
 	{
 		&quot;semihosting&quot;,
-		.handler = &amp;handle_arm7_9_semihosting_command,
+		.handler = handle_arm7_9_semihosting_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;enable | disable&gt;&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 		.help = &quot;activate support for semihosting operations&quot;,
 	},
 	COMMAND_REGISTRATION_DONE

commit 17921f51abc4402c9c5aadf3e664eb37663f744f
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 15:52:38 2010 -0800

    ARMv7: help/usage updates
    
    Provide helptext which was sometimes missing; update some of it
    to be more accurate.
    
    Usage syntax messages have the same EBNF as the User's Guide;
    there should be no angle brackets in either place.
    
    Don't use &quot;&amp;function&quot;; functions are like arrays, their address
    is their name.  Shrink some overlong lines, remove some empties.
    
    Add a couple comments about things that should change:  those
    extra TCK cycles for MEM-AP reads are in the wrong place (that
    might explain some problems we've seen); the DAP command tables
    should be shared, not copied.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/doc/openocd.texi b/doc/openocd.texi
index 3f5882c..6057aad 100644
--- a/doc/openocd.texi
+++ b/doc/openocd.texi
@@ -6198,26 +6198,28 @@ These commands are specific to ARM architecture v7 Debug Access Port (DAP),
 included on Cortex-M3 and Cortex-A8 systems.
 They are available in addition to other core-specific commands that may be available.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {dap info} [num]
-Displays dap info for ap @var{num}, defaulting to the currently selected AP.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {dap apid} [num]
+Displays ID register from AP @var{num},
+defaulting to the currently selected AP.
 @end deffn
 
 @deffn Command {dap apsel} [num]
 Select AP @var{num}, defaulting to 0.
 @end deffn
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {dap apid} [num]
-Displays id register from AP @var{num},
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {dap baseaddr} [num]
+Displays debug base address from MEM-AP @var{num},
 defaulting to the currently selected AP.
 @end deffn
 
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at deffn</A> Command {dap baseaddr} [num]
-Displays debug base address from AP @var{num},
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at deffn</A> Command {dap info} [num]
+Displays the ROM table for MEM-AP @var{num},
 defaulting to the currently selected AP.
 @end deffn
 
 @deffn Command {dap memaccess} [value]
-Displays the number of extra tck for mem-ap memory bus access [0-255].
+Displays the number of extra tck cycles in the JTAG idle to use for MEM-AP
+memory bus access [0-255], giving additional time to respond to reads.
 If @var{value} is defined, first assigns that.
 @end deffn
 
diff --git a/src/target/arm_adi_v5.c b/src/target/arm_adi_v5.c
index 96accf3..e490f2e 100644
--- a/src/target/arm_adi_v5.c
+++ b/src/target/arm_adi_v5.c
@@ -101,6 +101,10 @@ static int adi_jtag_dp_scan(struct swjdp_common *swjdp,
 	arm_jtag_set_instr(jtag_info, instr, NULL);
 
 	/* Add specified number of tck clocks before accessing memory bus */
+
+	/* REVISIT these TCK cycles should be *AFTER*  updating APACC, since
+	 * they provide more time for the (MEM) AP to complete the read ...
+	 */
 	if ((instr == JTAG_DP_APACC)
 			&amp;&amp; ((reg_addr == AP_REG_DRW)
 				|| ((reg_addr &amp; 0xF0) == AP_REG_BD0))
@@ -137,6 +141,10 @@ static int adi_jtag_dp_scan_u32(struct swjdp_common *swjdp,
 	arm_jtag_set_instr(jtag_info, instr, NULL);
 
 	/* Add specified number of tck clocks before accessing memory bus */
+
+	/* REVISIT these TCK cycles should be *AFTER*  updating APACC, since
+	 * they provide more time for the (MEM) AP to complete the read ...
+	 */
 	if ((instr == JTAG_DP_APACC)
 			&amp;&amp; ((reg_addr == AP_REG_DRW)
 				|| ((reg_addr &amp; 0xF0) == AP_REG_BD0))
diff --git a/src/target/armv7a.c b/src/target/armv7a.c
index 31538c2..fe87fee 100644
--- a/src/target/armv7a.c
+++ b/src/target/armv7a.c
@@ -174,40 +174,49 @@ COMMAND_HANDLER(handle_dap_info_command)
 	return dap_info_command(CMD_CTX, swjdp, apsel);
 }
 
+/* FIXME this table should be part of generic DAP support, and
+ * be shared by the ARMv7-A/R and ARMv7-M support ...
+ */
 static const struct command_registration armv7a_exec_command_handlers[] = {
 	{
 		.name = &quot;info&quot;,
-		.handler = &amp;handle_dap_info_command,
+		.handler = handle_dap_info_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;dap info for ap [num], &quot;
-			&quot;default currently selected AP&quot;,
+		.help = &quot;display ROM table for MEM-AP &quot;
+			&quot;(default currently selected AP)&quot;,
+		.usage = &quot;[ap_num]&quot;,
 	},
 	{
 		.name = &quot;apsel&quot;,
-		.handler = &amp;handle_dap_apsel_command,
+		.handler = handle_dap_apsel_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;select a different AP [num] (default 0)&quot;,
+		.help = &quot;Set the currently selected AP (default 0) &quot;
+			&quot;and display the result&quot;,
+		.usage = &quot;[ap_num]&quot;,
 	},
 	{
 		.name = &quot;apid&quot;,
-		.handler = &amp;handle_dap_apid_command,
+		.handler = handle_dap_apid_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;return id reg from AP [num], &quot;
-			&quot;default currently selected AP&quot;,
+		.help = &quot;return ID register from AP &quot;
+			&quot;(default currently selected AP)&quot;,
+		.usage = &quot;[ap_num]&quot;,
 	},
 	{
 		.name = &quot;baseaddr&quot;,
-		.handler = &amp;handle_dap_baseaddr_command,
+		.handler = handle_dap_baseaddr_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;return debug base address from AP [num], &quot;
-			&quot;default currently selected AP&quot;,
+		.help = &quot;return debug base address from MEM-AP &quot;
+			&quot;(default currently selected AP)&quot;,
+		.usage = &quot;[ap_num]&quot;,
 	},
 	{
 		.name = &quot;memaccess&quot;,
-		.handler = &amp;handle_dap_memaccess_command,
+		.handler = handle_dap_memaccess_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;set/get number of extra tck for mem-ap memory &quot;
+		.help = &quot;set/get number of extra tck for MEM-AP memory &quot;
 			&quot;bus access [0-255]&quot;,
+		.usage = &quot;[cycles]&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
diff --git a/src/target/armv7m.c b/src/target/armv7m.c
index 9d8132d..233fb95 100644
--- a/src/target/armv7m.c
+++ b/src/target/armv7m.c
@@ -799,40 +799,49 @@ COMMAND_HANDLER(handle_dap_info_command)
 	return dap_info_command(CMD_CTX, swjdp, apsel);
 }
 
+/* FIXME this table should be part of generic DAP support, and
+ * be shared by the ARMv7-A/R and ARMv7-M support ...
+ */
 static const struct command_registration armv7m_exec_command_handlers[] = {
 	{
 		.name = &quot;info&quot;,
-		.handler = &amp;handle_dap_info_command,
+		.handler = handle_dap_info_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;dap info for ap [num], &quot;
-			&quot;default currently selected AP&quot;,
+		.help = &quot;display ROM table for MEM-AP &quot;
+			&quot;(default currently selected AP)&quot;,
+		.usage = &quot;[ap_num]&quot;,
 	},
 	{
 		.name = &quot;apsel&quot;,
-		.handler = &amp;handle_dap_apsel_command,
+		.handler = handle_dap_apsel_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;select a different AP [num] (default 0)&quot;,
+		.help = &quot;Set the currently selected AP (default 0) &quot;
+			&quot;and display the result&quot;,
+		.usage = &quot;[ap_num]&quot;,
 	},
 	{
 		.name = &quot;apid&quot;,
-		.handler = &amp;handle_dap_apid_command,
+		.handler = handle_dap_apid_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;return id reg from AP [num], &quot;
-			&quot;default currently selected AP&quot;,
+		.help = &quot;return ID register from AP &quot;
+			&quot;(default currently selected AP)&quot;,
+		.usage = &quot;[ap_num]&quot;,
 	},
 	{
 		.name = &quot;baseaddr&quot;,
-		.handler = &amp;handle_dap_baseaddr_command,
+		.handler = handle_dap_baseaddr_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;return debug base address from AP [num], &quot;
-			&quot;default currently selected AP&quot;,
+		.help = &quot;return debug base address from MEM-AP &quot;
+			&quot;(default currently selected AP)&quot;,
+		.usage = &quot;[ap_num]&quot;,
 	},
 	{
 		.name = &quot;memaccess&quot;,
-		.handler = &amp;handle_dap_memaccess_command,
+		.handler = handle_dap_memaccess_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;set/get number of extra tck for mem-ap memory &quot;
+		.help = &quot;set/get number of extra tck for MEM-AP memory &quot;
 			&quot;bus access [0-255]&quot;,
+		.usage = &quot;[cycles]&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
diff --git a/src/target/cortex_a8.c b/src/target/cortex_a8.c
index 424263d..18edd95 100644
--- a/src/target/cortex_a8.c
+++ b/src/target/cortex_a8.c
@@ -1642,13 +1642,13 @@ COMMAND_HANDLER(cortex_a8_handle_dbginit_command)
 static const struct command_registration cortex_a8_exec_command_handlers[] = {
 	{
 		.name = &quot;cache_info&quot;,
-		.handler = &amp;cortex_a8_handle_cache_info_command,
+		.handler = cortex_a8_handle_cache_info_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display information about target caches&quot;,
 	},
 	{
 		.name = &quot;dbginit&quot;,
-		.handler = &amp;cortex_a8_handle_dbginit_command,
+		.handler = cortex_a8_handle_dbginit_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;Initialize core debug&quot;,
 	},
diff --git a/src/target/cortex_m3.c b/src/target/cortex_m3.c
index 9685821..c6b1bb2 100644
--- a/src/target/cortex_m3.c
+++ b/src/target/cortex_m3.c
@@ -1989,24 +1989,24 @@ COMMAND_HANDLER(handle_cortex_m3_mask_interrupts_command)
 static const struct command_registration cortex_m3_exec_command_handlers[] = {
 	{
 		.name = &quot;disassemble&quot;,
-		.handler = &amp;handle_cortex_m3_disassemble_command,
+		.handler = handle_cortex_m3_disassemble_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;disassemble Thumb2 instructions&quot;,
-		.usage = &quot;&lt;address&gt; [&lt;count&gt;]&quot;,
+		.usage = &quot;address [count]&quot;,
 	},
 	{
 		.name = &quot;maskisr&quot;,
-		.handler = &amp;handle_cortex_m3_mask_interrupts_command,
+		.handler = handle_cortex_m3_mask_interrupts_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;mask cortex_m3 interrupts&quot;,
 		.usage = &quot;['on'|'off']&quot;,
 	},
 	{
 		.name = &quot;vector_catch&quot;,
-		.handler = &amp;handle_cortex_m3_vector_catch_command,
+		.handler = handle_cortex_m3_vector_catch_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;catch hardware vectors&quot;,
-		.usage = &quot;['all'|'none'|&lt;list&gt;]&quot;,
+		.help = &quot;configure hardware vectors to trigger debug entry&quot;,
+		.usage = &quot;['all'|'none'|('bus_err'|'chk_err'|...)*]&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };

commit e19fe9ad09e28df1976257052afe6edf765aa778
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 15:22:41 2010 -0800

    ARM ETM/ETB/trace: help/usage updates
    
    Provide helptext which was sometimes missing; update some of it
    to be more accurate.
    
    Usage syntax messages have the same EBNF as the User's Guide;
    no angle brackets in either place.
    
    Don't use &quot;&amp;function&quot;; functions are like arrays, their address
    is their name.  Shrink some overlong lines, remove some empties.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/etb.c b/src/target/etb.c
index fb2dd60..18258f6 100644
--- a/src/target/etb.c
+++ b/src/target/etb.c
@@ -447,17 +447,21 @@ COMMAND_HANDLER(handle_etb_trigger_percent_command)
 
 static const struct command_registration etb_config_command_handlers[] = {
 	{
+		/* NOTE:  with ADIv5, ETBs are accessed using DAP operations,
+		 * possibly over SWD, not through separate TAPs...
+		 */
 		.name = &quot;config&quot;,
-		.handler = &amp;handle_etb_config_command,
+		.handler = handle_etb_config_command,
 		.mode = COMMAND_CONFIG,
+		.help = &quot;Associate ETB with target and JTAG TAP.&quot;,
 		.usage = &quot;target tap&quot;,
 	},
 	{
 		.name = &quot;trigger_percent&quot;,
-		.handler = &amp;handle_etb_trigger_percent_command,
+		.handler = handle_etb_trigger_percent_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;percent of trace buffer to be filled &quot;
-			&quot;after the trigger occurs&quot;,
+		.help = &quot;Set percent of trace buffer to be filled &quot;
+			&quot;after the trigger occurs (2..100).&quot;,
 		.usage = &quot;[percent]&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
diff --git a/src/target/etm.c b/src/target/etm.c
index d22bc40..3126efc 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -1259,12 +1259,16 @@ COMMAND_HANDLER(handle_etm_tracemode_command)
 	case 0:
 		break;
 	case 4:
-		CALL_COMMAND_HANDLER(handle_etm_tracemode_command_update, &amp;tracemode);
+		CALL_COMMAND_HANDLER(handle_etm_tracemode_command_update,
+				&amp;tracemode);
 		break;
 	default:
-		command_print(CMD_CTX, &quot;usage: configure trace mode &quot;
-				&quot;&lt;none | data | address | all&gt; &quot;
-				&quot;&lt;context id bits&gt; &lt;cycle accurate&gt; &lt;branch output&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: tracemode &quot;
+				&quot;('none'|'data'|'address'|'all') &quot;
+				&quot;context_id_bits &quot;
+				&quot;('enable'|'disable') &quot;
+				&quot;('enable'|'disable')&quot;
+				);
 		return ERROR_FAIL;
 	}
 
@@ -2112,11 +2116,16 @@ COMMAND_HANDLER(handle_etm_analyze_command)
 
 static const struct command_registration etm_config_command_handlers[] = {
 	{
+		/* NOTE:  with ADIv5, ETMs are accessed by DAP operations,
+		 * possibly over SWD, not JTAG scanchain 6 of 'target'.
+		 *
+		 * Also, these parameters don't match ETM v3+ modules...
+		 */
 		.name = &quot;config&quot;,
-		.handler = &amp;handle_etm_config_command,
+		.handler = handle_etm_config_command,
 		.mode = COMMAND_CONFIG,
-		.usage = &quot;&lt;target&gt; &lt;port_width&gt; &lt;port_mode&gt; &quot;
-			&quot;&lt;clocking&gt; &lt;capture_driver&gt;&quot;,
+		.help = &quot;Set up ETM output port.&quot;,
+		.usage = &quot;target port_width port_mode clocking capture_driver&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
@@ -2132,33 +2141,36 @@ const struct command_registration etm_command_handlers[] = {
 
 static const struct command_registration etm_exec_command_handlers[] = {
 	{
-		.name = &quot;tracemode&quot;, handle_etm_tracemode_command,
+		.name = &quot;tracemode&quot;,
+		.handler = handle_etm_tracemode_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;configure/display trace mode&quot;,
-		.usage = &quot;&lt;none | data | address | all&gt; &quot;
-			&quot;&lt;context_id_bits&gt; &lt;cycle_accurate&gt; &lt;branch_output&gt;&quot;,
+		.usage = &quot;('none'|'data'|'address'|'all') &quot;
+			&quot;context_id_bits &quot;
+			&quot;['enable'|'disable'] &quot;
+			&quot;['enable'|'disable']&quot;,
 	},
 	{
 		.name = &quot;info&quot;,
-		.handler = &amp;handle_etm_info_command,
+		.handler = handle_etm_info_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display info about the current target's ETM&quot;,
 	},
 	{
 		.name = &quot;status&quot;,
-		.handler = &amp;handle_etm_status_command,
+		.handler = handle_etm_status_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display current target's ETM status&quot;,
 	},
 	{
 		.name = &quot;start&quot;,
-		.handler = &amp;handle_etm_start_command,
+		.handler = handle_etm_start_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;start ETM trace collection&quot;,
 	},
 	{
 		.name = &quot;stop&quot;,
-		.handler = &amp;handle_etm_stop_command,
+		.handler = handle_etm_stop_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;stop ETM trace collection&quot;,
 	},
@@ -2167,7 +2179,7 @@ static const struct command_registration etm_exec_command_handlers[] = {
 		.handler = handle_etm_trigger_debug_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;enable/disable debug entry on trigger&quot;,
-		.usage = &quot;(enable | disable)&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 	},
 	{
 		.name = &quot;analyze&quot;,
@@ -2177,19 +2189,21 @@ static const struct command_registration etm_exec_command_handlers[] = {
 	},
 	{
 		.name = &quot;image&quot;,
-		.handler = &amp;handle_etm_image_command,
+		.handler = handle_etm_image_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;load image from &lt;file&gt; [base address]&quot;,
+		.help = &quot;load image from file with optional offset&quot;,
+		.usage = &quot;filename [offset]&quot;,
 	},
 	{
 		.name = &quot;dump&quot;,
-		.handler = &amp;handle_etm_dump_command,
+		.handler = handle_etm_dump_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;dump captured trace data &lt;file&gt;&quot;,
+		.help = &quot;dump captured trace data to file&quot;,
+		.usage = &quot;filename&quot;,
 	},
 	{
 		.name = &quot;load&quot;,
-		.handler = &amp;handle_etm_load_command,
+		.handler = handle_etm_load_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;load trace data for analysis &lt;file&gt;&quot;,
 	},
diff --git a/src/target/etm_dummy.c b/src/target/etm_dummy.c
index 19a078f..f9c6fe7 100644
--- a/src/target/etm_dummy.c
+++ b/src/target/etm_dummy.c
@@ -61,9 +61,9 @@ COMMAND_HANDLER(handle_etm_dummy_config_command)
 static const struct command_registration etm_dummy_config_command_handlers[] = {
 	{
 		.name = &quot;config&quot;,
-		.handler = &amp;handle_etm_dummy_config_command,
+		.handler = handle_etm_dummy_config_command,
 		.mode = COMMAND_CONFIG,
-		.usage = &quot;&lt;target&gt;&quot;,
+		.usage = &quot;target&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
diff --git a/src/target/oocd_trace.c b/src/target/oocd_trace.c
index 2533c40..3b43571 100644
--- a/src/target/oocd_trace.c
+++ b/src/target/oocd_trace.c
@@ -398,13 +398,13 @@ COMMAND_HANDLER(handle_oocd_trace_resync_command)
 static const struct command_registration oocd_trace_all_command_handlers[] = {
 	{
 		.name = &quot;config&quot;,
-		.handler = &amp;handle_oocd_trace_config_command,
+		.handler = handle_oocd_trace_config_command,
 		.mode = COMMAND_CONFIG,
-		.usage = &quot;&lt;target&gt;&quot;,
+		.usage = &quot;target&quot;,
 	},
 	{
 		.name = &quot;status&quot;,
-		.handler = &amp;handle_oocd_trace_status_command,
+		.handler = handle_oocd_trace_status_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display OpenOCD + trace status&quot;,
 	},

commit dd8f679aa2ea447a96f393db3a8938259f63eebc
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 15:05:26 2010 -0800

    target misc: help/usage updates
    
    Provide helptext which was sometimes missing; update some of it
    to be more accurate.
    
    Usage syntax messages have the same EBNF as the User's Guide.
    
    Don't use &quot;&amp;function&quot;; functions are like arrays, their address
    is their name.  Shrink some overlong lines; remove some empties.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/target.c b/src/target/target.c
index 73a762d..c29c45e 100644
--- a/src/target/target.c
+++ b/src/target/target.c
@@ -45,8 +45,10 @@
 #include &quot;image.h&quot;
 
 
-static int target_array2mem(Jim_Interp *interp, struct target *target, int argc, Jim_Obj *const *argv);
-static int target_mem2array(Jim_Interp *interp, struct target *target, int argc, Jim_Obj *const *argv);
+static int target_array2mem(Jim_Interp *interp, struct target *target,
+		int argc, Jim_Obj *const *argv);
+static int target_mem2array(Jim_Interp *interp, struct target *target,
+		int argc, Jim_Obj *const *argv);
 
 /* targets */
 extern struct target_type arm7tdmi_target;
@@ -2960,7 +2962,8 @@ static void writeGmon(uint32_t *samples, uint32_t sampleNum, const char *filenam
 	fclose(f);
 }
 
-/* profiling samples the CPU PC as quickly as OpenOCD is able, which will be used as a random sampling of PC */
+/* profiling samples the CPU PC as quickly as OpenOCD is able,
+ * which will be used as a random sampling of PC */
 COMMAND_HANDLER(handle_profile_command)
 {
 	struct target *target = get_current_target(CMD_CTX);
@@ -2976,6 +2979,12 @@ COMMAND_HANDLER(handle_profile_command)
 
 	timeval_add_time(&amp;timeout, offset, 0);
 
+	/**
+	 * @todo: Some cores let us sample the PC without the
+	 * annoying halt/resume step; for example, ARMv7 PCSR.
+	 * Provide a way to use that more efficient mechanism.
+	 */
+
 	command_print(CMD_CTX, &quot;Starting profiling. Halting and resuming the target as often as we can...&quot;);
 
 	static const int maxSample = 10000;
@@ -3287,7 +3296,9 @@ static int jim_array2mem(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 
 	return target_array2mem(interp,target, argc-1, argv + 1);
 }
-static int target_array2mem(Jim_Interp *interp, struct target *target, int argc, Jim_Obj *const *argv)
+
+static int target_array2mem(Jim_Interp *interp, struct target *target,
+		int argc, Jim_Obj *const *argv)
 {
 	long l;
 	uint32_t width;
@@ -3789,11 +3800,13 @@ static int target_configure(Jim_GetOptInfo *goi, struct target *target)
 	return JIM_OK;
 }
 
-static int jim_target_configure(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
+static int
+jim_target_configure(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 {
 	Jim_GetOptInfo goi;
+
 	Jim_GetOpt_Setup(&amp;goi, interp, argc - 1, argv + 1);
-	goi.isconfigure = strcmp(Jim_GetString(argv[0], NULL), &quot;configure&quot;) == 0;
+	goi.isconfigure = !strcmp(Jim_GetString(argv[0], NULL), &quot;configure&quot;);
 	int need_args = 1 + goi.isconfigure;
 	if (goi.argc &lt; need_args)
 	{
@@ -3988,13 +4001,15 @@ static int jim_target_md(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 	return JIM_OK;
 }
 
-static int jim_target_mem2array(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
+static int jim_target_mem2array(Jim_Interp *interp,
+		int argc, Jim_Obj *const *argv)
 {
 	struct target *target = Jim_CmdPrivData(interp);
 	return target_mem2array(interp, target, argc - 1, argv + 1);
 }
 
-static int jim_target_array2mem(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
+static int jim_target_array2mem(Jim_Interp *interp,
+		int argc, Jim_Obj *const *argv)
 {
 	struct target *target = Jim_CmdPrivData(interp);
 	return target_array2mem(interp, target, argc - 1, argv + 1);
@@ -4219,108 +4234,123 @@ static const struct command_registration target_instance_command_handlers[] = {
 	{
 		.name = &quot;configure&quot;,
 		.mode = COMMAND_CONFIG,
-		.jim_handler = &amp;jim_target_configure,
-		.usage = &quot;[&lt;target_options&gt; ...]&quot;,
+		.jim_handler = jim_target_configure,
 		.help  = &quot;configure a new target for use&quot;,
+		.usage = &quot;[target_attribute ...]&quot;,
 	},
 	{
 		.name = &quot;cget&quot;,
 		.mode = COMMAND_ANY,
-		.jim_handler = &amp;jim_target_configure,
-		.usage = &quot;&lt;target_type&gt; [&lt;target_options&gt; ...]&quot;,
-		.help  = &quot;configure a new target for use&quot;,
+		.jim_handler = jim_target_configure,
+		.help  = &quot;returns the specified target attribute&quot;,
+		.usage = &quot;target_attribute&quot;,
 	},
 	{
 		.name = &quot;mww&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_mw,
-		.usage = &quot;&lt;address&gt; &lt;data&gt; [&lt;count&gt;]&quot;,
+		.jim_handler = jim_target_mw,
 		.help = &quot;Write 32-bit word(s) to target memory&quot;,
+		.usage = &quot;address data [count]&quot;,
 	},
 	{
 		.name = &quot;mwh&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_mw,
-		.usage = &quot;&lt;address&gt; &lt;data&gt; [&lt;count&gt;]&quot;,
+		.jim_handler = jim_target_mw,
 		.help = &quot;Write 16-bit half-word(s) to target memory&quot;,
+		.usage = &quot;address data [count]&quot;,
 	},
 	{
 		.name = &quot;mwb&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_mw,
-		.usage = &quot;&lt;address&gt; &lt;data&gt; [&lt;count&gt;]&quot;,
+		.jim_handler = jim_target_mw,
 		.help = &quot;Write byte(s) to target memory&quot;,
+		.usage = &quot;address data [count]&quot;,
 	},
 	{
 		.name = &quot;mdw&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_md,
-		.usage = &quot;&lt;address&gt; [&lt;count&gt;]&quot;,
+		.jim_handler = jim_target_md,
 		.help = &quot;Display target memory as 32-bit words&quot;,
+		.usage = &quot;address [count]&quot;,
 	},
 	{
 		.name = &quot;mdh&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_md,
-		.usage = &quot;&lt;address&gt; [&lt;count&gt;]&quot;,
+		.jim_handler = jim_target_md,
 		.help = &quot;Display target memory as 16-bit half-words&quot;,
+		.usage = &quot;address [count]&quot;,
 	},
 	{
 		.name = &quot;mdb&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_md,
-		.usage = &quot;&lt;address&gt; [&lt;count&gt;]&quot;,
+		.jim_handler = jim_target_md,
 		.help = &quot;Display target memory as 8-bit bytes&quot;,
+		.usage = &quot;address [count]&quot;,
 	},
 	{
 		.name = &quot;array2mem&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_array2mem,
+		.jim_handler = jim_target_array2mem,
+		.help = &quot;Writes Tcl array of 8/16/32 bit numbers &quot;
+			&quot;to target memory&quot;,
+		.usage = &quot;arrayname bitwidth address count&quot;,
 	},
 	{
 		.name = &quot;mem2array&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_mem2array,
+		.jim_handler = jim_target_mem2array,
+		.help = &quot;Loads Tcl array of 8/16/32 bit numbers &quot;
+			&quot;from target memory&quot;,
+		.usage = &quot;arrayname bitwidth address count&quot;,
 	},
 	{
 		.name = &quot;eventlist&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_event_list,
+		.jim_handler = jim_target_event_list,
+		.help = &quot;displays a table of events defined for this target&quot;,
 	},
 	{
 		.name = &quot;curstate&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_current_state,
+		.jim_handler = jim_target_current_state,
+		.help = &quot;displays the current state of this target&quot;,
 	},
 	{
 		.name = &quot;arp_examine&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_examine,
+		.jim_handler = jim_target_examine,
+		.help = &quot;used internally for reset processing&quot;,
 	},
 	{
 		.name = &quot;arp_poll&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_poll,
+		.jim_handler = jim_target_poll,
+		.help = &quot;used internally for reset processing&quot;,
 	},
 	{
 		.name = &quot;arp_reset&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_reset,
+		.jim_handler = jim_target_reset,
+		.help = &quot;used internally for reset processing&quot;,
 	},
 	{
 		.name = &quot;arp_halt&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_halt,
+		.jim_handler = jim_target_halt,
+		.help = &quot;used internally for reset processing&quot;,
 	},
 	{
 		.name = &quot;arp_waitstate&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_wait_state,
+		.jim_handler = jim_target_wait_state,
+		.help = &quot;used internally for reset processing&quot;,
 	},
 	{
 		.name = &quot;invoke-event&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_target_invoke_event,
+		.jim_handler = jim_target_invoke_event,
+		.help = &quot;invoke handler for specified event&quot;,
+		.usage = &quot;event_name&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
@@ -4472,7 +4502,7 @@ static int target_create(Jim_GetOptInfo *goi)
 		}
 		*tpp = target;
 	}
-	
+
 	/* now - create the new target name command */
 	const const struct command_registration target_subcommands[] = {
 		{
@@ -4615,51 +4645,54 @@ static const struct command_registration target_subcommand_handlers[] = {
 	{
 		.name = &quot;init&quot;,
 		.mode = COMMAND_CONFIG,
-		.handler = &amp;handle_target_init_command,
+		.handler = handle_target_init_command,
 		.help = &quot;initialize targets&quot;,
 	},
 	{
 		.name = &quot;create&quot;,
+		/* REVISIT this should be COMMAND_CONFIG ... */
 		.mode = COMMAND_ANY,
-		.jim_handler = &amp;jim_target_create,
-		.usage = &quot;&lt;name&gt; &lt;type&gt; ...&quot;,
-		.help = &quot;Returns the currently selected target&quot;,
+		.jim_handler = jim_target_create,
+		.usage = &quot;name type '-chain-position' name [options ...]&quot;,
+		.help = &quot;Creates and selects a new target&quot;,
 	},
 	{
 		.name = &quot;current&quot;,
 		.mode = COMMAND_ANY,
-		.jim_handler = &amp;jim_target_current,
+		.jim_handler = jim_target_current,
 		.help = &quot;Returns the currently selected target&quot;,
 	},
 	{
 		.name = &quot;types&quot;,
 		.mode = COMMAND_ANY,
-		.jim_handler = &amp;jim_target_types,
-		.help = &quot;Returns the available target types as a list of strings&quot;,
+		.jim_handler = jim_target_types,
+		.help = &quot;Returns the available target types as &quot;
+				&quot;a list of strings&quot;,
 	},
 	{
 		.name = &quot;names&quot;,
 		.mode = COMMAND_ANY,
-		.jim_handler = &amp;jim_target_names,
+		.jim_handler = jim_target_names,
 		.help = &quot;Returns the names of all targets as a list of strings&quot;,
 	},
 	{
 		.name = &quot;number&quot;,
 		.mode = COMMAND_ANY,
-		.jim_handler = &amp;jim_target_number,
-		.usage = &quot;&lt;number&gt;&quot;,
-		.help = &quot;Returns the name of target &lt;n&gt;&quot;,
+		.jim_handler = jim_target_number,
+		.usage = &quot;number&quot;,
+		.help = &quot;Returns the name of the numbered target &quot;
+			&quot;(DEPRECATED)&quot;,
 	},
 	{
 		.name = &quot;count&quot;,
 		.mode = COMMAND_ANY,
-		.jim_handler = &amp;jim_target_count,
-		.help = &quot;Returns the number of targets as an integer&quot;,
+		.jim_handler = jim_target_count,
+		.help = &quot;Returns the number of targets as an integer &quot;
+			&quot;(DEPRECATED)&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
 
-
 struct FastLoad
 {
 	uint32_t address;
@@ -4833,11 +4866,11 @@ COMMAND_HANDLER(handle_fast_load_command)
 static const struct command_registration target_command_handlers[] = {
 	{
 		.name = &quot;targets&quot;,
-		.handler = &amp;handle_targets_command,
+		.handler = handle_targets_command,
 		.mode = COMMAND_ANY,
-		.help = &quot;change current command line target (one parameter) &quot;
-			&quot;or list targets (no parameters)&quot;,
-		.usage = &quot;[&lt;new_current_target&gt;]&quot;,
+		.help = &quot;change current default target (one parameter) &quot;
+			&quot;or prints table of all targets (no parameters)&quot;,
+		.usage = &quot;[target]&quot;,
 	},
 	{
 		.name = &quot;target&quot;,
@@ -4857,69 +4890,75 @@ int target_register_commands(struct command_context *cmd_ctx)
 static const struct command_registration target_exec_command_handlers[] = {
 	{
 		.name = &quot;fast_load_image&quot;,
-		.handler = &amp;handle_fast_load_image_command,
+		.handler = handle_fast_load_image_command,
 		.mode = COMMAND_ANY,
-		.help = &quot;Load image into memory, mainly for profiling purposes&quot;,
-		.usage = &quot;&lt;file&gt; &lt;address&gt; ['bin'|'ihex'|'elf'|'s19'] &quot;
-			&quot;[min_address] [max_length]&quot;,
+		.help = &quot;Load image into server memory for later use by &quot;
+			&quot;fast_load; primarily for profiling&quot;,
+		.usage = &quot;filename address ['bin'|'ihex'|'elf'|'s19'] &quot;
+			&quot;[min_address [max_length]]&quot;,
 	},
 	{
 		.name = &quot;fast_load&quot;,
-		.handler = &amp;handle_fast_load_command,
+		.handler = handle_fast_load_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;loads active fast load image to current target &quot;
 			&quot;- mainly for profiling purposes&quot;,
 	},
 	{
 		.name = &quot;profile&quot;,
-		.handler = &amp;handle_profile_command,
+		.handler = handle_profile_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;profiling samples the CPU PC&quot;,
 	},
 	/** @todo don't register virt2phys() unless target supports it */
 	{
 		.name = &quot;virt2phys&quot;,
-		.handler = &amp;handle_virt2phys_command,
+		.handler = handle_virt2phys_command,
 		.mode = COMMAND_ANY,
 		.help = &quot;translate a virtual address into a physical address&quot;,
+		.usage = &quot;virual_address&quot;,
 	},
-
 	{
 		.name = &quot;reg&quot;,
-		.handler = &amp;handle_reg_command,
+		.handler = handle_reg_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;display or set a register&quot;,
+		.help = &quot;display or set a register; with no arguments, &quot;
+			&quot;displays all registers and their values&quot;,
+		.usage = &quot;[(register_name|register_number) [value]]&quot;,
 	},
-
 	{
 		.name = &quot;poll&quot;,
-		.handler = &amp;handle_poll_command,
+		.handler = handle_poll_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;poll target state&quot;,
+		.help = &quot;poll target state; or reconfigure background polling&quot;,
+		.usage = &quot;['on'|'off']&quot;,
 	},
 	{
 		.name = &quot;wait_halt&quot;,
-		.handler = &amp;handle_wait_halt_command,
+		.handler = handle_wait_halt_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;wait for target halt&quot;,
-		.usage = &quot;[time (s)]&quot;,
+		.help = &quot;wait up to the specified number of milliseconds &quot;
+			&quot;(default 5) for a previously requested halt&quot;,
+		.usage = &quot;[milliseconds]&quot;,
 	},
 	{
 		.name = &quot;halt&quot;,
-		.handler = &amp;handle_halt_command,
+		.handler = handle_halt_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;halt target&quot;,
+		.help = &quot;request target to halt, then wait up to the specified&quot;
+			&quot;number of milliseconds (default 5) for it to complete&quot;,
+		.usage = &quot;[milliseconds]&quot;,
 	},
 	{
 		.name = &quot;resume&quot;,
-		.handler = &amp;handle_resume_command,
+		.handler = handle_resume_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;resume target&quot;,
-		.usage = &quot;[&lt;address&gt;]&quot;,
+		.help =	&quot;resume target execution from current PC or address&quot;,
+		.usage = &quot;[address]&quot;,
 	},
 	{
 		.name = &quot;reset&quot;,
-		.handler = &amp;handle_reset_command,
+		.handler = handle_reset_command,
 		.mode = COMMAND_EXEC,
 		.usage = &quot;[run|halt|init]&quot;,
 		.help = &quot;Reset all targets into the specified mode.&quot;
@@ -4927,133 +4966,127 @@ static const struct command_registration target_exec_command_handlers[] = {
 	},
 	{
 		.name = &quot;soft_reset_halt&quot;,
-		.handler = &amp;handle_soft_reset_halt_command,
+		.handler = handle_soft_reset_halt_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;halt the target and do a soft reset&quot;,
 	},
 	{
-
 		.name = &quot;step&quot;,
-		.handler = &amp;handle_step_command,
+		.handler = handle_step_command,
 		.mode = COMMAND_EXEC,
-		.help =	&quot;step one instruction from current PC or [addr]&quot;,
-		.usage = &quot;[&lt;address&gt;]&quot;,
+		.help =	&quot;step one instruction from current PC or address&quot;,
+		.usage = &quot;[address]&quot;,
 	},
 	{
-
 		.name = &quot;mdw&quot;,
-		.handler = &amp;handle_md_command,
+		.handler = handle_md_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display memory words&quot;,
-		.usage = &quot;[phys] &lt;addr&gt; [count]&quot;,
+		.usage = &quot;['phys'] address [count]&quot;,
 	},
 	{
 		.name = &quot;mdh&quot;,
-		.handler = &amp;handle_md_command,
+		.handler = handle_md_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display memory half-words&quot;,
-		.usage = &quot;[phys] &lt;addr&gt; [count]&quot;,
+		.usage = &quot;['phys'] address [count]&quot;,
 	},
 	{
 		.name = &quot;mdb&quot;,
-		.handler = &amp;handle_md_command,
+		.handler = handle_md_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display memory bytes&quot;,
-		.usage = &quot;[phys] &lt;addr&gt; [count]&quot;,
+		.usage = &quot;['phys'] address [count]&quot;,
 	},
 	{
-
 		.name = &quot;mww&quot;,
-		.handler = &amp;handle_mw_command,
+		.handler = handle_mw_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;write memory word&quot;,
-		.usage = &quot;[phys]  &lt;addr&gt; &lt;value&gt; [count]&quot;,
+		.usage = &quot;['phys'] address value [count]&quot;,
 	},
 	{
 		.name = &quot;mwh&quot;,
-		.handler = &amp;handle_mw_command,
+		.handler = handle_mw_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;write memory half-word&quot;,
-		.usage = &quot;[phys] &lt;addr&gt; &lt;value&gt; [count]&quot;,
+		.usage = &quot;['phys'] address value [count]&quot;,
 	},
 	{
 		.name = &quot;mwb&quot;,
-		.handler = &amp;handle_mw_command,
+		.handler = handle_mw_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;write memory byte&quot;,
-		.usage = &quot;[phys] &lt;addr&gt; &lt;value&gt; [count]&quot;,
+		.usage = &quot;['phys'] address value [count]&quot;,
 	},
 	{
-
 		.name = &quot;bp&quot;,
-		.handler = &amp;handle_bp_command,
+		.handler = handle_bp_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;list or set breakpoint&quot;,
-		.usage = &quot;[&lt;address&gt; &lt;length&gt; [hw]]&quot;,
+		.help = &quot;list or set hardware or software breakpoint&quot;,
+		.usage = &quot;[address length ['hw']]&quot;,
 	},
 	{
 		.name = &quot;rbp&quot;,
-		.handler = &amp;handle_rbp_command,
+		.handler = handle_rbp_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;remove breakpoint&quot;,
-		.usage = &quot;&lt;address&gt;&quot;,
+		.usage = &quot;address&quot;,
 	},
 	{
-
 		.name = &quot;wp&quot;,
-		.handler = &amp;handle_wp_command,
+		.handler = handle_wp_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;list or set watchpoint&quot;,
-		.usage = &quot;[&lt;address&gt; &lt;length&gt; &lt;r/w/a&gt; [value] [mask]]&quot;,
+		.help = &quot;list (no params) or create watchpoints&quot;,
+		.usage = &quot;[address length [('r'|'w'|'a') value [mask]]]&quot;,
 	},
 	{
 		.name = &quot;rwp&quot;,
-		.handler = &amp;handle_rwp_command,
+		.handler = handle_rwp_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;remove watchpoint&quot;,
-		.usage = &quot;&lt;address&gt;&quot;,
-
+		.usage = &quot;address&quot;,
 	},
 	{
 		.name = &quot;load_image&quot;,
-		.handler = &amp;handle_load_image_command,
+		.handler = handle_load_image_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;file&gt; &lt;address&gt; ['bin'|'ihex'|'elf'|'s19'] &quot;
+		.usage = &quot;filename address ['bin'|'ihex'|'elf'|'s19'] &quot;
 			&quot;[min_address] [max_length]&quot;,
 	},
 	{
 		.name = &quot;dump_image&quot;,
-		.handler = &amp;handle_dump_image_command,
+		.handler = handle_dump_image_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;file&gt; &lt;address&gt; &lt;size&gt;&quot;,
+		.usage = &quot;filename address size&quot;,
 	},
 	{
 		.name = &quot;verify_image&quot;,
-		.handler = &amp;handle_verify_image_command,
+		.handler = handle_verify_image_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;file&gt; [offset] [type]&quot;,
+		.usage = &quot;filename [offset [type]]&quot;,
 	},
 	{
 		.name = &quot;test_image&quot;,
-		.handler = &amp;handle_test_image_command,
+		.handler = handle_test_image_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;file&gt; [offset] [type]&quot;,
+		.usage = &quot;filename [offset [type]]&quot;,
 	},
 	{
 		.name = &quot;ocd_mem2array&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_mem2array,
-		.help = &quot;read memory and return as a TCL array &quot;
+		.jim_handler = jim_mem2array,
+		.help = &quot;read 8/16/32 bit memory and return as a TCL array &quot;
 			&quot;for script processing&quot;,
-		.usage = &quot;&lt;arrayname&gt; &lt;width=32|16|8&gt; &lt;address&gt; &lt;count&gt;&quot;,
+		.usage = &quot;arrayname bitwidth address count&quot;,
 	},
 	{
 		.name = &quot;ocd_array2mem&quot;,
 		.mode = COMMAND_EXEC,
-		.jim_handler = &amp;jim_array2mem,
+		.jim_handler = jim_array2mem,
 		.help = &quot;convert a TCL array to memory locations &quot;
-			&quot;and write the values&quot;,
-		.usage = &quot;&lt;arrayname&gt; &lt;width=32|16|8&gt; &lt;address&gt; &lt;count&gt;&quot;,
+			&quot;and write the 8/16/32 bit values&quot;,
+		.usage = &quot;arrayname bitwidth address count&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
diff --git a/src/target/target_request.c b/src/target/target_request.c
index d22b8a2..ec3d48e 100644
--- a/src/target/target_request.c
+++ b/src/target/target_request.c
@@ -303,10 +303,10 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 static const struct command_registration target_req_exec_command_handlers[] = {
 	{
 		.name = &quot;debugmsgs&quot;,
-		.handler = &amp;handle_target_request_debugmsgs_command,
+		.handler = handle_target_request_debugmsgs_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;set reception of debug messages from target&quot;,
-		.usage = &quot;(enable|disable)&quot;,
+		.help = &quot;display and/or modify reception of debug messages from target&quot;,
+		.usage = &quot;['enable'|'charmsg'|'disable']&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
diff --git a/src/target/trace.c b/src/target/trace.c
index 56a18a4..a8ec143 100644
--- a/src/target/trace.c
+++ b/src/target/trace.c
@@ -159,18 +159,18 @@ COMMAND_HANDLER(handle_trace_history_command)
 static const struct command_registration trace_exec_command_handlers[] = {
 	{
 		.name = &quot;history&quot;,
-		.handler = &amp;handle_trace_history_command,
+		.handler = handle_trace_history_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;display trace history, clear history or set [size]&quot;,
-		.usage = &quot;[clear|&lt;size&gt;]&quot;,
+		.help = &quot;display trace history, clear history or set size&quot;,
+		.usage = &quot;['clear'|size]&quot;,
 	},
 	{
 		.name = &quot;point&quot;,
-		.handler = &amp;handle_trace_point_command,
+		.handler = handle_trace_point_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;display trace points, clear list of trace points, &quot;
-			&quot;or add new tracepoint at [address]&quot;,
-		.usage = &quot;[clear|&lt;address&gt;]&quot;,
+			&quot;or add new tracepoint at address&quot;,
+		.usage = &quot;['clear'|address]&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };

commit 7c3aee96b2f122fd16ec20e305cb16fe89180c9b
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Thu Jan 7 14:51:59 2010 -0800

    XScale: help/usage updates
    
    Provide helptext which was sometimes missing; update some of it
    to be more accurate (mostly they display something w/no args).
    
    Usage syntax messages have the same EBNF as the User's Guide.
    In some cases, *exactly* what the user's guide shows... e.g.
    talking about &quot;offset&quot; not &quot;address&quot; for trace_image.
    
    Don't use &quot;&amp;function&quot;; functions are like arrays, their name
    is their address.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/target/xscale.c b/src/target/xscale.c
index 6efe59c..fc71ea3 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -3607,94 +3607,101 @@ COMMAND_HANDLER(xscale_handle_cp15)
 static const struct command_registration xscale_exec_command_handlers[] = {
 	{
 		.name = &quot;cache_info&quot;,
-		.handler = &amp;xscale_handle_cache_info_command,
-		.mode = COMMAND_EXEC, NULL,
+		.handler = xscale_handle_cache_info_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display information about CPU caches&quot;,
 	},
-
 	{
 		.name = &quot;mmu&quot;,
-		.handler = &amp;xscale_handle_mmu_command,
+		.handler = xscale_handle_mmu_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;[enable|disable]&quot;,
 		.help = &quot;enable or disable the MMU&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 	},
 	{
 		.name = &quot;icache&quot;,
-		.handler = &amp;xscale_handle_idcache_command,
+		.handler = xscale_handle_idcache_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;[enable|disable]&quot;,
-		.help = &quot;enable or disable the ICache&quot;,
+		.help = &quot;display ICache state, optionally enabling or &quot;
+			&quot;disabling it&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 	},
 	{
 		.name = &quot;dcache&quot;,
-		.handler = &amp;xscale_handle_idcache_command,
+		.handler = xscale_handle_idcache_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;[enable|disable]&quot;,
-		.help = &quot;enable or disable the DCache&quot;,
+		.help = &quot;display DCache state, optionally enabling or &quot;
+			&quot;disabling it&quot;,
+		.usage = &quot;['enable'|'disable']&quot;,
 	},
-
 	{
 		.name = &quot;vector_catch&quot;,
-		.handler = &amp;xscale_handle_vector_catch_command,
+		.handler = xscale_handle_vector_catch_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;mask of vectors that should be caught&quot;,
-		.usage = &quot;[&lt;mask&gt;]&quot;,
+		.help = &quot;set or display 8-bit mask of vectors &quot;
+			&quot;that should trigger debug entry&quot;,
+		.usage = &quot;[mask]&quot;,
 	},
 	{
 		.name = &quot;vector_table&quot;,
-		.handler = &amp;xscale_handle_vector_table_command,
+		.handler = xscale_handle_vector_table_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;high|low&gt; &lt;index&gt; &lt;code&gt;&quot;,
-		.help = &quot;set static code for exception handler entry&quot;,
+		.help = &quot;set vector table entry in mini-ICache, &quot;
+			&quot;or display current tables&quot;,
+		.usage = &quot;[('high'|'low') index code]&quot;,
 	},
-
 	{
 		.name = &quot;trace_buffer&quot;,
-		.handler = &amp;xscale_handle_trace_buffer_command,
+		.handler = xscale_handle_trace_buffer_command,
 		.mode = COMMAND_EXEC,
-		.usage = &quot;&lt;enable | disable&gt; [fill [n]|wrap]&quot;,
+		.help = &quot;display trace buffer status, enable or disable &quot;
+			&quot;tracing, and optionally reconfigure trace mode&quot;,
+		.usage = &quot;['enable'|'disable' ['fill' number|'wrap']]&quot;,
 	},
 	{
 		.name = &quot;dump_trace&quot;,
-		.handler = &amp;xscale_handle_dump_trace_command,
+		.handler = xscale_handle_dump_trace_command,
 		.mode = COMMAND_EXEC,
-		.help = &quot;dump content of trace buffer to &lt;file&gt;&quot;,
-		.usage = &quot;&lt;file&gt;&quot;,
+		.help = &quot;dump content of trace buffer to file&quot;,
+		.usage = &quot;filename&quot;,
 	},
 	{
 		.name = &quot;analyze_trace&quot;,
-		.handler = &amp;xscale_handle_analyze_trace_buffer_command,
+		.handler = xscale_handle_analyze_trace_buffer_command,
 		.mode = COMMAND_EXEC,
 		.help = &quot;analyze content of trace buffer&quot;,
+		.usage = &quot;&quot;,
 	},
 	{
 		.name = &quot;trace_image&quot;,
-		.handler = &amp;xscale_handle_trace_image_command,
-		COMMAND_EXEC,
-		.help = &quot;load image from &lt;file&gt; [base address]&quot;,
-		.usage = &quot;&lt;file&gt; [address] [type]&quot;,
+		.handler = xscale_handle_trace_image_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;load image from file to address (default 0)&quot;,
+		.usage = &quot;filename [offset [filetype]]&quot;,
 	},
-
 	{
 		.name = &quot;cp15&quot;,
-		.handler = &amp;xscale_handle_cp15,
+		.handler = xscale_handle_cp15,
 		.mode = COMMAND_EXEC,
-		.help = &quot;access coproc 15&quot;,
-		.usage = &quot;&lt;register&gt; [value]&quot;,
+		.help = &quot;Read or write coprocessor 15 register.&quot;,
+		.usage = &quot;register [value]&quot;,
 	},
 	COMMAND_REGISTRATION_DONE
 };
 static const struct command_registration xscale_any_command_handlers[] = {
 	{
 		.name = &quot;debug_handler&quot;,
-		.handler = &amp;xscale_handle_debug_handler_command,
+		.handler = xscale_handle_debug_handler_command,
 		.mode = COMMAND_ANY,
-		.usage = &quot;&lt;target#&gt; &lt;address&gt;&quot;,
+		.help = &quot;Change address used for debug handler.&quot;,
+		.usage = &quot;target address&quot;,
 	},
 	{
 		.name = &quot;cache_clean_address&quot;,
-		.handler = &amp;xscale_handle_cache_clean_address_command,
+		.handler = xscale_handle_cache_clean_address_command,
 		.mode = COMMAND_ANY,
+		.help = &quot;Change address used for cleaning data cache.&quot;,
+		.usage = &quot;address&quot;,
 	},
 	{
 		.chain = xscale_exec_command_handlers,

-----------------------------------------------------------------------

Summary of changes:
 doc/openocd.texi            |  111 +++++++++++------
 src/target/arm11.c          |   29 +++--
 src/target/arm720t.c        |    6 +-
 src/target/arm7_9_common.c  |   16 ++--
 src/target/arm920t.c        |   24 ++--
 src/target/arm926ejs.c      |    2 +-
 src/target/arm966e.c        |   12 ++-
 src/target/arm9tdmi.c       |    4 +-
 src/target/arm_adi_v5.c     |    8 ++
 src/target/armv4_5.c        |   10 +-
 src/target/armv7a.c         |   35 ++++--
 src/target/armv7m.c         |   35 ++++--
 src/target/cortex_a8.c      |    4 +-
 src/target/cortex_m3.c      |   12 +-
 src/target/etb.c            |   12 ++-
 src/target/etm.c            |   54 ++++++---
 src/target/etm_dummy.c      |    4 +-
 src/target/oocd_trace.c     |    6 +-
 src/target/target.c         |  277 ++++++++++++++++++++++++-------------------
 src/target/target_request.c |    6 +-
 src/target/trace.c          |   12 +-
 src/target/xscale.c         |   79 +++++++------
 22 files changed, 448 insertions(+), 310 deletions(-)


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002005.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-58-g991d030
</A></li>
	<LI>Next message: <A HREF="002007.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-70-g296a011
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2006">[ date ]</a>
              <a href="thread.html#2006">[ thread ]</a>
              <a href="subject.html#2006">[ subject ]</a>
              <a href="author.html#2006">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
