<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-39-ge033829
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2010-January/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.4.0-rc1-39-ge033829&In-Reply-To=%3CE1NRXih-0005WN-Nz%40sfp-scmshell-1.v30.ch3.sourceforge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001995.html">
   <LINK REL="Next"  HREF="001997.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-39-ge033829</H1>
    <B>David Brownell</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.4.0-rc1-39-ge033829&In-Reply-To=%3CE1NRXih-0005WN-Nz%40sfp-scmshell-1.v30.ch3.sourceforge.com%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-39-ge033829">dbrownell at users.sourceforge.net
       </A><BR>
    <I>Sun Jan  3 22:10:38 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001995.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-37-g4ed5b45
</A></li>
        <LI>Next message: <A HREF="001997.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-40-g4aedb02
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1996">[ date ]</a>
              <a href="thread.html#1996">[ thread ]</a>
              <a href="subject.html#1996">[ subject ]</a>
              <a href="author.html#1996">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  e0338293b80211aee4254848ea56e0cf38bf3b9a (commit)
       via  d9508b30e096b5cc44a4fdbf2d6b99ca173a43f1 (commit)
      from  4ed5b45097cb2c13f9ef0682848c4682b5fd7240 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit e0338293b80211aee4254848ea56e0cf38bf3b9a
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Sun Jan 3 13:07:18 2010 -0800

    JTAG/drivers: cleanup jtag_interface structs
    
    Get rid of excess indents.
    Ditto superfluous &quot;&amp;&quot; before function pointers.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/jtag/drivers/arm-jtag-ew.c b/src/jtag/drivers/arm-jtag-ew.c
index 6221011..e54c8c6 100644
--- a/src/jtag/drivers/arm-jtag-ew.c
+++ b/src/jtag/drivers/arm-jtag-ew.c
@@ -513,17 +513,15 @@ static const struct command_registration armjtagew_command_handlers[] = {
 };
 
 struct jtag_interface armjtagew_interface = {
-		.name = &quot;arm-jtag-ew&quot;,
-
-		.commands = armjtagew_command_handlers,
-
-		.execute_queue = &amp;armjtagew_execute_queue,
-		.speed = &amp;armjtagew_speed,
-		.khz = &amp;armjtagew_khz,
-
-		.init = &amp;armjtagew_init,
-		.quit = &amp;armjtagew_quit,
-	};
+	.name = &quot;arm-jtag-ew&quot;,
+	.commands = armjtagew_command_handlers,
+
+	.execute_queue = armjtagew_execute_queue,
+	.speed = armjtagew_speed,
+	.khz = armjtagew_khz,
+	.init = armjtagew_init,
+	.quit = armjtagew_quit,
+};
 
 /***************************************************************************/
 /* ARM-JTAG-EW tap functions */
diff --git a/src/jtag/drivers/ft2232.c b/src/jtag/drivers/ft2232.c
index 06fc252..a3ac142 100644
--- a/src/jtag/drivers/ft2232.c
+++ b/src/jtag/drivers/ft2232.c
@@ -4018,12 +4018,13 @@ static const struct command_registration ft2232_command_handlers[] = {
 };
 
 struct jtag_interface ft2232_interface = {
-		.name = &quot;ft2232&quot;,
-		.commands = ft2232_command_handlers,
-		.init = &amp;ft2232_init,
-		.quit = &amp;ft2232_quit,
-		.speed = &amp;ft2232_speed,
-		.speed_div = &amp;ft2232_speed_div,
-		.khz = &amp;ft2232_khz,
-		.execute_queue = &amp;ft2232_execute_queue,
-	};
+	.name = &quot;ft2232&quot;,
+	.commands = ft2232_command_handlers,
+
+	.init = ft2232_init,
+	.quit = ft2232_quit,
+	.speed = ft2232_speed,
+	.speed_div = ft2232_speed_div,
+	.khz = ft2232_khz,
+	.execute_queue = ft2232_execute_queue,
+};
diff --git a/src/jtag/drivers/gw16012.c b/src/jtag/drivers/gw16012.c
index 9083e92..38e5dd7 100644
--- a/src/jtag/drivers/gw16012.c
+++ b/src/jtag/drivers/gw16012.c
@@ -574,10 +574,11 @@ static const struct command_registration gw16012_command_handlers[] = {
 };
 
 struct jtag_interface gw16012_interface = {
-		.name = &quot;gw16012&quot;,
-		.commands = gw16012_command_handlers,
-		.init = &amp;gw16012_init,
-		.quit = &amp;gw16012_quit,
-		.speed = &amp;gw16012_speed,
-		.execute_queue = &amp;gw16012_execute_queue,
-	};
+	.name = &quot;gw16012&quot;,
+	.commands = gw16012_command_handlers,
+
+	.init = gw16012_init,
+	.quit = gw16012_quit,
+	.speed = gw16012_speed,
+	.execute_queue = gw16012_execute_queue,
+};
diff --git a/src/jtag/drivers/jlink.c b/src/jtag/drivers/jlink.c
index 4ca4349..6596849 100644
--- a/src/jtag/drivers/jlink.c
+++ b/src/jtag/drivers/jlink.c
@@ -645,18 +645,16 @@ static const struct command_registration jlink_command_handlers[] = {
 };
 
 struct jtag_interface jlink_interface = {
-		.name = &quot;jlink&quot;,
-
-		.commands = jlink_command_handlers,
-
-		.execute_queue = &amp;jlink_execute_queue,
-		.speed = &amp;jlink_speed,
-		.speed_div = &amp;jlink_speed_div,
-		.khz = &amp;jlink_khz,
-
-		.init = &amp;jlink_init,
-		.quit = &amp;jlink_quit,
-	};
+	.name = &quot;jlink&quot;,
+	.commands = jlink_command_handlers,
+
+	.execute_queue = jlink_execute_queue,
+	.speed = jlink_speed,
+	.speed_div = jlink_speed_div,
+	.khz = jlink_khz,
+	.init = jlink_init,
+	.quit = jlink_quit,
+};
 
 /***************************************************************************/
 /* J-Link tap functions */
diff --git a/src/jtag/drivers/parport.c b/src/jtag/drivers/parport.c
index 04ac272..2e6b9ed 100644
--- a/src/jtag/drivers/parport.c
+++ b/src/jtag/drivers/parport.c
@@ -517,16 +517,13 @@ static const struct command_registration parport_command_handlers[] = {
 };
 
 struct jtag_interface parport_interface = {
-		.name = &quot;parport&quot;,
-
-		.commands = parport_command_handlers,
-
-		.init = &amp;parport_init,
-		.quit = &amp;parport_quit,
-
-		.khz = &amp;parport_khz,
-		.speed_div = &amp;parport_speed_div,
-		.speed = &amp;parport_speed,
-
-		.execute_queue = &amp;bitbang_execute_queue,
-	};
+	.name = &quot;parport&quot;,
+	.commands = parport_command_handlers,
+
+	.init = parport_init,
+	.quit = parport_quit,
+	.khz = parport_khz,
+	.speed_div = parport_speed_div,
+	.speed = parport_speed,
+	.execute_queue = bitbang_execute_queue,
+};
diff --git a/src/jtag/drivers/presto.c b/src/jtag/drivers/presto.c
index fac5e82..0baf561 100644
--- a/src/jtag/drivers/presto.c
+++ b/src/jtag/drivers/presto.c
@@ -786,15 +786,13 @@ static int presto_jtag_quit(void)
 }
 
 struct jtag_interface presto_interface = {
-		.name = &quot;presto&quot;,
-
-		.commands = presto_command_handlers,
-
-		.execute_queue = &amp;bitq_execute_queue,
-		.speed = &amp;presto_jtag_speed,
-		.khz = &amp;presto_jtag_khz,
-		.speed_div = &amp;presto_jtag_speed_div,
-
-		.init = &amp;presto_jtag_init,
-		.quit = &amp;presto_jtag_quit,
-	};
+	.name = &quot;presto&quot;,
+	.commands = presto_command_handlers,
+
+	.execute_queue = bitq_execute_queue,
+	.speed = presto_jtag_speed,
+	.khz = presto_jtag_khz,
+	.speed_div = presto_jtag_speed_div,
+	.init = presto_jtag_init,
+	.quit = presto_jtag_quit,
+};
diff --git a/src/jtag/drivers/usbprog.c b/src/jtag/drivers/usbprog.c
index f6d8a97..0d51b27 100644
--- a/src/jtag/drivers/usbprog.c
+++ b/src/jtag/drivers/usbprog.c
@@ -652,9 +652,10 @@ static void usbprog_jtag_tms_send(struct usbprog_jtag *usbprog_jtag)
 }
 
 struct jtag_interface usbprog_interface = {
-		.name = &quot;usbprog&quot;,
-		.execute_queue = &amp;usbprog_execute_queue,
-		.speed = &amp;usbprog_speed,
-		.init = &amp;usbprog_init,
-		.quit = &amp;usbprog_quit
-	};
+	.name = &quot;usbprog&quot;,
+
+	.execute_queue = usbprog_execute_queue,
+	.speed = usbprog_speed,
+	.init = usbprog_init,
+	.quit = usbprog_quit
+};
diff --git a/src/jtag/drivers/vsllink.c b/src/jtag/drivers/vsllink.c
index bbbb5f9..d301290 100644
--- a/src/jtag/drivers/vsllink.c
+++ b/src/jtag/drivers/vsllink.c
@@ -1891,13 +1891,13 @@ static const struct command_registration vsllink_command_handlers[] = {
 };
 
 struct jtag_interface vsllink_interface = {
-		.name = &quot;vsllink&quot;,
-		.commands = vsllink_command_handlers,
-
-		.init = &amp;vsllink_init,
-		.quit = &amp;vsllink_quit,
-		.khz = &amp;vsllink_khz,
-		.speed = &amp;vsllink_speed,
-		.speed_div = &amp;vsllink_speed_div,
-		.execute_queue = &amp;vsllink_execute_queue,
-	};
+	.name = &quot;vsllink&quot;,
+	.commands = vsllink_command_handlers,
+
+	.init = vsllink_init,
+	.quit = vsllink_quit,
+	.khz = vsllink_khz,
+	.speed = vsllink_speed,
+	.speed_div = vsllink_speed_div,
+	.execute_queue = vsllink_execute_queue,
+};

commit d9508b30e096b5cc44a4fdbf2d6b99ca173a43f1
Author: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;
Date:   Sun Jan 3 12:59:51 2010 -0800

    JTAG/drivers: amt_jtagaccel fixes + cleanup
    
    Build fixes:  it failed abysmally with PPDEV enabled.  Swapped
    a build-time error with a FIXME comment in the affected macros.
    
    Cleanup: remove &quot;&amp;&quot; before function pointers, and excess indent,
    for the interface struct declaration.
    
    Signed-off-by: David Brownell &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">dbrownell at users.sourceforge.net</A>&gt;

diff --git a/src/jtag/drivers/amt_jtagaccel.c b/src/jtag/drivers/amt_jtagaccel.c
index 8ba1583..de7cdcb 100644
--- a/src/jtag/drivers/amt_jtagaccel.c
+++ b/src/jtag/drivers/amt_jtagaccel.c
@@ -55,13 +55,41 @@ static int rtck_enabled = 0;
 #if PARPORT_USE_PPDEV == 1
 static int device_handle;
 
-static int addr_mode = IEEE1284_MODE_EPP | IEEE1284_ADDR ;
-#define AMT_AW(val)	do { ioctl(device_handle, PPSETMODE, &amp;addr_mode); write(device_handle, &amp;val, 1); } while (0)
-#define AMT_AR(val)	do { ioctl(device_handle, PPSETMODE, &amp;addr_mode); read(device_handle, &amp;val, 1); } while (0)
-
-static int data_mode = IEEE1284_MODE_EPP | IEEE1284_DATA ;
-#define AMT_DW(val)	do { ioctl(device_handle, PPSETMODE, &amp;data_mode); write(device_handle, &amp;val, 1); } while (0)
-#define AMT_DR(val)	do { ioctl(device_handle, PPSETMODE, &amp;data_mode); read(device_handle, &amp;val, 1); } while (0)
+static const int addr_mode = IEEE1284_MODE_EPP | IEEE1284_ADDR;
+
+/* FIXME do something sane when these ioctl/read/write calls fail. */
+
+#define AMT_AW(val) \
+	do { \
+		int __retval; \
+		\
+		__retval = ioctl(device_handle, PPSETMODE, &amp;addr_mode); \
+		__retval = write(device_handle, &amp;val, 1); \
+	} while (0)
+#define AMT_AR(val) \
+	do { \
+		int __retval; \
+		\
+		__retval = ioctl(device_handle, PPSETMODE, &amp;addr_mode); \
+		__retval = read(device_handle, &amp;val, 1); \
+	} while (0)
+
+static const int data_mode = IEEE1284_MODE_EPP | IEEE1284_DATA;
+
+#define AMT_DW(val) \
+	do { \
+		int __retval; \
+		\
+		__retval = ioctl(device_handle, PPSETMODE, &amp;data_mode); \
+		__retval = write(device_handle, &amp;val, 1); \
+	} while (0)
+#define AMT_DR(val) \
+	do { \
+		int __retval; \
+		\
+		__retval = ioctl(device_handle, PPSETMODE, &amp;data_mode); \
+		__retval = read(device_handle, &amp;val, 1); \
+	} while (0)
 
 #else
 
@@ -559,10 +587,11 @@ static const struct command_registration amtjtagaccel_command_handlers[] = {
 };
 
 struct jtag_interface amt_jtagaccel_interface = {
-		.name = &quot;amt_jtagaccel&quot;,
-		.commands = amtjtagaccel_command_handlers,
-		.init = &amp;amt_jtagaccel_init,
-		.quit = &amp;amt_jtagaccel_quit,
-		.speed = &amp;amt_jtagaccel_speed,
-		.execute_queue = &amp;amt_jtagaccel_execute_queue,
-	};
+	.name = &quot;amt_jtagaccel&quot;,
+	.commands = amtjtagaccel_command_handlers,
+
+	.init = amt_jtagaccel_init,
+	.quit = amt_jtagaccel_quit,
+	.speed = amt_jtagaccel_speed,
+	.execute_queue = amt_jtagaccel_execute_queue,
+};

-----------------------------------------------------------------------

Summary of changes:
 src/jtag/drivers/amt_jtagaccel.c |   57 ++++++++++++++++++++++++++++---------
 src/jtag/drivers/arm-jtag-ew.c   |   20 ++++++-------
 src/jtag/drivers/ft2232.c        |   19 ++++++------
 src/jtag/drivers/gw16012.c       |   15 +++++----
 src/jtag/drivers/jlink.c         |   22 ++++++--------
 src/jtag/drivers/parport.c       |   23 ++++++--------
 src/jtag/drivers/presto.c        |   22 ++++++--------
 src/jtag/drivers/usbprog.c       |   13 ++++----
 src/jtag/drivers/vsllink.c       |   20 ++++++------
 9 files changed, 117 insertions(+), 94 deletions(-)


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001995.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-37-g4ed5b45
</A></li>
	<LI>Next message: <A HREF="001997.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.4.0-rc1-40-g4aedb02
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1996">[ date ]</a>
              <a href="thread.html#1996">[ thread ]</a>
              <a href="subject.html#1996">[ subject ]</a>
              <a href="author.html#1996">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
