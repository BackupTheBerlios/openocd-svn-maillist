<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-637-gf74e2e0
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-637-gf74e2e0&In-Reply-To=%3CE1NDN3d-0000im-CF%40sfp-scmshell-3.v30.ch3.sourceforge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001861.html">
   <LINK REL="Next"  HREF="001863.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-637-gf74e2e0</H1>
    <B>Zach Welch</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-637-gf74e2e0&In-Reply-To=%3CE1NDN3d-0000im-CF%40sfp-scmshell-3.v30.ch3.sourceforge.com%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-637-gf74e2e0">zwelch at users.sourceforge.net
       </A><BR>
    <I>Wed Nov 25 19:57:40 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001861.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-615-g90d09e3
</A></li>
        <LI>Next message: <A HREF="001863.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-651-g4946925
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1862">[ date ]</a>
              <a href="thread.html#1862">[ thread ]</a>
              <a href="subject.html#1862">[ subject ]</a>
              <a href="author.html#1862">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  f74e2e033a2ad082e5bef67d0ddedd1db3f58300 (commit)
       via  66ee303456910f684244a20a0ac2e958d40b78cb (commit)
       via  144e3678bd2d518388b6c2d7f3d2a912a9ac2abd (commit)
       via  8a41656391bd8eb6854c8573920d1155d815966b (commit)
       via  5f6962b34f623e7daf0dfb1f6249620431b5ab79 (commit)
       via  4e67912fb01a0ab60c246c12c7ce50e361dd3e20 (commit)
       via  c3800b5e674be3a9e1c7976925f9cfc52cba3ad5 (commit)
       via  a17caa387c0fb08ee2604e066b436d90d9cf0a2f (commit)
       via  dd063d99147ff08ad817fc3fbd306425b6933d8d (commit)
       via  8161fd3163142f828a0bd79e0b5ad339dc4aec6b (commit)
       via  97fbd793b3a4edec490b2b034f7b6fe5261ca03e (commit)
       via  28300bbf6ff726fe1ab807fa9796241bb3348cfd (commit)
       via  df95fe25a4f01db9e131272ee72ebbf328ede428 (commit)
       via  d79176e1bc4699a52663b87dc52f02fb7afa3d54 (commit)
       via  84c03168a54549e2a102ceb25219ac8a2281d954 (commit)
       via  d1eca9a74c7c57ba6a3210c51b2a10cc5adb22e1 (commit)
       via  69908ddbd04fc9382d02819e296bb4384ef78810 (commit)
       via  11061486b5e18b43cca6a94bdd9e998d5dde44c4 (commit)
       via  509fe82b07df4a7e6217bfde37374e90262aa2de (commit)
       via  e232dea176cc8c831e77a10903120ff057337f6c (commit)
       via  e905fe6e756453daf27cd064285aa9cddf31b1ef (commit)
       via  b40f265f9cb9e6be4c979e7f4e10072822dcb5c7 (commit)
      from  90d09e35e4be6f0b35899238b253154249f85cb6 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit f74e2e033a2ad082e5bef67d0ddedd1db3f58300
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 08:24:02 2009 -0800

    remove register_commands from etm_capture_driver
    
    Converts callback to an array of command_registration records.
    Moves oocd_trace driver definition to end of file to eliminate
    useless forward declaration.

diff --git a/src/target/etb.c b/src/target/etb.c
index 63dee18..bc0e1bf 100644
--- a/src/target/etb.c
+++ b/src/target/etb.c
@@ -421,11 +421,6 @@ static const struct command_registration etb_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int etb_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, etb_command_handlers);
-}
-
 static int etb_init(struct etm_context *etm_ctx)
 {
 	struct etb *etb = etm_ctx-&gt;capture_driver_priv;
@@ -696,7 +691,7 @@ static int etb_stop_capture(struct etm_context *etm_ctx)
 struct etm_capture_driver etb_capture_driver =
 {
 	.name = &quot;etb&quot;,
-	.register_commands = etb_register_commands,
+	.commands = etb_command_handlers,
 	.init = etb_init,
 	.status = etb_status,
 	.start_capture = etb_start_capture,
diff --git a/src/target/etm.c b/src/target/etm.c
index 2465d5c..4e7f917 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -1471,8 +1471,9 @@ COMMAND_HANDLER(handle_etm_config_command)
 	{
 		if (strcmp(CMD_ARGV[4], etm_capture_drivers[i]-&gt;name) == 0)
 		{
-			int retval;
-			if ((retval = etm_capture_drivers[i]-&gt;register_commands(CMD_CTX)) != ERROR_OK)
+			int retval = register_commands(CMD_CTX, NULL,
+					etm_capture_drivers[i]-&gt;commands);
+			if (ERROR_OK != retval)
 			{
 				free(etm_ctx);
 				return retval;
diff --git a/src/target/etm.h b/src/target/etm.h
index 05e5495..c8da794 100644
--- a/src/target/etm.h
+++ b/src/target/etm.h
@@ -126,7 +126,7 @@ struct etm_context;
 struct etm_capture_driver
 {
 	char *name;
-	int (*register_commands)(struct command_context *cmd_ctx);
+	const struct command_registration *commands;
 	int (*init)(struct etm_context *etm_ctx);
 	trace_status_t (*status)(struct etm_context *etm_ctx);
 	int (*read_trace)(struct etm_context *etm_ctx);
diff --git a/src/target/etm_dummy.c b/src/target/etm_dummy.c
index 27a8eec..647774f 100644
--- a/src/target/etm_dummy.c
+++ b/src/target/etm_dummy.c
@@ -77,11 +77,6 @@ static const struct command_registration etm_dummy_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int etm_dummy_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, etm_dummy_command_handlers);
-}
-
 static int etm_dummy_init(struct etm_context *etm_ctx)
 {
 	return ERROR_OK;
@@ -110,7 +105,7 @@ static int etm_dummy_stop_capture(struct etm_context *etm_ctx)
 struct etm_capture_driver etm_dummy_capture_driver =
 {
 	.name = &quot;dummy&quot;,
-	.register_commands = etm_dummy_register_commands,
+	.commands = etm_dummy_command_handlers,
 	.init = etm_dummy_init,
 	.status = etm_dummy_status,
 	.start_capture = etm_dummy_start_capture,
diff --git a/src/target/oocd_trace.c b/src/target/oocd_trace.c
index a34c63c..ac79f18 100644
--- a/src/target/oocd_trace.c
+++ b/src/target/oocd_trace.c
@@ -30,8 +30,6 @@
  */
 
 
-static int oocd_trace_register_commands(struct command_context *cmd_ctx);
-
 static int oocd_trace_read_reg(struct oocd_trace *oocd_trace, int reg, uint32_t *value)
 {
 	size_t bytes_written, bytes_read, bytes_to_read;
@@ -278,17 +276,6 @@ static int oocd_trace_stop_capture(struct etm_context *etm_ctx)
 	return ERROR_OK;
 }
 
-struct etm_capture_driver oocd_trace_capture_driver =
-{
-	.name = &quot;oocd_trace&quot;,
-	.register_commands = oocd_trace_register_commands,
-	.init = oocd_trace_init,
-	.status = oocd_trace_status,
-	.start_capture = oocd_trace_start_capture,
-	.stop_capture = oocd_trace_stop_capture,
-	.read_trace = oocd_trace_read_trace,
-};
-
 COMMAND_HANDLER(handle_oocd_trace_config_command)
 {
 	struct target *target;
@@ -438,7 +425,15 @@ static const struct command_registration oocd_trace_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-int oocd_trace_register_commands(struct command_context *cmd_ctx)
+struct etm_capture_driver oocd_trace_capture_driver =
 {
-	return register_commands(cmd_ctx, NULL, oocd_trace_command_handlers);
-}
+	.name = &quot;oocd_trace&quot;,
+	.commands = oocd_trace_command_handlers,
+	.init = oocd_trace_init,
+	.status = oocd_trace_status,
+	.start_capture = oocd_trace_start_capture,
+	.stop_capture = oocd_trace_stop_capture,
+	.read_trace = oocd_trace_read_trace,
+};
+
+

commit 66ee303456910f684244a20a0ac2e958d40b78cb
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 08:17:01 2009 -0800

    remove target_type register_command callback
    
    Uses chaining of command_registration structures to eliminate all
    target_type register_callback routines.  Exports the command_handler
    registration arrays for those target types that are used by others.

diff --git a/src/target/arm11.c b/src/target/arm11.c
index 835234c..7c6d39c 100644
--- a/src/target/arm11.c
+++ b/src/target/arm11.c
@@ -1617,6 +1617,12 @@ static const struct command_registration arm11_any_command_handlers[] = {
 };
 static const struct command_registration arm11_command_handlers[] = {
 	{
+		.chain = arm_command_handlers,
+	},
+	{
+		.chain = etm_command_handlers,
+	},
+	{
 		.name = &quot;arm11&quot;,
 		.mode = COMMAND_ANY,
 		.help = &quot;ARM11 command group&quot;,
@@ -1625,13 +1631,6 @@ static const struct command_registration arm11_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int arm11_register_commands(struct command_context *cmd_ctx)
-{
-	armv4_5_register_commands(cmd_ctx);
-	etm_register_commands(cmd_ctx);
-	return register_commands(cmd_ctx, NULL, arm11_command_handlers);
-}
-
 /** Holds methods for ARM11xx targets. */
 struct target_type arm11_target = {
 	.name =			&quot;arm11&quot;,
@@ -1666,7 +1665,7 @@ struct target_type arm11_target = {
 
 	.run_algorithm =	armv4_5_run_algorithm,
 
-	.register_commands =	arm11_register_commands,
+	.commands =		arm11_command_handlers,
 	.target_create =	arm11_target_create,
 	.init_target =		arm11_init_target,
 	.examine =		arm11_examine,
diff --git a/src/target/arm720t.c b/src/target/arm720t.c
index 52a311c..bae2561 100644
--- a/src/target/arm720t.c
+++ b/src/target/arm720t.c
@@ -504,6 +504,9 @@ static const struct command_registration arm720t_exec_command_handlers[] = {
 
 static const struct command_registration arm720t_command_handlers[] = {
 	{
+		.chain = arm7_9_command_handlers,
+	},
+	{
 		.name = &quot;arm720t&quot;,
 		.mode = COMMAND_ANY,
 		.help = &quot;arm720t command group&quot;,
@@ -512,12 +515,6 @@ static const struct command_registration arm720t_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int arm720t_register_commands(struct command_context *cmd_ctx)
-{
-	arm7_9_register_commands(cmd_ctx);
-	return register_commands(cmd_ctx, NULL, arm720t_command_handlers);
-}
-
 /** Holds methods for ARM720 targets. */
 struct target_type arm720t_target =
 {
@@ -555,7 +552,7 @@ struct target_type arm720t_target =
 	.add_watchpoint = arm7_9_add_watchpoint,
 	.remove_watchpoint = arm7_9_remove_watchpoint,
 
-	.register_commands = arm720t_register_commands,
+	.commands = arm720t_command_handlers,
 	.target_create = arm720t_target_create,
 	.init_target = arm720t_init_target,
 	.examine = arm7_9_examine,
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index b40be8d..c4775e8 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2873,7 +2873,13 @@ static const struct command_registration arm7_9_any_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-static const struct command_registration arm7_9_command_handlers[] = {
+const struct command_registration arm7_9_command_handlers[] = {
+	{
+		.chain = arm_command_handlers,
+	},
+	{
+		.chain = etm_command_handlers,
+	},
 	{
 		.name = &quot;arm7_9&quot;,
 		.mode = COMMAND_ANY,
@@ -2882,10 +2888,3 @@ static const struct command_registration arm7_9_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-
-int arm7_9_register_commands(struct command_context *cmd_ctx)
-{
-	armv4_5_register_commands(cmd_ctx);
-	etm_register_commands(cmd_ctx);
-	return register_commands(cmd_ctx, NULL, arm7_9_command_handlers);
-}
diff --git a/src/target/arm7_9_common.h b/src/target/arm7_9_common.h
index 2f7132a..d43eaa6 100644
--- a/src/target/arm7_9_common.h
+++ b/src/target/arm7_9_common.h
@@ -120,7 +120,7 @@ static inline bool is_arm7_9(struct arm7_9_common *arm7_9)
 	return arm7_9-&gt;common_magic == ARM7_9_COMMON_MAGIC;
 }
 
-int arm7_9_register_commands(struct command_context *cmd_ctx);
+extern const struct command_registration arm7_9_command_handlers[];
 
 int arm7_9_poll(struct target *target);
 
diff --git a/src/target/arm7tdmi.c b/src/target/arm7tdmi.c
index 742eace..7d14ed6 100644
--- a/src/target/arm7tdmi.c
+++ b/src/target/arm7tdmi.c
@@ -747,7 +747,7 @@ struct target_type arm7tdmi_target =
 	.add_watchpoint = arm7_9_add_watchpoint,
 	.remove_watchpoint = arm7_9_remove_watchpoint,
 
-	.register_commands  = arm7_9_register_commands,
+	.commands  = arm7_9_command_handlers,
 	.target_create  = arm7tdmi_target_create,
 	.init_target = arm7tdmi_init_target,
 	.examine = arm7_9_examine,
diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index 1e6019c..e6c2eed 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -1396,7 +1396,10 @@ static const struct command_registration arm920t_exec_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-static const struct command_registration arm920t_command_handlers[] = {
+const struct command_registration arm920t_command_handlers[] = {
+	{
+		.chain = arm9tdmi_command_handlers,
+	},
 	{
 		.name = &quot;arm920t&quot;,
 		.mode = COMMAND_ANY,
@@ -1406,13 +1409,6 @@ static const struct command_registration arm920t_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-/** Registers commands to access coprocessor, cache, and MMU resources. */
-int arm920t_register_commands(struct command_context *cmd_ctx)
-{
-	arm9tdmi_register_commands(cmd_ctx);
-	return register_commands(cmd_ctx, NULL, arm920t_command_handlers);
-}
-
 /** Holds methods for ARM920 targets. */
 struct target_type arm920t_target =
 {
@@ -1452,7 +1448,7 @@ struct target_type arm920t_target =
 	.add_watchpoint = arm7_9_add_watchpoint,
 	.remove_watchpoint = arm7_9_remove_watchpoint,
 
-	.register_commands = arm920t_register_commands,
+	.commands = arm920t_command_handlers,
 	.target_create = arm920t_target_create,
 	.init_target = arm9tdmi_init_target,
 	.examine = arm7_9_examine,
diff --git a/src/target/arm920t.h b/src/target/arm920t.h
index ca6be7e..a75f01a 100644
--- a/src/target/arm920t.h
+++ b/src/target/arm920t.h
@@ -71,6 +71,7 @@ void arm920t_disable_mmu_caches(struct target *target,
 	int mmu, int d_u_cache, int i_cache);
 void arm920t_enable_mmu_caches(struct target *target,
 	int mmu, int d_u_cache, int i_cache);
-int arm920t_register_commands(struct command_context *cmd_ctx);
+
+extern const struct command_registration arm920t_command_handlers[];
 
 #endif /* ARM920T_H */
diff --git a/src/target/arm926ejs.c b/src/target/arm926ejs.c
index 329aa12..408ede9 100644
--- a/src/target/arm926ejs.c
+++ b/src/target/arm926ejs.c
@@ -766,7 +766,10 @@ static const struct command_registration arm926ejs_exec_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-static const struct command_registration arm926ejs_command_handlers[] = {
+const struct command_registration arm926ejs_command_handlers[] = {
+	{
+		.chain = arm9tdmi_command_handlers,
+	},
 	{
 		.name = &quot;arm926ejs&quot;,
 		.mode = COMMAND_ANY,
@@ -776,13 +779,6 @@ static const struct command_registration arm926ejs_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-/** Registers commands to access coprocessor, cache, and debug resources.  */
-int arm926ejs_register_commands(struct command_context *cmd_ctx)
-{
-	arm9tdmi_register_commands(cmd_ctx);
-	return register_commands(cmd_ctx, NULL, arm926ejs_command_handlers);
-}
-
 /** Holds methods for ARM926 targets. */
 struct target_type arm926ejs_target =
 {
@@ -817,7 +813,7 @@ struct target_type arm926ejs_target =
 	.add_watchpoint = arm7_9_add_watchpoint,
 	.remove_watchpoint = arm7_9_remove_watchpoint,
 
-	.register_commands = arm926ejs_register_commands,
+	.commands = arm926ejs_command_handlers,
 	.target_create = arm926ejs_target_create,
 	.init_target = arm9tdmi_init_target,
 	.examine = arm7_9_examine,
diff --git a/src/target/arm926ejs.h b/src/target/arm926ejs.h
index 514f054..274733b 100644
--- a/src/target/arm926ejs.h
+++ b/src/target/arm926ejs.h
@@ -48,10 +48,11 @@ target_to_arm926(struct target *target)
 
 int arm926ejs_init_arch_info(struct target *target,
 		struct arm926ejs_common *arm926ejs, struct jtag_tap *tap);
-int arm926ejs_register_commands(struct command_context *cmd_ctx);
 int arm926ejs_arch_state(struct target *target);
 int arm926ejs_write_memory(struct target *target,
 		uint32_t address, uint32_t size, uint32_t count, uint8_t *buffer);
 int arm926ejs_soft_reset_halt(struct target *target);
 
+extern const struct command_registration arm926ejs_command_handlers[];
+
 #endif /* ARM926EJS_H */
diff --git a/src/target/arm966e.c b/src/target/arm966e.c
index 70cc3c4..9fe513c 100644
--- a/src/target/arm966e.c
+++ b/src/target/arm966e.c
@@ -232,7 +232,10 @@ static const struct command_registration arm966e_exec_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static const struct command_registration arm966e_command_handlers[] = {
+const struct command_registration arm966e_command_handlers[] = {
+	{
+		.chain = arm9tdmi_command_handlers,
+	},
 	{
 		.name = &quot;arm966e&quot;,
 		.mode = COMMAND_ANY,
@@ -242,13 +245,6 @@ static const struct command_registration arm966e_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-/** Registers commands used to access coprocessor resources. */
-int arm966e_register_commands(struct command_context *cmd_ctx)
-{
-	arm9tdmi_register_commands(cmd_ctx);
-	return register_commands(cmd_ctx, NULL, arm966e_command_handlers);
-}
-
 /** Holds methods for ARM966 targets. */
 struct target_type arm966e_target =
 {
@@ -283,7 +279,7 @@ struct target_type arm966e_target =
 	.add_watchpoint = arm7_9_add_watchpoint,
 	.remove_watchpoint = arm7_9_remove_watchpoint,
 
-	.register_commands = arm966e_register_commands,
+	.commands = arm966e_command_handlers,
 	.target_create = arm966e_target_create,
 	.init_target = arm9tdmi_init_target,
 	.examine = arm7_9_examine,
diff --git a/src/target/arm966e.h b/src/target/arm966e.h
index 45aeb4e..24dcec3 100644
--- a/src/target/arm966e.h
+++ b/src/target/arm966e.h
@@ -43,7 +43,8 @@ target_to_arm966(struct target *target)
 
 int arm966e_init_arch_info(struct target *target,
 		struct arm966e_common *arm966e, struct jtag_tap *tap);
-int arm966e_register_commands(struct command_context *cmd_ctx);
 int arm966e_write_cp15(struct target *target, int reg_addr, uint32_t value);
 
+extern const struct command_registration arm966e_command_handlers[];
+
 #endif /* ARM966E_H */
diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index 87ace05..7eb5641 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -917,7 +917,10 @@ static const struct command_registration arm9tdmi_exec_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-static const struct command_registration arm9tdmi_command_handlers[] = {
+const struct command_registration arm9tdmi_command_handlers[] = {
+	{
+		.chain = arm7_9_command_handlers,
+	},
 	{
 		.name = &quot;arm9tdmi&quot;,
 		.mode = COMMAND_ANY,
@@ -927,12 +930,6 @@ static const struct command_registration arm9tdmi_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-int arm9tdmi_register_commands(struct command_context *cmd_ctx)
-{
-	arm7_9_register_commands(cmd_ctx);
-	return register_commands(cmd_ctx, NULL, arm9tdmi_command_handlers);
-}
-
 /** Holds methods for ARM9TDMI targets. */
 struct target_type arm9tdmi_target =
 {
@@ -967,7 +964,7 @@ struct target_type arm9tdmi_target =
 	.add_watchpoint = arm7_9_add_watchpoint,
 	.remove_watchpoint = arm7_9_remove_watchpoint,
 
-	.register_commands = arm9tdmi_register_commands,
+	.commands = arm9tdmi_command_handlers,
 	.target_create = arm9tdmi_target_create,
 	.init_target = arm9tdmi_init_target,
 	.examine = arm7_9_examine,
diff --git a/src/target/arm9tdmi.h b/src/target/arm9tdmi.h
index 351b00a..aff9fc5 100644
--- a/src/target/arm9tdmi.h
+++ b/src/target/arm9tdmi.h
@@ -29,7 +29,7 @@ int arm9tdmi_init_target(struct command_context *cmd_ctx,
 		struct target *target);
 int arm9tdmi_init_arch_info(struct target *target,
 		struct arm7_9_common *arm7_9, struct jtag_tap *tap);
-int arm9tdmi_register_commands(struct command_context *cmd_ctx);
+extern const struct command_registration arm9tdmi_command_handlers[];
 
 int arm9tdmi_clock_out(struct arm_jtag *jtag_info,
 		uint32_t instr, uint32_t out, uint32_t *in, int sysspeed);
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index dfb7094..7e5bb0a 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -809,7 +809,7 @@ static const struct command_registration arm_exec_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-static const struct command_registration arm_command_handlers[] = {
+const struct command_registration arm_command_handlers[] = {
 	{
 		.name = &quot;arm&quot;,
 		.mode = COMMAND_ANY,
@@ -819,11 +819,6 @@ static const struct command_registration arm_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-int armv4_5_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, arm_command_handlers);
-}
-
 int armv4_5_get_gdb_reg_list(struct target *target, struct reg **reg_list[], int *reg_list_size)
 {
 	struct arm *armv4_5 = target_to_armv4_5(target);
diff --git a/src/target/armv4_5.h b/src/target/armv4_5.h
index 7a6cb61..822d143 100644
--- a/src/target/armv4_5.h
+++ b/src/target/armv4_5.h
@@ -27,6 +27,8 @@
 #define ARMV4_5_H
 
 #include &quot;target.h&quot;
+#include &quot;command.h&quot;
+
 
 typedef enum armv4_5_mode
 {
@@ -155,7 +157,8 @@ int armv4_5_arch_state(struct target *target);
 int armv4_5_get_gdb_reg_list(struct target *target,
 		struct reg **reg_list[], int *reg_list_size);
 
-int armv4_5_register_commands(struct command_context *cmd_ctx);
+extern const struct command_registration arm_command_handlers[];
+
 int armv4_5_init_arch_info(struct target *target, struct arm *armv4_5);
 
 int armv4_5_run_algorithm(struct target *target,
diff --git a/src/target/armv7a.c b/src/target/armv7a.c
index 7cc2273..3d94329 100644
--- a/src/target/armv7a.c
+++ b/src/target/armv7a.c
@@ -181,7 +181,7 @@ static const struct command_registration armv7a_exec_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-static const struct command_registration armv7a_command_handlers[] = {
+const struct command_registration armv7a_command_handlers[] = {
 	{
 		.name = &quot;dap&quot;,
 		.mode = COMMAND_ANY,
@@ -191,7 +191,3 @@ static const struct command_registration armv7a_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-int armv7a_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, armv7a_command_handlers);
-}
diff --git a/src/target/armv7a.h b/src/target/armv7a.h
index 942bf8b..f843f03 100644
--- a/src/target/armv7a.h
+++ b/src/target/armv7a.h
@@ -103,7 +103,8 @@ struct armv7a_core_reg
 int armv7a_arch_state(struct target *target);
 struct reg_cache *armv7a_build_reg_cache(struct target *target,
 		struct armv7a_common *armv7a_common);
-int armv7a_register_commands(struct command_context *cmd_ctx);
 int armv7a_init_arch_info(struct target *target, struct armv7a_common *armv7a);
 
+extern const struct command_registration armv7a_command_handlers[];
+
 #endif /* ARMV4_5_H */
diff --git a/src/target/armv7m.c b/src/target/armv7m.c
index 6d8ad5f..9d89086 100644
--- a/src/target/armv7m.c
+++ b/src/target/armv7m.c
@@ -832,7 +832,7 @@ static const struct command_registration armv7m_exec_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-static const struct command_registration armv7m_command_handlers[] = {
+const struct command_registration armv7m_command_handlers[] = {
 	{
 		.name = &quot;dap&quot;,
 		.mode = COMMAND_ANY,
@@ -841,8 +841,3 @@ static const struct command_registration armv7m_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-
-int armv7m_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, armv7m_command_handlers);
-}
diff --git a/src/target/armv7m.h b/src/target/armv7m.h
index 9dd4ddb..7299bdf 100644
--- a/src/target/armv7m.h
+++ b/src/target/armv7m.h
@@ -143,7 +143,6 @@ int armv7m_arch_state(struct target *target);
 int armv7m_get_gdb_reg_list(struct target *target,
 		struct reg **reg_list[], int *reg_list_size);
 
-int armv7m_register_commands(struct command_context *cmd_ctx);
 int armv7m_init_arch_info(struct target *target, struct armv7m_common *armv7m);
 
 int armv7m_run_algorithm(struct target *target,
@@ -161,6 +160,8 @@ int armv7m_checksum_memory(struct target *target,
 int armv7m_blank_check_memory(struct target *target,
 		uint32_t address, uint32_t count, uint32_t* blank);
 
+extern const struct command_registration armv7m_command_handlers[];
+
 /* Thumb mode instructions
  */
 
diff --git a/src/target/avrt.c b/src/target/avrt.c
index cabb272..dc527f5 100644
--- a/src/target/avrt.c
+++ b/src/target/avrt.c
@@ -28,9 +28,6 @@
 
 #define AVR_JTAG_INS_LEN	4
 
-/* cli handling */
-int avr_register_commands(struct command_context *cmd_ctx);
-
 /* forward declarations */
 int avr_target_create(struct target *target, Jim_Interp *interp);
 int avr_init_target(struct command_context *cmd_ctx, struct target *target);
@@ -91,17 +88,10 @@ struct target_type avr_target =
 	.add_watchpoint = avr_add_watchpoint,
 	.remove_watchpoint = avr_remove_watchpoint,
 */
-	.register_commands = avr_register_commands,
 	.target_create = avr_target_create,
 	.init_target = avr_init_target,
 };
 
-int avr_register_commands(struct command_context *cmd_ctx)
-{
-	LOG_DEBUG(&quot;%s&quot;, __FUNCTION__);
-	return ERROR_OK;
-}
-
 int avr_target_create(struct target *target, Jim_Interp *interp)
 {
 	struct avr_common *avr = calloc(1, sizeof(struct avr_common));
diff --git a/src/target/cortex_a8.c b/src/target/cortex_a8.c
index 325a54b..b85481a 100644
--- a/src/target/cortex_a8.c
+++ b/src/target/cortex_a8.c
@@ -1642,6 +1642,12 @@ static const struct command_registration cortex_a8_exec_command_handlers[] = {
 };
 static const struct command_registration cortex_a8_command_handlers[] = {
 	{
+		.chain = arm_command_handlers,
+	},
+	{
+		.chain = armv7a_command_handlers,
+	},
+	{
 		.name = &quot;cortex_a8&quot;,
 		.mode = COMMAND_ANY,
 		.help = &quot;Cortex-A8 command group&quot;,
@@ -1650,13 +1656,6 @@ static const struct command_registration cortex_a8_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int cortex_a8_register_commands(struct command_context *cmd_ctx)
-{
-	armv4_5_register_commands(cmd_ctx);
-	armv7a_register_commands(cmd_ctx);
-	return register_commands(cmd_ctx, NULL, cortex_a8_command_handlers);
-}
-
 struct target_type cortexa8_target = {
 	.name = &quot;cortex_a8&quot;,
 
@@ -1689,7 +1688,7 @@ struct target_type cortexa8_target = {
 	.add_watchpoint = NULL,
 	.remove_watchpoint = NULL,
 
-	.register_commands = cortex_a8_register_commands,
+	.commands = cortex_a8_command_handlers,
 	.target_create = cortex_a8_target_create,
 	.init_target = cortex_a8_init_target,
 	.examine = cortex_a8_examine,
diff --git a/src/target/cortex_m3.c b/src/target/cortex_m3.c
index be81af9..7cfe540 100644
--- a/src/target/cortex_m3.c
+++ b/src/target/cortex_m3.c
@@ -1938,6 +1938,12 @@ static const struct command_registration cortex_m3_exec_command_handlers[] = {
 };
 static const struct command_registration cortex_m3_command_handlers[] = {
 	{
+		.chain = arm_command_handlers,
+	},
+	{
+		.chain = armv7m_command_handlers,
+	},
+	{
 		.name = &quot;cortex_m3&quot;,
 		.mode = COMMAND_ANY,
 		.help = &quot;Cortex-M3 command group&quot;,
@@ -1946,12 +1952,6 @@ static const struct command_registration cortex_m3_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int cortex_m3_register_commands(struct command_context *cmd_ctx)
-{
-	armv7m_register_commands(cmd_ctx);
-	return register_commands(cmd_ctx, NULL, cortex_m3_command_handlers);
-}
-
 struct target_type cortexm3_target =
 {
 	.name = &quot;cortex_m3&quot;,
@@ -1984,7 +1984,7 @@ struct target_type cortexm3_target =
 	.add_watchpoint = cortex_m3_add_watchpoint,
 	.remove_watchpoint = cortex_m3_remove_watchpoint,
 
-	.register_commands = cortex_m3_register_commands,
+	.commands = cortex_m3_command_handlers,
 	.target_create = cortex_m3_target_create,
 	.init_target = cortex_m3_init_target,
 	.examine = cortex_m3_examine,
diff --git a/src/target/etm.c b/src/target/etm.c
index 0f7b41e..2465d5c 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -2103,7 +2103,7 @@ static const struct command_registration etm_config_command_handlers[] = {
 	},
 	COMMAND_REGISTRATION_DONE
 };
-static const struct command_registration etm_command_handlers[] = {
+const struct command_registration etm_command_handlers[] = {
 	{
 		.name = &quot;etm&quot;,
 		.mode = COMMAND_ANY,
@@ -2113,11 +2113,6 @@ static const struct command_registration etm_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-int etm_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, etm_command_handlers);
-}
-
 static const struct command_registration etm_exec_command_handlers[] = {
 	{
 		.name = &quot;tracemode&quot;, handle_etm_tracemode_command,
diff --git a/src/target/etm.h b/src/target/etm.h
index b74c6d9..05e5495 100644
--- a/src/target/etm.h
+++ b/src/target/etm.h
@@ -212,7 +212,7 @@ struct reg_cache* etm_build_reg_cache(struct target *target,
 
 int etm_setup(struct target *target);
 
-int etm_register_commands(struct command_context *cmd_ctx);
+extern const struct command_registration etm_command_handlers[];
 
 #define ERROR_ETM_INVALID_DRIVER	(-1300)
 #define ERROR_ETM_PORTMODE_NOT_SUPPORTED	(-1301)
diff --git a/src/target/fa526.c b/src/target/fa526.c
index 9c22a75..32469d0 100644
--- a/src/target/fa526.c
+++ b/src/target/fa526.c
@@ -385,7 +385,7 @@ struct target_type fa526_target =
 	.add_watchpoint = arm7_9_add_watchpoint,
 	.remove_watchpoint = arm7_9_remove_watchpoint,
 
-	.register_commands = arm920t_register_commands,
+	.commands = arm920t_command_handlers,
 	.target_create = fa526_target_create,
 	.init_target = arm9tdmi_init_target,
 	.examine = arm7_9_examine,
diff --git a/src/target/feroceon.c b/src/target/feroceon.c
index 8c05276..432d49d 100644
--- a/src/target/feroceon.c
+++ b/src/target/feroceon.c
@@ -709,7 +709,7 @@ struct target_type feroceon_target =
 	.add_watchpoint = arm7_9_add_watchpoint,
 	.remove_watchpoint = arm7_9_remove_watchpoint,
 
-	.register_commands = arm926ejs_register_commands,
+	.commands = arm926ejs_command_handlers,
 	.target_create = feroceon_target_create,
 	.init_target = feroceon_init_target,
 	.examine = feroceon_examine,
@@ -748,7 +748,7 @@ struct target_type dragonite_target =
 	.add_watchpoint = arm7_9_add_watchpoint,
 	.remove_watchpoint = arm7_9_remove_watchpoint,
 
-	.register_commands = arm966e_register_commands,
+	.commands = arm966e_command_handlers,
 	.target_create = dragonite_target_create,
 	.init_target = feroceon_init_target,
 	.examine = feroceon_examine,
diff --git a/src/target/mips32.c b/src/target/mips32.c
index 0b8ebb4..48d0720 100644
--- a/src/target/mips32.c
+++ b/src/target/mips32.c
@@ -320,11 +320,6 @@ int mips32_init_arch_info(struct target *target, struct mips32_common *mips32, s
 	return ERROR_OK;
 }
 
-int mips32_register_commands(struct command_context *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 int mips32_run_algorithm(struct target *target, int num_mem_params, struct mem_param *mem_params, int num_reg_params, struct reg_param *reg_params, uint32_t entry_point, uint32_t exit_point, int timeout_ms, void *arch_info)
 {
 	/*TODO*/
diff --git a/src/target/mips_m4k.c b/src/target/mips_m4k.c
index 0a566c3..a83217f 100644
--- a/src/target/mips_m4k.c
+++ b/src/target/mips_m4k.c
@@ -41,7 +41,6 @@ int mips_m4k_resume(struct target *target, int current, uint32_t address, int ha
 int mips_m4k_step(struct target *target, int current, uint32_t address, int handle_breakpoints);
 int mips_m4k_read_memory(struct target *target, uint32_t address, uint32_t size, uint32_t count, uint8_t *buffer);
 int mips_m4k_write_memory(struct target *target, uint32_t address, uint32_t size, uint32_t count, uint8_t *buffer);
-int mips_m4k_register_commands(struct command_context *cmd_ctx);
 int mips_m4k_init_target(struct command_context *cmd_ctx, struct target *target);
 int mips_m4k_target_create(struct target *target, Jim_Interp *interp);
 
@@ -82,7 +81,6 @@ struct target_type mips_m4k_target =
 	.add_watchpoint = mips_m4k_add_watchpoint,
 	.remove_watchpoint = mips_m4k_remove_watchpoint,
 
-	.register_commands = mips_m4k_register_commands,
 	.target_create = mips_m4k_target_create,
 	.init_target = mips_m4k_init_target,
 	.examine = mips_m4k_examine,
@@ -902,14 +900,6 @@ int mips_m4k_write_memory(struct target *target, uint32_t address, uint32_t size
 		return mips32_dmaacc_write_mem(ejtag_info, address, size, count, (void *)buffer);
 }
 
-int mips_m4k_register_commands(struct command_context *cmd_ctx)
-{
-	int retval;
-
-	retval = mips32_register_commands(cmd_ctx);
-	return retval;
-}
-
 int mips_m4k_init_target(struct command_context *cmd_ctx, struct target *target)
 {
 	mips32_build_reg_cache(target);
diff --git a/src/target/target.c b/src/target/target.c
index 6f48808..e999e68 100644
--- a/src/target/target.c
+++ b/src/target/target.c
@@ -4353,9 +4353,14 @@ static int target_create(Jim_GetOptInfo *goi)
 	if (!target-&gt;variant)
 		target-&gt;variant = strdup(&quot;&quot;);
 
+	cp = Jim_GetString(new_cmd, NULL);
+	target-&gt;cmd_name = strdup(cp);
+
 	/* create the target specific commands */
-	if (target-&gt;type-&gt;register_commands) {
-		(*(target-&gt;type-&gt;register_commands))(cmd_ctx);
+	if (target-&gt;type-&gt;commands) {
+		e = register_commands(cmd_ctx, NULL, target-&gt;type-&gt;commands);
+		if (ERROR_OK != e)
+			LOG_ERROR(&quot;unable to register '%s' commands&quot;, cp);
 	}
 	if (target-&gt;type-&gt;target_create) {
 		(*(target-&gt;type-&gt;target_create))(target, goi-&gt;interp);
@@ -4371,9 +4376,6 @@ static int target_create(Jim_GetOptInfo *goi)
 		*tpp = target;
 	}
 
-	cp = Jim_GetString(new_cmd, NULL);
-	target-&gt;cmd_name = strdup(cp);
-
 	/* now - create the new target name command */
 	e = Jim_CreateCommand(goi-&gt;interp,
 						   /* name */
diff --git a/src/target/target_type.h b/src/target/target_type.h
index aa87a74..9a0709d 100644
--- a/src/target/target_type.h
+++ b/src/target/target_type.h
@@ -148,7 +148,7 @@ struct target_type
 	 */
 	int (*run_algorithm)(struct target *target, int num_mem_params, struct mem_param *mem_params, int num_reg_params, struct reg_param *reg_param, uint32_t entry_point, uint32_t exit_point, int timeout_ms, void *arch_info);
 
-	int (*register_commands)(struct command_context *cmd_ctx);
+	const struct command_registration *commands;
 
 	/* called when target is created */
 	int (*target_create)(struct target *target, Jim_Interp *interp);
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 965ac52..e402a11 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -3653,6 +3653,9 @@ static const struct command_registration xscale_any_command_handlers[] = {
 };
 static const struct command_registration xscale_command_handlers[] = {
 	{
+		.chain = arm_command_handlers,
+	},
+	{
 		.name = &quot;xscale&quot;,
 		.mode = COMMAND_ANY,
 		.help = &quot;xscale command group&quot;,
@@ -3661,14 +3664,6 @@ static const struct command_registration xscale_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int xscale_register_commands(struct command_context *cmd_ctx)
-{
-
-	armv4_5_register_commands(cmd_ctx);
-
-	return ERROR_OK;
-}
-
 struct target_type xscale_target =
 {
 	.name = &quot;xscale&quot;,
@@ -3702,7 +3697,7 @@ struct target_type xscale_target =
 	.add_watchpoint = xscale_add_watchpoint,
 	.remove_watchpoint = xscale_remove_watchpoint,
 
-	.register_commands = xscale_register_commands,
+	.commands = xscale_command_handlers,
 	.target_create = xscale_target_create,
 	.init_target = xscale_init_target,
 

commit 144e3678bd2d518388b6c2d7f3d2a912a9ac2abd
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    xscale: use register_commands()

diff --git a/src/target/xscale.c b/src/target/xscale.c
index c2b3493..965ac52 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -3554,31 +3554,115 @@ COMMAND_HANDLER(xscale_handle_cp15)
 	return ERROR_OK;
 }
 
+static const struct command_registration xscale_exec_command_handlers[] = {
+	{
+		.name = &quot;cache_info&quot;,
+		.handler = &amp;xscale_handle_cache_info_command,
+		.mode = COMMAND_EXEC, NULL,
+	},
+
+	{
+		.name = &quot;mmu&quot;,
+		.handler = &amp;xscale_handle_mmu_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;[enable|disable]&quot;,
+		.help = &quot;enable or disable the MMU&quot;,
+	},
+	{
+		.name = &quot;icache&quot;,
+		.handler = &amp;xscale_handle_idcache_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;[enable|disable]&quot;,
+		.help = &quot;enable or disable the ICache&quot;,
+	},
+	{
+		.name = &quot;dcache&quot;,
+		.handler = &amp;xscale_handle_idcache_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;[enable|disable]&quot;,
+		.help = &quot;enable or disable the DCache&quot;,
+	},
+
+	{
+		.name = &quot;vector_catch&quot;,
+		.handler = &amp;xscale_handle_vector_catch_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;mask of vectors that should be caught&quot;,
+		.usage = &quot;[&lt;mask&gt;]&quot;,
+	},
+	{
+		.name = &quot;vector_table&quot;,
+		.handler = &amp;xscale_handle_vector_table_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;high|low&gt; &lt;index&gt; &lt;code&gt;&quot;,
+		.help = &quot;set static code for exception handler entry&quot;,
+	},
+
+	{
+		.name = &quot;trace_buffer&quot;,
+		.handler = &amp;xscale_handle_trace_buffer_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;enable | disable&gt; [fill [n]|wrap]&quot;,
+	},
+	{
+		.name = &quot;dump_trace&quot;,
+		.handler = &amp;xscale_handle_dump_trace_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;dump content of trace buffer to &lt;file&gt;&quot;,
+		.usage = &quot;&lt;file&gt;&quot;,
+	},
+	{
+		.name = &quot;analyze_trace&quot;,
+		.handler = &amp;xscale_handle_analyze_trace_buffer_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;analyze content of trace buffer&quot;,
+	},
+	{
+		.name = &quot;trace_image&quot;,
+		.handler = &amp;xscale_handle_trace_image_command,
+		COMMAND_EXEC,
+		.help = &quot;load image from &lt;file&gt; [base address]&quot;,
+		.usage = &quot;&lt;file&gt; [address] [type]&quot;,
+	},
+
+	{
+		.name = &quot;cp15&quot;,
+		.handler = &amp;xscale_handle_cp15,
+		.mode = COMMAND_EXEC,
+		.help = &quot;access coproc 15&quot;,
+		.usage = &quot;&lt;register&gt; [value]&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration xscale_any_command_handlers[] = {
+	{
+		.name = &quot;debug_handler&quot;,
+		.handler = &amp;xscale_handle_debug_handler_command,
+		.mode = COMMAND_ANY,
+		.usage = &quot;&lt;target#&gt; &lt;address&gt;&quot;,
+	},
+	{
+		.name = &quot;cache_clean_address&quot;,
+		.handler = &amp;xscale_handle_cache_clean_address_command,
+		.mode = COMMAND_ANY,
+	},
+	{
+		.chain = xscale_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration xscale_command_handlers[] = {
+	{
+		.name = &quot;xscale&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;xscale command group&quot;,
+		.chain = xscale_any_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int xscale_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *xscale_cmd;
-
-	xscale_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;xscale&quot;, NULL, COMMAND_ANY, &quot;xscale specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;debug_handler&quot;, xscale_handle_debug_handler_command, COMMAND_ANY, &quot;'xscale debug_handler &lt;target#&gt; &lt;address&gt;' command takes two required operands&quot;);
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;cache_clean_address&quot;, xscale_handle_cache_clean_address_command, COMMAND_ANY, NULL);
-
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;cache_info&quot;, xscale_handle_cache_info_command, COMMAND_EXEC, NULL);
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;mmu&quot;, xscale_handle_mmu_command, COMMAND_EXEC, &quot;['enable'|'disable'] the MMU&quot;);
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;icache&quot;, xscale_handle_idcache_command, COMMAND_EXEC, &quot;['enable'|'disable'] the ICache&quot;);
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;dcache&quot;, xscale_handle_idcache_command, COMMAND_EXEC, &quot;['enable'|'disable'] the DCache&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;vector_catch&quot;, xscale_handle_vector_catch_command, COMMAND_EXEC, &quot;&lt;mask&gt; of vectors that should be catched&quot;);
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;vector_table&quot;, xscale_handle_vector_table_command, COMMAND_EXEC, &quot;&lt;high|low&gt; &lt;index&gt; &lt;code&gt; set static code for exception handler entry&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;trace_buffer&quot;, xscale_handle_trace_buffer_command, COMMAND_EXEC, &quot;&lt;enable | disable&gt; ['fill' [n]|'wrap']&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;dump_trace&quot;, xscale_handle_dump_trace_command, COMMAND_EXEC, &quot;dump content of trace buffer to &lt;file&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;analyze_trace&quot;, xscale_handle_analyze_trace_buffer_command, COMMAND_EXEC, &quot;analyze content of trace buffer&quot;);
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;trace_image&quot;, xscale_handle_trace_image_command,
-		COMMAND_EXEC, &quot;load image from &lt;file&gt; [base address]&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, xscale_cmd, &quot;cp15&quot;, xscale_handle_cp15, COMMAND_EXEC, &quot;access coproc 15 &lt;register&gt; [value]&quot;);
 
 	armv4_5_register_commands(cmd_ctx);
 

commit 8a41656391bd8eb6854c8573920d1155d815966b
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    trace: use register_commands()

diff --git a/src/target/trace.c b/src/target/trace.c
index c3897a0..f257592 100644
--- a/src/target/trace.c
+++ b/src/target/trace.c
@@ -156,16 +156,35 @@ COMMAND_HANDLER(handle_trace_history_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration trace_exec_command_handlers[] = {
+	{
+		.name = &quot;history&quot;,
+		.handler = &amp;handle_trace_history_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display trace history, clear history or set [size]&quot;,
+		.usage = &quot;[clear|&lt;size&gt;]&quot;,
+	},
+	{
+		.name = &quot;point&quot;,
+		.handler = &amp;handle_trace_point_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display trace points, clear list of trace points, &quot;
+			&quot;or add new tracepoint at [address]&quot;,
+		.usage = &quot;[clear|&lt;address&gt;]&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration trace_command_handlers[] = {
+	{
+		.name = &quot;trace&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;trace command group&quot;,
+		.chain = trace_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int trace_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *trace_cmd =
-		COMMAND_REGISTER(cmd_ctx, NULL, &quot;trace&quot;, NULL, COMMAND_ANY, &quot;trace commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, trace_cmd, &quot;history&quot;, handle_trace_history_command,
-		COMMAND_EXEC, &quot;display trace history, ['clear'] history or set [size]&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, trace_cmd, &quot;point&quot;, handle_trace_point_command,
-		COMMAND_EXEC, &quot;display trace points, ['clear'] list of trace points, or add new tracepoint at [address]&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, trace_command_handlers);
 }

commit 5f6962b34f623e7daf0dfb1f6249620431b5ab79
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    target_request: use register_commands()

diff --git a/src/target/target_request.c b/src/target/target_request.c
index a02e2c1..9e78178 100644
--- a/src/target/target_request.c
+++ b/src/target/target_request.c
@@ -35,7 +35,6 @@
 #include &quot;log.h&quot;
 
 
-static struct command *target_request_cmd = NULL;
 static int charmsg_mode = 0;
 
 static int target_asciimsg(struct target *target, uint32_t length)
@@ -300,13 +299,27 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration target_req_exec_command_handlers[] = {
+	{
+		.name = &quot;debugmsgs&quot;,
+		.handler = &amp;handle_target_request_debugmsgs_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;set reception of debug messages from target&quot;,
+		.usage = &quot;(enable|disable)&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration target_req_command_handlers[] = {
+	{
+		.name = &quot;target_request&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;target request command group&quot;,
+		.chain = target_req_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int target_request_register_commands(struct command_context *cmd_ctx)
 {
-	target_request_cmd =
-		COMMAND_REGISTER(cmd_ctx, NULL, &quot;target_request&quot;, NULL, COMMAND_ANY, &quot;target_request commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, target_request_cmd, &quot;debugmsgs&quot;, handle_target_request_debugmsgs_command,
-		COMMAND_EXEC, &quot;enable/disable reception of debug messages from target&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, target_req_command_handlers);
 }

commit 4e67912fb01a0ab60c246c12c7ce50e361dd3e20
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    target: use register_commands()

diff --git a/src/target/target.c b/src/target/target.c
index 2e93382..6f48808 100644
--- a/src/target/target.c
+++ b/src/target/target.c
@@ -4762,19 +4762,211 @@ static int jim_mcrmrc(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 	return JIM_OK;
 }
 
+static const struct command_registration target_command_handlers[] = {
+	{
+		.name = &quot;targets&quot;,
+		.handler = &amp;handle_targets_command,
+		.mode = COMMAND_ANY,
+		.help = &quot;change current command line target (one parameter) &quot;
+			&quot;or list targets (no parameters)&quot;,
+		.usage = &quot;[&lt;new_current_target&gt;]&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int target_register_commands(struct command_context *cmd_ctx)
 {
-
-	COMMAND_REGISTER(cmd_ctx, NULL, &quot;targets&quot;,
-			handle_targets_command, COMMAND_EXEC,
-			&quot;change current command line target (one parameter) &quot;
-			&quot;or list targets (no parameters)&quot;);
-
 	register_jim(cmd_ctx, &quot;target&quot;, jim_target, &quot;configure target&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, target_command_handlers);
 }
 
+static const struct command_registration target_exec_command_handlers[] = {
+	{
+		.name = &quot;fast_load_image&quot;,
+		.handler = &amp;handle_fast_load_image_command,
+		.mode = COMMAND_ANY,
+		.help = &quot;Load image into memory, mainly for profiling purposes&quot;,
+		.usage = &quot;&lt;file&gt; &lt;address&gt; ['bin'|'ihex'|'elf'|'s19'] &quot;
+			&quot;[min_address] [max_length]&quot;,
+	},
+	{
+		.name = &quot;fast_load&quot;,
+		.handler = &amp;handle_fast_load_command,
+		.mode = COMMAND_ANY,
+		.help = &quot;loads active fast load image to current target &quot;
+			&quot;- mainly for profiling purposes&quot;,
+	},
+	{
+		.name = &quot;profile&quot;,
+		.handler = &amp;handle_profile_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;profiling samples the CPU PC&quot;,
+	},
+	/** @todo don't register virt2phys() unless target supports it */
+	{
+		.name = &quot;virt2phys&quot;,
+		.handler = &amp;handle_virt2phys_command,
+		.mode = COMMAND_ANY,
+		.help = &quot;translate a virtual address into a physical address&quot;,
+	},
+
+	{
+		.name = &quot;reg&quot;,
+		.handler = &amp;handle_reg_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display or set a register&quot;,
+	},
+
+	{
+		.name = &quot;poll&quot;,
+		.handler = &amp;handle_poll_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;poll target state&quot;,
+	},
+	{
+		.name = &quot;wait_halt&quot;,
+		.handler = &amp;handle_wait_halt_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;wait for target halt&quot;,
+		.usage = &quot;[time (s)]&quot;,
+	},
+	{
+		.name = &quot;halt&quot;,
+		.handler = &amp;handle_halt_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;halt target&quot;,
+	},
+	{
+		.name = &quot;resume&quot;,
+		.handler = &amp;handle_resume_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;resume target&quot;,
+		.usage = &quot;[&lt;address&gt;]&quot;,
+	},
+	{
+		.name = &quot;reset&quot;,
+		.handler = &amp;handle_reset_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;[run|halt|init]&quot;,
+		.help = &quot;Reset all targets into the specified mode.&quot;
+			&quot;Default reset mode is run, if not given.&quot;,
+	},
+	{
+		.name = &quot;soft_reset_halt&quot;,
+		.handler = &amp;handle_soft_reset_halt_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;halt the target and do a soft reset&quot;,
+	},
+	{
+
+		.name = &quot;step&quot;,
+		.handler = &amp;handle_step_command,
+		.mode = COMMAND_EXEC,
+		.help =	&quot;step one instruction from current PC or [addr]&quot;,
+		.usage = &quot;[&lt;address&gt;]&quot;,
+	},
+	{
+
+		.name = &quot;mdw&quot;,
+		.handler = &amp;handle_md_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display memory words&quot;,
+		.usage = &quot;[phys] &lt;addr&gt; [count]&quot;,
+	},
+	{
+		.name = &quot;mdh&quot;,
+		.handler = &amp;handle_md_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display memory half-words&quot;,
+		.usage = &quot;[phys] &lt;addr&gt; [count]&quot;,
+	},
+	{
+		.name = &quot;mdb&quot;,
+		.handler = &amp;handle_md_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display memory bytes&quot;,
+		.usage = &quot;[phys] &lt;addr&gt; [count]&quot;,
+	},
+	{
+
+		.name = &quot;mww&quot;,
+		.handler = &amp;handle_mw_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;write memory word&quot;,
+		.usage = &quot;[phys]  &lt;addr&gt; &lt;value&gt; [count]&quot;,
+	},
+	{
+		.name = &quot;mwh&quot;,
+		.handler = &amp;handle_mw_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;write memory half-word&quot;,
+		.usage = &quot;[phys] &lt;addr&gt; &lt;value&gt; [count]&quot;,
+	},
+	{
+		.name = &quot;mwb&quot;,
+		.handler = &amp;handle_mw_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;write memory byte&quot;,
+		.usage = &quot;[phys] &lt;addr&gt; &lt;value&gt; [count]&quot;,
+	},
+	{
+
+		.name = &quot;bp&quot;,
+		.handler = &amp;handle_bp_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;list or set breakpoint&quot;,
+		.usage = &quot;[&lt;address&gt; &lt;length&gt; [hw]]&quot;,
+	},
+	{
+		.name = &quot;rbp&quot;,
+		.handler = &amp;handle_rbp_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;remove breakpoint&quot;,
+		.usage = &quot;&lt;address&gt;&quot;,
+	},
+	{
+
+		.name = &quot;wp&quot;,
+		.handler = &amp;handle_wp_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;list or set watchpoint&quot;,
+		.usage = &quot;[&lt;address&gt; &lt;length&gt; &lt;r/w/a&gt; [value] [mask]]&quot;,
+	},
+	{
+		.name = &quot;rwp&quot;,
+		.handler = &amp;handle_rwp_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;remove watchpoint&quot;,
+		.usage = &quot;&lt;address&gt;&quot;,
+
+	},
+	{
+		.name = &quot;load_image&quot;,
+		.handler = &amp;handle_load_image_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;file&gt; &lt;address&gt; ['bin'|'ihex'|'elf'|'s19'] &quot;
+			&quot;[min_address] [max_length]&quot;,
+	},
+	{
+		.name = &quot;dump_image&quot;,
+		.handler = &amp;handle_dump_image_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;file&gt; &lt;address&gt; &lt;size&gt;&quot;,
+	},
+	{
+		.name = &quot;verify_image&quot;,
+		.handler = &amp;handle_verify_image_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;file&gt; [offset] [type]&quot;,
+	},
+	{
+		.name = &quot;test_image&quot;,
+		.handler = &amp;handle_test_image_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;file&gt; [offset] [type]&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
 int target_register_user_commands(struct command_context *cmd_ctx)
 {
 	int retval = ERROR_OK;
@@ -4784,10 +4976,6 @@ int target_register_user_commands(struct command_context *cmd_ctx)
 	if ((retval = trace_register_commands(cmd_ctx)) != ERROR_OK)
 		return retval;
 
-	COMMAND_REGISTER(cmd_ctx, NULL, &quot;profile&quot;,
-			handle_profile_command, COMMAND_EXEC,
-			&quot;profiling samples the CPU PC&quot;);
-
 	register_jim(cmd_ctx, &quot;ocd_mem2array&quot;, jim_mem2array,
 			&quot;read memory and return as a TCL array for script processing &quot;
 			&quot;&lt;ARRAYNAME&gt; &lt;WIDTH = 32/16/8&gt; &lt;ADDRESS&gt; &lt;COUNT&gt;&quot;);
@@ -4796,96 +4984,5 @@ int target_register_user_commands(struct command_context *cmd_ctx)
 			&quot;convert a TCL array to memory locations and write the values &quot;
 			&quot;&lt;ARRAYNAME&gt; &lt;WIDTH = 32/16/8&gt; &lt;ADDRESS&gt; &lt;COUNT&gt;&quot;);
 
-	COMMAND_REGISTER(cmd_ctx, NULL, &quot;fast_load_image&quot;,
-			handle_fast_load_image_command, COMMAND_ANY,
-			&quot;same CMD_ARGV as load_image, image stored in memory &quot;
-			&quot;- mainly for profiling purposes&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, NULL, &quot;fast_load&quot;,
-			handle_fast_load_command, COMMAND_ANY,
-			&quot;loads active fast load image to current target &quot;
-			&quot;- mainly for profiling purposes&quot;);
-
-	/** @todo don't register virt2phys() unless target supports it */
-	COMMAND_REGISTER(cmd_ctx, NULL, &quot;virt2phys&quot;,
-			handle_virt2phys_command, COMMAND_ANY,
-			&quot;translate a virtual address into a physical address&quot;);
-
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;reg&quot;,
-			handle_reg_command, COMMAND_EXEC,
-			&quot;display or set a register&quot;);
-
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;poll&quot;,
-			handle_poll_command, COMMAND_EXEC,
-			&quot;poll target state&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;wait_halt&quot;,
-			handle_wait_halt_command, COMMAND_EXEC,
-			&quot;wait for target halt [time (s)]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;halt&quot;,
-			handle_halt_command, COMMAND_EXEC,
-			&quot;halt target&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;resume&quot;,
-			handle_resume_command, COMMAND_EXEC,
-			&quot;resume target [addr]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;reset&quot;,
-			handle_reset_command, COMMAND_EXEC,
-			&quot;reset target [run | halt | init] - default is run&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;soft_reset_halt&quot;,
-			handle_soft_reset_halt_command, COMMAND_EXEC,
-			&quot;halt the target and do a soft reset&quot;);
-
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;step&quot;,
-			handle_step_command, COMMAND_EXEC,
-			&quot;step one instruction from current PC or [addr]&quot;);
-
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;mdw&quot;,
-			handle_md_command, COMMAND_EXEC,
-			&quot;display memory words [phys] &lt;addr&gt; [count]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;mdh&quot;,
-			handle_md_command, COMMAND_EXEC,
-			&quot;display memory half-words [phys] &lt;addr&gt; [count]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;mdb&quot;,
-			handle_md_command, COMMAND_EXEC,
-			&quot;display memory bytes [phys] &lt;addr&gt; [count]&quot;);
-
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;mww&quot;,
-			handle_mw_command, COMMAND_EXEC,
-			&quot;write memory word [phys]  &lt;addr&gt; &lt;value&gt; [count]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;mwh&quot;,
-			handle_mw_command, COMMAND_EXEC,
-			&quot;write memory half-word [phys]  &lt;addr&gt; &lt;value&gt; [count]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;mwb&quot;,
-			handle_mw_command, COMMAND_EXEC,
-			&quot;write memory byte [phys] &lt;addr&gt; &lt;value&gt; [count]&quot;);
-
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;bp&quot;,
-			handle_bp_command, COMMAND_EXEC,
-			&quot;list or set breakpoint [&lt;address&gt; &lt;length&gt; [hw]]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;rbp&quot;,
-			handle_rbp_command, COMMAND_EXEC,
-			&quot;remove breakpoint &lt;address&gt;&quot;);
-
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;wp&quot;,
-			handle_wp_command, COMMAND_EXEC,
-			&quot;list or set watchpoint &quot;
-				&quot;[&lt;address&gt; &lt;length&gt; &lt;r/w/a&gt; [value] [mask]]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;rwp&quot;,
-			handle_rwp_command, COMMAND_EXEC,
-			&quot;remove watchpoint &lt;address&gt;&quot;);
-
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;load_image&quot;,
-			handle_load_image_command, COMMAND_EXEC,
-			&quot;load_image &lt;file&gt; &lt;address&gt; &quot;
-			&quot;['bin'|'ihex'|'elf'|'s19'] [min_address] [max_length]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;dump_image&quot;,
-			handle_dump_image_command, COMMAND_EXEC,
-			&quot;dump_image &lt;file&gt; &lt;address&gt; &lt;size&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;verify_image&quot;,
-			handle_verify_image_command, COMMAND_EXEC,
-			&quot;verify_image &lt;file&gt; [offset] [type]&quot;);
-	COMMAND_REGISTER(cmd_ctx,  NULL, &quot;test_image&quot;,
-			handle_test_image_command, COMMAND_EXEC,
-			&quot;test_image &lt;file&gt; [offset] [type]&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, target_exec_command_handlers);
 }

commit c3800b5e674be3a9e1c7976925f9cfc52cba3ad5
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    oocd_trace: use register_commands()

diff --git a/src/target/oocd_trace.c b/src/target/oocd_trace.c
index 596a4d6..a34c63c 100644
--- a/src/target/oocd_trace.c
+++ b/src/target/oocd_trace.c
@@ -407,16 +407,38 @@ COMMAND_HANDLER(handle_oocd_trace_resync_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration oocd_trace_all_command_handlers[] = {
+	{
+		.name = &quot;config&quot;,
+		.handler = &amp;handle_oocd_trace_config_command,
+		.mode = COMMAND_CONFIG,
+		.usage = &quot;&lt;target&gt;&quot;,
+	},
+	{
+		.name = &quot;status&quot;,
+		.handler = &amp;handle_oocd_trace_status_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display OpenOCD + trace status&quot;,
+	},
+	{
+		.name = &quot;resync&quot;,
+		.handler = handle_oocd_trace_resync_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;resync OpenOCD + trace capture clock&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration oocd_trace_command_handlers[] = {
+	{
+		.name = &quot;oocd_trace&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;OpenOCD trace capture driver command group&quot;,
+		.chain = oocd_trace_all_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int oocd_trace_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *oocd_trace_cmd;
-
-	oocd_trace_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;oocd_trace&quot;, NULL, COMMAND_ANY, &quot;OpenOCD + trace&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, oocd_trace_cmd, &quot;config&quot;, handle_oocd_trace_config_command, COMMAND_CONFIG, NULL);
-
-	COMMAND_REGISTER(cmd_ctx, oocd_trace_cmd, &quot;status&quot;, handle_oocd_trace_status_command, COMMAND_EXEC, &quot;display OpenOCD + trace status&quot;);
-	COMMAND_REGISTER(cmd_ctx, oocd_trace_cmd, &quot;resync&quot;, handle_oocd_trace_resync_command, COMMAND_EXEC, &quot;resync OpenOCD + trace capture clock&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, oocd_trace_command_handlers);
 }

commit a17caa387c0fb08ee2604e066b436d90d9cf0a2f
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    etm_dummy: use register_commands()

diff --git a/src/target/etm_dummy.c b/src/target/etm_dummy.c
index 2df8943..27a8eec 100644
--- a/src/target/etm_dummy.c
+++ b/src/target/etm_dummy.c
@@ -58,15 +58,28 @@ COMMAND_HANDLER(handle_etm_dummy_config_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration etm_dummy_config_command_handlers[] = {
+	{
+		.name = &quot;config&quot;,
+		.handler = &amp;handle_etm_dummy_config_command,
+		.mode = COMMAND_CONFIG,
+		.usage = &quot;&lt;target&gt;&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration etm_dummy_command_handlers[] = {
+	{
+		.name = &quot;etm_dummy&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;Dummy ETM capture driver command group&quot;,
+		.chain = etm_dummy_config_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int etm_dummy_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *etm_dummy_cmd;
-
-	etm_dummy_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;etm_dummy&quot;, NULL, COMMAND_ANY, &quot;Dummy ETM capture driver&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, etm_dummy_cmd, &quot;config&quot;, handle_etm_dummy_config_command, COMMAND_CONFIG, NULL);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, etm_dummy_command_handlers);
 }
 
 static int etm_dummy_init(struct etm_context *etm_ctx)

commit dd063d99147ff08ad817fc3fbd306425b6933d8d
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    etm: use register_commands()

diff --git a/src/target/etm.c b/src/target/etm.c
index 6df354a..0f7b41e 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -221,8 +221,6 @@ static int etm_register_user_commands(struct command_context *cmd_ctx);
 static int etm_set_reg_w_exec(struct reg *reg, uint8_t *buf);
 static int etm_write_reg(struct reg *reg, uint32_t value);
 
-static struct command *etm_cmd;
-
 static const struct reg_arch_type etm_scan6_type = {
 	.get = etm_get_reg,
 	.set = etm_set_reg_w_exec,
@@ -2095,45 +2093,99 @@ COMMAND_HANDLER(handle_etm_analyze_command)
 	return retval;
 }
 
+static const struct command_registration etm_config_command_handlers[] = {
+	{
+		.name = &quot;config&quot;,
+		.handler = &amp;handle_etm_config_command,
+		.mode = COMMAND_CONFIG,
+		.usage = &quot;&lt;target&gt; &lt;port_width&gt; &lt;port_mode&gt; &quot;
+			&quot;&lt;clocking&gt; &lt;capture_driver&gt;&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration etm_command_handlers[] = {
+	{
+		.name = &quot;etm&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;Emebdded Trace Macrocell command group&quot;,
+		.chain = etm_config_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int etm_register_commands(struct command_context *cmd_ctx)
 {
-	etm_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;etm&quot;, NULL, COMMAND_ANY, &quot;Embedded Trace Macrocell&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;config&quot;, handle_etm_config_command,
-		COMMAND_CONFIG, &quot;etm config &lt;target&gt; &lt;port_width&gt; &lt;port_mode&gt; &lt;clocking&gt; &lt;capture_driver&gt;&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, etm_command_handlers);
 }
 
+static const struct command_registration etm_exec_command_handlers[] = {
+	{
+		.name = &quot;tracemode&quot;, handle_etm_tracemode_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;configure/display trace mode&quot;,
+		.usage = &quot;&lt;none | data | address | all&gt; &quot;
+			&quot;&lt;context_id_bits&gt; &lt;cycle_accurate&gt; &lt;branch_output&gt;&quot;,
+	},
+	{
+		.name = &quot;info&quot;,
+		.handler = &amp;handle_etm_info_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display info about the current target's ETM&quot;,
+	},
+	{
+		.name = &quot;trigger_percent&quot;,
+		.handler = &amp;handle_etm_trigger_percent_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;amount (&lt;percent&gt;) of trace buffer &quot;
+			&quot;to be filled after the trigger occured&quot;,
+	},
+	{
+		.name = &quot;status&quot;,
+		.handler = &amp;handle_etm_status_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display current target's ETM status&quot;,
+	},
+	{
+		.name = &quot;start&quot;,
+		.handler = &amp;handle_etm_start_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;start ETM trace collection&quot;,
+	},
+	{
+		.name = &quot;stop&quot;,
+		.handler = &amp;handle_etm_stop_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;stop ETM trace collection&quot;,
+	},
+	{
+		.name = &quot;analyze&quot;,
+		.handler = &amp;handle_etm_analyze_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;anaylze collected ETM trace&quot;,
+	},
+	{
+		.name = &quot;image&quot;,
+		.handler = &amp;handle_etm_image_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;load image from &lt;file&gt; [base address]&quot;,
+	},
+	{
+		.name = &quot;dump&quot;,
+		.handler = &amp;handle_etm_dump_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;dump captured trace data &lt;file&gt;&quot;,
+	},
+	{
+		.name = &quot;load&quot;,
+		.handler = &amp;handle_etm_load_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;load trace data for analysis &lt;file&gt;&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int etm_register_user_commands(struct command_context *cmd_ctx)
 {
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;tracemode&quot;, handle_etm_tracemode_command,
-		COMMAND_EXEC, &quot;configure/display trace mode: &quot;
-			&quot;&lt;none | data | address | all&gt; &quot;
-			&quot;&lt;context_id_bits&gt; &lt;cycle_accurate&gt; &lt;branch_output&gt;&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;info&quot;, handle_etm_info_command,
-		COMMAND_EXEC, &quot;display info about the current target's ETM&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;trigger_percent&quot;, handle_etm_trigger_percent_command,
-		COMMAND_EXEC, &quot;amount (&lt;percent&gt;) of trace buffer to be filled after the trigger occured&quot;);
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;status&quot;, handle_etm_status_command,
-		COMMAND_EXEC, &quot;display current target's ETM status&quot;);
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;start&quot;, handle_etm_start_command,
-		COMMAND_EXEC, &quot;start ETM trace collection&quot;);
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;stop&quot;, handle_etm_stop_command,
-		COMMAND_EXEC, &quot;stop ETM trace collection&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;analyze&quot;, handle_etm_analyze_command,
-		COMMAND_EXEC, &quot;anaylze collected ETM trace&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;image&quot;, handle_etm_image_command,
-		COMMAND_EXEC, &quot;load image from &lt;file&gt; [base address]&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;dump&quot;, handle_etm_dump_command,
-		COMMAND_EXEC, &quot;dump captured trace data &lt;file&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, etm_cmd, &quot;load&quot;, handle_etm_load_command,
-		COMMAND_EXEC, &quot;load trace data for analysis &lt;file&gt;&quot;);
-
-	return ERROR_OK;
+	struct command *etm_cmd = command_find_in_context(cmd_ctx, &quot;etm&quot;);
+	return register_commands(cmd_ctx, etm_cmd, etm_exec_command_handlers);
 }

commit 8161fd3163142f828a0bd79e0b5ad339dc4aec6b
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    etb: use register_commands()

diff --git a/src/target/etb.c b/src/target/etb.c
index 1f44d3a..63dee18 100644
--- a/src/target/etb.c
+++ b/src/target/etb.c
@@ -402,16 +402,28 @@ COMMAND_HANDLER(handle_etb_config_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration etb_config_command_handlers[] = {
+	{
+		.name = &quot;config&quot;,
+		.handler = &amp;handle_etb_config_command,
+		.mode = COMMAND_CONFIG,
+		.usage = &quot;&lt;target&gt; &lt;tap&gt;&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration etb_command_handlers[] = {
+	{
+		.name = &quot;etb&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;Emebdded Trace Buffer command group&quot;,
+		.chain = etb_config_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int etb_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *etb_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;etb&quot;,
-			NULL, COMMAND_ANY, &quot;Embedded Trace Buffer&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, etb_cmd, &quot;config&quot;,
-			handle_etb_config_command, COMMAND_CONFIG,
-			NULL);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, etb_command_handlers);
 }
 
 static int etb_init(struct etm_context *etm_ctx)

commit 97fbd793b3a4edec490b2b034f7b6fe5261ca03e
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    cortex_m3: use register_commands()

diff --git a/src/target/cortex_m3.c b/src/target/cortex_m3.c
index 47052e9..be81af9 100644
--- a/src/target/cortex_m3.c
+++ b/src/target/cortex_m3.c
@@ -1912,27 +1912,44 @@ COMMAND_HANDLER(handle_cortex_m3_mask_interrupts_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration cortex_m3_exec_command_handlers[] = {
+	{
+		.name = &quot;disassemble&quot;,
+		.handler = &amp;handle_cortex_m3_disassemble_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;disassemble Thumb2 instructions&quot;,
+		.usage = &quot;&lt;address&gt; [&lt;count&gt;]&quot;,
+	},
+	{
+		.name = &quot;maskisr&quot;,
+		.handler = &amp;handle_cortex_m3_mask_interrupts_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;mask cortex_m3 interrupts&quot;,
+		.usage = &quot;['on'|'off']&quot;,
+	},
+	{
+		.name = &quot;vector_catch&quot;,
+		.handler = &amp;handle_cortex_m3_vector_catch_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;catch hardware vectors&quot;,
+		.usage = &quot;['all'|'none'|&lt;list&gt;]&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration cortex_m3_command_handlers[] = {
+	{
+		.name = &quot;cortex_m3&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;Cortex-M3 command group&quot;,
+		.chain = cortex_m3_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int cortex_m3_register_commands(struct command_context *cmd_ctx)
 {
-	int retval;
-	struct command *cortex_m3_cmd;
-
-	retval = armv7m_register_commands(cmd_ctx);
-
-	cortex_m3_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;cortex_m3&quot;,
-			NULL, COMMAND_ANY, &quot;cortex_m3 specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, cortex_m3_cmd, &quot;disassemble&quot;,
-			handle_cortex_m3_disassemble_command, COMMAND_EXEC,
-			&quot;disassemble Thumb2 instructions &lt;address&gt; [&lt;count&gt;]&quot;);
-	COMMAND_REGISTER(cmd_ctx, cortex_m3_cmd, &quot;maskisr&quot;,
-			handle_cortex_m3_mask_interrupts_command, COMMAND_EXEC,
-			&quot;mask cortex_m3 interrupts ['on'|'off']&quot;);
-	COMMAND_REGISTER(cmd_ctx, cortex_m3_cmd, &quot;vector_catch&quot;,
-			handle_cortex_m3_vector_catch_command, COMMAND_EXEC,
-			&quot;catch hardware vectors ['all'|'none'|&lt;list&gt;]&quot;);
-
-	return retval;
+	armv7m_register_commands(cmd_ctx);
+	return register_commands(cmd_ctx, NULL, cortex_m3_command_handlers);
 }
 
 struct target_type cortexm3_target =

commit 28300bbf6ff726fe1ab807fa9796241bb3348cfd
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    cortex_a8: use register_commands()

diff --git a/src/target/cortex_a8.c b/src/target/cortex_a8.c
index 519ba3f..325a54b 100644
--- a/src/target/cortex_a8.c
+++ b/src/target/cortex_a8.c
@@ -1625,28 +1625,36 @@ COMMAND_HANDLER(cortex_a8_handle_dbginit_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration cortex_a8_exec_command_handlers[] = {
+	{
+		.name = &quot;cache_info&quot;,
+		.handler = &amp;cortex_a8_handle_cache_info_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display information about target caches&quot;,
+	},
+	{
+		.name = &quot;dbginit&quot;,
+		.handler = &amp;cortex_a8_handle_dbginit_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;Initialize core debug&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration cortex_a8_command_handlers[] = {
+	{
+		.name = &quot;cortex_a8&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;Cortex-A8 command group&quot;,
+		.chain = cortex_a8_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
 
 static int cortex_a8_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *cortex_a8_cmd;
-	int retval = ERROR_OK;
-
 	armv4_5_register_commands(cmd_ctx);
 	armv7a_register_commands(cmd_ctx);
-
-	cortex_a8_cmd =	COMMAND_REGISTER(cmd_ctx, NULL, &quot;cortex_a8&quot;,
-			NULL, COMMAND_ANY,
-			&quot;cortex_a8 specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, cortex_a8_cmd, &quot;cache_info&quot;,
-			cortex_a8_handle_cache_info_command, COMMAND_EXEC,
-			&quot;display information about target caches&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, cortex_a8_cmd, &quot;dbginit&quot;,
-			cortex_a8_handle_dbginit_command, COMMAND_EXEC,
-			&quot;Initialize core debug&quot;);
-
-	return retval;
+	return register_commands(cmd_ctx, NULL, cortex_a8_command_handlers);
 }
 
 struct target_type cortexa8_target = {

commit df95fe25a4f01db9e131272ee72ebbf328ede428
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:06 2009 -0800

    armv7m: use register_commands()

diff --git a/src/target/armv7m.c b/src/target/armv7m.c
index 9fd24e9..6d8ad5f 100644
--- a/src/target/armv7m.c
+++ b/src/target/armv7m.c
@@ -795,34 +795,54 @@ COMMAND_HANDLER(handle_dap_info_command)
 	return dap_info_command(CMD_CTX, swjdp, apsel);
 }
 
-/** Registers commands used to access DAP resources. */
+static const struct command_registration armv7m_exec_command_handlers[] = {
+	{
+		.name = &quot;info&quot;,
+		.handler = &amp;handle_dap_info_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;dap info for ap [num], &quot;
+			&quot;default currently selected AP&quot;,
+	},
+	{
+		.name = &quot;apsel&quot;,
+		.handler = &amp;handle_dap_apsel_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;select a different AP [num] (default 0)&quot;,
+	},
+	{
+		.name = &quot;apid&quot;,
+		.handler = &amp;handle_dap_apid_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;return id reg from AP [num], &quot;
+			&quot;default currently selected AP&quot;,
+	},
+	{
+		.name = &quot;baseaddr&quot;,
+		.handler = &amp;handle_dap_baseaddr_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;return debug base address from AP [num], &quot;
+			&quot;default currently selected AP&quot;,
+	},
+	{
+		.name = &quot;memaccess&quot;,
+		.handler = &amp;handle_dap_memaccess_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;set/get number of extra tck for mem-ap memory &quot;
+			&quot;bus access [0-255]&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration armv7m_command_handlers[] = {
+	{
+		.name = &quot;dap&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;Cortex DAP command group&quot;,
+		.chain = armv7m_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int armv7m_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *arm_adi_v5_dap_cmd;
-
-	arm_adi_v5_dap_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;dap&quot;,
-			NULL, COMMAND_ANY,
-			&quot;cortex dap specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;info&quot;,
-			handle_dap_info_command, COMMAND_EXEC,
-			&quot;Displays dap info for ap [num],&quot;
-			&quot;default currently selected AP&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;apsel&quot;,
-			handle_dap_apsel_command, COMMAND_EXEC,
-			&quot;Select a different AP [num] (default 0)&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;apid&quot;,
-			handle_dap_apid_command, COMMAND_EXEC,
-			&quot;Displays id reg from AP [num], &quot;
-			&quot;default currently selected AP&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;baseaddr&quot;,
-			handle_dap_baseaddr_command, COMMAND_EXEC,
-			&quot;Displays debug base address from AP [num],&quot;
-			&quot;default currently selected AP&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;memaccess&quot;,
-			handle_dap_memaccess_command, COMMAND_EXEC,
-			&quot;set/get number of extra tck for mem-ap &quot;
-			&quot;memory bus access [0-255]&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, armv7m_command_handlers);
 }

commit d79176e1bc4699a52663b87dc52f02fb7afa3d54
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:05 2009 -0800

    armv7a: use register_commands()

diff --git a/src/target/armv7a.c b/src/target/armv7a.c
index 6763863..7cc2273 100644
--- a/src/target/armv7a.c
+++ b/src/target/armv7a.c
@@ -144,33 +144,54 @@ COMMAND_HANDLER(handle_dap_info_command)
 	return dap_info_command(CMD_CTX, swjdp, apsel);
 }
 
+static const struct command_registration armv7a_exec_command_handlers[] = {
+	{
+		.name = &quot;info&quot;,
+		.handler = &amp;handle_dap_info_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;dap info for ap [num], &quot;
+			&quot;default currently selected AP&quot;,
+	},
+	{
+		.name = &quot;apsel&quot;,
+		.handler = &amp;handle_dap_apsel_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;select a different AP [num] (default 0)&quot;,
+	},
+	{
+		.name = &quot;apid&quot;,
+		.handler = &amp;handle_dap_apid_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;return id reg from AP [num], &quot;
+			&quot;default currently selected AP&quot;,
+	},
+	{
+		.name = &quot;baseaddr&quot;,
+		.handler = &amp;handle_dap_baseaddr_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;return debug base address from AP [num], &quot;
+			&quot;default currently selected AP&quot;,
+	},
+	{
+		.name = &quot;memaccess&quot;,
+		.handler = &amp;handle_dap_memaccess_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;set/get number of extra tck for mem-ap memory &quot;
+			&quot;bus access [0-255]&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration armv7a_command_handlers[] = {
+	{
+		.name = &quot;dap&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;Cortex DAP command group&quot;,
+		.chain = armv7a_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int armv7a_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *arm_adi_v5_dap_cmd;
-
-	arm_adi_v5_dap_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;dap&quot;,
-			NULL, COMMAND_ANY,
-			&quot;cortex dap specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;info&quot;,
-			handle_dap_info_command, COMMAND_EXEC,
-			&quot;dap info for ap [num], &quot;
-			&quot;default currently selected AP&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;apsel&quot;,
-			handle_dap_apsel_command, COMMAND_EXEC,
-			&quot;select a different AP [num] (default 0)&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;apid&quot;,
-			handle_dap_apid_command, COMMAND_EXEC,
-			&quot;return id reg from AP [num], &quot;
-			&quot;default currently selected AP&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;baseaddr&quot;,
-			handle_dap_baseaddr_command, COMMAND_EXEC,
-			&quot;return debug base address from AP [num], &quot;
-			&quot;default currently selected AP&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm_adi_v5_dap_cmd, &quot;memaccess&quot;,
-			handle_dap_memaccess_command, COMMAND_EXEC,
-			&quot;set/get number of extra tck for mem-ap memory &quot;
-			&quot;bus access [0-255]&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, armv7a_command_handlers);
 }

commit 84c03168a54549e2a102ceb25219ac8a2281d954
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:05 2009 -0800

    armv4_5: use register_commands()

diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index ec6d5a0..dfb7094 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -786,26 +786,42 @@ usage:
 	return retval;
 }
 
+static const struct command_registration arm_exec_command_handlers[] = {
+	{
+		.name = &quot;reg&quot;,
+		.handler = &amp;handle_armv4_5_reg_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display ARM core registers&quot;,
+	},
+	{
+		.name = &quot;core_state&quot;,
+		.handler = &amp;handle_armv4_5_core_state_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;arm | thumb&gt;&quot;,
+		.help = &quot;display/change ARM core state&quot;,
+	},
+	{
+		.name = &quot;disassemble&quot;,
+		.handler = &amp;handle_armv4_5_disassemble_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;address&gt; [&lt;count&gt; ['thumb']]&quot;,
+		.help = &quot;disassemble instructions &quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration arm_command_handlers[] = {
+	{
+		.name = &quot;arm&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;ARM command group&quot;,
+		.chain = arm_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int armv4_5_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *armv4_5_cmd;
-
-	armv4_5_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;arm&quot;,
-			NULL, COMMAND_ANY,
-			&quot;generic ARM commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, armv4_5_cmd, &quot;reg&quot;,
-			handle_armv4_5_reg_command, COMMAND_EXEC,
-			&quot;display ARM core registers&quot;);
-	COMMAND_REGISTER(cmd_ctx, armv4_5_cmd, &quot;core_state&quot;,
-			handle_armv4_5_core_state_command, COMMAND_EXEC,
-			&quot;display/change ARM core state &lt;arm | thumb&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, armv4_5_cmd, &quot;disassemble&quot;,
-			handle_armv4_5_disassemble_command, COMMAND_EXEC,
-			&quot;disassemble instructions &quot;
-				&quot;&lt;address&gt; [&lt;count&gt; ['thumb']]&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, arm_command_handlers);
 }
 
 int armv4_5_get_gdb_reg_list(struct target *target, struct reg **reg_list[], int *reg_list_size)

commit d1eca9a74c7c57ba6a3210c51b2a10cc5adb22e1
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:05 2009 -0800

    arm9tdmi: use register_commands()

diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index f965429..87ace05 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -908,20 +908,29 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration arm9tdmi_exec_command_handlers[] = {
+	{
+		.name = &quot;vector_catch&quot;,
+		.handler = handle_arm9tdmi_catch_vectors_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;[all|none|reset|undef|swi|pabt|dabt|irq|fiq] ...&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration arm9tdmi_command_handlers[] = {
+	{
+		.name = &quot;arm9tdmi&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;arm9tdmi command group&quot;,
+		.chain = arm9tdmi_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int arm9tdmi_register_commands(struct command_context *cmd_ctx)
 {
-	int retval;
-	struct command *arm9tdmi_cmd;
-
-	retval = arm7_9_register_commands(cmd_ctx);
-	arm9tdmi_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;arm9&quot;,
-			NULL, COMMAND_ANY,
-			&quot;arm9 specific commands&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm9tdmi_cmd, &quot;vector_catch&quot;,
-			handle_arm9tdmi_catch_vectors_command, COMMAND_EXEC,
-			&quot;arm9 vector_catch [all|none|reset|undef|swi|pabt|dabt|irq|fiq] ...&quot;);
-
-	return retval;
+	arm7_9_register_commands(cmd_ctx);
+	return register_commands(cmd_ctx, NULL, arm9tdmi_command_handlers);
 }
 
 /** Holds methods for ARM9TDMI targets. */

commit 69908ddbd04fc9382d02819e296bb4384ef78810
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:05 2009 -0800

    arm966e: use register_commands()

diff --git a/src/target/arm966e.c b/src/target/arm966e.c
index f617875..70cc3c4 100644
--- a/src/target/arm966e.c
+++ b/src/target/arm966e.c
@@ -221,21 +221,32 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration arm966e_exec_command_handlers[] = {
+	{
+		.name = &quot;cp15&quot;,
+		.handler = arm966e_handle_cp15_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;opcode&gt; [value]&quot;,
+		.help = &quot;display/modify cp15 register&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
+static const struct command_registration arm966e_command_handlers[] = {
+	{
+		.name = &quot;arm966e&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;arm966e command group&quot;,
+		.chain = arm966e_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 /** Registers commands used to access coprocessor resources. */
 int arm966e_register_commands(struct command_context *cmd_ctx)
 {
-	int retval;
-	struct command *arm966e_cmd;
-
-	retval = arm9tdmi_register_commands(cmd_ctx);
-	arm966e_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;arm966e&quot;,
-			NULL, COMMAND_ANY,
-			&quot;arm966e specific commands&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm966e_cmd, &quot;cp15&quot;,
-			arm966e_handle_cp15_command, COMMAND_EXEC,
-			&quot;display/modify cp15 register &lt;num&gt; [value]&quot;);
-
-	return retval;
+	arm9tdmi_register_commands(cmd_ctx);
+	return register_commands(cmd_ctx, NULL, arm966e_command_handlers);
 }
 
 /** Holds methods for ARM966 targets. */

commit 11061486b5e18b43cca6a94bdd9e998d5dde44c4
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:05 2009 -0800

    arm926ejs: use register_commands()

diff --git a/src/target/arm926ejs.c b/src/target/arm926ejs.c
index 030405a..329aa12 100644
--- a/src/target/arm926ejs.c
+++ b/src/target/arm926ejs.c
@@ -756,23 +756,31 @@ static int arm926ejs_mmu(struct target *target, int *enabled)
 	return ERROR_OK;
 }
 
+static const struct command_registration arm926ejs_exec_command_handlers[] = {
+	{
+		.name = &quot;cache_info&quot;,
+		.handler = &amp;arm926ejs_handle_cache_info_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display information about target caches&quot;,
+
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration arm926ejs_command_handlers[] = {
+	{
+		.name = &quot;arm926ejs&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;arm926ejs command group&quot;,
+		.chain = arm926ejs_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 /** Registers commands to access coprocessor, cache, and debug resources.  */
 int arm926ejs_register_commands(struct command_context *cmd_ctx)
 {
-	int retval;
-	struct command *arm926ejs_cmd;
-
-	retval = arm9tdmi_register_commands(cmd_ctx);
-
-	arm926ejs_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;arm926ejs&quot;,
-		NULL, COMMAND_ANY,
-		&quot;arm926ejs specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, arm926ejs_cmd, &quot;cache_info&quot;,
-		arm926ejs_handle_cache_info_command, COMMAND_EXEC,
-		&quot;display information about target caches&quot;);
-
-	return retval;
+	arm9tdmi_register_commands(cmd_ctx);
+	return register_commands(cmd_ctx, NULL, arm926ejs_command_handlers);
 }
 
 /** Holds methods for ARM926 targets. */

commit 509fe82b07df4a7e6217bfde37374e90262aa2de
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:05 2009 -0800

    arm920t: use register_commands()

diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index e927844..1e6019c 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -1361,36 +1361,56 @@ static int arm920t_mcr(struct target *target, int cpnum, uint32_t op1, uint32_t
 	return arm920t_write_cp15_interpreted(target, mrc_opcode(cpnum, op1, op2, CRn, CRm), 0, value);
 }
 
+static const struct command_registration arm920t_exec_command_handlers[] = {
+	{
+		.name = &quot;cp15&quot;,
+		.handler = &amp;arm920t_handle_cp15_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display/modify cp15 register&quot;,
+		.usage = &quot;&lt;num&gt; [value]&quot;,
+	},
+	{
+		.name = &quot;cp15i&quot;,
+		.handler = &amp;arm920t_handle_cp15i_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display/modify cp15 (interpreted access)&quot;,
+		.usage = &quot;&lt;opcode&gt; [value] [address]&quot;,
+	},
+	{
+		.name = &quot;cache_info&quot;,
+		.handler = &amp;arm920t_handle_cache_info_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display information about target caches&quot;,
+	},
+	{
+		.name = &quot;read_cache&quot;,
+		.handler = &amp;arm920t_handle_read_cache_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display I/D cache content&quot;,
+	},
+	{
+		.name = &quot;read_mmu&quot;,
+		.handler = &amp;arm920t_handle_read_mmu_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;display I/D mmu content&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration arm920t_command_handlers[] = {
+	{
+		.name = &quot;arm920t&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;arm920t command group&quot;,
+		.chain = arm920t_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 /** Registers commands to access coprocessor, cache, and MMU resources. */
 int arm920t_register_commands(struct command_context *cmd_ctx)
 {
-	int retval;
-	struct command *arm920t_cmd;
-
-	retval = arm9tdmi_register_commands(cmd_ctx);
-
-	arm920t_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;arm920t&quot;,
-			NULL, COMMAND_ANY,
-			&quot;arm920t specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, arm920t_cmd, &quot;cp15&quot;,
-			arm920t_handle_cp15_command, COMMAND_EXEC,
-			&quot;display/modify cp15 register &lt;num&gt; [value]&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm920t_cmd, &quot;cp15i&quot;,
-			arm920t_handle_cp15i_command, COMMAND_EXEC,
-			&quot;display/modify cp15 (interpreted access) &quot;
-				&quot;&lt;opcode&gt; [value] [address]&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm920t_cmd, &quot;cache_info&quot;,
-			arm920t_handle_cache_info_command, COMMAND_EXEC,
-			&quot;display information about target caches&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm920t_cmd, &quot;read_cache&quot;,
-			arm920t_handle_read_cache_command, COMMAND_EXEC,
-			&quot;display I/D cache content&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm920t_cmd, &quot;read_mmu&quot;,
-			arm920t_handle_read_mmu_command, COMMAND_EXEC,
-			&quot;display I/D mmu content&quot;);
-
-	return retval;
+	arm9tdmi_register_commands(cmd_ctx);
+	return register_commands(cmd_ctx, NULL, arm920t_command_handlers);
 }
 
 /** Holds methods for ARM920 targets. */

commit e232dea176cc8c831e77a10903120ff057337f6c
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:05 2009 -0800

    arm7_9_common: use register_commands()

diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index 1601ee1..b40be8d 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2847,28 +2847,45 @@ int arm7_9_init_arch_info(struct target *target, struct arm7_9_common *arm7_9)
 			1, 1, target);
 }
 
+static const struct command_registration arm7_9_any_command_handlers[] = {
+	{
+		&quot;dbgrq&quot;,
+		.handler = &amp;handle_arm7_9_dbgrq_command,
+		.mode = COMMAND_ANY,
+		.usage = &quot;&lt;enable|disable&gt;&quot;,
+		.help = &quot;use EmbeddedICE dbgrq instead of breakpoint &quot;
+			&quot;for target halt requests&quot;,
+	},
+	{
+		&quot;fast_memory_access&quot;,
+		.handler = &amp;handle_arm7_9_fast_memory_access_command,
+		.mode = COMMAND_ANY,
+		.usage = &quot;&lt;enable|disable&gt;&quot;,
+		.help = &quot;use fast memory accesses instead of slower &quot;
+			&quot;but potentially safer accesses&quot;,
+	},
+	{
+		&quot;dcc_downloads&quot;,
+		.handler = &amp;handle_arm7_9_dcc_downloads_command,
+		.mode = COMMAND_ANY,
+		.usage = &quot;&lt;enable | disable&gt;&quot;,
+		.help = &quot;use DCC downloads for larger memory writes&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration arm7_9_command_handlers[] = {
+	{
+		.name = &quot;arm7_9&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;arm7/9 specific commands&quot;,
+		.chain = arm7_9_any_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int arm7_9_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *arm7_9_cmd;
-
-	arm7_9_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;arm7_9&quot;,
-			NULL, COMMAND_ANY, &quot;arm7/9 specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, arm7_9_cmd, &quot;dbgrq&quot;,
-			handle_arm7_9_dbgrq_command, COMMAND_ANY,
-			&quot;use EmbeddedICE dbgrq instead of breakpoint &quot;
-			&quot;for target halt requests &lt;enable | disable&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm7_9_cmd, &quot;fast_memory_access&quot;,
-			handle_arm7_9_fast_memory_access_command, COMMAND_ANY,
-			&quot;use fast memory accesses instead of slower &quot;
-			&quot;but potentially safer accesses &lt;enable | disable&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, arm7_9_cmd, &quot;dcc_downloads&quot;,
-			handle_arm7_9_dcc_downloads_command, COMMAND_ANY,
-			&quot;use DCC downloads for larger memory writes &lt;enable | disable&gt;&quot;);
-
 	armv4_5_register_commands(cmd_ctx);
-
 	etm_register_commands(cmd_ctx);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, arm7_9_command_handlers);
 }

commit e905fe6e756453daf27cd064285aa9cddf31b1ef
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:05 2009 -0800

    arm720t: use register_commands()

diff --git a/src/target/arm720t.c b/src/target/arm720t.c
index 4ca80e1..52a311c 100644
--- a/src/target/arm720t.c
+++ b/src/target/arm720t.c
@@ -491,23 +491,31 @@ static int arm720t_mcr(struct target *target, int cpnum, uint32_t op1, uint32_t
 	return arm720t_write_cp15(target, mrc_opcode(cpnum, op1, op2, CRn, CRm), value);
 }
 
-static int arm720t_register_commands(struct command_context *cmd_ctx)
-{
-	int retval;
-	struct command *arm720t_cmd;
-
-
-	retval = arm7_9_register_commands(cmd_ctx);
-
-	arm720t_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;arm720t&quot;,
-			NULL, COMMAND_ANY,
-			&quot;arm720t specific commands&quot;);
+static const struct command_registration arm720t_exec_command_handlers[] = {
+	{
+		.name = &quot;cp15&quot;,
+		.handler = arm720t_handle_cp15_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;opcode&gt; [value]&quot;,
+		.help = &quot;display/modify cp15 register&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
 
-	COMMAND_REGISTER(cmd_ctx, arm720t_cmd, &quot;cp15&quot;,
-			arm720t_handle_cp15_command, COMMAND_EXEC,
-			&quot;display/modify cp15 register &lt;opcode&gt; [value]&quot;);
+static const struct command_registration arm720t_command_handlers[] = {
+	{
+		.name = &quot;arm720t&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;arm720t command group&quot;,
+		.chain = arm720t_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
 
-	return ERROR_OK;
+static int arm720t_register_commands(struct command_context *cmd_ctx)
+{
+	arm7_9_register_commands(cmd_ctx);
+	return register_commands(cmd_ctx, NULL, arm720t_command_handlers);
 }
 
 /** Holds methods for ARM720 targets. */

commit b40f265f9cb9e6be4c979e7f4e10072822dcb5c7
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 23 07:43:05 2009 -0800

    arm11: use register_commands()

diff --git a/src/target/arm11.c b/src/target/arm11.c
index 66954fa..835234c 100644
--- a/src/target/arm11.c
+++ b/src/target/arm11.c
@@ -1565,44 +1565,71 @@ static int arm11_mcr(struct target *target, int cpnum,
 	return arm11_mrc_inner(target, cpnum, op1, op2, CRn, CRm, &amp;value, false);
 }
 
+static const struct command_registration arm11_mw_command_handlers[] = {
+	{
+		.name = &quot;burst&quot;,
+		.handler = &amp;arm11_handle_bool_memwrite_burst,
+		.mode = COMMAND_ANY,
+		.help = &quot;Enable/Disable non-standard but fast burst mode&quot;
+			&quot; (default: enabled)&quot;,
+	},
+	{
+		.name = &quot;error_fatal&quot;,
+		.handler = &amp;arm11_handle_bool_memwrite_error_fatal,
+		.mode = COMMAND_ANY,
+		.help = &quot;Terminate program if transfer error was found&quot;
+			&quot; (default: enabled)&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration arm11_any_command_handlers[] = {
+	{
+		/* &quot;hardware_step&quot; is only here to check if the default
+		 * simulate + breakpoint implementation is broken.
+		 * TEMPORARY! NOT DOCUMENTED! */
+		.name = &quot;hardware_step&quot;,
+		.handler = &amp;arm11_handle_bool_hardware_step,
+		.mode = COMMAND_ANY,
+		.help = &quot;DEBUG ONLY - Hardware single stepping&quot;
+			&quot; (default: disabled)&quot;,
+		.usage = &quot;(enable|disable)&quot;,
+	},
+	{
+		.name = &quot;memwrite&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;memwrite command group&quot;,
+		.chain = arm11_mw_command_handlers,
+	},
+	{
+		.name = &quot;step_irq_enable&quot;,
+		.handler = &amp;arm11_handle_bool_step_irq_enable,
+		.mode = COMMAND_ANY,
+		.help = &quot;Enable interrupts while stepping&quot;
+			&quot; (default: disabled)&quot;,
+	},
+	{
+		.name = &quot;vcr&quot;,
+		.handler = &amp;arm11_handle_vcr,
+		.mode = COMMAND_ANY,
+		.help = &quot;Control (Interrupt) Vector Catch Register&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration arm11_command_handlers[] = {
+	{
+		.name = &quot;arm11&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;ARM11 command group&quot;,
+		.chain = arm11_any_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int arm11_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *top_cmd, *mw_cmd;
-
 	armv4_5_register_commands(cmd_ctx);
-
-	top_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;arm11&quot;,
-			NULL, COMMAND_ANY, NULL);
-
-	/* &quot;hardware_step&quot; is only here to check if the default
-	 * simulate + breakpoint implementation is broken.
-	 * TEMPORARY! NOT DOCUMENTED!
-	 */
-	COMMAND_REGISTER(cmd_ctx, top_cmd, &quot;hardware_step&quot;,
-			arm11_handle_bool_hardware_step, COMMAND_ANY,
-			&quot;DEBUG ONLY - Hardware single stepping&quot;
-				&quot; (default: disabled)&quot;);
-
-	mw_cmd = COMMAND_REGISTER(cmd_ctx, top_cmd, &quot;memwrite&quot;,
-			NULL, COMMAND_ANY, NULL);
-	COMMAND_REGISTER(cmd_ctx, mw_cmd, &quot;burst&quot;,
-			arm11_handle_bool_memwrite_burst, COMMAND_ANY,
-			&quot;Enable/Disable non-standard but fast burst mode&quot;
-				&quot; (default: enabled)&quot;);
-	COMMAND_REGISTER(cmd_ctx, mw_cmd, &quot;error_fatal&quot;,
-			arm11_handle_bool_memwrite_error_fatal, COMMAND_ANY,
-			&quot;Terminate program if transfer error was found&quot;
-				&quot; (default: enabled)&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, top_cmd, &quot;step_irq_enable&quot;,
-			arm11_handle_bool_step_irq_enable, COMMAND_ANY,
-			&quot;Enable interrupts while stepping&quot;
-				&quot; (default: disabled)&quot;);
-	COMMAND_REGISTER(cmd_ctx, top_cmd, &quot;vcr&quot;,
-			arm11_handle_vcr, COMMAND_ANY,
-			&quot;Control (Interrupt) Vector Catch Register&quot;);
-
-	return etm_register_commands(cmd_ctx);
+	etm_register_commands(cmd_ctx);
+	return register_commands(cmd_ctx, NULL, arm11_command_handlers);
 }
 
 /** Holds methods for ARM11xx targets. */

-----------------------------------------------------------------------

Summary of changes:
 src/target/arm11.c          |  106 +++++++++------
 src/target/arm720t.c        |   41 +++---
 src/target/arm7_9_common.c  |   66 ++++++----
 src/target/arm7_9_common.h  |    2 +-
 src/target/arm7tdmi.c       |    2 +-
 src/target/arm920t.c        |   80 +++++++-----
 src/target/arm920t.h        |    3 +-
 src/target/arm926ejs.c      |   40 +++---
 src/target/arm926ejs.h      |    3 +-
 src/target/arm966e.c        |   39 +++--
 src/target/arm966e.h        |    3 +-
 src/target/arm9tdmi.c       |   38 +++--
 src/target/arm9tdmi.h       |    2 +-
 src/target/armv4_5.c        |   53 +++++---
 src/target/armv4_5.h        |    5 +-
 src/target/armv7a.c         |   75 ++++++----
 src/target/armv7a.h         |    3 +-
 src/target/armv7m.c         |   77 ++++++----
 src/target/armv7m.h         |    3 +-
 src/target/avrt.c           |   10 --
 src/target/cortex_a8.c      |   55 ++++----
 src/target/cortex_m3.c      |   63 ++++++---
 src/target/etb.c            |   31 +++--
 src/target/etm.c            |  130 ++++++++++++------
 src/target/etm.h            |    4 +-
 src/target/etm_dummy.c      |   30 +++--
 src/target/fa526.c          |    2 +-
 src/target/feroceon.c       |    4 +-
 src/target/mips32.c         |    5 -
 src/target/mips_m4k.c       |   10 --
 src/target/oocd_trace.c     |   63 ++++++---
 src/target/target.c         |  317 ++++++++++++++++++++++++++++---------------
 src/target/target_request.c |   29 +++-
 src/target/target_type.h    |    2 +-
 src/target/trace.c          |   39 ++++--
 src/target/xscale.c         |  141 +++++++++++++++----
 36 files changed, 998 insertions(+), 578 deletions(-)


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001861.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-615-g90d09e3
</A></li>
	<LI>Next message: <A HREF="001863.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-651-g4946925
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1862">[ date ]</a>
              <a href="thread.html#1862">[ thread ]</a>
              <a href="subject.html#1862">[ subject ]</a>
              <a href="author.html#1862">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
