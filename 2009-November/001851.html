<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-541-g0583cb0
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-541-g0583cb0&In-Reply-To=%3CE1NCqKO-00077X-OD%40sfp-scmshell-4.v30.ch3.sourceforge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001850.html">
   <LINK REL="Next"  HREF="001852.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-541-g0583cb0</H1>
    <B>&#216;yvind Harboe</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-541-g0583cb0&In-Reply-To=%3CE1NCqKO-00077X-OD%40sfp-scmshell-4.v30.ch3.sourceforge.com%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-541-g0583cb0">gowinex at users.sourceforge.net
       </A><BR>
    <I>Tue Nov 24 09:00:47 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001850.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-540-g0d06a06
</A></li>
        <LI>Next message: <A HREF="001852.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-545-g6ff33a4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1851">[ date ]</a>
              <a href="thread.html#1851">[ thread ]</a>
              <a href="subject.html#1851">[ subject ]</a>
              <a href="author.html#1851">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  0583cb0a0d222787c4048f9362292c5db9d969b0 (commit)
      from  0d06a06f8bb7d0dcb91ec7d31ab00c0c730f1cf4 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 0583cb0a0d222787c4048f9362292c5db9d969b0
Author: Andreas Fritiofson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">andreas.fritiofson at gmail.com</A>&gt;
Date:   Tue Nov 24 00:32:54 2009 +0100

    support for scripts in $HOME/.openocd
    
    Add $HOME/.openocd as the first default script search directory, allowing
    the user to override the standard scripts.
    
    Update the user guide with information on where OpenOCD expects to find
    configuration files and scripts. Also fixed some minor formatting issues.
    
    Add entry to NEWS as well.
    
    Signed-off-by: Andreas Fritiofson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">andreas.fritiofson at gmail.com</A>&gt;
    Signed-off-by: &#195;&#152;yvind Harboe &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">oyvind.harboe at zylin.com</A>&gt;

diff --git a/NEWS b/NEWS
index 1a024e4..0dcc4bc 100644
--- a/NEWS
+++ b/NEWS
@@ -19,6 +19,7 @@ Flash Layer:
 Board, Target, and Interface Configuration Scripts:
 	ARM9
 		- ETM and ETB hookup for iMX2* targets
+	Add $HOME/.openocd to the search path.
 
 Documentation:
 Build and Release:
diff --git a/doc/openocd.texi b/doc/openocd.texi
index cff7fc5..e94c9d0 100644
--- a/doc/openocd.texi
+++ b/doc/openocd.texi
@@ -483,14 +483,24 @@ bash$ openocd --help
 --pipe       | -p       use pipes when talking to gdb
 @end verbatim
 
-By default OpenOCD reads the file configuration file @file{openocd.cfg}
-in the current directory.  To specify a different (or multiple)
-configuration file, you can use the ``-f'' option. For example:
+By default OpenOCD reads the configuration file @file{openocd.cfg}.
+To specify a different (or multiple)
+configuration file, you can use the @option{-f} option. For example:
 
 @example
 openocd -f config1.cfg -f config2.cfg -f config3.cfg
 @end example
 
+Configuration files and scripts are searched for in
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at enumerate</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> the current directory,
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> any search dir specified on the command line using the @option{-s} option,
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> @file{$HOME/.openocd} (not on Windows),
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> the site wide script library @file{$pkgdatadir/site} and
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at item</A> the OpenOCD-supplied script library @file{$pkgdatadir/scripts}.
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">+ at end</A> enumerate
+The first found file with a matching file name will be used.
+
 OpenOCD starts by processing the configuration commands provided
 on the command line or in @file{openocd.cfg}.
 @xref{Configuration Stage}.
@@ -507,7 +517,7 @@ clients (Telnet, GDB, Other) and processes the commands issued through
 those channels.
 
 If you are having problems, you can enable internal debug messages via
-the ``-d'' option.
+the @option{-d} option.
 
 Also it is possible to interleave JIM-Tcl commands w/config scripts using the
 @option{-c} command line switch.
@@ -523,10 +533,6 @@ setting from within a telnet or gdb session using @command{debug_level
 You can redirect all output from the daemon to a file using the
 @option{-l &lt;logfile&gt;} switch.
 
-Search paths for config/script files can be added to OpenOCD by using
-the @option{-s &lt;search&gt;} switch. The current directory and the OpenOCD
-target library is in the search path by default.
-
 For details on the @option{-p} option. @xref{Connecting to GDB}.
 
 Note! OpenOCD will launch the GDB &amp; telnet server even if it can not
diff --git a/src/helper/options.c b/src/helper/options.c
index 874196e..3db96fd 100644
--- a/src/helper/options.c
+++ b/src/helper/options.c
@@ -101,7 +101,22 @@ static void add_default_dirs(void)
 	 * listed last in the built-in search order, so the user can
 	 * override these scripts with site-specific customizations.
 	 */
-	/// @todo Implement @c add_script_search_dir(&quot;${HOME}/.openocd&quot;).
+
+	const char *home = getenv(&quot;HOME&quot;);
+
+	if (home) 
+	{
+		char *path;
+
+		path = alloc_printf(&quot;%s/.openocd&quot;, home);
+
+		if (path) 
+	        {
+			add_script_search_dir(path);
+			free(path);
+		}
+	}
+
 	add_script_search_dir(PKGDATADIR &quot;/site&quot;);
 	add_script_search_dir(PKGDATADIR &quot;/scripts&quot;);
 #endif

-----------------------------------------------------------------------

Summary of changes:
 NEWS                 |    1 +
 doc/openocd.texi     |   22 ++++++++++++++--------
 src/helper/options.c |   17 ++++++++++++++++-
 3 files changed, 31 insertions(+), 9 deletions(-)


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001850.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-540-g0d06a06
</A></li>
	<LI>Next message: <A HREF="001852.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-545-g6ff33a4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1851">[ date ]</a>
              <a href="thread.html#1851">[ thread ]</a>
              <a href="subject.html#1851">[ subject ]</a>
              <a href="author.html#1851">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
