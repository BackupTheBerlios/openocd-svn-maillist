<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-615-g90d09e3
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-615-g90d09e3&In-Reply-To=%3CE1NDN3D-0007YH-AT%40sfp-scmshell-2.v30.ch3.sourceforge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001860.html">
   <LINK REL="Next"  HREF="001862.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-615-g90d09e3</H1>
    <B>Zach Welch</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-615-g90d09e3&In-Reply-To=%3CE1NDN3D-0007YH-AT%40sfp-scmshell-2.v30.ch3.sourceforge.com%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-615-g90d09e3">zwelch at users.sourceforge.net
       </A><BR>
    <I>Wed Nov 25 19:57:14 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001860.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-595-g8d46720
</A></li>
        <LI>Next message: <A HREF="001862.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-637-gf74e2e0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1861">[ date ]</a>
              <a href="thread.html#1861">[ thread ]</a>
              <a href="subject.html#1861">[ subject ]</a>
              <a href="author.html#1861">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  90d09e35e4be6f0b35899238b253154249f85cb6 (commit)
       via  ad090413a8dfacccc993ff15b8376e0f2bd56712 (commit)
       via  6b9bb584a5edec4889b12ed3f99a1e2eeab1ada2 (commit)
       via  b4e95c37205bae2c22d9c223a4e92bcea38bf7dd (commit)
       via  5e977b46c3a4688d9bf5091306ce3003f1bd6713 (commit)
       via  dfa856ca186bd703b3c75f374b4f84dff372345c (commit)
       via  f9606a6cb72d8bce8964b66e5aa5eec5d98a7b1d (commit)
       via  737f8f2735011256f9ca5a3988ee02167f2847a2 (commit)
       via  0ff0dbba497374dddac9641b466e97d67bb6678d (commit)
       via  ccae9ae0200a66472409334d18108b309a9fae70 (commit)
       via  1bf7462edb89a79835e8bd42905d69282ba4ba17 (commit)
       via  7609e1091abfacfc1b62aca06c642e42003aa444 (commit)
       via  1cbe3ec6f105e35e641293cd7e62e6fefac1b271 (commit)
       via  a12a29c28a92f51861957a09d86177625220483b (commit)
       via  b90bf52be340d8ad2285f2f359174fbc1e31ce24 (commit)
       via  1765b103044179baa2d5036bb61710369ae59e70 (commit)
       via  b595ab8b97ae15babe530a935bb5009cdb02fcd7 (commit)
       via  c4aa2fd6e745d7d9fb82673f5845a09c98b10912 (commit)
       via  bdae918dcd3bbcd1a90b2c5f65291908271727f7 (commit)
       via  2a4a94b7ac4401802832f37ef07b0500efc92f0e (commit)
      from  8d46720cda288f498787a706bb2518e6f852b9f1 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 90d09e35e4be6f0b35899238b253154249f85cb6
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 06:24:19 2009 -0800

    remove nand_controller-&gt;register_callbacks
    
    Replace flash_driver callback with pointer to command_registration.
    Eliminates all related routines and allows drivers to omit commands.

diff --git a/src/flash/davinci_nand.c b/src/flash/davinci_nand.c
index ebd9ba8..72cd378 100644
--- a/src/flash/davinci_nand.c
+++ b/src/flash/davinci_nand.c
@@ -78,11 +78,6 @@ static int halted(struct target *target, const char *label)
 	return false;
 }
 
-static int davinci_register_commands(struct command_context *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 static int davinci_init(struct nand_device *nand)
 {
 	struct davinci_nand *info = nand-&gt;controller_priv;
@@ -747,7 +742,6 @@ fail:
 struct nand_flash_controller davinci_nand_controller = {
 	.name			= &quot;davinci&quot;,
 	.nand_device_command	= davinci_nand_device_command,
-	.register_commands	= davinci_register_commands,
 	.init			= davinci_init,
 	.reset			= davinci_reset,
 	.command		= davinci_command,
diff --git a/src/flash/lpc3180_nand_controller.c b/src/flash/lpc3180_nand_controller.c
index 2dec3e1..146c843 100644
--- a/src/flash/lpc3180_nand_controller.c
+++ b/src/flash/lpc3180_nand_controller.c
@@ -893,15 +893,10 @@ static const struct command_registration lpc3180_command_handler[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int lpc3180_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, lpc3180_command_handler);
-}
-
 struct nand_flash_controller lpc3180_nand_controller = {
 		.name = &quot;lpc3180&quot;,
+		.commands = lpc3180_command_handler,
 		.nand_device_command = lpc3180_nand_device_command,
-		.register_commands = lpc3180_register_commands,
 		.init = lpc3180_init,
 		.reset = lpc3180_reset,
 		.command = lpc3180_command,
diff --git a/src/flash/mx3_nand.c b/src/flash/mx3_nand.c
index 459e2a6..1dc4fcb 100644
--- a/src/flash/mx3_nand.c
+++ b/src/flash/mx3_nand.c
@@ -315,11 +315,6 @@ static int imx31_nand_ready (struct nand_device *nand, int timeout)
 	return imx31_controller_ready (nand, timeout);
 }
 
-static int imx31_register_commands (struct command_context *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 static int imx31_reset (struct nand_device *nand)
 {
 	/*
@@ -871,7 +866,6 @@ static int do_data_output (struct nand_device *nand)
 struct nand_flash_controller imx31_nand_flash_controller = {
 		.name = &quot;imx31&quot;,
 		.nand_device_command = &amp;imx31_nand_device_command,
-		.register_commands = &amp;imx31_register_commands,
 		.init = &amp;imx31_init,
 		.reset = &amp;imx31_reset,
 		.command = &amp;imx31_command,
diff --git a/src/flash/nand.c b/src/flash/nand.c
index bc0e350..1e28ba2 100644
--- a/src/flash/nand.c
+++ b/src/flash/nand.c
@@ -214,11 +214,12 @@ COMMAND_HANDLER(handle_nand_list_drivers)
 static COMMAND_HELPER(create_nand_device, const char *bank_name,
 		struct nand_flash_controller *controller)
 {
-	int retval = controller-&gt;register_commands(CMD_CTX);
-	if (ERROR_OK != retval)
+	if (NULL != controller-&gt;commands)
 	{
-		LOG_ERROR(&quot;couldn't register '%s' commands&quot;, controller-&gt;name);
-		return retval;
+		int retval = register_commands(CMD_CTX, NULL,
+				controller-&gt;commands);
+		if (ERROR_OK != retval)
+			return retval;
 	}
 	struct nand_device *c = malloc(sizeof(struct nand_device));
 
@@ -233,7 +234,7 @@ static COMMAND_HELPER(create_nand_device, const char *bank_name,
 	c-&gt;use_raw = 0;
 	c-&gt;next = NULL;
 
-	retval = CALL_COMMAND_HANDLER(controller-&gt;nand_device_command, c);
+	int retval = CALL_COMMAND_HANDLER(controller-&gt;nand_device_command, c);
 	if (ERROR_OK != retval)
 	{
 		LOG_ERROR(&quot;'%s' driver rejected nand flash&quot;, controller-&gt;name);
diff --git a/src/flash/nand.h b/src/flash/nand.h
index af52c77..b780f28 100644
--- a/src/flash/nand.h
+++ b/src/flash/nand.h
@@ -35,8 +35,8 @@ struct nand_device;
 struct nand_flash_controller
 {
 	char *name;
+	const struct command_registration *commands;
 	__NAND_DEVICE_COMMAND((*nand_device_command));
-	int (*register_commands)(struct command_context *cmd_ctx);
 	int (*init)(struct nand_device *nand);
 	int (*reset)(struct nand_device *nand);
 	int (*command)(struct nand_device *nand, uint8_t command);
diff --git a/src/flash/orion_nand.c b/src/flash/orion_nand.c
index c8fc969..77a03f2 100644
--- a/src/flash/orion_nand.c
+++ b/src/flash/orion_nand.c
@@ -120,11 +120,6 @@ static int orion_nand_controller_ready(struct nand_device *nand, int timeout)
 	return 1;
 }
 
-static int orion_nand_register_commands(struct command_context *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 NAND_DEVICE_COMMAND_HANDLER(orion_nand_device_command)
 {
 	struct orion_nand_controller *hw;
@@ -180,7 +175,6 @@ struct nand_flash_controller orion_nand_controller =
 	.reset			= orion_nand_reset,
 	.controller_ready	= orion_nand_controller_ready,
 	.nand_device_command	= orion_nand_device_command,
-	.register_commands	= orion_nand_register_commands,
 	.init			= orion_nand_init,
 };
 
diff --git a/src/flash/s3c2410_nand.c b/src/flash/s3c2410_nand.c
index 6fe8bae..ca50c99 100644
--- a/src/flash/s3c2410_nand.c
+++ b/src/flash/s3c2410_nand.c
@@ -110,7 +110,6 @@ static int s3c2410_nand_ready(struct nand_device *nand, int timeout)
 struct nand_flash_controller s3c2410_nand_controller = {
 		.name = &quot;s3c2410&quot;,
 		.nand_device_command = &amp;s3c2410_nand_device_command,
-		.register_commands = &amp;s3c24xx_register_commands,
 		.init = &amp;s3c2410_init,
 		.reset = &amp;s3c24xx_reset,
 		.command = &amp;s3c24xx_command,
diff --git a/src/flash/s3c2412_nand.c b/src/flash/s3c2412_nand.c
index 2ca4cd3..acc6d99 100644
--- a/src/flash/s3c2412_nand.c
+++ b/src/flash/s3c2412_nand.c
@@ -64,7 +64,6 @@ static int s3c2412_init(struct nand_device *nand)
 struct nand_flash_controller s3c2412_nand_controller = {
 		.name = &quot;s3c2412&quot;,
 		.nand_device_command = &amp;s3c2412_nand_device_command,
-		.register_commands = &amp;s3c24xx_register_commands,
 		.init = &amp;s3c2412_init,
 		.reset = &amp;s3c24xx_reset,
 		.command = &amp;s3c24xx_command,
diff --git a/src/flash/s3c2440_nand.c b/src/flash/s3c2440_nand.c
index 65e5a51..556f6f1 100644
--- a/src/flash/s3c2440_nand.c
+++ b/src/flash/s3c2440_nand.c
@@ -156,7 +156,6 @@ int s3c2440_write_block_data(struct nand_device *nand, uint8_t *data, int data_s
 struct nand_flash_controller s3c2440_nand_controller = {
 		.name = &quot;s3c2440&quot;,
 		.nand_device_command = &amp;s3c2440_nand_device_command,
-		.register_commands = &amp;s3c24xx_register_commands,
 		.init = &amp;s3c2440_init,
 		.reset = &amp;s3c24xx_reset,
 		.command = &amp;s3c24xx_command,
diff --git a/src/flash/s3c2443_nand.c b/src/flash/s3c2443_nand.c
index 5afb26f..311bb69 100644
--- a/src/flash/s3c2443_nand.c
+++ b/src/flash/s3c2443_nand.c
@@ -65,7 +65,6 @@ static int s3c2443_init(struct nand_device *nand)
 struct nand_flash_controller s3c2443_nand_controller = {
 		.name = &quot;s3c2443&quot;,
 		.nand_device_command = &amp;s3c2443_nand_device_command,
-		.register_commands = &amp;s3c24xx_register_commands,
 		.init = &amp;s3c2443_init,
 		.reset = &amp;s3c24xx_reset,
 		.command = &amp;s3c24xx_command,
diff --git a/src/flash/s3c24xx_nand.c b/src/flash/s3c24xx_nand.c
index 262569e..e7afb48 100644
--- a/src/flash/s3c24xx_nand.c
+++ b/src/flash/s3c24xx_nand.c
@@ -52,11 +52,6 @@ S3C24XX_DEVICE_COMMAND()
 	return ERROR_OK;
 }
 
-int s3c24xx_register_commands(struct command_context *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 int s3c24xx_reset(struct nand_device *nand)
 {
 	struct s3c24xx_nand_controller *s3c24xx_info = nand-&gt;controller_priv;
diff --git a/src/flash/s3c24xx_nand.h b/src/flash/s3c24xx_nand.h
index 4829c7c..fad33a0 100644
--- a/src/flash/s3c24xx_nand.h
+++ b/src/flash/s3c24xx_nand.h
@@ -59,8 +59,6 @@ S3C24XX_DEVICE_COMMAND();
 			return retval; \
 	} while (0)
 
-int s3c24xx_register_commands(struct command_context *cmd_ctx);
-
 int s3c24xx_reset(struct nand_device *nand);
 
 int s3c24xx_command(struct nand_device *nand, uint8_t command);

commit ad090413a8dfacccc993ff15b8376e0f2bd56712
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 06:12:04 2009 -0800

    remove flash_driver-&gt;register_callbacks
    
    Replace flash_driver callback with pointer to command_registration.
    Eliminates all related routines and allows drivers to omit commands.

diff --git a/src/flash/at91sam3.c b/src/flash/at91sam3.c
index 75e8495..be17a5f 100644
--- a/src/flash/at91sam3.c
+++ b/src/flash/at91sam3.c
@@ -2501,14 +2501,9 @@ static const struct command_registration at91sam3_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int sam3_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, at91sam3_command_handlers);
-}
-
 struct flash_driver at91sam3_flash = {
 		.name = &quot;at91sam3&quot;,
-		.register_commands = &amp;sam3_register_commands,
+		.commands = at91sam3_command_handlers,
 		.flash_bank_command = &amp;sam3_flash_bank_command,
 		.erase = &amp;sam3_erase,
 		.protect = &amp;sam3_protect,
diff --git a/src/flash/at91sam7.c b/src/flash/at91sam7.c
index 0204660..f9b87ba 100644
--- a/src/flash/at91sam7.c
+++ b/src/flash/at91sam7.c
@@ -1198,14 +1198,9 @@ static const struct command_registration at91sam7_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int at91sam7_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, at91sam7_command_handlers);
-}
-
 struct flash_driver at91sam7_flash = {
 		.name = &quot;at91sam7&quot;,
-		.register_commands = &amp;at91sam7_register_commands,
+		.commands = at91sam7_command_handlers,
 		.flash_bank_command = &amp;at91sam7_flash_bank_command,
 		.erase = &amp;at91sam7_erase,
 		.protect = &amp;at91sam7_protect,
diff --git a/src/flash/avrf.c b/src/flash/avrf.c
index 9aea47d..1c48464 100644
--- a/src/flash/avrf.c
+++ b/src/flash/avrf.c
@@ -468,14 +468,9 @@ static const struct command_registration avrf_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int avrf_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, avrf_command_handlers);
-}
-
 struct flash_driver avr_flash = {
 		.name = &quot;avr&quot;,
-		.register_commands = &amp;avrf_register_commands,
+		.commands = avrf_command_handlers,
 		.flash_bank_command = &amp;avrf_flash_bank_command,
 		.erase = &amp;avrf_erase,
 		.protect = &amp;avrf_protect,
diff --git a/src/flash/cfi.c b/src/flash/cfi.c
index b92ecbd..6dbffb9 100644
--- a/src/flash/cfi.c
+++ b/src/flash/cfi.c
@@ -589,11 +589,6 @@ static int cfi_intel_info(struct flash_bank *bank, char *buf, int buf_size)
 	return ERROR_OK;
 }
 
-static int cfi_register_commands(struct command_context *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 /* flash_bank cfi &lt;base&gt; &lt;size&gt; &lt;chip_width&gt; &lt;bus_width&gt; &lt;target#&gt; [options]
  */
 FLASH_BANK_COMMAND_HANDLER(cfi_flash_bank_command)
@@ -2623,7 +2618,6 @@ static int cfi_info(struct flash_bank *bank, char *buf, int buf_size)
 
 struct flash_driver cfi_flash = {
 		.name = &quot;cfi&quot;,
-		.register_commands = &amp;cfi_register_commands,
 		.flash_bank_command = &amp;cfi_flash_bank_command,
 		.erase = &amp;cfi_erase,
 		.protect = &amp;cfi_protect,
diff --git a/src/flash/ecos.c b/src/flash/ecos.c
index f6f3307..7a0b26f 100644
--- a/src/flash/ecos.c
+++ b/src/flash/ecos.c
@@ -336,11 +336,6 @@ static int ecosflash_probe(struct flash_bank *bank)
 	return ERROR_OK;
 }
 
-static int ecosflash_register_commands(struct command_context *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 #if 0
 static void command(struct flash_bank *bank, uint8_t cmd, uint8_t *cmd_buf)
 {
@@ -437,7 +432,6 @@ static int ecosflash_handle_gpnvm_command(struct command_context *cmd_ctx, char
 
 struct flash_driver ecosflash_flash = {
 		.name = &quot;ecosflash&quot;,
-		.register_commands = &amp;ecosflash_register_commands,
 		.flash_bank_command = &amp;ecosflash_flash_bank_command,
 		.erase = &amp;ecosflash_erase,
 		.protect = &amp;ecosflash_protect,
diff --git a/src/flash/faux.c b/src/flash/faux.c
index 558d7b0..adfc7bd 100644
--- a/src/flash/faux.c
+++ b/src/flash/faux.c
@@ -87,11 +87,6 @@ FLASH_BANK_COMMAND_HANDLER(faux_flash_bank_command)
 	return ERROR_OK;
 }
 
-static int faux_register_commands(struct command_context *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 static int faux_erase(struct flash_bank *bank, int first, int last)
 {
 	struct faux_flash_bank *info = bank-&gt;driver_priv;
@@ -130,7 +125,6 @@ static int faux_probe(struct flash_bank *bank)
 
 struct flash_driver faux_flash = {
 		.name = &quot;faux&quot;,
-		.register_commands = &amp;faux_register_commands,
 		.flash_bank_command = &amp;faux_flash_bank_command,
 		.erase = &amp;faux_erase,
 		.protect = &amp;faux_protect,
diff --git a/src/flash/flash.c b/src/flash/flash.c
index de95b62..4584c5d 100644
--- a/src/flash/flash.c
+++ b/src/flash/flash.c
@@ -263,15 +263,20 @@ COMMAND_HANDLER(handle_flash_bank_command)
 		if (strcmp(driver_name, flash_drivers[i]-&gt;name) != 0)
 			continue;
 
-		struct flash_bank *p, *c;
-
 		/* register flash specific commands */
-		if (flash_drivers[i]-&gt;register_commands(CMD_CTX) != ERROR_OK)
+		if (NULL != flash_drivers[i]-&gt;commands)
 		{
-			LOG_ERROR(&quot;couldn't register '%s' commands&quot;, driver_name);
-			return ERROR_FAIL;
+			int retval = register_commands(CMD_CTX, NULL,
+					flash_drivers[i]-&gt;commands);
+			if (ERROR_OK != retval)
+			{
+				LOG_ERROR(&quot;couldn't register '%s' commands&quot;,
+						driver_name);
+				return ERROR_FAIL;
+			}
 		}
 
+		struct flash_bank *p, *c;
 		c = malloc(sizeof(struct flash_bank));
 		c-&gt;name = strdup(bank_name);
 		c-&gt;target = target;
diff --git a/src/flash/flash.h b/src/flash/flash.h
index ac1600e..92727bf 100644
--- a/src/flash/flash.h
+++ b/src/flash/flash.h
@@ -91,13 +91,11 @@ struct flash_driver
 	char *name;
 
 	/**
-	 * Registers driver-specific commands.  When called (during the
-	 * &quot;flash bank&quot; command), the driver may register addition
+	 * An array of driver-specific commands to register.  When called
+	 * during the &quot;flash bank&quot; command, the driver can register addition
 	 * commands to support new flash chip functions.
-	 *
-	 * @returns ERROR_OK if successful; otherwise, an error code.
 	 */
-	int (*register_commands)(struct command_context *cmd_ctx);
+	const struct command_registration *commands;
 
 	/**
 	 * Finish the &quot;flash bank&quot; command for @a bank.  The
diff --git a/src/flash/lpc2000.c b/src/flash/lpc2000.c
index 896b794..418b5b0 100644
--- a/src/flash/lpc2000.c
+++ b/src/flash/lpc2000.c
@@ -795,14 +795,9 @@ static const struct command_registration lpc2000_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int lpc2000_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, lpc2000_command_handlers);
-}
-
 struct flash_driver lpc2000_flash = {
 		.name = &quot;lpc2000&quot;,
-		.register_commands = &amp;lpc2000_register_commands,
+		.commands = lpc2000_command_handlers,
 		.flash_bank_command = &amp;lpc2000_flash_bank_command,
 		.erase = &amp;lpc2000_erase,
 		.protect = &amp;lpc2000_protect,
diff --git a/src/flash/lpc2900.c b/src/flash/lpc2900.c
index 0d961e4..81e2def 100644
--- a/src/flash/lpc2900.c
+++ b/src/flash/lpc2900.c
@@ -1003,15 +1003,6 @@ static const struct command_registration lpc2900_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-/**
- * Register private command handlers.
- */
-static int lpc2900_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, lpc2900_command_handlers);
-}
-
-
 /// Evaluate flash bank command.
 FLASH_BANK_COMMAND_HANDLER(lpc2900_flash_bank_command)
 {
@@ -1830,7 +1821,7 @@ static int lpc2900_info(struct flash_bank *bank, char *buf, int buf_size)
 struct flash_driver lpc2900_flash =
 {
 	.name               = &quot;lpc2900&quot;,
-	.register_commands  = lpc2900_register_commands,
+	.commands           = lpc2900_command_handlers,
 	.flash_bank_command = lpc2900_flash_bank_command,
 	.erase              = lpc2900_erase,
 	.protect            = lpc2900_protect,
diff --git a/src/flash/pic32mx.c b/src/flash/pic32mx.c
index 1950e05..9bb6c97 100644
--- a/src/flash/pic32mx.c
+++ b/src/flash/pic32mx.c
@@ -907,14 +907,9 @@ static const struct command_registration pic32mx_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int pic32mx_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, pic32mx_command_handlers);
-}
-
 struct flash_driver pic32mx_flash = {
 		.name = &quot;pic32mx&quot;,
-		.register_commands = &amp;pic32mx_register_commands,
+		.commands = pic32mx_command_handlers,
 		.flash_bank_command = &amp;pic32mx_flash_bank_command,
 		.erase = &amp;pic32mx_erase,
 		.protect = &amp;pic32mx_protect,
diff --git a/src/flash/stellaris.c b/src/flash/stellaris.c
index 1cff486..771f0a7 100644
--- a/src/flash/stellaris.c
+++ b/src/flash/stellaris.c
@@ -1180,15 +1180,9 @@ static const struct command_registration stellaris_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int stellaris_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, stellaris_command_handlers);
-}
-
-
 struct flash_driver stellaris_flash = {
 		.name = &quot;stellaris&quot;,
-		.register_commands = &amp;stellaris_register_commands,
+		.commands = stellaris_command_handlers,
 		.flash_bank_command = &amp;stellaris_flash_bank_command,
 		.erase = &amp;stellaris_erase,
 		.protect = &amp;stellaris_protect,
diff --git a/src/flash/stm32x.c b/src/flash/stm32x.c
index 808e32c..2f51aa5 100644
--- a/src/flash/stm32x.c
+++ b/src/flash/stm32x.c
@@ -1225,13 +1225,9 @@ static const struct command_registration stm32x_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int stm32x_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, stm32x_command_handlers);
-}
 struct flash_driver stm32x_flash = {
 		.name = &quot;stm32x&quot;,
-		.register_commands = &amp;stm32x_register_commands,
+		.commands = stm32x_command_handlers,
 		.flash_bank_command = &amp;stm32x_flash_bank_command,
 		.erase = &amp;stm32x_erase,
 		.protect = &amp;stm32x_protect,
diff --git a/src/flash/str7x.c b/src/flash/str7x.c
index e72946f..7edffac 100644
--- a/src/flash/str7x.c
+++ b/src/flash/str7x.c
@@ -691,14 +691,9 @@ static const struct command_registration str7x_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int str7x_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, str7x_command_handlers);
-}
-
 struct flash_driver str7x_flash = {
 		.name = &quot;str7x&quot;,
-		.register_commands = &amp;str7x_register_commands,
+		.commands = str7x_command_handlers,
 		.flash_bank_command = &amp;str7x_flash_bank_command,
 		.erase = &amp;str7x_erase,
 		.protect = &amp;str7x_protect,
diff --git a/src/flash/str9x.c b/src/flash/str9x.c
index f6ad51a..98f15e7 100644
--- a/src/flash/str9x.c
+++ b/src/flash/str9x.c
@@ -696,14 +696,9 @@ static const struct command_registration str9x_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int str9x_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, str9x_command_handlers);
-}
-
 struct flash_driver str9x_flash = {
 		.name = &quot;str9x&quot;,
-		.register_commands = &amp;str9x_register_commands,
+		.commands = str9x_command_handlers,
 		.flash_bank_command = &amp;str9x_flash_bank_command,
 		.erase = &amp;str9x_erase,
 		.protect = &amp;str9x_protect,
diff --git a/src/flash/str9xpec.c b/src/flash/str9xpec.c
index 7f6a29a..96e1259 100644
--- a/src/flash/str9xpec.c
+++ b/src/flash/str9xpec.c
@@ -1242,15 +1242,9 @@ static const struct command_registration str9xpec_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int str9xpec_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, str9xpec_command_handlers);
-}
-
-
 struct flash_driver str9xpec_flash = {
 		.name = &quot;str9xpec&quot;,
-		.register_commands = &amp;str9xpec_register_commands,
+		.commands = str9xpec_command_handlers,
 		.flash_bank_command = &amp;str9xpec_flash_bank_command,
 		.erase = &amp;str9xpec_erase,
 		.protect = &amp;str9xpec_protect,
diff --git a/src/flash/tms470.c b/src/flash/tms470.c
index 3f32b51..682013e 100644
--- a/src/flash/tms470.c
+++ b/src/flash/tms470.c
@@ -848,11 +848,6 @@ static const struct command_registration tms470_command_handlers[] = {
 	COMMAND_REGISTRATION_DONE
 };
 
-static int tms470_register_commands(struct command_context *cmd_ctx)
-{
-	return register_commands(cmd_ctx, NULL, tms470_command_handlers);
-}
-
 /* ---------------------------------------------------------------------- */
 
 static int tms470_erase(struct flash_bank *bank, int first, int last)
@@ -1263,7 +1258,7 @@ FLASH_BANK_COMMAND_HANDLER(tms470_flash_bank_command)
 
 struct flash_driver tms470_flash = {
 		.name = &quot;tms470&quot;,
-		.register_commands = &amp;tms470_register_commands,
+		.commands = tms470_command_handlers,
 		.flash_bank_command = &amp;tms470_flash_bank_command,
 		.erase = &amp;tms470_erase,
 		.protect = &amp;tms470_protect,

commit 6b9bb584a5edec4889b12ed3f99a1e2eeab1ada2
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    tms470: use register_commands()

diff --git a/src/flash/tms470.c b/src/flash/tms470.c
index bf58f1d..3f32b51 100644
--- a/src/flash/tms470.c
+++ b/src/flash/tms470.c
@@ -817,15 +817,40 @@ static int tms470_erase_sector(struct flash_bank *bank, int sector)
               Implementation of Flash Driver Interfaces
    ---------------------------------------------------------------------- */
 
+static const struct command_registration tms470_any_command_handlers[] = {
+	{
+		.name = &quot;flash_keyset&quot;,
+		.handler = &amp;tms470_handle_flash_keyset_command,
+		.mode = COMMAND_ANY,
+		.help = &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;,
+	},
+	{
+		.name = &quot;osc_megahertz&quot;,
+		.handler = &amp;tms470_handle_osc_megahertz_command,
+		.mode = COMMAND_ANY,
+		.help = &quot;tms470 osc_megahertz &lt;MHz&gt;&quot;,
+	},
+	{
+		.name = &quot;plldis&quot;,
+		.handler = &amp;tms470_handle_plldis_command,
+		.mode = COMMAND_ANY,
+		.help = &quot;tms470 plldis &lt;0/1&gt;&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration tms470_command_handlers[] = {
+	{
+		.name = &quot;tms470&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;TI tms470 flash command group&quot;,
+		.chain = tms470_any_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int tms470_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *tms470_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;tms470&quot;, NULL, COMMAND_ANY, &quot;applies to TI tms470 family&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, tms470_cmd, &quot;flash_keyset&quot;, tms470_handle_flash_keyset_command, COMMAND_ANY, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, tms470_cmd, &quot;osc_megahertz&quot;, tms470_handle_osc_megahertz_command, COMMAND_ANY, &quot;tms470 osc_megahertz &lt;MHz&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, tms470_cmd, &quot;plldis&quot;, tms470_handle_plldis_command, COMMAND_ANY, &quot;tms470 plldis &lt;0/1&gt;&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, tms470_command_handlers);
 }
 
 /* ---------------------------------------------------------------------- */

commit b4e95c37205bae2c22d9c223a4e92bcea38bf7dd
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    str9xpec: use register_commands()

diff --git a/src/flash/str9xpec.c b/src/flash/str9xpec.c
index 7519413..7f6a29a 100644
--- a/src/flash/str9xpec.c
+++ b/src/flash/str9xpec.c
@@ -1163,48 +1163,91 @@ COMMAND_HANDLER(str9xpec_handle_flash_disable_turbo_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration str9xpec_config_command_handlers[] = {
+	{
+		.name = &quot;enable_turbo&quot;,
+		.handler = str9xpec_handle_flash_enable_turbo_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;enable str9xpec turbo mode&quot;,
+	},
+	{
+		.name = &quot;disable_turbo&quot;,
+		.handler = str9xpec_handle_flash_disable_turbo_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;disable str9xpec turbo mode&quot;,
+	},
+	{
+		.name = &quot;options_cmap&quot;,
+		.handler = str9xpec_handle_flash_options_cmap_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;configure str9xpec boot sector&quot;,
+	},
+	{
+		.name = &quot;options_lvdthd&quot;,
+		.handler = str9xpec_handle_flash_options_lvdthd_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;configure str9xpec lvd threshold&quot;,
+	},
+	{
+		.name = &quot;options_lvdsel&quot;,
+		.handler = str9xpec_handle_flash_options_lvdsel_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;configure str9xpec lvd selection&quot;,
+	},
+	{
+		.name = &quot;options_lvdwarn&quot;,
+		.handler = str9xpec_handle_flash_options_lvdwarn_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;configure str9xpec lvd warning&quot;,
+	},
+	{
+		.name = &quot;options_read&quot;,
+		.handler = str9xpec_handle_flash_options_read_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;read str9xpec options&quot;,
+	},
+	{
+		.name = &quot;options_write&quot;,
+		.handler = str9xpec_handle_flash_options_write_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;write str9xpec options&quot;,
+	},
+	{
+		.name = &quot;lock&quot;,
+		.handler = str9xpec_handle_flash_lock_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;lock str9xpec device&quot;,
+	},
+	{
+		.name = &quot;unlock&quot;,
+		.handler = str9xpec_handle_flash_unlock_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;unlock str9xpec device&quot;,
+	},
+	{
+		.name = &quot;part_id&quot;,
+		.handler = str9xpec_handle_part_id_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;print part id of str9xpec flash bank &lt;num&gt;&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration str9xpec_command_handlers[] = {
+	{
+		.name = &quot;str9xpec&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;str9xpec flash command group&quot;,
+		.chain = str9xpec_config_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int str9xpec_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *str9xpec_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;str9xpec&quot;,
-			NULL, COMMAND_ANY, &quot;str9xpec flash specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;enable_turbo&quot;,
-			str9xpec_handle_flash_enable_turbo_command,
-			COMMAND_EXEC, &quot;enable str9xpec turbo mode&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;disable_turbo&quot;,
-			str9xpec_handle_flash_disable_turbo_command,
-			COMMAND_EXEC, &quot;disable str9xpec turbo mode&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;options_cmap&quot;,
-			str9xpec_handle_flash_options_cmap_command,
-			COMMAND_EXEC, &quot;configure str9xpec boot sector&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;options_lvdthd&quot;,
-			str9xpec_handle_flash_options_lvdthd_command,
-			COMMAND_EXEC, &quot;configure str9xpec lvd threshold&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;options_lvdsel&quot;,
-			str9xpec_handle_flash_options_lvdsel_command,
-			COMMAND_EXEC, &quot;configure str9xpec lvd selection&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;options_lvdwarn&quot;,
-			str9xpec_handle_flash_options_lvdwarn_command,
-			COMMAND_EXEC, &quot;configure str9xpec lvd warning&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;options_read&quot;,
-			str9xpec_handle_flash_options_read_command,
-			COMMAND_EXEC, &quot;read str9xpec options&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;options_write&quot;,
-			str9xpec_handle_flash_options_write_command,
-			COMMAND_EXEC, &quot;write str9xpec options&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;lock&quot;,
-			str9xpec_handle_flash_lock_command,
-			COMMAND_EXEC, &quot;lock str9xpec device&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;unlock&quot;,
-			str9xpec_handle_flash_unlock_command,
-			COMMAND_EXEC, &quot;unlock str9xpec device&quot;);
-	COMMAND_REGISTER(cmd_ctx, str9xpec_cmd, &quot;part_id&quot;,
-			str9xpec_handle_part_id_command,
-			COMMAND_EXEC, &quot;print part id of str9xpec flash bank &lt;num&gt;&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, str9xpec_command_handlers);
 }
 
+
 struct flash_driver str9xpec_flash = {
 		.name = &quot;str9xpec&quot;,
 		.register_commands = &amp;str9xpec_register_commands,

commit 5e977b46c3a4688d9bf5091306ce3003f1bd6713
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    str9x: use register_commands()

diff --git a/src/flash/str9x.c b/src/flash/str9x.c
index 6d556d9..f6ad51a 100644
--- a/src/flash/str9x.c
+++ b/src/flash/str9x.c
@@ -676,16 +676,29 @@ COMMAND_HANDLER(str9x_handle_flash_config_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration str9x_config_command_handlers[] = {
+	{
+		.name = &quot;disable_jtag&quot;,
+		.handler = &amp;str9x_handle_flash_config_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;configure str9x flash controller&quot;,
+		.usage = &quot;&lt;bank_id&gt; &lt;BBSR&gt; &lt;NBBSR&gt; &lt;BBADR&gt; &lt;NBBADR&gt;&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration str9x_command_handlers[] = {
+	{
+		.name = &quot;str9x&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;str9x flash command group&quot;,
+		.chain = str9x_config_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int str9x_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *str9x_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;str9x&quot;,
-			NULL, COMMAND_ANY, &quot;str9x flash commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, str9x_cmd, &quot;flash_config&quot;,
-			str9x_handle_flash_config_command, COMMAND_EXEC,
-			&quot;configure str9 flash controller&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, str9x_command_handlers);
 }
 
 struct flash_driver str9x_flash = {

commit dfa856ca186bd703b3c75f374b4f84dff372345c
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    str7x: use register_commands()

diff --git a/src/flash/str7x.c b/src/flash/str7x.c
index b53ddf9..e72946f 100644
--- a/src/flash/str7x.c
+++ b/src/flash/str7x.c
@@ -672,16 +672,28 @@ COMMAND_HANDLER(str7x_handle_disable_jtag_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration str7x_exec_command_handlers[] = {
+	{
+		.name = &quot;disable_jtag&quot;,
+		.handler = &amp;str7x_handle_disable_jtag_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;disable jtag access&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration str7x_command_handlers[] = {
+	{
+		.name = &quot;str7x&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;str7x flash command group&quot;,
+		.chain = str7x_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int str7x_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *str7x_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;str7x&quot;,
-			NULL, COMMAND_ANY, &quot;str7x flash specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, str7x_cmd, &quot;disable_jtag&quot;,
-			str7x_handle_disable_jtag_command, COMMAND_EXEC,
-			&quot;disable jtag access&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, str7x_command_handlers);
 }
 
 struct flash_driver str7x_flash = {

commit f9606a6cb72d8bce8964b66e5aa5eec5d98a7b1d
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    stm32x: use register_commands()

diff --git a/src/flash/stm32x.c b/src/flash/stm32x.c
index c628f18..808e32c 100644
--- a/src/flash/stm32x.c
+++ b/src/flash/stm32x.c
@@ -1182,30 +1182,53 @@ COMMAND_HANDLER(stm32x_handle_mass_erase_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration stm32x_exec_command_handlers[] = {
+	{
+		.name = &quot;lock&quot;,
+		.handler = &amp;stm32x_handle_lock_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;lock device&quot;,
+	},
+	{
+		.name = &quot;unlock&quot;,
+		.handler = &amp;stm32x_handle_unlock_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;unlock protected device&quot;,
+	},
+	{
+		.name = &quot;mass_erase&quot;,
+		.handler = &amp;stm32x_handle_mass_erase_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;mass erase device&quot;,
+	},
+	{
+		.name = &quot;options_read&quot;,
+		.handler = &amp;stm32x_handle_options_read_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;read device option bytes&quot;,
+	},
+	{
+		.name = &quot;options_write&quot;,
+		.handler = &amp;stm32x_handle_options_write_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;write device option bytes&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration stm32x_command_handlers[] = {
+	{
+		.name = &quot;stm32x&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;stm32x flash command group&quot;,
+		.chain = stm32x_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int stm32x_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *stm32x_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;stm32x&quot;,
-			NULL, COMMAND_ANY, &quot;stm32x flash specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, stm32x_cmd, &quot;lock&quot;,
-			stm32x_handle_lock_command, COMMAND_EXEC,
-			&quot;lock device&quot;);
-	COMMAND_REGISTER(cmd_ctx, stm32x_cmd, &quot;unlock&quot;,
-			stm32x_handle_unlock_command, COMMAND_EXEC,
-			&quot;unlock protected device&quot;);
-	COMMAND_REGISTER(cmd_ctx, stm32x_cmd, &quot;mass_erase&quot;,
-			stm32x_handle_mass_erase_command, COMMAND_EXEC,
-			&quot;mass erase device&quot;);
-	COMMAND_REGISTER(cmd_ctx, stm32x_cmd, &quot;options_read&quot;,
-			stm32x_handle_options_read_command, COMMAND_EXEC,
-			&quot;read device option bytes&quot;);
-	COMMAND_REGISTER(cmd_ctx, stm32x_cmd, &quot;options_write&quot;,
-			stm32x_handle_options_write_command, COMMAND_EXEC,
-			&quot;write device option bytes&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, stm32x_command_handlers);
 }
-
 struct flash_driver stm32x_flash = {
 		.name = &quot;stm32x&quot;,
 		.register_commands = &amp;stm32x_register_commands,

commit 737f8f2735011256f9ca5a3988ee02167f2847a2
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    stellaris: use register_commands()

diff --git a/src/flash/stellaris.c b/src/flash/stellaris.c
index 2d653ec..1cff486 100644
--- a/src/flash/stellaris.c
+++ b/src/flash/stellaris.c
@@ -1161,15 +1161,28 @@ COMMAND_HANDLER(stellaris_handle_mass_erase_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration stellaris_exec_command_handlers[] = {
+	{
+		.name = &quot;mass_erase&quot;,
+		.handler = &amp;stellaris_handle_mass_erase_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;erase entire device&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration stellaris_command_handlers[] = {
+	{
+		.name = &quot;stellaris&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;Stellaris flash command group&quot;,
+		.chain = stellaris_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int stellaris_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *stm32x_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;stellaris&quot;,
-			NULL, COMMAND_ANY, &quot;stellaris flash specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, stm32x_cmd, &quot;mass_erase&quot;,
-			stellaris_handle_mass_erase_command, COMMAND_EXEC,
-			&quot;mass erase device&quot;);
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, stellaris_command_handlers);
 }
 
 

commit 0ff0dbba497374dddac9641b466e97d67bb6678d
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    pic32mx: use register_commands()

diff --git a/src/flash/pic32mx.c b/src/flash/pic32mx.c
index c6d4615..1950e05 100644
--- a/src/flash/pic32mx.c
+++ b/src/flash/pic32mx.c
@@ -882,26 +882,34 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 
 	return ERROR_OK;
 }
+static const struct command_registration pic32mx_exec_command_handlers[] = {
+	{
+		.name = &quot;chip_erase&quot;,
+		.handler = &amp;pic32mx_handle_chip_erase_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;erase device&quot;,
+	},
+	{
+		.name = &quot;pgm_word&quot;,
+		.handler = &amp;pic32mx_handle_pgm_word_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;program a word&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration pic32mx_command_handlers[] = {
+	{
+		.name = &quot;pic32mx&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;pic32mx flash command group&quot;,
+		.chain = pic32mx_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
 
 static int pic32mx_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *pic32mx_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;pic32mx&quot;,
-			NULL, COMMAND_ANY, &quot;pic32mx flash specific commands&quot;);
-#if 0
-	COMMAND_REGISTER(cmd_ctx, pic32mx_cmd, &quot;lock&quot;,
-			pic32mx_handle_lock_command, COMMAND_EXEC,
-			&quot;lock device&quot;);
-	COMMAND_REGISTER(cmd_ctx, pic32mx_cmd, &quot;unlock&quot;,
-			pic32mx_handle_unlock_command, COMMAND_EXEC,
-			&quot;unlock protected device&quot;);
-#endif
-	COMMAND_REGISTER(cmd_ctx, pic32mx_cmd, &quot;chip_erase&quot;,
-			pic32mx_handle_chip_erase_command, COMMAND_EXEC,
-			&quot;erase device&quot;);
-	COMMAND_REGISTER(cmd_ctx, pic32mx_cmd, &quot;pgm_word&quot;,
-			pic32mx_handle_pgm_word_command, COMMAND_EXEC,
-			&quot;program a word&quot;);
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, pic32mx_command_handlers);
 }
 
 struct flash_driver pic32mx_flash = {

commit ccae9ae0200a66472409334d18108b309a9fae70
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    nand: use register_commands()
    
    Eliminates 'nand_cmd' global variable.

diff --git a/src/flash/nand.c b/src/flash/nand.c
index 2438ddd..bc0e350 100644
--- a/src/flash/nand.c
+++ b/src/flash/nand.c
@@ -63,7 +63,6 @@ static struct nand_flash_controller *nand_flash_controllers[] =
 
 /* configured NAND devices and NAND Flash command handler */
 static struct nand_device *nand_devices = NULL;
-static struct command *nand_cmd;
 
 /*	Chip ID list
  *
@@ -279,19 +278,34 @@ COMMAND_HANDLER(handle_nand_device_command)
 	return CALL_COMMAND_HANDLER(handle_nand_list_drivers);
 }
 
+static const struct command_registration nand_config_command_handlers[] = {
+	{
+		.name = &quot;device&quot;,
+		.handler = &amp;handle_nand_device_command,
+		.mode = COMMAND_CONFIG,
+		.help = &quot;defines a new NAND bank&quot;,
+	},
+	{
+		.name = &quot;drivers&quot;,
+		.handler = &amp;handle_nand_list_drivers,
+		.mode = COMMAND_ANY,
+		.help = &quot;lists available NAND drivers&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration nand_command_handlers[] = {
+	{
+		.name = &quot;nand&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;NAND flash command group&quot;,
+		.chain = nand_config_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int nand_register_commands(struct command_context *cmd_ctx)
 {
-	nand_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;nand&quot;,
-			NULL, COMMAND_ANY, &quot;NAND specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;device&quot;,
-			&amp;handle_nand_device_command, COMMAND_CONFIG,
-			&quot;defines a new NAND bank&quot;);
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;drivers&quot;,
-			&amp;handle_nand_list_drivers, COMMAND_ANY,
-			&quot;lists available NAND drivers&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, nand_command_handlers);
 }
 
 struct nand_device *get_nand_device_by_name(const char *name)
@@ -1700,43 +1714,80 @@ COMMAND_HANDLER(handle_nand_raw_access_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration nand_exec_command_handlers[] = {
+	{
+		.name = &quot;list&quot;,
+		.handler = &amp;handle_nand_list_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;list configured NAND flash devices&quot;,
+	},
+	{
+		.name = &quot;info&quot;,
+		.handler = &amp;handle_nand_info_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt;&quot;,
+		.help = &quot;print info about a NAND flash device&quot;,
+	},
+	{
+		.name = &quot;probe&quot;,
+		.handler = &amp;handle_nand_probe_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt;&quot;,
+		.help = &quot;identify NAND flash device &lt;num&gt;&quot;,
+
+	},
+	{
+		.name = &quot;check_bad_blocks&quot;,
+		.handler = &amp;handle_nand_check_bad_blocks_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; [&lt;offset&gt; &lt;length&gt;]&quot;,
+		.help = &quot;check NAND flash device &lt;num&gt; for bad blocks&quot;,
+	},
+	{
+		.name = &quot;erase&quot;,
+		.handler = &amp;handle_nand_erase_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; [&lt;offset&gt; &lt;length&gt;]&quot;,
+		.help = &quot;erase blocks on NAND flash device&quot;,
+	},
+	{
+		.name = &quot;dump&quot;,
+		.handler = &amp;handle_nand_dump_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;filename&gt; &lt;offset&gt; &lt;length&gt; &quot;
+			&quot;[oob_raw | oob_only]&quot;,
+		.help = &quot;dump from NAND flash device&quot;,
+	},
+	{
+		.name = &quot;verify&quot;,
+		.handler = &amp;handle_nand_verify_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;filename&gt; &lt;offset&gt; &quot;
+			&quot;[oob_raw | oob_only | oob_softecc | oob_softecc_kw]&quot;,
+		.help = &quot;verify NAND flash device&quot;,
+	},
+	{
+		.name = &quot;write&quot;,
+		.handler = &amp;handle_nand_write_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;filename&gt; &lt;offset&gt; &quot;
+			&quot;[oob_raw | oob_only | oob_softecc | oob_softecc_kw]&quot;,
+		.help = &quot;write to NAND flash device&quot;,
+	},
+	{
+		.name = &quot;raw_access&quot;,
+		.handler = &amp;handle_nand_raw_access_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;num&gt; ['enable'|'disable']&quot;,
+		.help = &quot;raw access to NAND flash device&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int nand_init(struct command_context *cmd_ctx)
 {
 	if (!nand_devices)
 		return ERROR_OK;
-
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;list&quot;,
-			handle_nand_list_command, COMMAND_EXEC,
-			&quot;list configured NAND flash devices&quot;);
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;info&quot;,
-			handle_nand_info_command, COMMAND_EXEC,
-			&quot;print info about NAND flash device &lt;num&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;probe&quot;,
-			handle_nand_probe_command, COMMAND_EXEC,
-			&quot;identify NAND flash device &lt;num&gt;&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;check_bad_blocks&quot;,
-			handle_nand_check_bad_blocks_command, COMMAND_EXEC,
-			&quot;check NAND flash device &lt;num&gt; for bad blocks [&lt;offset&gt; &lt;length&gt;]&quot;);
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;erase&quot;,
-			handle_nand_erase_command, COMMAND_EXEC,
-			&quot;erase blocks on NAND flash device &lt;num&gt; [&lt;offset&gt; &lt;length&gt;]&quot;);
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;dump&quot;,
-			handle_nand_dump_command, COMMAND_EXEC,
-			&quot;dump from NAND flash device &lt;num&gt; &lt;filename&gt; &quot;
-			 &quot;&lt;offset&gt; &lt;length&gt; [oob_raw | oob_only]&quot;);
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;verify&quot;,
-			&amp;handle_nand_verify_command, COMMAND_EXEC,
-			&quot;verify NAND flash device &lt;num&gt; &lt;filename&gt; &lt;offset&gt; &quot;
-			&quot;[oob_raw | oob_only | oob_softecc | oob_softecc_kw]&quot;);
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;write&quot;,
-			handle_nand_write_command, COMMAND_EXEC,
-			&quot;write to NAND flash device &lt;num&gt; &lt;filename&gt; &lt;offset&gt; &quot;
-			&quot;[oob_raw | oob_only | oob_softecc | oob_softecc_kw]&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, nand_cmd, &quot;raw_access&quot;,
-			handle_nand_raw_access_command, COMMAND_EXEC,
-			&quot;raw access to NAND flash device &lt;num&gt; ['enable'|'disable']&quot;);
-
-	return ERROR_OK;
+	struct command *parent = command_find_in_context(cmd_ctx, &quot;nand&quot;);
+	return register_commands(cmd_ctx, parent, nand_exec_command_handlers);
 }

commit 1bf7462edb89a79835e8bd42905d69282ba4ba17
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    mflash: use register_commands()

diff --git a/src/flash/mflash.c b/src/flash/mflash.c
index a4a45dc..03a56e2 100644
--- a/src/flash/mflash.c
+++ b/src/flash/mflash.c
@@ -33,8 +33,6 @@ static int s3c2440_set_gpio_output_val (struct mflash_gpio_num gpio, uint8_t val
 static int pxa270_set_gpio_to_output (struct mflash_gpio_num gpio);
 static int pxa270_set_gpio_output_val (struct mflash_gpio_num gpio, uint8_t val);
 
-static struct command *mflash_cmd;
-
 static struct mflash_bank *mflash_bank;
 
 static struct mflash_gpio_drv pxa270_gpio = {
@@ -1268,19 +1266,42 @@ COMMAND_HANDLER(mg_config_cmd)
 	}
 }
 
+static const struct command_registration mflash_exec_command_handlers[] = {
+	{
+		.name = &quot;probe&quot;,
+		.handler = &amp;mg_probe_cmd,
+		.mode = COMMAND_EXEC,
+		.help = &quot;Detect bank configuration information&quot;,
+	},
+	{
+		.name = &quot;write&quot;,
+		.handler = &amp;mg_write_cmd,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;num&gt; &lt;file&gt; &lt;address&gt;&quot;,
+		.help = &quot;Write a file at the specified address&quot;,
+	},
+	{
+		.name = &quot;dump&quot;,
+		.handler = &amp;mg_dump_cmd,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;num&gt; &lt;file&gt; &lt;address&gt; &lt;size&gt;&quot;,
+		.help = &quot;Dump to a file from the specified address&quot;,
+	},
+	{
+		.name = &quot;config&quot;,
+		.handler = &amp;mg_config_cmd,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;num&gt; &lt;stage&gt;&quot;,
+		.help = &quot;Dump to a file from the specified address&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int mflash_init_drivers(struct command_context *cmd_ctx)
 {
-	if (mflash_bank) {
-		COMMAND_REGISTER(cmd_ctx, mflash_cmd, &quot;probe&quot;, mg_probe_cmd, COMMAND_EXEC, NULL);
-		COMMAND_REGISTER(cmd_ctx, mflash_cmd, &quot;write&quot;, mg_write_cmd, COMMAND_EXEC,
-				&quot;mflash write &lt;num&gt; &lt;file&gt; &lt;address&gt;&quot;);
-		COMMAND_REGISTER(cmd_ctx, mflash_cmd, &quot;dump&quot;, mg_dump_cmd, COMMAND_EXEC,
-						&quot;mflash dump &lt;num&gt; &lt;file&gt; &lt;address&gt; &lt;size&gt;&quot;);
-		COMMAND_REGISTER(cmd_ctx, mflash_cmd, &quot;config&quot;, mg_config_cmd,
-				COMMAND_EXEC, &quot;mflash config &lt;num&gt; &lt;stage&gt;&quot;);
-	}
-
-	return ERROR_OK;
+	if (!mflash_bank)
+		return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, mflash_exec_command_handlers);
 }
 
 COMMAND_HANDLER(mg_bank_cmd)
@@ -1323,10 +1344,26 @@ COMMAND_HANDLER(mg_bank_cmd)
 	return ERROR_OK;
 }
 
+static const struct command_registration mflash_config_command_handlers[] = {
+	{
+		.name = &quot;bank&quot;,
+		.handler = &amp;mg_bank_cmd,
+		.mode = COMMAND_CONFIG,
+		.help = &quot;configure a mflash device bank&quot;,
+		.usage = &quot;&lt;soc&gt; &lt;base&gt; &lt;RST pin&gt; &lt;target #&gt;&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration mflash_command_handler[] = {
+	{
+		.name = &quot;mflash&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;mflash command group&quot;,
+		.chain = mflash_config_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
 int mflash_register_commands(struct command_context *cmd_ctx)
 {
-	mflash_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;mflash&quot;, NULL, COMMAND_ANY, NULL);
-	COMMAND_REGISTER(cmd_ctx, mflash_cmd, &quot;bank&quot;, mg_bank_cmd, COMMAND_CONFIG,
-			&quot;mflash bank &lt;soc&gt; &lt;base&gt; &lt;RST pin&gt; &lt;target #&gt;&quot;);
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, mflash_command_handler);
 }

commit 7609e1091abfacfc1b62aca06c642e42003aa444
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    lpc3180_nand_controller: use register_commands()

diff --git a/src/flash/lpc3180_nand_controller.c b/src/flash/lpc3180_nand_controller.c
index 801607d..2dec3e1 100644
--- a/src/flash/lpc3180_nand_controller.c
+++ b/src/flash/lpc3180_nand_controller.c
@@ -873,13 +873,29 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration lpc3180_exec_command_handlers[] = {
+	{
+		.name = &quot;select&quot;,
+		.handler = &amp;handle_lpc3180_select_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;select &lt;'mlc'|'slc'&gt; controller (default is mlc)&quot;,
+		.usage = &quot;&lt;device_id&gt; (mlc|slc)&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration lpc3180_command_handler[] = {
+	{
+		.name = &quot;lpc3180&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;LPC3180 NAND flash controller commands&quot;,
+		.chain = lpc3180_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int lpc3180_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *lpc3180_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;lpc3180&quot;, NULL, COMMAND_ANY, &quot;commands specific to the LPC3180 NAND flash controllers&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, lpc3180_cmd, &quot;select&quot;, handle_lpc3180_select_command, COMMAND_EXEC, &quot;select &lt;'mlc'|'slc'&gt; controller (default is mlc)&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, lpc3180_command_handler);
 }
 
 struct nand_flash_controller lpc3180_nand_controller = {

commit 1cbe3ec6f105e35e641293cd7e62e6fefac1b271
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    lpc2900: use register_commands()

diff --git a/src/flash/lpc2900.c b/src/flash/lpc2900.c
index c7f1b3a..0d961e4 100644
--- a/src/flash/lpc2900.c
+++ b/src/flash/lpc2900.c
@@ -948,46 +948,67 @@ COMMAND_HANDLER(lpc2900_handle_secure_jtag_command)
 
 /***********************  Flash interface functions  **************************/
 
+static const struct command_registration lpc2900_exec_command_handlers[] = {
+	{
+		.name = &quot;signature&quot;,
+		.handler = &amp;lpc2900_handle_signature_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt;&quot;,
+		.help = &quot;print device signature of flash bank&quot;,
+	},
+	{
+		.name = &quot;read_custom&quot;,
+		.handler = &amp;lpc2900_handle_read_custom_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;filename&gt;&quot;,
+		.help = &quot;read customer information from index sector to file&quot;,
+	},
+	{
+		.name = &quot;password&quot;,
+		.handler = &amp;lpc2900_handle_password_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;password&gt;&quot;,
+		.help = &quot;enter password to enable 'dangerous' options&quot;,
+	},
+	{
+		.name = &quot;write_custom&quot;,
+		.handler = &amp;lpc2900_handle_write_custom_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;filename&gt; [&lt;type&gt;]&quot;,
+		.help = &quot;write customer info from file to index sector&quot;,
+	},
+	{
+		.name = &quot;secure_sector&quot;,
+		.handler = &amp;lpc2900_handle_secure_sector_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;first&gt; &lt;last&gt;&quot;,
+		.help = &quot;activate sector security for a range of sectors&quot;,
+	},
+	{
+		.name = &quot;secure_jtag&quot;,
+		.handler = &amp;lpc2900_handle_secure_jtag_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;level&gt;&quot;,
+		.help = &quot;activate JTAG security&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration lpc2900_command_handlers[] = {
+	{
+		.name = &quot;lpc2900&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;LPC2900 flash command group&quot;,
+		.chain = lpc2900_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
 
 /**
  * Register private command handlers.
  */
 static int lpc2900_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *lpc2900_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;lpc2900&quot;,
-	                                          NULL, COMMAND_ANY, NULL);
-
-	COMMAND_REGISTER(cmd_ctx, lpc2900_cmd, &quot;signature&quot;,
-	    &amp;lpc2900_handle_signature_command, COMMAND_EXEC,
-	    &quot;&lt;bank&gt; | &quot;
-	    &quot;print device signature of flash bank&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, lpc2900_cmd, &quot;read_custom&quot;,
-	    &amp;lpc2900_handle_read_custom_command, COMMAND_EXEC,
-	    &quot;&lt;bank&gt; &lt;filename&gt; | &quot;
-            &quot;read customer information from index sector to file&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, lpc2900_cmd, &quot;password&quot;,
-	    &amp;lpc2900_handle_password_command, COMMAND_EXEC,
-	    &quot;&lt;bank&gt; &lt;password&gt; | &quot;
-            &quot;enter password to enable 'dangerous' options&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, lpc2900_cmd, &quot;write_custom&quot;,
-	    &amp;lpc2900_handle_write_custom_command, COMMAND_EXEC,
-	    &quot;&lt;bank&gt; &lt;filename&gt; [&lt;type&gt;] | &quot;
-            &quot;write customer info from file to index sector&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, lpc2900_cmd, &quot;secure_sector&quot;,
-	    &amp;lpc2900_handle_secure_sector_command, COMMAND_EXEC,
-	    &quot;&lt;bank&gt; &lt;first&gt; &lt;last&gt; | &quot;
-            &quot;activate sector security for a range of sectors&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, lpc2900_cmd, &quot;secure_jtag&quot;,
-	    &amp;lpc2900_handle_secure_jtag_command, COMMAND_EXEC,
-	    &quot;&lt;bank&gt; &lt;level&gt; | &quot;
-            &quot;activate JTAG security&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, lpc2900_command_handlers);
 }
 
 

commit a12a29c28a92f51861957a09d86177625220483b
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    lpc2000: use register_commands()

diff --git a/src/flash/lpc2000.c b/src/flash/lpc2000.c
index 4a934c0..896b794 100644
--- a/src/flash/lpc2000.c
+++ b/src/flash/lpc2000.c
@@ -776,16 +776,28 @@ COMMAND_HANDLER(lpc2000_handle_part_id_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration lpc2000_exec_command_handlers[] = {
+	{
+		.name = &quot;part_id&quot;,
+		.handler = &amp;lpc2000_handle_part_id_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;print part id of lpc2000 flash bank &lt;num&gt;&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration lpc2000_command_handlers[] = {
+	{
+		.name = &quot;lpc2000&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;lpc2000 flash command group&quot;,
+		.chain = lpc2000_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int lpc2000_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *lpc2000_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;lpc2000&quot;,
-			NULL, COMMAND_ANY, NULL);
-
-	COMMAND_REGISTER(cmd_ctx, lpc2000_cmd, &quot;part_id&quot;,
-			lpc2000_handle_part_id_command, COMMAND_EXEC,
-			&quot;print part id of lpc2000 flash bank &lt;num&gt;&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, lpc2000_command_handlers);
 }
 
 struct flash_driver lpc2000_flash = {

commit b90bf52be340d8ad2285f2f359174fbc1e31ce24
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    flash: use register_commands()
    
    Eliminates 'flash_cmd' global variable.

diff --git a/src/flash/flash.c b/src/flash/flash.c
index 7bc74ab..de95b62 100644
--- a/src/flash/flash.c
+++ b/src/flash/flash.c
@@ -78,7 +78,6 @@ struct flash_driver *flash_drivers[] = {
 };
 
 struct flash_bank *flash_banks;
-static 	struct command *flash_cmd;
 
 /* wafer thin wrapper for invoking the flash driver */
 static int flash_driver_write(struct flash_bank *bank, uint8_t *buffer, uint32_t offset, uint32_t count)
@@ -1272,64 +1271,132 @@ int default_flash_blank_check(struct flash_bank *bank)
 	return ERROR_OK;
 }
 
+static const struct command_registration flash_exec_command_handlers[] = {
+	{
+		.name = &quot;probe&quot;,
+		.handler = &amp;handle_flash_probe_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt;&quot;,
+		.help = &quot;identify flash bank&quot;,
+	},
+	{
+		.name = &quot;info&quot;,
+		.handler = &amp;handle_flash_info_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt;&quot;,
+		.help = &quot;print bank information&quot;,
+	},
+	{
+		.name = &quot;erase_check&quot;,
+		.handler = &amp;handle_flash_erase_check_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt;&quot;,
+		.help = &quot;check erase state of sectors&quot;,
+	},
+	{
+		.name = &quot;protect_check&quot;,
+		.handler = &amp;handle_flash_protect_check_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt;&quot;,
+		.help = &quot;check protection state of sectors&quot;,
+	},
+	{
+		.name = &quot;erase_sector&quot;,
+		.handler = &amp;handle_flash_erase_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;first&gt; &lt;last&gt;&quot;,
+		.help = &quot;erase sectors&quot;,
+	},
+	{
+		.name = &quot;erase_address&quot;,
+		.handler = &amp;handle_flash_erase_address_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;address&gt; &lt;length&gt;&quot;,
+		.help = &quot;erase address range&quot;,
+
+	},
+	{
+		.name = &quot;fillw&quot;,
+		.handler = &amp;handle_flash_fill_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;address&gt; &lt;word_pattern&gt; &lt;count&gt;&quot;,
+		.help = &quot;fill with pattern (no autoerase)&quot;,
+	},
+	{
+		.name = &quot;fillh&quot;,
+		.handler = &amp;handle_flash_fill_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;address&gt; &lt;halfword_pattern&gt; &lt;count&gt;&quot;,
+		.help = &quot;fill with pattern&quot;,
+	},
+	{
+		.name = &quot;fillb&quot;,
+		.handler = &amp;handle_flash_fill_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;address&gt; &lt;byte_pattern&gt; &lt;count&gt;&quot;,
+		.help = &quot;fill with pattern&quot;,
+
+	},
+	{
+		.name = &quot;write_bank&quot;,
+		.handler = &amp;handle_flash_write_bank_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;file&gt; &lt;offset&gt;&quot;,
+		.help = &quot;write binary data&quot;,
+	},
+	{
+		.name = &quot;write_image&quot;,
+		.handler = &amp;handle_flash_write_image_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; [erase] [unlock] &lt;file&gt; [offset] [type]&quot;,
+		.help = &quot;write an image to flash&quot;
+	},
+	{
+		.name = &quot;protect&quot;,
+		.handler = &amp;handle_flash_protect_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;bank&gt; &lt;first&gt; &lt;last&gt; &lt;on | off&gt;&quot;,
+		.help = &quot;set protection of sectors&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int flash_init_drivers(struct command_context *cmd_ctx)
 {
 	register_jim(cmd_ctx, &quot;ocd_flash_banks&quot;,
 			jim_flash_banks, &quot;return information about the flash banks&quot;);
-
 	if (!flash_banks)
 		return ERROR_OK;
 
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;info&quot;,
-			handle_flash_info_command, COMMAND_EXEC,
-			&quot;print info about flash bank &lt;num&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;probe&quot;,
-			handle_flash_probe_command, COMMAND_EXEC,
-			&quot;identify flash bank &lt;num&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;erase_check&quot;,
-			handle_flash_erase_check_command, COMMAND_EXEC,
-			&quot;check erase state of sectors in flash bank &lt;num&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;protect_check&quot;,
-			handle_flash_protect_check_command, COMMAND_EXEC,
-			&quot;check protection state of sectors in flash bank &lt;num&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;erase_sector&quot;,
-			handle_flash_erase_command, COMMAND_EXEC,
-			&quot;erase sectors at &lt;bank&gt; &lt;first&gt; &lt;last&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;erase_address&quot;,
-			handle_flash_erase_address_command, COMMAND_EXEC,
-			&quot;erase address range &lt;address&gt; &lt;length&gt;&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;fillw&quot;,
-			handle_flash_fill_command, COMMAND_EXEC,
-			&quot;fill with pattern (no autoerase) &lt;address&gt; &lt;word_pattern&gt; &lt;count&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;fillh&quot;,
-			handle_flash_fill_command, COMMAND_EXEC,
-			&quot;fill with pattern &lt;address&gt; &lt;halfword_pattern&gt; &lt;count&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;fillb&quot;,
-			handle_flash_fill_command, COMMAND_EXEC,
-			&quot;fill with pattern &lt;address&gt; &lt;byte_pattern&gt; &lt;count&gt;&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;write_bank&quot;,
-			handle_flash_write_bank_command, COMMAND_EXEC,
-			&quot;write binary data to &lt;bank&gt; &lt;file&gt; &lt;offset&gt;&quot;);
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;write_image&quot;,
-			handle_flash_write_image_command, COMMAND_EXEC,
-			&quot;write_image [erase] [unlock] &lt;file&gt; [offset] [type]&quot;);
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;protect&quot;,
-			handle_flash_protect_command, COMMAND_EXEC,
-			&quot;set protection of sectors at &lt;bank&gt; &lt;first&gt; &lt;last&gt; &lt;on | off&gt;&quot;);
-
-	return ERROR_OK;
+	struct command *parent = command_find_in_context(cmd_ctx, &quot;flash&quot;);
+	return register_commands(cmd_ctx, parent, flash_exec_command_handlers);
 }
 
+
+static const struct command_registration flash_config_command_handlers[] = {
+	{
+		.name = &quot;bank&quot;,
+		.handler = &amp;handle_flash_bank_command,
+		.mode = COMMAND_CONFIG,
+		.usage = &quot;&lt;name&gt; &lt;driver&gt; &lt;base&gt; &lt;size&gt; &quot;
+			&quot;&lt;chip_width&gt; &lt;bus_width&gt; &lt;target&gt; &quot;
+			&quot;[driver_options ...]&quot;,
+		.help = &quot;Define a new bank with the given name, &quot;
+			&quot;using the specified NOR flash driver.&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration flash_command_handlers[] = {
+	{
+		.name = &quot;flash&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;NOR flash command group&quot;,
+		.chain = flash_config_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 int flash_register_commands(struct command_context *cmd_ctx)
 {
-	flash_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;flash&quot;,
-			NULL, COMMAND_ANY, NULL);
-
-	COMMAND_REGISTER(cmd_ctx, flash_cmd, &quot;bank&quot;,
-			handle_flash_bank_command, COMMAND_CONFIG,
-			&quot;flash bank &lt;driver&gt; &lt;base&gt; &lt;size&gt; &quot;
-			&quot;&lt;chip_width&gt; &lt;bus_width&gt; &lt;target&gt; [driver_options ...]&quot;);
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, flash_command_handlers);
 }

commit 1765b103044179baa2d5036bb61710369ae59e70
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    ecos: use register_commands()

diff --git a/src/flash/ecos.c b/src/flash/ecos.c
index 381f858..f6f3307 100644
--- a/src/flash/ecos.c
+++ b/src/flash/ecos.c
@@ -338,8 +338,6 @@ static int ecosflash_probe(struct flash_bank *bank)
 
 static int ecosflash_register_commands(struct command_context *cmd_ctx)
 {
-	COMMAND_REGISTER(cmd_ctx, NULL, &quot;ecosflash&quot;, NULL, COMMAND_ANY, NULL);
-
 	return ERROR_OK;
 }
 

commit b595ab8b97ae15babe530a935bb5009cdb02fcd7
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    cfi: use register_commands()

diff --git a/src/flash/cfi.c b/src/flash/cfi.c
index e743fe9..b92ecbd 100644
--- a/src/flash/cfi.c
+++ b/src/flash/cfi.c
@@ -591,12 +591,6 @@ static int cfi_intel_info(struct flash_bank *bank, char *buf, int buf_size)
 
 static int cfi_register_commands(struct command_context *cmd_ctx)
 {
-	/*struct command *cfi_cmd = */
-	COMMAND_REGISTER(cmd_ctx, NULL, &quot;cfi&quot;, NULL, COMMAND_ANY, &quot;flash bank cfi &lt;base&gt; &lt;size&gt; &lt;chip_width&gt; &lt;bus_width&gt; &lt;targetNum&gt; [jedec_probe/x16_as_x8]&quot;);
-	/*
-	COMMAND_REGISTER(cmd_ctx, cfi_cmd, &quot;part_id&quot;, cfi_handle_part_id_command, COMMAND_EXEC,
-					 &quot;print part id of cfi flash bank &lt;num&gt;&quot;);
-	*/
 	return ERROR_OK;
 }
 

commit c4aa2fd6e745d7d9fb82673f5845a09c98b10912
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    avrf: use register_commands()

diff --git a/src/flash/avrf.c b/src/flash/avrf.c
index 692992f..9aea47d 100644
--- a/src/flash/avrf.c
+++ b/src/flash/avrf.c
@@ -449,16 +449,28 @@ COMMAND_HANDLER(avrf_handle_mass_erase_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration avrf_exec_command_handlers[] = {
+	{
+		.name = &quot;mass_erase&quot;,
+		.handler = &amp;avrf_handle_mass_erase_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;erase entire device&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration avrf_command_handlers[] = {
+	{
+		.name = &quot;avrf&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;AVR flash command group&quot;,
+		.chain = avrf_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int avrf_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *avr_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;avr&quot;,
-			NULL, COMMAND_ANY, &quot;avr flash specific commands&quot;);
-
-	COMMAND_REGISTER(cmd_ctx, avr_cmd, &quot;mass_erase&quot;,
-			avrf_handle_mass_erase_command, COMMAND_EXEC,
-			&quot;mass erase device&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, avrf_command_handlers);
 }
 
 struct flash_driver avr_flash = {

commit bdae918dcd3bbcd1a90b2c5f65291908271727f7
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    at91sam7: use register_commands()

diff --git a/src/flash/at91sam7.c b/src/flash/at91sam7.c
index 1665b91..0204660 100644
--- a/src/flash/at91sam7.c
+++ b/src/flash/at91sam7.c
@@ -1178,17 +1178,29 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration at91sam7_exec_command_handlers[] = {
+	{
+		.name = &quot;gpnvm&quot;,
+		.handler = &amp;at91sam7_handle_gpnvm_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;gpnvm &lt;bit&gt; set | clear, &quot;
+			&quot;set or clear one gpnvm bit&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration at91sam7_command_handlers[] = {
+	{
+		.name = &quot;at91sam7&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;at91sam7 flash command group&quot;,
+		.chain = at91sam7_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+
 static int at91sam7_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *at91sam7_cmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;at91sam7&quot;,
-			NULL, COMMAND_ANY, NULL);
-
-	COMMAND_REGISTER(cmd_ctx, at91sam7_cmd, &quot;gpnvm&quot;,
-			at91sam7_handle_gpnvm_command, COMMAND_EXEC,
-			&quot;at91sam7 gpnvm &lt;bit&gt; set | clear, &quot;
-			&quot;set or clear one gpnvm bit&quot;);
-
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, at91sam7_command_handlers);
 }
 
 struct flash_driver at91sam7_flash = {

commit 2a4a94b7ac4401802832f37ef07b0500efc92f0e
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 22 04:13:56 2009 -0800

    at91sam3: use register_commands()

diff --git a/src/flash/at91sam3.c b/src/flash/at91sam3.c
index d8460b0..75e8495 100644
--- a/src/flash/at91sam3.c
+++ b/src/flash/at91sam3.c
@@ -2467,35 +2467,43 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 	return ERROR_OK;
 }
 
+static const struct command_registration at91sam3_exec_command_handlers[] = {
+	{
+		.name = &quot;gpnvm&quot;,
+		.handler = &amp;sam3_handle_gpnvm_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;[(set|clear) [&lt;bit_id&gt;]]&quot;,
+		.help = &quot;Without arguments, shows the gpnvm register; &quot;
+			&quot;otherwise, sets or clear the specified bit.&quot;,
+	},
+	{
+		.name = &quot;info&quot;,
+		.handler = &amp;sam3_handle_info_command,
+		.mode = COMMAND_EXEC,
+		.help = &quot;print information about the current sam3 chip&quot;,
+	},
+	{
+		.name = &quot;slowclk&quot;,
+		.handler = &amp;sam3_handle_slowclk_command,
+		.mode = COMMAND_EXEC,
+		.usage = &quot;&lt;value&gt;&quot;,
+		.help = &quot;set the slowclock frequency (default 32768hz)&quot;,
+	},
+	COMMAND_REGISTRATION_DONE
+};
+static const struct command_registration at91sam3_command_handlers[] = {
+	{
+		.name = &quot;at91sam3&quot;,
+		.mode = COMMAND_ANY,
+		.help = &quot;at91sam3 flash command group&quot;,
+		.chain = at91sam3_exec_command_handlers,
+	},
+	COMMAND_REGISTRATION_DONE
+};
 
-static int sam3_registered;
-static int
-sam3_register_commands(struct command_context *cmd_ctx)
+static int sam3_register_commands(struct command_context *cmd_ctx)
 {
-	struct command *pCmd;
-
-	// only register once
-	if (!sam3_registered) {
-		sam3_registered++;
-
-		pCmd = COMMAND_REGISTER(cmd_ctx, NULL, &quot;at91sam3&quot;, NULL, COMMAND_ANY, NULL);
-		COMMAND_REGISTER(cmd_ctx, pCmd,
-						  &quot;gpnvm&quot;,
-						  sam3_handle_gpnvm_command,
-						  COMMAND_EXEC,
-						  &quot;at91sam3 gpnvm [action [&lt;BIT&gt;], by default 'show', otherwise set | clear BIT&quot;);
-		COMMAND_REGISTER(cmd_ctx, pCmd,
-						  &quot;info&quot;,
-						  sam3_handle_info_command,
-						  COMMAND_EXEC,
-						  &quot;at91sam3 info - print information about the current sam3 chip&quot;);
-		COMMAND_REGISTER(cmd_ctx, pCmd,
-						  &quot;slowclk&quot;,
-						  sam3_handle_slowclk_command,
-						  COMMAND_EXEC,
-						  &quot;at91sam3 slowclk [VALUE] set the slowclock frequency (default 32768hz)&quot;);
-	}
-	return ERROR_OK;
+	return register_commands(cmd_ctx, NULL, at91sam3_command_handlers);
 }
 
 struct flash_driver at91sam3_flash = {

-----------------------------------------------------------------------

Summary of changes:
 src/flash/at91sam3.c                |   65 +++++++------
 src/flash/at91sam7.c                |   33 ++++---
 src/flash/avrf.c                    |   31 ++++---
 src/flash/cfi.c                     |   12 ---
 src/flash/davinci_nand.c            |    6 -
 src/flash/ecos.c                    |    8 --
 src/flash/faux.c                    |    6 -
 src/flash/flash.c                   |  182 ++++++++++++++++++++++++-----------
 src/flash/flash.h                   |    8 +-
 src/flash/lpc2000.c                 |   31 ++++---
 src/flash/lpc2900.c                 |   98 +++++++++++--------
 src/flash/lpc3180_nand_controller.c |   29 ++++--
 src/flash/mflash.c                  |   71 ++++++++++----
 src/flash/mx3_nand.c                |    6 -
 src/flash/nand.c                    |  156 ++++++++++++++++++++----------
 src/flash/nand.h                    |    2 +-
 src/flash/orion_nand.c              |    6 -
 src/flash/pic32mx.c                 |   47 +++++----
 src/flash/s3c2410_nand.c            |    1 -
 src/flash/s3c2412_nand.c            |    1 -
 src/flash/s3c2440_nand.c            |    1 -
 src/flash/s3c2443_nand.c            |    1 -
 src/flash/s3c24xx_nand.c            |    5 -
 src/flash/s3c24xx_nand.h            |    2 -
 src/flash/stellaris.c               |   31 ++++---
 src/flash/stm32x.c                  |   67 ++++++++-----
 src/flash/str7x.c                   |   31 ++++---
 src/flash/str9x.c                   |   32 ++++---
 src/flash/str9xpec.c                |  121 +++++++++++++++--------
 src/flash/tms470.c                  |   42 ++++++--
 30 files changed, 692 insertions(+), 440 deletions(-)


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001860.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-595-g8d46720
</A></li>
	<LI>Next message: <A HREF="001862.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-637-gf74e2e0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1861">[ date ]</a>
              <a href="thread.html#1861">[ thread ]</a>
              <a href="subject.html#1861">[ subject ]</a>
              <a href="author.html#1861">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
