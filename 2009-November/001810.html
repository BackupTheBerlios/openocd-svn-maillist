<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-454-g789d47c
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-454-g789d47c&In-Reply-To=%3CE1NATw8-0003ip-J4%40fxgxhf1.ch3.sourceforge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001809.html">
   <LINK REL="Next"  HREF="001811.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-454-g789d47c</H1>
    <B>Zach Welch</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-454-g789d47c&In-Reply-To=%3CE1NATw8-0003ip-J4%40fxgxhf1.ch3.sourceforge.com%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-454-g789d47c">zwelch at users.sourceforge.net
       </A><BR>
    <I>Tue Nov 17 20:41:59 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001809.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-446-gf478865
</A></li>
        <LI>Next message: <A HREF="001811.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-456-g0091e59
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1810">[ date ]</a>
              <a href="thread.html#1810">[ thread ]</a>
              <a href="subject.html#1810">[ subject ]</a>
              <a href="author.html#1810">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  789d47c18097abb5ee6cc8544e0ba030000fd418 (commit)
       via  cfaf7bdd0aedb23a4837078db808be450e5efc30 (commit)
       via  cffc98ad8047b6dc8d38a6422136638f2df992d2 (commit)
       via  be084414ba00a4ad641af04c3c6858312dd1b336 (commit)
       via  2861877b32a7a2f4022a1c3d9b66c9b4879878ac (commit)
       via  23402315ce01071f30d7ec0c5ca7563ce41f1cc6 (commit)
       via  7bf1a86e473a12882bf6f71cb4d0d416394b69d4 (commit)
       via  5b9899d6ea1e0cf763465c64c700f20eddd893f9 (commit)
      from  f4788652e45662d1e43933dc0620561bc4cddae0 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 789d47c18097abb5ee6cc8544e0ba030000fd418
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Tue Nov 17 05:38:17 2009 -0800

    update command_handler documentation
    
    Improve the developer manual and primer sections which talk about
    writing command handlers.  Notably, it documents the new CMD_* macros.

diff --git a/doc/manual/helper.txt b/doc/manual/helper.txt
index 247d7b4..e7454b6 100644
--- a/doc/manual/helper.txt
+++ b/doc/manual/helper.txt
@@ -45,16 +45,16 @@ another layer of handlers.
 
 @subsection helpercmdhandlerdef Defining and Calling Command Handlers
 
-These functions should be defined using the COMMAND_HANDLER macro.
+These functions should be defined using the @c COMMAND_HANDLER macro.
 These methods must be defined as static, as their principle entry point
 should be the run_command dispatch mechanism.
 
 Command helper functions that require access to the full set of
-parameters should be defined using the COMMAND_HELPER.  These must be
+parameters should be defined using the @c COMMAND_HELPER.  These must be
 declared static by you, as sometimes you might want to share a helper
-among several files (e.g. s3c24xx_nand.h).
+among several files (e.g. @c s3c24xx_nand.h).
 
-Both types of routines must be called using the CALL_COMMAND_HANDLER macro.
+Both types of routines must be called using the @c CALL_COMMAND_HANDLER macro.
 Calls using this macro to normal handlers require the name of the command
 handler (which can a name or function pointer).  Calls to helpers and
 derived handlers must pass those extra parameters specified by their
@@ -67,22 +67,18 @@ will be able to use direct invocations.
 Thus, the following macros can be used to define and call command
 handlers or helpers:
 
-- COMMAND_HANDLER - declare or define a command handler.
-- COMMAND_HELPER - declare or define a derived command handler or helper.
-- CALL_COMMAND_COMMAND - call a command handler/helper.
-
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">- at subsection</A> helpercmdhandlerparam Command Handler Parameters
-
-The following parameters are defined in the scope of all command
-handlers and helpers:
-- &lt;code&gt;struct command_context *cmd_ctx&lt;/code&gt; - the command's context
-- &lt;code&gt;unsigned argc&lt;/code&gt; - the number of command arguments
-- &lt;code&gt;const char *args[]&lt;/code&gt; - contains the command arguments
+- @c COMMAND_HANDLER - declare or define a command handler.
+- @c COMMAND_HELPER - declare or define a derived command handler or helper.
+- @c CALL_COMMAND_COMMAND - call a command handler/helper.
 
 @subsection helpercmdhandlermacros Command Handler Macros
 
-In addition, the following macro may be used:
-- &lt;code&gt;COMMAND_NAME&lt;/code&gt; - contains the command name
+In addition, the following macros may be used in the context of
+command handlers and helpers:
+- @c CMD_CTX - the current @c command_context
+- @c CMD_NAME - invoked command name
+- @c CMD_ARGC - the number of command arguments
+- @c CMD_ARGV - array of command argument strings
 
 @section helpercmdprimer Command Development Primer
 
diff --git a/doc/manual/primer/commands.txt b/doc/manual/primer/commands.txt
index 9efcca2..b15f669 100644
--- a/doc/manual/primer/commands.txt
+++ b/doc/manual/primer/commands.txt
@@ -16,7 +16,7 @@ COMMAND_HANDLER(handle_hello_command)
 	const char *sep, *name;
 	int retval = CALL_COMMAND_HANDLER(handle_hello_args);
 	if (ERROR_OK == retval)
-		command_print(cmd_ctx, &quot;Greetings%s%s!&quot;, sep, name);
+		command_print(CMD_CTX, &quot;Greetings%s%s!&quot;, sep, name);
 	return retval;
 }
 @endcode
@@ -39,13 +39,13 @@ static COMMAND_HELPER(handle_hello_args, const char **sep, const char **name)
 {
 	if (argc &gt; 1)
 	{
-		LOG_ERROR(&quot;%s: too many arguments&quot;, COMMAND_NAME);
+		LOG_ERROR(&quot;%s: too many arguments&quot;, CMD_NAME);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	if (1 == argc)
+	if (1 == CMD_ARGC)
 	{
 		*sep = &quot;, &quot;;
-		*name = args[0];
+		*name = CMD_ARGV[0];
 	}
 	else
 		*sep = *name = &quot;&quot;;
@@ -96,4 +96,9 @@ Greetings, John Doe!
 Error: ocd_hello: too many arguments
 @endcode
 
+This difference between the registered and displayed command name comes from
+the fact that the TCL scripts are provided with a stub that calls the munged
+name.  This stub wraps the internal &lt;code&gt;ocd_&lt;/code&gt;-prefixed routine,
+providing a measure of high-level error handling.
+
  */

commit cfaf7bdd0aedb23a4837078db808be450e5efc30
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 16 15:45:17 2009 -0800

    remove unused variable from run_command

diff --git a/src/helper/command.c b/src/helper/command.c
index b9d0d08..ad09e3d 100644
--- a/src/helper/command.c
+++ b/src/helper/command.c
@@ -438,7 +438,6 @@ char *command_name(struct command *c, char delim)
 static int run_command(struct command_context *context,
 		struct command *c, const char *words[], unsigned num_words)
 {
-	int start_word = 0;
 	if (!((context-&gt;mode == COMMAND_CONFIG) || (c-&gt;mode == COMMAND_ANY) || (c-&gt;mode == context-&gt;mode)))
 	{
 		/* Config commands can not run after the config stage */
@@ -449,8 +448,8 @@ static int run_command(struct command_context *context,
 	struct command_invocation cmd = {
 			.ctx = context,
 			.name = c-&gt;name,
-			.argc = num_words - start_word - 1,
-			.argv = words + start_word + 1,
+			.argc = num_words - 1,
+			.argv = words + 1,
 		};
 	int retval = c-&gt;handler(&amp;cmd);
 	if (retval == ERROR_COMMAND_SYNTAX_ERROR)

commit cffc98ad8047b6dc8d38a6422136638f2df992d2
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 16 05:46:15 2009 -0800

    add CMD_NAME variable in command_invocation
    
    Update CMD_NAME from its migratory home in CMD_ARGV[-1] to cmd-&gt;name.
    Allows CMD_ARGV++ idiom to be used safely in command handlers.

diff --git a/src/helper/command.c b/src/helper/command.c
index 96d23ab..b9d0d08 100644
--- a/src/helper/command.c
+++ b/src/helper/command.c
@@ -102,8 +102,7 @@ static int script_command(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 
 	script_debug(interp, c-&gt;name, argc, argv);
 
-	words = malloc(sizeof(char *) * (argc + 1));
-	words[0] = c-&gt;name;
+	words = malloc(argc * sizeof(char *));
 	for (i = 0; i &lt; argc; i++)
 	{
 		int len;
@@ -113,12 +112,12 @@ static int script_command(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 			/* hit an end of line comment */
 			break;
 		}
-		words[i + 1] = strdup(w);
-		if (words[i + 1] == NULL)
+		words[i] = strdup(w);
+		if (words[i] == NULL)
 		{
 			int j;
 			for (j = 0; j &lt; i; j++)
-				free(words[j + 1]);
+				free(words[j]);
 			free(words);
 			return JIM_ERR;
 		}
@@ -143,7 +142,7 @@ static int script_command(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 	log_add_callback(tcl_output, tclOutput);
 
 	// turn words[0] into CMD_ARGV[-1] with this cast
-	retval = run_command(context, c, (const char **)words + 1, nwords);
+	retval = run_command(context, c, (const char **)words, nwords);
 
 	log_remove_callback(tcl_output, tclOutput);
 
@@ -152,7 +151,7 @@ static int script_command(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 	Jim_DecrRefCount(interp, tclOutput);
 
 	for (i = 0; i &lt; nwords; i++)
-		free(words[i + 1]);
+		free(words[i]);
 	free(words);
 
 	int *return_retval = Jim_GetAssocData(interp, &quot;retval&quot;);
@@ -449,6 +448,7 @@ static int run_command(struct command_context *context,
 
 	struct command_invocation cmd = {
 			.ctx = context,
+			.name = c-&gt;name,
 			.argc = num_words - start_word - 1,
 			.argv = words + start_word + 1,
 		};
diff --git a/src/helper/command.h b/src/helper/command.h
index b8ea3a4..62231fc 100644
--- a/src/helper/command.h
+++ b/src/helper/command.h
@@ -87,6 +87,7 @@ struct command_context
  */
 struct command_invocation {
 	struct command_context *ctx;
+	const char *name;
 	unsigned argc;
 	const char **argv;
 };
@@ -149,7 +150,7 @@ struct command_invocation {
  * Use this macro to access the name of the command being handled,
  * rather than accessing the variable directly.  It may be moved.
  */
-#define CMD_NAME CMD_ARGV[-1]
+#define CMD_NAME cmd-&gt;name
 
 
 /// The type signature for commands' handler functions.

commit be084414ba00a4ad641af04c3c6858312dd1b336
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 15 04:21:17 2009 -0800

    add struct command_invocation for COMMAND_HANDLER
    
    Adds the command_invocation structure to encapsulate parameters for
    all COMMAND_HANDLER routines.  Rather than passing several arguments
    to each successive subroutine, a single pointer may be passed around.
    
    Changes the CMD_* macros to reference the new fields.
    
    Updates run_command to create an instance and pass it to the handler.

diff --git a/src/helper/command.c b/src/helper/command.c
index fdb59f0..96d23ab 100644
--- a/src/helper/command.c
+++ b/src/helper/command.c
@@ -447,9 +447,12 @@ static int run_command(struct command_context *context,
 		return ERROR_FAIL;
 	}
 
-	unsigned argc = num_words - start_word - 1;
-	const char **args = words + start_word + 1;
-	int retval = c-&gt;handler(context, args, argc);
+	struct command_invocation cmd = {
+			.ctx = context,
+			.argc = num_words - start_word - 1,
+			.argv = words + start_word + 1,
+		};
+	int retval = c-&gt;handler(&amp;cmd);
 	if (retval == ERROR_COMMAND_SYNTAX_ERROR)
 	{
 		/* Print help for command */
diff --git a/src/helper/command.h b/src/helper/command.h
index 7484964..b8ea3a4 100644
--- a/src/helper/command.h
+++ b/src/helper/command.h
@@ -80,6 +80,16 @@ struct command_context
 	void *output_handler_priv;
 };
 
+/**
+ * When run_command is called, a new instance will be created on the
+ * stack, filled with the proper values, and passed by reference to the
+ * required COMMAND_HANDLER routine.
+ */
+struct command_invocation {
+	struct command_context *ctx;
+	unsigned argc;
+	const char **argv;
+};
 
 /**
  * Command handlers may be defined with more parameters than the base
@@ -87,8 +97,7 @@ struct command_context
  * defining all such derivative types using this macro.
  */
 #define __COMMAND_HANDLER(name, extra...) \
-		int name(struct command_context *cmd_ctx, \
-				const char *args[], unsigned argc, ##extra)
+		int name(struct command_invocation *cmd, ##extra)
 
 /**
  * Use this to macro to call a command helper (or a nested handler).
@@ -104,7 +113,7 @@ struct command_context
  * variables in intervening scope(s) by accident.
  */
 #define CALL_COMMAND_HANDLER(name, extra...) \
-		name(cmd_ctx, args, argc, ##extra)
+		name(cmd, ##extra)
 
 /**
  * Always use this macro to define new command handler functions.
@@ -125,17 +134,17 @@ struct command_context
  * Use this macro to access the context of the command being handled,
  * rather than accessing the variable directly.  It may be moved.
  */
-#define CMD_CTX cmd_ctx
+#define CMD_CTX cmd-&gt;ctx
 /**
  * Use this macro to access the number of arguments for the command being
  * handled, rather than accessing the variable directly.  It may be moved.
  */
-#define CMD_ARGC argc
+#define CMD_ARGC cmd-&gt;argc
 /**
  * Use this macro to access the arguments for the command being handled,
  * rather than accessing the variable directly.  It may be moved.
  */
-#define CMD_ARGV args
+#define CMD_ARGV cmd-&gt;argv
 /**
  * Use this macro to access the name of the command being handled,
  * rather than accessing the variable directly.  It may be moved.

commit 2861877b32a7a2f4022a1c3d9b66c9b4879878ac
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 15 05:57:37 2009 -0800

    command_handler: change 'cmd_ctx' to CMD_CTX
    
    Convert all command handler 'cmd_ctx' parameter usage with CMD_CTX.

diff --git a/src/flash/at91sam3.c b/src/flash/at91sam3.c
index 4cf4d20..195da91 100644
--- a/src/flash/at91sam3.c
+++ b/src/flash/at91sam3.c
@@ -2267,7 +2267,7 @@ COMMAND_HANDLER(sam3_handle_info_command)
 	unsigned x;
 	int r;
 
-	pChip = get_current_sam3(cmd_ctx);
+	pChip = get_current_sam3(CMD_CTX);
 	if (!pChip) {
 		return ERROR_OK;
 	}
@@ -2278,7 +2278,7 @@ COMMAND_HANDLER(sam3_handle_info_command)
 	if (pChip-&gt;details.bank[0].pBank == NULL) {
 		x = 0;
 	need_define:
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 					   &quot;Please define bank %d via command: flash bank %s ... &quot;,
 					   x,
 					   at91sam3_flash.name);
@@ -2329,7 +2329,7 @@ COMMAND_HANDLER(sam3_handle_info_command)
 	// print results
 	cp = membuf_strtok(pChip-&gt;mbuf, &quot;\n&quot;, &amp;vp);
 	while (cp) {
-		command_print(cmd_ctx,&quot;%s&quot;, cp);
+		command_print(CMD_CTX,&quot;%s&quot;, cp);
 		cp = membuf_strtok(NULL, &quot;\n&quot;, &amp;vp);
 	}
 	return ERROR_OK;
@@ -2341,7 +2341,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 	int r,who;
 	struct sam3_chip *pChip;
 
-	pChip = get_current_sam3(cmd_ctx);
+	pChip = get_current_sam3(CMD_CTX);
 	if (!pChip) {
 		return ERROR_OK;
 	}
@@ -2353,7 +2353,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 
 
 	if (pChip-&gt;details.bank[0].pBank == NULL) {
-		command_print(cmd_ctx, &quot;Bank0 must be defined first via: flash bank %s ...&quot;,
+		command_print(CMD_CTX, &quot;Bank0 must be defined first via: flash bank %s ...&quot;,
 					   at91sam3_flash.name);
 		return ERROR_FAIL;
 	}
@@ -2367,7 +2367,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 
 	switch (CMD_ARGC) {
 	default:
-		command_print(cmd_ctx,&quot;Too many parameters\n&quot;);
+		command_print(CMD_CTX,&quot;Too many parameters\n&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 		break;
 	case 0:
@@ -2397,22 +2397,22 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 				if (r != ERROR_OK) {
 					break;
 				}
-				command_print(cmd_ctx, &quot;sam3-gpnvm%u: %u&quot;, x, v);
+				command_print(CMD_CTX, &quot;sam3-gpnvm%u: %u&quot;, x, v);
 			}
 			return r;
 		}
 		if ((who &gt;= 0) &amp;&amp; (((unsigned)(who)) &lt; pChip-&gt;details.n_gpnvms)) {
 			r = FLASHD_GetGPNVM(&amp;(pChip-&gt;details.bank[0]), who, &amp;v);
-			command_print(cmd_ctx, &quot;sam3-gpnvm%u: %u&quot;, who, v);
+			command_print(CMD_CTX, &quot;sam3-gpnvm%u: %u&quot;, who, v);
 			return r;
 		} else {
-			command_print(cmd_ctx, &quot;sam3-gpnvm invalid GPNVM: %u&quot;, who);
+			command_print(CMD_CTX, &quot;sam3-gpnvm invalid GPNVM: %u&quot;, who);
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
 	}
 
 	if (who == -1) {
-		command_print(cmd_ctx, &quot;Missing GPNVM number&quot;);
+		command_print(CMD_CTX, &quot;Missing GPNVM number&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -2422,7 +2422,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 			   (0 == strcmp(&quot;clear&quot;, CMD_ARGV[0]))) { // quietly accept both
 		r = FLASHD_ClrGPNVM(&amp;(pChip-&gt;details.bank[0]), who);
 	} else {
-		command_print(cmd_ctx, &quot;Unkown command: %s&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;Unkown command: %s&quot;, CMD_ARGV[0]);
 		r = ERROR_COMMAND_SYNTAX_ERROR;
 	}
 	return r;
@@ -2432,7 +2432,7 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 {
 	struct sam3_chip *pChip;
 
-	pChip = get_current_sam3(cmd_ctx);
+	pChip = get_current_sam3(CMD_CTX);
 	if (!pChip) {
 		return ERROR_OK;
 	}
@@ -2449,7 +2449,7 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], v);
 		if (v &gt; 200000) {
 			// absurd slow clock of 200Khz?
-			command_print(cmd_ctx,&quot;Absurd/illegal slow clock freq: %d\n&quot;, (int)(v));
+			command_print(CMD_CTX,&quot;Absurd/illegal slow clock freq: %d\n&quot;, (int)(v));
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
 		pChip-&gt;cfg.slow_freq = v;
@@ -2457,11 +2457,11 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 	}
 	default:
 		// error
-		command_print(cmd_ctx,&quot;Too many parameters&quot;);
+		command_print(CMD_CTX,&quot;Too many parameters&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 		break;
 	}
-	command_print(cmd_ctx, &quot;Slowclk freq: %d.%03dkhz&quot;,
+	command_print(CMD_CTX, &quot;Slowclk freq: %d.%03dkhz&quot;,
 				   (int)(pChip-&gt;cfg.slow_freq/ 1000),
 				   (int)(pChip-&gt;cfg.slow_freq% 1000));
 	return ERROR_OK;
diff --git a/src/flash/at91sam7.c b/src/flash/at91sam7.c
index d23d2b0..3e5dbdd 100644
--- a/src/flash/at91sam7.c
+++ b/src/flash/at91sam7.c
@@ -1109,7 +1109,7 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 
 	if (CMD_ARGC != 2)
 	{
-		command_print(cmd_ctx, &quot;at91sam7 gpnvm &lt;bit&gt; &lt;set | clear&gt;&quot;);
+		command_print(CMD_CTX, &quot;at91sam7 gpnvm &lt;bit&gt; &lt;set | clear&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1120,7 +1120,7 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 	}
 	if (strcmp(bank-&gt;driver-&gt;name, &quot;at91sam7&quot;))
 	{
-		command_print(cmd_ctx, &quot;not an at91sam7 flash bank '%s'&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;not an at91sam7 flash bank '%s'&quot;, CMD_ARGV[0]);
 		return ERROR_FLASH_BANK_INVALID;
 	}
 	if (bank-&gt;target-&gt;state != TARGET_HALTED)
@@ -1155,7 +1155,7 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 	COMMAND_PARSE_NUMBER(int, CMD_ARGV[0], bit);
 	if ((bit &lt; 0) || (bit &gt;= at91sam7_info-&gt;num_nvmbits))
 	{
-		command_print(cmd_ctx, &quot;gpnvm bit '#%s' is out of bounds for target %s&quot;, CMD_ARGV[0], at91sam7_info-&gt;target_name);
+		command_print(CMD_CTX, &quot;gpnvm bit '#%s' is out of bounds for target %s&quot;, CMD_ARGV[0], at91sam7_info-&gt;target_name);
 		return ERROR_OK;
 	}
 
diff --git a/src/flash/avrf.c b/src/flash/avrf.c
index f1db3c4..20c619d 100644
--- a/src/flash/avrf.c
+++ b/src/flash/avrf.c
@@ -421,7 +421,7 @@ COMMAND_HANDLER(avrf_handle_mass_erase_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;avr mass_erase &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;avr mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -438,11 +438,11 @@ COMMAND_HANDLER(avrf_handle_mass_erase_command)
 			bank-&gt;sectors[i].is_erased = 1;
 		}
 
-		command_print(cmd_ctx, &quot;avr mass erase complete&quot;);
+		command_print(CMD_CTX, &quot;avr mass erase complete&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;avr mass erase failed&quot;);
+		command_print(CMD_CTX, &quot;avr mass erase failed&quot;);
 	}
 
 	LOG_DEBUG(&quot;%s&quot;, __FUNCTION__);
diff --git a/src/flash/flash.c b/src/flash/flash.c
index 99e71d7..2c63b82 100644
--- a/src/flash/flash.c
+++ b/src/flash/flash.c
@@ -208,7 +208,7 @@ COMMAND_HELPER(flash_command_get_bank_by_num,
 	*bank = get_flash_bank_by_num(bank_num);
 	if (!*bank)
 	{
-		command_print(cmd_ctx, &quot;flash bank '%s' not found&quot;, name);
+		command_print(CMD_CTX, &quot;flash bank '%s' not found&quot;, name);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	return ERROR_OK;
@@ -241,7 +241,7 @@ COMMAND_HANDLER(handle_flash_bank_command)
 		struct flash_bank *p, *c;
 
 		/* register flash specific commands */
-		if (flash_drivers[i]-&gt;register_commands(cmd_ctx) != ERROR_OK)
+		if (flash_drivers[i]-&gt;register_commands(CMD_CTX) != ERROR_OK)
 		{
 			LOG_ERROR(&quot;couldn't register '%s' commands&quot;, CMD_ARGV[0]);
 			return ERROR_FAIL;
@@ -320,7 +320,7 @@ COMMAND_HANDLER(handle_flash_info_command)
 		if ((retval = p-&gt;driver-&gt;auto_probe(p)) != ERROR_OK)
 			return retval;
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			      &quot;#%&quot; PRIi32 &quot; : %s at 0x%8.8&quot; PRIx32 &quot;, size 0x%8.8&quot; PRIx32 &quot;, buswidth %i, chipwidth %i&quot;,
 			      i,
 			      p-&gt;driver-&gt;name,
@@ -339,7 +339,7 @@ COMMAND_HANDLER(handle_flash_info_command)
 			else
 				protect_state = &quot;protection state unknown&quot;;
 
-			command_print(cmd_ctx,
+			command_print(CMD_CTX,
 				      &quot;\t#%3i: 0x%8.8&quot; PRIx32 &quot; (0x%&quot; PRIx32 &quot; %&quot; PRIi32 &quot;kB) %s&quot;,
 				      j,
 				      p-&gt;sectors[j].offset,
@@ -350,7 +350,7 @@ COMMAND_HANDLER(handle_flash_info_command)
 
 		*buf = '\0'; /* initialize buffer, otherwise it migh contain garbage if driver function fails */
 		retval = p-&gt;driver-&gt;info(p, buf, sizeof(buf));
-		command_print(cmd_ctx, &quot;%s&quot;, buf);
+		command_print(CMD_CTX, &quot;%s&quot;, buf);
 		if (retval != ERROR_OK)
 			LOG_ERROR(&quot;error retrieving flash info (%d)&quot;, retval);
 	}
@@ -374,22 +374,22 @@ COMMAND_HANDLER(handle_flash_probe_command)
 	{
 		if ((retval = p-&gt;driver-&gt;probe(p)) == ERROR_OK)
 		{
-			command_print(cmd_ctx, &quot;flash '%s' found at 0x%8.8&quot; PRIx32, p-&gt;driver-&gt;name, p-&gt;base);
+			command_print(CMD_CTX, &quot;flash '%s' found at 0x%8.8&quot; PRIx32, p-&gt;driver-&gt;name, p-&gt;base);
 		}
 		else if (retval == ERROR_FLASH_BANK_INVALID)
 		{
-			command_print(cmd_ctx, &quot;probing failed for flash bank '#%s' at 0x%8.8&quot; PRIx32,
+			command_print(CMD_CTX, &quot;probing failed for flash bank '#%s' at 0x%8.8&quot; PRIx32,
 						  CMD_ARGV[0], p-&gt;base);
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;unknown error when probing flash bank '#%s' at 0x%8.8&quot; PRIx32,
+			command_print(CMD_CTX, &quot;unknown error when probing flash bank '#%s' at 0x%8.8&quot; PRIx32,
 						  CMD_ARGV[0], p-&gt;base);
 		}
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;flash bank '#%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;flash bank '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 	}
 
 	return ERROR_OK;
@@ -410,11 +410,11 @@ COMMAND_HANDLER(handle_flash_erase_check_command)
 	int j;
 	if ((retval = p-&gt;driver-&gt;erase_check(p)) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;successfully checked erase state&quot;);
+		command_print(CMD_CTX, &quot;successfully checked erase state&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when checking erase state of flash bank #%s at 0x%8.8&quot; PRIx32,
+		command_print(CMD_CTX, &quot;unknown error when checking erase state of flash bank #%s at 0x%8.8&quot; PRIx32,
 			CMD_ARGV[0], p-&gt;base);
 	}
 
@@ -429,7 +429,7 @@ COMMAND_HANDLER(handle_flash_erase_check_command)
 		else
 			erase_state = &quot;erase state unknown&quot;;
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			      &quot;\t#%3i: 0x%8.8&quot; PRIx32 &quot; (0x%&quot; PRIx32 &quot; %&quot; PRIi32 &quot;kB) %s&quot;,
 			      j,
 			      p-&gt;sectors[j].offset,
@@ -448,7 +448,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 	int address;
 	int length;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC != 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -457,7 +457,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 	COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], length);
 	if (length &lt;= 0)
 	{
-		command_print(cmd_ctx, &quot;Length must be &gt;0&quot;);
+		command_print(CMD_CTX, &quot;Length must be &gt;0&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -477,7 +477,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;erased address 0x%8.8x (length %i)&quot;
+		command_print(CMD_CTX, &quot;erased address 0x%8.8x (length %i)&quot;
 				&quot; in %fs (%0.3f kb/s)&quot;, address, length,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, length));
 	}
@@ -497,15 +497,15 @@ COMMAND_HANDLER(handle_flash_protect_check_command)
 
 	if ((retval = p-&gt;driver-&gt;protect_check(p)) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;successfully checked protect state&quot;);
+		command_print(CMD_CTX, &quot;successfully checked protect state&quot;);
 	}
 	else if (retval == ERROR_FLASH_OPERATION_FAILED)
 	{
-		command_print(cmd_ctx, &quot;checking protection state failed (possibly unsupported) by flash #%s at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
+		command_print(CMD_CTX, &quot;checking protection state failed (possibly unsupported) by flash #%s at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when checking protection state of flash bank '#%s' at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
+		command_print(CMD_CTX, &quot;unknown error when checking protection state of flash bank '#%s' at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
 	}
 
 	return ERROR_OK;
@@ -550,7 +550,7 @@ COMMAND_HANDLER(handle_flash_erase_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], last);
 
 	int retval;
-	if ((retval = flash_check_sector_parameters(cmd_ctx,
+	if ((retval = flash_check_sector_parameters(CMD_CTX,
 			first, last, p-&gt;num_sectors)) != ERROR_OK)
 		return retval;
 
@@ -561,7 +561,7 @@ COMMAND_HANDLER(handle_flash_erase_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;erased sectors %&quot; PRIu32 &quot; &quot;
+		command_print(CMD_CTX, &quot;erased sectors %&quot; PRIu32 &quot; &quot;
 				&quot;through %&quot; PRIu32&quot; on flash bank %&quot; PRIu32 &quot; &quot;
 				&quot;in %fs&quot;, first, last, bank_nr, duration_elapsed(&amp;bench));
 	}
@@ -598,13 +598,13 @@ COMMAND_HANDLER(handle_flash_protect_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int retval;
-	if ((retval = flash_check_sector_parameters(cmd_ctx,
+	if ((retval = flash_check_sector_parameters(CMD_CTX,
 			first, last, p-&gt;num_sectors)) != ERROR_OK)
 		return retval;
 
 	retval = flash_driver_protect(p, set, first, last);
 	if (retval == ERROR_OK) {
-		command_print(cmd_ctx, &quot;%s protection for sectors %i &quot;
+		command_print(CMD_CTX, &quot;%s protection for sectors %i &quot;
 				&quot;through %i on flash bank %i&quot;,
 			(set) ? &quot;set&quot; : &quot;cleared&quot;, (int) first,
 			(int) last, (int) bank_nr);
@@ -615,7 +615,7 @@ COMMAND_HANDLER(handle_flash_protect_command)
 
 COMMAND_HANDLER(handle_flash_write_image_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	struct image image;
 	uint32_t written;
@@ -638,13 +638,13 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 			auto_erase = 1;
 			CMD_ARGV++;
 			CMD_ARGC--;
-			command_print(cmd_ctx, &quot;auto erase enabled&quot;);
+			command_print(CMD_CTX, &quot;auto erase enabled&quot;);
 		} else if (strcmp(CMD_ARGV[0], &quot;unlock&quot;) == 0)
 		{
 			auto_unlock = true;
 			CMD_ARGV++;
 			CMD_ARGC--;
-			command_print(cmd_ctx, &quot;auto unlock enabled&quot;);
+			command_print(CMD_CTX, &quot;auto unlock enabled&quot;);
 		} else
 		{
 			break;
@@ -693,7 +693,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;wrote %&quot; PRIu32 &quot; byte from file %s &quot;
+		command_print(CMD_CTX, &quot;wrote %&quot; PRIu32 &quot; byte from file %s &quot;
 				&quot;in %fs (%0.3f kb/s)&quot;, written, CMD_ARGV[0],
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, written));
 	}
@@ -714,7 +714,7 @@ COMMAND_HANDLER(handle_flash_fill_command)
 	uint32_t wrote = 0;
 	uint32_t cur_size = 0;
 	uint32_t chunk_count;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	uint32_t i;
 	uint32_t wordsize;
 
@@ -800,7 +800,7 @@ COMMAND_HANDLER(handle_flash_fill_command)
 
 	if (duration_measure(&amp;bench) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;wrote %&quot; PRIu32 &quot; bytes to 0x%8.8&quot; PRIx32 
+		command_print(CMD_CTX, &quot;wrote %&quot; PRIu32 &quot; bytes to 0x%8.8&quot; PRIx32
 				&quot; in %fs (%0.3f kb/s)&quot;, wrote, address,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, wrote));
 	}
@@ -847,7 +847,7 @@ COMMAND_HANDLER(handle_flash_write_bank_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;wrote %zu byte from file %s to flash bank %u&quot;
+		command_print(CMD_CTX, &quot;wrote %zu byte from file %s to flash bank %u&quot;
 				&quot; at offset 0x%8.8&quot; PRIx32 &quot; in %fs (%0.3f kb/s)&quot;,
 				fileio.size, CMD_ARGV[1], p-&gt;bank_number, offset,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, fileio.size));
diff --git a/src/flash/lpc2000.c b/src/flash/lpc2000.c
index 6378130..191eb4b 100644
--- a/src/flash/lpc2000.c
+++ b/src/flash/lpc2000.c
@@ -764,14 +764,14 @@ COMMAND_HANDLER(lpc2000_handle_part_id_command)
 	{
 		if (status_code == ERROR_FLASH_OPERATION_FAILED)
 		{
-			command_print(cmd_ctx, &quot;no sufficient working area specified, can't access LPC2000 IAP interface&quot;);
+			command_print(CMD_CTX, &quot;no sufficient working area specified, can't access LPC2000 IAP interface&quot;);
 			return ERROR_OK;
 		}
-		command_print(cmd_ctx, &quot;lpc2000 IAP returned status code %i&quot;, status_code);
+		command_print(CMD_CTX, &quot;lpc2000 IAP returned status code %i&quot;, status_code);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;lpc2000 part id: 0x%8.8&quot; PRIx32 , result_table[0]);
+		command_print(CMD_CTX, &quot;lpc2000 part id: 0x%8.8&quot; PRIx32 , result_table[0]);
 	}
 
 	return ERROR_OK;
diff --git a/src/flash/lpc2900.c b/src/flash/lpc2900.c
index 98b13bf..1d5abd9 100644
--- a/src/flash/lpc2900.c
+++ b/src/flash/lpc2900.c
@@ -564,7 +564,7 @@ COMMAND_HANDLER(lpc2900_handle_signature_command)
 		return status;
 	}
 
-	command_print( cmd_ctx, &quot;signature: 0x%8.8&quot; PRIx32
+	command_print( CMD_CTX, &quot;signature: 0x%8.8&quot; PRIx32
 	                                  &quot;:0x%8.8&quot; PRIx32
 	                                  &quot;:0x%8.8&quot; PRIx32
 	                                  &quot;:0x%8.8&quot; PRIx32,
@@ -672,11 +672,11 @@ COMMAND_HANDLER(lpc2900_handle_password_command)
 
 	if( !lpc2900_info-&gt;risky )
 	{
-		command_print(cmd_ctx, &quot;Wrong password (use '%s')&quot;, ISS_PASSWORD);
+		command_print(CMD_CTX, &quot;Wrong password (use '%s')&quot;, ISS_PASSWORD);
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
 
-	command_print(cmd_ctx,
+	command_print(CMD_CTX,
                   &quot;Potentially dangerous operation allowed in next command!&quot;);
 
 	return ERROR_OK;
@@ -704,7 +704,7 @@ COMMAND_HANDLER(lpc2900_handle_write_custom_command)
 	/* Check if command execution is allowed. */
 	if( !lpc2900_info-&gt;risky )
 	{
-		command_print( cmd_ctx, &quot;Command execution not allowed!&quot; );
+		command_print( CMD_CTX, &quot;Command execution not allowed!&quot; );
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
 	lpc2900_info-&gt;risky = 0;
@@ -815,7 +815,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
 	/* Check if command execution is allowed. */
 	if( !lpc2900_info-&gt;risky )
 	{
-		command_print( cmd_ctx, &quot;Command execution not allowed! &quot;
+		command_print( CMD_CTX, &quot;Command execution not allowed! &quot;
 		&quot;(use 'password' command first)&quot;);
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
@@ -829,7 +829,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
 	    (last &gt;= bank-&gt;num_sectors) ||
 	    (first &gt; last) )
 	{
-		command_print( cmd_ctx, &quot;Illegal sector range&quot; );
+		command_print( CMD_CTX, &quot;Illegal sector range&quot; );
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
 
@@ -878,7 +878,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
 		}
 	}
 
-	command_print( cmd_ctx,
+	command_print( CMD_CTX,
 	        &quot;Sectors security will become effective after next power cycle&quot;);
 
 	/* Update the sector security status */
@@ -914,7 +914,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_jtag_command)
 	/* Check if command execution is allowed. */
 	if( !lpc2900_info-&gt;risky )
 	{
-		command_print( cmd_ctx, &quot;Command execution not allowed! &quot;
+		command_print( CMD_CTX, &quot;Command execution not allowed! &quot;
 		                        &quot;(use 'password' command first)&quot;);
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
diff --git a/src/flash/lpc3180_nand_controller.c b/src/flash/lpc3180_nand_controller.c
index 1de48f4..61bef90 100644
--- a/src/flash/lpc3180_nand_controller.c
+++ b/src/flash/lpc3180_nand_controller.c
@@ -846,7 +846,7 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 	struct nand_device *nand = get_nand_device_by_num(num);
 	if (!nand)
 	{
-		command_print(cmd_ctx, &quot;nand device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;nand device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -868,7 +868,7 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;%s controller selected&quot;, selected[lpc3180_info-&gt;selected_controller]);
+	command_print(CMD_CTX, &quot;%s controller selected&quot;, selected[lpc3180_info-&gt;selected_controller]);
 
 	return ERROR_OK;
 }
diff --git a/src/flash/mflash.c b/src/flash/mflash.c
index 64f332e..2a1fbe5 100644
--- a/src/flash/mflash.c
+++ b/src/flash/mflash.c
@@ -416,7 +416,7 @@ COMMAND_HANDLER(mg_probe_cmd)
 	ret = mg_mflash_probe();
 
 	if (ret == ERROR_OK) {
-		command_print(cmd_ctx, &quot;mflash (total %&quot; PRIu32 &quot; sectors) found at 0x%8.8&quot; PRIx32 &quot;&quot;,
+		command_print(CMD_CTX, &quot;mflash (total %&quot; PRIu32 &quot; sectors) found at 0x%8.8&quot; PRIx32 &quot;&quot;,
 				mflash_bank-&gt;drv_info-&gt;tot_sects, mflash_bank-&gt;base);
 	}
 
@@ -751,7 +751,7 @@ COMMAND_HANDLER(mg_write_cmd)
 
 	if (duration_measure(&amp;bench) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;wrote %zu byte from file %s &quot;
+		command_print(CMD_CTX, &quot;wrote %zu byte from file %s &quot;
 				&quot;in %fs (%0.3f kB/s)&quot;, fileio.size, CMD_ARGV[1],
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, fileio.size));
 	}
@@ -817,7 +817,7 @@ COMMAND_HANDLER(mg_dump_cmd)
 
 	if (duration_measure(&amp;bench) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;dump image (address 0x%8.8&quot; PRIx32 &quot; &quot;
+		command_print(CMD_CTX, &quot;dump image (address 0x%8.8&quot; PRIx32 &quot; &quot;
 				&quot;size %&quot; PRIu32 &quot;) to file %s in %fs (%0.3f kB/s)&quot;,
 				address, size, CMD_ARGV[1],
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, size));
diff --git a/src/flash/nand.c b/src/flash/nand.c
index ce713b9..c96354a 100644
--- a/src/flash/nand.c
+++ b/src/flash/nand.c
@@ -223,7 +223,7 @@ COMMAND_HANDLER(handle_nand_device_command)
 		if (strcmp(CMD_ARGV[0], nand_flash_controllers[i]-&gt;name) == 0)
 		{
 			/* register flash specific commands */
-			if ((retval = nand_flash_controllers[i]-&gt;register_commands(cmd_ctx)) != ERROR_OK)
+			if ((retval = nand_flash_controllers[i]-&gt;register_commands(CMD_CTX)) != ERROR_OK)
 			{
 				LOG_ERROR(&quot;couldn't register '%s' commands&quot;, CMD_ARGV[0]);
 				return retval;
@@ -312,7 +312,7 @@ COMMAND_HELPER(nand_command_get_device_by_num, unsigned name_index,
 	COMMAND_PARSE_NUMBER(uint, str, num);
 	*nand = get_nand_device_by_num(num);
 	if (!*nand) {
-		command_print(cmd_ctx, &quot;NAND flash device '#%s' is out of bounds&quot;, str);
+		command_print(CMD_CTX, &quot;NAND flash device '#%s' is out of bounds&quot;, str);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	return ERROR_OK;
@@ -1050,21 +1050,21 @@ COMMAND_HANDLER(handle_nand_list_command)
 
 	if (!nand_devices)
 	{
-		command_print(cmd_ctx, &quot;no NAND flash devices configured&quot;);
+		command_print(CMD_CTX, &quot;no NAND flash devices configured&quot;);
 		return ERROR_OK;
 	}
 
 	for (p = nand_devices, i = 0; p; p = p-&gt;next, i++)
 	{
 		if (p-&gt;device)
-			command_print(cmd_ctx, &quot;#%i: %s (%s) &quot;
+			command_print(CMD_CTX, &quot;#%i: %s (%s) &quot;
 				&quot;pagesize: %i, buswidth: %i,\n\t&quot;
 				&quot;blocksize: %i, blocks: %i&quot;,
 				i, p-&gt;device-&gt;name, p-&gt;manufacturer-&gt;name,
 				p-&gt;page_size, p-&gt;bus_width,
 				p-&gt;erase_size, p-&gt;num_blocks);
 		else
-			command_print(cmd_ctx, &quot;#%i: not probed&quot;, i);
+			command_print(CMD_CTX, &quot;#%i: not probed&quot;, i);
 	}
 
 	return ERROR_OK;
@@ -1102,7 +1102,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 
 	if (NULL == p-&gt;device)
 	{
-		command_print(cmd_ctx, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -1112,7 +1112,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 	if (last &gt;= p-&gt;num_blocks)
 		last = p-&gt;num_blocks - 1;
 
-	command_print(cmd_ctx, &quot;#%i: %s (%s) pagesize: %i, buswidth: %i, erasesize: %i&quot;,
+	command_print(CMD_CTX, &quot;#%i: %s (%s) pagesize: %i, buswidth: %i, erasesize: %i&quot;,
 		i++, p-&gt;device-&gt;name, p-&gt;manufacturer-&gt;name, p-&gt;page_size, p-&gt;bus_width, p-&gt;erase_size);
 
 	for (j = first; j &lt;= last; j++)
@@ -1133,7 +1133,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 		else
 			bad_state = &quot; (block condition unknown)&quot;;
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			      &quot;\t#%i: 0x%8.8&quot; PRIx32 &quot; (%&quot; PRId32 &quot;kB) %s%s&quot;,
 			      j,
 			      p-&gt;blocks[j].offset,
@@ -1159,15 +1159,15 @@ COMMAND_HANDLER(handle_nand_probe_command)
 
 	if ((retval = nand_probe(p)) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;NAND flash device '%s' found&quot;, p-&gt;device-&gt;name);
+		command_print(CMD_CTX, &quot;NAND flash device '%s' found&quot;, p-&gt;device-&gt;name);
 	}
 	else if (retval == ERROR_NAND_OPERATION_FAILED)
 	{
-		command_print(cmd_ctx, &quot;probing failed for NAND flash device&quot;);
+		command_print(CMD_CTX, &quot;probing failed for NAND flash device&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when probing NAND flash device&quot;);
+		command_print(CMD_CTX, &quot;unknown error when probing NAND flash device&quot;);
 	}
 
 	return ERROR_OK;
@@ -1212,18 +1212,18 @@ COMMAND_HANDLER(handle_nand_erase_command)
 	retval = nand_erase(p, offset, offset + length - 1);
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;erased blocks %lu to %lu &quot;
+		command_print(CMD_CTX, &quot;erased blocks %lu to %lu &quot;
 				&quot;on NAND flash device #%s '%s'&quot;,
 				offset, offset + length,
 				CMD_ARGV[0], p-&gt;device-&gt;name);
 	}
 	else if (retval == ERROR_NAND_OPERATION_FAILED)
 	{
-		command_print(cmd_ctx, &quot;erase failed&quot;);
+		command_print(CMD_CTX, &quot;erase failed&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when erasing NAND flash device&quot;);
+		command_print(CMD_CTX, &quot;unknown error when erasing NAND flash device&quot;);
 	}
 
 	return ERROR_OK;
@@ -1269,17 +1269,17 @@ COMMAND_HANDLER(handle_nand_check_bad_blocks_command)
 	retval = nand_build_bbt(p, first, last);
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;checked NAND flash device for bad blocks, &quot;
+		command_print(CMD_CTX, &quot;checked NAND flash device for bad blocks, &quot;
 				&quot;use \&quot;nand info\&quot; command to list blocks&quot;);
 	}
 	else if (retval == ERROR_NAND_OPERATION_FAILED)
 	{
-		command_print(cmd_ctx, &quot;error when checking for bad blocks on &quot;
+		command_print(CMD_CTX, &quot;error when checking for bad blocks on &quot;
 				&quot;NAND flash device&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when checking for bad &quot;
+		command_print(CMD_CTX, &quot;unknown error when checking for bad &quot;
 				&quot;blocks on NAND flash device&quot;);
 	}
 
@@ -1399,7 +1399,7 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 
 	if (NULL == nand-&gt;device)
 	{
-		command_print(cmd_ctx, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -1409,7 +1409,7 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], state-&gt;size);
 			if (state-&gt;size % nand-&gt;page_size)
 			{
-				command_print(cmd_ctx, &quot;only page-aligned sizes are supported&quot;);
+				command_print(CMD_CTX, &quot;only page-aligned sizes are supported&quot;);
 				return ERROR_COMMAND_SYNTAX_ERROR;
 			}
 	}
@@ -1428,13 +1428,13 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 				state-&gt;oob_format |= NAND_OOB_SW_ECC_KW;
 			else
 			{
-				command_print(cmd_ctx, &quot;unknown option: %s&quot;, CMD_ARGV[i]);
+				command_print(CMD_CTX, &quot;unknown option: %s&quot;, CMD_ARGV[i]);
 				return ERROR_COMMAND_SYNTAX_ERROR;
 			}
 		}
 	}
 
-	retval = nand_fileio_start(cmd_ctx, nand, CMD_ARGV[1], filemode, state);
+	retval = nand_fileio_start(CMD_CTX, nand, CMD_ARGV[1], filemode, state);
 	if (ERROR_OK != retval)
 		return retval;
 
@@ -1517,7 +1517,7 @@ COMMAND_HANDLER(handle_nand_write_command)
 		int bytes_read = nand_fileio_read(nand, &amp;s);
 		if (bytes_read &lt;= 0)
 		{
-			command_print(cmd_ctx, &quot;error while reading file&quot;);
+			command_print(CMD_CTX, &quot;error while reading file&quot;);
 			return nand_fileio_cleanup(&amp;s);
 		}
 		s.size -= bytes_read;
@@ -1526,7 +1526,7 @@ COMMAND_HANDLER(handle_nand_write_command)
 				s.page, s.page_size, s.oob, s.oob_size);
 		if (ERROR_OK != retval)
 		{
-			command_print(cmd_ctx, &quot;failed writing file %s &quot;
+			command_print(CMD_CTX, &quot;failed writing file %s &quot;
 				&quot;to NAND flash %s at offset 0x%8.8&quot; PRIx32,
 				CMD_ARGV[1], CMD_ARGV[0], s.address);
 			return nand_fileio_cleanup(&amp;s);
@@ -1536,7 +1536,7 @@ COMMAND_HANDLER(handle_nand_write_command)
 
 	if (nand_fileio_finish(&amp;s))
 	{
-		command_print(cmd_ctx, &quot;wrote file %s to NAND flash %s up to &quot;
+		command_print(CMD_CTX, &quot;wrote file %s to NAND flash %s up to &quot;
 				&quot;offset 0x%8.8&quot; PRIx32 &quot; in %fs (%0.3f kb/s)&quot;,
 				CMD_ARGV[1], CMD_ARGV[0], s.address, duration_elapsed(&amp;s.bench),
 				duration_kbps(&amp;s.bench, total_bytes));
@@ -1558,7 +1558,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 	dev.address = file.address;
 	dev.size = file.size;
 	dev.oob_format = file.oob_format;
-	retval = nand_fileio_start(cmd_ctx, nand, NULL, FILEIO_NONE, &amp;dev);
+	retval = nand_fileio_start(CMD_CTX, nand, NULL, FILEIO_NONE, &amp;dev);
 	if (ERROR_OK != retval)
 		return retval;
 
@@ -1568,7 +1568,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 				dev.page, dev.page_size, dev.oob, dev.oob_size);
 		if (ERROR_OK != retval)
 		{
-			command_print(cmd_ctx, &quot;reading NAND flash page failed&quot;);
+			command_print(CMD_CTX, &quot;reading NAND flash page failed&quot;);
 			nand_fileio_cleanup(&amp;dev);
 			return nand_fileio_cleanup(&amp;file);
 		}
@@ -1576,7 +1576,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 		int bytes_read = nand_fileio_read(nand, &amp;file);
 		if (bytes_read &lt;= 0)
 		{
-			command_print(cmd_ctx, &quot;error while reading file&quot;);
+			command_print(CMD_CTX, &quot;error while reading file&quot;);
 			nand_fileio_cleanup(&amp;dev);
 			return nand_fileio_cleanup(&amp;file);
 		}
@@ -1584,7 +1584,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 		if ((dev.page &amp;&amp; memcmp(dev.page, file.page, dev.page_size)) ||
 		    (dev.oob &amp;&amp; memcmp(dev.oob, file.oob, dev.oob_size)) )
 		{
-			command_print(cmd_ctx, &quot;NAND flash contents differ &quot;
+			command_print(CMD_CTX, &quot;NAND flash contents differ &quot;
 						&quot;at 0x%8.8&quot; PRIx32, dev.address);
 			nand_fileio_cleanup(&amp;dev);
 			return nand_fileio_cleanup(&amp;file);
@@ -1596,7 +1596,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 
 	if (nand_fileio_finish(&amp;file) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;verified file %s in NAND flash %s &quot;
+		command_print(CMD_CTX, &quot;verified file %s in NAND flash %s &quot;
 				&quot;up to offset 0x%8.8&quot; PRIx32 &quot; in %fs (%0.3f kb/s)&quot;,
 				CMD_ARGV[1], CMD_ARGV[0], dev.address, duration_elapsed(&amp;file.bench),
 				duration_kbps(&amp;file.bench, dev.size));
@@ -1621,7 +1621,7 @@ COMMAND_HANDLER(handle_nand_dump_command)
 				s.page, s.page_size, s.oob, s.oob_size);
 		if (ERROR_OK != retval)
 		{
-			command_print(cmd_ctx, &quot;reading NAND flash page failed&quot;);
+			command_print(CMD_CTX, &quot;reading NAND flash page failed&quot;);
 			return nand_fileio_cleanup(&amp;s);
 		}
 
@@ -1637,7 +1637,7 @@ COMMAND_HANDLER(handle_nand_dump_command)
 
 	if (nand_fileio_finish(&amp;s) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;dumped %zu bytes in %fs (%0.3f kb/s)&quot;, 
+		command_print(CMD_CTX, &quot;dumped %zu bytes in %fs (%0.3f kb/s)&quot;, 
 				s.fileio.size, duration_elapsed(&amp;s.bench),
 				duration_kbps(&amp;s.bench, s.fileio.size));
 	}
@@ -1658,7 +1658,7 @@ COMMAND_HANDLER(handle_nand_raw_access_command)
 
 	if (NULL == p-&gt;device)
 	{
-		command_print(cmd_ctx, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -1673,7 +1673,7 @@ COMMAND_HANDLER(handle_nand_raw_access_command)
 	}
 
 	const char *msg = p-&gt;use_raw ? &quot;enabled&quot; : &quot;disabled&quot;;
-	command_print(cmd_ctx, &quot;raw access is %s&quot;, msg);
+	command_print(CMD_CTX, &quot;raw access is %s&quot;, msg);
 
 	return ERROR_OK;
 }
diff --git a/src/flash/pic32mx.c b/src/flash/pic32mx.c
index 05e0474..4bfe91b 100644
--- a/src/flash/pic32mx.c
+++ b/src/flash/pic32mx.c
@@ -679,7 +679,7 @@ COMMAND_HANDLER(pic32mx_handle_lock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;pic32mx lock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;pic32mx lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -700,7 +700,7 @@ COMMAND_HANDLER(pic32mx_handle_lock_command)
 
 	if (pic32mx_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;pic32mx failed to erase options&quot;);
+		command_print(CMD_CTX, &quot;pic32mx failed to erase options&quot;);
 		return ERROR_OK;
 	}
 
@@ -709,11 +709,11 @@ COMMAND_HANDLER(pic32mx_handle_lock_command)
 
 	if (pic32mx_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;pic32mx failed to lock device&quot;);
+		command_print(CMD_CTX, &quot;pic32mx failed to lock device&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;pic32mx locked&quot;);
+	command_print(CMD_CTX, &quot;pic32mx locked&quot;);
 
 	return ERROR_OK;
 }
@@ -725,7 +725,7 @@ COMMAND_HANDLER(pic32mx_handle_unlock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;pic32mx unlock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;pic32mx unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -746,17 +746,17 @@ COMMAND_HANDLER(pic32mx_handle_unlock_command)
 
 	if (pic32mx_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;pic32mx failed to unlock device&quot;);
+		command_print(CMD_CTX, &quot;pic32mx failed to unlock device&quot;);
 		return ERROR_OK;
 	}
 
 	if (pic32mx_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;pic32mx failed to lock device&quot;);
+		command_print(CMD_CTX, &quot;pic32mx failed to lock device&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;pic32mx unlocked&quot;);
+	command_print(CMD_CTX, &quot;pic32mx unlocked&quot;);
 
 	return ERROR_OK;
 }
@@ -815,7 +815,7 @@ COMMAND_HANDLER(pic32mx_handle_chip_erase_command)
 
 	if (CMD_ARGC != 0)
 	{
-		command_print(cmd_ctx, &quot;pic32mx chip_erase&quot;);
+		command_print(CMD_CTX, &quot;pic32mx chip_erase&quot;);
 		return ERROR_OK;
 	}
 
@@ -832,11 +832,11 @@ COMMAND_HANDLER(pic32mx_handle_chip_erase_command)
 			bank-&gt;sectors[i].is_erased = 1;
 		}
 
-		command_print(cmd_ctx, &quot;pic32mx chip erase complete&quot;);
+		command_print(CMD_CTX, &quot;pic32mx chip erase complete&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;pic32mx chip erase failed&quot;);
+		command_print(CMD_CTX, &quot;pic32mx chip erase failed&quot;);
 	}
 #endif
 
@@ -850,7 +850,7 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 
 	if (CMD_ARGC != 3)
 	{
-		command_print(cmd_ctx, &quot;pic32mx pgm_word &lt;addr&gt; &lt;value&gt; &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;pic32mx pgm_word &lt;addr&gt; &lt;value&gt; &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -864,7 +864,7 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 
 	if (address &lt; bank-&gt;base || address &gt;= (bank-&gt;base + bank-&gt;size))
 	{
-		command_print(cmd_ctx, &quot;flash address '%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;flash address '%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -876,9 +876,9 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 		res = ERROR_FLASH_OPERATION_FAILED;
 
 	if (res == ERROR_OK)
-		command_print(cmd_ctx, &quot;pic32mx pgm word complete&quot;);
+		command_print(CMD_CTX, &quot;pic32mx pgm word complete&quot;);
 	else
-		command_print(cmd_ctx, &quot;pic32mx pgm word failed (status = 0x%x)&quot;, status);
+		command_print(CMD_CTX, &quot;pic32mx pgm word failed (status = 0x%x)&quot;, status);
 
 	return ERROR_OK;
 }
diff --git a/src/flash/stellaris.c b/src/flash/stellaris.c
index 4f28c09..a18c99b 100644
--- a/src/flash/stellaris.c
+++ b/src/flash/stellaris.c
@@ -1134,7 +1134,7 @@ COMMAND_HANDLER(stellaris_handle_mass_erase_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stellaris mass_erase &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stellaris mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1151,11 +1151,11 @@ COMMAND_HANDLER(stellaris_handle_mass_erase_command)
 			bank-&gt;sectors[i].is_erased = 1;
 		}
 
-		command_print(cmd_ctx, &quot;stellaris mass erase complete&quot;);
+		command_print(CMD_CTX, &quot;stellaris mass erase complete&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;stellaris mass erase failed&quot;);
+		command_print(CMD_CTX, &quot;stellaris mass erase failed&quot;);
 	}
 
 	return ERROR_OK;
diff --git a/src/flash/stm32x.c b/src/flash/stm32x.c
index f59ed61..4db338d 100644
--- a/src/flash/stm32x.c
+++ b/src/flash/stm32x.c
@@ -900,7 +900,7 @@ COMMAND_HANDLER(stm32x_handle_lock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stm32x lock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -921,7 +921,7 @@ COMMAND_HANDLER(stm32x_handle_lock_command)
 
 	if (stm32x_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to erase options&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to erase options&quot;);
 		return ERROR_OK;
 	}
 
@@ -930,11 +930,11 @@ COMMAND_HANDLER(stm32x_handle_lock_command)
 
 	if (stm32x_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to lock device&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to lock device&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;stm32x locked&quot;);
+	command_print(CMD_CTX, &quot;stm32x locked&quot;);
 
 	return ERROR_OK;
 }
@@ -946,7 +946,7 @@ COMMAND_HANDLER(stm32x_handle_unlock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stm32x unlock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -967,17 +967,17 @@ COMMAND_HANDLER(stm32x_handle_unlock_command)
 
 	if (stm32x_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to unlock device&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to unlock device&quot;);
 		return ERROR_OK;
 	}
 
 	if (stm32x_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to lock device&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to lock device&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;stm32x unlocked&quot;);
+	command_print(CMD_CTX, &quot;stm32x unlocked&quot;);
 
 	return ERROR_OK;
 }
@@ -990,7 +990,7 @@ COMMAND_HANDLER(stm32x_handle_options_read_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stm32x options_read &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x options_read &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1010,30 +1010,30 @@ COMMAND_HANDLER(stm32x_handle_options_read_command)
 	}
 
 	target_read_u32(target, STM32_FLASH_OBR, &amp;optionbyte);
-	command_print(cmd_ctx, &quot;Option Byte: 0x%&quot; PRIx32 &quot;&quot;, optionbyte);
+	command_print(CMD_CTX, &quot;Option Byte: 0x%&quot; PRIx32 &quot;&quot;, optionbyte);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_ERROR, 1))
-		command_print(cmd_ctx, &quot;Option Byte Complement Error&quot;);
+		command_print(CMD_CTX, &quot;Option Byte Complement Error&quot;);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_READOUT, 1))
-		command_print(cmd_ctx, &quot;Readout Protection On&quot;);
+		command_print(CMD_CTX, &quot;Readout Protection On&quot;);
 	else
-		command_print(cmd_ctx, &quot;Readout Protection Off&quot;);
+		command_print(CMD_CTX, &quot;Readout Protection Off&quot;);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_RDWDGSW, 1))
-		command_print(cmd_ctx, &quot;Software Watchdog&quot;);
+		command_print(CMD_CTX, &quot;Software Watchdog&quot;);
 	else
-		command_print(cmd_ctx, &quot;Hardware Watchdog&quot;);
+		command_print(CMD_CTX, &quot;Hardware Watchdog&quot;);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_RDRSTSTOP, 1))
-		command_print(cmd_ctx, &quot;Stop: No reset generated&quot;);
+		command_print(CMD_CTX, &quot;Stop: No reset generated&quot;);
 	else
-		command_print(cmd_ctx, &quot;Stop: Reset generated&quot;);
+		command_print(CMD_CTX, &quot;Stop: Reset generated&quot;);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_RDRSTSTDBY, 1))
-		command_print(cmd_ctx, &quot;Standby: No reset generated&quot;);
+		command_print(CMD_CTX, &quot;Standby: No reset generated&quot;);
 	else
-		command_print(cmd_ctx, &quot;Standby: Reset generated&quot;);
+		command_print(CMD_CTX, &quot;Standby: Reset generated&quot;);
 
 	return ERROR_OK;
 }
@@ -1046,7 +1046,7 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 
 	if (CMD_ARGC &lt; 4)
 	{
-		command_print(cmd_ctx, &quot;stm32x options_write &lt;bank&gt; &lt;SWWDG | HWWDG&gt; &lt;RSTSTNDBY | NORSTSTNDBY&gt; &lt;RSTSTOP | NORSTSTOP&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x options_write &lt;bank&gt; &lt;SWWDG | HWWDG&gt; &lt;RSTSTNDBY | NORSTSTNDBY&gt; &lt;RSTSTOP | NORSTSTOP&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1094,7 +1094,7 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 
 	if (stm32x_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to erase options&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to erase options&quot;);
 		return ERROR_OK;
 	}
 
@@ -1102,11 +1102,11 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 
 	if (stm32x_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to write options&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to write options&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;stm32x write options complete&quot;);
+	command_print(CMD_CTX, &quot;stm32x write options complete&quot;);
 
 	return ERROR_OK;
 }
@@ -1155,7 +1155,7 @@ COMMAND_HANDLER(stm32x_handle_mass_erase_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stm32x mass_erase &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1172,11 +1172,11 @@ COMMAND_HANDLER(stm32x_handle_mass_erase_command)
 			bank-&gt;sectors[i].is_erased = 1;
 		}
 
-		command_print(cmd_ctx, &quot;stm32x mass erase complete&quot;);
+		command_print(CMD_CTX, &quot;stm32x mass erase complete&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;stm32x mass erase failed&quot;);
+		command_print(CMD_CTX, &quot;stm32x mass erase failed&quot;);
 	}
 
 	return ERROR_OK;
diff --git a/src/flash/str7x.c b/src/flash/str7x.c
index 76b6467..da1899d 100644
--- a/src/flash/str7x.c
+++ b/src/flash/str7x.c
@@ -613,7 +613,7 @@ COMMAND_HANDLER(str7x_handle_disable_jtag_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str7x disable_jtag &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str7x disable_jtag &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
diff --git a/src/flash/str9xpec.c b/src/flash/str9xpec.c
index a87d0ff..de222fb 100644
--- a/src/flash/str9xpec.c
+++ b/src/flash/str9xpec.c
@@ -759,7 +759,7 @@ COMMAND_HANDLER(str9xpec_handle_part_id_command)
 
 	idcode = buf_get_u32(buffer, 0, 32);
 
-	command_print(cmd_ctx, &quot;str9xpec part id: 0x%8.8&quot; PRIx32 &quot;&quot;, idcode);
+	command_print(CMD_CTX, &quot;str9xpec part id: 0x%8.8&quot; PRIx32 &quot;&quot;, idcode);
 
 	free(buffer);
 
@@ -784,7 +784,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_read_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_read &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_read &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -802,33 +802,33 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_read_command)
 
 	/* boot bank */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_CSMAPBIT, 1))
-		command_print(cmd_ctx, &quot;CS Map: bank1&quot;);
+		command_print(CMD_CTX, &quot;CS Map: bank1&quot;);
 	else
-		command_print(cmd_ctx, &quot;CS Map: bank0&quot;);
+		command_print(CMD_CTX, &quot;CS Map: bank0&quot;);
 
 	/* OTP lock */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_OTPBIT, 1))
-		command_print(cmd_ctx, &quot;OTP Lock: OTP Locked&quot;);
+		command_print(CMD_CTX, &quot;OTP Lock: OTP Locked&quot;);
 	else
-		command_print(cmd_ctx, &quot;OTP Lock: OTP Unlocked&quot;);
+		command_print(CMD_CTX, &quot;OTP Lock: OTP Unlocked&quot;);
 
 	/* LVD Threshold */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_LVDTHRESBIT, 1))
-		command_print(cmd_ctx, &quot;LVD Threshold: 2.7v&quot;);
+		command_print(CMD_CTX, &quot;LVD Threshold: 2.7v&quot;);
 	else
-		command_print(cmd_ctx, &quot;LVD Threshold: 2.4v&quot;);
+		command_print(CMD_CTX, &quot;LVD Threshold: 2.4v&quot;);
 
 	/* LVD reset warning */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_LVDWARNBIT, 1))
-		command_print(cmd_ctx, &quot;LVD Reset Warning: VDD or VDDQ Inputs&quot;);
+		command_print(CMD_CTX, &quot;LVD Reset Warning: VDD or VDDQ Inputs&quot;);
 	else
-		command_print(cmd_ctx, &quot;LVD Reset Warning: VDD Input Only&quot;);
+		command_print(CMD_CTX, &quot;LVD Reset Warning: VDD Input Only&quot;);
 
 	/* LVD reset select */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_LVDSELBIT, 1))
-		command_print(cmd_ctx, &quot;LVD Reset Selection: VDD or VDDQ Inputs&quot;);
+		command_print(CMD_CTX, &quot;LVD Reset Selection: VDD or VDDQ Inputs&quot;);
 	else
-		command_print(cmd_ctx, &quot;LVD Reset Selection: VDD Input Only&quot;);
+		command_print(CMD_CTX, &quot;LVD Reset Selection: VDD Input Only&quot;);
 
 	return ERROR_OK;
 }
@@ -900,7 +900,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_write_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_write &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_write &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -923,7 +923,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_cmap_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_cmap &lt;bank&gt; &lt;bank0 | bank1&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_cmap &lt;bank&gt; &lt;bank0 | bank1&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -952,7 +952,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdthd_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_lvdthd &lt;bank&gt; &lt;2.4v | 2.7v&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_lvdthd &lt;bank&gt; &lt;2.4v | 2.7v&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -981,7 +981,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdsel_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_lvdsel &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_lvdsel &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1010,7 +1010,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdwarn_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_lvdwarn &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_lvdwarn &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1039,7 +1039,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_lock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec lock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1062,7 +1062,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_unlock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec unlock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1088,7 +1088,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_enable_turbo_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec enable_turbo &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec enable_turbo &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1106,14 +1106,14 @@ COMMAND_HANDLER(str9xpec_handle_flash_enable_turbo_command)
 	if (tap1 == NULL)
 	{
 		/* things are *WRONG* */
-		command_print(cmd_ctx,&quot;**STR9FLASH** (tap1) invalid chain?&quot;);
+		command_print(CMD_CTX,&quot;**STR9FLASH** (tap1) invalid chain?&quot;);
 		return ERROR_OK;
 	}
 	tap2 = tap1-&gt;next_tap;
 	if (tap2 == NULL)
 	{
 		/* things are *WRONG* */
-		command_print(cmd_ctx,&quot;**STR9FLASH** (tap2) invalid chain?&quot;);
+		command_print(CMD_CTX,&quot;**STR9FLASH** (tap2) invalid chain?&quot;);
 		return ERROR_OK;
 	}
 
@@ -1135,7 +1135,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_disable_turbo_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec disable_turbo &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec disable_turbo &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
diff --git a/src/flash/tms470.c b/src/flash/tms470.c
index 890db73..f6f3900 100644
--- a/src/flash/tms470.c
+++ b/src/flash/tms470.c
@@ -293,7 +293,7 @@ COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 {
 	if (CMD_ARGC &gt; 4)
 	{
-		command_print(cmd_ctx, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
+		command_print(CMD_CTX, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	else if (CMD_ARGC == 4)
@@ -306,7 +306,7 @@ COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 
 			if (1 != sscanf(&amp;CMD_ARGV[i][start], &quot;%&quot; SCNx32 &quot;&quot;, &amp;flashKeys[i]))
 			{
-				command_print(cmd_ctx, &quot;could not process flash key %s&quot;, CMD_ARGV[i]);
+				command_print(CMD_CTX, &quot;could not process flash key %s&quot;, CMD_ARGV[i]);
 				LOG_ERROR(&quot;could not process flash key %s&quot;, CMD_ARGV[i]);
 				return ERROR_INVALID_ARGUMENTS;
 			}
@@ -316,18 +316,18 @@ COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 	}
 	else if (CMD_ARGC != 0)
 	{
-		command_print(cmd_ctx, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
+		command_print(CMD_CTX, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
 	if (keysSet)
 	{
-		command_print(cmd_ctx, &quot;using flash keys 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;&quot;,
+		command_print(CMD_CTX, &quot;using flash keys 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;&quot;,
 			      flashKeys[0], flashKeys[1], flashKeys[2], flashKeys[3]);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;flash keys not set&quot;);
+		command_print(CMD_CTX, &quot;flash keys not set&quot;);
 	}
 
 	return ERROR_OK;
@@ -357,7 +357,7 @@ COMMAND_HANDLER(tms470_handle_osc_megahertz_command)
 {
 	if (CMD_ARGC &gt; 1)
 	{
-		command_print(cmd_ctx, &quot;tms470 osc_megahertz &lt;MHz&gt;&quot;);
+		command_print(CMD_CTX, &quot;tms470 osc_megahertz &lt;MHz&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	else if (CMD_ARGC == 1)
@@ -368,12 +368,12 @@ COMMAND_HANDLER(tms470_handle_osc_megahertz_command)
 	if (oscMHz &lt;= 0)
 	{
 		LOG_ERROR(&quot;osc_megahertz must be positive and non-zero!&quot;);
-		command_print(cmd_ctx, &quot;osc_megahertz must be positive and non-zero!&quot;);
+		command_print(CMD_CTX, &quot;osc_megahertz must be positive and non-zero!&quot;);
 		oscMHz = 12;
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
-	command_print(cmd_ctx, &quot;osc_megahertz=%d&quot;, oscMHz);
+	command_print(CMD_CTX, &quot;osc_megahertz=%d&quot;, oscMHz);
 
 	return ERROR_OK;
 }
@@ -386,7 +386,7 @@ COMMAND_HANDLER(tms470_handle_plldis_command)
 {
 	if (CMD_ARGC &gt; 1)
 	{
-		command_print(cmd_ctx, &quot;tms470 plldis &lt;0 | 1&gt;&quot;);
+		command_print(CMD_CTX, &quot;tms470 plldis &lt;0 | 1&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	else if (CMD_ARGC == 1)
@@ -395,7 +395,7 @@ COMMAND_HANDLER(tms470_handle_plldis_command)
 		plldis = plldis ? 1 : 0;
 	}
 
-	command_print(cmd_ctx, &quot;plldis=%d&quot;, plldis);
+	command_print(CMD_CTX, &quot;plldis=%d&quot;, plldis);
 
 	return ERROR_OK;
 }
diff --git a/src/hello.c b/src/hello.c
index df0cb02..dd33650 100644
--- a/src/hello.c
+++ b/src/hello.c
@@ -44,7 +44,7 @@ COMMAND_HANDLER(handle_hello_command)
 	const char *sep, *name;
 	int retval = CALL_COMMAND_HANDLER(handle_hello_args, &amp;sep, &amp;name);
 	if (ERROR_OK == retval)
-		command_print(cmd_ctx, &quot;Greetings%s%s!&quot;, sep, name);
+		command_print(CMD_CTX, &quot;Greetings%s%s!&quot;, sep, name);
 	return retval;
 }
 
diff --git a/src/helper/command.h b/src/helper/command.h
index 3e36627..7484964 100644
--- a/src/helper/command.h
+++ b/src/helper/command.h
@@ -244,7 +244,7 @@ DECLARE_PARSE_WRAPPER(_s8, int8_t);
 	do { \
 		int retval = parse_##type(in, &amp;(out)); \
 		if (ERROR_OK != retval) { \
-			command_print(cmd_ctx, stringify(out) \
+			command_print(CMD_CTX, stringify(out) \
 				&quot; option value ('%s') is not valid&quot;, in); \
 			return retval; \
 		} \
diff --git a/src/helper/ioutil.c b/src/helper/ioutil.c
index 3fc1a96..3fb3014 100644
--- a/src/helper/ioutil.c
+++ b/src/helper/ioutil.c
@@ -61,13 +61,13 @@ COMMAND_HANDLER(handle_rm_command)
 {
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;rm &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;rm &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
 	if (unlink(CMD_ARGV[0]) != 0)
 	{
-		command_print(cmd_ctx, &quot;failed: %d&quot;, errno);
+		command_print(CMD_CTX, &quot;failed: %d&quot;, errno);
 	}
 
 	return ERROR_OK;
@@ -137,7 +137,7 @@ COMMAND_HANDLER(handle_cat_command)
 {
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;cat &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;cat &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -148,12 +148,12 @@ COMMAND_HANDLER(handle_cat_command)
 	int retval = loadFile(CMD_ARGV[0], &amp;data, &amp;len);
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;%s&quot;, (char *)data);
+		command_print(CMD_CTX, &quot;%s&quot;, (char *)data);
 		free(data);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;%s not found %d&quot;, CMD_ARGV[0], retval);
+		command_print(CMD_CTX, &quot;%s not found %d&quot;, CMD_ARGV[0], retval);
 	}
 
 	return ERROR_OK;
@@ -163,7 +163,7 @@ COMMAND_HANDLER(handle_trunc_command)
 {
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;trunc &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;trunc &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -182,7 +182,7 @@ COMMAND_HANDLER(handle_meminfo_command)
 
 	if (CMD_ARGC != 0)
 	{
-		command_print(cmd_ctx, &quot;meminfo&quot;);
+		command_print(CMD_CTX, &quot;meminfo&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -190,11 +190,11 @@ COMMAND_HANDLER(handle_meminfo_command)
 
 	if (prev &gt; 0)
 	{
-		command_print(cmd_ctx, &quot;Diff:            %d&quot;, prev - info.fordblks);
+		command_print(CMD_CTX, &quot;Diff:            %d&quot;, prev - info.fordblks);
 	}
 	prev = info.fordblks;
 
-	command_print(cmd_ctx, &quot;Available ram:   %d&quot;, info.fordblks);
+	command_print(CMD_CTX, &quot;Available ram:   %d&quot;, info.fordblks);
 
 	return ERROR_OK;
 }
@@ -204,7 +204,7 @@ COMMAND_HANDLER(handle_append_command)
 {
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;append &lt;filename&gt; [&lt;string1&gt;, [&lt;string2&gt;, ...]]&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
@@ -276,7 +276,7 @@ COMMAND_HANDLER(handle_cp_command)
 			break;
 		}
 
-		command_print(cmd_ctx, &quot;%zu&quot;, len - pos);
+		command_print(CMD_CTX, &quot;%zu&quot;, len - pos);
 
 		pos += chunk;
 
@@ -286,10 +286,10 @@ COMMAND_HANDLER(handle_cp_command)
 
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;Copied %s to %s&quot;, CMD_ARGV[0], CMD_ARGV[1]);
+		command_print(CMD_CTX, &quot;Copied %s to %s&quot;, CMD_ARGV[0], CMD_ARGV[1]);
 	} else
 	{
-		command_print(cmd_ctx, &quot;Failed: %d&quot;, retval);
+		command_print(CMD_CTX, &quot;Failed: %d&quot;, retval);
 	}
 
 	if (data != NULL)
diff --git a/src/helper/log.c b/src/helper/log.c
index 0e04c8e..caaed42 100644
--- a/src/helper/log.c
+++ b/src/helper/log.c
@@ -296,7 +296,7 @@ COMMAND_HANDLER(handle_debug_level_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;debug_level: %i&quot;, debug_level);
+	command_print(CMD_CTX, &quot;debug_level: %i&quot;, debug_level);
 
 	return ERROR_OK;
 }
diff --git a/src/jtag/amt_jtagaccel.c b/src/jtag/amt_jtagaccel.c
index d35b0c2..4da2fa1 100644
--- a/src/jtag/amt_jtagaccel.c
+++ b/src/jtag/amt_jtagaccel.c
@@ -513,7 +513,7 @@ COMMAND_HANDLER(amt_jtagaccel_handle_parport_port_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;parport port = %u&quot;, amt_jtagaccel_port);
+	command_print(CMD_CTX, &quot;parport port = %u&quot;, amt_jtagaccel_port);
 
 	return ERROR_OK;
 }
@@ -522,7 +522,7 @@ COMMAND_HANDLER(amt_jtagaccel_handle_rtck_command)
 {
 	if (CMD_ARGC == 0)
 	{
-		command_print(cmd_ctx, &quot;amt_jtagaccel RTCK feature %s&quot;, (rtck_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
+		command_print(CMD_CTX, &quot;amt_jtagaccel RTCK feature %s&quot;, (rtck_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 		return ERROR_OK;
 	}
 	else
diff --git a/src/jtag/gw16012.c b/src/jtag/gw16012.c
index d0cdde6..2d7b453 100644
--- a/src/jtag/gw16012.c
+++ b/src/jtag/gw16012.c
@@ -557,7 +557,7 @@ COMMAND_HANDLER(gw16012_handle_parport_port_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;parport port = %u&quot;, gw16012_port);
+	command_print(CMD_CTX, &quot;parport port = %u&quot;, gw16012_port);
 
 	return ERROR_OK;
 }
diff --git a/src/jtag/jlink.c b/src/jtag/jlink.c
index 80e7150..dbbddb8 100644
--- a/src/jtag/jlink.c
+++ b/src/jtag/jlink.c
@@ -629,7 +629,7 @@ COMMAND_HANDLER(jlink_handle_jlink_hw_jtag_command)
 {
 	switch (CMD_ARGC) {
 	case 0:
-		command_print(cmd_ctx, &quot;jlink hw jtag  %i&quot;, jlink_hw_jtag_version);
+		command_print(CMD_CTX, &quot;jlink hw jtag  %i&quot;, jlink_hw_jtag_version);
 		break;
 	case 1: {
 		int request_version = atoi(CMD_ARGV[0]);
diff --git a/src/jtag/parport.c b/src/jtag/parport.c
index e15c66d..97f6458 100644
--- a/src/jtag/parport.c
+++ b/src/jtag/parport.c
@@ -425,7 +425,7 @@ COMMAND_HANDLER(parport_handle_parport_port_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;parport port = %u&quot;, parport_port);
+	command_print(CMD_CTX, &quot;parport port = %u&quot;, parport_port);
 
 	return ERROR_OK;
 }
@@ -449,7 +449,7 @@ COMMAND_HANDLER(parport_handle_write_on_exit_command)
 {
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: parport_write_on_exit &lt;on | off&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: parport_write_on_exit &lt;on | off&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -479,7 +479,7 @@ COMMAND_HANDLER(parport_handle_parport_toggling_time_command)
 		wait_states = jtag_get_speed();
 	}
 
-	command_print(cmd_ctx, &quot;parport toggling time = %&quot; PRIu32 &quot; ns&quot;,
+	command_print(CMD_CTX, &quot;parport toggling time = %&quot; PRIu32 &quot; ns&quot;,
 			parport_toggling_time_ns);
 
 	return ERROR_OK;
diff --git a/src/jtag/tcl.c b/src/jtag/tcl.c
index 1eead8d..96018b5 100644
--- a/src/jtag/tcl.c
+++ b/src/jtag/tcl.c
@@ -608,11 +608,11 @@ COMMAND_HANDLER(handle_interface_list_command)
 	if (strcmp(CMD_NAME, &quot;interface_list&quot;) == 0 &amp;&amp; CMD_ARGC &gt; 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	command_print(cmd_ctx, &quot;The following JTAG interfaces are available:&quot;);
+	command_print(CMD_CTX, &quot;The following JTAG interfaces are available:&quot;);
 	for (unsigned i = 0; NULL != jtag_interfaces[i]; i++)
 	{
 		const char *name = jtag_interfaces[i]-&gt;name;
-		command_print(cmd_ctx, &quot;%u: %s&quot;, i + 1, name);
+		command_print(CMD_CTX, &quot;%u: %s&quot;, i + 1, name);
 	}
 
 	return ERROR_OK;
@@ -636,7 +636,7 @@ COMMAND_HANDLER(handle_interface_command)
 		if (strcmp(CMD_ARGV[0], jtag_interfaces[i]-&gt;name) != 0)
 			continue;
 
-		int retval = jtag_interfaces[i]-&gt;register_commands(cmd_ctx);
+		int retval = jtag_interfaces[i]-&gt;register_commands(CMD_CTX);
 		if (ERROR_OK != retval)
 				return retval;
 
@@ -667,8 +667,8 @@ COMMAND_HANDLER(handle_scan_chain_command)
 	struct jtag_tap *tap;
 
 	tap = jtag_all_taps();
-	command_print(cmd_ctx, &quot;     TapName            | Enabled |   IdCode      Expected    IrLen IrCap  IrMask Instr     &quot;);
-	command_print(cmd_ctx, &quot;---|--------------------|---------|------------|------------|------|------|------|---------&quot;);
+	command_print(CMD_CTX, &quot;     TapName            | Enabled |   IdCode      Expected    IrLen IrCap  IrMask Instr     &quot;);
+	command_print(CMD_CTX, &quot;---|--------------------|---------|------------|------------|------|------|------|---------&quot;);
 
 	while (tap) {
 		uint32_t expected, expected_mask, cur_instr, ii;
@@ -676,7 +676,7 @@ COMMAND_HANDLER(handle_scan_chain_command)
 		expected_mask = buf_get_u32(tap-&gt;expected_mask, 0, tap-&gt;ir_length);
 		cur_instr = buf_get_u32(tap-&gt;cur_instr, 0, tap-&gt;ir_length);
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 					  &quot;%2d | %-18s |    %c    | 0x%08x | 0x%08x | 0x%02x | 0x%02x | 0x%02x | 0x%02x&quot;,
 					  tap-&gt;abs_chain_position,
 					  tap-&gt;dotted_name,
@@ -689,7 +689,7 @@ COMMAND_HANDLER(handle_scan_chain_command)
 					  (unsigned int)(cur_instr));
 
 		for (ii = 1; ii &lt; tap-&gt;expected_ids_cnt; ii++) {
-			command_print(cmd_ctx, &quot;   |                    |         |            | 0x%08x |      |      |      |         &quot;,
+			command_print(CMD_CTX, &quot;   |                    |         |            | 0x%08x |      |      |      |         &quot;,
 						  (unsigned int)(tap-&gt;expected_ids[ii]));
 		}
 
@@ -888,7 +888,7 @@ next:
 		modes[4] = &quot;&quot;;
 	}
 
-	command_print(cmd_ctx, &quot;%s %s%s%s%s&quot;,
+	command_print(CMD_CTX, &quot;%s %s%s%s%s&quot;,
 			modes[0], modes[1],
 			modes[2], modes[3], modes[4]);
 
@@ -906,7 +906,7 @@ COMMAND_HANDLER(handle_jtag_nsrst_delay_command)
 
 		jtag_set_nsrst_delay(delay);
 	}
-	command_print(cmd_ctx, &quot;jtag_nsrst_delay: %u&quot;, jtag_get_nsrst_delay());
+	command_print(CMD_CTX, &quot;jtag_nsrst_delay: %u&quot;, jtag_get_nsrst_delay());
 	return ERROR_OK;
 }
 
@@ -921,7 +921,7 @@ COMMAND_HANDLER(handle_jtag_ntrst_delay_command)
 
 		jtag_set_ntrst_delay(delay);
 	}
-	command_print(cmd_ctx, &quot;jtag_ntrst_delay: %u&quot;, jtag_get_ntrst_delay());
+	command_print(CMD_CTX, &quot;jtag_ntrst_delay: %u&quot;, jtag_get_ntrst_delay());
 	return ERROR_OK;
 }
 
@@ -936,7 +936,7 @@ COMMAND_HANDLER(handle_jtag_nsrst_assert_width_command)
 
 		jtag_set_nsrst_assert_width(delay);
 	}
-	command_print(cmd_ctx, &quot;jtag_nsrst_assert_width: %u&quot;, jtag_get_nsrst_assert_width());
+	command_print(CMD_CTX, &quot;jtag_nsrst_assert_width: %u&quot;, jtag_get_nsrst_assert_width());
 	return ERROR_OK;
 }
 
@@ -951,7 +951,7 @@ COMMAND_HANDLER(handle_jtag_ntrst_assert_width_command)
 
 		jtag_set_ntrst_assert_width(delay);
 	}
-	command_print(cmd_ctx, &quot;jtag_ntrst_assert_width: %u&quot;, jtag_get_ntrst_assert_width());
+	command_print(CMD_CTX, &quot;jtag_ntrst_assert_width: %u&quot;, jtag_get_ntrst_assert_width());
 	return ERROR_OK;
 }
 
@@ -977,9 +977,9 @@ COMMAND_HANDLER(handle_jtag_khz_command)
 		return retval;
 
 	if (cur_speed)
-		command_print(cmd_ctx, &quot;%d kHz&quot;, cur_speed);
+		command_print(CMD_CTX, &quot;%d kHz&quot;, cur_speed);
 	else
-		command_print(cmd_ctx, &quot;RCLK - adaptive&quot;);
+		command_print(CMD_CTX, &quot;RCLK - adaptive&quot;);
 
 	return retval;
 }
@@ -1006,9 +1006,9 @@ COMMAND_HANDLER(handle_jtag_rclk_command)
 		return retval;
 
 	if (cur_khz)
-		command_print(cmd_ctx, &quot;RCLK not supported - fallback to %d kHz&quot;, cur_khz);
+		command_print(CMD_CTX, &quot;RCLK not supported - fallback to %d kHz&quot;, cur_khz);
 	else
-		command_print(cmd_ctx, &quot;RCLK - adaptive&quot;);
+		command_print(CMD_CTX, &quot;RCLK - adaptive&quot;);
 
 	return retval;
 }
@@ -1034,7 +1034,7 @@ COMMAND_HANDLER(handle_jtag_reset_command)
 	else
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	if (jtag_interface_init(cmd_ctx) != ERROR_OK)
+	if (jtag_interface_init(CMD_CTX) != ERROR_OK)
 		return ERROR_JTAG_INIT_FAILED;
 
 	jtag_add_reset(trst, srst);
@@ -1122,7 +1122,7 @@ COMMAND_HANDLER(handle_irscan_command)
 			for (j = 0; j &lt; i; j++)
 				free(fields[j].out_value);
                         free(fields);
-			command_print(cmd_ctx, &quot;Tap: %s unknown&quot;, CMD_ARGV[i*2]);
+			command_print(CMD_CTX, &quot;Tap: %s unknown&quot;, CMD_ARGV[i*2]);
 
 			return ERROR_FAIL;
 		}
@@ -1366,7 +1366,7 @@ COMMAND_HANDLER(handle_verify_ircapture_command)
 	}
 
 	const char *status = jtag_will_verify_capture_ir() ? &quot;enabled&quot;: &quot;disabled&quot;;
-	command_print(cmd_ctx, &quot;verify Capture-IR is %s&quot;, status);
+	command_print(CMD_CTX, &quot;verify Capture-IR is %s&quot;, status);
 
 	return ERROR_OK;
 }
@@ -1387,7 +1387,7 @@ COMMAND_HANDLER(handle_verify_jtag_command)
 	}
 
 	const char *status = jtag_will_verify() ? &quot;enabled&quot;: &quot;disabled&quot;;
-	command_print(cmd_ctx, &quot;verify jtag capture is %s&quot;, status);
+	command_print(CMD_CTX, &quot;verify jtag capture is %s&quot;, status);
 
 	return ERROR_OK;
 }
@@ -1410,7 +1410,7 @@ COMMAND_HANDLER(handle_tms_sequence_command)
 		tap_use_new_tms_table(use_new_table);
 	}
 
-	command_print(cmd_ctx, &quot;tms sequence is  %s&quot;,
+	command_print(CMD_CTX, &quot;tms sequence is  %s&quot;,
 			tap_uses_new_tms_table() ? &quot;short&quot;: &quot;long&quot;);
 
 	return ERROR_OK;
diff --git a/src/openocd.c b/src/openocd.c
index 1a43b3c..9edd611 100644
--- a/src/openocd.c
+++ b/src/openocd.c
@@ -55,7 +55,7 @@ COMMAND_HANDLER(handle_version_command)
 	if (CMD_ARGC != 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	command_print(cmd_ctx, OPENOCD_VERSION);
+	command_print(CMD_CTX, OPENOCD_VERSION);
 
 	return ERROR_OK;
 }
@@ -107,11 +107,11 @@ COMMAND_HANDLER(handle_init_command)
 
 	atexit(exit_handler);
 
-	if (target_init(cmd_ctx) != ERROR_OK)
+	if (target_init(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;target init complete&quot;);
 
-	if ((retval = jtag_interface_init(cmd_ctx)) != ERROR_OK)
+	if ((retval = jtag_interface_init(CMD_CTX)) != ERROR_OK)
 	{
 		/* we must be able to set up the jtag interface */
 		return retval;
@@ -120,7 +120,7 @@ COMMAND_HANDLER(handle_init_command)
 
 	/* Try to initialize &amp; examine the JTAG chain at this point, but
 	 * continue startup regardless */
-	if (jtag_init(cmd_ctx) == ERROR_OK)
+	if (jtag_init(CMD_CTX) == ERROR_OK)
 	{
 		LOG_DEBUG(&quot;jtag init complete&quot;);
 		if (target_examine() == ERROR_OK)
@@ -129,19 +129,19 @@ COMMAND_HANDLER(handle_init_command)
 		}
 	}
 
-	if (flash_init_drivers(cmd_ctx) != ERROR_OK)
+	if (flash_init_drivers(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;flash init complete&quot;);
 
-	if (mflash_init_drivers(cmd_ctx) != ERROR_OK)
+	if (mflash_init_drivers(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;mflash init complete&quot;);
 
-	if (nand_init(cmd_ctx) != ERROR_OK)
+	if (nand_init(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;NAND init complete&quot;);
 
-	if (pld_init(cmd_ctx) != ERROR_OK)
+	if (pld_init(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;pld init complete&quot;);
 
@@ -153,7 +153,7 @@ COMMAND_HANDLER(handle_init_command)
 	gdb_init();
 	tcl_init(); /* allows tcl to just connect without going thru telnet */
 
-	target_register_event_callback(log_target_callback_event_handler, cmd_ctx);
+	target_register_event_callback(log_target_callback_event_handler, CMD_CTX);
 
 	return ERROR_OK;
 }
diff --git a/src/pld/pld.c b/src/pld/pld.c
index 96d37f1..d021f7b 100644
--- a/src/pld/pld.c
+++ b/src/pld/pld.c
@@ -75,7 +75,7 @@ COMMAND_HANDLER(handle_pld_device_command)
 			struct pld_device *p, *c;
 
 			/* register pld specific commands */
-			if (pld_drivers[i]-&gt;register_commands(cmd_ctx) != ERROR_OK)
+			if (pld_drivers[i]-&gt;register_commands(CMD_CTX) != ERROR_OK)
 			{
 				LOG_ERROR(&quot;couldn't register '%s' commands&quot;, CMD_ARGV[0]);
 				exit(-1);
@@ -127,13 +127,13 @@ COMMAND_HANDLER(handle_pld_devices_command)
 
 	if (!pld_devices)
 	{
-		command_print(cmd_ctx, &quot;no pld devices configured&quot;);
+		command_print(CMD_CTX, &quot;no pld devices configured&quot;);
 		return ERROR_OK;
 	}
 
 	for (p = pld_devices; p; p = p-&gt;next)
 	{
-		command_print(cmd_ctx, &quot;#%i: %s&quot;, i++, p-&gt;driver-&gt;name);
+		command_print(CMD_CTX, &quot;#%i: %s&quot;, i++, p-&gt;driver-&gt;name);
 	}
 
 	return ERROR_OK;
@@ -149,7 +149,7 @@ COMMAND_HANDLER(handle_pld_load_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;usage: pld load &lt;device#&gt; &lt;file&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: pld load &lt;device#&gt; &lt;file&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -158,13 +158,13 @@ COMMAND_HANDLER(handle_pld_load_command)
 	p = get_pld_device_by_num(dev_id);
 	if (!p)
 	{
-		command_print(cmd_ctx, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
 	if ((retval = p-&gt;driver-&gt;load(p, CMD_ARGV[1])) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;failed loading file %s to pld device %u&quot;,
+		command_print(CMD_CTX, &quot;failed loading file %s to pld device %u&quot;,
 			CMD_ARGV[1], dev_id);
 		switch (retval)
 		{
@@ -176,7 +176,7 @@ COMMAND_HANDLER(handle_pld_load_command)
 		gettimeofday(&amp;end, NULL);
 		timeval_subtract(&amp;duration, &amp;end, &amp;start);
 
-		command_print(cmd_ctx, &quot;loaded file %s to pld device %u in %jis %jius&quot;,
+		command_print(CMD_CTX, &quot;loaded file %s to pld device %u in %jis %jius&quot;,
 			CMD_ARGV[1], dev_id,
 			(intmax_t)duration.tv_sec, (intmax_t)duration.tv_usec);
 	}
diff --git a/src/pld/virtex2.c b/src/pld/virtex2.c
index b4593cc..e8fe63b 100644
--- a/src/pld/virtex2.c
+++ b/src/pld/virtex2.c
@@ -185,7 +185,7 @@ COMMAND_HANDLER(virtex2_handle_read_stat_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: virtex2 read_stat &lt;num&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: virtex2 read_stat &lt;num&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -194,7 +194,7 @@ COMMAND_HANDLER(virtex2_handle_read_stat_command)
 	device = get_pld_device_by_num(dev_id);
 	if (!device)
 	{
-		command_print(cmd_ctx, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -202,7 +202,7 @@ COMMAND_HANDLER(virtex2_handle_read_stat_command)
 
 	virtex2_read_stat(device, &amp;status);
 
-	command_print(cmd_ctx, &quot;virtex2 status register: 0x%8.8&quot; PRIx32 &quot;&quot;, status);
+	command_print(CMD_CTX, &quot;virtex2 status register: 0x%8.8&quot; PRIx32 &quot;&quot;, status);
 
 	return ERROR_OK;
 }
@@ -221,7 +221,7 @@ PLD_DEVICE_COMMAND_HANDLER(virtex2_pld_device_command)
 
 	tap = jtag_tap_by_string(CMD_ARGV[1]);
 	if (tap == NULL) {
-		command_print(cmd_ctx, &quot;Tap: %s does not exist&quot;, CMD_ARGV[1]);
+		command_print(CMD_CTX, &quot;Tap: %s does not exist&quot;, CMD_ARGV[1]);
 		return ERROR_OK;
 	}
 
diff --git a/src/server/gdb_server.c b/src/server/gdb_server.c
index 716e1cf..9605f81 100644
--- a/src/server/gdb_server.c
+++ b/src/server/gdb_server.c
@@ -2252,7 +2252,7 @@ COMMAND_HANDLER(handle_gdb_sync_command)
 
 	if (current_gdb_connection == NULL)
 	{
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;gdb_sync command can only be run from within gdb using \&quot;monitor gdb_sync\&quot;&quot;);
 		return ERROR_FAIL;
 	}
diff --git a/src/server/server.c b/src/server/server.c
index 258c89b..b28aa50 100644
--- a/src/server/server.c
+++ b/src/server/server.c
@@ -553,7 +553,7 @@ SERVER_PORT_COMMAND()
 {
 	switch (CMD_ARGC) {
 	case 0:
-		command_print(cmd_ctx, &quot;%d&quot;, *out);
+		command_print(CMD_CTX, &quot;%d&quot;, *out);
 		break;
 	case 1:
 	{
diff --git a/src/svf/svf.c b/src/svf/svf.c
index 45f3493..545bcf8 100644
--- a/src/svf/svf.c
+++ b/src/svf/svf.c
@@ -310,7 +310,7 @@ COMMAND_HANDLER(handle_svf_command)
 
 	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; (1 + SVF_NUM_OF_OPTIONS)))
 	{
-		command_print(cmd_ctx, &quot;usage: svf &lt;file&gt; [quiet]&quot;);
+		command_print(CMD_CTX, &quot;usage: svf &lt;file&gt; [quiet]&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -333,7 +333,7 @@ COMMAND_HANDLER(handle_svf_command)
 
 	if ((svf_fd = open(CMD_ARGV[0], O_RDONLY)) &lt; 0)
 	{
-		command_print(cmd_ctx, &quot;file \&quot;%s\&quot; not found&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;file \&quot;%s\&quot; not found&quot;, CMD_ARGV[0]);
 
 		// no need to free anything now
 		return ERROR_FAIL;
@@ -392,7 +392,7 @@ COMMAND_HANDLER(handle_svf_command)
 
 	while (ERROR_OK == svf_read_command_from_file(svf_fd))
 	{
-		if (ERROR_OK != svf_run_command(cmd_ctx, svf_command_buffer))
+		if (ERROR_OK != svf_run_command(CMD_CTX, svf_command_buffer))
 		{
 			LOG_ERROR(&quot;fail to run command at line %d&quot;, svf_line_number);
 			ret = ERROR_FAIL;
@@ -410,7 +410,7 @@ COMMAND_HANDLER(handle_svf_command)
 	}
 
 	// print time
-	command_print(cmd_ctx, &quot;%lld ms used&quot;, timeval_ms() - time_ago);
+	command_print(CMD_CTX, &quot;%lld ms used&quot;, timeval_ms() - time_ago);
 
 free_all:
 
@@ -457,11 +457,11 @@ free_all:
 
 	if (ERROR_OK == ret)
 	{
-		command_print(cmd_ctx, &quot;svf file programmed successfully for %d commands&quot;, command_num);
+		command_print(CMD_CTX, &quot;svf file programmed successfully for %d commands&quot;, command_num);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;svf file programmed failed&quot;);
+		command_print(CMD_CTX, &quot;svf file programmed failed&quot;);
 	}
 
 	return ret;
diff --git a/src/target/arm720t.c b/src/target/arm720t.c
index a0cde5d..b51f969 100644
--- a/src/target/arm720t.c
+++ b/src/target/arm720t.c
@@ -412,11 +412,11 @@ static int arm720t_target_create(struct target *target, Jim_Interp *interp)
 COMMAND_HANDLER(arm720t_handle_cp15_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm720t_common *arm720t = target_to_arm720(target);
 	struct arm_jtag *jtag_info;
 
-	retval = arm720t_verify_pointer(cmd_ctx, arm720t);
+	retval = arm720t_verify_pointer(CMD_CTX, arm720t);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -424,7 +424,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -439,7 +439,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 			uint32_t value;
 			if ((retval = arm720t_read_cp15(target, opcode, &amp;value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't access cp15 with opcode 0x%8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't access cp15 with opcode 0x%8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
 
@@ -448,7 +448,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 				return retval;
 			}
 
-			command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
+			command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
 		else if (CMD_ARGC == 2)
 		{
@@ -457,10 +457,10 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 
 			if ((retval = arm720t_write_cp15(target, opcode, value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't access cp15 with opcode 0x%8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't access cp15 with opcode 0x%8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
+			command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
 	}
 
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index bd018b4..b29eb5c 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2750,24 +2750,24 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_command)
 	uint32_t value;
 	int spsr;
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;can't write registers while running&quot;);
+		command_print(CMD_CTX, &quot;can't write registers while running&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;usage: write_xpsr &lt;value&gt; &lt;not cpsr | spsr&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: write_xpsr &lt;value&gt; &lt;not cpsr | spsr&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2794,24 +2794,24 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_im8_command)
 	int rotate;
 	int spsr;
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;can't write registers while running&quot;);
+		command_print(CMD_CTX, &quot;can't write registers while running&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (CMD_ARGC &lt; 3)
 	{
-		command_print(cmd_ctx, &quot;usage: write_xpsr_im8 &lt;im8&gt; &lt;rotate&gt; &lt;not cpsr | spsr&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: write_xpsr_im8 &lt;im8&gt; &lt;rotate&gt; &lt;not cpsr | spsr&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2834,24 +2834,24 @@ COMMAND_HANDLER(handle_arm7_9_write_core_reg_command)
 	uint32_t value;
 	uint32_t mode;
 	int num;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;can't write registers while running&quot;);
+		command_print(CMD_CTX, &quot;can't write registers while running&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (CMD_ARGC &lt; 3)
 	{
-		command_print(cmd_ctx, &quot;usage: write_core_reg &lt;num&gt; &lt;mode&gt; &lt;value&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: write_core_reg &lt;num&gt; &lt;mode&gt; &lt;value&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2864,12 +2864,12 @@ COMMAND_HANDLER(handle_arm7_9_write_core_reg_command)
 
 COMMAND_HANDLER(handle_arm7_9_dbgrq_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
@@ -2885,23 +2885,23 @@ COMMAND_HANDLER(handle_arm7_9_dbgrq_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: arm7_9 dbgrq &lt;enable | disable&gt;&quot;);
+			command_print(CMD_CTX, &quot;usage: arm7_9 dbgrq &lt;enable | disable&gt;&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;use of EmbeddedICE dbgrq instead of breakpoint for target halt %s&quot;, (arm7_9-&gt;use_dbgrq) ? &quot;enabled&quot; : &quot;disabled&quot;);
+	command_print(CMD_CTX, &quot;use of EmbeddedICE dbgrq instead of breakpoint for target halt %s&quot;, (arm7_9-&gt;use_dbgrq) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(handle_arm7_9_fast_memory_access_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
@@ -2917,23 +2917,23 @@ COMMAND_HANDLER(handle_arm7_9_fast_memory_access_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: arm7_9 fast_memory_access &lt;enable | disable&gt;&quot;);
+			command_print(CMD_CTX, &quot;usage: arm7_9 fast_memory_access &lt;enable | disable&gt;&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;fast memory access is %s&quot;, (arm7_9-&gt;fast_memory_access) ? &quot;enabled&quot; : &quot;disabled&quot;);
+	command_print(CMD_CTX, &quot;fast memory access is %s&quot;, (arm7_9-&gt;fast_memory_access) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(handle_arm7_9_dcc_downloads_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
@@ -2949,11 +2949,11 @@ COMMAND_HANDLER(handle_arm7_9_dcc_downloads_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: arm7_9 dcc_downloads &lt;enable | disable&gt;&quot;);
+			command_print(CMD_CTX, &quot;usage: arm7_9 dcc_downloads &lt;enable | disable&gt;&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;dcc downloads are %s&quot;, (arm7_9-&gt;dcc_downloads) ? &quot;enabled&quot; : &quot;disabled&quot;);
+	command_print(CMD_CTX, &quot;dcc downloads are %s&quot;, (arm7_9-&gt;dcc_downloads) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index fbb8d7f..99b4bbd 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -664,7 +664,7 @@ static int arm920t_target_create(struct target *target, Jim_Interp *interp)
 COMMAND_HANDLER(arm920t_handle_read_cache_command)
 {
 	int retval = ERROR_OK;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 	struct armv4_5_common_s *armv4_5 = &amp;arm7_9-&gt;armv4_5_common;
@@ -678,13 +678,13 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 	struct arm920t_cache_line d_cache[8][64], i_cache[8][64];
 	int segment, index;
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: arm920t read_cache &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: arm920t read_cache &lt;filename&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -885,7 +885,7 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 	/* restore CP15 MMU and Cache settings */
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl_saved);
 
-	command_print(cmd_ctx, &quot;cache content successfully output to %s&quot;, CMD_ARGV[0]);
+	command_print(CMD_CTX, &quot;cache content successfully output to %s&quot;, CMD_ARGV[0]);
 
 	fclose(output);
 
@@ -910,7 +910,7 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 {
 	int retval = ERROR_OK;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 	struct armv4_5_common_s *armv4_5 = &amp;arm7_9-&gt;armv4_5_common;
@@ -924,13 +924,13 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 	struct arm920t_tlb_entry d_tlb[64], i_tlb[64];
 	int victim;
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: arm920t read_mmu &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: arm920t read_mmu &lt;filename&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1168,7 +1168,7 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 		fprintf(output, &quot;%i: 0x%8.8&quot; PRIx32 &quot; 0x%8.8&quot; PRIx32 &quot; 0x%8.8&quot; PRIx32 &quot; %s\n&quot;, i, i_tlb[i].cam, i_tlb[i].ram1, i_tlb[i].ram2, (i_tlb[i].cam &amp; 0x20) ? &quot;(valid)&quot; : &quot;(invalid)&quot;);
 	}
 
-	command_print(cmd_ctx, &quot;mmu content successfully output to %s&quot;, CMD_ARGV[0]);
+	command_print(CMD_CTX, &quot;mmu content successfully output to %s&quot;, CMD_ARGV[0]);
 
 	fclose(output);
 
@@ -1193,16 +1193,16 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 COMMAND_HANDLER(arm920t_handle_cp15_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -1217,7 +1217,7 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 			uint32_t value;
 			if ((retval = arm920t_read_cp15_physical(target, address, &amp;value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't access reg %i&quot;, address);
+				command_print(CMD_CTX, &quot;couldn't access reg %i&quot;, address);
 				return ERROR_OK;
 			}
 			if ((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1225,7 +1225,7 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 				return retval;
 			}
 
-			command_print(cmd_ctx, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
+			command_print(CMD_CTX, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
 		}
 		else if (CMD_ARGC == 2)
 		{
@@ -1233,10 +1233,10 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			if ((retval = arm920t_write_cp15_physical(target, address, value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't access reg %i&quot;, address);
+				command_print(CMD_CTX, &quot;couldn't access reg %i&quot;, address);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
+			command_print(CMD_CTX, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
 		}
 	}
 
@@ -1246,17 +1246,17 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 COMMAND_HANDLER(arm920t_handle_cp15i_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -1271,11 +1271,11 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 			uint32_t value;
 			if ((retval = arm920t_read_cp15_interpreted(target, opcode, 0x0, &amp;value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
 
-			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
+			command_print(CMD_CTX, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
 		else if (CMD_ARGC == 2)
 		{
@@ -1283,10 +1283,10 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			if ((retval = arm920t_write_cp15_interpreted(target, opcode, value, 0)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
+			command_print(CMD_CTX, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
 		else if (CMD_ARGC == 3)
 		{
@@ -1296,15 +1296,15 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], address);
 			if ((retval = arm920t_write_cp15_interpreted(target, opcode, value, address)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot; %8.8&quot; PRIx32 &quot;&quot;, opcode, value, address);
+			command_print(CMD_CTX, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot; %8.8&quot; PRIx32 &quot;&quot;, opcode, value, address);
 		}
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;usage: arm920t cp15i &lt;opcode&gt; [value] [address]&quot;);
+		command_print(CMD_CTX, &quot;usage: arm920t cp15i &lt;opcode&gt; [value] [address]&quot;);
 	}
 
 	return ERROR_OK;
@@ -1313,14 +1313,14 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 COMMAND_HANDLER(arm920t_handle_cache_info_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
-	return armv4_5_handle_cache_info_command(cmd_ctx, &amp;arm920t-&gt;armv4_5_mmu.armv4_5_cache);
+	return armv4_5_handle_cache_info_command(CMD_CTX, &amp;arm920t-&gt;armv4_5_mmu.armv4_5_cache);
 }
 
 
diff --git a/src/target/arm926ejs.c b/src/target/arm926ejs.c
index 6678054..cc6318b 100644
--- a/src/target/arm926ejs.c
+++ b/src/target/arm926ejs.c
@@ -715,7 +715,7 @@ static int arm926ejs_target_create(struct target *target, Jim_Interp *interp)
 COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm926ejs_common *arm926ejs = target_to_arm926(target);
 	int opcode_1;
 	int opcode_2;
@@ -724,7 +724,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 
 	if ((CMD_ARGC &lt; 4) || (CMD_ARGC &gt; 5))
 	{
-		command_print(cmd_ctx, &quot;usage: arm926ejs cp15 &lt;opcode_1&gt; &lt;opcode_2&gt; &lt;CRn&gt; &lt;CRm&gt; [value]&quot;);
+		command_print(CMD_CTX, &quot;usage: arm926ejs cp15 &lt;opcode_1&gt; &lt;opcode_2&gt; &lt;CRn&gt; &lt;CRm&gt; [value]&quot;);
 		return ERROR_OK;
 	}
 
@@ -733,13 +733,13 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 	COMMAND_PARSE_NUMBER(int, CMD_ARGV[2], CRn);
 	COMMAND_PARSE_NUMBER(int, CMD_ARGV[3], CRm);
 
-	retval = arm926ejs_verify_pointer(cmd_ctx, arm926ejs);
+	retval = arm926ejs_verify_pointer(CMD_CTX, arm926ejs);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -748,7 +748,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 		uint32_t value;
 		if ((retval = arm926ejs-&gt;read_cp15(target, opcode_1, opcode_2, CRn, CRm, &amp;value)) != ERROR_OK)
 		{
-			command_print(cmd_ctx, &quot;couldn't access register&quot;);
+			command_print(CMD_CTX, &quot;couldn't access register&quot;);
 			return ERROR_OK;
 		}
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
@@ -756,7 +756,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 			return retval;
 		}
 
-		command_print(cmd_ctx, &quot;%i %i %i %i: %8.8&quot; PRIx32 &quot;&quot;, opcode_1, opcode_2, CRn, CRm, value);
+		command_print(CMD_CTX, &quot;%i %i %i %i: %8.8&quot; PRIx32 &quot;&quot;, opcode_1, opcode_2, CRn, CRm, value);
 	}
 	else
 	{
@@ -764,10 +764,10 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[4], value);
 		if ((retval = arm926ejs-&gt;write_cp15(target, opcode_1, opcode_2, CRn, CRm, value)) != ERROR_OK)
 		{
-			command_print(cmd_ctx, &quot;couldn't access register&quot;);
+			command_print(CMD_CTX, &quot;couldn't access register&quot;);
 			return ERROR_OK;
 		}
-		command_print(cmd_ctx, &quot;%i %i %i %i: %8.8&quot; PRIx32 &quot;&quot;, opcode_1, opcode_2, CRn, CRm, value);
+		command_print(CMD_CTX, &quot;%i %i %i %i: %8.8&quot; PRIx32 &quot;&quot;, opcode_1, opcode_2, CRn, CRm, value);
 	}
 
 	return ERROR_OK;
@@ -776,14 +776,14 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 COMMAND_HANDLER(arm926ejs_handle_cache_info_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm926ejs_common *arm926ejs = target_to_arm926(target);
 
-	retval = arm926ejs_verify_pointer(cmd_ctx, arm926ejs);
+	retval = arm926ejs_verify_pointer(CMD_CTX, arm926ejs);
 	if (retval != ERROR_OK)
 		return retval;
 
-	return armv4_5_handle_cache_info_command(cmd_ctx, &amp;arm926ejs-&gt;armv4_5_mmu.armv4_5_cache);
+	return armv4_5_handle_cache_info_command(CMD_CTX, &amp;arm926ejs-&gt;armv4_5_mmu.armv4_5_cache);
 }
 
 static int arm926ejs_virt2phys(struct target *target, uint32_t virtual, uint32_t *physical)
diff --git a/src/target/arm966e.c b/src/target/arm966e.c
index ffc65cd..9302199 100644
--- a/src/target/arm966e.c
+++ b/src/target/arm966e.c
@@ -165,16 +165,16 @@ int arm966e_write_cp15(struct target *target, int reg_addr, uint32_t value)
 COMMAND_HANDLER(arm966e_handle_cp15_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm966e_common *arm966e = target_to_arm966(target);
 
-	retval = arm966e_verify_pointer(cmd_ctx, arm966e);
+	retval = arm966e_verify_pointer(CMD_CTX, arm966e);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -189,7 +189,7 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 			uint32_t value;
 			if ((retval = arm966e_read_cp15(target, address, &amp;value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx,
+				command_print(CMD_CTX,
 						&quot;couldn't access reg %&quot; PRIi32,
 						address);
 				return ERROR_OK;
@@ -199,7 +199,7 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 				return retval;
 			}
 
-			command_print(cmd_ctx, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
+			command_print(CMD_CTX, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
 					address, value);
 		}
 		else if (CMD_ARGC == 2)
@@ -208,12 +208,12 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			if ((retval = arm966e_write_cp15(target, address, value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx,
+				command_print(CMD_CTX,
 						&quot;couldn't access reg %&quot; PRIi32,
 						address);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
+			command_print(CMD_CTX, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
 					address, value);
 		}
 	}
diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index 3f074be..a69e49e 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -831,7 +831,7 @@ static int arm9tdmi_target_create(struct target *target, Jim_Interp *interp)
 
 COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 	struct reg *vector_catch;
 	uint32_t vector_catch_value;
@@ -839,7 +839,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 	/* it's uncommon, but some ARM7 chips can support this */
 	if (arm7_9-&gt;common_magic != ARM7_9_COMMON_MAGIC
 			|| !arm7_9-&gt;has_vector_catch) {
-		command_print(cmd_ctx, &quot;target doesn't have EmbeddedICE &quot;
+		command_print(CMD_CTX, &quot;target doesn't have EmbeddedICE &quot;
 				&quot;with vector_catch&quot;);
 		return ERROR_TARGET_INVALID;
 	}
@@ -882,7 +882,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 				/* complain if vector wasn't found */
 				if (!arm9tdmi_vectors[j].name)
 				{
-					command_print(cmd_ctx, &quot;vector '%s' not found, leaving current setting unchanged&quot;, CMD_ARGV[i]);
+					command_print(CMD_CTX, &quot;vector '%s' not found, leaving current setting unchanged&quot;, CMD_ARGV[i]);
 
 					/* reread current setting */
 					vector_catch_value = buf_get_u32(
@@ -901,7 +901,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 
 	/* output current settings */
 	for (unsigned i = 0; arm9tdmi_vectors[i].name; i++) {
-		command_print(cmd_ctx, &quot;%s: %s&quot;, arm9tdmi_vectors[i].name,
+		command_print(CMD_CTX, &quot;%s: %s&quot;, arm9tdmi_vectors[i].name,
 			(vector_catch_value &amp; arm9tdmi_vectors[i].value)
 				? &quot;catch&quot; : &quot;don't catch&quot;);
 	}
diff --git a/src/target/arm_adi_v5.c b/src/target/arm_adi_v5.c
index 7f4bc58..3d0b8f8 100644
--- a/src/target/arm_adi_v5.c
+++ b/src/target/arm_adi_v5.c
@@ -1386,7 +1386,7 @@ DAP_COMMAND_HANDLER(dap_baseaddr_command)
 
 	dap_ap_read_reg_u32(swjdp, 0xF8, &amp;baseaddr);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32, baseaddr);
+	command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32, baseaddr);
 
 	if (apselsave != apsel)
 		dap_ap_select(swjdp, apselsave);
@@ -1410,7 +1410,7 @@ DAP_COMMAND_HANDLER(dap_memaccess_command)
 	}
 	swjdp-&gt;memaccess_tck = memaccess_tck;
 
-	command_print(cmd_ctx, &quot;memory bus access delay set to %&quot; PRIi32 &quot; tck&quot;,
+	command_print(CMD_CTX, &quot;memory bus access delay set to %&quot; PRIi32 &quot; tck&quot;,
 			swjdp-&gt;memaccess_tck);
 
 	return ERROR_OK;
@@ -1435,7 +1435,7 @@ DAP_COMMAND_HANDLER(dap_apsel_command)
 	dap_ap_select(swjdp, apsel);
 	dap_ap_read_reg_u32(swjdp, 0xFC, &amp;apid);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, &quot;ap %&quot; PRIi32 &quot; selected, identification register 0x%8.8&quot; PRIx32,
+	command_print(CMD_CTX, &quot;ap %&quot; PRIi32 &quot; selected, identification register 0x%8.8&quot; PRIx32,
 			apsel, apid);
 
 	return retval;
@@ -1463,7 +1463,7 @@ DAP_COMMAND_HANDLER(dap_apid_command)
 
 	dap_ap_read_reg_u32(swjdp, 0xFC, &amp;apid);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32, apid);
+	command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32, apid);
 	if (apselsave != apsel)
 		dap_ap_select(swjdp, apselsave);
 
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 5f0fe42..6f8d14c 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -358,18 +358,18 @@ COMMAND_HANDLER(handle_armv4_5_reg_command)
 	char output[128];
 	int output_len;
 	int mode, num;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv4_5_common_s *armv4_5 = target_to_armv4_5(target);
 
 	if (!is_arm(armv4_5))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;error: target must be halted for register accesses&quot;);
+		command_print(CMD_CTX, &quot;error: target must be halted for register accesses&quot;);
 		return ERROR_OK;
 	}
 
@@ -377,7 +377,7 @@ COMMAND_HANDLER(handle_armv4_5_reg_command)
 		return ERROR_FAIL;
 
 	if (!armv4_5-&gt;full_context) {
-		command_print(cmd_ctx, &quot;error: target doesn't support %s&quot;,
+		command_print(CMD_CTX, &quot;error: target doesn't support %s&quot;,
 				CMD_NAME);
 		return ERROR_FAIL;
 	}
@@ -397,9 +397,9 @@ COMMAND_HANDLER(handle_armv4_5_reg_command)
 					       ARMV4_5_CORE_REG_MODENUM(armv4_5-&gt;core_cache, mode, num).name,
 					       buf_get_u32(ARMV4_5_CORE_REG_MODENUM(armv4_5-&gt;core_cache, mode, num).value, 0, 32));
 		}
-		command_print(cmd_ctx, &quot;%s&quot;, output);
+		command_print(CMD_CTX, &quot;%s&quot;, output);
 	}
-	command_print(cmd_ctx,
+	command_print(CMD_CTX,
 		      &quot;    cpsr: %8.8&quot; PRIx32 &quot; spsr_fiq: %8.8&quot; PRIx32 &quot; spsr_irq: %8.8&quot; PRIx32 &quot; spsr_svc: %8.8&quot; PRIx32 &quot; spsr_abt: %8.8&quot; PRIx32 &quot; spsr_und: %8.8&quot; PRIx32 &quot;&quot;,
 			  buf_get_u32(armv4_5-&gt;core_cache-&gt;reg_list[ARMV4_5_CPSR].value, 0, 32),
 			  buf_get_u32(armv4_5-&gt;core_cache-&gt;reg_list[ARMV4_5_SPSR_FIQ].value, 0, 32),
@@ -413,12 +413,12 @@ COMMAND_HANDLER(handle_armv4_5_reg_command)
 
 COMMAND_HANDLER(handle_armv4_5_core_state_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv4_5_common_s *armv4_5 = target_to_armv4_5(target);
 
 	if (!is_arm(armv4_5))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -434,7 +434,7 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;core state: %s&quot;, armv4_5_state_strings[armv4_5-&gt;core_state]);
+	command_print(CMD_CTX, &quot;core state: %s&quot;, armv4_5_state_strings[armv4_5-&gt;core_state]);
 
 	return ERROR_OK;
 }
@@ -442,14 +442,14 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
 COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 {
 	int retval = ERROR_OK;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm *arm = target ? target_to_arm(target) : NULL;
 	uint32_t address;
 	int count = 1;
 	int thumb = 0;
 
 	if (!is_arm(arm)) {
-		command_print(cmd_ctx, &quot;current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -466,7 +466,7 @@ COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 		if (address &amp; 0x01) {
 			if (!thumb) {
-				command_print(cmd_ctx, &quot;Disassemble as Thumb&quot;);
+				command_print(CMD_CTX, &quot;Disassemble as Thumb&quot;);
 				thumb = 1;
 			}
 			address &amp;= ~1;
@@ -474,7 +474,7 @@ COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 		break;
 	default:
 usage:
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			&quot;usage: arm disassemble &lt;address&gt; [&lt;count&gt; ['thumb']]&quot;);
 		count = 0;
 		retval = ERROR_FAIL;
@@ -503,7 +503,7 @@ usage:
 			if (retval != ERROR_OK)
 				break;
 		}
-		command_print(cmd_ctx, &quot;%s&quot;, cur_instruction.text);
+		command_print(CMD_CTX, &quot;%s&quot;, cur_instruction.text);
 		address += cur_instruction.instruction_size;
 	}
 
diff --git a/src/target/armv7a.c b/src/target/armv7a.c
index 7f5b834..8f90dd3 100644
--- a/src/target/armv7a.c
+++ b/src/target/armv7a.c
@@ -218,7 +218,7 @@ int armv7a_arch_state(struct target *target)
 
 COMMAND_HANDLER(handle_dap_baseaddr_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 
@@ -227,7 +227,7 @@ COMMAND_HANDLER(handle_dap_baseaddr_command)
 
 COMMAND_HANDLER(handle_dap_memaccess_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 
@@ -236,7 +236,7 
@@ COMMAND_HANDLER(handle_dap_memaccess_command)
 
 COMMAND_HANDLER(handle_dap_apsel_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 
@@ -245,7 +245,7 @@ COMMAND_HANDLER(handle_dap_apsel_command)
 
 COMMAND_HANDLER(handle_dap_apid_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 
@@ -254,7 +254,7 @@ COMMAND_HANDLER(handle_dap_apid_command)
 
 COMMAND_HANDLER(handle_dap_info_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 	uint32_t apsel;
@@ -270,7 +270,7 @@ COMMAND_HANDLER(handle_dap_info_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	return dap_info_command(cmd_ctx, swjdp, apsel);
+	return dap_info_command(CMD_CTX, swjdp, apsel);
 }
 
 int armv7a_register_commands(struct command_context *cmd_ctx)
diff --git a/src/target/armv7m.c b/src/target/armv7m.c
index 4fe5794..862261d 100644
--- a/src/target/armv7m.c
+++ b/src/target/armv7m.c
@@ -759,7 +759,7 @@ int armv7m_blank_check_memory(struct target *target,
  */
 COMMAND_HANDLER(handle_dap_baseaddr_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 	uint32_t apsel, apselsave, baseaddr;
@@ -782,7 +782,7 @@ COMMAND_HANDLER(handle_dap_baseaddr_command)
 
 	dap_ap_read_reg_u32(swjdp, 0xF8, &amp;baseaddr);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32 &quot;&quot;, baseaddr);
+	command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32 &quot;&quot;, baseaddr);
 
 	if (apselsave != apsel)
 		dap_ap_select(swjdp, apselsave);
@@ -796,7 +796,7 @@ COMMAND_HANDLER(handle_dap_baseaddr_command)
  */
 COMMAND_HANDLER(handle_dap_apid_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 
@@ -805,7 +805,7 @@ COMMAND_HANDLER(handle_dap_apid_command)
 
 COMMAND_HANDLER(handle_dap_apsel_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 
@@ -814,7 +814,7 @@ COMMAND_HANDLER(handle_dap_apsel_command)
 
 COMMAND_HANDLER(handle_dap_memaccess_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 
@@ -824,7 +824,7 @@ COMMAND_HANDLER(handle_dap_memaccess_command)
 
 COMMAND_HANDLER(handle_dap_info_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 	uint32_t apsel;
@@ -840,7 +840,7 @@ COMMAND_HANDLER(handle_dap_info_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	return dap_info_command(cmd_ctx, swjdp, apsel);
+	return dap_info_command(CMD_CTX, swjdp, apsel);
 }
 
 /** Registers commands used to access DAP resources. */
diff --git a/src/target/cortex_a8.c b/src/target/cortex_a8.c
index 4cd6c0a..04b3f87 100644
--- a/src/target/cortex_a8.c
+++ b/src/target/cortex_a8.c
@@ -1512,17 +1512,17 @@ static int cortex_a8_target_create(struct target *target, Jim_Interp *interp)
 
 COMMAND_HANDLER(cortex_a8_handle_cache_info_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 
-	return armv4_5_handle_cache_info_command(cmd_ctx,
+	return armv4_5_handle_cache_info_command(CMD_CTX,
 			&amp;armv7a-&gt;armv4_5_mmu.armv4_5_cache);
 }
 
 
 COMMAND_HANDLER(cortex_a8_handle_dbginit_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	cortex_a8_init_debug_access(target);
 
diff --git a/src/target/cortex_m3.c b/src/target/cortex_m3.c
index 9cb4b98..c9938c9 100644
--- a/src/target/cortex_m3.c
+++ b/src/target/cortex_m3.c
@@ -1769,13 +1769,13 @@ static int cortex_m3_verify_pointer(struct command_context *cmd_ctx,
 COMMAND_HANDLER(handle_cortex_m3_disassemble_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct cortex_m3_common *cortex_m3 = target_to_cm3(target);
 	uint32_t address;
 	unsigned long count = 1;
 	struct arm_instruction cur_instruction;
 
-	retval = cortex_m3_verify_pointer(cmd_ctx, cortex_m3);
+	retval = cortex_m3_verify_pointer(CMD_CTX, cortex_m3);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -1788,7 +1788,7 @@ COMMAND_HANDLER(handle_cortex_m3_disassemble_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 		break;
 	default:
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			&quot;usage: cortex_m3 disassemble &lt;address&gt; [&lt;count&gt;]&quot;);
 		return ERROR_OK;
 	}
@@ -1797,7 +1797,7 @@ COMMAND_HANDLER(handle_cortex_m3_disassemble_command)
 		retval = thumb2_opcode(target, address, &amp;cur_instruction);
 		if (retval != ERROR_OK)
 			return retval;
-		command_print(cmd_ctx, &quot;%s&quot;, cur_instruction.text);
+		command_print(CMD_CTX, &quot;%s&quot;, cur_instruction.text);
 		address += cur_instruction.instruction_size;
 	}
 
@@ -1820,13 +1820,14 @@ static const struct {
 
 COMMAND_HANDLER(handle_cortex_m3_vector_catch_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct cortex_m3_common *cortex_m3 = target_to_cm3(target);
 	struct armv7m_common *armv7m = &amp;cortex_m3-&gt;armv7m;
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 	uint32_t demcr = 0;
 	int retval;
-	retval = cortex_m3_verify_pointer(cmd_ctx, cortex_m3);
+
+	retval = cortex_m3_verify_pointer(CMD_CTX, cortex_m3);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -1868,25 +1869,27 @@ write:
 	}
 
 	for (unsigned i = 0; i &lt; ARRAY_SIZE(vec_ids); i++)
-		command_print(cmd_ctx, &quot;%9s: %s&quot;, vec_ids[i].name,
+	{
+		command_print(CMD_CTX, &quot;%9s: %s&quot;, vec_ids[i].name,
 			(demcr &amp; vec_ids[i].mask) ? &quot;catch&quot; : &quot;ignore&quot;);
+	}
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(handle_cortex_m3_mask_interrupts_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct cortex_m3_common *cortex_m3 = target_to_cm3(target);
 	int retval;
 
-	retval = cortex_m3_verify_pointer(cmd_ctx, cortex_m3);
+	retval = cortex_m3_verify_pointer(CMD_CTX, cortex_m3);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -1902,11 +1905,11 @@ COMMAND_HANDLER(handle_cortex_m3_mask_interrupts_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: cortex_m3 maskisr ['on'|'off']&quot;);
+			command_print(CMD_CTX, &quot;usage: cortex_m3 maskisr ['on'|'off']&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;cortex_m3 interrupt mask %s&quot;,
+	command_print(CMD_CTX, &quot;cortex_m3 interrupt mask %s&quot;,
 			(cortex_m3-&gt;dcb_dhcsr &amp; C_MASKINTS) ? &quot;on&quot; : &quot;off&quot;);
 
 	return ERROR_OK;
diff --git a/src/target/etb.c b/src/target/etb.c
index 25d6d0b..df04e40 100644
--- a/src/target/etb.c
+++ b/src/target/etb.c
@@ -370,14 +370,14 @@ COMMAND_HANDLER(handle_etb_config_command)
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETB: '%s' isn't an ARM&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;ETB: '%s' isn't an ARM&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
 	tap = jtag_tap_by_string(CMD_ARGV[1]);
 	if (tap == NULL)
 	{
-		command_print(cmd_ctx, &quot;ETB: TAP %s does not exist&quot;, CMD_ARGV[1]);
+		command_print(CMD_CTX, &quot;ETB: TAP %s does not exist&quot;, CMD_ARGV[1]);
 		return ERROR_FAIL;
 	}
 
diff --git a/src/target/etm.c b/src/target/etm.c
index 72e8b3d..3b5fa61 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -1189,7 +1189,7 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 		tracemode = ETMV1_TRACE_DATA | ETMV1_TRACE_ADDR;
 	else
 	{
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;invalid option '%s'&quot;, CMD_ARGV[0]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1210,7 +1210,7 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 		tracemode |= ETMV1_CONTEXTID_32;
 		break;
 	default:
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[1]);
+		command_print(CMD_CTX, &quot;invalid option '%s'&quot;, CMD_ARGV[1]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1220,7 +1220,7 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 		tracemode |= 0;
 	else
 	{
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[2]);
+		command_print(CMD_CTX, &quot;invalid option '%s'&quot;, CMD_ARGV[2]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1230,7 +1230,7 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 		tracemode |= 0;
 	else
 	{
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[3]);
+		command_print(CMD_CTX, &quot;invalid option '%s'&quot;, CMD_ARGV[3]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1246,18 +1246,18 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 
 COMMAND_HANDLER(handle_etm_tracemode_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm *arm = target_to_arm(target);
 	struct etm_context *etm;
 
 	if (!is_arm(arm)) {
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm = arm-&gt;etm;
 	if (!etm) {
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1271,7 +1271,7 @@ COMMAND_HANDLER(handle_etm_tracemode_command)
 		CALL_COMMAND_HANDLER(handle_etm_tracemode_command_update, &amp;tracemode);
 		break;
 	default:
-		command_print(cmd_ctx, &quot;usage: configure trace mode &quot;
+		command_print(CMD_CTX, &quot;usage: configure trace mode &quot;
 				&quot;&lt;none | data | address | all&gt; &quot;
 				&quot;&lt;context id bits&gt; &lt;cycle accurate&gt; &lt;branch output&gt;&quot;);
 		return ERROR_FAIL;
@@ -1282,56 +1282,56 @@ COMMAND_HANDLER(handle_etm_tracemode_command)
 	 * or couldn't be written; display actual hardware state...
 	 */
 
-	command_print(cmd_ctx, &quot;current tracemode configuration:&quot;);
+	command_print(CMD_CTX, &quot;current tracemode configuration:&quot;);
 
 	switch (tracemode &amp; ETMV1_TRACE_MASK)
 	{
 		case ETMV1_TRACE_NONE:
-			command_print(cmd_ctx, &quot;data tracing: none&quot;);
+			command_print(CMD_CTX, &quot;data tracing: none&quot;);
 			break;
 		case ETMV1_TRACE_DATA:
-			command_print(cmd_ctx, &quot;data tracing: data only&quot;);
+			command_print(CMD_CTX, &quot;data tracing: data only&quot;);
 			break;
 		case ETMV1_TRACE_ADDR:
-			command_print(cmd_ctx, &quot;data tracing: address only&quot;);
+			command_print(CMD_CTX, &quot;data tracing: address only&quot;);
 			break;
 		case ETMV1_TRACE_DATA | ETMV1_TRACE_ADDR:
-			command_print(cmd_ctx, &quot;data tracing: address and data&quot;);
+			command_print(CMD_CTX, &quot;data tracing: address and data&quot;);
 			break;
 	}
 
 	switch (tracemode &amp; ETMV1_CONTEXTID_MASK)
 	{
 		case ETMV1_CONTEXTID_NONE:
-			command_print(cmd_ctx, &quot;contextid tracing: none&quot;);
+			command_print(CMD_CTX, &quot;contextid tracing: none&quot;);
 			break;
 		case ETMV1_CONTEXTID_8:
-			command_print(cmd_ctx, &quot;contextid tracing: 8 bit&quot;);
+			command_print(CMD_CTX, &quot;contextid tracing: 8 bit&quot;);
 			break;
 		case ETMV1_CONTEXTID_16:
-			command_print(cmd_ctx, &quot;contextid tracing: 16 bit&quot;);
+			command_print(CMD_CTX, &quot;contextid tracing: 16 bit&quot;);
 			break;
 		case ETMV1_CONTEXTID_32:
-			command_print(cmd_ctx, &quot;contextid tracing: 32 bit&quot;);
+			command_print(CMD_CTX, &quot;contextid tracing: 32 bit&quot;);
 			break;
 	}
 
 	if (tracemode &amp; ETMV1_CYCLE_ACCURATE)
 	{
-		command_print(cmd_ctx, &quot;cycle-accurate tracing enabled&quot;);
+		command_print(CMD_CTX, &quot;cycle-accurate tracing enabled&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;cycle-accurate tracing disabled&quot;);
+		command_print(CMD_CTX, &quot;cycle-accurate tracing disabled&quot;);
 	}
 
 	if (tracemode &amp; ETMV1_BRANCH_OUTPUT)
 	{
-		command_print(cmd_ctx, &quot;full branch address output enabled&quot;);
+		command_print(CMD_CTX, &quot;full branch address output enabled&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;full branch address output disabled&quot;);
+		command_print(CMD_CTX, &quot;full branch address output disabled&quot;);
 	}
 
 	/* only update ETM_CTRL register if tracemode changed */
@@ -1386,7 +1386,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 
 	arm = target_to_arm(target);
 	if (!is_arm(arm)) {
-		command_print(cmd_ctx, &quot;target '%s' is '%s'; not an ARM&quot;,
+		command_print(CMD_CTX, &quot;target '%s' is '%s'; not an ARM&quot;,
 				target-&gt;cmd_name, target_get_name(target));
 		return ERROR_FAIL;
 	}
@@ -1437,7 +1437,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 			portmode |= ETM_PORT_2BIT;
 			break;
 		default:
-			command_print(cmd_ctx,
+			command_print(CMD_CTX,
 				&quot;unsupported ETM port width '%s'&quot;, CMD_ARGV[1]);
 			return ERROR_FAIL;
 	}
@@ -1456,7 +1456,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unsupported ETM port mode '%s', must be 'normal', 'multiplexed' or 'demultiplexed'&quot;, CMD_ARGV[2]);
+		command_print(CMD_CTX, &quot;unsupported ETM port mode '%s', must be 'normal', 'multiplexed' or 'demultiplexed'&quot;, CMD_ARGV[2]);
 		return ERROR_FAIL;
 	}
 
@@ -1470,7 +1470,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unsupported ETM port clocking '%s', must be 'full' or 'half'&quot;, CMD_ARGV[3]);
+		command_print(CMD_CTX, &quot;unsupported ETM port clocking '%s', must be 'full' or 'half'&quot;, CMD_ARGV[3]);
 		return ERROR_FAIL;
 	}
 
@@ -1485,7 +1485,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 		if (strcmp(CMD_ARGV[4], etm_capture_drivers[i]-&gt;name) == 0)
 		{
 			int retval;
-			if ((retval = etm_capture_drivers[i]-&gt;register_commands(cmd_ctx)) != ERROR_OK)
+			if ((retval = etm_capture_drivers[i]-&gt;register_commands(CMD_CTX)) != ERROR_OK)
 			{
 				free(etm_ctx);
 				return retval;
@@ -1513,7 +1513,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 
 	arm-&gt;etm = etm_ctx;
 
-	return etm_register_user_commands(cmd_ctx);
+	return etm_register_user_commands(CMD_CTX);
 }
 
 COMMAND_HANDLER(handle_etm_info_command)
@@ -1525,49 +1525,49 @@ COMMAND_HANDLER(handle_etm_info_command)
 	int max_port_size;
 	uint32_t config;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm = arm-&gt;etm;
 	if (!etm)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
-	command_print(cmd_ctx, &quot;ETM v%d.%d&quot;,
+	command_print(CMD_CTX, &quot;ETM v%d.%d&quot;,
 			etm-&gt;bcd_vers &gt;&gt; 4, etm-&gt;bcd_vers &amp; 0xf);
-	command_print(cmd_ctx, &quot;pairs of address comparators: %i&quot;,
+	command_print(CMD_CTX, &quot;pairs of address comparators: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 0) &amp; 0x0f);
-	command_print(cmd_ctx, &quot;data comparators: %i&quot;,
+	command_print(CMD_CTX, &quot;data comparators: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 4) &amp; 0x0f);
-	command_print(cmd_ctx, &quot;memory map decoders: %i&quot;,
+	command_print(CMD_CTX, &quot;memory map decoders: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 8) &amp; 0x1f);
-	command_print(cmd_ctx, &quot;number of counters: %i&quot;,
+	command_print(CMD_CTX, &quot;number of counters: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 13) &amp; 0x07);
-	command_print(cmd_ctx, &quot;sequencer %spresent&quot;,
+	command_print(CMD_CTX, &quot;sequencer %spresent&quot;,
 			(int) (etm-&gt;config &amp; (1 &lt;&lt; 16)) ? &quot;&quot; : &quot;not &quot;);
-	command_print(cmd_ctx, &quot;number of ext. inputs: %i&quot;,
+	command_print(CMD_CTX, &quot;number of ext. inputs: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 17) &amp; 0x07);
-	command_print(cmd_ctx, &quot;number of ext. outputs: %i&quot;,
+	command_print(CMD_CTX, &quot;number of ext. outputs: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 20) &amp; 0x07);
-	command_print(cmd_ctx, &quot;FIFO full %spresent&quot;,
+	command_print(CMD_CTX, &quot;FIFO full %spresent&quot;,
 			(int) (etm-&gt;config &amp; (1 &lt;&lt; 23)) ? &quot;&quot; : &quot;not &quot;);
 	if (etm-&gt;bcd_vers &lt; 0x20)
-		command_print(cmd_ctx, &quot;protocol version: %i&quot;,
+		command_print(CMD_CTX, &quot;protocol version: %i&quot;,
 				(int) (etm-&gt;config &gt;&gt; 28) &amp; 0x07);
 	else {
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;coprocessor and memory access %ssupported&quot;,
 				(etm-&gt;config &amp; (1 &lt;&lt; 26)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;trace start/stop %spresent&quot;,
+		command_print(CMD_CTX, &quot;trace start/stop %spresent&quot;,
 				(etm-&gt;config &amp; (1 &lt;&lt; 26)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;number of context comparators: %i&quot;,
+		command_print(CMD_CTX, &quot;number of context comparators: %i&quot;,
 				(int) (etm-&gt;config &gt;&gt; 24) &amp; 0x03);
 	}
 
@@ -1619,30 +1619,30 @@ COMMAND_HANDLER(handle_etm_info_command)
 			LOG_ERROR(&quot;Illegal max_port_size&quot;);
 			return ERROR_FAIL;
 	}
-	command_print(cmd_ctx, &quot;max. port size: %i&quot;, max_port_size);
+	command_print(CMD_CTX, &quot;max. port size: %i&quot;, max_port_size);
 
 	if (etm-&gt;bcd_vers &lt; 0x30) {
-		command_print(cmd_ctx, &quot;half-rate clocking %ssupported&quot;,
+		command_print(CMD_CTX, &quot;half-rate clocking %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 3)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;full-rate clocking %ssupported&quot;,
+		command_print(CMD_CTX, &quot;full-rate clocking %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 4)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;normal trace format %ssupported&quot;,
+		command_print(CMD_CTX, &quot;normal trace format %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 5)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;multiplex trace format %ssupported&quot;,
+		command_print(CMD_CTX, &quot;multiplex trace format %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 6)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;demultiplex trace format %ssupported&quot;,
+		command_print(CMD_CTX, &quot;demultiplex trace format %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 7)) ? &quot;&quot; : &quot;not &quot;);
 	} else {
 		/* REVISIT show which size and format are selected ... */
-		command_print(cmd_ctx, &quot;current port size %ssupported&quot;,
+		command_print(CMD_CTX, &quot;current port size %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 10)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;current trace format %ssupported&quot;,
+		command_print(CMD_CTX, &quot;current trace format %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 11)) ? &quot;&quot; : &quot;not &quot;);
 	}
 	if (etm-&gt;bcd_vers &gt;= 0x21)
-		command_print(cmd_ctx, &quot;fetch comparisons %ssupported&quot;,
+		command_print(CMD_CTX, &quot;fetch comparisons %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 17)) ? &quot;not &quot; : &quot;&quot;);
-	command_print(cmd_ctx, &quot;FIFO full %ssupported&quot;,
+	command_print(CMD_CTX, &quot;FIFO full %ssupported&quot;,
 			(config &amp; (1 &lt;&lt; 8)) ? &quot;&quot; : &quot;not &quot;);
 
 	return ERROR_OK;
@@ -1655,18 +1655,18 @@ COMMAND_HANDLER(handle_etm_status_command)
 	struct etm_context *etm;
 	trace_status_t trace_status;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm = arm-&gt;etm;
 	if (!etm)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1680,7 +1680,7 @@ COMMAND_HANDLER(handle_etm_status_command)
 		if (etm_get_reg(reg) == ERROR_OK) {
 			unsigned s = buf_get_u32(reg-&gt;value, 0, reg-&gt;size);
 
-			command_print(cmd_ctx, &quot;etm: %s%s%s%s&quot;,
+			command_print(CMD_CTX, &quot;etm: %s%s%s%s&quot;,
 				/* bit(1) == progbit */
 				(etm-&gt;bcd_vers &gt;= 0x12)
 					? ((s &amp; (1 &lt;&lt; 1))
@@ -1699,7 +1699,7 @@ COMMAND_HANDLER(handle_etm_status_command)
 	trace_status = etm-&gt;capture_driver-&gt;status(etm);
 	if (trace_status == TRACE_IDLE)
 	{
-		command_print(cmd_ctx, &quot;%s: idle&quot;, etm-&gt;capture_driver-&gt;name);
+		command_print(CMD_CTX, &quot;%s: idle&quot;, etm-&gt;capture_driver-&gt;name);
 	}
 	else
 	{
@@ -1708,7 +1708,7 @@ COMMAND_HANDLER(handle_etm_status_command)
 		static char *overflowed = &quot;, overflowed&quot;;
 		static char *triggered = &quot;, triggered&quot;;
 
-		command_print(cmd_ctx, &quot;%s: trace collection%s%s%s&quot;,
+		command_print(CMD_CTX, &quot;%s: trace collection%s%s%s&quot;,
 			etm-&gt;capture_driver-&gt;name,
 			(trace_status &amp; TRACE_RUNNING) ? running : completed,
 			(trace_status &amp; TRACE_OVERFLOWED) ? overflowed : &quot;&quot;,
@@ -1716,7 +1716,7 @@ COMMAND_HANDLER(handle_etm_status_command)
 
 		if (etm-&gt;trace_depth &gt; 0)
 		{
-			command_print(cmd_ctx, &quot;%i frames of trace data read&quot;,
+			command_print(CMD_CTX, &quot;%i frames of trace data read&quot;,
 					(int)(etm-&gt;trace_depth));
 		}
 	}
@@ -1732,22 +1732,22 @@ COMMAND_HANDLER(handle_etm_image_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: etm image &lt;file&gt; [base address] [type]&quot;);
+		command_print(CMD_CTX, &quot;usage: etm image &lt;file&gt; [base address] [type]&quot;);
 		return ERROR_FAIL;
 	}
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1755,7 +1755,7 @@ COMMAND_HANDLER(handle_etm_image_command)
 	{
 		image_close(etm_ctx-&gt;image);
 		free(etm_ctx-&gt;image);
-		command_print(cmd_ctx, &quot;previously loaded image found and closed&quot;);
+		command_print(CMD_CTX, &quot;previously loaded image found and closed&quot;);
 	}
 
 	etm_ctx-&gt;image = malloc(sizeof(struct image));
@@ -1793,35 +1793,35 @@ COMMAND_HANDLER(handle_etm_dump_command)
 
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: etm dump &lt;file&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: etm dump &lt;file&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (etm_ctx-&gt;capture_driver-&gt;status == TRACE_IDLE)
 	{
-		command_print(cmd_ctx, &quot;trace capture wasn't enabled, no trace data captured&quot;);
+		command_print(CMD_CTX, &quot;trace capture wasn't enabled, no trace data captured&quot;);
 		return ERROR_OK;
 	}
 
 	if (etm_ctx-&gt;capture_driver-&gt;status(etm_ctx) &amp; TRACE_RUNNING)
 	{
 		/* TODO: if on-the-fly capture is to be supported, this needs to be changed */
-		command_print(cmd_ctx, &quot;trace capture not completed&quot;);
+		command_print(CMD_CTX, &quot;trace capture not completed&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1861,28 +1861,28 @@ COMMAND_HANDLER(handle_etm_load_command)
 
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: etm load &lt;file&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: etm load &lt;file&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (etm_ctx-&gt;capture_driver-&gt;status(etm_ctx) &amp; TRACE_RUNNING)
 	{
-		command_print(cmd_ctx, &quot;trace capture running, stop first&quot;);
+		command_print(CMD_CTX, &quot;trace capture running, stop first&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1893,7 +1893,7 @@ COMMAND_HANDLER(handle_etm_load_command)
 
 	if (file.size % 4)
 	{
-		command_print(cmd_ctx, &quot;size isn't a multiple of 4, no valid trace data&quot;);
+		command_print(CMD_CTX, &quot;size isn't a multiple of 4, no valid trace data&quot;);
 		fileio_close(&amp;file);
 		return ERROR_FAIL;
 	}
@@ -1914,7 +1914,7 @@ COMMAND_HANDLER(handle_etm_load_command)
 	etm_ctx-&gt;trace_data = malloc(sizeof(struct etmv1_trace_data) * etm_ctx-&gt;trace_depth);
 	if (etm_ctx-&gt;trace_data == NULL)
 	{
-		command_print(cmd_ctx, &quot;not enough memory to perform operation&quot;);
+		command_print(CMD_CTX, &quot;not enough memory to perform operation&quot;);
 		fileio_close(&amp;file);
 		return ERROR_FAIL;
 	}
@@ -1941,18 +1941,18 @@ COMMAND_HANDLER(handle_etm_trigger_percent_command)
 	struct arm *arm;
 	struct etm_context *etm_ctx;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1963,7 +1963,7 @@ COMMAND_HANDLER(handle_etm_trigger_percent_command)
 
 		if ((new_value &lt; 2) || (new_value &gt; 100))
 		{
-			command_print(cmd_ctx, &quot;valid settings are 2%% to 100%%&quot;);
+			command_print(CMD_CTX, &quot;valid settings are 2%% to 100%%&quot;);
 		}
 		else
 		{
@@ -1971,7 +1971,7 @@ COMMAND_HANDLER(handle_etm_trigger_percent_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;%i percent of the tracebuffer reserved for after the trigger&quot;, ((int)(etm_ctx-&gt;trigger_percent)));
+	command_print(CMD_CTX, &quot;%i percent of the tracebuffer reserved for after the trigger&quot;, ((int)(etm_ctx-&gt;trigger_percent)));
 
 	return ERROR_OK;
 }
@@ -1983,18 +1983,18 @@ COMMAND_HANDLER(handle_etm_start_command)
 	struct etm_context *etm_ctx;
 	struct reg *etm_ctrl_reg;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2031,18 +2031,18 @@ COMMAND_HANDLER(handle_etm_stop_command)
 	struct etm_context *etm_ctx;
 	struct reg *etm_ctrl_reg;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2070,36 +2070,36 @@ COMMAND_HANDLER(handle_etm_analyze_command)
 	struct etm_context *etm_ctx;
 	int retval;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
-	if ((retval = etmv1_analyze_trace(etm_ctx, cmd_ctx)) != ERROR_OK)
+	if ((retval = etmv1_analyze_trace(etm_ctx, CMD_CTX)) != ERROR_OK)
 	{
 		switch (retval)
 		{
 			case ERROR_ETM_ANALYSIS_FAILED:
-				command_print(cmd_ctx, &quot;further analysis failed (corrupted trace data or just end of data&quot;);
+				command_print(CMD_CTX, &quot;further analysis failed (corrupted trace data or just end of data&quot;);
 				break;
 			case ERROR_TRACE_INSTRUCTION_UNAVAILABLE:
-				command_print(cmd_ctx, &quot;no instruction for current address available, analysis aborted&quot;);
+				command_print(CMD_CTX, &quot;no instruction for current address available, analysis aborted&quot;);
 				break;
 			case ERROR_TRACE_IMAGE_UNAVAILABLE:
-				command_print(cmd_ctx, &quot;no image available for trace analysis&quot;);
+				command_print(CMD_CTX, &quot;no image available for trace analysis&quot;);
 				break;
 			default:
-				command_print(cmd_ctx, &quot;unknown error: %i&quot;, retval);
+				command_print(CMD_CTX, &quot;unknown error: %i&quot;, retval);
 		}
 	}
 
diff --git a/src/target/etm_dummy.c b/src/target/etm_dummy.c
index ae53802..7621414 100644
--- a/src/target/etm_dummy.c
+++ b/src/target/etm_dummy.c
@@ -41,7 +41,7 @@ COMMAND_HANDLER(handle_etm_dummy_config_command)
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;target '%s' isn't an ARM&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;target '%s' isn't an ARM&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
diff --git a/src/target/oocd_trace.c b/src/target/oocd_trace.c
index 74f8955..05df258 100644
--- a/src/target/oocd_trace.c
+++ b/src/target/oocd_trace.c
@@ -300,11 +300,11 @@ COMMAND_HANDLER(handle_oocd_trace_config_command)
 		return ERROR_FAIL;
 	}
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -333,24 +333,24 @@ COMMAND_HANDLER(handle_oocd_trace_status_command)
 	struct oocd_trace *oocd_trace;
 	uint32_t status;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (!arm-&gt;etm)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (strcmp(arm-&gt;etm-&gt;capture_driver-&gt;name, &quot;oocd_trace&quot;) != 0)
 	{
-		command_print(cmd_ctx, &quot;current target's ETM capture driver isn't 'oocd_trace'&quot;);
+		command_print(CMD_CTX, &quot;current target's ETM capture driver isn't 'oocd_trace'&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -359,9 +359,9 @@ COMMAND_HANDLER(handle_oocd_trace_status_command)
 	oocd_trace_read_reg(oocd_trace, OOCD_TRACE_STATUS, &amp;status);
 
 	if (status &amp; 0x8)
-		command_print(cmd_ctx, &quot;trace clock locked&quot;);
+		command_print(CMD_CTX, &quot;trace clock locked&quot;);
 	else
-		command_print(cmd_ctx, &quot;no trace clock&quot;);
+		command_print(CMD_CTX, &quot;no trace clock&quot;);
 
 	return ERROR_OK;
 }
@@ -374,24 +374,24 @@ COMMAND_HANDLER(handle_oocd_trace_resync_command)
 	size_t bytes_written;
 	uint8_t cmd_array[1];
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (!arm-&gt;etm)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (strcmp(arm-&gt;etm-&gt;capture_driver-&gt;name, &quot;oocd_trace&quot;) != 0)
 	{
-		command_print(cmd_ctx, &quot;current target's ETM capture driver isn't 'oocd_trace'&quot;);
+		command_print(CMD_CTX, &quot;current target's ETM capture driver isn't 'oocd_trace'&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -401,7 +401,7 @@ COMMAND_HANDLER(handle_oocd_trace_resync
_command)
 
 	bytes_written = write(oocd_trace-&gt;tty_fd, cmd_array, 1);
 
-	command_print(cmd_ctx, &quot;requesting traceclock resync&quot;);
+	command_print(CMD_CTX, &quot;requesting traceclock resync&quot;);
 	LOG_DEBUG(&quot;resyncing traceclk pll&quot;);
 
 	return ERROR_OK;
diff --git a/src/target/target.c b/src/target/target.c
index 3143180..bf83da0 100644
--- a/src/target/target.c
+++ b/src/target/target.c
@@ -1652,24 +1652,24 @@ COMMAND_HANDLER(handle_targets_command)
 	{
 		target = get_target(CMD_ARGV[0]);
 		if (target == NULL) {
-			command_print(cmd_ctx,&quot;Target: %s is unknown, try one of:\n&quot;, CMD_ARGV[0]);
+			command_print(CMD_CTX,&quot;Target: %s is unknown, try one of:\n&quot;, CMD_ARGV[0]);
 			goto DumpTargets;
 		}
 		if (!target-&gt;tap-&gt;enabled) {
-			command_print(cmd_ctx,&quot;Target: TAP %s is disabled, &quot;
+			command_print(CMD_CTX,&quot;Target: TAP %s is disabled, &quot;
 					&quot;can't be the current target\n&quot;,
 					target-&gt;tap-&gt;dotted_name);
 			return ERROR_FAIL;
 		}
 
-		cmd_ctx-&gt;current_target = target-&gt;target_number;
+		CMD_CTX-&gt;current_target = target-&gt;target_number;
 		return ERROR_OK;
 	}
 DumpTargets:
 
 	target = all_targets;
-	command_print(cmd_ctx, &quot;    TargetName         Type       Endian TapName            State       &quot;);
-	command_print(cmd_ctx, &quot;--  ------------------ ---------- ------ ------------------ ------------&quot;);
+	command_print(CMD_CTX, &quot;    TargetName         Type       Endian TapName            State       &quot;);
+	command_print(CMD_CTX, &quot;--  ------------------ ---------- ------ ------------------ ------------&quot;);
 	while (target)
 	{
 		const char *state;
@@ -1680,11 +1680,11 @@ DumpTargets:
 		else
 			state = &quot;tap-disabled&quot;;
 
-		if (cmd_ctx-&gt;current_target == target-&gt;target_number)
+		if (CMD_CTX-&gt;current_target == target-&gt;target_number)
 			marker = '*';
 
 		/* keep columns lined up to match the headers above */
-		command_print(cmd_ctx, &quot;%2d%c %-18s %-10s %-6s %-18s %s&quot;,
+		command_print(CMD_CTX, &quot;%2d%c %-18s %-10s %-6s %-18s %s&quot;,
 					  target-&gt;target_number,
 					  marker,
 					  target-&gt;cmd_name,
@@ -1865,7 +1865,7 @@ COMMAND_HANDLER(handle_reg_command)
 
 	LOG_DEBUG(&quot;-&quot;);
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 
 	/* list all available registers for the current target */
 	if (CMD_ARGC == 0)
@@ -1877,7 +1877,7 @@ COMMAND_HANDLER(handle_reg_command)
 		{
 			int i;
 
-			command_print(cmd_ctx, &quot;===== %s&quot;, cache-&gt;name);
+			command_print(CMD_CTX, &quot;===== %s&quot;, cache-&gt;name);
 
 			for (i = 0, reg = cache-&gt;reg_list;
 					i &lt; cache-&gt;num_regs;
@@ -1887,7 +1887,7 @@ COMMAND_HANDLER(handle_reg_command)
 				if (reg-&gt;valid) {
 					value = buf_to_str(reg-&gt;value,
 							reg-&gt;size, 16);
-					command_print(cmd_ctx,
+					command_print(CMD_CTX,
 							&quot;(%i) %s (/%&quot; PRIu32 &quot;): 0x%s%s&quot;,
 							count, reg-&gt;name,
 							reg-&gt;size, value,
@@ -1896,7 +1896,7 @@ COMMAND_HANDLER(handle_reg_command)
 								: &quot;&quot;);
 					free(value);
 				} else {
-					command_print(cmd_ctx, &quot;(%i) %s (/%&quot; PRIu32 &quot;)&quot;,
+					command_print(CMD_CTX, &quot;(%i) %s (/%&quot; PRIu32 &quot;)&quot;,
 							  count, reg-&gt;name,
 							  reg-&gt;size) ;
 				}
@@ -1933,7 +1933,7 @@ COMMAND_HANDLER(handle_reg_command)
 
 		if (!reg)
 		{
-			command_print(cmd_ctx, &quot;%i is out of bounds, the current target has only %i registers (0 - %i)&quot;, num, count, count - 1);
+			command_print(CMD_CTX, &quot;%i is out of bounds, the current target has only %i registers (0 - %i)&quot;, num, count, count - 1);
 			return ERROR_OK;
 		}
 	} else /* access a single register by its name */
@@ -1942,7 +1942,7 @@ COMMAND_HANDLER(handle_reg_command)
 
 		if (!reg)
 		{
-			command_print(cmd_ctx, &quot;register %s not found in current target&quot;, CMD_ARGV[0]);
+			command_print(CMD_CTX, &quot;register %s not found in current target&quot;, CMD_ARGV[0]);
 			return ERROR_OK;
 		}
 	}
@@ -1958,7 +1958,7 @@ COMMAND_HANDLER(handle_reg_command)
 			reg-&gt;type-&gt;get(reg);
 		}
 		value = buf_to_str(reg-&gt;value, reg-&gt;size, 16);
-		command_print(cmd_ctx, &quot;%s (/%i): 0x%s&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
+		command_print(CMD_CTX, &quot;%s (/%i): 0x%s&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
 		free(value);
 		return ERROR_OK;
 	}
@@ -1972,7 +1972,7 @@ COMMAND_HANDLER(handle_reg_command)
 		reg-&gt;type-&gt;set(reg, buf);
 
 		value = buf_to_str(reg-&gt;value, reg-&gt;size, 16);
-		command_print(cmd_ctx, &quot;%s (/%i): 0x%s&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
+		command_print(CMD_CTX, &quot;%s (/%i): 0x%s&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
 		free(value);
 
 		free(buf);
@@ -1980,7 +1980,7 @@ COMMAND_HANDLER(handle_reg_command)
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;usage: reg &lt;#|name&gt; [value]&quot;);
+	command_print(CMD_CTX, &quot;usage: reg &lt;#|name&gt; [value]&quot;);
 
 	return ERROR_OK;
 }
@@ -1988,13 +1988,13 @@ COMMAND_HANDLER(handle_reg_command)
 COMMAND_HANDLER(handle_poll_command)
 {
 	int retval = ERROR_OK;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC == 0)
 	{
-		command_print(cmd_ctx, &quot;background polling: %s&quot;,
+		command_print(CMD_CTX, &quot;background polling: %s&quot;,
 				jtag_poll_get_enabled() ? &quot;on&quot; : &quot;off&quot;);
-		command_print(cmd_ctx, &quot;TAP: %s (%s)&quot;,
+		command_print(CMD_CTX, &quot;TAP: %s (%s)&quot;,
 				target-&gt;tap-&gt;dotted_name,
 				target-&gt;tap-&gt;enabled ? &quot;enabled&quot; : &quot;disabled&quot;);
 		if (!target-&gt;tap-&gt;enabled)
@@ -2017,7 +2017,7 @@ COMMAND_HANDLER(handle_poll_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;arg is \&quot;on\&quot; or \&quot;off\&quot;&quot;);
+			command_print(CMD_CTX, &quot;arg is \&quot;on\&quot; or \&quot;off\&quot;&quot;);
 		}
 	} else
 	{
@@ -2038,14 +2038,14 @@ COMMAND_HANDLER(handle_wait_halt_command)
 		int retval = parse_uint(CMD_ARGV[0], &amp;ms);
 		if (ERROR_OK != retval)
 		{
-			command_print(cmd_ctx, &quot;usage: %s [seconds]&quot;, CMD_NAME);
+			command_print(CMD_CTX, &quot;usage: %s [seconds]&quot;, CMD_NAME);
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
 		// convert seconds (given) to milliseconds (needed)
 		ms *= 1000;
 	}
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	return target_wait_state(target, TARGET_HALTED, ms);
 }
 
@@ -2098,7 +2098,7 @@ COMMAND_HANDLER(handle_halt_command)
 {
 	LOG_DEBUG(&quot;-&quot;);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	int retval = target_halt(target);
 	if (ERROR_OK != retval)
 		return retval;
@@ -2118,7 +2118,7 @@ COMMAND_HANDLER(handle_halt_command)
 
 COMMAND_HANDLER(handle_soft_reset_halt_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	LOG_USER(&quot;requesting target halt and executing a soft reset&quot;);
 
@@ -2144,7 +2144,7 @@ COMMAND_HANDLER(handle_reset_command)
 	}
 
 	/* reset *all* targets */
-	return target_process_reset(cmd_ctx, reset_mode);
+	return target_process_reset(CMD_CTX, reset_mode);
 }
 
 
@@ -2154,7 +2154,7 @@ COMMAND_HANDLER(handle_resume_command)
 	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	target_handle_event(target, TARGET_EVENT_OLD_pre_resume);
 
 	/* with no CMD_ARGV, resume from current pc, addr = 0,
@@ -2188,7 +2188,7 @@ COMMAND_HANDLER(handle_step_command)
 		current_pc = 0;
 	}
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	return target-&gt;type-&gt;step(target, current_pc, addr, 1);
 }
@@ -2282,10 +2282,10 @@ COMMAND_HANDLER(handle_md_command)
 
 	uint8_t *buffer = calloc(count, size);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	int retval = fn(target, address, size, count, buffer);
 	if (ERROR_OK == retval)
-		handle_md_output(cmd_ctx, target, address, size, count, buffer);
+		handle_md_output(CMD_CTX, target, address, size, count, buffer);
 
 	free(buffer);
 
@@ -2324,7 +2324,7 @@ COMMAND_HANDLER(handle_mw_command)
 	if (CMD_ARGC == 3)
 		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[2], count);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	unsigned wordsize;
 	uint8_t value_buf[4];
 	switch (cmd_name[6])
@@ -2409,7 +2409,7 @@ COMMAND_HANDLER(handle_load_image_command)
 	if (ERROR_OK != retval)
 		return retval;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	struct duration bench;
 	duration_start(&amp;bench);
@@ -2426,7 +2426,7 @@ COMMAND_HANDLER(handle_load_image_command)
 		buffer = malloc(image.sections[i].size);
 		if (buffer == NULL)
 		{
-			command_print(cmd_ctx,
+			command_print(CMD_CTX,
 						  &quot;error allocating buffer for section (%d bytes)&quot;,
 						  (int)(image.sections[i].size));
 			break;
@@ -2464,7 +2464,7 @@ COMMAND_HANDLER(handle_load_image_command)
 				break;
 			}
 			image_size += length;
-			command_print(cmd_ctx, &quot;%u bytes written at address 0x%8.8&quot; PRIx32 &quot;&quot;,
+			command_print(CMD_CTX, &quot;%u bytes written at address 0x%8.8&quot; PRIx32 &quot;&quot;,
 						  (unsigned int)length,
 						  image.sections[i].base_address + offset);
 		}
@@ -2474,7 +2474,7 @@ COMMAND_HANDLER(handle_load_image_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;downloaded %&quot; PRIu32 &quot; bytes &quot;
+		command_print(CMD_CTX, &quot;downloaded %&quot; PRIu32 &quot; bytes &quot;
 				&quot;in %fs (%0.3f kb/s)&quot;, image_size,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, image_size));
 	}
@@ -2493,11 +2493,11 @@ COMMAND_HANDLER(handle_dump_image_command)
 	int retvaltemp;
 
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC != 3)
 	{
-		command_print(cmd_ctx, &quot;usage: dump_image &lt;filename&gt; &lt;address&gt; &lt;size&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: dump_image &lt;filename&gt; &lt;address&gt; &lt;size&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -2540,7 +2540,7 @@ COMMAND_HANDLER(handle_dump_image_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;dumped %zu bytes in %fs (%0.3f kb/s)&quot;, fileio.size,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, fileio.size));
 	}
@@ -2560,7 +2560,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 
 	struct image image;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC &lt; 1)
 	{
@@ -2603,7 +2603,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 		buffer = malloc(image.sections[i].size);
 		if (buffer == NULL)
 		{
-			command_print(cmd_ctx,
+			command_print(CMD_CTX,
 						  &quot;error allocating buffer for section (%d bytes)&quot;,
 						  (int)(image.sections[i].size));
 			break;
@@ -2631,7 +2631,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 				/* failed crc checksum, fall back to a binary compare */
 				uint8_t *data;
 
-				command_print(cmd_ctx, &quot;checksum mismatch - attempting binary compare&quot;);
+				command_print(CMD_CTX, &quot;checksum mismatch - attempting binary compare&quot;);
 
 				data = (uint8_t*)malloc(buf_cnt);
 
@@ -2651,7 +2651,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 					{
 						if (data[t] != buffer[t])
 						{
-							command_print(cmd_ctx,
+							command_print(CMD_CTX,
 										  &quot;Verify operation failed address 0x%08x. Was 0x%02x instead of 0x%02x\n&quot;,
 										  (unsigned)(t + image.sections[i].base_address),
 										  data[t],
@@ -2672,7 +2672,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 			}
 		} else
 		{
-			command_print(cmd_ctx, &quot;address 0x%08&quot; PRIx32 &quot; length 0x%08zx&quot;,
+			command_print(CMD_CTX, &quot;address 0x%08&quot; PRIx32 &quot; length 0x%08zx&quot;,
 						  image.sections[i].base_address,
 						  buf_cnt);
 		}
@@ -2683,7 +2683,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 done:
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;verified %&quot; PRIu32 &quot; bytes &quot;
+		command_print(CMD_CTX, &quot;verified %&quot; PRIu32 &quot; bytes &quot;
 				&quot;in %fs (%0.3f kb/s)&quot;, image_size,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, image_size));
 	}
@@ -2746,11 +2746,11 @@ static int handle_bp_command_set(struct command_context *cmd_ctx,
 COMMAND_HANDLER(handle_bp_command)
 {
 	if (CMD_ARGC == 0)
-		return handle_bp_command_list(cmd_ctx);
+		return handle_bp_command_list(CMD_CTX);
 
 	if (CMD_ARGC &lt; 2 || CMD_ARGC &gt; 3)
 	{
-		command_print(cmd_ctx, &quot;usage: bp &lt;address&gt; &lt;length&gt; ['hw']&quot;);
+		command_print(CMD_CTX, &quot;usage: bp &lt;address&gt; &lt;length&gt; ['hw']&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -2768,7 +2768,7 @@ COMMAND_HANDLER(handle_bp_command)
 			return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	return handle_bp_command_set(cmd_ctx, addr, length, hw);
+	return handle_bp_command_set(CMD_CTX, addr, length, hw);
 }
 
 COMMAND_HANDLER(handle_rbp_command)
@@ -2779,7 +2779,7 @@ COMMAND_HANDLER(handle_rbp_command)
 	uint32_t addr;
 	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	breakpoint_remove(target, addr);
 
 	return ERROR_OK;
@@ -2787,7 +2787,7 @@ COMMAND_HANDLER(handle_rbp_command)
 
 COMMAND_HANDLER(handle_wp_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC == 0)
 	{
@@ -2795,7 +2795,7 @@ COMMAND_HANDLER(handle_wp_command)
 
 		while (watchpoint)
 		{
-			command_print(cmd_ctx, &quot;address: 0x%8.8&quot; PRIx32
+			command_print(CMD_CTX, &quot;address: 0x%8.8&quot; PRIx32
 					&quot;, len: 0x%8.8&quot; PRIx32
 					&quot;, r/w/a: %i, value: 0x%8.8&quot; PRIx32
 					&quot;, mask: 0x%8.8&quot; PRIx32,
@@ -2846,7 +2846,7 @@ COMMAND_HANDLER(handle_wp_command)
 		break;
 
 	default:
-		command_print(cmd_ctx, &quot;usage: wp [address length &quot;
+		command_print(CMD_CTX, &quot;usage: wp [address length &quot;
 				&quot;[(r|w|a) [value [mask]]]]&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2867,7 +2867,7 @@ COMMAND_HANDLER(handle_rwp_command)
 	uint32_t addr;
 	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	watchpoint_remove(target, addr);
 
 	return ERROR_OK;
@@ -2889,10 +2889,10 @@ COMMAND_HANDLER(handle_virt2phys_command)
 	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], va);
 	uint32_t pa;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	int retval = target-&gt;type-&gt;virt2phys(target, va, &amp;pa);
 	if (retval == ERROR_OK)
-		command_print(cmd_ctx, &quot;Physical address 0x%08&quot; PRIx32 &quot;&quot;, pa);
+		command_print(CMD_CTX, &quot;Physical address 0x%08&quot; PRIx32 &quot;&quot;, pa);
 
 	return retval;
 }
@@ -3016,7 +3016,7 @@ static void writeGmon(uint32_t *samples, uint32_t sampleNum, const char *filenam
 /* profiling samples the CPU PC as quickly as OpenOCD is able, which will be used as a random sampling of PC */
 COMMAND_HANDLER(handle_profile_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct timeval timeout, now;
 
 	gettimeofday(&amp;timeout, NULL);
@@ -3029,7 +3029,7 @@ COMMAND_HANDLER(handle_profile_command)
 
 	timeval_add_time(&amp;timeout, offset, 0);
 
-	command_print(cmd_ctx, &quot;Starting profiling. Halting and resuming the target as often as we can...&quot;);
+	command_print(CMD_CTX, &quot;Starting profiling. Halting and resuming the target as often as we can...&quot;);
 
 	static const int maxSample = 10000;
 	uint32_t *samples = malloc(sizeof(uint32_t)*maxSample);
@@ -3061,7 +3061,7 @@ COMMAND_HANDLER(handle_profile_command)
 			}
 		} else
 		{
-			command_print(cmd_ctx, &quot;Target not halted or running&quot;);
+			command_print(CMD_CTX, &quot;Target not halted or running&quot;);
 			retval = ERROR_OK;
 			break;
 		}
@@ -3073,7 +3073,7 @@ COMMAND_HANDLER(handle_profile_command)
 		gettimeofday(&amp;now, NULL);
 		if ((numSamples &gt;= maxSample) || ((now.tv_sec &gt;= timeout.tv_sec) &amp;&amp; (now.tv_usec &gt;= timeout.tv_usec)))
 		{
-			command_print(cmd_ctx, &quot;Profiling completed. %d samples.&quot;, numSamples);
+			command_print(CMD_CTX, &quot;Profiling completed. %d samples.&quot;, numSamples);
 			if ((retval = target_poll(target)) != ERROR_OK)
 			{
 				free(samples);
@@ -3089,7 +3089,7 @@ COMMAND_HANDLER(handle_profile_command)
 				return retval;
 			}
 			writeGmon(samples, numSamples, CMD_ARGV[1]);
-			command_print(cmd_ctx, &quot;Wrote %s&quot;, CMD_ARGV[1]);
+			command_print(CMD_CTX, &quot;Wrote %s&quot;, CMD_ARGV[1]);
 			break;
 		}
 	}
@@ -4571,7 +4571,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 		buffer = malloc(image.sections[i].size);
 		if (buffer == NULL)
 		{
-			command_print(cmd_ctx, &quot;error allocating buffer for section (%d bytes)&quot;,
+			command_print(CMD_CTX, &quot;error allocating buffer for section (%d bytes)&quot;,
 						  (int)(image.sections[i].size));
 			break;
 		}
@@ -4614,7 +4614,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 			fastload[i].length = length;
 
 			image_size += length;
-			command_print(cmd_ctx, &quot;%u bytes written at address 0x%8.8x&quot;,
+			command_print(CMD_CTX, &quot;%u bytes written at address 0x%8.8x&quot;,
 						  (unsigned int)length,
 						  ((unsigned int)(image.sections[i].base_address + offset)));
 		}
@@ -4624,11 +4624,11 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;Loaded %&quot; PRIu32 &quot; bytes &quot;
+		command_print(CMD_CTX, &quot;Loaded %&quot; PRIu32 &quot; bytes &quot;
 				&quot;in %fs (%0.3f kb/s)&quot;, image_size, 
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, image_size));
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;WARNING: image has not been loaded to target!&quot;
 				&quot;You can issue a 'fast_load' to finish loading.&quot;);
 	}
@@ -4658,8 +4658,8 @@ COMMAND_HANDLER(handle_fast_load_command)
 	int retval = ERROR_OK;
 	for (i = 0; i &lt; fastload_num;i++)
 	{
-		struct target *target = get_current_target(cmd_ctx);
-		command_print(cmd_ctx, &quot;Write to 0x%08x, length 0x%08x&quot;,
+		struct target *target = get_current_target(CMD_CTX);
+		command_print(CMD_CTX, &quot;Write to 0x%08x, length 0x%08x&quot;,
 					  (unsigned int)(fastload[i].address),
 					  (unsigned int)(fastload[i].length));
 		if (retval == ERROR_OK)
@@ -4669,7 +4669,7 @@ COMMAND_HANDLER(handle_fast_load_command)
 		size += fastload[i].length;
 	}
 	int after = timeval_ms();
-	command_print(cmd_ctx, &quot;Loaded image %f kBytes/s&quot;, (float)(size/1024.0)/((float)(after-ms)/1000.0));
+	command_print(CMD_CTX, &quot;Loaded image %f kBytes/s&quot;, (float)(size/1024.0)/((float)(after-ms)/1000.0));
 	return retval;
 }
 
diff --git a/src/target/target_request.c b/src/target/target_request.c
index 1d618cc..583f4c0 100644
--- a/src/target/target_request.c
+++ b/src/target/target_request.c
@@ -260,12 +260,12 @@ int delete_debug_msg_receiver(struct command_context *cmd_ctx, struct target *ta
 
 COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	int receiving = 0;
 
 	/* see if reciever is already registered */
-	if (find_debug_msg_receiver(cmd_ctx, target) != NULL)
+	if (find_debug_msg_receiver(CMD_CTX, target) != NULL)
 		receiving = 1;
 
 	if (CMD_ARGC &gt; 0)
@@ -276,7 +276,7 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 			if (!receiving)
 			{
 				receiving = 1;
-				add_debug_msg_receiver(cmd_ctx, target);
+				add_debug_msg_receiver(CMD_CTX, target);
 			}
 			charmsg_mode = !strcmp(CMD_ARGV[0], &quot;charmsg&quot;);
 		}
@@ -286,16 +286,16 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 			if (receiving)
 			{
 				receiving = 0;
-				delete_debug_msg_receiver(cmd_ctx, target);
+				delete_debug_msg_receiver(CMD_CTX, target);
 			}
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: target_request debugmsgs ['enable'|'disable'|'charmsg']&quot;);
+			command_print(CMD_CTX, &quot;usage: target_request debugmsgs ['enable'|'disable'|'charmsg']&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;receiving debug messages from current target %s&quot;,
+	command_print(CMD_CTX, &quot;receiving debug messages from current target %s&quot;,
 		      (receiving) ? (charmsg_mode?&quot;charmsg&quot;:&quot;enabled&quot;) : &quot;disabled&quot;);
 	return ERROR_OK;
 }
diff --git a/src/target/trace.c b/src/target/trace.c
index f2fd790..c038a15 100644
--- a/src/target/trace.c
+++ b/src/target/trace.c
@@ -49,7 +49,7 @@ int trace_point(struct target *target, uint32_t number)
 
 COMMAND_HANDLER(handle_trace_point_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct trace *trace = target-&gt;trace_info;
 
 	if (CMD_ARGC == 0)
@@ -58,7 +58,7 @@ COMMAND_HANDLER(handle_trace_point_command)
 
 		for (i = 0; i &lt; trace-&gt;num_trace_points; i++)
 		{
-			command_print(cmd_ctx, &quot;trace point 0x%8.8&quot; PRIx32 &quot; (%lld times hit)&quot;,
+			command_print(CMD_CTX, &quot;trace point 0x%8.8&quot; PRIx32 &quot; (%lld times hit)&quot;,
 					trace-&gt;trace_points[i].address,
 					(long long)trace-&gt;trace_points[i].hit_counter);
 		}
@@ -97,7 +97,7 @@ COMMAND_HANDLER(handle_trace_point_command)
 
 COMMAND_HANDLER(handle_trace_history_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct trace *trace = target-&gt;trace_info;
 
 	if (CMD_ARGC &gt; 0)
@@ -117,7 +117,7 @@ COMMAND_HANDLER(handle_trace_history_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], trace-&gt;trace_history_size);
 		trace-&gt;trace_history = malloc(sizeof(uint32_t) * trace-&gt;trace_history_size);
 
-		command_print(cmd_ctx, &quot;new trace history size: %i&quot;, (int)(trace-&gt;trace_history_size));
+		command_print(CMD_CTX, &quot;new trace history size: %i&quot;, (int)(trace-&gt;trace_history_size));
 	}
 	else
 	{
@@ -126,7 +126,7 @@ COMMAND_HANDLER(handle_trace_history_command)
 		uint32_t last = trace-&gt;trace_history_pos;
 
 		if (!trace-&gt;trace_history_size) {
-			command_print(cmd_ctx, &quot;trace history buffer is not allocated&quot;);
+			command_print(CMD_CTX, &quot;trace history buffer is not allocated&quot;);
 			return ERROR_OK;
 		}
 		if (trace-&gt;trace_history_overflowed)
@@ -141,14 +141,14 @@ COMMAND_HANDLER(handle_trace_history_command)
 			{
 				uint32_t address;
 				address = trace-&gt;trace_points[trace-&gt;trace_history[i % trace-&gt;trace_history_size]].address;
-				command_print(cmd_ctx, &quot;trace point %i: 0x%8.8&quot; PRIx32 &quot;&quot;,
+				command_print(CMD_CTX, &quot;trace point %i: 0x%8.8&quot; PRIx32 &quot;&quot;,
 					      (int)(trace-&gt;trace_history[i % trace-&gt;trace_history_size]),
 					      address);
 			}
 
 			else
 			{
-				command_print(cmd_ctx, &quot;trace point %i: -not defined-&quot;, (int)(trace-&gt;trace_history[i % trace-&gt;trace_history_size]));
+				command_print(CMD_CTX, &quot;trace point %i: -not defined-&quot;, (int)(trace-&gt;trace_history[i % trace-&gt;trace_history_size]));
 			}
 		}
 	}
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 9500a33..a4a8eab 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -3008,7 +3008,7 @@ COMMAND_HANDLER(xscale_handle_debug_handler_command)
 	}
 
 	xscale = target_to_xscale(target);
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -3047,7 +3047,7 @@ COMMAND_HANDLER(xscale_handle_cache_clean_address_command)
 		return ERROR_FAIL;
 	}
 	xscale = target_to_xscale(target);
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -3067,15 +3067,15 @@ COMMAND_HANDLER(xscale_handle_cache_clean_address_command)
 
 COMMAND_HANDLER(xscale_handle_cache_info_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
-	return armv4_5_handle_cache_info_command(cmd_ctx, &amp;xscale-&gt;armv4_5_mmu.armv4_5_cache);
+	return armv4_5_handle_cache_info_command(CMD_CTX, &amp;xscale-&gt;armv4_5_mmu.armv4_5_cache);
 }
 
 static int xscale_virt2phys(struct target *target,
@@ -3116,17 +3116,17 @@ static int xscale_mmu(struct target *target, int *enabled)
 
 COMMAND_HANDLER(xscale_handle_mmu_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -3144,25 +3144,25 @@ COMMAND_HANDLER(xscale_handle_mmu_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;mmu %s&quot;, (xscale-&gt;armv4_5_mmu.mmu_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
+	command_print(CMD_CTX, &quot;mmu %s&quot;, (xscale-&gt;armv4_5_mmu.mmu_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(xscale_handle_idcache_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int icache = 0, dcache = 0;
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -3194,27 +3194,27 @@ COMMAND_HANDLER(xscale_handle_idcache_command)
 	}
 
 	if (icache)
-		command_print(cmd_ctx, &quot;icache %s&quot;, (xscale-&gt;armv4_5_mmu.armv4_5_cache.i_cache_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
+		command_print(CMD_CTX, &quot;icache %s&quot;, (xscale-&gt;armv4_5_mmu.armv4_5_cache.i_cache_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	if (dcache)
-		command_print(cmd_ctx, &quot;dcache %s&quot;, (xscale-&gt;armv4_5_mmu.armv4_5_cache.d_u_cache_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
+		command_print(CMD_CTX, &quot;dcache %s&quot;, (xscale-&gt;armv4_5_mmu.armv4_5_cache.d_u_cache_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(xscale_handle_vector_catch_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: xscale vector_catch [mask]&quot;);
+		command_print(CMD_CTX, &quot;usage: xscale vector_catch [mask]&quot;);
 	}
 	else
 	{
@@ -3223,7 +3223,7 @@ COMMAND_HANDLER(xscale_handle_vector_catch_command)
 		xscale_write_dcsr(target, -1, -1);
 	}
 
-	command_print(cmd_ctx, &quot;vector catch mask: 0x%2.2x&quot;, xscale-&gt;vector_catch);
+	command_print(CMD_CTX, &quot;vector catch mask: 0x%2.2x&quot;, xscale-&gt;vector_catch);
 
 	return ERROR_OK;
 }
@@ -3231,12 +3231,12 @@ COMMAND_HANDLER(xscale_handle_vector_catch_command)
 
 COMMAND_HANDLER(xscale_handle_vector_table_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int err = 0;
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -3244,13 +3244,13 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 	{
 		int idx;
 
-		command_print(cmd_ctx, &quot;active user-set static vectors:&quot;);
+		command_print(CMD_CTX, &quot;active user-set static vectors:&quot;);
 		for (idx = 1; idx &lt; 8; idx++)
 			if (xscale-&gt;static_low_vectors_set &amp; (1 &lt;&lt; idx))
-				command_print(cmd_ctx, &quot;low  %d: 0x%&quot; PRIx32, idx, xscale-&gt;static_low_vectors[idx]);
+				command_print(CMD_CTX, &quot;low  %d: 0x%&quot; PRIx32, idx, xscale-&gt;static_low_vectors[idx]);
 		for (idx = 1; idx &lt; 8; idx++)
 			if (xscale-&gt;static_high_vectors_set &amp; (1 &lt;&lt; idx))
-				command_print(cmd_ctx, &quot;high %d: 0x%&quot; PRIx32, idx, xscale-&gt;static_high_vectors[idx]);
+				command_print(CMD_CTX, &quot;high %d: 0x%&quot; PRIx32, idx, xscale-&gt;static_high_vectors[idx]);
 		return ERROR_OK;
 	}
 
@@ -3281,7 +3281,7 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 	}
 
 	if (err)
-		command_print(cmd_ctx, &quot;usage: xscale vector_table &lt;high|low&gt; &lt;index&gt; &lt;code&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: xscale vector_table &lt;high|low&gt; &lt;index&gt; &lt;code&gt;&quot;);
 
 	return ERROR_OK;
 }
@@ -3289,19 +3289,19 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 
 COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	struct armv4_5_common_s *armv4_5 = &amp;xscale-&gt;armv4_5_common;
 	uint32_t dcsr_value;
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -3353,7 +3353,7 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 		xscale-&gt;trace.pc_ok = 0;
 	}
 
-	command_print(cmd_ctx, &quot;trace buffer %s (%s)&quot;,
+	command_print(CMD_CTX, &quot;trace buffer %s (%s)&quot;,
 		(xscale-&gt;trace.buffer_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;,
 		(xscale-&gt;trace.buffer_fill &gt; 0) ? &quot;fill&quot; : &quot;wrap&quot;);
 
@@ -3368,17 +3368,17 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 
 COMMAND_HANDLER(xscale_handle_trace_image_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: xscale trace_image &lt;file&gt; [base address] [type]&quot;);
+		command_print(CMD_CTX, &quot;usage: xscale trace_image &lt;file&gt; [base address] [type]&quot;);
 		return ERROR_OK;
 	}
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -3386,7 +3386,7 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 	{
 		image_close(xscale-&gt;trace.image);
 		free(xscale-&gt;trace.image);
-		command_print(cmd_ctx, &quot;previously loaded image found and closed&quot;);
+		command_print(CMD_CTX, &quot;previously loaded image found and closed&quot;);
 	}
 
 	xscale-&gt;trace.image = malloc(sizeof(struct image));
@@ -3416,25 +3416,25 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 
 COMMAND_HANDLER(xscale_handle_dump_trace_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	struct xscale_trace_data *trace_data;
 	struct fileio file;
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: xscale dump_trace &lt;file&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: xscale dump_trace &lt;file&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -3442,7 +3442,7 @@ COMMAND_HANDLER(xscale_handle_dump_trace_command)
 
 	if (!trace_data)
 	{
-		command_print(cmd_ctx, &quot;no trace data collected&quot;);
+		command_print(CMD_CTX, &quot;no trace data collected&quot;);
 		return ERROR_OK;
 	}
 
@@ -3473,32 +3473,32 @@ COMMAND_HANDLER(xscale_handle_dump_trace_command)
 
 COMMAND_HANDLER(xscale_handle_analyze_trace_buffer_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
-	xscale_analyze_trace(target, cmd_ctx);
+	xscale_analyze_trace(target, CMD_CTX);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(xscale_handle_cp15)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 	uint32_t reg_no = 0;
@@ -3534,7 +3534,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 			reg_no = XSCALE_CPACCESS;
 			break;
 		default:
-			command_print(cmd_ctx, &quot;invalid register number&quot;);
+			command_print(CMD_CTX, &quot;invalid register number&quot;);
 			return ERROR_INVALID_ARGUMENTS;
 		}
 		reg = &amp;xscale-&gt;reg_cache-&gt;reg_list[reg_no];
@@ -3547,7 +3547,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 		/* read cp15 control register */
 		xscale_get_reg(reg);
 		value = buf_get_u32(reg-&gt;value, 0, 32);
-		command_print(cmd_ctx, &quot;%s (/%i): 0x%&quot; PRIx32 &quot;&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
+		command_print(CMD_CTX, &quot;%s (/%i): 0x%&quot; PRIx32 &quot;&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
 	}
 	else if (CMD_ARGC == 2)
 	{
@@ -3568,7 +3568,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;usage: cp15 [register]&lt;, [value]&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: cp15 [register]&lt;, [value]&gt;&quot;);
 	}
 
 	return ERROR_OK;
diff --git a/src/xsvf/xsvf.c b/src/xsvf/xsvf.c
index 1fe0b86..9af9767 100644
--- a/src/xsvf/xsvf.c
+++ b/src/xsvf/xsvf.c
@@ -221,7 +221,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;usage: xsvf &lt;device#|plain&gt; &lt;file&gt; [&lt;variant&gt;] [quiet]&quot;);
+		command_print(CMD_CTX, &quot;usage: xsvf &lt;device#|plain&gt; &lt;file&gt; [&lt;variant&gt;] [quiet]&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -233,14 +233,14 @@ COMMAND_HANDLER(handle_xsvf_command)
 		tap = jtag_tap_by_string(CMD_ARGV[0]);
 		if (!tap)
 		{
-			command_print(cmd_ctx, &quot;Tap: %s unknown&quot;, CMD_ARGV[0]);
+			command_print(CMD_CTX, &quot;Tap: %s unknown&quot;, CMD_ARGV[0]);
 			return ERROR_FAIL;
 		}
 	}
 
 	if ((xsvf_fd = open(filename, O_RDONLY)) &lt; 0)
 	{
-		command_print(cmd_ctx, &quot;file \&quot;%s\&quot; not found&quot;, filename);
+		command_print(CMD_CTX, &quot;file \&quot;%s\&quot; not found&quot;, filename);
 		return ERROR_FAIL;
 	}
 
@@ -1012,7 +1012,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 
 	if (tdo_mismatch)
 	{
-		command_print(cmd_ctx, &quot;TDO mismatch, somewhere near offset %lu in xsvf file, aborting&quot;,
+		command_print(CMD_CTX, &quot;TDO mismatch, somewhere near offset %lu in xsvf file, aborting&quot;,
 					  file_offset);
 
 
@@ -1022,7 +1022,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 	if (unsupported)
 	{
 		off_t offset = lseek(xsvf_fd, 0, SEEK_CUR) - 1;
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;unsupported xsvf command (0x%02X) at offset %jd, aborting&quot;,
 				uc, (intmax_t)offset);
 		return ERROR_FAIL;
@@ -1030,7 +1030,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 
 	if (do_abort)
 	{
-		command_print(cmd_ctx, &quot;premature end of xsvf file detected, aborting&quot;);
+		command_print(CMD_CTX, &quot;premature end of xsvf file detected, aborting&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1045,7 +1045,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 
 	close(xsvf_fd);
 
-	command_print(cmd_ctx, &quot;XSVF file programmed successfully&quot;);
+	command_print(CMD_CTX, &quot;XSVF file programmed successfully&quot;);
 
 	return ERROR_OK;
 }

commit 23402315ce01071f30d7ec0c5ca7563ce41f1cc6
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 15 08:15:59 2009 -0800

    command_handler: change 'args' to CMD_ARGV
    
    This patch converts all instances of 'args' in COMMAND_HANDLER routines
    to use CMD_ARGV macro.

diff --git a/src/flash/at91sam3.c b/src/flash/at91sam3.c
index 54e60bf..4cf4d20 100644
--- a/src/flash/at91sam3.c
+++ b/src/flash/at91sam3.c
@@ -2378,17 +2378,17 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 		who = -1;
 		break;
 	case 2:
-		if ((0 == strcmp(args[0], &quot;show&quot;)) &amp;&amp; (0 == strcmp(args[1], &quot;all&quot;))) {
+		if ((0 == strcmp(CMD_ARGV[0], &quot;show&quot;)) &amp;&amp; (0 == strcmp(CMD_ARGV[1], &quot;all&quot;))) {
 			who = -1;
 		} else {
 			uint32_t v32;
-			COMMAND_PARSE_NUMBER(u32, args[1], v32);
+			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], v32);
 			who = v32;
 		}
 		break;
 	}
 
-	if (0 == strcmp(&quot;show&quot;, args[0])) {
+	if (0 == strcmp(&quot;show&quot;, CMD_ARGV[0])) {
 		if (who == -1) {
 		showall:
 			r = ERROR_OK;
@@ -2416,13 +2416,13 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	if (0 == strcmp(&quot;set&quot;, args[0])) {
+	if (0 == strcmp(&quot;set&quot;, CMD_ARGV[0])) {
 		r = FLASHD_SetGPNVM(&amp;(pChip-&gt;details.bank[0]), who);
-	} else if ((0 == strcmp(&quot;clr&quot;, args[0])) ||
-			   (0 == strcmp(&quot;clear&quot;, args[0]))) { // quietly accept both
+	} else if ((0 == strcmp(&quot;clr&quot;, CMD_ARGV[0])) ||
+			   (0 == strcmp(&quot;clear&quot;, CMD_ARGV[0]))) { // quietly accept both
 		r = FLASHD_ClrGPNVM(&amp;(pChip-&gt;details.bank[0]), who);
 	} else {
-		command_print(cmd_ctx, &quot;Unkown command: %s&quot;, args[0]);
+		command_print(cmd_ctx, &quot;Unkown command: %s&quot;, CMD_ARGV[0]);
 		r = ERROR_COMMAND_SYNTAX_ERROR;
 	}
 	return r;
@@ -2446,7 +2446,7 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 	{
 		// set
 		uint32_t v;
-		COMMAND_PARSE_NUMBER(u32, args[0], v);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], v);
 		if (v &gt; 200000) {
 			// absurd slow clock of 200Khz?
 			command_print(cmd_ctx,&quot;Absurd/illegal slow clock freq: %d\n&quot;, (int)(v));
diff --git a/src/flash/at91sam7.c b/src/flash/at91sam7.c
index 193bfd3..d23d2b0 100644
--- a/src/flash/at91sam7.c
+++ b/src/flash/at91sam7.c
@@ -749,20 +749,20 @@ FLASH_BANK_COMMAND_HANDLER(at91sam7_flash_bank_command)
 		return ERROR_OK;
 	}
 
-	COMMAND_PARSE_NUMBER(u32, args[1], base_address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], base_address);
 
-	COMMAND_PARSE_NUMBER(int, args[3], chip_width);
-	COMMAND_PARSE_NUMBER(int, args[4], bus_width);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[3], chip_width);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[4], bus_width);
 
-	COMMAND_PARSE_NUMBER(int, args[8], banks_num);
-	COMMAND_PARSE_NUMBER(int, args[9], num_sectors);
-	COMMAND_PARSE_NUMBER(u16, args[10], pages_per_sector);
-	COMMAND_PARSE_NUMBER(u16, args[11], page_size);
-	COMMAND_PARSE_NUMBER(u16, args[12], num_nvmbits);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[8], banks_num);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[9], num_sectors);
+	COMMAND_PARSE_NUMBER(u16, CMD_ARGV[10], pages_per_sector);
+	COMMAND_PARSE_NUMBER(u16, CMD_ARGV[11], page_size);
+	COMMAND_PARSE_NUMBER(u16, CMD_ARGV[12], num_nvmbits);
 
 	if (CMD_ARGC == 14) {
 		unsigned long freq;
-		COMMAND_PARSE_NUMBER(ulong, args[13], freq);
+		COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[13], freq);
 		ext_freq = freq * 1000;
 		at91sam7_info-&gt;ext_freq = ext_freq;
 	}
@@ -774,8 +774,8 @@ FLASH_BANK_COMMAND_HANDLER(at91sam7_flash_bank_command)
 		return ERROR_OK;
 	}
 
-	target_name = calloc(strlen(args[7]) + 1, sizeof(char));
-	strcpy(target_name, args[7]);
+	target_name = calloc(strlen(CMD_ARGV[7]) + 1, sizeof(char));
+	strcpy(target_name, CMD_ARGV[7]);
 
 	/* calculate bank size  */
 	bank_size = num_sectors * pages_per_sector * page_size;
@@ -1120,7 +1120,7 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 	}
 	if (strcmp(bank-&gt;driver-&gt;name, &quot;at91sam7&quot;))
 	{
-		command_print(cmd_ctx, &quot;not an at91sam7 flash bank '%s'&quot;, args[0]);
+		command_print(cmd_ctx, &quot;not an at91sam7 flash bank '%s'&quot;, CMD_ARGV[0]);
 		return ERROR_FLASH_BANK_INVALID;
 	}
 	if (bank-&gt;target-&gt;state != TARGET_HALTED)
@@ -1129,11 +1129,11 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 		return ERROR_TARGET_NOT_HALTED;
 	}
 
-	if (strcmp(args[1], &quot;set&quot;) == 0)
+	if (strcmp(CMD_ARGV[1], &quot;set&quot;) == 0)
 	{
 		flashcmd = SGPB;
 	}
-	else if (strcmp(args[1], &quot;clear&quot;) == 0)
+	else if (strcmp(CMD_ARGV[1], &quot;clear&quot;) == 0)
 	{
 		flashcmd = CGPB;
 	}
@@ -1152,10 +1152,10 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 		}
 	}
 
-	COMMAND_PARSE_NUMBER(int, args[0], bit);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[0], bit);
 	if ((bit &lt; 0) || (bit &gt;= at91sam7_info-&gt;num_nvmbits))
 	{
-		command_print(cmd_ctx, &quot;gpnvm bit '#%s' is out of bounds for target %s&quot;, args[0], at91sam7_info-&gt;target_name);
+		command_print(cmd_ctx, &quot;gpnvm bit '#%s' is out of bounds for target %s&quot;, CMD_ARGV[0], at91sam7_info-&gt;target_name);
 		return ERROR_OK;
 	}
 
diff --git a/src/flash/cfi.c b/src/flash/cfi.c
index c68fb73..59c9c6c 100644
--- a/src/flash/cfi.c
+++ b/src/flash/cfi.c
@@ -613,8 +613,8 @@ FLASH_BANK_COMMAND_HANDLER(cfi_flash_bank_command)
 	}
 
 	uint16_t chip_width, bus_width;
-	COMMAND_PARSE_NUMBER(u16, args[3], bus_width);
-	COMMAND_PARSE_NUMBER(u16, args[4], chip_width);
+	COMMAND_PARSE_NUMBER(u16, CMD_ARGV[3], bus_width);
+	COMMAND_PARSE_NUMBER(u16, CMD_ARGV[4], chip_width);
 
 	if ((chip_width &gt; CFI_MAX_CHIP_WIDTH)
 			|| (bus_width &gt; CFI_MAX_BUS_WIDTH))
@@ -635,11 +635,11 @@ FLASH_BANK_COMMAND_HANDLER(cfi_flash_bank_command)
 
 	for (unsigned i = 6; i &lt; CMD_ARGC; i++)
 	{
-		if (strcmp(args[i], &quot;x16_as_x8&quot;) == 0)
+		if (strcmp(CMD_ARGV[i], &quot;x16_as_x8&quot;) == 0)
 		{
 			cfi_info-&gt;x16_as_x8 = 1;
 		}
-		else if (strcmp(args[i], &quot;jedec_probe&quot;) == 0)
+		else if (strcmp(CMD_ARGV[i], &quot;jedec_probe&quot;) == 0)
 		{
 			cfi_info-&gt;jedec_probe = 1;
 		}
diff --git a/src/flash/davinci_nand.c b/src/flash/davinci_nand.c
index 7c68be7..ebd9ba8 100644
--- a/src/flash/davinci_nand.c
+++ b/src/flash/davinci_nand.c
@@ -648,36 +648,36 @@ NAND_DEVICE_COMMAND_HANDLER(davinci_nand_device_command)
 	if (CMD_ARGC &lt; 5) {
 		LOG_ERROR(&quot;parameters: %s target &quot;
 				&quot;chip_addr hwecc_mode aemif_addr&quot;,
-				args[0]);
+				CMD_ARGV[0]);
 		goto fail;
 	}
 
-	target = get_target(args[1]);
+	target = get_target(CMD_ARGV[1]);
 	if (!target) {
-		LOG_ERROR(&quot;invalid target %s&quot;, args[1]);
+		LOG_ERROR(&quot;invalid target %s&quot;, CMD_ARGV[1]);
 		goto fail;
 	}
 
-	COMMAND_PARSE_NUMBER(ulong, args[2], chip);
+	COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[2], chip);
 	if (chip == 0) {
-		LOG_ERROR(&quot;Invalid NAND chip address %s&quot;, args[2]);
+		LOG_ERROR(&quot;Invalid NAND chip address %s&quot;, CMD_ARGV[2]);
 		goto fail;
 	}
 
-	if (strcmp(args[3], &quot;hwecc1&quot;) == 0)
+	if (strcmp(CMD_ARGV[3], &quot;hwecc1&quot;) == 0)
 		eccmode = HWECC1;
-	else if (strcmp(args[3], &quot;hwecc4&quot;) == 0)
+	else if (strcmp(CMD_ARGV[3], &quot;hwecc4&quot;) == 0)
 		eccmode = HWECC4;
-	else if (strcmp(args[3], &quot;hwecc4_infix&quot;) == 0)
+	else if (strcmp(CMD_ARGV[3], &quot;hwecc4_infix&quot;) == 0)
 		eccmode = HWECC4_INFIX;
 	else {
-		LOG_ERROR(&quot;Invalid ecc mode %s&quot;, args[3]);
+		LOG_ERROR(&quot;Invalid ecc mode %s&quot;, CMD_ARGV[3]);
 		goto fail;
 	}
 
-	COMMAND_PARSE_NUMBER(ulong, args[4], aemif);
+	COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[4], aemif);
 	if (aemif == 0) {
-		LOG_ERROR(&quot;Invalid AEMIF controller address %s&quot;, args[4]);
+		LOG_ERROR(&quot;Invalid AEMIF controller address %s&quot;, CMD_ARGV[4]);
 		goto fail;
 	}
 
diff --git a/src/flash/ecos.c b/src/flash/ecos.c
index 8d2d3ee..863c12b 100644
--- a/src/flash/ecos.c
+++ b/src/flash/ecos.c
@@ -122,7 +122,7 @@ FLASH_BANK_COMMAND_HANDLER(ecosflash_flash_bank_command)
 		exit(-1);
 	}
 	bank-&gt;driver_priv = info;
-	info-&gt;driverPath = strdup(args[6]);
+	info-&gt;driverPath = strdup(CMD_ARGV[6]);
 
 	/* eCos flash sector sizes are not exposed to OpenOCD, use 0x10000 as
 	 * a way to improve impedance match between OpenOCD and eCos flash
@@ -141,10 +141,10 @@ FLASH_BANK_COMMAND_HANDLER(ecosflash_flash_bank_command)
 		bank-&gt;sectors[i].is_protected = 0;
 	}
 
-	info-&gt;target = get_target(args[5]);
+	info-&gt;target = get_target(CMD_ARGV[5]);
 	if (info-&gt;target == NULL)
 	{
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[5]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[5]);
 		return ERROR_FAIL;
 	}
 	return ERROR_OK;
diff --git a/src/flash/faux.c b/src/flash/faux.c
index 54acf75..558d7b0 100644
--- a/src/flash/faux.c
+++ b/src/flash/faux.c
@@ -76,10 +76,10 @@ FLASH_BANK_COMMAND_HANDLER(faux_flash_bank_command)
 		bank-&gt;sectors[i].is_protected = 0;
 	}
 
-	info-&gt;target = get_target(args[5]);
+	info-&gt;target = get_target(CMD_ARGV[5]);
 	if (info-&gt;target == NULL)
 	{
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[5]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[5]);
 		free(info-&gt;memory);
 		free(info);
 		return ERROR_FAIL;
diff --git a/src/flash/flash.c b/src/flash/flash.c
index 7402772..99e71d7 100644
--- a/src/flash/flash.c
+++ b/src/flash/flash.c
@@ -201,14 +201,14 @@ struct flash_bank *get_flash_bank_by_num(int num)
 COMMAND_HELPER(flash_command_get_bank_by_num,
 	unsigned name_index, struct flash_bank **bank)
 {
+	const char *name = CMD_ARGV[name_index];
 	unsigned bank_num;
-	COMMAND_PARSE_NUMBER(uint, args[name_index], bank_num);
+	COMMAND_PARSE_NUMBER(uint, name, bank_num);
 
 	*bank = get_flash_bank_by_num(bank_num);
 	if (!*bank)
 	{
-		command_print(cmd_ctx,
-			&quot;flash bank '#%u' not found&quot;, bank_num);
+		command_print(cmd_ctx, &quot;flash bank '%s' not found&quot;, name);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	return ERROR_OK;
@@ -227,15 +227,15 @@ COMMAND_HANDLER(handle_flash_bank_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	if ((target = get_target(args[5])) == NULL)
+	if ((target = get_target(CMD_ARGV[5])) == NULL)
 	{
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[5]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[5]);
 		return ERROR_FAIL;
 	}
 
 	for (i = 0; flash_drivers[i]; i++)
 	{
-		if (strcmp(args[0], flash_drivers[i]-&gt;name) != 0)
+		if (strcmp(CMD_ARGV[0], flash_drivers[i]-&gt;name) != 0)
 			continue;
 
 		struct flash_bank *p, *c;
@@ -243,7 +243,7 @@ COMMAND_HANDLER(handle_flash_bank_command)
 		/* register flash specific commands */
 		if (flash_drivers[i]-&gt;register_commands(cmd_ctx) != ERROR_OK)
 		{
-			LOG_ERROR(&quot;couldn't register '%s' commands&quot;, args[0]);
+			LOG_ERROR(&quot;couldn't register '%s' commands&quot;, CMD_ARGV[0]);
 			return ERROR_FAIL;
 		}
 
@@ -251,10 +251,10 @@ COMMAND_HANDLER(handle_flash_bank_command)
 		c-&gt;target = target;
 		c-&gt;driver = flash_drivers[i];
 		c-&gt;driver_priv = NULL;
-		COMMAND_PARSE_NUMBER(u32, args[1], c-&gt;base);
-		COMMAND_PARSE_NUMBER(u32, args[2], c-&gt;size);
-		COMMAND_PARSE_NUMBER(int, args[3], c-&gt;chip_width);
-		COMMAND_PARSE_NUMBER(int, args[4], c-&gt;bus_width);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], c-&gt;base);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], c-&gt;size);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[3], c-&gt;chip_width);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[4], c-&gt;bus_width);
 		c-&gt;num_sectors = 0;
 		c-&gt;sectors = NULL;
 		c-&gt;next = NULL;
@@ -262,7 +262,7 @@ COMMAND_HANDLER(handle_flash_bank_command)
 		retval = CALL_COMMAND_HANDLER(flash_drivers[i]-&gt;flash_bank_command, c);
 		if (ERROR_OK != retval)
 		{
-			LOG_ERROR(&quot;'%s' driver rejected flash bank at 0x%8.8&quot; PRIx32 , args[0], c-&gt;base);
+			LOG_ERROR(&quot;'%s' driver rejected flash bank at 0x%8.8&quot; PRIx32 , CMD_ARGV[0], c-&gt;base);
 			free(c);
 			return retval;
 		}
@@ -289,7 +289,7 @@ COMMAND_HANDLER(handle_flash_bank_command)
 	/* no matching flash driver found */
 	if (!found)
 	{
-		LOG_ERROR(&quot;flash driver '%s' not found&quot;, args[0]);
+		LOG_ERROR(&quot;flash driver '%s' not found&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
@@ -307,7 +307,7 @@ COMMAND_HANDLER(handle_flash_info_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned bank_nr;
-	COMMAND_PARSE_NUMBER(uint, args[0], bank_nr);
+	COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], bank_nr);
 
 	for (p = flash_banks; p; p = p-&gt;next, i++)
 	{
@@ -368,7 +368,7 @@ COMMAND_HANDLER(handle_flash_probe_command)
 	}
 
 	unsigned bank_nr;
-	COMMAND_PARSE_NUMBER(uint, args[0], bank_nr);
+	COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], bank_nr);
 	struct flash_bank *p = get_flash_bank_by_num_noprobe(bank_nr);
 	if (p)
 	{
@@ -379,17 +379,17 @@ COMMAND_HANDLER(handle_flash_probe_command)
 		else if (retval == ERROR_FLASH_BANK_INVALID)
 		{
 			command_print(cmd_ctx, &quot;probing failed for flash bank '#%s' at 0x%8.8&quot; PRIx32,
-						  args[0], p-&gt;base);
+						  CMD_ARGV[0], p-&gt;base);
 		}
 		else
 		{
 			command_print(cmd_ctx, &quot;unknown error when probing flash bank '#%s' at 0x%8.8&quot; PRIx32,
-						  args[0], p-&gt;base);
+						  CMD_ARGV[0], p-&gt;base);
 		}
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;flash bank '#%s' is out of bounds&quot;, args[0]);
+		command_print(cmd_ctx, &quot;flash bank '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 	}
 
 	return ERROR_OK;
@@ -415,7 +415,7 @@ COMMAND_HANDLER(handle_flash_erase_check_command)
 	else
 	{
 		command_print(cmd_ctx, &quot;unknown error when checking erase state of flash bank #%s at 0x%8.8&quot; PRIx32,
-			args[0], p-&gt;base);
+			CMD_ARGV[0], p-&gt;base);
 	}
 
 	for (j = 0; j &lt; p-&gt;num_sectors; j++)
@@ -453,8 +453,8 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 	if (CMD_ARGC != 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	COMMAND_PARSE_NUMBER(int, args[0], address);
-	COMMAND_PARSE_NUMBER(int, args[1], length);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[0], address);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], length);
 	if (length &lt;= 0)
 	{
 		command_print(cmd_ctx, &quot;Length must be &gt;0&quot;);
@@ -501,11 +501,11 @@ COMMAND_HANDLER(handle_flash_protect_check_command)
 	}
 	else if (retval == ERROR_FLASH_OPERATION_FAILED)
 	{
-		command_print(cmd_ctx, &quot;checking protection state failed (possibly unsupported) by flash #%s at 0x%8.8&quot; PRIx32, args[0], p-&gt;base);
+		command_print(cmd_ctx, &quot;checking protection state failed (possibly unsupported) by flash #%s at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when checking protection state of flash bank '#%s' at 0x%8.8&quot; PRIx32, args[0], p-&gt;base);
+		command_print(cmd_ctx, &quot;unknown error when checking protection state of flash bank '#%s' at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
 	}
 
 	return ERROR_OK;
@@ -538,16 +538,16 @@ COMMAND_HANDLER(handle_flash_erase_command)
 	uint32_t first;
 	uint32_t last;
 
-	COMMAND_PARSE_NUMBER(u32, args[0], bank_nr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], bank_nr);
 	struct flash_bank *p = get_flash_bank_by_num(bank_nr);
 	if (!p)
 		return ERROR_OK;
 
-	COMMAND_PARSE_NUMBER(u32, args[1], first);
-	if (strcmp(args[2], &quot;last&quot;) == 0)
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], first);
+	if (strcmp(CMD_ARGV[2], &quot;last&quot;) == 0)
 		last = p-&gt;num_sectors - 1;
 	else
-		COMMAND_PARSE_NUMBER(u32, args[2], last);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], last);
 
 	int retval;
 	if ((retval = flash_check_sector_parameters(cmd_ctx,
@@ -579,20 +579,20 @@ COMMAND_HANDLER(handle_flash_protect_command)
 	uint32_t last;
 	int set;
 
-	COMMAND_PARSE_NUMBER(u32, args[0], bank_nr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], bank_nr);
 	struct flash_bank *p = get_flash_bank_by_num(bank_nr);
 	if (!p)
 		return ERROR_OK;
 
-	COMMAND_PARSE_NUMBER(u32, args[1], first);
-	if (strcmp(args[2], &quot;last&quot;) == 0)
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], first);
+	if (strcmp(CMD_ARGV[2], &quot;last&quot;) == 0)
 		last = p-&gt;num_sectors - 1;
 	else
-		COMMAND_PARSE_NUMBER(u32, args[2], last);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], last);
 
-	if (strcmp(args[3], &quot;on&quot;) == 0)
+	if (strcmp(CMD_ARGV[3], &quot;on&quot;) == 0)
 		set = 1;
-	else if (strcmp(args[3], &quot;off&quot;) == 0)
+	else if (strcmp(CMD_ARGV[3], &quot;off&quot;) == 0)
 		set = 0;
 	else
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -633,16 +633,16 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 
 	for (;;)
 	{
-		if (strcmp(args[0], &quot;erase&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;erase&quot;) == 0)
 		{
 			auto_erase = 1;
-			args++;
+			CMD_ARGV++;
 			CMD_ARGC--;
 			command_print(cmd_ctx, &quot;auto erase enabled&quot;);
-		} else if (strcmp(args[0], &quot;unlock&quot;) == 0)
+		} else if (strcmp(CMD_ARGV[0], &quot;unlock&quot;) == 0)
 		{
 			auto_unlock = true;
-			args++;
+			CMD_ARGV++;
 			CMD_ARGC--;
 			command_print(cmd_ctx, &quot;auto unlock enabled&quot;);
 		} else
@@ -668,7 +668,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 	if (CMD_ARGC &gt;= 2)
 	{
 		image.base_address_set = 1;
-		COMMAND_PARSE_NUMBER(int, args[1], image.base_address);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], image.base_address);
 	}
 	else
 	{
@@ -678,7 +678,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 
 	image.start_address_set = 0;
 
-	retval = image_open(&amp;image, args[0], (CMD_ARGC == 3) ? args[2] : NULL);
+	retval = image_open(&amp;image, CMD_ARGV[0], (CMD_ARGC == 3) ? CMD_ARGV[2] : NULL);
 	if (retval != ERROR_OK)
 	{
 		return retval;
@@ -694,7 +694,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
 		command_print(cmd_ctx, &quot;wrote %&quot; PRIu32 &quot; byte from file %s &quot;
-				&quot;in %fs (%0.3f kb/s)&quot;, written, args[0],
+				&quot;in %fs (%0.3f kb/s)&quot;, written, CMD_ARGV[0],
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, written));
 	}
 
@@ -721,9 +721,9 @@ COMMAND_HANDLER(handle_flash_fill_command)
 	if (CMD_ARGC != 3)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	COMMAND_PARSE_NUMBER(u32, args[0], address);
-	COMMAND_PARSE_NUMBER(u32, args[1], pattern);
-	COMMAND_PARSE_NUMBER(u32, args[2], count);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], pattern);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], count);
 
 	if (count == 0)
 		return ERROR_OK;
@@ -824,9 +824,9 @@ COMMAND_HANDLER(handle_flash_write_bank_command)
 	if (ERROR_OK != retval)
 		return retval;
 
-	COMMAND_PARSE_NUMBER(u32, args[2], offset);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], offset);
 
-	if (fileio_open(&amp;fileio, args[1], FILEIO_READ, FILEIO_BINARY) != ERROR_OK)
+	if (fileio_open(&amp;fileio, CMD_ARGV[1], FILEIO_READ, FILEIO_BINARY) != ERROR_OK)
 	{
 		return ERROR_OK;
 	}
@@ -849,7 +849,7 @@ COMMAND_HANDLER(handle_flash_write_bank_command)
 	{
 		command_print(cmd_ctx, &quot;wrote %zu byte from file %s to flash bank %u&quot;
 				&quot; at offset 0x%8.8&quot; PRIx32 &quot; in %fs (%0.3f kb/s)&quot;,
-				fileio.size, args[1], p-&gt;bank_number, offset,
+				fileio.size, CMD_ARGV[1], p-&gt;bank_number, offset,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, fileio.size));
 	}
 
diff --git a/src/flash/flash.h b/src/flash/flash.h
index df5b0c9..23a7b81 100644
--- a/src/flash/flash.h
+++ b/src/flash/flash.h
@@ -105,21 +105,21 @@ struct flash_driver
 	 * layer when this routine is called, and the driver can store
 	 * additional information in its struct flash_bank::driver_priv field.
 	 *
-	 * The args are: @par
+	 * The CMD_ARGV are: @par
 	 * @code
-	 * args[0] = bank
-	 * args[1] = drivername {name above}
-	 * args[2] = baseaddress
-	 * args[3] = lengthbytes
-	 * args[4] = chip_width_in bytes
-	 * args[5] = bus_width_bytes
-	 * args[6] = driver-specific parameters
+	 * CMD_ARGV[0] = bank
+	 * CMD_ARGV[1] = drivername {name above}
+	 * CMD_ARGV[2] = baseaddress
+	 * CMD_ARGV[3] = lengthbytes
+	 * CMD_ARGV[4] = chip_width_in bytes
+	 * CMD_ARGV[5] = bus_width_bytes
+	 * CMD_ARGV[6] = driver-specific parameters
 	 * @endcode
 	 *
-	 * For example, args[4] = 16 bit flash, args[5] = 32bit bus.
+	 * For example, CMD_ARGV[4] = 16 bit flash, CMD_ARGV[5] = 32bit bus.
 	 *
 	 * If extra arguments are provided (@a CMD_ARGC &gt; 6), they will
-	 * start in @a args[6].  These can be used to implement
+	 * start in @a CMD_ARGV[6].  These can be used to implement
 	 * driver-specific extensions.
 	 *
 	 * @returns ERROR_OK if successful; otherwise, an error code.
diff --git a/src/flash/lpc2000.c b/src/flash/lpc2000.c
index 60d909f..6378130 100644
--- a/src/flash/lpc2000.c
+++ b/src/flash/lpc2000.c
@@ -433,7 +433,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2000_flash_bank_command)
 	lpc2000_info = malloc(sizeof(struct lpc2000_flash_bank));
 	bank-&gt;driver_priv = lpc2000_info;
 
-	if (strcmp(args[6], &quot;lpc2000_v1&quot;) == 0)
+	if (strcmp(CMD_ARGV[6], &quot;lpc2000_v1&quot;) == 0)
 	{
 		lpc2000_info-&gt;variant = lpc2000_v1;
 		lpc2000_info-&gt;cmd51_dst_boundary = 512;
@@ -441,7 +441,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2000_flash_bank_command)
 		lpc2000_info-&gt;cmd51_can_8192b = 1;
 		lpc2000_info-&gt;checksum_vector = 5;
 	}
-	else if (strcmp(args[6], &quot;lpc2000_v2&quot;) == 0)
+	else if (strcmp(CMD_ARGV[6], &quot;lpc2000_v2&quot;) == 0)
 	{
 		lpc2000_info-&gt;variant = lpc2000_v2;
 		lpc2000_info-&gt;cmd51_dst_boundary = 256;
@@ -449,7 +449,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2000_flash_bank_command)
 		lpc2000_info-&gt;cmd51_can_8192b = 0;
 		lpc2000_info-&gt;checksum_vector = 5;
 	}
-	else if (strcmp(args[6], &quot;lpc1700&quot;) == 0)
+	else if (strcmp(CMD_ARGV[6], &quot;lpc1700&quot;) == 0)
 	{
 		lpc2000_info-&gt;variant = lpc1700;
 		lpc2000_info-&gt;cmd51_dst_boundary = 256;
@@ -459,19 +459,19 @@ FLASH_BANK_COMMAND_HANDLER(lpc2000_flash_bank_command)
 	}
 	else
 	{
-		LOG_ERROR(&quot;unknown LPC2000 variant: %s&quot;, args[6]);
+		LOG_ERROR(&quot;unknown LPC2000 variant: %s&quot;, CMD_ARGV[6]);
 		free(lpc2000_info);
 		return ERROR_FLASH_BANK_INVALID;
 	}
 
 	lpc2000_info-&gt;iap_working_area = NULL;
-	COMMAND_PARSE_NUMBER(u32, args[7], lpc2000_info-&gt;cclk);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[7], lpc2000_info-&gt;cclk);
 	lpc2000_info-&gt;calc_checksum = 0;
 	lpc2000_build_sector_list(bank);
 
 	if (CMD_ARGC &gt;= 9)
 	{
-		if (strcmp(args[8], &quot;calc_checksum&quot;) == 0)
+		if (strcmp(CMD_ARGV[8], &quot;calc_checksum&quot;) == 0)
 			lpc2000_info-&gt;calc_checksum = 1;
 	}
 
diff --git a/src/flash/lpc288x.c b/src/flash/lpc288x.c
index 2ad5014..446fc9d 100644
--- a/src/flash/lpc288x.c
+++ b/src/flash/lpc288x.c
@@ -180,7 +180,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc288x_flash_bank_command)
 
 	/* part wasn't probed for info yet */
 	lpc288x_info-&gt;cidr = 0;
-	COMMAND_PARSE_NUMBER(u32, args[6], lpc288x_info-&gt;cclk);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[6], lpc288x_info-&gt;cclk);
 
 	return ERROR_OK;
 }
diff --git a/src/flash/lpc2900.c b/src/flash/lpc2900.c
index 67a510e..98b13bf 100644
--- a/src/flash/lpc2900.c
+++ b/src/flash/lpc2900.c
@@ -623,7 +623,7 @@ COMMAND_HANDLER(lpc2900_handle_read_custom_command)
 
 	/* Try and open the file */
 	struct fileio fileio;
-	const char *filename = args[1];
+	const char *filename = CMD_ARGV[1];
 	int ret = fileio_open( &amp;fileio, filename, FILEIO_WRITE, FILEIO_BINARY );
 	if( ret != ERROR_OK )
 	{
@@ -668,7 +668,7 @@ COMMAND_HANDLER(lpc2900_handle_password_command)
 
 #define ISS_PASSWORD &quot;I_know_what_I_am_doing&quot;
 
-	lpc2900_info-&gt;risky = !strcmp( args[1], ISS_PASSWORD );
+	lpc2900_info-&gt;risky = !strcmp( CMD_ARGV[1], ISS_PASSWORD );
 
 	if( !lpc2900_info-&gt;risky )
 	{
@@ -723,8 +723,8 @@ COMMAND_HANDLER(lpc2900_handle_write_custom_command)
 	image.base_address = 0;
 	image.start_address_set = 0;
 
-	const char *filename = args[1];
-	const char *type = (CMD_ARGC &gt;= 3) ? args[2] : NULL;
+	const char *filename = CMD_ARGV[1];
+	const char *type = (CMD_ARGC &gt;= 3) ? CMD_ARGV[2] : NULL;
 	retval = image_open(&amp;image, filename, type);
 	if (retval != ERROR_OK)
 	{
@@ -823,8 +823,8 @@ COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
 
 	/* Read sector range, and do a sanity check. */
 	int first, last;
-	COMMAND_PARSE_NUMBER(int, args[1], first);
-	COMMAND_PARSE_NUMBER(int, args[2], last);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], first);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[2], last);
 	if( (first &gt;= bank-&gt;num_sectors) ||
 	    (last &gt;= bank-&gt;num_sectors) ||
 	    (first &gt; last) )
@@ -1034,7 +1034,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2900_flash_bank_command)
 	 * (if clock too slow), or for erase time (clock too fast).
 	 */
 	uint32_t clk_sys_fmc;
-	COMMAND_PARSE_NUMBER(u32, args[6], clk_sys_fmc);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[6], clk_sys_fmc);
 	lpc2900_info-&gt;clk_sys_fmc = clk_sys_fmc * 1000;
 
 	uint32_t clock_limit;
diff --git a/src/flash/lpc3180_nand_controller.c b/src/flash/lpc3180_nand_controller.c
index d7cbe38..1de48f4 100644
--- a/src/flash/lpc3180_nand_controller.c
+++ b/src/flash/lpc3180_nand_controller.c
@@ -37,15 +37,15 @@ NAND_DEVICE_COMMAND_HANDLER(lpc3180_nand_device_command)
 		return ERROR_FLASH_BANK_INVALID;
 	}
 
-	struct target *target = get_target(args[1]);
+	struct target *target = get_target(CMD_ARGV[1]);
 	if (NULL == target)
 	{
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[1]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[1]);
 		return ERROR_NAND_DEVICE_INVALID;
 	}
 
 	uint32_t osc_freq;
-	COMMAND_PARSE_NUMBER(u32, args[2], osc_freq);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], osc_freq);
 
 	struct lpc3180_nand_controller *lpc3180_info;
 	lpc3180_info = malloc(sizeof(struct lpc3180_nand_controller));
@@ -842,11 +842,11 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 	}
 
 	unsigned num;
-	COMMAND_PARSE_NUMBER(uint, args[1], num);
+	COMMAND_PARSE_NUMBER(uint, CMD_ARGV[1], num);
 	struct nand_device *nand = get_nand_device_by_num(num);
 	if (!nand)
 	{
-		command_print(cmd_ctx, &quot;nand device '#%s' is out of bounds&quot;, args[0]);
+		command_print(cmd_ctx, &quot;nand device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -854,11 +854,11 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 
 	if (CMD_ARGC == 2)
 	{
-		if (strcmp(args[1], &quot;mlc&quot;) == 0)
+		if (strcmp(CMD_ARGV[1], &quot;mlc&quot;) == 0)
 		{
 			lpc3180_info-&gt;selected_controller = LPC3180_MLC_CONTROLLER;
 		}
-		else if (strcmp(args[1], &quot;slc&quot;) == 0)
+		else if (strcmp(CMD_ARGV[1], &quot;slc&quot;) == 0)
 		{
 			lpc3180_info-&gt;selected_controller = LPC3180_SLC_CONTROLLER;
 		}
diff --git a/src/flash/mflash.c b/src/flash/mflash.c
index 6aeeabc..64f332e 100644
--- a/src/flash/mflash.c
+++ b/src/flash/mflash.c
@@ -714,9 +714,9 @@ COMMAND_HANDLER(mg_write_cmd)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	COMMAND_PARSE_NUMBER(u32, args[2], address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], address);
 
-	ret = fileio_open(&amp;fileio, args[1], FILEIO_READ, FILEIO_BINARY);
+	ret = fileio_open(&amp;fileio, CMD_ARGV[1], FILEIO_READ, FILEIO_BINARY);
 	if (ret != ERROR_OK)
 		return ret;
 
@@ -752,7 +752,7 @@ COMMAND_HANDLER(mg_write_cmd)
 	if (duration_measure(&amp;bench) == ERROR_OK)
 	{
 		command_print(cmd_ctx, &quot;wrote %zu byte from file %s &quot;
-				&quot;in %fs (%0.3f kB/s)&quot;, fileio.size, args[1],
+				&quot;in %fs (%0.3f kB/s)&quot;, fileio.size, CMD_ARGV[1],
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, fileio.size));
 	}
 
@@ -779,10 +779,10 @@ COMMAND_HANDLER(mg_dump_cmd)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	COMMAND_PARSE_NUMBER(u32, args[2], address);
-	COMMAND_PARSE_NUMBER(u32, args[3], size);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[3], size);
 
-	ret = fileio_open(&amp;fileio, args[1], FILEIO_WRITE, FILEIO_BINARY);
+	ret = fileio_open(&amp;fileio, CMD_ARGV[1], FILEIO_WRITE, FILEIO_BINARY);
 	if (ret != ERROR_OK)
 		return ret;
 
@@ -819,7 +819,7 @@ COMMAND_HANDLER(mg_dump_cmd)
 	{
 		command_print(cmd_ctx, &quot;dump image (address 0x%8.8&quot; PRIx32 &quot; &quot;
 				&quot;size %&quot; PRIu32 &quot;) to file %s in %fs (%0.3f kB/s)&quot;,
-				address, size, args[1],
+				address, size, CMD_ARGV[1],
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, size));
 	}
 
@@ -1225,17 +1225,17 @@ COMMAND_HANDLER(mg_config_cmd)
 
 	switch (CMD_ARGC) {
 		case 2:
-			if (!strcmp(args[1], &quot;boot&quot;))
+			if (!strcmp(CMD_ARGV[1], &quot;boot&quot;))
 				return mg_boot_config();
-			else if (!strcmp(args[1], &quot;storage&quot;))
+			else if (!strcmp(CMD_ARGV[1], &quot;storage&quot;))
 				return mg_storage_config();
 			else
 				return ERROR_COMMAND_NOTFOUND;
 			break;
 		case 3:
-			if (!strcmp(args[1], &quot;pll&quot;)) {
+			if (!strcmp(CMD_ARGV[1], &quot;pll&quot;)) {
 				unsigned long freq;
-				COMMAND_PARSE_NUMBER(ulong, args[2], freq);
+				COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[2], freq);
 				fin = freq;
 
 				if (fin &gt; MG_PLL_CLK_OUT) {
@@ -1293,30 +1293,30 @@ COMMAND_HANDLER(mg_bank_cmd)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	if ((target = get_target(args[3])) == NULL)
+	if ((target = get_target(CMD_ARGV[3])) == NULL)
 	{
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[3]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[3]);
 		return ERROR_FAIL;
 	}
 
 	mflash_bank = calloc(sizeof(struct mflash_bank), 1);
-	COMMAND_PARSE_NUMBER(u32, args[1], mflash_bank-&gt;base);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], mflash_bank-&gt;base);
 	/// @todo Verify how this parsing should work, then document it.
 	char *str;
-	mflash_bank-&gt;rst_pin.num = strtoul(args[2], &amp;str, 0);
+	mflash_bank-&gt;rst_pin.num = strtoul(CMD_ARGV[2], &amp;str, 0);
 	if (*str)
 		mflash_bank-&gt;rst_pin.port[0] = (uint16_t)tolower(str[0]);
 
 	mflash_bank-&gt;target = target;
 
 	for (i = 0; mflash_gpio[i] ; i++) {
-		if (! strcmp(mflash_gpio[i]-&gt;name, args[0])) {
+		if (! strcmp(mflash_gpio[i]-&gt;name, CMD_ARGV[0])) {
 			mflash_bank-&gt;gpio_drv = mflash_gpio[i];
 		}
 	}
 
 	if (! mflash_bank-&gt;gpio_drv) {
-		LOG_ERROR(&quot;%s is unsupported soc&quot;, args[0]);
+		LOG_ERROR(&quot;%s is unsupported soc&quot;, CMD_ARGV[0]);
 		return ERROR_MG_UNSUPPORTED_SOC;
 	}
 
diff --git a/src/flash/mx3_nand.c b/src/flash/mx3_nand.c
index 49e1758..459e2a6 100644
--- a/src/flash/mx3_nand.c
+++ b/src/flash/mx3_nand.c
@@ -73,10 +73,10 @@ NAND_DEVICE_COMMAND_HANDLER(imx31_nand_device_command)
 
 	nand-&gt;controller_priv = mx3_nf_info;
 
-	mx3_nf_info-&gt;target = get_target (args[1]);
+	mx3_nf_info-&gt;target = get_target (CMD_ARGV[1]);
 	if (mx3_nf_info-&gt;target == NULL)
 	{
-	    LOG_ERROR (&quot;target '%s' not defined&quot;, args[1]);
+	    LOG_ERROR (&quot;target '%s' not defined&quot;, CMD_ARGV[1]);
 	    return ERROR_FAIL;
 	}
 	if (CMD_ARGC &lt; 3)
@@ -89,7 +89,7 @@ NAND_DEVICE_COMMAND_HANDLER(imx31_nand_device_command)
 	*/
 	{
 	int hwecc_needed;
-	hwecc_needed = strcmp (args[2], &quot;hwecc&quot;);
+	hwecc_needed = strcmp (CMD_ARGV[2], &quot;hwecc&quot;);
 	if (hwecc_needed == 0)
 	    {
 		mx3_nf_info-&gt;flags.hw_ecc_enabled = 1;
diff --git a/src/flash/nand.c b/src/flash/nand.c
index 9231b9a..ce713b9 100644
--- a/src/flash/nand.c
+++ b/src/flash/nand.c
@@ -220,12 +220,12 @@ COMMAND_HANDLER(handle_nand_device_command)
 	{
 		struct nand_device *p, *c;
 
-		if (strcmp(args[0], nand_flash_controllers[i]-&gt;name) == 0)
+		if (strcmp(CMD_ARGV[0], nand_flash_controllers[i]-&gt;name) == 0)
 		{
 			/* register flash specific commands */
 			if ((retval = nand_flash_controllers[i]-&gt;register_commands(cmd_ctx)) != ERROR_OK)
 			{
-				LOG_ERROR(&quot;couldn't register '%s' commands&quot;, args[0]);
+				LOG_ERROR(&quot;couldn't register '%s' commands&quot;, CMD_ARGV[0]);
 				return retval;
 			}
 
@@ -269,7 +269,7 @@ COMMAND_HANDLER(handle_nand_device_command)
 	/* no valid NAND controller was found (i.e. the configuration option,
 	 * didn't match one of the compiled-in controllers)
 	 */
-	LOG_ERROR(&quot;No valid NAND flash controller found (%s)&quot;, args[0]);
+	LOG_ERROR(&quot;No valid NAND flash controller found (%s)&quot;, CMD_ARGV[0]);
 	LOG_ERROR(&quot;compiled-in NAND flash controllers:&quot;);
 	for (i = 0; nand_flash_controllers[i]; i++)
 	{
@@ -307,7 +307,7 @@ struct nand_device *get_nand_device_by_num(int num)
 COMMAND_HELPER(nand_command_get_device_by_num, unsigned name_index,
 		struct nand_device **nand)
 {
-	const char *str = args[name_index];
+	const char *str = CMD_ARGV[name_index];
 	unsigned num;
 	COMMAND_PARSE_NUMBER(uint, str, num);
 	*nand = get_nand_device_by_num(num);
@@ -1090,19 +1090,19 @@ COMMAND_HANDLER(handle_nand_info_command)
 		last = INT32_MAX;
 		break;
 	case 2:
-		COMMAND_PARSE_NUMBER(int, args[1], i);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], i);
 		first = last = i;
 		i = 0;
 		break;
 	case 3:
-		COMMAND_PARSE_NUMBER(int, args[1], first);
-		COMMAND_PARSE_NUMBER(int, args[2], last);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], first);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[2], last);
 		break;
 	}
 
 	if (NULL == p-&gt;device)
 	{
-		command_print(cmd_ctx, &quot;#%s: not probed&quot;, args[0]);
+		command_print(cmd_ctx, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -1193,11 +1193,11 @@ COMMAND_HANDLER(handle_nand_erase_command)
 	if (CMD_ARGC == 3) {
 		unsigned long size = p-&gt;erase_size * p-&gt;num_blocks;
 
-		COMMAND_PARSE_NUMBER(ulong, args[1], offset);
+		COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[1], offset);
 		if ((offset % p-&gt;erase_size) != 0 || offset &gt;= size)
 			return ERROR_INVALID_ARGUMENTS;
 
-		COMMAND_PARSE_NUMBER(ulong, args[2], length);
+		COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[2], length);
 		if ((length == 0) || (length % p-&gt;erase_size) != 0
 				|| (length + offset) &gt; size)
 			return ERROR_INVALID_ARGUMENTS;
@@ -1215,7 +1215,7 @@ COMMAND_HANDLER(handle_nand_erase_command)
 		command_print(cmd_ctx, &quot;erased blocks %lu to %lu &quot;
 				&quot;on NAND flash device #%s '%s'&quot;,
 				offset, offset + length,
-				args[0], p-&gt;device-&gt;name);
+				CMD_ARGV[0], p-&gt;device-&gt;name);
 	}
 	else if (retval == ERROR_NAND_OPERATION_FAILED)
 	{
@@ -1250,12 +1250,12 @@ COMMAND_HANDLER(handle_nand_check_bad_blocks_command)
 		unsigned long offset;
 		unsigned long length;
 
-		COMMAND_PARSE_NUMBER(ulong, args[1], offset);
+		COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[1], offset);
 		if (offset % p-&gt;erase_size)
 			return ERROR_INVALID_ARGUMENTS;
 		offset /= p-&gt;erase_size;
 
-		COMMAND_PARSE_NUMBER(ulong, args[2], length);
+		COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[2], length);
 		if (length % p-&gt;erase_size)
 			return ERROR_INVALID_ARGUMENTS;
 
@@ -1399,14 +1399,14 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 
 	if (NULL == nand-&gt;device)
 	{
-		command_print(cmd_ctx, &quot;#%s: not probed&quot;, args[0]);
+		command_print(cmd_ctx, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
-	COMMAND_PARSE_NUMBER(u32, args[2], state-&gt;address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], state-&gt;address);
 	if (need_size)
 	{
-			COMMAND_PARSE_NUMBER(u32, args[2], state-&gt;size);
+			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], state-&gt;size);
 			if (state-&gt;size % nand-&gt;page_size)
 			{
 				command_print(cmd_ctx, &quot;only page-aligned sizes are supported&quot;);
@@ -1418,23 +1418,23 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 	{
 		for (unsigned i = minargs; i &lt; CMD_ARGC; i++)
 		{
-			if (!strcmp(args[i], &quot;oob_raw&quot;))
+			if (!strcmp(CMD_ARGV[i], &quot;oob_raw&quot;))
 				state-&gt;oob_format |= NAND_OOB_RAW;
-			else if (!strcmp(args[i], &quot;oob_only&quot;))
+			else if (!strcmp(CMD_ARGV[i], &quot;oob_only&quot;))
 				state-&gt;oob_format |= NAND_OOB_RAW | NAND_OOB_ONLY;
-			else if (sw_ecc &amp;&amp; !strcmp(args[i], &quot;oob_softecc&quot;))
+			else if (sw_ecc &amp;&amp; !strcmp(CMD_ARGV[i], &quot;oob_softecc&quot;))
 				state-&gt;oob_format |= NAND_OOB_SW_ECC;
-			else if (sw_ecc &amp;&amp; !strcmp(args[i], &quot;oob_softecc_kw&quot;))
+			else if (sw_ecc &amp;&amp; !strcmp(CMD_ARGV[i], &quot;oob_softecc_kw&quot;))
 				state-&gt;oob_format |= NAND_OOB_SW_ECC_KW;
 			else
 			{
-				command_print(cmd_ctx, &quot;unknown option: %s&quot;, args[i]);
+				command_print(cmd_ctx, &quot;unknown option: %s&quot;, CMD_ARGV[i]);
 				return ERROR_COMMAND_SYNTAX_ERROR;
 			}
 		}
 	}
 
-	retval = nand_fileio_start(cmd_ctx, nand, args[1], filemode, state);
+	retval = nand_fileio_start(cmd_ctx, nand, CMD_ARGV[1], filemode, state);
 	if (ERROR_OK != retval)
 		return retval;
 
@@ -1528,7 +1528,7 @@ COMMAND_HANDLER(handle_nand_write_command)
 		{
 			command_print(cmd_ctx, &quot;failed writing file %s &quot;
 				&quot;to NAND flash %s at offset 0x%8.8&quot; PRIx32,
-				args[1], args[0], s.address);
+				CMD_ARGV[1], CMD_ARGV[0], s.address);
 			return nand_fileio_cleanup(&amp;s);
 		}
 		s.address += s.page_size;
@@ -1538,7 +1538,7 @@ COMMAND_HANDLER(handle_nand_write_command)
 	{
 		command_print(cmd_ctx, &quot;wrote file %s to NAND flash %s up to &quot;
 				&quot;offset 0x%8.8&quot; PRIx32 &quot; in %fs (%0.3f kb/s)&quot;,
-				args[1], args[0], s.address, duration_elapsed(&amp;s.bench),
+				CMD_ARGV[1], CMD_ARGV[0], s.address, duration_elapsed(&amp;s.bench),
 				duration_kbps(&amp;s.bench, total_bytes));
 	}
 	return ERROR_OK;
@@ -1598,7 +1598,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 	{
 		command_print(cmd_ctx, &quot;verified file %s in NAND flash %s &quot;
 				&quot;up to offset 0x%8.8&quot; PRIx32 &quot; in %fs (%0.3f kb/s)&quot;,
-				args[1], args[0], dev.address, duration_elapsed(&amp;file.bench),
+				CMD_ARGV[1], CMD_ARGV[0], dev.address, duration_elapsed(&amp;file.bench),
 				duration_kbps(&amp;file.bench, dev.size));
 	}
 
@@ -1658,15 +1658,15 @@ COMMAND_HANDLER(handle_nand_raw_access_command)
 
 	if (NULL == p-&gt;device)
 	{
-		command_print(cmd_ctx, &quot;#%s: not probed&quot;, args[0]);
+		command_print(cmd_ctx, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
 	if (CMD_ARGC == 2)
 	{
-		if (strcmp(&quot;enable&quot;, args[1]) == 0)
+		if (strcmp(&quot;enable&quot;, CMD_ARGV[1]) == 0)
 			p-&gt;use_raw = 1;
-		else if (strcmp(&quot;disable&quot;, args[1]) == 0)
+		else if (strcmp(&quot;disable&quot;, CMD_ARGV[1]) == 0)
 			p-&gt;use_raw = 0;
 		else
 			return ERROR_COMMAND_SYNTAX_ERROR;
diff --git a/src/flash/orion_nand.c b/src/flash/orion_nand.c
index 69d6d96..c8fc969 100644
--- a/src/flash/orion_nand.c
+++ b/src/flash/orion_nand.c
@@ -143,14 +143,14 @@ NAND_DEVICE_COMMAND_HANDLER(orion_nand_device_command)
 	}
 
 	nand-&gt;controller_priv = hw;
-	hw-&gt;target = get_target(args[1]);
+	hw-&gt;target = get_target(CMD_ARGV[1]);
 	if (!hw-&gt;target) {
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[1]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[1]);
 		free(hw);
 		return ERROR_NAND_DEVICE_INVALID;
 	}
 
-	COMMAND_PARSE_NUMBER(u32, args[2], base);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], base);
 	cle = 0;
 	ale = 1;
 
diff --git a/src/flash/pic32mx.c b/src/flash/pic32mx.c
index 95e2c63..05e0474 100644
--- a/src/flash/pic32mx.c
+++ b/src/flash/pic32mx.c
@@ -854,8 +854,8 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 		return ERROR_OK;
 	}
 
-	COMMAND_PARSE_NUMBER(u32, args[0], address);
-	COMMAND_PARSE_NUMBER(u32, args[1], value);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 
 	struct flash_bank *bank;
 	int retval = CALL_COMMAND_HANDLER(flash_command_get_bank_by_num, 2, &amp;bank);
@@ -864,7 +864,7 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 
 	if (address &lt; bank-&gt;base || address &gt;= (bank-&gt;base + bank-&gt;size))
 	{
-		command_print(cmd_ctx, &quot;flash address '%s' is out of bounds&quot;, args[0]);
+		command_print(cmd_ctx, &quot;flash address '%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
diff --git a/src/flash/s3c24xx_nand.c b/src/flash/s3c24xx_nand.c
index 75b8700..262569e 100644
--- a/src/flash/s3c24xx_nand.c
+++ b/src/flash/s3c24xx_nand.c
@@ -43,9 +43,9 @@ S3C24XX_DEVICE_COMMAND()
 
 	nand-&gt;controller_priv = s3c24xx_info;
 
-	s3c24xx_info-&gt;target = get_target(args[1]);
+	s3c24xx_info-&gt;target = get_target(CMD_ARGV[1]);
 	if (s3c24xx_info-&gt;target == NULL) {
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[1]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[1]);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
diff --git a/src/flash/stm32x.c b/src/flash/stm32x.c
index d32e9ea..f59ed61 100644
--- a/src/flash/stm32x.c
+++ b/src/flash/stm32x.c
@@ -1065,7 +1065,7 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 		return ERROR_TARGET_NOT_HALTED;
 	}
 
-	if (strcmp(args[1], &quot;SWWDG&quot;) == 0)
+	if (strcmp(CMD_ARGV[1], &quot;SWWDG&quot;) == 0)
 	{
 		optionbyte |= (1 &lt;&lt; 0);
 	}
@@ -1074,7 +1074,7 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 		optionbyte &amp;= ~(1 &lt;&lt; 0);
 	}
 
-	if (strcmp(args[2], &quot;NORSTSTNDBY&quot;) == 0)
+	if (strcmp(CMD_ARGV[2], &quot;NORSTSTNDBY&quot;) == 0)
 	{
 		optionbyte |= (1 &lt;&lt; 1);
 	}
@@ -1083,7 +1083,7 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 		optionbyte &amp;= ~(1 &lt;&lt; 1);
 	}
 
-	if (strcmp(args[3], &quot;NORSTSTOP&quot;) == 0)
+	if (strcmp(CMD_ARGV[3], &quot;NORSTSTOP&quot;) == 0)
 	{
 		optionbyte |= (1 &lt;&lt; 2);
 	}
diff --git a/src/flash/str7x.c b/src/flash/str7x.c
index 134780b..76b6467 100644
--- a/src/flash/str7x.c
+++ b/src/flash/str7x.c
@@ -127,23 +127,23 @@ FLASH_BANK_COMMAND_HANDLER(str7x_flash_bank_command)
 	str7x_info-&gt;busy_bits = (FLASH_LOCK | FLASH_BSYA1 | FLASH_BSYA0);
 	str7x_info-&gt;disable_bit = (1 &lt;&lt; 1);
 
-	if (strcmp(args[6], &quot;STR71x&quot;) == 0)
+	if (strcmp(CMD_ARGV[6], &quot;STR71x&quot;) == 0)
 	{
 		str7x_info-&gt;register_base = 0x40100000;
 	}
-	else if (strcmp(args[6], &quot;STR73x&quot;) == 0)
+	else if (strcmp(CMD_ARGV[6], &quot;STR73x&quot;) == 0)
 	{
 		str7x_info-&gt;register_base = 0x80100000;
 		str7x_info-&gt;busy_bits = (FLASH_LOCK | FLASH_BSYA0);
 	}
-	else if (strcmp(args[6], &quot;STR75x&quot;) == 0)
+	else if (strcmp(CMD_ARGV[6], &quot;STR75x&quot;) == 0)
 	{
 		str7x_info-&gt;register_base = 0x20100000;
 		str7x_info-&gt;disable_bit = (1 &lt;&lt; 0);
 	}
 	else
 	{
-		LOG_ERROR(&quot;unknown STR7x variant: '%s'&quot;, args[6]);
+		LOG_ERROR(&quot;unknown STR7x variant: '%s'&quot;, CMD_ARGV[6]);
 		free(str7x_info);
 		return ERROR_FLASH_BANK_INVALID;
 	}
diff --git a/src/flash/str9x.c b/src/flash/str9x.c
index c103e57..50cddaf 100644
--- a/src/flash/str9x.c
+++ b/src/flash/str9x.c
@@ -647,10 +647,10 @@ COMMAND_HANDLER(str9x_handle_flash_config_command)
 		return retval;
 
 	uint32_t bbsr, nbbsr, bbadr, nbbadr;
-	COMMAND_PARSE_NUMBER(u32, args[1], bbsr);
-	COMMAND_PARSE_NUMBER(u32, args[2], nbbsr);
-	COMMAND_PARSE_NUMBER(u32, args[3], bbadr);
-	COMMAND_PARSE_NUMBER(u32, args[4], nbbadr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], bbsr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], nbbsr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[3], bbadr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[4], nbbadr);
 
 	str9x_info = bank-&gt;driver_priv;
 
diff --git a/src/flash/str9xpec.c b/src/flash/str9xpec.c
index 73027e4..a87d0ff 100644
--- a/src/flash/str9xpec.c
+++ b/src/flash/str9xpec.c
@@ -934,7 +934,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_cmap_command)
 
 	str9xpec_info = bank-&gt;driver_priv;
 
-	if (strcmp(args[1], &quot;bank1&quot;) == 0)
+	if (strcmp(CMD_ARGV[1], &quot;bank1&quot;) == 0)
 	{
 		buf_set_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_CSMAPBIT, 1, 1);
 	}
@@ -963,7 +963,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdthd_command)
 
 	str9xpec_info = bank-&gt;driver_priv;
 
-	if (strcmp(args[1], &quot;2.7v&quot;) == 0)
+	if (strcmp(CMD_ARGV[1], &quot;2.7v&quot;) == 0)
 	{
 		buf_set_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_LVDTHRESBIT, 1, 1);
 	}
@@ -992,7 +992,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdsel_command)
 
 	str9xpec_info = bank-&gt;driver_priv;
 
-	if (strcmp(args[1], &quot;vdd_vddq&quot;) == 0)
+	if (strcmp(CMD_ARGV[1], &quot;vdd_vddq&quot;) == 0)
 	{
 		buf_set_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_LVDSELBIT, 1, 1);
 	}
@@ -1021,7 +1021,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdwarn_command)
 
 	str9xpec_info = bank-&gt;driver_priv;
 
-	if (strcmp(args[1], &quot;vdd_vddq&quot;) == 0)
+	if (strcmp(CMD_ARGV[1], &quot;vdd_vddq&quot;) == 0)
 	{
 		buf_set_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_LVDWARNBIT, 1, 1);
 	}
diff --git a/src/flash/tms470.c b/src/flash/tms470.c
index d52dcc1..890db73 100644
--- a/src/flash/tms470.c
+++ b/src/flash/tms470.c
@@ -302,12 +302,12 @@ COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 
 		for (i = 0; i &lt; 4; i++)
 		{
-			int start = (0 == strncmp(args[i], &quot;0x&quot;, 2)) ? 2 : 0;
+			int start = (0 == strncmp(CMD_ARGV[i], &quot;0x&quot;, 2)) ? 2 : 0;
 
-			if (1 != sscanf(&amp;args[i][start], &quot;%&quot; SCNx32 &quot;&quot;, &amp;flashKeys[i]))
+			if (1 != sscanf(&amp;CMD_ARGV[i][start], &quot;%&quot; SCNx32 &quot;&quot;, &amp;flashKeys[i]))
 			{
-				command_print(cmd_ctx, &quot;could not process flash key %s&quot;, args[i]);
-				LOG_ERROR(&quot;could not process flash key %s&quot;, args[i]);
+				command_print(cmd_ctx, &quot;could not process flash key %s&quot;, CMD_ARGV[i]);
+				LOG_ERROR(&quot;could not process flash key %s&quot;, CMD_ARGV[i]);
 				return ERROR_INVALID_ARGUMENTS;
 			}
 		}
@@ -362,7 +362,7 @@ COMMAND_HANDLER(tms470_handle_osc_megahertz_command)
 	}
 	else if (CMD_ARGC == 1)
 	{
-		sscanf(args[0], &quot;%d&quot;, &amp;oscMHz);
+		sscanf(CMD_ARGV[0], &quot;%d&quot;, &amp;oscMHz);
 	}
 
 	if (oscMHz &lt;= 0)
@@ -391,7 +391,7 @@ COMMAND_HANDLER(tms470_handle_plldis_command)
 	}
 	else if (CMD_ARGC == 1)
 	{
-		sscanf(args[0], &quot;%d&quot;, &amp;plldis);
+		sscanf(CMD_ARGV[0], &quot;%d&quot;, &amp;plldis);
 		plldis = plldis ? 1 : 0;
 	}
 
diff --git a/src/hello.c b/src/hello.c
index b2d1d30..df0cb02 100644
--- a/src/hello.c
+++ b/src/hello.c
@@ -32,7 +32,7 @@ static COMMAND_HELPER(handle_hello_args, const char **sep, const char **name)
 	if (1 == CMD_ARGC)
 	{
 		*sep = &quot; &quot;;
-		*name = args[0];
+		*name = CMD_ARGV[0];
 	}
 	else
 		*sep = *name = &quot;&quot;;
diff --git a/src/helper/command.c b/src/helper/command.c
index 3abfdd6..fdb59f0 100644
--- a/src/helper/command.c
+++ b/src/helper/command.c
@@ -142,7 +142,7 @@ static int script_command(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 
 	log_add_callback(tcl_output, tclOutput);
 
-	// turn words[0] into args[-1] with this cast
+	// turn words[0] into CMD_ARGV[-1] with this cast
 	retval = run_command(context, c, (const char **)words + 1, nwords);
 
 	log_remove_callback(tcl_output, tclOutput);
@@ -725,7 +725,7 @@ COMMAND_HANDLER(handle_sleep_command)
 	bool busy = false;
 	if (CMD_ARGC == 2)
 	{
-		if (strcmp(args[1], &quot;busy&quot;) == 0)
+		if (strcmp(CMD_ARGV[1], &quot;busy&quot;) == 0)
 			busy = true;
 		else
 			return ERROR_COMMAND_SYNTAX_ERROR;
@@ -734,7 +734,7 @@ COMMAND_HANDLER(handle_sleep_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned long duration = 0;
-	int retval = parse_ulong(args[0], &amp;duration);
+	int retval = parse_ulong(CMD_ARGV[0], &amp;duration);
 	if (ERROR_OK != retval)
 		return retval;
 
@@ -758,7 +758,7 @@ COMMAND_HANDLER(handle_fast_command)
 	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	fast_and_dangerous = strcmp(&quot;enable&quot;, args[0]) == 0;
+	fast_and_dangerous = strcmp(&quot;enable&quot;, CMD_ARGV[0]) == 0;
 
 	return ERROR_OK;
 }
diff --git a/src/helper/ioutil.c b/src/helper/ioutil.c
index 2e8229c..3fc1a96 100644
--- a/src/helper/ioutil.c
+++ b/src/helper/ioutil.c
@@ -65,7 +65,7 @@ COMMAND_HANDLER(handle_rm_command)
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
-	if (unlink(args[0]) != 0)
+	if (unlink(CMD_ARGV[0]) != 0)
 	{
 		command_print(cmd_ctx, &quot;failed: %d&quot;, errno);
 	}
@@ -145,7 +145,7 @@ COMMAND_HANDLER(handle_cat_command)
 	void *data;
 	size_t len;
 
-	int retval = loadFile(args[0], &amp;data, &amp;len);
+	int retval = loadFile(CMD_ARGV[0], &amp;data, &amp;len);
 	if (retval == ERROR_OK)
 	{
 		command_print(cmd_ctx, &quot;%s&quot;, (char *)data);
@@ -153,7 +153,7 @@ COMMAND_HANDLER(handle_cat_command)
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;%s not found %d&quot;, args[0], retval);
+		command_print(cmd_ctx, &quot;%s not found %d&quot;, CMD_ARGV[0], retval);
 	}
 
 	return ERROR_OK;
@@ -168,7 +168,7 @@ COMMAND_HANDLER(handle_trunc_command)
 	}
 
 	FILE *config_file = NULL;
-	config_file = fopen(args[0], &quot;w&quot;);
+	config_file = fopen(CMD_ARGV[0], &quot;w&quot;);
 	if (config_file != NULL)
 		fclose(config_file);
 
@@ -211,7 +211,7 @@ COMMAND_HANDLER(handle_append_command)
 
 	int retval = ERROR_FAIL;
 	FILE *config_file = NULL;
-	config_file = fopen(args[0], &quot;a&quot;);
+	config_file = fopen(CMD_ARGV[0], &quot;a&quot;);
 	if (config_file != NULL)
 	{
 		fseek(config_file, 0, SEEK_END);
@@ -219,7 +219,7 @@ COMMAND_HANDLER(handle_append_command)
 		unsigned i;
 		for (i = 1; i &lt; CMD_ARGC; i++)
 		{
-			if (fwrite(args[i], 1, strlen(args[i]), config_file) != strlen(args[i]))
+			if (fwrite(CMD_ARGV[i], 1, strlen(CMD_ARGV[i]), config_file) != strlen(CMD_ARGV[i]))
 				break;
 			if (i != CMD_ARGC - 1)
 			{
@@ -250,11 +250,11 @@ COMMAND_HANDLER(handle_cp_command)
 	void *data;
 	size_t len;
 
-	int retval = loadFile(args[0], &amp;data, &amp;len);
+	int retval = loadFile(CMD_ARGV[0], &amp;data, &amp;len);
 	if (retval != ERROR_OK)
 		return retval;
 
-	FILE *f = fopen(args[1], &quot;wb&quot;);
+	FILE *f = fopen(CMD_ARGV[1], &quot;wb&quot;);
 	if (f == NULL)
 		retval = ERROR_INVALID_ARGUMENTS;
 
@@ -286,7 +286,7 @@ COMMAND_HANDLER(handle_cp_command)
 
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;Copied %s to %s&quot;, args[0], args[1]);
+		command_print(cmd_ctx, &quot;Copied %s to %s&quot;, CMD_ARGV[0], CMD_ARGV[1]);
 	} else
 	{
 		command_print(cmd_ctx, &quot;Failed: %d&quot;, retval);
@@ -298,7 +298,7 @@ COMMAND_HANDLER(handle_cp_command)
 		fclose(f);
 
 	if (retval != ERROR_OK)
-		unlink(args[1]);
+		unlink(CMD_ARGV[1]);
 
 	return retval;
 }
diff --git a/src/helper/log.c b/src/helper/log.c
index 715f2fa..0e04c8e 100644
--- a/src/helper/log.c
+++ b/src/helper/log.c
@@ -278,7 +278,7 @@ COMMAND_HANDLER(handle_debug_level_command)
 	if (CMD_ARGC == 1)
 	{
 		unsigned new_level;
-		COMMAND_PARSE_NUMBER(uint, args[0], new_level);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], new_level);
 		debug_level = MIN(new_level, LOG_LVL_DEBUG);
 	}
 	else if (CMD_ARGC &gt; 1)
@@ -305,7 +305,7 @@ COMMAND_HANDLER(handle_log_output_command)
 {
 	if (CMD_ARGC == 1)
 	{
-		FILE* file = fopen(args[0], &quot;w&quot;);
+		FILE* file = fopen(CMD_ARGV[0], &quot;w&quot;);
 
 		if (file)
 		{
diff --git a/src/jtag/amt_jtagaccel.c b/src/jtag/amt_jtagaccel.c
index 949acec..d35b0c2 100644
--- a/src/jtag/amt_jtagaccel.c
+++ b/src/jtag/amt_jtagaccel.c
@@ -503,7 +503,7 @@ COMMAND_HANDLER(amt_jtagaccel_handle_parport_port_command)
 		if (amt_jtagaccel_port == 0)
 		{
 			uint16_t port;
-			COMMAND_PARSE_NUMBER(u16, args[0], port);
+			COMMAND_PARSE_NUMBER(u16, CMD_ARGV[0], port);
 			amt_jtagaccel_port = port;
 		}
 		else
@@ -527,7 +527,7 @@ COMMAND_HANDLER(amt_jtagaccel_handle_rtck_command)
 	}
 	else
 	{
-		if (strcmp(args[0], &quot;enabled&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;enabled&quot;) == 0)
 		{
 			rtck_enabled = 1;
 		}
diff --git a/src/jtag/at91rm9200.c b/src/jtag/at91rm9200.c
index 90d94c9..8fbdf39 100644
--- a/src/jtag/at91rm9200.c
+++ b/src/jtag/at91rm9200.c
@@ -185,7 +185,7 @@ static int at91rm9200_speed(int speed)
 	return ERROR_OK;
 }
 
-static int at91rm9200_handle_device_command(struct command_context *cmd_ctx, char *cmd, char 
**args, int argc)
+static int at91rm9200_handle_device_command(struct command_context *cmd_ctx, char *cmd, char **CMD_ARGV, int argc)
 {
 	if (CMD_ARGC == 0)
 		return ERROR_OK;
@@ -193,8 +193,8 @@ static int at91rm9200_handle_device_command(struct command_context *cmd_ctx, cha
 	/* only if the device name wasn't overwritten by cmdline */
 	if (at91rm9200_device == 0)
 	{
-		at91rm9200_device = malloc(strlen(args[0]) + sizeof(char));
-		strcpy(at91rm9200_device, args[0]);
+		at91rm9200_device = malloc(strlen(CMD_ARGV[0]) + sizeof(char));
+		strcpy(at91rm9200_device, CMD_ARGV[0]);
 	}
 
 	return ERROR_OK;
diff --git a/src/jtag/ft2232.c b/src/jtag/ft2232.c
index c1b3f10..451da41 100644
--- a/src/jtag/ft2232.c
+++ b/src/jtag/ft2232.c
@@ -2803,7 +2803,7 @@ COMMAND_HANDLER(ft2232_handle_device_desc_command)
 	char buf[200];
 	if (CMD_ARGC == 1)
 	{
-		ft2232_device_desc = strdup(args[0]);
+		ft2232_device_desc = strdup(CMD_ARGV[0]);
 		cp = strchr(ft2232_device_desc, 0);
 		/* under Win32, the FTD2XX driver appends an &quot;A&quot; to the end
 		 * of the description, this examines the given desc
@@ -2835,7 +2835,7 @@ COMMAND_HANDLER(ft2232_handle_serial_command)
 {
 	if (CMD_ARGC == 1)
 	{
-		ft2232_serial = strdup(args[0]);
+		ft2232_serial = strdup(CMD_ARGV[0]);
 	}
 	else
 	{
@@ -2850,8 +2850,8 @@ COMMAND_HANDLER(ft2232_handle_layout_command)
 	if (CMD_ARGC == 0)
 		return ERROR_OK;
 
-	ft2232_layout = malloc(strlen(args[0]) + 1);
-	strcpy(ft2232_layout, args[0]);
+	ft2232_layout = malloc(strlen(CMD_ARGV[0]) + 1);
+	strcpy(ft2232_layout, CMD_ARGV[0]);
 
 	return ERROR_OK;
 }
@@ -2876,8 +2876,8 @@ COMMAND_HANDLER(ft2232_handle_vid_pid_command)
 	unsigned i;
 	for (i = 0; i &lt; CMD_ARGC; i += 2)
 	{
-		COMMAND_PARSE_NUMBER(u16, args[i], ft2232_vid[i &gt;&gt; 1]);
-		COMMAND_PARSE_NUMBER(u16, args[i + 1], ft2232_pid[i &gt;&gt; 1]);
+		COMMAND_PARSE_NUMBER(u16, CMD_ARGV[i], ft2232_vid[i &gt;&gt; 1]);
+		COMMAND_PARSE_NUMBER(u16, CMD_ARGV[i + 1], ft2232_pid[i &gt;&gt; 1]);
 	}
 
 	/*
@@ -2893,7 +2893,7 @@ COMMAND_HANDLER(ft2232_handle_latency_command)
 {
 	if (CMD_ARGC == 1)
 	{
-		ft2232_latency = atoi(args[0]);
+		ft2232_latency = atoi(CMD_ARGV[0]);
 	}
 	else
 	{
diff --git a/src/jtag/gw16012.c b/src/jtag/gw16012.c
index d1da2a1..d0cdde6 100644
--- a/src/jtag/gw16012.c
+++ b/src/jtag/gw16012.c
@@ -548,7 +548,7 @@ COMMAND_HANDLER(gw16012_handle_parport_port_command)
 		/* only if the port wasn't overwritten by cmdline */
 		if (gw16012_port == 0)
 		{
-			COMMAND_PARSE_NUMBER(u16, args[0], gw16012_port);
+			COMMAND_PARSE_NUMBER(u16, CMD_ARGV[0], gw16012_port);
 		}
 		else
 		{
diff --git a/src/jtag/jlink.c b/src/jtag/jlink.c
index 41b99a1..80e7150 100644
--- a/src/jtag/jlink.c
+++ b/src/jtag/jlink.c
@@ -632,7 +632,7 @@ COMMAND_HANDLER(jlink_handle_jlink_hw_jtag_command)
 		command_print(cmd_ctx, &quot;jlink hw jtag  %i&quot;, jlink_hw_jtag_version);
 		break;
 	case 1: {
-		int request_version = atoi(args[0]);
+		int request_version = atoi(CMD_ARGV[0]);
 		switch (request_version) {
 		case 2: case 3:
 			jlink_hw_jtag_version = request_version;
diff --git a/src/jtag/parport.c b/src/jtag/parport.c
index 52289c5..e15c66d 100644
--- a/src/jtag/parport.c
+++ b/src/jtag/parport.c
@@ -416,7 +416,7 @@ COMMAND_HANDLER(parport_handle_parport_port_command)
 		/* only if the port wasn't overwritten by cmdline */
 		if (parport_port == 0)
 		{
-			COMMAND_PARSE_NUMBER(u16, args[0], parport_port);
+			COMMAND_PARSE_NUMBER(u16, CMD_ARGV[0], parport_port);
 		}
 		else
 		{
@@ -438,8 +438,8 @@ COMMAND_HANDLER(parport_handle_parport_cable_command)
 	/* only if the cable name wasn't overwritten by cmdline */
 	if (parport_cable == 0)
 	{
-		parport_cable = malloc(strlen(args[0]) + sizeof(char));
-		strcpy(parport_cable, args[0]);
+		parport_cable = malloc(strlen(CMD_ARGV[0]) + sizeof(char));
+		strcpy(parport_cable, CMD_ARGV[0]);
 	}
 
 	return ERROR_OK;
@@ -453,9 +453,9 @@ COMMAND_HANDLER(parport_handle_write_on_exit_command)
 		return ERROR_OK;
 	}
 
-	if (strcmp(args[0], &quot;on&quot;) == 0)
+	if (strcmp(CMD_ARGV[0], &quot;on&quot;) == 0)
 		parport_exit = 1;
-	else if (strcmp(args[0], &quot;off&quot;) == 0)
+	else if (strcmp(CMD_ARGV[0], &quot;off&quot;) == 0)
 		parport_exit = 0;
 
 	return ERROR_OK;
@@ -465,7 +465,7 @@ COMMAND_HANDLER(parport_handle_parport_toggling_time_command)
 {
 	if (CMD_ARGC == 1) {
 		uint32_t ns;
-		int retval = parse_u32(args[0], &amp;ns);
+		int retval = parse_u32(CMD_ARGV[0], &amp;ns);
 
 		if (ERROR_OK != retval)
 			return retval;
diff --git a/src/jtag/presto.c b/src/jtag/presto.c
index 45d99ff..1d6bc1d 100644
--- a/src/jtag/presto.c
+++ b/src/jtag/presto.c
@@ -756,7 +756,7 @@ COMMAND_HANDLER(presto_handle_serial_command)
 	{
 		if (presto_serial)
 			free(presto_serial);
-		presto_serial = strdup(args[0]);
+		presto_serial = strdup(CMD_ARGV[0]);
 	}
 	else
 	{
diff --git a/src/jtag/tcl.c b/src/jtag/tcl.c
index bd3f704..1eead8d 100644
--- a/src/jtag/tcl.c
+++ b/src/jtag/tcl.c
@@ -628,12 +628,12 @@ COMMAND_HANDLER(handle_interface_command)
 	}
 
 	/* interface name is a mandatory argument */
-	if (CMD_ARGC != 1 || args[0][0] == '\0')
+	if (CMD_ARGC != 1 || CMD_ARGV[0][0] == '\0')
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	for (unsigned i = 0; NULL != jtag_interfaces[i]; i++)
 	{
-		if (strcmp(args[0], jtag_interfaces[i]-&gt;name) != 0)
+		if (strcmp(CMD_ARGV[0], jtag_interfaces[i]-&gt;name) != 0)
 			continue;
 
 		int retval = jtag_interfaces[i]-&gt;register_commands(cmd_ctx);
@@ -657,7 +657,7 @@ COMMAND_HANDLER(handle_interface_command)
 	/* no valid interface was found (i.e. the configuration option,
 	 * didn't match one of the compiled-in interfaces
 	 */
-	LOG_ERROR(&quot;The specified JTAG interface was not found (%s)&quot;, args[0]);
+	LOG_ERROR(&quot;The specified JTAG interface was not found (%s)&quot;, CMD_ARGV[0]);
 	CALL_COMMAND_HANDLER(handle_interface_list_command);
 	return ERROR_JTAG_INVALID_INTERFACE;
 }
@@ -711,21 +711,21 @@ COMMAND_HANDLER(handle_reset_config_command)
 	 * Here we don't care about the order, and only change values
 	 * which have been explicitly specified.
 	 */
-	for (; CMD_ARGC; CMD_ARGC--, args++) {
+	for (; CMD_ARGC; CMD_ARGC--, CMD_ARGV++) {
 		int tmp = 0;
 		int m;
 
 		/* gating */
 		m = RESET_SRST_NO_GATING;
-		if (strcmp(*args, &quot;srst_gates_jtag&quot;) == 0)
+		if (strcmp(*CMD_ARGV, &quot;srst_gates_jtag&quot;) == 0)
 			/* default: don't use JTAG while SRST asserted */;
-		else if (strcmp(*args, &quot;srst_nogate&quot;) == 0)
+		else if (strcmp(*CMD_ARGV, &quot;srst_nogate&quot;) == 0)
 			tmp = RESET_SRST_NO_GATING;
 		else
 			m = 0;
 		if (mask &amp; m) {
 			LOG_ERROR(&quot;extra reset_config %s spec (%s)&quot;,
-					&quot;gating&quot;, *args);
+					&quot;gating&quot;, *CMD_ARGV);
 			return ERROR_INVALID_ARGUMENTS;
 		}
 		if (m)
@@ -733,19 +733,19 @@ COMMAND_HANDLER(handle_reset_config_command)
 
 		/* signals */
 		m = RESET_HAS_TRST | RESET_HAS_SRST;
-		if (strcmp(*args, &quot;none&quot;) == 0)
+		if (strcmp(*CMD_ARGV, &quot;none&quot;) == 0)
 			tmp = RESET_NONE;
-		else if (strcmp(*args, &quot;trst_only&quot;) == 0)
+		else if (strcmp(*CMD_ARGV, &quot;trst_only&quot;) == 0)
 			tmp = RESET_HAS_TRST;
-		else if (strcmp(*args, &quot;srst_only&quot;) == 0)
+		else if (strcmp(*CMD_ARGV, &quot;srst_only&quot;) == 0)
 			tmp = RESET_HAS_SRST;
-		else if (strcmp(*args, &quot;trst_and_srst&quot;) == 0)
+		else if (strcmp(*CMD_ARGV, &quot;trst_and_srst&quot;) == 0)
 			tmp = RESET_HAS_TRST | RESET_HAS_SRST;
 		else
 			m = 0;
 		if (mask &amp; m) {
 			LOG_ERROR(&quot;extra reset_config %s spec (%s)&quot;,
-					&quot;signal&quot;, *args);
+					&quot;signal&quot;, *CMD_ARGV);
 			return ERROR_INVALID_ARGUMENTS;
 		}
 		if (m)
@@ -753,19 +753,19 @@ COMMAND_HANDLER(handle_reset_config_command)
 
 		/* combination (options for broken wiring) */
 		m = RESET_SRST_PULLS_TRST | RESET_TRST_PULLS_SRST;
-		if (strcmp(*args, &quot;separate&quot;) == 0)
+		if (strcmp(*CMD_ARGV, &quot;separate&quot;) == 0)
 			/* separate reset lines - default */;
-		else if (strcmp(*args, &quot;srst_pulls_trst&quot;) == 0)
+		else if (strcmp(*CMD_ARGV, &quot;srst_pulls_trst&quot;) == 0)
 			tmp |= RESET_SRST_PULLS_TRST;
-		else if (strcmp(*args, &quot;trst_pulls_srst&quot;) == 0)
+		else if (strcmp(*CMD_ARGV, &quot;trst_pulls_srst&quot;) == 0)
 			tmp |= RESET_TRST_PULLS_SRST;
-		else if (strcmp(*args, &quot;combined&quot;) == 0)
+		else if (strcmp(*CMD_ARGV, &quot;combined&quot;) == 0)
 			tmp |= RESET_SRST_PULLS_TRST | RESET_TRST_PULLS_SRST;
 		else
 			m = 0;
 		if (mask &amp; m) {
 			LOG_ERROR(&quot;extra reset_config %s spec (%s)&quot;,
-					&quot;combination&quot;, *args);
+					&quot;combination&quot;, *CMD_ARGV);
 			return ERROR_INVALID_ARGUMENTS;
 		}
 		if (m)
@@ -773,15 +773,15 @@ COMMAND_HANDLER(handle_reset_config_command)
 
 		/* trst_type (NOP without HAS_TRST) */
 		m = RESET_TRST_OPEN_DRAIN;
-		if (strcmp(*args, &quot;trst_open_drain&quot;) == 0)
+		if (strcmp(*CMD_ARGV, &quot;trst_open_drain&quot;) == 0)
 			tmp |= RESET_TRST_OPEN_DRAIN;
-		else if (strcmp(*args, &quot;trst_push_pull&quot;) == 0)
+		else if (strcmp(*CMD_ARGV, &quot;trst_push_pull&quot;) == 0)
 			/* push/pull from adapter - default */;
 		else
 			m = 0;
 		if (mask &amp; m) {
 			LOG_ERROR(&quot;extra reset_config %s spec (%s)&quot;,
-					&quot;trst_type&quot;, *args);
+					&quot;trst_type&quot;, *CMD_ARGV);
 			return ERROR_INVALID_ARGUMENTS;
 		}
 		if (m)
@@ -789,22 +789,22 @@ COMMAND_HANDLER(handle_reset_config_command)
 
 		/* srst_type (NOP without HAS_SRST) */
 		m |= RESET_SRST_PUSH_PULL;
-		if (strcmp(*args, &quot;srst_push_pull&quot;) == 0)
+		if (strcmp(*CMD_ARGV, &quot;srst_push_pull&quot;) == 0)
 			tmp |= RESET_SRST_PUSH_PULL;
-		else if (strcmp(*args, &quot;srst_open_drain&quot;) == 0)
+		else if (strcmp(*CMD_ARGV, &quot;srst_open_drain&quot;) == 0)
 			/* open drain from adapter - default */;
 		else
 			m = 0;
 		if (mask &amp; m) {
 			LOG_ERROR(&quot;extra reset_config %s spec (%s)&quot;,
-					&quot;srst_type&quot;, *args);
+					&quot;srst_type&quot;, *CMD_ARGV);
 			return ERROR_INVALID_ARGUMENTS;
 		}
 		if (m)
 			goto next;
 
 		/* caller provided nonsense; fail */
-		LOG_ERROR(&quot;unknown reset_config flag (%s)&quot;, *args);
+		LOG_ERROR(&quot;unknown reset_config flag (%s)&quot;, *CMD_ARGV);
 		return ERROR_INVALID_ARGUMENTS;
 
 next:
@@ -902,7 +902,7 @@ COMMAND_HANDLER(handle_jtag_nsrst_delay_command)
 	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
-		COMMAND_PARSE_NUMBER(uint, args[0], delay);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], delay);
 
 		jtag_set_nsrst_delay(delay);
 	}
@@ -917,7 +917,7 @@ COMMAND_HANDLER(handle_jtag_ntrst_delay_command)
 	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
-		COMMAND_PARSE_NUMBER(uint, args[0], delay);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], delay);
 
 		jtag_set_ntrst_delay(delay);
 	}
@@ -932,7 +932,7 @@ COMMAND_HANDLER(handle_jtag_nsrst_assert_width_command)
 	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
-		COMMAND_PARSE_NUMBER(uint, args[0], delay);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], delay);
 
 		jtag_set_nsrst_assert_width(delay);
 	}
@@ -947,7 +947,7 @@ COMMAND_HANDLER(handle_jtag_ntrst_assert_width_command)
 	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
-		COMMAND_PARSE_NUMBER(uint, args[0], delay);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], delay);
 
 		jtag_set_ntrst_assert_width(delay);
 	}
@@ -964,7 +964,7 @@ COMMAND_HANDLER(handle_jtag_khz_command)
 	if (CMD_ARGC == 1)
 	{
 		unsigned khz = 0;
-		COMMAND_PARSE_NUMBER(uint, args[0], khz);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], khz);
 
 		retval = jtag_config_khz(khz);
 		if (ERROR_OK != retval)
@@ -993,7 +993,7 @@ COMMAND_HANDLER(handle_jtag_rclk_command)
 	if (CMD_ARGC == 1)
 	{
 		unsigned khz = 0;
-		COMMAND_PARSE_NUMBER(uint, args[0], khz);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], khz);
 
 		retval = jtag_config_rclk(khz);
 		if (ERROR_OK != retval)
@@ -1019,17 +1019,17 @@ COMMAND_HANDLER(handle_jtag_reset_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int trst = -1;
-	if (args[0][0] == '1')
+	if (CMD_ARGV[0][0] == '1')
 		trst = 1;
-	else if (args[0][0] == '0')
+	else if (CMD_ARGV[0][0] == '0')
 		trst = 0;
 	else
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int srst = -1;
-	if (args[1][0] == '1')
+	if (CMD_ARGV[1][0] == '1')
 		srst = 1;
-	else if (args[1][0] == '0')
+	else if (CMD_ARGV[1][0] == '0')
 		srst = 0;
 	else
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -1047,7 +1047,7 @@ COMMAND_HANDLER(handle_runtest_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned num_clocks;
-	COMMAND_PARSE_NUMBER(uint, args[0], num_clocks);
+	COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], num_clocks);
 
 	jtag_add_runtest(num_clocks, TAP_IDLE);
 	return jtag_execute_queue();
@@ -1096,13 +1096,13 @@ COMMAND_HANDLER(handle_irscan_command)
 	if (CMD_ARGC &gt;= 4) {
 		/* have at least one pair of numbers. */
 		/* is last pair the magic text? */
-		if (strcmp(&quot;-endstate&quot;, args[CMD_ARGC - 2]) == 0) {
-			endstate = tap_state_by_name(args[CMD_ARGC - 1]);
+		if (strcmp(&quot;-endstate&quot;, CMD_ARGV[CMD_ARGC - 2]) == 0) {
+			endstate = tap_state_by_name(CMD_ARGV[CMD_ARGC - 1]);
 			if (endstate == TAP_INVALID)
 				return ERROR_COMMAND_SYNTAX_ERROR;
 			if (!scan_is_safe(endstate))
 				LOG_WARNING(&quot;unstable irscan endstate \&quot;%s\&quot;&quot;,
-						args[CMD_ARGC - 1]);
+						CMD_ARGV[CMD_ARGC - 1]);
 			CMD_ARGC -= 2;
 		}
 	}
@@ -1115,14 +1115,14 @@ COMMAND_HANDLER(handle_irscan_command)
 	int retval;
 	for (i = 0; i &lt; num_fields; i++)
 	{
-		tap = jtag_tap_by_string(args[i*2]);
+		tap = jtag_tap_by_string(CMD_ARGV[i*2]);
 		if (tap == NULL)
 		{
 			int j;
 			for (j = 0; j &lt; i; j++)
 				free(fields[j].out_value);
                         free(fields);
-			command_print(cmd_ctx, &quot;Tap: %s unknown&quot;, args[i*2]);
+			command_print(cmd_ctx, &quot;Tap: %s unknown&quot;, CMD_ARGV[i*2]);
 
 			return ERROR_FAIL;
 		}
@@ -1132,7 +1132,7 @@ COMMAND_HANDLER(handle_irscan_command)
 		fields[i].out_value = malloc(DIV_ROUND_UP(field_size, 8));
 
 		uint32_t value;
-		retval = parse_u32(args[i * 2 + 1], &amp;value);
+		retval = parse_u32(CMD_ARGV[i * 2 + 1], &amp;value);
 		if (ERROR_OK != retval)
 			goto error_return;
 		buf_set_u32(fields[i].out_value, 0, field_size, value);
@@ -1357,9 +1357,9 @@ COMMAND_HANDLER(handle_verify_ircapture_command)
 
 	if (CMD_ARGC == 1)
 	{
-		if (strcmp(args[0], &quot;enable&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;enable&quot;) == 0)
 			jtag_set_verify_capture_ir(true);
-		else if (strcmp(args[0], &quot;disable&quot;) == 0)
+		else if (strcmp(CMD_ARGV[0], &quot;disable&quot;) == 0)
 			jtag_set_verify_capture_ir(false);
 		else
 			return ERROR_COMMAND_SYNTAX_ERROR;
@@ -1378,9 +1378,9 @@ COMMAND_HANDLER(handle_verify_jtag_command)
 
 	if (CMD_ARGC == 1)
 	{
-		if (strcmp(args[0], &quot;enable&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;enable&quot;) == 0)
 			jtag_set_verify(true);
-		else if (strcmp(args[0], &quot;disable&quot;) == 0)
+		else if (strcmp(CMD_ARGV[0], &quot;disable&quot;) == 0)
 			jtag_set_verify(false);
 		else
 			return ERROR_COMMAND_SYNTAX_ERROR;
@@ -1400,9 +1400,9 @@ COMMAND_HANDLER(handle_tms_sequence_command)
 	if (CMD_ARGC == 1)
 	{
 		bool use_new_table;
-		if (strcmp(args[0], &quot;short&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;short&quot;) == 0)
 			use_new_table = true;
-		else if (strcmp(args[0], &quot;long&quot;) == 0)
+		else if (strcmp(CMD_ARGV[0], &quot;long&quot;) == 0)
 			use_new_table = false;
 		else
 			return ERROR_COMMAND_SYNTAX_ERROR;
diff --git a/src/jtag/vsllink.c b/src/jtag/vsllink.c
index cbea995..7962249 100644
--- a/src/jtag/vsllink.c
+++ b/src/jtag/vsllink.c
@@ -1329,17 +1329,17 @@ COMMAND_HANDLER(vsllink_handle_mode_command)
 		return ERROR_FAIL;
 	}
 
-	if (!strcmp(args[0], &quot;normal&quot;))
+	if (!strcmp(CMD_ARGV[0], &quot;normal&quot;))
 	{
 		vsllink_mode = VSLLINK_MODE_NORMAL;
 	}
-	else if (!strcmp(args[0], &quot;dma&quot;))
+	else if (!strcmp(CMD_ARGV[0], &quot;dma&quot;))
 	{
 		vsllink_mode = VSLLINK_MODE_DMA;
 	}
 	else
 	{
-		LOG_ERROR(&quot;invalid vsllink_mode: %s&quot;, args[0]);
+		LOG_ERROR(&quot;invalid vsllink_mode: %s&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
@@ -1354,7 +1354,7 @@ COMMAND_HANDLER(vsllink_handle_usb_vid_command)
 		return ERROR_OK;
 	}
 
-	COMMAND_PARSE_NUMBER(u16, args[0], vsllink_usb_vid);
+	COMMAND_PARSE_NUMBER(u16, CMD_ARGV[0], vsllink_usb_vid);
 	return ERROR_OK;
 }
 
@@ -1365,7 +1365,7 @@ COMMAND_HANDLER(vsllink_handle_usb_pid_command)
 		LOG_ERROR(&quot;parameter error, should be one parameter for PID&quot;);
 		return ERROR_OK;
 	}
-	COMMAND_PARSE_NUMBER(u16, args[0], vsllink_usb_pid);
+	COMMAND_PARSE_NUMBER(u16, CMD_ARGV[0], vsllink_usb_pid);
 	return ERROR_OK;
 }
 
@@ -1377,7 +1377,7 @@ COMMAND_HANDLER(vsllink_handle_usb_bulkin_command)
 		return ERROR_OK;
 	}
 
-	COMMAND_PARSE_NUMBER(u8, args[0], vsllink_usb_bulkin);
+	COMMAND_PARSE_NUMBER(u8, CMD_ARGV[0], vsllink_usb_bulkin);
 
 	vsllink_usb_bulkin |= 0x80;
 
@@ -1392,7 +1392,7 @@ COMMAND_HANDLER(vsllink_handle_usb_bulkout_command)
 		return ERROR_OK;
 	}
 
-	COMMAND_PARSE_NUMBER(u8, args[0], vsllink_usb_bulkout);
+	COMMAND_PARSE_NUMBER(u8, CMD_ARGV[0], vsllink_usb_bulkout);
 
 	vsllink_usb_bulkout &amp;= ~0x80;
 
@@ -1407,7 +1407,7 @@ COMMAND_HANDLER(vsllink_handle_usb_interface_command)
 		return ERROR_OK;
 	}
 
-	COMMAND_PARSE_NUMBER(u8, args[0], vsllink_usb_interface);
+	COMMAND_PARSE_NUMBER(u8, CMD_ARGV[0], vsllink_usb_interface);
 	return ERROR_OK;
 }
 
diff --git a/src/pld/pld.c b/src/pld/pld.c
index 178da97..96d37f1 100644
--- a/src/pld/pld.c
+++ b/src/pld/pld.c
@@ -70,14 +70,14 @@ COMMAND_HANDLER(handle_pld_device_command)
 
 	for (i = 0; pld_drivers[i]; i++)
 	{
-		if (strcmp(args[0], pld_drivers[i]-&gt;name) == 0)
+		if (strcmp(CMD_ARGV[0], pld_drivers[i]-&gt;name) == 0)
 		{
 			struct pld_device *p, *c;
 
 			/* register pld specific commands */
 			if (pld_drivers[i]-&gt;register_commands(cmd_ctx) != ERROR_OK)
 			{
-				LOG_ERROR(&quot;couldn't register '%s' commands&quot;, args[0]);
+				LOG_ERROR(&quot;couldn't register '%s' commands&quot;, CMD_ARGV[0]);
 				exit(-1);
 			}
 
@@ -88,7 +88,7 @@ COMMAND_HANDLER(handle_pld_device_command)
 			int retval = CALL_COMMAND_HANDLER(pld_drivers[i]-&gt;pld_device_command, c);
 			if (ERROR_OK != retval)
 			{
-				LOG_ERROR(&quot;'%s' driver rejected pld device&quot;, args[0]);
+				LOG_ERROR(&quot;'%s' driver rejected pld device&quot;, CMD_ARGV[0]);
 				free(c);
 				return ERROR_OK;
 			}
@@ -113,7 +113,7 @@ COMMAND_HANDLER(handle_pld_device_command)
 	/* no matching pld driver found */
 	if (!found)
 	{
-		LOG_ERROR(&quot;pld driver '%s' not found&quot;, args[0]);
+		LOG_ERROR(&quot;pld driver '%s' not found&quot;, CMD_ARGV[0]);
 		exit(-1);
 	}
 
@@ -154,18 +154,18 @@ COMMAND_HANDLER(handle_pld_load_command)
 	}
 
 	unsigned dev_id;
-	COMMAND_PARSE_NUMBER(uint, args[0], dev_id);
+	COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], dev_id);
 	p = get_pld_device_by_num(dev_id);
 	if (!p)
 	{
-		command_print(cmd_ctx, &quot;pld device '#%s' is out of bounds&quot;, args[0]);
+		command_print(cmd_ctx, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
-	if ((retval = p-&gt;driver-&gt;load(p, args[1])) != ERROR_OK)
+	if ((retval = p-&gt;driver-&gt;load(p, CMD_ARGV[1])) != ERROR_OK)
 	{
 		command_print(cmd_ctx, &quot;failed loading file %s to pld device %u&quot;,
-			args[1], dev_id);
+			CMD_ARGV[1], dev_id);
 		switch (retval)
 		{
 		}
@@ -177,7 +177,7 @@ COMMAND_HANDLER(handle_pld_load_command)
 		timeval_subtract(&amp;duration, &amp;end, &amp;start);
 
 		command_print(cmd_ctx, &quot;loaded file %s to pld device %u in %jis %jius&quot;,
-			args[1], dev_id,
+			CMD_ARGV[1], dev_id,
 			(intmax_t)duration.tv_sec, (intmax_t)duration.tv_usec);
 	}
 
diff --git a/src/pld/virtex2.c b/src/pld/virtex2.c
index a6587dd..b4593cc 100644
--- a/src/pld/virtex2.c
+++ b/src/pld/virtex2.c
@@ -190,11 +190,11 @@ COMMAND_HANDLER(virtex2_handle_read_stat_command)
 	}
 
 	unsigned dev_id;
-	COMMAND_PARSE_NUMBER(uint, args[0], dev_id);
+	COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], dev_id);
 	device = get_pld_device_by_num(dev_id);
 	if (!device)
 	{
-		command_print(cmd_ctx, &quot;pld device '#%s' is out of bounds&quot;, args[0]);
+		command_print(cmd_ctx, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -219,9 +219,9 @@ PLD_DEVICE_COMMAND_HANDLER(virtex2_pld_device_command)
 		return ERROR_PLD_DEVICE_INVALID;
 	}
 
-	tap = jtag_tap_by_string(args[1]);
+	tap = jtag_tap_by_string(CMD_ARGV[1]);
 	if (tap == NULL) {
-		command_print(cmd_ctx, &quot;Tap: %s does not exist&quot;, args[1]);
+		command_print(cmd_ctx, &quot;Tap: %s does not exist&quot;, CMD_ARGV[1]);
 		return ERROR_OK;
 	}
 
diff --git a/src/server/gdb_server.c b/src/server/gdb_server.c
index f5eb71d..716e1cf 100644
--- a/src/server/gdb_server.c
+++ b/src/server/gdb_server.c
@@ -2272,18 +2272,18 @@ COMMAND_HANDLER(handle_gdb_memory_map_command)
 {
 	if (CMD_ARGC == 1)
 	{
-		if (strcmp(args[0], &quot;enable&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;enable&quot;) == 0)
 		{
 			gdb_use_memory_map = 1;
 			return ERROR_OK;
 		}
-		else if (strcmp(args[0], &quot;disable&quot;) == 0)
+		else if (strcmp(CMD_ARGV[0], &quot;disable&quot;) == 0)
 		{
 			gdb_use_memory_map = 0;
 			return ERROR_OK;
 		}
 		else
-			LOG_WARNING(&quot;invalid gdb_memory_map configuration directive %s&quot;, args[0]);
+			LOG_WARNING(&quot;invalid gdb_memory_map configuration directive %s&quot;, CMD_ARGV[0]);
 	}
 
 	return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2293,18 +2293,18 @@ COMMAND_HANDLER(handle_gdb_flash_program_command)
 {
 	if (CMD_ARGC == 1)
 	{
-		if (strcmp(args[0], &quot;enable&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;enable&quot;) == 0)
 		{
 			gdb_flash_program = 1;
 			return ERROR_OK;
 		}
-		else if (strcmp(args[0], &quot;disable&quot;) == 0)
+		else if (strcmp(CMD_ARGV[0], &quot;disable&quot;) == 0)
 		{
 			gdb_flash_program = 0;
 			return ERROR_OK;
 		}
 		else
-			LOG_WARNING(&quot;invalid gdb_flash_program configuration directive: %s&quot;, args[0]);
+			LOG_WARNING(&quot;invalid gdb_flash_program configuration directive: %s&quot;, CMD_ARGV[0]);
 	}
 
 	return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2314,18 +2314,18 @@ COMMAND_HANDLER(handle_gdb_report_data_abort_command)
 {
 	if (CMD_ARGC == 1)
 	{
-		if (strcmp(args[0], &quot;enable&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;enable&quot;) == 0)
 		{
 			gdb_report_data_abort = 1;
 			return ERROR_OK;
 		}
-		else if (strcmp(args[0], &quot;disable&quot;) == 0)
+		else if (strcmp(CMD_ARGV[0], &quot;disable&quot;) == 0)
 		{
 			gdb_report_data_abort = 0;
 			return ERROR_OK;
 		}
 		else
-			LOG_WARNING(&quot;invalid gdb_report_data_abort configuration directive: %s&quot;, args[0]);
+			LOG_WARNING(&quot;invalid gdb_report_data_abort configuration directive: %s&quot;, CMD_ARGV[0]);
 	}
 
 	return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2340,13 +2340,13 @@ COMMAND_HANDLER(handle_gdb_breakpoint_override_command)
 	} else if (CMD_ARGC == 1)
 	{
 		gdb_breakpoint_override = 1;
-		if (strcmp(args[0], &quot;hard&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;hard&quot;) == 0)
 		{
 			gdb_breakpoint_override_type = BKPT_HARD;
-		} else if (strcmp(args[0], &quot;soft&quot;) == 0)
+		} else if (strcmp(CMD_ARGV[0], &quot;soft&quot;) == 0)
 		{
 			gdb_breakpoint_override_type = BKPT_SOFT;
-		} else if (strcmp(args[0], &quot;disable&quot;) == 0)
+		} else if (strcmp(CMD_ARGV[0], &quot;disable&quot;) == 0)
 		{
 			gdb_breakpoint_override = 0;
 		}
diff --git a/src/server/httpd.c b/src/server/httpd.c
index d8659b0..1c5e6d2 100644
--- a/src/server/httpd.c
+++ b/src/server/httpd.c
@@ -109,7 +109,7 @@ static int httpd_Jim_Command_writeform(Jim_Interp *interp, int argc,
 {
 	if (argc != 3)
 	{
-		Jim_WrongNumArgs(interp, 1, argv, &quot;method ?args ...?&quot;);
+		Jim_WrongNumArgs(interp, 1, argv, &quot;method ?CMD_ARGV ...?&quot;);
 		return JIM_ERR;
 	}
 	char *name = (char*) Jim_GetString(argv[1], NULL);
@@ -156,7 +156,7 @@ httpd_Jim_Command_formfetch(Jim_Interp *interp,
 {
     if (argc != 2)
     {
-        Jim_WrongNumArgs(interp, 1, argv, &quot;method ?args ...?&quot;);
+        Jim_WrongNumArgs(interp, 1, argv, &quot;method ?CMD_ARGV ...?&quot;);
         return JIM_ERR;
     }
     char *name = (char*)Jim_GetString(argv[1], NULL);
diff --git a/src/server/server.c b/src/server/server.c
index 17a116d..258c89b 100644
--- a/src/server/server.c
+++ b/src/server/server.c
@@ -558,7 +558,7 @@ SERVER_PORT_COMMAND()
 	case 1:
 	{
 		uint16_t port;
-		COMMAND_PARSE_NUMBER(u16, args[0], port);
+		COMMAND_PARSE_NUMBER(u16, CMD_ARGV[0], port);
 		*out = port;
 		break;
 	}
diff --git a/src/svf/svf.c b/src/svf/svf.c
index c51e609..45f3493 100644
--- a/src/svf/svf.c
+++ b/src/svf/svf.c
@@ -318,28 +318,28 @@ COMMAND_HANDLER(handle_svf_command)
 	svf_quiet = 0;
 	for (unsigned i = 1; i &lt; CMD_ARGC; i++)
 	{
-		if (!strcmp(args[i], &quot;quiet&quot;))
+		if (!strcmp(CMD_ARGV[i], &quot;quiet&quot;))
 		{
 			svf_quiet = 1;
 		}
 		else
 		{
-			LOG_ERROR(&quot;unknown variant for svf: %s&quot;, args[i]);
+			LOG_ERROR(&quot;unknown variant for svf: %s&quot;, CMD_ARGV[i]);
 
 			// no need to free anything now
 			return ERROR_FAIL;
 		}
 	}
 
-	if ((svf_fd = open(args[0], O_RDONLY)) &lt; 0)
+	if ((svf_fd = open(CMD_ARGV[0], O_RDONLY)) &lt; 0)
 	{
-		command_print(cmd_ctx, &quot;file \&quot;%s\&quot; not found&quot;, args[0]);
+		command_print(cmd_ctx, &quot;file \&quot;%s\&quot; not found&quot;, CMD_ARGV[0]);
 
 		// no need to free anything now
 		return ERROR_FAIL;
 	}
 
-	LOG_USER(&quot;svf processing file: \&quot;%s\&quot;&quot;, args[0]);
+	LOG_USER(&quot;svf processing file: \&quot;%s\&quot;&quot;, CMD_ARGV[0]);
 
 	// get time
 	time_ago = timeval_ms();
diff --git a/src/target/arm11.c b/src/target/arm11.c
index 4236ac8..65e0780 100644
--- a/src/target/arm11.c
+++ b/src/target/arm11.c
@@ -2014,7 +2014,7 @@ static COMMAND_HELPER(arm11_handle_bool, bool *var, char *name)
 	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	switch (args[0][0])
+	switch (CMD_ARGV[0][0])
 	{
 	case '0':	/* 0 */
 	case 'f':	/* false */
@@ -2056,7 +2056,7 @@ COMMAND_HANDLER(arm11_handle_vcr)
 	case 0:
 		break;
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], arm11_vcr);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], arm11_vcr);
 		break;
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
diff --git a/src/target/arm720t.c b/src/target/arm720t.c
index 53d2224..a0cde5d 100644
--- a/src/target/arm720t.c
+++ b/src/target/arm720t.c
@@ -432,7 +432,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 	if (CMD_ARGC &gt;= 1)
 	{
 		uint32_t opcode;
-		COMMAND_PARSE_NUMBER(u32, args[0], opcode);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], opcode);
 
 		if (CMD_ARGC == 1)
 		{
@@ -453,7 +453,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
-			COMMAND_PARSE_NUMBER(u32, args[1], value);
+			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 
 			if ((retval = arm720t_write_cp15(target, opcode, value)) != ERROR_OK)
 			{
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index 19c9791..bd018b4 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2771,8 +2771,8 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_command)
 		return ERROR_FAIL;
 	}
 
-	COMMAND_PARSE_NUMBER(u32, args[0], value);
-	COMMAND_PARSE_NUMBER(int, args[1], spsr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], value);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], spsr);
 
 	/* if we're writing the CPSR, mask the T bit */
 	if (!spsr)
@@ -2815,9 +2815,9 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_im8_command)
 		return ERROR_FAIL;
 	}
 
-	COMMAND_PARSE_NUMBER(u32, args[0], value);
-	COMMAND_PARSE_NUMBER(int, args[1], rotate);
-	COMMAND_PARSE_NUMBER(int, args[2], spsr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], value);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], rotate);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[2], spsr);
 
 	arm7_9-&gt;write_xpsr_im8(target, value, rotate, spsr);
 	if ((retval = jtag_execute_queue()) != ERROR_OK)
@@ -2855,9 +2855,9 @@ COMMAND_HANDLER(handle_arm7_9_write_core_reg_command)
 		return ERROR_FAIL;
 	}
 
-	COMMAND_PARSE_NUMBER(int, args[0], num);
-	COMMAND_PARSE_NUMBER(u32, args[1], mode);
-	COMMAND_PARSE_NUMBER(u32, args[2], value);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[0], num);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], mode);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], value);
 
 	return arm7_9_write_core_reg(target, num, mode, value);
 }
@@ -2875,11 +2875,11 @@ COMMAND_HANDLER(handle_arm7_9_dbgrq_command)
 
 	if (CMD_ARGC &gt; 0)
 	{
-		if (strcmp(&quot;enable&quot;, args[0]) == 0)
+		if (strcmp(&quot;enable&quot;, CMD_ARGV[0]) == 0)
 		{
 			arm7_9-&gt;use_dbgrq = 1;
 		}
-		else if (strcmp(&quot;disable&quot;, args[0]) == 0)
+		else if (strcmp(&quot;disable&quot;, CMD_ARGV[0]) == 0)
 		{
 			arm7_9-&gt;use_dbgrq = 0;
 		}
@@ -2907,11 +2907,11 @@ COMMAND_HANDLER(handle_arm7_9_fast_memory_access_command)
 
 	if (CMD_ARGC &gt; 0)
 	{
-		if (strcmp(&quot;enable&quot;, args[0]) == 0)
+		if (strcmp(&quot;enable&quot;, CMD_ARGV[0]) == 0)
 		{
 			arm7_9-&gt;fast_memory_access = 1;
 		}
-		else if (strcmp(&quot;disable&quot;, args[0]) == 0)
+		else if (strcmp(&quot;disable&quot;, CMD_ARGV[0]) == 0)
 		{
 			arm7_9-&gt;fast_memory_access = 0;
 		}
@@ -2939,11 +2939,11 @@ COMMAND_HANDLER(handle_arm7_9_dcc_downloads_command)
 
 	if (CMD_ARGC &gt; 0)
 	{
-		if (strcmp(&quot;enable&quot;, args[0]) == 0)
+		if (strcmp(&quot;enable&quot;, CMD_ARGV[0]) == 0)
 		{
 			arm7_9-&gt;dcc_downloads = 1;
 		}
-		else if (strcmp(&quot;disable&quot;, args[0]) == 0)
+		else if (strcmp(&quot;disable&quot;, CMD_ARGV[0]) == 0)
 		{
 			arm7_9-&gt;dcc_downloads = 0;
 		}
diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index 58e92c3..fbb8d7f 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -688,7 +688,7 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 		return ERROR_OK;
 	}
 
-	if ((output = fopen(args[0], &quot;w&quot;)) == NULL)
+	if ((output = fopen(CMD_ARGV[0], &quot;w&quot;)) == NULL)
 	{
 		LOG_DEBUG(&quot;error opening cache content file&quot;);
 		return ERROR_OK;
@@ -885,7 +885,7 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 	/* restore CP15 MMU and Cache settings */
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl_saved);
 
-	command_print(cmd_ctx, &quot;cache content successfully output to %s&quot;, args[0]);
+	command_print(cmd_ctx, &quot;cache content successfully output to %s&quot;, CMD_ARGV[0]);
 
 	fclose(output);
 
@@ -934,7 +934,7 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 		return ERROR_OK;
 	}
 
-	if ((output = fopen(args[0], &quot;w&quot;)) == NULL)
+	if ((output = fopen(CMD_ARGV[0], &quot;w&quot;)) == NULL)
 	{
 		LOG_DEBUG(&quot;error opening mmu content file&quot;);
 		return ERROR_OK;
@@ -1168,7 +1168,7 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 		fprintf(output, &quot;%i: 0x%8.8&quot; PRIx32 &quot; 0x%8.8&quot; PRIx32 &quot; 0x%8.8&quot; PRIx32 &quot; %s\n&quot;, i, i_tlb[i].cam, i_tlb[i].ram1, i_tlb[i].ram2, (i_tlb[i].cam &amp; 0x20) ? &quot;(valid)&quot; : &quot;(invalid)&quot;);
 	}
 
-	command_print(cmd_ctx, &quot;mmu content successfully output to %s&quot;, args[0]);
+	command_print(cmd_ctx, &quot;mmu content successfully output to %s&quot;, CMD_ARGV[0]);
 
 	fclose(output);
 
@@ -1210,7 +1210,7 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 	if (CMD_ARGC &gt;= 1)
 	{
 		int address;
-		COMMAND_PARSE_NUMBER(int, args[0], address);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[0], address);
 
 		if (CMD_ARGC == 1)
 		{
@@ -1230,7 +1230,7 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
-			COMMAND_PARSE_NUMBER(u32, args[1], value);
+			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			if ((retval = arm920t_write_cp15_physical(target, address, value)) != ERROR_OK)
 			{
 				command_print(cmd_ctx, &quot;couldn't access reg %i&quot;, address);
@@ -1264,7 +1264,7 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 	if (CMD_ARGC &gt;= 1)
 	{
 		uint32_t opcode;
-		COMMAND_PARSE_NUMBER(u32, args[0], opcode);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], opcode);
 
 		if (CMD_ARGC == 1)
 		{
@@ -1280,7 +1280,7 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
-			COMMAND_PARSE_NUMBER(u32, args[1], value);
+			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			if ((retval = arm920t_write_cp15_interpreted(target, opcode, value, 0)) != ERROR_OK)
 			{
 				command_print(cmd_ctx, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
@@ -1291,9 +1291,9 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 		else if (CMD_ARGC == 3)
 		{
 			uint32_t value;
-			COMMAND_PARSE_NUMBER(u32, args[1], value);
+			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			uint32_t address;
-			COMMAND_PARSE_NUMBER(u32, args[2], address);
+			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], address);
 			if ((retval = arm920t_write_cp15_interpreted(target, opcode, value, address)) != ERROR_OK)
 			{
 				command_print(cmd_ctx, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
diff --git a/src/target/arm926ejs.c b/src/target/arm926ejs.c
index 4e20664..6678054 100644
--- a/src/target/arm926ejs.c
+++ b/src/target/arm926ejs.c
@@ -728,10 +728,10 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 		return ERROR_OK;
 	}
 
-	COMMAND_PARSE_NUMBER(int, args[0], opcode_1);
-	COMMAND_PARSE_NUMBER(int, args[1], opcode_2);
-	COMMAND_PARSE_NUMBER(int, args[2], CRn);
-	COMMAND_PARSE_NUMBER(int, args[3], CRm);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[0], opcode_1);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], opcode_2);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[2], CRn);
+	COMMAND_PARSE_NUMBER(int, CMD_ARGV[3], CRm);
 
 	retval = arm926ejs_verify_pointer(cmd_ctx, arm926ejs);
 	if (retval != ERROR_OK)
@@ -761,7 +761,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 	else
 	{
 		uint32_t value;
-		COMMAND_PARSE_NUMBER(u32, args[4], value);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[4], value);
 		if ((retval = arm926ejs-&gt;write_cp15(target, opcode_1, opcode_2, CRn, CRm, value)) != ERROR_OK)
 		{
 			command_print(cmd_ctx, &quot;couldn't access register&quot;);
diff --git a/src/target/arm966e.c b/src/target/arm966e.c
index 0c08a60..ffc65cd 100644
--- a/src/target/arm966e.c
+++ b/src/target/arm966e.c
@@ -182,7 +182,7 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 	if (CMD_ARGC &gt;= 1)
 	{
 		uint32_t address;
-		COMMAND_PARSE_NUMBER(u32, args[0], address);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 
 		if (CMD_ARGC == 1)
 		{
@@ -205,7 +205,7 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
-			COMMAND_PARSE_NUMBER(u32, args[1], value);
+			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			if ((retval = arm966e_write_cp15(target, address, value)) != ERROR_OK)
 			{
 				command_print(cmd_ctx,
diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index b582eae..3f074be 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -856,11 +856,11 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 	if (CMD_ARGC &gt; 0)
 	{
 		vector_catch_value = 0x0;
-		if (strcmp(args[0], &quot;all&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;all&quot;) == 0)
 		{
 			vector_catch_value = 0xdf;
 		}
-		else if (strcmp(args[0], &quot;none&quot;) == 0)
+		else if (strcmp(CMD_ARGV[0], &quot;none&quot;) == 0)
 		{
 			/* do nothing */
 		}
@@ -872,7 +872,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 				unsigned j;
 				for (j = 0; arm9tdmi_vectors[j].name; j++)
 				{
-					if (strcmp(args[i], arm9tdmi_vectors[j].name) == 0)
+					if (strcmp(CMD_ARGV[i], arm9tdmi_vectors[j].name) == 0)
 					{
 						vector_catch_value |= arm9tdmi_vectors[j].value;
 						break;
@@ -882,7 +882,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 				/* complain if vector wasn't found */
 				if (!arm9tdmi_vectors[j].name)
 				{
-					command_print(cmd_ctx, &quot;vector '%s' not found, leaving current setting unchanged&quot;, args[i]);
+					command_print(cmd_ctx, &quot;vector '%s' not found, leaving current setting unchanged&quot;, CMD_ARGV[i]);
 
 					/* reread current setting */
 					vector_catch_value = buf_get_u32(
diff --git a/src/target/arm_adi_v5.c b/src/target/arm_adi_v5.c
index dcae818..7f4bc58 100644
--- a/src/target/arm_adi_v5.c
+++ b/src/target/arm_adi_v5.c
@@ -1375,7 +1375,7 @@ DAP_COMMAND_HANDLER(dap_baseaddr_command)
 		apsel = swjdp-&gt;apsel;
 		break;
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], apsel);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], apsel);
 		break;
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -1403,7 +1403,7 @@ DAP_COMMAND_HANDLER(dap_memaccess_command)
 		memaccess_tck = swjdp-&gt;memaccess_tck;
 		break;
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], memaccess_tck);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], memaccess_tck);
 		break;
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -1426,7 +1426,7 @@ DAP_COMMAND_HANDLER(dap_apsel_command)
 		apsel = 0;
 		break;
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], apsel);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], apsel);
 		break;
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -1452,7 +1452,7 @@ DAP_COMMAND_HANDLER(dap_apid_command)
 		apsel = swjdp-&gt;apsel;
 		break;
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], apsel);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], apsel);
 		break;
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 4c2a6e5..5f0fe42 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -424,11 +424,11 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
 
 	if (CMD_ARGC &gt; 0)
 	{
-		if (strcmp(args[0], &quot;arm&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;arm&quot;) == 0)
 		{
 			armv4_5-&gt;core_state = ARMV4_5_STATE_ARM;
 		}
-		if (strcmp(args[0], &quot;thumb&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;thumb&quot;) == 0)
 		{
 			armv4_5-&gt;core_state = ARMV4_5_STATE_THUMB;
 		}
@@ -455,15 +455,15 @@ COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 
 	switch (CMD_ARGC) {
 	case 3:
-		if (strcmp(args[2], &quot;thumb&quot;) != 0)
+		if (strcmp(CMD_ARGV[2], &quot;thumb&quot;) != 0)
 			goto usage;
 		thumb = 1;
 		/* FALL THROUGH */
 	case 2:
-		COMMAND_PARSE_NUMBER(int, args[1], count);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], count);
 		/* FALL THROUGH */
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], address);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 		if (address &amp; 0x01) {
 			if (!thumb) {
 				command_print(cmd_ctx, &quot;Disassemble as Thumb&quot;);
diff --git a/src/target/armv7a.c b/src/target/armv7a.c
index 31ab4b4..7f5b834 100644
--- a/src/target/armv7a.c
+++ b/src/target/armv7a.c
@@ -264,7 +264,7 @@ COMMAND_HANDLER(handle_dap_info_command)
 		apsel = swjdp-&gt;apsel;
 		break;
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], apsel);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], apsel);
 		break;
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
diff --git a/src/target/armv7m.c b/src/target/armv7m.c
index e9d46df..4fe5794 100644
--- a/src/target/armv7m.c
+++ b/src/target/armv7m.c
@@ -771,7 +771,7 @@ COMMAND_HANDLER(handle_dap_baseaddr_command)
 		apsel = swjdp-&gt;apsel;
 		break;
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], apsel);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], apsel);
 		break;
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -834,7 +834,7 @@ COMMAND_HANDLER(handle_dap_info_command)
 		apsel = swjdp-&gt;apsel;
 		break;
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], apsel);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], apsel);
 		break;
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
diff --git a/src/target/cortex_m3.c b/src/target/cortex_m3.c
index 0584434..9cb4b98 100644
--- a/src/target/cortex_m3.c
+++ b/src/target/cortex_m3.c
@@ -1782,10 +1782,10 @@ COMMAND_HANDLER(handle_cortex_m3_disassemble_command)
 	errno = 0;
 	switch (CMD_ARGC) {
 	case 2:
-		COMMAND_PARSE_NUMBER(ulong, args[1], count);
+		COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[1], count);
 		/* FALL THROUGH */
 	case 1:
-		COMMAND_PARSE_NUMBER(u32, args[0], address);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 		break;
 	default:
 		command_print(cmd_ctx,
@@ -1836,25 +1836,25 @@ COMMAND_HANDLER(handle_cortex_m3_vector_catch_command)
 		unsigned catch = 0;
 
 		if (CMD_ARGC == 1) {
-			if (strcmp(args[0], &quot;all&quot;) == 0) {
+			if (strcmp(CMD_ARGV[0], &quot;all&quot;) == 0) {
 				catch = VC_HARDERR | VC_INTERR | VC_BUSERR
 					| VC_STATERR | VC_CHKERR | VC_NOCPERR
 					| VC_MMERR | VC_CORERESET;
 				goto write;
-			} else if (strcmp(args[0], &quot;none&quot;) == 0) {
+			} else if (strcmp(CMD_ARGV[0], &quot;none&quot;) == 0) {
 				goto write;
 			}
 		}
 		while (CMD_ARGC-- &gt; 0) {
 			unsigned i;
 			for (i = 0; i &lt; ARRAY_SIZE(vec_ids); i++) {
-				if (strcmp(args[CMD_ARGC], vec_ids[i].name) != 0)
+				if (strcmp(CMD_ARGV[CMD_ARGC], vec_ids[i].name) != 0)
 					continue;
 				catch |= vec_ids[i].mask;
 				break;
 			}
 			if (i == ARRAY_SIZE(vec_ids)) {
-				LOG_ERROR(&quot;No CM3 vector '%s'&quot;, args[CMD_ARGC]);
+				LOG_ERROR(&quot;No CM3 vector '%s'&quot;, CMD_ARGV[CMD_ARGC]);
 				return ERROR_INVALID_ARGUMENTS;
 			}
 		}
@@ -1892,11 +1892,11 @@ COMMAND_HANDLER(handle_cortex_m3_mask_interrupts_command)
 
 	if (CMD_ARGC &gt; 0)
 	{
-		if (!strcmp(args[0], &quot;on&quot;))
+		if (!strcmp(CMD_ARGV[0], &quot;on&quot;))
 		{
 			cortex_m3_write_debug_halt_mask(target, C_HALT | C_MASKINTS, 0);
 		}
-		else if (!strcmp(args[0], &quot;off&quot;))
+		else if (!strcmp(CMD_ARGV[0], &quot;off&quot;))
 		{
 			cortex_m3_write_debug_halt_mask(target, C_HALT, C_MASKINTS);
 		}
diff --git a/src/target/etb.c b/src/target/etb.c
index 2ad5156..25d6d0b 100644
--- a/src/target/etb.c
+++ b/src/target/etb.c
@@ -359,25 +359,25 @@ COMMAND_HANDLER(handle_etb_config_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	target = get_target(args[0]);
+	target = get_target(CMD_ARGV[0]);
 
 	if (!target)
 	{
-		LOG_ERROR(&quot;ETB: target '%s' not defined&quot;, args[0]);
+		LOG_ERROR(&quot;ETB: target '%s' not defined&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETB: '%s' isn't an ARM&quot;, args[0]);
+		command_print(cmd_ctx, &quot;ETB: '%s' isn't an ARM&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
-	tap = jtag_tap_by_string(args[1]);
+	tap = jtag_tap_by_string(CMD_ARGV[1]);
 	if (tap == NULL)
 	{
-		command_print(cmd_ctx, &quot;ETB: TAP %s does not exist&quot;, args[1]);
+		command_print(cmd_ctx, &quot;ETB: TAP %s does not exist&quot;, CMD_ARGV[1]);
 		return ERROR_FAIL;
 	}
 
diff --git a/src/target/etm.c b/src/target/etm.c
index 044ccb0..72e8b3d 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -1179,22 +1179,22 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 	etmv1_tracemode_t tracemode;
 
 	/* what parts of data access are traced? */
-	if (strcmp(args[0], &quot;none&quot;) == 0)
+	if (strcmp(CMD_ARGV[0], &quot;none&quot;) == 0)
 		tracemode = ETMV1_TRACE_NONE;
-	else if (strcmp(args[0], &quot;data&quot;) == 0)
+	else if (strcmp(CMD_ARGV[0], &quot;data&quot;) == 0)
 		tracemode = ETMV1_TRACE_DATA;
-	else if (strcmp(args[0], &quot;address&quot;) == 0)
+	else if (strcmp(CMD_ARGV[0], &quot;address&quot;) == 0)
 		tracemode = ETMV1_TRACE_ADDR;
-	else if (strcmp(args[0], &quot;all&quot;) == 0)
+	else if (strcmp(CMD_ARGV[0], &quot;all&quot;) == 0)
 		tracemode = ETMV1_TRACE_DATA | ETMV1_TRACE_ADDR;
 	else
 	{
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, args[0]);
+		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[0]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
 	uint8_t context_id;
-	COMMAND_PARSE_NUMBER(u8, args[1], context_id);
+	COMMAND_PARSE_NUMBER(u8, CMD_ARGV[1], context_id);
 	switch (context_id)
 	{
 	case 0:
@@ -1210,27 +1210,27 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 		tracemode |= ETMV1_CONTEXTID_32;
 		break;
 	default:
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, args[1]);
+		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[1]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
-	if (strcmp(args[2], &quot;enable&quot;) == 0)
+	if (strcmp(CMD_ARGV[2], &quot;enable&quot;) == 0)
 		tracemode |= ETMV1_CYCLE_ACCURATE;
-	else if (strcmp(args[2], &quot;disable&quot;) == 0)
+	else if (strcmp(CMD_ARGV[2], &quot;disable&quot;) == 0)
 		tracemode |= 0;
 	else
 	{
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, args[2]);
+		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[2]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
-	if (strcmp(args[3], &quot;enable&quot;) == 0)
+	if (strcmp(CMD_ARGV[3], &quot;enable&quot;) == 0)
 		tracemode |= ETMV1_BRANCH_OUTPUT;
-	else if (strcmp(args[3], &quot;disable&quot;) == 0)
+	else if (strcmp(CMD_ARGV[3], &quot;disable&quot;) == 0)
 		tracemode |= 0;
 	else
 	{
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, args[3]);
+		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[3]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1377,10 +1377,10 @@ COMMAND_HANDLER(handle_etm_config_command)
 	if (CMD_ARGC != 5)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	target = get_target(args[0]);
+	target = get_target(CMD_ARGV[0]);
 	if (!target)
 	{
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[0]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
@@ -1404,7 +1404,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 	 *    &quot;normal full&quot; ...
 	 */
 	uint8_t port_width;
-	COMMAND_PARSE_NUMBER(u8, args[1], port_width);
+	COMMAND_PARSE_NUMBER(u8, CMD_ARGV[1], port_width);
 	switch (port_width)
 	{
 		/* before ETMv3.0 */
@@ -1438,39 +1438,39 @@ COMMAND_HANDLER(handle_etm_config_command)
 			break;
 		default:
 			command_print(cmd_ctx,
-				&quot;unsupported ETM port width '%s'&quot;, args[1]);
+				&quot;unsupported ETM port width '%s'&quot;, CMD_ARGV[1]);
 			return ERROR_FAIL;
 	}
 
-	if (strcmp(&quot;normal&quot;, args[2]) == 0)
+	if (strcmp(&quot;normal&quot;, CMD_ARGV[2]) == 0)
 	{
 		portmode |= ETM_PORT_NORMAL;
 	}
-	else if (strcmp(&quot;multiplexed&quot;, args[2]) == 0)
+	else if (strcmp(&quot;multiplexed&quot;, CMD_ARGV[2]) == 0)
 	{
 		portmode |= ETM_PORT_MUXED;
 	}
-	else if (strcmp(&quot;demultiplexed&quot;, args[2]) == 0)
+	else if (strcmp(&quot;demultiplexed&quot;, CMD_ARGV[2]) == 0)
 	{
 		portmode |= ETM_PORT_DEMUXED;
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unsupported ETM port mode '%s', must be 'normal', 'multiplexed' or 'demultiplexed'&quot;, args[2]);
+		command_print(cmd_ctx, &quot;unsupported ETM port mode '%s', must be 'normal', 'multiplexed' or 'demultiplexed'&quot;, CMD_ARGV[2]);
 		return ERROR_FAIL;
 	}
 
-	if (strcmp(&quot;half&quot;, args[3]) == 0)
+	if (strcmp(&quot;half&quot;, CMD_ARGV[3]) == 0)
 	{
 		portmode |= ETM_PORT_HALF_CLOCK;
 	}
-	else if (strcmp(&quot;full&quot;, args[3]) == 0)
+	else if (strcmp(&quot;full&quot;, CMD_ARGV[3]) == 0)
 	{
 		portmode |= ETM_PORT_FULL_CLOCK;
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unsupported ETM port clocking '%s', must be 'full' or 'half'&quot;, args[3]);
+		command_print(cmd_ctx, &quot;unsupported ETM port clocking '%s', must be 'full' or 'half'&quot;, CMD_ARGV[3]);
 		return ERROR_FAIL;
 	}
 
@@ -1482,7 +1482,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 
 	for (i = 0; etm_capture_drivers[i]; i++)
 	{
-		if (strcmp(args[4], etm_capture_drivers[i]-&gt;name) == 0)
+		if (strcmp(CMD_ARGV[4], etm_capture_drivers[i]-&gt;name) == 0)
 		{
 			int retval;
 			if ((retval = etm_capture_drivers[i]-&gt;register_commands(cmd_ctx)) != ERROR_OK)
@@ -1501,7 +1501,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 	{
 		/* no supported capture driver found, don't register an ETM */
 		free(etm_ctx);
-		LOG_ERROR(&quot;trace capture driver '%s' not found&quot;, args[4]);
+		LOG_ERROR(&quot;trace capture driver '%s' not found&quot;, CMD_ARGV[4]);
 		return ERROR_FAIL;
 	}
 
@@ -1766,14 +1766,14 @@ COMMAND_HANDLER(handle_etm_image_command)
 	if (CMD_ARGC &gt;= 2)
 	{
 		etm_ctx-&gt;image-&gt;base_address_set = 1;
-		COMMAND_PARSE_NUMBER(int, args[1], etm_ctx-&gt;image-&gt;base_address);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], etm_ctx-&gt;image-&gt;base_address);
 	}
 	else
 	{
 		etm_ctx-&gt;image-&gt;base_address_set = 0;
 	}
 
-	if (image_open(etm_ctx-&gt;image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(etm_ctx-&gt;image, CMD_ARGV[0], (CMD_ARGC &gt;= 3) ? CMD_ARGV[2] : NULL) != ERROR_OK)
 	{
 		free(etm_ctx-&gt;image);
 		etm_ctx-&gt;image = NULL;
@@ -1829,7 +1829,7 @@ COMMAND_HANDLER(handle_etm_dump_command)
 	if (etm_ctx-&gt;trace_depth == 0)
 		etm_ctx-&gt;capture_driver-&gt;read_trace(etm_ctx);
 
-	if (fileio_open(&amp;file, args[0], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK)
+	if (fileio_open(&amp;file, CMD_ARGV[0], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK)
 	{
 		return ERROR_FAIL;
 	}
@@ -1886,7 +1886,7 @@ COMMAND_HANDLER(handle_etm_load_command)
 		return ERROR_FAIL;
 	}
 
-	if (fileio_open(&amp;file, args[0], FILEIO_READ, FILEIO_BINARY) != ERROR_OK)
+	if (fileio_open(&amp;file, CMD_ARGV[0], FILEIO_READ, FILEIO_BINARY) != ERROR_OK)
 	{
 		return ERROR_FAIL;
 	}
@@ -1959,7 +1959,7 @@ COMMAND_HANDLER(handle_etm_trigger_percent_command)
 	if (CMD_ARGC &gt; 0)
 	{
 		uint32_t new_value;
-		COMMAND_PARSE_NUMBER(u32, args[0], new_value);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], new_value);
 
 		if ((new_value &lt; 2) || (new_value &gt; 100))
 		{
diff --git a/src/target/etm_dummy.c b/src/target/etm_dummy.c
index b0ab1fb..ae53802 100644
--- a/src/target/etm_dummy.c
+++ b/src/target/etm_dummy.c
@@ -30,18 +30,18 @@ COMMAND_HANDLER(handle_etm_dummy_config_command)
 	struct target *target;
 	struct arm *arm;
 
-	target = get_target(args[0]);
+	target = get_target(CMD_ARGV[0]);
 
 	if (!target)
 	{
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[0]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;target '%s' isn't an ARM&quot;, args[0]);
+		command_print(cmd_ctx, &quot;target '%s' isn't an ARM&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
diff --git a/src/target/oocd_trace.c b/src/target/oocd_trace.c
index 47c2bb4..74f8955 100644
--- a/src/target/oocd_trace.c
+++ b/src/target/oocd_trace.c
@@ -316,7 +316,7 @@ COMMAND_HANDLER(handle_oocd_trace_config_command)
 		oocd_trace-&gt;etm_ctx = arm-&gt;etm;
 
 		/* copy name of TTY device used to communicate with OpenOCD + trace */
-		oocd_trace-&gt;tty = strndup(args[1], 256);
+		oocd_trace-&gt;tty = strndup(CMD_ARGV[1], 256);
 	}
 	else
 	{
diff --git a/src/target/target.c b/src/target/target.c
index 88fea17..3143180 100644
--- a/src/target/target.c
+++ b/src/target/target.c
@@ -1650,9 +1650,9 @@ COMMAND_HANDLER(handle_targets_command)
 
 	if (CMD_ARGC == 1)
 	{
-		target = get_target(args[0]);
+		target = get_target(CMD_ARGV[0]);
 		if (target == NULL) {
-			command_print(cmd_ctx,&quot;Target: %s is unknown, try one of:\n&quot;, args[0]);
+			command_print(cmd_ctx,&quot;Target: %s is unknown, try one of:\n&quot;, CMD_ARGV[0]);
 			goto DumpTargets;
 		}
 		if (!target-&gt;tap-&gt;enabled) {
@@ -1908,10 +1908,10 @@ COMMAND_HANDLER(handle_reg_command)
 	}
 
 	/* access a single register by its ordinal number */
-	if ((args[0][0] &gt;= '0') &amp;&amp; (args[0][0] &lt;= '9'))
+	if ((CMD_ARGV[0][0] &gt;= '0') &amp;&amp; (CMD_ARGV[0][0] &lt;= '9'))
 	{
 		unsigned num;
-		COMMAND_PARSE_NUMBER(uint, args[0], num);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], num);
 
 		struct reg_cache *cache = target-&gt;reg_cache;
 		count = 0;
@@ -1938,19 +1938,19 @@ COMMAND_HANDLER(handle_reg_command)
 		}
 	} else /* access a single register by its name */
 	{
-		reg = register_get_by_name(target-&gt;reg_cache, args[0], 1);
+		reg = register_get_by_name(target-&gt;reg_cache, CMD_ARGV[0], 1);
 
 		if (!reg)
 		{
-			command_print(cmd_ctx, &quot;register %s not found in current target&quot;, args[0]);
+			command_print(cmd_ctx, &quot;register %s not found in current target&quot;, CMD_ARGV[0]);
 			return ERROR_OK;
 		}
 	}
 
 	/* display a register */
-	if ((CMD_ARGC == 1) || ((CMD_ARGC == 2) &amp;&amp; !((args[1][0] &gt;= '0') &amp;&amp; (args[1][0] &lt;= '9'))))
+	if ((CMD_ARGC == 1) || ((CMD_ARGC == 2) &amp;&amp; !((CMD_ARGV[1][0] &gt;= '0') &amp;&amp; (CMD_ARGV[1][0] &lt;= '9'))))
 	{
-		if ((CMD_ARGC == 2) &amp;&amp; (strcmp(args[1], &quot;force&quot;) == 0))
+		if ((CMD_ARGC == 2) &amp;&amp; (strcmp(CMD_ARGV[1], &quot;force&quot;) == 0))
 			reg-&gt;valid = 0;
 
 		if (reg-&gt;valid == 0)
@@ -1967,7 +1967,7 @@ COMMAND_HANDLER(handle_reg_command)
 	if (CMD_ARGC == 2)
 	{
 		uint8_t *buf = malloc(DIV_ROUND_UP(reg-&gt;size, 8));
-		str_to_buf(args[1], strlen(args[1]), buf, reg-&gt;size, 0);
+		str_to_buf(CMD_ARGV[1], strlen(CMD_ARGV[1]), buf, reg-&gt;size, 0);
 
 		reg-&gt;type-&gt;set(reg, buf);
 
@@ -2007,11 +2007,11 @@ COMMAND_HANDLER(handle_poll_command)
 	}
 	else if (CMD_ARGC == 1)
 	{
-		if (strcmp(args[0], &quot;on&quot;) == 0)
+		if (strcmp(CMD_ARGV[0], &quot;on&quot;) == 0)
 		{
 			jtag_poll_set_enabled(true);
 		}
-		else if (strcmp(args[0], &quot;off&quot;) == 0)
+		else if (strcmp(CMD_ARGV[0], &quot;off&quot;) == 0)
 		{
 			jtag_poll_set_enabled(false);
 		}
@@ -2035,7 +2035,7 @@ COMMAND_HANDLER(handle_wait_halt_command)
 	unsigned ms = 5000;
 	if (1 == CMD_ARGC)
 	{
-		int retval = parse_uint(args[0], &amp;ms);
+		int retval = parse_uint(CMD_ARGV[0], &amp;ms);
 		if (ERROR_OK != retval)
 		{
 			command_print(cmd_ctx, &quot;usage: %s [seconds]&quot;, CMD_NAME);
@@ -2106,7 +2106,7 @@ COMMAND_HANDLER(handle_halt_command)
 	if (CMD_ARGC == 1)
 	{
 		unsigned wait;
-		retval = parse_uint(args[0], &amp;wait);
+		retval = parse_uint(CMD_ARGV[0], &amp;wait);
 		if (ERROR_OK != retval)
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		if (!wait)
@@ -2136,7 +2136,7 @@ COMMAND_HANDLER(handle_reset_command)
 	if (CMD_ARGC == 1)
 	{
 		const Jim_Nvp *n;
-		n = Jim_Nvp_name2value_simple(nvp_reset_modes, args[0]);
+		n = Jim_Nvp_name2value_simple(nvp_reset_modes, CMD_ARGV[0]);
 		if ((n-&gt;name == NULL) || (n-&gt;value == RESET_UNKNOWN)) {
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
@@ -2157,13 +2157,13 @@ COMMAND_HANDLER(handle_resume_command)
 	struct target *target = get_current_target(cmd_ctx);
 	target_handle_event(target, TARGET_EVENT_OLD_pre_resume);
 
-	/* with no args, resume from current pc, addr = 0,
-	 * with one arguments, addr = args[0],
+	/* with no CMD_ARGV, resume from current pc, addr = 0,
+	 * with one arguments, addr = CMD_ARGV[0],
 	 * handle breakpoints, not debugging */
 	uint32_t addr = 0;
 	if (CMD_ARGC == 1)
 	{
-		COMMAND_PARSE_NUMBER(u32, args[0], addr);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 		current = 0;
 	}
 
@@ -2177,14 +2177,14 @@ COMMAND_HANDLER(handle_step_command)
 
 	LOG_DEBUG(&quot;-&quot;);
 
-	/* with no args, step from current pc, addr = 0,
-	 * with one argument addr = args[0],
+	/* with no CMD_ARGV, step from current pc, addr = 0,
+	 * with one argument addr = CMD_ARGV[0],
 	 * handle breakpoints, debugging */
 	uint32_t addr = 0;
 	int current_pc = 1;
 	if (CMD_ARGC == 1)
 	{
-		COMMAND_PARSE_NUMBER(u32, args[0], addr);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 		current_pc = 0;
 	}
 
@@ -2256,13 +2256,13 @@ COMMAND_HANDLER(handle_md_command)
 	default: return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	bool physical=strcmp(args[0], &quot;phys&quot;)==0;
+	bool physical=strcmp(CMD_ARGV[0], &quot;phys&quot;)==0;
 	int (*fn)(struct target *target,
 			uint32_t address, uint32_t size, uint32_t count, uint8_t *buffer);
 	if (physical)
 	{
 		CMD_ARGC--;
-		args++;
+		CMD_ARGV++;
 		fn=target_read_phys_memory;
 	} else
 	{
@@ -2274,11 +2274,11 @@ COMMAND_HANDLER(handle_md_command)
 	}
 
 	uint32_t address;
-	COMMAND_PARSE_NUMBER(u32, args[0], address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 
 	unsigned count = 1;
 	if (CMD_ARGC == 2)
-		COMMAND_PARSE_NUMBER(uint, args[1], count);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[1], count);
 
 	uint8_t *buffer = calloc(count, size);
 
@@ -2298,14 +2298,14 @@ COMMAND_HANDLER(handle_mw_command)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	bool physical=strcmp(args[0], &quot;phys&quot;)==0;
+	bool physical=strcmp(CMD_ARGV[0], &quot;phys&quot;)==0;
 	int (*fn)(struct target *target,
 			uint32_t address, uint32_t size, uint32_t count, uint8_t *buffer);
 	const char *cmd_name = CMD_NAME;
 	if (physical)
 	{
 		CMD_ARGC--;
-		args++;
+		CMD_ARGV++;
 		fn=target_write_phys_memory;
 	} else
 	{
@@ -2315,14 +2315,14 @@ COMMAND_HANDLER(handle_mw_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t address;
-	COMMAND_PARSE_NUMBER(u32, args[0], address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 
 	uint32_t value;
-	COMMAND_PARSE_NUMBER(u32, args[1], value);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 
 	unsigned count = 1;
 	if (CMD_ARGC == 3)
-		COMMAND_PARSE_NUMBER(uint, args[2], count);
+		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[2], count);
 
 	struct target *target = get_current_target(cmd_ctx);
 	unsigned wordsize;
@@ -2357,7 +2357,7 @@ COMMAND_HANDLER(handle_mw_command)
 
 }
 
-static COMMAND_HELPER(parse_load_image_command_args, struct image *image,
+static COMMAND_HELPER(parse_load_image_command_CMD_ARGV, struct image *image,
 		uint32_t *min_address, uint32_t *max_address)
 {
 	if (CMD_ARGC &lt; 1 || CMD_ARGC &gt; 5)
@@ -2368,7 +2368,7 @@ static COMMAND_HELPER(parse_load_image_command_args, struct image *image,
 	if (CMD_ARGC &gt;= 2)
 	{
 		uint32_t addr;
-		COMMAND_PARSE_NUMBER(u32, args[1], addr);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], addr);
 		image-&gt;base_address = addr;
 		image-&gt;base_address_set = 1;
 	}
@@ -2379,11 +2379,11 @@ static COMMAND_HELPER(parse_load_image_command_args, struct image *image,
 
 	if (CMD_ARGC &gt;= 4)
 	{
-		COMMAND_PARSE_NUMBER(u32, args[3], *min_address);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[3], *min_address);
 	}
 	if (CMD_ARGC == 5)
 	{
-		COMMAND_PARSE_NUMBER(u32, args[4], *max_address);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[4], *max_address);
 		// use size (given) to find max (required)
 		*max_address += *min_address;
 	}
@@ -2404,7 +2404,7 @@ COMMAND_HANDLER(handle_load_image_command)
 	int i;
 	struct image image;
 
-	int retval = CALL_COMMAND_HANDLER(parse_load_image_command_args,
+	int retval = CALL_COMMAND_HANDLER(parse_load_image_command_CMD_ARGV,
 			&amp;image, &amp;min_address, &amp;max_address);
 	if (ERROR_OK != retval)
 		return retval;
@@ -2414,7 +2414,7 @@ COMMAND_HANDLER(handle_load_image_command)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (image_open(&amp;image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(&amp;image, CMD_ARGV[0], (CMD_ARGC &gt;= 3) ? CMD_ARGV[2] : NULL) != ERROR_OK)
 	{
 		return ERROR_OK;
 	}
@@ -2502,11 +2502,11 @@ COMMAND_HANDLER(handle_dump_image_command)
 	}
 
 	uint32_t address;
-	COMMAND_PARSE_NUMBER(u32, args[1], address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], address);
 	uint32_t size;
-	COMMAND_PARSE_NUMBER(u32, args[2], size);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], size);
 
-	if (fileio_open(&amp;fileio, args[0], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK)
+	if (fileio_open(&amp;fileio, CMD_ARGV[0], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK)
 	{
 		return ERROR_OK;
 	}
@@ -2579,7 +2579,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 	if (CMD_ARGC &gt;= 2)
 	{
 		uint32_t addr;
-		COMMAND_PARSE_NUMBER(u32, args[1], addr);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], addr);
 		image.base_address = addr;
 		image.base_address_set = 1;
 	}
@@ -2591,7 +2591,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 
 	image.start_address_set = 0;
 
-	if ((retval = image_open(&amp;image, args[0], (CMD_ARGC == 3) ? args[2] : NULL)) != ERROR_OK)
+	if ((retval = image_open(&amp;image, CMD_ARGV[0], (CMD_ARGC == 3) ? CMD_ARGV[2] : NULL)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -2755,14 +2755,14 @@ COMMAND_HANDLER(handle_bp_command)
 	}
 
 	uint32_t addr;
-	COMMAND_PARSE_NUMBER(u32, args[0], addr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 	uint32_t length;
-	COMMAND_PARSE_NUMBER(u32, args[1], length);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], length);
 
 	int hw = BKPT_SOFT;
 	if (CMD_ARGC == 3)
 	{
-		if (strcmp(args[2], &quot;hw&quot;) == 0)
+		if (strcmp(CMD_ARGV[2], &quot;hw&quot;) == 0)
 			hw = BKPT_HARD;
 		else
 			return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2777,7 +2777,7 @@ COMMAND_HANDLER(handle_rbp_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t addr;
-	COMMAND_PARSE_NUMBER(u32, args[0], addr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 
 	struct target *target = get_current_target(cmd_ctx);
 	breakpoint_remove(target, addr);
@@ -2818,13 +2818,13 @@ COMMAND_HANDLER(handle_wp_command)
 	switch (CMD_ARGC)
 	{
 	case 5:
-		COMMAND_PARSE_NUMBER(u32, args[4], data_mask);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[4], data_mask);
 		// fall through
 	case 4:
-		COMMAND_PARSE_NUMBER(u32, args[3], data_value);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[3], data_value);
 		// fall through
 	case 3:
-		switch (args[2][0])
+		switch (CMD_ARGV[2][0])
 		{
 		case 'r':
 			type = WPT_READ;
@@ -2836,13 +2836,13 @@ COMMAND_HANDLER(handle_wp_command)
 			type = WPT_ACCESS;
 			break;
 		default:
-			LOG_ERROR(&quot;invalid watchpoint mode ('%c')&quot;, args[2][0]);
+			LOG_ERROR(&quot;invalid watchpoint mode ('%c')&quot;, CMD_ARGV[2][0]);
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
 		// fall through
 	case 2:
-		COMMAND_PARSE_NUMBER(u32, args[1], length);
-		COMMAND_PARSE_NUMBER(u32, args[0], addr);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], length);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 		break;
 
 	default:
@@ -2865,7 +2865,7 @@ COMMAND_HANDLER(handle_rwp_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t addr;
-	COMMAND_PARSE_NUMBER(u32, args[0], addr);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 
 	struct target *target = get_current_target(cmd_ctx);
 	watchpoint_remove(target, addr);
@@ -2886,7 +2886,7 @@ COMMAND_HANDLER(handle_virt2phys_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t va;
-	COMMAND_PARSE_NUMBER(u32, args[0], va);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], va);
 	uint32_t pa;
 
 	struct target *target = get_current_target(cmd_ctx);
@@ -3025,7 +3025,7 @@ COMMAND_HANDLER(handle_profile_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 	unsigned offset;
-	COMMAND_PARSE_NUMBER(uint, args[0], offset);
+	COMMAND_PARSE_NUMBER(uint, CMD_ARGV[0], offset);
 
 	timeval_add_time(&amp;timeout, offset, 0);
 
@@ -3088,8 +3088,8 @@ COMMAND_HANDLER(handle_profile_command)
 				free(samples);
 				return retval;
 			}
-			writeGmon(samples, numSamples, args[1]);
-			command_print(cmd_ctx, &quot;Wrote %s&quot;, args[1]);
+			writeGmon(samples, numSamples, CMD_ARGV[1]);
+			command_print(cmd_ctx, &quot;Wrote %s&quot;, CMD_ARGV[1]);
 			break;
 		}
 	}
@@ -4543,7 +4543,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 
 	struct image image;
 
-	int retval = CALL_COMMAND_HANDLER(parse_load_image_command_args,
+	int retval = CALL_COMMAND_HANDLER(parse_load_image_command_CMD_ARGV,
 			&amp;image, &amp;min_address, &amp;max_address);
 	if (ERROR_OK != retval)
 		return retval;
@@ -4551,7 +4551,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (image_open(&amp;image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(&amp;image, CMD_ARGV[0], (CMD_ARGC &gt;= 3) ? CMD_ARGV[2] : NULL) != ERROR_OK)
 	{
 		return ERROR_OK;
 	}
@@ -4795,7 +4795,7 @@ int target_register_user_commands(struct command_context *cmd_ctx)
 
 	register_command(cmd_ctx, NULL, &quot;fast_load_image&quot;,
 			handle_fast_load_image_command, COMMAND_ANY,
-			&quot;same args as load_image, image stored in memory &quot;
+			&quot;same CMD_ARGV as load_image, image stored in memory &quot;
 			&quot;- mainly for profiling purposes&quot;);
 
 	register_command(cmd_ctx, NULL, &quot;fast_load&quot;,
diff --git a/src/target/target_request.c b/src/target/target_request.c
index c5de691..1d618cc 100644
--- a/src/target/target_request.c
+++ b/src/target/target_request.c
@@ -270,7 +270,7 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 
 	if (CMD_ARGC &gt; 0)
 	{
-		if (!strcmp(args[0], &quot;enable&quot;) || !strcmp(args[0], &quot;charmsg&quot;))
+		if (!strcmp(CMD_ARGV[0], &quot;enable&quot;) || !strcmp(CMD_ARGV[0], &quot;charmsg&quot;))
 		{
 			/* don't register if this command context is already receiving */
 			if (!receiving)
@@ -278,9 +278,9 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 				receiving = 1;
 				add_debug_msg_receiver(cmd_ctx, target);
 			}
-			charmsg_mode = !strcmp(args[0], &quot;charmsg&quot;);
+			charmsg_mode = !strcmp(CMD_ARGV[0], &quot;charmsg&quot;);
 		}
-		else if (!strcmp(args[0], &quot;disable&quot;))
+		else if (!strcmp(CMD_ARGV[0], &quot;disable&quot;))
 		{
 			/* no need to delete a receiver if none is registered */
 			if (receiving)
diff --git a/src/target/trace.c b/src/target/trace.c
index 88f4ed3..f2fd790 100644
--- a/src/target/trace.c
+++ b/src/target/trace.c
@@ -66,7 +66,7 @@ COMMAND_HANDLER(handle_trace_point_command)
 		return ERROR_OK;
 	}
 
-	if (!strcmp(args[0], &quot;clear&quot;))
+	if (!strcmp(CMD_ARGV[0], &quot;clear&quot;))
 	{
 		if (trace-&gt;trace_points)
 		{
@@ -87,7 +87,7 @@ COMMAND_HANDLER(handle_trace_point_command)
 	}
 
 	uint32_t address;
-	COMMAND_PARSE_NUMBER(u32, args[0], address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 	trace-&gt;trace_points[trace-&gt;num_trace_points].address = address;
 	trace-&gt;trace_points[trace-&gt;num_trace_points].hit_counter = 0;
 	trace-&gt;num_trace_points++;
@@ -105,7 +105,7 @@ COMMAND_HANDLER(handle_trace_history_command)
 		trace-&gt;trace_history_pos = 0;
 		trace-&gt;trace_history_overflowed = 0;
 
-		if (!strcmp(args[0], &quot;clear&quot;))
+		if (!strcmp(CMD_ARGV[0], &quot;clear&quot;))
 		{
 			/* clearing is implicit, we've just reset position anyway */
 			return ERROR_OK;
@@ -114,7 +114,7 @@ COMMAND_HANDLER(handle_trace_history_command)
 		if (trace-&gt;trace_history)
 			free(trace-&gt;trace_history);
 
-		COMMAND_PARSE_NUMBER(u32, args[0], trace-&gt;trace_history_size);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], trace-&gt;trace_history_size);
 		trace-&gt;trace_history = malloc(sizeof(uint32_t) * trace-&gt;trace_history_size);
 
 		command_print(cmd_ctx, &quot;new trace history size: %i&quot;, (int)(trace-&gt;trace_history_size));
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 3af28d0..9500a33 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -3001,9 +3001,9 @@ COMMAND_HANDLER(xscale_handle_debug_handler_command)
 		return ERROR_OK;
 	}
 
-	if ((target = get_target(args[0])) == NULL)
+	if ((target = get_target(CMD_ARGV[0])) == NULL)
 	{
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[0]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
@@ -3012,7 +3012,7 @@ COMMAND_HANDLER(xscale_handle_debug_handler_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	COMMAND_PARSE_NUMBER(u32, args[1], handler_address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], handler_address);
 
 	if (((handler_address &gt;= 0x800) &amp;&amp; (handler_address &lt;= 0x1fef800)) ||
 		((handler_address &gt;= 0xfe000800) &amp;&amp; (handler_address &lt;= 0xfffff800)))
@@ -3040,10 +3040,10 @@ COMMAND_HANDLER(xscale_handle_cache_clean_address_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	target = get_target(args[0]);
+	target = get_target(CMD_ARGV[0]);
 	if (target == NULL)
 	{
-		LOG_ERROR(&quot;target '%s' not defined&quot;, args[0]);
+		LOG_ERROR(&quot;target '%s' not defined&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 	xscale = target_to_xscale(target);
@@ -3051,7 +3051,7 @@ COMMAND_HANDLER(xscale_handle_cache_clean_address_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	COMMAND_PARSE_NUMBER(u32, args[1], cache_clean_address);
+	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], cache_clean_address);
 
 	if (cache_clean_address &amp; 0xffff)
 	{
@@ -3132,12 +3132,12 @@ COMMAND_HANDLER(xscale_handle_mmu_command)
 
 	if (CMD_ARGC &gt;= 1)
 	{
-		if (strcmp(&quot;enable&quot;, args[0]) == 0)
+		if (strcmp(&quot;enable&quot;, CMD_ARGV[0]) == 0)
 		{
 			xscale_enable_mmu_caches(target, 1, 0, 0);
 			xscale-&gt;armv4_5_mmu.mmu_enabled = 1;
 		}
-		else if (strcmp(&quot;disable&quot;, args[0]) == 0)
+		else if (strcmp(&quot;disable&quot;, CMD_ARGV[0]) == 0)
 		{
 			xscale_disable_mmu_caches(target, 1, 0, 0);
 			xscale-&gt;armv4_5_mmu.mmu_enabled = 0;
@@ -3173,7 +3173,7 @@ COMMAND_HANDLER(xscale_handle_idcache_command)
 
 	if (CMD_ARGC &gt;= 1)
 	{
-		if (strcmp(&quot;enable&quot;, args[0]) == 0)
+		if (strcmp(&quot;enable&quot;, CMD_ARGV[0]) == 0)
 		{
 			xscale_enable_mmu_caches(target, 0, dcache, icache);
 
@@ -3182,7 +3182,7 @@ COMMAND_HANDLER(xscale_handle_idcache_command)
 			else if (dcache)
 				xscale-&gt;armv4_5_mmu.armv4_5_cache.d_u_cache_enabled = 1;
 		}
-		else if (strcmp(&quot;disable&quot;, args[0]) == 0)
+		else if (strcmp(&quot;disable&quot;, CMD_ARGV[0]) == 0)
 		{
 			xscale_disable_mmu_caches(target, 0, dcache, icache);
 
@@ -3218,7 +3218,7 @@ COMMAND_HANDLER(xscale_handle_vector_catch_command)
 	}
 	else
 	{
-		COMMAND_PARSE_NUMBER(u8, args[0], xscale-&gt;vector_catch);
+		COMMAND_PARSE_NUMBER(u8, CMD_ARGV[0], xscale-&gt;vector_catch);
 		buf_set_u32(xscale-&gt;reg_cache-&gt;reg_list[XSCALE_DCSR].value, 16, 8, xscale-&gt;vector_catch);
 		xscale_write_dcsr(target, -1, -1);
 	}
@@ -3259,19 +3259,19 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 	else
 	{
 		int idx;
-		COMMAND_PARSE_NUMBER(int, args[1], idx);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], idx);
 		uint32_t vec;
-		COMMAND_PARSE_NUMBER(u32, args[2], vec);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], vec);
 
 		if (idx &lt; 1 || idx &gt;= 8)
 			err = 1;
 
-		if (!err &amp;&amp; strcmp(args[0], &quot;low&quot;) == 0)
+		if (!err &amp;&amp; strcmp(CMD_ARGV[0], &quot;low&quot;) == 0)
 		{
 			xscale-&gt;static_low_vectors_set |= (1&lt;&lt;idx);
 			xscale-&gt;static_low_vectors[idx] = vec;
 		}
-		else if (!err &amp;&amp; (strcmp(args[0], &quot;high&quot;) == 0))
+		else if (!err &amp;&amp; (strcmp(CMD_ARGV[0], &quot;high&quot;) == 0))
 		{
 			xscale-&gt;static_high_vectors_set |= (1&lt;&lt;idx);
 			xscale-&gt;static_high_vectors[idx] = vec;
@@ -3305,7 +3305,7 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 		return ERROR_OK;
 	}
 
-	if ((CMD_ARGC &gt;= 1) &amp;&amp; (strcmp(&quot;enable&quot;, args[0]) == 0))
+	if ((CMD_ARGC &gt;= 1) &amp;&amp; (strcmp(&quot;enable&quot;, CMD_ARGV[0]) == 0))
 	{
 		struct xscale_trace_data *td, *next_td;
 		xscale-&gt;trace.buffer_enabled = 1;
@@ -3323,19 +3323,19 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 		}
 		xscale-&gt;trace.data = NULL;
 	}
-	else if ((CMD_ARGC &gt;= 1) &amp;&amp; (strcmp(&quot;disable&quot;, args[0]) == 0))
+	else if ((CMD_ARGC &gt;= 1) &amp;&amp; (strcmp(&quot;disable&quot;, CMD_ARGV[0]) == 0))
 	{
 		xscale-&gt;trace.buffer_enabled = 0;
 	}
 
-	if ((CMD_ARGC &gt;= 2) &amp;&amp; (strcmp(&quot;fill&quot;, args[1]) == 0))
+	if ((CMD_ARGC &gt;= 2) &amp;&amp; (strcmp(&quot;fill&quot;, CMD_ARGV[1]) == 0))
 	{
 		uint32_t fill = 1;
 		if (CMD_ARGC &gt;= 3)
-			COMMAND_PARSE_NUMBER(u32, args[2], fill);
+			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], fill);
 		xscale-&gt;trace.buffer_fill = fill;
 	}
-	else if ((CMD_ARGC &gt;= 2) &amp;&amp; (strcmp(&quot;wrap&quot;, args[1]) == 0))
+	else if ((CMD_ARGC &gt;= 2) &amp;&amp; (strcmp(&quot;wrap&quot;, CMD_ARGV[1]) == 0))
 	{
 		xscale-&gt;trace.buffer_fill = -1;
 	}
@@ -3397,14 +3397,14 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 	if (CMD_ARGC &gt;= 2)
 	{
 		xscale-&gt;trace.image-&gt;base_address_set = 1;
-		COMMAND_PARSE_NUMBER(int, args[1], xscale-&gt;trace.image-&gt;base_address);
+		COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], xscale-&gt;trace.image-&gt;base_address);
 	}
 	else
 	{
 		xscale-&gt;trace.image-&gt;base_address_set = 0;
 	}
 
-	if (image_open(xscale-&gt;trace.image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(xscale-&gt;trace.image, CMD_ARGV[0], (CMD_ARGC &gt;= 3) ? CMD_ARGV[2] : NULL) != ERROR_OK)
 	{
 		free(xscale-&gt;trace.image);
 		xscale-&gt;trace.image = NULL;
@@ -3446,7 +3446,7 @@ COMMAND_HANDLER(xscale_handle_dump_trace_command)
 		return ERROR_OK;
 	}
 
-	if (fileio_open(&amp;file, args[0], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK)
+	if (fileio_open(&amp;file, CMD_ARGV[0], FILEIO_WRITE, FILEIO_BINARY) != ERROR_OK)
 	{
 		return ERROR_OK;
 	}
@@ -3505,7 +3505,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 	struct reg *reg = NULL;
 	if (CMD_ARGC &gt; 0)
 	{
-		COMMAND_PARSE_NUMBER(u32, args[0], reg_no);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], reg_no);
 		/*translate from xscale cp15 register no to openocd register*/
 		switch (reg_no)
 		{
@@ -3552,7 +3552,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 	else if (CMD_ARGC == 2)
 	{
 		uint32_t value;
-		COMMAND_PARSE_NUMBER(u32, args[1], value);
+		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 
 		/* send CP write request (command 0x41) */
 		xscale_send_u32(target, 0x41);
diff --git a/src/xsvf/xsvf.c b/src/xsvf/xsvf.c
index 311acc6..1fe0b86 100644
--- a/src/xsvf/xsvf.c
+++ b/src/xsvf/xsvf.c
@@ -225,15 +225,15 @@ COMMAND_HANDLER(handle_xsvf_command)
 		return ERROR_FAIL;
 	}
 
-	/* we mess with args starting point below, snapshot filename here */
-	const char *filename = args[1];
+	/* we mess with CMD_ARGV starting point below, snapshot filename here */
+	const char *filename = CMD_ARGV[1];
 
-	if (strcmp(args[0], &quot;plain&quot;) != 0)
+	if (strcmp(CMD_ARGV[0], &quot;plain&quot;) != 0)
 	{
-		tap = jtag_tap_by_string(args[0]);
+		tap = jtag_tap_by_string(CMD_ARGV[0]);
 		if (!tap)
 		{
-			command_print(cmd_ctx, &quot;Tap: %s unknown&quot;, args[0]);
+			command_print(cmd_ctx, &quot;Tap: %s unknown&quot;, CMD_ARGV[0]);
 			return ERROR_FAIL;
 		}
 	}
@@ -245,14 +245,14 @@ COMMAND_HANDLER(handle_xsvf_command)
 	}
 
 	/* if this argument is present, then interpret xruntest counts as TCK cycles rather than as usecs */
-	if ((CMD_ARGC &gt; 2) &amp;&amp; (strcmp(args[2], &quot;virt2&quot;) == 0))
+	if ((CMD_ARGC &gt; 2) &amp;&amp; (strcmp(CMD_ARGV[2], &quot;virt2&quot;) == 0))
 	{
 		runtest_requires_tck = 1;
 		--CMD_ARGC;
-		++args;
+		++CMD_ARGV;
 	}
 
-	if ((CMD_ARGC &gt; 2) &amp;&amp; (strcmp(args[2], &quot;quiet&quot;) == 0))
+	if ((CMD_ARGC &gt; 2) &amp;&amp; (strcmp(CMD_ARGV[2], &quot;quiet&quot;) == 0))
 	{
 		verbose = 0;
 	}

commit 7bf1a86e473a12882bf6f71cb4d0d416394b69d4
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 15 04:57:12 2009 -0800

    command_handler: change to 'argc' to CMD_ARGC
    
    This patch converts all instances of 'argc' in COMMAND_HANDLER routines
    to use CMD_ARGC.

diff --git a/src/flash/at91sam3.c b/src/flash/at91sam3.c
index 4507888..54e60bf 100644
--- a/src/flash/at91sam3.c
+++ b/src/flash/at91sam3.c
@@ -2365,7 +2365,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 	}
 
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	default:
 		command_print(cmd_ctx,&quot;Too many parameters\n&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2438,7 +2438,7 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 	}
 
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		// show
 		break;
diff --git a/src/flash/at91sam7.c b/src/flash/at91sam7.c
index 9d05d7b..193bfd3 100644
--- a/src/flash/at91sam7.c
+++ b/src/flash/at91sam7.c
@@ -743,7 +743,7 @@ FLASH_BANK_COMMAND_HANDLER(at91sam7_flash_bank_command)
 	at91sam7_info-&gt;ext_freq = 0;
 	at91sam7_info-&gt;flash_autodetection = 0;
 
-	if (argc &lt; 13)
+	if (CMD_ARGC &lt; 13)
 	{
 		at91sam7_info-&gt;flash_autodetection = 1;
 		return ERROR_OK;
@@ -760,7 +760,7 @@ FLASH_BANK_COMMAND_HANDLER(at91sam7_flash_bank_command)
 	COMMAND_PARSE_NUMBER(u16, args[11], page_size);
 	COMMAND_PARSE_NUMBER(u16, args[12], num_nvmbits);
 
-	if (argc == 14) {
+	if (CMD_ARGC == 14) {
 		unsigned long freq;
 		COMMAND_PARSE_NUMBER(ulong, args[13], freq);
 		ext_freq = freq * 1000;
@@ -1107,7 +1107,7 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 	struct at91sam7_flash_bank *at91sam7_info;
 	int retval;
 
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		command_print(cmd_ctx, &quot;at91sam7 gpnvm &lt;bit&gt; &lt;set | clear&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/avrf.c b/src/flash/avrf.c
index 5d3c033..f1db3c4 100644
--- a/src/flash/avrf.c
+++ b/src/flash/avrf.c
@@ -184,7 +184,7 @@ FLASH_BANK_COMMAND_HANDLER(avrf_flash_bank_command)
 {
 	struct avrf_flash_bank *avrf_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank avr configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -419,7 +419,7 @@ COMMAND_HANDLER(avrf_handle_mass_erase_command)
 {
 	int i;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;avr mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/cfi.c b/src/flash/cfi.c
index c0ad50d..c68fb73 100644
--- a/src/flash/cfi.c
+++ b/src/flash/cfi.c
@@ -606,7 +606,7 @@ FLASH_BANK_COMMAND_HANDLER(cfi_flash_bank_command)
 {
 	struct cfi_flash_bank *cfi_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank cfi configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -633,7 +633,7 @@ FLASH_BANK_COMMAND_HANDLER(cfi_flash_bank_command)
 	cfi_info-&gt;jedec_probe = 0;
 	cfi_info-&gt;not_cfi = 0;
 
-	for (unsigned i = 6; i &lt; argc; i++)
+	for (unsigned i = 6; i &lt; CMD_ARGC; i++)
 	{
 		if (strcmp(args[i], &quot;x16_as_x8&quot;) == 0)
 		{
diff --git a/src/flash/davinci_nand.c b/src/flash/davinci_nand.c
index 413bcda..7c68be7 100644
--- a/src/flash/davinci_nand.c
+++ b/src/flash/davinci_nand.c
@@ -645,7 +645,7 @@ NAND_DEVICE_COMMAND_HANDLER(davinci_nand_device_command)
 	 *  - aemif address
 	 * Plus someday, optionally, ALE and CLE masks.
 	 */
-	if (argc &lt; 5) {
+	if (CMD_ARGC &lt; 5) {
 		LOG_ERROR(&quot;parameters: %s target &quot;
 				&quot;chip_addr hwecc_mode aemif_addr&quot;,
 				args[0]);
diff --git a/src/flash/ecos.c b/src/flash/ecos.c
index b2ffadf..8d2d3ee 100644
--- a/src/flash/ecos.c
+++ b/src/flash/ecos.c
@@ -109,7 +109,7 @@ FLASH_BANK_COMMAND_HANDLER(ecosflash_flash_bank_command)
 {
 	struct ecosflash_flash_bank *info;
 
-	if (argc &lt; 7)
+	if (CMD_ARGC &lt; 7)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank ecosflash configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/faux.c b/src/flash/faux.c
index b048fcb..54acf75 100644
--- a/src/flash/faux.c
+++ b/src/flash/faux.c
@@ -41,7 +41,7 @@ FLASH_BANK_COMMAND_HANDLER(faux_flash_bank_command)
 {
 	struct faux_flash_bank *info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank faux configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/flash.c b/src/flash/flash.c
index adc1411..7402772 100644
--- a/src/flash/flash.c
+++ b/src/flash/flash.c
@@ -222,7 +222,7 @@ COMMAND_HANDLER(handle_flash_bank_command)
 	int found = 0;
 	struct target *target;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -303,7 +303,7 @@ COMMAND_HANDLER(handle_flash_info_command)
 	int j = 0;
 	int retval;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned bank_nr;
@@ -362,7 +362,7 @@ COMMAND_HANDLER(handle_flash_probe_command)
 {
 	int retval;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -397,7 +397,7 @@ COMMAND_HANDLER(handle_flash_probe_command)
 
 COMMAND_HANDLER(handle_flash_erase_check_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -450,7 +450,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	COMMAND_PARSE_NUMBER(int, args[0], address);
@@ -487,7 +487,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 
 COMMAND_HANDLER(handle_flash_protect_check_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct flash_bank *p;
@@ -531,7 +531,7 @@ static int flash_check_sector_parameters(struct command_context *cmd_ctx,
 
 COMMAND_HANDLER(handle_flash_erase_command)
 {
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t bank_nr;
@@ -571,7 +571,7 @@ COMMAND_HANDLER(handle_flash_erase_command)
 
 COMMAND_HANDLER(handle_flash_protect_command)
 {
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t bank_nr;
@@ -622,7 +622,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 
 	int retval;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -637,13 +637,13 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 		{
 			auto_erase = 1;
 			args++;
-			argc--;
+			CMD_ARGC--;
 			command_print(cmd_ctx, &quot;auto erase enabled&quot;);
 		} else if (strcmp(args[0], &quot;unlock&quot;) == 0)
 		{
 			auto_unlock = true;
 			args++;
-			argc--;
+			CMD_ARGC--;
 			command_print(cmd_ctx, &quot;auto unlock enabled&quot;);
 		} else
 		{
@@ -651,7 +651,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 		}
 	}
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -665,7 +665,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		image.base_address_set = 1;
 		COMMAND_PARSE_NUMBER(int, args[1], image.base_address);
@@ -678,7 +678,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 
 	image.start_address_set = 0;
 
-	retval = image_open(&amp;image, args[0], (argc == 3) ? args[2] : NULL);
+	retval = image_open(&amp;image, args[0], (CMD_ARGC == 3) ? args[2] : NULL);
 	if (retval != ERROR_OK)
 	{
 		return retval;
@@ -718,7 +718,7 @@ COMMAND_HANDLER(handle_flash_fill_command)
 	uint32_t i;
 	uint32_t wordsize;
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	COMMAND_PARSE_NUMBER(u32, args[0], address);
@@ -813,7 +813,7 @@ COMMAND_HANDLER(handle_flash_write_bank_command)
 	uint8_t *buffer;
 	struct fileio fileio;
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct duration bench;
diff --git a/src/flash/flash.h b/src/flash/flash.h
index 96a4120..df5b0c9 100644
--- a/src/flash/flash.h
+++ b/src/flash/flash.h
@@ -118,7 +118,7 @@ struct flash_driver
 	 *
 	 * For example, args[4] = 16 bit flash, args[5] = 32bit bus.
 	 *
-	 * If extra arguments are provided (@a argc &gt; 6), they will
+	 * If extra arguments are provided (@a CMD_ARGC &gt; 6), they will
 	 * start in @a args[6].  These can be used to implement
 	 * driver-specific extensions.
 	 *
diff --git a/src/flash/lpc2000.c b/src/flash/lpc2000.c
index a3f9718..60d909f 100644
--- a/src/flash/lpc2000.c
+++ b/src/flash/lpc2000.c
@@ -424,7 +424,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2000_flash_bank_command)
 {
 	struct lpc2000_flash_bank *lpc2000_info;
 
-	if (argc &lt; 8)
+	if (CMD_ARGC &lt; 8)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank lpc2000 configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -469,7 +469,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2000_flash_bank_command)
 	lpc2000_info-&gt;calc_checksum = 0;
 	lpc2000_build_sector_list(bank);
 
-	if (argc &gt;= 9)
+	if (CMD_ARGC &gt;= 9)
 	{
 		if (strcmp(args[8], &quot;calc_checksum&quot;) == 0)
 			lpc2000_info-&gt;calc_checksum = 1;
@@ -744,7 +744,7 @@ COMMAND_HANDLER(lpc2000_handle_part_id_command)
 	uint32_t result_table[4];
 	int status_code;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
diff --git a/src/flash/lpc288x.c b/src/flash/lpc288x.c
index eb95b66..2ad5014 100644
--- a/src/flash/lpc288x.c
+++ b/src/flash/lpc288x.c
@@ -169,7 +169,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc288x_flash_bank_command)
 {
 	struct lpc288x_flash_bank *lpc288x_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank LPC288x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/lpc2900.c b/src/flash/lpc2900.c
index dc91668..67a510e 100644
--- a/src/flash/lpc2900.c
+++ b/src/flash/lpc2900.c
@@ -537,7 +537,7 @@ COMMAND_HANDLER(lpc2900_handle_signature_command)
 	uint32_t signature[4];
 
 
-	if( argc &lt; 1 )
+	if( CMD_ARGC &lt; 1 )
 	{
 		LOG_WARNING( &quot;Too few arguments. Call: lpc2900 signature &lt;bank#&gt;&quot; );
 		return ERROR_FLASH_BANK_INVALID;
@@ -583,7 +583,7 @@ COMMAND_HANDLER(lpc2900_handle_signature_command)
  */
 COMMAND_HANDLER(lpc2900_handle_read_custom_command)
 {
-	if( argc &lt; 2 )
+	if( CMD_ARGC &lt; 2 )
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -654,7 +654,7 @@ COMMAND_HANDLER(lpc2900_handle_read_custom_command)
  */
 COMMAND_HANDLER(lpc2900_handle_password_command)
 {
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -689,7 +689,7 @@ COMMAND_HANDLER(lpc2900_handle_password_command)
  */
 COMMAND_HANDLER(lpc2900_handle_write_custom_command)
 {
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -724,7 +724,7 @@ COMMAND_HANDLER(lpc2900_handle_write_custom_command)
 	image.start_address_set = 0;
 
 	const char *filename = args[1];
-	const char *type = (argc &gt;= 3) ? args[2] : NULL;
+	const char *type = (CMD_ARGC &gt;= 3) ? args[2] : NULL;
 	retval = image_open(&amp;image, filename, type);
 	if (retval != ERROR_OK)
 	{
@@ -799,7 +799,7 @@ COMMAND_HANDLER(lpc2900_handle_write_custom_command)
  */
 COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
 {
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -898,7 +898,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
  */
 COMMAND_HANDLER(lpc2900_handle_secure_jtag_command)
 {
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -1020,7 +1020,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2900_flash_bank_command)
 {
 	struct lpc2900_flash_bank *lpc2900_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank LPC2900 configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/lpc3180_nand_controller.c b/src/flash/lpc3180_nand_controller.c
index 3589e8b..d7cbe38 100644
--- a/src/flash/lpc3180_nand_controller.c
+++ b/src/flash/lpc3180_nand_controller.c
@@ -31,7 +31,7 @@ static int lpc3180_controller_ready(struct nand_device *nand, int timeout);
  */
 NAND_DEVICE_COMMAND_HANDLER(lpc3180_nand_device_command)
 {
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 		LOG_WARNING(&quot;incomplete 'lpc3180' nand flash configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -836,7 +836,7 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 		&quot;no&quot;, &quot;mlc&quot;, &quot;slc&quot;
 	};
 
-	if ((argc &lt; 1) || (argc &gt; 2))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -852,7 +852,7 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 
 	lpc3180_info = nand-&gt;controller_priv;
 
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 	{
 		if (strcmp(args[1], &quot;mlc&quot;) == 0)
 		{
diff --git a/src/flash/mflash.c b/src/flash/mflash.c
index 0620642..6aeeabc 100644
--- a/src/flash/mflash.c
+++ b/src/flash/mflash.c
@@ -710,7 +710,7 @@ COMMAND_HANDLER(mg_write_cmd)
 	struct fileio fileio;
 	int ret;
 
-	if (argc != 3) {
+	if (CMD_ARGC != 3) {
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -775,7 +775,7 @@ COMMAND_HANDLER(mg_dump_cmd)
 	struct fileio fileio;
 	int ret;
 
-	if (argc != 4) {
+	if (CMD_ARGC != 4) {
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -1223,7 +1223,7 @@ COMMAND_HANDLER(mg_config_cmd)
 	if ((ret = mg_mflash_rst()) != ERROR_OK)
 		return ret;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 		case 2:
 			if (!strcmp(args[1], &quot;boot&quot;))
 				return mg_boot_config();
@@ -1288,7 +1288,7 @@ COMMAND_HANDLER(mg_bank_cmd)
 	struct target *target;
 	int i;
 
-	if (argc &lt; 4)
+	if (CMD_ARGC &lt; 4)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
diff --git a/src/flash/mx3_nand.c b/src/flash/mx3_nand.c
index 45d2a32..49e1758 100644
--- a/src/flash/mx3_nand.c
+++ b/src/flash/mx3_nand.c
@@ -79,7 +79,7 @@ NAND_DEVICE_COMMAND_HANDLER(imx31_nand_device_command)
 	    LOG_ERROR (&quot;target '%s' not defined&quot;, args[1]);
 	    return ERROR_FAIL;
 	}
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 	    LOG_ERROR (&quot;use \&quot;nand device imx31 target noecc|hwecc\&quot;&quot;);
 	    return ERROR_FAIL;
diff --git a/src/flash/nand.c b/src/flash/nand.c
index 71a67c4..9231b9a 100644
--- a/src/flash/nand.c
+++ b/src/flash/nand.c
@@ -210,7 +210,7 @@ COMMAND_HANDLER(handle_nand_device_command)
 	int i;
 	int retval;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		LOG_WARNING(&quot;incomplete flash device nand configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -1082,7 +1082,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 	if (ERROR_OK != retval)
 		return retval;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	case 1:
@@ -1147,7 +1147,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 
 COMMAND_HANDLER(handle_nand_probe_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -1175,7 +1175,7 @@ COMMAND_HANDLER(handle_nand_probe_command)
 
 COMMAND_HANDLER(handle_nand_erase_command)
 {
-	if (argc != 1 &amp;&amp; argc != 3)
+	if (CMD_ARGC != 1 &amp;&amp; CMD_ARGC != 3)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
@@ -1190,7 +1190,7 @@ COMMAND_HANDLER(handle_nand_erase_command)
 	unsigned long length;
 
 	/* erase specified part of the chip; or else everything */
-	if (argc == 3) {
+	if (CMD_ARGC == 3) {
 		unsigned long size = p-&gt;erase_size * p-&gt;num_blocks;
 
 		COMMAND_PARSE_NUMBER(ulong, args[1], offset);
@@ -1234,7 +1234,7 @@ COMMAND_HANDLER(handle_nand_check_bad_blocks_command)
 	int first = -1;
 	int last = -1;
 
-	if ((argc &lt; 1) || (argc &gt; 3) || (argc == 2))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; 3) || (CMD_ARGC == 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
@@ -1245,7 +1245,7 @@ COMMAND_HANDLER(handle_nand_check_bad_blocks_command)
 	if (ERROR_OK != retval)
 		return retval;
 
-	if (argc == 3)
+	if (CMD_ARGC == 3)
 	{
 		unsigned long offset;
 		unsigned long length;
@@ -1389,7 +1389,7 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 	nand_fileio_init(state);
 
 	unsigned minargs = need_size ? 4 : 3;
-	if (argc &lt; minargs)
+	if (CMD_ARGC &lt; minargs)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct nand_device *nand;
@@ -1414,9 +1414,9 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 			}
 	}
 
-	if (argc &gt; minargs)
+	if (CMD_ARGC &gt; minargs)
 	{
-		for (unsigned i = minargs; i &lt; argc; i++)
+		for (unsigned i = minargs; i &lt; CMD_ARGC; i++)
 		{
 			if (!strcmp(args[i], &quot;oob_raw&quot;))
 				state-&gt;oob_format |= NAND_OOB_RAW;
@@ -1646,7 +1646,7 @@ COMMAND_HANDLER(handle_nand_dump_command)
 
 COMMAND_HANDLER(handle_nand_raw_access_command)
 {
-	if ((argc &lt; 1) || (argc &gt; 2))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -1662,7 +1662,7 @@ COMMAND_HANDLER(handle_nand_raw_access_command)
 		return ERROR_OK;
 	}
 
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 	{
 		if (strcmp(&quot;enable&quot;, args[1]) == 0)
 			p-&gt;use_raw = 1;
diff --git a/src/flash/ocl.c b/src/flash/ocl.c
index 0b492c6..388395f 100644
--- a/src/flash/ocl.c
+++ b/src/flash/ocl.c
@@ -49,7 +49,7 @@ FLASH_BANK_COMMAND_HANDLER(ocl_flash_bank_command)
 	struct arm7_9_common *arm7_9;
 	struct ocl_priv *ocl;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank ocl configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/orion_nand.c b/src/flash/orion_nand.c
index 4235b08..69d6d96 100644
--- a/src/flash/orion_nand.c
+++ b/src/flash/orion_nand.c
@@ -131,7 +131,7 @@ NAND_DEVICE_COMMAND_HANDLER(orion_nand_device_command)
 	uint32_t base;
 	uint8_t ale, cle;
 
-	if (argc != 3) {
+	if (CMD_ARGC != 3) {
 		LOG_ERROR(&quot;arguments must be: &lt;target_id&gt; &lt;NAND_address&gt;\n&quot;);
 		return ERROR_NAND_DEVICE_INVALID;
 	}
diff --git a/src/flash/pic32mx.c b/src/flash/pic32mx.c
index 51c42b5..95e2c63 100644
--- a/src/flash/pic32mx.c
+++ b/src/flash/pic32mx.c
@@ -66,7 +66,7 @@ FLASH_BANK_COMMAND_HANDLER(pic32mx_flash_bank_command)
 {
 	struct pic32mx_flash_bank *pic32mx_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank pic32mx configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -677,7 +677,7 @@ COMMAND_HANDLER(pic32mx_handle_lock_command)
 	struct target *target = NULL;
 	struct pic32mx_flash_bank *pic32mx_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;pic32mx lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -723,7 +723,7 @@ COMMAND_HANDLER(pic32mx_handle_unlock_command)
 	struct target *target = NULL;
 	struct pic32mx_flash_bank *pic32mx_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;pic32mx unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -813,7 +813,7 @@ COMMAND_HANDLER(pic32mx_handle_chip_erase_command)
 #if 0
 	int i;
 
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 	{
 		command_print(cmd_ctx, &quot;pic32mx chip_erase&quot;);
 		return ERROR_OK;
@@ -848,7 +848,7 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 	uint32_t address, value;
 	int status, res;
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 	{
 		command_print(cmd_ctx, &quot;pic32mx pgm_word &lt;addr&gt; &lt;value&gt; &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/stellaris.c b/src/flash/stellaris.c
index bbe4aef..4f28c09 100644
--- a/src/flash/stellaris.c
+++ b/src/flash/stellaris.c
@@ -218,7 +218,7 @@ FLASH_BANK_COMMAND_HANDLER(stellaris_flash_bank_command)
 {
 	struct stellaris_flash_bank *stellaris_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank stellaris configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -1132,7 +1132,7 @@ COMMAND_HANDLER(stellaris_handle_mass_erase_command)
 {
 	int i;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stellaris mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/stm32x.c b/src/flash/stm32x.c
index ab9831b..d32e9ea 100644
--- a/src/flash/stm32x.c
+++ b/src/flash/stm32x.c
@@ -38,7 +38,7 @@ FLASH_BANK_COMMAND_HANDLER(stm32x_flash_bank_command)
 {
 	struct stm32x_flash_bank *stm32x_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank stm32x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -898,7 +898,7 @@ COMMAND_HANDLER(stm32x_handle_lock_command)
 	struct target *target = NULL;
 	struct stm32x_flash_bank *stm32x_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stm32x lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -944,7 +944,7 @@ COMMAND_HANDLER(stm32x_handle_unlock_command)
 	struct target *target = NULL;
 	struct stm32x_flash_bank *stm32x_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stm32x unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -988,7 +988,7 @@ COMMAND_HANDLER(stm32x_handle_options_read_command)
 	struct target *target = NULL;
 	struct stm32x_flash_bank *stm32x_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stm32x options_read &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -1044,7 +1044,7 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 	struct stm32x_flash_bank *stm32x_info = NULL;
 	uint16_t optionbyte = 0xF8;
 
-	if (argc &lt; 4)
+	if (CMD_ARGC &lt; 4)
 	{
 		command_print(cmd_ctx, &quot;stm32x options_write &lt;bank&gt; &lt;SWWDG | HWWDG&gt; &lt;RSTSTNDBY | NORSTSTNDBY&gt; &lt;RSTSTOP | NORSTSTOP&gt;&quot;);
 		return ERROR_OK;
@@ -1153,7 +1153,7 @@ COMMAND_HANDLER(stm32x_handle_mass_erase_command)
 {
 	int i;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stm32x mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/str7x.c b/src/flash/str7x.c
index d851051..134780b 100644
--- a/src/flash/str7x.c
+++ b/src/flash/str7x.c
@@ -114,7 +114,7 @@ FLASH_BANK_COMMAND_HANDLER(str7x_flash_bank_command)
 {
 	struct str7x_flash_bank *str7x_info;
 
-	if (argc &lt; 7)
+	if (CMD_ARGC &lt; 7)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank str7x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -611,7 +611,7 @@ COMMAND_HANDLER(str7x_handle_disable_jtag_command)
 	uint16_t ProtectionLevel = 0;
 	uint16_t ProtectionRegs;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str7x disable_jtag &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/str9x.c b/src/flash/str9x.c
index 4c4d8ae..c103e57 100644
--- a/src/flash/str9x.c
+++ b/src/flash/str9x.c
@@ -121,7 +121,7 @@ FLASH_BANK_COMMAND_HANDLER(str9x_flash_bank_command)
 {
 	struct str9x_flash_bank *str9x_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank str9x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -636,7 +636,7 @@ COMMAND_HANDLER(str9x_handle_flash_config_command)
 	struct str9x_flash_bank *str9x_info;
 	struct target *target = NULL;
 
-	if (argc &lt; 5)
+	if (CMD_ARGC &lt; 5)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
diff --git a/src/flash/str9xpec.c b/src/flash/str9xpec.c
index 7f6d8be..73027e4 100644
--- a/src/flash/str9xpec.c
+++ b/src/flash/str9xpec.c
@@ -242,7 +242,7 @@ FLASH_BANK_COMMAND_HANDLER(str9xpec_flash_bank_command)
 	struct arm7_9_common *arm7_9 = NULL;
 	struct arm_jtag *jtag_info = NULL;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank str9x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -734,7 +734,7 @@ COMMAND_HANDLER(str9xpec_handle_part_id_command)
 	uint32_t idcode;
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct flash_bank *bank;
@@ -782,7 +782,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_read_command)
 	uint8_t status;
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_read &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -898,7 +898,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_write_command)
 {
 	uint8_t status;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_write &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -921,7 +921,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_cmap_command)
 {
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_cmap &lt;bank&gt; &lt;bank0 | bank1&gt;&quot;);
 		return ERROR_OK;
@@ -950,7 +950,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdthd_command)
 {
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_lvdthd &lt;bank&gt; &lt;2.4v | 2.7v&gt;&quot;);
 		return ERROR_OK;
@@ -979,7 +979,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdsel_command)
 {
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_lvdsel &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
 		return ERROR_OK;
@@ -1008,7 +1008,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdwarn_command)
 {
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_lvdwarn &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
 		return ERROR_OK;
@@ -1037,7 +1037,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_lock_command)
 {
 	uint8_t status;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -1060,7 +1060,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_unlock_command)
 {
 	uint8_t status;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -1086,7 +1086,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_enable_turbo_command)
 	struct jtag_tap *tap2;
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec enable_turbo &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -1133,7 +1133,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_disable_turbo_command)
 	struct jtag_tap *tap;
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec disable_turbo &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/tms470.c b/src/flash/tms470.c
index b71e9ed..d52dcc1 100644
--- a/src/flash/tms470.c
+++ b/src/flash/tms470.c
@@ -291,12 +291,12 @@ static uint32_t flashKeys[4];
 
 COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 {
-	if (argc &gt; 4)
+	if (CMD_ARGC &gt; 4)
 	{
 		command_print(cmd_ctx, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
-	else if (argc == 4)
+	else if (CMD_ARGC == 4)
 	{
 		int i;
 
@@ -314,7 +314,7 @@ COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 
 		keysSet = 1;
 	}
-	else if (argc != 0)
+	else if (CMD_ARGC != 0)
 	{
 		command_print(cmd_ctx, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -355,12 +355,12 @@ static int oscMHz = 12;
 
 COMMAND_HANDLER(tms470_handle_osc_megahertz_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 	{
 		command_print(cmd_ctx, &quot;tms470 osc_megahertz &lt;MHz&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
-	else if (argc == 1)
+	else if (CMD_ARGC == 1)
 	{
 		sscanf(args[0], &quot;%d&quot;, &amp;oscMHz);
 	}
@@ -384,12 +384,12 @@ static int plldis = 0;
 
 COMMAND_HANDLER(tms470_handle_plldis_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 	{
 		command_print(cmd_ctx, &quot;tms470 plldis &lt;0 | 1&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
-	else if (argc == 1)
+	else if (CMD_ARGC == 1)
 	{
 		sscanf(args[0], &quot;%d&quot;, &amp;plldis);
 		plldis = plldis ? 1 : 0;
diff --git a/src/hello.c b/src/hello.c
index 275150a..b2d1d30 100644
--- a/src/hello.c
+++ b/src/hello.c
@@ -24,12 +24,12 @@
 
 static COMMAND_HELPER(handle_hello_args, const char **sep, const char **name)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 	{
 		LOG_ERROR(&quot;%s: too many arguments&quot;, CMD_NAME);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	if (1 == argc)
+	if (1 == CMD_ARGC)
 	{
 		*sep = &quot; &quot;;
 		*name = args[0];
diff --git a/src/helper/command.c b/src/helper/command.c
index 7edd585..3abfdd6 100644
--- a/src/helper/command.c
+++ b/src/helper/command.c
@@ -723,14 +723,14 @@ static int jim_capture(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 COMMAND_HANDLER(handle_sleep_command)
 {
 	bool busy = false;
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 	{
 		if (strcmp(args[1], &quot;busy&quot;) == 0)
 			busy = true;
 		else
 			return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	else if (argc &lt; 1 || argc &gt; 2)
+	else if (CMD_ARGC &lt; 1 || CMD_ARGC &gt; 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned long duration = 0;
@@ -755,7 +755,7 @@ COMMAND_HANDLER(handle_sleep_command)
 
 COMMAND_HANDLER(handle_fast_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	fast_and_dangerous = strcmp(&quot;enable&quot;, args[0]) == 0;
diff --git a/src/helper/ioutil.c b/src/helper/ioutil.c
index a9474a6..2e8229c 100644
--- a/src/helper/ioutil.c
+++ b/src/helper/ioutil.c
@@ -59,7 +59,7 @@
 
 COMMAND_HANDLER(handle_rm_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;rm &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -135,7 +135,7 @@ int loadFile(const char *fileName, void **data, size_t *len)
 
 COMMAND_HANDLER(handle_cat_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;cat &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -161,7 +161,7 @@ COMMAND_HANDLER(handle_cat_command)
 
 COMMAND_HANDLER(handle_trunc_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;trunc &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -180,7 +180,7 @@ COMMAND_HANDLER(handle_meminfo_command)
 	static int prev = 0;
 	struct mallinfo info;
 
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 	{
 		command_print(cmd_ctx, &quot;meminfo&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -202,7 +202,7 @@ COMMAND_HANDLER(handle_meminfo_command)
 
 COMMAND_HANDLER(handle_append_command)
 {
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx,
 				&quot;append &lt;filename&gt; [&lt;string1&gt;, [&lt;string2&gt;, ...]]&quot;);
@@ -217,17 +217,17 @@ COMMAND_HANDLER(handle_append_command)
 		fseek(config_file, 0, SEEK_END);
 
 		unsigned i;
-		for (i = 1; i &lt; argc; i++)
+		for (i = 1; i &lt; CMD_ARGC; i++)
 		{
 			if (fwrite(args[i], 1, strlen(args[i]), config_file) != strlen(args[i]))
 				break;
-			if (i != argc - 1)
+			if (i != CMD_ARGC - 1)
 			{
 				if (fwrite(&quot; &quot;, 1, 1, config_file) != 1)
 					break;
 			}
 		}
-		if ((i == argc) &amp;&amp; (fwrite(&quot;\n&quot;, 1, 1, config_file) == 1))
+		if ((i == CMD_ARGC) &amp;&amp; (fwrite(&quot;\n&quot;, 1, 1, config_file) == 1))
 		{
 			retval = ERROR_OK;
 		}
@@ -241,7 +241,7 @@ COMMAND_HANDLER(handle_append_command)
 
 COMMAND_HANDLER(handle_cp_command)
 {
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		return ERROR_INVALID_ARGUMENTS;
 	}
diff --git a/src/helper/log.c b/src/helper/log.c
index 9396ffe..715f2fa 100644
--- a/src/helper/log.c
+++ b/src/helper/log.c
@@ -275,13 +275,13 @@ void log_printf_lf(enum log_levels level, const char *file, unsigned line, const
  */
 COMMAND_HANDLER(handle_debug_level_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned new_level;
 		COMMAND_PARSE_NUMBER(uint, args[0], new_level);
 		debug_level = MIN(new_level, LOG_LVL_DEBUG);
 	}
-	else if (argc &gt; 1)
+	else if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	if (debug_level &gt;= LOG_LVL_DEBUG &amp;&amp; server_use_pipes == 1)
@@ -303,7 +303,7 @@ COMMAND_HANDLER(handle_debug_level_command)
 
 COMMAND_HANDLER(handle_log_output_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		FILE* file = fopen(args[0], &quot;w&quot;);
 
diff --git a/src/jtag/amt_jtagaccel.c b/src/jtag/amt_jtagaccel.c
index 3fb77f8..949acec 100644
--- a/src/jtag/amt_jtagaccel.c
+++ b/src/jtag/amt_jtagaccel.c
@@ -497,7 +497,7 @@ static int amt_jtagaccel_quit(void)
 
 COMMAND_HANDLER(amt_jtagaccel_handle_parport_port_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		/* only if the port wasn't overwritten by cmdline */
 		if (amt_jtagaccel_port == 0)
@@ -520,7 +520,7 @@ COMMAND_HANDLER(amt_jtagaccel_handle_parport_port_command)
 
 COMMAND_HANDLER(amt_jtagaccel_handle_rtck_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		command_print(cmd_ctx, &quot;amt_jtagaccel RTCK feature %s&quot;, (rtck_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 		return ERROR_OK;
diff --git a/src/jtag/at91rm9200.c b/src/jtag/at91rm9200.c
index dc9797e..90d94c9 100644
--- a/src/jtag/at91rm9200.c
+++ b/src/jtag/at91rm9200.c
@@ -187,7 +187,7 @@ static int at91rm9200_speed(int speed)
 
 static int at91rm9200_handle_device_command(struct command_context *cmd_ctx, char *cmd, char **args, int argc)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 		return ERROR_OK;
 
 	/* only if the device name wasn't overwritten by cmdline */
diff --git a/src/jtag/ft2232.c b/src/jtag/ft2232.c
index 7acdf1a..c1b3f10 100644
--- a/src/jtag/ft2232.c
+++ b/src/jtag/ft2232.c
@@ -2801,7 +2801,7 @@ COMMAND_HANDLER(ft2232_handle_device_desc_command)
 {
 	char *cp;
 	char buf[200];
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		ft2232_device_desc = strdup(args[0]);
 		cp = strchr(ft2232_device_desc, 0);
@@ -2833,7 +2833,7 @@ COMMAND_HANDLER(ft2232_handle_device_desc_command)
 
 COMMAND_HANDLER(ft2232_handle_serial_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		ft2232_serial = strdup(args[0]);
 	}
@@ -2847,7 +2847,7 @@ COMMAND_HANDLER(ft2232_handle_serial_command)
 
 COMMAND_HANDLER(ft2232_handle_layout_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 		return ERROR_OK;
 
 	ft2232_layout = malloc(strlen(args[0]) + 1);
@@ -2858,23 +2858,23 @@ COMMAND_HANDLER(ft2232_handle_layout_command)
 
 COMMAND_HANDLER(ft2232_handle_vid_pid_command)
 {
-	if (argc &gt; MAX_USB_IDS * 2)
+	if (CMD_ARGC &gt; MAX_USB_IDS * 2)
 	{
 		LOG_WARNING(&quot;ignoring extra IDs in ft2232_vid_pid &quot;
 					&quot;(maximum is %d pairs)&quot;, MAX_USB_IDS);
-		argc = MAX_USB_IDS * 2;
+		CMD_ARGC = MAX_USB_IDS * 2;
 	}
-	if (argc &lt; 2 || (argc &amp; 1))
+	if (CMD_ARGC &lt; 2 || (CMD_ARGC &amp; 1))
 	{
 		LOG_WARNING(&quot;incomplete ft2232_vid_pid configuration directive&quot;);
-		if (argc &lt; 2)
+		if (CMD_ARGC &lt; 2)
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		/* remove the incomplete trailing id */
-		argc -= 1;
+		CMD_ARGC -= 1;
 	}
 
 	unsigned i;
-	for (i = 0; i &lt; argc; i += 2)
+	for (i = 0; i &lt; CMD_ARGC; i += 2)
 	{
 		COMMAND_PARSE_NUMBER(u16, args[i], ft2232_vid[i &gt;&gt; 1]);
 		COMMAND_PARSE_NUMBER(u16, args[i + 1], ft2232_pid[i &gt;&gt; 1]);
@@ -2891,7 +2891,7 @@ COMMAND_HANDLER(ft2232_handle_vid_pid_command)
 
 COMMAND_HANDLER(ft2232_handle_latency_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		ft2232_latency = atoi(args[0]);
 	}
diff --git a/src/jtag/gw16012.c b/src/jtag/gw16012.c
index e24c23a..d1da2a1 100644
--- a/src/jtag/gw16012.c
+++ b/src/jtag/gw16012.c
@@ -543,7 +543,7 @@ static int gw16012_quit(void)
 
 COMMAND_HANDLER(gw16012_handle_parport_port_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		/* only if the port wasn't overwritten by cmdline */
 		if (gw16012_port == 0)
diff --git a/src/jtag/jlink.c b/src/jtag/jlink.c
index 23ebc62..41b99a1 100644
--- a/src/jtag/jlink.c
+++ b/src/jtag/jlink.c
@@ -627,7 +627,7 @@ COMMAND_HANDLER(jlink_handle_jlink_info_command)
 
 COMMAND_HANDLER(jlink_handle_jlink_hw_jtag_command)
 {
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		command_print(cmd_ctx, &quot;jlink hw jtag  %i&quot;, jlink_hw_jtag_version);
 		break;
diff --git a/src/jtag/parport.c b/src/jtag/parport.c
index 399c00a..52289c5 100644
--- a/src/jtag/parport.c
+++ b/src/jtag/parport.c
@@ -411,7 +411,7 @@ static int parport_quit(void)
 
 COMMAND_HANDLER(parport_handle_parport_port_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		/* only if the port wasn't overwritten by cmdline */
 		if (parport_port == 0)
@@ -432,7 +432,7 @@ COMMAND_HANDLER(parport_handle_parport_port_command)
 
 COMMAND_HANDLER(parport_handle_parport_cable_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 		return ERROR_OK;
 
 	/* only if the cable name wasn't overwritten by cmdline */
@@ -447,7 +447,7 @@ COMMAND_HANDLER(parport_handle_parport_cable_command)
 
 COMMAND_HANDLER(parport_handle_write_on_exit_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: parport_write_on_exit &lt;on | off&gt;&quot;);
 		return ERROR_OK;
@@ -463,7 +463,7 @@ COMMAND_HANDLER(parport_handle_write_on_exit_command)
 
 COMMAND_HANDLER(parport_handle_parport_toggling_time_command)
 {
-	if (argc == 1) {
+	if (CMD_ARGC == 1) {
 		uint32_t ns;
 		int retval = parse_u32(args[0], &amp;ns);
 
diff --git a/src/jtag/presto.c b/src/jtag/presto.c
index b4ba3f4..45d99ff 100644
--- a/src/jtag/presto.c
+++ b/src/jtag/presto.c
@@ -752,7 +752,7 @@ static char *presto_serial;
 
 COMMAND_HANDLER(presto_handle_serial_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (presto_serial)
 			free(presto_serial);
diff --git a/src/jtag/tcl.c b/src/jtag/tcl.c
index 71e7bd5..bd3f704 100644
--- a/src/jtag/tcl.c
+++ b/src/jtag/tcl.c
@@ -605,7 +605,7 @@ static int default_srst_asserted(int *srst_asserted)
 
 COMMAND_HANDLER(handle_interface_list_command)
 {
-	if (strcmp(CMD_NAME, &quot;interface_list&quot;) == 0 &amp;&amp; argc &gt; 0)
+	if (strcmp(CMD_NAME, &quot;interface_list&quot;) == 0 &amp;&amp; CMD_ARGC &gt; 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	command_print(cmd_ctx, &quot;The following JTAG interfaces are available:&quot;);
@@ -628,7 +628,7 @@ COMMAND_HANDLER(handle_interface_command)
 	}
 
 	/* interface name is a mandatory argument */
-	if (argc != 1 || args[0][0] == '\0')
+	if (CMD_ARGC != 1 || args[0][0] == '\0')
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	for (unsigned i = 0; NULL != jtag_interfaces[i]; i++)
@@ -711,7 +711,7 @@ COMMAND_HANDLER(handle_reset_config_command)
 	 * Here we don't care about the order, and only change values
 	 * which have been explicitly specified.
 	 */
-	for (; argc; argc--, args++) {
+	for (; CMD_ARGC; CMD_ARGC--, args++) {
 		int tmp = 0;
 		int m;
 
@@ -897,9 +897,9 @@ next:
 
 COMMAND_HANDLER(handle_jtag_nsrst_delay_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
 		COMMAND_PARSE_NUMBER(uint, args[0], delay);
@@ -912,9 +912,9 @@ COMMAND_HANDLER(handle_jtag_nsrst_delay_command)
 
 COMMAND_HANDLER(handle_jtag_ntrst_delay_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
 		COMMAND_PARSE_NUMBER(uint, args[0], delay);
@@ -927,9 +927,9 @@ COMMAND_HANDLER(handle_jtag_ntrst_delay_command)
 
 COMMAND_HANDLER(handle_jtag_nsrst_assert_width_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
 		COMMAND_PARSE_NUMBER(uint, args[0], delay);
@@ -942,9 +942,9 @@ COMMAND_HANDLER(handle_jtag_nsrst_assert_width_command)
 
 COMMAND_HANDLER(handle_jtag_ntrst_assert_width_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
 		COMMAND_PARSE_NUMBER(uint, args[0], delay);
@@ -957,11 +957,11 @@ COMMAND_HANDLER(handle_jtag_ntrst_assert_width_command)
 
 COMMAND_HANDLER(handle_jtag_khz_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int retval = ERROR_OK;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned khz = 0;
 		COMMAND_PARSE_NUMBER(uint, args[0], khz);
@@ -986,11 +986,11 @@ COMMAND_HANDLER(handle_jtag_khz_command)
 
 COMMAND_HANDLER(handle_jtag_rclk_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int retval = ERROR_OK;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned khz = 0;
 		COMMAND_PARSE_NUMBER(uint, args[0], khz);
@@ -1015,7 +1015,7 @@ COMMAND_HANDLER(handle_jtag_rclk_command)
 
 COMMAND_HANDLER(handle_jtag_reset_command)
 {
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int trst = -1;
@@ -1043,7 +1043,7 @@ COMMAND_HANDLER(handle_jtag_reset_command)
 
 COMMAND_HANDLER(handle_runtest_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned num_clocks;
@@ -1082,7 +1082,7 @@ COMMAND_HANDLER(handle_irscan_command)
 	struct jtag_tap *tap;
 	tap_state_t endstate;
 
-	if ((argc &lt; 2) || (argc % 2))
+	if ((CMD_ARGC &lt; 2) || (CMD_ARGC % 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -1093,21 +1093,21 @@ COMMAND_HANDLER(handle_irscan_command)
 	 */
 	endstate = TAP_IDLE;
 
-	if (argc &gt;= 4) {
+	if (CMD_ARGC &gt;= 4) {
 		/* have at least one pair of numbers. */
 		/* is last pair the magic text? */
-		if (strcmp(&quot;-endstate&quot;, args[argc - 2]) == 0) {
-			endstate = tap_state_by_name(args[argc - 1]);
+		if (strcmp(&quot;-endstate&quot;, args[CMD_ARGC - 2]) == 0) {
+			endstate = tap_state_by_name(args[CMD_ARGC - 1]);
 			if (endstate == TAP_INVALID)
 				return ERROR_COMMAND_SYNTAX_ERROR;
 			if (!scan_is_safe(endstate))
 				LOG_WARNING(&quot;unstable irscan endstate \&quot;%s\&quot;&quot;,
-						args[argc - 1]);
-			argc -= 2;
+						args[CMD_ARGC - 1]);
+			CMD_ARGC -= 2;
 		}
 	}
 
-	int num_fields = argc / 2;
+	int num_fields = CMD_ARGC / 2;
 	size_t fields_len = sizeof(struct scan_field) * num_fields;
 	fields = malloc(fields_len);
 	memset(fields, 0, fields_len);
@@ -1352,10 +1352,10 @@ static int Jim_Command_flush_count(Jim_Interp *interp, int argc, Jim_Obj *const
 
 COMMAND_HANDLER(handle_verify_ircapture_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 			jtag_set_verify_capture_ir(true);
@@ -1373,10 +1373,10 @@ COMMAND_HANDLER(handle_verify_ircapture_command)
 
 COMMAND_HANDLER(handle_verify_jtag_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 			jtag_set_verify(true);
@@ -1394,10 +1394,10 @@ COMMAND_HANDLER(handle_verify_jtag_command)
 
 COMMAND_HANDLER(handle_tms_sequence_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		bool use_new_table;
 		if (strcmp(args[0], &quot;short&quot;) == 0)
diff --git a/src/jtag/vsllink.c b/src/jtag/vsllink.c
index 0684dd3..cbea995 100644
--- a/src/jtag/vsllink.c
+++ b/src/jtag/vsllink.c
@@ -1324,7 +1324,7 @@ static void vsllink_simple_command(uint8_t command)
 
 COMMAND_HANDLER(vsllink_handle_mode_command)
 {
-	if (argc != 1) {
+	if (CMD_ARGC != 1) {
 		LOG_ERROR(&quot;parameter error, should be one parameter for VID&quot;);
 		return ERROR_FAIL;
 	}
@@ -1348,7 +1348,7 @@ COMMAND_HANDLER(vsllink_handle_mode_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_vid_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for VID&quot;);
 		return ERROR_OK;
@@ -1360,7 +1360,7 @@ COMMAND_HANDLER(vsllink_handle_usb_vid_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_pid_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for PID&quot;);
 		return ERROR_OK;
@@ -1371,7 +1371,7 @@ COMMAND_HANDLER(vsllink_handle_usb_pid_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_bulkin_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for BULKIN endpoint&quot;);
 		return ERROR_OK;
@@ -1386,7 +1386,7 @@ COMMAND_HANDLER(vsllink_handle_usb_bulkin_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_bulkout_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for BULKOUT endpoint&quot;);
 		return ERROR_OK;
@@ -1401,7 +1401,7 @@ COMMAND_HANDLER(vsllink_handle_usb_bulkout_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_interface_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for interface number&quot;);
 		return ERROR_OK;
diff --git a/src/openocd.c b/src/openocd.c
index 4c07511..1a43b3c 100644
--- a/src/openocd.c
+++ b/src/openocd.c
@@ -52,7 +52,7 @@
 /* Give TELNET a way to find out what version this is */
 COMMAND_HANDLER(handle_version_command)
 {
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	command_print(cmd_ctx, OPENOCD_VERSION);
@@ -95,7 +95,7 @@ int ioutil_init(struct command_context *cmd_ctx);
 COMMAND_HANDLER(handle_init_command)
 {
 
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int retval;
diff --git a/src/pld/pld.c b/src/pld/pld.c
index fdb276f..178da97 100644
--- a/src/pld/pld.c
+++ b/src/pld/pld.c
@@ -62,7 +62,7 @@ COMMAND_HANDLER(handle_pld_device_command)
 	int i;
 	int found = 0;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		LOG_WARNING(&quot;incomplete 'pld device' command&quot;);
 		return ERROR_OK;
@@ -147,7 +147,7 @@ COMMAND_HANDLER(handle_pld_load_command)
 
 	gettimeofday(&amp;start, NULL);
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;usage: pld load &lt;device#&gt; &lt;file&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/pld/virtex2.c b/src/pld/virtex2.c
index c07931e..a6587dd 100644
--- a/src/pld/virtex2.c
+++ b/src/pld/virtex2.c
@@ -183,7 +183,7 @@ COMMAND_HANDLER(virtex2_handle_read_stat_command)
 	struct virtex2_pld_device *virtex2_info;
 	uint32_t status;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: virtex2 read_stat &lt;num&gt;&quot;);
 		return ERROR_OK;
@@ -213,7 +213,7 @@ PLD_DEVICE_COMMAND_HANDLER(virtex2_pld_device_command)
 
 	struct virtex2_pld_device *virtex2_info;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		LOG_WARNING(&quot;incomplete pld device 'virtex2' configuration&quot;);
 		return ERROR_PLD_DEVICE_INVALID;
diff --git a/src/server/gdb_server.c b/src/server/gdb_server.c
index 9581ea6..f5eb71d 100644
--- a/src/server/gdb_server.c
+++ b/src/server/gdb_server.c
@@ -2245,7 +2245,7 @@ int gdb_init(void)
 
 COMMAND_HANDLER(handle_gdb_sync_command)
 {
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2270,7 +2270,7 @@ COMMAND_HANDLER(handle_gdb_port_command)
 
 COMMAND_HANDLER(handle_gdb_memory_map_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 		{
@@ -2291,7 +2291,7 @@ COMMAND_HANDLER(handle_gdb_memory_map_command)
 
 COMMAND_HANDLER(handle_gdb_flash_program_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 		{
@@ -2312,7 +2312,7 @@ COMMAND_HANDLER(handle_gdb_flash_program_command)
 
 COMMAND_HANDLER(handle_gdb_report_data_abort_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 		{
@@ -2334,10 +2334,10 @@ COMMAND_HANDLER(handle_gdb_report_data_abort_command)
 /* gdb_breakpoint_override */
 COMMAND_HANDLER(handle_gdb_breakpoint_override_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 
-	} else if (argc == 1)
+	} else if (CMD_ARGC == 1)
 	{
 		gdb_breakpoint_override = 1;
 		if (strcmp(args[0], &quot;hard&quot;) == 0)
diff --git a/src/server/server.c b/src/server/server.c
index 92292eb..17a116d 100644
--- a/src/server/server.c
+++ b/src/server/server.c
@@ -551,7 +551,7 @@ int server_register_commands(struct command_context *context)
 
 SERVER_PORT_COMMAND()
 {
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		command_print(cmd_ctx, &quot;%d&quot;, *out);
 		break;
diff --git a/src/svf/svf.c b/src/svf/svf.c
index fb5e1b0..c51e609 100644
--- a/src/svf/svf.c
+++ b/src/svf/svf.c
@@ -308,7 +308,7 @@ COMMAND_HANDLER(handle_svf_command)
 	int ret = ERROR_OK;
 	long long time_ago;
 
-	if ((argc &lt; 1) || (argc &gt; (1 + SVF_NUM_OF_OPTIONS)))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; (1 + SVF_NUM_OF_OPTIONS)))
 	{
 		command_print(cmd_ctx, &quot;usage: svf &lt;file&gt; [quiet]&quot;);
 		return ERROR_FAIL;
@@ -316,7 +316,7 @@ COMMAND_HANDLER(handle_svf_command)
 
 	// parse variant
 	svf_quiet = 0;
-	for (unsigned i = 1; i &lt; argc; i++)
+	for (unsigned i = 1; i &lt; CMD_ARGC; i++)
 	{
 		if (!strcmp(args[i], &quot;quiet&quot;))
 		{
diff --git a/src/target/arm11.c b/src/target/arm11.c
index 936edd8..4236ac8 100644
--- a/src/target/arm11.c
+++ b/src/target/arm11.c
@@ -2005,13 +2005,13 @@ static int arm11_build_reg_cache(struct target *target)
 
 static COMMAND_HELPER(arm11_handle_bool, bool *var, char *name)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		LOG_INFO(&quot;%s is %s.&quot;, name, *var ? &quot;enabled&quot; : &quot;disabled&quot;);
 		return ERROR_OK;
 	}
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	switch (args[0][0])
@@ -2052,7 +2052,7 @@ BOOL_WRAPPER(hardware_step,			&quot;hardware single step&quot;)
 
 COMMAND_HANDLER(arm11_handle_vcr)
 {
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		break;
 	case 1:
diff --git a/src/target/arm720t.c b/src/target/arm720t.c
index 3bac0be..53d2224 100644
--- a/src/target/arm720t.c
+++ b/src/target/arm720t.c
@@ -429,12 +429,12 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 	}
 
 	/* one or more argument, access a single register (write if second argument is given */
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		uint32_t opcode;
 		COMMAND_PARSE_NUMBER(u32, args[0], opcode);
 
-		if (argc == 1)
+		if (CMD_ARGC == 1)
 		{
 			uint32_t value;
 			if ((retval = arm720t_read_cp15(target, opcode, &amp;value)) != ERROR_OK)
@@ -450,7 +450,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 
 			command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
-		else if (argc == 2)
+		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index 923c8cd..19c9791 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2765,7 +2765,7 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_command)
 		return ERROR_FAIL;
 	}
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;usage: write_xpsr &lt;value&gt; &lt;not cpsr | spsr&gt;&quot;);
 		return ERROR_FAIL;
@@ -2809,7 +2809,7 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_im8_command)
 		return ERROR_FAIL;
 	}
 
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 		command_print(cmd_ctx, &quot;usage: write_xpsr_im8 &lt;im8&gt; &lt;rotate&gt; &lt;not cpsr | spsr&gt;&quot;);
 		return ERROR_FAIL;
@@ -2849,7 +2849,7 @@ COMMAND_HANDLER(handle_arm7_9_write_core_reg_command)
 		return ERROR_FAIL;
 	}
 
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 		command_print(cmd_ctx, &quot;usage: write_core_reg &lt;num&gt; &lt;mode&gt; &lt;value&gt;&quot;);
 		return ERROR_FAIL;
@@ -2873,7 +2873,7 @@ COMMAND_HANDLER(handle_arm7_9_dbgrq_command)
 		return ERROR_TARGET_INVALID;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
@@ -2905,7 +2905,7 @@ COMMAND_HANDLER(handle_arm7_9_fast_memory_access_command)
 		return ERROR_TARGET_INVALID;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
@@ -2937,7 +2937,7 @@ COMMAND_HANDLER(handle_arm7_9_dcc_downloads_command)
 		return ERROR_TARGET_INVALID;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index 62dd3a1..58e92c3 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -682,7 +682,7 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: arm920t read_cache &lt;filename&gt;&quot;);
 		return ERROR_OK;
@@ -928,7 +928,7 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: arm920t read_mmu &lt;filename&gt;&quot;);
 		return ERROR_OK;
@@ -1207,12 +1207,12 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 	}
 
 	/* one or more argument, access a single register (write if second argument is given */
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		int address;
 		COMMAND_PARSE_NUMBER(int, args[0], address);
 
-		if (argc == 1)
+		if (CMD_ARGC == 1)
 		{
 			uint32_t value;
 			if ((retval = arm920t_read_cp15_physical(target, address, &amp;value)) != ERROR_OK)
@@ -1227,7 +1227,7 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 
 			command_print(cmd_ctx, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
 		}
-		else if (argc == 2)
+		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
@@ -1261,12 +1261,12 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 	}
 
 	/* one or more argument, access a single register (write if second argument is given */
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		uint32_t opcode;
 		COMMAND_PARSE_NUMBER(u32, args[0], opcode);
 
-		if (argc == 1)
+		if (CMD_ARGC == 1)
 		{
 			uint32_t value;
 			if ((retval = arm920t_read_cp15_interpreted(target, opcode, 0x0, &amp;value)) != ERROR_OK)
@@ -1277,7 +1277,7 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 
 			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
-		else if (argc == 2)
+		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
@@ -1288,7 +1288,7 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 			}
 			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
-		else if (argc == 3)
+		else if (CMD_ARGC == 3)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
diff --git a/src/target/arm926ejs.c b/src/target/arm926ejs.c
index e38e7df..4e20664 100644
--- a/src/target/arm926ejs.c
+++ b/src/target/arm926ejs.c
@@ -722,7 +722,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 	int CRn;
 	int CRm;
 
-	if ((argc &lt; 4) || (argc &gt; 5))
+	if ((CMD_ARGC &lt; 4) || (CMD_ARGC &gt; 5))
 	{
 		command_print(cmd_ctx, &quot;usage: arm926ejs cp15 &lt;opcode_1&gt; &lt;opcode_2&gt; &lt;CRn&gt; &lt;CRm&gt; [value]&quot;);
 		return ERROR_OK;
@@ -743,7 +743,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 		return ERROR_OK;
 	}
 
-	if (argc == 4)
+	if (CMD_ARGC == 4)
 	{
 		uint32_t value;
 		if ((retval = arm926ejs-&gt;read_cp15(target, opcode_1, opcode_2, CRn, CRm, &amp;value)) != ERROR_OK)
diff --git a/src/target/arm966e.c b/src/target/arm966e.c
index fc50acb..0c08a60 100644
--- a/src/target/arm966e.c
+++ b/src/target/arm966e.c
@@ -179,12 +179,12 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 	}
 
 	/* one or more argument, access a single register (write if second argument is given */
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		uint32_t address;
 		COMMAND_PARSE_NUMBER(u32, args[0], address);
 
-		if (argc == 1)
+		if (CMD_ARGC == 1)
 		{
 			uint32_t value;
 			if ((retval = arm966e_read_cp15(target, address, &amp;value)) != ERROR_OK)
@@ -202,7 +202,7 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 			command_print(cmd_ctx, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
 					address, value);
 		}
-		else if (argc == 2)
+		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index 3492c2a..b582eae 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -853,7 +853,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 	/* get the current setting */
 	vector_catch_value = buf_get_u32(vector_catch-&gt;value, 0, 8);
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		vector_catch_value = 0x0;
 		if (strcmp(args[0], &quot;all&quot;) == 0)
@@ -866,7 +866,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 		}
 		else
 		{
-			for (unsigned i = 0; i &lt; argc; i++)
+			for (unsigned i = 0; i &lt; CMD_ARGC; i++)
 			{
 				/* go through list of vectors */
 				unsigned j;
diff --git a/src/target/arm_adi_v5.c b/src/target/arm_adi_v5.c
index 958844b..dcae818 100644
--- a/src/target/arm_adi_v5.c
+++ b/src/target/arm_adi_v5.c
@@ -1370,7 +1370,7 @@ DAP_COMMAND_HANDLER(dap_baseaddr_command)
 	int retval;
 
 	apselsave = swjdp-&gt;apsel;
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
@@ -1398,7 +1398,7 @@ DAP_COMMAND_HANDLER(dap_memaccess_command)
 {
 	uint32_t memaccess_tck;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		memaccess_tck = swjdp-&gt;memaccess_tck;
 		break;
@@ -1421,7 +1421,7 @@ DAP_COMMAND_HANDLER(dap_apsel_command)
 	uint32_t apsel, apid;
 	int retval;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = 0;
 		break;
@@ -1447,7 +1447,7 @@ DAP_COMMAND_HANDLER(dap_apid_command)
 	int retval;
 
 	apselsave = swjdp-&gt;apsel;
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 413061f..4c2a6e5 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -422,7 +422,7 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
 		return ERROR_FAIL;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (strcmp(args[0], &quot;arm&quot;) == 0)
 		{
@@ -453,7 +453,7 @@ COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 		return ERROR_FAIL;
 	}
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 3:
 		if (strcmp(args[2], &quot;thumb&quot;) != 0)
 			goto usage;
diff --git a/src/target/armv7a.c b/src/target/armv7a.c
index 5193b2a..31ab4b4 100644
--- a/src/target/armv7a.c
+++ b/src/target/armv7a.c
@@ -259,7 +259,7 @@ COMMAND_HANDLER(handle_dap_info_command)
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 	uint32_t apsel;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
diff --git a/src/target/armv7m.c b/src/target/armv7m.c
index 8c1de32..e9d46df 100644
--- a/src/target/armv7m.c
+++ b/src/target/armv7m.c
@@ -766,7 +766,7 @@ COMMAND_HANDLER(handle_dap_baseaddr_command)
 	int retval;
 
 	apselsave = swjdp-&gt;apsel;
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
@@ -829,7 +829,7 @@ COMMAND_HANDLER(handle_dap_info_command)
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 	uint32_t apsel;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
diff --git a/src/target/cortex_m3.c b/src/target/cortex_m3.c
index c7b978b..0584434 100644
--- a/src/target/cortex_m3.c
+++ b/src/target/cortex_m3.c
@@ -1780,7 +1780,7 @@ COMMAND_HANDLER(handle_cortex_m3_disassemble_command)
 		return retval;
 
 	errno = 0;
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 2:
 		COMMAND_PARSE_NUMBER(ulong, args[1], count);
 		/* FALL THROUGH */
@@ -1832,10 +1832,10 @@ COMMAND_HANDLER(handle_cortex_m3_vector_catch_command)
 
 	mem_ap_read_atomic_u32(swjdp, DCB_DEMCR, &amp;demcr);
 
-	if (argc &gt; 0) {
+	if (CMD_ARGC &gt; 0) {
 		unsigned catch = 0;
 
-		if (argc == 1) {
+		if (CMD_ARGC == 1) {
 			if (strcmp(args[0], &quot;all&quot;) == 0) {
 				catch = VC_HARDERR | VC_INTERR | VC_BUSERR
 					| VC_STATERR | VC_CHKERR | VC_NOCPERR
@@ -1845,16 +1845,16 @@ COMMAND_HANDLER(handle_cortex_m3_vector_catch_command)
 				goto write;
 			}
 		}
-		while (argc-- &gt; 0) {
+		while (CMD_ARGC-- &gt; 0) {
 			unsigned i;
 			for (i = 0; i &lt; ARRAY_SIZE(vec_ids); i++) {
-				if (strcmp(args[argc], vec_ids[i].name) != 0)
+				if (strcmp(args[CMD_ARGC], vec_ids[i].name) != 0)
 					continue;
 				catch |= vec_ids[i].mask;
 				break;
 			}
 			if (i == ARRAY_SIZE(vec_ids)) {
-				LOG_ERROR(&quot;No CM3 vector '%s'&quot;, args[argc]);
+				LOG_ERROR(&quot;No CM3 vector '%s'&quot;, args[CMD_ARGC]);
 				return ERROR_INVALID_ARGUMENTS;
 			}
 		}
@@ -1890,7 +1890,7 @@ COMMAND_HANDLER(handle_cortex_m3_mask_interrupts_command)
 		return ERROR_OK;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (!strcmp(args[0], &quot;on&quot;))
 		{
diff --git a/src/target/etb.c b/src/target/etb.c
index 859ebaf..2ad5156 100644
--- a/src/target/etb.c
+++ b/src/target/etb.c
@@ -354,7 +354,7 @@ COMMAND_HANDLER(handle_etb_config_command)
 	struct jtag_tap *tap;
 	struct arm *arm;
 
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
diff --git a/src/target/etm.c b/src/target/etm.c
index 31b8bb2..044ccb0 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -1263,7 +1263,7 @@ COMMAND_HANDLER(handle_etm_tracemode_command)
 
 	etmv1_tracemode_t tracemode = etm-&gt;tracemode;
 
-	switch (argc)
+	switch (CMD_ARGC)
 	{
 	case 0:
 		break;
@@ -1374,7 +1374,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 	struct etm_context *etm_ctx;
 	int i;
 
-	if (argc != 5)
+	if (CMD_ARGC != 5)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	target = get_target(args[0]);
@@ -1730,7 +1730,7 @@ COMMAND_HANDLER(handle_etm_image_command)
 	struct arm *arm;
 	struct etm_context *etm_ctx;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: etm image &lt;file&gt; [base address] [type]&quot;);
 		return ERROR_FAIL;
@@ -1763,7 +1763,7 @@ COMMAND_HANDLER(handle_etm_image_command)
 	etm_ctx-&gt;image-&gt;start_address_set = 0;
 
 	/* a base address isn't always necessary, default to 0x0 (i.e. don't relocate) */
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		etm_ctx-&gt;image-&gt;base_address_set = 1;
 		COMMAND_PARSE_NUMBER(int, args[1], etm_ctx-&gt;image-&gt;base_address);
@@ -1773,7 +1773,7 @@ COMMAND_HANDLER(handle_etm_image_command)
 		etm_ctx-&gt;image-&gt;base_address_set = 0;
 	}
 
-	if (image_open(etm_ctx-&gt;image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(etm_ctx-&gt;image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
 	{
 		free(etm_ctx-&gt;image);
 		etm_ctx-&gt;image = NULL;
@@ -1791,7 +1791,7 @@ COMMAND_HANDLER(handle_etm_dump_command)
 	struct etm_context *etm_ctx;
 	uint32_t i;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: etm dump &lt;file&gt;&quot;);
 		return ERROR_FAIL;
@@ -1859,7 +1859,7 @@ COMMAND_HANDLER(handle_etm_load_command)
 	struct etm_context *etm_ctx;
 	uint32_t i;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: etm load &lt;file&gt;&quot;);
 		return ERROR_FAIL;
@@ -1956,7 +1956,7 @@ COMMAND_HANDLER(handle_etm_trigger_percent_command)
 		return ERROR_FAIL;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		uint32_t new_value;
 		COMMAND_PARSE_NUMBER(u32, args[0], new_value);
diff --git a/src/target/oocd_trace.c b/src/target/oocd_trace.c
index cad4977..47c2bb4 100644
--- a/src/target/oocd_trace.c
+++ b/src/target/oocd_trace.c
@@ -294,7 +294,7 @@ COMMAND_HANDLER(handle_oocd_trace_config_command)
 	struct target *target;
 	struct arm *arm;
 
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		LOG_ERROR(&quot;incomplete 'oocd_trace config &lt;target&gt; &lt;tty&gt;' command&quot;);
 		return ERROR_FAIL;
diff --git a/src/target/target.c b/src/target/target.c
index 0b2438c..88fea17 100644
--- a/src/target/target.c
+++ b/src/target/target.c
@@ -1648,7 +1648,7 @@ COMMAND_HANDLER(handle_targets_command)
 {
 	struct target *target = all_targets;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		target = get_target(args[0]);
 		if (target == NULL) {
@@ -1868,7 +1868,7 @@ COMMAND_HANDLER(handle_reg_command)
 	target = get_current_target(cmd_ctx);
 
 	/* list all available registers for the current target */
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		struct reg_cache *cache = target-&gt;reg_cache;
 
@@ -1948,9 +1948,9 @@ COMMAND_HANDLER(handle_reg_command)
 	}
 
 	/* display a register */
-	if ((argc == 1) || ((argc == 2) &amp;&amp; !((args[1][0] &gt;= '0') &amp;&amp; (args[1][0] &lt;= '9'))))
+	if ((CMD_ARGC == 1) || ((CMD_ARGC == 2) &amp;&amp; !((args[1][0] &gt;= '0') &amp;&amp; (args[1][0] &lt;= '9'))))
 	{
-		if ((argc == 2) &amp;&amp; (strcmp(args[1], &quot;force&quot;) == 0))
+		if ((CMD_ARGC == 2) &amp;&amp; (strcmp(args[1], &quot;force&quot;) == 0))
 			reg-&gt;valid = 0;
 
 		if (reg-&gt;valid == 0)
@@ -1964,7 +1964,7 @@ COMMAND_HANDLER(handle_reg_command)
 	}
 
 	/* set register value */
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 	{
 		uint8_t *buf = malloc(DIV_ROUND_UP(reg-&gt;size, 8));
 		str_to_buf(args[1], strlen(args[1]), buf, reg-&gt;size, 0);
@@ -1990,7 +1990,7 @@ COMMAND_HANDLER(handle_poll_command)
 	int retval = ERROR_OK;
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		command_print(cmd_ctx, &quot;background polling: %s&quot;,
 				jtag_poll_get_enabled() ? &quot;on&quot; : &quot;off&quot;);
@@ -2005,7 +2005,7 @@ COMMAND_HANDLER(handle_poll_command)
 			return retval;
 
 	}
-	else if (argc == 1)
+	else if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;on&quot;) == 0)
 		{
@@ -2029,11 +2029,11 @@ COMMAND_HANDLER(handle_poll_command)
 
 COMMAND_HANDLER(handle_wait_halt_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned ms = 5000;
-	if (1 == argc)
+	if (1 == CMD_ARGC)
 	{
 		int retval = parse_uint(args[0], &amp;ms);
 		if (ERROR_OK != retval)
@@ -2103,7 +2103,7 @@ COMMAND_HANDLER(handle_halt_command)
 	if (ERROR_OK != retval)
 		return retval;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned wait;
 		retval = parse_uint(args[0], &amp;wait);
@@ -2129,11 +2129,11 @@ COMMAND_HANDLER(handle_soft_reset_halt_command)
 
 COMMAND_HANDLER(handle_reset_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	enum target_reset_mode reset_mode = RESET_RUN;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		const Jim_Nvp *n;
 		n = Jim_Nvp_name2value_simple(nvp_reset_modes, args[0]);
@@ -2151,7 +2151,7 @@ COMMAND_HANDLER(handle_reset_command)
 COMMAND_HANDLER(handle_resume_command)
 {
 	int current = 1;
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct target *target = get_current_target(cmd_ctx);
@@ -2161,7 +2161,7 @@ COMMAND_HANDLER(handle_resume_command)
 	 * with one arguments, addr = args[0],
 	 * handle breakpoints, not debugging */
 	uint32_t addr = 0;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[0], addr);
 		current = 0;
@@ -2172,7 +2172,7 @@ COMMAND_HANDLER(handle_resume_command)
 
 COMMAND_HANDLER(handle_step_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	LOG_DEBUG(&quot;-&quot;);
@@ -2182,7 +2182,7 @@ COMMAND_HANDLER(handle_step_command)
 	 * handle breakpoints, debugging */
 	uint32_t addr = 0;
 	int current_pc = 1;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[0], addr);
 		current_pc = 0;
@@ -2244,7 +2244,7 @@ static void handle_md_output(struct command_context *cmd_ctx,
 
 COMMAND_HANDLER(handle_md_command)
 {
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned size = 0;
@@ -2261,14 +2261,14 @@ COMMAND_HANDLER(handle_md_command)
 			uint32_t address, uint32_t size, uint32_t count, uint8_t *buffer);
 	if (physical)
 	{
-		argc--;
+		CMD_ARGC--;
 		args++;
 		fn=target_read_phys_memory;
 	} else
 	{
 		fn=target_read_memory;
 	}
-	if ((argc &lt; 1) || (argc &gt; 2))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2277,7 +2277,7 @@ COMMAND_HANDLER(handle_md_command)
 	COMMAND_PARSE_NUMBER(u32, args[0], address);
 
 	unsigned count = 1;
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 		COMMAND_PARSE_NUMBER(uint, args[1], count);
 
 	uint8_t *buffer = calloc(count, size);
@@ -2294,7 +2294,7 @@ COMMAND_HANDLER(handle_md_command)
 
 COMMAND_HANDLER(handle_mw_command)
 {
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2304,14 +2304,14 @@ COMMAND_HANDLER(handle_mw_command)
 	const char *cmd_name = CMD_NAME;
 	if (physical)
 	{
-		argc--;
+		CMD_ARGC--;
 		args++;
 		fn=target_write_phys_memory;
 	} else
 	{
 		fn=target_write_memory;
 	}
-	if ((argc &lt; 2) || (argc &gt; 3))
+	if ((CMD_ARGC &lt; 2) || (CMD_ARGC &gt; 3))
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t address;
@@ -2321,7 +2321,7 @@ COMMAND_HANDLER(handle_mw_command)
 	COMMAND_PARSE_NUMBER(u32, args[1], value);
 
 	unsigned count = 1;
-	if (argc == 3)
+	if (CMD_ARGC == 3)
 		COMMAND_PARSE_NUMBER(uint, args[2], count);
 
 	struct target *target = get_current_target(cmd_ctx);
@@ -2360,12 +2360,12 @@ COMMAND_HANDLER(handle_mw_command)
 static COMMAND_HELPER(parse_load_image_command_args, struct image *image,
 		uint32_t *min_address, uint32_t *max_address)
 {
-	if (argc &lt; 1 || argc &gt; 5)
+	if (CMD_ARGC &lt; 1 || CMD_ARGC &gt; 5)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	/* a base address isn't always necessary,
 	 * default to 0x0 (i.e. don't relocate) */
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		uint32_t addr;
 		COMMAND_PARSE_NUMBER(u32, args[1], addr);
@@ -2377,11 +2377,11 @@ static COMMAND_HELPER(parse_load_image_command_args, struct image *image,
 
 	image-&gt;start_address_set = 0;
 
-	if (argc &gt;= 4)
+	if (CMD_ARGC &gt;= 4)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[3], *min_address);
 	}
-	if (argc == 5)
+	if (CMD_ARGC == 5)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[4], *max_address);
 		// use size (given) to find max (required)
@@ -2414,7 +2414,7 @@ COMMAND_HANDLER(handle_load_image_command)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (image_open(&amp;image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(&amp;image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
 	{
 		return ERROR_OK;
 	}
@@ -2495,7 +2495,7 @@ COMMAND_HANDLER(handle_dump_image_command)
 
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 	{
 		command_print(cmd_ctx, &quot;usage: dump_image &lt;filename&gt; &lt;address&gt; &lt;size&gt;&quot;);
 		return ERROR_OK;
@@ -2562,7 +2562,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2576,7 +2576,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		uint32_t addr;
 		COMMAND_PARSE_NUMBER(u32, args[1], addr);
@@ -2591,7 +2591,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 
 	image.start_address_set = 0;
 
-	if ((retval = image_open(&amp;image, args[0], (argc == 3) ? args[2] : NULL)) != ERROR_OK)
+	if ((retval = image_open(&amp;image, args[0], (CMD_ARGC == 3) ? args[2] : NULL)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -2745,10 +2745,10 @@ static int handle_bp_command_set(struct command_context *cmd_ctx,
 
 COMMAND_HANDLER(handle_bp_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 		return handle_bp_command_list(cmd_ctx);
 
-	if (argc &lt; 2 || argc &gt; 3)
+	if (CMD_ARGC &lt; 2 || CMD_ARGC &gt; 3)
 	{
 		command_print(cmd_ctx, &quot;usage: bp &lt;address&gt; &lt;length&gt; ['hw']&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2760,7 +2760,7 @@ COMMAND_HANDLER(handle_bp_command)
 	COMMAND_PARSE_NUMBER(u32, args[1], length);
 
 	int hw = BKPT_SOFT;
-	if (argc == 3)
+	if (CMD_ARGC == 3)
 	{
 		if (strcmp(args[2], &quot;hw&quot;) == 0)
 			hw = BKPT_HARD;
@@ -2773,7 +2773,7 @@ COMMAND_HANDLER(handle_bp_command)
 
 COMMAND_HANDLER(handle_rbp_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t addr;
@@ -2789,7 +2789,7 @@ COMMAND_HANDLER(handle_wp_command)
 {
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		struct watchpoint *watchpoint = target-&gt;watchpoints;
 
@@ -2815,7 +2815,7 @@ COMMAND_HANDLER(handle_wp_command)
 	uint32_t data_value = 0x0;
 	uint32_t data_mask = 0xffffffff;
 
-	switch (argc)
+	switch (CMD_ARGC)
 	{
 	case 5:
 		COMMAND_PARSE_NUMBER(u32, args[4], data_mask);
@@ -2861,7 +2861,7 @@ COMMAND_HANDLER(handle_wp_command)
 
 COMMAND_HANDLER(handle_rwp_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t addr;
@@ -2882,7 +2882,7 @@ COMMAND_HANDLER(handle_rwp_command)
  */
 COMMAND_HANDLER(handle_virt2phys_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t va;
@@ -3020,7 +3020,7 @@ COMMAND_HANDLER(handle_profile_command)
 	struct timeval timeout, now;
 
 	gettimeofday(&amp;timeout, NULL);
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -4551,7 +4551,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (image_open(&amp;image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(&amp;image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
 	{
 		return ERROR_OK;
 	}
@@ -4645,7 +4645,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 
 COMMAND_HANDLER(handle_fast_load_command)
 {
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	if (fastload == NULL)
 	{
diff --git a/src/target/target_request.c b/src/target/target_request.c
index be176ca..c5de691 100644
--- a/src/target/target_request.c
+++ b/src/target/target_request.c
@@ -268,7 +268,7 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 	if (find_debug_msg_receiver(cmd_ctx, target) != NULL)
 		receiving = 1;
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (!strcmp(args[0], &quot;enable&quot;) || !strcmp(args[0], &quot;charmsg&quot;))
 		{
diff --git a/src/target/trace.c b/src/target/trace.c
index 6ec08d6..88f4ed3 100644
--- a/src/target/trace.c
+++ b/src/target/trace.c
@@ -52,7 +52,7 @@ COMMAND_HANDLER(handle_trace_point_command)
 	struct target *target = get_current_target(cmd_ctx);
 	struct trace *trace = target-&gt;trace_info;
 
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		uint32_t i;
 
@@ -100,7 +100,7 @@ COMMAND_HANDLER(handle_trace_history_command)
 	struct target *target = get_current_target(cmd_ctx);
 	struct trace *trace = target-&gt;trace_info;
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		trace-&gt;trace_history_pos = 0;
 		trace-&gt;trace_history_overflowed = 0;
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 4c3945c..3af28d0 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -2995,7 +2995,7 @@ COMMAND_HANDLER(xscale_handle_debug_handler_command)
 	int retval;
 	uint32_t handler_address;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		LOG_ERROR(&quot;'xscale debug_handler &lt;target#&gt; &lt;address&gt;' command takes two required operands&quot;);
 		return ERROR_OK;
@@ -3035,7 +3035,7 @@ COMMAND_HANDLER(xscale_handle_cache_clean_address_command)
 	int retval;
 	uint32_t cache_clean_address;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -3130,7 +3130,7 @@ COMMAND_HANDLER(xscale_handle_mmu_command)
 		return ERROR_OK;
 	}
 
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
@@ -3171,7 +3171,7 @@ COMMAND_HANDLER(xscale_handle_idcache_command)
 	else if (strcmp(CMD_NAME, &quot;dcache&quot;) == 0)
 		dcache = 1;
 
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
@@ -3212,7 +3212,7 @@ COMMAND_HANDLER(xscale_handle_vector_catch_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: xscale vector_catch [mask]&quot;);
 	}
@@ -3240,7 +3240,7 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (argc == 0) /* print current settings */
+	if (CMD_ARGC == 0) /* print current settings */
 	{
 		int idx;
 
@@ -3254,7 +3254,7 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 		return ERROR_OK;
 	}
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 		err = 1;
 	else
 	{
@@ -3305,7 +3305,7 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 		return ERROR_OK;
 	}
 
-	if ((argc &gt;= 1) &amp;&amp; (strcmp(&quot;enable&quot;, args[0]) == 0))
+	if ((CMD_ARGC &gt;= 1) &amp;&amp; (strcmp(&quot;enable&quot;, args[0]) == 0))
 	{
 		struct xscale_trace_data *td, *next_td;
 		xscale-&gt;trace.buffer_enabled = 1;
@@ -3323,19 +3323,19 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 		}
 		xscale-&gt;trace.data = NULL;
 	}
-	else if ((argc &gt;= 1) &amp;&amp; (strcmp(&quot;disable&quot;, args[0]) == 0))
+	else if ((CMD_ARGC &gt;= 1) &amp;&amp; (strcmp(&quot;disable&quot;, args[0]) == 0))
 	{
 		xscale-&gt;trace.buffer_enabled = 0;
 	}
 
-	if ((argc &gt;= 2) &amp;&amp; (strcmp(&quot;fill&quot;, args[1]) == 0))
+	if ((CMD_ARGC &gt;= 2) &amp;&amp; (strcmp(&quot;fill&quot;, args[1]) == 0))
 	{
 		uint32_t fill = 1;
-		if (argc &gt;= 3)
+		if (CMD_ARGC &gt;= 3)
 			COMMAND_PARSE_NUMBER(u32, args[2], fill);
 		xscale-&gt;trace.buffer_fill = fill;
 	}
-	else if ((argc &gt;= 2) &amp;&amp; (strcmp(&quot;wrap&quot;, args[1]) == 0))
+	else if ((CMD_ARGC &gt;= 2) &amp;&amp; (strcmp(&quot;wrap&quot;, args[1]) == 0))
 	{
 		xscale-&gt;trace.buffer_fill = -1;
 	}
@@ -3372,7 +3372,7 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: xscale trace_image &lt;file&gt; [base address] [type]&quot;);
 		return ERROR_OK;
@@ -3394,7 +3394,7 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 	xscale-&gt;trace.image-&gt;start_address_set = 0;
 
 	/* a base address isn't always necessary, default to 0x0 (i.e. don't relocate) */
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		xscale-&gt;trace.image-&gt;base_address_set = 1;
 		COMMAND_PARSE_NUMBER(int, args[1], xscale-&gt;trace.image-&gt;base_address);
@@ -3404,7 +3404,7 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 		xscale-&gt;trace.image-&gt;base_address_set = 0;
 	}
 
-	if (image_open(xscale-&gt;trace.image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(xscale-&gt;trace.image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
 	{
 		free(xscale-&gt;trace.image);
 		xscale-&gt;trace.image = NULL;
@@ -3432,7 +3432,7 @@ COMMAND_HANDLER(xscale_handle_dump_trace_command)
 		return ERROR_OK;
 	}
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: xscale dump_trace &lt;file&gt;&quot;);
 		return ERROR_OK;
@@ -3503,7 +3503,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 	}
 	uint32_t reg_no = 0;
 	struct reg *reg = NULL;
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[0], reg_no);
 		/*translate from xscale cp15 register no to openocd register*/
@@ -3540,7 +3540,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 		reg = &amp;xscale-&gt;reg_cache-&gt;reg_list[reg_no];
 
 	}
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		uint32_t value;
 
@@ -3549,7 +3549,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 		value = buf_get_u32(reg-&gt;value, 0, 32);
 		command_print(cmd_ctx, &quot;%s (/%i): 0x%&quot; PRIx32 &quot;&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
 	}
-	else if (argc == 2)
+	else if (CMD_ARGC == 2)
 	{
 		uint32_t value;
 		COMMAND_PARSE_NUMBER(u32, args[1], value);
diff --git a/src/xsvf/xsvf.c b/src/xsvf/xsvf.c
index 01a9411..311acc6 100644
--- a/src/xsvf/xsvf.c
+++ b/src/xsvf/xsvf.c
@@ -219,7 +219,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 	*/
 	struct jtag_tap *tap = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;usage: xsvf &lt;device#|plain&gt; &lt;file&gt; [&lt;variant&gt;] [quiet]&quot;);
 		return ERROR_FAIL;
@@ -245,14 +245,14 @@ COMMAND_HANDLER(handle_xsvf_command)
 	}
 
 	/* if this argument is present, then interpret xruntest counts as TCK cycles rather than as usecs */
-	if ((argc &gt; 2) &amp;&amp; (strcmp(args[2], &quot;virt2&quot;) == 0))
+	if ((CMD_ARGC &gt; 2) &amp;&amp; (strcmp(args[2], &quot;virt2&quot;) == 0))
 	{
 		runtest_requires_tck = 1;
-		--argc;
+		--CMD_ARGC;
 		++args;
 	}
 
-	if ((argc &gt; 2) &amp;&amp; (strcmp(args[2], &quot;quiet&quot;) == 0))
+	if ((CMD_ARGC &gt; 2) &amp;&amp; (strcmp(args[2], &quot;quiet&quot;) == 0))
 	{
 		verbose = 0;
 	}

commit 5b9899d6ea1e0cf763465c64c700f20eddd893f9
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Sun Nov 15 04:18:51 2009 -0800

    add more command_handler conversion macros
    
    Add additional macros to allow command handling to be migrated easily:
    CMD_CTX, CMD_ARGC, and CMD_ARGV.  Updates CMD_NAME to use CMD_ARGV.
    
    In addition to making the remaining patches of this series cleaner,
    this introduces easily sed-able symbols that could allow us to retire
    these once the command handler infrastructure matures (i.e. pre-1.0).

diff --git a/src/helper/command.h b/src/helper/command.h
index 79e57f5..3e36627 100644
--- a/src/helper/command.h
+++ b/src/helper/command.h
@@ -122,10 +122,25 @@ struct command_context
 #define COMMAND_HELPER(name, extra...) __COMMAND_HANDLER(name, extra)
 
 /**
+ * Use this macro to access the context of the command being handled,
+ * rather than accessing the variable directly.  It may be moved.
+ */
+#define CMD_CTX cmd_ctx
+/**
+ * Use this macro to access the number of arguments for the command being
+ * handled, rather than accessing the variable directly.  It may be moved.
+ */
+#define CMD_ARGC argc
+/**
+ * Use this macro to access the arguments for the command being handled,
+ * rather than accessing the variable directly.  It may be moved.
+ */
+#define CMD_ARGV args
+/**
  * Use this macro to access the name of the command being handled,
  * rather than accessing the variable directly.  It may be moved.
  */
-#define CMD_NAME args[-1]
+#define CMD_NAME CMD_ARGV[-1]
 
 
 /// The type signature for commands' handler functions.

-----------------------------------------------------------------------

Summary of changes:
 doc/manual/helper.txt               |   30 ++--
 doc/manual/primer/commands.txt      |   13 +-
 src/flash/at91sam3.c                |   48 +++---
 src/flash/at91sam7.c                |   40 +++---
 src/flash/avrf.c                    |   10 +-
 src/flash/cfi.c                     |   12 +-
 src/flash/davinci_nand.c            |   24 ++--
 src/flash/ecos.c                    |    8 +-
 src/flash/faux.c                    |    6 +-
 src/flash/flash.c                   |  172 ++++++++++----------
 src/flash/flash.h                   |   22 ++--
 src/flash/lpc2000.c                 |   24 ++--
 src/flash/lpc288x.c                 |    4 +-
 src/flash/lpc2900.c                 |   44 +++---
 src/flash/lpc3180_nand_controller.c |   22 ++--
 src/flash/mflash.c                  |   48 +++---
 src/flash/mx3_nand.c                |    8 +-
 src/flash/nand.c                    |  136 ++++++++--------
 src/flash/ocl.c                     |    2 +-
 src/flash/orion_nand.c              |    8 +-
 src/flash/pic32mx.c                 |   44 +++---
 src/flash/s3c24xx_nand.c            |    4 +-
 src/flash/stellaris.c               |   10 +-
 src/flash/stm32x.c                  |   70 ++++----
 src/flash/str7x.c                   |   14 +-
 src/flash/str9x.c                   |   12 +-
 src/flash/str9xpec.c                |   78 +++++-----
 src/flash/tms470.c                  |   44 +++---
 src/hello.c                         |    8 +-
 src/helper/command.c                |   38 +++--
 src/helper/command.h                |   35 ++++-
 src/helper/ioutil.c                 |   60 ++++----
 src/helper/log.c                    |   12 +-
 src/jtag/amt_jtagaccel.c            |   12 +-
 src/jtag/at91rm9200.c               |    8 +-
 src/jtag/ft2232.c                   |   34 ++--
 src/jtag/gw16012.c                  |    6 +-
 src/jtag/jlink.c                    |    6 +-
 src/jtag/parport.c                  |   26 ++--
 src/jtag/presto.c                   |    4 +-
 src/jtag/tcl.c                      |  184 ++++++++++----------
 src/jtag/vsllink.c                  |   28 ++--
 src/openocd.c                       |   22 ++--
 src/pld/pld.c                       |   34 ++--
 src/pld/virtex2.c                   |   16 +-
 src/server/gdb_server.c             |   38 ++--
 src/server/httpd.c                  |    4 +-
 src/server/server.c                 |    6 +-
 src/svf/svf.c                       |   24 ++--
 src/target/arm11.c                  |   10 +-
 src/target/arm720t.c                |   24 ++--
 src/target/arm7_9_common.c          |   88 +++++-----
 src/target/arm920t.c                |   90 +++++-----
 src/target/arm926ejs.c              |   36 ++--
 src/target/arm966e.c                |   24 ++--
 src/target/arm9tdmi.c               |   18 +-
 src/target/arm_adi_v5.c             |   24 ++--
 src/target/armv4_5.c                |   42 +++---
 src/target/armv7a.c                 |   16 +-
 src/target/armv7m.c                 |   22 ++--
 src/target/cortex_a8.c              |    6 +-
 src/target/cortex_m3.c              |   53 +++---
 src/target/etb.c                    |   12 +-
 src/target/etm.c                    |  258 ++++++++++++++--------------
 src/target/etm_dummy.c              |    6 +-
 src/target/oocd_trace.c             |   30 ++--
 src/target/target.c                 |  318 +++++++++++++++++-----------------
 src/target/target_request.c         |   20 +-
 src/target/trace.c                  |   26 ++--
 src/target/xscale.c                 |  170 ++++++++++----------
 src/xsvf/xsvf.c                     |   32 ++--
 71 files changed, 1459 insertions(+), 1428 deletions(-)


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001809.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-446-gf478865
</A></li>
	<LI>Next message: <A HREF="001811.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-456-g0091e59
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1810">[ date ]</a>
              <a href="thread.html#1810">[ thread ]</a>
              <a href="subject.html#1810">[ subject ]</a>
              <a href="author.html#1810">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
