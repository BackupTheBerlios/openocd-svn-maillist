<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-118-g2351641
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-svn/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-118-g2351641&In-Reply-To=%3CE1N7giB-0004Rj-6L%40cxgxhf1.ch3.sourceforge.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001748.html">
   <LINK REL="Next"  HREF="001750.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-118-g2351641</H1>
    <B>Zach Welch</B> 
    <A HREF="mailto:openocd-svn%40lists.berlios.de?Subject=Re%3A%20%5Bopenocd-svn%5D%20Main%20OpenOCD%20repository%20branch%2C%20master%2C%0A%09updated.%20v0.3.0-118-g2351641&In-Reply-To=%3CE1N7giB-0004Rj-6L%40cxgxhf1.ch3.sourceforge.com%3E"
       TITLE="[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-118-g2351641">zwelch at users.sourceforge.net
       </A><BR>
    <I>Tue Nov 10 03:44:01 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001748.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-110-g7269ba5
</A></li>
        <LI>Next message: <A HREF="001750.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-119-gef6387a
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1749">[ date ]</a>
              <a href="thread.html#1749">[ thread ]</a>
              <a href="subject.html#1749">[ subject ]</a>
              <a href="author.html#1749">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;Main OpenOCD repository&quot;.

The branch, master has been updated
       via  2351641b8f4d0f09912ef0c8bf11578b841230e7 (commit)
       via  6cd97f48d032e3ead3ee94c56699e162f7032ddd (commit)
       via  041c319d9dbdc8159cef3257b7f607aaf91b468c (commit)
       via  712d3fc0fb3ed69342a649d8bbb0d6d901a64720 (commit)
       via  4cd02c63e9213b7f33ec4ac33d481fb00e00708f (commit)
       via  770716e9e079f3fb088994e28aa08edfc5afd2fb (commit)
       via  8b5c5c054d7ae08990e817a52bd28a326b27e54a (commit)
       via  5c95741df7a582ef4901bc18f85f7c4f38b252dd (commit)
      from  7269ba5eb6c4c0e3b8dfceba9d5f2c2f4dfc1618 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 2351641b8f4d0f09912ef0c8bf11578b841230e7
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 9 09:20:34 2009 -0800

    {pic32m,stm32}x.c: remove useless declarations
    
    Remove useless forward declarations.
    Moves command registrations to end of files.
    Moves flash structure definitions to end of files.
    
    Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;

diff --git a/src/flash/pic32mx.c b/src/flash/pic32mx.c
index d9966bf..78ed185 100644
--- a/src/flash/pic32mx.c
+++ b/src/flash/pic32mx.c
@@ -57,58 +57,8 @@ struct pic32mx_devs_s {
 	{ 0x00, NULL, 0 }
 };
 
-static int pic32mx_register_commands(struct command_context_s *cmd_ctx);
-static int pic32mx_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int pic32mx_erase(struct flash_bank_s *bank, int first, int last);
-static int pic32mx_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int pic32mx_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
 static int pic32mx_write_row(struct flash_bank_s *bank, uint32_t address, uint32_t srcaddr);
 static int pic32mx_write_word(struct flash_bank_s *bank, uint32_t address, uint32_t word);
-static int pic32mx_probe(struct flash_bank_s *bank);
-static int pic32mx_auto_probe(struct flash_bank_s *bank);
-//static int pic32mx_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int pic32mx_protect_check(struct flash_bank_s *bank);
-static int pic32mx_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-#if 0
-int pic32mx_handle_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-int pic32mx_handle_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-#endif
-static int pic32mx_handle_chip_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int pic32mx_handle_pgm_word_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-//static int pic32mx_chip_erase(struct flash_bank_s *bank);
-
-flash_driver_t pic32mx_flash =
-{
-	.name = &quot;pic32mx&quot;,
-	.register_commands = pic32mx_register_commands,
-	.flash_bank_command = pic32mx_flash_bank_command,
-	.erase = pic32mx_erase,
-	.protect = pic32mx_protect,
-	.write = pic32mx_write,
-	.probe = pic32mx_probe,
-	.auto_probe = pic32mx_auto_probe,
-	.erase_check = default_flash_mem_blank_check,
-	.protect_check = pic32mx_protect_check,
-	.info = pic32mx_info
-};
-
-static int pic32mx_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *pic32mx_cmd = register_command(cmd_ctx, NULL, &quot;pic32mx&quot;, NULL, COMMAND_ANY, &quot;pic32mx flash specific commands&quot;);
-
-#if 0
-	register_command(cmd_ctx, pic32mx_cmd, &quot;lock&quot;, pic32mx_handle_lock_command, COMMAND_EXEC,
-					 &quot;lock device&quot;);
-	register_command(cmd_ctx, pic32mx_cmd, &quot;unlock&quot;, pic32mx_handle_unlock_command, COMMAND_EXEC,
-					 &quot;unlock protected device&quot;);
-#endif
-	register_command(cmd_ctx, pic32mx_cmd, &quot;chip_erase&quot;, pic32mx_handle_chip_erase_command, COMMAND_EXEC,
-					 &quot;erase device&quot;);
-	register_command(cmd_ctx, pic32mx_cmd, &quot;pgm_word&quot;, pic32mx_handle_pgm_word_command, COMMAND_EXEC,
-					 &quot;program a word&quot;);
-	return ERROR_OK;
-}
 
 /* flash bank pic32mx &lt;base&gt; &lt;size&gt; 0 0 &lt;target#&gt;
  */
@@ -932,3 +882,38 @@ static int pic32mx_handle_pgm_word_command(struct command_context_s *cmd_ctx, ch
 
 	return ERROR_OK;
 }
+
+static int pic32mx_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *pic32mx_cmd = register_command(cmd_ctx, NULL, &quot;pic32mx&quot;,
+			NULL, COMMAND_ANY, &quot;pic32mx flash specific commands&quot;);
+#if 0
+	register_command(cmd_ctx, pic32mx_cmd, &quot;lock&quot;,
+			pic32mx_handle_lock_command, COMMAND_EXEC,
+			&quot;lock device&quot;);
+	register_command(cmd_ctx, pic32mx_cmd, &quot;unlock&quot;,
+			pic32mx_handle_unlock_command, COMMAND_EXEC,
+			&quot;unlock protected device&quot;);
+#endif
+	register_command(cmd_ctx, pic32mx_cmd, &quot;chip_erase&quot;,
+			pic32mx_handle_chip_erase_command, COMMAND_EXEC,
+			&quot;erase device&quot;);
+	register_command(cmd_ctx, pic32mx_cmd, &quot;pgm_word&quot;,
+			pic32mx_handle_pgm_word_command, COMMAND_EXEC,
+			&quot;program a word&quot;);
+	return ERROR_OK;
+}
+
+flash_driver_t pic32mx_flash = {
+		.name = &quot;pic32mx&quot;,
+		.register_commands = &amp;pic32mx_register_commands,
+		.flash_bank_command = &amp;pic32mx_flash_bank_command,
+		.erase = &amp;pic32mx_erase,
+		.protect = &amp;pic32mx_protect,
+		.write = &amp;pic32mx_write,
+		.probe = &amp;pic32mx_probe,
+		.auto_probe = &amp;pic32mx_auto_probe,
+		.erase_check = &amp;default_flash_mem_blank_check,
+		.protect_check = &amp;pic32mx_protect_check,
+		.info = &amp;pic32mx_info,
+	};
diff --git a/src/flash/stm32x.c b/src/flash/stm32x.c
index 158f264..2ca5fa9 100644
--- a/src/flash/stm32x.c
+++ b/src/flash/stm32x.c
@@ -29,56 +29,8 @@
 #include &quot;binarybuffer.h&quot;
 
 
-static int stm32x_register_commands(struct command_context_s *cmd_ctx);
-static int stm32x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int stm32x_erase(struct flash_bank_s *bank, int first, int last);
-static int stm32x_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int stm32x_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int stm32x_probe(struct flash_bank_s *bank);
-static int stm32x_auto_probe(struct flash_bank_s *bank);
-//static int stm32x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int stm32x_protect_check(struct flash_bank_s *bank);
-static int stm32x_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-static int stm32x_handle_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int stm32x_handle_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int stm32x_handle_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int stm32x_handle_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int stm32x_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int stm32x_mass_erase(struct flash_bank_s *bank);
 
-flash_driver_t stm32x_flash =
-{
-	.name = &quot;stm32x&quot;,
-	.register_commands = stm32x_register_commands,
-	.flash_bank_command = stm32x_flash_bank_command,
-	.erase = stm32x_erase,
-	.protect = stm32x_protect,
-	.write = stm32x_write,
-	.probe = stm32x_probe,
-	.auto_probe = stm32x_auto_probe,
-	.erase_check = default_flash_mem_blank_check,
-	.protect_check = stm32x_protect_check,
-	.info = stm32x_info
-};
-
-static int stm32x_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *stm32x_cmd = register_command(cmd_ctx, NULL, &quot;stm32x&quot;, NULL, COMMAND_ANY, &quot;stm32x flash specific commands&quot;);
-
-	register_command(cmd_ctx, stm32x_cmd, &quot;lock&quot;, stm32x_handle_lock_command, COMMAND_EXEC,
-					 &quot;lock device&quot;);
-	register_command(cmd_ctx, stm32x_cmd, &quot;unlock&quot;, stm32x_handle_unlock_command, COMMAND_EXEC,
-					 &quot;unlock protected device&quot;);
-	register_command(cmd_ctx, stm32x_cmd, &quot;mass_erase&quot;, stm32x_handle_mass_erase_command, COMMAND_EXEC,
-					 &quot;mass erase device&quot;);
-	register_command(cmd_ctx, stm32x_cmd, &quot;options_read&quot;, stm32x_handle_options_read_command, COMMAND_EXEC,
-					 &quot;read device option bytes&quot;);
-	register_command(cmd_ctx, stm32x_cmd, &quot;options_write&quot;, stm32x_handle_options_write_command, COMMAND_EXEC,
-					 &quot;write device option bytes&quot;);
-	return ERROR_OK;
-}
-
 /* flash bank stm32x &lt;base&gt; &lt;size&gt; 0 0 &lt;target#&gt;
  */
 static int stm32x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
@@ -1228,3 +1180,41 @@ static int stm32x_handle_mass_erase_command(struct command_context_s *cmd_ctx, c
 
 	return ERROR_OK;
 }
+
+static int stm32x_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *stm32x_cmd = register_command(cmd_ctx, NULL, &quot;stm32x&quot;,
+			NULL, COMMAND_ANY, &quot;stm32x flash specific commands&quot;);
+
+	register_command(cmd_ctx, stm32x_cmd, &quot;lock&quot;,
+			stm32x_handle_lock_command, COMMAND_EXEC,
+			&quot;lock device&quot;);
+	register_command(cmd_ctx, stm32x_cmd, &quot;unlock&quot;,
+			stm32x_handle_unlock_command, COMMAND_EXEC,
+			&quot;unlock protected device&quot;);
+	register_command(cmd_ctx, stm32x_cmd, &quot;mass_erase&quot;,
+			stm32x_handle_mass_erase_command, COMMAND_EXEC,
+			&quot;mass erase device&quot;);
+	register_command(cmd_ctx, stm32x_cmd, &quot;options_read&quot;,
+			stm32x_handle_options_read_command, COMMAND_EXEC,
+			&quot;read device option bytes&quot;);
+	register_command(cmd_ctx, stm32x_cmd, &quot;options_write&quot;,
+			stm32x_handle_options_write_command, COMMAND_EXEC,
+			&quot;write device option bytes&quot;);
+
+	return ERROR_OK;
+}
+
+flash_driver_t stm32x_flash = {
+		.name = &quot;stm32x&quot;,
+		.register_commands = &amp;stm32x_register_commands,
+		.flash_bank_command = &amp;stm32x_flash_bank_command,
+		.erase = &amp;stm32x_erase,
+		.protect = &amp;stm32x_protect,
+		.write = &amp;stm32x_write,
+		.probe = &amp;stm32x_probe,
+		.auto_probe = &amp;stm32x_auto_probe,
+		.erase_check = &amp;default_flash_mem_blank_check,
+		.protect_check = &amp;stm32x_protect_check,
+		.info = &amp;stm32x_info,
+	};

commit 6cd97f48d032e3ead3ee94c56699e162f7032ddd
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 9 09:20:34 2009 -0800

    str{7,9}x*.c: remove useless forward declarations
    
    Remove useless forward declarations.
    Moves command registrations to end of files.
    Moves flash structure definitions to end of files.
    
    Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;

diff --git a/src/flash/str7x.c b/src/flash/str7x.c
index 650c0bc..ed107f3 100644
--- a/src/flash/str7x.c
+++ b/src/flash/str7x.c
@@ -45,43 +45,6 @@ str7x_mem_layout_t mem_layout_str7bank1[] = {
 	{0x00002000, 0x02000, 0x20000}
 };
 
-static int str7x_register_commands(struct command_context_s *cmd_ctx);
-static int str7x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int str7x_erase(struct flash_bank_s *bank, int first, int last);
-static int str7x_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int str7x_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int str7x_probe(struct flash_bank_s *bank);
-//static int str7x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str7x_protect_check(struct flash_bank_s *bank);
-static int str7x_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-static int str7x_handle_disable_jtag_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
-flash_driver_t str7x_flash =
-{
-	.name = &quot;str7x&quot;,
-	.register_commands = str7x_register_commands,
-	.flash_bank_command = str7x_flash_bank_command,
-	.erase = str7x_erase,
-	.protect = str7x_protect,
-	.write = str7x_write,
-	.probe = str7x_probe,
-	.auto_probe = str7x_probe,
-	.erase_check = default_flash_blank_check,
-	.protect_check = str7x_protect_check,
-	.info = str7x_info
-};
-
-static int str7x_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *str7x_cmd = register_command(cmd_ctx, NULL, &quot;str7x&quot;, NULL, COMMAND_ANY, NULL);
-
-	register_command(cmd_ctx, str7x_cmd, &quot;disable_jtag&quot;, str7x_handle_disable_jtag_command, COMMAND_EXEC,
-					 &quot;disable jtag access&quot;);
-
-	return ERROR_OK;
-}
-
 static int str7x_get_flash_adr(struct flash_bank_s *bank, uint32_t reg)
 {
 	str7x_flash_bank_t *str7x_info = bank-&gt;driver_priv;
@@ -707,3 +670,29 @@ static int str7x_handle_disable_jtag_command(struct command_context_s *cmd_ctx,
 
 	return ERROR_OK;
 }
+
+static int str7x_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *str7x_cmd = register_command(cmd_ctx, NULL, &quot;str7x&quot;,
+			NULL, COMMAND_ANY, &quot;str7x flash specific commands&quot;);
+
+	register_command(cmd_ctx, str7x_cmd, &quot;disable_jtag&quot;,
+			str7x_handle_disable_jtag_command, COMMAND_EXEC,
+			&quot;disable jtag access&quot;);
+
+	return ERROR_OK;
+}
+
+flash_driver_t str7x_flash = {
+		.name = &quot;str7x&quot;,
+		.register_commands = &amp;str7x_register_commands,
+		.flash_bank_command = &amp;str7x_flash_bank_command,
+		.erase = &amp;str7x_erase,
+		.protect = &amp;str7x_protect,
+		.write = &amp;str7x_write,
+		.probe = &amp;str7x_probe,
+		.auto_probe = &amp;str7x_probe,
+		.erase_check = &amp;default_flash_blank_check,
+		.protect_check = &amp;str7x_protect_check,
+		.info = &amp;str7x_info,
+	};
diff --git a/src/flash/str9x.c b/src/flash/str9x.c
index fe6c086..893baf5 100644
--- a/src/flash/str9x.c
+++ b/src/flash/str9x.c
@@ -33,43 +33,6 @@
 
 static uint32_t bank1start = 0x00080000;
 
-static int str9x_register_commands(struct command_context_s *cmd_ctx);
-static int str9x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int str9x_erase(struct flash_bank_s *bank, int first, int last);
-static int str9x_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int str9x_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int str9x_probe(struct flash_bank_s *bank);
-//static int str9x_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9x_protect_check(struct flash_bank_s *bank);
-static int str9x_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-static int str9x_handle_flash_config_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
-flash_driver_t str9x_flash =
-{
-	.name = &quot;str9x&quot;,
-	.register_commands = str9x_register_commands,
-	.flash_bank_command = str9x_flash_bank_command,
-	.erase = str9x_erase,
-	.protect = str9x_protect,
-	.write = str9x_write,
-	.probe = str9x_probe,
-	.auto_probe = str9x_probe,
-	.erase_check = default_flash_blank_check,
-	.protect_check = str9x_protect_check,
-	.info = str9x_info
-};
-
-static int str9x_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *str9x_cmd = register_command(cmd_ctx, NULL, &quot;str9x&quot;, NULL, COMMAND_ANY, NULL);
-
-	register_command(cmd_ctx, str9x_cmd, &quot;flash_config&quot;, str9x_handle_flash_config_command, COMMAND_EXEC,
-					 &quot;configure str9 flash controller&quot;);
-
-	return ERROR_OK;
-}
-
 static int str9x_build_block_list(struct flash_bank_s *bank)
 {
 	str9x_flash_bank_t *str9x_info = bank-&gt;driver_priv;
@@ -714,3 +677,29 @@ static int str9x_handle_flash_config_command(struct command_context_s *cmd_ctx,
 	target_write_u32(target, FLASH_CR, 0x18);
 	return ERROR_OK;
 }
+
+static int str9x_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *str9x_cmd = register_command(cmd_ctx, NULL, &quot;str9x&quot;,
+			NULL, COMMAND_ANY, &quot;str9x flash commands&quot;);
+
+	register_command(cmd_ctx, str9x_cmd, &quot;flash_config&quot;,
+			str9x_handle_flash_config_command, COMMAND_EXEC,
+			&quot;configure str9 flash controller&quot;);
+
+	return ERROR_OK;
+}
+
+flash_driver_t str9x_flash = {
+		.name = &quot;str9x&quot;,
+		.register_commands = &amp;str9x_register_commands,
+		.flash_bank_command = &amp;str9x_flash_bank_command,
+		.erase = &amp;str9x_erase,
+		.protect = &amp;str9x_protect,
+		.write = &amp;str9x_write,
+		.probe = &amp;str9x_probe,
+		.auto_probe = &amp;str9x_probe,
+		.erase_check = &amp;default_flash_blank_check,
+		.protect_check = &amp;str9x_protect_check,
+		.info = &amp;str9x_info,
+	};
diff --git a/src/flash/str9xpec.c b/src/flash/str9xpec.c
index 711ee7a..73b9a1d 100644
--- a/src/flash/str9xpec.c
+++ b/src/flash/str9xpec.c
@@ -28,77 +28,10 @@
 #include &quot;arm7_9_common.h&quot;
 
 
-static int str9xpec_register_commands(struct command_context_s *cmd_ctx);
-static int str9xpec_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int str9xpec_erase(struct flash_bank_s *bank, int first, int last);
-static int str9xpec_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int str9xpec_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int str9xpec_probe(struct flash_bank_s *bank);
-static int str9xpec_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_protect_check(struct flash_bank_s *bank);
-static int str9xpec_erase_check(struct flash_bank_s *bank);
-static int str9xpec_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
 static int str9xpec_erase_area(struct flash_bank_s *bank, int first, int last);
 static int str9xpec_set_address(struct flash_bank_s *bank, uint8_t sector);
 static int str9xpec_write_options(struct flash_bank_s *bank);
 
-static int str9xpec_handle_flash_options_cmap_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_handle_flash_options_lvdthd_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_handle_flash_options_lvdsel_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_handle_flash_options_lvdwarn_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_handle_flash_options_read_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_handle_flash_options_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_handle_flash_lock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_handle_flash_unlock_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_handle_flash_enable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int str9xpec_handle_flash_disable_turbo_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
-flash_driver_t str9xpec_flash =
-{
-	.name = &quot;str9xpec&quot;,
-	.register_commands = str9xpec_register_commands,
-	.flash_bank_command = str9xpec_flash_bank_command,
-	.erase = str9xpec_erase,
-	.protect = str9xpec_protect,
-	.write = str9xpec_write,
-	.probe = str9xpec_probe,
-	.auto_probe = str9xpec_probe,
-	.erase_check = str9xpec_erase_check,
-	.protect_check = str9xpec_protect_check,
-	.info = str9xpec_info
-};
-
-static int str9xpec_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *str9xpec_cmd = register_command(cmd_ctx, NULL, &quot;str9xpec&quot;, NULL, COMMAND_ANY, &quot;str9xpec flash specific commands&quot;);
-
-	register_command(cmd_ctx, str9xpec_cmd, &quot;enable_turbo&quot;, str9xpec_handle_flash_enable_turbo_command, COMMAND_EXEC,
-					 &quot;enable str9xpec turbo mode&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;disable_turbo&quot;, str9xpec_handle_flash_disable_turbo_command, COMMAND_EXEC,
-					 &quot;disable str9xpec turbo mode&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;options_cmap&quot;, str9xpec_handle_flash_options_cmap_command, COMMAND_EXEC,
-					 &quot;configure str9xpec boot sector&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;options_lvdthd&quot;, str9xpec_handle_flash_options_lvdthd_command, COMMAND_EXEC,
-					 &quot;configure str9xpec lvd threshold&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;options_lvdsel&quot;, str9xpec_handle_flash_options_lvdsel_command, COMMAND_EXEC,
-					 &quot;configure str9xpec lvd selection&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;options_lvdwarn&quot;, str9xpec_handle_flash_options_lvdwarn_command, COMMAND_EXEC,
-					 &quot;configure str9xpec lvd warning&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;options_read&quot;, str9xpec_handle_flash_options_read_command, COMMAND_EXEC,
-					 &quot;read str9xpec options&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;options_write&quot;, str9xpec_handle_flash_options_write_command, COMMAND_EXEC,
-					 &quot;write str9xpec options&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;lock&quot;, str9xpec_handle_flash_lock_command, COMMAND_EXEC,
-					 &quot;lock str9xpec device&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;unlock&quot;, str9xpec_handle_flash_unlock_command, COMMAND_EXEC,
-					 &quot;unlock str9xpec device&quot;);
-	register_command(cmd_ctx, str9xpec_cmd, &quot;part_id&quot;, str9xpec_handle_part_id_command, COMMAND_EXEC,
-					 &quot;print part id of str9xpec flash bank &lt;num&gt;&quot;);
-
-	return ERROR_OK;
-}
-
 int str9xpec_set_instr(jtag_tap_t *tap, uint32_t new_instr, tap_state_t end_state)
 {
 	if (tap == NULL) {
@@ -1229,3 +1162,59 @@ static int str9xpec_handle_flash_disable_turbo_command(struct command_context_s
 
 	return ERROR_OK;
 }
+
+static int str9xpec_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *str9xpec_cmd = register_command(cmd_ctx, NULL, &quot;str9xpec&quot;,
+			NULL, COMMAND_ANY, &quot;str9xpec flash specific commands&quot;);
+
+	register_command(cmd_ctx, str9xpec_cmd, &quot;enable_turbo&quot;,
+			str9xpec_handle_flash_enable_turbo_command,
+			COMMAND_EXEC, &quot;enable str9xpec turbo mode&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;disable_turbo&quot;,
+			str9xpec_handle_flash_disable_turbo_command,
+			COMMAND_EXEC, &quot;disable str9xpec turbo mode&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;options_cmap&quot;,
+			str9xpec_handle_flash_options_cmap_command,
+			COMMAND_EXEC, &quot;configure str9xpec boot sector&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;options_lvdthd&quot;,
+			str9xpec_handle_flash_options_lvdthd_command,
+			COMMAND_EXEC, &quot;configure str9xpec lvd threshold&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;options_lvdsel&quot;,
+			str9xpec_handle_flash_options_lvdsel_command,
+			COMMAND_EXEC, &quot;configure str9xpec lvd selection&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;options_lvdwarn&quot;,
+			str9xpec_handle_flash_options_lvdwarn_command,
+			COMMAND_EXEC, &quot;configure str9xpec lvd warning&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;options_read&quot;,
+			str9xpec_handle_flash_options_read_command,
+			COMMAND_EXEC, &quot;read str9xpec options&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;options_write&quot;,
+			str9xpec_handle_flash_options_write_command,
+			COMMAND_EXEC, &quot;write str9xpec options&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;lock&quot;,
+			str9xpec_handle_flash_lock_command,
+			COMMAND_EXEC, &quot;lock str9xpec device&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;unlock&quot;,
+			str9xpec_handle_flash_unlock_command,
+			COMMAND_EXEC, &quot;unlock str9xpec device&quot;);
+	register_command(cmd_ctx, str9xpec_cmd, &quot;part_id&quot;,
+			str9xpec_handle_part_id_command,
+			COMMAND_EXEC, &quot;print part id of str9xpec flash bank &lt;num&gt;&quot;);
+
+	return ERROR_OK;
+}
+
+flash_driver_t str9xpec_flash = {
+		.name = &quot;str9xpec&quot;,
+		.register_commands = &amp;str9xpec_register_commands,
+		.flash_bank_command = &amp;str9xpec_flash_bank_command,
+		.erase = &amp;str9xpec_erase,
+		.protect = &amp;str9xpec_protect,
+		.write = &amp;str9xpec_write,
+		.probe = &amp;str9xpec_probe,
+		.auto_probe = &amp;str9xpec_probe,
+		.erase_check = &amp;str9xpec_erase_check,
+		.protect_check = &amp;str9xpec_protect_check,
+		.info = &amp;str9xpec_info,
+	};

commit 041c319d9dbdc8159cef3257b7f607aaf91b468c
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 9 09:20:33 2009 -0800

    flash/&lt;various&gt;.c: remove useless declarations
    
    Remove useless forward declarations.
    Moves flash structure definitions to end of files.
    
    Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;

diff --git a/src/flash/cfi.c b/src/flash/cfi.c
index 93e661c..b448a30 100644
--- a/src/flash/cfi.c
+++ b/src/flash/cfi.c
@@ -29,39 +29,12 @@
 #include &quot;binarybuffer.h&quot;
 
 
-static int cfi_register_commands(struct command_context_s *cmd_ctx);
-static int cfi_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int cfi_erase(struct flash_bank_s *bank, int first, int last);
-static int cfi_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int cfi_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int cfi_probe(struct flash_bank_s *bank);
-static int cfi_auto_probe(struct flash_bank_s *bank);
-static int cfi_protect_check(struct flash_bank_s *bank);
-static int cfi_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-//static int cfi_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
 #define CFI_MAX_BUS_WIDTH	4
 #define CFI_MAX_CHIP_WIDTH	4
 
 /* defines internal maximum size for code fragment in cfi_intel_write_block() */
 #define CFI_MAX_INTEL_CODESIZE 256
 
-flash_driver_t cfi_flash =
-{
-	.name = &quot;cfi&quot;,
-	.register_commands = cfi_register_commands,
-	.flash_bank_command = cfi_flash_bank_command,
-	.erase = cfi_erase,
-	.protect = cfi_protect,
-	.write = cfi_write,
-	.probe = cfi_probe,
-	.auto_probe = cfi_auto_probe,
-	.erase_check = default_flash_blank_check,
-	.protect_check = cfi_protect_check,
-	.info = cfi_info
-};
-
 static cfi_unlock_addresses_t cfi_unlock_addresses[] =
 {
 	[CFI_UNLOCK_555_2AA] = { .unlock1 = 0x555, .unlock2 = 0x2aa },
@@ -2655,3 +2628,17 @@ static int cfi_info(struct flash_bank_s *bank, char *buf, int buf_size)
 
 	return ERROR_OK;
 }
+
+flash_driver_t cfi_flash = {
+		.name = &quot;cfi&quot;,
+		.register_commands = &amp;cfi_register_commands,
+		.flash_bank_command = &amp;cfi_flash_bank_command,
+		.erase = &amp;cfi_erase,
+		.protect = &amp;cfi_protect,
+		.write = &amp;cfi_write,
+		.probe = &amp;cfi_probe,
+		.auto_probe = &amp;cfi_auto_probe,
+		.erase_check = &amp;default_flash_blank_check,
+		.protect_check = &amp;cfi_protect_check,
+		.info = &amp;cfi_info,
+	};
diff --git a/src/flash/ecos.c b/src/flash/ecos.c
index 8583544..401fdf2 100644
--- a/src/flash/ecos.c
+++ b/src/flash/ecos.c
@@ -26,15 +26,6 @@
 #include &quot;image.h&quot;
 
 
-static int ecosflash_register_commands(struct command_context_s *cmd_ctx);
-static int ecosflash_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int ecosflash_erase(struct flash_bank_s *bank, int first, int last);
-static int ecosflash_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int ecosflash_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int ecosflash_probe(struct flash_bank_s *bank);
-static int ecosflash_protect_check(struct flash_bank_s *bank);
-static int ecosflash_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
 #if 0
 static uint32_t ecosflash_get_flash_status(flash_bank_t *bank);
 static void ecosflash_set_flash_mode(flash_bank_t *bank,int mode);
@@ -42,21 +33,6 @@ static uint32_t ecosflash_wait_status_busy(flash_bank_t *bank, uint32_t waitbits
 static int ecosflash_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 #endif
 
-flash_driver_t ecosflash_flash =
-{
-	.name = &quot;ecosflash&quot;,
-	.register_commands = ecosflash_register_commands,
-	.flash_bank_command = ecosflash_flash_bank_command,
-	.erase = ecosflash_erase,
-	.protect = ecosflash_protect,
-	.write = ecosflash_write,
-	.probe = ecosflash_probe,
-	.auto_probe = ecosflash_probe,
-	.erase_check = default_flash_blank_check,
-	.protect_check = ecosflash_protect_check,
-	.info = ecosflash_info
-};
-
 typedef struct ecosflash_flash_bank_s
 {
 	struct target_s *target;
@@ -458,3 +434,17 @@ static int ecosflash_handle_gpnvm_command(struct command_context_s *cmd_ctx, cha
 	return ERROR_OK;
 }
 #endif
+
+flash_driver_t ecosflash_flash = {
+		.name = &quot;ecosflash&quot;,
+		.register_commands = &amp;ecosflash_register_commands,
+		.flash_bank_command = &amp;ecosflash_flash_bank_command,
+		.erase = &amp;ecosflash_erase,
+		.protect = &amp;ecosflash_protect,
+		.write = &amp;ecosflash_write,
+		.probe = &amp;ecosflash_probe,
+		.auto_probe = &amp;ecosflash_probe,
+		.erase_check = &amp;default_flash_blank_check,
+		.protect_check = &amp;ecosflash_protect_check,
+		.info = &amp;ecosflash_info
+	};
diff --git a/src/flash/faux.c b/src/flash/faux.c
index c5928ad..474dee5 100644
--- a/src/flash/faux.c
+++ b/src/flash/faux.c
@@ -25,30 +25,6 @@
 #include &quot;image.h&quot;
 
 
-static int faux_register_commands(struct command_context_s *cmd_ctx);
-static int faux_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int faux_erase(struct flash_bank_s *bank, int first, int last);
-static int faux_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int faux_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int faux_probe(struct flash_bank_s *bank);
-static int faux_protect_check(struct flash_bank_s *bank);
-static int faux_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-flash_driver_t faux_flash =
-{
-	.name = &quot;faux&quot;,
-	.register_commands = faux_register_commands,
-	.flash_bank_command = faux_flash_bank_command,
-	.erase = faux_erase,
-	.protect = faux_protect,
-	.write = faux_write,
-	.probe = faux_probe,
-	.auto_probe = faux_probe,
-	.erase_check = default_flash_blank_check,
-	.protect_check = faux_protect_check,
-	.info = faux_info
-};
-
 typedef struct faux_flash_bank_s
 {
 	struct target_s *target;
@@ -151,3 +127,17 @@ static int faux_probe(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
 }
+
+flash_driver_t faux_flash = {
+		.name = &quot;faux&quot;,
+		.register_commands = &amp;faux_register_commands,
+		.flash_bank_command = &amp;faux_flash_bank_command,
+		.erase = &amp;faux_erase,
+		.protect = &amp;faux_protect,
+		.write = &amp;faux_write,
+		.probe = &amp;faux_probe,
+		.auto_probe = &amp;faux_probe,
+		.erase_check = &amp;default_flash_blank_check,
+		.protect_check = &amp;faux_protect_check,
+		.info = &amp;faux_info
+	};

commit 712d3fc0fb3ed69342a649d8bbb0d6d901a64720
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 9 09:20:33 2009 -0800

    flash/&lt;assorted&gt;.c: remove useless declarations
    
    Remove useless forward declarations.
    Moves command registrations to end of files.
    Moves flash structure definitions to end of files.
    
    Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;

diff --git a/src/flash/aduc702x.c b/src/flash/aduc702x.c
index a4007d0..7d6fa24 100644
--- a/src/flash/aduc702x.c
+++ b/src/flash/aduc702x.c
@@ -29,16 +29,6 @@
 #include &quot;time_support.h&quot;
 
 
-static int aduc702x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int aduc702x_register_commands(struct command_context_s *cmd_ctx);
-static int aduc702x_erase(struct flash_bank_s *bank, int first, int last);
-static int aduc702x_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int aduc702x_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int aduc702x_write_single(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int aduc702x_write_block(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int aduc702x_probe(struct flash_bank_s *bank);
-static int aduc702x_info(struct flash_bank_s *bank, char *buf, int buf_size);
-static int aduc702x_protect_check(struct flash_bank_s *bank);
 static int aduc702x_build_sector_list(struct flash_bank_s *bank);
 static int aduc702x_check_flash_completion(target_t* target, unsigned int timeout_ms);
 static int aduc702x_set_write_enable(target_t *target, int enable);
@@ -69,26 +59,6 @@ typedef struct
 	working_area_t *write_algorithm;
 } aduc702x_flash_bank_t;
 
-flash_driver_t aduc702x_flash =
-{
-	.name = &quot;aduc702x&quot;,
-	.register_commands = aduc702x_register_commands,
-	.flash_bank_command = aduc702x_flash_bank_command,
-	.erase = aduc702x_erase,
-	.protect = aduc702x_protect,
-	.write = aduc702x_write,
-	.probe = aduc702x_probe,
-	.auto_probe = aduc702x_probe,
-	.erase_check = default_flash_blank_check,
-	.protect_check = aduc702x_protect_check,
-	.info = aduc702x_info
-};
-
-static int aduc702x_register_commands(struct command_context_s *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 /* flash bank aduc702x 0 0 0 0 &lt;target#&gt;
  * The ADC7019-28 devices all have the same flash layout */
 static int aduc702x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
@@ -452,3 +422,15 @@ static int aduc702x_check_flash_completion(target_t* target, unsigned int timeou
         else return ERROR_OK;
 }
 
+flash_driver_t aduc702x_flash = {
+		.name = &quot;aduc702x&quot;,
+		.flash_bank_command = &amp;aduc702x_flash_bank_command,
+		.erase = &amp;aduc702x_erase,
+		.protect = &amp;aduc702x_protect,
+		.write = &amp;aduc702x_write,
+		.probe = &amp;aduc702x_probe,
+		.auto_probe = &amp;aduc702x_probe,
+		.erase_check = &amp;default_flash_blank_check,
+		.protect_check = &amp;aduc702x_protect_check,
+		.info = &amp;aduc702x_info
+	};
diff --git a/src/flash/avrf.c b/src/flash/avrf.c
index 2b95b8a..b045909 100644
--- a/src/flash/avrf.c
+++ b/src/flash/avrf.c
@@ -56,46 +56,18 @@ avrf_type_t avft_chips_info[] =
 	{&quot;atmega128&quot;,	0x9702,		256,				512,			8,					512},
 };
 
-static int avrf_register_commands(struct command_context_s *cmd_ctx);
-static int avrf_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int avrf_erase(struct flash_bank_s *bank, int first, int last);
-static int avrf_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int avrf_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int avrf_probe(struct flash_bank_s *bank);
-static int avrf_auto_probe(struct flash_bank_s *bank);
-//static int avrf_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int avrf_protect_check(struct flash_bank_s *bank);
-static int avrf_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-static int avrf_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
-extern int avr_jtag_sendinstr(jtag_tap_t *tap, uint8_t *ir_in, uint8_t ir_out);
-extern int avr_jtag_senddat(jtag_tap_t *tap, uint32_t *dr_in, uint32_t dr_out, int len);
-
-extern int mcu_write_ir(jtag_tap_t *tap, uint8_t *ir_in, uint8_t *ir_out, int ir_len, int rti);
-extern int mcu_write_dr(jtag_tap_t *tap, uint8_t *ir_in, uint8_t *ir_out, int dr_len, int rti);
-extern int mcu_write_ir_u8(jtag_tap_t *tap, uint8_t *ir_in, uint8_t ir_out, int ir_len, int rti);
-extern int mcu_write_dr_u8(jtag_tap_t *tap, uint8_t *ir_in, uint8_t ir_out, int dr_len, int rti);
-extern int mcu_write_ir_u16(jtag_tap_t *tap, uint16_t *ir_in, uint16_t ir_out, int ir_len, int rti);
-extern int mcu_write_dr_u16(jtag_tap_t *tap, uint16_t *ir_in, uint16_t ir_out, int dr_len, int rti);
-extern int mcu_write_ir_u32(jtag_tap_t *tap, uint32_t *ir_in, uint32_t ir_out, int ir_len, int rti);
-extern int mcu_write_dr_u32(jtag_tap_t *tap, uint32_t *ir_in, uint32_t ir_out, int dr_len, int rti);
-extern int mcu_execute_queue(void);
-
-flash_driver_t avr_flash =
-{
-	.name = &quot;avr&quot;,
-	.register_commands = avrf_register_commands,
-	.flash_bank_command = avrf_flash_bank_command,
-	.erase = avrf_erase,
-	.protect = avrf_protect,
-	.write = avrf_write,
-	.probe = avrf_probe,
-	.auto_probe = avrf_auto_probe,
-	.erase_check = default_flash_mem_blank_check,
-	.protect_check = avrf_protect_check,
-	.info = avrf_info
-};
+int avr_jtag_sendinstr(jtag_tap_t *tap, uint8_t *ir_in, uint8_t ir_out);
+int avr_jtag_senddat(jtag_tap_t *tap, uint32_t *dr_in, uint32_t dr_out, int len);
+
+int mcu_write_ir(jtag_tap_t *tap, uint8_t *ir_in, uint8_t *ir_out, int ir_len, int rti);
+int mcu_write_dr(jtag_tap_t *tap, uint8_t *ir_in, uint8_t *ir_out, int dr_len, int rti);
+int mcu_write_ir_u8(jtag_tap_t *tap, uint8_t *ir_in, uint8_t ir_out, int ir_len, int rti);
+int mcu_write_dr_u8(jtag_tap_t *tap, uint8_t *ir_in, uint8_t ir_out, int dr_len, int rti);
+int mcu_write_ir_u16(jtag_tap_t *tap, uint16_t *ir_in, uint16_t ir_out, int ir_len, int rti);
+int mcu_write_dr_u16(jtag_tap_t *tap, uint16_t *ir_in, uint16_t ir_out, int dr_len, int rti);
+int mcu_write_ir_u32(jtag_tap_t *tap, uint32_t *ir_in, uint32_t ir_out, int ir_len, int rti);
+int mcu_write_dr_u32(jtag_tap_t *tap, uint32_t *ir_in, uint32_t ir_out, int dr_len, int rti);
+int mcu_execute_queue(void);
 
 /* avr program functions */
 static int avr_jtag_reset(avr_common_t *avr, uint32_t reset)
@@ -208,17 +180,6 @@ static int avr_jtagprg_writeflashpage(avr_common_t *avr, uint8_t *page_buf, uint
 	return ERROR_OK;
 }
 
-/* interface command */
-static int avrf_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *avr_cmd = register_command(cmd_ctx, NULL, &quot;avr&quot;, NULL, COMMAND_ANY, &quot;avr flash specific commands&quot;);
-
-	register_command(cmd_ctx, avr_cmd, &quot;mass_erase&quot;, avrf_handle_mass_erase_command, COMMAND_EXEC,
-					 &quot;mass erase device&quot;);
-
-	return ERROR_OK;
-}
-
 static int avrf_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank)
 {
 	avrf_flash_bank_t *avrf_info;
@@ -487,3 +448,29 @@ static int avrf_handle_mass_erase_command(struct command_context_s *cmd_ctx, cha
 	LOG_DEBUG(&quot;%s&quot;, __FUNCTION__);
 	return ERROR_OK;
 }
+
+static int avrf_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *avr_cmd = register_command(cmd_ctx, NULL, &quot;avr&quot;,
+			NULL, COMMAND_ANY, &quot;avr flash specific commands&quot;);
+
+	register_command(cmd_ctx, avr_cmd, &quot;mass_erase&quot;,
+			avrf_handle_mass_erase_command, COMMAND_EXEC,
+			&quot;mass erase device&quot;);
+
+	return ERROR_OK;
+}
+
+flash_driver_t avr_flash = {
+		.name = &quot;avr&quot;,
+		.register_commands = &amp;avrf_register_commands,
+		.flash_bank_command = &amp;avrf_flash_bank_command,
+		.erase = &amp;avrf_erase,
+		.protect = &amp;avrf_protect,
+		.write = &amp;avrf_write,
+		.probe = &amp;avrf_probe,
+		.auto_probe = &amp;avrf_auto_probe,
+		.erase_check = &amp;default_flash_mem_blank_check,
+		.protect_check = &amp;avrf_protect_check,
+		.info = &amp;avrf_info,
+	};
diff --git a/src/flash/ocl.c b/src/flash/ocl.c
index a2dac50..51ccc96 100644
--- a/src/flash/ocl.c
+++ b/src/flash/ocl.c
@@ -26,32 +26,6 @@
 #include &quot;embeddedice.h&quot;
 
 
-static int ocl_register_commands(struct command_context_s *cmd_ctx);
-static int ocl_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int ocl_erase(struct flash_bank_s *bank, int first, int last);
-static int ocl_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int ocl_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int ocl_probe(struct flash_bank_s *bank);
-static int ocl_erase_check(struct flash_bank_s *bank);
-static int ocl_protect_check(struct flash_bank_s *bank);
-static int ocl_info(struct flash_bank_s *bank, char *buf, int buf_size);
-static int ocl_auto_probe(struct flash_bank_s *bank);
-
-flash_driver_t ocl_flash =
-{
-	.name = &quot;ocl&quot;,
-	.register_commands = ocl_register_commands,
-	.flash_bank_command = ocl_flash_bank_command,
-	.erase = ocl_erase,
-	.protect = ocl_protect,
-	.write = ocl_write,
-	.probe = ocl_probe,
-	.erase_check = ocl_erase_check,
-	.protect_check = ocl_protect_check,
-	.info = ocl_info,
-	.auto_probe = ocl_auto_probe
-};
-
 typedef struct ocl_priv_s
 {
 	arm_jtag_t *jtag_info;
@@ -59,11 +33,6 @@ typedef struct ocl_priv_s
 	unsigned int bufalign;
 } ocl_priv_t;
 
-static int ocl_register_commands(struct command_context_s *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 static int ocl_erase_check(struct flash_bank_s *bank)
 {
 	return ERROR_OK;
@@ -378,3 +347,16 @@ static int ocl_auto_probe(struct flash_bank_s *bank)
 
 	return ERROR_OK;
 }
+
+flash_driver_t ocl_flash = {
+		.name = &quot;ocl&quot;,
+		.flash_bank_command = &amp;ocl_flash_bank_command,
+		.erase = &amp;ocl_erase,
+		.protect = &amp;ocl_protect,
+		.write = &amp;ocl_write,
+		.probe = &amp;ocl_probe,
+		.erase_check = &amp;ocl_erase_check,
+		.protect_check = &amp;ocl_protect_check,
+		.info = &amp;ocl_info,
+		.auto_probe = &amp;ocl_auto_probe,
+	};
diff --git a/src/flash/stellaris.c b/src/flash/stellaris.c
index b482ce2..bd561a6 100644
--- a/src/flash/stellaris.c
+++ b/src/flash/stellaris.c
@@ -34,39 +34,14 @@
 
 
 #define DID0_VER(did0) ((did0 &gt;&gt; 28)&amp;0x07)
-static int stellaris_register_commands(struct command_context_s *cmd_ctx);
-static int stellaris_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int stellaris_erase(struct flash_bank_s *bank, int first, int last);
-static int stellaris_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int stellaris_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int stellaris_auto_probe(struct flash_bank_s *bank);
-static int stellaris_probe(struct flash_bank_s *bank);
-static int stellaris_protect_check(struct flash_bank_s *bank);
-static int stellaris_info(struct flash_bank_s *bank, char *buf, int buf_size);
 
 static int stellaris_read_part_info(struct flash_bank_s *bank);
 static uint32_t stellaris_get_flash_status(flash_bank_t *bank);
 static void stellaris_set_flash_mode(flash_bank_t *bank,int mode);
 //static uint32_t stellaris_wait_status_busy(flash_bank_t *bank, uint32_t waitbits, int timeout);
 
-static int stellaris_handle_mass_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int stellaris_mass_erase(struct flash_bank_s *bank);
 
-flash_driver_t stellaris_flash =
-{
-	.name = &quot;stellaris&quot;,
-	.register_commands = stellaris_register_commands,
-	.flash_bank_command = stellaris_flash_bank_command,
-	.erase = stellaris_erase,
-	.protect = stellaris_protect,
-	.write = stellaris_write,
-	.probe = stellaris_probe,
-	.auto_probe = stellaris_auto_probe,
-	.erase_check = default_flash_mem_blank_check,
-	.protect_check = stellaris_protect_check,
-	.info = stellaris_info
-};
-
 static struct {
 	uint32_t partno;
 	char *partname;
@@ -264,14 +239,6 @@ static int stellaris_flash_bank_command(struct command_context_s *cmd_ctx, char
 	return ERROR_OK;
 }
 
-static int stellaris_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *stm32x_cmd = register_command(cmd_ctx, NULL, &quot;stellaris&quot;, NULL, COMMAND_ANY, &quot;stellaris flash specific commands&quot;);
-
-	register_command(cmd_ctx, stm32x_cmd, &quot;mass_erase&quot;, stellaris_handle_mass_erase_command, COMMAND_EXEC, &quot;mass erase device&quot;);
-	return ERROR_OK;
-}
-
 static int stellaris_info(struct flash_bank_s *bank, char *buf, int buf_size)
 {
 	int printed, device_class;
@@ -1192,3 +1159,29 @@ static int stellaris_handle_mass_erase_command(struct command_context_s *cmd_ctx
 
 	return ERROR_OK;
 }
+
+static int stellaris_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *stm32x_cmd = register_command(cmd_ctx, NULL, &quot;stellaris&quot;,
+			NULL, COMMAND_ANY, &quot;stellaris flash specific commands&quot;);
+
+	register_command(cmd_ctx, stm32x_cmd, &quot;mass_erase&quot;,
+			stellaris_handle_mass_erase_command, COMMAND_EXEC,
+			&quot;mass erase device&quot;);
+	return ERROR_OK;
+}
+
+
+flash_driver_t stellaris_flash = {
+		.name = &quot;stellaris&quot;,
+		.register_commands = &amp;stellaris_register_commands,
+		.flash_bank_command = &amp;stellaris_flash_bank_command,
+		.erase = &amp;stellaris_erase,
+		.protect = &amp;stellaris_protect,
+		.write = &amp;stellaris_write,
+		.probe = &amp;stellaris_probe,
+		.auto_probe = &amp;stellaris_auto_probe,
+		.erase_check = &amp;default_flash_mem_blank_check,
+		.protect_check = &amp;stellaris_protect_check,
+		.info = &amp;stellaris_info,
+	};
diff --git a/src/flash/tms470.c b/src/flash/tms470.c
index 58210ac..1348697 100644
--- a/src/flash/tms470.c
+++ b/src/flash/tms470.c
@@ -24,31 +24,6 @@
 #include &quot;tms470.h&quot;
 
 
-static int tms470_register_commands(struct command_context_s *cmd_ctx);
-static int tms470_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int tms470_erase(struct flash_bank_s *bank, int first, int last);
-static int tms470_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int tms470_write(struct flash_bank_s *bank, uint8_t * buffer, uint32_t offset, uint32_t count);
-static int tms470_probe(struct flash_bank_s *bank);
-static int tms470_auto_probe(struct flash_bank_s *bank);
-static int tms470_erase_check(struct flash_bank_s *bank);
-static int tms470_protect_check(struct flash_bank_s *bank);
-static int tms470_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-flash_driver_t tms470_flash = {
-	.name = &quot;tms470&quot;,
-	.register_commands = tms470_register_commands,
-	.flash_bank_command = tms470_flash_bank_command,
-	.erase = tms470_erase,
-	.protect = tms470_protect,
-	.write = tms470_write,
-	.probe = tms470_probe,
-	.auto_probe = tms470_auto_probe,
-	.erase_check = tms470_erase_check,
-	.protect_check = tms470_protect_check,
-	.info = tms470_info
-};
-
 /* ----------------------------------------------------------------------
                       Internal Support, Helpers
    ---------------------------------------------------------------------- */
@@ -1260,3 +1235,17 @@ static int tms470_flash_bank_command(struct command_context_s *cmd_ctx, char *cm
 
 	return ERROR_OK;
 }
+
+flash_driver_t tms470_flash = {
+		.name = &quot;tms470&quot;,
+		.register_commands = &amp;tms470_register_commands,
+		.flash_bank_command = &amp;tms470_flash_bank_command,
+		.erase = &amp;tms470_erase,
+		.protect = &amp;tms470_protect,
+		.write = &amp;tms470_write,
+		.probe = &amp;tms470_probe,
+		.auto_probe = &amp;tms470_auto_probe,
+		.erase_check = &amp;tms470_erase_check,
+		.protect_check = &amp;tms470_protect_check,
+		.info = &amp;tms470_info,
+	};

commit 4cd02c63e9213b7f33ec4ac33d481fb00e00708f
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 9 09:20:33 2009 -0800

    flash/at91sam[37].c: remove useless declarations
    
    Remove useless forward declarations.
    Moves command registration to end of file.
    Moves flash structure definitions to end of files.
    
    Changes a few references to global flash structure to local refs.
    
    Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;

diff --git a/src/flash/at91sam3.c b/src/flash/at91sam3.c
index aff4d98..7d3d82c 100644
--- a/src/flash/at91sam3.c
+++ b/src/flash/at91sam3.c
@@ -2508,19 +2508,16 @@ sam3_register_commands(struct command_context_s *cmd_ctx)
 	return ERROR_OK;
 }
 
-
-flash_driver_t at91sam3_flash =
-{
-	.name						= &quot;at91sam3&quot;,
-	.register_commands			= sam3_register_commands,
-
-	.flash_bank_command			= sam3_flash_bank_command,
-	.erase						= sam3_erase,
-	.protect					= sam3_protect,
-	.write						= sam3_write,
-	.probe						= sam3_probe,
-	.auto_probe					= sam3_auto_probe,
-	.erase_check				= sam3_erase_check,
-	.protect_check				= sam3_protect_check,
-	.info						= sam3_info
-};
+flash_driver_t at91sam3_flash = {
+		.name = &quot;at91sam3&quot;,
+		.register_commands = &amp;sam3_register_commands,
+		.flash_bank_command = &amp;sam3_flash_bank_command,
+		.erase = &amp;sam3_erase,
+		.protect = &amp;sam3_protect,
+		.write = &amp;sam3_write,
+		.probe = &amp;sam3_probe,
+		.auto_probe = &amp;sam3_auto_probe,
+		.erase_check = &amp;sam3_erase_check,
+		.protect_check = &amp;sam3_protect_check,
+		.info = &amp;sam3_info,
+	};
diff --git a/src/flash/at91sam7.c b/src/flash/at91sam7.c
index 7d93c9e..134c9e5 100644
--- a/src/flash/at91sam7.c
+++ b/src/flash/at91sam7.c
@@ -52,38 +52,13 @@
 #include &quot;at91sam7.h&quot;
 #include &quot;binarybuffer.h&quot;
 
-
-static int at91sam7_register_commands(struct command_context_s *cmd_ctx);
-static int at91sam7_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int at91sam7_erase(struct flash_bank_s *bank, int first, int last);
-static int at91sam7_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int at91sam7_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int at91sam7_probe(struct flash_bank_s *bank);
-//static int at91sam7_auto_probe(struct flash_bank_s *bank);
-static int at91sam7_erase_check(struct flash_bank_s *bank);
 static int at91sam7_protect_check(struct flash_bank_s *bank);
-static int at91sam7_info(struct flash_bank_s *bank, char *buf, int buf_size);
+static int at91sam7_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
 
 static uint32_t at91sam7_get_flash_status(target_t *target, int bank_number);
 static void at91sam7_set_flash_mode(flash_bank_t *bank, int mode);
 static uint32_t at91sam7_wait_status_busy(flash_bank_t *bank, uint32_t waitbits, int timeout);
 static int at91sam7_flash_command(struct flash_bank_s *bank, uint8_t cmd, uint16_t pagen);
-static int at91sam7_handle_gpnvm_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
-flash_driver_t at91sam7_flash =
-{
-	.name = &quot;at91sam7&quot;,
-	.register_commands = at91sam7_register_commands,
-	.flash_bank_command = at91sam7_flash_bank_command,
-	.erase = at91sam7_erase,
-	.protect = at91sam7_protect,
-	.write = at91sam7_write,
-	.probe = at91sam7_probe,
-	.auto_probe = at91sam7_probe,
-	.erase_check = at91sam7_erase_check,
-	.protect_check = at91sam7_protect_check,
-	.info = at91sam7_info
-};
 
 static uint32_t MC_FMR[4] = { 0xFFFFFF60, 0xFFFFFF70, 0xFFFFFF80, 0xFFFFFF90 };
 static uint32_t MC_FCR[4] = { 0xFFFFFF64, 0xFFFFFF74, 0xFFFFFF84, 0xFFFFFF94 };
@@ -112,14 +87,6 @@ static long SRAMSIZ[16] = {
 };
 #endif
 
-static int at91sam7_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *at91sam7_cmd = register_command(cmd_ctx, NULL, &quot;at91sam7&quot;, NULL, COMMAND_ANY, NULL);
-
-	register_command(cmd_ctx, at91sam7_cmd, &quot;gpnvm&quot;, at91sam7_handle_gpnvm_command, COMMAND_EXEC,
-					&quot;at91sam7 gpnvm &lt;bit&gt; set | clear, set or clear one gpnvm bit&quot;);
-	return ERROR_OK;
-}
 
 static uint32_t at91sam7_get_flash_status(target_t *target, int bank_number)
 {
@@ -567,7 +534,7 @@ static int at91sam7_read_part_info(struct flash_bank_s *bank)
 			/* create a new flash bank element */
 			flash_bank_t *fb = malloc(sizeof(flash_bank_t));
 			fb-&gt;target = target;
-			fb-&gt;driver = &amp;at91sam7_flash;
+			fb-&gt;driver = bank-&gt;driver;
 			fb-&gt;driver_priv = malloc(sizeof(at91sam7_flash_bank_t));
 			fb-&gt;next = NULL;
 
@@ -820,7 +787,7 @@ static int at91sam7_flash_bank_command(struct command_context_s *cmd_ctx, char *
 			/* create a new bank element */
 			flash_bank_t *fb = malloc(sizeof(flash_bank_t));
 			fb-&gt;target = target;
-			fb-&gt;driver = &amp;at91sam7_flash;
+			fb-&gt;driver = bank-&gt;driver;
 			fb-&gt;driver_priv = malloc(sizeof(at91sam7_flash_bank_t));
 			fb-&gt;next = NULL;
 
@@ -1151,7 +1118,7 @@ static int at91sam7_handle_gpnvm_command(struct command_context_s *cmd_ctx, char
 	{
 		return ERROR_FLASH_BANK_INVALID;
 	}
-	if (bank-&gt;driver != &amp;at91sam7_flash)
+	if (strcmp(bank-&gt;driver-&gt;name, &quot;at91sam7&quot;))
 	{
 		command_print(cmd_ctx, &quot;not an at91sam7 flash bank '%s'&quot;, args[0]);
 		return ERROR_FLASH_BANK_INVALID;
@@ -1210,3 +1177,30 @@ static int at91sam7_handle_gpnvm_command(struct command_context_s *cmd_ctx, char
 
 	return ERROR_OK;
 }
+
+static int at91sam7_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *at91sam7_cmd = register_command(cmd_ctx, NULL, &quot;at91sam7&quot;,
+			NULL, COMMAND_ANY, NULL);
+
+	register_command(cmd_ctx, at91sam7_cmd, &quot;gpnvm&quot;,
+			at91sam7_handle_gpnvm_command, COMMAND_EXEC,
+			&quot;at91sam7 gpnvm &lt;bit&gt; set | clear, &quot;
+			&quot;set or clear one gpnvm bit&quot;);
+
+	return ERROR_OK;
+}
+
+flash_driver_t at91sam7_flash = {
+		.name = &quot;at91sam7&quot;,
+		.register_commands = &amp;at91sam7_register_commands,
+		.flash_bank_command = &amp;at91sam7_flash_bank_command,
+		.erase = &amp;at91sam7_erase,
+		.protect = &amp;at91sam7_protect,
+		.write = &amp;at91sam7_write,
+		.probe = &amp;at91sam7_probe,
+		.auto_probe = &amp;at91sam7_probe,
+		.erase_check = &amp;at91sam7_erase_check,
+		.protect_check = &amp;at91sam7_protect_check,
+		.info = &amp;at91sam7_info,
+	};

commit 770716e9e079f3fb088994e28aa08edfc5afd2fb
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 9 09:20:33 2009 -0800

    flash/lpc2???.c: remove useless declarations
    
    Remove useless forward declarations.
    Moves command registrations to end of files.
    Moves flash structure definitions to end of files.
    
    Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;

diff --git a/src/flash/lpc2000.c b/src/flash/lpc2000.c
index ed9c7c3..e71629e 100644
--- a/src/flash/lpc2000.c
+++ b/src/flash/lpc2000.c
@@ -53,43 +53,6 @@
  * - 176x (tested with LPC1768)
  */
 
-static int lpc2000_register_commands(struct command_context_s *cmd_ctx);
-static int lpc2000_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
-static int lpc2000_erase(struct flash_bank_s *bank, int first, int last);
-static int lpc2000_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int lpc2000_write(struct flash_bank_s *bank, uint8_t *buffer, uint32_t offset, uint32_t count);
-static int lpc2000_probe(struct flash_bank_s *bank);
-static int lpc2000_erase_check(struct flash_bank_s *bank);
-static int lpc2000_protect_check(struct flash_bank_s *bank);
-static int lpc2000_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
-static int lpc2000_handle_part_id_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
-flash_driver_t lpc2000_flash =
-{
-	.name = &quot;lpc2000&quot;,
-	.register_commands = lpc2000_register_commands,
-	.flash_bank_command = lpc2000_flash_bank_command,
-	.erase = lpc2000_erase,
-	.protect = lpc2000_protect,
-	.write = lpc2000_write,
-	.probe = lpc2000_probe,
-	.auto_probe = lpc2000_probe,
-	.erase_check = lpc2000_erase_check,
-	.protect_check = lpc2000_protect_check,
-	.info = lpc2000_info
-};
-
-static int lpc2000_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *lpc2000_cmd = register_command(cmd_ctx, NULL, &quot;lpc2000&quot;, NULL, COMMAND_ANY, NULL);
-
-	register_command(cmd_ctx, lpc2000_cmd, &quot;part_id&quot;, lpc2000_handle_part_id_command, COMMAND_EXEC,
-					 &quot;print part id of lpc2000 flash bank &lt;num&gt;&quot;);
-
-	return ERROR_OK;
-}
-
 static int lpc2000_build_sector_list(struct flash_bank_s *bank)
 {
 	lpc2000_flash_bank_t *lpc2000_info = bank-&gt;driver_priv;
@@ -812,3 +775,31 @@ static int lpc2000_handle_part_id_command(struct command_context_s *cmd_ctx, cha
 
 	return ERROR_OK;
 }
+
+static int lpc2000_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *lpc2000_cmd = register_command(cmd_ctx, NULL, &quot;lpc2000&quot;,
+			NULL, COMMAND_ANY, NULL);
+
+	register_command(cmd_ctx, lpc2000_cmd, &quot;part_id&quot;,
+			lpc2000_handle_part_id_command, COMMAND_EXEC,
+			&quot;print part id of lpc2000 flash bank &lt;num&gt;&quot;);
+
+	return ERROR_OK;
+}
+
+flash_driver_t lpc2000_flash = {
+		.name = &quot;lpc2000&quot;,
+		.register_commands = &amp;lpc2000_register_commands,
+		.flash_bank_command = &amp;lpc2000_flash_bank_command,
+		.erase = &amp;lpc2000_erase,
+		.protect = &amp;lpc2000_protect,
+		.write = &amp;lpc2000_write,
+		.probe = &amp;lpc2000_probe,
+		.auto_probe = &amp;lpc2000_probe,
+		.erase_check = &amp;lpc2000_erase_check,
+		.protect_check = &amp;lpc2000_protect_check,
+		.info = &amp;lpc2000_info,
+	};
+
+
diff --git a/src/flash/lpc288x.c b/src/flash/lpc288x.c
index 61aa3a0..4827c21 100644
--- a/src/flash/lpc288x.c
+++ b/src/flash/lpc288x.c
@@ -84,6 +84,7 @@
 /* F_CLK_TIME */
 #define FCT_CLK_DIV_MASK    0x0FFF
 
+#if 0
 static int lpc288x_register_commands(struct command_context_s *cmd_ctx);
 static int lpc288x_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct flash_bank_s *bank);
 static int lpc288x_erase(struct flash_bank_s *bank, int first, int last);
@@ -93,31 +94,12 @@ static int lpc288x_probe(struct flash_bank_s *bank);
 static int lpc288x_erase_check(struct flash_bank_s *bank);
 static int lpc288x_protect_check(struct flash_bank_s *bank);
 static int lpc288x_info(struct flash_bank_s *bank, char *buf, int buf_size);
+#endif
 static uint32_t lpc288x_wait_status_busy(flash_bank_t *bank, int timeout);
 static void lpc288x_load_timer(int erase, struct target_s *target);
 static void lpc288x_set_flash_clk(struct flash_bank_s *bank);
 static uint32_t lpc288x_system_ready(struct flash_bank_s *bank);
 
-flash_driver_t lpc288x_flash =
-{
-	.name = &quot;lpc288x&quot;,
-	.register_commands = lpc288x_register_commands,
-	.flash_bank_command = lpc288x_flash_bank_command,
-	.erase = lpc288x_erase,
-	.protect = lpc288x_protect,
-	.write = lpc288x_write,
-	.probe = lpc288x_probe,
-	.auto_probe = lpc288x_probe,
-	.erase_check = lpc288x_erase_check,
-	.protect_check = lpc288x_protect_check,
-	.info = lpc288x_info
-};
-
-static int lpc288x_register_commands(struct command_context_s *cmd_ctx)
-{
-	return ERROR_OK;
-}
-
 static uint32_t lpc288x_wait_status_busy(flash_bank_t *bank, int timeout)
 {
 	uint32_t status;
@@ -499,3 +481,16 @@ static int lpc288x_protect(struct flash_bank_s *bank, int set, int first, int la
 
 	return ERROR_OK;
 }
+
+flash_driver_t lpc288x_flash = {
+		.name = &quot;lpc288x&quot;,
+		.flash_bank_command = &amp;lpc288x_flash_bank_command,
+		.erase = &amp;lpc288x_erase,
+		.protect = &amp;lpc288x_protect,
+		.write = &amp;lpc288x_write,
+		.probe = &amp;lpc288x_probe,
+		.auto_probe = &amp;lpc288x_probe,
+		.erase_check = &amp;lpc288x_erase_check,
+		.protect_check = &amp;lpc288x_protect_check,
+		.info = &amp;lpc288x_info,
+	};
diff --git a/src/flash/lpc2900.c b/src/flash/lpc2900.c
index e15d93b..f2daab4 100644
--- a/src/flash/lpc2900.c
+++ b/src/flash/lpc2900.c
@@ -171,21 +171,6 @@ typedef struct lpc2900_flash_bank_s
 } lpc2900_flash_bank_t;
 
 
-
-
-static int lpc2900_register_commands(struct command_context_s *cmd_ctx);
-static int lpc2900_flash_bank_command(struct command_context_s *cmd_ctx,
-                                      char *cmd, char **args, int argc,
-                                      struct flash_bank_s *bank);
-static int lpc2900_erase(struct flash_bank_s *bank, int first, int last);
-static int lpc2900_protect(struct flash_bank_s *bank, int set, int first, int last);
-static int lpc2900_write(struct flash_bank_s *bank,
-                         uint8_t *buffer, uint32_t offset, uint32_t count);
-static int lpc2900_probe(struct flash_bank_s *bank);
-static int lpc2900_erase_check(struct flash_bank_s *bank);
-static int lpc2900_protect_check(struct flash_bank_s *bank);
-static int lpc2900_info(struct flash_bank_s *bank, char *buf, int buf_size);
-
 static uint32_t lpc2900_wait_status(flash_bank_t *bank, uint32_t mask, int timeout);
 static void lpc2900_setup(struct flash_bank_s *bank);
 static uint32_t lpc2900_is_ready(struct flash_bank_s *bank);

commit 8b5c5c054d7ae08990e817a52bd28a326b27e54a
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 9 09:20:33 2009 -0800

    flash/*nand*.c: remove useless declarations
    
    Remove useless forward declarations.
    Moves command registration to end of files.
    Moves flash structure definition to end of files.
    
    Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;

diff --git a/src/flash/lpc3180_nand_controller.c b/src/flash/lpc3180_nand_controller.c
index ac079c6..309890c 100644
--- a/src/flash/lpc3180_nand_controller.c
+++ b/src/flash/lpc3180_nand_controller.c
@@ -24,37 +24,8 @@
 #include &quot;lpc3180_nand_controller.h&quot;
 #include &quot;nand.h&quot;
 
-static int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-static int lpc3180_register_commands(struct command_context_s *cmd_ctx);
-static int lpc3180_init(struct nand_device_s *device);
 static int lpc3180_reset(struct nand_device_s *device);
-static int lpc3180_command(struct nand_device_s *device, uint8_t command);
-static int lpc3180_address(struct nand_device_s *device, uint8_t address);
-static int lpc3180_write_data(struct nand_device_s *device, uint16_t data);
-static int lpc3180_read_data(struct nand_device_s *device, void *data);
-static int lpc3180_write_page(struct nand_device_s *device, uint32_t page, uint8_t *data, uint32_t data_size, uint8_t *oob, uint32_t oob_size);
-static int lpc3180_read_page(struct nand_device_s *device, uint32_t page, uint8_t *data, uint32_t data_size, uint8_t *oob, uint32_t oob_size);
 static int lpc3180_controller_ready(struct nand_device_s *device, int timeout);
-static int lpc3180_nand_ready(struct nand_device_s *device, int timeout);
-
-static int handle_lpc3180_select_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
-nand_flash_controller_t lpc3180_nand_controller =
-{
-	.name = &quot;lpc3180&quot;,
-	.nand_device_command = lpc3180_nand_device_command,
-	.register_commands = lpc3180_register_commands,
-	.init = lpc3180_init,
-	.reset = lpc3180_reset,
-	.command = lpc3180_command,
-	.address = lpc3180_address,
-	.write_data = lpc3180_write_data,
-	.read_data = lpc3180_read_data,
-	.write_page = lpc3180_write_page,
-	.read_page = lpc3180_read_page,
-	.controller_ready = lpc3180_controller_ready,
-	.nand_ready = lpc3180_nand_ready,
-};
 
 /* nand device lpc3180 &lt;target#&gt; &lt;oscillator_frequency&gt;
  */
@@ -95,15 +66,6 @@ static int lpc3180_nand_device_command(struct command_context_s *cmd_ctx, char *
 	return ERROR_OK;
 }
 
-static int lpc3180_register_commands(struct command_context_s *cmd_ctx)
-{
-	command_t *lpc3180_cmd = register_command(cmd_ctx, NULL, &quot;lpc3180&quot;, NULL, COMMAND_ANY, &quot;commands specific to the LPC3180 NAND flash controllers&quot;);
-
-	register_command(cmd_ctx, lpc3180_cmd, &quot;select&quot;, handle_lpc3180_select_command, COMMAND_EXEC, &quot;select &lt;'mlc'|'slc'&gt; controller (default is mlc)&quot;);
-
-	return ERROR_OK;
-}
-
 static int lpc3180_pll(int fclkin, uint32_t pll_ctrl)
 {
 	int bypass = (pll_ctrl &amp; 0x8000) &gt;&gt; 15;
@@ -910,3 +872,28 @@ static int handle_lpc3180_select_command(struct command_context_s *cmd_ctx, char
 
 	return ERROR_OK;
 }
+
+static int lpc3180_register_commands(struct command_context_s *cmd_ctx)
+{
+	command_t *lpc3180_cmd = register_command(cmd_ctx, NULL, &quot;lpc3180&quot;, NULL, COMMAND_ANY, &quot;commands specific to the LPC3180 NAND flash controllers&quot;);
+
+	register_command(cmd_ctx, lpc3180_cmd, &quot;select&quot;, handle_lpc3180_select_command, COMMAND_EXEC, &quot;select &lt;'mlc'|'slc'&gt; controller (default is mlc)&quot;);
+
+	return ERROR_OK;
+}
+
+nand_flash_controller_t lpc3180_nand_controller = {
+		.name = &quot;lpc3180&quot;,
+		.nand_device_command = lpc3180_nand_device_command,
+		.register_commands = lpc3180_register_commands,
+		.init = lpc3180_init,
+		.reset = lpc3180_reset,
+		.command = lpc3180_command,
+		.address = lpc3180_address,
+		.write_data = lpc3180_write_data,
+		.read_data = lpc3180_read_data,
+		.write_page = lpc3180_write_page,
+		.read_page = lpc3180_read_page,
+		.controller_ready = lpc3180_controller_ready,
+		.nand_ready = lpc3180_nand_ready,
+	};
diff --git a/src/flash/nand.c b/src/flash/nand.c
index 8f67624..ea1cb9e 100644
--- a/src/flash/nand.c
+++ b/src/flash/nand.c
@@ -28,16 +28,6 @@
 #include &quot;time_support.h&quot;
 #include &quot;fileio.h&quot;
 
-static int handle_nand_list_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_nand_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_nand_check_bad_blocks_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_nand_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_nand_write_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_nand_dump_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_nand_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
-static int handle_nand_raw_access_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-
 static int nand_read_page(struct nand_device_s *device, uint32_t page, uint8_t *data, uint32_t data_size, uint8_t *oob, uint32_t oob_size);
 //static int nand_read_plain(struct nand_device_s *device, uint32_t address, uint8_t *data, uint32_t data_size);
 
@@ -297,33 +287,6 @@ int nand_register_commands(struct command_context_s *cmd_ctx)
 	return ERROR_OK;
 }
 
-int nand_init(struct command_context_s *cmd_ctx)
-{
-	if (nand_devices)
-	{
-		register_command(cmd_ctx, nand_cmd, &quot;list&quot;, handle_nand_list_command, COMMAND_EXEC,
-						 &quot;list configured NAND flash devices&quot;);
-		register_command(cmd_ctx, nand_cmd, &quot;info&quot;, handle_nand_info_command, COMMAND_EXEC,
-						 &quot;print info about NAND flash device &lt;num&gt;&quot;);
-		register_command(cmd_ctx, nand_cmd, &quot;probe&quot;, handle_nand_probe_command, COMMAND_EXEC,
-						 &quot;identify NAND flash device &lt;num&gt;&quot;);
-		register_command(cmd_ctx, nand_cmd, &quot;check_bad_blocks&quot;, handle_nand_check_bad_blocks_command, COMMAND_EXEC,
-						 &quot;check NAND flash device &lt;num&gt; for bad blocks [&lt;offset&gt; &lt;length&gt;]&quot;);
-		register_command(cmd_ctx, nand_cmd, &quot;erase&quot;,
-				handle_nand_erase_command, COMMAND_EXEC,
-				&quot;erase blocks on NAND flash device &lt;num&gt; [&lt;offset&gt; &lt;length&gt;]&quot;);
-		register_command(cmd_ctx, nand_cmd, &quot;dump&quot;, handle_nand_dump_command, COMMAND_EXEC,
-						 &quot;dump from NAND flash device &lt;num&gt; &lt;filename&gt; &quot;
-						 &quot;&lt;offset&gt; &lt;length&gt; [oob_raw | oob_only]&quot;);
-		register_command(cmd_ctx, nand_cmd, &quot;write&quot;, handle_nand_write_command, COMMAND_EXEC,
-						 &quot;write to NAND flash device &lt;num&gt; &lt;filename&gt; &lt;offset&gt; [oob_raw | oob_only | oob_softecc | oob_softecc_kw]&quot;);
-		register_command(cmd_ctx, nand_cmd, &quot;raw_access&quot;, handle_nand_raw_access_command, COMMAND_EXEC,
-						 &quot;raw access to NAND flash device &lt;num&gt; ['enable'|'disable']&quot;);
-	}
-
-	return ERROR_OK;
-}
-
 nand_device_t *get_nand_device_by_num(int num)
 {
 	nand_device_t *p;
@@ -1639,3 +1602,40 @@ static int handle_nand_raw_access_command(struct command_context_s *cmd_ctx, cha
 
 	return ERROR_OK;
 }
+
+int nand_init(struct command_context_s *cmd_ctx)
+{
+	if (!nand_devices)
+		return ERROR_OK;
+
+	register_command(cmd_ctx, nand_cmd, &quot;list&quot;,
+			handle_nand_list_command, COMMAND_EXEC,
+			&quot;list configured NAND flash devices&quot;);
+	register_command(cmd_ctx, nand_cmd, &quot;info&quot;,
+			handle_nand_info_command, COMMAND_EXEC,
+			&quot;print info about NAND flash device &lt;num&gt;&quot;);
+	register_command(cmd_ctx, nand_cmd, &quot;probe&quot;,
+			handle_nand_probe_command, COMMAND_EXEC,
+			&quot;identify NAND flash device &lt;num&gt;&quot;);
+
+	register_command(cmd_ctx, nand_cmd, &quot;check_bad_blocks&quot;,
+			handle_nand_check_bad_blocks_command, COMMAND_EXEC,
+			&quot;check NAND flash device &lt;num&gt; for bad blocks [&lt;offset&gt; &lt;length&gt;]&quot;);
+	register_command(cmd_ctx, nand_cmd, &quot;erase&quot;,
+			handle_nand_erase_command, COMMAND_EXEC,
+			&quot;erase blocks on NAND flash device &lt;num&gt; [&lt;offset&gt; &lt;length&gt;]&quot;);
+	register_command(cmd_ctx, nand_cmd, &quot;dump&quot;,
+			handle_nand_dump_command, COMMAND_EXEC,
+			&quot;dump from NAND flash device &lt;num&gt; &lt;filename&gt; &quot;
+			 &quot;&lt;offset&gt; &lt;length&gt; [oob_raw | oob_only]&quot;);
+	register_command(cmd_ctx, nand_cmd, &quot;write&quot;,
+			handle_nand_write_command, COMMAND_EXEC,
+			&quot;write to NAND flash device &lt;num&gt; &lt;filename&gt; &lt;offset&gt; &quot;
+			&quot;[oob_raw | oob_only | oob_softecc | oob_softecc_kw]&quot;);
+
+	register_command(cmd_ctx, nand_cmd, &quot;raw_access&quot;,
+			handle_nand_raw_access_command, COMMAND_EXEC,
+			&quot;raw access to NAND flash device &lt;num&gt; ['enable'|'disable']&quot;);
+
+	return ERROR_OK;
+}
diff --git a/src/flash/s3c2410_nand.c b/src/flash/s3c2410_nand.c
index 2630697..4ec4f23 100644
--- a/src/flash/s3c2410_nand.c
+++ b/src/flash/s3c2410_nand.c
@@ -30,30 +30,6 @@
 
 #include &quot;s3c24xx_nand.h&quot;
 
-
-static int s3c2410_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-static int s3c2410_init(struct nand_device_s *device);
-static int s3c2410_read_data(struct nand_device_s *device, void *data);
-static int s3c2410_write_data(struct nand_device_s *device, uint16_t data);
-static int s3c2410_nand_ready(struct nand_device_s *device, int timeout);
-
-nand_flash_controller_t s3c2410_nand_controller =
-{
-	.name			= &quot;s3c2410&quot;,
-	.nand_device_command	= s3c2410_nand_device_command,
-	.register_commands	= s3c24xx_register_commands,
-	.init			= s3c2410_init,
-	.reset			= s3c24xx_reset,
-	.command		= s3c24xx_command,
-	.address		= s3c24xx_address,
-	.write_data		= s3c2410_write_data,
-	.read_data		= s3c2410_read_data,
-	.write_page		= s3c24xx_write_page,
-	.read_page		= s3c24xx_read_page,
-	.controller_ready	= s3c24xx_controller_ready,
-	.nand_ready		= s3c2410_nand_ready,
-};
-
 static int s3c2410_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
 				char **args, int argc,
 				struct nand_device_s *device)
@@ -136,3 +112,19 @@ static int s3c2410_nand_ready(struct nand_device_s *device, int timeout)
 
 	return 0;
 }
+
+nand_flash_controller_t s3c2410_nand_controller = {
+		.name = &quot;s3c2410&quot;,
+		.nand_device_command = &amp;s3c2410_nand_device_command,
+		.register_commands = &amp;s3c24xx_register_commands,
+		.init = &amp;s3c2410_init,
+		.reset = &amp;s3c24xx_reset,
+		.command = &amp;s3c24xx_command,
+		.address = &amp;s3c24xx_address,
+		.write_data = &amp;s3c2410_write_data,
+		.read_data = &amp;s3c2410_read_data,
+		.write_page = s3c24xx_write_page,
+		.read_page = s3c24xx_read_page,
+		.controller_ready = &amp;s3c24xx_controller_ready,
+		.nand_ready = &amp;s3c2410_nand_ready,
+	};
diff --git a/src/flash/s3c2412_nand.c b/src/flash/s3c2412_nand.c
index a7b1371..a995acc 100644
--- a/src/flash/s3c2412_nand.c
+++ b/src/flash/s3c2412_nand.c
@@ -30,29 +30,6 @@
 
 #include &quot;s3c24xx_nand.h&quot;
 
-
-static int s3c2412_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-static int s3c2412_init(struct nand_device_s *device);
-
-nand_flash_controller_t s3c2412_nand_controller =
-{
-	.name			= &quot;s3c2412&quot;,
-	.nand_device_command	= s3c2412_nand_device_command,
-	.register_commands	= s3c24xx_register_commands,
-	.init			= s3c2412_init,
-	.reset			= s3c24xx_reset,
-	.command		= s3c24xx_command,
-	.address		= s3c24xx_address,
-	.write_data		= s3c24xx_write_data,
-	.read_data		= s3c24xx_read_data,
-	.write_page		= s3c24xx_write_page,
-	.read_page		= s3c24xx_read_page,
-	.write_block_data	= s3c2440_write_block_data,
-	.read_block_data	= s3c2440_read_block_data,
-	.controller_ready	= s3c24xx_controller_ready,
-	.nand_ready		= s3c2440_nand_ready,
-};
-
 static int s3c2412_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
 				char **args, int argc,
 				struct nand_device_s *device)
@@ -89,3 +66,21 @@ static int s3c2412_init(struct nand_device_s *device)
 
 	return ERROR_OK;
 }
+
+nand_flash_controller_t s3c2412_nand_controller = {
+		.name = &quot;s3c2412&quot;,
+		.nand_device_command = &amp;s3c2412_nand_device_command,
+		.register_commands = &amp;s3c24xx_register_commands,
+		.init = &amp;s3c2412_init,
+		.reset = &amp;s3c24xx_reset,
+		.command = &amp;s3c24xx_command,
+		.address = &amp;s3c24xx_address,
+		.write_data = &amp;s3c24xx_write_data,
+		.read_data = &amp;s3c24xx_read_data,
+		.write_page = s3c24xx_write_page,
+		.read_page = s3c24xx_read_page,
+		.write_block_data = &amp;s3c2440_write_block_data,
+		.read_block_data = &amp;s3c2440_read_block_data,
+		.controller_ready = &amp;s3c24xx_controller_ready,
+		.nand_ready = &amp;s3c2440_nand_ready,
+	};
diff --git a/src/flash/s3c2440_nand.c b/src/flash/s3c2440_nand.c
index 54875da..2321382 100644
--- a/src/flash/s3c2440_nand.c
+++ b/src/flash/s3c2440_nand.c
@@ -31,29 +31,6 @@
 #include &quot;s3c24xx_nand.h&quot;
 
 
-static int s3c2440_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-static int s3c2440_init(struct nand_device_s *device);
-//static int s3c2440_nand_ready(struct nand_device_s *device, int timeout);
-
-nand_flash_controller_t s3c2440_nand_controller =
-{
-	.name			= &quot;s3c2440&quot;,
-	.nand_device_command	= s3c2440_nand_device_command,
-	.register_commands	= s3c24xx_register_commands,
-	.init			= s3c2440_init,
-	.reset			= s3c24xx_reset,
-	.command		= s3c24xx_command,
-	.address		= s3c24xx_address,
-	.write_data		= s3c24xx_write_data,
-	.read_data		= s3c24xx_read_data,
-	.write_page		= s3c24xx_write_page,
-	.read_page		= s3c24xx_read_page,
-	.write_block_data	= s3c2440_write_block_data,
-	.read_block_data	= s3c2440_read_block_data,
-	.controller_ready	= s3c24xx_controller_ready,
-	.nand_ready		= s3c2440_nand_ready,
-};
-
 static int s3c2440_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
 				char **args, int argc,
 				struct nand_device_s *device)
@@ -181,3 +158,21 @@ int s3c2440_write_block_data(struct nand_device_s *device, uint8_t *data, int da
 
 	return ERROR_OK;
 }
+
+nand_flash_controller_t s3c2440_nand_controller = {
+		.name = &quot;s3c2440&quot;,
+		.nand_device_command = &amp;s3c2440_nand_device_command,
+		.register_commands = &amp;s3c24xx_register_commands,
+		.init = &amp;s3c2440_init,
+		.reset = &amp;s3c24xx_reset,
+		.command = &amp;s3c24xx_command,
+		.address = &amp;s3c24xx_address,
+		.write_data = &amp;s3c24xx_write_data,
+		.read_data = &amp;s3c24xx_read_data,
+		.write_page = s3c24xx_write_page,
+		.read_page = s3c24xx_read_page,
+		.write_block_data = &amp;s3c2440_write_block_data,
+		.read_block_data = &amp;s3c2440_read_block_data,
+		.controller_ready = &amp;s3c24xx_controller_ready,
+		.nand_ready = &amp;s3c2440_nand_ready,
+	};
diff --git a/src/flash/s3c2443_nand.c b/src/flash/s3c2443_nand.c
index a50689d..c6effdf 100644
--- a/src/flash/s3c2443_nand.c
+++ b/src/flash/s3c2443_nand.c
@@ -31,28 +31,6 @@
 #include &quot;s3c24xx_nand.h&quot;
 
 
-static int s3c2443_nand_device_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc, struct nand_device_s *device);
-static int s3c2443_init(struct nand_device_s *device);
-
-nand_flash_controller_t s3c2443_nand_controller =
-{
-	.name			= &quot;s3c2443&quot;,
-	.nand_device_command	= s3c2443_nand_device_command,
-	.register_commands	= s3c24xx_register_commands,
-	.init			= s3c2443_init,
-	.reset			= s3c24xx_reset,
-	.command		= s3c24xx_command,
-	.address		= s3c24xx_address,
-	.write_data		= s3c24xx_write_data,
-	.read_data		= s3c24xx_read_data,
-	.write_page		= s3c24xx_write_page,
-	.read_page		= s3c24xx_read_page,
-	.write_block_data	= s3c2440_write_block_data,
-	.read_block_data	= s3c2440_read_block_data,
-	.controller_ready	= s3c24xx_controller_ready,
-	.nand_ready		= s3c2440_nand_ready,
-};
-
 static int s3c2443_nand_device_command(struct command_context_s *cmd_ctx, char *cmd,
 				char **args, int argc,
 				struct nand_device_s *device)
@@ -89,3 +67,21 @@ static int s3c2443_init(struct nand_device_s *device)
 
 	return ERROR_OK;
 }
+
+nand_flash_controller_t s3c2443_nand_controller = {
+		.name = &quot;s3c2443&quot;,
+		.nand_device_command = &amp;s3c2443_nand_device_command,
+		.register_commands = &amp;s3c24xx_register_commands,
+		.init = &amp;s3c2443_init,
+		.reset = &amp;s3c24xx_reset,
+		.command = &amp;s3c24xx_command,
+		.address = &amp;s3c24xx_address,
+		.write_data = &amp;s3c24xx_write_data,
+		.read_data = &amp;s3c24xx_read_data,
+		.write_page = s3c24xx_write_page,
+		.read_page = s3c24xx_read_page,
+		.write_block_data = &amp;s3c2440_write_block_data,
+		.read_block_data = &amp;s3c2440_read_block_data,
+		.controller_ready = &amp;s3c24xx_controller_ready,
+		.nand_ready = &amp;s3c2440_nand_ready,
+	};

commit 5c95741df7a582ef4901bc18f85f7c4f38b252dd
Author: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;
Date:   Mon Nov 9 09:20:33 2009 -0800

    flash/flash.c: remove forward declarations
    
    Remove useless forward declarations.
    Moves command registration to end of file.
    Moves flash structure definition to end of file.
    
    Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-svn">zw at superlucidity.net</A>&gt;

diff --git a/src/flash/flash.c b/src/flash/flash.c
index 22c6069..451abdc 100644
--- a/src/flash/flash.c
+++ b/src/flash/flash.c
@@ -31,18 +31,6 @@
 #include &quot;image.h&quot;
 #include &quot;time_support.h&quot;
 
-/* command handlers */
-static int handle_flash_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_info_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_probe_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_erase_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_erase_address_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_protect_check_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_erase_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_write_bank_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_write_image_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_fill_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
-static int handle_flash_protect_command(struct command_context_s *cmd_ctx, char *cmd, char **args, int argc);
 static int flash_write_unlock(target_t *target, image_t *image, uint32_t *written, int erase, bool unlock);
 
 /* flash drivers
@@ -132,14 +120,6 @@ int flash_driver_protect(struct flash_bank_s *bank, int set, int first, int last
 	return retval;
 }
 
-int flash_register_commands(struct command_context_s *cmd_ctx)
-{
-	flash_cmd = register_command(cmd_ctx, NULL, &quot;flash&quot;, NULL, COMMAND_ANY, NULL);
-
-	register_command(cmd_ctx, flash_cmd, &quot;bank&quot;, handle_flash_bank_command, COMMAND_CONFIG, &quot;flash bank &lt;driver&gt; &lt;base&gt; &lt;size&gt; &lt;chip_width&gt; &lt;bus_width&gt; &lt;target&gt; [driver_options ...]&quot;);
-	return ERROR_OK;
-}
-
 static int jim_flash_banks(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 {
 	flash_bank_t *p;
@@ -173,43 +153,6 @@ static int jim_flash_banks(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 	return JIM_OK;
 }
 
-int flash_init_drivers(struct command_context_s *cmd_ctx)
-{
-	register_jim(cmd_ctx, &quot;ocd_flash_banks&quot;, jim_flash_banks, &quot;return information about the flash banks&quot;);
-
-	if (!flash_banks)
-		return ERROR_OK;
-
-	register_command(cmd_ctx, flash_cmd, &quot;info&quot;, handle_flash_info_command, COMMAND_EXEC,
-					 &quot;print info about flash bank &lt;num&gt;&quot;);
-	register_command(cmd_ctx, flash_cmd, &quot;probe&quot;, handle_flash_probe_command, COMMAND_EXEC,
-					 &quot;identify flash bank &lt;num&gt;&quot;);
-	register_command(cmd_ctx, flash_cmd, &quot;erase_check&quot;, handle_flash_erase_check_command, COMMAND_EXEC,
-					 &quot;check erase state of sectors in flash bank &lt;num&gt;&quot;);
-	register_command(cmd_ctx, flash_cmd, &quot;protect_check&quot;, handle_flash_protect_check_command, COMMAND_EXEC,
-					 &quot;check protection state of sectors in flash bank &lt;num&gt;&quot;);
-	register_command(cmd_ctx, flash_cmd, &quot;erase_sector&quot;, handle_flash_erase_command, COMMAND_EXEC,
-					 &quot;erase sectors at &lt;bank&gt; &lt;first&gt; &lt;last&gt;&quot;);
-	register_command(cmd_ctx, flash_cmd, &quot;erase_address&quot;, handle_flash_erase_address_command, COMMAND_EXEC,
-					 &quot;erase address range &lt;address&gt; &lt;length&gt;&quot;);
-
-	register_command(cmd_ctx, flash_cmd, &quot;fillw&quot;, handle_flash_fill_command, COMMAND_EXEC,
-					 &quot;fill with pattern (no autoerase) &lt;address&gt; &lt;word_pattern&gt; &lt;count&gt;&quot;);
-	register_command(cmd_ctx, flash_cmd, &quot;fillh&quot;, handle_flash_fill_command, COMMAND_EXEC,
-					 &quot;fill with pattern &lt;address&gt; &lt;halfword_pattern&gt; &lt;count&gt;&quot;);
-	register_command(cmd_ctx, flash_cmd, &quot;fillb&quot;, handle_flash_fill_command, COMMAND_EXEC,
-					 &quot;fill with pattern &lt;address&gt; &lt;byte_pattern&gt; &lt;count&gt;&quot;);
-
-	register_command(cmd_ctx, flash_cmd, &quot;write_bank&quot;, handle_flash_write_bank_command, COMMAND_EXEC,
-					 &quot;write binary data to &lt;bank&gt; &lt;file&gt; &lt;offset&gt;&quot;);
-	register_command(cmd_ctx, flash_cmd, &quot;write_image&quot;, handle_flash_write_image_command, COMMAND_EXEC,
-					 &quot;write_image [erase] [unlock] &lt;file&gt; [offset] [type]&quot;);
-	register_command(cmd_ctx, flash_cmd, &quot;protect&quot;, handle_flash_protect_command, COMMAND_EXEC,
-					 &quot;set protection of sectors at &lt;bank&gt; &lt;first&gt; &lt;last&gt; &lt;on | off&gt;&quot;);
-
-	return ERROR_OK;
-}
-
 flash_bank_t *get_flash_bank_by_num_noprobe(int num)
 {
 	flash_bank_t *p;
@@ -1274,3 +1217,65 @@ int default_flash_blank_check(struct flash_bank_s *bank)
 
 	return ERROR_OK;
 }
+
+int flash_init_drivers(struct command_context_s *cmd_ctx)
+{
+	register_jim(cmd_ctx, &quot;ocd_flash_banks&quot;,
+			jim_flash_banks, &quot;return information about the flash banks&quot;);
+
+	if (!flash_banks)
+		return ERROR_OK;
+
+	register_command(cmd_ctx, flash_cmd, &quot;info&quot;,
+			handle_flash_info_command, COMMAND_EXEC,
+			&quot;print info about flash bank &lt;num&gt;&quot;);
+	register_command(cmd_ctx, flash_cmd, &quot;probe&quot;,
+			handle_flash_probe_command, COMMAND_EXEC,
+			&quot;identify flash bank &lt;num&gt;&quot;);
+	register_command(cmd_ctx, flash_cmd, &quot;erase_check&quot;,
+			handle_flash_erase_check_command, COMMAND_EXEC,
+			&quot;check erase state of sectors in flash bank &lt;num&gt;&quot;);
+	register_command(cmd_ctx, flash_cmd, &quot;protect_check&quot;,
+			handle_flash_protect_check_command, COMMAND_EXEC,
+			&quot;check protection state of sectors in flash bank &lt;num&gt;&quot;);
+	register_command(cmd_ctx, flash_cmd, &quot;erase_sector&quot;,
+			handle_flash_erase_command, COMMAND_EXEC,
+			&quot;erase sectors at &lt;bank&gt; &lt;first&gt; &lt;last&gt;&quot;);
+	register_command(cmd_ctx, flash_cmd, &quot;erase_address&quot;,
+			handle_flash_erase_address_command, COMMAND_EXEC,
+			&quot;erase address range &lt;address&gt; &lt;length&gt;&quot;);
+
+	register_command(cmd_ctx, flash_cmd, &quot;fillw&quot;,
+			handle_flash_fill_command, COMMAND_EXEC,
+			&quot;fill with pattern (no autoerase) &lt;address&gt; &lt;word_pattern&gt; &lt;count&gt;&quot;);
+	register_command(cmd_ctx, flash_cmd, &quot;fillh&quot;,
+			handle_flash_fill_command, COMMAND_EXEC,
+			&quot;fill with pattern &lt;address&gt; &lt;halfword_pattern&gt; &lt;count&gt;&quot;);
+	register_command(cmd_ctx, flash_cmd, &quot;fillb&quot;,
+			handle_flash_fill_command, COMMAND_EXEC,
+			&quot;fill with pattern &lt;address&gt; &lt;byte_pattern&gt; &lt;count&gt;&quot;);
+
+	register_command(cmd_ctx, flash_cmd, &quot;write_bank&quot;,
+			handle_flash_write_bank_command, COMMAND_EXEC,
+			&quot;write binary data to &lt;bank&gt; &lt;file&gt; &lt;offset&gt;&quot;);
+	register_command(cmd_ctx, flash_cmd, &quot;write_image&quot;,
+			handle_flash_write_image_command, COMMAND_EXEC,
+			&quot;write_image [erase] [unlock] &lt;file&gt; [offset] [type]&quot;);
+	register_command(cmd_ctx, flash_cmd, &quot;protect&quot;,
+			handle_flash_protect_command, COMMAND_EXEC,
+			&quot;set protection of sectors at &lt;bank&gt; &lt;first&gt; &lt;last&gt; &lt;on | off&gt;&quot;);
+
+	return ERROR_OK;
+}
+
+int flash_register_commands(struct command_context_s *cmd_ctx)
+{
+	flash_cmd = register_command(cmd_ctx, NULL, &quot;flash&quot;,
+			NULL, COMMAND_ANY, NULL);
+
+	register_command(cmd_ctx, flash_cmd, &quot;bank&quot;,
+			handle_flash_bank_command, COMMAND_CONFIG,
+			&quot;flash bank &lt;driver&gt; &lt;base&gt; &lt;size&gt; &quot;
+			&quot;&lt;chip_width&gt; &lt;bus_width&gt; &lt;target&gt; [driver_options ...]&quot;);
+	return ERROR_OK;
+}

-----------------------------------------------------------------------

Summary of changes:
 src/flash/aduc702x.c                |   42 ++++---------
 src/flash/at91sam3.c                |   29 ++++-----
 src/flash/at91sam7.c                |   68 +++++++++-----------
 src/flash/avrf.c                    |   89 +++++++++++--------------
 src/flash/cfi.c                     |   41 ++++--------
 src/flash/ecos.c                    |   38 ++++-------
 src/flash/faux.c                    |   38 ++++-------
 src/flash/flash.c                   |  119 ++++++++++++++++++----------------
 src/flash/lpc2000.c                 |   65 ++++++++-----------
 src/flash/lpc288x.c                 |   35 ++++------
 src/flash/lpc2900.c                 |   15 ----
 src/flash/lpc3180_nand_controller.c |   63 +++++++-----------
 src/flash/nand.c                    |   74 +++++++++++-----------
 src/flash/ocl.c                     |   44 ++++---------
 src/flash/pic32mx.c                 |   85 ++++++++++--------------
 src/flash/s3c2410_nand.c            |   40 +++++-------
 src/flash/s3c2412_nand.c            |   41 +++++-------
 src/flash/s3c2440_nand.c            |   41 +++++-------
 src/flash/s3c2443_nand.c            |   40 +++++------
 src/flash/stellaris.c               |   59 +++++++---------
 src/flash/stm32x.c                  |   86 +++++++++++--------------
 src/flash/str7x.c                   |   63 +++++++-----------
 src/flash/str9x.c                   |   63 +++++++-----------
 src/flash/str9xpec.c                |  123 ++++++++++++++++-------------------
 src/flash/tms470.c                  |   39 ++++-------
 25 files changed, 607 insertions(+), 833 deletions(-)


hooks/post-receive
-- 
Main OpenOCD repository

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001748.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-110-g7269ba5
</A></li>
	<LI>Next message: <A HREF="001750.html">[openocd-svn] Main OpenOCD repository branch, master,	updated. v0.3.0-119-gef6387a
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1749">[ date ]</a>
              <a href="thread.html#1749">[ thread ]</a>
              <a href="subject.html#1749">[ subject ]</a>
              <a href="author.html#1749">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-svn">More information about the openocd-svn
mailing list</a><br>
</body></html>
